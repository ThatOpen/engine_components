# .github/workflows/publish-npm.yml
name: Publish package to npmjs (OIDC)

on:
  workflow_call:
    inputs:
      package_dir:
        description: "Path to the package to publish"
        required: false
        type: string
        default: "packages/core"

jobs:
  publish:
    runs-on: ubuntu-latest

    # Required for npm Trusted Publishing (OIDC)
    permissions:
      contents: read
      id-token: write

    steps:
      - uses: actions/checkout@v4

      # Use a modern Node that can run npm 11+, and/or install npm 11.5.1+ explicitly
      - uses: actions/setup-node@v4
        with:
          node-version: "24"
          registry-url: "https://registry.npmjs.org"

      # Ensure the npm version meets the Trusted Publishing requirement
      - name: Ensure npm >= 11.5.1
        run: |
          npm i -g npm@^11.5.1
          npm --version

      # If you use Yarn (you do), keep it for install/build
      - name: Install deps
        run: |
          corepack enable
          yarn install --immutable

      # Publish via npm CLI (OIDC happens automatically; no NODE_AUTH_TOKEN)
      - name: Publish Core
        run: npm publish --access public
        working-directory: packages/core

      - name: Publish Front
        run: npm publish --access public
        working-directory: packages/front