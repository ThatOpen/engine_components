var k0=Object.defineProperty;var A0=(i,t,e)=>t in i?k0(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var ct=(i,t,e)=>(A0(i,typeof t!="symbol"?t+"":t,e),e);import{f as xe,g as yi,q as Je,V as L,C as gt,G as Ls,ag as su,y as Pt,s as gc,h as Kt,P as oi,L as ti,j as oe,ah as nu,O as bc,ai as wl,U as Gg,aj as xl,af as xr,S as Rs,M as Ve,Y as It,ak as T0,al as up,am as M0,W as se,an as co,x as P0,d as at,n as Cr,D as Bs,ao as $0,ap as O0,F as Ns,z as Bl,o as D0,p as I0,m as ru,k as Nl,aq as z0,w as L0,a0 as R0,a1 as B0,ar as ou,v as Xg,as as N0,at as Kg,au as Ie,av as ar,aw as F0,ax as pp,r as U0,ay as j0,az as Kh,aA as Qn,aB as V0,i as H0,e as W0,B as Ae,aC as Qg,aD as q0,aE as vi,aF as Y0,aG as fp,aH as Z0,aI as Ea,aJ as Rr,aK as G0,aL as X0,aM as K0,ae as Q0,aN as mp,l as J0,b as tw,c as Jg,a as Qh}from"./index-D_lOu8Cy.js";import{R as au,E as Fl,j as ew,c as tb,h as iw,F as Se,W as yc,S as lu,O as eb,k as sw,d as ib,l as ra,m as vc,n as nw,T as fs,H as cu,o as rw,C as ow,i as aw,p as lw}from"./graphic-vertex-picker-BY8Y4wOR.js";import{b as sb,a as cw,L as hw}from"./LineSegments2-DMoLV2Kl.js";class dw{constructor(t){ct(this,"alignments",[]);ct(this,"enabled",!0);ct(this,"world",null);ct(this,"_raycastable",[]);ct(this,"_components");this._components=t}update(){this.dispose();for(const t of this.alignments)for(const e of t.children){const s=e;s.updateWorldMatrix(!0,!0);for(const n of s.children){const r=n;if(r.isLine2&&r.userData.points){const o=new xe,a=new yi;a.geometry.setIndex(r.geometry.index);const l=new Float32Array(r.userData.points),c=new Je(l,3);o.setAttribute("position",c),a.geometry=o,a.userData.curve=r,a.applyMatrix4(r.matrixWorld),a.updateMatrixWorld(),this._raycastable.push(a)}}}}dispose(){for(const t of this._raycastable)t.geometry.dispose(),t.geometry=void 0;this._raycastable=[]}castRay(){if(!this.enabled||!this.world)return null;const s=this._components.get(au).get(this.world).castRayToObjects(this._raycastable);if(!s)return null;const n=s.object,r=n.geometry,o=s.index,a=r.attributes.position.array[o*3],l=r.attributes.position.array[o*3+1],c=r.attributes.position.array[o*3+2],h=r.attributes.position.array[o*3+3],d=r.attributes.position.array[o*3+4],u=r.attributes.position.array[o*3+5],p=new L(h-a,d-l,u-c).normalize();return{point:s.point,normal:p,curve:n.userData.curve,alignment:n.userData.curve.parent}}}class $s{static alignmentPercentageToPoint(t,e){const s=new L,n=new L,r=this.alignmentLength(t),o=e*r;let a=0;if(t.updateWorldMatrix(!0,!0),e===1)for(let l=t.children.length-1;l>=0;l--){const c=t.children[l],h=c.userData.points;if(!h)continue;const d=new L(h[h.length-3],h[h.length-2],h[h.length-1]);return d.applyMatrix4(c.matrixWorld),{normal:new L,point:d,curve:c,alignment:t}}for(const l of t.children){const c=l.userData.points;if(c)for(let h=0;h<c.length-3;h+=3){const d=s.set(c[h],c[h+1],c[h+2]),u=n.set(c[h+3],c[h+4],c[h+5]),p=d.distanceTo(u);if(a+p>=o){const m=o-a,f=u.clone().sub(d).normalize(),b=f.clone().multiplyScalar(m);return d.add(b),d.applyMatrix4(l.matrixWorld),{normal:f,point:d,curve:l,alignment:t}}a+=p}}return null}static curvePercentageToPoint(t,e,s){const n=new L,r=new L,o=this.curveLength(e),a=s*o;let l=0;const c=e.userData.points;if(!c)throw new Error("No points found in curve");for(let h=0;h<c.length-3;h+=3){const d=n.set(c[h],c[h+1],c[h+2]),u=r.set(c[h+3],c[h+4],c[h+5]),p=d.distanceTo(u);if(l+p>=a){const m=a-l,f=u.clone().sub(d).normalize(),b=f.clone().multiplyScalar(m);return d.add(b),{normal:f,point:d,curve:e,alignment:t}}l+=p}return null}static alignmentLength(t){let e=0;if(t.userData.length!==void 0)return t.userData.length;for(const s of t.children)"isLine2"in s&&(e+=this.curveLength(s));return t.userData.length=e,e}static curveLength(t){let e=0;if(t.userData.length!==void 0)return t.userData.length;const s=new L,n=new L,r=t.userData.points;if(!r)throw new Error("No points found in curve");for(let o=0;o<r.length-2-3;o+=3){const a=s.set(r[o],r[o+1],r[o+2]),l=n.set(r[o+3],r[o+4],r[o+5]);e+=a.distanceTo(l)}return t.userData.length=e,e}static curvePointToAlignmentPercentage(t,e,s){const n=new L,r=new L,o=this.alignmentLength(t);let a=0;t.updateWorldMatrix(!0,!0);for(const l of t.children){const c=l.userData.points;if(c)for(let h=0;h<c.length-3;h+=3){const d=n.set(c[h],c[h+1],c[h+2]),u=r.set(c[h+3],c[h+4],c[h+5]);d.applyMatrix4(l.matrixWorld),u.applyMatrix4(l.matrixWorld);const p=d.distanceTo(u),m=d.distanceTo(e)<.001,f=u.distanceTo(e)<.001,b=this.isPointbetweenTwoOthers(d,u,e);if(l===s&&(m||f||b)){const g=d.distanceTo(e);return(a+g)/o}a+=p}}return null}static isPointbetweenTwoOthers(t,e,s){const n=new L;n.subVectors(e,t).normalize();const r=new L;r.subVectors(s,t).normalize();const o=new L;o.subVectors(s,e).normalize();const l=1-.0016;return n.dot(r)>l&&n.dot(o)<-l}}class uw{constructor(t,e){ct(this,"onDisposed",new Fl);ct(this,"alignments",[]);ct(this,"components");ct(this,"onMarkerChange",new Fl);ct(this,"enabled",!0);ct(this,"highlightMaterial");ct(this,"increments",20);ct(this,"screenDistanceLimit",.1);ct(this,"fadeInTime",500);ct(this,"_mouseMarkers");ct(this,"_highlighted",new Set);ct(this,"_stationPoints",new Map);ct(this,"_originalHighlightMaterialId","originalHighlightMaterial");ct(this,"_world",null);ct(this,"_raycaster");ct(this,"_stationLabelColor",new gt(16777215));ct(this,"_stationLabelBackgroundColor",new gt(8014801));ct(this,"_stationPointerColor",new gt(16777215));ct(this,"_stationPointerBackgroundColor",new gt(4803766));ct(this,"_pointerDown",performance.now());ct(this,"_pointerDownTime",150);ct(this,"onPointerDown",()=>{this._pointerDown=performance.now()});ct(this,"onPointerUp",()=>{if(performance.now()-this._pointerDown>this._pointerDownTime)return;const t=this.setMarkerToMouse("select");t&&this.onMarkerChange.trigger(t)});ct(this,"onMouseMove",()=>{this.setMarkerToMouse("hover")});this.components=t,this.highlightMaterial=e,this._raycaster=new dw(t),this._raycaster.alignments=this.alignments}get world(){return this._world}set world(t){var n,r,o,a;if(t===this._world||(this._world&&this.setupEvents(!1),this._world=t,(n=this._mouseMarkers)==null||n.hover.removeFromParent(),(r=this._mouseMarkers)==null||r.select.removeFromParent(),(o=this._mouseMarkers)==null||o.hover.element.remove(),(a=this._mouseMarkers)==null||a.select.element.remove(),!t))return;this._raycaster.world=t;const e=this.newCivilLabel(0,"stationPointer");t.scene.three.add(e),e.visible=!1,e.element.style.transition="";const s=this.newCivilLabel(0,"stationPointer");s.element.style.transition="",s.element.style.opacity="0.5",t.scene.three.add(s),s.visible=!1,this._mouseMarkers={select:e,hover:s},this.setupEvents(!0)}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(t){this._stationLabelColor=t;const e=`#${t.getHexString()}`;for(const[,{labels:s}]of this._stationPoints){const n=[...s.children];for(const r of n){const o=this.getLabel(r);o.style.color=e;const a=this.getPoint(r);a.style.backgroundColor=e}}}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(t){this._stationLabelBackgroundColor=t;const e=`#${t.getHexString()}`;for(const[,{labels:s}]of this._stationPoints){const n=[...s.children];for(const r of n){const o=this.getLabel(r);o.style.backgroundColor=e;const a=this.getPoint(r);a.style.border=`2px solid ${e}`}}}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(t){this._stationPointerColor=t;const e=`#${t.getHexString()}`;if(this._mouseMarkers){const s=this._mouseMarkers.select,n=this.getLabel(s);n.style.color=e;const r=this.getPoint(s);r.style.backgroundColor=e}}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(t){this._stationPointerBackgroundColor=t;const e=`#${t.getHexString()}`;if(this._mouseMarkers){const s=this._mouseMarkers.select,n=this.getLabel(s);n.style.backgroundColor=e;const r=this.getPoint(s);r.style.border=`2px solid ${e}`}}dispose(){var t,e,s,n;this.clearHighlight(),this.clearStations(),this.alignments=[],(t=this._mouseMarkers)==null||t.hover.removeFromParent(),(e=this._mouseMarkers)==null||e.select.removeFromParent(),(s=this._mouseMarkers)==null||s.hover.element.remove(),(n=this._mouseMarkers)==null||n.select.element.remove(),this._raycaster.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){this._raycaster.update()}setMarkerAtPoint(t,e){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");this.updateMarkerValue(t,e),this._mouseMarkers[e].visible=!0,this._mouseMarkers[e].position.copy(t.point)}highlight(t,e=!0){e&&this.clearHighlight(this._highlighted);for(const s of t.children)"isLineSegments2"in s&&"material"in s&&(s.userData[this._originalHighlightMaterialId]=s.material,s.material=this.highlightMaterial);this._highlighted.add(t)}clearHighlight(t=this._highlighted){for(const e of t)for(const s of e.children)"isLineSegments2"in s&&"material"in s&&(s.material=s.userData[this._originalHighlightMaterialId],delete s.userData[this._originalHighlightMaterialId]);this._highlighted.clear()}createStations(t){if(!this.world||this._stationPoints.has(t.uuid))return;const e=new Ls;this.world.scene.three.add(e),this._stationPoints.set(t.uuid,{alignment:t,labels:e})}clearStations(t=this._stationPoints.keys()){for(const e of t){const s=this._stationPoints.get(e);s&&(this.clearLabels(s.labels),this._stationPoints.delete(e))}}updateStations(){if(!this.world)throw new Error("No world found!");if(!this.world.renderer)throw new Error("No renderer found!");const t=this.world.camera.three,e=this.world.renderer.three,s=new su,n=e.clippingPlanes,r=new L,o=new L;let a=!0;const l=new L;for(const[,{alignment:c,labels:h}]of this._stationPoints){this.clearLabels(h),c.updateWorldMatrix(!0,!0);const d=c.userData.initialStation;let u=d||0;const p=u%this.increments;let m=d+this.increments-p;for(const f of c.children){if(!("isLine2"in f))continue;const b=f;if(b.geometry.boundingBox||b.geometry.computeBoundingBox(),s.setFromProjectionMatrix(new Pt().multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse)),!s.intersectsBox(b.geometry.boundingBox)){const $=$s.curveLength(f);u+=$;const w=u%this.increments;m=u+this.increments-w;continue}const g=f.userData.points,y=g[0],v=g[1],_=g[2];if(l.set(y,v,_),l.applyMatrix4(f.matrixWorld),!this.isLabelClipped(n,l)){if(a){a=!1,r.set(l.x,l.y,l.z),r.project(t),r.z=0;const $=this.newCivilLabel(u,"stationLabel");$.position.set(l.x,l.y,l.z),h.children.push($)}else if(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit){const w=this.newCivilLabel(u,"stationLabel");w.position.set(l.x,l.y,l.z),h.children.push(w),r.copy(o)}}const S=new L,k=new L;for(let $=0;$<g.length-3;$+=3){S.set(g[$],g[$+1],g[$+2]),k.set(g[$+3],g[$+4],g[$+5]);const w=S.distanceTo(k),z=u+w,Y=k.clone().sub(S).normalize();for(;z>m;){const V=m-u,K=Y.clone();K.multiplyScalar(V);const{x:q,y:rt,z:U}=S.clone().add(K);if(l.set(q,rt,U),l.applyMatrix4(f.matrixWorld),!this.isLabelClipped(n,l)&&s.containsPoint(l)&&(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit)){const J=this.newCivilLabel(m,"stationLabel");J.position.set(l.x,l.y,l.z),h.children.push(J),r.copy(o)}m+=this.increments}u+=w}const T=g[g.length-3],M=g[g.length-2],O=g[g.length-1];if(l.set(T,M,O),l.applyMatrix4(f.matrixWorld),this.isLabelClipped(n,l)||!s.containsPoint(l))continue;if(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit){const $=this.newCivilLabel(u,"stationLabel");$.position.set(l.x,l.y,l.z),h.children.push($),r.copy(o)}}}}getCursorValue(){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");return this._mouseMarkers.select.element.children[0].children[0].innerText}setCursorValue(t,e){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const n=this._mouseMarkers[e].element.children[0].children[0];n.innerText=t}isLabelClipped(t,e){for(const s of t)if(!(s.distanceToPoint(e)>0))return!0;return!1}clearLabels(t){const e=[...t.children];for(const s of e)s.element.style.opacity="0";setTimeout(()=>{for(const s of e)s.removeFromParent(),s.element.remove(),s.visible=!1},this.fadeInTime)}newCivilLabel(t,e){const s=document.createElement("div"),n=e==="stationLabel"?this.stationLabelColor:this.stationPointerColor,r=e==="stationLabel"?this.stationLabelBackgroundColor:this.stationPointerBackgroundColor,o=document.createElement("div");o.style.width="4px",o.style.height="4px",o.style.borderRadius="50%",o.style.backgroundColor=`#${n.getHexString()}`,o.style.border=`2px solid #${r.getHexString()}`,o.style.display="flex",o.style.justifyContent="center";const a=this.getFormattedStation(t),l=document.createElement("div");l.innerText=a,l.style.backgroundColor=`#${r.getHexString()}`,l.style.color=`#${n.getHexString()}`,l.style.padding="0.3rem",l.style.position="absolute",l.style.bottom="1rem",l.style.borderRadius="6px",l.style.boxShadow="rgba(0, 0, 0, 0.6) 0px 4px 6px",o.appendChild(l);const c=new ew(s);return s.appendChild(o),e==="stationLabel"&&(s.style.transition=`opacity ${this.fadeInTime}ms ease-in-out`,s.style.opacity="0",setTimeout(()=>{s.style.opacity="1"})),c}setupEvents(t){if(!this.world)throw new Error("No world found!");if(this.world.isDisposing||!this.world.renderer)return;const e=this.world.renderer.three.domElement,n=this.components.get(au).get(this.world);n.three.params.Line||(n.three.params.Line={threshold:10}),e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointerup",this.onPointerUp),e.removeEventListener("pointermove",this.onMouseMove),t&&(e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointerup",this.onPointerUp),e.addEventListener("pointermove",this.onMouseMove))}setMarkerToMouse(t){if(!this.enabled||!this._mouseMarkers)return null;if(!this.world)throw new Error("No world found!");const e=this._raycaster.castRay();if(!e)return this._mouseMarkers[t].visible=!1,null;this._mouseMarkers[t].visible=!0;const s=e.point;return this._mouseMarkers[t].position.copy(s),this.updateMarkerValue(e,t),e}updateMarkerValue(t,e){if(!this._mouseMarkers)return;const{alignment:s,curve:n,point:r}=t,o=$s.curvePointToAlignmentPercentage(s,r,n);if(o===null)throw new Error("Point is not on the curve");const l=o*$s.alignmentLength(s)+s.userData.initialStation,c=this.getFormattedStation(l);this.setCursorValue(c,e)}getFormattedStation(t){const e=Math.floor(t/1e3),s=Math.round(t-e*1e3);return`${e}+${s}`}getLabel(t){return t.element.children[0].children[0]}getPoint(t){return t.element.children[0]}}const fc=class fc extends tb{constructor(e){super(e);ct(this,"onDisposed",new Fl);ct(this,"list",new Map);ct(this,"enabled",!0);ct(this,"highlightMaterial",new sb({color:8014801,linewidth:5,depthTest:!1}));ct(this,"_increments",20);ct(this,"_screenDistanceLimit",.1);ct(this,"_fadeInTime",500);ct(this,"_stationLabelColor",new gt(16777215));ct(this,"_stationLabelBackgroundColor",new gt(8014801));ct(this,"_stationPointerColor",new gt(16777215));ct(this,"_stationPointerBackgroundColor",new gt(4803766));this.components.add(fc.uuid,this)}get increments(){return this._increments}set increments(e){this._increments=e;for(const[,s]of this.list)s.increments=e}get screenDistanceLimit(){return this._screenDistanceLimit}set screenDistanceLimit(e){this._screenDistanceLimit=e;for(const[,s]of this.list)s.screenDistanceLimit=e}get fadeInTime(){return this._fadeInTime}set fadeInTime(e){this._fadeInTime=e;for(const[,s]of this.list)s.fadeInTime=e}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(e){this._stationLabelColor=e;for(const[,s]of this.list)s.stationLabelColor=e}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(e){this._stationLabelBackgroundColor=e;for(const[,s]of this.list)s.stationLabelBackgroundColor=e}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(e){this._stationPointerColor=e;for(const[,s]of this.list)s.stationPointerColor=e}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(e){this._stationPointerBackgroundColor=e;for(const[,s]of this.list)s.stationPointerBackgroundColor=e}create(e){const s=new uw(this.components,this.highlightMaterial);return this.list.set(e,s),s}delete(e){const s=this.list.get(e);s&&(s.dispose(),this.list.delete(e))}dispose(){for(const[,e]of this.list)e.dispose();this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){for(const[,e]of this.list)e.updateAlignments()}};ct(fc,"uuid","0a59c09e-2b49-474a-9320-99f51f40f182");let Jh=fc;const mc=class mc extends tb{constructor(e){super(e);ct(this,"enabled",!0);ct(this,"onDisposed",new Fl);ct(this,"_world",null);ct(this,"_flip",!1);ct(this,"_plane");ct(this,"_point",new L);ct(this,"_edgeMeshes",[]);ct(this,"_sectionVisible",!1);ct(this,"_sectionOffset",.1);ct(this,"edgeMaterial",new sb({color:0,linewidth:5,depthTest:!1}));this.components.add(mc.uuid,this)}get plane(){if(!this._plane)throw new Error("Plane is not set. You must give a world.");return this._plane}set plane(e){this._plane=e}get sectionVisible(){return this._sectionVisible}set sectionVisible(e){this._sectionVisible=e;for(const s of this._edgeMeshes)s.visible=e}get world(){return this._world}set world(e){var r;if(this._world=e,(r=this._plane)==null||r.dispose(),!e)return;const s=this.components.get(iw),n=s.createFromNormalAndCoplanarPoint(e,new L(1,0,0),new L);this.plane=s.list.get(n),this.plane.visible=!1,this.plane.enabled=!1}get flip(){return this._flip}set flip(e){var n;if(e===this._flip)return;this._flip=e;const s=(n=this.plane)==null?void 0:n.normal.clone().multiplyScalar(-1);for(const r of this._edgeMeshes)r.position.add(s.clone().multiplyScalar(this._sectionOffset));this.plane.setFromNormalAndCoplanarPoint(s,this._point),this.plane.update()}dispose(){var e;this.clearMeshes(),(e=this.plane)==null||e.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}async set(e,s){this.flip&&s.multiplyScalar(-1),this.plane.setFromNormalAndCoplanarPoint(s,e),this._point.copy(e)}async update(){this.clearMeshes();const e=this.components.get(Se);this.plane.update();const s=[];for(const[,n]of e.list)s.push(this.generateModelSection(n));await Promise.all(s)}async generateModelSection(e){if(!this.world)return;const s=this.plane.three.clone();s.constant-=.01;const{buffer:n}=await e.getSection(s),r=new xe,o=new Je(n,3,!1);r.setAttribute("position",o);const a=new gc(r),l=new cw;l.fromLineSegments(a);const c=new hw(l,this.edgeMaterial);c.frustumCulled=!1,this.world.scene.three.add(c),this._edgeMeshes.push(c),c.renderOrder=3,a.geometry.dispose()}clearMeshes(){for(const e of this._edgeMeshes)e.removeFromParent(),e.geometry.dispose(),e.material=void 0;this._edgeMeshes=[]}};ct(mc,"uuid","96b2c87e-d90b-4639-8257-8f01136fe324");let td=mc;var pw=Object.defineProperty,fw=(i,t,e)=>t in i?pw(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,P=(i,t,e)=>(fw(i,typeof t!="symbol"?t+"":t,e),e),mw=Object.defineProperty,gw=(i,t,e)=>t in i?mw(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,E=(i,t,e)=>(gw(i,typeof t!="symbol"?t+"":t,e),e);let et=class{constructor(){E(this,"enabled",!0),E(this,"trigger",i=>{if(!this.enabled)return;const t=this.handlers.slice(0);for(const e of t)e(i)}),E(this,"handlers",[])}add(i){this.handlers.push(i)}remove(i){this.handlers=this.handlers.filter(t=>t!==i)}reset(){this.handlers.length=0}},hu=class{constructor(t){E(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),E(this,"isResizeable",()=>"resize"in this&&"getSize"in this),E(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),E(this,"isHideable",()=>"visible"in this),E(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),E(this,"isSerializable",()=>"import"in this&&"export"in this),this.components=t}},zt=class extends hu{},nb=class extends hu{constructor(t){super(t),E(this,"worlds",new It),E(this,"onWorldChanged",new et),E(this,"_currentWorld",null),this.onWorldChanged.add(({world:e,action:s})=>{s==="removed"&&this.worlds.delete(e.uuid)})}set currentWorld(t){this._currentWorld=t}get currentWorld(){return this._currentWorld}},bw=class extends nb{constructor(){super(...arguments),E(this,"hasCameraControls",()=>"controls"in this)}},yw=class extends nb{constructor(){super(...arguments),E(this,"onAfterUpdate",new et),E(this,"onBeforeUpdate",new et),E(this,"onDisposed",new et),E(this,"onResize",new et),E(this,"onClippingPlanesUpdated",new et),E(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(t,e,s){e.isLocal=s;const n=this.clippingPlanes.indexOf(e);t&&n===-1?this.clippingPlanes.push(e):!t&&n>-1&&this.clippingPlanes.splice(n,1),this.three.clippingPlanes=this.clippingPlanes.filter(r=>!r.isLocal)}};const rb=class ed extends zt{constructor(t){super(t),E(this,"_disposedComponents",new Set),E(this,"enabled",!0),t.add(ed.uuid,this)}get(){return this._disposedComponents}destroy(t,e=!0,s=!0){t.removeFromParent();const n=t;n.dispose&&n.dispose(),this.disposeGeometryAndMaterials(t,e),s&&n.children&&n.children.length&&this.disposeChildren(n),t.children.length=0}disposeGeometry(t){t.boundsTree&&t.disposeBoundsTree&&t.disposeBoundsTree(),t.dispose()}disposeGeometryAndMaterials(t,e){const s=t;s.geometry&&this.disposeGeometry(s.geometry),e&&s.material&&ed.disposeMaterial(s),s.material=[],s.geometry=null}disposeChildren(t){for(const e of t.children)this.destroy(e)}static disposeMaterial(t){if(t.material)if(Array.isArray(t.material))for(const e of t.material)e.dispose();else t.material.dispose()}};E(rb,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let Ui=rb;const du=class ue{static create(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,s=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return`${ue._lut[t&255]+ue._lut[t>>8&255]+ue._lut[t>>16&255]+ue._lut[t>>24&255]}-${ue._lut[e&255]}${ue._lut[e>>8&255]}-${ue._lut[e>>16&15|64]}${ue._lut[e>>24&255]}-${ue._lut[s&63|128]}${ue._lut[s>>8&255]}-${ue._lut[s>>16&255]}${ue._lut[s>>24&255]}${ue._lut[n&255]}${ue._lut[n>>8&255]}${ue._lut[n>>16&255]}${ue._lut[n>>24&255]}`.toLowerCase()}static validate(t){if(!ue._pattern.test(t))throw new Error(`${t} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};E(du,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/);E(du,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let _e=du;var ka=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vw(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ob={},_c={};(function(i){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",e=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",s="["+t+"]["+e+"]*",n=new RegExp("^"+s+"$"),r=function(a,l){const c=[];let h=l.exec(a);for(;h;){const d=[];d.startIndex=l.lastIndex-h[0].length;const u=h.length;for(let p=0;p<u;p++)d.push(h[p]);c.push(d),h=l.exec(a)}return c},o=function(a){const l=n.exec(a);return!(l===null||typeof l>"u")};i.isExist=function(a){return typeof a<"u"},i.isEmptyObject=function(a){return Object.keys(a).length===0},i.merge=function(a,l,c){if(l){const h=Object.keys(l),d=h.length;for(let u=0;u<d;u++)c==="strict"?a[h[u]]=[l[h[u]]]:a[h[u]]=l[h[u]]}},i.getValue=function(a){return i.isExist(a)?a:""},i.isName=o,i.getAllMatches=r,i.nameRegexp=s})(_c);const uu=_c,_w={allowBooleanAttributes:!1,unpairedTags:[]};ob.validate=function(i,t){t=Object.assign({},_w,t);const e=[];let s=!1,n=!1;i[0]==="\uFEFF"&&(i=i.substr(1));for(let r=0;r<i.length;r++)if(i[r]==="<"&&i[r+1]==="?"){if(r+=2,r=bp(i,r),r.err)return r}else if(i[r]==="<"){let o=r;if(r++,i[r]==="!"){r=yp(i,r);continue}else{let a=!1;i[r]==="/"&&(a=!0,r++);let l="";for(;r<i.length&&i[r]!==">"&&i[r]!==" "&&i[r]!=="	"&&i[r]!==`
`&&i[r]!=="\r";r++)l+=i[r];if(l=l.trim(),l[l.length-1]==="/"&&(l=l.substring(0,l.length-1),r--),!Tw(l)){let d;return l.trim().length===0?d="Invalid space after '<'.":d="Tag '"+l+"' is an invalid name.",ie("InvalidTag",d,ze(i,r))}const c=Cw(i,r);if(c===!1)return ie("InvalidAttr","Attributes for '"+l+"' have open quote.",ze(i,r));let h=c.value;if(r=c.index,h[h.length-1]==="/"){const d=r-h.length;h=h.substring(0,h.length-1);const u=vp(h,t);if(u===!0)s=!0;else return ie(u.err.code,u.err.msg,ze(i,d+u.err.line))}else if(a)if(c.tagClosed){if(h.trim().length>0)return ie("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",ze(i,o));if(e.length===0)return ie("InvalidTag","Closing tag '"+l+"' has not been opened.",ze(i,o));{const d=e.pop();if(l!==d.tagName){let u=ze(i,d.tagStartPos);return ie("InvalidTag","Expected closing tag '"+d.tagName+"' (opened in line "+u.line+", col "+u.col+") instead of closing tag '"+l+"'.",ze(i,o))}e.length==0&&(n=!0)}}else return ie("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",ze(i,r));else{const d=vp(h,t);if(d!==!0)return ie(d.err.code,d.err.msg,ze(i,r-h.length+d.err.line));if(n===!0)return ie("InvalidXml","Multiple possible root nodes found.",ze(i,r));t.unpairedTags.indexOf(l)!==-1||e.push({tagName:l,tagStartPos:o}),s=!0}for(r++;r<i.length;r++)if(i[r]==="<")if(i[r+1]==="!"){r++,r=yp(i,r);continue}else if(i[r+1]==="?"){if(r=bp(i,++r),r.err)return r}else break;else if(i[r]==="&"){const d=kw(i,r);if(d==-1)return ie("InvalidChar","char '&' is not expected.",ze(i,r));r=d}else if(n===!0&&!gp(i[r]))return ie("InvalidXml","Extra text at the end",ze(i,r));i[r]==="<"&&r--}}else{if(gp(i[r]))continue;return ie("InvalidChar","char '"+i[r]+"' is not expected.",ze(i,r))}if(s){if(e.length==1)return ie("InvalidTag","Unclosed tag '"+e[0].tagName+"'.",ze(i,e[0].tagStartPos));if(e.length>0)return ie("InvalidXml","Invalid '"+JSON.stringify(e.map(r=>r.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return ie("InvalidXml","Start tag expected.",1);return!0};function gp(i){return i===" "||i==="	"||i===`
`||i==="\r"}function bp(i,t){const e=t;for(;t<i.length;t++)if(i[t]=="?"||i[t]==" "){const s=i.substr(e,t-e);if(t>5&&s==="xml")return ie("InvalidXml","XML declaration allowed only at the start of the document.",ze(i,t));if(i[t]=="?"&&i[t+1]==">"){t++;break}else continue}return t}function yp(i,t){if(i.length>t+5&&i[t+1]==="-"&&i[t+2]==="-"){for(t+=3;t<i.length;t++)if(i[t]==="-"&&i[t+1]==="-"&&i[t+2]===">"){t+=2;break}}else if(i.length>t+8&&i[t+1]==="D"&&i[t+2]==="O"&&i[t+3]==="C"&&i[t+4]==="T"&&i[t+5]==="Y"&&i[t+6]==="P"&&i[t+7]==="E"){let e=1;for(t+=8;t<i.length;t++)if(i[t]==="<")e++;else if(i[t]===">"&&(e--,e===0))break}else if(i.length>t+9&&i[t+1]==="["&&i[t+2]==="C"&&i[t+3]==="D"&&i[t+4]==="A"&&i[t+5]==="T"&&i[t+6]==="A"&&i[t+7]==="["){for(t+=8;t<i.length;t++)if(i[t]==="]"&&i[t+1]==="]"&&i[t+2]===">"){t+=2;break}}return t}const ww='"',xw="'";function Cw(i,t){let e="",s="",n=!1;for(;t<i.length;t++){if(i[t]===ww||i[t]===xw)s===""?s=i[t]:s!==i[t]||(s="");else if(i[t]===">"&&s===""){n=!0;break}e+=i[t]}return s!==""?!1:{value:e,index:t,tagClosed:n}}const Sw=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function vp(i,t){const e=uu.getAllMatches(i,Sw),s={};for(let n=0;n<e.length;n++){if(e[n][1].length===0)return ie("InvalidAttr","Attribute '"+e[n][2]+"' has no space in starting.",Br(e[n]));if(e[n][3]!==void 0&&e[n][4]===void 0)return ie("InvalidAttr","Attribute '"+e[n][2]+"' is without value.",Br(e[n]));if(e[n][3]===void 0&&!t.allowBooleanAttributes)return ie("InvalidAttr","boolean attribute '"+e[n][2]+"' is not allowed.",Br(e[n]));const r=e[n][2];if(!Aw(r))return ie("InvalidAttr","Attribute '"+r+"' is an invalid name.",Br(e[n]));if(!s.hasOwnProperty(r))s[r]=1;else return ie("InvalidAttr","Attribute '"+r+"' is repeated.",Br(e[n]))}return!0}function Ew(i,t){let e=/\d/;for(i[t]==="x"&&(t++,e=/[\da-fA-F]/);t<i.length;t++){if(i[t]===";")return t;if(!i[t].match(e))break}return-1}function kw(i,t){if(t++,i[t]===";")return-1;if(i[t]==="#")return t++,Ew(i,t);let e=0;for(;t<i.length;t++,e++)if(!(i[t].match(/\w/)&&e<20)){if(i[t]===";")break;return-1}return t}function ie(i,t,e){return{err:{code:i,msg:t,line:e.line||e,col:e.col}}}function Aw(i){return uu.isName(i)}function Tw(i){return uu.isName(i)}function ze(i,t){const e=i.substring(0,t).split(/\r?\n/);return{line:e.length,col:e[e.length-1].length+1}}function Br(i){return i.startIndex+i[1].length}var pu={};const ab={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(i,t){return t},attributeValueProcessor:function(i,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(i,t,e){return i}},Mw=function(i){return Object.assign({},ab,i)};pu.buildOptions=Mw;pu.defaultOptions=ab;let Pw=class{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}};var $w=Pw;const Ow=_c;function Dw(i,t){const e={};if(i[t+3]==="O"&&i[t+4]==="C"&&i[t+5]==="T"&&i[t+6]==="Y"&&i[t+7]==="P"&&i[t+8]==="E"){t=t+9;let s=1,n=!1,r=!1,o="";for(;t<i.length;t++)if(i[t]==="<"&&!r){if(n&&Lw(i,t))t+=7,[entityName,val,t]=Iw(i,t+1),val.indexOf("&")===-1&&(e[Fw(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(n&&Rw(i,t))t+=8;else if(n&&Bw(i,t))t+=8;else if(n&&Nw(i,t))t+=9;else if(zw)r=!0;else throw new Error("Invalid DOCTYPE");s++,o=""}else if(i[t]===">"){if(r?i[t-1]==="-"&&i[t-2]==="-"&&(r=!1,s--):s--,s===0)break}else i[t]==="["?n=!0:o+=i[t];if(s!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:e,i:t}}function Iw(i,t){let e="";for(;t<i.length&&i[t]!=="'"&&i[t]!=='"';t++)e+=i[t];if(e=e.trim(),e.indexOf(" ")!==-1)throw new Error("External entites are not supported");const s=i[t++];let n="";for(;t<i.length&&i[t]!==s;t++)n+=i[t];return[e,n,t]}function zw(i,t){return i[t+1]==="!"&&i[t+2]==="-"&&i[t+3]==="-"}function Lw(i,t){return i[t+1]==="!"&&i[t+2]==="E"&&i[t+3]==="N"&&i[t+4]==="T"&&i[t+5]==="I"&&i[t+6]==="T"&&i[t+7]==="Y"}function Rw(i,t){return i[t+1]==="!"&&i[t+2]==="E"&&i[t+3]==="L"&&i[t+4]==="E"&&i[t+5]==="M"&&i[t+6]==="E"&&i[t+7]==="N"&&i[t+8]==="T"}function Bw(i,t){return i[t+1]==="!"&&i[t+2]==="A"&&i[t+3]==="T"&&i[t+4]==="T"&&i[t+5]==="L"&&i[t+6]==="I"&&i[t+7]==="S"&&i[t+8]==="T"}function Nw(i,t){return i[t+1]==="!"&&i[t+2]==="N"&&i[t+3]==="O"&&i[t+4]==="T"&&i[t+5]==="A"&&i[t+6]==="T"&&i[t+7]==="I"&&i[t+8]==="O"&&i[t+9]==="N"}function Fw(i){if(Ow.isName(i))return i;throw new Error(`Invalid entity name ${i}`)}var Uw=Dw;const jw=/^[-+]?0x[a-fA-F0-9]+$/,Vw=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,Hw={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function Ww(i,t={}){if(t=Object.assign({},Hw,t),!i||typeof i!="string")return i;let e=i.trim();if(t.skipLike!==void 0&&t.skipLike.test(e))return i;if(i==="0")return 0;if(t.hex&&jw.test(e))return Yw(e,16);if(e.search(/[eE]/)!==-1){const s=e.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(s){if(t.leadingZeros)e=(s[1]||"")+s[3];else if(!(s[2]==="0"&&s[3][0]==="."))return i;return t.eNotation?Number(e):i}else return i}else{const s=Vw.exec(e);if(s){const n=s[1],r=s[2];let o=qw(s[3]);if(!t.leadingZeros&&r.length>0&&n&&e[2]!=="."||!t.leadingZeros&&r.length>0&&!n&&e[1]!==".")return i;if(t.leadingZeros&&r===i)return 0;{const a=Number(e),l=""+a;return l.search(/[eE]/)!==-1?t.eNotation?a:i:e.indexOf(".")!==-1?l==="0"&&o===""||l===o||n&&l==="-"+o?a:i:r?o===l||n+o===l?a:i:e===l||e===n+l?a:i}}else return i}}function qw(i){return i&&i.indexOf(".")!==-1&&(i=i.replace(/0+$/,""),i==="."?i="0":i[0]==="."?i="0"+i:i[i.length-1]==="."&&(i=i.substr(0,i.length-1))),i}function Yw(i,t){if(parseInt)return parseInt(i,t);if(Number.parseInt)return Number.parseInt(i,t);if(window&&window.parseInt)return window.parseInt(i,t);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}var Zw=Ww;const lb=_c,Nr=$w,Gw=Uw,Xw=Zw;let Kw=class{constructor(t){this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,s)=>String.fromCharCode(Number.parseInt(s,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,s)=>String.fromCharCode(Number.parseInt(s,16))}},this.addExternalEntities=Qw,this.parseXml=sx,this.parseTextData=Jw,this.resolveNameSpace=tx,this.buildAttributesMap=ix,this.isItStopNode=ax,this.replaceEntitiesValue=rx,this.readStopNodeData=cx,this.saveTextToParentTag=ox,this.addChild=nx}};function Qw(i){const t=Object.keys(i);for(let e=0;e<t.length;e++){const s=t[e];this.lastEntities[s]={regex:new RegExp("&"+s+";","g"),val:i[s]}}}function Jw(i,t,e,s,n,r,o){if(i!==void 0&&(this.options.trimValues&&!s&&(i=i.trim()),i.length>0)){o||(i=this.replaceEntitiesValue(i));const a=this.options.tagValueProcessor(t,i,e,n,r);return a==null?i:typeof a!=typeof i||a!==i?a:this.options.trimValues?sd(i,this.options.parseTagValue,this.options.numberParseOptions):i.trim()===i?sd(i,this.options.parseTagValue,this.options.numberParseOptions):i}}function tx(i){if(this.options.removeNSPrefix){const t=i.split(":"),e=i.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(i=e+t[1])}return i}const ex=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function ix(i,t,e){if(!this.options.ignoreAttributes&&typeof i=="string"){const s=lb.getAllMatches(i,ex),n=s.length,r={};for(let o=0;o<n;o++){const a=this.resolveNameSpace(s[o][1]);let l=s[o][4],c=this.options.attributeNamePrefix+a;if(a.length)if(this.options.transformAttributeName&&(c=this.options.transformAttributeName(c)),c==="__proto__"&&(c="#__proto__"),l!==void 0){this.options.trimValues&&(l=l.trim()),l=this.replaceEntitiesValue(l);const h=this.options.attributeValueProcessor(a,l,t);h==null?r[c]=l:typeof h!=typeof l||h!==l?r[c]=h:r[c]=sd(l,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(r[c]=!0)}if(!Object.keys(r).length)return;if(this.options.attributesGroupName){const o={};return o[this.options.attributesGroupName]=r,o}return r}}const sx=function(i){i=i.replace(/\r\n?/g,`
`);const t=new Nr("!xml");let e=t,s="",n="";for(let r=0;r<i.length;r++)if(i[r]==="<")if(i[r+1]==="/"){const o=pn(i,">",r,"Closing Tag is not closed.");let a=i.substring(r+2,o).trim();if(this.options.removeNSPrefix){const h=a.indexOf(":");h!==-1&&(a=a.substr(h+1))}this.options.transformTagName&&(a=this.options.transformTagName(a)),e&&(s=this.saveTextToParentTag(s,e,n));const l=n.substring(n.lastIndexOf(".")+1);if(a&&this.options.unpairedTags.indexOf(a)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${a}>`);let c=0;l&&this.options.unpairedTags.indexOf(l)!==-1?(c=n.lastIndexOf(".",n.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=n.lastIndexOf("."),n=n.substring(0,c),e=this.tagsNodeStack.pop(),s="",r=o}else if(i[r+1]==="?"){let o=id(i,r,!1,"?>");if(!o)throw new Error("Pi Tag is not closed.");if(s=this.saveTextToParentTag(s,e,n),!(this.options.ignoreDeclaration&&o.tagName==="?xml"||this.options.ignorePiTags)){const a=new Nr(o.tagName);a.add(this.options.textNodeName,""),o.tagName!==o.tagExp&&o.attrExpPresent&&(a[":@"]=this.buildAttributesMap(o.tagExp,n,o.tagName)),this.addChild(e,a,n)}r=o.closeIndex+1}else if(i.substr(r+1,3)==="!--"){const o=pn(i,"-->",r+4,"Comment is not closed.");if(this.options.commentPropName){const a=i.substring(r+4,o-2);s=this.saveTextToParentTag(s,e,n),e.add(this.options.commentPropName,[{[this.options.textNodeName]:a}])}r=o}else if(i.substr(r+1,2)==="!D"){const o=Gw(i,r);this.docTypeEntities=o.entities,r=o.i}else if(i.substr(r+1,2)==="!["){const o=pn(i,"]]>",r,"CDATA is not closed.")-2,a=i.substring(r+9,o);s=this.saveTextToParentTag(s,e,n);let l=this.parseTextData(a,e.tagname,n,!0,!1,!0,!0);l==null&&(l=""),this.options.cdataPropName?e.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]):e.add(this.options.textNodeName,l),r=o+2}else{let o=id(i,r,this.options.removeNSPrefix),a=o.tagName;const l=o.rawTagName;let c=o.tagExp,h=o.attrExpPresent,d=o.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),e&&s&&e.tagname!=="!xml"&&(s=this.saveTextToParentTag(s,e,n,!1));const u=e;if(u&&this.options.unpairedTags.indexOf(u.tagname)!==-1&&(e=this.tagsNodeStack.pop(),n=n.substring(0,n.lastIndexOf("."))),a!==t.tagname&&(n+=n?"."+a:a),this.isItStopNode(this.options.stopNodes,n,a)){let p="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)a[a.length-1]==="/"?(a=a.substr(0,a.length-1),n=n.substr(0,n.length-1),c=a):c=c.substr(0,c.length-1),r=o.closeIndex;else if(this.options.unpairedTags.indexOf(a)!==-1)r=o.closeIndex;else{const f=this.readStopNodeData(i,l,d+1);if(!f)throw new Error(`Unexpected end of ${l}`);r=f.i,p=f.tagContent}const m=new Nr(a);a!==c&&h&&(m[":@"]=this.buildAttributesMap(c,n,a)),p&&(p=this.parseTextData(p,a,n,!0,h,!0,!0)),n=n.substr(0,n.lastIndexOf(".")),m.add(this.options.textNodeName,p),this.addChild(e,m,n)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){a[a.length-1]==="/"?(a=a.substr(0,a.length-1),n=n.substr(0,n.length-1),c=a):c=c.substr(0,c.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));const p=new Nr(a);a!==c&&h&&(p[":@"]=this.buildAttributesMap(c,n,a)),this.addChild(e,p,n),n=n.substr(0,n.lastIndexOf("."))}else{const p=new Nr(a);this.tagsNodeStack.push(e),a!==c&&h&&(p[":@"]=this.buildAttributesMap(c,n,a)),this.addChild(e,p,n),e=p}s="",r=d}}else s+=i[r];return t.child};function nx(i,t,e){const s=this.options.updateTag(t.tagname,e,t[":@"]);s===!1||(typeof s=="string"&&(t.tagname=s),i.addChild(t))}const rx=function(i){if(this.options.processEntities){for(let t in this.docTypeEntities){const e=this.docTypeEntities[t];i=i.replace(e.regx,e.val)}for(let t in this.lastEntities){const e=this.lastEntities[t];i=i.replace(e.regex,e.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const e=this.htmlEntities[t];i=i.replace(e.regex,e.val)}i=i.replace(this.ampEntity.regex,this.ampEntity.val)}return i};function ox(i,t,e,s){return i&&(s===void 0&&(s=Object.keys(t.child).length===0),i=this.parseTextData(i,t.tagname,e,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,s),i!==void 0&&i!==""&&t.add(this.options.textNodeName,i),i=""),i}function ax(i,t,e){const s="*."+e;for(const n in i){const r=i[n];if(s===r||t===r)return!0}return!1}function lx(i,t,e=">"){let s,n="";for(let r=t;r<i.length;r++){let o=i[r];if(s)o===s&&(s="");else if(o==='"'||o==="'")s=o;else if(o===e[0])if(e[1]){if(i[r+1]===e[1])return{data:n,index:r}}else return{data:n,index:r};else o==="	"&&(o=" ");n+=o}}function pn(i,t,e,s){const n=i.indexOf(t,e);if(n===-1)throw new Error(s);return n+t.length-1}function id(i,t,e,s=">"){const n=lx(i,t+1,s);if(!n)return;let r=n.data;const o=n.index,a=r.search(/\s/);let l=r,c=!0;a!==-1&&(l=r.substring(0,a),r=r.substring(a+1).trimStart());const h=l;if(e){const d=l.indexOf(":");d!==-1&&(l=l.substr(d+1),c=l!==n.data.substr(d+1))}return{tagName:l,tagExp:r,closeIndex:o,attrExpPresent:c,rawTagName:h}}function cx(i,t,e){const s=e;let n=1;for(;e<i.length;e++)if(i[e]==="<")if(i[e+1]==="/"){const r=pn(i,">",e,`${t} is not closed`);if(i.substring(e+2,r).trim()===t&&(n--,n===0))return{tagContent:i.substring(s,e),i:r};e=r}else if(i[e+1]==="?")e=pn(i,"?>",e+1,"StopNode is not closed.");else if(i.substr(e+1,3)==="!--")e=pn(i,"-->",e+3,"StopNode is not closed.");else if(i.substr(e+1,2)==="![")e=pn(i,"]]>",e,"StopNode is not closed.")-2;else{const r=id(i,e,">");r&&((r&&r.tagName)===t&&r.tagExp[r.tagExp.length-1]!=="/"&&n++,e=r.closeIndex)}}function sd(i,t,e){if(t&&typeof i=="string"){const s=i.trim();return s==="true"?!0:s==="false"?!1:Xw(i,e)}else return lb.isExist(i)?i:""}var hx=Kw,cb={};function dx(i,t){return hb(i,t)}function hb(i,t,e){let s;const n={};for(let r=0;r<i.length;r++){const o=i[r],a=ux(o);let l="";if(e===void 0?l=a:l=e+"."+a,a===t.textNodeName)s===void 0?s=o[a]:s+=""+o[a];else{if(a===void 0)continue;if(o[a]){let c=hb(o[a],t,l);const h=fx(c,t);o[":@"]?px(c,o[":@"],l,t):Object.keys(c).length===1&&c[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?c=c[t.textNodeName]:Object.keys(c).length===0&&(t.alwaysCreateTextNode?c[t.textNodeName]="":c=""),n[a]!==void 0&&n.hasOwnProperty(a)?(Array.isArray(n[a])||(n[a]=[n[a]]),n[a].push(c)):t.isArray(a,l,h)?n[a]=[c]:n[a]=c}}}return typeof s=="string"?s.length>0&&(n[t.textNodeName]=s):s!==void 0&&(n[t.textNodeName]=s),n}function ux(i){const t=Object.keys(i);for(let e=0;e<t.length;e++){const s=t[e];if(s!==":@")return s}}function px(i,t,e,s){if(t){const n=Object.keys(t),r=n.length;for(let o=0;o<r;o++){const a=n[o];s.isArray(a,e+"."+a,!0,!0)?i[a]=[t[a]]:i[a]=t[a]}}}function fx(i,t){const{textNodeName:e}=t,s=Object.keys(i).length;return!!(s===0||s===1&&(i[e]||typeof i[e]=="boolean"||i[e]===0))}cb.prettify=dx;const{buildOptions:mx}=pu,gx=hx,{prettify:bx}=cb,yx=ob;let vx=class{constructor(t){this.externalEntities={},this.options=mx(t)}parse(t,e){if(typeof t!="string")if(t.toString)t=t.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(e){e===!0&&(e={});const r=yx.validate(t,e);if(r!==!0)throw Error(`${r.err.msg}:${r.err.line}:${r.err.col}`)}const s=new gx(this.options);s.addExternalEntities(this.externalEntities);const n=s.parseXml(t);return this.options.preserveOrder||n===void 0?n:bx(n,this.options)}addEntity(t,e){if(e.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(t.indexOf("&")!==-1||t.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(e==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=e}};var _x=vx;const wx=`
`;function xx(i,t){let e="";return t.format&&t.indentBy.length>0&&(e=wx),db(i,t,"",e)}function db(i,t,e,s){let n="",r=!1;for(let o=0;o<i.length;o++){const a=i[o],l=Cx(a);if(l===void 0)continue;let c="";if(e.length===0?c=l:c=`${e}.${l}`,l===t.textNodeName){let m=a[l];Sx(c,t)||(m=t.tagValueProcessor(l,m),m=ub(m,t)),r&&(n+=s),n+=m,r=!1;continue}else if(l===t.cdataPropName){r&&(n+=s),n+=`<![CDATA[${a[l][0][t.textNodeName]}]]>`,r=!1;continue}else if(l===t.commentPropName){n+=s+`<!--${a[l][0][t.textNodeName]}-->`,r=!0;continue}else if(l[0]==="?"){const m=_p(a[":@"],t),f=l==="?xml"?"":s;let b=a[l][0][t.textNodeName];b=b.length!==0?" "+b:"",n+=f+`<${l}${b}${m}?>`,r=!0;continue}let h=s;h!==""&&(h+=t.indentBy);const d=_p(a[":@"],t),u=s+`<${l}${d}`,p=db(a[l],t,c,h);t.unpairedTags.indexOf(l)!==-1?t.suppressUnpairedNode?n+=u+">":n+=u+"/>":(!p||p.length===0)&&t.suppressEmptyNode?n+=u+"/>":p&&p.endsWith(">")?n+=u+`>${p}${s}</${l}>`:(n+=u+">",p&&s!==""&&(p.includes("/>")||p.includes("</"))?n+=s+t.indentBy+p+s:n+=p,n+=`</${l}>`),r=!0}return n}function Cx(i){const t=Object.keys(i);for(let e=0;e<t.length;e++){const s=t[e];if(i.hasOwnProperty(s)&&s!==":@")return s}}function _p(i,t){let e="";if(i&&!t.ignoreAttributes)for(let s in i){if(!i.hasOwnProperty(s))continue;let n=t.attributeValueProcessor(s,i[s]);n=ub(n,t),n===!0&&t.suppressBooleanAttributes?e+=` ${s.substr(t.attributeNamePrefix.length)}`:e+=` ${s.substr(t.attributeNamePrefix.length)}="${n}"`}return e}function Sx(i,t){i=i.substr(0,i.length-t.textNodeName.length-1);let e=i.substr(i.lastIndexOf(".")+1);for(let s in t.stopNodes)if(t.stopNodes[s]===i||t.stopNodes[s]==="*."+e)return!0;return!1}function ub(i,t){if(i&&i.length>0&&t.processEntities)for(let e=0;e<t.entities.length;e++){const s=t.entities[e];i=i.replace(s.regex,s.val)}return i}var Ex=xx;const kx=Ex,Ax={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(i,t){return t},attributeValueProcessor:function(i,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function qs(i){this.options=Object.assign({},Ax,i),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=Px),this.processTextOrObjNode=Tx,this.options.format?(this.indentate=Mx,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}qs.prototype.build=function(i){return this.options.preserveOrder?kx(i,this.options):(Array.isArray(i)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(i={[this.options.arrayNodeName]:i}),this.j2x(i,0).val)};qs.prototype.j2x=function(i,t){let e="",s="";for(let n in i)if(Object.prototype.hasOwnProperty.call(i,n))if(typeof i[n]>"u")this.isAttribute(n)&&(s+="");else if(i[n]===null)this.isAttribute(n)?s+="":n[0]==="?"?s+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:s+=this.indentate(t)+"<"+n+"/"+this.tagEndChar;else if(i[n]instanceof Date)s+=this.buildTextValNode(i[n],n,"",t);else if(typeof i[n]!="object"){const r=this.isAttribute(n);if(r)e+=this.buildAttrPairStr(r,""+i[n]);else if(n===this.options.textNodeName){let o=this.options.tagValueProcessor(n,""+i[n]);s+=this.replaceEntitiesValue(o)}else s+=this.buildTextValNode(i[n],n,"",t)}else if(Array.isArray(i[n])){const r=i[n].length;let o="",a="";for(let l=0;l<r;l++){const c=i[n][l];if(!(typeof c>"u"))if(c===null)n[0]==="?"?s+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:s+=this.indentate(t)+"<"+n+"/"+this.tagEndChar;else if(typeof c=="object")if(this.options.oneListGroup){const h=this.j2x(c,t+1);o+=h.val,this.options.attributesGroupName&&c.hasOwnProperty(this.options.attributesGroupName)&&(a+=h.attrStr)}else o+=this.processTextOrObjNode(c,n,t);else if(this.options.oneListGroup){let h=this.options.tagValueProcessor(n,c);h=this.replaceEntitiesValue(h),o+=h}else o+=this.buildTextValNode(c,n,"",t)}this.options.oneListGroup&&(o=this.buildObjectNode(o,n,a,t)),s+=o}else if(this.options.attributesGroupName&&n===this.options.attributesGroupName){const r=Object.keys(i[n]),o=r.length;for(let a=0;a<o;a++)e+=this.buildAttrPairStr(r[a],""+i[n][r[a]])}else s+=this.processTextOrObjNode(i[n],n,t);return{attrStr:e,val:s}};qs.prototype.buildAttrPairStr=function(i,t){return t=this.options.attributeValueProcessor(i,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&t==="true"?" "+i:" "+i+'="'+t+'"'};function Tx(i,t,e){const s=this.j2x(i,e+1);return i[this.options.textNodeName]!==void 0&&Object.keys(i).length===1?this.buildTextValNode(i[this.options.textNodeName],t,s.attrStr,e):this.buildObjectNode(s.val,t,s.attrStr,e)}qs.prototype.buildObjectNode=function(i,t,e,s){if(i==="")return t[0]==="?"?this.indentate(s)+"<"+t+e+"?"+this.tagEndChar:this.indentate(s)+"<"+t+e+this.closeTag(t)+this.tagEndChar;{let n="</"+t+this.tagEndChar,r="";return t[0]==="?"&&(r="?",n=""),(e||e==="")&&i.indexOf("<")===-1?this.indentate(s)+"<"+t+e+r+">"+i+n:this.options.commentPropName!==!1&&t===this.options.commentPropName&&r.length===0?this.indentate(s)+`<!--${i}-->`+this.newLine:this.indentate(s)+"<"+t+e+r+this.tagEndChar+i+this.indentate(s)+n}};qs.prototype.closeTag=function(i){let t="";return this.options.unpairedTags.indexOf(i)!==-1?this.options.suppressUnpairedNode||(t="/"):this.options.suppressEmptyNode?t="/":t=`></${i}`,t};qs.prototype.buildTextValNode=function(i,t,e,s){if(this.options.cdataPropName!==!1&&t===this.options.cdataPropName)return this.indentate(s)+`<![CDATA[${i}]]>`+this.newLine;if(this.options.commentPropName!==!1&&t===this.options.commentPropName)return this.indentate(s)+`<!--${i}-->`+this.newLine;if(t[0]==="?")return this.indentate(s)+"<"+t+e+"?"+this.tagEndChar;{let n=this.options.tagValueProcessor(t,i);return n=this.replaceEntitiesValue(n),n===""?this.indentate(s)+"<"+t+e+this.closeTag(t)+this.tagEndChar:this.indentate(s)+"<"+t+e+">"+n+"</"+t+this.tagEndChar}};qs.prototype.replaceEntitiesValue=function(i){if(i&&i.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const e=this.options.entities[t];i=i.replace(e.regex,e.val)}return i};function Mx(i){return this.options.indentBy.repeat(i)}function Px(i){return i.startsWith(this.options.attributeNamePrefix)&&i!==this.options.textNodeName?i.substr(this.attrPrefixLen):!1}var $x=qs;const Ox=_x,Dx=$x;var wc={XMLParser:Ox,XMLBuilder:Dx};let xc=class{};E(xc,"parser",new wc.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));E(xc,"builder",new wc.XMLBuilder({attributeNamePrefix:"$",ignoreAttributes:!1,suppressBooleanAttributes:!1}));let Rt=class Cl{static join(t){const e={};for(const s of t)for(const n in s)if(!e[n])e[n]=new Set(s[n]);else for(const r of s[n])e[n].add(r);return e}static intersect(t){if(t.length===0)return{};let e=Cl.clone(t[0]);for(let s=1;s<t.length;s++){const n=t[s],r={};for(const o in e)if(n[o]){const a=new Set;for(const l of e[o])n[o].has(l)&&a.add(l);a.size>0&&(r[o]=a)}e=r}return e}static clone(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}static remove(t,e,s=!1){s&&(t=Cl.clone(t));for(const n in e)if(t[n]){for(const r of e[n])t[n].delete(r);t[n].size===0&&delete t[n]}}static add(t,e,s=!1){s&&(t=Cl.clone(t));for(const n in e)if(!t[n])t[n]=new Set(e[n]);else for(const r of e[n])t[n].add(r)}static append(t,e,...s){let n=t[e];n||(n=new Set,t[e]=n);for(const r of s)n.add(r)}static isEqual(t,e){const s=Object.keys(t),n=Object.keys(e);if(s.length!==n.length)return!1;for(const r of s){if(!e[r]||t[r].size!==e[r].size)return!1;for(const o of t[r])if(!e[r].has(o))return!1}return!0}static isEmpty(t){return Object.values(t).reduce((e,s)=>e+s.size,0)===0}static toRaw(t){const e={};for(const s in t)e[s]=Array.from(t[s]);return e}static fromRaw(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}},th=class{static isEntry(t){return new Set(["Boolean","Color","Text","Number","Select","Vector3","TextSet","None"]).has(t.type)}static copySchema(t,e={}){for(const s in t){const n=t[s];this.isEntry(n)?e[s]=this.copyEntry(n):(e[s]={},this.copySchema(n,e[s]))}return e}static copyEntry(t){if(t.type==="Boolean"){const e=t;return{type:e.type,value:e.value}}if(t.type==="Color"){const e=t;return{type:e.type,value:e.value.clone()}}if(t.type==="Text"){const e=t;return{type:e.type,value:e.value}}if(t.type==="Number"){const e=t;return{type:e.type,value:e.value,min:e.min,max:e.max,interpolable:e.interpolable}}if(t.type==="Select"){const e=t;return{type:e.type,value:e.value,multiple:e.multiple,options:new Set(e.options)}}if(t.type==="Vector3"){const e=t;return{type:e.type,value:e.value.clone()}}if(t.type==="TextSet"){const e=t;return{type:e.type,value:new Set(e.value)}}if(t.type==="None"){const e=t;return{type:e.type,value:e.value}}throw new Error("Invalid entry!")}},Ix=class{constructor(){E(this,"list",new Set)}add(t){for(const e of t)this.list.add(e)}remove(t){for(const e of t)this.list.delete(e)}set(t){for(const e of this.list)e.enabled=t}reset(){for(const t of this.list)t.reset()}},Cc=class{constructor(t,e,s,n){E(this,"_component"),E(this,"name"),E(this,"uuid"),this._component=t,this.name=s,this.uuid=n??_e.create(),e.get(fu).list.set(this.uuid,this)}get controls(){return th.copySchema(this._config)}set(t){for(const e in t)if(e in this){const s=e;this[s]=t[e].value}}export(t=this._config,e={}){for(const s in t){const n=t[s];if(th.isEntry(n))if(n.type==="Color"){const{r,g:o,b:a}=n.value;e[s]={...n,value:{r,g:o,b:a}}}else if(n.type==="Vector3"){const{x:r,y:o,z:a}=n.value;e[s]={...n,value:{x:r,y:o,z:a}}}else if(n.type==="TextSet"){const r=Array.from(n.value);e[s]={...n,value:r}}else if(n.type==="Select"){const r=Array.from(n.options);e[s]={...n,options:r}}else e[s]={...n};else e[s]={},this.export(n,e[s])}return e}import(t,e={},s=!0){for(const n in t){const r=t[n];if(th.isEntry(r))if(r.type==="Color"){const{r:o,g:a,b:l}=r.value;e[n]={...r,value:new gt(o,a,l)}}else if(r.type==="Vector3"){const{x:o,y:a,z:l}=r.value;e[n]={...r,value:new L(o,a,l)}}else r.type==="TextSet"?e[n]={...r,value:new Set(r.value)}:r.type==="Select"?e[n]={...r,options:new Set(r.options)}:e[n]={...r};else e[n]={},this.import(r,e[n],!1)}s&&this.set(e)}};const pb=class fb extends zt{constructor(t){super(t),E(this,"list",new It),E(this,"enabled",!0),t.add(fb.uuid,this)}};E(pb,"uuid","b8c764e0-6b24-4e77-9a32-35fa728ee5b4");let fu=pb,mb=class{constructor(t){E(this,"_event"),E(this,"_position",new Kt),E(this,"onDisposed",new et),E(this,"updateMouseInfo",e=>{this._event=e}),this.dom=t,this.setupEvents(!0)}get position(){return this.updatePosition(!1),this._position.clone()}get rawPosition(){return this.updatePosition(!0),this._position.clone()}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}updatePosition(t){if(this._event){const e=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(e,this._event,t),this._position.y=this.getPositionY(e,this._event,t)}}getPositionY(t,e,s){const n=this.getDataObject(e);return s?n.clientY:-((n.clientY-t.top)/(t.bottom-t.top))*2+1}getPositionX(t,e,s){const n=this.getDataObject(e);return s?n.clientX:(n.clientX-t.left)/(t.right-t.left)*2-1}getDataObject(t){return t instanceof MouseEvent?t:t.touches[0]}setupEvents(t){t?(this.dom.addEventListener("pointermove",this.updateMouseInfo),this.dom.addEventListener("touchstart",this.updateMouseInfo)):(this.dom.removeEventListener("pointermove",this.updateMouseInfo),this.dom.removeEventListener("touchstart",this.updateMouseInfo))}};const gb=class bb extends zt{constructor(t){super(t),E(this,"onDisposed",new et),E(this,"onBeforeDispose",new et),E(this,"onFragmentsLoaded",new et),E(this,"baseCoordinationModel",""),E(this,"baseCoordinationMatrix",new Pt),E(this,"enabled",!0),E(this,"_core"),this.components.add(bb.uuid,this)}get initialized(){return!!this._core}get list(){return this.core.models.list}get core(){if(!this._core)throw new Error("FragmentsManager not initialized. Call init() first.");return this._core}get _hasCoordinationModel(){return this.baseCoordinationModel!==""}dispose(){this.onBeforeDispose.trigger(),this._core&&(this.core.dispose(),this._core=void 0),this.baseCoordinationModel="",this.onFragmentsLoaded.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}init(t){this._core=new T0(t),this.core.onModelLoaded.add(async()=>{if(this._hasCoordinationModel)return;const e=[...this.list.values()][0];e&&(this.baseCoordinationModel=e.modelId,this.baseCoordinationMatrix=await e.getCoordinationMatrix())}),this.list.onItemDeleted.add(()=>{this.list.size>0||(this.baseCoordinationModel="",this.baseCoordinationMatrix=new Pt)})}async raycast(t){const e=[];for(const r of this.core.models.list.values())if(t.snappingClasses&&t.snappingClasses.length>0){const o=await r.raycastWithSnapping(t);if(o&&o.length>0)e.push(o[0]);else{const a=await r.raycast(t);a&&e.push(a)}}else{const o=await r.raycast(t);o&&e.push(o)}if(await Promise.all(e),e.length===0)return;let s=e[0],n=s.distance;for(let r=1;r<e.length;r++)e[r].distance<n&&(n=e[r].distance,s=e[r]);return s}async getPositions(t){const e=[],s=async(r,o)=>{const a=await r.getPositions(o);for(const l of a)e.push(l)},n=[];for(const r in t){const o=this.core.models.list.get(r);o&&n.push(s(o,Array.from(t[r])))}return await Promise.all(n),e}async getBBoxes(t){const e=[],s=async(r,o)=>{const a=await r.getBoxes(o);if(a)for(const l of a)e.push(l)},n=[];for(const r in t){const o=this.core.models.list.get(r);o&&n.push(s(o,Array.from(t[r])))}return await Promise.all(n),e}async highlight(t,e){await this.forEachModel(e,"highlight",t)}async getData(t,e){const s={};for(const[n,r]of Object.entries(t)){const o=this.list.get(n);if(!o)continue;if(r.size===0){s[n]=[];continue}const a=await o.getItemsData([...r],e);s[n]=a}return s}async resetHighlight(t){await this.forEachModel(t,"resetHighlight")}async forEachModel(t,e,...s){const n={};if(t)for(const o in t){const a=t[o];n[o]=Array.from(a)}else for(const o of this.core.models.list.keys())n[o]=void 0;const r=[];for(const o in n){const a=this.core.models.list.get(o);if(a){const l=n[o],c=a[e](l,...s);r.push(c)}}await Promise.all(r)}async guidsToModelIdMap(t){const e={};for(const[s,n]of this.list){const r=(await n.getLocalIdsByGuids([...t])).filter(o=>o!==null);e[s]=new Set(r)}return e}async modelIdMapToGuids(t){const e=[];for(const[s,n]of Object.entries(t)){const r=this.list.get(s);if(!r)continue;const o=(await r.getGuidsByLocalIds([...n])).filter(a=>a!==null);e.push(...o)}return e}applyBaseCoordinateSystem(t,e){const s=new Pt;return e&&s.copy(e.clone()).invert(),s.multiply(this.baseCoordinationMatrix),t.applyMatrix4(s),s}};E(gb,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let ut=gb,zx=class{constructor(){E(this,"wasm",{path:"",absolute:!1,logLevel:z0.LOG_LEVEL_OFF}),E(this,"webIfc",{COORDINATE_TO_ORIGIN:!0}),E(this,"autoSetWasm",!0),E(this,"customLocateFileHandler",null)}};const Lx=class nd extends zt{constructor(t){super(t),E(this,"onDisposed",new et),E(this,"onIfcStartedLoading",new et),E(this,"onIfcImporterInitialized",new et),E(this,"onSetup",new et),E(this,"settings",new zx),E(this,"webIfc",new up),E(this,"enabled",!0),this.components.add(nd.uuid,this)}dispose(){this.webIfc=null,this.onDisposed.trigger(nd.uuid),this.onDisposed.reset()}async setup(t){this.settings={...this.settings,...t},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(t,e,s,n){const r=this.components.get(ut);if(!r.initialized)throw new Error("You need to initialize fragments first.");this.settings.autoSetWasm&&await this.autoSetWasm(),r.core.settings.autoCoordinate=e;const o=new M0;o.wasm.path=this.settings.wasm.path,o.wasm.absolute=this.settings.wasm.absolute,o.webIfcSettings=this.settings.webIfc,this.onIfcImporterInitialized.trigger(o),n!=null&&n.instanceCallback&&n.instanceCallback(o);const a=await o.process({...n==null?void 0:n.processData,bytes:t});return await r.core.load(a,{modelId:s,userData:n==null?void 0:n.userData})}async readIfcFile(t){const{path:e,absolute:s,logLevel:n}=this.settings.wasm;return this.webIfc.SetWasmPath(e,s),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModel(t,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new up}async autoSetWasm(){const t=await fetch(`https://unpkg.com/@thatopen/components@${jb.release}/package.json`);if(!t.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const e=await t.json();if(!("web-ifc"in e.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const s=e.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${s}/`,this.settings.wasm.absolute=!0}}};E(Lx,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");const yb=class vb extends zt{constructor(t){super(t),E(this,"enabled",!0),this.components.add(vb.uuid,this)}async set(t,e){const s=this.components.get(ut),n=[];if(e)for(const[r,o]of Object.entries(e)){const a=s.list.get(r);a&&n.push(a.setVisible([...o],t))}else for(const r of s.list.values())n.push(r.setVisible(void 0,t));await Promise.all(n),await s.core.update(!0)}async isolate(t){await Promise.all([this.set(!1),this.set(!0,t)])}async toggle(t){const e=[],s=this.components.get(ut);for(const[n,r]of Object.entries(t)){const o=s.list.get(n);o&&e.push(o.toggleVisible([...r]))}await Promise.all(e),await s.core.update(!0)}async getVisibilityMap(t,e){const s=[],n=[],r=this.components.get(ut);if(e)for(const l of e){const c=r.list.get(l);c&&(s.push(c.modelId),n.push(c.getItemsByVisibility(t)))}else for(const l of r.list.values())s.push(l.modelId),n.push(l.getItemsByVisibility(t));const o=await Promise.all(n),a={};for(const[l,c]of s.entries())a[c]=o[l];return a}};E(yb,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");let Rx=yb;const _b=class rd extends zt{constructor(t){super(t),E(this,"enabled",!0),E(this,"onDisposed",new et),E(this,"list",new se),this.components.add(rd.uuid,this)}dispose(t=!0){this.list.clear(),this.onDisposed.trigger(rd.uuid),t&&(this.onDisposed.reset(),this.list.eventsEnabled=!1,this.list.dispose())}get(){const t=new oe;for(const e of this.list)t.union(e);return t}async addFromModelIdMap(t){const e=this.components.get(ut),s=new oe;for(const[n,r]of Object.entries(t)){const o=e.list.get(n);if(!o)continue;const a=await o.getMergedBox([...r]);s.union(a)}this.list.add(s)}addFromModels(t){const e=this.components.get(ut);for(const[s,n]of e.list)t&&!t.some(r=>r.test(s))||this.list.add(n.box)}async getCenter(t){this.list.clear(),await this.addFromModelIdMap(t);const e=this.get();this.list.clear();const s=new L;return e.getCenter(s),s}async getCameraOrientation(t,e=1){const s=this.components.get(ut);this.list.clear();for(const[c,h]of s.list)this.list.add(h.box);const n=this.get();this.list.clear();const r=new L;n.getCenter(r);const o=new L;n.getSize(o);const a=Math.max(o.x,o.y,o.z)*e,l=new L;switch(t){case"front":l.set(r.x,r.y,r.z+a);break;case"back":l.set(r.x,r.y,r.z-a);break;case"left":l.set(r.x-a,r.y,r.z);break;case"right":l.set(r.x+a,r.y,r.z);break;case"top":l.set(r.x,r.y+a,r.z);break;case"bottom":l.set(r.x,r.y-a,r.z);break;default:l.set(r.x,r.y,r.z+a)}return{position:l,target:r}}};E(_b,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");let Ul=_b,Bx=class{constructor(t,e){E(this,"name","Query"),E(this,"customData",{}),E(this,"_components"),E(this,"_queries",[]),E(this,"_aggregation","exclusive"),E(this,"result",null),E(this,"cache",!0),E(this,"serializeQueryParameters",s=>{var n;return{categories:(n=s.categories)==null?void 0:n.map(r=>r.source),attributes:s.attributes?{aggregation:s.attributes.aggregation,queries:s.attributes.queries.map(this.serializeAttributeQuery)}:void 0,relation:s.relation?{name:s.relation.name,query:s.relation.query?this.serializeQueryParameters(s.relation.query):void 0}:void 0}}),E(this,"deserializeQueryParameters",s=>{var n;return{categories:(n=s.categories)==null?void 0:n.map(r=>new RegExp(r)),attributes:s.attributes?{aggregation:s.attributes.aggregation,queries:s.attributes.queries.map(this.deserializeAttributeQuery)}:void 0,relation:s.relation?{name:s.relation.name,query:s.relation.query?this.deserializeQueryParameters(s.relation.query):void 0}:void 0}}),this._components=t,this.queries=e}set queries(t){this._queries=t,this.clearCache()}get queries(){return this._queries}set aggregation(t){t!==this._aggregation&&this.clearCache(),this._aggregation=t}get aggregation(){return this._aggregation}async test(t){const{modelIds:e,force:s}={force:!1,...t};if(this.result&&!s)return this.result;const n=await this._components.get(vo).getItems(this.queries,{modelIds:e,aggregation:this.aggregation});return this.cache&&(this.result=n),n}clearCache(){this.result=null}serializeAttributeQuery(t){let e;return Array.isArray(t.value)?e=t.value.map(s=>s.source):t.value instanceof RegExp?e=t.value.source:e=t.value,{name:t.name.source,value:e,type:t.type instanceof RegExp?t.type.source:t.type,negate:t.negate,itemIds:t.itemIds}}toJSON(){return{guid:this._components.get(vo).list.getKey(this)??_e.create(),name:this.name,customData:this.customData,queries:this.queries.map(this.serializeQueryParameters),aggregation:this.aggregation,cache:this.cache}}deserializeAttributeQuery(t){let e;return Array.isArray(t.value)?e=t.value.map(s=>new RegExp(s)):typeof t.value=="string"?e=new RegExp(t.value):e=t.value,{name:new RegExp(t.name),value:e,type:t.type?new RegExp(t.type):void 0,negate:t.negate,itemIds:t.itemIds}}fromJSON(t){return this.name=t.name,this.customData=t.customData,this.aggregation=t.aggregation,this.cache=t.cache,this.queries=t.queries.map(this.deserializeQueryParameters),this}};const wb=class xb extends zt{constructor(t){super(t),E(this,"enabled",!0),E(this,"list",new It),t.add(xb.uuid,this)}async getItems(t,e){let s;if(e){const{modelIds:a,items:l}=e;if(l){const c=Object.keys(l);c.length>0&&(s=c.map(h=>new RegExp(`^${h}$`)))}else a&&(s=a)}const n=(e==null?void 0:e.aggregation)??"exclusive",r=this.components.get(ut),o=await Promise.all(t.map(async a=>{const l={};return await Promise.all(Array.from(r.list).map(async([c,h])=>{var d;if(s&&!s.some(m=>m.test(c)))return;const u=(d=e==null?void 0:e.items)==null?void 0:d[c],p=await h.getItemsByQuery(a,{localIds:u?[...u]:void 0});l[c]=new Set(p)})),l}));return n==="inclusive"?Rt.join(o):Rt.intersect(o)}create(t,e){const s=new Bx(this.components,e);return this.list.set(t,s),s}async addFromCategories(t){const e=new Set,s=this.components.get(ut);for(const[n,r]of s.list){if(t&&!t.some(l=>l.test(n)))continue;const o=(await r.getItemsWithGeometryCategories()).filter(l=>l!==null),a=new Set(o);for(const l of a)this.list.has(l)||(this.create(l,[{categories:[new RegExp(`^${l}$`)]}]),e.add(l))}return[...e]}import(t){const{data:e}=t,s=[];if(!e)return s;for(const n of e){const r=this.create(n.guid,[]);r.fromJSON(n),s.push(r)}return s}export(){const t=[];for(const[e,s]of this.list.entries()){const n={...s.toJSON(),name:e};t.push(n)}return{data:t}}};E(wb,"uuid","0da7ad77-f734-42ca-942f-a074adfd1e3a");let vo=wb;const Cb=class Sb extends zt{constructor(t){super(t),E(this,"enabled",!0),E(this,"onDisposed",new et),E(this,"list",new It),E(this,"defaultSaveFunction",e=>"value"in e.Name?e.Name.value:null),E(this,"onBeforeFragmentsDispose",async e=>{const{key:s,value:n}=e,r=await n.getLocalIds(),o={[s]:new Set(r)};this.removeItems(o)}),t.add(Sb.uuid,this),this.setupEvents(),t.get(ut).list.onBeforeDelete.add(this.onBeforeFragmentsDispose)}setupEvents(){this.list.onBeforeDelete.add(({value:t})=>t.dispose())}getClassificationGroups(t){let e=this.list.get(t);return e||(e=new It,this.list.set(t,e)),e}getModelItems(t,e,s){const{map:n}=this.getGroupData(t,e);let r=n[s];return r||(r=new Set,n[s]=r),r}getGroupData(t,e){const s=this.components.get(vo),n=this.getClassificationGroups(t);let r=n.get(e);return r||(r={map:{},get(){return new Promise(o=>{if(!r){o({});return}if(r.query){const{name:a,config:l}=r.query,c=s.list.get(a);if(!c)throw new Error("Classifier: the query name associated with the group doesn't exist in the ItemsFinder component");c.test(l).then(h=>{if(!r){o({});return}const d=Rt.join([h,r.map]);o(d)})}else o(r.map)})}},n.set(e,r)),r}async aggregateItems(t,e,s){const n=(s==null?void 0:s.data)??void 0,r=(s==null?void 0:s.aggregationCallback)??this.defaultSaveFunction,o=this.components.get(ut),a=await this.components.get(vo).getItems([e],{modelIds:s==null?void 0:s.modelIds});for(const[l,c]of Object.entries(a)){const h=o.list.get(l);if(!h)continue;const d=(p,...m)=>{const f=this.getModelItems(t,p,l);for(const b of m)f.add(b)},u=await h.getItemsData([...c],n);for(const p of u)r(p,d)}}addGroupItems(t,e,s){const{map:n}=this.getGroupData(t,e);Rt.add(n,s)}setGroupQuery(t,e,s){const n=this.getGroupData(t,e);n.query=s}async find(t){const e=[];for(const[s,n]of Object.entries(t)){const r=[],o=this.list.get(s);if(!o)continue;for(const l of n){const c=o.get(l);if(!c)continue;const h=await c.get();r.push(h)}const a=Rt.join(r);e.push(a)}return Rt.intersect(e)}async aggregateItemRelations(t,e,s,n){const r=(n==null?void 0:n.attribute)??"Name",o={relations:{[s]:{attributes:!0,relations:!1}}};await this.aggregateItems(t,e,{modelIds:n==null?void 0:n.modelIds,data:o,aggregationCallback:(a,l)=>{if(!(a!=null&&a[r]))return;const c=a[r];if(!("value"in c))return;const h=a[s];if(Array.isArray(h))for(const d of h)"value"in d._localId&&l(c.value,d._localId.value)}})}async byIfcBuildingStorey(t){await this.aggregateItemRelations((t==null?void 0:t.classificationName)??"Storeys",{categories:[/BUILDINGSTOREY/]},"ContainsElements",{modelIds:t==null?void 0:t.modelIds})}async byCategory(t){const e=await this.components.get(vo).addFromCategories(t==null?void 0:t.modelIds);for(const s of e)this.setGroupQuery((t==null?void 0:t.classificationName)??"Categories",s,{name:s})}dispose(){this.list.clear(),this.components.get(ut).list.onBeforeDelete.remove(this.onBeforeFragmentsDispose),this.onDisposed.trigger()}removeItems(t,e){if(e&&e.classificationName){const s=this.list.get(e.classificationName);if(!s||e.groupName&&!s.get(e.groupName))return;for(const[,n]of s)Rt.remove(n.map,t);return}for(const[,s]of this.list.entries())for(const[,n]of s)Rt.remove(n.map,t)}async byModel(t){const e=this.components.get(ut),s=(t==null?void 0:t.classificationName)??"Models";for(const[n,r]of e.list){if(t&&t.modelIds&&!t.modelIds.some(l=>l.test(n)))continue;const o=await r.getItemsIdsWithGeometry(),a={[n]:new Set(o)};this.getGroupData(s,n),this.addGroupItems(s,n,a)}}};E(Cb,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");let Nx=Cb,Fx=class{constructor(t,e){E(this,"enabled",!0),E(this,"components"),E(this,"onDisposed",new et),E(this,"mouse"),E(this,"world"),E(this,"debugMode",!1),E(this,"colorToModelId",new Map),E(this,"modelIdToColor",new Map),E(this,"renderTarget"),E(this,"renderTargetSize",new Kt),E(this,"debugCanvas"),E(this,"debugContainer"),E(this,"colorMaterials",new Map),E(this,"originalMaterials",new Map),E(this,"originalLodColors",new Map),E(this,"colorsNeedUpdate",!0);const s=e.renderer;if(!s)throw new Error("A renderer is needed for the FastModelPicker to work!");this.world=e,this.mouse=new mb(s.three.domElement),this.components=t,this.setupRenderTarget(),this.setupFragmentListeners()}setupFragmentListeners(){const t=this.components.get(ut);t.list.onItemSet.add(()=>{this.colorsNeedUpdate=!0}),t.list.onItemDeleted.add(()=>{this.colorsNeedUpdate=!0})}setupRenderTarget(){const t=this.world.renderer.three.getSize(new Kt);this.renderTargetSize.copy(t),this.renderTarget=new L0(t.x,t.y),this.renderTarget.texture.format=R0,this.renderTarget.texture.type=B0,this.debugMode&&this.setupDebugCanvas(),this.world.renderer.onResize.add(e=>{this.renderTargetSize.copy(e),this.renderTarget.setSize(e.x,e.y),this.debugCanvas&&(this.debugCanvas.width=e.x,this.debugCanvas.height=e.y)})}setupDebugCanvas(){if(this.debugCanvas)return;const t=this.world.renderer.three.getSize(new Kt);this.debugContainer=document.createElement("div"),this.debugContainer.style.position="fixed",this.debugContainer.style.top="10px",this.debugContainer.style.right="10px",this.debugContainer.style.width="300px",this.debugContainer.style.height="300px",this.debugContainer.style.border="2px solid #fff",this.debugContainer.style.backgroundColor="#000",this.debugContainer.style.zIndex="10000",this.debugContainer.style.pointerEvents="none",this.debugCanvas=document.createElement("canvas"),this.debugCanvas.width=t.x,this.debugCanvas.height=t.y,this.debugCanvas.style.width="100%",this.debugCanvas.style.height="100%",this.debugCanvas.style.imageRendering="pixelated",this.debugContainer.appendChild(this.debugCanvas),document.body.appendChild(this.debugContainer)}generateColorForModel(t){let e=0;for(let a=0;a<t.length;a++)e=(e<<5)-e+t.charCodeAt(a),e&=e;let s=Math.abs(e)%16777215;s===0&&(s=1);const n=s>>16&255||1,r=s>>8&255||1,o=s&255||1;return new gt(n/255,r/255,o/255)}colorToId(t){const e=Math.round(t.r*255),s=Math.round(t.g*255),n=Math.round(t.b*255);return e<<16|s<<8|n}assignColors(){const t=this.components.get(ut);if(t.initialized){if(!this.colorsNeedUpdate){const e=new Set(t.list.keys()),s=new Set(this.modelIdToColor.keys());(e.size!==s.size||[...e].some(n=>!s.has(n)))&&(this.colorsNeedUpdate=!0)}if(this.colorsNeedUpdate){this.colorToModelId.clear(),this.modelIdToColor.clear();for(const e of this.colorMaterials.values())e.dispose();this.colorMaterials.clear();for(const[e]of t.list){const s=this.generateColorForModel(e),n=this.colorToId(s);this.colorToModelId.set(n,e),this.modelIdToColor.set(e,s);const r=new Cr({color:s,depthTest:!0,depthWrite:!0});this.colorMaterials.set(e,r)}this.colorsNeedUpdate=!1}}}applyColorMaterials(){const t=this.components.get(ut);if(t.initialized)for(const[e,s]of t.list){const n=this.colorMaterials.get(e);n&&s.object.traverse(r=>{if(r instanceof at){if("isLODGeometry"in r.geometry){const o=r.material[0].uniforms.lodColor;this.originalLodColors.has(o)||this.originalLodColors.set(o,o.value),o.value=n.color;return}this.originalMaterials.has(r)||this.originalMaterials.set(r,r.material),r.material=n}})}}restoreOriginalMaterials(){for(const[t,e]of this.originalMaterials)t.material=e;for(const[t,e]of this.originalLodColors)t.value=e;this.originalMaterials.clear()}renderColorCoded(){if(!this.renderTarget||!this.world.renderer)throw new Error("Render target not initialized!");const t=this.world.renderer.three,e=this.world.scene.three,s=this.world.camera.three,n=t.getRenderTarget(),r=t.autoClear,o=new gt,a=t.getClearAlpha();t.getClearColor(o),this.applyColorMaterials(),t.setRenderTarget(this.renderTarget),t.autoClear=!0,t.setClearColor(0,1),t.clear(!0,!0,!1),t.render(e,s),t.setRenderTarget(n),t.autoClear=r,t.setClearColor(o,a),this.restoreOriginalMaterials(),this.debugMode&&this.debugCanvas&&this.updateDebugCanvas()}updateDebugCanvas(){if(!this.debugCanvas||!this.renderTarget||!this.world.renderer)return;const t=this.world.renderer.three,e=this.renderTargetSize,s=new Uint8Array(e.x*e.y*4);t.readRenderTargetPixels(this.renderTarget,0,0,e.x,e.y,s);const n=this.debugCanvas.getContext("2d");if(!n)return;const r=n.createImageData(e.x,e.y),o=e.x*4;for(let a=0;a<e.y;a++){const l=a,c=e.y-1-a,h=l*o,d=c*o;r.data.set(s.subarray(h,h+o),d)}n.putImageData(r,0,0)}async getModelAt(t){if(!this.renderTarget||!this.world.renderer)throw new Error("Render target not initialized!");const e=this.components.get(ut);if(!e.initialized||e.list.size===0)return null;this.assignColors(),this.renderColorCoded();const s=t||this.mouse.position,n=this.renderTargetSize,r=Math.floor((s.x+1)*.5*n.x),o=Math.floor((s.y+1)*.5*(n.y-1)),a=Math.max(0,Math.min(n.x-1,r)),l=Math.max(0,Math.min(n.y-1,o)),c=this.world.renderer.three,h=new Uint8Array(4);c.readRenderTargetPixels(this.renderTarget,a,l,1,1,h);const d=h[0],u=h[1],p=h[2],m=d<<16|u<<8|p;return this.colorToModelId.get(m)||null}setDebugMode(t){this.debugMode=t,t?this.setupDebugCanvas():this.removeDebugCanvas()}removeDebugCanvas(){this.debugContainer&&(this.debugContainer.remove(),this.debugContainer=void 0,this.debugCanvas=void 0)}dispose(){this.mouse.dispose(),this.removeDebugCanvas();for(const t of this.colorMaterials.values())t.dispose();this.colorMaterials.clear(),this.renderTarget&&this.renderTarget.dispose(),this.colorToModelId.clear(),this.modelIdToColor.clear(),this.originalMaterials.clear(),this.originalLodColors.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}};const Eb=class kb extends zt{constructor(t){super(t),E(this,"enabled",!0),E(this,"list",new Map),E(this,"onDisposed",new et),t.add(kb.uuid,this)}get(t){if(this.list.has(t.uuid))return this.list.get(t.uuid);const e=new Fx(this.components,t);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}};E(Eb,"uuid","4a82430c-7ff2-49ea-9401-60807502dad6");let Ux=Eb,jx=class{constructor(t,e){E(this,"enabled",!0),E(this,"components"),E(this,"onDisposed",new et),E(this,"mouse"),E(this,"three",new nu),E(this,"world"),E(this,"useFastModelPicking",!1);const s=e.renderer;if(!s)throw new Error("A renderer is needed for the raycaster to work!");this.world=e,this.mouse=new mb(s.three.domElement),this.components=t}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRayToObjects(t=Array.from(this.world.meshes),e=this.mouse.position){if(!this.world)throw new Error("A world is needed to cast rays!");const s=this.world.camera.three;return this.three.setFromCamera(e,s),this.intersect(t)}async castRay(t){const e=t==null?void 0:t.snappingClasses,s=(t==null?void 0:t.items)??Array.from(this.world.meshes),n=(t==null?void 0:t.position)??this.mouse.position;if(!this.world)throw new Error("A world is needed to cast rays!");const r=this.world.camera.three,o=this.components.get(ut),a=this.world.renderer.three.domElement,l=this.mouse.rawPosition;let c=null;if(o.initialized){if(this.useFastModelPicking){const d=await this.components.get(Ux).get(this.world).getModelAt(n);if(d){const u=o.list.get(d);if(u)if(e&&e.length>0){const p=await u.raycastWithSnapping({camera:r,dom:a,mouse:l,snappingClasses:e});p&&p.length>0?c=p[0]:c=await u.raycast({camera:r,dom:a,mouse:l})}else c=await u.raycast({camera:r,dom:a,mouse:l})}}else c=await o.raycast({camera:r,dom:a,mouse:l,snappingClasses:e});if(s.length===0)return c}this.three.setFromCamera(n,r);const h=this.intersect(s);return c?h&&h.distance<c.distance?h:c:h}castRayFromVector(t,e,s=Array.from(this.world.meshes)){return this.three.set(t,e),this.intersect(s)}intersect(t=Array.from(this.world.meshes)){const e=this.three.intersectObjects(t),s=this.filterClippingPlanes(e);return s.length>0?s[0]:null}filterClippingPlanes(t){if(!this.world.renderer)throw new Error("Renderer not found!");const e=this.world.renderer.three;if(!e.clippingPlanes)return t;const s=e.clippingPlanes;return t.length<=0||!s||(s==null?void 0:s.length)<=0?t:t.filter(n=>s.every(r=>r.distanceToPoint(n.point)>0))}};const Ab=class Tb extends zt{constructor(t){super(t),E(this,"enabled",!0),E(this,"list",new Map),E(this,"onDisposed",new et),t.add(Tb.uuid,this)}get(t){if(this.list.has(t.uuid))return this.list.get(t.uuid);const e=new jx(this.components,t);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}};E(Ab,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let Re=Ab,Vx=class extends hu{constructor(){super(...arguments),E(this,"onCameraChanged",new et),E(this,"meshes",new Set),E(this,"onAfterUpdate",new et),E(this,"onBeforeUpdate",new et),E(this,"onDisposed",new et),E(this,"isDisposing",!1),E(this,"enabled",!0),E(this,"_dynamicAnchor",!1),E(this,"uuid",_e.create()),E(this,"name"),E(this,"_scene"),E(this,"_camera"),E(this,"_renderer",null),E(this,"onPointerDown",async t=>{if(!this.camera.hasCameraControls())throw new Error("World: can't set dynamic anchor if the camera doesn't have controls.");const e=await this.components.get(Re).get(this).castRay();e&&e.point&&t.button===0&&this.camera.controls.setOrbitPoint(e.point.x,e.point.y,e.point.z)}),E(this,"_defaultCamera")}set dynamicAnchor(t){var e;const s=(e=this.renderer)==null?void 0:e.three.domElement.parentElement;if(!s)throw new Error("World: the renderer must have a parentElement to set dynamic anchoring.");t?(this.camera.controls&&(this.camera.controls.minDistance=.01),s.addEventListener("pointerdown",this.onPointerDown)):s.removeEventListener("pointerdown",this.onPointerDown)}get dynamicAnchor(){return this._dynamicAnchor}get defaultCamera(){if(!this._defaultCamera)throw new Error("World: there is no default camera defined.");return this._defaultCamera}set defaultCamera(t){this._defaultCamera=t}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(t){this._scene=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(t){this._camera||(this.defaultCamera=t),this._camera=t,t.currentWorld=this,this.onCameraChanged.trigger(t)}get renderer(){return this._renderer}set renderer(t){this._renderer=t,t&&(t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"}))}useDefaultCamera(){this.camera=this.defaultCamera}update(t){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(t),this.camera.isUpdateable()&&this.camera.update(t),this.renderer&&this.renderer.update(t),this.onAfterUpdate.trigger()))}dispose(t=!0){if(this.enabled=!1,this.isDisposing=!0,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),t){const e=this.components.get(Ui);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const s of this.meshes)e.destroy(s);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.components.get(Db).list.delete(this.uuid),this.onDisposed.trigger(),this.onDisposed.reset()}},Hx=class extends yw{constructor(t,e,s){super(t),E(this,"enabled",!0),E(this,"container"),E(this,"three"),E(this,"mode",1),E(this,"needsUpdate",!1),E(this,"_canvas"),E(this,"_parameters"),E(this,"_resizeObserver",null),E(this,"onContainerUpdated",new et),E(this,"_resizing",!1),E(this,"resize",o=>{if(this._resizing)return;this._resizing=!0,this.onContainerUpdated.trigger();const a=o?o.x:this.container.clientWidth,l=o?o.y:this.container.clientHeight;this.three.setSize(a,l),this.onResize.trigger(new Kt(a,l)),this._resizing=!1}),E(this,"resizeEvent",()=>{this.resize()}),E(this,"onContextLost",o=>{o.preventDefault(),this.enabled=!1}),E(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new mp({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0}),this.container=e,this._parameters=s,this.three=new mp({antialias:!0,alpha:!0,...s}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const n=this.three.getContext(),{canvas:r}=n;r.addEventListener("webglcontextlost",this.onContextLost,!1),r.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld||this.mode===0&&!this.needsUpdate)return;this.needsUpdate=!1,this.onBeforeUpdate.trigger(this);const t=this.currentWorld.scene.three,e=this.currentWorld.camera.three;this.three.render(t,e),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.forceContextLoss(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new Kt(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(t){const e=this.three.domElement.parentElement;if(!e)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),t&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(e),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}};/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Gt={LEFT:1,RIGHT:2,MIDDLE:4},W=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),On={NONE:0,IN:1,OUT:-1};function Js(i){return i.isPerspectiveCamera}function ys(i){return i.isOrthographicCamera}const Dn=Math.PI*2,wp=Math.PI/2,Mb=1e-5,Fr=Math.PI/180;function gi(i,t,e){return Math.max(t,Math.min(e,i))}function Ft(i,t=Mb){return Math.abs(i)<t}function Tt(i,t,e=Mb){return Ft(i-t,e)}function xp(i,t){return Math.round(i/t)*t}function Ur(i){return isFinite(i)?i:i<0?-Number.MAX_VALUE:Number.MAX_VALUE}function jr(i){return Math.abs(i)<Number.MAX_VALUE?i:i*(1/0)}function Aa(i,t,e,s,n=1/0,r){s=Math.max(1e-4,s);const o=2/s,a=o*r,l=1/(1+a+.48*a*a+.235*a*a*a);let c=i-t;const h=t,d=n*s;c=gi(c,-d,d),t=i-c;const u=(e.value+o*c)*r;e.value=(e.value-o*u)*l;let p=t+(c+u)*l;return h-i>0==p>h&&(p=h,e.value=(p-h)/r),p}function Cp(i,t,e,s,n=1/0,r,o){s=Math.max(1e-4,s);const a=2/s,l=a*r,c=1/(1+l+.48*l*l+.235*l*l*l);let h=t.x,d=t.y,u=t.z,p=i.x-h,m=i.y-d,f=i.z-u;const b=h,g=d,y=u,v=n*s,_=v*v,x=p*p+m*m+f*f;if(x>_){const z=Math.sqrt(x);p=p/z*v,m=m/z*v,f=f/z*v}h=i.x-p,d=i.y-m,u=i.z-f;const S=(e.x+a*p)*r,k=(e.y+a*m)*r,T=(e.z+a*f)*r;e.x=(e.x-a*S)*c,e.y=(e.y-a*k)*c,e.z=(e.z-a*T)*c,o.x=h+(p+S)*c,o.y=d+(m+k)*c,o.z=u+(f+T)*c;const M=b-i.x,O=g-i.y,R=y-i.z,A=o.x-b,$=o.y-g,w=o.z-y;return M*A+O*$+R*w>0&&(o.x=b,o.y=g,o.z=y,e.x=(o.x-b)/r,e.y=(o.y-g)/r,e.z=(o.z-y)/r),o}function eh(i,t){t.set(0,0),i.forEach(e=>{t.x+=e.clientX,t.y+=e.clientY}),t.x/=i.length,t.y/=i.length}function ih(i,t){return ys(i)?(console.warn(`${t} is not supported in OrthographicCamera`),!0):!1}let Wx=class{constructor(){this._listeners={}}addEventListener(t,e){const s=this._listeners;s[t]===void 0&&(s[t]=[]),s[t].indexOf(e)===-1&&s[t].push(e)}hasEventListener(t,e){const s=this._listeners;return s[t]!==void 0&&s[t].indexOf(e)!==-1}removeEventListener(t,e){const s=this._listeners[t];if(s!==void 0){const n=s.indexOf(e);n!==-1&&s.splice(n,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){const e=this._listeners[t.type];if(e!==void 0){t.target=this;const s=e.slice(0);for(let n=0,r=s.length;n<r;n++)s[n].call(this,t)}}};var sh;const qx="2.10.1",Ta=1/8,Yx=/Mac/.test((sh=globalThis==null?void 0:globalThis.navigator)===null||sh===void 0?void 0:sh.platform);let ft,Sp,Ma,nh,Fe,_t,Et,In,Vr,Mi,Pi,tn,Ep,kp,ni,Hr,zn,Ap,rh,Tp,oh,ah,Pa,Xe=class od extends Wx{static install(t){ft=t.THREE,Sp=Object.freeze(new ft.Vector3(0,0,0)),Ma=Object.freeze(new ft.Vector3(0,1,0)),nh=Object.freeze(new ft.Vector3(0,0,1)),Fe=new ft.Vector2,_t=new ft.Vector3,Et=new ft.Vector3,In=new ft.Vector3,Vr=new ft.Vector3,Mi=new ft.Vector3,Pi=new ft.Vector3,tn=new ft.Vector3,Ep=new ft.Vector3,kp=new ft.Vector3,ni=new ft.Spherical,Hr=new ft.Spherical,zn=new ft.Box3,Ap=new ft.Box3,rh=new ft.Sphere,Tp=new ft.Quaternion,oh=new ft.Quaternion,ah=new ft.Matrix4,Pa=new ft.Raycaster}static get ACTION(){return W}set verticalDragToForward(t){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(t,e){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=W.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=On.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new ft.Vector3,this._focalOffsetVelocity=new ft.Vector3,this._zoomVelocity={value:0},this._truckInternal=(g,y,v,_)=>{let x,S;if(Js(this._camera)){const k=_t.copy(this._camera.position).sub(this._target),T=this._camera.getEffectiveFOV()*Fr,M=k.length()*Math.tan(T*.5);x=this.truckSpeed*g*M/this._elementRect.height,S=this.truckSpeed*y*M/this._elementRect.height}else if(ys(this._camera)){const k=this._camera;x=this.truckSpeed*g*(k.right-k.left)/k.zoom/this._elementRect.width,S=this.truckSpeed*y*(k.top-k.bottom)/k.zoom/this._elementRect.height}else return;_?(v?this.setFocalOffset(this._focalOffsetEnd.x+x,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(x,0,!0),this.forward(-S,!0)):v?this.setFocalOffset(this._focalOffsetEnd.x+x,this._focalOffsetEnd.y+S,this._focalOffsetEnd.z,!0):this.truck(x,S,!0)},this._rotateInternal=(g,y)=>{const v=Dn*this.azimuthRotateSpeed*g/this._elementRect.height,_=Dn*this.polarRotateSpeed*y/this._elementRect.height;this.rotate(v,_,!0)},this._dollyInternal=(g,y,v)=>{const _=Math.pow(.95,-g*this.dollySpeed),x=this._sphericalEnd.radius,S=this._sphericalEnd.radius*_,k=gi(S,this.minDistance,this.maxDistance),T=k-S;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(S,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(T,!0),this._dollyToNoClamp(k,!0)):this._dollyToNoClamp(k,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?S:k)-x,this._dollyControlCoord.set(y,v)),this._lastDollyDirection=Math.sign(-g)},this._zoomInternal=(g,y,v)=>{const _=Math.pow(.95,g*this.dollySpeed),x=this._zoom,S=this._zoom*_;this.zoomTo(S,!0),this.dollyToCursor&&(this._changedZoom+=S-x,this._dollyControlCoord.set(y,v))},typeof ft>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new ft.Quaternion().setFromUnitVectors(this._camera.up,Ma),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=W.NONE,this._target=new ft.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new ft.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new ft.Spherical().setFromVector3(_t.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new ft.Vector3,new ft.Vector3,new ft.Vector3,new ft.Vector3],this._updateNearPlaneCorners(),this._boundary=new ft.Box3(new ft.Vector3(-1/0,-1/0,-1/0),new ft.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new ft.Vector2,this.mouseButtons={left:W.ROTATE,middle:W.DOLLY,right:W.TRUCK,wheel:Js(this._camera)?W.DOLLY:ys(this._camera)?W.ZOOM:W.NONE},this.touches={one:W.TOUCH_ROTATE,two:Js(this._camera)?W.TOUCH_DOLLY_TRUCK:ys(this._camera)?W.TOUCH_ZOOM_TRUCK:W.NONE,three:W.TOUCH_TRUCK};const s=new ft.Vector2,n=new ft.Vector2,r=new ft.Vector2,o=g=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const _=this._domElement.getBoundingClientRect(),x=g.clientX/_.width,S=g.clientY/_.height;if(x<this._interactiveArea.left||x>this._interactiveArea.right||S<this._interactiveArea.top||S>this._interactiveArea.bottom)return}const y=g.pointerType!=="mouse"?null:(g.buttons&Gt.LEFT)===Gt.LEFT?Gt.LEFT:(g.buttons&Gt.MIDDLE)===Gt.MIDDLE?Gt.MIDDLE:(g.buttons&Gt.RIGHT)===Gt.RIGHT?Gt.RIGHT:null;if(y!==null){const _=this._findPointerByMouseButton(y);_&&this._disposePointer(_)}if((g.buttons&Gt.LEFT)===Gt.LEFT&&this._lockedPointer)return;const v={pointerId:g.pointerId,clientX:g.clientX,clientY:g.clientY,deltaX:0,deltaY:0,mouseButton:y};this._activePointers.push(v),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,u(g)},a=g=>{g.cancelable&&g.preventDefault();const y=g.pointerId,v=this._lockedPointer||this._findPointerById(y);if(v){if(v.clientX=g.clientX,v.clientY=g.clientY,v.deltaX=g.movementX,v.deltaY=g.movementY,this._state=0,g.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(g.buttons&Gt.LEFT)===Gt.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(g.buttons&Gt.MIDDLE)===Gt.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(g.buttons&Gt.RIGHT)===Gt.RIGHT&&(this._state=this._state|this.mouseButtons.right);p()}},l=g=>{const y=this._findPointerById(g.pointerId);if(!(y&&y===this._lockedPointer)){if(y&&this._disposePointer(y),g.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=W.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=W.NONE;m()}};let c=-1;const h=g=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===W.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const S=this._domElement.getBoundingClientRect(),k=g.clientX/S.width,T=g.clientY/S.height;if(k<this._interactiveArea.left||k>this._interactiveArea.right||T<this._interactiveArea.top||T>this._interactiveArea.bottom)return}if(g.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===W.ROTATE||this.mouseButtons.wheel===W.TRUCK){const S=performance.now();c-S<1e3&&this._getClientRect(this._elementRect),c=S}const y=Yx?-1:-3,v=g.deltaMode===1||g.ctrlKey?g.deltaY/y:g.deltaY/(y*10),_=this.dollyToCursor?(g.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,x=this.dollyToCursor?(g.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case W.ROTATE:{this._rotateInternal(g.deltaX,g.deltaY),this._isUserControllingRotate=!0;break}case W.TRUCK:{this._truckInternal(g.deltaX,g.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case W.SCREEN_PAN:{this._truckInternal(g.deltaX,g.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case W.OFFSET:{this._truckInternal(g.deltaX,g.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case W.DOLLY:{this._dollyInternal(-v,_,x),this._isUserControllingDolly=!0;break}case W.ZOOM:{this._zoomInternal(-v,_,x),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},d=g=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===od.ACTION.NONE){const y=g instanceof PointerEvent?g.pointerId:0,v=this._findPointerById(y);v&&this._disposePointer(v),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l);return}g.preventDefault()}},u=g=>{if(this._enabled){if(eh(this._activePointers,Fe),this._getClientRect(this._elementRect),s.copy(Fe),n.copy(Fe),this._activePointers.length>=2){const y=Fe.x-this._activePointers[1].clientX,v=Fe.y-this._activePointers[1].clientY,_=Math.sqrt(y*y+v*v);r.set(0,_);const x=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,S=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;n.set(x,S)}if(this._state=0,!g)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in g&&g.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(g.buttons&Gt.LEFT)===Gt.LEFT&&(this._state=this._state|this.mouseButtons.left),(g.buttons&Gt.MIDDLE)===Gt.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(g.buttons&Gt.RIGHT)===Gt.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&W.ROTATE)===W.ROTATE||(this._state&W.TOUCH_ROTATE)===W.TOUCH_ROTATE||(this._state&W.TOUCH_DOLLY_ROTATE)===W.TOUCH_DOLLY_ROTATE||(this._state&W.TOUCH_ZOOM_ROTATE)===W.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&W.TRUCK)===W.TRUCK||(this._state&W.SCREEN_PAN)===W.SCREEN_PAN||(this._state&W.TOUCH_TRUCK)===W.TOUCH_TRUCK||(this._state&W.TOUCH_SCREEN_PAN)===W.TOUCH_SCREEN_PAN||(this._state&W.TOUCH_DOLLY_TRUCK)===W.TOUCH_DOLLY_TRUCK||(this._state&W.TOUCH_DOLLY_SCREEN_PAN)===W.TOUCH_DOLLY_SCREEN_PAN||(this._state&W.TOUCH_ZOOM_TRUCK)===W.TOUCH_ZOOM_TRUCK||(this._state&W.TOUCH_ZOOM_SCREEN_PAN)===W.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&W.DOLLY)===W.DOLLY||(this._state&W.TOUCH_DOLLY)===W.TOUCH_DOLLY||(this._state&W.TOUCH_DOLLY_TRUCK)===W.TOUCH_DOLLY_TRUCK||(this._state&W.TOUCH_DOLLY_SCREEN_PAN)===W.TOUCH_DOLLY_SCREEN_PAN||(this._state&W.TOUCH_DOLLY_OFFSET)===W.TOUCH_DOLLY_OFFSET||(this._state&W.TOUCH_DOLLY_ROTATE)===W.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&W.ZOOM)===W.ZOOM||(this._state&W.TOUCH_ZOOM)===W.TOUCH_ZOOM||(this._state&W.TOUCH_ZOOM_TRUCK)===W.TOUCH_ZOOM_TRUCK||(this._state&W.TOUCH_ZOOM_SCREEN_PAN)===W.TOUCH_ZOOM_SCREEN_PAN||(this._state&W.TOUCH_ZOOM_OFFSET)===W.TOUCH_ZOOM_OFFSET||(this._state&W.TOUCH_ZOOM_ROTATE)===W.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&W.OFFSET)===W.OFFSET||(this._state&W.TOUCH_OFFSET)===W.TOUCH_OFFSET||(this._state&W.TOUCH_DOLLY_OFFSET)===W.TOUCH_DOLLY_OFFSET||(this._state&W.TOUCH_ZOOM_OFFSET)===W.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},p=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,eh(this._activePointers,Fe);const g=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,y=g?-g.deltaX:n.x-Fe.x,v=g?-g.deltaY:n.y-Fe.y;if(n.copy(Fe),((this._state&W.ROTATE)===W.ROTATE||(this._state&W.TOUCH_ROTATE)===W.TOUCH_ROTATE||(this._state&W.TOUCH_DOLLY_ROTATE)===W.TOUCH_DOLLY_ROTATE||(this._state&W.TOUCH_ZOOM_ROTATE)===W.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(y,v),this._isUserControllingRotate=!0),(this._state&W.DOLLY)===W.DOLLY||(this._state&W.ZOOM)===W.ZOOM){const _=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,x=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,S=this.dollyDragInverted?-1:1;(this._state&W.DOLLY)===W.DOLLY?(this._dollyInternal(S*v*Ta,_,x),this._isUserControllingDolly=!0):(this._zoomInternal(S*v*Ta,_,x),this._isUserControllingZoom=!0)}if((this._state&W.TOUCH_DOLLY)===W.TOUCH_DOLLY||(this._state&W.TOUCH_ZOOM)===W.TOUCH_ZOOM||(this._state&W.TOUCH_DOLLY_TRUCK)===W.TOUCH_DOLLY_TRUCK||(this._state&W.TOUCH_ZOOM_TRUCK)===W.TOUCH_ZOOM_TRUCK||(this._state&W.TOUCH_DOLLY_SCREEN_PAN)===W.TOUCH_DOLLY_SCREEN_PAN||(this._state&W.TOUCH_ZOOM_SCREEN_PAN)===W.TOUCH_ZOOM_SCREEN_PAN||(this._state&W.TOUCH_DOLLY_OFFSET)===W.TOUCH_DOLLY_OFFSET||(this._state&W.TOUCH_ZOOM_OFFSET)===W.TOUCH_ZOOM_OFFSET||(this._state&W.TOUCH_DOLLY_ROTATE)===W.TOUCH_DOLLY_ROTATE||(this._state&W.TOUCH_ZOOM_ROTATE)===W.TOUCH_ZOOM_ROTATE){const _=Fe.x-this._activePointers[1].clientX,x=Fe.y-this._activePointers[1].clientY,S=Math.sqrt(_*_+x*x),k=r.y-S;r.set(0,S);const T=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,M=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&W.TOUCH_DOLLY)===W.TOUCH_DOLLY||(this._state&W.TOUCH_DOLLY_ROTATE)===W.TOUCH_DOLLY_ROTATE||(this._state&W.TOUCH_DOLLY_TRUCK)===W.TOUCH_DOLLY_TRUCK||(this._state&W.TOUCH_DOLLY_SCREEN_PAN)===W.TOUCH_DOLLY_SCREEN_PAN||(this._state&W.TOUCH_DOLLY_OFFSET)===W.TOUCH_DOLLY_OFFSET?(this._dollyInternal(k*Ta,T,M),this._isUserControllingDolly=!0):(this._zoomInternal(k*Ta,T,M),this._isUserControllingZoom=!0)}((this._state&W.TRUCK)===W.TRUCK||(this._state&W.TOUCH_TRUCK)===W.TOUCH_TRUCK||(this._state&W.TOUCH_DOLLY_TRUCK)===W.TOUCH_DOLLY_TRUCK||(this._state&W.TOUCH_ZOOM_TRUCK)===W.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(y,v,!1,!1),this._isUserControllingTruck=!0),((this._state&W.SCREEN_PAN)===W.SCREEN_PAN||(this._state&W.TOUCH_SCREEN_PAN)===W.TOUCH_SCREEN_PAN||(this._state&W.TOUCH_DOLLY_SCREEN_PAN)===W.TOUCH_DOLLY_SCREEN_PAN||(this._state&W.TOUCH_ZOOM_SCREEN_PAN)===W.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(y,v,!1,!0),this._isUserControllingTruck=!0),((this._state&W.OFFSET)===W.OFFSET||(this._state&W.TOUCH_OFFSET)===W.TOUCH_OFFSET||(this._state&W.TOUCH_DOLLY_OFFSET)===W.TOUCH_DOLLY_OFFSET||(this._state&W.TOUCH_ZOOM_OFFSET)===W.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(y,v,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},m=()=>{eh(this._activePointers,Fe),n.copy(Fe),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",f),this._domElement.ownerDocument.addEventListener("pointerlockerror",b),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),u())},this.unlockPointer=()=>{var g,y,v;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(g=this._domElement)===null||g===void 0||g.ownerDocument.exitPointerLock(),(y=this._domElement)===null||y===void 0||y.ownerDocument.removeEventListener("pointerlockchange",f),(v=this._domElement)===null||v===void 0||v.ownerDocument.removeEventListener("pointerlockerror",b),this.cancel()};const f=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},b=()=>{this.unlockPointer()};this._addAllEventListeners=g=>{this._domElement=g,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",h,{passive:!1}),this._domElement.addEventListener("contextmenu",d)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",h,{passive:!1}),this._domElement.removeEventListener("contextmenu",d),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",f),this._domElement.ownerDocument.removeEventListener("pointerlockerror",b))},this.cancel=()=>{this._state!==W.NONE&&(this._state=W.NONE,this._activePointers.length=0,m())},e&&this.connect(e),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=gi(t.width,0,1),this._interactiveArea.height=gi(t.height,0,1),this._interactiveArea.x=gi(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=gi(t.y,0,1-this._interactiveArea.height)}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,s=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,s)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,s=!1){this._isUserControllingRotate=!1;const n=gi(t,this.minAzimuthAngle,this.maxAzimuthAngle),r=gi(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=n,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!s||Tt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Tt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=On.NONE,this._changedDolly=0,this._dollyToNoClamp(gi(t,this.minDistance,this.maxDistance),e)}_dollyToNoClamp(t,e=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const r=this._collisionTest(),o=Tt(r,this._spherical.radius);if(!(s>t)&&o)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,r)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);const n=!e||Tt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(n)}dollyInFixed(t,e=!1){this._targetEnd.add(this._getCameraDirection(Vr).multiplyScalar(t)),e||this._target.copy(this._targetEnd);const s=!e||Tt(this._target.x,this._targetEnd.x,this.restThreshold)&&Tt(this._target.y,this._targetEnd.y,this.restThreshold)&&Tt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._isUserControllingZoom=!1,this._zoomEnd=gi(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);const s=!e||Tt(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(t,e,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,s)}truck(t,e,s=!1){this._camera.updateMatrix(),Mi.setFromMatrixColumn(this._camera.matrix,0),Pi.setFromMatrixColumn(this._camera.matrix,1),Mi.multiplyScalar(t),Pi.multiplyScalar(-e);const n=_t.copy(Mi).add(Pi),r=Et.copy(this._targetEnd).add(n);return this.moveTo(r.x,r.y,r.z,s)}forward(t,e=!1){_t.setFromMatrixColumn(this._camera.matrix,0),_t.crossVectors(this._camera.up,_t),_t.multiplyScalar(t);const s=Et.copy(this._targetEnd).add(_t);return this.moveTo(s.x,s.y,s.z,e)}elevate(t,e=!1){return _t.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+_t.x,this._targetEnd.y+_t.y,this._targetEnd.z+_t.z,e)}moveTo(t,e,s,n=!1){this._isUserControllingTruck=!1;const r=_t.set(t,e,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,n||this._target.copy(this._targetEnd);const o=!n||Tt(this._target.x,this._targetEnd.x,this.restThreshold)&&Tt(this._target.y,this._targetEnd.y,this.restThreshold)&&Tt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(t,e,s,n=!1){const r=_t.set(t,e,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(r.x,r.y,r.z,n)}fitToBox(t,e,{cover:s=!1,paddingLeft:n=0,paddingRight:r=0,paddingBottom:o=0,paddingTop:a=0}={}){const l=[],c=t.isBox3?zn.copy(t):zn.setFromObject(t);c.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const h=xp(this._sphericalEnd.theta,wp),d=xp(this._sphericalEnd.phi,wp);l.push(this.rotateTo(h,d,e));const u=_t.setFromSpherical(this._sphericalEnd).normalize(),p=Tp.setFromUnitVectors(u,nh),m=Tt(Math.abs(u.y),1);m&&p.multiply(oh.setFromAxisAngle(Ma,h)),p.multiply(this._yAxisUpSpaceInverse);const f=Ap.makeEmpty();Et.copy(c.min).applyQuaternion(p),f.expandByPoint(Et),Et.copy(c.min).setX(c.max.x).applyQuaternion(p),f.expandByPoint(Et),Et.copy(c.min).setY(c.max.y).applyQuaternion(p),f.expandByPoint(Et),Et.copy(c.max).setZ(c.min.z).applyQuaternion(p),f.expandByPoint(Et),Et.copy(c.min).setZ(c.max.z).applyQuaternion(p),f.expandByPoint(Et),Et.copy(c.max).setY(c.min.y).applyQuaternion(p),f.expandByPoint(Et),Et.copy(c.max).setX(c.min.x).applyQuaternion(p),f.expandByPoint(Et),Et.copy(c.max).applyQuaternion(p),f.expandByPoint(Et),f.min.x-=n,f.min.y-=o,f.max.x+=r,f.max.y+=a,p.setFromUnitVectors(nh,u),m&&p.premultiply(oh.invert()),p.premultiply(this._yAxisUpSpace);const b=f.getSize(_t),g=f.getCenter(Et).applyQuaternion(p);if(Js(this._camera)){const y=this.getDistanceToFitBox(b.x,b.y,b.z,s);l.push(this.moveTo(g.x,g.y,g.z,e)),l.push(this.dollyTo(y,e)),l.push(this.setFocalOffset(0,0,0,e))}else if(ys(this._camera)){const y=this._camera,v=y.right-y.left,_=y.top-y.bottom,x=s?Math.max(v/b.x,_/b.y):Math.min(v/b.x,_/b.y);l.push(this.moveTo(g.x,g.y,g.z,e)),l.push(this.zoomTo(x,e)),l.push(this.setFocalOffset(0,0,0,e))}return Promise.all(l)}fitToSphere(t,e){const s=[],n="isObject3D"in t?od.createBoundingSphere(t,rh):rh.copy(t);if(s.push(this.moveTo(n.center.x,n.center.y,n.center.z,e)),Js(this._camera)){const r=this.getDistanceToFitSphere(n.radius);s.push(this.dollyTo(r,e))}else if(ys(this._camera)){const r=this._camera.right-this._camera.left,o=this._camera.top-this._camera.bottom,a=2*n.radius,l=Math.min(r/a,o/a);s.push(this.zoomTo(l,e))}return s.push(this.setFocalOffset(0,0,0,e)),Promise.all(s)}setLookAt(t,e,s,n,r,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=On.NONE,this._changedDolly=0;const l=Et.set(n,r,o),c=_t.set(t,e,s);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(c.sub(l).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const h=!a||Tt(this._target.x,this._targetEnd.x,this.restThreshold)&&Tt(this._target.y,this._targetEnd.y,this.restThreshold)&&Tt(this._target.z,this._targetEnd.z,this.restThreshold)&&Tt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Tt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Tt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(h)}lerpLookAt(t,e,s,n,r,o,a,l,c,h,d,u,p,m=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=On.NONE,this._changedDolly=0;const f=_t.set(n,r,o),b=Et.set(t,e,s);ni.setFromVector3(b.sub(f).applyQuaternion(this._yAxisUpSpace));const g=In.set(h,d,u),y=Et.set(a,l,c);Hr.setFromVector3(y.sub(g).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(f.lerp(g,p));const v=Hr.theta-ni.theta,_=Hr.phi-ni.phi,x=Hr.radius-ni.radius;this._sphericalEnd.set(ni.radius+x*p,ni.phi+_*p,ni.theta+v*p),this.normalizeRotations(),this._needsUpdate=!0,m||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const S=!m||Tt(this._target.x,this._targetEnd.x,this.restThreshold)&&Tt(this._target.y,this._targetEnd.y,this.restThreshold)&&Tt(this._target.z,this._targetEnd.z,this.restThreshold)&&Tt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Tt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Tt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(S)}setPosition(t,e,s,n=!1){return this.setLookAt(t,e,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,n)}setTarget(t,e,s,n=!1){const r=this.getPosition(_t),o=this.setLookAt(r.x,r.y,r.z,t,e,s,n);return this._sphericalEnd.phi=gi(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(t,e,s,n=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,e,s),this._needsUpdate=!0,n||this._focalOffset.copy(this._focalOffsetEnd);const r=!n||Tt(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Tt(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Tt(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(t,e,s){this._camera.updateMatrixWorld(),Mi.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Pi.setFromMatrixColumn(this._camera.matrixWorldInverse,1),tn.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const n=_t.set(t,e,s),r=n.distanceTo(this._camera.position),o=n.sub(this._camera.position);Mi.multiplyScalar(o.x),Pi.multiplyScalar(o.y),tn.multiplyScalar(o.z),_t.copy(Mi).add(Pi).add(tn),_t.z=_t.z+r,this.dollyTo(r,!1),this.setFocalOffset(-_t.x,_t.y,-_t.z,!1),this.moveTo(t,e,s,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,s,n){if(t===null){this._viewport=null;return}this._viewport=this._viewport||new ft.Vector4,typeof t=="number"?this._viewport.set(t,e,s,n):this._viewport.copy(t)}getDistanceToFitBox(t,e,s,n=!1){if(ih(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const r=t/e,o=this._camera.getEffectiveFOV()*Fr,a=this._camera.aspect;return((n?r>a:r<a)?e:t/a)*.5/Math.tan(o*.5)+s*.5}getDistanceToFitSphere(t){if(ih(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const e=this._camera.getEffectiveFOV()*Fr,s=Math.atan(Math.tan(e*.5)*this._camera.aspect)*2,n=1<this._camera.aspect?e:s;return t/Math.sin(n*.5)}getTarget(t,e=!0){return(t&&t.isVector3?t:new ft.Vector3).copy(e?this._targetEnd:this._target)}getPosition(t,e=!0){return(t&&t.isVector3?t:new ft.Vector3).setFromSpherical(e?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(e?this._targetEnd:this._target)}getSpherical(t,e=!0){return(t||new ft.Spherical).copy(e?this._sphericalEnd:this._spherical)}getFocalOffset(t,e=!0){return(t&&t.isVector3?t:new ft.Vector3).copy(e?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Dn,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Dn),this._spherical.theta+=Dn*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Dn)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(t=!1){if(!Tt(this._camera.up.x,this._cameraUp0.x)||!Tt(this._camera.up.y,this._cameraUp0.y)||!Tt(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(_t);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const e=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(e)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Ma),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const t=_t.subVectors(this._target,this._camera.position).normalize(),e=Et.crossVectors(t,this._camera.up);this._camera.up.crossVectors(e,t).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(_t);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(t){const e=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,n=this._sphericalEnd.radius-this._spherical.radius,r=Ep.subVectors(this._targetEnd,this._target),o=kp.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(Ft(e))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Aa(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,h,1/0,t),this._needsUpdate=!0}if(Ft(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Aa(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,h,1/0,t),this._needsUpdate=!0}if(Ft(n))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const h=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Aa(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,h,this.maxSpeed,t),this._needsUpdate=!0}if(Ft(r.x)&&Ft(r.y)&&Ft(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const h=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Cp(this._target,this._targetEnd,this._targetVelocity,h,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(Ft(o.x)&&Ft(o.y)&&Ft(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const h=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Cp(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,h,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(Ft(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const h=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Aa(this._zoom,this._zoomEnd,this._zoomVelocity,h,1/0,t)}if(this.dollyToCursor){if(Js(this._camera)&&this._changedDolly!==0){const h=this._spherical.radius-this._lastDistance,d=this._camera,u=this._getCameraDirection(Vr),p=_t.copy(u).cross(d.up).normalize();p.lengthSq()===0&&(p.x=1);const m=Et.crossVectors(p,u),f=this._sphericalEnd.radius*Math.tan(d.getEffectiveFOV()*Fr*.5),b=(this._sphericalEnd.radius-h-this._sphericalEnd.radius)/this._sphericalEnd.radius,g=In.copy(this._targetEnd).add(p.multiplyScalar(this._dollyControlCoord.x*f*d.aspect)).add(m.multiplyScalar(this._dollyControlCoord.y*f)),y=_t.copy(this._targetEnd).lerp(g,b),v=this._lastDollyDirection===On.IN&&this._spherical.radius<=this.minDistance,_=this._lastDollyDirection===On.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(v||_)){this._sphericalEnd.radius-=h,this._spherical.radius-=h;const S=Et.copy(u).multiplyScalar(-h);y.add(S)}this._boundary.clampPoint(y,y);const x=Et.subVectors(y,this._targetEnd);this._targetEnd.copy(y),this._target.add(x),this._changedDolly-=h,Ft(this._changedDolly)&&(this._changedDolly=0)}else if(ys(this._camera)&&this._changedZoom!==0){const h=this._zoom-this._lastZoom,d=this._camera,u=_t.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(d.near+d.far)/(d.near-d.far)).unproject(d),p=Et.set(0,0,-1).applyQuaternion(d.quaternion),m=In.copy(u).add(p.multiplyScalar(-u.dot(d.up))),f=-(this._zoom-h-this._zoom)/this._zoom,b=this._getCameraDirection(Vr),g=this._targetEnd.dot(b),y=_t.copy(this._targetEnd).lerp(m,f),v=y.dot(b),_=b.multiplyScalar(v-g);y.sub(_),this._boundary.clampPoint(y,y);const x=Et.subVectors(y,this._targetEnd);this._targetEnd.copy(y),this._target.add(x),this._changedZoom-=h,Ft(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!Ft(this._focalOffset.x)||!Ft(this._focalOffset.y)||!Ft(this._focalOffset.z))&&(Mi.setFromMatrixColumn(this._camera.matrix,0),Pi.setFromMatrixColumn(this._camera.matrix,1),tn.setFromMatrixColumn(this._camera.matrix,2),Mi.multiplyScalar(this._focalOffset.x),Pi.multiplyScalar(-this._focalOffset.y),tn.multiplyScalar(this._focalOffset.z),_t.copy(Mi).add(Pi).add(tn),this._camera.position.add(_t),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),_t.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const c=this._needsUpdate;return c&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):c?(this.dispatchEvent({type:"update"}),Ft(e,this.restThreshold)&&Ft(s,this.restThreshold)&&Ft(n,this.restThreshold)&&Ft(r.x,this.restThreshold)&&Ft(r.y,this.restThreshold)&&Ft(r.z,this.restThreshold)&&Ft(o.x,this.restThreshold)&&Ft(o.y,this.restThreshold)&&Ft(o.z,this.restThreshold)&&Ft(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!c&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=c,this._needsUpdate=!1,c}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Ur(this.maxDistance),minZoom:this.minZoom,maxZoom:Ur(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Ur(this.maxPolarAngle),minAzimuthAngle:Ur(this.minAzimuthAngle),maxAzimuthAngle:Ur(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:_t.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){const s=JSON.parse(t);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=jr(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=jr(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=jr(s.maxPolarAngle),this.minAzimuthAngle=jr(s.minAzimuthAngle),this.maxAzimuthAngle=jr(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],e),ni.setFromVector3(_t.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(ni.theta,ni.phi,e),this.dollyTo(ni.radius,e),this.zoomTo(s.zoom,e),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],e),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version",qx),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(e=>e.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(e=>e.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,e,s){const n=e.lengthSq();if(n===0)return t;const r=Et.copy(e).add(t),o=this._boundary.clampPoint(r,In).sub(r),a=o.lengthSq();if(a===0)return t.add(e);if(a===n)return t;if(s===0)return t.add(e).add(o);{const l=1+s*a/e.dot(o);return t.add(Et.copy(e).multiplyScalar(l)).add(o.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(Js(this._camera)){const t=this._camera,e=t.near,s=t.getEffectiveFOV()*Fr,n=Math.tan(s*.5)*e,r=n*t.aspect;this._nearPlaneCorners[0].set(-r,-n,0),this._nearPlaneCorners[1].set(r,-n,0),this._nearPlaneCorners[2].set(r,n,0),this._nearPlaneCorners[3].set(-r,n,0)}else if(ys(this._camera)){const t=this._camera,e=1/t.zoom,s=t.left*e,n=t.right*e,r=t.top*e,o=t.bottom*e;this._nearPlaneCorners[0].set(s,r,0),this._nearPlaneCorners[1].set(n,r,0),this._nearPlaneCorners[2].set(n,o,0),this._nearPlaneCorners[3].set(s,o,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||ih(this._camera,"_collisionTest"))return t;const e=this._getTargetDirection(Vr);ah.lookAt(Sp,e,this._camera.up);for(let s=0;s<4;s++){const n=Et.copy(this._nearPlaneCorners[s]);n.applyMatrix4(ah);const r=In.addVectors(this._target,n);Pa.set(r,e),Pa.far=this._spherical.radius+1;const o=Pa.intersectObjects(this.colliderMeshes);o.length!==0&&o[0].distance<t&&(t=o[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;const e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{const s=()=>{this.removeEventListener("rest",s),e()};this.addEventListener("rest",s)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,e=new ft.Sphere){const s=e,n=s.center;zn.makeEmpty(),t.traverseVisible(o=>{o.isMesh&&zn.expandByObject(o)}),zn.getCenter(n);let r=0;return t.traverseVisible(o=>{if(!o.isMesh)return;const a=o;if(!a.geometry)return;const l=a.geometry.clone();l.applyMatrix4(a.matrixWorld);const c=l.attributes.position;for(let h=0,d=c.count;h<d;h++)_t.fromBufferAttribute(c,h),r=Math.max(r,n.distanceToSquared(_t))}),s.radius=Math.sqrt(r),s}},ad=class Pb extends bw{constructor(t){super(t),E(this,"onBeforeUpdate",new et),E(this,"onAfterUpdate",new et),E(this,"onAspectUpdated",new et),E(this,"onDisposed",new et),E(this,"three"),E(this,"_allControls",new Map),E(this,"updateAspect",()=>{var e;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof bc){this.onAspectUpdated.trigger();return}if((e=this.currentWorld.renderer)!=null&&e.isResizeable()){const s=this.currentWorld.renderer.getSize();this.three.aspect=s.width/s.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.worlds.onItemSet.add(({value:e})=>{const s=this.newCameraControls();this._allControls.set(e.uuid,s)}),this.worlds.onBeforeDelete.add(({value:e})=>{const s=this._allControls.get(e.uuid);s&&(s.dispose(),this._allControls.delete(e.uuid))})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const t=this._allControls.get(this.currentWorld.uuid);if(!t)throw new Error("Controls not found!");return t}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(t){this.currentWorld!==null&&(this.controls.enabled=t)}set currentWorld(t){super.currentWorld=t,t&&(this.worlds.get(t.uuid)||this.worlds.set(t.uuid,t))}get currentWorld(){return this._currentWorld}dispose(){this.setupEvents(!1),this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[t,e]of this._allControls)e.dispose();this.worlds.clear()}async fitToItems(t){const e=await this.getItemsBounding(t);await this.controls.fitToSphere(e,!0)}async setOrbitToItems(t){const e=await this.getItemsBounding(t);this.controls.setOrbitPoint(e.center.x,e.center.y,e.center.z)}update(t){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(t),this.onAfterUpdate.trigger(this))}async getItemsBounding(t){const e=this.components.get(ut),s=this.components.get(Ul);s.list.clear();const n=new Rs;if(t)await s.addFromModelIdMap(t);else for(const[,r]of e.list)s.list.add(r.box);return s.get().getBoundingSphere(n),s.list.clear(),n}setupCamera(){const t=window.innerWidth/window.innerHeight,e=new Kg(60,t,1,1e3);return e.position.set(50,50,50),e.lookAt(new L(0,0,0)),e}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");Xe.install({THREE:Pb.getSubsetOfThree()});const{domElement:t}=this.currentWorld.renderer.three,e=new Xe(this.three,t);return e.smoothTime=.2,e.dollyToCursor=!0,e.infinityDolly=!0,e.minDistance=6,e}setupEvents(t){t?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:Y0,Vector2:Kt,Vector3:L,Vector4:xr,Quaternion:vi,Matrix4:Pt,Spherical:q0,Box3:oe,Sphere:Rs,Raycaster:nu,MathUtils:Qg}}};const $b=class Ob extends zt{constructor(t){super(t),E(this,"onAfterUpdate",new et),E(this,"onBeforeUpdate",new et),E(this,"onDisposed",new et),E(this,"list",new It),E(this,"enabled",!0),t.add(Ob.uuid,this)}create(){const t=new Vx(this.components),e=t.uuid;if(this.list.has(e))throw new Error("There is already a world with this name!");return this.list.set(e,t),t}delete(t){if(!this.list.has(t.uuid))throw new Error("The provided world is not found in the list!");this.list.delete(t.uuid),t.dispose()}dispose(){this.enabled=!1;for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}update(t){if(this.enabled)for(const[e,s]of this.list)s.update(t)}};E($b,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let Db=$b,Zx=class extends Cc{constructor(){super(...arguments),E(this,"_config",{visible:{value:!0,type:"Boolean"},color:{value:new gt,type:"Color"},primarySize:{type:"Number",interpolable:!0,value:1,min:0,max:1e3},secondarySize:{type:"Number",interpolable:!0,value:10,min:0,max:1e3},distance:{type:"Number",interpolable:!0,value:500,min:0,max:500}})}get visible(){return this._config.visible.value}set visible(t){this._config.visible.value=t,this._component.visible=t}get color(){return this._config.color.value}set color(t){this._config.color.value=t,this._component.material.uniforms.uColor.value=t,this._component.material.uniformsNeedUpdate=!0}get primarySize(){return this._config.primarySize.value}set primarySize(t){this._config.primarySize.value=t,this._component.material.uniforms.uSize1.value=t,this._component.material.uniformsNeedUpdate=!0}get secondarySize(){return this._config.secondarySize.value}set secondarySize(t){this._config.secondarySize.value=t,this._component.material.uniforms.uSize2.value=t,this._component.material.uniformsNeedUpdate=!0}get distance(){return this._config.distance.value}set distance(t){this._config.distance.value=t,this._component.material.uniforms.uDistance.value=t,this._component.material.uniformsNeedUpdate=!0}},Gx=class{constructor(t,e){E(this,"onDisposed",new et),E(this,"onSetup",new et),E(this,"isSetup",!1),E(this,"world"),E(this,"components"),E(this,"config"),E(this,"_defaultConfig",{visible:!0,color:new gt(12303291),primarySize:1,secondarySize:10,distance:500}),E(this,"three"),E(this,"_fade",3),E(this,"updateZoom",()=>{this.world.camera instanceof ad&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=e;const{color:s,primarySize:n,secondarySize:r,distance:o}=this._defaultConfig;this.components=t,this.config=new Zx(this,this.components,"Grid");const a=new ou(2,2,1,1),l=new Xg({side:Bs,uniforms:{uSize1:{value:n},uSize2:{value:r},uColor:{value:s},uDistance:{value:o},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new at(a,l),this.three.frustumCulled=!1,e.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(t){this.three.visible=t,t?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(t){this._fade=t?3:0,this.material.uniforms.uFade.value=this._fade}setup(t){const e={...this._defaultConfig,...t};this.config.visible=!0,this.config.color=e.color,this.config.primarySize=e.primarySize,this.config.secondarySize=e.secondarySize,this.config.distance=e.distance,this.isSetup=!0,this.onSetup.trigger()}dispose(){this.setupEvents(!1),this.components.get(fu).list.delete(this.config.uuid),this.components.get(Ui).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(t){if(this.world.isDisposing||!(this.world.camera instanceof ad))return;const e=this.world.camera.controls;t?e.addEventListener("update",this.updateZoom):e.removeEventListener("update",this.updateZoom)}};const Xx=class Ib extends zt{constructor(t){super(t),E(this,"list",new Map),E(this,"onDisposed",new et),E(this,"enabled",!0),t.add(Ib.uuid,this)}create(t){if(this.list.has(t.uuid))throw new Error("This world already has a grid!");const e=new Gx(this.components,t);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}};E(Xx,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");const zb=0,Kx=1,Qx=2,Mp=2,lh=1.25,Pp=1,Sl=6*4+4+4,Sc=65535,Jx=Math.pow(2,-24),ch=Symbol("SKIP_GENERATION");function t1(i){return i.index?i.index.count:i.attributes.position.count}function Sr(i){return t1(i)/3}function e1(i,t=ArrayBuffer){return i>65535?new Uint32Array(new t(4*i)):new Uint16Array(new t(2*i))}function i1(i,t){if(!i.index){const e=i.attributes.position.count,s=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=e1(e,s);i.setIndex(new Je(n,1));for(let r=0;r<e;r++)n[r]=r}}function Lb(i){const t=Sr(i),e=i.drawRange,s=e.start/3,n=(e.start+e.count)/3,r=Math.max(0,s),o=Math.min(t,n)-r;return[{offset:Math.floor(r),count:Math.floor(o)}]}function Rb(i){if(!i.groups||!i.groups.length)return Lb(i);const t=[],e=new Set,s=i.drawRange,n=s.start/3,r=(s.start+s.count)/3;for(const a of i.groups){const l=a.start/3,c=(a.start+a.count)/3;e.add(Math.max(n,l)),e.add(Math.min(r,c))}const o=Array.from(e.values()).sort((a,l)=>a-l);for(let a=0;a<o.length-1;a++){const l=o[a],c=o[a+1];t.push({offset:Math.floor(l),count:Math.floor(c-l)})}return t}function s1(i){if(i.groups.length===0)return!1;const t=Sr(i),e=Rb(i).sort((r,o)=>r.offset-o.offset),s=e[e.length-1];s.count=Math.min(t-s.offset,s.count);let n=0;return e.forEach(({count:r})=>n+=r),t!==n}function Xt(i,t,e){return e.min.x=t[i],e.min.y=t[i+1],e.min.z=t[i+2],e.max.x=t[i+3],e.max.y=t[i+4],e.max.z=t[i+5],e}function n1(i){i[0]=i[1]=i[2]=1/0,i[3]=i[4]=i[5]=-1/0}function $p(i){let t=-1,e=-1/0;for(let s=0;s<3;s++){const n=i[s+3]-i[s];n>e&&(e=n,t=s)}return t}function Op(i,t){t.set(i)}function Dp(i,t,e){let s,n;for(let r=0;r<3;r++){const o=r+3;s=i[r],n=t[r],e[r]=s<n?s:n,s=i[o],n=t[o],e[o]=s>n?s:n}}function $a(i,t,e){for(let s=0;s<3;s++){const n=t[i+2*s],r=t[i+2*s+1],o=n-r,a=n+r;o<e[s]&&(e[s]=o),a>e[s+3]&&(e[s+3]=a)}}function Wr(i){const t=i[3]-i[0],e=i[4]-i[1],s=i[5]-i[2];return 2*(t*e+e*s+s*t)}function hh(i,t,e,s,n=null){let r=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,h=-1/0,d=1/0,u=1/0,p=1/0,m=-1/0,f=-1/0,b=-1/0;const g=n!==null;for(let y=t*6,v=(t+e)*6;y<v;y+=6){const _=i[y+0],x=i[y+1],S=_-x,k=_+x;S<r&&(r=S),k>l&&(l=k),g&&_<d&&(d=_),g&&_>m&&(m=_);const T=i[y+2],M=i[y+3],O=T-M,R=T+M;O<o&&(o=O),R>c&&(c=R),g&&T<u&&(u=T),g&&T>f&&(f=T);const A=i[y+4],$=i[y+5],w=A-$,z=A+$;w<a&&(a=w),z>h&&(h=z),g&&A<p&&(p=A),g&&A>b&&(b=A)}s[0]=r,s[1]=o,s[2]=a,s[3]=l,s[4]=c,s[5]=h,g&&(n[0]=d,n[1]=u,n[2]=p,n[3]=m,n[4]=f,n[5]=b)}function r1(i,t,e,s){let n=1/0,r=1/0,o=1/0,a=-1/0,l=-1/0,c=-1/0;for(let h=t*6,d=(t+e)*6;h<d;h+=6){const u=i[h+0];u<n&&(n=u),u>a&&(a=u);const p=i[h+2];p<r&&(r=p),p>l&&(l=p);const m=i[h+4];m<o&&(o=m),m>c&&(c=m)}s[0]=n,s[1]=r,s[2]=o,s[3]=a,s[4]=l,s[5]=c}function o1(i,t){n1(t);const e=i.attributes.position,s=i.index?i.index.array:null,n=Sr(i),r=new Float32Array(n*6),o=e.normalized,a=e.array,l=e.offset||0;let c=3;e.isInterleavedBufferAttribute&&(c=e.data.stride);const h=["getX","getY","getZ"];for(let d=0;d<n;d++){const u=d*3,p=d*6;let m=u+0,f=u+1,b=u+2;s&&(m=s[m],f=s[f],b=s[b]),o||(m=m*c+l,f=f*c+l,b=b*c+l);for(let g=0;g<3;g++){let y,v,_;o?(y=e[h[g]](m),v=e[h[g]](f),_=e[h[g]](b)):(y=a[m+g],v=a[f+g],_=a[b+g]);let x=y;v<x&&(x=v),_<x&&(x=_);let S=y;v>S&&(S=v),_>S&&(S=_);const k=(S-x)/2,T=g*2;r[p+T+0]=x+k,r[p+T+1]=k+(Math.abs(x)+k)*Jx,x<t[g]&&(t[g]=x),S>t[g+3]&&(t[g+3]=S)}}return r}const Yi=32,a1=(i,t)=>i.candidate-t.candidate,ms=new Array(Yi).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Oa=new Float32Array(6);function l1(i,t,e,s,n,r){let o=-1,a=0;if(r===zb)o=$p(t),o!==-1&&(a=(t[o]+t[o+3])/2);else if(r===Kx)o=$p(i),o!==-1&&(a=c1(e,s,n,o));else if(r===Qx){const l=Wr(i);let c=lh*n;const h=s*6,d=(s+n)*6;for(let u=0;u<3;u++){const p=t[u],m=(t[u+3]-p)/Yi;if(n<Yi/4){const f=[...ms];f.length=n;let b=0;for(let y=h;y<d;y+=6,b++){const v=f[b];v.candidate=e[y+2*u],v.count=0;const{bounds:_,leftCacheBounds:x,rightCacheBounds:S}=v;for(let k=0;k<3;k++)S[k]=1/0,S[k+3]=-1/0,x[k]=1/0,x[k+3]=-1/0,_[k]=1/0,_[k+3]=-1/0;$a(y,e,_)}f.sort(a1);let g=n;for(let y=0;y<g;y++){const v=f[y];for(;y+1<g&&f[y+1].candidate===v.candidate;)f.splice(y+1,1),g--}for(let y=h;y<d;y+=6){const v=e[y+2*u];for(let _=0;_<g;_++){const x=f[_];v>=x.candidate?$a(y,e,x.rightCacheBounds):($a(y,e,x.leftCacheBounds),x.count++)}}for(let y=0;y<g;y++){const v=f[y],_=v.count,x=n-v.count,S=v.leftCacheBounds,k=v.rightCacheBounds;let T=0;_!==0&&(T=Wr(S)/l);let M=0;x!==0&&(M=Wr(k)/l);const O=Pp+lh*(T*_+M*x);O<c&&(o=u,c=O,a=v.candidate)}}else{for(let g=0;g<Yi;g++){const y=ms[g];y.count=0,y.candidate=p+m+g*m;const v=y.bounds;for(let _=0;_<3;_++)v[_]=1/0,v[_+3]=-1/0}for(let g=h;g<d;g+=6){let y=~~((e[g+2*u]-p)/m);y>=Yi&&(y=Yi-1);const v=ms[y];v.count++,$a(g,e,v.bounds)}const f=ms[Yi-1];Op(f.bounds,f.rightCacheBounds);for(let g=Yi-2;g>=0;g--){const y=ms[g],v=ms[g+1];Dp(y.bounds,v.rightCacheBounds,y.rightCacheBounds)}let b=0;for(let g=0;g<Yi-1;g++){const y=ms[g],v=y.count,_=y.bounds,x=ms[g+1].rightCacheBounds;v!==0&&(b===0?Op(_,Oa):Dp(_,Oa,Oa)),b+=v;let S=0,k=0;b!==0&&(S=Wr(Oa)/l);const T=n-b;T!==0&&(k=Wr(x)/l);const M=Pp+lh*(S*b+k*T);M<c&&(o=u,c=M,a=y.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:o,pos:a}}function c1(i,t,e,s){let n=0;for(let r=t,o=t+e;r<o;r++)n+=i[r*6+s*2];return n/e}let Da=class{constructor(){}};function h1(i,t,e,s,n,r){let o=s,a=s+n-1;const l=r.pos,c=r.axis*2;for(;;){for(;o<=a&&e[o*6+c]<l;)o++;for(;o<=a&&e[a*6+c]>=l;)a--;if(o<a){for(let h=0;h<3;h++){let d=t[o*3+h];t[o*3+h]=t[a*3+h],t[a*3+h]=d}for(let h=0;h<6;h++){let d=e[o*6+h];e[o*6+h]=e[a*6+h],e[a*6+h]=d}o++,a--}else return o}}function d1(i,t,e,s,n,r){let o=s,a=s+n-1;const l=r.pos,c=r.axis*2;for(;;){for(;o<=a&&e[o*6+c]<l;)o++;for(;o<=a&&e[a*6+c]>=l;)a--;if(o<a){let h=i[o];i[o]=i[a],i[a]=h;for(let d=0;d<6;d++){let u=e[o*6+d];e[o*6+d]=e[a*6+d],e[a*6+d]=u}o++,a--}else return o}}function u1(i,t){const e=(i.index?i.index.count:i.attributes.position.count)/3,s=e>2**16,n=s?4:2,r=t?new SharedArrayBuffer(e*n):new ArrayBuffer(e*n),o=s?new Uint32Array(r):new Uint16Array(r);for(let a=0,l=o.length;a<l;a++)o[a]=a;return o}function p1(i,t){const e=i.geometry,s=e.index?e.index.array:null,n=t.maxDepth,r=t.verbose,o=t.maxLeafTris,a=t.strategy,l=t.onProgress,c=Sr(e),h=i._indirectBuffer;let d=!1;const u=new Float32Array(6),p=new Float32Array(6),m=o1(e,u),f=t.indirect?d1:h1,b=[],g=t.indirect?Lb(e):Rb(e);if(g.length===1){const _=g[0],x=new Da;x.boundingData=u,r1(m,_.offset,_.count,p),v(x,_.offset,_.count,p),b.push(x)}else for(let _ of g){const x=new Da;x.boundingData=new Float32Array(6),hh(m,_.offset,_.count,x.boundingData,p),v(x,_.offset,_.count,p),b.push(x)}return b;function y(_){l&&l(_/c)}function v(_,x,S,k=null,T=0){if(!d&&T>=n&&(d=!0,r&&(console.warn(`MeshBVH: Max depth of ${n} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),S<=o||T>=n)return y(x+S),_.offset=x,_.count=S,_;const M=l1(_.boundingData,k,m,x,S,a);if(M.axis===-1)return y(x+S),_.offset=x,_.count=S,_;const O=f(h,s,m,x,S,M);if(O===x||O===x+S)y(x+S),_.offset=x,_.count=S;else{_.splitAxis=M.axis;const R=new Da,A=x,$=O-x;_.left=R,R.boundingData=new Float32Array(6),hh(m,A,$,R.boundingData,p),v(R,A,$,p,T+1);const w=new Da,z=O,Y=S-$;_.right=w,w.boundingData=new Float32Array(6),hh(m,z,Y,w.boundingData,p),v(w,z,Y,p,T+1)}return _}}function f1(i,t){const e=i.geometry;t.indirect&&(i._indirectBuffer=u1(e,t.useSharedArrayBuffer),s1(e)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),i._indirectBuffer||i1(e,t);const s=p1(i,t);let n,r,o;const a=[],l=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let d=0;d<s.length;d++){const u=s[d];let p=c(u);const m=new l(Sl*p);n=new Float32Array(m),r=new Uint32Array(m),o=new Uint16Array(m),h(0,u),a.push(m)}i._roots=a;return;function c(d){return d.count?1:1+c(d.left)+c(d.right)}function h(d,u){const p=d/4,m=d/2,f=!!u.count,b=u.boundingData;for(let g=0;g<6;g++)n[p+g]=b[g];if(f){const g=u.offset,y=u.count;return r[p+6]=g,o[m+14]=y,o[m+15]=Sc,d+Sl}else{const g=u.left,y=u.right,v=u.splitAxis;let _;if(_=h(d+Sl,g),_/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[p+6]=_/4,_=h(_,y),r[p+7]=v,_}}}let rs=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let s=1/0,n=-1/0;for(let r=0,o=t.length;r<o;r++){const a=t[r][e];s=a<s?a:s,n=a>n?a:n}this.min=s,this.max=n}setFromPoints(t,e){let s=1/0,n=-1/0;for(let r=0,o=e.length;r<o;r++){const a=e[r],l=t.dot(a);s=l<s?l:s,n=l>n?l:n}this.min=s,this.max=n}isSeparated(t){return this.min>t.max||t.min>this.max}};rs.prototype.setFromBox=function(){const i=new L;return function(t,e){const s=e.min,n=e.max;let r=1/0,o=-1/0;for(let a=0;a<=1;a++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){i.x=s.x*a+n.x*(1-a),i.y=s.y*l+n.y*(1-l),i.z=s.z*c+n.z*(1-c);const h=t.dot(i);r=Math.min(h,r),o=Math.max(h,o)}this.min=r,this.max=o}}();const m1=function(){const i=new L,t=new L,e=new L;return function(s,n,r){const o=s.start,a=i,l=n.start,c=t;e.subVectors(o,l),i.subVectors(s.end,s.start),t.subVectors(n.end,n.start);const h=e.dot(c),d=c.dot(a),u=c.dot(c),p=e.dot(a),m=a.dot(a)*u-d*d;let f,b;m!==0?f=(h*d-p*u)/m:f=0,b=(h+f*d)/u,r.x=f,r.y=b}}(),mu=function(){const i=new Kt,t=new L,e=new L;return function(s,n,r,o){m1(s,n,i);let a=i.x,l=i.y;if(a>=0&&a<=1&&l>=0&&l<=1){s.at(a,r),n.at(l,o);return}else if(a>=0&&a<=1){l<0?n.at(0,o):n.at(1,o),s.closestPointToPoint(o,!0,r);return}else if(l>=0&&l<=1){a<0?s.at(0,r):s.at(1,r),n.closestPointToPoint(r,!0,o);return}else{let c;a<0?c=s.start:c=s.end;let h;l<0?h=n.start:h=n.end;const d=t,u=e;if(s.closestPointToPoint(h,!0,t),n.closestPointToPoint(c,!0,e),d.distanceToSquared(h)<=u.distanceToSquared(c)){r.copy(d),o.copy(h);return}else{r.copy(c),o.copy(u);return}}}}(),g1=function(){const i=new L,t=new L,e=new oi,s=new ti;return function(n,r){const{radius:o,center:a}=n,{a:l,b:c,c:h}=r;if(s.start=l,s.end=c,s.closestPointToPoint(a,!0,i).distanceTo(a)<=o||(s.start=l,s.end=h,s.closestPointToPoint(a,!0,i).distanceTo(a)<=o)||(s.start=c,s.end=h,s.closestPointToPoint(a,!0,i).distanceTo(a)<=o))return!0;const d=r.getPlane(e);if(Math.abs(d.distanceToPoint(a))<=o){const u=d.projectPoint(a,t);if(r.containsPoint(u))return!0}return!1}}(),b1=1e-15;function dh(i){return Math.abs(i)<b1}let Ci=class extends co{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new L),this.satBounds=new Array(4).fill().map(()=>new rs),this.points=[this.a,this.b,this.c],this.sphere=new Rs,this.plane=new oi,this.needsUpdate=!0}intersectsSphere(t){return g1(t,this)}update(){const t=this.a,e=this.b,s=this.c,n=this.points,r=this.satAxes,o=this.satBounds,a=r[0],l=o[0];this.getNormal(a),l.setFromPoints(a,n);const c=r[1],h=o[1];c.subVectors(t,e),h.setFromPoints(c,n);const d=r[2],u=o[2];d.subVectors(e,s),u.setFromPoints(d,n);const p=r[3],m=o[3];p.subVectors(s,t),m.setFromPoints(p,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,t),this.needsUpdate=!1}};Ci.prototype.closestPointToSegment=function(){const i=new L,t=new L,e=new ti;return function(s,n=null,r=null){const{start:o,end:a}=s,l=this.points;let c,h=1/0;for(let d=0;d<3;d++){const u=(d+1)%3;e.start.copy(l[d]),e.end.copy(l[u]),mu(e,s,i,t),c=i.distanceToSquared(t),c<h&&(h=c,n&&n.copy(i),r&&r.copy(t))}return this.closestPointToPoint(o,i),c=o.distanceToSquared(i),c<h&&(h=c,n&&n.copy(i),r&&r.copy(o)),this.closestPointToPoint(a,i),c=a.distanceToSquared(i),c<h&&(h=c,n&&n.copy(i),r&&r.copy(a)),Math.sqrt(h)}}();Ci.prototype.intersectsTriangle=function(){const i=new Ci,t=new Array(3),e=new Array(3),s=new rs,n=new rs,r=new L,o=new L,a=new L,l=new L,c=new L,h=new ti,d=new ti,u=new ti,p=new L;function m(f,b,g){const y=f.points;let v=0,_=-1;for(let x=0;x<3;x++){const{start:S,end:k}=h;S.copy(y[x]),k.copy(y[(x+1)%3]),h.delta(o);const T=dh(b.distanceToPoint(S));if(dh(b.normal.dot(o))&&T){g.copy(h),v=2;break}const M=b.intersectLine(h,p);if(!M&&T&&p.copy(S),(M||T)&&!dh(p.distanceTo(k))){if(v<=1)(v===1?g.start:g.end).copy(p),T&&(_=v);else if(v>=2){(_===1?g.start:g.end).copy(p),v=2;break}if(v++,v===2&&_===-1)break}}return v}return function(f,b=null,g=!1){this.needsUpdate&&this.update(),f.isExtendedTriangle?f.needsUpdate&&f.update():(i.copy(f),i.update(),f=i);const y=this.plane,v=f.plane;if(Math.abs(y.normal.dot(v.normal))>1-1e-10){const _=this.satBounds,x=this.satAxes;e[0]=f.a,e[1]=f.b,e[2]=f.c;for(let T=0;T<4;T++){const M=_[T],O=x[T];if(s.setFromPoints(O,e),M.isSeparated(s))return!1}const S=f.satBounds,k=f.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let T=0;T<4;T++){const M=S[T],O=k[T];if(s.setFromPoints(O,t),M.isSeparated(s))return!1}for(let T=0;T<4;T++){const M=x[T];for(let O=0;O<4;O++){const R=k[O];if(r.crossVectors(M,R),s.setFromPoints(r,t),n.setFromPoints(r,e),s.isSeparated(n))return!1}}return b&&(g||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),b.start.set(0,0,0),b.end.set(0,0,0)),!0}else{const _=m(this,v,d);if(_===1&&f.containsPoint(d.end))return b&&(b.start.copy(d.end),b.end.copy(d.end)),!0;if(_!==2)return!1;const x=m(f,y,u);if(x===1&&this.containsPoint(u.end))return b&&(b.start.copy(u.end),b.end.copy(u.end)),!0;if(x!==2)return!1;if(d.delta(a),u.delta(l),a.dot(l)<0){let A=u.start;u.start=u.end,u.end=A}const S=d.start.dot(a),k=d.end.dot(a),T=u.start.dot(a),M=u.end.dot(a),O=k<T,R=S<M;return S!==M&&T!==k&&O===R?!1:(b&&(c.subVectors(d.start,u.start),c.dot(a)>0?b.start.copy(d.start):b.start.copy(u.start),c.subVectors(d.end,u.end),c.dot(a)<0?b.end.copy(d.end):b.end.copy(u.end)),!0)}}}();Ci.prototype.distanceToPoint=function(){const i=new L;return function(t){return this.closestPointToPoint(t,i),t.distanceTo(i)}}();Ci.prototype.distanceToTriangle=function(){const i=new L,t=new L,e=["a","b","c"],s=new ti,n=new ti;return function(r,o=null,a=null){const l=o||a?s:null;if(this.intersectsTriangle(r,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let c=1/0;for(let h=0;h<3;h++){let d;const u=e[h],p=r[u];this.closestPointToPoint(p,i),d=p.distanceToSquared(i),d<c&&(c=d,o&&o.copy(i),a&&a.copy(p));const m=this[u];r.closestPointToPoint(m,i),d=m.distanceToSquared(i),d<c&&(c=d,o&&o.copy(m),a&&a.copy(i))}for(let h=0;h<3;h++){const d=e[h],u=e[(h+1)%3];s.set(this[d],this[u]);for(let p=0;p<3;p++){const m=e[p],f=e[(p+1)%3];n.set(r[m],r[f]),mu(s,n,i,t);const b=i.distanceToSquared(t);b<c&&(c=b,o&&o.copy(i),a&&a.copy(t))}}return Math.sqrt(c)}}();let Be=class{constructor(t,e,s){this.isOrientedBox=!0,this.min=new L,this.max=new L,this.matrix=new Pt,this.invMatrix=new Pt,this.points=new Array(8).fill().map(()=>new L),this.satAxes=new Array(3).fill().map(()=>new L),this.satBounds=new Array(3).fill().map(()=>new rs),this.alignedSatBounds=new Array(3).fill().map(()=>new rs),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),s&&this.matrix.copy(s)}set(t,e,s){this.min.copy(t),this.max.copy(e),this.matrix.copy(s),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}};Be.prototype.update=function(){return function(){const i=this.matrix,t=this.min,e=this.max,s=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){const d=1*l|2*c|4*h,u=s[d];u.x=l?e.x:t.x,u.y=c?e.y:t.y,u.z=h?e.z:t.z,u.applyMatrix4(i)}const n=this.satBounds,r=this.satAxes,o=s[0];for(let l=0;l<3;l++){const c=r[l],h=n[l],d=1<<l,u=s[d];c.subVectors(o,u),h.setFromPoints(c,s)}const a=this.alignedSatBounds;a[0].setFromPointsField(s,"x"),a[1].setFromPointsField(s,"y"),a[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Be.prototype.intersectsBox=function(){const i=new rs;return function(t){this.needsUpdate&&this.update();const e=t.min,s=t.max,n=this.satBounds,r=this.satAxes,o=this.alignedSatBounds;if(i.min=e.x,i.max=s.x,o[0].isSeparated(i)||(i.min=e.y,i.max=s.y,o[1].isSeparated(i))||(i.min=e.z,i.max=s.z,o[2].isSeparated(i)))return!1;for(let a=0;a<3;a++){const l=r[a],c=n[a];if(i.setFromBox(l,t),c.isSeparated(i))return!1}return!0}}();Be.prototype.intersectsTriangle=function(){const i=new Ci,t=new Array(3),e=new rs,s=new rs,n=new L;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(i.copy(r),i.update(),r=i);const o=this.satBounds,a=this.satAxes;t[0]=r.a,t[1]=r.b,t[2]=r.c;for(let d=0;d<3;d++){const u=o[d],p=a[d];if(e.setFromPoints(p,t),u.isSeparated(e))return!1}const l=r.satBounds,c=r.satAxes,h=this.points;for(let d=0;d<3;d++){const u=l[d],p=c[d];if(e.setFromPoints(p,h),u.isSeparated(e))return!1}for(let d=0;d<3;d++){const u=a[d];for(let p=0;p<4;p++){const m=c[p];if(n.crossVectors(u,m),e.setFromPoints(n,t),s.setFromPoints(n,h),e.isSeparated(s))return!1}}return!0}}();Be.prototype.closestPointToPoint=function(){return function(i,t){return this.needsUpdate&&this.update(),t.copy(i).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();Be.prototype.distanceToPoint=function(){const i=new L;return function(t){return this.closestPointToPoint(t,i),t.distanceTo(i)}}();Be.prototype.distanceToBox=function(){const i=["x","y","z"],t=new Array(12).fill().map(()=>new ti),e=new Array(12).fill().map(()=>new ti),s=new L,n=new L;return function(r,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(a||l)&&(r.getCenter(n),this.closestPointToPoint(n,s),r.closestPointToPoint(s,n),a&&a.copy(s),l&&l.copy(n)),0;const c=o*o,h=r.min,d=r.max,u=this.points;let p=1/0;for(let f=0;f<8;f++){const b=u[f];n.copy(b).clamp(h,d);const g=b.distanceToSquared(n);if(g<p&&(p=g,a&&a.copy(b),l&&l.copy(n),g<c))return Math.sqrt(g)}let m=0;for(let f=0;f<3;f++)for(let b=0;b<=1;b++)for(let g=0;g<=1;g++){const y=(f+1)%3,v=(f+2)%3,_=b<<y|g<<v,x=1<<f|b<<y|g<<v,S=u[_],k=u[x];t[m].set(S,k);const T=i[f],M=i[y],O=i[v],R=e[m],A=R.start,$=R.end;A[T]=h[T],A[M]=b?h[M]:d[M],A[O]=g?h[O]:d[M],$[T]=d[T],$[M]=b?h[M]:d[M],$[O]=g?h[O]:d[M],m++}for(let f=0;f<=1;f++)for(let b=0;b<=1;b++)for(let g=0;g<=1;g++){n.x=f?d.x:h.x,n.y=b?d.y:h.y,n.z=g?d.z:h.z,this.closestPointToPoint(n,s);const y=n.distanceToSquared(s);if(y<p&&(p=y,a&&a.copy(s),l&&l.copy(n),y<c))return Math.sqrt(y)}for(let f=0;f<12;f++){const b=t[f];for(let g=0;g<12;g++){const y=e[g];mu(b,y,s,n);const v=s.distanceToSquared(n);if(v<p&&(p=v,a&&a.copy(s),l&&l.copy(n),v<c))return Math.sqrt(v)}}return Math.sqrt(p)}}();let gu=class{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}},y1=class extends gu{constructor(){super(()=>new Ci)}};const ai=new y1;function Ke(i,t){return t[i+15]===65535}function Qe(i,t){return t[i+6]}function li(i,t){return t[i+14]}function ci(i){return i+8}function hi(i,t){return t[i+6]}function Bb(i,t){return t[i+7]}let v1=class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=s=>{e&&t.push(e),e=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,t.length!==0&&this.setBuffer(t.pop())}}};const Wt=new v1;let Es,Jn;const Ln=[],Ia=new gu(()=>new oe);function _1(i,t,e,s,n,r){Es=Ia.getPrimitive(),Jn=Ia.getPrimitive(),Ln.push(Es,Jn),Wt.setBuffer(i._roots[t]);const o=ld(0,i.geometry,e,s,n,r);Wt.clearBuffer(),Ia.releasePrimitive(Es),Ia.releasePrimitive(Jn),Ln.pop(),Ln.pop();const a=Ln.length;return a>0&&(Jn=Ln[a-1],Es=Ln[a-2]),o}function ld(i,t,e,s,n=null,r=0,o=0){const{float32Array:a,uint16Array:l,uint32Array:c}=Wt;let h=i*2;if(Ke(h,l)){const d=Qe(i,c),u=li(h,l);return Xt(i,a,Es),s(d,u,!1,o,r+i,Es)}else{let d=function(R){const{uint16Array:A,uint32Array:$}=Wt;let w=R*2;for(;!Ke(w,A);)R=ci(R),w=R*2;return Qe(R,$)},u=function(R){const{uint16Array:A,uint32Array:$}=Wt;let w=R*2;for(;!Ke(w,A);)R=hi(R,$),w=R*2;return Qe(R,$)+li(w,A)};const p=ci(i),m=hi(i,c);let f=p,b=m,g,y,v,_;if(n&&(v=Es,_=Jn,Xt(f,a,v),Xt(b,a,_),g=n(v),y=n(_),y<g)){f=m,b=p;const R=g;g=y,y=R,v=_}v||(v=Es,Xt(f,a,v));const x=Ke(f*2,l),S=e(v,x,g,o+1,r+f);let k;if(S===Mp){const R=d(f),A=u(f)-R;k=s(R,A,!0,o+1,r+f,v)}else k=S&&ld(f,t,e,s,n,r,o+1);if(k)return!0;_=Jn,Xt(b,a,_);const T=Ke(b*2,l),M=e(_,T,y,o+1,r+b);let O;if(M===Mp){const R=d(b),A=u(b)-R;O=s(R,A,!0,o+1,r+b,_)}else O=M&&ld(b,t,e,s,n,r,o+1);return!!O}}const qr=new L,uh=new L;function w1(i,t,e={},s=0,n=1/0){const r=s*s,o=n*n;let a=1/0,l=null;if(i.shapecast({boundsTraverseOrder:h=>(qr.copy(t).clamp(h.min,h.max),qr.distanceToSquared(t)),intersectsBounds:(h,d,u)=>u<a&&u<o,intersectsTriangle:(h,d)=>{h.closestPointToPoint(t,qr);const u=t.distanceToSquared(qr);return u<a&&(uh.copy(qr),a=u,l=d),u<r}}),a===1/0)return null;const c=Math.sqrt(a);return e.point?e.point.copy(uh):e.point=uh.clone(),e.distance=c,e.faceIndex=l,e}const Rn=new L,Bn=new L,Nn=new L,za=new Kt,La=new Kt,Ra=new Kt,Ip=new L,zp=new L,Lp=new L,Ba=new L;function x1(i,t,e,s,n,r){let o;return r===K0?o=i.intersectTriangle(s,e,t,!0,n):o=i.intersectTriangle(t,e,s,r!==Bs,n),o===null?null:{distance:i.origin.distanceTo(n),point:n.clone()}}function C1(i,t,e,s,n,r,o,a,l){Rn.fromBufferAttribute(t,r),Bn.fromBufferAttribute(t,o),Nn.fromBufferAttribute(t,a);const c=x1(i,Rn,Bn,Nn,Ba,l);if(c){s&&(za.fromBufferAttribute(s,r),La.fromBufferAttribute(s,o),Ra.fromBufferAttribute(s,a),c.uv=co.getInterpolation(Ba,Rn,Bn,Nn,za,La,Ra,new Kt)),n&&(za.fromBufferAttribute(n,r),La.fromBufferAttribute(n,o),Ra.fromBufferAttribute(n,a),c.uv1=co.getInterpolation(Ba,Rn,Bn,Nn,za,La,Ra,new Kt)),e&&(Ip.fromBufferAttribute(e,r),zp.fromBufferAttribute(e,o),Lp.fromBufferAttribute(e,a),c.normal=co.getInterpolation(Ba,Rn,Bn,Nn,Ip,zp,Lp,new L),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));const h={a:r,b:o,c:a,normal:new L,materialIndex:0};co.getNormal(Rn,Bn,Nn,h.normal),c.face=h,c.faceIndex=r}return c}function Ec(i,t,e,s,n){const r=s*3;let o=r+0,a=r+1,l=r+2;const c=i.index;i.index&&(o=c.getX(o),a=c.getX(a),l=c.getX(l));const{position:h,normal:d,uv:u,uv1:p}=i.attributes,m=C1(e,h,d,u,p,o,a,l,t);return m?(m.faceIndex=s,n&&n.push(m),m):null}function he(i,t,e,s){const n=i.a,r=i.b,o=i.c;let a=t,l=t+1,c=t+2;e&&(a=e.getX(a),l=e.getX(l),c=e.getX(c)),n.x=s.getX(a),n.y=s.getY(a),n.z=s.getZ(a),r.x=s.getX(l),r.y=s.getY(l),r.z=s.getZ(l),o.x=s.getX(c),o.y=s.getY(c),o.z=s.getZ(c)}function S1(i,t,e,s,n,r){const{geometry:o,_indirectBuffer:a}=i;for(let l=s,c=s+n;l<c;l++)Ec(o,t,e,l,r)}function E1(i,t,e,s,n){const{geometry:r,_indirectBuffer:o}=i;let a=1/0,l=null;for(let c=s,h=s+n;c<h;c++){let d;d=Ec(r,t,e,c),d&&d.distance<a&&(l=d,a=d.distance)}return l}function k1(i,t,e,s,n,r,o){const{geometry:a}=e,{index:l}=a,c=a.attributes.position;for(let h=i,d=t+i;h<d;h++){let u;if(u=h,he(o,u*3,l,c),o.needsUpdate=!0,s(o,u,n,r))return!0}return!1}function A1(i,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=i.geometry,s=e.index?e.index.array:null,n=e.attributes.position;let r,o,a,l,c=0;const h=i._roots;for(let u=0,p=h.length;u<p;u++)r=h[u],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),d(0,c),c+=r.byteLength;function d(u,p,m=!1){const f=u*2;if(a[f+15]===Sc){const b=o[u+6],g=a[f+14];let y=1/0,v=1/0,_=1/0,x=-1/0,S=-1/0,k=-1/0;for(let T=3*b,M=3*(b+g);T<M;T++){let O=s[T];const R=n.getX(O),A=n.getY(O),$=n.getZ(O);R<y&&(y=R),R>x&&(x=R),A<v&&(v=A),A>S&&(S=A),$<_&&(_=$),$>k&&(k=$)}return l[u+0]!==y||l[u+1]!==v||l[u+2]!==_||l[u+3]!==x||l[u+4]!==S||l[u+5]!==k?(l[u+0]=y,l[u+1]=v,l[u+2]=_,l[u+3]=x,l[u+4]=S,l[u+5]=k,!0):!1}else{const b=u+8,g=o[u+6],y=b+p,v=g+p;let _=m,x=!1,S=!1;t?_||(x=t.has(y),S=t.has(v),_=!x&&!S):(x=!0,S=!0);const k=_||x,T=_||S;let M=!1;k&&(M=d(b,p,_));let O=!1;T&&(O=d(g,p,_));const R=M||O;if(R)for(let A=0;A<3;A++){const $=b+A,w=g+A,z=l[$],Y=l[$+3],V=l[w],K=l[w+3];l[u+A]=z<V?z:V,l[u+A+3]=Y>K?Y:K}return R}}}const Rp=new oe;function Fs(i,t,e,s){return Xt(i,t,Rp),e.intersectBox(Rp,s)}function T1(i,t,e,s,n,r){const{geometry:o,_indirectBuffer:a}=i;for(let l=s,c=s+n;l<c;l++){let h=a?a[l]:l;Ec(o,t,e,h,r)}}function M1(i,t,e,s,n){const{geometry:r,_indirectBuffer:o}=i;let a=1/0,l=null;for(let c=s,h=s+n;c<h;c++){let d;d=Ec(r,t,e,o?o[c]:c),d&&d.distance<a&&(l=d,a=d.distance)}return l}function P1(i,t,e,s,n,r,o){const{geometry:a}=e,{index:l}=a,c=a.attributes.position;for(let h=i,d=t+i;h<d;h++){let u;if(u=e.resolveTriangleIndex(h),he(o,u*3,l,c),o.needsUpdate=!0,s(o,u,n,r))return!0}return!1}const Bp=new L;function $1(i,t,e,s,n){Wt.setBuffer(i._roots[t]),cd(0,i,e,s,n),Wt.clearBuffer()}function cd(i,t,e,s,n){const{float32Array:r,uint16Array:o,uint32Array:a}=Wt,l=i*2;if(Ke(l,o)){const c=Qe(i,a),h=li(l,o);S1(t,e,s,c,h,n)}else{const c=ci(i);Fs(c,r,s,Bp)&&cd(c,t,e,s,n);const h=hi(i,a);Fs(h,r,s,Bp)&&cd(h,t,e,s,n)}}const Np=new L,O1=["x","y","z"];function D1(i,t,e,s){Wt.setBuffer(i._roots[t]);const n=hd(0,i,e,s);return Wt.clearBuffer(),n}function hd(i,t,e,s){const{float32Array:n,uint16Array:r,uint32Array:o}=Wt;let a=i*2;if(Ke(a,r)){const l=Qe(i,o),c=li(a,r);return E1(t,e,s,l,c)}else{const l=Bb(i,o),c=O1[l],h=s.direction[c]>=0;let d,u;h?(d=ci(i),u=hi(i,o)):(d=hi(i,o),u=ci(i));const p=Fs(d,n,s,Np)?hd(d,t,e,s):null;if(p){const f=p.point[c];if(h?f<=n[u+l]:f>=n[u+l+3])return p}const m=Fs(u,n,s,Np)?hd(u,t,e,s):null;return p&&m?p.distance<=m.distance?p:m:p||m||null}}const Na=new oe,Fn=new Ci,Un=new Ci,Yr=new Pt,Fp=new Be,Fa=new Be;function I1(i,t,e,s){Wt.setBuffer(i._roots[t]);const n=dd(0,i,e,s);return Wt.clearBuffer(),n}function dd(i,t,e,s,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=Wt;let l=i*2;if(n===null&&(e.boundingBox||e.computeBoundingBox(),Fp.set(e.boundingBox.min,e.boundingBox.max,s),n=Fp),Ke(l,o)){const c=t.geometry,h=c.index,d=c.attributes.position,u=e.index,p=e.attributes.position,m=Qe(i,a),f=li(l,o);if(Yr.copy(s).invert(),e.boundsTree)return Xt(i,r,Fa),Fa.matrix.copy(Yr),Fa.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:b=>Fa.intersectsBox(b),intersectsTriangle:b=>{b.a.applyMatrix4(s),b.b.applyMatrix4(s),b.c.applyMatrix4(s),b.needsUpdate=!0;for(let g=m*3,y=(f+m)*3;g<y;g+=3)if(he(Un,g,h,d),Un.needsUpdate=!0,b.intersectsTriangle(Un))return!0;return!1}});for(let b=m*3,g=(f+m)*3;b<g;b+=3){he(Fn,b,h,d),Fn.a.applyMatrix4(Yr),Fn.b.applyMatrix4(Yr),Fn.c.applyMatrix4(Yr),Fn.needsUpdate=!0;for(let y=0,v=u.count;y<v;y+=3)if(he(Un,y,u,p),Un.needsUpdate=!0,Fn.intersectsTriangle(Un))return!0}}else{const c=i+8,h=a[i+6];return Xt(c,r,Na),!!(n.intersectsBox(Na)&&dd(c,t,e,s,n)||(Xt(h,r,Na),n.intersectsBox(Na)&&dd(h,t,e,s,n)))}}const Ua=new Pt,ph=new Be,Zr=new Be,z1=new L,L1=new L,R1=new L,B1=new L;function N1(i,t,e,s={},n={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),ph.set(t.boundingBox.min,t.boundingBox.max,e),ph.needsUpdate=!0;const a=i.geometry,l=a.attributes.position,c=a.index,h=t.attributes.position,d=t.index,u=ai.getPrimitive(),p=ai.getPrimitive();let m=z1,f=L1,b=null,g=null;n&&(b=R1,g=B1);let y=1/0,v=null,_=null;return Ua.copy(e).invert(),Zr.matrix.copy(Ua),i.shapecast({boundsTraverseOrder:x=>ph.distanceToBox(x),intersectsBounds:(x,S,k)=>k<y&&k<o?(S&&(Zr.min.copy(x.min),Zr.max.copy(x.max),Zr.needsUpdate=!0),!0):!1,intersectsRange:(x,S)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:k=>Zr.distanceToBox(k),intersectsBounds:(k,T,M)=>M<y&&M<o,intersectsRange:(k,T)=>{for(let M=k,O=k+T;M<O;M++){he(p,3*M,d,h),p.a.applyMatrix4(e),p.b.applyMatrix4(e),p.c.applyMatrix4(e),p.needsUpdate=!0;for(let R=x,A=x+S;R<A;R++){he(u,3*R,c,l),u.needsUpdate=!0;const $=u.distanceToTriangle(p,m,b);if($<y&&(f.copy(m),g&&g.copy(b),y=$,v=R,_=M),$<r)return!0}}}});{const k=Sr(t);for(let T=0,M=k;T<M;T++){he(p,3*T,d,h),p.a.applyMatrix4(e),p.b.applyMatrix4(e),p.c.applyMatrix4(e),p.needsUpdate=!0;for(let O=x,R=x+S;O<R;O++){he(u,3*O,c,l),u.needsUpdate=!0;const A=u.distanceToTriangle(p,m,b);if(A<y&&(f.copy(m),g&&g.copy(b),y=A,v=O,_=T),A<r)return!0}}}}}),ai.releasePrimitive(u),ai.releasePrimitive(p),y===1/0?null:(s.point?s.point.copy(f):s.point=f.clone(),s.distance=y,s.faceIndex=v,n&&(n.point?n.point.copy(g):n.point=g.clone(),n.point.applyMatrix4(Ua),f.applyMatrix4(Ua),n.distance=f.sub(n.point).length(),n.faceIndex=_),s)}function F1(i,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=i.geometry,s=e.index?e.index.array:null,n=e.attributes.position;let r,o,a,l,c=0;const h=i._roots;for(let u=0,p=h.length;u<p;u++)r=h[u],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),d(0,c),c+=r.byteLength;function d(u,p,m=!1){const f=u*2;if(a[f+15]===Sc){const b=o[u+6],g=a[f+14];let y=1/0,v=1/0,_=1/0,x=-1/0,S=-1/0,k=-1/0;for(let T=b,M=b+g;T<M;T++){const O=3*i.resolveTriangleIndex(T);for(let R=0;R<3;R++){let A=O+R;A=s?s[A]:A;const $=n.getX(A),w=n.getY(A),z=n.getZ(A);$<y&&(y=$),$>x&&(x=$),w<v&&(v=w),w>S&&(S=w),z<_&&(_=z),z>k&&(k=z)}}return l[u+0]!==y||l[u+1]!==v||l[u+2]!==_||l[u+3]!==x||l[u+4]!==S||l[u+5]!==k?(l[u+0]=y,l[u+1]=v,l[u+2]=_,l[u+3]=x,l[u+4]=S,l[u+5]=k,!0):!1}else{const b=u+8,g=o[u+6],y=b+p,v=g+p;let _=m,x=!1,S=!1;t?_||(x=t.has(y),S=t.has(v),_=!x&&!S):(x=!0,S=!0);const k=_||x,T=_||S;let M=!1;k&&(M=d(b,p,_));let O=!1;T&&(O=d(g,p,_));const R=M||O;if(R)for(let A=0;A<3;A++){const $=b+A,w=g+A,z=l[$],Y=l[$+3],V=l[w],K=l[w+3];l[u+A]=z<V?z:V,l[u+A+3]=Y>K?Y:K}return R}}}const Up=new L;function U1(i,t,e,s,n){Wt.setBuffer(i._roots[t]),ud(0,i,e,s,n),Wt.clearBuffer()}function ud(i,t,e,s,n){const{float32Array:r,uint16Array:o,uint32Array:a}=Wt,l=i*2;if(Ke(l,o)){const c=Qe(i,a),h=li(l,o);T1(t,e,s,c,h,n)}else{const c=ci(i);Fs(c,r,s,Up)&&ud(c,t,e,s,n);const h=hi(i,a);Fs(h,r,s,Up)&&ud(h,t,e,s,n)}}const jp=new L,j1=["x","y","z"];function V1(i,t,e,s){Wt.setBuffer(i._roots[t]);const n=pd(0,i,e,s);return Wt.clearBuffer(),n}function pd(i,t,e,s){const{float32Array:n,uint16Array:r,uint32Array:o}=Wt;let a=i*2;if(Ke(a,r)){const l=Qe(i,o),c=li(a,r);return M1(t,e,s,l,c)}else{const l=Bb(i,o),c=j1[l],h=s.direction[c]>=0;let d,u;h?(d=ci(i),u=hi(i,o)):(d=hi(i,o),u=ci(i));const p=Fs(d,n,s,jp)?pd(d,t,e,s):null;if(p){const f=p.point[c];if(h?f<=n[u+l]:f>=n[u+l+3])return p}const m=Fs(u,n,s,jp)?pd(u,t,e,s):null;return p&&m?p.distance<=m.distance?p:m:p||m||null}}const ja=new oe,jn=new Ci,Vn=new Ci,Gr=new Pt,Vp=new Be,Va=new Be;function H1(i,t,e,s){Wt.setBuffer(i._roots[t]);const n=fd(0,i,e,s);return Wt.clearBuffer(),n}function fd(i,t,e,s,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=Wt;let l=i*2;if(n===null&&(e.boundingBox||e.computeBoundingBox(),Vp.set(e.boundingBox.min,e.boundingBox.max,s),n=Vp),Ke(l,o)){const c=t.geometry,h=c.index,d=c.attributes.position,u=e.index,p=e.attributes.position,m=Qe(i,a),f=li(l,o);if(Gr.copy(s).invert(),e.boundsTree)return Xt(i,r,Va),Va.matrix.copy(Gr),Va.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:b=>Va.intersectsBox(b),intersectsTriangle:b=>{b.a.applyMatrix4(s),b.b.applyMatrix4(s),b.c.applyMatrix4(s),b.needsUpdate=!0;for(let g=m,y=f+m;g<y;g++)if(he(Vn,3*t.resolveTriangleIndex(g),h,d),Vn.needsUpdate=!0,b.intersectsTriangle(Vn))return!0;return!1}});for(let b=m,g=f+m;b<g;b++){const y=t.resolveTriangleIndex(b);he(jn,3*y,h,d),jn.a.applyMatrix4(Gr),jn.b.applyMatrix4(Gr),jn.c.applyMatrix4(Gr),jn.needsUpdate=!0;for(let v=0,_=u.count;v<_;v+=3)if(he(Vn,v,u,p),Vn.needsUpdate=!0,jn.intersectsTriangle(Vn))return!0}}else{const c=i+8,h=a[i+6];return Xt(c,r,ja),!!(n.intersectsBox(ja)&&fd(c,t,e,s,n)||(Xt(h,r,ja),n.intersectsBox(ja)&&fd(h,t,e,s,n)))}}const Ha=new Pt,fh=new Be,Xr=new Be,W1=new L,q1=new L,Y1=new L,Z1=new L;function G1(i,t,e,s={},n={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),fh.set(t.boundingBox.min,t.boundingBox.max,e),fh.needsUpdate=!0;const a=i.geometry,l=a.attributes.position,c=a.index,h=t.attributes.position,d=t.index,u=ai.getPrimitive(),p=ai.getPrimitive();let m=W1,f=q1,b=null,g=null;n&&(b=Y1,g=Z1);let y=1/0,v=null,_=null;return Ha.copy(e).invert(),Xr.matrix.copy(Ha),i.shapecast({boundsTraverseOrder:x=>fh.distanceToBox(x),intersectsBounds:(x,S,k)=>k<y&&k<o?(S&&(Xr.min.copy(x.min),Xr.max.copy(x.max),Xr.needsUpdate=!0),!0):!1,intersectsRange:(x,S)=>{if(t.boundsTree){const k=t.boundsTree;return k.shapecast({boundsTraverseOrder:T=>Xr.distanceToBox(T),intersectsBounds:(T,M,O)=>O<y&&O<o,intersectsRange:(T,M)=>{for(let O=T,R=T+M;O<R;O++){const A=k.resolveTriangleIndex(O);he(p,3*A,d,h),p.a.applyMatrix4(e),p.b.applyMatrix4(e),p.c.applyMatrix4(e),p.needsUpdate=!0;for(let $=x,w=x+S;$<w;$++){const z=i.resolveTriangleIndex($);he(u,3*z,c,l),u.needsUpdate=!0;const Y=u.distanceToTriangle(p,m,b);if(Y<y&&(f.copy(m),g&&g.copy(b),y=Y,v=$,_=O),Y<r)return!0}}}})}else{const k=Sr(t);for(let T=0,M=k;T<M;T++){he(p,3*T,d,h),p.a.applyMatrix4(e),p.b.applyMatrix4(e),p.c.applyMatrix4(e),p.needsUpdate=!0;for(let O=x,R=x+S;O<R;O++){const A=i.resolveTriangleIndex(O);he(u,3*A,c,l),u.needsUpdate=!0;const $=u.distanceToTriangle(p,m,b);if($<y&&(f.copy(m),g&&g.copy(b),y=$,v=O,_=T),$<r)return!0}}}}}),ai.releasePrimitive(u),ai.releasePrimitive(p),y===1/0?null:(s.point?s.point.copy(f):s.point=f.clone(),s.distance=y,s.faceIndex=v,n&&(n.point?n.point.copy(g):n.point=g.clone(),n.point.applyMatrix4(Ha),f.applyMatrix4(Ha),n.distance=f.sub(n.point).length(),n.faceIndex=_),s)}function X1(){return typeof SharedArrayBuffer<"u"}const _o=new Wt.constructor,jl=new Wt.constructor,_s=new gu(()=>new oe),Hn=new oe,Wn=new oe,mh=new oe,gh=new oe;let bh=!1;function K1(i,t,e,s){if(bh)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");bh=!0;const n=i._roots,r=t._roots;let o,a=0,l=0;const c=new Pt().copy(e).invert();for(let h=0,d=n.length;h<d;h++){_o.setBuffer(n[h]),l=0;const u=_s.getPrimitive();Xt(0,_o.float32Array,u),u.applyMatrix4(c);for(let p=0,m=r.length;p<m&&(jl.setBuffer(r[h]),o=bi(0,0,e,c,s,a,l,0,0,u),jl.clearBuffer(),l+=r[p].length,!o);p++);if(_s.releasePrimitive(u),_o.clearBuffer(),a+=n[h].length,o)break}return bh=!1,o}function bi(i,t,e,s,n,r=0,o=0,a=0,l=0,c=null,h=!1){let d,u;h?(d=jl,u=_o):(d=_o,u=jl);const p=d.float32Array,m=d.uint32Array,f=d.uint16Array,b=u.float32Array,g=u.uint32Array,y=u.uint16Array,v=i*2,_=t*2,x=Ke(v,f),S=Ke(_,y);let k=!1;if(S&&x)h?k=n(Qe(t,g),li(t*2,y),Qe(i,m),li(i*2,f),l,o+t,a,r+i):k=n(Qe(i,m),li(i*2,f),Qe(t,g),li(t*2,y),a,r+i,l,o+t);else if(S){const T=_s.getPrimitive();Xt(t,b,T),T.applyMatrix4(e);const M=ci(i),O=hi(i,m);Xt(M,p,Hn),Xt(O,p,Wn);const R=T.intersectsBox(Hn),A=T.intersectsBox(Wn);k=R&&bi(t,M,s,e,n,o,r,l,a+1,T,!h)||A&&bi(t,O,s,e,n,o,r,l,a+1,T,!h),_s.releasePrimitive(T)}else{const T=ci(t),M=hi(t,g);Xt(T,b,mh),Xt(M,b,gh);const O=c.intersectsBox(mh),R=c.intersectsBox(gh);if(O&&R)k=bi(i,T,e,s,n,r,o,a,l+1,c,h)||bi(i,M,e,s,n,r,o,a,l+1,c,h);else if(O)if(x)k=bi(i,T,e,s,n,r,o,a,l+1,c,h);else{const A=_s.getPrimitive();A.copy(mh).applyMatrix4(e);const $=ci(i),w=hi(i,m);Xt($,p,Hn),Xt(w,p,Wn);const z=A.intersectsBox(Hn),Y=A.intersectsBox(Wn);k=z&&bi(T,$,s,e,n,o,r,l,a+1,A,!h)||Y&&bi(T,w,s,e,n,o,r,l,a+1,A,!h),_s.releasePrimitive(A)}else if(R)if(x)k=bi(i,M,e,s,n,r,o,a,l+1,c,h);else{const A=_s.getPrimitive();A.copy(gh).applyMatrix4(e);const $=ci(i),w=hi(i,m);Xt($,p,Hn),Xt(w,p,Wn);const z=A.intersectsBox(Hn),Y=A.intersectsBox(Wn);k=z&&bi(M,$,s,e,n,o,r,l,a+1,A,!h)||Y&&bi(M,w,s,e,n,o,r,l,a+1,A,!h),_s.releasePrimitive(A)}}return k}const Wa=new Be,Hp=new oe;let Q1=class Nb{static serialize(t,e={}){e={cloneBuffers:!0,...e};const s=t.geometry,n=t._roots,r=t._indirectBuffer,o=s.getIndex();let a;return e.cloneBuffers?a={roots:n.map(l=>l.slice()),index:o.array.slice(),indirectBuffer:r?r.slice():null}:a={roots:n,index:o.array,indirectBuffer:r},a}static deserialize(t,e,s={}){s={setIndex:!0,indirect:!!t.indirectBuffer,...s};const{index:n,roots:r,indirectBuffer:o}=t,a=new Nb(e,{...s,[ch]:!0});if(a._roots=r,a._indirectBuffer=o||null,s.setIndex){const l=e.getIndex();if(l===null){const c=new Je(t.index,1,!1);e.setIndex(c)}else l.array!==n&&(l.array.set(n),l.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({strategy:zb,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[ch]:!1},e),e.useSharedArrayBuffer&&!X1())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[ch]||(f1(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new oe)));const{_indirectBuffer:s}=this;this.resolveTriangleIndex=e.indirect?n=>s[n]:n=>n}refit(t=null){return(this.indirect?F1:A1)(this,t)}traverse(t,e=0){const s=this._roots[e],n=new Uint32Array(s),r=new Uint16Array(s);o(0);function o(a,l=0){const c=a*2,h=r[c+15]===Sc;if(h){const d=n[a+6],u=r[c+14];t(l,h,new Float32Array(s,a*4,6),d,u)}else{const d=a+Sl/4,u=n[a+6],p=n[a+7];t(l,h,new Float32Array(s,a*4,6),p)||(o(d,l+1),o(u,l+1))}}}raycast(t,e=fp){const s=this._roots,n=this.geometry,r=[],o=e.isMaterial,a=Array.isArray(e),l=n.groups,c=o?e.side:e,h=this.indirect?U1:$1;for(let d=0,u=s.length;d<u;d++){const p=a?e[l[d].materialIndex].side:c,m=r.length;if(h(this,d,p,t,r),a){const f=l[d].materialIndex;for(let b=m,g=r.length;b<g;b++)r[b].face.materialIndex=f}}return r}raycastFirst(t,e=fp){const s=this._roots,n=this.geometry,r=e.isMaterial,o=Array.isArray(e);let a=null;const l=n.groups,c=r?e.side:e,h=this.indirect?V1:D1;for(let d=0,u=s.length;d<u;d++){const p=o?e[l[d].materialIndex].side:c,m=h(this,d,p,t);m!=null&&(a==null||m.distance<a.distance)&&(a=m,o&&(m.face.materialIndex=l[d].materialIndex))}return a}intersectsGeometry(t,e){let s=!1;const n=this._roots,r=this.indirect?H1:I1;for(let o=0,a=n.length;o<a&&(s=r(this,o,t,e),!s);o++);return s}shapecast(t){const e=ai.getPrimitive(),s=this.indirect?P1:k1;let{boundsTraverseOrder:n,intersectsBounds:r,intersectsRange:o,intersectsTriangle:a}=t;if(o&&a){const d=o;o=(u,p,m,f,b)=>d(u,p,m,f,b)?!0:s(u,p,this,a,m,f,e)}else o||(a?o=(d,u,p,m)=>s(d,u,this,a,p,m,e):o=(d,u,p)=>p);let l=!1,c=0;const h=this._roots;for(let d=0,u=h.length;d<u;d++){const p=h[d];if(l=_1(this,d,r,o,n,c),l)break;c+=p.byteLength}return ai.releasePrimitive(e),l}bvhcast(t,e,s){let{intersectsRanges:n,intersectsTriangles:r}=s;const o=ai.getPrimitive(),a=this.geometry.index,l=this.geometry.attributes.position,c=this.indirect?m=>{const f=this.resolveTriangleIndex(m);he(o,f*3,a,l)}:m=>{he(o,m*3,a,l)},h=ai.getPrimitive(),d=t.geometry.index,u=t.geometry.attributes.position,p=t.indirect?m=>{const f=t.resolveTriangleIndex(m);he(h,f*3,d,u)}:m=>{he(h,m*3,d,u)};if(r){const m=(f,b,g,y,v,_,x,S)=>{for(let k=g,T=g+y;k<T;k++){p(k),h.a.applyMatrix4(e),h.b.applyMatrix4(e),h.c.applyMatrix4(e),h.needsUpdate=!0;for(let M=f,O=f+b;M<O;M++)if(c(M),o.needsUpdate=!0,r(o,h,M,k,v,_,x,S))return!0}return!1};if(n){const f=n;n=function(b,g,y,v,_,x,S,k){return f(b,g,y,v,_,x,S,k)?!0:m(b,g,y,v,_,x,S,k)}}else n=m}return K1(this,t,e,n)}intersectsBox(t,e){return Wa.set(t.min,t.max,e),Wa.needsUpdate=!0,this.shapecast({intersectsBounds:s=>Wa.intersectsBox(s),intersectsTriangle:s=>Wa.intersectsTriangle(s)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,s={},n={},r=0,o=1/0){return(this.indirect?G1:N1)(this,t,e,s,n,r,o)}closestPointToPoint(t,e={},s=0,n=1/0){return w1(this,t,e,s,n)}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(e=>{Xt(0,new Float32Array(e),Hp),t.union(Hp)}),t}};function Wp(i,t,e){return i===null||(i.point.applyMatrix4(t.matrixWorld),i.distance=i.point.distanceTo(e.ray.origin),i.object=t,i.distance<e.near||i.distance>e.far)?null:i}const yh=new N0,qp=new Pt,J1=at.prototype.raycast;function tC(i,t){if(this.geometry.boundsTree){if(this.material===void 0)return;qp.copy(this.matrixWorld).invert(),yh.copy(i.ray).applyMatrix4(qp);const e=this.geometry.boundsTree;if(i.firstHitOnly===!0){const s=Wp(e.raycastFirst(yh,this.material),this,i);s&&t.push(s)}else{const s=e.raycast(yh,this.material);for(let n=0,r=s.length;n<r;n++){const o=Wp(s[n],this,i);o&&t.push(o)}}}else J1.call(this,i,t)}function eC(i){return this.boundsTree=new Q1(this,i),this.boundsTree}function iC(){this.boundsTree=null}const Fb=class Ub{constructor(){E(this,"onDisposed",new et),E(this,"list",new It),E(this,"enabled",!1),E(this,"_clock"),E(this,"onInit",new et),E(this,"update",()=>{if(!this.enabled)return;const t=this._clock.getDelta();for(const[e,s]of this.list)s.enabled&&s.isUpdateable()&&s.update(t);requestAnimationFrame(this.update)}),this._clock=new P0,Ub.setupBVH()}add(t,e){if(this.list.has(t))throw new Error("You're trying to add a component that already exists in the components instance. Use Components.get() instead.");_e.validate(t),this.list.set(t,e)}get(t){var e;const s=t.uuid;if(!this.list.has(s)){const n=new t(this);return(e=n.isDisposeable)!=null&&e.call(n)&&n.onDisposed.add(()=>this.list.delete(s)),this.list.has(s)||this.add(s,n),n}return this.list.get(s)}init(){this.enabled=!0;for(const[t,e]of this.list.entries())e.enabled=!0;this._clock.start(),this.update(),this.onInit.trigger()}dispose(){this.enabled=!1;let t;for(const[e,s]of this.list){if(s.enabled=!1,e===ut.uuid){t=s;continue}s.isDisposeable()&&s.dispose()}t==null||t.dispose(),this._clock.stop(),this.onDisposed.trigger()}static setupBVH(){xe.prototype.computeBoundsTree=eC,xe.prototype.disposeBoundsTree=iC,at.prototype.raycast=tC}};E(Fb,"release","2.4.3");let jb=Fb,sC=class{constructor(t){E(this,"enabled",!1),E(this,"id","FirstPerson"),this.camera=t}set(t){if(this.enabled=t,t){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const t=this.camera.controls,e=new L;t.distance--,t.getPosition(e),t.minDistance=1,t.maxDistance=1,t.distance=1,t.moveTo(e.x,e.y,e.z),t.truckSpeed=50,t.mouseButtons.wheel=Xe.ACTION.DOLLY,t.touches.two=Xe.ACTION.TOUCH_ZOOM_TRUCK}},nC=class{constructor(t){E(this,"enabled",!0),E(this,"id","Orbit"),this.camera=t,this.activateOrbitControls()}set(t){this.enabled=t,t&&this.activateOrbitControls()}activateOrbitControls(){const t=this.camera.controls;t.minDistance=1,t.maxDistance=300;const e=new L;t.getPosition(e);const s=e.length();t.distance=s,t.truckSpeed=2;const{rotation:n}=this.camera.three,r=new L(0,0,-1).applyEuler(n),o=e.addScaledVector(r,s);t.moveTo(o.x,o.y,o.z)}},rC=class{constructor(t){E(this,"enabled",!1),E(this,"id","Plan"),E(this,"mouseAction1"),E(this,"mouseAction2"),E(this,"mouseInitialized",!1),E(this,"defaultAzimuthSpeed"),E(this,"defaultPolarSpeed"),this.camera=t,this.defaultAzimuthSpeed=t.controls.azimuthRotateSpeed,this.defaultPolarSpeed=t.controls.polarRotateSpeed}set(t){this.enabled=t;const e=this.camera.controls;e.azimuthRotateSpeed=t?0:this.defaultAzimuthSpeed,e.polarRotateSpeed=t?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=e.touches.one,this.mouseAction2=e.touches.two,this.mouseInitialized=!0),t?(e.mouseButtons.left=Xe.ACTION.TRUCK,e.touches.one=Xe.ACTION.TOUCH_TRUCK,e.touches.two=Xe.ACTION.TOUCH_ZOOM):(e.mouseButtons.left=Xe.ACTION.ROTATE,e.touches.one=this.mouseAction1,e.touches.two=this.mouseAction2)}},oC=class{constructor(t){E(this,"onChanged",new et),E(this,"current","Perspective"),E(this,"camera"),E(this,"matchOrthoDistanceEnabled",!1),E(this,"_component"),E(this,"_previousDistance",-1),this._component=t,this.camera=t.three}async set(t){this.current!==t&&(t==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const t=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(t)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const t=this.getPerspectiveDims();if(!t)return;const{width:e,height:s}=t;this.setupOrthoCamera(s,e),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const t=this._component.currentWorld;if(!t||!t.renderer)return null;const e=new L;this._component.threePersp.getWorldDirection(e);const s=new L;this._component.controls.getTarget(s);const n=s.clone().sub(this._component.threePersp.position).dot(e),r=t.renderer.getSize(),o=r.x/r.y,a=this._component.threePersp,l=n*2*Math.atan(a.fov*(Math.PI/180)/2);return{width:l*o,height:l}}setupOrthoCamera(t,e){this._component.controls.mouseButtons.wheel=Xe.ACTION.ZOOM,this._component.controls.mouseButtons.middle=Xe.ACTION.ZOOM;const s=this._component.threePersp,n=this._component.threeOrtho;n.zoom=1,n.left=e/-2,n.right=e/2,n.top=t/2,n.bottom=t/-2,n.updateProjectionMatrix(),n.position.copy(s.position),n.quaternion.copy(s.quaternion),this._component.controls.camera=n}getDistance(){const t=this._component.threePersp,e=this._component.threeOrtho;return(e.top-e.bottom)/e.zoom/(2*Math.atan(t.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=Xe.ACTION.DOLLY,this._component.controls.mouseButtons.middle=Xe.ACTION.DOLLY;const t=this._component.threePersp,e=this._component.threeOrtho;t.position.copy(e.position),t.quaternion.copy(e.quaternion),this._component.controls.mouseButtons.wheel=Xe.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),t.updateProjectionMatrix(),this._component.controls.camera=t,this.camera=t,this.current="Perspective"}},Vb=class extends ad{constructor(t){super(t),E(this,"projection"),E(this,"threeOrtho"),E(this,"threePersp"),E(this,"_userInputButtons",{}),E(this,"_frustumSize",50),E(this,"_navigationModes",new Map),E(this,"_mode",null),E(this,"previousSize",null),this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new oC(this),this.onAspectUpdated.add(()=>{this.setOrthoPerspCameraAspect()}),this.projection.onChanged.add(e=>{this.three=e,this.updateAspect()}),this.worlds.onItemSet.add(()=>{this._navigationModes.clear(),this._navigationModes.set("Orbit",new nC(this)),this._navigationModes.set("FirstPerson",new sC(this)),this._navigationModes.set("Plan",new rC(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0}),this.currentWorld&&this.currentWorld.renderer&&(this.previousSize=this.currentWorld.renderer.getSize().clone())}),this.worlds.onItemDeleted.add(()=>{this._navigationModes.clear()})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(t){if(this.mode!==null&&this.mode.id!==t){if(this.mode.set(!1),!this._navigationModes.has(t))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(t),this.mode.set(!0)}}async fit(t,e=1.5){if(!this.enabled)return;const s=Number.MAX_VALUE,n=Number.MIN_VALUE,r=new L(s,s,s),o=new L(n,n,n);for(const p of t){const m=new oe().setFromObject(p);m.min.x<r.x&&(r.x=m.min.x),m.min.y<r.y&&(r.y=m.min.y),m.min.z<r.z&&(r.z=m.min.z),m.max.x>o.x&&(o.x=m.max.x),m.max.y>o.y&&(o.y=m.max.y),m.max.z>o.z&&(o.z=m.max.z)}const a=new oe(r,o),l=this.components.get(ut);if(l.initialized)for(const[,p]of l.list){const m=p.box;m.min.x<r.x&&(r.x=m.min.x),m.min.y<r.y&&(r.y=m.min.y),m.min.z<r.z&&(r.z=m.min.z),m.max.x>o.x&&(o.x=m.max.x),m.max.y>o.y&&(o.y=m.max.y),m.max.z>o.z&&(o.z=m.max.z)}const c=new L;a.getSize(c);const h=new L;a.getCenter(h);const d=Math.max(c.x,c.y,c.z)*e,u=new Rs(h,d);await this.controls.fitToSphere(u,!0)}setUserInput(t){t?this.enableUserInput():this.disableUserInput()}addCustomNavigationMode(t){this._navigationModes.set(t.id,t)}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const t=window.innerWidth/window.innerHeight;return new bc(this._frustumSize*t/-2,this._frustumSize*t/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoPerspCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer||!this.previousSize)return;const t=this.currentWorld.renderer.getSize(),e=this.threeOrtho.top,s=this.threeOrtho.right,n=t.y/this.previousSize.y,r=t.x/this.previousSize.x,o=e*n,a=s*r;this.threeOrtho.left=-a,this.threeOrtho.right=a,this.threeOrtho.top=o,this.threeOrtho.bottom=-o,this.threeOrtho.updateProjectionMatrix(),this.previousSize.copy(t)}};function qa(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Hb={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(i,t){(function(e){i.exports=e()})(function(){return function e(s,n,r){function o(c,h){if(!n[c]){if(!s[c]){var d=typeof qa=="function"&&qa;if(!h&&d)return d(c,!0);if(a)return a(c,!0);var u=new Error("Cannot find module '"+c+"'");throw u.code="MODULE_NOT_FOUND",u}var p=n[c]={exports:{}};s[c][0].call(p.exports,function(m){var f=s[c][1][m];return o(f||m)},p,p.exports,e,s,n,r)}return n[c].exports}for(var a=typeof qa=="function"&&qa,l=0;l<r.length;l++)o(r[l]);return o}({1:[function(e,s,n){var r=e("./utils"),o=e("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(l){for(var c,h,d,u,p,m,f,b=[],g=0,y=l.length,v=y,_=r.getTypeOf(l)!=="string";g<l.length;)v=y-g,d=_?(c=l[g++],h=g<y?l[g++]:0,g<y?l[g++]:0):(c=l.charCodeAt(g++),h=g<y?l.charCodeAt(g++):0,g<y?l.charCodeAt(g++):0),u=c>>2,p=(3&c)<<4|h>>4,m=1<v?(15&h)<<2|d>>6:64,f=2<v?63&d:64,b.push(a.charAt(u)+a.charAt(p)+a.charAt(m)+a.charAt(f));return b.join("")},n.decode=function(l){var c,h,d,u,p,m,f=0,b=0,g="data:";if(l.substr(0,g.length)===g)throw new Error("Invalid base64 input, it looks like a data url.");var y,v=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&v--,l.charAt(l.length-2)===a.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(y=o.uint8array?new Uint8Array(0|v):new Array(0|v);f<l.length;)c=a.indexOf(l.charAt(f++))<<2|(u=a.indexOf(l.charAt(f++)))>>4,h=(15&u)<<4|(p=a.indexOf(l.charAt(f++)))>>2,d=(3&p)<<6|(m=a.indexOf(l.charAt(f++))),y[b++]=c,p!==64&&(y[b++]=h),m!==64&&(y[b++]=d);return y}},{"./support":30,"./utils":32}],2:[function(e,s,n){var r=e("./external"),o=e("./stream/DataWorker"),a=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function c(h,d,u,p,m){this.compressedSize=h,this.uncompressedSize=d,this.crc32=u,this.compression=p,this.compressedContent=m}c.prototype={getContentWorker:function(){var h=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return h.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(h,d,u){return h.pipe(new a).pipe(new l("uncompressedSize")).pipe(d.compressWorker(u)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},s.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,s,n){var r=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,s,n){var r=e("./utils"),o=function(){for(var a,l=[],c=0;c<256;c++){a=c;for(var h=0;h<8;h++)a=1&a?3988292384^a>>>1:a>>>1;l[c]=a}return l}();s.exports=function(a,l){return a!==void 0&&a.length?r.getTypeOf(a)!=="string"?function(c,h,d,u){var p=o,m=u+d;c^=-1;for(var f=u;f<m;f++)c=c>>>8^p[255&(c^h[f])];return-1^c}(0|l,a,a.length,0):function(c,h,d,u){var p=o,m=u+d;c^=-1;for(var f=u;f<m;f++)c=c>>>8^p[255&(c^h.charCodeAt(f))];return-1^c}(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(e,s,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,s,n){var r=null;r=typeof Promise<"u"?Promise:e("lie"),s.exports={Promise:r}},{lie:37}],7:[function(e,s,n){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=e("pako"),a=e("./utils"),l=e("./stream/GenericWorker"),c=r?"uint8array":"array";function h(d,u){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=u,this.meta={}}n.magic="\b\0",a.inherits(h,l),h.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,d.data),!1)},h.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(u){d.push({data:u,meta:d.meta})}},n.compressWorker=function(d){return new h("Deflate",d)},n.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,s,n){function r(p,m){var f,b="";for(f=0;f<m;f++)b+=String.fromCharCode(255&p),p>>>=8;return b}function o(p,m,f,b,g,y){var v,_,x=p.file,S=p.compression,k=y!==c.utf8encode,T=a.transformTo("string",y(x.name)),M=a.transformTo("string",c.utf8encode(x.name)),O=x.comment,R=a.transformTo("string",y(O)),A=a.transformTo("string",c.utf8encode(O)),$=M.length!==x.name.length,w=A.length!==O.length,z="",Y="",V="",K=x.dir,q=x.date,rt={crc32:0,compressedSize:0,uncompressedSize:0};m&&!f||(rt.crc32=p.crc32,rt.compressedSize=p.compressedSize,rt.uncompressedSize=p.uncompressedSize);var U=0;m&&(U|=8),k||!$&&!w||(U|=2048);var B=0,ot=0;K&&(B|=16),g==="UNIX"?(ot=798,B|=function(tt,dt){var yt=tt;return tt||(yt=dt?16893:33204),(65535&yt)<<16}(x.unixPermissions,K)):(ot=20,B|=function(tt){return 63&(tt||0)}(x.dosPermissions)),v=q.getUTCHours(),v<<=6,v|=q.getUTCMinutes(),v<<=5,v|=q.getUTCSeconds()/2,_=q.getUTCFullYear()-1980,_<<=4,_|=q.getUTCMonth()+1,_<<=5,_|=q.getUTCDate(),$&&(Y=r(1,1)+r(h(T),4)+M,z+="up"+r(Y.length,2)+Y),w&&(V=r(1,1)+r(h(R),4)+A,z+="uc"+r(V.length,2)+V);var J="";return J+=`
\0`,J+=r(U,2),J+=S.magic,J+=r(v,2),J+=r(_,2),J+=r(rt.crc32,4),J+=r(rt.compressedSize,4),J+=r(rt.uncompressedSize,4),J+=r(T.length,2),J+=r(z.length,2),{fileRecord:d.LOCAL_FILE_HEADER+J+T+z,dirRecord:d.CENTRAL_FILE_HEADER+r(ot,2)+J+r(R.length,2)+"\0\0\0\0"+r(B,4)+r(b,4)+T+z+R}}var a=e("../utils"),l=e("../stream/GenericWorker"),c=e("../utf8"),h=e("../crc32"),d=e("../signature");function u(p,m,f,b){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=f,this.encodeFileName=b,this.streamFiles=p,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(u,l),u.prototype.push=function(p){var m=p.meta.percent||0,f=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(p):(this.bytesWritten+=p.data.length,l.prototype.push.call(this,{data:p.data,meta:{currentFile:this.currentFile,percent:f?(m+100*(f-b-1))/f:100}}))},u.prototype.openedSource=function(p){this.currentSourceOffset=this.bytesWritten,this.currentFile=p.file.name;var m=this.streamFiles&&!p.file.dir;if(m){var f=o(p,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:f.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(p){this.accumulate=!1;var m=this.streamFiles&&!p.file.dir,f=o(p,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(f.dirRecord),m)this.push({data:function(b){return d.DATA_DESCRIPTOR+r(b.crc32,4)+r(b.compressedSize,4)+r(b.uncompressedSize,4)}(p),meta:{percent:100}});else for(this.push({data:f.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var p=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var f=this.bytesWritten-p,b=function(g,y,v,_,x){var S=a.transformTo("string",x(_));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(g,2)+r(g,2)+r(y,4)+r(v,4)+r(S.length,2)+S}(this.dirRecords.length,f,p,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(p){this._sources.push(p);var m=this;return p.on("data",function(f){m.processChunk(f)}),p.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),p.on("error",function(f){m.error(f)}),this},u.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(p){var m=this._sources;if(!l.prototype.error.call(this,p))return!1;for(var f=0;f<m.length;f++)try{m[f].error(p)}catch{}return!0},u.prototype.lock=function(){l.prototype.lock.call(this);for(var p=this._sources,m=0;m<p.length;m++)p[m].lock()},s.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,s,n){var r=e("../compressions"),o=e("./ZipFileWorker");n.generateWorker=function(a,l,c){var h=new o(l.streamFiles,c,l.platform,l.encodeFileName),d=0;try{a.forEach(function(u,p){d++;var m=function(y,v){var _=y||v,x=r[_];if(!x)throw new Error(_+" is not a valid compression method !");return x}(p.options.compression,l.compression),f=p.options.compressionOptions||l.compressionOptions||{},b=p.dir,g=p.date;p._compressWorker(m,f).withStreamInfo("file",{name:u,dir:b,date:g,comment:p.comment||"",unixPermissions:p.unixPermissions,dosPermissions:p.dosPermissions}).pipe(h)}),h.entriesCount=d}catch(u){h.error(u)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,s,n){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new r;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(r.prototype=e("./object")).loadAsync=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.version="3.10.1",r.loadAsync=function(o,a){return new r().loadAsync(o,a)},r.external=e("./external"),s.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,s,n){var r=e("./utils"),o=e("./external"),a=e("./utf8"),l=e("./zipEntries"),c=e("./stream/Crc32Probe"),h=e("./nodejsUtils");function d(u){return new o.Promise(function(p,m){var f=u.decompressed.getContentWorker().pipe(new c);f.on("error",function(b){m(b)}).on("end",function(){f.streamInfo.crc32!==u.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):p()}).resume()})}s.exports=function(u,p){var m=this;return p=r.extend(p||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),h.isNode&&h.isStream(u)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",u,!0,p.optimizedBinaryString,p.base64).then(function(f){var b=new l(p);return b.load(f),b}).then(function(f){var b=[o.Promise.resolve(f)],g=f.files;if(p.checkCRC32)for(var y=0;y<g.length;y++)b.push(d(g[y]));return o.Promise.all(b)}).then(function(f){for(var b=f.shift(),g=b.files,y=0;y<g.length;y++){var v=g[y],_=v.fileNameStr,x=r.resolve(v.fileNameStr);m.file(x,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:p.createFolders}),v.dir||(m.file(x).unsafeOriginalName=_)}return b.zipComment.length&&(m.comment=b.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,s,n){var r=e("../utils"),o=e("../stream/GenericWorker");function a(l,c){o.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}r.inherits(a,o),a.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(h){c.push({data:h,meta:{percent:0}})}).on("error",function(h){c.isPaused?this.generatedError=h:c.error(h)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,s,n){var r=e("readable-stream").Readable;function o(a,l,c){r.call(this,l),this._helper=a;var h=this;a.on("data",function(d,u){h.push(d)||h._helper.pause(),c&&c(u)}).on("error",function(d){h.emit("error",d)}).on("end",function(){h.push(null)})}e("../utils").inherits(o,r),o.prototype._read=function(){this._helper.resume()},s.exports=o},{"../utils":32,"readable-stream":16}],14:[function(e,s,n){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,o);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,o)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var o=new Buffer(r);return o.fill(0),o},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(e,s,n){function r(x,S,k){var T,M=a.getTypeOf(S),O=a.extend(k||{},h);O.date=O.date||new Date,O.compression!==null&&(O.compression=O.compression.toUpperCase()),typeof O.unixPermissions=="string"&&(O.unixPermissions=parseInt(O.unixPermissions,8)),O.unixPermissions&&16384&O.unixPermissions&&(O.dir=!0),O.dosPermissions&&16&O.dosPermissions&&(O.dir=!0),O.dir&&(x=g(x)),O.createFolders&&(T=b(x))&&y.call(this,T,!0);var R=M==="string"&&O.binary===!1&&O.base64===!1;k&&k.binary!==void 0||(O.binary=!R),(S instanceof d&&S.uncompressedSize===0||O.dir||!S||S.length===0)&&(O.base64=!1,O.binary=!0,S="",O.compression="STORE",M="string");var A=null;A=S instanceof d||S instanceof l?S:m.isNode&&m.isStream(S)?new f(x,S):a.prepareContent(x,S,O.binary,O.optimizedBinaryString,O.base64);var $=new u(x,A,O);this.files[x]=$}var o=e("./utf8"),a=e("./utils"),l=e("./stream/GenericWorker"),c=e("./stream/StreamHelper"),h=e("./defaults"),d=e("./compressedObject"),u=e("./zipObject"),p=e("./generate"),m=e("./nodejsUtils"),f=e("./nodejs/NodejsStreamInputAdapter"),b=function(x){x.slice(-1)==="/"&&(x=x.substring(0,x.length-1));var S=x.lastIndexOf("/");return 0<S?x.substring(0,S):""},g=function(x){return x.slice(-1)!=="/"&&(x+="/"),x},y=function(x,S){return S=S!==void 0?S:h.createFolders,x=g(x),this.files[x]||r.call(this,x,null,{dir:!0,createFolders:S}),this.files[x]};function v(x){return Object.prototype.toString.call(x)==="[object RegExp]"}var _={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(x){var S,k,T;for(S in this.files)T=this.files[S],(k=S.slice(this.root.length,S.length))&&S.slice(0,this.root.length)===this.root&&x(k,T)},filter:function(x){var S=[];return this.forEach(function(k,T){x(k,T)&&S.push(T)}),S},file:function(x,S,k){if(arguments.length!==1)return x=this.root+x,r.call(this,x,S,k),this;if(v(x)){var T=x;return this.filter(function(O,R){return!R.dir&&T.test(O)})}var M=this.files[this.root+x];return M&&!M.dir?M:null},folder:function(x){if(!x)return this;if(v(x))return this.filter(function(M,O){return O.dir&&x.test(M)});var S=this.root+x,k=y.call(this,S),T=this.clone();return T.root=k.name,T},remove:function(x){x=this.root+x;var S=this.files[x];if(S||(x.slice(-1)!=="/"&&(x+="/"),S=this.files[x]),S&&!S.dir)delete this.files[x];else for(var k=this.filter(function(M,O){return O.name.slice(0,x.length)===x}),T=0;T<k.length;T++)delete this.files[k[T].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(x){var S,k={};try{if((k=a.extend(x||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=k.type.toLowerCase(),k.compression=k.compression.toUpperCase(),k.type==="binarystring"&&(k.type="string"),!k.type)throw new Error("No output type specified.");a.checkSupport(k.type),k.platform!=="darwin"&&k.platform!=="freebsd"&&k.platform!=="linux"&&k.platform!=="sunos"||(k.platform="UNIX"),k.platform==="win32"&&(k.platform="DOS");var T=k.comment||this.comment||"";S=p.generateWorker(this,k,T)}catch(M){(S=new l("error")).error(M)}return new c(S,k.type||"string",k.mimeType)},generateAsync:function(x,S){return this.generateInternalStream(x).accumulate(S)},generateNodeStream:function(x,S){return(x=x||{}).type||(x.type="nodebuffer"),this.generateInternalStream(x).toNodejsStream(S)}};s.exports=_},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,s,n){s.exports=e("stream")},{stream:void 0}],17:[function(e,s,n){var r=e("./DataReader");function o(a){r.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}e("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),c=a.charCodeAt(1),h=a.charCodeAt(2),d=a.charCodeAt(3),u=this.length-4;0<=u;--u)if(this.data[u]===l&&this.data[u+1]===c&&this.data[u+2]===h&&this.data[u+3]===d)return u-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),c=a.charCodeAt(1),h=a.charCodeAt(2),d=a.charCodeAt(3),u=this.readData(4);return l===u[0]&&c===u[1]&&h===u[2]&&d===u[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./DataReader":18}],18:[function(e,s,n){var r=e("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,c=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=a,c},readString:function(a){return r.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},s.exports=o},{"../utils":32}],19:[function(e,s,n){var r=e("./Uint8ArrayReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,s,n){var r=e("./DataReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./DataReader":18}],21:[function(e,s,n){var r=e("./ArrayReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(e,s,n){var r=e("../utils"),o=e("../support"),a=e("./ArrayReader"),l=e("./StringReader"),c=e("./NodeBufferReader"),h=e("./Uint8ArrayReader");s.exports=function(d){var u=r.getTypeOf(d);return r.checkSupport(u),u!=="string"||o.uint8array?u==="nodebuffer"?new c(d):o.uint8array?new h(r.transformTo("uint8array",d)):new a(r.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,s,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,s,n){var r=e("./GenericWorker"),o=e("../utils");function a(l){r.call(this,"ConvertWorker to "+l),this.destType=l}o.inherits(a,r),a.prototype.processChunk=function(l){this.push({data:o.transformTo(this.destType,l.data),meta:l.meta})},s.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,s,n){var r=e("./GenericWorker"),o=e("../crc32");function a(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(a,r),a.prototype.processChunk=function(l){this.streamInfo.crc32=o(l.data,this.streamInfo.crc32||0),this.push(l)},s.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,s,n){var r=e("../utils"),o=e("./GenericWorker");function a(l){o.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}r.inherits(a,o),a.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}o.prototype.processChunk.call(this,l)},s.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,s,n){var r=e("../utils"),o=e("./GenericWorker");function a(l){o.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(h){c.dataIsReady=!0,c.data=h,c.max=h&&h.length||0,c.type=r.getTypeOf(h),c.isPaused||c._tickAndRepeat()},function(h){c.error(h)})}r.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(e,s,n){function r(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var l=0;l<this._listeners[o].length;l++)this._listeners[o][l].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(l){a.processChunk(l)}),o.on("end",function(){a.end()}),o.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},s.exports=r},{}],29:[function(e,s,n){var r=e("../utils"),o=e("./ConvertWorker"),a=e("./GenericWorker"),l=e("../base64"),c=e("../support"),h=e("../external"),d=null;if(c.nodestream)try{d=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function u(m,f){return new h.Promise(function(b,g){var y=[],v=m._internalType,_=m._outputType,x=m._mimeType;m.on("data",function(S,k){y.push(S),f&&f(k)}).on("error",function(S){y=[],g(S)}).on("end",function(){try{var S=function(k,T,M){switch(k){case"blob":return r.newBlob(r.transformTo("arraybuffer",T),M);case"base64":return l.encode(T);default:return r.transformTo(k,T)}}(_,function(k,T){var M,O=0,R=null,A=0;for(M=0;M<T.length;M++)A+=T[M].length;switch(k){case"string":return T.join("");case"array":return Array.prototype.concat.apply([],T);case"uint8array":for(R=new Uint8Array(A),M=0;M<T.length;M++)R.set(T[M],O),O+=T[M].length;return R;case"nodebuffer":return Buffer.concat(T);default:throw new Error("concat : unsupported type '"+k+"'")}}(v,y),x);b(S)}catch(k){g(k)}y=[]}).resume()})}function p(m,f,b){var g=f;switch(f){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string"}try{this._internalType=g,this._outputType=f,this._mimeType=b,r.checkSupport(g),this._worker=m.pipe(new o(g)),m.lock()}catch(y){this._worker=new a("error"),this._worker.error(y)}}p.prototype={accumulate:function(m){return u(this,m)},on:function(m,f){var b=this;return m==="data"?this._worker.on(m,function(g){f.call(b,g.data,g.meta)}):this._worker.on(m,function(){r.delay(f,arguments,b)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},m)}},s.exports=p},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,s,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var r=new ArrayBuffer(0);try{n.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(r),n.blob=o.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(e,s,n){for(var r=e("./utils"),o=e("./support"),a=e("./nodejsUtils"),l=e("./stream/GenericWorker"),c=new Array(256),h=0;h<256;h++)c[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;c[254]=c[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}function u(){l.call(this,"utf-8 encode")}n.utf8encode=function(p){return o.nodebuffer?a.newBufferFrom(p,"utf-8"):function(m){var f,b,g,y,v,_=m.length,x=0;for(y=0;y<_;y++)(64512&(b=m.charCodeAt(y)))==55296&&y+1<_&&(64512&(g=m.charCodeAt(y+1)))==56320&&(b=65536+(b-55296<<10)+(g-56320),y++),x+=b<128?1:b<2048?2:b<65536?3:4;for(f=o.uint8array?new Uint8Array(x):new Array(x),y=v=0;v<x;y++)(64512&(b=m.charCodeAt(y)))==55296&&y+1<_&&(64512&(g=m.charCodeAt(y+1)))==56320&&(b=65536+(b-55296<<10)+(g-56320),y++),b<128?f[v++]=b:(b<2048?f[v++]=192|b>>>6:(b<65536?f[v++]=224|b>>>12:(f[v++]=240|b>>>18,f[v++]=128|b>>>12&63),f[v++]=128|b>>>6&63),f[v++]=128|63&b);return f}(p)},n.utf8decode=function(p){return o.nodebuffer?r.transformTo("nodebuffer",p).toString("utf-8"):function(m){var f,b,g,y,v=m.length,_=new Array(2*v);for(f=b=0;f<v;)if((g=m[f++])<128)_[b++]=g;else if(4<(y=c[g]))_[b++]=65533,f+=y-1;else{for(g&=y===2?31:y===3?15:7;1<y&&f<v;)g=g<<6|63&m[f++],y--;1<y?_[b++]=65533:g<65536?_[b++]=g:(g-=65536,_[b++]=55296|g>>10&1023,_[b++]=56320|1023&g)}return _.length!==b&&(_.subarray?_=_.subarray(0,b):_.length=b),r.applyFromCharCode(_)}(p=r.transformTo(o.uint8array?"uint8array":"array",p))},r.inherits(d,l),d.prototype.processChunk=function(p){var m=r.transformTo(o.uint8array?"uint8array":"array",p.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var f=m;(m=new Uint8Array(f.length+this.leftOver.length)).set(this.leftOver,0),m.set(f,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var b=function(y,v){var _;for((v=v||y.length)>y.length&&(v=y.length),_=v-1;0<=_&&(192&y[_])==128;)_--;return _<0||_===0?v:_+c[y[_]]>v?_:v}(m),g=m;b!==m.length&&(o.uint8array?(g=m.subarray(0,b),this.leftOver=m.subarray(b,m.length)):(g=m.slice(0,b),this.leftOver=m.slice(b,m.length))),this.push({data:n.utf8decode(g),meta:p.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=d,r.inherits(u,l),u.prototype.processChunk=function(p){this.push({data:n.utf8encode(p.data),meta:p.meta})},n.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,s,n){var r=e("./support"),o=e("./base64"),a=e("./nodejsUtils"),l=e("./external");function c(f){return f}function h(f,b){for(var g=0;g<f.length;++g)b[g]=255&f.charCodeAt(g);return b}e("setimmediate"),n.newBlob=function(f,b){n.checkSupport("blob");try{return new Blob([f],{type:b})}catch{try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(f),g.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(f,b,g){var y=[],v=0,_=f.length;if(_<=g)return String.fromCharCode.apply(null,f);for(;v<_;)b==="array"||b==="nodebuffer"?y.push(String.fromCharCode.apply(null,f.slice(v,Math.min(v+g,_)))):y.push(String.fromCharCode.apply(null,f.subarray(v,Math.min(v+g,_)))),v+=g;return y.join("")},stringifyByChar:function(f){for(var b="",g=0;g<f.length;g++)b+=String.fromCharCode(f[g]);return b},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function u(f){var b=65536,g=n.getTypeOf(f),y=!0;if(g==="uint8array"?y=d.applyCanBeUsed.uint8array:g==="nodebuffer"&&(y=d.applyCanBeUsed.nodebuffer),y)for(;1<b;)try{return d.stringifyByChunk(f,g,b)}catch{b=Math.floor(b/2)}return d.stringifyByChar(f)}function p(f,b){for(var g=0;g<f.length;g++)b[g]=f[g];return b}n.applyFromCharCode=u;var m={};m.string={string:c,array:function(f){return h(f,new Array(f.length))},arraybuffer:function(f){return m.string.uint8array(f).buffer},uint8array:function(f){return h(f,new Uint8Array(f.length))},nodebuffer:function(f){return h(f,a.allocBuffer(f.length))}},m.array={string:u,array:c,arraybuffer:function(f){return new Uint8Array(f).buffer},uint8array:function(f){return new Uint8Array(f)},nodebuffer:function(f){return a.newBufferFrom(f)}},m.arraybuffer={string:function(f){return u(new Uint8Array(f))},array:function(f){return p(new Uint8Array(f),new Array(f.byteLength))},arraybuffer:c,uint8array:function(f){return new Uint8Array(f)},nodebuffer:function(f){return a.newBufferFrom(new Uint8Array(f))}},m.uint8array={string:u,array:function(f){return p(f,new Array(f.length))},arraybuffer:function(f){return f.buffer},uint8array:c,nodebuffer:function(f){return a.newBufferFrom(f)}},m.nodebuffer={string:u,array:function(f){return p(f,new Array(f.length))},arraybuffer:function(f){return m.nodebuffer.uint8array(f).buffer},uint8array:function(f){return p(f,new Uint8Array(f.length))},nodebuffer:c},n.transformTo=function(f,b){if(b=b||"",!f)return b;n.checkSupport(f);var g=n.getTypeOf(b);return m[g][f](b)},n.resolve=function(f){for(var b=f.split("/"),g=[],y=0;y<b.length;y++){var v=b[y];v==="."||v===""&&y!==0&&y!==b.length-1||(v===".."?g.pop():g.push(v))}return g.join("/")},n.getTypeOf=function(f){return typeof f=="string"?"string":Object.prototype.toString.call(f)==="[object Array]"?"array":r.nodebuffer&&a.isBuffer(f)?"nodebuffer":r.uint8array&&f instanceof Uint8Array?"uint8array":r.arraybuffer&&f instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(f){if(!r[f.toLowerCase()])throw new Error(f+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(f){var b,g,y="";for(g=0;g<(f||"").length;g++)y+="\\x"+((b=f.charCodeAt(g))<16?"0":"")+b.toString(16).toUpperCase();return y},n.delay=function(f,b,g){setImmediate(function(){f.apply(g||null,b||[])})},n.inherits=function(f,b){function g(){}g.prototype=b.prototype,f.prototype=new g},n.extend=function(){var f,b,g={};for(f=0;f<arguments.length;f++)for(b in arguments[f])Object.prototype.hasOwnProperty.call(arguments[f],b)&&g[b]===void 0&&(g[b]=arguments[f][b]);return g},n.prepareContent=function(f,b,g,y,v){return l.Promise.resolve(b).then(function(_){return r.blob&&(_ instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(_))!==-1)&&typeof FileReader<"u"?new l.Promise(function(x,S){var k=new FileReader;k.onload=function(T){x(T.target.result)},k.onerror=function(T){S(T.target.error)},k.readAsArrayBuffer(_)}):_}).then(function(_){var x=n.getTypeOf(_);return x?(x==="arraybuffer"?_=n.transformTo("uint8array",_):x==="string"&&(v?_=o.decode(_):g&&y!==!0&&(_=function(S){return h(S,r.uint8array?new Uint8Array(S.length):new Array(S.length))}(_))),_):l.Promise.reject(new Error("Can't read the data of '"+f+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,s,n){var r=e("./reader/readerFor"),o=e("./utils"),a=e("./signature"),l=e("./zipEntry"),c=e("./support");function h(d){this.files=[],this.loadOptions=d}h.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var u=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(u)+", expected "+o.pretty(d)+")")}},isSignature:function(d,u){var p=this.reader.index;this.reader.setIndex(d);var m=this.reader.readString(4)===u;return this.reader.setIndex(p),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),u=c.uint8array?"uint8array":"array",p=o.transformTo(u,d);this.zipComment=this.loadOptions.decodeFileName(p)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,u,p,m=this.zip64EndOfCentralSize-44;0<m;)d=this.reader.readInt(2),u=this.reader.readInt(4),p=this.reader.readData(u),this.zip64ExtensibleData[d]={id:d,length:u,value:p}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,u;for(d=0;d<this.files.length;d++)u=this.files[d],this.reader.setIndex(u.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),u.readLocalPart(this.reader),u.handleUTF8(),u.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var u=d;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var p=this.centralDirOffset+this.centralDirSize;this.zip64&&(p+=20,p+=12+this.zip64EndOfCentralSize);var m=u-p;if(0<m)this.isSignature(u,a.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(d){this.reader=r(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,s,n){var r=e("./reader/readerFor"),o=e("./utils"),a=e("./compressedObject"),l=e("./crc32"),c=e("./utf8"),h=e("./compressions"),d=e("./support");function u(p,m){this.options=p,this.loadOptions=m}u.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(p){var m,f;if(p.skip(22),this.fileNameLength=p.readInt(2),f=p.readInt(2),this.fileName=p.readData(this.fileNameLength),p.skip(f),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(b){for(var g in h)if(Object.prototype.hasOwnProperty.call(h,g)&&h[g].magic===b)return h[g];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,m,p.readData(this.compressedSize))},readCentralPart:function(p){this.versionMadeBy=p.readInt(2),p.skip(2),this.bitFlag=p.readInt(2),this.compressionMethod=p.readString(2),this.date=p.readDate(),this.crc32=p.readInt(4),this.compressedSize=p.readInt(4),this.uncompressedSize=p.readInt(4);var m=p.readInt(2);if(this.extraFieldsLength=p.readInt(2),this.fileCommentLength=p.readInt(2),this.diskNumberStart=p.readInt(2),this.internalFileAttributes=p.readInt(2),this.externalFileAttributes=p.readInt(4),this.localHeaderOffset=p.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");p.skip(m),this.readExtraFields(p),this.parseZIP64ExtraField(p),this.fileComment=p.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var p=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),p==0&&(this.dosPermissions=63&this.externalFileAttributes),p==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var p=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=p.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=p.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=p.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=p.readInt(4))}},readExtraFields:function(p){var m,f,b,g=p.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});p.index+4<g;)m=p.readInt(2),f=p.readInt(2),b=p.readData(f),this.extraFields[m]={id:m,length:f,value:b};p.setIndex(g)},handleUTF8:function(){var p=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var f=o.transformTo(p,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(f)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var g=o.transformTo(p,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(g)}}},findExtraFieldUnicodePath:function(){var p=this.extraFields[28789];if(p){var m=r(p.value);return m.readInt(1)!==1||l(this.fileName)!==m.readInt(4)?null:c.utf8decode(m.readData(p.length-5))}return null},findExtraFieldUnicodeComment:function(){var p=this.extraFields[25461];if(p){var m=r(p.value);return m.readInt(1)!==1||l(this.fileComment)!==m.readInt(4)?null:c.utf8decode(m.readData(p.length-5))}return null}},s.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,s,n){function r(m,f,b){this.name=m,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=f,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=e("./stream/StreamHelper"),a=e("./stream/DataWorker"),l=e("./utf8"),c=e("./compressedObject"),h=e("./stream/GenericWorker");r.prototype={internalStream:function(m){var f=null,b="string";try{if(!m)throw new Error("No output type specified.");var g=(b=m.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),f=this._decompressWorker();var y=!this._dataBinary;y&&!g&&(f=f.pipe(new l.Utf8EncodeWorker)),!y&&g&&(f=f.pipe(new l.Utf8DecodeWorker))}catch(v){(f=new h("error")).error(v)}return new o(f,b,"")},async:function(m,f){return this.internalStream(m).accumulate(f)},nodeStream:function(m,f){return this.internalStream(m||"nodebuffer").toNodejsStream(f)},_compressWorker:function(m,f){if(this._data instanceof c&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(b,m,f)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof h?this._data:new a(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<d.length;p++)r.prototype[d[p]]=u;s.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,s,n){(function(r){var o,a,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var c=0,h=new l(m),d=r.document.createTextNode("");h.observe(d,{characterData:!0}),o=function(){d.data=c=++c%2}}else if(r.setImmediate||r.MessageChannel===void 0)o="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var f=r.document.createElement("script");f.onreadystatechange=function(){m(),f.onreadystatechange=null,f.parentNode.removeChild(f),f=null},r.document.documentElement.appendChild(f)}:function(){setTimeout(m,0)};else{var u=new r.MessageChannel;u.port1.onmessage=m,o=function(){u.port2.postMessage(0)}}var p=[];function m(){var f,b;a=!0;for(var g=p.length;g;){for(b=p,p=[],f=-1;++f<g;)b[f]();g=p.length}a=!1}s.exports=function(f){p.push(f)!==1||a||o()}}).call(this,typeof ka<"u"?ka:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,s,n){var r=e("immediate");function o(){}var a={},l=["REJECTED"],c=["FULFILLED"],h=["PENDING"];function d(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,g!==o&&f(this,g)}function u(g,y,v){this.promise=g,typeof y=="function"&&(this.onFulfilled=y,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function p(g,y,v){r(function(){var _;try{_=y(v)}catch(x){return a.reject(g,x)}_===g?a.reject(g,new TypeError("Cannot resolve promise with itself")):a.resolve(g,_)})}function m(g){var y=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof y=="function")return function(){y.apply(g,arguments)}}function f(g,y){var v=!1;function _(k){v||(v=!0,a.reject(g,k))}function x(k){v||(v=!0,a.resolve(g,k))}var S=b(function(){y(x,_)});S.status==="error"&&_(S.value)}function b(g,y){var v={};try{v.value=g(y),v.status="success"}catch(_){v.status="error",v.value=_}return v}(s.exports=d).prototype.finally=function(g){if(typeof g!="function")return this;var y=this.constructor;return this.then(function(v){return y.resolve(g()).then(function(){return v})},function(v){return y.resolve(g()).then(function(){throw v})})},d.prototype.catch=function(g){return this.then(null,g)},d.prototype.then=function(g,y){if(typeof g!="function"&&this.state===c||typeof y!="function"&&this.state===l)return this;var v=new this.constructor(o);return this.state!==h?p(v,this.state===c?g:y,this.outcome):this.queue.push(new u(v,g,y)),v},u.prototype.callFulfilled=function(g){a.resolve(this.promise,g)},u.prototype.otherCallFulfilled=function(g){p(this.promise,this.onFulfilled,g)},u.prototype.callRejected=function(g){a.reject(this.promise,g)},u.prototype.otherCallRejected=function(g){p(this.promise,this.onRejected,g)},a.resolve=function(g,y){var v=b(m,y);if(v.status==="error")return a.reject(g,v.value);var _=v.value;if(_)f(g,_);else{g.state=c,g.outcome=y;for(var x=-1,S=g.queue.length;++x<S;)g.queue[x].callFulfilled(y)}return g},a.reject=function(g,y){g.state=l,g.outcome=y;for(var v=-1,_=g.queue.length;++v<_;)g.queue[v].callRejected(y);return g},d.resolve=function(g){return g instanceof this?g:a.resolve(new this(o),g)},d.reject=function(g){var y=new this(o);return a.reject(y,g)},d.all=function(g){var y=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=g.length,_=!1;if(!v)return this.resolve([]);for(var x=new Array(v),S=0,k=-1,T=new this(o);++k<v;)M(g[k],k);return T;function M(O,R){y.resolve(O).then(function(A){x[R]=A,++S!==v||_||(_=!0,a.resolve(T,x))},function(A){_||(_=!0,a.reject(T,A))})}},d.race=function(g){var y=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=g.length,_=!1;if(!v)return this.resolve([]);for(var x=-1,S=new this(o);++x<v;)k=g[x],y.resolve(k).then(function(T){_||(_=!0,a.resolve(S,T))},function(T){_||(_=!0,a.reject(S,T))});var k;return S}},{immediate:36}],38:[function(e,s,n){var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),s.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,s,n){var r=e("./zlib/deflate"),o=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/messages"),c=e("./zlib/zstream"),h=Object.prototype.toString,d=0,u=-1,p=0,m=8;function f(g){if(!(this instanceof f))return new f(g);this.options=o.assign({level:u,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},g||{});var y=this.options;y.raw&&0<y.windowBits?y.windowBits=-y.windowBits:y.gzip&&0<y.windowBits&&y.windowBits<16&&(y.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var v=r.deflateInit2(this.strm,y.level,y.method,y.windowBits,y.memLevel,y.strategy);if(v!==d)throw new Error(l[v]);if(y.header&&r.deflateSetHeader(this.strm,y.header),y.dictionary){var _;if(_=typeof y.dictionary=="string"?a.string2buf(y.dictionary):h.call(y.dictionary)==="[object ArrayBuffer]"?new Uint8Array(y.dictionary):y.dictionary,(v=r.deflateSetDictionary(this.strm,_))!==d)throw new Error(l[v]);this._dict_set=!0}}function b(g,y){var v=new f(y);if(v.push(g,!0),v.err)throw v.msg||l[v.err];return v.result}f.prototype.push=function(g,y){var v,_,x=this.strm,S=this.options.chunkSize;if(this.ended)return!1;_=y===~~y?y:y===!0?4:0,typeof g=="string"?x.input=a.string2buf(g):h.call(g)==="[object ArrayBuffer]"?x.input=new Uint8Array(g):x.input=g,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new o.Buf8(S),x.next_out=0,x.avail_out=S),(v=r.deflate(x,_))!==1&&v!==d)return this.onEnd(v),!(this.ended=!0);x.avail_out!==0&&(x.avail_in!==0||_!==4&&_!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(x.output,x.next_out))):this.onData(o.shrinkBuf(x.output,x.next_out)))}while((0<x.avail_in||x.avail_out===0)&&v!==1);return _===4?(v=r.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===d):_!==2||(this.onEnd(d),!(x.avail_out=0))},f.prototype.onData=function(g){this.chunks.push(g)},f.prototype.onEnd=function(g){g===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},n.Deflate=f,n.deflate=b,n.deflateRaw=function(g,y){return(y=y||{}).raw=!0,b(g,y)},n.gzip=function(g,y){return(y=y||{}).gzip=!0,b(g,y)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,s,n){var r=e("./zlib/inflate"),o=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),h=e("./zlib/zstream"),d=e("./zlib/gzheader"),u=Object.prototype.toString;function p(f){if(!(this instanceof p))return new p(f);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},f||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||f&&f.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var g=r.inflateInit2(this.strm,b.windowBits);if(g!==l.Z_OK)throw new Error(c[g]);this.header=new d,r.inflateGetHeader(this.strm,this.header)}function m(f,b){var g=new p(b);if(g.push(f,!0),g.err)throw g.msg||c[g.err];return g.result}p.prototype.push=function(f,b){var g,y,v,_,x,S,k=this.strm,T=this.options.chunkSize,M=this.options.dictionary,O=!1;if(this.ended)return!1;y=b===~~b?b:b===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof f=="string"?k.input=a.binstring2buf(f):u.call(f)==="[object ArrayBuffer]"?k.input=new Uint8Array(f):k.input=f,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new o.Buf8(T),k.next_out=0,k.avail_out=T),(g=r.inflate(k,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&M&&(S=typeof M=="string"?a.string2buf(M):u.call(M)==="[object ArrayBuffer]"?new Uint8Array(M):M,g=r.inflateSetDictionary(this.strm,S)),g===l.Z_BUF_ERROR&&O===!0&&(g=l.Z_OK,O=!1),g!==l.Z_STREAM_END&&g!==l.Z_OK)return this.onEnd(g),!(this.ended=!0);k.next_out&&(k.avail_out!==0&&g!==l.Z_STREAM_END&&(k.avail_in!==0||y!==l.Z_FINISH&&y!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=a.utf8border(k.output,k.next_out),_=k.next_out-v,x=a.buf2string(k.output,v),k.next_out=_,k.avail_out=T-_,_&&o.arraySet(k.output,k.output,v,_,0),this.onData(x)):this.onData(o.shrinkBuf(k.output,k.next_out)))),k.avail_in===0&&k.avail_out===0&&(O=!0)}while((0<k.avail_in||k.avail_out===0)&&g!==l.Z_STREAM_END);return g===l.Z_STREAM_END&&(y=l.Z_FINISH),y===l.Z_FINISH?(g=r.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===l.Z_OK):y!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(k.avail_out=0))},p.prototype.onData=function(f){this.chunks.push(f)},p.prototype.onEnd=function(f){f===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},n.Inflate=p,n.inflate=m,n.inflateRaw=function(f,b){return(b=b||{}).raw=!0,m(f,b)},n.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,s,n){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var h=c.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var d in h)h.hasOwnProperty(d)&&(l[d]=h[d])}}return l},n.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var o={arraySet:function(l,c,h,d,u){if(c.subarray&&l.subarray)l.set(c.subarray(h,h+d),u);else for(var p=0;p<d;p++)l[u+p]=c[h+p]},flattenChunks:function(l){var c,h,d,u,p,m;for(c=d=0,h=l.length;c<h;c++)d+=l[c].length;for(m=new Uint8Array(d),c=u=0,h=l.length;c<h;c++)p=l[c],m.set(p,u),u+=p.length;return m}},a={arraySet:function(l,c,h,d,u){for(var p=0;p<d;p++)l[u+p]=c[h+p]},flattenChunks:function(l){return[].concat.apply([],l)}};n.setTyped=function(l){l?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(r)},{}],42:[function(e,s,n){var r=e("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new r.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function h(d,u){if(u<65537&&(d.subarray&&a||!d.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(d,u));for(var p="",m=0;m<u;m++)p+=String.fromCharCode(d[m]);return p}l[254]=l[254]=1,n.string2buf=function(d){var u,p,m,f,b,g=d.length,y=0;for(f=0;f<g;f++)(64512&(p=d.charCodeAt(f)))==55296&&f+1<g&&(64512&(m=d.charCodeAt(f+1)))==56320&&(p=65536+(p-55296<<10)+(m-56320),f++),y+=p<128?1:p<2048?2:p<65536?3:4;for(u=new r.Buf8(y),f=b=0;b<y;f++)(64512&(p=d.charCodeAt(f)))==55296&&f+1<g&&(64512&(m=d.charCodeAt(f+1)))==56320&&(p=65536+(p-55296<<10)+(m-56320),f++),p<128?u[b++]=p:(p<2048?u[b++]=192|p>>>6:(p<65536?u[b++]=224|p>>>12:(u[b++]=240|p>>>18,u[b++]=128|p>>>12&63),u[b++]=128|p>>>6&63),u[b++]=128|63&p);return u},n.buf2binstring=function(d){return h(d,d.length)},n.binstring2buf=function(d){for(var u=new r.Buf8(d.length),p=0,m=u.length;p<m;p++)u[p]=d.charCodeAt(p);return u},n.buf2string=function(d,u){var p,m,f,b,g=u||d.length,y=new Array(2*g);for(p=m=0;p<g;)if((f=d[p++])<128)y[m++]=f;else if(4<(b=l[f]))y[m++]=65533,p+=b-1;else{for(f&=b===2?31:b===3?15:7;1<b&&p<g;)f=f<<6|63&d[p++],b--;1<b?y[m++]=65533:f<65536?y[m++]=f:(f-=65536,y[m++]=55296|f>>10&1023,y[m++]=56320|1023&f)}return h(y,m)},n.utf8border=function(d,u){var p;for((u=u||d.length)>d.length&&(u=d.length),p=u-1;0<=p&&(192&d[p])==128;)p--;return p<0||p===0?u:p+l[d[p]]>u?p:u}},{"./common":41}],43:[function(e,s,n){s.exports=function(r,o,a,l){for(var c=65535&r|0,h=r>>>16&65535|0,d=0;a!==0;){for(a-=d=2e3<a?2e3:a;h=h+(c=c+o[l++]|0)|0,--d;);c%=65521,h%=65521}return c|h<<16|0}},{}],44:[function(e,s,n){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,s,n){var r=function(){for(var o,a=[],l=0;l<256;l++){o=l;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;a[l]=o}return a}();s.exports=function(o,a,l,c){var h=r,d=c+l;o^=-1;for(var u=c;u<d;u++)o=o>>>8^h[255&(o^a[u])];return-1^o}},{}],46:[function(e,s,n){var r,o=e("../utils/common"),a=e("./trees"),l=e("./adler32"),c=e("./crc32"),h=e("./messages"),d=0,u=4,p=0,m=-2,f=-1,b=4,g=2,y=8,v=9,_=286,x=30,S=19,k=2*_+1,T=15,M=3,O=258,R=O+M+1,A=42,$=113,w=1,z=2,Y=3,V=4;function K(C,G){return C.msg=h[G],G}function q(C){return(C<<1)-(4<C?9:0)}function rt(C){for(var G=C.length;0<=--G;)C[G]=0}function U(C){var G=C.state,Z=G.pending;Z>C.avail_out&&(Z=C.avail_out),Z!==0&&(o.arraySet(C.output,G.pending_buf,G.pending_out,Z,C.next_out),C.next_out+=Z,G.pending_out+=Z,C.total_out+=Z,C.avail_out-=Z,G.pending-=Z,G.pending===0&&(G.pending_out=0))}function B(C,G){a._tr_flush_block(C,0<=C.block_start?C.block_start:-1,C.strstart-C.block_start,G),C.block_start=C.strstart,U(C.strm)}function ot(C,G){C.pending_buf[C.pending++]=G}function J(C,G){C.pending_buf[C.pending++]=G>>>8&255,C.pending_buf[C.pending++]=255&G}function tt(C,G){var Z,I,D=C.max_chain_length,N=C.strstart,X=C.prev_length,Q=C.nice_match,H=C.strstart>C.w_size-R?C.strstart-(C.w_size-R):0,st=C.window,lt=C.w_mask,nt=C.prev,ht=C.strstart+O,Nt=st[N+X-1],xt=st[N+X];C.prev_length>=C.good_match&&(D>>=2),Q>C.lookahead&&(Q=C.lookahead);do if(st[(Z=G)+X]===xt&&st[Z+X-1]===Nt&&st[Z]===st[N]&&st[++Z]===st[N+1]){N+=2,Z++;do;while(st[++N]===st[++Z]&&st[++N]===st[++Z]&&st[++N]===st[++Z]&&st[++N]===st[++Z]&&st[++N]===st[++Z]&&st[++N]===st[++Z]&&st[++N]===st[++Z]&&st[++N]===st[++Z]&&N<ht);if(I=O-(ht-N),N=ht-O,X<I){if(C.match_start=G,Q<=(X=I))break;Nt=st[N+X-1],xt=st[N+X]}}while((G=nt[G&lt])>H&&--D!=0);return X<=C.lookahead?X:C.lookahead}function dt(C){var G,Z,I,D,N,X,Q,H,st,lt,nt=C.w_size;do{if(D=C.window_size-C.lookahead-C.strstart,C.strstart>=nt+(nt-R)){for(o.arraySet(C.window,C.window,nt,nt,0),C.match_start-=nt,C.strstart-=nt,C.block_start-=nt,G=Z=C.hash_size;I=C.head[--G],C.head[G]=nt<=I?I-nt:0,--Z;);for(G=Z=nt;I=C.prev[--G],C.prev[G]=nt<=I?I-nt:0,--Z;);D+=nt}if(C.strm.avail_in===0)break;if(X=C.strm,Q=C.window,H=C.strstart+C.lookahead,st=D,lt=void 0,lt=X.avail_in,st<lt&&(lt=st),Z=lt===0?0:(X.avail_in-=lt,o.arraySet(Q,X.input,X.next_in,lt,H),X.state.wrap===1?X.adler=l(X.adler,Q,lt,H):X.state.wrap===2&&(X.adler=c(X.adler,Q,lt,H)),X.next_in+=lt,X.total_in+=lt,lt),C.lookahead+=Z,C.lookahead+C.insert>=M)for(N=C.strstart-C.insert,C.ins_h=C.window[N],C.ins_h=(C.ins_h<<C.hash_shift^C.window[N+1])&C.hash_mask;C.insert&&(C.ins_h=(C.ins_h<<C.hash_shift^C.window[N+M-1])&C.hash_mask,C.prev[N&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=N,N++,C.insert--,!(C.lookahead+C.insert<M)););}while(C.lookahead<R&&C.strm.avail_in!==0)}function yt(C,G){for(var Z,I;;){if(C.lookahead<R){if(dt(C),C.lookahead<R&&G===d)return w;if(C.lookahead===0)break}if(Z=0,C.lookahead>=M&&(C.ins_h=(C.ins_h<<C.hash_shift^C.window[C.strstart+M-1])&C.hash_mask,Z=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart),Z!==0&&C.strstart-Z<=C.w_size-R&&(C.match_length=tt(C,Z)),C.match_length>=M)if(I=a._tr_tally(C,C.strstart-C.match_start,C.match_length-M),C.lookahead-=C.match_length,C.match_length<=C.max_lazy_match&&C.lookahead>=M){for(C.match_length--;C.strstart++,C.ins_h=(C.ins_h<<C.hash_shift^C.window[C.strstart+M-1])&C.hash_mask,Z=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart,--C.match_length!=0;);C.strstart++}else C.strstart+=C.match_length,C.match_length=0,C.ins_h=C.window[C.strstart],C.ins_h=(C.ins_h<<C.hash_shift^C.window[C.strstart+1])&C.hash_mask;else I=a._tr_tally(C,0,C.window[C.strstart]),C.lookahead--,C.strstart++;if(I&&(B(C,!1),C.strm.avail_out===0))return w}return C.insert=C.strstart<M-1?C.strstart:M-1,G===u?(B(C,!0),C.strm.avail_out===0?Y:V):C.last_lit&&(B(C,!1),C.strm.avail_out===0)?w:z}function pt(C,G){for(var Z,I,D;;){if(C.lookahead<R){if(dt(C),C.lookahead<R&&G===d)return w;if(C.lookahead===0)break}if(Z=0,C.lookahead>=M&&(C.ins_h=(C.ins_h<<C.hash_shift^C.window[C.strstart+M-1])&C.hash_mask,Z=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart),C.prev_length=C.match_length,C.prev_match=C.match_start,C.match_length=M-1,Z!==0&&C.prev_length<C.max_lazy_match&&C.strstart-Z<=C.w_size-R&&(C.match_length=tt(C,Z),C.match_length<=5&&(C.strategy===1||C.match_length===M&&4096<C.strstart-C.match_start)&&(C.match_length=M-1)),C.prev_length>=M&&C.match_length<=C.prev_length){for(D=C.strstart+C.lookahead-M,I=a._tr_tally(C,C.strstart-1-C.prev_match,C.prev_length-M),C.lookahead-=C.prev_length-1,C.prev_length-=2;++C.strstart<=D&&(C.ins_h=(C.ins_h<<C.hash_shift^C.window[C.strstart+M-1])&C.hash_mask,Z=C.prev[C.strstart&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=C.strstart),--C.prev_length!=0;);if(C.match_available=0,C.match_length=M-1,C.strstart++,I&&(B(C,!1),C.strm.avail_out===0))return w}else if(C.match_available){if((I=a._tr_tally(C,0,C.window[C.strstart-1]))&&B(C,!1),C.strstart++,C.lookahead--,C.strm.avail_out===0)return w}else C.match_available=1,C.strstart++,C.lookahead--}return C.match_available&&(I=a._tr_tally(C,0,C.window[C.strstart-1]),C.match_available=0),C.insert=C.strstart<M-1?C.strstart:M-1,G===u?(B(C,!0),C.strm.avail_out===0?Y:V):C.last_lit&&(B(C,!1),C.strm.avail_out===0)?w:z}function vt(C,G,Z,I,D){this.good_length=C,this.max_lazy=G,this.nice_length=Z,this.max_chain=I,this.func=D}function Ot(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*k),this.dyn_dtree=new o.Buf16(2*(2*x+1)),this.bl_tree=new o.Buf16(2*(2*S+1)),rt(this.dyn_ltree),rt(this.dyn_dtree),rt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(T+1),this.heap=new o.Buf16(2*_+1),rt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*_+1),rt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Bt(C){var G;return C&&C.state?(C.total_in=C.total_out=0,C.data_type=g,(G=C.state).pending=0,G.pending_out=0,G.wrap<0&&(G.wrap=-G.wrap),G.status=G.wrap?A:$,C.adler=G.wrap===2?0:1,G.last_flush=d,a._tr_init(G),p):K(C,m)}function De(C){var G=Bt(C);return G===p&&function(Z){Z.window_size=2*Z.w_size,rt(Z.head),Z.max_lazy_match=r[Z.level].max_lazy,Z.good_match=r[Z.level].good_length,Z.nice_match=r[Z.level].nice_length,Z.max_chain_length=r[Z.level].max_chain,Z.strstart=0,Z.block_start=0,Z.lookahead=0,Z.insert=0,Z.match_length=Z.prev_length=M-1,Z.match_available=0,Z.ins_h=0}(C.state),G}function ge(C,G,Z,I,D,N){if(!C)return m;var X=1;if(G===f&&(G=6),I<0?(X=0,I=-I):15<I&&(X=2,I-=16),D<1||v<D||Z!==y||I<8||15<I||G<0||9<G||N<0||b<N)return K(C,m);I===8&&(I=9);var Q=new Ot;return(C.state=Q).strm=C,Q.wrap=X,Q.gzhead=null,Q.w_bits=I,Q.w_size=1<<Q.w_bits,Q.w_mask=Q.w_size-1,Q.hash_bits=D+7,Q.hash_size=1<<Q.hash_bits,Q.hash_mask=Q.hash_size-1,Q.hash_shift=~~((Q.hash_bits+M-1)/M),Q.window=new o.Buf8(2*Q.w_size),Q.head=new o.Buf16(Q.hash_size),Q.prev=new o.Buf16(Q.w_size),Q.lit_bufsize=1<<D+6,Q.pending_buf_size=4*Q.lit_bufsize,Q.pending_buf=new o.Buf8(Q.pending_buf_size),Q.d_buf=1*Q.lit_bufsize,Q.l_buf=3*Q.lit_bufsize,Q.level=G,Q.strategy=N,Q.method=Z,De(C)}r=[new vt(0,0,0,0,function(C,G){var Z=65535;for(Z>C.pending_buf_size-5&&(Z=C.pending_buf_size-5);;){if(C.lookahead<=1){if(dt(C),C.lookahead===0&&G===d)return w;if(C.lookahead===0)break}C.strstart+=C.lookahead,C.lookahead=0;var I=C.block_start+Z;if((C.strstart===0||C.strstart>=I)&&(C.lookahead=C.strstart-I,C.strstart=I,B(C,!1),C.strm.avail_out===0)||C.strstart-C.block_start>=C.w_size-R&&(B(C,!1),C.strm.avail_out===0))return w}return C.insert=0,G===u?(B(C,!0),C.strm.avail_out===0?Y:V):(C.strstart>C.block_start&&(B(C,!1),C.strm.avail_out),w)}),new vt(4,4,8,4,yt),new vt(4,5,16,8,yt),new vt(4,6,32,32,yt),new vt(4,4,16,16,pt),new vt(8,16,32,32,pt),new vt(8,16,128,128,pt),new vt(8,32,128,256,pt),new vt(32,128,258,1024,pt),new vt(32,258,258,4096,pt)],n.deflateInit=function(C,G){return ge(C,G,y,15,8,0)},n.deflateInit2=ge,n.deflateReset=De,n.deflateResetKeep=Bt,n.deflateSetHeader=function(C,G){return C&&C.state?C.state.wrap!==2?m:(C.state.gzhead=G,p):m},n.deflate=function(C,G){var Z,I,D,N;if(!C||!C.state||5<G||G<0)return C?K(C,m):m;if(I=C.state,!C.output||!C.input&&C.avail_in!==0||I.status===666&&G!==u)return K(C,C.avail_out===0?-5:m);if(I.strm=C,Z=I.last_flush,I.last_flush=G,I.status===A)if(I.wrap===2)C.adler=0,ot(I,31),ot(I,139),ot(I,8),I.gzhead?(ot(I,(I.gzhead.text?1:0)+(I.gzhead.hcrc?2:0)+(I.gzhead.extra?4:0)+(I.gzhead.name?8:0)+(I.gzhead.comment?16:0)),ot(I,255&I.gzhead.time),ot(I,I.gzhead.time>>8&255),ot(I,I.gzhead.time>>16&255),ot(I,I.gzhead.time>>24&255),ot(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),ot(I,255&I.gzhead.os),I.gzhead.extra&&I.gzhead.extra.length&&(ot(I,255&I.gzhead.extra.length),ot(I,I.gzhead.extra.length>>8&255)),I.gzhead.hcrc&&(C.adler=c(C.adler,I.pending_buf,I.pending,0)),I.gzindex=0,I.status=69):(ot(I,0),ot(I,0),ot(I,0),ot(I,0),ot(I,0),ot(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),ot(I,3),I.status=$);else{var X=y+(I.w_bits-8<<4)<<8;X|=(2<=I.strategy||I.level<2?0:I.level<6?1:I.level===6?2:3)<<6,I.strstart!==0&&(X|=32),X+=31-X%31,I.status=$,J(I,X),I.strstart!==0&&(J(I,C.adler>>>16),J(I,65535&C.adler)),C.adler=1}if(I.status===69)if(I.gzhead.extra){for(D=I.pending;I.gzindex<(65535&I.gzhead.extra.length)&&(I.pending!==I.pending_buf_size||(I.gzhead.hcrc&&I.pending>D&&(C.adler=c(C.adler,I.pending_buf,I.pending-D,D)),U(C),D=I.pending,I.pending!==I.pending_buf_size));)ot(I,255&I.gzhead.extra[I.gzindex]),I.gzindex++;I.gzhead.hcrc&&I.pending>D&&(C.adler=c(C.adler,I.pending_buf,I.pending-D,D)),I.gzindex===I.gzhead.extra.length&&(I.gzindex=0,I.status=73)}else I.status=73;if(I.status===73)if(I.gzhead.name){D=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>D&&(C.adler=c(C.adler,I.pending_buf,I.pending-D,D)),U(C),D=I.pending,I.pending===I.pending_buf_size)){N=1;break}N=I.gzindex<I.gzhead.name.length?255&I.gzhead.name.charCodeAt(I.gzindex++):0,ot(I,N)}while(N!==0);I.gzhead.hcrc&&I.pending>D&&(C.adler=c(C.adler,I.pending_buf,I.pending-D,D)),N===0&&(I.gzindex=0,I.status=91)}else I.status=91;if(I.status===91)if(I.gzhead.comment){D=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>D&&(C.adler=c(C.adler,I.pending_buf,I.pending-D,D)),U(C),D=I.pending,I.pending===I.pending_buf_size)){N=1;break}N=I.gzindex<I.gzhead.comment.length?255&I.gzhead.comment.charCodeAt(I.gzindex++):0,ot(I,N)}while(N!==0);I.gzhead.hcrc&&I.pending>D&&(C.adler=c(C.adler,I.pending_buf,I.pending-D,D)),N===0&&(I.status=103)}else I.status=103;if(I.status===103&&(I.gzhead.hcrc?(I.pending+2>I.pending_buf_size&&U(C),I.pending+2<=I.pending_buf_size&&(ot(I,255&C.adler),ot(I,C.adler>>8&255),C.adler=0,I.status=$)):I.status=$),I.pending!==0){if(U(C),C.avail_out===0)return I.last_flush=-1,p}else if(C.avail_in===0&&q(G)<=q(Z)&&G!==u)return K(C,-5);if(I.status===666&&C.avail_in!==0)return K(C,-5);if(C.avail_in!==0||I.lookahead!==0||G!==d&&I.status!==666){var Q=I.strategy===2?function(H,st){for(var lt;;){if(H.lookahead===0&&(dt(H),H.lookahead===0)){if(st===d)return w;break}if(H.match_length=0,lt=a._tr_tally(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++,lt&&(B(H,!1),H.strm.avail_out===0))return w}return H.insert=0,st===u?(B(H,!0),H.strm.avail_out===0?Y:V):H.last_lit&&(B(H,!1),H.strm.avail_out===0)?w:z}(I,G):I.strategy===3?function(H,st){for(var lt,nt,ht,Nt,xt=H.window;;){if(H.lookahead<=O){if(dt(H),H.lookahead<=O&&st===d)return w;if(H.lookahead===0)break}if(H.match_length=0,H.lookahead>=M&&0<H.strstart&&(nt=xt[ht=H.strstart-1])===xt[++ht]&&nt===xt[++ht]&&nt===xt[++ht]){Nt=H.strstart+O;do;while(nt===xt[++ht]&&nt===xt[++ht]&&nt===xt[++ht]&&nt===xt[++ht]&&nt===xt[++ht]&&nt===xt[++ht]&&nt===xt[++ht]&&nt===xt[++ht]&&ht<Nt);H.match_length=O-(Nt-ht),H.match_length>H.lookahead&&(H.match_length=H.lookahead)}if(H.match_length>=M?(lt=a._tr_tally(H,1,H.match_length-M),H.lookahead-=H.match_length,H.strstart+=H.match_length,H.match_length=0):(lt=a._tr_tally(H,0,H.window[H.strstart]),H.lookahead--,H.strstart++),lt&&(B(H,!1),H.strm.avail_out===0))return w}return H.insert=0,st===u?(B(H,!0),H.strm.avail_out===0?Y:V):H.last_lit&&(B(H,!1),H.strm.avail_out===0)?w:z}(I,G):r[I.level].func(I,G);if(Q!==Y&&Q!==V||(I.status=666),Q===w||Q===Y)return C.avail_out===0&&(I.last_flush=-1),p;if(Q===z&&(G===1?a._tr_align(I):G!==5&&(a._tr_stored_block(I,0,0,!1),G===3&&(rt(I.head),I.lookahead===0&&(I.strstart=0,I.block_start=0,I.insert=0))),U(C),C.avail_out===0))return I.last_flush=-1,p}return G!==u?p:I.wrap<=0?1:(I.wrap===2?(ot(I,255&C.adler),ot(I,C.adler>>8&255),ot(I,C.adler>>16&255),ot(I,C.adler>>24&255),ot(I,255&C.total_in),ot(I,C.total_in>>8&255),ot(I,C.total_in>>16&255),ot(I,C.total_in>>24&255)):(J(I,C.adler>>>16),J(I,65535&C.adler)),U(C),0<I.wrap&&(I.wrap=-I.wrap),I.pending!==0?p:1)},n.deflateEnd=function(C){var G;return C&&C.state?(G=C.state.status)!==A&&G!==69&&G!==73&&G!==91&&G!==103&&G!==$&&G!==666?K(C,m):(C.state=null,G===$?K(C,-3):p):m},n.deflateSetDictionary=function(C,G){var Z,I,D,N,X,Q,H,st,lt=G.length;if(!C||!C.state||(N=(Z=C.state).wrap)===2||N===1&&Z.status!==A||Z.lookahead)return m;for(N===1&&(C.adler=l(C.adler,G,lt,0)),Z.wrap=0,lt>=Z.w_size&&(N===0&&(rt(Z.head),Z.strstart=0,Z.block_start=0,Z.insert=0),st=new o.Buf8(Z.w_size),o.arraySet(st,G,lt-Z.w_size,Z.w_size,0),G=st,lt=Z.w_size),X=C.avail_in,Q=C.next_in,H=C.input,C.avail_in=lt,C.next_in=0,C.input=G,dt(Z);Z.lookahead>=M;){for(I=Z.strstart,D=Z.lookahead-(M-1);Z.ins_h=(Z.ins_h<<Z.hash_shift^Z.window[I+M-1])&Z.hash_mask,Z.prev[I&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=I,I++,--D;);Z.strstart=I,Z.lookahead=M-1,dt(Z)}return Z.strstart+=Z.lookahead,Z.block_start=Z.strstart,Z.insert=Z.lookahead,Z.lookahead=0,Z.match_length=Z.prev_length=M-1,Z.match_available=0,C.next_in=Q,C.input=H,C.avail_in=X,Z.wrap=N,p},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,s,n){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,s,n){s.exports=function(r,o){var a,l,c,h,d,u,p,m,f,b,g,y,v,_,x,S,k,T,M,O,R,A,$,w,z;a=r.state,l=r.next_in,w=r.input,c=l+(r.avail_in-5),h=r.next_out,z=r.output,d=h-(o-r.avail_out),u=h+(r.avail_out-257),p=a.dmax,m=a.wsize,f=a.whave,b=a.wnext,g=a.window,y=a.hold,v=a.bits,_=a.lencode,x=a.distcode,S=(1<<a.lenbits)-1,k=(1<<a.distbits)-1;t:do{v<15&&(y+=w[l++]<<v,v+=8,y+=w[l++]<<v,v+=8),T=_[y&S];e:for(;;){if(y>>>=M=T>>>24,v-=M,(M=T>>>16&255)===0)z[h++]=65535&T;else{if(!(16&M)){if(!(64&M)){T=_[(65535&T)+(y&(1<<M)-1)];continue e}if(32&M){a.mode=12;break t}r.msg="invalid literal/length code",a.mode=30;break t}O=65535&T,(M&=15)&&(v<M&&(y+=w[l++]<<v,v+=8),O+=y&(1<<M)-1,y>>>=M,v-=M),v<15&&(y+=w[l++]<<v,v+=8,y+=w[l++]<<v,v+=8),T=x[y&k];i:for(;;){if(y>>>=M=T>>>24,v-=M,!(16&(M=T>>>16&255))){if(!(64&M)){T=x[(65535&T)+(y&(1<<M)-1)];continue i}r.msg="invalid distance code",a.mode=30;break t}if(R=65535&T,v<(M&=15)&&(y+=w[l++]<<v,(v+=8)<M&&(y+=w[l++]<<v,v+=8)),p<(R+=y&(1<<M)-1)){r.msg="invalid distance too far back",a.mode=30;break t}if(y>>>=M,v-=M,(M=h-d)<R){if(f<(M=R-M)&&a.sane){r.msg="invalid distance too far back",a.mode=30;break t}if($=g,(A=0)===b){if(A+=m-M,M<O){for(O-=M;z[h++]=g[A++],--M;);A=h-R,$=z}}else if(b<M){if(A+=m+b-M,(M-=b)<O){for(O-=M;z[h++]=g[A++],--M;);if(A=0,b<O){for(O-=M=b;z[h++]=g[A++],--M;);A=h-R,$=z}}}else if(A+=b-M,M<O){for(O-=M;z[h++]=g[A++],--M;);A=h-R,$=z}for(;2<O;)z[h++]=$[A++],z[h++]=$[A++],z[h++]=$[A++],O-=3;O&&(z[h++]=$[A++],1<O&&(z[h++]=$[A++]))}else{for(A=h-R;z[h++]=z[A++],z[h++]=z[A++],z[h++]=z[A++],2<(O-=3););O&&(z[h++]=z[A++],1<O&&(z[h++]=z[A++]))}break}}break}}while(l<c&&h<u);l-=O=v>>3,y&=(1<<(v-=O<<3))-1,r.next_in=l,r.next_out=h,r.avail_in=l<c?c-l+5:5-(l-c),r.avail_out=h<u?u-h+257:257-(h-u),a.hold=y,a.bits=v}},{}],49:[function(e,s,n){var r=e("../utils/common"),o=e("./adler32"),a=e("./crc32"),l=e("./inffast"),c=e("./inftrees"),h=1,d=2,u=0,p=-2,m=1,f=852,b=592;function g(A){return(A>>>24&255)+(A>>>8&65280)+((65280&A)<<8)+((255&A)<<24)}function y(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(A){var $;return A&&A.state?($=A.state,A.total_in=A.total_out=$.total=0,A.msg="",$.wrap&&(A.adler=1&$.wrap),$.mode=m,$.last=0,$.havedict=0,$.dmax=32768,$.head=null,$.hold=0,$.bits=0,$.lencode=$.lendyn=new r.Buf32(f),$.distcode=$.distdyn=new r.Buf32(b),$.sane=1,$.back=-1,u):p}function _(A){var $;return A&&A.state?(($=A.state).wsize=0,$.whave=0,$.wnext=0,v(A)):p}function x(A,$){var w,z;return A&&A.state?(z=A.state,$<0?(w=0,$=-$):(w=1+($>>4),$<48&&($&=15)),$&&($<8||15<$)?p:(z.window!==null&&z.wbits!==$&&(z.window=null),z.wrap=w,z.wbits=$,_(A))):p}function S(A,$){var w,z;return A?(z=new y,(A.state=z).window=null,(w=x(A,$))!==u&&(A.state=null),w):p}var k,T,M=!0;function O(A){if(M){var $;for(k=new r.Buf32(512),T=new r.Buf32(32),$=0;$<144;)A.lens[$++]=8;for(;$<256;)A.lens[$++]=9;for(;$<280;)A.lens[$++]=7;for(;$<288;)A.lens[$++]=8;for(c(h,A.lens,0,288,k,0,A.work,{bits:9}),$=0;$<32;)A.lens[$++]=5;c(d,A.lens,0,32,T,0,A.work,{bits:5}),M=!1}A.lencode=k,A.lenbits=9,A.distcode=T,A.distbits=5}function R(A,$,w,z){var Y,V=A.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new r.Buf8(V.wsize)),z>=V.wsize?(r.arraySet(V.window,$,w-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(z<(Y=V.wsize-V.wnext)&&(Y=z),r.arraySet(V.window,$,w-z,Y,V.wnext),(z-=Y)?(r.arraySet(V.window,$,w-z,z,0),V.wnext=z,V.whave=V.wsize):(V.wnext+=Y,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=Y))),0}n.inflateReset=_,n.inflateReset2=x,n.inflateResetKeep=v,n.inflateInit=function(A){return S(A,15)},n.inflateInit2=S,n.inflate=function(A,$){var w,z,Y,V,K,q,rt,U,B,ot,J,tt,dt,yt,pt,vt,Ot,Bt,De,ge,C,G,Z,I,D=0,N=new r.Buf8(4),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!A||!A.state||!A.output||!A.input&&A.avail_in!==0)return p;(w=A.state).mode===12&&(w.mode=13),K=A.next_out,Y=A.output,rt=A.avail_out,V=A.next_in,z=A.input,q=A.avail_in,U=w.hold,B=w.bits,ot=q,J=rt,G=u;t:for(;;)switch(w.mode){case m:if(w.wrap===0){w.mode=13;break}for(;B<16;){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}if(2&w.wrap&&U===35615){N[w.check=0]=255&U,N[1]=U>>>8&255,w.check=a(w.check,N,2,0),B=U=0,w.mode=2;break}if(w.flags=0,w.head&&(w.head.done=!1),!(1&w.wrap)||(((255&U)<<8)+(U>>8))%31){A.msg="incorrect header check",w.mode=30;break}if((15&U)!=8){A.msg="unknown compression method",w.mode=30;break}if(B-=4,C=8+(15&(U>>>=4)),w.wbits===0)w.wbits=C;else if(C>w.wbits){A.msg="invalid window size",w.mode=30;break}w.dmax=1<<C,A.adler=w.check=1,w.mode=512&U?10:12,B=U=0;break;case 2:for(;B<16;){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}if(w.flags=U,(255&w.flags)!=8){A.msg="unknown compression method",w.mode=30;break}if(57344&w.flags){A.msg="unknown header flags set",w.mode=30;break}w.head&&(w.head.text=U>>8&1),512&w.flags&&(N[0]=255&U,N[1]=U>>>8&255,w.check=a(w.check,N,2,0)),B=U=0,w.mode=3;case 3:for(;B<32;){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}w.head&&(w.head.time=U),512&w.flags&&(N[0]=255&U,N[1]=U>>>8&255,N[2]=U>>>16&255,N[3]=U>>>24&255,w.check=a(w.check,N,4,0)),B=U=0,w.mode=4;case 4:for(;B<16;){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}w.head&&(w.head.xflags=255&U,w.head.os=U>>8),512&w.flags&&(N[0]=255&U,N[1]=U>>>8&255,w.check=a(w.check,N,2,0)),B=U=0,w.mode=5;case 5:if(1024&w.flags){for(;B<16;){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}w.length=U,w.head&&(w.head.extra_len=U),512&w.flags&&(N[0]=255&U,N[1]=U>>>8&255,w.check=a(w.check,N,2,0)),B=U=0}else w.head&&(w.head.extra=null);w.mode=6;case 6:if(1024&w.flags&&(q<(tt=w.length)&&(tt=q),tt&&(w.head&&(C=w.head.extra_len-w.length,w.head.extra||(w.head.extra=new Array(w.head.extra_len)),r.arraySet(w.head.extra,z,V,tt,C)),512&w.flags&&(w.check=a(w.check,z,tt,V)),q-=tt,V+=tt,w.length-=tt),w.length))break t;w.length=0,w.mode=7;case 7:if(2048&w.flags){if(q===0)break t;for(tt=0;C=z[V+tt++],w.head&&C&&w.length<65536&&(w.head.name+=String.fromCharCode(C)),C&&tt<q;);if(512&w.flags&&(w.check=a(w.check,z,tt,V)),q-=tt,V+=tt,C)break t}else w.head&&(w.head.name=null);w.length=0,w.mode=8;case 8:if(4096&w.flags){if(q===0)break t;for(tt=0;C=z[V+tt++],w.head&&C&&w.length<65536&&(w.head.comment+=String.fromCharCode(C)),C&&tt<q;);if(512&w.flags&&(w.check=a(w.check,z,tt,V)),q-=tt,V+=tt,C)break t}else w.head&&(w.head.comment=null);w.mode=9;case 9:if(512&w.flags){for(;B<16;){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}if(U!==(65535&w.check)){A.msg="header crc mismatch",w.mode=30;break}B=U=0}w.head&&(w.head.hcrc=w.flags>>9&1,w.head.done=!0),A.adler=w.check=0,w.mode=12;break;case 10:for(;B<32;){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}A.adler=w.check=g(U),B=U=0,w.mode=11;case 11:if(w.havedict===0)return A.next_out=K,A.avail_out=rt,A.next_in=V,A.avail_in=q,w.hold=U,w.bits=B,2;A.adler=w.check=1,w.mode=12;case 12:if($===5||$===6)break t;case 13:if(w.last){U>>>=7&B,B-=7&B,w.mode=27;break}for(;B<3;){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}switch(w.last=1&U,B-=1,3&(U>>>=1)){case 0:w.mode=14;break;case 1:if(O(w),w.mode=20,$!==6)break;U>>>=2,B-=2;break t;case 2:w.mode=17;break;case 3:A.msg="invalid block type",w.mode=30}U>>>=2,B-=2;break;case 14:for(U>>>=7&B,B-=7&B;B<32;){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}if((65535&U)!=(U>>>16^65535)){A.msg="invalid stored block lengths",w.mode=30;break}if(w.length=65535&U,B=U=0,w.mode=15,$===6)break t;case 15:w.mode=16;case 16:if(tt=w.length){if(q<tt&&(tt=q),rt<tt&&(tt=rt),tt===0)break t;r.arraySet(Y,z,V,tt,K),q-=tt,V+=tt,rt-=tt,K+=tt,w.length-=tt;break}w.mode=12;break;case 17:for(;B<14;){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}if(w.nlen=257+(31&U),U>>>=5,B-=5,w.ndist=1+(31&U),U>>>=5,B-=5,w.ncode=4+(15&U),U>>>=4,B-=4,286<w.nlen||30<w.ndist){A.msg="too many length or distance symbols",w.mode=30;break}w.have=0,w.mode=18;case 18:for(;w.have<w.ncode;){for(;B<3;){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}w.lens[X[w.have++]]=7&U,U>>>=3,B-=3}for(;w.have<19;)w.lens[X[w.have++]]=0;if(w.lencode=w.lendyn,w.lenbits=7,Z={bits:w.lenbits},G=c(0,w.lens,0,19,w.lencode,0,w.work,Z),w.lenbits=Z.bits,G){A.msg="invalid code lengths set",w.mode=30;break}w.have=0,w.mode=19;case 19:for(;w.have<w.nlen+w.ndist;){for(;vt=(D=w.lencode[U&(1<<w.lenbits)-1])>>>16&255,Ot=65535&D,!((pt=D>>>24)<=B);){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}if(Ot<16)U>>>=pt,B-=pt,w.lens[w.have++]=Ot;else{if(Ot===16){for(I=pt+2;B<I;){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}if(U>>>=pt,B-=pt,w.have===0){A.msg="invalid bit length repeat",w.mode=30;break}C=w.lens[w.have-1],tt=3+(3&U),U>>>=2,B-=2}else if(Ot===17){for(I=pt+3;B<I;){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}B-=pt,C=0,tt=3+(7&(U>>>=pt)),U>>>=3,B-=3}else{for(I=pt+7;B<I;){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}B-=pt,C=0,tt=11+(127&(U>>>=pt)),U>>>=7,B-=7}if(w.have+tt>w.nlen+w.ndist){A.msg="invalid bit length repeat",w.mode=30;break}for(;tt--;)w.lens[w.have++]=C}}if(w.mode===30)break;if(w.lens[256]===0){A.msg="invalid code -- missing end-of-block",w.mode=30;break}if(w.lenbits=9,Z={bits:w.lenbits},G=c(h,w.lens,0,w.nlen,w.lencode,0,w.work,Z),w.lenbits=Z.bits,G){A.msg="invalid literal/lengths set",w.mode=30;break}if(w.distbits=6,w.distcode=w.distdyn,Z={bits:w.distbits},G=c(d,w.lens,w.nlen,w.ndist,w.distcode,0,w.work,Z),w.distbits=Z.bits,G){A.msg="invalid distances set",w.mode=30;break}if(w.mode=20,$===6)break t;case 20:w.mode=21;case 21:if(6<=q&&258<=rt){A.next_out=K,A.avail_out=rt,A.next_in=V,A.avail_in=q,w.hold=U,w.bits=B,l(A,J),K=A.next_out,Y=A.output,rt=A.avail_out,V=A.next_in,z=A.input,q=A.avail_in,U=w.hold,B=w.bits,w.mode===12&&(w.back=-1);break}for(w.back=0;vt=(D=w.lencode[U&(1<<w.lenbits)-1])>>>16&255,Ot=65535&D,!((pt=D>>>24)<=B);){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}if(vt&&!(240&vt)){for(Bt=pt,De=vt,ge=Ot;vt=(D=w.lencode[ge+((U&(1<<Bt+De)-1)>>Bt)])>>>16&255,Ot=65535&D,!(Bt+(pt=D>>>24)<=B);){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}U>>>=Bt,B-=Bt,w.back+=Bt}if(U>>>=pt,B-=pt,w.back+=pt,w.length=Ot,vt===0){w.mode=26;break}if(32&vt){w.back=-1,w.mode=12;break}if(64&vt){A.msg="invalid literal/length code",w.mode=30;break}w.extra=15&vt,w.mode=22;case 22:if(w.extra){for(I=w.extra;B<I;){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}w.length+=U&(1<<w.extra)-1,U>>>=w.extra,B-=w.extra,w.back+=w.extra}w.was=w.length,w.mode=23;case 23:for(;vt=(D=w.distcode[U&(1<<w.distbits)-1])>>>16&255,Ot=65535&D,!((pt=D>>>24)<=B);){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}if(!(240&vt)){for(Bt=pt,De=vt,ge=Ot;vt=(D=w.distcode[ge+((U&(1<<Bt+De)-1)>>Bt)])>>>16&255,Ot=65535&D,!(Bt+(pt=D>>>24)<=B);){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}U>>>=Bt,B-=Bt,w.back+=Bt}if(U>>>=pt,B-=pt,w.back+=pt,64&vt){A.msg="invalid distance code",w.mode=30;break}w.offset=Ot,w.extra=15&vt,w.mode=24;case 24:if(w.extra){for(I=w.extra;B<I;){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}w.offset+=U&(1<<w.extra)-1,U>>>=w.extra,B-=w.extra,w.back+=w.extra}if(w.offset>w.dmax){A.msg="invalid distance too far back",w.mode=30;break}w.mode=25;case 25:if(rt===0)break t;if(tt=J-rt,w.offset>tt){if((tt=w.offset-tt)>w.whave&&w.sane){A.msg="invalid distance too far back",w.mode=30;break}dt=tt>w.wnext?(tt-=w.wnext,w.wsize-tt):w.wnext-tt,tt>w.length&&(tt=w.length),yt=w.window}else yt=Y,dt=K-w.offset,tt=w.length;for(rt<tt&&(tt=rt),rt-=tt,w.length-=tt;Y[K++]=yt[dt++],--tt;);w.length===0&&(w.mode=21);break;case 26:if(rt===0)break t;Y[K++]=w.length,rt--,w.mode=21;break;case 27:if(w.wrap){for(;B<32;){if(q===0)break t;q--,U|=z[V++]<<B,B+=8}if(J-=rt,A.total_out+=J,w.total+=J,J&&(A.adler=w.check=w.flags?a(w.check,Y,J,K-J):o(w.check,Y,J,K-J)),J=rt,(w.flags?U:g(U))!==w.check){A.msg="incorrect data check",w.mode=30;break}B=U=0}w.mode=28;case 28:if(w.wrap&&w.flags){for(;B<32;){if(q===0)break t;q--,U+=z[V++]<<B,B+=8}if(U!==(4294967295&w.total)){A.msg="incorrect length check",w.mode=30;break}B=U=0}w.mode=29;case 29:G=1;break t;case 30:G=-3;break t;case 31:return-4;case 32:default:return p}return A.next_out=K,A.avail_out=rt,A.next_in=V,A.avail_in=q,w.hold=U,w.bits=B,(w.wsize||J!==A.avail_out&&w.mode<30&&(w.mode<27||$!==4))&&R(A,A.output,A.next_out,J-A.avail_out)?(w.mode=31,-4):(ot-=A.avail_in,J-=A.avail_out,A.total_in+=ot,A.total_out+=J,w.total+=J,w.wrap&&J&&(A.adler=w.check=w.flags?a(w.check,Y,J,A.next_out-J):o(w.check,Y,J,A.next_out-J)),A.data_type=w.bits+(w.last?64:0)+(w.mode===12?128:0)+(w.mode===20||w.mode===15?256:0),(ot==0&&J===0||$===4)&&G===u&&(G=-5),G)},n.inflateEnd=function(A){if(!A||!A.state)return p;var $=A.state;return $.window&&($.window=null),A.state=null,u},n.inflateGetHeader=function(A,$){var w;return A&&A.state&&2&(w=A.state).wrap?((w.head=$).done=!1,u):p},n.inflateSetDictionary=function(A,$){var w,z=$.length;return A&&A.state?(w=A.state).wrap!==0&&w.mode!==11?p:w.mode===11&&o(1,$,z,0)!==w.check?-3:R(A,$,z,z)?(w.mode=31,-4):(w.havedict=1,u):p},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,s,n){var r=e("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(h,d,u,p,m,f,b,g){var y,v,_,x,S,k,T,M,O,R=g.bits,A=0,$=0,w=0,z=0,Y=0,V=0,K=0,q=0,rt=0,U=0,B=null,ot=0,J=new r.Buf16(16),tt=new r.Buf16(16),dt=null,yt=0;for(A=0;A<=15;A++)J[A]=0;for($=0;$<p;$++)J[d[u+$]]++;for(Y=R,z=15;1<=z&&J[z]===0;z--);if(z<Y&&(Y=z),z===0)return m[f++]=20971520,m[f++]=20971520,g.bits=1,0;for(w=1;w<z&&J[w]===0;w++);for(Y<w&&(Y=w),A=q=1;A<=15;A++)if(q<<=1,(q-=J[A])<0)return-1;if(0<q&&(h===0||z!==1))return-1;for(tt[1]=0,A=1;A<15;A++)tt[A+1]=tt[A]+J[A];for($=0;$<p;$++)d[u+$]!==0&&(b[tt[d[u+$]]++]=$);if(k=h===0?(B=dt=b,19):h===1?(B=o,ot-=257,dt=a,yt-=257,256):(B=l,dt=c,-1),A=w,S=f,K=$=U=0,_=-1,x=(rt=1<<(V=Y))-1,h===1&&852<rt||h===2&&592<rt)return 1;for(;;){for(T=A-K,O=b[$]<k?(M=0,b[$]):b[$]>k?(M=dt[yt+b[$]],B[ot+b[$]]):(M=96,0),y=1<<A-K,w=v=1<<V;m[S+(U>>K)+(v-=y)]=T<<24|M<<16|O|0,v!==0;);for(y=1<<A-1;U&y;)y>>=1;if(y!==0?(U&=y-1,U+=y):U=0,$++,--J[A]==0){if(A===z)break;A=d[u+b[$]]}if(Y<A&&(U&x)!==_){for(K===0&&(K=Y),S+=w,q=1<<(V=A-K);V+K<z&&!((q-=J[V+K])<=0);)V++,q<<=1;if(rt+=1<<V,h===1&&852<rt||h===2&&592<rt)return 1;m[_=U&x]=Y<<24|V<<16|S-f|0}}return U!==0&&(m[S+U]=A-K<<24|64<<16|0),g.bits=Y,0}},{"../utils/common":41}],51:[function(e,s,n){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,s,n){var r=e("../utils/common"),o=0,a=1;function l(D){for(var N=D.length;0<=--N;)D[N]=0}var c=0,h=29,d=256,u=d+1+h,p=30,m=19,f=2*u+1,b=15,g=16,y=7,v=256,_=16,x=17,S=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],T=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],R=new Array(2*(u+2));l(R);var A=new Array(2*p);l(A);var $=new Array(512);l($);var w=new Array(256);l(w);var z=new Array(h);l(z);var Y,V,K,q=new Array(p);function rt(D,N,X,Q,H){this.static_tree=D,this.extra_bits=N,this.extra_base=X,this.elems=Q,this.max_length=H,this.has_stree=D&&D.length}function U(D,N){this.dyn_tree=D,this.max_code=0,this.stat_desc=N}function B(D){return D<256?$[D]:$[256+(D>>>7)]}function ot(D,N){D.pending_buf[D.pending++]=255&N,D.pending_buf[D.pending++]=N>>>8&255}function J(D,N,X){D.bi_valid>g-X?(D.bi_buf|=N<<D.bi_valid&65535,ot(D,D.bi_buf),D.bi_buf=N>>g-D.bi_valid,D.bi_valid+=X-g):(D.bi_buf|=N<<D.bi_valid&65535,D.bi_valid+=X)}function tt(D,N,X){J(D,X[2*N],X[2*N+1])}function dt(D,N){for(var X=0;X|=1&D,D>>>=1,X<<=1,0<--N;);return X>>>1}function yt(D,N,X){var Q,H,st=new Array(b+1),lt=0;for(Q=1;Q<=b;Q++)st[Q]=lt=lt+X[Q-1]<<1;for(H=0;H<=N;H++){var nt=D[2*H+1];nt!==0&&(D[2*H]=dt(st[nt]++,nt))}}function pt(D){var N;for(N=0;N<u;N++)D.dyn_ltree[2*N]=0;for(N=0;N<p;N++)D.dyn_dtree[2*N]=0;for(N=0;N<m;N++)D.bl_tree[2*N]=0;D.dyn_ltree[2*v]=1,D.opt_len=D.static_len=0,D.last_lit=D.matches=0}function vt(D){8<D.bi_valid?ot(D,D.bi_buf):0<D.bi_valid&&(D.pending_buf[D.pending++]=D.bi_buf),D.bi_buf=0,D.bi_valid=0}function Ot(D,N,X,Q){var H=2*N,st=2*X;return D[H]<D[st]||D[H]===D[st]&&Q[N]<=Q[X]}function Bt(D,N,X){for(var Q=D.heap[X],H=X<<1;H<=D.heap_len&&(H<D.heap_len&&Ot(N,D.heap[H+1],D.heap[H],D.depth)&&H++,!Ot(N,Q,D.heap[H],D.depth));)D.heap[X]=D.heap[H],X=H,H<<=1;D.heap[X]=Q}function De(D,N,X){var Q,H,st,lt,nt=0;if(D.last_lit!==0)for(;Q=D.pending_buf[D.d_buf+2*nt]<<8|D.pending_buf[D.d_buf+2*nt+1],H=D.pending_buf[D.l_buf+nt],nt++,Q===0?tt(D,H,N):(tt(D,(st=w[H])+d+1,N),(lt=k[st])!==0&&J(D,H-=z[st],lt),tt(D,st=B(--Q),X),(lt=T[st])!==0&&J(D,Q-=q[st],lt)),nt<D.last_lit;);tt(D,v,N)}function ge(D,N){var X,Q,H,st=N.dyn_tree,lt=N.stat_desc.static_tree,nt=N.stat_desc.has_stree,ht=N.stat_desc.elems,Nt=-1;for(D.heap_len=0,D.heap_max=f,X=0;X<ht;X++)st[2*X]!==0?(D.heap[++D.heap_len]=Nt=X,D.depth[X]=0):st[2*X+1]=0;for(;D.heap_len<2;)st[2*(H=D.heap[++D.heap_len]=Nt<2?++Nt:0)]=1,D.depth[H]=0,D.opt_len--,nt&&(D.static_len-=lt[2*H+1]);for(N.max_code=Nt,X=D.heap_len>>1;1<=X;X--)Bt(D,st,X);for(H=ht;X=D.heap[1],D.heap[1]=D.heap[D.heap_len--],Bt(D,st,1),Q=D.heap[1],D.heap[--D.heap_max]=X,D.heap[--D.heap_max]=Q,st[2*H]=st[2*X]+st[2*Q],D.depth[H]=(D.depth[X]>=D.depth[Q]?D.depth[X]:D.depth[Q])+1,st[2*X+1]=st[2*Q+1]=H,D.heap[1]=H++,Bt(D,st,1),2<=D.heap_len;);D.heap[--D.heap_max]=D.heap[1],function(xt,si){var Ir,Ti,zr,ee,Ca,Jc,Wi=si.dyn_tree,hp=si.max_code,C0=si.stat_desc.static_tree,S0=si.stat_desc.has_stree,E0=si.stat_desc.extra_bits,dp=si.stat_desc.extra_base,Lr=si.stat_desc.max_length,Sa=0;for(ee=0;ee<=b;ee++)xt.bl_count[ee]=0;for(Wi[2*xt.heap[xt.heap_max]+1]=0,Ir=xt.heap_max+1;Ir<f;Ir++)Lr<(ee=Wi[2*Wi[2*(Ti=xt.heap[Ir])+1]+1]+1)&&(ee=Lr,Sa++),Wi[2*Ti+1]=ee,hp<Ti||(xt.bl_count[ee]++,Ca=0,dp<=Ti&&(Ca=E0[Ti-dp]),Jc=Wi[2*Ti],xt.opt_len+=Jc*(ee+Ca),S0&&(xt.static_len+=Jc*(C0[2*Ti+1]+Ca)));if(Sa!==0){do{for(ee=Lr-1;xt.bl_count[ee]===0;)ee--;xt.bl_count[ee]--,xt.bl_count[ee+1]+=2,xt.bl_count[Lr]--,Sa-=2}while(0<Sa);for(ee=Lr;ee!==0;ee--)for(Ti=xt.bl_count[ee];Ti!==0;)hp<(zr=xt.heap[--Ir])||(Wi[2*zr+1]!==ee&&(xt.opt_len+=(ee-Wi[2*zr+1])*Wi[2*zr],Wi[2*zr+1]=ee),Ti--)}}(D,N),yt(st,Nt,D.bl_count)}function C(D,N,X){var Q,H,st=-1,lt=N[1],nt=0,ht=7,Nt=4;for(lt===0&&(ht=138,Nt=3),N[2*(X+1)+1]=65535,Q=0;Q<=X;Q++)H=lt,lt=N[2*(Q+1)+1],++nt<ht&&H===lt||(nt<Nt?D.bl_tree[2*H]+=nt:H!==0?(H!==st&&D.bl_tree[2*H]++,D.bl_tree[2*_]++):nt<=10?D.bl_tree[2*x]++:D.bl_tree[2*S]++,st=H,Nt=(nt=0)===lt?(ht=138,3):H===lt?(ht=6,3):(ht=7,4))}function G(D,N,X){var Q,H,st=-1,lt=N[1],nt=0,ht=7,Nt=4;for(lt===0&&(ht=138,Nt=3),Q=0;Q<=X;Q++)if(H=lt,lt=N[2*(Q+1)+1],!(++nt<ht&&H===lt)){if(nt<Nt)for(;tt(D,H,D.bl_tree),--nt!=0;);else H!==0?(H!==st&&(tt(D,H,D.bl_tree),nt--),tt(D,_,D.bl_tree),J(D,nt-3,2)):nt<=10?(tt(D,x,D.bl_tree),J(D,nt-3,3)):(tt(D,S,D.bl_tree),J(D,nt-11,7));st=H,Nt=(nt=0)===lt?(ht=138,3):H===lt?(ht=6,3):(ht=7,4)}}l(q);var Z=!1;function I(D,N,X,Q){J(D,(c<<1)+(Q?1:0),3),function(H,st,lt,nt){vt(H),ot(H,lt),ot(H,~lt),r.arraySet(H.pending_buf,H.window,st,lt,H.pending),H.pending+=lt}(D,N,X)}n._tr_init=function(D){Z||(function(){var N,X,Q,H,st,lt=new Array(b+1);for(H=Q=0;H<h-1;H++)for(z[H]=Q,N=0;N<1<<k[H];N++)w[Q++]=H;for(w[Q-1]=H,H=st=0;H<16;H++)for(q[H]=st,N=0;N<1<<T[H];N++)$[st++]=H;for(st>>=7;H<p;H++)for(q[H]=st<<7,N=0;N<1<<T[H]-7;N++)$[256+st++]=H;for(X=0;X<=b;X++)lt[X]=0;for(N=0;N<=143;)R[2*N+1]=8,N++,lt[8]++;for(;N<=255;)R[2*N+1]=9,N++,lt[9]++;for(;N<=279;)R[2*N+1]=7,N++,lt[7]++;for(;N<=287;)R[2*N+1]=8,N++,lt[8]++;for(yt(R,u+1,lt),N=0;N<p;N++)A[2*N+1]=5,A[2*N]=dt(N,5);Y=new rt(R,k,d+1,u,b),V=new rt(A,T,0,p,b),K=new rt(new Array(0),M,0,m,y)}(),Z=!0),D.l_desc=new U(D.dyn_ltree,Y),D.d_desc=new U(D.dyn_dtree,V),D.bl_desc=new U(D.bl_tree,K),D.bi_buf=0,D.bi_valid=0,pt(D)},n._tr_stored_block=I,n._tr_flush_block=function(D,N,X,Q){var H,st,lt=0;0<D.level?(D.strm.data_type===2&&(D.strm.data_type=function(nt){var ht,Nt=4093624447;for(ht=0;ht<=31;ht++,Nt>>>=1)if(1&Nt&&nt.dyn_ltree[2*ht]!==0)return o;if(nt.dyn_ltree[18]!==0||nt.dyn_ltree[20]!==0||nt.dyn_ltree[26]!==0)return a;for(ht=32;ht<d;ht++)if(nt.dyn_ltree[2*ht]!==0)return a;return o}(D)),ge(D,D.l_desc),ge(D,D.d_desc),lt=function(nt){var ht;for(C(nt,nt.dyn_ltree,nt.l_desc.max_code),C(nt,nt.dyn_dtree,nt.d_desc.max_code),ge(nt,nt.bl_desc),ht=m-1;3<=ht&&nt.bl_tree[2*O[ht]+1]===0;ht--);return nt.opt_len+=3*(ht+1)+5+5+4,ht}(D),H=D.opt_len+3+7>>>3,(st=D.static_len+3+7>>>3)<=H&&(H=st)):H=st=X+5,X+4<=H&&N!==-1?I(D,N,X,Q):D.strategy===4||st===H?(J(D,2+(Q?1:0),3),De(D,R,A)):(J(D,4+(Q?1:0),3),function(nt,ht,Nt,xt){var si;for(J(nt,ht-257,5),J(nt,Nt-1,5),J(nt,xt-4,4),si=0;si<xt;si++)J(nt,nt.bl_tree[2*O[si]+1],3);G(nt,nt.dyn_ltree,ht-1),G(nt,nt.dyn_dtree,Nt-1)}(D,D.l_desc.max_code+1,D.d_desc.max_code+1,lt+1),De(D,D.dyn_ltree,D.dyn_dtree)),pt(D),Q&&vt(D)},n._tr_tally=function(D,N,X){return D.pending_buf[D.d_buf+2*D.last_lit]=N>>>8&255,D.pending_buf[D.d_buf+2*D.last_lit+1]=255&N,D.pending_buf[D.l_buf+D.last_lit]=255&X,D.last_lit++,N===0?D.dyn_ltree[2*X]++:(D.matches++,N--,D.dyn_ltree[2*(w[X]+d+1)]++,D.dyn_dtree[2*B(N)]++),D.last_lit===D.lit_bufsize-1},n._tr_align=function(D){J(D,2,3),tt(D,v,R),function(N){N.bi_valid===16?(ot(N,N.bi_buf),N.bi_buf=0,N.bi_valid=0):8<=N.bi_valid&&(N.pending_buf[N.pending++]=255&N.bi_buf,N.bi_buf>>=8,N.bi_valid-=8)}(D)}},{"../utils/common":41}],53:[function(e,s,n){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,s,n){(function(r){(function(o,a){if(!o.setImmediate){var l,c,h,d,u=1,p={},m=!1,f=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,l={}.toString.call(o.process)==="[object process]"?function(_){process.nextTick(function(){y(_)})}:function(){if(o.postMessage&&!o.importScripts){var _=!0,x=o.onmessage;return o.onmessage=function(){_=!1},o.postMessage("","*"),o.onmessage=x,_}}()?(d="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",v,!1):o.attachEvent("onmessage",v),function(_){o.postMessage(d+_,"*")}):o.MessageChannel?((h=new MessageChannel).port1.onmessage=function(_){y(_.data)},function(_){h.port2.postMessage(_)}):f&&"onreadystatechange"in f.createElement("script")?(c=f.documentElement,function(_){var x=f.createElement("script");x.onreadystatechange=function(){y(_),x.onreadystatechange=null,c.removeChild(x),x=null},c.appendChild(x)}):function(_){setTimeout(y,0,_)},b.setImmediate=function(_){typeof _!="function"&&(_=new Function(""+_));for(var x=new Array(arguments.length-1),S=0;S<x.length;S++)x[S]=arguments[S+1];var k={callback:_,args:x};return p[u]=k,l(u),u++},b.clearImmediate=g}function g(_){delete p[_]}function y(_){if(m)setTimeout(y,0,_);else{var x=p[_];if(x){m=!0;try{(function(S){var k=S.callback,T=S.args;switch(T.length){case 0:k();break;case 1:k(T[0]);break;case 2:k(T[0],T[1]);break;case 3:k(T[0],T[1],T[2]);break;default:k.apply(a,T)}})(x)}finally{g(_),m=!1}}}}function v(_){_.source===o&&typeof _.data=="string"&&_.data.indexOf(d)===0&&y(+_.data.slice(d.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof ka<"u"?ka:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Hb);var aC=Hb.exports;const Yp=vw(aC);let md=class{constructor(t,e){E(this,"date",new Date),E(this,"author"),E(this,"guid",_e.create()),E(this,"viewpoint"),E(this,"modifiedAuthor"),E(this,"modifiedDate"),E(this,"topic"),E(this,"_components"),E(this,"_comment",""),this._components=t,this._comment=e;const s=this._components.get(pe);this.author=s.config.author}set comment(t){var e;const s=this._components.get(pe);this._comment=t,this.modifiedDate=new Date,this.modifiedAuthor=s.config.author,(e=this.topic)==null||e.comments.set(this.guid,this)}get comment(){return this._comment}toJSON(){var t,e;const s={guid:this.guid,date:this.date.toISOString(),author:this.author,comment:this.comment,topic_guid:(t=this.topic)==null?void 0:t.guid,viewpoint_guid:this.viewpoint,modified_date:(e=this.modifiedDate)==null?void 0:e.toISOString(),modified_author:this.modifiedAuthor};for(const[n,r]of Object.entries(s))r===void 0&&delete s[n];return s}};const Wb=class vs{constructor(t){E(this,"guid",_e.create()),E(this,"title",vs.default.title),E(this,"creationDate",new Date),E(this,"creationAuthor",""),E(this,"viewpoints",new se),E(this,"relatedTopics",new se),E(this,"comments",new It),E(this,"documentReferences",new se),E(this,"customData",{}),E(this,"description"),E(this,"serverAssignedId"),E(this,"dueDate"),E(this,"modifiedAuthor"),E(this,"modifiedDate"),E(this,"index"),E(this,"_type",vs.default.type),E(this,"_status",vs.default.status),E(this,"_priority",vs.default.priority),E(this,"_stage",vs.default.stage),E(this,"_assignedTo",vs.default.assignedTo),E(this,"_labels",vs.default.labels??new Set),E(this,"_components"),this._components=t;const e=t.get(pe);this.creationAuthor=e.config.author,this.relatedTopics.guard=s=>s!==this.guid}set type(t){const e=this._components.get(pe),{strict:s,types:n}=e.config;(!s||n.has(t))&&(this._type=t)}get type(){return this._type}set status(t){const e=this._components.get(pe),{strict:s,statuses:n}=e.config;(!s||n.has(t))&&(this._status=t)}get status(){return this._status}set priority(t){const e=this._components.get(pe);if(t){const{strict:s,priorities:n}=e.config;if(!(!s||n.has(t)))return;this._priority=t}else this._priority=t}get priority(){return this._priority}set stage(t){const e=this._components.get(pe);if(t){const{strict:s,stages:n}=e.config;if(!(!s||n.has(t)))return;this._stage=t}else this._stage=t}get stage(){return this._stage}set assignedTo(t){const e=this._components.get(pe);if(t){const{strict:s,users:n}=e.config;if(!(!s||n.has(t)))return;this._assignedTo=t}else this._assignedTo=t}get assignedTo(){return this._assignedTo}set labels(t){const e=this._components.get(pe),{strict:s,labels:n}=e.config;if(s){const r=new Set;for(const o of t)(!s||n.has(o))&&r.add(o);this._labels=r}else this._labels=t}get labels(){return this._labels}get _managerVersion(){return this._components.get(pe).config.version}set(t){const e=t,s=this;for(const n in t){if(n==="guid")continue;const r=e[n];n in this&&(s[n]=r)}return this._components.get(pe).list.set(this.guid,this),this}createComment(t,e){const s=new md(this._components,t);return s.viewpoint=e,s.topic=this,this.comments.set(s.guid,s),s}createLabelTags(){const t=[...this.labels];if(this._components.get(pe).config.exportCustomDataAsLabels)for(const e in this.customData){const s=this.customData[e];typeof s=="string"&&t.push(s)}return t}createCommentTags(){return[...this.comments.values()].map(t=>{var e;return{$Guid:t.guid,Date:t.date.toISOString(),Author:t.author,Comment:t.comment,ModifiedAuthor:t.modifiedAuthor,ModifiedDate:(e=t.modifiedDate)==null?void 0:e.toISOString(),Viewpoint:t.viewpoint?{$Guid:t.viewpoint}:void 0}})}createViewpointTags(){const t=this._components.get(Ki);return[...this.viewpoints].map(e=>t.list.get(e)).filter(e=>e).map(e=>{const s={$Guid:e.guid,Viewpoint:`${e.title??e.guid}.bcfv`};if(t.snapshots.get(e.snapshot)){const n=t.getSnapshotExtension(e.snapshot);s.Snapshot=`${e.snapshot}.${n}`}return s})}createRelatedTopicTags(){return[...this.relatedTopics].map(t=>({$Guid:t}))}createDocumentReferencesTag(t=this._managerVersion){const e=[];if(!(t==="3"||t==="2.1"))return e;const s=this._components.get(pe);for(const n of this.documentReferences){const r=s.documents.get(n);if(!r)continue;let o={$Guid:_e.create(),Description:r.description};t==="2.1"&&(o={...o,$isExternal:r.type==="external"?!0:void 0,ReferencedDocument:r.type==="external"?r.url:`../${r.fileName}`}),t==="3"&&(o={...o,DocumentGuid:r.type==="internal"?n:void 0,Url:r.type==="external"?r.url:void 0}),Object.keys(o).length>0&&e.push(o)}return e}toJSON(){var t,e;const s={guid:this.guid,server_assigned_id:this.serverAssignedId,topic_type:this.type,topic_status:this.status,title:this.title,priority:this.priority,index:this.index,labels:[...this.labels],creation_date:this.creationDate.toISOString(),creation_author:this.creationAuthor,modified_date:(t=this.modifiedDate)==null?void 0:t.toISOString(),modified_author:this.modifiedAuthor,assigned_to:this.assignedTo,stage:this.stage,description:this.description,due_date:(e=this.dueDate)==null?void 0:e.toISOString(),comments:[...this.comments].map(([o,a])=>a.toJSON()),relatedTopics:[...this.relatedTopics].map(o=>({related_topic_guid:o}))},n=this._components.get(Ki);for(const o of this.viewpoints){const a=n.list.get(o);a&&(s.viewpoints||(s.viewpoints=[]),s.viewpoints.push(a.toJSON()))}const r=this._components.get(pe);for(const o of this.documentReferences){const a=r.documents.get(o);a&&(s.document_references||(s.document_references=[]),a.type==="external"?s.document_references.push({guid:_e.create(),description:a.description,url:a.url}):s.document_references.push({guid:_e.create(),description:a.description,document_guid:o}))}for(const[o,a]of Object.entries(s))(a===void 0||Array.isArray(a)&&a.length===0)&&delete s[o];return s}serialize(){var t,e;const s=this._managerVersion,n={$Guid:this.guid,$TopicType:this.type,$TopicStatus:this.status,$ServerAssignedId:this.serverAssignedId,Title:this.title,CreationAuthor:this.creationAuthor,CreationDate:this.creationDate.toISOString(),Priority:this.priority,Index:s==="2.1"?this.index:void 0,ModifiedDate:(t=this.modifiedDate)==null?void 0:t.toISOString(),ModifiedAuthor:this.modifiedAuthor,DueDate:(e=this.dueDate)==null?void 0:e.toISOString(),AssignedTo:this.assignedTo,Description:this.description,Stage:this.stage,DocumentReferences:s==="3"?{DocumentReference:this.createDocumentReferencesTag(s)}:void 0,RelatedTopics:s==="3"?{RelatedTopic:this.createRelatedTopicTags()}:void 0,RelatedTopic:s==="2.1"?this.createRelatedTopicTags():void 0,Labels:s==="3"?{Label:this.createLabelTags()}:void 0,Viewpoints:s==="3"?{ViewPoint:this.createViewpointTags()}:void 0,Comments:s==="3"?{Comment:this.createCommentTags()}:void 0};s==="2.1"&&(n.Labels=this.createLabelTags(),n.DocumentReference=this.createDocumentReferencesTag(s));const r={Markup:{Topic:n}};return s==="2.1"&&(r.Markup.Viewpoints=this.createViewpointTags(),r.Markup.Comment=this.createCommentTags()),`<?xml version="1.0" encoding="UTF-8"?>
    ${xc.builder.build(r)}`}};E(Wb,"default",{title:"BCF Topic",type:"Issue",status:"Active"});let Zp=Wb;const lC=(i,t)=>{if(t.trim()==="")return;const e=pe.xmlParser.parse(t).Extensions;if(!e)return;const{Priorities:s,TopicStatuses:n,TopicTypes:r,Users:o}=e;if(s&&s.Priority){const a=Array.isArray(s.Priority)?s.Priority:[s.Priority];for(const l of a)i.config.priorities.add(l)}if(n&&n.TopicStatus){const a=Array.isArray(n.TopicStatus)?n.TopicStatus:[n.TopicStatus];for(const l of a)i.config.statuses.add(l)}if(r&&r.TopicType){const a=Array.isArray(r.TopicType)?r.TopicType:[r.TopicType];for(const l of a)i.config.types.add(l)}if(o&&o.User){const a=Array.isArray(o.User)?o.User:[o.User];for(const l of a)i.config.users.add(l)}};let cC=class extends Cc{constructor(){super(...arguments),E(this,"_config",{version:{type:"Select",options:new Set(["2.1","3"]),multiple:!1,value:""},author:{type:"Text",value:""},types:{type:"TextSet",value:new Set},statuses:{type:"TextSet",value:new Set},priorities:{type:"TextSet",value:new Set},labels:{type:"TextSet",value:new Set},stages:{type:"TextSet",value:new Set},users:{type:"TextSet",value:new Set},includeSelectionTag:{type:"Boolean",value:!1},updateExtensionsOnImport:{type:"Boolean",value:!1},strict:{type:"Boolean",value:!1},includeAllExtensionsOnExport:{type:"Boolean",value:!1},fallbackVersionOnImport:{type:"Select",multiple:!1,options:new Set(["2.1","3"]),value:""},ignoreIncompleteTopicsOnImport:{type:"Boolean",value:!1},exportCustomDataAsLabels:{type:"Boolean",value:!1}})}get version(){return this._config.version.value}set version(t){this._config.version.value=t}get author(){return this._config.author.value}set author(t){this._config.author.value=t}get types(){return this._config.types.value}set types(t){this._config.types.value=t}get statuses(){return this._config.statuses.value}set statuses(t){this._config.statuses.value=t}get priorities(){return this._config.priorities.value}set priorities(t){this._config.priorities.value=t}get labels(){return this._config.labels.value}set labels(t){this._config.labels.value=t}get stages(){return this._config.stages.value}set stages(t){this._config.stages.value=t}get users(){return this._config.users.value}set users(t){this._config.users.value=t}get includeSelectionTag(){return this._config.includeSelectionTag.value}set includeSelectionTag(t){this._config.includeSelectionTag.value=t}get updateExtensionsOnImport(){return this._config.updateExtensionsOnImport.value}set updateExtensionsOnImport(t){this._config.updateExtensionsOnImport.value=t}get strict(){return this._config.strict.value}set strict(t){this._config.strict.value=t}get includeAllExtensionsOnExport(){return this._config.includeAllExtensionsOnExport.value}set includeAllExtensionsOnExport(t){this._config.includeAllExtensionsOnExport.value=t}get fallbackVersionOnImport(){return this._config.fallbackVersionOnImport.value}set fallbackVersionOnImport(t){this._config.fallbackVersionOnImport.value=t}get ignoreIncompleteTopicsOnImport(){return this._config.ignoreIncompleteTopicsOnImport.value}set ignoreIncompleteTopicsOnImport(t){this._config.ignoreIncompleteTopicsOnImport.value=t}get exportCustomDataAsLabels(){return this._config.exportCustomDataAsLabels.value}set exportCustomDataAsLabels(t){this._config.exportCustomDataAsLabels.value=t}};const bu=class ho extends zt{constructor(){super(...arguments),E(this,"enabled",!1),E(this,"_defaultConfig",{author:"jhon.doe@example.com",version:"2.1",types:new Set(["Clash","Failure","Fault","Inquiry","Issue","Remark","Request"]),statuses:new Set(["Active","In Progress","Done","In Review","Closed"]),priorities:new Set(["On hold","Minor","Normal","Major","Critical"]),labels:new Set,stages:new Set,users:new Set,includeSelectionTag:!1,updateExtensionsOnImport:!0,strict:!1,includeAllExtensionsOnExport:!0,fallbackVersionOnImport:"2.1",ignoreIncompleteTopicsOnImport:!1,exportCustomDataAsLabels:!1}),E(this,"config",new cC(this,this.components,"BCF Topics",ho.uuid)),E(this,"list",new It),E(this,"documents",new It),E(this,"onSetup",new et),E(this,"isSetup",!1),E(this,"onBCFImported",new et),E(this,"onDisposed",new et)}setup(t){if(this.isSetup)return;const e={...this._defaultConfig,...t};this.config.version=e.version,this.config.author=e.author,this.config.types=e.types,this.config.statuses=e.statuses,this.config.priorities=e.priorities,this.config.labels=e.labels,this.config.stages=e.stages,this.config.users=e.users,this.config.includeSelectionTag=e.includeSelectionTag,this.config.updateExtensionsOnImport=e.updateExtensionsOnImport,this.config.strict=e.strict,this.config.includeAllExtensionsOnExport=e.includeAllExtensionsOnExport,this.config.fallbackVersionOnImport=e.fallbackVersionOnImport||"",this.config.ignoreIncompleteTopicsOnImport=e.ignoreIncompleteTopicsOnImport,this.isSetup=!0,this.enabled=!0,this.onSetup.trigger()}create(t){const e=new Zp(this.components);return t?(e.guid=t.guid??e.guid,e.set(t)):this.list.set(e.guid,e),e}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get usedTypes(){const t=[...this.list].map(([e,s])=>s.type);return new Set(t)}get usedStatuses(){const t=[...this.list].map(([e,s])=>s.status);return new Set(t)}get usedPriorities(){const t=[...this.list].map(([e,s])=>s.priority).filter(e=>e);return new Set(t)}get usedStages(){const t=[...this.list].map(([e,s])=>s.stage).filter(e=>e);return new Set(t)}get usedUsers(){const t=[];for(const[e,s]of this.list){t.push(s.creationAuthor),s.assignedTo&&t.push(s.assignedTo),s.modifiedAuthor&&t.push(s.modifiedAuthor);for(const[n,r]of s.comments)t.push(r.author),r.modifiedAuthor&&t.push(r.modifiedAuthor)}return new Set(t)}get usedLabels(){const t=[];for(const[e,s]of this.list)t.push(...s.labels);return new Set(t)}updateExtensions(){for(const[t,e]of this.list){for(const s of e.labels)this.config.labels.add(s);this.config.types.add(e.type),e.priority&&this.config.priorities.add(e.priority),e.stage&&this.config.stages.add(e.stage),this.config.statuses.add(e.status),this.config.users.add(e.creationAuthor),e.assignedTo&&this.config.users.add(e.assignedTo),e.modifiedAuthor&&this.config.users.add(e.modifiedAuthor);for(const[s,n]of e.comments)this.config.users.add(n.author),n.modifiedAuthor&&this.config.users.add(n.modifiedAuthor)}}updateViewpointReferences(){const t=this.components.get(Ki);for(const[e,s]of this.list)for(const n of s.viewpoints)t.list.has(n)||s.viewpoints.delete(n)}async export(t=this.list.values()){const e=new Yp;e.file("bcf.version",`<?xml version="1.0" encoding="UTF-8"?>
    <Version VersionId="${this.config.version}" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/buildingSMART/BCF-XML/release_3_0/Schemas/version.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    </Version>`);for(const[n,r]of this.documents.entries())r.type!=="external"&&e.file(this.config.version==="2.1"?r.fileName:`documents/${n}`,r.data);if(this.config.version==="3"){const n=[];for(const[r,o]of this.documents.entries()){const{type:a,description:l}=o;a!=="external"&&n.push(`<Document Guid="${r}">
        <Filename>${o.fileName}</Filename>
        ${l?`<Description>${l}</Description>`:""}
      </Document>`)}n.length>0&&e.file("documents.xml",`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
  <DocumentInfo xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="documents.xsd">
    <Documents>
      ${n.join(`
`)}
    </Documents>
  </DocumentInfo>`)}e.file("bcf.extensions",this.serializeExtensions());const s=this.components.get(Ki);for(const n of t){const r=e.folder(n.guid);r.file("markup.bcf",n.serialize());for(const o of n.viewpoints){const a=s.list.get(o);if(!a)continue;const l=a.title??a.guid;r.file(`${l}.bcfv`,await a.serialize());const c=s.snapshots.get(a.snapshot);if(!c)continue;const h=c?a.snapshot:a.guid,d=s.getSnapshotExtension(a.snapshot);r.file(`${h}.${d}`,c,{binary:!0})}}return await e.generateAsync({type:"blob"})}serializeExtensions(){const t=[...this.config.types].map(a=>`<TopicType>${a}</TopicType>`).join(`
`),e=[...this.config.statuses].map(a=>`<TopicStatus>${a}</TopicStatus>`).join(`
`),s=[...this.config.priorities].map(a=>`<Priority>${a}</Priority>`).join(`
`),n=[...this.config.labels].map(a=>`<TopicLabel>${a}</TopicLabel>`).join(`
`),r=[...this.config.stages].map(a=>`<Stage>${a}</Stage>`).join(`
`),o=[...this.config.users].map(a=>`<User>${a}</User>`).join(`
`);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Extensions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="your-schema-location.xsd">
        ${t.length!==0?`<TopicTypes>
${t}
</TopicTypes>`:""}
        ${e.length!==0?`<TopicStatuses>
${e}
</TopicStatuses>`:""}
        ${s.length!==0?`<Priorities>
${s}
</Priorities>`:""}
        ${n.length!==0?`<TopicLabels>
${n}
</TopicLabels>`:""}
        ${r.length!==0?`<Stages>
${r}
</Stages>`:""}
        ${o.length!==0?`<Users>
${o}
</Users>`:""}
      </Extensions>
    `}processMarkupComment(t){const{Guid:e,Date:s,Author:n,Comment:r,Viewpoint:o}=t;if(!(e&&s&&n&&(md||o)))return null;const a=new md(this.components,r??"");return a.guid=e,a.date=new Date(s),a.author=n,a.viewpoint=o==null?void 0:o.Guid,a.modifiedAuthor=t.ModifiedAuthor,a.modifiedDate=t.ModifiedDate?new Date(t.ModifiedDate):void 0,a}getMarkupComments(t,e){var s;let n;if(e==="2.1"&&(n=t.Comment),e==="3"&&(n=(s=t.Topic.Comments)==null?void 0:s.Comment),!n)return[];n=Array.isArray(n)?n:[n];const r=n.map(o=>this.processMarkupComment(o)).filter(o=>o);return Array.isArray(r)?r:[r]}getMarkupLabels(t,e){var s;let n;return e==="2.1"&&(n=t.Topic.Labels),e==="3"&&(n=(s=t.Topic.Labels)==null?void 0:s.Label),n?Array.isArray(n)?n:[n]:[]}getMarkupViewpoints(t,e){var s;let n;return e==="2.1"&&(n=t.Viewpoints),e==="3"&&(n=(s=t.Topic.Viewpoints)==null?void 0:s.ViewPoint),n?(n=Array.isArray(n)?n:[n],n):[]}getMarkupRelatedTopics(t,e){var s;let n;return e==="2.1"&&(n=t.Topic.RelatedTopic),e==="3"&&(n=(s=t.Topic.RelatedTopics)==null?void 0:s.RelatedTopic),n?(Array.isArray(n)?n:[n]).map(r=>r.Guid):[]}getMarkupDocumentReferences(t,e){var s;let n;return e==="2.1"&&(n=t.Topic.DocumentReference),e==="3"&&(n=(s=t.Topic.DocumentReferences)==null?void 0:s.DocumentReference),n?Array.isArray(n)?n:[n]:[]}async load(t){var e,s,n;const{fallbackVersionOnImport:r,ignoreIncompleteTopicsOnImport:o,updateExtensionsOnImport:a}=this.config,l=new Yp;await l.loadAsync(t);const c=Object.values(l.files);let h=r;const d=c.find(v=>v.name.endsWith(".version"));if(d){const v=await d.async("string"),_=ho.xmlParser.parse(v).Version.VersionId;h=String(_)}if(!(h&&(h==="2.1"||h==="3")))throw new Error(`BCFTopics: ${h} is not supported.`);const u=c.find(v=>v.name.endsWith(".extensions"));if(a&&u){const v=await u.async("string");lC(this,v)}const p=[],m=this.components.get(Ki),f=c.filter(v=>v.name.endsWith(".bcfv"));for(const v of f){const _=await v.async("string"),x=ho.xmlParser.parse(_).VisualizationInfo;if(!x){console.warn("Missing VisualizationInfo in Viewpoint");continue}const S={},{Guid:k,ClippingPlanes:T,Components:M,OrthogonalCamera:O,PerspectiveCamera:R}=x;if(k&&(S.guid=k),M){const $={selection:[],coloring:[],visibility:{default_visibility:!1,exceptions:[],view_setup_hints:{spaces_visible:!1,space_boundaries_visible:!1,openings_visible:!1}}};S.components=$;const{Selection:w,Visibility:z}=M;if(w&&w.Component){const K=Array.isArray(w.Component)?w.Component:[w.Component];$.selection=K.map(q=>q.IfcGuid?{ifc_guid:q.IfcGuid}:null).filter(q=>q!==null)}if(z&&"DefaultVisibility"in z&&($.visibility.default_visibility=z.DefaultVisibility),z&&z.Exceptions&&"Component"in z.Exceptions){const{Component:K}=z.Exceptions,q=Array.isArray(K)?K:[K];$.visibility.exceptions=q.map(rt=>rt.IfcGuid?{ifc_guid:rt.IfcGuid}:null).filter(rt=>rt!==null)}let Y;h==="2.1"&&(Y=M.ViewSetupHints),h==="3"&&(Y=(e=M.Visibility)==null?void 0:e.ViewSetupHints),Y&&("OpeningsVisible"in Y&&($.visibility.view_setup_hints.openings_visible=Y.OpeningsVisible),"SpacesVisible"in Y&&($.visibility.view_setup_hints.spaces_visible=Y.SpacesVisible),"SpaceBoundariesVisible"in Y&&($.visibility.view_setup_hints.space_boundaries_visible=Y.SpaceBoundariesVisible));const{Coloring:V}=M;if(V&&V.Color){const K=Array.isArray(V.Color)?V.Color:[V.Color];for(const q of K){const{Color:rt,Component:U}=q;if(!(rt.length===6||rt.length===8))continue;const B=rt.length===6?rt:rt.slice(2),ot=(Array.isArray(U)?U:[U]).map(J=>J.IfcGuid?{ifc_guid:J.IfcGuid}:null).filter(J=>J!==null);$.coloring.push({color:B,components:ot})}}}if(O||R){const $=x.PerspectiveCamera??x.OrthogonalCamera,{CameraViewPoint:w,CameraDirection:z}=$,Y=new L(Number(w.X),Number(w.Z),Number(-w.Y)),V=new L(Number(z.X),Number(z.Z),Number(-z.Y)),K={camera_view_point:{x:Y.x,y:Y.y,z:Y.z},camera_direction:{x:V.x,y:V.y,z:V.z},aspect_ratio:"AspectRatio"in $?$.AspectRatio:1,camera_up_vector:{x:0,y:0,z:0}};"ViewToWorldScale"in $&&(S.orthogonal_camera={...K,view_to_world_scale:$.ViewToWorldScale}),"FieldOfView"in $&&(S.perspective_camera={...K,field_of_view:$.FieldOfView})}if(T){const $=(Array.isArray(T.ClippingPlane)?T.ClippingPlane:[T.ClippingPlane]).map(({Location:w,Direction:z})=>({location:{x:w.x,y:w.y,z:w.z},direction:{x:z.x,y:z.y,z:z.z}}));S.clipping_planes=$}const A=new Zb(this.components,S);p.push(A)}const b={},g=[],y=c.filter(v=>v.name.endsWith(".bcf"));for(const v of y){const _=await v.async("string"),x=ho.xmlParser.parse(_).Markup,S=x.Topic,{Guid:k,TopicType:T,TopicStatus:M,Title:O,CreationDate:R,CreationAuthor:A}=S;if(o&&!(k&&T&&M&&O&&R&&A))continue;const $=new Zp(this.components);$.guid=k??$.guid;const w=this.getMarkupRelatedTopics(x,h);b[$.guid]=new Set(w),$.type=T??$.type,$.status=M??$.status,$.title=O??$.title,$.creationDate=R?new Date(R):$.creationDate,$.creationAuthor=A??$.creationAuthor,$.serverAssignedId=S.ServerAssignedId,$.priority=S.Priority,$.index=S.Index,$.modifiedDate=S.ModifiedDate?new Date(S.ModifiedDate):void 0,$.modifiedAuthor=S.ModifiedAuthor,$.dueDate=S.DueDate?new Date(S.DueDate):void 0,$.assignedTo=S.AssignedTo,$.description=S.Description,$.stage=S.Stage;const z=this.getMarkupLabels(x,h);for(const B of z)$.labels.add(B);const Y=this.getMarkupComments(x,h);for(const B of Y)$.comments.set(B.guid,B);const V=this.getMarkupViewpoints(x,h);for(const B of V){if(!(B&&B.Guid))continue;const ot=m.list.get(B.Guid);if(!ot)continue;$.viewpoints.add(ot.guid);const J=`${$.guid}/${B.Snapshot}`,tt=c.find(({name:dt})=>dt===J);if(tt){const dt=await tt.async("arraybuffer"),yt=new Uint8Array(dt);m.snapshots.set(ot.guid,yt),ot.snapshot=ot.guid??null}}const K=this.getMarkupDocumentReferences(x,h),q=c.find(B=>B.name==="documents.xml");let rt=[];const U=await(q==null?void 0:q.async("string"));if(U){const B=(n=(s=xc.parser.parse(U).DocumentInfo)==null?void 0:s.Documents)==null?void 0:n.Document;rt=Array.isArray(B)?B:[B]}for(const B of K){const{Description:ot,DocumentGuid:J,Url:tt,isExternal:dt,ReferencedDocument:yt}=B;if(J&&rt.length>0){const pt=rt.find(({Guid:ge})=>ge===J),vt=c.find(ge=>ge.name.endsWith(J)),Ot=await(vt==null?void 0:vt.async("uint8array"));if(!(pt&&Ot))continue;const{Description:Bt,Filename:De}=pt;this.documents.set(J,{type:"internal",fileName:De,description:Bt,data:Ot}),$.documentReferences.add(J)}if(tt){const pt=this.documents.add({type:"external",url:tt,description:ot});$.documentReferences.add(pt)}if(yt){let pt=null;if(dt)pt=this.documents.add({type:"external",url:yt,description:ot});else{const vt=yt.split("/"),Ot=vt[vt.length-1],Bt=c.find(ge=>ge.name.endsWith(Ot)),De=await(Bt==null?void 0:Bt.async("uint8array"));if(!De)continue;pt=this.documents.add({type:"internal",fileName:Ot,data:De,description:ot})}$.documentReferences.add(pt)}}this.list.set($.guid,$),g.push($)}for(const v in b){const _=this.list.get(v);if(!_)continue;const x=b[v];for(const S of x)_.relatedTopics.add(S)}return this.onBCFImported.trigger(g),{viewpoints:p,topics:g}}};E(bu,"uuid","de977976-e4f6-4e4f-a01a-204727839802");E(bu,"xmlParser",new wc.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let pe=bu;const en=new nu,Te=new L,gs=new L,qt=new vi,Gp={X:new L(1,0,0),Y:new L(0,1,0),Z:new L(0,0,1)},vh={type:"change"},Xp={type:"mouseDown",mode:null},Kp={type:"mouseUp",mode:null},Qp={type:"objectChange"};let hC=class extends Z0{constructor(t,e=null){super(void 0,e);const s=new gC(this);this._root=s;const n=new bC;this._gizmo=n,s.add(n);const r=new yC;this._plane=r,s.add(r);const o=this;function a(v,_){let x=_;Object.defineProperty(o,v,{get:function(){return x!==void 0?x:_},set:function(S){x!==S&&(x=S,r[v]=S,n[v]=S,o.dispatchEvent({type:v+"-changed",value:S}),o.dispatchEvent(vh))}}),o[v]=_,r[v]=_,n[v]=_}a("camera",t),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0),a("minX",-1/0),a("maxX",1/0),a("minY",-1/0),a("maxY",1/0),a("minZ",-1/0),a("maxZ",1/0);const l=new L,c=new L,h=new vi,d=new vi,u=new L,p=new vi,m=new L,f=new L,b=new L,g=0,y=new L;a("worldPosition",l),a("worldPositionStart",c),a("worldQuaternion",h),a("worldQuaternionStart",d),a("cameraPosition",u),a("cameraQuaternion",p),a("pointStart",m),a("pointEnd",f),a("rotationAxis",b),a("rotationAngle",g),a("eye",y),this._offset=new L,this._startNorm=new L,this._endNorm=new L,this._cameraScale=new L,this._parentPosition=new L,this._parentQuaternion=new vi,this._parentQuaternionInv=new vi,this._parentScale=new L,this._worldScaleStart=new L,this._worldQuaternionInv=new vi,this._worldScale=new L,this._positionStart=new L,this._quaternionStart=new vi,this._scaleStart=new L,this._getPointer=dC.bind(this),this._onPointerDown=pC.bind(this),this._onPointerHover=uC.bind(this),this._onPointerMove=fC.bind(this),this._onPointerUp=mC.bind(this),e!==null&&this.connect(e)}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(t){if(this.object===void 0||this.dragging===!0)return;t!==null&&en.setFromCamera(t,this.camera);const e=_h(this._gizmo.picker[this.mode],en);e?this.axis=e.object.name:this.axis=null}pointerDown(t){if(!(this.object===void 0||this.dragging===!0||t!=null&&t.button!==0)&&this.axis!==null){t!==null&&en.setFromCamera(t,this.camera);const e=_h(this._plane,en,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,Xp.mode=this.mode,this.dispatchEvent(Xp)}}pointerMove(t){const e=this.axis,s=this.mode,n=this.object;let r=this.space;if(s==="scale"?r="local":(e==="E"||e==="XYZE"||e==="XYZ")&&(r="world"),n===void 0||e===null||this.dragging===!1||t!==null&&t.button!==-1)return;t!==null&&en.setFromCamera(t,this.camera);const o=_h(this._plane,en,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&e!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),e.indexOf("X")===-1&&(this._offset.x=0),e.indexOf("Y")===-1&&(this._offset.y=0),e.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&e!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(n.position.applyQuaternion(qt.copy(this._quaternionStart).invert()),e.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),r==="world"&&(n.parent&&n.position.add(Te.setFromMatrixPosition(n.parent.matrixWorld)),e.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(Te.setFromMatrixPosition(n.parent.matrixWorld)))),n.position.x=Math.max(this.minX,Math.min(this.maxX,n.position.x)),n.position.y=Math.max(this.minY,Math.min(this.maxY,n.position.y)),n.position.z=Math.max(this.minZ,Math.min(this.maxZ,n.position.z));else if(s==="scale"){if(e.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),gs.set(a,a,a)}else Te.copy(this.pointStart),gs.copy(this.pointEnd),Te.applyQuaternion(this._worldQuaternionInv),gs.applyQuaternion(this._worldQuaternionInv),gs.divide(Te),e.search("X")===-1&&(gs.x=1),e.search("Y")===-1&&(gs.y=1),e.search("Z")===-1&&(gs.z=1);n.scale.copy(this._scaleStart).multiply(gs),this.scaleSnap&&(e.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(Te.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;e==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Te.copy(this.rotationAxis).cross(this.eye))*a):(e==="X"||e==="Y"||e==="Z")&&(this.rotationAxis.copy(Gp[e]),Te.copy(Gp[e]),r==="local"&&Te.applyQuaternion(this.worldQuaternion),Te.cross(this.eye),Te.length()===0?l=!0:this.rotationAngle=this._offset.dot(Te.normalize())*a),(e==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&e!=="E"&&e!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(qt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(qt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(vh),this.dispatchEvent(Qp)}}pointerUp(t){t!==null&&t.button!==0||(this.dragging&&this.axis!==null&&(Kp.mode=this.mode,this.dispatchEvent(Kp)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(t){return this.object=t,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(vh),this.dispatchEvent(Qp),this.pointStart.copy(this.pointEnd))}getRaycaster(){return en}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}};function dC(i){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:i.button};{const t=this.domElement.getBoundingClientRect();return{x:(i.clientX-t.left)/t.width*2-1,y:-(i.clientY-t.top)/t.height*2+1,button:i.button}}}function uC(i){if(this.enabled)switch(i.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(i));break}}function pC(i){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(i.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(i)),this.pointerDown(this._getPointer(i)))}function fC(i){this.enabled&&this.pointerMove(this._getPointer(i))}function mC(i){this.enabled&&(this.domElement.releasePointerCapture(i.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(i)))}function _h(i,t,e){const s=t.intersectObject(i,!0);for(let n=0;n<s.length;n++)if(s[n].object.visible||e)return s[n];return!1}const Ya=new X0,Lt=new L(0,1,0),Jp=new L(0,0,0),tf=new Pt,Za=new vi,El=new vi,$i=new L,ef=new Pt,uo=new L(1,0,0),hn=new L(0,1,0),po=new L(0,0,1),Ga=new L,Kr=new L,Qr=new L;let gC=class extends ar{constructor(t){super(),this.isTransformControlsRoot=!0,this.controls=t,this.visible=!1}updateMatrixWorld(t){const e=this.controls;e.object!==void 0&&(e.object.updateMatrixWorld(),e.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):e.object.parent.matrixWorld.decompose(e._parentPosition,e._parentQuaternion,e._parentScale),e.object.matrixWorld.decompose(e.worldPosition,e.worldQuaternion,e._worldScale),e._parentQuaternionInv.copy(e._parentQuaternion).invert(),e._worldQuaternionInv.copy(e.worldQuaternion).invert()),e.camera.updateMatrixWorld(),e.camera.matrixWorld.decompose(e.cameraPosition,e.cameraQuaternion,e._cameraScale),e.camera.isOrthographicCamera?e.camera.getWorldDirection(e.eye).negate():e.eye.copy(e.cameraPosition).sub(e.worldPosition).normalize(),super.updateMatrixWorld(t)}dispose(){this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}},bC=class extends ar{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const t=new Cr({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),e=new ru({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=t.clone();s.opacity=.15;const n=e.clone();n.opacity=.5;const r=t.clone();r.color.setHex(16711680);const o=t.clone();o.color.setHex(65280);const a=t.clone();a.color.setHex(255);const l=t.clone();l.color.setHex(16711680),l.opacity=.5;const c=t.clone();c.color.setHex(65280),c.opacity=.5;const h=t.clone();h.color.setHex(255),h.opacity=.5;const d=t.clone();d.opacity=.25;const u=t.clone();u.color.setHex(16776960),u.opacity=.25,t.clone().color.setHex(16776960);const p=t.clone();p.color.setHex(7895160);const m=new Ie(0,.04,.1,12);m.translate(0,.05,0);const f=new Ae(.08,.08,.08);f.translate(0,.04,0);const b=new xe;b.setAttribute("position",new Ns([0,0,0,1,0,0],3));const g=new Ie(.0075,.0075,.5,3);g.translate(0,.25,0);function y(w,z){const Y=new Rr(w,.0075,3,64,z*Math.PI*2);return Y.rotateY(Math.PI/2),Y.rotateX(Math.PI/2),Y}function v(){const w=new xe;return w.setAttribute("position",new Ns([0,0,0,1,1,1],3)),w}const _={X:[[new at(m,r),[.5,0,0],[0,0,-Math.PI/2]],[new at(m,r),[-.5,0,0],[0,0,Math.PI/2]],[new at(g,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new at(m,o),[0,.5,0]],[new at(m,o),[0,-.5,0],[Math.PI,0,0]],[new at(g,o)]],Z:[[new at(m,a),[0,0,.5],[Math.PI/2,0,0]],[new at(m,a),[0,0,-.5],[-Math.PI/2,0,0]],[new at(g,a),null,[Math.PI/2,0,0]]],XYZ:[[new at(new Ea(.1,0),d.clone()),[0,0,0]]],XY:[[new at(new Ae(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new at(new Ae(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new at(new Ae(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},x={X:[[new at(new Ie(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new at(new Ie(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new at(new Ie(.2,0,.6,4),s),[0,.3,0]],[new at(new Ie(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new at(new Ie(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new at(new Ie(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new at(new Ea(.2,0),s)]],XY:[[new at(new Ae(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new at(new Ae(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new at(new Ae(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},S={START:[[new at(new Ea(.01,2),n),null,null,null,"helper"]],END:[[new at(new Ea(.01,2),n),null,null,null,"helper"]],DELTA:[[new yi(v(),n),null,null,null,"helper"]],X:[[new yi(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new yi(b,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new yi(b,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},k={XYZE:[[new at(y(.5,1),p),null,[0,Math.PI/2,0]]],X:[[new at(y(.5,.5),r)]],Y:[[new at(y(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new at(y(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new at(y(.75,1),u),null,[0,Math.PI/2,0]]]},T={AXIS:[[new yi(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},M={XYZE:[[new at(new G0(.25,10,8),s)]],X:[[new at(new Rr(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new at(new Rr(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new at(new Rr(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new at(new Rr(.75,.1,2,24),s)]]},O={X:[[new at(f,r),[.5,0,0],[0,0,-Math.PI/2]],[new at(g,r),[0,0,0],[0,0,-Math.PI/2]],[new at(f,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new at(f,o),[0,.5,0]],[new at(g,o)],[new at(f,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new at(f,a),[0,0,.5],[Math.PI/2,0,0]],[new at(g,a),[0,0,0],[Math.PI/2,0,0]],[new at(f,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new at(new Ae(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new at(new Ae(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new at(new Ae(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new at(new Ae(.1,.1,.1),d.clone())]]},R={X:[[new at(new Ie(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new at(new Ie(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new at(new Ie(.2,0,.6,4),s),[0,.3,0]],[new at(new Ie(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new at(new Ie(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new at(new Ie(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new at(new Ae(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new at(new Ae(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new at(new Ae(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new at(new Ae(.2,.2,.2),s),[0,0,0]]]},A={X:[[new yi(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new yi(b,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new yi(b,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function $(w){const z=new ar;for(const Y in w)for(let V=w[Y].length;V--;){const K=w[Y][V][0].clone(),q=w[Y][V][1],rt=w[Y][V][2],U=w[Y][V][3],B=w[Y][V][4];K.name=Y,K.tag=B,q&&K.position.set(q[0],q[1],q[2]),rt&&K.rotation.set(rt[0],rt[1],rt[2]),U&&K.scale.set(U[0],U[1],U[2]),K.updateMatrix();const ot=K.geometry.clone();ot.applyMatrix4(K.matrix),K.geometry=ot,K.renderOrder=1/0,K.position.set(0,0,0),K.rotation.set(0,0,0),K.scale.set(1,1,1),z.add(K)}return z}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=$(_)),this.add(this.gizmo.rotate=$(k)),this.add(this.gizmo.scale=$(O)),this.add(this.picker.translate=$(x)),this.add(this.picker.rotate=$(M)),this.add(this.picker.scale=$(R)),this.add(this.helper.translate=$(S)),this.add(this.helper.rotate=$(T)),this.add(this.helper.scale=$(A)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const e=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:El;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let n=0;n<s.length;n++){const r=s[n];r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition);let o;if(this.camera.isOrthographicCamera?o=(this.camera.top-this.camera.bottom)/this.camera.zoom:o=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),r.scale.set(1,1,1).multiplyScalar(o*this.size/4),r.tag==="helper"){r.visible=!1,r.name==="AXIS"?(r.visible=!!this.axis,this.axis==="X"&&(qt.setFromEuler(Ya.set(0,0,0)),r.quaternion.copy(e).multiply(qt),Math.abs(Lt.copy(uo).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Y"&&(qt.setFromEuler(Ya.set(0,0,Math.PI/2)),r.quaternion.copy(e).multiply(qt),Math.abs(Lt.copy(hn).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Z"&&(qt.setFromEuler(Ya.set(0,Math.PI/2,0)),r.quaternion.copy(e).multiply(qt),Math.abs(Lt.copy(po).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="XYZE"&&(qt.setFromEuler(Ya.set(0,Math.PI/2,0)),Lt.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix(tf.lookAt(Jp,Lt,hn)),r.quaternion.multiply(qt),r.visible=this.dragging),this.axis==="E"&&(r.visible=!1)):r.name==="START"?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):r.name==="END"?(r.position.copy(this.worldPosition),r.visible=this.dragging):r.name==="DELTA"?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),Te.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Te.applyQuaternion(this.worldQuaternionStart.clone().invert()),r.scale.copy(Te),r.visible=this.dragging):(r.quaternion.copy(e),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=this.axis.search(r.name)!==-1));continue}r.quaternion.copy(e),this.mode==="translate"||this.mode==="scale"?(r.name==="X"&&Math.abs(Lt.copy(uo).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Y"&&Math.abs(Lt.copy(hn).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Z"&&Math.abs(Lt.copy(po).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XY"&&Math.abs(Lt.copy(po).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="YZ"&&Math.abs(Lt.copy(uo).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XZ"&&Math.abs(Lt.copy(hn).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1)):this.mode==="rotate"&&(Za.copy(e),Lt.copy(this.eye).applyQuaternion(qt.copy(e).invert()),r.name.search("E")!==-1&&r.quaternion.setFromRotationMatrix(tf.lookAt(this.eye,Jp,hn)),r.name==="X"&&(qt.setFromAxisAngle(uo,Math.atan2(-Lt.y,Lt.z)),qt.multiplyQuaternions(Za,qt),r.quaternion.copy(qt)),r.name==="Y"&&(qt.setFromAxisAngle(hn,Math.atan2(Lt.x,Lt.z)),qt.multiplyQuaternions(Za,qt),r.quaternion.copy(qt)),r.name==="Z"&&(qt.setFromAxisAngle(po,Math.atan2(Lt.y,Lt.x)),qt.multiplyQuaternions(Za,qt),r.quaternion.copy(qt))),r.visible=r.visible&&(r.name.indexOf("X")===-1||this.showX),r.visible=r.visible&&(r.name.indexOf("Y")===-1||this.showY),r.visible=r.visible&&(r.name.indexOf("Z")===-1||this.showZ),r.visible=r.visible&&(r.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),r.material._color=r.material._color||r.material.color.clone(),r.material._opacity=r.material._opacity||r.material.opacity,r.material.color.copy(r.material._color),r.material.opacity=r.material._opacity,this.enabled&&this.axis&&(r.name===this.axis||this.axis.split("").some(function(a){return r.name===a}))&&(r.material.color.setHex(16776960),r.material.opacity=1)}super.updateMatrixWorld(t)}},yC=class extends at{constructor(){super(new ou(1e5,1e5,2,2),new Cr({visible:!1,wireframe:!0,side:Bs,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(t){let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),Ga.copy(uo).applyQuaternion(e==="local"?this.worldQuaternion:El),Kr.copy(hn).applyQuaternion(e==="local"?this.worldQuaternion:El),Qr.copy(po).applyQuaternion(e==="local"?this.worldQuaternion:El),Lt.copy(Kr),this.mode){case"translate":case"scale":switch(this.axis){case"X":Lt.copy(this.eye).cross(Ga),$i.copy(Ga).cross(Lt);break;case"Y":Lt.copy(this.eye).cross(Kr),$i.copy(Kr).cross(Lt);break;case"Z":Lt.copy(this.eye).cross(Qr),$i.copy(Qr).cross(Lt);break;case"XY":$i.copy(Qr);break;case"YZ":$i.copy(Ga);break;case"XZ":Lt.copy(Qr),$i.copy(Kr);break;case"XYZ":case"E":$i.set(0,0,0);break}break;case"rotate":default:$i.set(0,0,0)}$i.length()===0?this.quaternion.copy(this.cameraQuaternion):(ef.lookAt(Te.set(0,0,0),$i,Lt),this.quaternion.setFromRotationMatrix(ef)),super.updateMatrixWorld(t)}},vC=class qb{constructor(t,e,s,n,r,o=5,a=!0){if(E(this,"onDraggingStarted",new et),E(this,"onDraggingEnded",new et),E(this,"onDisposed",new et),E(this,"normal"),E(this,"origin"),E(this,"three",new oi),E(this,"components"),E(this,"world"),E(this,"type","default"),E(this,"_title","Clipping Plane"),E(this,"_helper"),E(this,"_visible",!0),E(this,"_enabled",!0),E(this,"_controlsActive",!1),E(this,"_arrowBoundBox",new at),E(this,"_planeMesh"),E(this,"_controls"),E(this,"_hiddenMaterial",new Cr({visible:!1})),E(this,"_visibilityBeforeDisabled",!0),E(this,"notifyManager",()=>{const l=this.components.get(ws),c=l.list.getKey(this);c&&l.list.set(c,this)}),E(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),E(this,"changeDrag",l=>{this._visible=!l.value,this.preventCameraMovement(),this.notifyDraggingChanged(l)}),this.components=t,this.world=e,!e.renderer)throw new Error("The given world must have a renderer!");this.normal=n,this.origin=s,e.renderer.setPlane(!0,this.three),this._planeMesh=qb.newPlaneMesh(o,r),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(n,s),a&&this.toggleControls(!0)}set title(t){this._title=t,this.notifyManager()}get title(){return this._title}get enabled(){return this._enabled}set enabled(t){if(!this.world.isDisposing){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=t,t?this.visible=this._visibilityBeforeDisabled:(this._visibilityBeforeDisabled=this.visible,this.visible=!1),this.world.renderer.setPlane(t,this.three),this.notifyManager()}}get visible(){return this._visible}set visible(t){this._visible=t,this._controls.getHelper().visible=t,this._helper.visible=t,this.toggleControls(t),this.notifyManager()}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(t){this._planeMesh.material=t}get size(){return this._planeMesh.scale.x}set size(t){this._planeMesh.scale.set(t,t,t)}get helper(){return this._helper}get controls(){return this._controls}setFromNormalAndCoplanarPoint(t,e){this.reset(),this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.getHelper().removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const t=new L(1,0,0),e=new L;this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix()}toggleControls(t){if(t){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=t}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const t=this.world.camera.three,e=this.world.renderer.three.domElement,s=new hC(t,e);return this.initializeControls(s),this.world.scene.three.add(s.getHelper()),s}initializeControls(t){t.attach(this._helper),t.showX=!1,t.showY=!1,t.setSpace("local"),this.createArrowBoundingBox(),t.getHelper().children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new Ie(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(t){t.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const t=new ar;return t.lookAt(this.normal),t.position.copy(this.origin),this._planeMesh.position.z+=.01,t.add(this._planeMesh),this.world.scene.three.add(t),t}static newPlaneMesh(t,e){const s=new ou(1),n=new at(s,e);return n.scale.set(t,t,t),n}},_C=class extends Cc{constructor(){super(...arguments),E(this,"_config",{enabled:{value:!0,type:"Boolean"},visible:{value:!0,type:"Boolean"},color:{value:new gt,type:"Color"},opacity:{type:"Number",interpolable:!0,value:1,min:0,max:1},size:{type:"Number",interpolable:!0,value:2,min:0,max:100}})}get enabled(){return this._config.enabled.value}set enabled(t){this._config.enabled.value=t,this._component.enabled=t}get visible(){return this._config.visible.value}set visible(t){this._config.visible.value=t,this._component.visible=t}get color(){return this._config.color.value}set color(t){this._config.color.value=t,this._component.material.color.copy(t)}get opacity(){return this._config.opacity.value}set opacity(t){this._config.opacity.value=t,this._component.material.opacity=t}get size(){return this._config.size.value}set size(t){this._config.size.value=t,this._component.size=t}};const Yb=class kl extends zt{constructor(t){super(t),E(this,"onSetup",new et),E(this,"onBeforeDrag",new et),E(this,"onAfterDrag",new et),E(this,"onBeforeCreate",new et),E(this,"onBeforeCancel",new et),E(this,"onAfterCancel",new et),E(this,"onBeforeDelete",new et),E(this,"onAfterCreate",new et),E(this,"onAfterDelete",new et),E(this,"onDisposed",new et),E(this,"isSetup",!1),E(this,"orthogonalY",!1),E(this,"toleranceOrthogonalY",.7),E(this,"Type",vC),E(this,"list",new It),E(this,"config",new _C(this,this.components,"Clipper",kl.uuid)),E(this,"_defaultConfig",{color:new gt(12255487),opacity:.2,size:2}),E(this,"_material",new Cr({color:12255487,side:Bs,transparent:!0,opacity:.2})),E(this,"_size",5),E(this,"_enabled",!1),E(this,"_visible",!0),E(this,"onStateChanged",new et),E(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),E(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(kl.uuid,this),this.setEvents()}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this.onStateChanged.trigger(["enabled"])}get visible(){return this._visible}set visible(t){this._visible=t;for(const[e,s]of this.list)s.visible=t;this.onStateChanged.trigger(["visibility"])}get material(){return this._material}set material(t){this._material=t;for(const[e,s]of this.list)s.planeMaterial=t;this.onStateChanged.trigger(["material"])}get size(){return this._size}set size(t){this._size=t;for(const[e,s]of this.list)s.size=t;this.onStateChanged.trigger(["size"])}setEvents(){this.list.onBeforeDelete.add(({value:t})=>{if(!t.world.renderer)throw new Error("Renderer not found for this plane's world!");t.world.renderer.setPlane(!1,t.three),t.dispose(),this.updateMaterialsAndPlanes(),this.onAfterDelete.trigger(t)})}dispose(){this._enabled=!1,this.components.get(fu).list.delete(this.config.uuid),this.list.clear(),this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(kl.uuid),this.onDisposed.reset()}async create(t){const e=await this.components.get(Re).get(t).castRay();return e?this.createPlaneFromIntersection(t,e):null}createFromNormalAndCoplanarPoint(t,e,s){const n=this.newPlane(t,s,e);return this.updateMaterialsAndPlanes(),n}async delete(t,e){if(!e){const s=await this.pickPlane(t);if(!s)return;e=this.list.getKey(s)}e&&this.list.delete(e)}deleteAll(t){for(const[e,s]of this.list)(!t||t.has(s.type))&&this.list.delete(e)}setup(t){const e={...this._defaultConfig,...t};this.config.color=e.color,this.config.opacity=e.opacity,this.config.size=e.size,this.isSetup=!0,this.onSetup.trigger()}async pickPlane(t){const e=this.components.get(Re).get(t),s=this.getAllPlaneMeshes(),n=await e.castRay({items:s});if(n){const r=n.object;return[...this.list.values()].find(o=>o.meshes.includes(r))}}getAllPlaneMeshes(){const t=[];for(const[e,s]of this.list)t.push(...s.meshes);return t}createPlaneFromIntersection(t,e){var s;if(!t.renderer)throw new Error("The given world must have a renderer!");const n=e.point.distanceTo(new L(0,0,0)),r=e.normal||((s=e.face)==null?void 0:s.normal);if(!n||!r)return null;const o=this.getWorldNormal(e,r),a=this.newPlane(t,e.point,o.negate()),l=this.list.get(a);return l.visible=this._visible,l.size=this._size,t.renderer.setPlane(!0,l.three),this.updateMaterialsAndPlanes(),l}getWorldNormal(t,e){const s=t.object;let n=t.object.matrixWorld.clone();if(s instanceof $0&&t.instanceId!==void 0){const a=new Pt;s.getMatrixAt(t.instanceId,a),n=a.multiply(n)}const r=new O0().getNormalMatrix(n),o=e.clone().applyMatrix3(r).normalize();return this.normalizePlaneDirectionY(o),o}normalizePlaneDirectionY(t){this.orthogonalY&&(t.y>this.toleranceOrthogonalY&&(t.x=0,t.y=1,t.z=0),t.y<-this.toleranceOrthogonalY&&(t.x=0,t.y=-1,t.z=0))}newPlane(t,e,s){const n=new this.Type(this.components,t,e,s,this._material);n.onDraggingStarted.add(this._onStartDragging),n.onDraggingEnded.add(this._onEndDragging);const r=_e.create();return this.list.set(r,n),this.onAfterCreate.trigger(n),r}updateMaterialsAndPlanes(){const t=this.components.get(Db);for(const[e,s]of t.list){if(!s.renderer)continue;s.renderer.updateClippingPlanes();const{clippingPlanes:n}=s.renderer;for(const r of s.meshes)if(r.material)if(Array.isArray(r.material))for(const o of r.material)o.clippingPlanes=n;else r.material.clippingPlanes=n}}};E(Yb,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let ws=Yb,Zb=class{constructor(t,e){E(this,"title"),E(this,"guid",_e.create()),E(this,"clippingPlanes",new se),E(this,"camera",{aspect_ratio:1,field_of_view:60,camera_direction:{x:0,y:0,z:0},camera_view_point:{x:0,y:0,z:0},camera_up_vector:{x:0,y:1,z:0}}),E(this,"customData",{}),E(this,"exceptionComponents",new se),E(this,"selectionComponents",new se),E(this,"componentColors",new It),E(this,"spacesVisible",!1),E(this,"spaceBoundariesVisible",!1),E(this,"openingsVisible",!1),E(this,"defaultVisibility",!0),E(this,"snapshot",this.guid),E(this,"_components"),E(this,"_world",null),E(this,"notifyUpdate",()=>{this._components.get(Ki).list.set(this.guid,this)}),this._components=t,e&&(this.guid=e.guid??this.guid,this.set(e)),this.setEvents()}async getSelectionMap(){return await this._components.get(ut).guidsToModelIdMap([...this.selectionComponents])}async getExceptionMap(){return await this._components.get(ut).guidsToModelIdMap([...this.exceptionComponents])}get projection(){return"field_of_view"in this.camera?"Perspective":"Orthographic"}get position(){const t=this._components.get(ut),{camera_view_point:e}=this.camera,{x:s,y:n,z:r}=e,o=new L(s,n,r);return t.applyBaseCoordinateSystem(o,new Pt),o}set position(t){const e=t.clone(),s=this._components.get(ut);t.clone().applyMatrix4(s.baseCoordinationMatrix.clone().invert()),this.camera.camera_view_point={x:e.x,y:e.y,z:e.z}}get direction(){const{camera_direction:t}=this.camera,{x:e,y:s,z:n}=t;return new L(e,s,n)}set world(t){this._world=t}get world(){return this._world}get _managerVersion(){return this._components.get(pe).config.version}get topics(){return[...this._components.get(pe).list.values()].filter(t=>t.viewpoints.has(this.guid))}setEvents(){this.selectionComponents.onUpdated.add(this.notifyUpdate),this.exceptionComponents.onUpdated.add(this.notifyUpdate),this.clippingPlanes.onUpdated.add(this.notifyUpdate),this.componentColors.onItemSet.add(this.notifyUpdate),this.componentColors.onItemDeleted.add(this.notifyUpdate),this.componentColors.onItemUpdated.add(this.notifyUpdate),this.componentColors.onCleared.add(this.notifyUpdate)}set(t){this.title=t.title;const{components:e,perspective_camera:s,orthogonal_camera:n,clipping_planes:r}=t;if(e){const{selection:o,visibility:a,coloring:l}=e;if(o){this.selectionComponents.clear();for(const{ifc_guid:c}of o)c&&this.selectionComponents.add(c)}if(a){const{default_visibility:c,exceptions:h,view_setup_hints:d}=a;if(c!==void 0&&(this.defaultVisibility=c),h){this.exceptionComponents.clear();for(const{ifc_guid:u}of h)u&&this.exceptionComponents.add(u)}if(d){const{spaces_visible:u,space_boundaries_visible:p,openings_visible:m}=d;u!==void 0&&(this.spacesVisible=u),p!==void 0&&(this.spaceBoundariesVisible=p),m!==void 0&&(this.openingsVisible=m)}}if(l){this.componentColors.clear();for(const c of l){const{color:h,components:d}=c,u=d.map(p=>p.ifc_guid).filter(p=>p!==null);this.componentColors.set(h,u)}}}if((s||n)&&(this.camera=s??n),r&&this.world){const o=this._components.get(ws);for(const a of r){const{location:l,direction:c}=a,h=new L(l.x,l.z,-l.y),d=new L(c.x,c.z,-c.y),u=o.createFromNormalAndCoplanarPoint(this.world,d,h);this.clippingPlanes.add(u),o.list.get(u).enabled=!1,o.list.get(u).visible=!1}}this.notifyUpdate()}async go(t){if(!this.world)return;const{camera:e}=this.world;if(!(e instanceof Vb))throw new Error("Viewpoint: the world's camera component must be of type OrthoPerspectiveCamera to switch between perspective and orthographic projections.");const{transition:s,applyClippings:n,applyVisibility:r,clippingsVisibility:o}={transition:!0,applyClippings:!0,applyVisibility:!0,clippingsVisibility:!0,...t};e.projection.set(this.projection);const a=new L(this.camera.camera_view_point.x,this.camera.camera_view_point.y,this.camera.camera_view_point.z),l=new L(this.camera.camera_direction.x,this.camera.camera_direction.y,this.camera.camera_direction.z);if(a.equals(new L)&&l.equals(new L))return;const c=this.position,h=this.direction,d=80,u={x:c.x+h.x*d,y:c.y+h.y*d,z:c.z+h.z*d},p=[];n&&this.setClippingState(!0),r&&p.push(this.applyVisibility()),this.setClippingVisibility(o),p.push(e.controls.setLookAt(c.x,c.y,c.z,u.x,u.y,u.z,s)),await Promise.all(p)}async updateCamera(t=!0){return new Promise(e=>{if(!this.world){e(!1);return}const{camera:s,renderer:n}=this.world;if(!n)throw new Error("Viewpoint: the world needs to have a renderer!");if(!s.hasCameraControls())throw new Error("Viewpoint: world's camera need camera controls!");const r=new L;s.controls.getPosition(r);const o=s.three,a=new L(0,0,-1).applyEuler(o.rotation),{width:l,height:c}=n.getSize();let h=l/c;Number.isNaN(h)&&(h=1);const d=this._components.get(ut);r.applyMatrix4(d.baseCoordinationMatrix.clone().invert());const u={aspect_ratio:h,camera_view_point:{x:r.x,y:r.y,z:r.z},camera_direction:{x:a.x,y:a.y,z:a.z},camera_up_vector:{x:0,y:1,z:0}};if(o instanceof Kg?this.camera={...u,field_of_view:o.fov}:o instanceof bc&&(this.camera={...u,view_to_world_scale:o.top-o.bottom}),t){const p=this._components.get(Ki),m=n.three.domElement;n.three.render(this.world.scene.three,s.three),m.toBlob(async f=>{if(f){const b=await f.arrayBuffer(),g=new Uint8Array(b);p.snapshots.set(this.guid,g)}this.notifyUpdate(),e(!0)})}else this.notifyUpdate(),e(!0)})}takeSnapshot(){return new Promise(t=>{if(!this.world){t(!1);return}const{camera:e,renderer:s}=this.world;if(!s)throw new Error("Viewpoint: the world needs to have a renderer!");const n=this._components.get(Ki),r=s.three.domElement;s.three.render(this.world.scene.three,e.three),r.toBlob(async o=>{if(o){const a=await o.arrayBuffer(),l=new Uint8Array(a);n.snapshots.set(this.guid,l)}this.notifyUpdate(),t(!0)})})}updateClippingPlanes(){this.clippingPlanes.clear();const t=this._components.get(ws);for(const[e,s]of t.list)s.enabled&&this.clippingPlanes.add(e)}async applyVisibility(){const t=this._components.get(Rx);t.set(this.defaultVisibility);const e=await this.getExceptionMap();t.set(!this.defaultVisibility,e);const s=await this.getSelectionMap();t.set(!0,s)}async setColorizationState(t){const e=this._components.get(ut),s=[];if(t)for(const[n,r]of this.componentColors){const o=`#${n}`,a=await e.guidsToModelIdMap(r);for(const[l,c]of Object.entries(a)){const h=e.list.get(l);h&&s.push(h.highlight([...c],{customId:o,color:new gt(o),renderedFaces:Bl.ONE,opacity:1,transparent:!1}))}}else for(const[n,r]of this.componentColors){const o=await e.guidsToModelIdMap(r);for(const[a,l]of Object.entries(o)){const c=e.list.get(a);c&&s.push(c.resetHighlight([...l]))}}s.push(e.core.update(!0)),await Promise.all(s)}setClippingState(t){const e=this._components.get(ws);for(const[s,n]of e.list)n.enabled=t&&this.clippingPlanes.has(s)}setClippingVisibility(t){const e=this._components.get(ws);for(const s of this.clippingPlanes){const n=e.list.get(s);n&&(n.visible=t)}}async createComponentTags(t){var e;const s=this._components.get(ut),n=this._components.get(pe);let r="";if(n.config.includeSelectionTag){const o=t==="selection"?await this.getSelectionMap():await this.getExceptionMap();for(const a in o){const l=s.list.get(a);if(!l)continue;const c=o[a];for(const h of c){const d=l.getItem(h),u=await d.getGuid();if(!u)continue;const p=(e=await d.getAttributes())==null?void 0:e.getValue("Tag");let m=null;p&&(m=`AuthoringToolId="${p}"`),r+=`
<Component IfcGuid="${u}" ${m??""} />`}}}else r=[...this.selectionComponents].map(o=>`<Component IfcGuid="${o}" />`).join(`
`);return r}createColorTags(){let t="";for(const[e,s]of this.componentColors.entries()){const n=s.map(r=>`
<Component IfcGuid="${r}" />`).join(`
`);t+=`<Color Color="${e}">
${n}
</Color>`}return t.length!==0?`<Coloring>
${t}
</Coloring>`:"<Coloring />"}toJSON(){const t=this._components.get(ws),e={guid:this.guid,components:{selection:[...this.selectionComponents].map(r=>({ifc_guid:r,authoring_tool_id:null})),coloring:[...this.componentColors].map(([r,o])=>({color:r,components:o.map(a=>({ifc_guid:a,authoring_tool_id:null}))})),visibility:{default_visibility:this.defaultVisibility,exceptions:[...this.exceptionComponents].map(r=>({ifc_guid:r,authoring_tool_id:null})),view_setup_hints:{spaces_visible:this.spacesVisible,space_boundaries_visible:this.spaceBoundariesVisible,openings_visible:this.openingsVisible}}},clipping_planes:[...this.clippingPlanes].map(r=>{const o=t.list.get(r);if(!o)return null;const a=o._controls.worldPosition??o.origin,{normal:l}=o;return{location:{x:a.x,y:-a.z,z:a.y},direction:{x:l.x,y:-l.z,z:l.y}}}).filter(r=>r!==null)};"field_of_view"in this.camera?e.perspective_camera=this.camera:e.orthogonal_camera=this.camera;const s=this._components.get(Ki),n=s.snapshots.get(this.snapshot);if(n){const r=n.toString(),o=btoa(r),a=s.getSnapshotExtension(this.snapshot);e.snapshot={snapshot_type:a,snapshot_data:o}}return e}async serialize(t=this._managerVersion){const e=this._components.get(ut),s=this.position;s.applyMatrix4(e.baseCoordinationMatrix.clone().invert());const n=this.direction;n.normalize();const r=new Pt().makeRotationX(Math.PI/2),o=n.clone().applyMatrix4(r);o.normalize();const a=`<CameraViewPoint>
      <X>${s.x}</X>
      <Y>${-s.z}</Y>
      <Z>${s.y}</Z>
    </CameraViewPoint>`,l=`<CameraDirection>
      <X>${n.x}</X>
      <Y>${-n.z}</Y>
      <Z>${n.y}</Z>
    </CameraDirection>`,c=`<CameraUpVector>
      <X>${o.x}</X>
      <Y>${-o.z}</Y>
      <Z>${o.y}</Z>
    </CameraUpVector>`,h=`<AspectRatio>${this.camera.aspect_ratio}</AspectRatio>`;let d="";"view_to_world_scale"in this.camera?d=`<OrthogonalCamera>
        ${a}
        ${l}
        ${c}
        ${h}
        <ViewToWorldScale>${this.camera.view_to_world_scale}</ViewToWorldScale>
      </OrthogonalCamera>`:"field_of_view"in this.camera&&(d=`<PerspectiveCamera>
        ${a}
        ${l}
        ${c}
        ${h}
        <FieldOfView>${this.camera.field_of_view}</FieldOfView>
      </PerspectiveCamera>`);const u=`<ViewSetupHints SpacesVisible="${this.spacesVisible??!1}" SpaceBoundariesVisible="${this.spaceBoundariesVisible??!1}" OpeningsVisible="${this.openingsVisible??!1}" />`,p=(await this.createComponentTags("selection")).trim(),m=(await this.createComponentTags("exception")).trim(),f=this.createColorTags();return`<?xml version="1.0" encoding="UTF-8"?>
    <VisualizationInfo Guid="${this.guid}">
      <Components>
        ${t==="2.1"?u:""}
        ${p.length!==0?`<Selection>${p}</Selection>`:""}
        <Visibility DefaultVisibility="${this.defaultVisibility}">
          ${t==="3"?u:""}
          ${m.length!==0?`<Exceptions>${m}</Exceptions>`:""}
        </Visibility>
        ${f}
      </Components>
      ${d}
    </VisualizationInfo>`}},wC=class extends Cc{constructor(){super(...arguments),E(this,"_config",{overwriteColors:{value:!1,type:"Boolean"}})}get overwriteColors(){return this._config.overwriteColors.value}set overwriteColors(t){this._config.overwriteColors.value=t}};const Gb=class gd extends zt{constructor(t){super(t),E(this,"enabled",!0),E(this,"world",null),E(this,"list",new It),E(this,"snapshots",new It),E(this,"isSetup",!1),E(this,"onSetup",new et),E(this,"config",new wC(this,this.components,"Viewpoints",gd.uuid)),E(this,"onDisposed",new et),t.add(gd.uuid,this)}create(t){const e=new Zb(this.components,t);return e.world=this.world,t||this.list.set(e.guid,e),e}getSnapshotExtension(t){let e="jpeg";const s=this.snapshots.get(t);if(!s)return e;const n=s.subarray(0,4);let r="";for(let o=0;o<n.length;o++)r+=n[o].toString(16);return r.startsWith("89504e47")&&(e="png"),r.startsWith("ffd8ffe")&&(e="jpeg"),e}setup(){}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}};E(Gb,"uuid","ee867824-a796-408d-8aa0-4e5962a83c66");let Ki=Gb,sf=class{constructor(t,e){E(this,"_components"),E(this,"_cameraOffset",10),E(this,"_planeHelper"),E(this,"_farPlaneHelper"),E(this,"_cameraHelper"),E(this,"onStateChanged",new et),E(this,"onUpdated",new et),E(this,"onDisposed",new et),E(this,"camera"),E(this,"plane",new oi),E(this,"farPlane",new oi),E(this,"id",_e.create()),E(this,"_open",!1),E(this,"_range",xC.defaultRange),E(this,"_world",null),E(this,"_helpersVisible",!1),E(this,"_planesEnabled",!1),this._components=t,this.camera=new Vb(this._components);const{threeOrtho:s}=this.camera;if(e!=null&&e.id&&(this.id=e.id),e!=null&&e.normal&&e!=null&&e.point){const{normal:n,point:r}=e;this.plane.setFromNormalAndCoplanarPoint(n,r)}this._cameraHelper=new F0(s),this._planeHelper=new pp(this.plane,50),this._farPlaneHelper=new pp(this.farPlane,50),this.farPlaneHelperColor=new gt("blue"),this.update()}get _planeNormalOpposite(){return this.plane.normal.clone().negate()}get _planePosition(){return this.plane.normal.clone().multiplyScalar(-this.plane.constant)}get _cameraPosition(){return this._planePosition.addScaledVector(this._planeNormalOpposite,this._cameraOffset)}set open(t){this._open=t,this.onStateChanged.trigger(["open"])}get open(){return this._open}set planeHelperColor(t){!Array.isArray(this._planeHelper.material)&&"color"in this._planeHelper.material&&this._planeHelper.material.color instanceof gt&&(this._planeHelper.material.color=t)}set farPlaneHelperColor(t){!Array.isArray(this._farPlaneHelper.material)&&"color"in this._farPlaneHelper.material&&this._farPlaneHelper.material.color instanceof gt&&(this._farPlaneHelper.material.color=t)}set range(t){this._range=t,this.update()}get range(){return this._range}set distance(t){this.plane.constant=t,this.update()}get distance(){return this.plane.constant}set world(t){this._world=t,this.camera.currentWorld=t,t&&(this.camera.projection.set("Orthographic"),this.camera.set("Plan"),this.camera.controls.dollySpeed=6,this.camera.controls.restThreshold=.005,this.update())}get world(){return this._world}set helpersVisible(t){if(!t){this._helpersVisible=t,this._planeHelper.removeFromParent(),this._farPlaneHelper.removeFromParent(),this._cameraHelper.removeFromParent();return}this.world&&(this._helpersVisible=t,this.world.scene.three.add(this._planeHelper,this._farPlaneHelper))}get helpersVisible(){return this._helpersVisible}set planesEnabled(t){const{world:e}=this;if(!e)return;const{renderer:s}=e;s&&(s.setPlane(t,this.plane),s.setPlane(t,this.farPlane),this._planesEnabled=t)}get planesEnabled(){return this._planesEnabled}dispose(){this.helpersVisible=!1;const t=this._components.get(Ui);t.destroy(this._planeHelper),t.destroy(this._farPlaneHelper),t.destroy(this._cameraHelper),this.camera.dispose(),this.onDisposed.trigger()}update(){if(this.world){const t=this._cameraPosition,e=this._planePosition;this.camera.controls.setLookAt(t.x,t.y,t.z,e.x,e.y,e.z,!1)}this.farPlane.normal.copy(this._planeNormalOpposite),this.farPlane.constant=this.range-this.plane.constant,this.onUpdated.trigger()}flip(){this.plane.normal.negate(),this.update()}};const yu=class Xb extends zt{constructor(t){super(t),E(this,"list",new It),E(this,"enabled",!0),E(this,"world",null),E(this,"_fragmentsUpdateEvent",()=>{this.components.get(ut).core.update(!0)}),t.add(Xb.uuid,this),this.setupEvents()}get hasOpenViews(){return[...this.list.values()].some(t=>t.open)}setupEvents(){this.list.onBeforeDelete.add(({key:t,value:e})=>{e.open&&this.close(t),e.dispose()})}create(t,e,s){const n=new sf(this.components,{id:s==null?void 0:s.id,normal:t,point:e});return n.world=(s==null?void 0:s.world)??this.world,this.list.set(n.id,n),n}createFromPlane(t,e){const s=new sf(this.components,{id:e==null?void 0:e.id});return s.plane.copy(t),s.update(),s.world=(e==null?void 0:e.world)??this.world,this.list.set(s.id,s),s}async createFromIfcStoreys(t){const e=[],s=this.components.get(ut),n=(t==null?void 0:t.offset)===void 0?.25:t.offset;for(const[r,o]of s.list){if(t&&t.modelIds&&!t.modelIds.some(d=>d.test(r)))continue;const a=Object.values(await o.getItemsOfCategories([/BUILDINGSTOREY/])).flat();if(a.length===0)continue;const l=await o.getItemsData(a),[,c]=await o.getCoordinates(),h=new L(0,-1,0);for(const d of l){if(!("value"in d.Name&&"value"in d.Elevation))continue;const{value:u}=d.Name;if(t!=null&&t.storeyNames&&!t.storeyNames.some(b=>b.test(u)))continue;const p=d.Elevation.value+c+n,m=new oi(h,p),f=this.createFromPlane(m,{id:u,world:t==null?void 0:t.world});e.push(f)}}return e}createElevations(t){const e=[],s=this.components.get(ut),n=(t==null?void 0:t.combine)===void 0?!1:t.combine,r=(t==null?void 0:t.namingCallback)??(a=>({front:`${n?"Front":`${a}: Front`}`,back:`${n?"Back":`${a}: Back`}`,left:`${n?"Left":`${a}: Left`}`,right:`${n?"Right":`${a}: Right`}`}));let o=[];for(const[a,l]of s.list)t&&t.modelIds&&!t.modelIds.some(c=>c.test(a))||o.push({id:a,box:l.box});if(n){const a=this.components.get(Ul);a.list.clear(),a.list.add(...o.map(l=>l.box)),o=[{id:"combined",box:a.get()}]}for(const{id:a,box:l}of o){const{min:c,max:h}=l,d=Math.abs(h.x-c.x),u=Math.abs(h.z-c.z),p=new L;l.getCenter(p);const m=new oi(new L(0,0,-1),h.z),f=new oi(new L(0,0,1),-c.z),b=new oi(new L(-1,0,0),h.x),g=new oi(new L(1,0,0),-c.x),{front:y,back:v,left:_,right:x}=r(a),S=this.createFromPlane(m,{id:y,world:t==null?void 0:t.world});S.range=u;const k=this.createFromPlane(f,{id:v,world:t==null?void 0:t.world});k.range=u;const T=this.createFromPlane(b,{id:_,world:t==null?void 0:t.world});T.range=d;const M=this.createFromPlane(g,{id:x,world:t==null?void 0:t.world});M.range=d,e.push(S,k,T,M)}return e}open(t){const e=this.list.get(t);if(!e)throw new Error(`Views: the view with id ${t} doesn't exist.`);if(e.open)return;const{world:s}=e;if(!s)throw new Error(`Views: no world found for view with id ${t}.`);const{renderer:n}=s;if(!n)throw new Error(`Views: no renderer found for world with id ${s.uuid}.`);for(const[,r]of this.list)r.world===s&&this.close(r.id);n.setPlane(!0,e.plane),n.setPlane(!0,e.farPlane),e.camera.controls.addEventListener("rest",this._fragmentsUpdateEvent),s.camera=e.camera,e.open=!0}close(t){let e;if(t?e=this.list.get(t):e=[...this.list.values()].find(r=>r.open),t&&!e)throw new Error(`Views: the view with id ${t} doesn't exist.`);if(!e||!e.open)return;const{world:s}=e;if(!s)throw new Error(`Views: no world found for view with id ${t}.`);const{renderer:n}=s;if(!n)throw new Error(`Views: no renderer found for world with id ${s.uuid}.`);n.setPlane(!1,e.plane),n.setPlane(!1,e.farPlane),e.camera.controls.removeEventListener("rest",this._fragmentsUpdateEvent),s.useDefaultCamera(),e.open=!1}};E(yu,"uuid","fb22f1f5-6598-4664-a11d-de8963ae420f");E(yu,"defaultRange",15);let xC=yu,Er=class{constructor(t){E(this,"cardinality","required"),E(this,"instructions"),E(this,"evalRequirement",(e,s,n,r)=>{const o={parameter:n,currentValue:e,requiredValue:s,pass:!1};r&&this.addCheckResult(o,r);let a=!1;if(s.type==="simple"&&(a=e===s.parameter),s.type==="enumeration"&&(a=s.parameter.includes(e)),s.type==="pattern"&&(a=new RegExp(s.parameter).test(String(e))),s.type==="length"){const{min:l,length:c,max:h}=s.parameter;c!==void 0&&(a=String(e).length===c),l!==void 0&&(a=String(e).length>=l),h!==void 0&&(a=String(e).length<=h)}if(s.type==="bounds"&&typeof e=="number"){const{min:l,minInclusive:c,max:h,maxInclusive:d}=s.parameter;let u=!0,p=!0;l!==void 0&&(u=c?e>=l:e>l),h!==void 0&&(p=d?e<=h:e<h),a=u&&p}return this.cardinality==="prohibited"&&(a=!a),this.cardinality==="optional"&&(a=!0),o.pass=a,o.pass}),this._components=t}addCheckResult(t,e){const s=e.findIndex(({parameter:n})=>n===t.parameter);s!==-1?e[s]=t:e.push(t)}getItemChecks(t,e,s,n){if(!("value"in s._localId&&typeof s._localId.value=="number"))return null;let r=t.get(e);r||(r=new It,t.set(e,r));let o=r.get(s._localId.value);if(o&&n&&!o.pass)return null;if(!o){const c=[];o={guid:Array.isArray(s._guid)?void 0:s._guid.value,pass:!1,checks:c},Object.defineProperty(o,"pass",{get:()=>c.every(({pass:h})=>h)}),r.set(s._localId.value,o)}const a=[],l={facetType:this.facetType,cardinality:this.cardinality,checks:a,pass:!1};return Object.defineProperty(l,"pass",{get:()=>a.every(({pass:c})=>c)}),o.checks.push(l),l.checks}};const Bi=(i,t)=>{let e="";if(!t)return e;if(t.type==="simple"&&(e=`<simpleValue>${t.parameter}</simpleValue>`),t.type==="enumeration"&&(e=`<xs:restriction base="xs:string">
    ${t.parameter.map(s=>`<xs:enumeration value="${s}" />`).join(`
`)}
    </xs:restriction>`),t.type==="pattern"&&(e=`<xs:restriction base="xs:string">
      <xs:pattern value="${t.parameter}" />
    </xs:restriction>`),t.type==="bounds"){const{min:s,minInclusive:n,max:r,maxInclusive:o}=t.parameter;let a="";s!==void 0&&(a=`<xs:min${n?"Inclusive":"Exclusive"} value="${s}">`);let l="";r!==void 0&&(l=`<xs:max${o?"Inclusive":"Exclusive"} value="${r}">`),e=`<xs:restriction base="xs:double">
      ${a}
      ${l}
    </xs:restriction>`}if(t.type==="length"){const{length:s,min:n,max:r}=t.parameter;let o="";s!==void 0&&n===void 0&&r===void 0&&(o=`<xs:length value="${s}" />`);let a="";n!==void 0&&s===void 0&&(a=`<xs:minLength value="${n}" />`);let l="";r!==void 0&&s===void 0&&(l=`<xs:maxLength value="${r}" />`),e=`<xs:restriction base="xs:string">
      ${o}
      ${a}
      ${l}
    </xs:restriction>`}return`<${i[0].toLowerCase()+i.slice(1)}>
    ${e}
  </${i[0].toLowerCase()+i.slice(1)}>`};let CC=class extends Er{constructor(t,e){super(t),E(this,"facetType","Attribute"),E(this,"name"),E(this,"value"),this.name=e}serialize(t){const e=Bi("Name",this.name),s=Bi("Value",this.value);let n="";return t==="requirement"&&(n+=`cardinality="${this.cardinality}"`,n+=this.instructions?`instructions="${this.instructions}"`:""),`<attribute ${n}>
  ${e}
  ${s}
</attribute>`}async getEntities(){}async test(t,e,s={skipIfFails:!0}){const n=this._components.get(ut);for(const[r,o]of Object.entries(t)){const a=n.list.get(r);if(!a)continue;const l=await a.getItemsData([...o]);for(const c of l){const h=this.getItemChecks(e,r,c,s.skipIfFails);if(!h)continue;const d=Object.keys(c).filter(p=>{const m=this.evalRequirement(p,this.name,"Name");if(!m)return!1;const f=c[p];return Array.isArray(f)?!0:f===null||f.value===null?this.cardinality==="optional"||this.cardinality==="prohibited":Array.isArray(f.value)&&f.value.length===0||typeof f.value=="string"&&f.value.trim()===""?!1:m}),u=d.length>0;if(h.push({parameter:"Name",currentValue:u?d[0]:null,requiredValue:this.name,pass:this.cardinality==="prohibited"?!u:u}),this.value)if(d[0]){const p=c[d[0]];Array.isArray(p)?h.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"}):Array.isArray(p.value)?h.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"}):this.evalRequirement(p.value,this.value,"Value",h)}else h.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"})}}}},SC=class extends Er{constructor(t,e){super(t),E(this,"facetType","Classification"),E(this,"system"),E(this,"value"),E(this,"uri"),this.system=e}serialize(t){const e=Bi("System",this.system),s=Bi("Value",this.value);let n="";return t==="requirement"&&(n+=`cardinality="${this.cardinality}"`,n+=this.uri?`uri=${this.uri}`:"",n+=this.instructions?`instructions="${this.instructions}"`:""),`<classification ${n}>
  ${e}
  ${s}
</classification>`}async getEntities(t,e){}async test(t,e){}},bd=class extends Er{constructor(t,e){super(t),E(this,"facetType","Entity"),E(this,"name"),E(this,"predefinedType"),this.name=e}serialize(t){const e=Bi("Name",this.name),s=Bi("Name",this.predefinedType);let n="";return t==="requirement"&&(n+=`cardinality="${this.cardinality}"`,n+=this.instructions?`instructions="${this.instructions}"`:""),`<entity ${n}>
  ${e}
  ${s}
</entity>`}async getEntities(t,e){const s=this._components.get(ut),n=new Map;for(const[o,a]of s.list){if(!t.find(c=>c.test(o)))continue;const l=await a.getCategories();for(const c of l){if(!await this.evalName(c))continue;let h=n.get(o);h||(h=[],n.set(o,h)),h.push(c)}}const r={};if(await Promise.all(Array.from(n.entries()).map(async([o,a])=>{const l=s.list.get(o);if(!l)return;const c=a.map(u=>new RegExp(`^${u}$`)),h=await l.getItemsOfCategories(c),d=Object.values(h).flat();r[o]=new Set(d)})),!this.predefinedType){Rt.add(e,r);return}for(const[o,a]of Object.entries(r)){const l=s.list.get(o);if(!l)continue;const c=await l.getItemsData([...a]);for(const h of c)"value"in h._localId&&await this.evalPredefinedType(o,h)&&Rt.append(e,o,h._localId.value)}}async test(t,e,s){const n=this._components.get(ut);for(const[r,o]of Object.entries(t)){const a=n.list.get(r);if(!a)continue;const l=await a.getItemsData([...o]);for(const c of l){if(!("value"in c._category))continue;const h=this.getItemChecks(e,r,c,s.skipIfFails);h&&(await this.evalName(c._category.value,h),await this.evalPredefinedType(r,c,h))}}}async evalName(t,e){return this.evalRequirement(t,this.name,"Name",e)}async evalPredefinedType(t,e,s){if(!this.predefinedType||!("value"in e.PredefinedType))return null;const n=typeof this.predefinedType.parameter=="string"&&this.predefinedType.parameter==="USERDEFINED";let r=e.PredefinedType.value;if(r==="USERDEFINED"&&!n){const o=Object.keys(e).find(a=>/^((?!Predefined).)*Type$/.test(a));if(o){const a=e[o];"value"in a&&(r=a.value)}else r="USERDEFINED"}if(!r){const o=this._components.get(ut).list.get(t);if(o&&"value"in e._localId){const[a]=await o.getItemsData([e._localId.value],{relations:{IsTypedBy:{attributes:!0,relations:!1}}});if(Array.isArray(a.IsTypedBy)){const l=a.IsTypedBy[0];if(l&&"value"in l.PredefinedType&&(r=l.PredefinedType.value,r==="USERDEFINED"&&!n)){const c=Object.keys(l).find(h=>/^((?!Predefined).)*Type$/.test(h));if(c){const h=l[c];"value"in h&&(r=h.value)}else r="USERDEFINED"}}}}return this.evalRequirement(r,this.predefinedType,"PredefinedType",s)}},EC=class extends Er{constructor(t,e,s){super(t),E(this,"facetType","Property"),E(this,"propertySet"),E(this,"baseName"),E(this,"value"),E(this,"dataType"),E(this,"uri"),E(this,"_unsupportedTypes",["IFCCOMPLEXPROPERTY","IFCPHYSICALCOMPLEXQUANTITY"]),this.propertySet=e,this.baseName=s}serialize(t){const e=Bi("PropertySet",this.propertySet),s=Bi("BaseName",this.baseName),n=Bi("Value",this.value),r=this.dataType?`dataType=${this.dataType}`:"";let o="";return t==="requirement"&&(o+=`cardinality="${this.cardinality}"`,o+=this.uri?`uri=${this.uri}`:"",o+=this.instructions?`instructions="${this.instructions}"`:""),`<property ${r} ${o}>
  ${e}
  ${s}
  ${n}
</property>`}async getEntities(t,e){const s=this._components.get(ut);for(const[n,r]of s.list){if(!t.find(c=>c.test(n)))continue;const o=await r.getItemsOfCategories([/PROPERTYSET/,/ELEMENTQUANTITY/]),a=Object.values(o).flat();if(a.length===0)continue;const l=await r.getItemsData(a,{relations:{HasProperties:{attributes:!0,relations:!1},DefinesOcurrence:{attributes:!0,relations:!1}}});for(const c of l){if(!("value"in c._localId&&"value"in c._category&&"value"in c.Name&&Array.isArray(c.DefinesOcurrence))||!this.evalRequirement(c.Name.value,this.propertySet,"PropertySet"))continue;let h;if(c._category.value==="IFCPROPERTYSET"&&(h="HasProperties"),c._category.value==="IFCELEMENTQUANTITY"&&(h="Quantities"),!h)continue;const d=c[h];if(Array.isArray(d))for(const u of d){const p=Object.keys(u),m=p.find(g=>/Name/.test(g));if(!(m&&"value"in u[m]))continue;const f=u[m];if(!("value"in f)||!this.evalRequirement(f.value,this.baseName,"BaseName"))continue;if(this.value){const g=p.find(v=>/Value/.test(v));if(!g)continue;const y=u[g];if(!("value"in y)||!this.evalRequirement(y.value,this.value,"Value"))continue}const b=c.DefinesOcurrence.map(g=>"value"in g._localId&&typeof g._localId.value=="number"?g._localId.value:null).filter(g=>g!==null);Rt.append(e,n,...b)}}}}async test(t,e,s={skipIfFails:!0}){const n=this._components.get(ut);for(const[r,o]of Object.entries(t)){const a=n.list.get(r);if(!a)continue;const l=await a.getItemsData([...o],{relations:{IsDefinedBy:{attributes:!0,relations:!0},IsTypedBy:{attributes:!0,relations:!1},HasPropertySets:{attributes:!0,relations:!0},DefinesOcurrence:{attributes:!1,relations:!1}}});for(const c of l){const h=this.getItemChecks(e,r,c,s.skipIfFails);if(!h)continue;const d=(await this.getPsets(c)).filter(u=>!("value"in u.Name)||!this.evalRequirement(u.Name.value,this.propertySet,"PropertySet")?!1:(h.push({currentValue:u.Name.value,parameter:"PropertySet",pass:!0,requiredValue:this.propertySet}),!0));if(d.length===0){h.push({currentValue:null,parameter:"PropertySet",pass:!1,requiredValue:this.propertySet});continue}for(const u of d){const p=this.getPropertyListName(u);if(!p)continue;const m=u[p];if(!Array.isArray(m)){h.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName});continue}const f=m.filter(b=>!("value"in b._category&&"value"in b.Name)||this._unsupportedTypes.includes(b._category.value)||!this.evalRequirement(b.Name.value,this.baseName,"BaseName")?!1:(h.push({currentValue:b.Name.value,parameter:"BaseName",pass:!0,requiredValue:this.baseName}),!0));if(f.length===0){h.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName});continue}for(const b of f)this.evalValue(b,h),this.evalDataType(b,h),this.evalURI()}}}}getPropertyListName(t){let e;return"value"in t._category&&(t._category.value==="IFCPROPERTYSET"&&(e="HasProperties"),t._category.value==="IFCELEMENTQUANTITY"&&(e="Quantities")),e}getValueKey(t){return Object.keys(t).find(e=>/Value/.test(e)||/Values/.test(e))}getTypePsets(t){if(!Array.isArray(t.IsTypedBy))return[];const[e]=t.IsTypedBy;return e&&Array.isArray(e.HasPropertySets)?e.HasPropertySets:[]}async getPsets(t){const e=this.getTypePsets(t);if(!Array.isArray(t.IsDefinedBy))return e;const s=[];for(const n of t.IsDefinedBy){if(!("value"in n.Name))continue;const r=n.Name.value,o=this.getPropertyListName(n);if(!(r&&o))continue;const a=e.find(l=>"value"in l.Name?l.Name.value===r:!1);if(a&&Array.isArray(a.HasProperties)&&Array.isArray(n.HasProperties))for(const l of a.HasProperties){if(!("value"in l.Name))continue;const c=l.Name.value;n.HasProperties.find(h=>"value"in h.Name?h.Name.value===c:!1)||n.HasProperties.push(l)}s.push(n)}return s}evalValue(t,e){const s=this.getValueKey(t),n=t[s];if(!("value"in n))return!1;if(this.value){if(!s)return e==null||e.push({parameter:"Value",currentValue:null,pass:!1,requiredValue:this.value}),!1;const r=structuredClone(this.value);return n.type==="IFCLABEL"&&r.type==="simple"&&(r.parameter=String(r.parameter)),this.evalRequirement(n.value,r,"Value",e)}return s&&typeof n.value=="string"&&n.value.trim()===""?(e==null||e.push({parameter:"Value",currentValue:"",pass:!1,requiredValue:this.value}),!1):!0}evalDataType(t,e){if(!this.dataType)return!0;const s=this.getValueKey(t);if(!(s&&"value"in t[s]))return e==null||e.push({parameter:"DataType",currentValue:null,pass:!1,requiredValue:this.dataType}),!1;const n=t[s];return this.evalRequirement(n.type??null,{type:"simple",parameter:this.dataType},"DataType",e)}evalURI(){return!0}},kC=class extends Er{constructor(){super(...arguments),E(this,"_ifcMaterialEntities",[/^IFCMATERIALLAYERSETUSAGE$/,/^IFCMATERIALCONSTITUENTSET$/,/^IFCMATERIAL$/,/^IFCMATERIALLIST$/]),E(this,"facetType","Material"),E(this,"value"),E(this,"uri")}serialize(t){if(!(this.value&&this.uri))return"<material />";const e=Bi("Value",this.value);let s="";return t==="requirement"&&(s+=`cardinality="${this.cardinality}"`,s+=this.uri?`uri=${this.uri}`:"",s+=this.instructions?`instructions="${this.instructions}"`:""),`<material ${s}>
  ${e}
</material>`}async getEntities(t,e){const s=this._components.get(ut);for(const[n,r]of s.list){if(!t.find(c=>c.test(n)))continue;const o=await r.getItemsOfCategories(this._ifcMaterialEntities),a=Object.values(o).flat();if(a.length===0)continue;const l=await r.getItemsData(a,{relations:{AssociatedTo:{attributes:!0,relations:!1},MaterialConstituents:{attributes:!0,relations:!0},ForLayerSet:{attributes:!0,relations:!0},MaterialLayers:{attributes:!0,relations:!0},Materials:{attributes:!0,relations:!1}}});for(const c of l){if(!("value"in c._localId&&"value"in c._category&&Array.isArray(c.AssociatedTo))||!this.hasValidMaterial(c))continue;const h=c.AssociatedTo.map(d=>"value"in d._localId&&d._localId.value?d._localId.value:null).filter(d=>d!==null);Rt.append(e,n,...h)}}}async test(t,e,s={skipIfFails:!0}){const n=this._components.get(ut);for(const[r,o]of Object.entries(t)){const a=n.list.get(r);if(!a)continue;const l=await a.getItemsData([[...o][0]],{relations:{AssociatedTo:{attributes:!1,relations:!1},HasAssociations:{attributes:!0,relations:!0},MaterialConstituents:{attributes:!0,relations:!0},ForLayerSet:{attributes:!0,relations:!0},MaterialLayers:{attributes:!0,relations:!0},Materials:{attributes:!0,relations:!1}}});for(const c of l){const h=this.getItemChecks(e,r,c,s.skipIfFails);if(h){if(!Array.isArray(c.HasAssociations)){h.push({parameter:null,currentValue:null,requiredValue:this.value,pass:!1});continue}for(const d of c.HasAssociations)if(this._ifcMaterialEntities.some(u=>"value"in d._category?u.test(d._category.value):!1)&&this.hasValidMaterial(d,h))break}}}}hasValidMaterial(t,e){let s=!1;if("value"in t._category&&t._category.value==="IFCMATERIAL")this.evalValue(t,e)&&(s=!0);else for(const[n,r]of Object.entries(t))if(["ForLayerSet","MaterialLayers","Material","MaterialConstituents","Materials"].includes(n)&&Array.isArray(r)){for(const o of r)if("value"in o._category&&o._category.value==="IFCMATERIAL"){if(this.evalValue(o,e)){s=!0;break}}else if(this.hasValidMaterial(o)){s=!0;break}}return s}evalValue(t,e){if(!this.value)return e==null||e.push({parameter:null,currentValue:t.Name&&"value"in t.Name?t.Name.value:null,pass:!0}),!0;if(!("value"in t._category&&t._category.value==="IFCMATERIAL"))return null;let s=!1;return t.Name&&"value"in t.Name&&(s=this.evalRequirement(t.Name.value,this.value,"Value",e)),s||(t.Category&&"value"in t.Category&&(s=this.evalRequirement(t.Category.value,this.value,"Value",e)),s)}},AC=class extends Er{constructor(t,e){super(t),E(this,"facetType","PartOf"),E(this,"_entityFacet"),E(this,"_entity"),E(this,"relation"),E(this,"cardinality","required"),this._entity=e,this._entityFacet=new bd(t,e.name),this._entityFacet.predefinedType=e.predefinedType}set entity(t){this._entity=t;const{name:e,predefinedType:s}=t;this._entityFacet=new bd(this._components,e),this._entityFacet.predefinedType=s}get entity(){return this._entity}serialize(){return""}async getEntities(t,e){}async test(t){}},TC=class{constructor(t,e,s){E(this,"name"),E(this,"ifcVersion",new Set),E(this,"identifier",_e.create()),E(this,"description"),E(this,"instructions"),E(this,"requirementsDescription"),E(this,"applicability",new se),E(this,"requirements",new se),E(this,"components"),this.components=t,this.name=e;for(const n of s)this.ifcVersion.add(n)}set(t){const e=t,s=this;for(const n in t){if(n==="identifier")continue;const r=e[n];n in this&&(s[n]=r)}return this.components.get(MC).list.set(this.identifier,this),this}async test(t,e={skipIfFails:!0}){const s=new It;if(this.requirements.size===0)return s;const n={},r=[];for(const a of this.applicability)r.push(a.getEntities(t,n));await Promise.all(r);const o=[];for(const a of this.requirements)o.push(a.test(n,s,e));return await Promise.all(o),s}serialize(){const t=`name="${this.name}"`,e=this.identifier?`identifier="${this.identifier}"`:"",s=this.description?`description="${this.description}"`:"",n=this.instructions?`instructions="${this.instructions}"`:"";return`<specification ifcVersion="${[...this.ifcVersion].join(" ")}" ${t} ${e} ${s} ${n}>
      <applicability minOccurs="1" maxOccurs="unbounded">
        ${[...this.applicability].map(r=>r.serialize("applicability")).join(`
`)}
      </applicability>
      <requirements>
        ${[...this.requirements].map(r=>r.serialize("requirement")).join(`
`)}
      </requirements>
    </specification>`}};const di=i=>{if(!i)return;const t={};if("simpleValue"in i&&(t.type="simple",t.parameter=i.simpleValue),"restriction"in i){const e=i.restriction,s=Object.keys(e);if("pattern"in e&&(t.type="pattern",t.parameter=e.pattern.value),"enumeration"in e){t.type="enumeration";const n=e.enumeration.map(({value:r})=>e.base.includes("string")?String(r):e.base.includes("integer")||e.base.includes("double")?Number(r):r);t.parameter=n}if(s.some(n=>["minInclusive","minExclusive","maxInclusive","maxExclusive"].includes(n))){t.type="bounds";const n={},r=s.find(a=>a.includes("min")),o=s.find(a=>a.includes("max"));r&&(n.minInclusive=r==="minInclusive",n.min=e[r].value),o&&(n.maxInclusive=o==="maxInclusive",n.max=e[o].value),t.parameter=n}if(s.some(n=>["minLength","length","maxLength"].includes(n))){t.type="length";const n={};e.length!==void 0&&(n.length=e.length.value),e.minLength!==void 0&&(n.min=e.minLength.value),e.maxLength!==void 0&&(n.max=e.maxLength.value),t.parameter=n}}if(t.parameter!==void 0)return t},nf=(i,t)=>{const e=[];for(const s of t){const n=s.name,r=di(n);if(!r)continue;const o=new bd(i,r);s.cardinality&&(o.cardinality=s.cardinality),o.predefinedType=di(s.predefinedType),o.instructions=s.instructions,e.push(o)}return e},rf=(i,t)=>{const e=[];for(const s of t){const n=s.name,r=di(n);if(!r)continue;const o=new CC(i,r);s.cardinality&&(o.cardinality=s.cardinality),o.value=di(s.value),o.instructions=s.instructions,e.push(o)}return e},of=(i,t)=>{const e=[];for(const s of t){const n=new kC(i);s.cardinality&&(n.cardinality=s.cardinality);const r=di(s.value);(r==null?void 0:r.type)==="enumeration"&&Array.isArray(r.parameter)&&(r.parameter=r.parameter.map(String)),n.value=r,n.uri=s.uri,n.instructions=s.instructions,e.push(n)}return e},af=(i,t)=>{const e=[];for(const s of t){const n=s.propertySet,r=s.baseName,o=di(n),a=di(r);if(!(a&&o))continue;const l=new EC(i,o,a);s.cardinality&&(l.cardinality=s.cardinality);const c=di(s.value);l.value=c,l.dataType=s.dataType,l.uri=s.uri,l.instructions=s.instructions,e.push(l)}return e},lf=(i,t)=>{const e=[];for(const s of t){const n=s.system,r=di(n);if(!r)continue;const o=new SC(i,r);s.cardinality&&(o.cardinality=s.cardinality);const a=di(s.value);(a==null?void 0:a.type)==="simple"&&(a.parameter=String(a.parameter)),(a==null?void 0:a.type)==="enumeration"&&Array.isArray(a.parameter)&&(a.parameter=a.parameter.map(String)),o.value=a,o.uri=s.uri,o.instructions=s.instructions,e.push(o)}return e},cf=(i,t)=>{const e=[];for(const s of t){const n=di(s.entity.name);if(!n)continue;const r=di(s.entity.predefinedType),o=new AC(i,{name:n,predefinedType:r});o.relation=s.relation,s.cardinality&&(o.cardinality=s.cardinality),o.instructions=s.instructions,e.push(o)}return e},vu=class yd extends zt{constructor(t){super(t),E(this,"enabled",!0),E(this,"IDSInfo"),E(this,"list",new It),t.add(yd.uuid,this)}getModelIdMap(t){const e={},s={};for(const[n,r]of t){const o=[...r].filter(([,l])=>l.pass).map(([l])=>l);Rt.append(e,n,...o);const a=[...r].filter(([,l])=>!l.pass).map(([l])=>l);Rt.append(s,n,...a)}return{pass:e,fail:s}}create(t,e,s){const n=new TC(this.components,t,e);return s&&(n.identifier=s),this.list.set(n.identifier,n),n}load(t){const e=[],s=yd.xmlParser.parse(t).ids,{specifications:n,info:r}=s;if(this.IDSInfo={...r},n&&n.specification){const o=Array.isArray(n.specification)?n.specification:[n.specification];for(const a of o){const{name:l,ifcVersion:c,description:h,instructions:d,identifier:u}=a;if(!(l&&c))continue;const p=[],m=[],{applicability:f,requirements:b}=a;if(f){const{maxOccurs:v,..._}=f,x=Array.isArray(_)?_:[_];for(const S of x)for(const k in S){const T=Array.isArray(S[k])?S[k]:[S[k]];if(k==="entity"){const M=nf(this.components,T);p.push(...M)}if(k==="attribute"){const M=rf(this.components,T);p.push(...M)}if(k==="material"){const M=of(this.components,T);p.push(...M)}if(k==="classification"){const M=lf(this.components,T);p.push(...M)}if(k==="property"){const M=af(this.components,T);p.push(...M)}if(k==="partOf"){const M=cf(this.components,T);p.push(...M)}}}let g;if(b){const{maxOccurs:v,..._}=b;g=b.description;const x=Array.isArray(_)?_:[_];for(const S of x)for(const k in S){const T=Array.isArray(S[k])?S[k]:[S[k]];if(k==="entity"){const M=nf(this.components,T);m.push(...M)}if(k==="attribute"){const M=rf(this.components,T);m.push(...M)}if(k==="material"){const M=of(this.components,T);m.push(...M)}if(k==="classification"){const M=lf(this.components,T);m.push(...M)}if(k==="property"){const M=af(this.components,T);m.push(...M)}if(k==="partOf"){const M=cf(this.components,T);m.push(...M)}}}const y=this.create(l,c.split(/\s+/),u);y.description=h,y.instructions=d,y.requirementsDescription=g,y.applicability.add(...p),y.requirements.add(...m),e.push(y)}}return e}export(t,e=this.list.values()){const s=e??this.list;return`<ids xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://standards.buildingsmart.org/IDS http://standards.buildingsmart.org/IDS/1.0/ids.xsd" xmlns:ids="http://standards.buildingsmart.org/IDS">
  <!-- Made with That Open Engine ${jb.release} (https://github.com/thatopen/engine_components) -->
  <info>
    <title>${t.title}</title>
    ${t.copyright?`<copyright>${t.copyright}</copyright>`:""}
    ${t.version?`<version>${t.version}</version>`:""}
    ${t.description?`<description>${t.description}</description>`:""}
    ${t.author?`<author>${t.author}</author>`:""}
    ${t.date?`<date>${t.date.toISOString().split("T")[0]}</date>`:""}
    ${t.purpose?`<purpose>${t.purpose}</purpose>`:""}
    ${t.milestone?`<milestone>${t.milestone}</milestone>`:""}
  </info>
  <specifications>
    ${[...s].map(n=>n.serialize()).join(`
`)}
  </specifications>
</ids>`}};E(vu,"uuid","9f0b9f78-9b2e-481a-b766-2fbfd01f342c");E(vu,"xmlParser",new wc.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let MC=vu;const Kb=class Qb extends zt{constructor(t){super(t),E(this,"enabled",!0),t.add(Qb.uuid,this)}static distanceFromPointToLine(t,e,s,n=!1){const r=new ti,o=new L;return r.set(e,s),r.closestPointToPoint(t,n,o),o.distanceTo(t)}round(t){t.x=Math.trunc(t.x*1e3)/1e3,t.y=Math.trunc(t.y*1e3)/1e3,t.z=Math.trunc(t.z*1e3)/1e3}async getVolumeFromFragments(t){return console.warn("getVolumeFromFragments is deprecated. Use getItemsVolume instead."),this.getItemsVolume(t)}async getItemsVolume(t){let e=0;const s=this.components.get(ut);for(const[n,r]of Object.entries(t)){const o=s.list.get(n);o&&(e+=await o.getItemsVolume([...r]))}return e}static convertUnits(t,e,s,n=2){const r={m:1,cm:.01,mm:.001,km:1e3,m2:1,cm2:1e-4,mm2:1e-6,km2:1e6,m3:1,cm3:1e-6,mm3:1e-9,km3:1e9};if(!r[e]||!r[s])throw new Error("Invalid units provided for conversion.");if(!Number.isInteger(n)||n<0||n>5)throw new Error("Precision must be an integer between 0 and 5.");let o=r[e]/r[s];const a=t*o,l=10**n;return Math.round(a*l)/l}};E(Kb,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");let lr=Kb;const PC=class Jb extends zt{constructor(t){super(t),P(this,"enabled",!0),P(this,"inputs",["OBC","BUI"]),P(this,"_requestEventID","thatOpenCompanyComponentRequested"),P(this,"_createEventID","thatOpenCompanyComponentCreated"),t.add(Jb.uuid,this)}async import(t){return new Promise(e=>{const s=document.createElement("script"),n=`
        function loader() {
          const { ${this.inputs} } = window.ThatOpenCompany;
        
          ${t}
        
          const onComponentRequested = () => {
            window.removeEventListener("${this._requestEventID}", onComponentRequested);
            const event = new CustomEvent("${this._createEventID}", { detail: main });
            window.dispatchEvent(event);
          };
          
          window.addEventListener("${this._requestEventID}", onComponentRequested);
        }
        
        loader();
      `,r=o=>{window.removeEventListener(this._createEventID,r);const{componentDefinition:a}=o.detail;let l=null;if(a){const c=a;l=this.components.get(c)}s.remove(),e(l)};s.addEventListener("load",()=>{window.addEventListener(this._createEventID,r),window.dispatchEvent(new Event(this._requestEventID))}),s.src=URL.createObjectURL(new File([n],"temp.js")),document.head.appendChild(s)})}};P(PC,"uuid","74c0c370-1af8-4ca9-900a-4a4196c0f2f5");let ty=class extends ar{constructor(t=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Kt(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&e.element.parentNode!==null&&e.element.remove()})})}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this.center=t.center,this}};const qn=new L,hf=new Pt,df=new Pt,uf=new L,pf=new L;let $C=class{constructor(t={}){const e=this;let s,n,r,o;const a={objects:new WeakMap},l=t.element!==void 0?t.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:s,height:n}},this.render=function(m,f){m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),f.parent===null&&f.matrixWorldAutoUpdate===!0&&f.updateMatrixWorld(),hf.copy(f.matrixWorldInverse),df.multiplyMatrices(f.projectionMatrix,hf),h(m,m,f),p(m)},this.setSize=function(m,f){s=m,n=f,r=s/2,o=n/2,l.style.width=m+"px",l.style.height=f+"px"};function c(m){m.isCSS2DObject&&(m.element.style.display="none");for(let f=0,b=m.children.length;f<b;f++)c(m.children[f])}function h(m,f,b){if(m.visible===!1){c(m);return}if(m.isCSS2DObject){qn.setFromMatrixPosition(m.matrixWorld),qn.applyMatrix4(df);const g=qn.z>=-1&&qn.z<=1&&m.layers.test(b.layers)===!0,y=m.element;y.style.display=g===!0?"":"none",g===!0&&(m.onBeforeRender(e,f,b),y.style.transform="translate("+-100*m.center.x+"%,"+-100*m.center.y+"%)translate("+(qn.x*r+r)+"px,"+(-qn.y*o+o)+"px)",y.parentNode!==l&&l.appendChild(y),m.onAfterRender(e,f,b));const v={distanceToCameraSquared:d(b,m)};a.objects.set(m,v)}for(let g=0,y=m.children.length;g<y;g++)h(m.children[g],f,b)}function d(m,f){return uf.setFromMatrixPosition(m.matrixWorld),pf.setFromMatrixPosition(f.matrixWorld),uf.distanceToSquared(pf)}function u(m){const f=[];return m.traverseVisible(function(b){b.isCSS2DObject&&f.push(b)}),f}function p(m){const f=u(m).sort(function(g,y){if(g.renderOrder!==y.renderOrder)return y.renderOrder-g.renderOrder;const v=a.objects.get(g).distanceToCameraSquared,_=a.objects.get(y).distanceToCameraSquared;return v-_}),b=f.length;for(let g=0,y=f.length;g<y;g++)f[g].element.style.zIndex=b-g}}},Os=class{constructor(t,e,s){P(this,"three"),P(this,"world"),P(this,"wasVisible",!0),P(this,"onDisposed",new et),this.world=t;let n;if(e)n=e;else{n=document.createElement("div");const r="6px";n.style.color="white",n.style.height=r,n.style.width=r,n.style.borderRadius="50%",n.style.border="2px solid rgb(122, 75, 209)",n.style.zIndex="-20"}this.three=new ty(n),(s||t.scene.three).add(this.three),this.visible=!0}set visible(t){this.three.visible=t,this.wasVisible=t}get visible(){return this.three.visible}toggleVisibility(){this.visible=!this.visible}notDisplay(){this.visible=!1}dispose(){this.three.removeFromParent(),this.three.element.remove(),this.onDisposed.trigger(),this.onDisposed.reset()}},OC=class extends Hx{constructor(t,e,s){super(t,e,s),P(this,"three2D",new $C),this.onAfterUpdate.add(()=>{if(this.onBeforeUpdate.trigger(this),!this.enabled||!this.currentWorld)return;const n=this.currentWorld.scene.three,r=this.currentWorld.camera.three;n instanceof Q0&&this.three2D.render(n,r)}),this.onDisposed.add(()=>{this.three2D.domElement.remove()}),this.onResize.add(({x:n,y:r})=>{this.three2D.setSize(n,r)}),this.setupHtmlRenderer(),this.resize()}setupHtmlRenderer(){this.three2D.domElement.style.position="absolute",this.three2D.domElement.style.top="0px",this.three2D.domElement.style.pointerEvents="none",this.container&&(this.container.appendChild(this.three2D.domElement),this.container.style.position="relative")}};const ff=class vd extends zt{constructor(t){super(t),P(this,"onDisposed",new et),P(this,"enabled",!0),P(this,"threshold",50),P(this,"autoCluster",!0),P(this,"clusterElementStyles",{...vd.DEFAULT_CLUSTER_STYLES}),P(this,"list",new Map),P(this,"clusterLabels",new Set),P(this,"currentKeys",new Set),P(this,"_color","white"),P(this,"_markerKey",0),P(this,"_clusterKey",0),P(this,"_worldEvents",new Map),P(this,"_setupWorlds",new Set),P(this,"clusterElementFactory",()=>{const e=document.createElement("div");return e.style.color="#000000",e.style.background="#FFFFFF",e.style.fontSize="1.2rem",e.style.fontWeight="500",e.style.borderRadius="50%",e.style.padding="5px 11px",e.style.textAlign="center",e.addEventListener("pointerover",()=>{e.style.background=this.clusterElementStyles.hoverBackgroundColor||"#BCF124"}),e.addEventListener("pointerout",()=>{e.style.background=this.clusterElementStyles.backgroundColor||"#FFFFFF"}),e}),t.add(vd.uuid,this)}get color(){return this._color}set color(t){this._color=t;for(const[e,s]of this.list)for(const[n,r]of s)r.label.three.element.style.color=t}create(t,e,s,n=!1){this.setupEvents(t,!0);const r=this._markerKey.toString(),o=this.getWorldMarkerList(t);if(o.has(r))return null;const a=document.createElement("span");a.append(e);const l=new Os(t,a);return l.three.position.copy(s),o.set(r,{key:r,label:l,merged:!1,static:n}),this._markerKey++,r}delete(t){for(const[e,s]of this.list){const n=s.get(t);n&&n.label.dispose(),s.delete(t)}}getWorldMarkerList(t){return this.list.has(t.uuid)||this.list.set(t.uuid,new Map),this.list.get(t.uuid)}dispose(t){for(const[e,s]of this.list){const n=[...s.keys()];for(const r of n){const o=s.get(r);t&&o.type!==t||(o.label.dispose(),s.delete(r))}}if(!t){this.list.clear(),this._markerKey=0;for(const e of this.clusterLabels)e.label.dispose();this.clusterLabels.clear(),this._clusterKey=0,this.currentKeys.clear()}this.onDisposed.trigger()}setupEvents(t,e){if(e&&this._setupWorlds.has(t.uuid)||!t.camera.hasCameraControls())return;const s=this.getWorldEvent(t);t.camera.controls.removeEventListener("sleep",s),t.camera.controls.removeEventListener("rest",s),e&&(t.camera.controls.addEventListener("sleep",s),t.camera.controls.addEventListener("rest",s))}cluster(t){if(!this.autoCluster)return;this.resetMarkers();const e=this.list.get(t.uuid);if(e){for(const[s,n]of e)if(!n.merged&&!n.static){this.currentKeys.clear();for(const[r,o]of e)o.static||n.key!==o.key&&!o.merged&&this.distance(n.label,o.label)<this.threshold&&(this.currentKeys.add(o.key),o.merged=!0);if(this.currentKeys.size>0){this.currentKeys.add(n.key),n.merged=!0;const r=Array.from(this.currentKeys),o=this.getAveragePositionFromLabels(r),a=new Os(n.label.world,this.createClusterElement(this._clusterKey.toString())),{element:l}=a.three;l.firstChild.textContent=r.length.toString(),a.three.position.copy(o),this.clusterLabels.add({key:this._clusterKey.toString(),markerKeys:r,label:a}),this._clusterKey++}}this.removeMergeMarkers(t)}}getWorldEvent(t){if(!this._worldEvents.has(t.uuid)){const e=()=>{this.cluster(t)};this._worldEvents.set(t.uuid,e)}return this._worldEvents.get(t.uuid)}resetMarkers(){for(const[t,e]of this.list)for(const[s,n]of e)n.merged=!1;for(const t of this.clusterLabels)t.label.dispose();this.clusterLabels.clear(),this._clusterKey=0}removeMergeMarkers(t){const e=this.list.get(t.uuid);if(e){for(const[s,n]of e)n.merged?n.label.dispose():n.label.world.scene.three.add(n.label.three);for(const s of this.clusterLabels)if(s.markerKeys.length===1){for(const[n,r]of this.list){const o=r.get(s.markerKeys[0]);o&&(o.label.world.scene.three.add(o.label.three),o.merged=!1)}s.label.dispose(),this.clusterLabels.delete(s)}}}getAveragePositionFromLabels(t){const e=t.map(s=>{for(const[n,r]of this.list){const o=r.get(s);if(o)return o.label.three.position}return new L});return e.reduce((s,n)=>s.add(n),new L).divideScalar(e.length)}createClusterElement(t){const e=this.clusterElementFactory();e.textContent=t;const s=document.createElement("span");return s.append(e),s.style.pointerEvents="auto",s.style.cursor="pointer",s.addEventListener("pointerdown",()=>{this.navigateToCluster(t)}),s}getScreenPosition(t){const e=new L;if(!t.world.renderer)throw new Error("Renderer not found!");const s=t.three.position.clone();s.project(t.world.camera.three);const n=t.world.renderer.getSize();return e.x=s.x*n.x/2+n.x/2,e.y=-(s.y*n.y/2)+n.y/2,e}distance(t,e){const s=this.getScreenPosition(t),n=this.getScreenPosition(e),r=s.x-n.x,o=s.y-n.y,a=Math.sqrt(r*r+o*o)*.5;return a===0?this.threshold+1:a}navigateToCluster(t){const e=[],s=Array.from(this.clusterLabels).find(c=>c.key===t);if(!s)return;const n=s.label.world.camera;if(!n.hasCameraControls()){console.warn("Zoom to clusters only supported with Camera Controls!");return}for(const c of s.markerKeys)for(const[h,d]of this.list){const u=d.get(c);if(u){const{x:p,y:m,z:f}=u.label.three.position;e.push(p,m,f)}}s.label.dispose(),this.clusterLabels.delete(s);const r=new xe,o=new Float32Array(e),a=new Je(o,3);r.setAttribute("position",a);const l=new at(r);l.geometry.computeBoundingSphere(),l.geometry.boundingSphere&&n.controls.fitToSphere(l,!0),r.dispose(),l.clear(),e.length=0}};P(ff,"uuid","4079eb91-79b0-4ede-bcf2-15b837129236"),P(ff,"DEFAULT_CLUSTER_STYLES",{backgroundColor:"#FFFFFF",textColor:"#000000",fontSize:"1.2rem",fontWeight:"500",borderRadius:"50%",padding:"5px 11px",textAlign:"center",cursor:"pointer",hoverBackgroundColor:"#BCF124",transition:void 0});new bc(-1,1,1,-1,0,1);let DC=class extends xe{constructor(){super(),this.setAttribute("position",new Ns([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Ns([0,2,0,0,2,0],2))}};new DC;new Kt,new Pt,new Pt,new Pt,new L(-1,-1,-1),new L(1,1,1);IC(16,2,1),new Kt,new Pt;function IC(i,t,e){const s=zC(i,t,e);let n="vec3[SAMPLES](";for(let r=0;r<i;r++){const o=s[r];n+=`vec3(${o.x}, ${o.y}, ${o.z})${r<i-1?",":")"}`}return n}function zC(i,t,e){const s=[];for(let n=0;n<i;n++){const r=2*Math.PI*t*n/i,o=Math.pow(n/(i-1),e);s.push(new L(Math.cos(r),Math.sin(r),o))}return s}new Kt(1/1024,1/512);new Kt(1/1024,1/512);new Kt(1/1024,1/512);const mf=new oe,Xa=new L;let _u=class extends j0{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],s=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(s),this.setAttribute("position",new Ns(t,3)),this.setAttribute("uv",new Ns(e,2))}applyMatrix4(t){const e=this.attributes.instanceStart,s=this.attributes.instanceEnd;return e!==void 0&&(e.applyMatrix4(t),s.applyMatrix4(t),e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));const s=new Kh(e,6,1);return this.setAttribute("instanceStart",new Qn(s,3,0)),this.setAttribute("instanceEnd",new Qn(s,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));const s=new Kh(e,6,1);return this.setAttribute("instanceColorStart",new Qn(s,3,0)),this.setAttribute("instanceColorEnd",new Qn(s,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new V0(t.geometry)),this}fromLineSegments(t){const e=t.geometry;return this.setPositions(e.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new oe);const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;t!==void 0&&e!==void 0&&(this.boundingBox.setFromBufferAttribute(t),mf.setFromBufferAttribute(e),this.boundingBox.union(mf))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Rs),this.boundingBox===null&&this.computeBoundingBox();const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(t!==void 0&&e!==void 0){const s=this.boundingSphere.center;this.boundingBox.getCenter(s);let n=0;for(let r=0,o=t.count;r<o;r++)Xa.fromBufferAttribute(t,r),n=Math.max(n,s.distanceToSquared(Xa)),Xa.fromBufferAttribute(e,r),n=Math.max(n,s.distanceToSquared(Xa));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}};wl.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Kt(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};xl.line={uniforms:Gg.merge([wl.common,wl.fog,wl.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};let wu=class extends Xg{constructor(t){super({type:"LineMaterial",uniforms:Gg.clone(xl.line.uniforms),vertexShader:xl.line.vertexShader,fragmentShader:xl.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(t)}get color(){return this.uniforms.diffuse.value}set color(t){this.uniforms.diffuse.value=t}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(t){this.uniforms.linewidth&&(this.uniforms.linewidth.value=t)}get dashed(){return"USE_DASH"in this.defines}set dashed(t){t===!0!==this.dashed&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(t){this.uniforms.dashScale.value=t}get dashSize(){return this.uniforms.dashSize.value}set dashSize(t){this.uniforms.dashSize.value=t}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(t){this.uniforms.dashOffset.value=t}get gapSize(){return this.uniforms.gapSize.value}set gapSize(t){this.uniforms.gapSize.value=t}get opacity(){return this.uniforms.opacity.value}set opacity(t){this.uniforms&&(this.uniforms.opacity.value=t)}get resolution(){return this.uniforms.resolution.value}set resolution(t){this.uniforms.resolution.value.copy(t)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(t){this.defines&&(t===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),t===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}};const wh=new xr,gf=new L,bf=new L,be=new xr,ye=new xr,Oi=new xr,xh=new L,Ch=new Pt,ve=new ti,yf=new L,Ka=new oe,Qa=new Rs,Di=new xr;let Ri,yn;function vf(i,t,e){return Di.set(0,0,-t,1).applyMatrix4(i.projectionMatrix),Di.multiplyScalar(1/Di.w),Di.x=yn/e.width,Di.y=yn/e.height,Di.applyMatrix4(i.projectionMatrixInverse),Di.multiplyScalar(1/Di.w),Math.abs(Math.max(Di.x,Di.y))}function LC(i,t){const e=i.matrixWorld,s=i.geometry,n=s.attributes.instanceStart,r=s.attributes.instanceEnd,o=Math.min(s.instanceCount,n.count);for(let a=0,l=o;a<l;a++){ve.start.fromBufferAttribute(n,a),ve.end.fromBufferAttribute(r,a),ve.applyMatrix4(e);const c=new L,h=new L;Ri.distanceSqToSegment(ve.start,ve.end,h,c),h.distanceTo(c)<yn*.5&&t.push({point:h,pointOnLine:c,distance:Ri.origin.distanceTo(h),object:i,face:null,faceIndex:a,uv:null,uv1:null})}}function RC(i,t,e){const s=t.projectionMatrix,n=i.material.resolution,r=i.matrixWorld,o=i.geometry,a=o.attributes.instanceStart,l=o.attributes.instanceEnd,c=Math.min(o.instanceCount,a.count),h=-t.near;Ri.at(1,Oi),Oi.w=1,Oi.applyMatrix4(t.matrixWorldInverse),Oi.applyMatrix4(s),Oi.multiplyScalar(1/Oi.w),Oi.x*=n.x/2,Oi.y*=n.y/2,Oi.z=0,xh.copy(Oi),Ch.multiplyMatrices(t.matrixWorldInverse,r);for(let d=0,u=c;d<u;d++){if(be.fromBufferAttribute(a,d),ye.fromBufferAttribute(l,d),be.w=1,ye.w=1,be.applyMatrix4(Ch),ye.applyMatrix4(Ch),be.z>h&&ye.z>h)continue;if(be.z>h){const g=be.z-ye.z,y=(be.z-h)/g;be.lerp(ye,y)}else if(ye.z>h){const g=ye.z-be.z,y=(ye.z-h)/g;ye.lerp(be,y)}be.applyMatrix4(s),ye.applyMatrix4(s),be.multiplyScalar(1/be.w),ye.multiplyScalar(1/ye.w),be.x*=n.x/2,be.y*=n.y/2,ye.x*=n.x/2,ye.y*=n.y/2,ve.start.copy(be),ve.start.z=0,ve.end.copy(ye),ve.end.z=0;const p=ve.closestPointToPointParameter(xh,!0);ve.at(p,yf);const m=Qg.lerp(be.z,ye.z,p),f=m>=-1&&m<=1,b=xh.distanceTo(yf)<yn*.5;if(f&&b){ve.start.fromBufferAttribute(a,d),ve.end.fromBufferAttribute(l,d),ve.start.applyMatrix4(r),ve.end.applyMatrix4(r);const g=new L,y=new L;Ri.distanceSqToSegment(ve.start,ve.end,y,g),e.push({point:y,pointOnLine:g,distance:Ri.origin.distanceTo(y),object:i,face:null,faceIndex:d,uv:null,uv1:null})}}}let ey=class extends at{constructor(t=new _u,e=new wu({color:Math.random()*16777215})){super(t,e),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const t=this.geometry,e=t.attributes.instanceStart,s=t.attributes.instanceEnd,n=new Float32Array(2*e.count);for(let o=0,a=0,l=e.count;o<l;o++,a+=2)gf.fromBufferAttribute(e,o),bf.fromBufferAttribute(s,o),n[a]=a===0?0:n[a-1],n[a+1]=n[a]+gf.distanceTo(bf);const r=new Kh(n,2,1);return t.setAttribute("instanceDistanceStart",new Qn(r,1,0)),t.setAttribute("instanceDistanceEnd",new Qn(r,1,1)),this}raycast(t,e){const s=this.material.worldUnits,n=t.camera;n===null&&!s&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const r=t.params.Line2!==void 0&&t.params.Line2.threshold||0;Ri=t.ray;const o=this.matrixWorld,a=this.geometry,l=this.material;yn=l.linewidth+r,a.boundingSphere===null&&a.computeBoundingSphere(),Qa.copy(a.boundingSphere).applyMatrix4(o);let c;if(s)c=yn*.5;else{const d=Math.max(n.near,Qa.distanceToPoint(Ri.origin));c=vf(n,d,l.resolution)}if(Qa.radius+=c,Ri.intersectsSphere(Qa)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),Ka.copy(a.boundingBox).applyMatrix4(o);let h;if(s)h=yn*.5;else{const d=Math.max(n.near,Ka.distanceToPoint(Ri.origin));h=vf(n,d,l.resolution)}Ka.expandByScalar(h),Ri.intersectsBox(Ka)!==!1&&(s?LC(this,e):RC(this,n,e))}onBeforeRender(t){const e=this.material.uniforms;e&&e.resolution&&(t.getViewport(wh),this.material.uniforms.resolution.value.set(wh.z,wh.w))}},BC=class{constructor(t,e){P(this,"_components"),P(this,"_modelStyleGeometries",new It),P(this,"onDisposed",new et),P(this,"three",new Ls),P(this,"plane"),P(this,"items",new It),P(this,"world",null),P(this,"_visible",!1),this._components=t,this.plane=e,this.setupEvents()}set visible(t){t?this.world&&(this.world.scene.three.add(this.three),this._visible=!0):(this.three.removeFromParent(),this._visible=!1)}get visible(){return this._visible}setupEvents(){const t=this._components.get(Sh);this.items.guard=(e,{style:s})=>!!t.styles.get(s),this.items.onItemSet.add(({value:e})=>{const{style:s,data:n}=e;this.create(s,n)})}async getStyleMeshes(t,e){const s=this._components.get(Sh).styles.get(e);if(!s)throw new Error(`ClipStyler: "${e}" style not found.`);const n=this._components.get(ut),r=n.list.get(t);if(!r)throw new Error(`ClipEdges: model with id "${t}" not found.`);const{linesMaterial:o,fillsMaterial:a}=s;let l=this._modelStyleGeometries.get(t);l||(l=new It,this._modelStyleGeometries.set(t,l));let c=l.get(e);if(!c){let h;o&&(h=new ey(new _u,o),h.frustumCulled=!1,r&&n.applyBaseCoordinateSystem(h,await r.getCoordinationMatrix()),this.three.add(h));let d;a&&(d=new at(new xe,a),r&&n.applyBaseCoordinateSystem(d,await r.getCoordinationMatrix()),this.three.add(d)),c={edges:h,fills:d},l.set(e,c)}return c}async updateMeshes(t,e,s){const n=this._components.get(ut),r=n.list.get(t);if(!r)return;const o=this._components.get(Ui),a=this.plane.clone(),l=(await r.getCoordinationMatrix()).clone().multiply(n.baseCoordinationMatrix.clone().invert());a.applyMatrix4(l),a.constant-=.01;const c=await r.getSection(a,s),{buffer:h,index:d,fillsIndices:u}=c,p=await this.getStyleMeshes(t,e),{edges:m,fills:f}=p,b=new Je(h,3,!1);if(m){b.setUsage(U0);const g=new xe;g.setAttribute("position",b),g.setDrawRange(0,d);const y=new gc(g);m.geometry.fromLineSegments(y),o.destroy(y)}f&&(f.geometry.attributes.position=b,f.geometry.setIndex(u))}async create(t,e){if(!this._components.get(Sh).styles.get(t))throw new Error(`ClipEdges: "${t}" style not found.`);const s=this._components.get(Nx);let n=null;e&&(n=await s.find(e));const r=this._components.get(ut);if(n)for(const[o,a]of Object.entries(n))r.list.get(o)&&this.updateMeshes(o,t,[...a]);else for(const[o]of r.list)this.updateMeshes(o,t)}async update(t){for(const[e,{data:s,style:n}]of this.items)t&&!t.includes(e)||this.create(n,s)}dispose(){this._components.get(Ui).destroy(this.three,!0,!0),this._modelStyleGeometries.clear()}};const iy=class _d extends zt{constructor(t){super(t),P(this,"onDisposed",new et),P(this,"enabled",!0),P(this,"world",null),P(this,"styles",new It),P(this,"list",new It),P(this,"_visible",!0),this.components.list.set(_d.uuid,this),this.setEvents()}get visible(){return this._visible}set visible(t){this._visible=t;for(const[,e]of this.list)e.visible=t}setEvents(){this.list.onBeforeDelete.add(({value:t})=>t.dispose())}setEdgesConfig(t,e){if(t.world=(e==null?void 0:e.world)??this.world,e!=null&&e.items)for(const[n,r]of Object.entries(e.items))t.items.set(n,r);const s=(e==null?void 0:e.id)??_e.create();this.list.set(s,t)}create(t,e){const s=new BC(this.components,t);return e&&this.setEdgesConfig(s,e),s}createFromView(t,e){const s=this.create(t.plane,e);return((e==null?void 0:e.link)===void 0||e.link)&&(t.onDisposed.add(()=>s.dispose()),t.onUpdated.add(()=>s.update()),t.onStateChanged.add(()=>s.visible=t.open)),s}createFromClipping(t,e){const s=this.components.get(ws).list.get(t);if(!s)throw new Error(`ClipStyler: Clipping plane with ID ${t} not found.`);const n=this.create(s.three,e);return n.visible=!0,((e==null?void 0:e.link)===void 0||e.link)&&(s.onDraggingEnded.add(()=>n.update()),s.onDisposed.add(()=>n.dispose())),n}dispose(){this.styles.clear(),this.list.clear(),this.onDisposed.trigger(_d.uuid)}};P(iy,"uuid","24dfc306-a3c4-410f-8071-babc4afa5e4d");let Sh=iy;const sy=class wd extends zt{constructor(t){super(t),P(this,"onDisposed",new et),P(this,"onBeforeUpdate",new et),P(this,"onAfterUpdate",new et),P(this,"onSetup",new et),P(this,"isSetup",!1),P(this,"enabled",!0),P(this,"events",{}),P(this,"multiple","ctrlKey"),P(this,"zoomFactor",1.5),P(this,"zoomToSelection",!1),P(this,"backupColor",null),P(this,"selection",{}),P(this,"config",{selectName:"select",selectionColor:null,autoHighlightOnClick:!0,world:null,selectEnabled:!0,autoUpdateFragments:!0,selectMaterialDefinition:{color:new gt("#BCF124"),renderedFaces:Bl.ONE,opacity:1,transparent:!1}}),P(this,"styles",new It),P(this,"autoToggle",new Set),P(this,"mouseDownPosition",{x:0,y:0}),P(this,"mouseMoveThreshold",5),P(this,"selectable",{}),P(this,"eventManager",new Ix),P(this,"_mouseState",{down:!1,moved:!1}),P(this,"_fromHighlight",!1),P(this,"restorePreviousColors",(e=this.selection.select)=>{for(const[s,n]of Object.entries(this.selection))if(!(s===this.config.selectName||!this.styles.get(s)))for(const[r,o]of Object.entries(e)){const a=n[r];if(!a)continue;const l=[...o].filter(c=>a.has(c));l.length!==0&&new Set(l)}}),P(this,"onMouseDown",e=>{this.enabled&&(this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.mouseDownPosition={x:e.clientX,y:e.clientY},this._mouseState.down=!0)}),P(this,"debounceTimeout",null),P(this,"onMouseUp",async e=>{if(!this.enabled)return;const{world:s,autoHighlightOnClick:n,selectEnabled:r}=this.config;if(!s)throw new Error("No world found!");if(!s.renderer)throw new Error("This world doesn't have a renderer!");if(e.target===s.renderer.three.domElement){if(this._mouseState.down=!1,this._mouseState.moved||e.button!==0){this._mouseState.moved=!1;return}if(this._mouseState.moved=!1,n&&r){const o=this.multiple==="none"?!0:!e[this.multiple];await this.highlight(this.config.selectName,o,this.zoomToSelection)}}}),P(this,"onMouseMove",async e=>{if(!this.enabled)return;const s=e.clientX-this.mouseDownPosition.x,n=e.clientY-this.mouseDownPosition.y,r=Math.sqrt(s*s+n*n);this._mouseState.moved||r>this.mouseMoveThreshold&&(this._mouseState.moved=this._mouseState.down)}),this.components.add(wd.uuid,this),this.eventManager.list.add(this.onSetup),this.eventManager.list.add(this.onDisposed),this.setStyleEvents()}setStyleEvents(){this.styles.onBeforeDelete.add(async({key:t})=>{if(await this.clear(t),delete this.selection[t],!(t in this.events))return;const{onClear:e,onHighlight:s,onBeforeHighlight:n}=this.events[t];this.eventManager.list.delete(e),this.eventManager.list.delete(s),this.eventManager.list.delete(n),delete this.events[t]}),this.styles.onItemSet.add(({key:t})=>{this.selection[t]={};const e=new et,s=new et,n=new et;this.events[t]={onHighlight:e,onClear:n,onBeforeHighlight:s},this.eventManager.add([n,e,s])})}async dispose(){this.setupEvents(!1),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.selection={},this.styles.clear(),this.onDisposed.trigger(wd.uuid),this.eventManager.reset(),this.isSetup=!1}add(t){if(console.warn("highlighter.add() is deprecated, use highlighter.styles.set() instead"),typeof t=="string")this.styles.set(t,null);else{const{customId:e}=t;this.styles.set(e,t)}}async remove(t){console.warn("highlighter.remove() is deprecated, use highlighter.styles.delete() instead"),this.styles.delete(t)}async highlight(t,e=!0,s=this.zoomToSelection,n=null){if(!this.enabled)return;if(!this.config.world)throw new Error("No world found in config!");const r=this.config.world;if(!this.selection[t])throw new Error(`Selection ${t} does not exist.`);const o=await this.components.get(Re).get(r).castRay();if(!o||o.localId===void 0||o.localId===null){e&&this.clear(t);return}const{localId:a,fragments:{modelId:l}}=o,c={[l]:new Set([a])};await this.highlightByID(t,c,e,s,n,!0)}async highlightByID(t,e,s=!0,n=this.zoomToSelection,r=null,o=!1){var a;if(!this.enabled)return;this._fromHighlight=!0,this.events[t].onBeforeHighlight.trigger(this.selection[t]),s&&await this.clear(t);let l=Rt.clone(e);const c=this.components.get(ut);for(const[d,u]of Object.entries(e)){const p=c.list.get(d);p!=null&&p.isDeltaModel&&p.parentModelId&&Rt.add(l,{[p.parentModelId]:u})}const h=(a=this.selectable)==null?void 0:a[t];if(h){const d=Rt.clone(h);l=Rt.intersect([l,d])}if(r){const d=Rt.clone(r);for(const[u,p]of Object.entries(d)){const m=c.list.get(u);m!=null&&m.deltaModelId&&Rt.add(d,{[m.deltaModelId]:p})}Rt.remove(l,r)}if(o&&this.autoToggle.has(t)){const d={};let u=!1;for(const p in l){const m=this.selection[t][p];if(!m)continue;const f=l[p];for(const b of f)if(m.has(b)){m.delete(b);let g=d[p];g||(g=new Set,d[p]=g),g.add(b),u=!0}else m.add(b);l[p]=m}u&&(this.events[t].onClear.trigger(d),t===this.config.selectName&&this.restorePreviousColors(d))}this.updateStyleMap(t,l),this.events[t].onHighlight.trigger(this.selection[t]),this._fromHighlight=!1,await this.updateColors(),n&&await this.zoomSelection(l)}async updateColors(){const t=this.components.get(ut),e=[t.resetHighlight()];for(const[s,n]of Object.entries(this.selection)){const r=this.styles.get(s);if(!r)continue;const o=s==="select"||!this.styles.get(this.config.selectName)?n:this.getMapWithoutSelection(s);o&&e.push(t.highlight({...r,customId:s},o))}this.config.autoUpdateFragments&&e.push(t.core.update(!0)),await Promise.allSettled(e)}updateStyleMap(t,e){const s=this.selection[t];for(const n in e){let r=s[n];r||(r=new Set,s[n]=r);const o=e[n];for(const a of o)r.add(a)}if(t!==this.config.selectName)for(const[n,r]of Object.entries(this.selection)){if(n===this.config.selectName||n===t)continue;const o=r;for(const[a,l]of Object.entries(s)){const c=o[a];if(c)for(const h of l)c.delete(h)}}}getMapWithoutSelection(t,e){const s=this.selection[t];if(!s)throw new Error(`Style ${t} does not exist.`);const n=this.selection[this.config.selectName]??{},r={};for(const o in s){const a=s[o],l=t===this.config.selectName?new Set:n[o]??new Set,c=Array.from(a).filter(h=>{var d;return!l.has(h)&&(!e||((d=e[o])==null?void 0:d.has(h)))});c.length>0&&(r[o]=new Set(c))}return Object.keys(r).length>0?r:null}async clear(t,e){const s=t?[t]:Object.keys(this.selection),n=e??void 0;for(const r of s){const o=this.selection[r]??{},a=n??o;r===this.config.selectName&&this.restorePreviousColors();const l={};for(const[c,h]of Object.entries(a)){const d=o[c];if(d)for(const u of h){if(!d.delete(u))continue;let p=l[c];p||(p=new Set,l[c]=p),p.add(u)}}Object.keys(l).length>0&&this.events[r].onClear.trigger(l),this.selection[r]={}}this._fromHighlight||await this.updateColors()}setup(t){if(this.isSetup)return;this.config={...this.config,...t};const{selectName:e,selectionColor:s,selectMaterialDefinition:n}=this.config;this.config.world&&this.components.get(Re).get(this.config.world),n?(s&&(console.warn("highlighter.config.selectionColor is deprecated, use selectMaterialDefinition instead"),n.color=s),this.styles.set(e,n)):this.styles.set(e,null),this.autoToggle.add(this.config.selectName),this.setupEvents(!0),this.enabled=!0,this.isSetup=!0,this.onSetup.trigger(this)}async zoomSelection(t){if(!this.config.world)throw new Error("No world found in config!");const e=this.config.world;let s=!1;for(const f in t)if(t[f].size>0){s=!0;break}if(!s||!e.camera.hasCameraControls())return;const n=await this.components.get(ut).getBBoxes(t),r=new Rs,o=new oe;for(const f of n)o.union(f);o.getBoundingSphere(r);const a=1/0,l=-1/0,{x:c,y:h,z:d}=r.center,u=r.radius===a||c===a||h===a||d===a,p=r.radius===l||c===l||h===l||d===l,m=r.radius===0;u||p||m||(r.radius*=this.zoomFactor,await e.camera.controls.fitToSphere(r,!0))}setupEvents(t){if(!this.config.world){console.log("No world found while setting up events!");return}if(this.config.world.isDisposing)return;if(!this.config.world.renderer)throw new Error("The given world doesn't have a renderer!");const e=this.config.world.renderer.three.domElement;e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("mouseup",this.onMouseUp),e.removeEventListener("pointermove",this.onMouseMove),t&&(e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("mouseup",this.onMouseUp),e.addEventListener("pointermove",this.onMouseMove))}};P(sy,"uuid","cb8a76f2-654a-4b50-80c6-66fd83cafd77");let Ds=sy;const ny=class ry extends zt{constructor(){super(...arguments),P(this,"enabled",!0),P(this,"geometries",new It),P(this,"onDisposed",new et)}async get(t,e){const{material:s,applyTransformation:n}={applyTransformation:!0,...e},r=this.components.get(ut),o=new It;for(const[a,l]of Object.entries(t)){const c=r.list.get(a);if(!c)continue;const h=this.getModelMeshes(a);for(const d of l){let u=o.get(a);u||(u=new It,o.set(a,u));let p=h.get(d);if(p&&p.length>0){const b=[];for(const[g,{geometry:y,transform:v}]of p.entries()){const _=await this.createMesh(c,y,v,{material:s,applyTransformation:n});b.push(_)}u.set(d,b);continue}else p=[],h.set(d,p);const[m]=await c.getItemsGeometry([d]);if(!m)continue;const f=[];for(const b of m){const g=this.createGeometry(b);if(!g)continue;const{geometry:y,transform:v}=g;p.push(g);const _=await this.createMesh(c,y,v,{material:s,applyTransformation:n});f.push(_)}u.set(d,f)}}return o}getModelMeshes(t){let e=this.geometries.get(t);return e||(e=new It,this.geometries.set(t,e)),e}remove(t=[...this.geometries.keys()]){for(const e of t){const s=this.geometries.get(e);if(s){for(const[n,r]of s)for(const{geometry:o}of r)o.dispose();this.geometries.delete(e)}}}dispose(t=!0){this.remove(),t&&this.geometries.dispose(),this.onDisposed.trigger(ry.uuid)}getMeshesFromResult(t){const e=[];for(const s of t.values())for(const n of s.values())e.push(...n);return e}createGeometry(t){const{positions:e,indices:s,normals:n,transform:r}=t;if(!(e&&s&&n))return null;const o=new xe;return o.setAttribute("position",new Je(e,3)),o.setAttribute("normal",new Je(n,3,!0)),o.setIndex(new Je(s,1)),{geometry:o,transform:r}}async createMesh(t,e,s,n){const{material:r,applyTransformation:o}={applyTransformation:!0,...n},a=new at(e,r);return a.applyMatrix4(s),a.applyMatrix4(t.object.matrixWorld),o||(a.position.set(0,0,0),a.rotation.set(0,0,0)),a}};P(ny,"uuid","ab45d0a7-feea-4afc-927c-80832dae76dd");let Vl=ny;const NC=class xd extends zt{constructor(t){super(t),P(this,"_world"),P(this,"styles",new se),P(this,"outlinePositions",!1),P(this,"_mesh",null),P(this,"onDisposed",new et),P(this,"_meshes",[]),P(this,"_map",{}),P(this,"_activeStyles",new Set),P(this,"_styleCallbacks",{}),t.add(xd.uuid,this),this.setupEvents()}set world(t){this._world=t,t&&this.getRenderer().postproduction.excludedObjectsPass.addExcludedMaterial(this._points.material)}get world(){return this._world}get _points(){return this._mesh||(this._mesh=new D0(new xe,new I0({size:10,sizeAttenuation:!1,depthTest:!1}))),this._mesh}get enabled(){return!this.world||this.world.isDisposing?!1:this.getRenderer().postproduction.outlinesEnabled}set enabled(t){if(!this.world||this.world.isDisposing)return;const e=this.getRenderer();e.postproduction.outlinesEnabled=t,this.outlinePositions&&(this._points.material.color=this.color,this.world.scene.three.add(this._points))}get color(){return this.getRenderer().postproduction.outlinePass.outlineColor}set color(t){this.getRenderer().postproduction.outlinePass.outlineColor.copy(t),this._points.material.color.copy(t)}get thickness(){return this.getRenderer().postproduction.outlinePass.thickness}set thickness(t){this.getRenderer().postproduction.outlinePass.thickness=t}get fillColor(){return this.getRenderer().postproduction.outlinePass.fillColor}set fillColor(t){this.getRenderer().postproduction.outlinePass.fillColor.copy(t)}get fillOpacity(){return this.getRenderer().postproduction.outlinePass.fillOpacity}set fillOpacity(t){const e=this.getRenderer().postproduction;e.outlinePass.fillOpacity=t}setupEvents(){const t=this.components.get(Ds);this.styles.guard=e=>t.styles.has(e),this.styles.onItemAdded.add(e=>{const s=this.components.get(Ds),n=()=>{this._activeStyles.add(e),this.updateFromStyles()},r=()=>{this._activeStyles.delete(e),this.updateFromStyles()};this._styleCallbacks[e]={onHighlight:n,onClear:r},s.events[e].onHighlight.add(n),s.events[e].onClear.add(r)}),this.styles.onBeforeDelete.add(e=>{const{onHighlight:s,onClear:n}=this._styleCallbacks[e];t.events[e].onHighlight.remove(s),t.events[e].onClear.remove(n),this._activeStyles.delete(e),delete this._styleCallbacks[e]}),t.styles.onItemDeleted.add(e=>this.styles.delete(e))}async updateFromStyles(){const t=this.components.get(Ds),e=[];for(const n of this._activeStyles){const r=t.selection[n];r&&e.push(r)}const s=Rt.join(e);this._map=s,await this.update()}async update(t=this._map){if(t===this._map&&this.cleanMeshes(),this.outlinePositions&&this.updatePoints(),Object.keys(t).length===0)return;const e=this.components.get(ut),s=this.getRenderer().postproduction.outlinePass,n=await this.components.get(Vl).get(t);for(const r of Object.keys(t)){const o=e.list.get(r),a=new Set(await(o==null?void 0:o.getItemsByVisibility(!1)));if(o){for(const[l,c]of n.entries())for(const[h,d]of c)if(!a.has(h))for(const u of d)this._meshes.push(u),s.scene.add(u)}}}async addItems(t){Rt.add(this._map,t),await this.update(t)}async removeItems(t){Rt.remove(this._map,t),await this.update()}clean(){this._map={},this._activeStyles.clear(),this.cleanMeshes(),this._mesh&&this.components.get(Ui).destroy(this._mesh,!0,!0),this._mesh=null}dispose(){this.styles.clear(),this.clean(),this.onDisposed.trigger(xd.uuid)}cleanMeshes(){for(const t of this._meshes)t.removeFromParent();this._meshes=[]}async updatePoints(){let t=0;for(const[s,n]of Object.entries(this._map))t+=n.size;this._points.geometry.setAttribute("position",new Ns(new Float32Array(t*3),3));const e=await this.components.get(ut).getPositions(this._map);for(let s=0;s<e.length;s++){const{x:n,y:r,z:o}=e[s];this._points.geometry.attributes.position.array[s*3]=n,this._points.geometry.attributes.position.array[s*3+1]=r,this._points.geometry.attributes.position.array[s*3+2]=o}this._points.geometry.attributes.position.needsUpdate=!0}getRenderer(){if(!this.world)throw new Error("You must set a world to use the outliner!");const t=this.world.renderer;if(!t.postproduction)throw new Error("The world given to the outliner must use the postproduction renderer.");return t}};P(NC,"uuid","2fd3bcc5-b3b6-4ded-9f64-f47a02854a10");const oy=class ay extends zt{constructor(t){super(t),P(this,"onHoverStarted",new et),P(this,"onHoverEnded",new et),P(this,"HOVERER_OPACITY_KEY","_maxHoverOpacity"),P(this,"_hoverTimeout",null),P(this,"_meshes",new se),P(this,"_localId",null),P(this,"_fadeAnimation",null),P(this,"_world",null),P(this,"_enabled",!1),P(this,"_material",new Cr({color:16777215,transparent:!0,opacity:.5,depthTest:!1,userData:{[this.HOVERER_OPACITY_KEY]:.5}})),P(this,"onDisposed",new et),P(this,"duration",200),P(this,"animation",!0),P(this,"mouseStopTimeout",null),P(this,"onMouseMove",()=>{this.mouseStopTimeout!==null&&clearTimeout(this.mouseStopTimeout),this.mouseStopTimeout=window.setTimeout(()=>this.hover(),50)}),P(this,"onMouseLeave",()=>{this._meshes.clear()}),P(this,"animate",()=>{if(!(this._fadeAnimation&&this.animation&&this.material.transparent))return;const{startTime:e,duration:s,fadeIn:n}=this._fadeAnimation,r=Date.now()-e,o=Math.min(r/s,1),a=n?o:1-o,l=this.material.userData[this.HOVERER_OPACITY_KEY],c=a*(l!==void 0?l:1);this.material.opacity=c,o<1?requestAnimationFrame(this.animate):(n||this._meshes.clear(),this._fadeAnimation=null,this.onHoverEnded.trigger(this))}),t.add(ay.uuid,this),this._meshes.onBeforeDelete.add(e=>{e.removeFromParent(),e.geometry.dispose()}),this._meshes.onItemAdded.add(e=>{this.world&&this.world.scene.three.add(e)}),this._meshes.onCleared.add(()=>{this._localId=null,this._hoverTimeout&&(clearTimeout(this._hoverTimeout),this._hoverTimeout=null)})}set world(t){if(t){this.components.get(Re).get(t),this._world=t,this.setupEvents(!0);for(const e of this._meshes)t.scene.three.add(e)}else{this.setupEvents(!1),this._world=null;for(const e of this._meshes)e.removeFromParent()}}get world(){return this._world}set enabled(t){this.setupEvents(t),this._enabled=t}get enabled(){return this._enabled}set material(t){t.userData[this.HOVERER_OPACITY_KEY]=t.opacity;for(const e of this._meshes)e.material=t;this._material.dispose(),this._material=t}get material(){return this._material}setupEvents(t){if(!this.world||this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The given world doesn't have a renderer!");const e=this.world.renderer.three.domElement;e.removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("mouseleave",this.onMouseMove),t&&(e.addEventListener("mousemove",this.onMouseMove),e.addEventListener("mouseleave",this.onMouseLeave))}async hover(){if(!this.enabled||!this.world)return;const t=await this.components.get(Re).get(this.world).castRay();if(!t){this._meshes.clear();return}const{fragments:e,localId:s}=t;this._localId!==s&&(this._meshes.clear(),this._localId=s,this._hoverTimeout=window.setTimeout(async()=>{const n={[e.modelId]:new Set([s])},r=await this.components.get(Vl).get(n);for(const[o,a]of r.entries()){const l=[...a.values()].flat();for(const c of l)c.material=this.material,this._meshes.add(c)}this._fadeAnimation={startTime:Date.now(),duration:this.duration,fadeIn:!0},this.onHoverStarted.trigger(this),this.animate()},100))}clear(){this._meshes.clear()}dispose(){this._enabled=!1,this._meshes.clear(),this._fadeAnimation=null,this._hoverTimeout=null,this.onHoverStarted.reset(),this.onHoverEnded.reset(),this.onDisposed.trigger()}};P(oy,"uuid","26fbd870-b1b2-4b71-b747-4063d484de1b");let FC=oy,UC=class{constructor(t){P(this,"alignments",[]),P(this,"enabled",!0),P(this,"world",null),P(this,"_raycastable",[]),P(this,"_components"),this._components=t}update(){this.dispose();for(const t of this.alignments)for(const e of t.children){const s=e;s.updateWorldMatrix(!0,!0);for(const n of s.children){const r=n;if(r.isLine2&&r.userData.points){const o=new xe,a=new yi;a.geometry.setIndex(r.geometry.index);const l=new Float32Array(r.userData.points),c=new Je(l,3);o.setAttribute("position",c),a.geometry=o,a.userData.curve=r,a.applyMatrix4(r.matrixWorld),a.updateMatrixWorld(),this._raycastable.push(a)}}}}dispose(){for(const t of this._raycastable)t.geometry.dispose(),t.geometry=void 0;this._raycastable=[]}castRay(){if(!this.enabled||!this.world)return null;const t=this._components.get(Re).get(this.world).castRayToObjects(this._raycastable);if(!t)return null;const e=t.object,s=e.geometry,n=t.index,r=s.attributes.position.array[n*3],o=s.attributes.position.array[n*3+1],a=s.attributes.position.array[n*3+2],l=s.attributes.position.array[n*3+3],c=s.attributes.position.array[n*3+4],h=s.attributes.position.array[n*3+5],d=new L(l-r,c-o,h-a).normalize();return{point:t.point,normal:d,curve:e.userData.curve,alignment:e.userData.curve.parent}}},Eh=class{static alignmentPercentageToPoint(t,e){const s=new L,n=new L,r=this.alignmentLength(t),o=e*r;let a=0;if(t.updateWorldMatrix(!0,!0),e===1)for(let l=t.children.length-1;l>=0;l--){const c=t.children[l],h=c.userData.points;if(!h)continue;const d=new L(h[h.length-3],h[h.length-2],h[h.length-1]);return d.applyMatrix4(c.matrixWorld),{normal:new L,point:d,curve:c,alignment:t}}for(const l of t.children){const c=l.userData.points;if(c)for(let h=0;h<c.length-3;h+=3){const d=s.set(c[h],c[h+1],c[h+2]),u=n.set(c[h+3],c[h+4],c[h+5]),p=d.distanceTo(u);if(a+p>=o){const m=o-a,f=u.clone().sub(d).normalize(),b=f.clone().multiplyScalar(m);return d.add(b),d.applyMatrix4(l.matrixWorld),{normal:f,point:d,curve:l,alignment:t}}a+=p}}return null}static curvePercentageToPoint(t,e,s){const n=new L,r=new L,o=this.curveLength(e),a=s*o;let l=0;const c=e.userData.points;if(!c)throw new Error("No points found in curve");for(let h=0;h<c.length-3;h+=3){const d=n.set(c[h],c[h+1],c[h+2]),u=r.set(c[h+3],c[h+4],c[h+5]),p=d.distanceTo(u);if(l+p>=a){const m=a-l,f=u.clone().sub(d).normalize(),b=f.clone().multiplyScalar(m);return d.add(b),{normal:f,point:d,curve:e,alignment:t}}l+=p}return null}static alignmentLength(t){let e=0;if(t.userData.length!==void 0)return t.userData.length;for(const s of t.children)"isLine2"in s&&(e+=this.curveLength(s));return t.userData.length=e,e}static curveLength(t){let e=0;if(t.userData.length!==void 0)return t.userData.length;const s=new L,n=new L,r=t.userData.points;if(!r)throw new Error("No points found in curve");for(let o=0;o<r.length-2-3;o+=3){const a=s.set(r[o],r[o+1],r[o+2]),l=n.set(r[o+3],r[o+4],r[o+5]);e+=a.distanceTo(l)}return t.userData.length=e,e}static curvePointToAlignmentPercentage(t,e,s){const n=new L,r=new L,o=this.alignmentLength(t);let a=0;t.updateWorldMatrix(!0,!0);for(const l of t.children){const c=l.userData.points;if(c)for(let h=0;h<c.length-3;h+=3){const d=n.set(c[h],c[h+1],c[h+2]),u=r.set(c[h+3],c[h+4],c[h+5]);d.applyMatrix4(l.matrixWorld),u.applyMatrix4(l.matrixWorld);const p=d.distanceTo(u),m=d.distanceTo(e)<.001,f=u.distanceTo(e)<.001,b=this.isPointbetweenTwoOthers(d,u,e);if(l===s&&(m||f||b)){const g=d.distanceTo(e);return(a+g)/o}a+=p}}return null}static isPointbetweenTwoOthers(t,e,s){const n=new L;n.subVectors(e,t).normalize();const r=new L;r.subVectors(s,t).normalize();const o=new L;o.subVectors(s,e).normalize();const a=1-.0016;return n.dot(r)>a&&n.dot(o)<-a}},jC=class{constructor(t,e){P(this,"onDisposed",new et),P(this,"alignments",[]),P(this,"components"),P(this,"onMarkerChange",new et),P(this,"enabled",!0),P(this,"highlightMaterial"),P(this,"increments",20),P(this,"screenDistanceLimit",.1),P(this,"fadeInTime",500),P(this,"_mouseMarkers"),P(this,"_highlighted",new Set),P(this,"_stationPoints",new Map),P(this,"_originalHighlightMaterialId","originalHighlightMaterial"),P(this,"_world",null),P(this,"_raycaster"),P(this,"_stationLabelColor",new gt(16777215)),P(this,"_stationLabelBackgroundColor",new gt(8014801)),P(this,"_stationPointerColor",new gt(16777215)),P(this,"_stationPointerBackgroundColor",new gt(4803766)),P(this,"_pointerDown",performance.now()),P(this,"_pointerDownTime",150),P(this,"onPointerDown",()=>{this._pointerDown=performance.now()}),P(this,"onPointerUp",()=>{if(performance.now()-this._pointerDown>this._pointerDownTime)return;const s=this.setMarkerToMouse("select");s&&this.onMarkerChange.trigger(s)}),P(this,"onMouseMove",()=>{this.setMarkerToMouse("hover")}),this.components=t,this.highlightMaterial=e,this._raycaster=new UC(t),this._raycaster.alignments=this.alignments}get world(){return this._world}set world(t){var e,s,n,r;if(t===this._world||(this._world&&this.setupEvents(!1),this._world=t,(e=this._mouseMarkers)==null||e.hover.removeFromParent(),(s=this._mouseMarkers)==null||s.select.removeFromParent(),(n=this._mouseMarkers)==null||n.hover.element.remove(),(r=this._mouseMarkers)==null||r.select.element.remove(),!t))return;this._raycaster.world=t;const o=this.newCivilLabel(0,"stationPointer");t.scene.three.add(o),o.visible=!1,o.element.style.transition="";const a=this.newCivilLabel(0,"stationPointer");a.element.style.transition="",a.element.style.opacity="0.5",t.scene.three.add(a),a.visible=!1,this._mouseMarkers={select:o,hover:a},this.setupEvents(!0)}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(t){this._stationLabelColor=t;const e=`#${t.getHexString()}`;for(const[,{labels:s}]of this._stationPoints){const n=[...s.children];for(const r of n){const o=this.getLabel(r);o.style.color=e;const a=this.getPoint(r);a.style.backgroundColor=e}}}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(t){this._stationLabelBackgroundColor=t;const e=`#${t.getHexString()}`;for(const[,{labels:s}]of this._stationPoints){const n=[...s.children];for(const r of n){const o=this.getLabel(r);o.style.backgroundColor=e;const a=this.getPoint(r);a.style.border=`2px solid ${e}`}}}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(t){this._stationPointerColor=t;const e=`#${t.getHexString()}`;if(this._mouseMarkers){const s=this._mouseMarkers.select,n=this.getLabel(s);n.style.color=e;const r=this.getPoint(s);r.style.backgroundColor=e}}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(t){this._stationPointerBackgroundColor=t;const e=`#${t.getHexString()}`;if(this._mouseMarkers){const s=this._mouseMarkers.select,n=this.getLabel(s);n.style.backgroundColor=e;const r=this.getPoint(s);r.style.border=`2px solid ${e}`}}dispose(){var t,e,s,n;this.clearHighlight(),this.clearStations(),this.alignments=[],(t=this._mouseMarkers)==null||t.hover.removeFromParent(),(e=this._mouseMarkers)==null||e.select.removeFromParent(),(s=this._mouseMarkers)==null||s.hover.element.remove(),(n=this._mouseMarkers)==null||n.select.element.remove(),this._raycaster.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){this._raycaster.update()}setMarkerAtPoint(t,e){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");this.updateMarkerValue(t,e),this._mouseMarkers[e].visible=!0,this._mouseMarkers[e].position.copy(t.point)}highlight(t,e=!0){e&&this.clearHighlight(this._highlighted);for(const s of t.children)"isLineSegments2"in s&&"material"in s&&(s.userData[this._originalHighlightMaterialId]=s.material,s.material=this.highlightMaterial);this._highlighted.add(t)}clearHighlight(t=this._highlighted){for(const e of t)for(const s of e.children)"isLineSegments2"in s&&"material"in s&&(s.material=s.userData[this._originalHighlightMaterialId],delete s.userData[this._originalHighlightMaterialId]);this._highlighted.clear()}createStations(t){if(!this.world||this._stationPoints.has(t.uuid))return;const e=new Ls;this.world.scene.three.add(e),this._stationPoints.set(t.uuid,{alignment:t,labels:e})}clearStations(t=this._stationPoints.keys()){for(const e of t){const s=this._stationPoints.get(e);s&&(this.clearLabels(s.labels),this._stationPoints.delete(e))}}updateStations(){if(!this.world)throw new Error("No world found!");if(!this.world.renderer)throw new Error("No renderer found!");const t=this.world.camera.three,e=this.world.renderer.three,s=new su,n=e.clippingPlanes,r=new L,o=new L;let a=!0;const l=new L;for(const[,{alignment:c,labels:h}]of this._stationPoints){this.clearLabels(h),c.updateWorldMatrix(!0,!0);const d=c.userData.initialStation;let u=d||0;const p=u%this.increments;let m=d+this.increments-p;for(const f of c.children){if(!("isLine2"in f))continue;const b=f;if(b.geometry.boundingBox||b.geometry.computeBoundingBox(),s.setFromProjectionMatrix(new Pt().multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse)),!s.intersectsBox(b.geometry.boundingBox)){const O=Eh.curveLength(f);u+=O;const R=u%this.increments;m=u+this.increments-R;continue}const g=f.userData.points,y=g[0],v=g[1],_=g[2];if(l.set(y,v,_),l.applyMatrix4(f.matrixWorld),!this.isLabelClipped(n,l)){if(a){a=!1,r.set(l.x,l.y,l.z),r.project(t),r.z=0;const O=this.newCivilLabel(u,"stationLabel");O.position.set(l.x,l.y,l.z),h.children.push(O)}else if(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit){const O=this.newCivilLabel(u,"stationLabel");O.position.set(l.x,l.y,l.z),h.children.push(O),r.copy(o)}}const x=new L,S=new L;for(let O=0;O<g.length-3;O+=3){x.set(g[O],g[O+1],g[O+2]),S.set(g[O+3],g[O+4],g[O+5]);const R=x.distanceTo(S),A=u+R,$=S.clone().sub(x).normalize();for(;A>m;){const w=m-u,z=$.clone();z.multiplyScalar(w);const{x:Y,y:V,z:K}=x.clone().add(z);if(l.set(Y,V,K),l.applyMatrix4(f.matrixWorld),!this.isLabelClipped(n,l)&&s.containsPoint(l)&&(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit)){const q=this.newCivilLabel(m,"stationLabel");q.position.set(l.x,l.y,l.z),h.children.push(q),r.copy(o)}m+=this.increments}u+=R}const k=g[g.length-3],T=g[g.length-2],M=g[g.length-1];if(l.set(k,T,M),l.applyMatrix4(f.matrixWorld),!(this.isLabelClipped(n,l)||!s.containsPoint(l))&&(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit)){const O=this.newCivilLabel(u,"stationLabel");O.position.set(l.x,l.y,l.z),h.children.push(O),r.copy(o)}}}}getCursorValue(){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");return this._mouseMarkers.select.element.children[0].children[0].innerText}setCursorValue(t,e){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const s=this._mouseMarkers[e].element.children[0].children[0];s.innerText=t}isLabelClipped(t,e){for(const s of t)if(!(s.distanceToPoint(e)>0))return!0;return!1}clearLabels(t){const e=[...t.children];for(const s of e)s.element.style.opacity="0";setTimeout(()=>{for(const s of e)s.removeFromParent(),s.element.remove(),s.visible=!1},this.fadeInTime)}newCivilLabel(t,e){const s=document.createElement("div"),n=e==="stationLabel"?this.stationLabelColor:this.stationPointerColor,r=e==="stationLabel"?this.stationLabelBackgroundColor:this.stationPointerBackgroundColor,o=document.createElement("div");o.style.width="4px",o.style.height="4px",o.style.borderRadius="50%",o.style.backgroundColor=`#${n.getHexString()}`,o.style.border=`2px solid #${r.getHexString()}`,o.style.display="flex",o.style.justifyContent="center";const a=this.getFormattedStation(t),l=document.createElement("div");l.innerText=a,l.style.backgroundColor=`#${r.getHexString()}`,l.style.color=`#${n.getHexString()}`,l.style.padding="0.3rem",l.style.position="absolute",l.style.bottom="1rem",l.style.borderRadius="6px",l.style.boxShadow="rgba(0, 0, 0, 0.6) 0px 4px 6px",o.appendChild(l);const c=new ty(s);return s.appendChild(o),e==="stationLabel"&&(s.style.transition=`opacity ${this.fadeInTime}ms ease-in-out`,s.style.opacity="0",setTimeout(()=>{s.style.opacity="1"})),c}setupEvents(t){if(!this.world)throw new Error("No world found!");if(this.world.isDisposing||!this.world.renderer)return;const e=this.world.renderer.three.domElement,s=this.components.get(Re).get(this.world);s.three.params.Line||(s.three.params.Line={threshold:10}),e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointerup",this.onPointerUp),e.removeEventListener("pointermove",this.onMouseMove),t&&(e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointerup",this.onPointerUp),e.addEventListener("pointermove",this.onMouseMove))}setMarkerToMouse(t){if(!this.enabled||!this._mouseMarkers)return null;if(!this.world)throw new Error("No world found!");const e=this._raycaster.castRay();if(!e)return this._mouseMarkers[t].visible=!1,null;this._mouseMarkers[t].visible=!0;const s=e.point;return this._mouseMarkers[t].position.copy(s),this.updateMarkerValue(e,t),e}updateMarkerValue(t,e){if(!this._mouseMarkers)return;const{alignment:s,curve:n,point:r}=t,o=Eh.curvePointToAlignmentPercentage(s,r,n);if(o===null)throw new Error("Point is not on the curve");const a=o*Eh.alignmentLength(s)+s.userData.initialStation,l=this.getFormattedStation(a);this.setCursorValue(l,e)}getFormattedStation(t){const e=Math.floor(t/1e3),s=Math.round(t-e*1e3);return`${e}+${s}`}getLabel(t){return t.element.children[0].children[0]}getPoint(t){return t.element.children[0]}};const VC=class ly extends zt{constructor(t){super(t),P(this,"onDisposed",new et),P(this,"list",new Map),P(this,"enabled",!0),P(this,"highlightMaterial",new wu({color:8014801,linewidth:5,depthTest:!1})),P(this,"_increments",20),P(this,"_screenDistanceLimit",.1),P(this,"_fadeInTime",500),P(this,"_stationLabelColor",new gt(16777215)),P(this,"_stationLabelBackgroundColor",new gt(8014801)),P(this,"_stationPointerColor",new gt(16777215)),P(this,"_stationPointerBackgroundColor",new gt(4803766)),this.components.add(ly.uuid,this)}get increments(){return this._increments}set increments(t){this._increments=t;for(const[,e]of this.list)e.increments=t}get screenDistanceLimit(){return this._screenDistanceLimit}set screenDistanceLimit(t){this._screenDistanceLimit=t;for(const[,e]of this.list)e.screenDistanceLimit=t}get fadeInTime(){return this._fadeInTime}set fadeInTime(t){this._fadeInTime=t;for(const[,e]of this.list)e.fadeInTime=t}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(t){this._stationLabelColor=t;for(const[,e]of this.list)e.stationLabelColor=t}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(t){this._stationLabelBackgroundColor=t;for(const[,e]of this.list)e.stationLabelBackgroundColor=t}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(t){this._stationPointerColor=t;for(const[,e]of this.list)e.stationPointerColor=t}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(t){this._stationPointerBackgroundColor=t;for(const[,e]of this.list)e.stationPointerBackgroundColor=t}create(t){const e=new jC(this.components,this.highlightMaterial);return this.list.set(t,e),e}delete(t){const e=this.list.get(t);e&&(e.dispose(),this.list.delete(t))}dispose(){for(const[,t]of this.list)t.dispose();this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){for(const[,t]of this.list)t.updateAlignments()}};P(VC,"uuid","0a59c09e-2b49-474a-9320-99f51f40f182");const HC=class cy extends zt{constructor(t){super(t),P(this,"enabled",!0),P(this,"onDisposed",new et),P(this,"_world",null),P(this,"_flip",!1),P(this,"_plane"),P(this,"_point",new L),P(this,"_edgeMeshes",[]),P(this,"_sectionVisible",!1),P(this,"_sectionOffset",.1),P(this,"edgeMaterial",new wu({color:0,linewidth:5,depthTest:!1})),this.components.add(cy.uuid,this)}get plane(){if(!this._plane)throw new Error("Plane is not set. You must give a world.");return this._plane}set plane(t){this._plane=t}get sectionVisible(){return this._sectionVisible}set sectionVisible(t){this._sectionVisible=t;for(const e of this._edgeMeshes)e.visible=t}get world(){return this._world}set world(t){var e;if(this._world=t,(e=this._plane)==null||e.dispose(),!t)return;const s=this.components.get(ws),n=s.createFromNormalAndCoplanarPoint(t,new L(1,0,0),new L);this.plane=s.list.get(n),this.plane.visible=!1,this.plane.enabled=!1}get flip(){return this._flip}set flip(t){var e;if(t===this._flip)return;this._flip=t;const s=(e=this.plane)==null?void 0:e.normal.clone().multiplyScalar(-1);for(const n of this._edgeMeshes)n.position.add(s.clone().multiplyScalar(this._sectionOffset));this.plane.setFromNormalAndCoplanarPoint(s,this._point),this.plane.update()}dispose(){var t;this.clearMeshes(),(t=this.plane)==null||t.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}async set(t,e){this.flip&&e.multiplyScalar(-1),this.plane.setFromNormalAndCoplanarPoint(e,t),this._point.copy(t)}async update(){this.clearMeshes();const t=this.components.get(ut);this.plane.update();const e=[];for(const[,s]of t.list)e.push(this.generateModelSection(s));await Promise.all(e)}async generateModelSection(t){if(!this.world)return;const e=this.plane.three.clone();e.constant-=.01;const{buffer:s}=await t.getSection(e),n=new xe,r=new Je(s,3,!1);n.setAttribute("position",r);const o=new gc(n),a=new _u;a.fromLineSegments(o);const l=new ey(a,this.edgeMaterial);l.frustumCulled=!1,this.world.scene.three.add(l),this._edgeMeshes.push(l),l.renderOrder=3,o.geometry.dispose()}clearMeshes(){for(const t of this._edgeMeshes)t.removeFromParent(),t.geometry.dispose(),t.material=void 0;this._edgeMeshes=[]}};P(HC,"uuid","96b2c87e-d90b-4639-8257-8f01136fe324");const Gn=class Ii{constructor(t){P(this,"onDisposed",new et),P(this,"marker",null),P(this,"world",null),P(this,"mode",0),P(this,"maxDistance",1),P(this,"_enabled",!1),P(this,"_components"),P(this,"_preview",document.createElement("div")),P(this,"_pointerVisible",!1),P(this,"_intersectionFound",!1),this._components=t;for(const e in Ii.baseSnappingStyle){const s=Ii.baseSnappingStyle[e];this._preview.style[e]=s}this._preview.style.zIndex="999",this._preview.style.pointerEvents="none",this._preview.style.position="fixed",this._preview.style.top="0",this._preview.style.left="0"}set enabled(t){this._enabled=t,this.marker&&(this.marker.visible=t),t&&this.get()}get enabled(){return this._enabled}dispose(){this.marker&&this.marker.dispose()}async get(t){return this.mode===1?this.getSynchronous(t):this.getDefault(t)}async getSynchronous(t){const e=(t==null?void 0:t.world)??this.world;if(!e)throw new Error("GraphicVertexPicker: a world is need to get a casting result.");const s=this._components.get(Re).get(e);let n=null;if(this.mode===0?n=await s.castRay({snappingClasses:t==null?void 0:t.snappingClasses}):this.mode===1&&(n=await s.castRayToObjects()),this._intersectionFound=!!n,n){const{point:r}=n;if(!this.marker){const o=document.createElement("div");this.marker=new Os(e,o)}if(this.marker.world!==e&&(this.marker.world=e,this.marker.three.removeFromParent(),e.scene.three.add(this.marker.three)),this.hidePointer(),this.marker.visible=!0,!!(t!=null&&t.snappingClasses)){const o=(t==null?void 0:t.snappingClasses)||[];let a=Ve.FACE;o.includes(Ve.POINT)?a=Ve.POINT:o.includes(Ve.LINE)&&(a=Ve.LINE);let l=!1;if(a!==Ve.FACE&&(l=this.applySnapping(n,a)),!l)Object.assign(this.marker.three.element.style,Ii.baseSnappingStyle);else{const c=Ii.snappingStyles[a]??Ii.baseSnappingStyle;Object.assign(this.marker.three.element.style,c)}this.marker.three.position.copy(r)}else Object.assign(this.marker.three.element.style,Ii.baseSnappingStyle)}else this.marker&&(this.marker.visible=!1);return n}async getDefault(t){const e=(t==null?void 0:t.world)??this.world;if(!e)throw new Error("GraphicVertexPicker: a world is need to get a casting result.");const s=await this._components.get(Re).get(e).castRay({snappingClasses:t==null?void 0:t.snappingClasses});if(this._intersectionFound=!!s,s){const{point:n}=s;if(!this.marker){const r=document.createElement("div");this.marker=new Os(e,r)}if(this.marker.world!==e&&(this.marker.world=e,this.marker.three.removeFromParent(),e.scene.three.add(this.marker.three)),this.hidePointer(),this.marker.visible=!0,this.marker.three.position.copy(n),"snappingClass"in s&&typeof s.snappingClass=="number"&&(s.snappingClass===0||s.snappingClass===1||s.snappingClass===2)){const r=Ii.snappingStyles[s.snappingClass]??Ii.baseSnappingStyle;Object.assign(this.marker.three.element.style,r)}else Object.assign(this.marker.three.element.style,Ii.baseSnappingStyle)}else this.marker&&(this.marker.visible=!1);return s}updatePointer(){if(!this.world||!this.marker)return;if(this.mode===1&&this._intersectionFound){this.hidePointer();return}this.showPointer(),this.marker.visible&&(this.marker.visible=!1);const t=this._components.get(Re).get(this.world).mouse.rawPosition;this._preview.style.transform=`translate(-50%, -50%) translate(${t.x}px, ${t.y}px)`}showPointer(){var t;!this.world||this._pointerVisible||(this._pointerVisible=!0,(t=this.world.renderer.three.domElement.parentElement)==null||t.appendChild(this._preview))}hidePointer(){var t;!this.world||!this._pointerVisible||(this._pointerVisible=!1,(t=this.world.renderer.three.domElement.parentElement)==null||t.removeChild(this._preview))}applySnapping(t,e){if(e===Ve.FACE)return!0;const s=t.object;if(!t.face||!s||!s.geometry||!s.geometry.index||!s.geometry.attributes||!s.geometry.attributes.position)return!1;const n=t.object.matrixWorld,r=s.geometry.attributes.position.array,o=t.point,a=t.face.a,l=t.face.b,c=t.face.c,h=new L(r[a*3],r[a*3+1],r[a*3+2]).applyMatrix4(n),d=new L(r[l*3],r[l*3+1],r[l*3+2]).applyMatrix4(n),u=new L(r[c*3],r[c*3+1],r[c*3+2]).applyMatrix4(n);if(t.facePoints=[h.x,h.y,h.z,d.x,d.y,d.z,u.x,u.y,u.z],e===Ve.LINE){const y=[[h,d],[d,u],[u,h]],v=new L,_=new L,x=new ti;let S=Number.MAX_SAFE_INTEGER,k=!1;const T=this.maxDistance*this.maxDistance;for(const[M,O]of y){x.set(M,O),x.closestPointToPoint(o,!0,v);const R=o.distanceToSquared(v);R<T&&R<S&&(t.snappedEdgeP1=M,t.snappedEdgeP2=O,S=R,_.copy(v),k=!0)}return k?(t.point.copy(_),!0):!1}const p=[h,d,u],m=new L;let f=Number.MAX_SAFE_INTEGER,b=!1;const g=this.maxDistance*this.maxDistance;for(let y=0;y<p.length;y++){const v=p[y],_=o.distanceToSquared(v);_<g&&_<f&&(f=_,m.copy(v),b=!0)}return b?(t.point.copy(m),!0):!1}};P(Gn,"baseSnappingStyle",{height:"6px",width:"6px",borderRadius:"100%",borderWidth:"2px",borderColor:"rgb(122, 75, 209)",borderStyle:"solid",zIndex:"-20"}),P(Gn,"snappingStyles",{[Ve.FACE]:{...Gn.baseSnappingStyle},[Ve.POINT]:{...Gn.baseSnappingStyle,borderColor:"#e25959",borderRadius:"0"},[Ve.LINE]:{...Gn.baseSnappingStyle,borderColor:"#2d2d2d",borderRadius:"0"}});let WC=Gn;function hy(){const i=document.createElement("div");return i.style.backgroundColor="blue",i.style.color="white",i.style.padding="6px",i.style.borderRadius="6px",i.style.boxShadow="0px 4px 6px rgba(0, 0, 0, 0.6)",i.style.zIndex="-10",i}function qC(i={}){const{color:t="white",size:e="4px",border:s="2px solid blue",background:n="white"}=i,r=document.createElement("div");return r.style.backgroundColor=n,r.style.color=t,r.style.height=e,r.style.width=e,r.style.borderRadius="50%",r.style.border=s,r.style.zIndex="-20",r}let Is=class extends ti{constructor(){super(...arguments),P(this,"id",_e.create()),P(this,"_units","m"),P(this,"_rounding",2)}set units(t){this._units=t}get units(){return this._units}set rounding(t){this._rounding=t}get rounding(){return this._rounding}get value(){const t=this.distance();return lr.convertUnits(t,"m",this.units,this.rounding)}},YC=class Cd{constructor(t,e,s,n=2,r="m"){P(this,"label"),P(this,"boundingBox",new at),P(this,"world"),P(this,"_components"),P(this,"_units","m"),P(this,"_rounding",2),P(this,"startNormal",null),P(this,"line"),P(this,"rectangleComponentLines",[]),P(this,"projectionComponentLines",[]),P(this,"_visible",!0),P(this,"_root",new Ls),P(this,"_endpoints",new se),P(this,"lineElement"),P(this,"rectangleDimensions",new se),P(this,"projectionDimensions",new se),P(this,"isSelected",!1),P(this,"_latestRectangularInversion",!1),P(this,"_endpointElement",qC()),P(this,"_material"),P(this,"_componentsMaterial",new W0({depthTest:!1,gapSize:.2,dashSize:.2,transparent:!0,opacity:.5,color:3026478})),P(this,"valueFormatter",null),this._components=t,this.world=e,this._material=s.lineMaterial,this._rounding=n,this._units=r,this.line=s.line,this.startNormal=s.startNormal??null,this.rectangleComponentLines=[new Is,new Is],this.updateRectangleComponents(),this.updateProjectionComponents(),this.lineElement=this.createLine(s),this._endpoints.onItemAdded.add(o=>{this._root.add(o.three);const a=this._endpoints.size===1?this.line.start:this.line.end;o.three.position.copy(a)}),this._endpoints.onBeforeDelete.add(o=>o.dispose()),this.createEndpoints();for(const o of this._endpoints)o.three.element.style.borderColor=`#${s.lineMaterial.color.getHexString()}`;this.label=this.newText(),this.label.three.element.style.backgroundColor=`#${s.lineMaterial.color.getHexString()}`,this.label.three.renderOrder=1,this._root.renderOrder=2,this.world.scene.three.add(this._root),this.setupEvents()}set units(t){for(const e of this.rectangleDimensions)e.units=t;for(const e of this.projectionDimensions)e.units=t;this._units=t,this.updateLabel()}get units(){return this._units}set rounding(t){for(const e of this.rectangleDimensions)e.rounding=t;for(const e of this.projectionDimensions)e.rounding=t;this._rounding=t,this.updateLabel()}get rounding(){return this._rounding}get visible(){return this._visible}set visible(t){for(const a of this.rectangleDimensions)a.visible=t;for(const a of this.projectionDimensions)a.visible=t;this._visible=t,this.label.visible=t;for(const a of this._endpoints)a.visible=t;const[e,s]=this._endpoints,n=e.three,r=s.three,o=this.label.three;t?(this.world.scene.three.add(this._root),this._root.add(o,n,r)):(o.removeFromParent(),n.removeFromParent(),r.removeFromParent(),this._root.removeFromParent())}set end(t){this.line.end=t;const e=this.lineElement.geometry.attributes.position;e.setXYZ(1,t.x,t.y,t.z),e.needsUpdate=!0,this.update()}set start(t){this.line.start=t;const e=this.lineElement.geometry.attributes.position;e.setXYZ(0,t.x,t.y,t.z),e.needsUpdate=!0,this.update()}applyPlanesVisibility(t){for(const e of this._endpoints){if(!e.wasVisible)continue;let s=!1;for(const n of t)if(n.distanceToPoint(e.three.position)<0){s=!0;break}e.three.visible=!s}if(this.label.wasVisible){let e=!1;const s=this.label.three.position;for(const n of t)if(n.distanceToPoint(s)<0){e=!0;break}this.label.three.visible=!e}for(const e of this.rectangleDimensions)e.applyPlanesVisibility(t);for(const e of this.projectionDimensions)e.applyPlanesVisibility(t)}setupEvents(){this.rectangleDimensions.onBeforeDelete.add(t=>t.dispose()),this.projectionDimensions.onBeforeDelete.add(t=>t.dispose())}dispose(){this.visible=!1;const t=this._components.get(Ui);t.destroy(this._root),t.destroy(this.lineElement),this._endpoints.clear(),this.label.dispose(),this.boundingBox&&t.destroy(this.boundingBox),this.rectangleDimensions.clear(),this.projectionDimensions.clear(),this._components=null}createBoundingBox(){const t=new L;this.line.getCenter(t);const e=this.line.distance();this.boundingBox.geometry=new Ae(1,1,e),this.boundingBox.position.copy(t),this.boundingBox.lookAt(this.line.end),this.boundingBox.visible=!1,this._root.add(this.boundingBox)}invertRectangularDimensions(){this.rectangleDimensions.size!==0&&(this.rectangleDimensions.clear(),this._latestRectangularInversion=!this._latestRectangularInversion,this.updateRectangleComponents(this._latestRectangularInversion),this.displayRectangularDimensions())}displayRectangularDimensions(){this.rectangleDimensions.clear();for(const t of this.rectangleComponentLines){const e=new Cd(this._components,this.world,{line:t,lineMaterial:this._componentsMaterial,endpointElement:this.endpointElement});e.lineElement.computeLineDistances(),this.rectangleDimensions.add(e)}}displayProjectionDimensions(){this.projectionDimensions.clear();for(const t of this.projectionComponentLines){const e=new Cd(this._components,this.world,{line:t,lineMaterial:this._componentsMaterial,endpointElement:this.endpointElement});e.lineElement.computeLineDistances(),this.projectionDimensions.add(e)}}set endpointElement(t){for(const e of this.rectangleDimensions)e.endpointElement=t;for(const e of this.projectionDimensions)e.endpointElement=t;this._endpointElement=t,this.createEndpoints()}get endpointElement(){return this._endpointElement}createEndpoints(){this._endpoints.clear();const t=new Os(this.world,this._endpointElement),e=new Os(this.world,this._endpointElement.cloneNode(!0));this._endpoints.add(t,e)}updateProjectionComponents(){if(!this.startNormal)return;const t=new oi().setFromNormalAndCoplanarPoint(this.startNormal,this.line.start),e=new L;t.projectPoint(this.line.end,e);let[s]=this.projectionComponentLines;s||(s=new Is,this.projectionComponentLines.push(s)),s.set(this.line.end,e),s.distance()<.01&&this.projectionComponentLines.shift();for(const n of this.projectionDimensions)n&&n.update()}updateRectangleComponents(t=!1){const e=t?this.line.end:this.line.start,s=t?this.line.start:this.line.end,n=new L;n.subVectors(s,e),Math.abs(s.y-e.y)>=.1?n.y=0:n.x=0;const r=e.clone().add(n),[o,a]=this.rectangleComponentLines;o.set(r,e),a.set(r,s);for(const l of this.rectangleDimensions)l.update()}updateLabel(){this.label.three.element.textContent=this.getTextContent();const t=new L;this.line.getCenter(t),this.label.three.position.copy(t)}updateGeometry(){this.updateRectangleComponents(),this.updateProjectionComponents(),[...this._endpoints][0].three.position.copy(this.line.start),[...this._endpoints][1].three.position.copy(this.line.end),this.lineElement.geometry.computeBoundingSphere()}update(){this.updateGeometry(),this.updateLabel()}set material(t){this._material.dispose(),this._material=t,this.lineElement.material=t}get material(){return this._material}createLine(t){const e=new xe;e.setFromPoints([t.line.start,t.line.end]);const s=new yi(e,t.lineMaterial);return this._root.add(s),s}newText(){const t=hy();t.textContent=this.getTextContent();const e=new Os(this.world,t),s=new L;return this.line.getCenter(s),e.three.position.copy(s),this._root.add(e.three),e}getTextContent(t=this.line.distance()){const e=lr.convertUnits(t,"m",this._units,this.rounding);return`${Us.valueFormatter?Us.valueFormatter(e):e.toFixed(this.rounding)} ${this._units}`}set color(t){const e=`#${t.getHexString()}`;this.label.three.element.style.backgroundColor=e;for(const s of this._endpoints)s.three.element.style.borderColor=e;this._material.color.set(t)}},xu=class dy{constructor(t){P(this,"id",_e.create()),P(this,"points",new se),P(this,"tolerance",.005),P(this,"_plane",null),P(this,"_rounding",2),P(this,"_units","m2"),this.points.guard=e=>{const s=[...this.points].some(r=>r.equals(e)),n=this.isPointInPlane(e);return!s&&n},this.points.onItemAdded.add(e=>{if(this.plane){const s=new L;this.plane.projectPoint(e,s),e.copy(s)}this.points.size<3||this.points.size===3&&this.computePlane()}),this.points.onItemDeleted.add(()=>{this.points.size>=3||(this._plane=null)}),this.points.onCleared.add(()=>{this._plane=null}),t&&this.points.add(...t)}get plane(){return this._plane}get _coordinateSystem(){if(!this.plane)return null;const t=this.plane.normal,e=new L,s=new L;return Math.abs(t.x)>Math.abs(t.z)?e.set(-t.y,t.x,0).normalize():e.set(0,-t.z,t.y).normalize(),s.crossVectors(t,e).normalize(),{normal:t.clone(),x:e.clone(),y:s.clone()}}get points2D(){if(!this.plane)if(this.points.size>=3)this.computePlane();else return null;return[...this.points].map(t=>this.convertPointTo2D(t)).filter(t=>t!==null)}get center(){if(!this.plane||this.points.size<3)return null;const t=this.points2D;if(!t||t.length===0)return null;const e=t.reduce((s,n)=>s.add(n),new Kt).divideScalar(t.length);return this.convertPointTo3D(e)}get value(){return lr.convertUnits(this.rawValue,"m2",this.units,this.rounding)}get rawValue(){const t=this.points2D;return t?Math.abs(H0.area(t)):0}get boundingBox(){if(this.points.size===0)return null;const t=new oe;for(const e of this.points)t.expandByPoint(e);return t}get perimeter(){const t=this.points2D;if(!t||t.length<2)return 0;let e=0;for(let s=0;s<t.length;s++){const n=t[s],r=t[(s+1)%t.length];e+=n.distanceTo(r)}return e}set rounding(t){this._rounding=t}get rounding(){return this._rounding}set units(t){this._units=t}get units(){return this._units}isPointInPlane(t){if(!this.plane)return!0;const e=this.plane.distanceToPoint(t);return Math.abs(e)<this.tolerance}clone(){const t=new dy([...this.points]);return t.units=this.units,t.rounding=this.rounding,t.tolerance=this.tolerance,t}computePlane(){const[t,e,s]=this.points;if(!(t&&e&&s))return null;const n=new L().subVectors(e,t),r=new L().subVectors(s,t),o=new L().crossVectors(n,r).normalize();return this._plane=new oi().setFromNormalAndCoplanarPoint(o,t),this.plane}convertPointTo2D(t){if(!this.isPointInPlane(t)||!this.plane)return null;const e=this._coordinateSystem;if(!e)return null;const s=new L;this.plane.projectPoint(t,s);const n=s.dot(e.x),r=s.dot(e.y);return new Kt(n,r)}convertPointTo3D(t){if(!this.plane)return null;const e=this._coordinateSystem;if(!e)return null;const{x:s,y:n,normal:r}=e;return new L().addScaledVector(s,t.x).addScaledVector(n,t.y).addScaledVector(r,-this.plane.constant)}},uy=class py{constructor(t){P(this,"_components"),P(this,"id",_e.create()),P(this,"onItemsChanged",new et),P(this,"_items",{}),P(this,"_units","m3"),P(this,"_rounding",2),this._components=t}set items(t){this._items=t,this.onItemsChanged.trigger()}get items(){return this._items}set units(t){this._units=t}get units(){return this._units}set rounding(t){this._rounding=t}get rounding(){return this._rounding}async getRawValue(){return await this._components.get(lr).getItemsVolume(this.items)}async getValue(){const t=await this.getRawValue();return lr.convertUnits(t,"m3",this.units,this.rounding)}async getCenter(){return await this._components.get(Ul).getCenter(this.items)}async getBox(){const t=this._components.get(Ul);t.list.clear(),await t.addFromModelIdMap(this.items);const e=t.get();return t.list.clear(),e}clone(){const t=new py(this._components);return t.items=Rt.clone(this.items),t}};function ZC(i,t,e=2){const s=i.length;let n=GC(i,0,s,e,!0);const r=[];if(!n||n.next===n.prev)return r;let o,a,l;if(i.length>80*e){o=1/0,a=1/0;let c=-1/0,h=-1/0;for(let d=e;d<s;d+=e){const u=i[d],p=i[d+1];u<o&&(o=u),p<a&&(a=p),u>c&&(c=u),p>h&&(h=p)}l=Math.max(c-o,h-a),l=l!==0?32767/l:0}return Bo(n,r,e,o,a,l,0),r}function GC(i,t,e,s,n){let r;if(n===aS(i,t,e,s)>0)for(let o=t;o<e;o+=s)r=_f(o/s|0,i[o],i[o+1],r);else for(let o=e-s;o>=t;o-=s)r=_f(o/s|0,i[o],i[o+1],r);return r&&kc(r,r.next)&&(No(r),r=r.next),r}function Ro(i,t){if(!i)return i;t||(t=i);let e=i,s;do if(s=!1,!e.steiner&&(kc(e,e.next)||ne(e.prev,e,e.next)===0)){if(No(e),e=t=e.prev,e===e.next)break;s=!0}else e=e.next;while(s||e!==t);return t}function Bo(i,t,e,s,n,r,o){if(!i)return;!o&&r&&tS(i,s,n,r);let a=i;for(;i.prev!==i.next;){const l=i.prev,c=i.next;if(r?KC(i,s,n,r):XC(i)){t.push(l.i,i.i,c.i),No(i),i=c.next,a=c.next;continue}if(i=c,i===a){o?o===1?(i=QC(Ro(i),t),Bo(i,t,e,s,n,r,2)):o===2&&JC(i,t,e,s,n,r):Bo(Ro(i),t,e,s,n,r,1);break}}}function XC(i){const t=i.prev,e=i,s=i.next;if(ne(t,e,s)>=0)return!1;const n=t.x,r=e.x,o=s.x,a=t.y,l=e.y,c=s.y,h=Math.min(n,r,o),d=Math.min(a,l,c),u=Math.max(n,r,o),p=Math.max(a,l,c);let m=s.next;for(;m!==t;){if(m.x>=h&&m.x<=u&&m.y>=d&&m.y<=p&&fo(n,a,r,l,o,c,m.x,m.y)&&ne(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function KC(i,t,e,s){const n=i.prev,r=i,o=i.next;if(ne(n,r,o)>=0)return!1;const a=n.x,l=r.x,c=o.x,h=n.y,d=r.y,u=o.y,p=Math.min(a,l,c),m=Math.min(h,d,u),f=Math.max(a,l,c),b=Math.max(h,d,u),g=Sd(p,m,t,e,s),y=Sd(f,b,t,e,s);let v=i.prevZ,_=i.nextZ;for(;v&&v.z>=g&&_&&_.z<=y;){if(v.x>=p&&v.x<=f&&v.y>=m&&v.y<=b&&v!==n&&v!==o&&fo(a,h,l,d,c,u,v.x,v.y)&&ne(v.prev,v,v.next)>=0||(v=v.prevZ,_.x>=p&&_.x<=f&&_.y>=m&&_.y<=b&&_!==n&&_!==o&&fo(a,h,l,d,c,u,_.x,_.y)&&ne(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;v&&v.z>=g;){if(v.x>=p&&v.x<=f&&v.y>=m&&v.y<=b&&v!==n&&v!==o&&fo(a,h,l,d,c,u,v.x,v.y)&&ne(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;_&&_.z<=y;){if(_.x>=p&&_.x<=f&&_.y>=m&&_.y<=b&&_!==n&&_!==o&&fo(a,h,l,d,c,u,_.x,_.y)&&ne(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function QC(i,t){let e=i;do{const s=e.prev,n=e.next.next;!kc(s,n)&&fy(s,e,e.next,n)&&Hl(s,n)&&Hl(n,s)&&(t.push(s.i,e.i,n.i),No(e),No(e.next),e=i=n),e=e.next}while(e!==i);return Ro(e)}function JC(i,t,e,s,n,r){let o=i;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&sS(o,a)){let l=oS(o,a);o=Ro(o,o.next),l=Ro(l,l.next),Bo(o,t,e,s,n,r,0),Bo(l,t,e,s,n,r,0);return}a=a.next}o=o.next}while(o!==i)}function tS(i,t,e,s){let n=i;do n.z===0&&(n.z=Sd(n.x,n.y,t,e,s)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==i);n.prevZ.nextZ=null,n.prevZ=null,eS(n)}function eS(i){let t,e=1;do{let s=i,n;i=null;let r=null;for(t=0;s;){t++;let o=s,a=0;for(let c=0;c<e&&(a++,o=o.nextZ,!!o);c++);let l=e;for(;a>0||l>0&&o;)a!==0&&(l===0||!o||s.z<=o.z)?(n=s,s=s.nextZ,a--):(n=o,o=o.nextZ,l--),r?r.nextZ=n:i=n,n.prevZ=r,r=n;s=o}r.nextZ=null,e*=2}while(t>1);return i}function Sd(i,t,e,s,n){return i=(i-e)*n|0,t=(t-s)*n|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function iS(i,t,e,s,n,r,o,a){return(n-o)*(t-a)>=(i-o)*(r-a)&&(i-o)*(s-a)>=(e-o)*(t-a)&&(e-o)*(r-a)>=(n-o)*(s-a)}function fo(i,t,e,s,n,r,o,a){return!(i===o&&t===a)&&iS(i,t,e,s,n,r,o,a)}function sS(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!nS(i,t)&&(Hl(i,t)&&Hl(t,i)&&rS(i,t)&&(ne(i.prev,i,t.prev)||ne(i,t.prev,t))||kc(i,t)&&ne(i.prev,i,i.next)>0&&ne(t.prev,t,t.next)>0)}function ne(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function kc(i,t){return i.x===t.x&&i.y===t.y}function fy(i,t,e,s){const n=tl(ne(i,t,e)),r=tl(ne(i,t,s)),o=tl(ne(e,s,i)),a=tl(ne(e,s,t));return!!(n!==r&&o!==a||n===0&&Ja(i,e,t)||r===0&&Ja(i,s,t)||o===0&&Ja(e,i,s)||a===0&&Ja(e,t,s))}function Ja(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function tl(i){return i>0?1:i<0?-1:0}function nS(i,t){let e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&fy(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function Hl(i,t){return ne(i.prev,i,i.next)<0?ne(i,t,i.next)>=0&&ne(i,i.prev,t)>=0:ne(i,t,i.prev)<0||ne(i,i.next,t)<0}function rS(i,t){let e=i,s=!1;const n=(i.x+t.x)/2,r=(i.y+t.y)/2;do e.y>r!=e.next.y>r&&e.next.y!==e.y&&n<(e.next.x-e.x)*(r-e.y)/(e.next.y-e.y)+e.x&&(s=!s),e=e.next;while(e!==i);return s}function oS(i,t){const e=Ed(i.i,i.x,i.y),s=Ed(t.i,t.x,t.y),n=i.next,r=t.prev;return i.next=t,t.prev=i,e.next=n,n.prev=e,s.next=e,e.prev=s,r.next=s,s.prev=r,s}function _f(i,t,e,s){const n=Ed(i,t,e);return s?(n.next=s.next,n.prev=s,s.next.prev=n,s.next=n):(n.prev=n,n.next=n),n}function No(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Ed(i,t,e){return{i,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function aS(i,t,e,s){let n=0;for(let r=t,o=e-s;r<e;r+=s)n+=(i[o]-i[r])*(i[r+1]+i[o+1]),o=r;return n}let my=class extends Os{constructor(t){const e=document.createElement("div");e.style.backgroundColor="blue",e.style.color="white",e.style.padding="6px",e.style.borderRadius="6px",e.style.boxShadow="0px 4px 6px rgba(0, 0, 0, 0.6)",e.style.zIndex="-10",super(t,e),P(this,"_value",0),P(this,"_units","m2"),P(this,"_worldUnits","m2"),P(this,"_color",new gt),P(this,"_textColor",new gt),P(this,"_rounding",2),this.three.renderOrder=1,e.textContent=this.formattedValue}set value(t){this._value=t,this.three.element.textContent=this.formattedValue}get value(){return this._value}set units(t){this._units=t,this.three.element.textContent=this.formattedValue}get units(){return this._units}set worldUnits(t){this._worldUnits=t,this.three.element.textContent=this.formattedValue}get worldUnits(){return this._worldUnits}set color(t){this._color=t;const e=`#${t.getHexString()}`;this.three.element.style.backgroundColor=e}get color(){return this._color}set textColor(t){this._textColor=t;const e=`#${t.getHexString()}`;this.three.element.style.color=e}get textColor(){return this._textColor}set rounding(t){this._rounding=t,this.three.element.textContent=this.formattedValue}get rounding(){return this._rounding}get formattedValue(){const t=lr.convertUnits(this.value,this.worldUnits,this.units,this.rounding);return`${Us.valueFormatter?Us.valueFormatter(t):t.toFixed(this.rounding)} ${this.units}`}},lS=class{constructor(t,e,s=new xu){P(this,"_root",new Ls),P(this,"_components"),P(this,"_material",new Nl({color:"red",transparent:!0,opacity:.5,side:Bs,depthTest:!1})),P(this,"_visible",!0),P(this,"_color",new gt),P(this,"label"),P(this,"three",new at),P(this,"world"),P(this,"area"),P(this,"_triggerUpdate",()=>this.update()),this._components=t,this.world=e,this.area=s,this.world.scene.three.add(this.three),this.label=new my(e),this._root.renderOrder=2,this.visible=!0,this.update(),s.points.onItemAdded.add(this._triggerUpdate),s.points.onItemDeleted.add(this._triggerUpdate),s.points.onCleared.add(this._triggerUpdate)}set material(t){this._material.dispose(),this._material=t,this.three.material=t}get material(){return this._material}set visible(t){this._visible=t,this.label.visible=t;const e=this.label.three;t?(this._root.add(e,this.three),this.world.scene.three.add(this._root)):(e.removeFromParent(),this._root.removeFromParent())}get visible(){return this._visible}set rounding(t){this.label.rounding=t}get rounding(){return this.label.rounding}set units(t){this.label.units=t}get units(){return this.label.units}set color(t){this._color=t,this.label.color=t,this._material.color.set(t)}get color(){return this._color}applyPlanesVisibility(t){if(!this.label.wasVisible)return;let e=!1;const s=this.area.center;if(s){for(const n of t)if(n.distanceToPoint(s)<0){e=!0;break}}this.label.three.visible=!e}updateMesh(){if(this.area.points.size<3)return;const t=this.area.points2D;if(!t||t.length<3)return;const e=t.flatMap(o=>[o.x,o.y]),s=ZC(e),n=[];for(const o of t){const a=this.area.convertPointTo3D(o);a&&n.push(a.x,a.y,a.z)}this.three.geometry&&this.three.geometry.dispose();const r=new xe;r.setAttribute("position",new Ns(n,3)),r.setIndex(s),this.three.geometry=r,this.three.material=this.material}update(){if(this.updateMesh(),this.area.rawValue===0)this.label.visible=!1;else{this.label.value=this.area.rawValue,this.label.visible=!0;const t=this.area.center;t&&this.label.three.position.copy(t)}}dispose(){this.label.dispose(),this._components.get(Ui).destroy(this._root,!0,!0),this.area.points.clear()}};const cS={length:"m",area:"m2",volume:"m3"};let gy=class{constructor(t,e,s=new uy(t)){P(this,"_root",new Ls),P(this,"_components"),P(this,"_material",new Nl({color:"red",transparent:!0,opacity:.75,side:Bs,depthTest:!1})),P(this,"_visible",!0),P(this,"_color",new gt),P(this,"label"),P(this,"world"),P(this,"volume"),P(this,"meshes",[]),this._components=t,this.world=e,this.volume=s,this.label=new my(e),this._root.renderOrder=2,this.visible=!0,this.update(),this.volume.onItemsChanged.add(()=>this.update())}set material(t){this._material.dispose(),this._material=t;for(const e of this.meshes)e.material=t}get material(){return this._material}set visible(t){this._visible=t,this.label.visible=t;for(const e of this.meshes)t?this.world.scene.three.add(e):e.removeFromParent()}get visible(){return this._visible}set rounding(t){this.label.rounding=t}get rounding(){return this.label.rounding}set units(t){this.label.units=t}get units(){return this.label.units}set color(t){this._color=t,this.label.color=t,this._material.color.set(t)}get color(){return this._color}applyPlanesVisibility(t){if(!this.label.wasVisible)return;let e=!1;for(const s of this.meshes){for(const n of t)if(n.distanceToPoint(s.position)<0){e=!0;break}this.label.three.visible=!e}}async updateMesh(){this.cleanMeshes();const t=this._components.get(Vl),e=await t.get(this.volume.items,{material:this.material});this.meshes=t.getMeshesFromResult(e);for(const s of this.meshes)this.world.scene.three.add(s)}async update(){this.updateMesh();const t=await this.volume.getRawValue();this.label.visible=t!==0,this.label.value=t;const e=await this.volume.getCenter();e&&this.label.three.position.copy(e)}cleanMeshes(){const t=this._components.get(Ui);for(const e of this.meshes)t.destroy(e,!0,!0);this._components.get(Vl).remove(),this.meshes=[]}dispose(){this.label.dispose(),this.cleanMeshes(),this.volume.items={}}},Us=class extends zt{constructor(t,e){super(t),P(this,"list",new se),P(this,"onDisposed",new et),P(this,"snappings",[Ve.LINE,Ve.POINT,Ve.FACE]),P(this,"lines",new se),P(this,"fills",new se),P(this,"labels",new se),P(this,"volumes",new se),P(this,"delay",300),P(this,"_world",null),P(this,"measureType"),P(this,"onPointerStop",new et),P(this,"onPointerMove",new et),P(this,"onStateChanged",new et),P(this,"pointerStopTimeout",null),P(this,"onMove",()=>{this.enabled&&(this._vertexPicker.updatePointer(),this.pointerStopTimeout!==null&&clearTimeout(this.pointerStopTimeout),this.pointerStopTimeout=window.setTimeout(()=>{this.onPointerStop.trigger()},this.delay),this.onPointerMove.trigger())}),P(this,"onKeydown",s=>{this.enabled&&s.key==="Escape"&&this.cancelCreation()}),P(this,"onEnabledChange",new et),P(this,"_enabled",!1),P(this,"onVisibilityChange",new et),P(this,"_visible",!0),P(this,"_units"),P(this,"_rounding",2),P(this,"_linesEndpointElement",hy()),P(this,"_linesMaterial",new ru({color:"#0000FF",depthTest:!1})),P(this,"_fillsMaterial",new Nl({color:2392594,side:Bs,transparent:!0,opacity:.3,depthTest:!1})),P(this,"_volumesMaterial",new Nl({color:2392594,side:Bs,transparent:!0,opacity:.3,depthTest:!1})),P(this,"_color",new gt),P(this,"_vertexPicker",new WC(this.components)),P(this,"create",s=>{}),P(this,"endCreation",s=>{}),P(this,"cancelCreation",()=>{}),P(this,"delete",s=>{}),this.measureType=e,this._units=cS[this.measureType],this.lines.onBeforeDelete.add(s=>s.dispose()),this.fills.onBeforeDelete.add(s=>s.dispose()),this.labels.onBeforeDelete.add(s=>s.dispose()),this.volumes.onBeforeDelete.add(s=>s.dispose()),this.list.onCleared.add(()=>{this.lines.clear(),this.fills.clear(),this.labels.clear(),this.volumes.clear()})}set world(t){this._world=t,this._vertexPicker.world=t}get world(){return this._world}get unitsList(){let t=[];return this.measureType==="length"?t=["mm","cm","m","km"]:this.measureType==="area"?t=["mm2","cm2","m2","km2"]:t=["mm3","cm3","m3","km3"],t}setEvents(t){if(!this.world)throw new Error("Measurement: you must specify a world first!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("Measurement: the world needs a renderer!");const e=this.world.renderer.three.domElement.parentElement;e&&(e.removeEventListener("pointermove",this.onMove),window.removeEventListener("keydown",this.onKeydown),t&&(e.addEventListener("pointermove",this.onMove),window.addEventListener("keydown",this.onKeydown)))}set enabled(t){this._enabled=t,this._vertexPicker.enabled=t,this.setEvents(t),this.cancelCreation(),this.onEnabledChange.trigger(t),this.onStateChanged.trigger(["enabled"])}get enabled(){return this._enabled}set visible(t){this._visible=t;for(const e of this.lines)e.visible=t;for(const e of this.fills)e.visible=t;for(const e of this.volumes)e.visible=t;this.onVisibilityChange.trigger(t),this.onStateChanged.trigger(["visibility"])}get visible(){return this._visible}set units(t){this._units=t;let e;t.endsWith("2")?e="area":t.endsWith("3")?e="volume":e="length";for(const s of this.list)(s instanceof Is||s instanceof xu||s instanceof uy)&&(s.units=t);if(e==="length")for(const s of this.lines)s.units=t;else if(e==="area")for(const s of this.fills)s.units=t;else if(e==="volume")for(const s of this.volumes)s.units=t;this.onStateChanged.trigger(["units"])}get units(){return this._units}set rounding(t){this._rounding=t;for(const e of this.list)"rounding"in e&&typeof e.rounding=="number"&&(e.rounding=t);for(const e of this.lines)e.rounding=t;for(const e of this.fills)e.rounding=t;for(const e of this.volumes)e.rounding=t;this.onStateChanged.trigger(["rounding"])}get rounding(){return this._rounding}set linesEndpointElement(t){this._linesEndpointElement=t;for(const e of this.lines)e.endpointElement=t}get linesEndpointElement(){return this._linesEndpointElement}set linesMaterial(t){this._linesMaterial.dispose(),this._linesMaterial=t;for(const e of this.lines)e.material=t}get linesMaterial(){return this._linesMaterial}set fillsMaterial(t){this._fillsMaterial.dispose(),this._fillsMaterial=t;for(const e of this.fills)e.material=t}get fillsMaterial(){return this._fillsMaterial}set volumesMaterial(t){this._volumesMaterial.dispose(),this._volumesMaterial=t;for(const e of this.volumes)e.material=t}get volumesMaterial(){return this._volumesMaterial}set color(t){this._color=t,this._linesMaterial.color.set(t),this._fillsMaterial.color.set(t),this._volumesMaterial.color.set(t);for(const e of this.lines)e.color=t;for(const e of this.fills)e.color=t;for(const e of this.volumes)e.color=t;this.onStateChanged.trigger(["color"])}get color(){return this._color}get pickerMode(){return this._vertexPicker.mode}set pickerMode(t){this._vertexPicker.mode=t}get snapDistance(){return this._vertexPicker.maxDistance}set snapDistance(t){this._vertexPicker.maxDistance=t}dispose(){this._vertexPicker.dispose(),this.list.clear(),this.linesMaterial.dispose(),this.fillsMaterial.dispose(),this.volumesMaterial.dispose(),this.onDisposed.trigger()}applyPlanesVisibility(t){for(const e of this.lines)e.applyPlanesVisibility(t);for(const e of this.fills)e.applyPlanesVisibility(t);for(const e of this.volumes)e.applyPlanesVisibility(t)}createLineElement(t,e=null){if(!this.world)throw new Error("Measurement: world is need!");return new YC(this.components,this.world,{line:t,startNormal:e??void 0,lineMaterial:this.linesMaterial,endpointElement:this.linesEndpointElement},this.rounding,this.units)}createFillElement(t){if(!this.world)throw new Error("Measurement: world is need!");const e=new lS(this.components,this.world,t);return e.rounding=this.rounding,(this.units.endsWith("2")?"area":void 0)==="area"&&(e.units=this.units),e}createVolumeElement(t){if(!this.world)throw new Error("Measurement: world is need!");const e=new gy(this.components,this.world,t);return e.rounding=this.rounding,(this.units.endsWith("3")?"volume":void 0)==="volume"&&(e.units=this.units),e}addLineElementsFromPoints(t){for(let e=0;e<t.length;e++){const s=t[e],n=t[(e+1)%t.length],r=new Is(s,n),o=this.createLineElement(r);o.label.visible=!1,this.lines.add(o)}}getLineBoxes(){const t=[];for(const e of this.lines)t.push(e.boundingBox);return t}getFillBoxes(){const t=[];for(const e of this.fills)t.push(e.three);return t}async getVolumeBoxes(){const t=[];for(const e of this.volumes)t.push(e.meshes);return t}};P(Us,"valueFormatter",null);const hS=class by extends Us{constructor(t){super(t,"area"),P(this,"pickTolerance",.1),P(this,"tolerance",.005),P(this,"modes",["free","square","face"]),P(this,"_mode","free"),P(this,"_temp",{isDragging:!1,area:new xu,lines:new se,point:new L}),P(this,"_lineToAreaMap",new WeakMap),P(this,"computeLineElements",()=>{this._temp.lines.clear();const e=[...this._temp.area.points];if(this._temp.area.isPointInPlane(this._temp.point)&&e.push(this._temp.point),!(e.length<2||!this.world))for(let s=0;s<e.length;s++){const n=e[s],r=e[(s+1)%e.length],o=new Is(n,r),a=this.createLineElement(o);this._temp.lines.add(a)}}),P(this,"create",async()=>{if(!this.enabled)return;if(!this.world)throw new Error("Area Measurement: world is not defined!");const e=await this._vertexPicker.get({snappingClasses:this.snappings});if(!(e&&e.point))return;if(this.mode==="face"){const r=e.facePoints;if(!r)return;const o=[];for(let a=0;a<r.length-2;a+=3){const l=r[a],c=r[a+1],h=r[a+2];o.push(new L(l,c,h))}this._temp.area.points.add(...o),this.endCreation();return}const{area:s,point:n}=this._temp;if(this._temp.isDragging||(s.tolerance=this.tolerance,s.points.clear(),this._temp.isDragging=!0),s.points.size===0&&n.copy(e.point),s.points.add(n.clone()),this.mode==="square"&&s.points.size===2&&e.normal){const[r,o]=s.points,a=new L().subVectors(o,r),l=a.clone(),c=a.clone().negate();Math.abs(a.y)>=.1?(l.y=0,c.y=0):(l.x=0,c.x=0);const h=r.clone().add(l),d=o.clone().add(c);s.points.clear(),s.points.add(r,h,o,d),this.endCreation()}}),P(this,"endCreation",()=>{this.enabled&&(this._temp.isDragging=!1,this._temp.area.points.size>=3&&this.list.add(this._temp.area.clone()),this._temp.area.points.clear(),this._temp.lines.clear())}),P(this,"cancelCreation",()=>{this.enabled&&(this._temp.isDragging=!1,this._temp.area.points.clear(),this._temp.lines.clear())}),P(this,"delete",()=>{if(!this.enabled||this.list.size===0||!this.world)return;const e=this.getFillBoxes(),s=this.components.get(Re).get(this.world).castRayToObjects(e);if(!s)return;const n=[...this.fills].find(o=>o.three===s.object);if(!n)return;const r=n.area;this.fills.delete(n),this.list.delete(r),this.components.get(Ui).destroy(s.object)}),t.add(by.uuid,this),this.initHandlers(),this.color=new gt("#6528d7")}get mode(){return this._mode}set mode(t){this._mode=t,this.cancelCreation(),this.onStateChanged.trigger(["mode"])}initHandlers(){this.onVisibilityChange.add(()=>{for(const t of this.lines)t.label.visible=!1}),this.list.onItemAdded.add(t=>{if(!this.world)return;const e=this.createFillElement(t);e.color=this.color,this.fills.add(e),this.addLineElementsFromPointsForArea([...t.points],t)}),this.list.onBeforeDelete.add(t=>{const e=[...this.fills].find(n=>n.area===t);e&&this.fills.delete(e);const s=[];for(const n of this.lines)this._lineToAreaMap.get(n)===t&&s.push(n);for(const n of s)this.lines.delete(n),this._lineToAreaMap.delete(n)}),this.onPointerStop.add(()=>this.updatePreview()),this._temp.lines.onItemAdded.add(t=>t.label.visible=!1),this._temp.lines.onBeforeDelete.add(t=>t.dispose()),this._temp.area.points.onItemAdded.add(()=>{this.computeLineElements()}),this._temp.area.points.onItemDeleted.add(()=>{this._temp.lines.clear()}),this.onStateChanged.add(t=>{t.includes("rounding")&&(this._temp.area.rounding=this.rounding),t.includes("units")&&(this._temp.area.units=this.units)})}async updatePreview(){if(!this.enabled||!this.world)throw new Error("Measurement is not enabled or world is not defined!");const t=await this._vertexPicker.get({snappingClasses:this.snappings});if(!(t&&t.point&&this._temp.isDragging))return;const e=t.point.clone(),{plane:s}=this._temp.area;if(s){const n=s.distanceToPoint(e);if(Math.abs(n)<.1){const r=new L;s.projectPoint(e,r),e.copy(r)}}this._temp.point.copy(e),this.computeLineElements()}addLineElementsFromPointsForArea(t,e){for(let s=0;s<t.length;s++){const n=t[s],r=t[(s+1)%t.length],o=new Is(n,r),a=this.createLineElement(o);a.label.visible=!1,this.lines.add(a),this._lineToAreaMap.set(a,e)}}};P(hS,"uuid","09b78c1f-0ff1-4630-a818-ceda3d878c75");const dS=class yy extends Us{constructor(t){super(t,"length"),P(this,"_temp",{isDragging:!1,line:new Is}),P(this,"modes",["free","edge"]),P(this,"_mode","free"),P(this,"create",async()=>{if(this.enabled){if(!this._temp.isDragging){await this.initPreview();return}this.endCreation()}}),P(this,"endCreation",()=>{this.enabled&&this._temp.dimension&&(this.list.add(this._temp.line.clone()),this.mode==="free"&&(this._temp.dimension.dispose(),this._temp.dimension=void 0,this._temp.isDragging=!1,this._temp.startNormal=void 0))}),P(this,"cancelCreation",()=>{var e;this.enabled&&(this._temp.isDragging=!1,this._temp.dimension&&((e=this._temp.dimension)==null||e.dispose(),this._temp.dimension=void 0))}),P(this,"delete",()=>{if(!this.enabled||this.list.size===0||!this.world)return;const e=this.getLineBoxes(),s=this.components.get(Re).get(this.world).castRayToObjects(e);if(!s)return;const n=[...this.lines].find(r=>r.boundingBox===s.object);n&&this.list.delete(n.line)}),t.add(yy.uuid,this),this.initHandlers()}get mode(){return this._mode}set mode(t){this._mode=t,this.cancelCreation(),t==="edge"&&this.initPreview(),this.onStateChanged.trigger(["mode"])}get isDragging(){return this._temp.isDragging}initHandlers(){this.list.onItemAdded.add(t=>{const e=this.createLineElement(t,this._temp.startNormal);e.createBoundingBox(),this.lines.add(e)}),this.list.onBeforeDelete.add(t=>{const e=[...this.lines].find(s=>s.line===t);e&&this.lines.delete(e)}),this.onPointerStop.add(()=>this.updatePreviewLine()),this.onEnabledChange.add(t=>{t&&this.mode==="edge"&&this.initPreview()})}async initPreview(){if(!this.world)throw new Error("Measurement: world is need!");const t=await this._vertexPicker.get({snappingClasses:this.snappings});if(this.mode==="free"){if(!(t!=null&&t.point))return;const e=t.point;this._temp.line.set(e,e.clone()),this._temp.isDragging=!0,this._temp.dimension=this.createLineElement(this._temp.line),this._temp.startNormal=t.normal??void 0}else if(this.mode==="edge"){const e=t==null?void 0:t.snappedEdgeP1,s=t==null?void 0:t.snappedEdgeP2,n=e||new L,r=n||s;this._temp.line.set(n,r),this._temp.isDragging=!0,this._temp.dimension=this.createLineElement(this._temp.line),this._temp.dimension.visible=!!(e&&s)}}async updatePreviewLine(){if(!this.world)throw new Error("Measurement: world is need!");const t=await this._vertexPicker.get({snappingClasses:this.snappings});if(this.mode==="free"){if(!(t!=null&&t.point)||(this._temp.line.end.copy(t.point),!this._temp.dimension))return;this._temp.dimension.end=this._temp.line.end}else if(this.mode==="edge"){const e=t==null?void 0:t.snappedEdgeP1,s=t==null?void 0:t.snappedEdgeP2;if(this._temp.dimension&&(this._temp.dimension.visible=!!(e&&s)),!(e&&s)||(this._temp.line.start.copy(e),this._temp.line.end.copy(s),!this._temp.dimension))return;this._temp.dimension.start=this._temp.line.start,this._temp.dimension.end=this._temp.line.end}}};P(dS,"uuid","2f9bcacf-18a9-4be6-a293-e898eae64ea1");const uS=class vy extends Us{constructor(t){super(t,"volume"),P(this,"_temp",{}),P(this,"onPreviewInitialized",new et),P(this,"modes",["free"]),P(this,"_mode","free"),P(this,"_previousHovererState",!1),P(this,"create",async()=>{if(!this.enabled)return;const e=await this._vertexPicker.get();e&&(this._temp.preview||await this.initPreview(),this._temp.preview.volume.items=Rt.join([this._temp.preview.volume.items,{[e.fragments.modelId]:new Set([e.localId])}]))}),P(this,"endCreation",()=>{if(!this._temp.preview||Rt.isEmpty(this._temp.preview.volume.items))return;const e=this._temp.preview.volume.clone();this.list.add(e),this._temp.preview.dispose(),delete this._temp.preview}),P(this,"cancelCreation",()=>{var e;(e=this._temp.preview)==null||e.dispose(),delete this._temp.preview}),P(this,"delete",async()=>{if(this.list.size===0||!this.world)return;const e=await this.getVolumeBoxes(),s=this.components.get(Re).get(this.world);for(const n of e){const r=s.castRayToObjects(n);if(!r)continue;const o=[...this.volumes].find(a=>a.meshes.some(l=>l===r.object));if(!o)return;this.list.delete(o.volume)}}),t.add(vy.uuid,this),this.initHandlers()}get mode(){return this._mode}set mode(t){this._mode=t,this.cancelCreation(),this.onStateChanged.trigger(["mode"])}initHandlers(){this.list.onItemAdded.add(t=>{const e=this.createVolumeElement(t);e.color=this.color,e.rounding=this.rounding,e.units=this.units,this.volumes.add(e)}),this.list.onBeforeDelete.add(t=>{const e=[...this.volumes].find(s=>s.volume===t);e&&this.volumes.delete(e)}),this.onStateChanged.add(t=>{if(t.includes("color")){if(!this._temp.preview)return;this._temp.preview.color=this.color}if(t.includes("units")){if(!this._temp.preview)return;this._temp.preview.units=this.units}if(t.includes("rounding")){if(!this._temp.preview)return;this._temp.preview.rounding=this.rounding}if(t.includes("enabled")){const e=this.components.get(FC);e.world=this.world,this.enabled?(this._previousHovererState=e.enabled,e.enabled=!0):(e.clear(),e.enabled=this._previousHovererState),e.hover()}})}async initPreview(){if(this.enabled){if(!this.world)throw new Error("Measurement: world is need!");this._temp.preview=new gy(this.components,this.world),this._temp.preview.color=this.color,this._temp.preview.rounding=this.rounding,this._temp.preview.units=this.units,this.onPreviewInitialized.trigger(this._temp.preview)}}};P(uS,"uuid","01f885ab-ec4e-4e6c-a853-9dfc0d6766ed");/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Al=globalThis,Cu=Al.ShadowRoot&&(Al.ShadyCSS===void 0||Al.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Su=Symbol(),wf=new WeakMap;let _y=class{constructor(i,t,e){if(this._$cssResult$=!0,e!==Su)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=i,this.t=t}get styleSheet(){let i=this.o;const t=this.t;if(Cu&&i===void 0){const e=t!==void 0&&t.length===1;e&&(i=wf.get(t)),i===void 0&&((this.o=i=new CSSStyleSheet).replaceSync(this.cssText),e&&wf.set(t,i))}return i}toString(){return this.cssText}};const pS=i=>new _y(typeof i=="string"?i:i+"",void 0,Su),Eu=(i,...t)=>{const e=i.length===1?i[0]:t.reduce((s,n,r)=>s+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+i[r+1],i[0]);return new _y(e,i,Su)},fS=(i,t)=>{if(Cu)i.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const e of t){const s=document.createElement("style"),n=Al.litNonce;n!==void 0&&s.setAttribute("nonce",n),s.textContent=e.cssText,i.appendChild(s)}},xf=Cu?i=>i:i=>i instanceof CSSStyleSheet?(t=>{let e="";for(const s of t.cssRules)e+=s.cssText;return pS(e)})(i):i;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:mS,defineProperty:gS,getOwnPropertyDescriptor:bS,getOwnPropertyNames:yS,getOwnPropertySymbols:vS,getPrototypeOf:_S}=Object,cr=globalThis,Cf=cr.trustedTypes,wS=Cf?Cf.emptyScript:"",Sf=cr.reactiveElementPolyfillSupport,wo=(i,t)=>i,Wl={toAttribute(i,t){switch(t){case Boolean:i=i?wS:null;break;case Object:case Array:i=i==null?i:JSON.stringify(i)}return i},fromAttribute(i,t){let e=i;switch(t){case Boolean:e=i!==null;break;case Number:e=i===null?null:Number(i);break;case Object:case Array:try{e=JSON.parse(i)}catch{e=null}}return e}},ku=(i,t)=>!mS(i,t),Ef={attribute:!0,type:String,converter:Wl,reflect:!1,useDefault:!1,hasChanged:ku};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),cr.litPropertyMetadata??(cr.litPropertyMetadata=new WeakMap);let Xn=class extends HTMLElement{static addInitializer(i){this._$Ei(),(this.l??(this.l=[])).push(i)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(i,t=Ef){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(i)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(i,t),!t.noAccessor){const e=Symbol(),s=this.getPropertyDescriptor(i,e,t);s!==void 0&&gS(this.prototype,i,s)}}static getPropertyDescriptor(i,t,e){const{get:s,set:n}=bS(this.prototype,i)??{get(){return this[t]},set(r){this[t]=r}};return{get:s,set(r){const o=s==null?void 0:s.call(this);n==null||n.call(this,r),this.requestUpdate(i,o,e)},configurable:!0,enumerable:!0}}static getPropertyOptions(i){return this.elementProperties.get(i)??Ef}static _$Ei(){if(this.hasOwnProperty(wo("elementProperties")))return;const i=_S(this);i.finalize(),i.l!==void 0&&(this.l=[...i.l]),this.elementProperties=new Map(i.elementProperties)}static finalize(){if(this.hasOwnProperty(wo("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(wo("properties"))){const t=this.properties,e=[...yS(t),...vS(t)];for(const s of e)this.createProperty(s,t[s])}const i=this[Symbol.metadata];if(i!==null){const t=litPropertyMetadata.get(i);if(t!==void 0)for(const[e,s]of t)this.elementProperties.set(e,s)}this._$Eh=new Map;for(const[t,e]of this.elementProperties){const s=this._$Eu(t,e);s!==void 0&&this._$Eh.set(s,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(i){const t=[];if(Array.isArray(i)){const e=new Set(i.flat(1/0).reverse());for(const s of e)t.unshift(xf(s))}else i!==void 0&&t.push(xf(i));return t}static _$Eu(i,t){const e=t.attribute;return e===!1?void 0:typeof e=="string"?e:typeof i=="string"?i.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var i;this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(i=this.constructor.l)==null||i.forEach(t=>t(this))}addController(i){var t;(this._$EO??(this._$EO=new Set)).add(i),this.renderRoot!==void 0&&this.isConnected&&((t=i.hostConnected)==null||t.call(i))}removeController(i){var t;(t=this._$EO)==null||t.delete(i)}_$E_(){const i=new Map,t=this.constructor.elementProperties;for(const e of t.keys())this.hasOwnProperty(e)&&(i.set(e,this[e]),delete this[e]);i.size>0&&(this._$Ep=i)}createRenderRoot(){const i=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return fS(i,this.constructor.elementStyles),i}connectedCallback(){var i;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(i=this._$EO)==null||i.forEach(t=>{var e;return(e=t.hostConnected)==null?void 0:e.call(t)})}enableUpdating(i){}disconnectedCallback(){var i;(i=this._$EO)==null||i.forEach(t=>{var e;return(e=t.hostDisconnected)==null?void 0:e.call(t)})}attributeChangedCallback(i,t,e){this._$AK(i,e)}_$ET(i,t){var e;const s=this.constructor.elementProperties.get(i),n=this.constructor._$Eu(i,s);if(n!==void 0&&s.reflect===!0){const r=(((e=s.converter)==null?void 0:e.toAttribute)!==void 0?s.converter:Wl).toAttribute(t,s.type);this._$Em=i,r==null?this.removeAttribute(n):this.setAttribute(n,r),this._$Em=null}}_$AK(i,t){var e,s;const n=this.constructor,r=n._$Eh.get(i);if(r!==void 0&&this._$Em!==r){const o=n.getPropertyOptions(r),a=typeof o.converter=="function"?{fromAttribute:o.converter}:((e=o.converter)==null?void 0:e.fromAttribute)!==void 0?o.converter:Wl;this._$Em=r;const l=a.fromAttribute(t,o.type);this[r]=l??((s=this._$Ej)==null?void 0:s.get(r))??l,this._$Em=null}}requestUpdate(i,t,e,s=!1,n){var r;if(i!==void 0){const o=this.constructor;if(s===!1&&(n=this[i]),e??(e=o.getPropertyOptions(i)),!((e.hasChanged??ku)(n,t)||e.useDefault&&e.reflect&&n===((r=this._$Ej)==null?void 0:r.get(i))&&!this.hasAttribute(o._$Eu(i,e))))return;this.C(i,t,e)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(i,t,{useDefault:e,reflect:s,wrapped:n},r){e&&!(this._$Ej??(this._$Ej=new Map)).has(i)&&(this._$Ej.set(i,r??t??this[i]),n!==!0||r!==void 0)||(this._$AL.has(i)||(this.hasUpdated||e||(t=void 0),this._$AL.set(i,t)),s===!0&&this._$Em!==i&&(this._$Eq??(this._$Eq=new Set)).add(i))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const i=this.scheduleUpdate();return i!=null&&await i,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var i;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[n,r]of this._$Ep)this[n]=r;this._$Ep=void 0}const s=this.constructor.elementProperties;if(s.size>0)for(const[n,r]of s){const{wrapped:o}=r,a=this[n];o!==!0||this._$AL.has(n)||a===void 0||this.C(n,void 0,r,a)}}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),(i=this._$EO)==null||i.forEach(s=>{var n;return(n=s.hostUpdate)==null?void 0:n.call(s)}),this.update(e)):this._$EM()}catch(s){throw t=!1,this._$EM(),s}t&&this._$AE(e)}willUpdate(i){}_$AE(i){var t;(t=this._$EO)==null||t.forEach(e=>{var s;return(s=e.hostUpdated)==null?void 0:s.call(e)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(i)),this.updated(i)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(i){return!0}update(i){this._$Eq&&(this._$Eq=this._$Eq.forEach(t=>this._$ET(t,this[t]))),this._$EM()}updated(i){}firstUpdated(i){}};Xn.elementStyles=[],Xn.shadowRootOptions={mode:"open"},Xn[wo("elementProperties")]=new Map,Xn[wo("finalized")]=new Map,Sf==null||Sf({ReactiveElement:Xn}),(cr.reactiveElementVersions??(cr.reactiveElementVersions=[])).push("2.1.2");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ql=globalThis,kf=i=>i,Yl=ql.trustedTypes,Af=Yl?Yl.createPolicy("lit-html",{createHTML:i=>i}):void 0,wy="$lit$",xs=`lit$${Math.random().toFixed(9).slice(2)}$`,xy="?"+xs,xS=`<${xy}>`,xn=document,Fo=()=>xn.createComment(""),Uo=i=>i===null||typeof i!="object"&&typeof i!="function",Au=Array.isArray,CS=i=>Au(i)||typeof(i==null?void 0:i[Symbol.iterator])=="function",kh=`[ 	
\f\r]`,Jr=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Tf=/-->/g,Mf=/>/g,sn=RegExp(`>|${kh}(?:([^\\s"'>=/]+)(${kh}*=${kh}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Pf=/'/g,$f=/"/g,Cy=/^(?:script|style|textarea|title)$/i,SS=i=>(t,...e)=>({_$litType$:i,strings:t,values:e}),Tu=SS(1),hr=Symbol.for("lit-noChange"),ce=Symbol.for("lit-nothing"),Of=new WeakMap,fn=xn.createTreeWalker(xn,129);function Sy(i,t){if(!Au(i)||!i.hasOwnProperty("raw"))throw Error("invalid template strings array");return Af!==void 0?Af.createHTML(t):t}const ES=(i,t)=>{const e=i.length-1,s=[];let n,r=t===2?"<svg>":t===3?"<math>":"",o=Jr;for(let a=0;a<e;a++){const l=i[a];let c,h,d=-1,u=0;for(;u<l.length&&(o.lastIndex=u,h=o.exec(l),h!==null);)u=o.lastIndex,o===Jr?h[1]==="!--"?o=Tf:h[1]!==void 0?o=Mf:h[2]!==void 0?(Cy.test(h[2])&&(n=RegExp("</"+h[2],"g")),o=sn):h[3]!==void 0&&(o=sn):o===sn?h[0]===">"?(o=n??Jr,d=-1):h[1]===void 0?d=-2:(d=o.lastIndex-h[2].length,c=h[1],o=h[3]===void 0?sn:h[3]==='"'?$f:Pf):o===$f||o===Pf?o=sn:o===Tf||o===Mf?o=Jr:(o=sn,n=void 0);const p=o===sn&&i[a+1].startsWith("/>")?" ":"";r+=o===Jr?l+xS:d>=0?(s.push(c),l.slice(0,d)+wy+l.slice(d)+xs+p):l+xs+(d===-2?a:p)}return[Sy(i,r+(i[e]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),s]};class jo{constructor({strings:t,_$litType$:e},s){let n;this.parts=[];let r=0,o=0;const a=t.length-1,l=this.parts,[c,h]=ES(t,e);if(this.el=jo.createElement(c,s),fn.currentNode=this.el.content,e===2||e===3){const d=this.el.content.firstChild;d.replaceWith(...d.childNodes)}for(;(n=fn.nextNode())!==null&&l.length<a;){if(n.nodeType===1){if(n.hasAttributes())for(const d of n.getAttributeNames())if(d.endsWith(wy)){const u=h[o++],p=n.getAttribute(d).split(xs),m=/([.?@])?(.*)/.exec(u);l.push({type:1,index:r,name:m[2],strings:p,ctor:m[1]==="."?AS:m[1]==="?"?TS:m[1]==="@"?MS:Ac}),n.removeAttribute(d)}else d.startsWith(xs)&&(l.push({type:6,index:r}),n.removeAttribute(d));if(Cy.test(n.tagName)){const d=n.textContent.split(xs),u=d.length-1;if(u>0){n.textContent=Yl?Yl.emptyScript:"";for(let p=0;p<u;p++)n.append(d[p],Fo()),fn.nextNode(),l.push({type:2,index:++r});n.append(d[u],Fo())}}}else if(n.nodeType===8)if(n.data===xy)l.push({type:2,index:r});else{let d=-1;for(;(d=n.data.indexOf(xs,d+1))!==-1;)l.push({type:7,index:r}),d+=xs.length-1}r++}}static createElement(t,e){const s=xn.createElement("template");return s.innerHTML=t,s}}function dr(i,t,e=i,s){var n,r;if(t===hr)return t;let o=s!==void 0?(n=e._$Co)==null?void 0:n[s]:e._$Cl;const a=Uo(t)?void 0:t._$litDirective$;return(o==null?void 0:o.constructor)!==a&&((r=o==null?void 0:o._$AO)==null||r.call(o,!1),a===void 0?o=void 0:(o=new a(i),o._$AT(i,e,s)),s!==void 0?(e._$Co??(e._$Co=[]))[s]=o:e._$Cl=o),o!==void 0&&(t=dr(i,o._$AS(i,t.values),o,s)),t}let kS=class{constructor(i,t){this._$AV=[],this._$AN=void 0,this._$AD=i,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(i){const{el:{content:t},parts:e}=this._$AD,s=((i==null?void 0:i.creationScope)??xn).importNode(t,!0);fn.currentNode=s;let n=fn.nextNode(),r=0,o=0,a=e[0];for(;a!==void 0;){if(r===a.index){let l;a.type===2?l=new oa(n,n.nextSibling,this,i):a.type===1?l=new a.ctor(n,a.name,a.strings,this,i):a.type===6&&(l=new PS(n,this,i)),this._$AV.push(l),a=e[++o]}r!==(a==null?void 0:a.index)&&(n=fn.nextNode(),r++)}return fn.currentNode=xn,s}p(i){let t=0;for(const e of this._$AV)e!==void 0&&(e.strings!==void 0?(e._$AI(i,e,t),t+=e.strings.length-2):e._$AI(i[t])),t++}};class oa{get _$AU(){var t;return((t=this._$AM)==null?void 0:t._$AU)??this._$Cv}constructor(t,e,s,n){this.type=2,this._$AH=ce,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=s,this.options=n,this._$Cv=(n==null?void 0:n.isConnected)??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=dr(this,t,e),Uo(t)?t===ce||t==null||t===""?(this._$AH!==ce&&this._$AR(),this._$AH=ce):t!==this._$AH&&t!==hr&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):CS(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==ce&&Uo(this._$AH)?this._$AA.nextSibling.data=t:this.T(xn.createTextNode(t)),this._$AH=t}$(t){var e;const{values:s,_$litType$:n}=t,r=typeof n=="number"?this._$AC(t):(n.el===void 0&&(n.el=jo.createElement(Sy(n.h,n.h[0]),this.options)),n);if(((e=this._$AH)==null?void 0:e._$AD)===r)this._$AH.p(s);else{const o=new kS(r,this),a=o.u(this.options);o.p(s),this.T(a),this._$AH=o}}_$AC(t){let e=Of.get(t.strings);return e===void 0&&Of.set(t.strings,e=new jo(t)),e}k(t){Au(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let s,n=0;for(const r of t)n===e.length?e.push(s=new oa(this.O(Fo()),this.O(Fo()),this,this.options)):s=e[n],s._$AI(r),n++;n<e.length&&(this._$AR(s&&s._$AB.nextSibling,n),e.length=n)}_$AR(t=this._$AA.nextSibling,e){var s;for((s=this._$AP)==null?void 0:s.call(this,!1,!0,e);t!==this._$AB;){const n=kf(t).nextSibling;kf(t).remove(),t=n}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}}let Ac=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(i,t,e,s,n){this.type=1,this._$AH=ce,this._$AN=void 0,this.element=i,this.name=t,this._$AM=s,this.options=n,e.length>2||e[0]!==""||e[1]!==""?(this._$AH=Array(e.length-1).fill(new String),this.strings=e):this._$AH=ce}_$AI(i,t=this,e,s){const n=this.strings;let r=!1;if(n===void 0)i=dr(this,i,t,0),r=!Uo(i)||i!==this._$AH&&i!==hr,r&&(this._$AH=i);else{const o=i;let a,l;for(i=n[0],a=0;a<n.length-1;a++)l=dr(this,o[e+a],t,a),l===hr&&(l=this._$AH[a]),r||(r=!Uo(l)||l!==this._$AH[a]),l===ce?i=ce:i!==ce&&(i+=(l??"")+n[a+1]),this._$AH[a]=l}r&&!s&&this.j(i)}j(i){i===ce?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,i??"")}},AS=class extends Ac{constructor(){super(...arguments),this.type=3}j(i){this.element[this.name]=i===ce?void 0:i}};class TS extends Ac{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==ce)}}class MS extends Ac{constructor(t,e,s,n,r){super(t,e,s,n,r),this.type=5}_$AI(t,e=this){if((t=dr(this,t,e,0)??ce)===hr)return;const s=this._$AH,n=t===ce&&s!==ce||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,r=t!==ce&&(s===ce||n);n&&this.element.removeEventListener(this.name,this,s),r&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e;typeof this._$AH=="function"?this._$AH.call(((e=this.options)==null?void 0:e.host)??this.element,t):this._$AH.handleEvent(t)}}class PS{constructor(t,e,s){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(t){dr(this,t)}}const Df=ql.litHtmlPolyfillSupport;Df==null||Df(jo,oa),(ql.litHtmlVersions??(ql.litHtmlVersions=[])).push("3.3.2");const $S=(i,t,e)=>{const s=(e==null?void 0:e.renderBefore)??t;let n=s._$litPart$;if(n===void 0){const r=(e==null?void 0:e.renderBefore)??null;s._$litPart$=n=new oa(t.insertBefore(Fo(),r),r,void 0,e??{})}return n._$AI(i),n};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Vo=globalThis;let vn=class extends Xn{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var i;const t=super.createRenderRoot();return(i=this.renderOptions).renderBefore??(i.renderBefore=t.firstChild),t}update(i){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(i),this._$Do=$S(t,this.renderRoot,this.renderOptions)}connectedCallback(){var i;super.connectedCallback(),(i=this._$Do)==null||i.setConnected(!0)}disconnectedCallback(){var i;super.disconnectedCallback(),(i=this._$Do)==null||i.setConnected(!1)}render(){return hr}};var If;vn._$litElement$=!0,vn.finalized=!0,(If=Vo.litElementHydrateSupport)==null||If.call(Vo,{LitElement:vn});const zf=Vo.litElementPolyfillSupport;zf==null||zf({LitElement:vn});(Vo.litElementVersions??(Vo.litElementVersions=[])).push("4.2.2");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const OS={attribute:!0,type:String,converter:Wl,reflect:!1,hasChanged:ku},DS=(i=OS,t,e)=>{const{kind:s,metadata:n}=e;let r=globalThis.litPropertyMetadata.get(n);if(r===void 0&&globalThis.litPropertyMetadata.set(n,r=new Map),s==="setter"&&((i=Object.create(i)).wrapped=!0),r.set(e.name,i),s==="accessor"){const{name:o}=e;return{set(a){const l=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,l,i,!0,a)},init(a){return a!==void 0&&this.C(o,void 0,i,a),a}}}if(s==="setter"){const{name:o}=e;return function(a){const l=this[o];t.call(this,a),this.requestUpdate(o,l,i,!0,a)}}throw Error("Unsupported decorator location: "+s)};function We(i){return(t,e)=>typeof e=="object"?DS(i,t,e):((s,n,r)=>{const o=n.hasOwnProperty(r);return n.constructor.createProperty(r,s),o?Object.getOwnPropertyDescriptor(n,r):void 0})(i,t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function IS(i){return We({...i,state:!0,attribute:!1})}class zS extends ar{constructor(t=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Kt(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&e.element.parentNode!==null&&e.element.remove()})})}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this.center=t.center,this}}new L;new Pt;new Pt;new L;new L;class LS{constructor(t,e){this._group=new Ls,this._frustum=new su,this._frustumMat=new Pt,this._regenerateDelay=200,this._regenerateCounter=0,this.material=new ru({color:"#2e3338"}),this.numbers=new Ls,this.maxRegenerateRetrys=4,this.gridsFactor=5,this._scaleX=1,this._scaleY=1,this._offsetX=0,this._offsetY=0,this._camera=t,this._container=e;const s=this.newGrid(-1),n=this.newGrid(-2);this.grids={main:s,secondary:n},this._group.add(n,s,this.numbers)}set scaleX(t){this._scaleX=t,this.regenerate()}get scaleX(){return this._scaleX}set scaleY(t){this._scaleY=t,this.regenerate()}get scaleY(){return this._scaleY}set offsetX(t){this._offsetX=t,this.regenerate()}get offsetX(){return this._offsetX}set offsetY(t){this._offsetY=t,this.regenerate()}get offsetY(){return this._offsetY}get(){return this._group}dispose(){const{main:t,secondary:e}=this.grids;t.removeFromParent(),e.removeFromParent(),t.geometry.dispose(),t.material.dispose(),e.geometry.dispose(),e.material.dispose()}regenerate(){if(!this.isGridReady()){if(this._regenerateCounter++,this._regenerateCounter>this.maxRegenerateRetrys)throw new Error("Grid could not be regenerated");setTimeout(()=>this.regenerate,this._regenerateDelay);return}this._regenerateCounter=0,this._camera.updateMatrix(),this._camera.updateMatrixWorld();const t=this._frustumMat.multiplyMatrices(this._camera.projectionMatrix,this._camera.matrixWorldInverse);this._frustum.setFromProjectionMatrix(t);const{planes:e}=this._frustum,s=e[0].constant*-e[0].normal.x,n=e[1].constant*-e[1].normal.x,r=e[2].constant*-e[2].normal.y,o=e[3].constant*-e[3].normal.y,a=Math.abs(s-n),l=Math.abs(o-r),{clientWidth:c,clientHeight:h}=this._container,d=Math.max(c,h),u=Math.max(a,l)/d,p=Math.ceil(Math.log10(a/this.scaleX)),m=Math.ceil(Math.log10(l/this.scaleY)),f=10**(p-2)*this.scaleX,b=10**(m-2)*this.scaleY,g=f*this.gridsFactor,y=b*this.gridsFactor,v=Math.ceil(l/y),_=Math.ceil(a/g),x=Math.ceil(l/b),S=Math.ceil(a/f),k=f*Math.ceil(n/f),T=b*Math.ceil(r/b),M=g*Math.ceil(n/g),O=y*Math.ceil(r/y),R=[...this.numbers.children];for(const dt of R)dt.removeFromParent();this.numbers.children=[];const A=[],$=9*u,w=1e4,z=M+this._offsetX,Y=Math.round(Math.abs(z/this.scaleX)*w)/w,V=(_-1)*g,K=Math.round(Math.abs((z+V)/this.scaleX)*w)/w,q=Math.max(Y,K).toString().length*$;let rt=Math.ceil(q/g)*g;for(let dt=0;dt<_;dt++){let yt=M+dt*g;A.push(yt,o,0,yt,r,0),yt=Math.round(yt*w)/w,rt=Math.round(rt*w)/w;const pt=yt%rt;if(!(g<1||y<1)&&Math.abs(pt)>.01)continue;const vt=this.newNumber((yt+this._offsetX)/this.scaleX),Ot=12*u;vt.position.set(yt,r+Ot,0)}for(let dt=0;dt<v;dt++){const yt=O+dt*y;A.push(n,yt,0,s,yt,0);const pt=this.newNumber(yt/this.scaleY);let vt=12;pt.element.textContent&&(vt+=4*pt.element.textContent.length);const Ot=vt*u;pt.position.set(n+Ot,yt,0)}const U=[];for(let dt=0;dt<S;dt++){const yt=k+dt*f;U.push(yt,o,0,yt,r,0)}for(let dt=0;dt<x;dt++){const yt=T+dt*b;U.push(n,yt,0,s,yt,0)}const B=new Je(new Float32Array(A),3),ot=new Je(new Float32Array(U),3),{main:J,secondary:tt}=this.grids;J.geometry.setAttribute("position",B),tt.geometry.setAttribute("position",ot)}newNumber(t){const e=document.createElement("bim-label");e.textContent=String(Math.round(t*100)/100);const s=new zS(e);return this.numbers.add(s),s}newGrid(t){const e=new xe,s=new gc(e,this.material);return s.frustumCulled=!1,s.renderOrder=t,s}isGridReady(){const t=this._camera.projectionMatrix.elements;for(let e=0;e<t.length;e++){const s=t[e];if(Number.isNaN(s))return!1}return!0}}var RS=Object.defineProperty,BS=Object.getOwnPropertyDescriptor,aa=(i,t,e,s)=>{for(var n=BS(t,e),r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&RS(t,e,n),n};const Ey=class extends vn{constructor(){super(...arguments),this._grid=null,this._world=null,this.resize=()=>{this._world&&this._grid&&this._grid.regenerate()}}set gridColor(t){if(this._gridColor=t,!(t&&this._grid))return;const e=Number(t.replace("#","0x"));Number.isNaN(e)||this._grid.material.color.setHex(e)}get gridColor(){return this._gridColor}set gridScaleX(t){this._gridScaleX=t,t&&this._grid&&(this._grid.scaleX=t)}get gridScaleX(){return this._gridScaleX}set gridScaleY(t){this._gridScaleY=t,t&&this._grid&&(this._grid.scaleY=t)}get gridScaleY(){return this._gridScaleY}get gridOffsetX(){var t;return((t=this._grid)==null?void 0:t.offsetX)||0}set gridOffsetX(t){this._grid&&(this._grid.offsetX=t)}get gridOffsetY(){var t;return((t=this._grid)==null?void 0:t.offsetY)||0}set gridOffsetY(t){this._grid&&(this._grid.offsetY=t)}set components(t){this.dispose();const e=t.get(yc).create();this._world=e,e.scene=new lu(t),e.scene.setup(),e.renderer=new OC(t,this);const s=new eb(t);e.camera=s;const n=new LS(s.threeOrtho,this);this._grid=n,e.scene.three.add(n.get()),s.controls.addEventListener("update",()=>n.regenerate()),setTimeout(async()=>{e.camera.updateAspect(),s.set("Plan"),await s.controls.setLookAt(0,0,100,0,0,0),await s.projection.set("Orthographic"),s.controls.dollySpeed=3,s.controls.draggingSmoothTime=.085,s.controls.maxZoom=1e3,s.controls.zoom(4)})}get world(){return this._world}dispose(){var t;(t=this.world)==null||t.dispose(),this._world=null,this._grid=null}connectedCallback(){super.connectedCallback(),new ResizeObserver(this.resize).observe(this)}disconnectedCallback(){super.disconnectedCallback(),this.dispose()}render(){return Tu`<slot></slot>`}};Ey.styles=Eu`
    :host {
      position: relative;
      display: flex;
      min-width: 0px;
      height: 100%;
      background-color: var(--bim-ui_bg-base);
    }
  `;let kr=Ey;aa([We({type:String,attribute:"grid-color",reflect:!0})],kr.prototype,"gridColor");aa([We({type:Number,attribute:"grid-scale-x",reflect:!0})],kr.prototype,"gridScaleX");aa([We({type:Number,attribute:"grid-scale-y",reflect:!0})],kr.prototype,"gridScaleY");aa([We({type:Number,attribute:"grid-offset-x",reflect:!0})],kr.prototype,"gridOffsetX");aa([We({type:Number,attribute:"grid-offset-y",reflect:!0})],kr.prototype,"gridOffsetY");var NS=Object.defineProperty,Ys=(i,t,e,s)=>{for(var n=void 0,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&NS(t,e,n),n};const ky=class extends vn{constructor(){super(...arguments),this._defaults={size:60},this._cssMatrix3D="",this._matrix=new Pt,this._onRightClick=new Event("rightclick"),this._onLeftClick=new Event("leftclick"),this._onTopClick=new Event("topclick"),this._onBottomClick=new Event("bottomclick"),this._onFrontClick=new Event("frontclick"),this._onBackClick=new Event("backclick"),this._camera=null,this._epsilon=t=>Math.abs(t)<1e-10?0:t}set camera(t){this._camera=t,this.updateOrientation()}get camera(){return this._camera}updateOrientation(){if(!this.camera)return;this._matrix.extractRotation(this.camera.matrixWorldInverse);const{elements:t}=this._matrix;this._cssMatrix3D=`matrix3d(
      ${this._epsilon(t[0])},
      ${this._epsilon(-t[1])},
      ${this._epsilon(t[2])},
      ${this._epsilon(t[3])},
      ${this._epsilon(t[4])},
      ${this._epsilon(-t[5])},
      ${this._epsilon(t[6])},
      ${this._epsilon(t[7])},
      ${this._epsilon(t[8])},
      ${this._epsilon(-t[9])},
      ${this._epsilon(t[10])},
      ${this._epsilon(t[11])},
      ${this._epsilon(t[12])},
      ${this._epsilon(-t[13])},
      ${this._epsilon(t[14])},
      ${this._epsilon(t[15])})
    `}render(){const t=this.size??this._defaults.size;return Tu`
      <style>
        .face,
        .cube {
          width: ${t}px;
          height: ${t}px;
          transform: translateZ(-300px) ${this._cssMatrix3D};
        }

        .face-right {
          translate: ${t/2}px 0 0;
        }

        .face-left {
          translate: ${-t/2}px 0 0;
        }

        .face-top {
          translate: 0 ${t/2}px 0;
        }

        .face-bottom {
          translate: 0 ${-t/2}px 0;
        }

        .face-front {
          translate: 0 0 ${t/2}px;
        }

        .face-back {
          translate: 0 0 ${-t/2}px;
        }
      </style>
      <div class="parent">
        <div class="cube">
          <div
            class="face x-direction face-right"
            @click=${()=>this.dispatchEvent(this._onRightClick)}
          >
            ${this.rightText}
          </div>
          <div
            class="face x-direction face-left"
            @click=${()=>this.dispatchEvent(this._onLeftClick)}
          >
            ${this.leftText}
          </div>
          <div
            class="face y-direction face-top"
            @click=${()=>this.dispatchEvent(this._onTopClick)}
          >
            ${this.topText}
          </div>
          <div
            class="face y-direction face-bottom"
            @click=${()=>this.dispatchEvent(this._onBottomClick)}
          >
            ${this.bottomText}
          </div>
          <div
            class="face z-direction face-front"
            @click=${()=>this.dispatchEvent(this._onFrontClick)}
          >
            ${this.frontText}
          </div>
          <div
            class="face z-direction face-back"
            @click=${()=>this.dispatchEvent(this._onBackClick)}
          >
            ${this.backText}
          </div>
        </div>
      </div>
    `}};ky.styles=Eu`
    :host {
      position: absolute;
      z-index: 999;
      bottom: 1rem;
      right: 1rem;
    }

    .parent {
      perspective: 400px;
    }

    .cube {
      position: relative;
      transform-style: preserve-3d;
    }

    .face {
      position: absolute;
      display: flex;
      justify-content: center;
      user-select: none;
      align-items: center;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
      color: var(--bim-view-cube--c, white);
      font-size: var(--bim-view-cube--fz, --bim-ui_size-2xl);
    }

    .x-direction {
      // background-color: var(--bim-view-cube_x--bgc, #c93830DD);
      background-color: var(--bim-view-cube_x--bgc, #01a6bcde);
    }

    .x-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .y-direction {
      // background-color: var(--bim-view-cube_y--bgc, #54ff19DD);
      background-color: var(--bim-view-cube_y--bgc, #8d0ec8de);
    }

    .y-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .z-direction {
      // background-color: var(--bim-view-cube_z--bgc, #3041c9DD);
      background-color: var(--bim-view-cube_z--bgc, #2718afde);
    }

    .z-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .face-front {
      transform: rotateX(180deg);
    }

    .face-back {
      transform: rotateZ(180deg);
    }

    .face-top {
      transform: rotateX(90deg);
    }

    .face-bottom {
      transform: rotateX(270deg);
    }

    .face-right {
      transform: rotateY(-270deg) rotateX(180deg);
    }

    .face-left {
      transform: rotateY(-90deg) rotateX(180deg);
    }
  `;let ds=ky;Ys([We({type:Number,reflect:!0})],ds.prototype,"size");Ys([We({type:String,attribute:"right-text",reflect:!0})],ds.prototype,"rightText");Ys([We({type:String,attribute:"left-text",reflect:!0})],ds.prototype,"leftText");Ys([We({type:String,attribute:"top-text",reflect:!0})],ds.prototype,"topText");Ys([We({type:String,attribute:"bottom-text",reflect:!0})],ds.prototype,"bottomText");Ys([We({type:String,attribute:"front-text",reflect:!0})],ds.prototype,"frontText");Ys([We({type:String,attribute:"back-text",reflect:!0})],ds.prototype,"backText");Ys([IS()],ds.prototype,"_cssMatrix3D");/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const FS=i=>i.strings===void 0;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const US={CHILD:2},jS=i=>(...t)=>({_$litDirective$:i,values:t});class VS{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,s){this._$Ct=t,this._$AM=e,this._$Ci=s}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const xo=(i,t)=>{var e;const s=i._$AN;if(s===void 0)return!1;for(const n of s)(e=n._$AO)==null||e.call(n,t,!1),xo(n,t);return!0},Zl=i=>{let t,e;do{if((t=i._$AM)===void 0)break;e=t._$AN,e.delete(i),i=t}while((e==null?void 0:e.size)===0)},Ay=i=>{for(let t;t=i._$AM;i=t){let e=t._$AN;if(e===void 0)t._$AN=e=new Set;else if(e.has(i))break;e.add(i),qS(t)}};function HS(i){this._$AN!==void 0?(Zl(this),this._$AM=i,Ay(this)):this._$AM=i}function WS(i,t=!1,e=0){const s=this._$AH,n=this._$AN;if(n!==void 0&&n.size!==0)if(t)if(Array.isArray(s))for(let r=e;r<s.length;r++)xo(s[r],!1),Zl(s[r]);else s!=null&&(xo(s,!1),Zl(s));else xo(this,i)}const qS=i=>{i.type==US.CHILD&&(i._$AP??(i._$AP=WS),i._$AQ??(i._$AQ=HS))};class YS extends VS{constructor(){super(...arguments),this._$AN=void 0}_$AT(t,e,s){super._$AT(t,e,s),Ay(this),this.isConnected=t._$AU}_$AO(t,e=!0){var s,n;t!==this.isConnected&&(this.isConnected=t,t?(s=this.reconnected)==null||s.call(this):(n=this.disconnected)==null||n.call(this)),e&&(xo(this,t),Zl(this))}setValue(t){if(FS(this._$Ct))this._$Ct._$AI(t,this);else{const e=[...this._$Ct._$AH];e[this._$Ci]=t,this._$Ct._$AI(e,this,0)}}disconnected(){}reconnected(){}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const kd=()=>new ZS;class ZS{}const Ah=new WeakMap,GS=jS(class extends YS{render(i){return ce}update(i,[t]){var e;const s=t!==this.G;return s&&this.G!==void 0&&this.rt(void 0),(s||this.lt!==this.ct)&&(this.G=t,this.ht=(e=i.options)==null?void 0:e.host,this.rt(this.ct=i.element)),ce}rt(i){if(this.isConnected||(i=void 0),typeof this.G=="function"){const t=this.ht??globalThis;let e=Ah.get(t);e===void 0&&(e=new WeakMap,Ah.set(t,e)),e.get(this.G)!==void 0&&this.G.call(this.ht,void 0),e.set(this.G,i),i!==void 0&&this.G.call(this.ht,i)}else this.G.value=i}get lt(){var i,t;return typeof this.G=="function"?(i=Ah.get(this.ht??globalThis))==null?void 0:i.get(this.G):(t=this.G)==null?void 0:t.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});var XS=Object.defineProperty,KS=(i,t,e,s)=>{for(var n=void 0,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&XS(t,e,n),n};const Ty=class extends vn{constructor(){super(...arguments),this.world=null,this._components=null,this._viewport=kd()}set components(t){var e;if(this._components=t,this.components){const s=this.components.get(yc);this.world=s.create(),this.world.name=this.name}else(e=this.world)==null||e.dispose(),this.world=null}get components(){return this._components}connectedCallback(){super.connectedCallback(),this.world&&(this.world.enabled=!0)}disconnectedCallback(){super.disconnectedCallback(),this.world&&(this.world.enabled=!1)}dispose(){this.components=null,this.remove()}firstUpdated(){const{value:t}=this._viewport;if(!(this.components&&t&&this.world))return;const e=new lu(this.components);this.world.scene=e,e.setup(),e.three.background=null;const s=new sw(this.components,t);this.world.renderer=s;const n=new eb(this.components);this.world.camera=n;const r=this.components.get(ib).create(this.world);r.material.uniforms.uColor.value=new gt(4342338),r.material.uniforms.uSize1.value=2,r.material.uniforms.uSize2.value=8}onSlotChange(){const t=new Event("slotchange");this.dispatchEvent(t)}render(){return Tu` <bim-viewport ${GS(this._viewport)}>
      <slot @slotchange=${this.onSlotChange}></slot>
    </bim-viewport>`}};Ty.styles=Eu``;let My=Ty;KS([We({type:String,reflect:!0})],My.prototype,"name");var QS=Object.defineProperty,JS=(i,t,e)=>t in i?QS(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,it=(i,t,e)=>(JS(i,typeof t!="symbol"?t+"":t,e),e);const ur=Math.min,ss=Math.max,Gl=Math.round,js=i=>({x:i,y:i}),tE={left:"right",right:"left",bottom:"top",top:"bottom"},eE={start:"end",end:"start"};function Lf(i,t,e){return ss(i,ur(t,e))}function la(i,t){return typeof i=="function"?i(t):i}function os(i){return i.split("-")[0]}function Tc(i){return i.split("-")[1]}function Py(i){return i==="x"?"y":"x"}function $y(i){return i==="y"?"height":"width"}const iE=new Set(["top","bottom"]);function Qi(i){return iE.has(os(i))?"y":"x"}function Oy(i){return Py(Qi(i))}function sE(i,t,e){e===void 0&&(e=!1);const s=Tc(i),n=Oy(i),r=$y(n);let o=n==="x"?s===(e?"end":"start")?"right":"left":s==="start"?"bottom":"top";return t.reference[r]>t.floating[r]&&(o=Xl(o)),[o,Xl(o)]}function nE(i){const t=Xl(i);return[Ad(i),t,Ad(t)]}function Ad(i){return i.replace(/start|end/g,t=>eE[t])}const Rf=["left","right"],Bf=["right","left"],rE=["top","bottom"],oE=["bottom","top"];function aE(i,t,e){switch(i){case"top":case"bottom":return e?t?Bf:Rf:t?Rf:Bf;case"left":case"right":return t?rE:oE;default:return[]}}function lE(i,t,e,s){const n=Tc(i);let r=aE(os(i),e==="start",s);return n&&(r=r.map(o=>o+"-"+n),t&&(r=r.concat(r.map(Ad)))),r}function Xl(i){return i.replace(/left|right|bottom|top/g,t=>tE[t])}function cE(i){return{top:0,right:0,bottom:0,left:0,...i}}function Dy(i){return typeof i!="number"?cE(i):{top:i,right:i,bottom:i,left:i}}function pr(i){const{x:t,y:e,width:s,height:n}=i;return{width:s,height:n,top:e,left:t,right:t+s,bottom:e+n,x:t,y:e}}function Nf(i,t,e){let{reference:s,floating:n}=i;const r=Qi(t),o=Oy(t),a=$y(o),l=os(t),c=r==="y",h=s.x+s.width/2-n.width/2,d=s.y+s.height/2-n.height/2,u=s[a]/2-n[a]/2;let p;switch(l){case"top":p={x:h,y:s.y-n.height};break;case"bottom":p={x:h,y:s.y+s.height};break;case"right":p={x:s.x+s.width,y:d};break;case"left":p={x:s.x-n.width,y:d};break;default:p={x:s.x,y:s.y}}switch(Tc(t)){case"start":p[o]-=u*(e&&c?-1:1);break;case"end":p[o]+=u*(e&&c?-1:1);break}return p}const hE=async(i,t,e)=>{const{placement:s="bottom",strategy:n="absolute",middleware:r=[],platform:o}=e,a=r.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(t));let c=await o.getElementRects({reference:i,floating:t,strategy:n}),{x:h,y:d}=Nf(c,s,l),u=s,p={},m=0;for(let f=0;f<a.length;f++){const{name:b,fn:g}=a[f],{x:y,y:v,data:_,reset:x}=await g({x:h,y:d,initialPlacement:s,placement:u,strategy:n,middlewareData:p,rects:c,platform:o,elements:{reference:i,floating:t}});h=y??h,d=v??d,p={...p,[b]:{...p[b],..._}},x&&m<=50&&(m++,typeof x=="object"&&(x.placement&&(u=x.placement),x.rects&&(c=x.rects===!0?await o.getElementRects({reference:i,floating:t,strategy:n}):x.rects),{x:h,y:d}=Nf(c,u,l)),f=-1)}return{x:h,y:d,placement:u,strategy:n,middlewareData:p}};async function Iy(i,t){var e;t===void 0&&(t={});const{x:s,y:n,platform:r,rects:o,elements:a,strategy:l}=i,{boundary:c="clippingAncestors",rootBoundary:h="viewport",elementContext:d="floating",altBoundary:u=!1,padding:p=0}=la(t,i),m=Dy(p),f=a[u?d==="floating"?"reference":"floating":d],b=pr(await r.getClippingRect({element:(e=await(r.isElement==null?void 0:r.isElement(f)))==null||e?f:f.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(a.floating)),boundary:c,rootBoundary:h,strategy:l})),g=d==="floating"?{x:s,y:n,width:o.floating.width,height:o.floating.height}:o.reference,y=await(r.getOffsetParent==null?void 0:r.getOffsetParent(a.floating)),v=await(r.isElement==null?void 0:r.isElement(y))?await(r.getScale==null?void 0:r.getScale(y))||{x:1,y:1}:{x:1,y:1},_=pr(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:g,offsetParent:y,strategy:l}):g);return{top:(b.top-_.top+m.top)/v.y,bottom:(_.bottom-b.bottom+m.bottom)/v.y,left:(b.left-_.left+m.left)/v.x,right:(_.right-b.right+m.right)/v.x}}const dE=function(i){return i===void 0&&(i={}),{name:"flip",options:i,async fn(t){var e,s;const{placement:n,middlewareData:r,rects:o,initialPlacement:a,platform:l,elements:c}=t,{mainAxis:h=!0,crossAxis:d=!0,fallbackPlacements:u,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:f=!0,...b}=la(i,t);if((e=r.arrow)!=null&&e.alignmentOffset)return{};const g=os(n),y=Qi(a),v=os(a)===a,_=await(l.isRTL==null?void 0:l.isRTL(c.floating)),x=u||(v||!f?[Xl(a)]:nE(a)),S=m!=="none";!u&&S&&x.push(...lE(a,f,m,_));const k=[a,...x],T=await Iy(t,b),M=[];let O=((s=r.flip)==null?void 0:s.overflows)||[];if(h&&M.push(T[g]),d){const w=sE(n,o,_);M.push(T[w[0]],T[w[1]])}if(O=[...O,{placement:n,overflows:M}],!M.every(w=>w<=0)){var R,A;const w=(((R=r.flip)==null?void 0:R.index)||0)+1,z=k[w];if(z&&(!(d==="alignment"&&y!==Qi(z))||O.every(V=>Qi(V.placement)===y?V.overflows[0]>0:!0)))return{data:{index:w,overflows:O},reset:{placement:z}};let Y=(A=O.filter(V=>V.overflows[0]<=0).sort((V,K)=>V.overflows[1]-K.overflows[1])[0])==null?void 0:A.placement;if(!Y)switch(p){case"bestFit":{var $;const V=($=O.filter(K=>{if(S){const q=Qi(K.placement);return q===y||q==="y"}return!0}).map(K=>[K.placement,K.overflows.filter(q=>q>0).reduce((q,rt)=>q+rt,0)]).sort((K,q)=>K[1]-q[1])[0])==null?void 0:$[0];V&&(Y=V);break}case"initialPlacement":Y=a;break}if(n!==Y)return{reset:{placement:Y}}}return{}}}};function zy(i){const t=ur(...i.map(r=>r.left)),e=ur(...i.map(r=>r.top)),s=ss(...i.map(r=>r.right)),n=ss(...i.map(r=>r.bottom));return{x:t,y:e,width:s-t,height:n-e}}function uE(i){const t=i.slice().sort((n,r)=>n.y-r.y),e=[];let s=null;for(let n=0;n<t.length;n++){const r=t[n];!s||r.y-s.y>s.height/2?e.push([r]):e[e.length-1].push(r),s=r}return e.map(n=>pr(zy(n)))}const pE=function(i){return i===void 0&&(i={}),{name:"inline",options:i,async fn(t){const{placement:e,elements:s,rects:n,platform:r,strategy:o}=t,{padding:a=2,x:l,y:c}=la(i,t),h=Array.from(await(r.getClientRects==null?void 0:r.getClientRects(s.reference))||[]),d=uE(h),u=pr(zy(h)),p=Dy(a);function m(){if(d.length===2&&d[0].left>d[1].right&&l!=null&&c!=null)return d.find(b=>l>b.left-p.left&&l<b.right+p.right&&c>b.top-p.top&&c<b.bottom+p.bottom)||u;if(d.length>=2){if(Qi(e)==="y"){const O=d[0],R=d[d.length-1],A=os(e)==="top",$=O.top,w=R.bottom,z=A?O.left:R.left,Y=A?O.right:R.right,V=Y-z,K=w-$;return{top:$,bottom:w,left:z,right:Y,width:V,height:K,x:z,y:$}}const b=os(e)==="left",g=ss(...d.map(O=>O.right)),y=ur(...d.map(O=>O.left)),v=d.filter(O=>b?O.left===y:O.right===g),_=v[0].top,x=v[v.length-1].bottom,S=y,k=g,T=k-S,M=x-_;return{top:_,bottom:x,left:S,right:k,width:T,height:M,x:S,y:_}}return u}const f=await r.getElementRects({reference:{getBoundingClientRect:m},floating:s.floating,strategy:o});return n.reference.x!==f.reference.x||n.reference.y!==f.reference.y||n.reference.width!==f.reference.width||n.reference.height!==f.reference.height?{reset:{rects:f}}:{}}}},fE=new Set(["left","top"]);async function mE(i,t){const{placement:e,platform:s,elements:n}=i,r=await(s.isRTL==null?void 0:s.isRTL(n.floating)),o=os(e),a=Tc(e),l=Qi(e)==="y",c=fE.has(o)?-1:1,h=r&&l?-1:1,d=la(t,i);let{mainAxis:u,crossAxis:p,alignmentAxis:m}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof m=="number"&&(p=a==="end"?m*-1:m),l?{x:p*h,y:u*c}:{x:u*c,y:p*h}}const Mu=function(i){return{name:"offset",options:i,async fn(t){var e,s;const{x:n,y:r,placement:o,middlewareData:a}=t,l=await mE(t,i);return o===((e=a.offset)==null?void 0:e.placement)&&(s=a.arrow)!=null&&s.alignmentOffset?{}:{x:n+l.x,y:r+l.y,data:{...l,placement:o}}}}},gE=function(i){return i===void 0&&(i={}),{name:"shift",options:i,async fn(t){const{x:e,y:s,placement:n}=t,{mainAxis:r=!0,crossAxis:o=!1,limiter:a={fn:b=>{let{x:g,y}=b;return{x:g,y}}},...l}=la(i,t),c={x:e,y:s},h=await Iy(t,l),d=Qi(os(n)),u=Py(d);let p=c[u],m=c[d];if(r){const b=u==="y"?"top":"left",g=u==="y"?"bottom":"right",y=p+h[b],v=p-h[g];p=Lf(y,p,v)}if(o){const b=d==="y"?"top":"left",g=d==="y"?"bottom":"right",y=m+h[b],v=m-h[g];m=Lf(y,m,v)}const f=a.fn({...t,[u]:p,[d]:m});return{...f,data:{x:f.x-e,y:f.y-s,enabled:{[u]:r,[d]:o}}}}}};function Mc(){return typeof window<"u"}function Vs(i){return Ly(i)?(i.nodeName||"").toLowerCase():"#document"}function ei(i){var t;return(i==null||(t=i.ownerDocument)==null?void 0:t.defaultView)||window}function Zs(i){var t;return(t=(Ly(i)?i.ownerDocument:i.document)||window.document)==null?void 0:t.documentElement}function Ly(i){return Mc()?i instanceof Node||i instanceof ei(i).Node:!1}function ji(i){return Mc()?i instanceof Element||i instanceof ei(i).Element:!1}function Vi(i){return Mc()?i instanceof HTMLElement||i instanceof ei(i).HTMLElement:!1}function Ff(i){return!Mc()||typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof ei(i).ShadowRoot}const bE=new Set(["inline","contents"]);function ca(i){const{overflow:t,overflowX:e,overflowY:s,display:n}=ui(i);return/auto|scroll|overlay|hidden|clip/.test(t+s+e)&&!bE.has(n)}const yE=new Set(["table","td","th"]);function vE(i){return yE.has(Vs(i))}const _E=[":popover-open",":modal"];function wE(i){return _E.some(t=>{try{return i.matches(t)}catch{return!1}})}const xE=["transform","translate","scale","rotate","perspective"],CE=["transform","translate","scale","rotate","perspective","filter"],SE=["paint","layout","strict","content"];function Pu(i){const t=$u(),e=ji(i)?ui(i):i;return xE.some(s=>e[s]?e[s]!=="none":!1)||(e.containerType?e.containerType!=="normal":!1)||!t&&(e.backdropFilter?e.backdropFilter!=="none":!1)||!t&&(e.filter?e.filter!=="none":!1)||CE.some(s=>(e.willChange||"").includes(s))||SE.some(s=>(e.contain||"").includes(s))}function EE(i){let t=fr(i);for(;Vi(t)&&!Pc(t);){if(Pu(t))return t;if(wE(t))return null;t=fr(t)}return null}function $u(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const kE=new Set(["html","body","#document"]);function Pc(i){return kE.has(Vs(i))}function ui(i){return ei(i).getComputedStyle(i)}function $c(i){return ji(i)?{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}:{scrollLeft:i.scrollX,scrollTop:i.scrollY}}function fr(i){if(Vs(i)==="html")return i;const t=i.assignedSlot||i.parentNode||Ff(i)&&i.host||Zs(i);return Ff(t)?t.host:t}function Ry(i){const t=fr(i);return Pc(t)?i.ownerDocument?i.ownerDocument.body:i.body:Vi(t)&&ca(t)?t:Ry(t)}function By(i,t,e){var s;t===void 0&&(t=[]);const n=Ry(i),r=n===((s=i.ownerDocument)==null?void 0:s.body),o=ei(n);return r?(AE(o),t.concat(o,o.visualViewport||[],ca(n)?n:[],[])):t.concat(n,By(n,[]))}function AE(i){return i.parent&&Object.getPrototypeOf(i.parent)?i.frameElement:null}function Ny(i){const t=ui(i);let e=parseFloat(t.width)||0,s=parseFloat(t.height)||0;const n=Vi(i),r=n?i.offsetWidth:e,o=n?i.offsetHeight:s,a=Gl(e)!==r||Gl(s)!==o;return a&&(e=r,s=o),{width:e,height:s,$:a}}function Fy(i){return ji(i)?i:i.contextElement}function ir(i){const t=Fy(i);if(!Vi(t))return js(1);const e=t.getBoundingClientRect(),{width:s,height:n,$:r}=Ny(t);let o=(r?Gl(e.width):e.width)/s,a=(r?Gl(e.height):e.height)/n;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const TE=js(0);function Uy(i){const t=ei(i);return!$u()||!t.visualViewport?TE:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function ME(i,t,e){return t===void 0&&(t=!1),!e||t&&e!==ei(i)?!1:t}function Ho(i,t,e,s){t===void 0&&(t=!1),e===void 0&&(e=!1);const n=i.getBoundingClientRect(),r=Fy(i);let o=js(1);t&&(s?ji(s)&&(o=ir(s)):o=ir(i));const a=ME(r,e,s)?Uy(r):js(0);let l=(n.left+a.x)/o.x,c=(n.top+a.y)/o.y,h=n.width/o.x,d=n.height/o.y;if(r){const u=ei(r),p=s&&ji(s)?ei(s):s;let m=u,f=m.frameElement;for(;f&&s&&p!==m;){const b=ir(f),g=f.getBoundingClientRect(),y=ui(f),v=g.left+(f.clientLeft+parseFloat(y.paddingLeft))*b.x,_=g.top+(f.clientTop+parseFloat(y.paddingTop))*b.y;l*=b.x,c*=b.y,h*=b.x,d*=b.y,l+=v,c+=_,m=ei(f),f=m.frameElement}}return pr({width:h,height:d,x:l,y:c})}const PE=[":popover-open",":modal"];function jy(i){return PE.some(t=>{try{return i.matches(t)}catch{return!1}})}function $E(i){let{elements:t,rect:e,offsetParent:s,strategy:n}=i;const r=n==="fixed",o=Zs(s),a=t?jy(t.floating):!1;if(s===o||a&&r)return e;let l={scrollLeft:0,scrollTop:0},c=js(1);const h=js(0),d=Vi(s);if((d||!d&&!r)&&((Vs(s)!=="body"||ca(o))&&(l=$c(s)),Vi(s))){const u=Ho(s);c=ir(s),h.x=u.x+s.clientLeft,h.y=u.y+s.clientTop}return{width:e.width*c.x,height:e.height*c.y,x:e.x*c.x-l.scrollLeft*c.x+h.x,y:e.y*c.y-l.scrollTop*c.y+h.y}}function OE(i){return Array.from(i.getClientRects())}function Vy(i){return Ho(Zs(i)).left+$c(i).scrollLeft}function DE(i){const t=Zs(i),e=$c(i),s=i.ownerDocument.body,n=ss(t.scrollWidth,t.clientWidth,s.scrollWidth,s.clientWidth),r=ss(t.scrollHeight,t.clientHeight,s.scrollHeight,s.clientHeight);let o=-e.scrollLeft+Vy(i);const a=-e.scrollTop;return ui(s).direction==="rtl"&&(o+=ss(t.clientWidth,s.clientWidth)-n),{width:n,height:r,x:o,y:a}}function IE(i,t){const e=ei(i),s=Zs(i),n=e.visualViewport;let r=s.clientWidth,o=s.clientHeight,a=0,l=0;if(n){r=n.width,o=n.height;const c=$u();(!c||c&&t==="fixed")&&(a=n.offsetLeft,l=n.offsetTop)}return{width:r,height:o,x:a,y:l}}function zE(i,t){const e=Ho(i,!0,t==="fixed"),s=e.top+i.clientTop,n=e.left+i.clientLeft,r=Vi(i)?ir(i):js(1),o=i.clientWidth*r.x,a=i.clientHeight*r.y,l=n*r.x,c=s*r.y;return{width:o,height:a,x:l,y:c}}function Uf(i,t,e){let s;if(t==="viewport")s=IE(i,e);else if(t==="document")s=DE(Zs(i));else if(ji(t))s=zE(t,e);else{const n=Uy(i);s={...t,x:t.x-n.x,y:t.y-n.y}}return pr(s)}function Hy(i,t){const e=fr(i);return e===t||!ji(e)||Pc(e)?!1:ui(e).position==="fixed"||Hy(e,t)}function LE(i,t){const e=t.get(i);if(e)return e;let s=By(i,[]).filter(a=>ji(a)&&Vs(a)!=="body"),n=null;const r=ui(i).position==="fixed";let o=r?fr(i):i;for(;ji(o)&&!Pc(o);){const a=ui(o),l=Pu(o);!l&&a.position==="fixed"&&(n=null),(r?!l&&!n:!l&&a.position==="static"&&n&&["absolute","fixed"].includes(n.position)||ca(o)&&!l&&Hy(i,o))?s=s.filter(c=>c!==o):n=a,o=fr(o)}return t.set(i,s),s}function RE(i){let{element:t,boundary:e,rootBoundary:s,strategy:n}=i;const r=[...e==="clippingAncestors"?LE(t,this._c):[].concat(e),s],o=r[0],a=r.reduce((l,c)=>{const h=Uf(t,c,n);return l.top=ss(h.top,l.top),l.right=ur(h.right,l.right),l.bottom=ur(h.bottom,l.bottom),l.left=ss(h.left,l.left),l},Uf(t,o,n));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function BE(i){const{width:t,height:e}=Ny(i);return{width:t,height:e}}function NE(i,t,e){const s=Vi(t),n=Zs(t),r=e==="fixed",o=Ho(i,!0,r,t);let a={scrollLeft:0,scrollTop:0};const l=js(0);if(s||!s&&!r)if((Vs(t)!=="body"||ca(n))&&(a=$c(t)),s){const d=Ho(t,!0,r,t);l.x=d.x+t.clientLeft,l.y=d.y+t.clientTop}else n&&(l.x=Vy(n));const c=o.left+a.scrollLeft-l.x,h=o.top+a.scrollTop-l.y;return{x:c,y:h,width:o.width,height:o.height}}function jf(i,t){return!Vi(i)||ui(i).position==="fixed"?null:t?t(i):i.offsetParent}function Wy(i,t){const e=ei(i);if(!Vi(i)||jy(i))return e;let s=jf(i,t);for(;s&&vE(s)&&ui(s).position==="static";)s=jf(s,t);return s&&(Vs(s)==="html"||Vs(s)==="body"&&ui(s).position==="static"&&!Pu(s))?e:s||EE(i)||e}const FE=async function(i){const t=this.getOffsetParent||Wy,e=this.getDimensions;return{reference:NE(i.reference,await t(i.floating),i.strategy),floating:{x:0,y:0,...await e(i.floating)}}};function UE(i){return ui(i).direction==="rtl"}const jE={convertOffsetParentRelativeRectToViewportRelativeRect:$E,getDocumentElement:Zs,getClippingRect:RE,getOffsetParent:Wy,getElementRects:FE,getClientRects:OE,getDimensions:BE,getScale:ir,isElement:ji,isRTL:UE},Ou=gE,Du=dE,Iu=pE,zu=(i,t,e)=>{const s=new Map,n={platform:jE,...e},r={...n.platform,_c:s};return hE(i,t,{...n,platform:r})};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Tl=globalThis,Lu=Tl.ShadowRoot&&(Tl.ShadyCSS===void 0||Tl.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Ru=Symbol(),Vf=new WeakMap;let qy=class{constructor(i,t,e){if(this._$cssResult$=!0,e!==Ru)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=i,this.t=t}get styleSheet(){let i=this.o;const t=this.t;if(Lu&&i===void 0){const e=t!==void 0&&t.length===1;e&&(i=Vf.get(t)),i===void 0&&((this.o=i=new CSSStyleSheet).replaceSync(this.cssText),e&&Vf.set(t,i))}return i}toString(){return this.cssText}};const VE=i=>new qy(typeof i=="string"?i:i+"",void 0,Ru),At=(i,...t)=>{const e=i.length===1?i[0]:t.reduce((s,n,r)=>s+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+i[r+1],i[0]);return new qy(e,i,Ru)},HE=(i,t)=>{if(Lu)i.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const e of t){const s=document.createElement("style"),n=Tl.litNonce;n!==void 0&&s.setAttribute("nonce",n),s.textContent=e.cssText,i.appendChild(s)}},Hf=Lu?i=>i:i=>i instanceof CSSStyleSheet?(t=>{let e="";for(const s of t.cssRules)e+=s.cssText;return VE(e)})(i):i;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:WE,defineProperty:qE,getOwnPropertyDescriptor:YE,getOwnPropertyNames:ZE,getOwnPropertySymbols:GE,getPrototypeOf:XE}=Object,mr=globalThis,Wf=mr.trustedTypes,KE=Wf?Wf.emptyScript:"",qf=mr.reactiveElementPolyfillSupport,Co=(i,t)=>i,Kl={toAttribute(i,t){switch(t){case Boolean:i=i?KE:null;break;case Object:case Array:i=i==null?i:JSON.stringify(i)}return i},fromAttribute(i,t){let e=i;switch(t){case Boolean:e=i!==null;break;case Number:e=i===null?null:Number(i);break;case Object:case Array:try{e=JSON.parse(i)}catch{e=null}}return e}},Bu=(i,t)=>!WE(i,t),Yf={attribute:!0,type:String,converter:Kl,reflect:!1,useDefault:!1,hasChanged:Bu};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),mr.litPropertyMetadata??(mr.litPropertyMetadata=new WeakMap);let Kn=class extends HTMLElement{static addInitializer(i){this._$Ei(),(this.l??(this.l=[])).push(i)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(i,t=Yf){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(i)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(i,t),!t.noAccessor){const e=Symbol(),s=this.getPropertyDescriptor(i,e,t);s!==void 0&&qE(this.prototype,i,s)}}static getPropertyDescriptor(i,t,e){const{get:s,set:n}=YE(this.prototype,i)??{get(){return this[t]},set(r){this[t]=r}};return{get:s,set(r){const o=s==null?void 0:s.call(this);n==null||n.call(this,r),this.requestUpdate(i,o,e)},configurable:!0,enumerable:!0}}static getPropertyOptions(i){return this.elementProperties.get(i)??Yf}static _$Ei(){if(this.hasOwnProperty(Co("elementProperties")))return;const i=XE(this);i.finalize(),i.l!==void 0&&(this.l=[...i.l]),this.elementProperties=new Map(i.elementProperties)}static finalize(){if(this.hasOwnProperty(Co("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Co("properties"))){const t=this.properties,e=[...ZE(t),...GE(t)];for(const s of e)this.createProperty(s,t[s])}const i=this[Symbol.metadata];if(i!==null){const t=litPropertyMetadata.get(i);if(t!==void 0)for(const[e,s]of t)this.elementProperties.set(e,s)}this._$Eh=new Map;for(const[t,e]of this.elementProperties){const s=this._$Eu(t,e);s!==void 0&&this._$Eh.set(s,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(i){const t=[];if(Array.isArray(i)){const e=new Set(i.flat(1/0).reverse());for(const s of e)t.unshift(Hf(s))}else i!==void 0&&t.push(Hf(i));return t}static _$Eu(i,t){const e=t.attribute;return e===!1?void 0:typeof e=="string"?e:typeof i=="string"?i.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var i;this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(i=this.constructor.l)==null||i.forEach(t=>t(this))}addController(i){var t;(this._$EO??(this._$EO=new Set)).add(i),this.renderRoot!==void 0&&this.isConnected&&((t=i.hostConnected)==null||t.call(i))}removeController(i){var t;(t=this._$EO)==null||t.delete(i)}_$E_(){const i=new Map,t=this.constructor.elementProperties;for(const e of t.keys())this.hasOwnProperty(e)&&(i.set(e,this[e]),delete this[e]);i.size>0&&(this._$Ep=i)}createRenderRoot(){const i=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return HE(i,this.constructor.elementStyles),i}connectedCallback(){var i;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(i=this._$EO)==null||i.forEach(t=>{var e;return(e=t.hostConnected)==null?void 0:e.call(t)})}enableUpdating(i){}disconnectedCallback(){var i;(i=this._$EO)==null||i.forEach(t=>{var e;return(e=t.hostDisconnected)==null?void 0:e.call(t)})}attributeChangedCallback(i,t,e){this._$AK(i,e)}_$ET(i,t){var e;const s=this.constructor.elementProperties.get(i),n=this.constructor._$Eu(i,s);if(n!==void 0&&s.reflect===!0){const r=(((e=s.converter)==null?void 0:e.toAttribute)!==void 0?s.converter:Kl).toAttribute(t,s.type);this._$Em=i,r==null?this.removeAttribute(n):this.setAttribute(n,r),this._$Em=null}}_$AK(i,t){var e,s;const n=this.constructor,r=n._$Eh.get(i);if(r!==void 0&&this._$Em!==r){const o=n.getPropertyOptions(r),a=typeof o.converter=="function"?{fromAttribute:o.converter}:((e=o.converter)==null?void 0:e.fromAttribute)!==void 0?o.converter:Kl;this._$Em=r;const l=a.fromAttribute(t,o.type);this[r]=l??((s=this._$Ej)==null?void 0:s.get(r))??l,this._$Em=null}}requestUpdate(i,t,e,s=!1,n){var r;if(i!==void 0){const o=this.constructor;if(s===!1&&(n=this[i]),e??(e=o.getPropertyOptions(i)),!((e.hasChanged??Bu)(n,t)||e.useDefault&&e.reflect&&n===((r=this._$Ej)==null?void 0:r.get(i))&&!this.hasAttribute(o._$Eu(i,e))))return;this.C(i,t,e)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(i,t,{useDefault:e,reflect:s,wrapped:n},r){e&&!(this._$Ej??(this._$Ej=new Map)).has(i)&&(this._$Ej.set(i,r??t??this[i]),n!==!0||r!==void 0)||(this._$AL.has(i)||(this.hasUpdated||e||(t=void 0),this._$AL.set(i,t)),s===!0&&this._$Em!==i&&(this._$Eq??(this._$Eq=new Set)).add(i))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const i=this.scheduleUpdate();return i!=null&&await i,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var i;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[n,r]of this._$Ep)this[n]=r;this._$Ep=void 0}const s=this.constructor.elementProperties;if(s.size>0)for(const[n,r]of s){const{wrapped:o}=r,a=this[n];o!==!0||this._$AL.has(n)||a===void 0||this.C(n,void 0,r,a)}}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),(i=this._$EO)==null||i.forEach(s=>{var n;return(n=s.hostUpdate)==null?void 0:n.call(s)}),this.update(e)):this._$EM()}catch(s){throw t=!1,this._$EM(),s}t&&this._$AE(e)}willUpdate(i){}_$AE(i){var t;(t=this._$EO)==null||t.forEach(e=>{var s;return(s=e.hostUpdated)==null?void 0:s.call(e)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(i)),this.updated(i)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(i){return!0}update(i){this._$Eq&&(this._$Eq=this._$Eq.forEach(t=>this._$ET(t,this[t]))),this._$EM()}updated(i){}firstUpdated(i){}};Kn.elementStyles=[],Kn.shadowRootOptions={mode:"open"},Kn[Co("elementProperties")]=new Map,Kn[Co("finalized")]=new Map,qf==null||qf({ReactiveElement:Kn}),(mr.reactiveElementVersions??(mr.reactiveElementVersions=[])).push("2.1.2");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ql=globalThis,Zf=i=>i,Jl=Ql.trustedTypes,Gf=Jl?Jl.createPolicy("lit-html",{createHTML:i=>i}):void 0,Yy="$lit$",Cs=`lit$${Math.random().toFixed(9).slice(2)}$`,Zy="?"+Cs,QE=`<${Zy}>`,Cn=document,Wo=()=>Cn.createComment(""),qo=i=>i===null||typeof i!="object"&&typeof i!="function",Nu=Array.isArray,JE=i=>Nu(i)||typeof(i==null?void 0:i[Symbol.iterator])=="function",Th=`[ 	
\f\r]`,to=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Xf=/-->/g,Kf=/>/g,nn=RegExp(`>|${Th}(?:([^\\s"'>=/]+)(${Th}*=${Th}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Qf=/'/g,Jf=/"/g,Gy=/^(?:script|style|textarea|title)$/i,t2=i=>(t,...e)=>({_$litType$:i,strings:t,values:e}),F=t2(1),Sn=Symbol.for("lit-noChange"),$t=Symbol.for("lit-nothing"),tm=new WeakMap,mn=Cn.createTreeWalker(Cn,129);function Xy(i,t){if(!Nu(i)||!i.hasOwnProperty("raw"))throw Error("invalid template strings array");return Gf!==void 0?Gf.createHTML(t):t}const e2=(i,t)=>{const e=i.length-1,s=[];let n,r=t===2?"<svg>":t===3?"<math>":"",o=to;for(let a=0;a<e;a++){const l=i[a];let c,h,d=-1,u=0;for(;u<l.length&&(o.lastIndex=u,h=o.exec(l),h!==null);)u=o.lastIndex,o===to?h[1]==="!--"?o=Xf:h[1]!==void 0?o=Kf:h[2]!==void 0?(Gy.test(h[2])&&(n=RegExp("</"+h[2],"g")),o=nn):h[3]!==void 0&&(o=nn):o===nn?h[0]===">"?(o=n??to,d=-1):h[1]===void 0?d=-2:(d=o.lastIndex-h[2].length,c=h[1],o=h[3]===void 0?nn:h[3]==='"'?Jf:Qf):o===Jf||o===Qf?o=nn:o===Xf||o===Kf?o=to:(o=nn,n=void 0);const p=o===nn&&i[a+1].startsWith("/>")?" ":"";r+=o===to?l+QE:d>=0?(s.push(c),l.slice(0,d)+Yy+l.slice(d)+Cs+p):l+Cs+(d===-2?a:p)}return[Xy(i,r+(i[e]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),s]};class Yo{constructor({strings:t,_$litType$:e},s){let n;this.parts=[];let r=0,o=0;const a=t.length-1,l=this.parts,[c,h]=e2(t,e);if(this.el=Yo.createElement(c,s),mn.currentNode=this.el.content,e===2||e===3){const d=this.el.content.firstChild;d.replaceWith(...d.childNodes)}for(;(n=mn.nextNode())!==null&&l.length<a;){if(n.nodeType===1){if(n.hasAttributes())for(const d of n.getAttributeNames())if(d.endsWith(Yy)){const u=h[o++],p=n.getAttribute(d).split(Cs),m=/([.?@])?(.*)/.exec(u);l.push({type:1,index:r,name:m[2],strings:p,ctor:m[1]==="."?s2:m[1]==="?"?n2:m[1]==="@"?r2:Oc}),n.removeAttribute(d)}else d.startsWith(Cs)&&(l.push({type:6,index:r}),n.removeAttribute(d));if(Gy.test(n.tagName)){const d=n.textContent.split(Cs),u=d.length-1;if(u>0){n.textContent=Jl?Jl.emptyScript:"";for(let p=0;p<u;p++)n.append(d[p],Wo()),mn.nextNode(),l.push({type:2,index:++r});n.append(d[u],Wo())}}}else if(n.nodeType===8)if(n.data===Zy)l.push({type:2,index:r});else{let d=-1;for(;(d=n.data.indexOf(Cs,d+1))!==-1;)l.push({type:7,index:r}),d+=Cs.length-1}r++}}static createElement(t,e){const s=Cn.createElement("template");return s.innerHTML=t,s}}function gr(i,t,e=i,s){var n,r;if(t===Sn)return t;let o=s!==void 0?(n=e._$Co)==null?void 0:n[s]:e._$Cl;const a=qo(t)?void 0:t._$litDirective$;return(o==null?void 0:o.constructor)!==a&&((r=o==null?void 0:o._$AO)==null||r.call(o,!1),a===void 0?o=void 0:(o=new a(i),o._$AT(i,e,s)),s!==void 0?(e._$Co??(e._$Co=[]))[s]=o:e._$Cl=o),o!==void 0&&(t=gr(i,o._$AS(i,t.values),o,s)),t}class i2{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:s}=this._$AD,n=((t==null?void 0:t.creationScope)??Cn).importNode(e,!0);mn.currentNode=n;let r=mn.nextNode(),o=0,a=0,l=s[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new ha(r,r.nextSibling,this,t):l.type===1?c=new l.ctor(r,l.name,l.strings,this,t):l.type===6&&(c=new o2(r,this,t)),this._$AV.push(c),l=s[++a]}o!==(l==null?void 0:l.index)&&(r=mn.nextNode(),o++)}return mn.currentNode=Cn,n}p(t){let e=0;for(const s of this._$AV)s!==void 0&&(s.strings!==void 0?(s._$AI(t,s,e),e+=s.strings.length-2):s._$AI(t[e])),e++}}class ha{get _$AU(){var t;return((t=this._$AM)==null?void 0:t._$AU)??this._$Cv}constructor(t,e,s,n){this.type=2,this._$AH=$t,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=s,this.options=n,this._$Cv=(n==null?void 0:n.isConnected)??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=gr(this,t,e),qo(t)?t===$t||t==null||t===""?(this._$AH!==$t&&this._$AR(),this._$AH=$t):t!==this._$AH&&t!==Sn&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):JE(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==$t&&qo(this._$AH)?this._$AA.nextSibling.data=t:this.T(Cn.createTextNode(t)),this._$AH=t}$(t){var e;const{values:s,_$litType$:n}=t,r=typeof n=="number"?this._$AC(t):(n.el===void 0&&(n.el=Yo.createElement(Xy(n.h,n.h[0]),this.options)),n);if(((e=this._$AH)==null?void 0:e._$AD)===r)this._$AH.p(s);else{const o=new i2(r,this),a=o.u(this.options);o.p(s),this.T(a),this._$AH=o}}_$AC(t){let e=tm.get(t.strings);return e===void 0&&tm.set(t.strings,e=new Yo(t)),e}k(t){Nu(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let s,n=0;for(const r of t)n===e.length?e.push(s=new ha(this.O(Wo()),this.O(Wo()),this,this.options)):s=e[n],s._$AI(r),n++;n<e.length&&(this._$AR(s&&s._$AB.nextSibling,n),e.length=n)}_$AR(t=this._$AA.nextSibling,e){var s;for((s=this._$AP)==null?void 0:s.call(this,!1,!0,e);t!==this._$AB;){const n=Zf(t).nextSibling;Zf(t).remove(),t=n}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}}class Oc{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,s,n,r){this.type=1,this._$AH=$t,this._$AN=void 0,this.element=t,this.name=e,this._$AM=n,this.options=r,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=$t}_$AI(t,e=this,s,n){const r=this.strings;let o=!1;if(r===void 0)t=gr(this,t,e,0),o=!qo(t)||t!==this._$AH&&t!==Sn,o&&(this._$AH=t);else{const a=t;let l,c;for(t=r[0],l=0;l<r.length-1;l++)c=gr(this,a[s+l],e,l),c===Sn&&(c=this._$AH[l]),o||(o=!qo(c)||c!==this._$AH[l]),c===$t?t=$t:t!==$t&&(t+=(c??"")+r[l+1]),this._$AH[l]=c}o&&!n&&this.j(t)}j(t){t===$t?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class s2 extends Oc{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===$t?void 0:t}}class n2 extends Oc{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==$t)}}class r2 extends Oc{constructor(t,e,s,n,r){super(t,e,s,n,r),this.type=5}_$AI(t,e=this){if((t=gr(this,t,e,0)??$t)===Sn)return;const s=this._$AH,n=t===$t&&s!==$t||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,r=t!==$t&&(s===$t||n);n&&this.element.removeEventListener(this.name,this,s),r&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e;typeof this._$AH=="function"?this._$AH.call(((e=this.options)==null?void 0:e.host)??this.element,t):this._$AH.handleEvent(t)}}class o2{constructor(t,e,s){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(t){gr(this,t)}}const em=Ql.litHtmlPolyfillSupport;em==null||em(Yo,ha),(Ql.litHtmlVersions??(Ql.litHtmlVersions=[])).push("3.3.2");const Td=(i,t,e)=>{const s=(e==null?void 0:e.renderBefore)??t;let n=s._$litPart$;if(n===void 0){const r=(e==null?void 0:e.renderBefore)??null;s._$litPart$=n=new ha(t.insertBefore(Wo(),r),r,void 0,e??{})}return n._$AI(i),n};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Zo=globalThis;let St=class extends Kn{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var i;const t=super.createRenderRoot();return(i=this.renderOptions).renderBefore??(i.renderBefore=t.firstChild),t}update(i){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(i),this._$Do=Td(t,this.renderRoot,this.renderOptions)}connectedCallback(){var i;super.connectedCallback(),(i=this._$Do)==null||i.setConnected(!0)}disconnectedCallback(){var i;super.disconnectedCallback(),(i=this._$Do)==null||i.setConnected(!1)}render(){return Sn}};var im;St._$litElement$=!0,St.finalized=!0,(im=Zo.litElementHydrateSupport)==null||im.call(Zo,{LitElement:St});const sm=Zo.litElementPolyfillSupport;sm==null||sm({LitElement:St});(Zo.litElementVersions??(Zo.litElementVersions=[])).push("4.2.2");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const a2={attribute:!0,type:String,converter:Kl,reflect:!1,hasChanged:Bu},l2=(i=a2,t,e)=>{const{kind:s,metadata:n}=e;let r=globalThis.litPropertyMetadata.get(n);if(r===void 0&&globalThis.litPropertyMetadata.set(n,r=new Map),s==="setter"&&((i=Object.create(i)).wrapped=!0),r.set(e.name,i),s==="accessor"){const{name:o}=e;return{set(a){const l=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,l,i,!0,a)},init(a){return a!==void 0&&this.C(o,void 0,i,a),a}}}if(s==="setter"){const{name:o}=e;return function(a){const l=this[o];t.call(this,a),this.requestUpdate(o,l,i,!0,a)}}throw Error("Unsupported decorator location: "+s)};function j(i){return(t,e)=>typeof e=="object"?l2(i,t,e):((s,n,r)=>{const o=n.hasOwnProperty(r);return n.constructor.createProperty(r,s),o?Object.getOwnPropertyDescriptor(n,r):void 0})(i,t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function us(i){return j({...i,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const c2=i=>i.strings===void 0;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ky={ATTRIBUTE:1,CHILD:2},Qy=i=>(...t)=>({_$litDirective$:i,values:t});let Jy=class{constructor(i){}get _$AU(){return this._$AM._$AU}_$AT(i,t,e){this._$Ct=i,this._$AM=t,this._$Ci=e}_$AS(i,t){return this.update(i,t)}update(i,t){return this.render(...t)}};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const So=(i,t)=>{var e;const s=i._$AN;if(s===void 0)return!1;for(const n of s)(e=n._$AO)==null||e.call(n,t,!1),So(n,t);return!0},tc=i=>{let t,e;do{if((t=i._$AM)===void 0)break;e=t._$AN,e.delete(i),i=t}while((e==null?void 0:e.size)===0)},tv=i=>{for(let t;t=i._$AM;i=t){let e=t._$AN;if(e===void 0)t._$AN=e=new Set;else if(e.has(i))break;e.add(i),u2(t)}};function h2(i){this._$AN!==void 0?(tc(this),this._$AM=i,tv(this)):this._$AM=i}function d2(i,t=!1,e=0){const s=this._$AH,n=this._$AN;if(n!==void 0&&n.size!==0)if(t)if(Array.isArray(s))for(let r=e;r<s.length;r++)So(s[r],!1),tc(s[r]);else s!=null&&(So(s,!1),tc(s));else So(this,i)}const u2=i=>{i.type==Ky.CHILD&&(i._$AP??(i._$AP=d2),i._$AQ??(i._$AQ=h2))};class p2 extends Jy{constructor(){super(...arguments),this._$AN=void 0}_$AT(t,e,s){super._$AT(t,e,s),tv(this),this.isConnected=t._$AU}_$AO(t,e=!0){var s,n;t!==this.isConnected&&(this.isConnected=t,t?(s=this.reconnected)==null||s.call(this):(n=this.disconnected)==null||n.call(this)),e&&(So(this,t),tc(this))}setValue(t){if(c2(this._$Ct))this._$Ct._$AI(t,this);else{const e=[...this._$Ct._$AH];e[this._$Ci]=t,this._$Ct._$AI(e,this,0)}}disconnected(){}reconnected(){}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const br=()=>new f2;class f2{}const Mh=new WeakMap,Yt=Qy(class extends p2{render(i){return $t}update(i,[t]){var e;const s=t!==this.G;return s&&this.G!==void 0&&this.rt(void 0),(s||this.lt!==this.ct)&&(this.G=t,this.ht=(e=i.options)==null?void 0:e.host,this.rt(this.ct=i.element)),$t}rt(i){if(this.isConnected||(i=void 0),typeof this.G=="function"){const t=this.ht??globalThis;let e=Mh.get(t);e===void 0&&(e=new WeakMap,Mh.set(t,e)),e.get(this.G)!==void 0&&this.G.call(this.ht,void 0),e.set(this.G,i),i!==void 0&&this.G.call(this.ht,i)}else this.G.value=i}get lt(){var i,t;return typeof this.G=="function"?(i=Mh.get(this.ht??globalThis))==null?void 0:i.get(this.G):(t=this.G)==null?void 0:t.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});/**
* (c) Iconify
*
* For the full copyright and license information, please view the license.txt
* files at https://github.com/iconify/iconify
*
* Licensed under MIT.
*
* @license MIT
* @version 3.0.1
*/const ev=Object.freeze({left:0,top:0,width:16,height:16}),ec=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),da=Object.freeze({...ev,...ec}),Md=Object.freeze({...da,body:"",hidden:!1}),m2=Object.freeze({width:null,height:null}),iv=Object.freeze({...m2,...ec});function g2(i,t=0){const e=i.replace(/^-?[0-9.]*/,"");function s(n){for(;n<0;)n+=4;return n%4}if(e===""){const n=parseInt(i);return isNaN(n)?0:s(n)}else if(e!==i){let n=0;switch(e){case"%":n=25;break;case"deg":n=90}if(n){let r=parseFloat(i.slice(0,i.length-e.length));return isNaN(r)?0:(r=r/n,r%1===0?s(r):0)}}return t}const b2=/[\s,]+/;function y2(i,t){t.split(b2).forEach(e=>{switch(e.trim()){case"horizontal":i.hFlip=!0;break;case"vertical":i.vFlip=!0;break}})}const sv={...iv,preserveAspectRatio:""};function nm(i){const t={...sv},e=(s,n)=>i.getAttribute(s)||n;return t.width=e("width",null),t.height=e("height",null),t.rotate=g2(e("rotate","")),y2(t,e("flip","")),t.preserveAspectRatio=e("preserveAspectRatio",e("preserveaspectratio","")),t}function v2(i,t){for(const e in sv)if(i[e]!==t[e])return!0;return!1}const nv=/^[a-z0-9]+(-[a-z0-9]+)*$/,ua=(i,t,e,s="")=>{const n=i.split(":");if(i.slice(0,1)==="@"){if(n.length<2||n.length>3)return null;s=n.shift().slice(1)}if(n.length>3||!n.length)return null;if(n.length>1){const a=n.pop(),l=n.pop(),c={provider:n.length>0?n[0]:s,prefix:l,name:a};return t&&!Ml(c)?null:c}const r=n[0],o=r.split("-");if(o.length>1){const a={provider:s,prefix:o.shift(),name:o.join("-")};return t&&!Ml(a)?null:a}if(e&&s===""){const a={provider:s,prefix:"",name:r};return t&&!Ml(a,e)?null:a}return null},Ml=(i,t)=>i?!!((t&&i.prefix===""||i.prefix)&&i.name):!1;function _2(i,t){const e=i.icons,s=i.aliases||Object.create(null),n=Object.create(null);function r(o){if(e[o])return n[o]=[];if(!(o in n)){n[o]=null;const a=s[o]&&s[o].parent,l=a&&r(a);l&&(n[o]=[a].concat(l))}return n[o]}return Object.keys(e).concat(Object.keys(s)).forEach(r),n}function w2(i,t){const e={};!i.hFlip!=!t.hFlip&&(e.hFlip=!0),!i.vFlip!=!t.vFlip&&(e.vFlip=!0);const s=((i.rotate||0)+(t.rotate||0))%4;return s&&(e.rotate=s),e}function rm(i,t){const e=w2(i,t);for(const s in Md)s in ec?s in i&&!(s in e)&&(e[s]=ec[s]):s in t?e[s]=t[s]:s in i&&(e[s]=i[s]);return e}function x2(i,t,e){const s=i.icons,n=i.aliases||Object.create(null);let r={};function o(a){r=rm(s[a]||n[a],r)}return o(t),e.forEach(o),rm(i,r)}function rv(i,t){const e=[];if(typeof i!="object"||typeof i.icons!="object")return e;i.not_found instanceof Array&&i.not_found.forEach(n=>{t(n,null),e.push(n)});const s=_2(i);for(const n in s){const r=s[n];r&&(t(n,x2(i,n,r)),e.push(n))}return e}const C2={provider:"",aliases:{},not_found:{},...ev};function Ph(i,t){for(const e in t)if(e in i&&typeof i[e]!=typeof t[e])return!1;return!0}function ov(i){if(typeof i!="object"||i===null)return null;const t=i;if(typeof t.prefix!="string"||!i.icons||typeof i.icons!="object"||!Ph(i,C2))return null;const e=t.icons;for(const n in e){const r=e[n];if(!n||typeof r.body!="string"||!Ph(r,Md))return null}const s=t.aliases||Object.create(null);for(const n in s){const r=s[n],o=r.parent;if(!n||typeof o!="string"||!e[o]&&!s[o]||!Ph(r,Md))return null}return t}const ic=Object.create(null);function S2(i,t){return{provider:i,prefix:t,icons:Object.create(null),missing:new Set}}function as(i,t){const e=ic[i]||(ic[i]=Object.create(null));return e[t]||(e[t]=S2(i,t))}function av(i,t){return ov(t)?rv(t,(e,s)=>{s?i.icons[e]=s:i.missing.add(e)}):[]}function E2(i,t,e){try{if(typeof e.body=="string")return i.icons[t]={...e},!0}catch{}return!1}function k2(i,t){let e=[];return(typeof i=="string"?[i]:Object.keys(ic)).forEach(s=>{(typeof s=="string"&&typeof t=="string"?[t]:Object.keys(ic[s]||{})).forEach(n=>{const r=as(s,n);e=e.concat(Object.keys(r.icons).map(o=>(s!==""?"@"+s+":":"")+n+":"+o))})}),e}let Go=!1;function lv(i){return typeof i=="boolean"&&(Go=i),Go}function Xo(i){const t=typeof i=="string"?ua(i,!0,Go):i;if(t){const e=as(t.provider,t.prefix),s=t.name;return e.icons[s]||(e.missing.has(s)?null:void 0)}}function cv(i,t){const e=ua(i,!0,Go);if(!e)return!1;const s=as(e.provider,e.prefix);return t?E2(s,e.name,t):(s.missing.add(e.name),!0)}function om(i,t){if(typeof i!="object")return!1;if(typeof t!="string"&&(t=i.provider||""),Go&&!t&&!i.prefix){let n=!1;return ov(i)&&(i.prefix="",rv(i,(r,o)=>{cv(r,o)&&(n=!0)})),n}const e=i.prefix;if(!Ml({prefix:e,name:"a"}))return!1;const s=as(t,e);return!!av(s,i)}function A2(i){return!!Xo(i)}function T2(i){const t=Xo(i);return t&&{...da,...t}}function hv(i,t){i.forEach(e=>{const s=e.loaderCallbacks;s&&(e.loaderCallbacks=s.filter(n=>n.id!==t))})}function M2(i){i.pendingCallbacksFlag||(i.pendingCallbacksFlag=!0,setTimeout(()=>{i.pendingCallbacksFlag=!1;const t=i.loaderCallbacks?i.loaderCallbacks.slice(0):[];if(!t.length)return;let e=!1;const s=i.provider,n=i.prefix;t.forEach(r=>{const o=r.icons,a=o.pending.length;o.pending=o.pending.filter(l=>{if(l.prefix!==n)return!0;const c=l.name;if(i.icons[c])o.loaded.push({provider:s,prefix:n,name:c});else if(i.missing.has(c))o.missing.push({provider:s,prefix:n,name:c});else return e=!0,!0;return!1}),o.pending.length!==a&&(e||hv([i],r.id),r.callback(o.loaded.slice(0),o.missing.slice(0),o.pending.slice(0),r.abort))})}))}let P2=0;function $2(i,t,e){const s=P2++,n=hv.bind(null,e,s);if(!t.pending.length)return n;const r={id:s,icons:t,callback:i,abort:n};return e.forEach(o=>{(o.loaderCallbacks||(o.loaderCallbacks=[])).push(r)}),n}function O2(i){const t={loaded:[],missing:[],pending:[]},e=Object.create(null);i.sort((n,r)=>n.provider!==r.provider?n.provider.localeCompare(r.provider):n.prefix!==r.prefix?n.prefix.localeCompare(r.prefix):n.name.localeCompare(r.name));let s={provider:"",prefix:"",name:""};return i.forEach(n=>{if(s.name===n.name&&s.prefix===n.prefix&&s.provider===n.provider)return;s=n;const r=n.provider,o=n.prefix,a=n.name,l=e[r]||(e[r]=Object.create(null)),c=l[o]||(l[o]=as(r,o));let h;a in c.icons?h=t.loaded:o===""||c.missing.has(a)?h=t.missing:h=t.pending;const d={provider:r,prefix:o,name:a};h.push(d)}),t}const Pd=Object.create(null);function am(i,t){Pd[i]=t}function $d(i){return Pd[i]||Pd[""]}function D2(i,t=!0,e=!1){const s=[];return i.forEach(n=>{const r=typeof n=="string"?ua(n,t,e):n;r&&s.push(r)}),s}function Fu(i){let t;if(typeof i.resources=="string")t=[i.resources];else if(t=i.resources,!(t instanceof Array)||!t.length)return null;return{resources:t,path:i.path||"/",maxURL:i.maxURL||500,rotate:i.rotate||750,timeout:i.timeout||5e3,random:i.random===!0,index:i.index||0,dataAfterTimeout:i.dataAfterTimeout!==!1}}const Dc=Object.create(null),el=["https://api.simplesvg.com","https://api.unisvg.com"],Od=[];for(;el.length>0;)el.length===1||Math.random()>.5?Od.push(el.shift()):Od.push(el.pop());Dc[""]=Fu({resources:["https://api.iconify.design"].concat(Od)});function lm(i,t){const e=Fu(t);return e===null?!1:(Dc[i]=e,!0)}function Ic(i){return Dc[i]}function I2(){return Object.keys(Dc)}const z2={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function L2(i,t,e,s){const n=i.resources.length,r=i.random?Math.floor(Math.random()*n):i.index;let o;if(i.random){let S=i.resources.slice(0);for(o=[];S.length>1;){const k=Math.floor(Math.random()*S.length);o.push(S[k]),S=S.slice(0,k).concat(S.slice(k+1))}o=o.concat(S)}else o=i.resources.slice(r).concat(i.resources.slice(0,r));const a=Date.now();let l="pending",c=0,h,d=null,u=[],p=[];typeof s=="function"&&p.push(s);function m(){d&&(clearTimeout(d),d=null)}function f(){l==="pending"&&(l="aborted"),m(),u.forEach(S=>{S.status==="pending"&&(S.status="aborted")}),u=[]}function b(S,k){k&&(p=[]),typeof S=="function"&&p.push(S)}function g(){return{startTime:a,payload:t,status:l,queriesSent:c,queriesPending:u.length,subscribe:b,abort:f}}function y(){l="failed",p.forEach(S=>{S(void 0,h)})}function v(){u.forEach(S=>{S.status==="pending"&&(S.status="aborted")}),u=[]}function _(S,k,T){const M=k!=="success";switch(u=u.filter(O=>O!==S),l){case"pending":break;case"failed":if(M||!i.dataAfterTimeout)return;break;default:return}if(k==="abort"){h=T,y();return}if(M){h=T,u.length||(o.length?x():y());return}if(m(),v(),!i.random){const O=i.resources.indexOf(S.resource);O!==-1&&O!==i.index&&(i.index=O)}l="completed",p.forEach(O=>{O(T)})}function x(){if(l!=="pending")return;m();const S=o.shift();if(S===void 0){if(u.length){d=setTimeout(()=>{m(),l==="pending"&&(v(),y())},i.timeout);return}y();return}const k={status:"pending",resource:S,callback:(T,M)=>{_(k,T,M)}};u.push(k),c++,d=setTimeout(x,i.rotate),e(S,t,k.callback)}return setTimeout(x),g}function dv(i){const t={...z2,...i};let e=[];function s(){e=e.filter(o=>o().status==="pending")}function n(o,a,l){const c=L2(t,o,a,(h,d)=>{s(),l&&l(h,d)});return e.push(c),c}function r(o){return e.find(a=>o(a))||null}return{query:n,find:r,setIndex:o=>{t.index=o},getIndex:()=>t.index,cleanup:s}}function cm(){}const $h=Object.create(null);function R2(i){if(!$h[i]){const t=Ic(i);if(!t)return;const e=dv(t),s={config:t,redundancy:e};$h[i]=s}return $h[i]}function uv(i,t,e){let s,n;if(typeof i=="string"){const r=$d(i);if(!r)return e(void 0,424),cm;n=r.send;const o=R2(i);o&&(s=o.redundancy)}else{const r=Fu(i);if(r){s=dv(r);const o=i.resources?i.resources[0]:"",a=$d(o);a&&(n=a.send)}}return!s||!n?(e(void 0,424),cm):s.query(t,n,e)().abort}function hm(){}function B2(i){i.iconsLoaderFlag||(i.iconsLoaderFlag=!0,setTimeout(()=>{i.iconsLoaderFlag=!1,M2(i)}))}function N2(i){const t=[],e=[];return i.forEach(s=>{(s.match(nv)?t:e).push(s)}),{valid:t,invalid:e}}function eo(i,t,e){function s(){const n=i.pendingIcons;t.forEach(r=>{n&&n.delete(r),i.icons[r]||i.missing.add(r)})}if(e&&typeof e=="object")try{if(!av(i,e).length){s();return}}catch(n){console.error(n)}s(),B2(i)}function dm(i,t){i instanceof Promise?i.then(e=>{t(e)}).catch(()=>{t(null)}):t(i)}function F2(i,t){i.iconsToLoad?i.iconsToLoad=i.iconsToLoad.concat(t).sort():i.iconsToLoad=t,i.iconsQueueFlag||(i.iconsQueueFlag=!0,setTimeout(()=>{i.iconsQueueFlag=!1;const{provider:e,prefix:s}=i,n=i.iconsToLoad;if(delete i.iconsToLoad,!n||!n.length)return;const r=i.loadIcon;if(i.loadIcons&&(n.length>1||!r)){dm(i.loadIcons(n,s,e),c=>{eo(i,n,c)});return}if(r){n.forEach(c=>{const h=r(c,s,e);dm(h,d=>{const u=d?{prefix:s,icons:{[c]:d}}:null;eo(i,[c],u)})});return}const{valid:o,invalid:a}=N2(n);if(a.length&&eo(i,a,null),!o.length)return;const l=s.match(nv)?$d(e):null;if(!l){eo(i,o,null);return}l.prepare(e,s,o).forEach(c=>{uv(e,c,h=>{eo(i,c.icons,h)})})}))}const Uu=(i,t)=>{const e=D2(i,!0,lv()),s=O2(e);if(!s.pending.length){let l=!0;return t&&setTimeout(()=>{l&&t(s.loaded,s.missing,s.pending,hm)}),()=>{l=!1}}const n=Object.create(null),r=[];let o,a;return s.pending.forEach(l=>{const{provider:c,prefix:h}=l;if(h===a&&c===o)return;o=c,a=h,r.push(as(c,h));const d=n[c]||(n[c]=Object.create(null));d[h]||(d[h]=[])}),s.pending.forEach(l=>{const{provider:c,prefix:h,name:d}=l,u=as(c,h),p=u.pendingIcons||(u.pendingIcons=new Set);p.has(d)||(p.add(d),n[c][h].push(d))}),r.forEach(l=>{const c=n[l.provider][l.prefix];c.length&&F2(l,c)}),t?$2(t,s,r):hm},U2=i=>new Promise((t,e)=>{const s=typeof i=="string"?ua(i,!0):i;if(!s){e(i);return}Uu([s||i],n=>{if(n.length&&s){const r=Xo(s);if(r){t({...da,...r});return}}e(i)})});function um(i){try{const t=typeof i=="string"?JSON.parse(i):i;if(typeof t.body=="string")return{...t}}catch{}}function j2(i,t){if(typeof i=="object")return{data:um(i),value:i};if(typeof i!="string")return{value:i};if(i.includes("{")){const r=um(i);if(r)return{data:r,value:i}}const e=ua(i,!0,!0);if(!e)return{value:i};const s=Xo(e);if(s!==void 0||!e.prefix)return{value:i,name:e,data:s};const n=Uu([e],()=>t(i,e,Xo(e)));return{value:i,name:e,loading:n}}let pv=!1;try{pv=navigator.vendor.indexOf("Apple")===0}catch{}function V2(i,t){switch(t){case"svg":case"bg":case"mask":return t}return t!=="style"&&(pv||i.indexOf("<a")===-1)?"svg":i.indexOf("currentColor")===-1?"bg":"mask"}const H2=/(-?[0-9.]*[0-9]+[0-9.]*)/g,W2=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function Dd(i,t,e){if(t===1)return i;if(e=e||100,typeof i=="number")return Math.ceil(i*t*e)/e;if(typeof i!="string")return i;const s=i.split(H2);if(s===null||!s.length)return i;const n=[];let r=s.shift(),o=W2.test(r);for(;;){if(o){const a=parseFloat(r);isNaN(a)?n.push(r):n.push(Math.ceil(a*t*e)/e)}else n.push(r);if(r=s.shift(),r===void 0)return n.join("");o=!o}}function q2(i,t="defs"){let e="";const s=i.indexOf("<"+t);for(;s>=0;){const n=i.indexOf(">",s),r=i.indexOf("</"+t);if(n===-1||r===-1)break;const o=i.indexOf(">",r);if(o===-1)break;e+=i.slice(n+1,r).trim(),i=i.slice(0,s).trim()+i.slice(o+1)}return{defs:e,content:i}}function Y2(i,t){return i?"<defs>"+i+"</defs>"+t:t}function Z2(i,t,e){const s=q2(i);return Y2(s.defs,t+s.content+e)}const G2=i=>i==="unset"||i==="undefined"||i==="none";function fv(i,t){const e={...da,...i},s={...iv,...t},n={left:e.left,top:e.top,width:e.width,height:e.height};let r=e.body;[e,s].forEach(f=>{const b=[],g=f.hFlip,y=f.vFlip;let v=f.rotate;g?y?v+=2:(b.push("translate("+(n.width+n.left).toString()+" "+(0-n.top).toString()+")"),b.push("scale(-1 1)"),n.top=n.left=0):y&&(b.push("translate("+(0-n.left).toString()+" "+(n.height+n.top).toString()+")"),b.push("scale(1 -1)"),n.top=n.left=0);let _;switch(v<0&&(v-=Math.floor(v/4)*4),v=v%4,v){case 1:_=n.height/2+n.top,b.unshift("rotate(90 "+_.toString()+" "+_.toString()+")");break;case 2:b.unshift("rotate(180 "+(n.width/2+n.left).toString()+" "+(n.height/2+n.top).toString()+")");break;case 3:_=n.width/2+n.left,b.unshift("rotate(-90 "+_.toString()+" "+_.toString()+")");break}v%2===1&&(n.left!==n.top&&(_=n.left,n.left=n.top,n.top=_),n.width!==n.height&&(_=n.width,n.width=n.height,n.height=_)),b.length&&(r=Z2(r,'<g transform="'+b.join(" ")+'">',"</g>"))});const o=s.width,a=s.height,l=n.width,c=n.height;let h,d;o===null?(d=a===null?"1em":a==="auto"?c:a,h=Dd(d,l/c)):(h=o==="auto"?l:o,d=a===null?Dd(h,c/l):a==="auto"?c:a);const u={},p=(f,b)=>{G2(b)||(u[f]=b.toString())};p("width",h),p("height",d);const m=[n.left,n.top,l,c];return u.viewBox=m.join(" "),{attributes:u,viewBox:m,body:r}}function ju(i,t){let e=i.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const s in t)e+=" "+s+'="'+t[s]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+e+">"+i+"</svg>"}function X2(i){return i.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function K2(i){return"data:image/svg+xml,"+X2(i)}function mv(i){return'url("'+K2(i)+'")'}const Q2=()=>{let i;try{if(i=fetch,typeof i=="function")return i}catch{}};let sc=Q2();function J2(i){sc=i}function tk(){return sc}function ek(i,t){const e=Ic(i);if(!e)return 0;let s;if(!e.maxURL)s=0;else{let n=0;e.resources.forEach(o=>{n=Math.max(n,o.length)});const r=t+".json?icons=";s=e.maxURL-n-e.path.length-r.length}return s}function ik(i){return i===404}const sk=(i,t,e)=>{const s=[],n=ek(i,t),r="icons";let o={type:r,provider:i,prefix:t,icons:[]},a=0;return e.forEach((l,c)=>{a+=l.length+1,a>=n&&c>0&&(s.push(o),o={type:r,provider:i,prefix:t,icons:[]},a=l.length),o.icons.push(l)}),s.push(o),s};function nk(i){if(typeof i=="string"){const t=Ic(i);if(t)return t.path}return"/"}const rk=(i,t,e)=>{if(!sc){e("abort",424);return}let s=nk(t.provider);switch(t.type){case"icons":{const r=t.prefix,o=t.icons.join(","),a=new URLSearchParams({icons:o});s+=r+".json?"+a.toString();break}case"custom":{const r=t.uri;s+=r.slice(0,1)==="/"?r.slice(1):r;break}default:e("abort",400);return}let n=503;sc(i+s).then(r=>{const o=r.status;if(o!==200){setTimeout(()=>{e(ik(o)?"abort":"next",o)});return}return n=501,r.json()}).then(r=>{if(typeof r!="object"||r===null){setTimeout(()=>{r===404?e("abort",r):e("next",n)});return}setTimeout(()=>{e("success",r)})}).catch(()=>{e("next",n)})},ok={prepare:sk,send:rk};function ak(i,t,e){as(e||"",t).loadIcons=i}function lk(i,t,e){as(e||"",t).loadIcon=i}const Oh="data-style";let gv="";function ck(i){gv=i}function pm(i,t){let e=Array.from(i.childNodes).find(s=>s.hasAttribute&&s.hasAttribute(Oh));e||(e=document.createElement("style"),e.setAttribute(Oh,Oh),i.appendChild(e)),e.textContent=":host{display:inline-block;vertical-align:"+(t?"-0.125em":"0")+"}span,svg{display:block;margin:auto}"+gv}function bv(){am("",ok),lv(!0);let i;try{i=window}catch{}if(i){if(i.IconifyPreload!==void 0){const t=i.IconifyPreload,e="Invalid IconifyPreload syntax.";typeof t=="object"&&t!==null&&(t instanceof Array?t:[t]).forEach(s=>{try{(typeof s!="object"||s===null||s instanceof Array||typeof s.icons!="object"||typeof s.prefix!="string"||!om(s))&&console.error(e)}catch{console.error(e)}})}if(i.IconifyProviders!==void 0){const t=i.IconifyProviders;if(typeof t=="object"&&t!==null)for(const e in t){const s="IconifyProviders["+e+"] is invalid.";try{const n=t[e];if(typeof n!="object"||!n||n.resources===void 0)continue;lm(e,n)||console.error(s)}catch{console.error(s)}}}}return{iconLoaded:A2,getIcon:T2,listIcons:k2,addIcon:cv,addCollection:om,calculateSize:Dd,buildIcon:fv,iconToHTML:ju,svgToURL:mv,loadIcons:Uu,loadIcon:U2,addAPIProvider:lm,setCustomIconLoader:lk,setCustomIconsLoader:ak,appendCustomStyle:ck,_api:{getAPIConfig:Ic,setAPIModule:am,sendAPIQuery:uv,setFetch:J2,getFetch:tk,listAPIProviders:I2}}}const Id={"background-color":"currentColor"},yv={"background-color":"transparent"},fm={image:"var(--svg)",repeat:"no-repeat",size:"100% 100%"},mm={"-webkit-mask":Id,mask:Id,background:yv};for(const i in mm){const t=mm[i];for(const e in fm)t[i+"-"+e]=fm[e]}function gm(i){return i?i+(i.match(/^[-0-9.]+$/)?"px":""):"inherit"}function hk(i,t,e){const s=document.createElement("span");let n=i.body;n.indexOf("<a")!==-1&&(n+="<!-- "+Date.now()+" -->");const r=i.attributes,o=ju(n,{...r,width:t.width+"",height:t.height+""}),a=mv(o),l=s.style,c={"--svg":a,width:gm(r.width),height:gm(r.height),...e?Id:yv};for(const h in c)l.setProperty(h,c[h]);return s}let Eo;function dk(){try{Eo=window.trustedTypes.createPolicy("iconify",{createHTML:i=>i})}catch{Eo=null}}function uk(i){return Eo===void 0&&dk(),Eo?Eo.createHTML(i):i}function pk(i){const t=document.createElement("span"),e=i.attributes;let s="";e.width||(s="width: inherit;"),e.height||(s+="height: inherit;"),s&&(e.style=s);const n=ju(i.body,e);return t.innerHTML=uk(n),t.firstChild}function zd(i){return Array.from(i.childNodes).find(t=>{const e=t.tagName&&t.tagName.toUpperCase();return e==="SPAN"||e==="SVG"})}function bm(i,t){const e=t.icon.data,s=t.customisations,n=fv(e,s);s.preserveAspectRatio&&(n.attributes.preserveAspectRatio=s.preserveAspectRatio);const r=t.renderedMode;let o;switch(r){case"svg":o=pk(n);break;default:o=hk(n,{...da,...e},r==="mask")}const a=zd(i);a?o.tagName==="SPAN"&&a.tagName===o.tagName?a.setAttribute("style",o.getAttribute("style")):i.replaceChild(o,a):i.appendChild(o)}function ym(i,t,e){const s=e&&(e.rendered?e:e.lastRender);return{rendered:!1,inline:t,icon:i,lastRender:s}}function fk(i="iconify-icon"){let t,e;try{t=window.customElements,e=window.HTMLElement}catch{return}if(!t||!e)return;const s=t.get(i);if(s)return s;const n=["icon","mode","inline","noobserver","width","height","rotate","flip"],r=class extends e{constructor(){super(),it(this,"_shadowRoot"),it(this,"_initialised",!1),it(this,"_state"),it(this,"_checkQueued",!1),it(this,"_connected",!1),it(this,"_observer",null),it(this,"_visible",!0);const a=this._shadowRoot=this.attachShadow({mode:"open"}),l=this.hasAttribute("inline");pm(a,l),this._state=ym({value:""},l),this._queueCheck()}connectedCallback(){this._connected=!0,this.startObserver()}disconnectedCallback(){this._connected=!1,this.stopObserver()}static get observedAttributes(){return n.slice(0)}attributeChangedCallback(a){switch(a){case"inline":{const l=this.hasAttribute("inline"),c=this._state;l!==c.inline&&(c.inline=l,pm(this._shadowRoot,l));break}case"noobserver":{this.hasAttribute("noobserver")?this.startObserver():this.stopObserver();break}default:this._queueCheck()}}get icon(){const a=this.getAttribute("icon");if(a&&a.slice(0,1)==="{")try{return JSON.parse(a)}catch{}return a}set icon(a){typeof a=="object"&&(a=JSON.stringify(a)),this.setAttribute("icon",a)}get inline(){return this.hasAttribute("inline")}set inline(a){a?this.setAttribute("inline","true"):this.removeAttribute("inline")}get observer(){return this.hasAttribute("observer")}set observer(a){a?this.setAttribute("observer","true"):this.removeAttribute("observer")}restartAnimation(){const a=this._state;if(a.rendered){const l=this._shadowRoot;if(a.renderedMode==="svg")try{l.lastChild.setCurrentTime(0);return}catch{}bm(l,a)}}get status(){const a=this._state;return a.rendered?"rendered":a.icon.data===null?"failed":"loading"}_queueCheck(){this._checkQueued||(this._checkQueued=!0,setTimeout(()=>{this._check()}))}_check(){if(!this._checkQueued)return;this._checkQueued=!1;const a=this._state,l=this.getAttribute("icon");if(l!==a.icon.value){this._iconChanged(l);return}if(!a.rendered||!this._visible)return;const c=this.getAttribute("mode"),h=nm(this);(a.attrMode!==c||v2(a.customisations,h)||!zd(this._shadowRoot))&&this._renderIcon(a.icon,h,c)}_iconChanged(a){const l=j2(a,(c,h,d)=>{const u=this._state;if(u.rendered||this.getAttribute("icon")!==c)return;const p={value:c,name:h,data:d};p.data?this._gotIconData(p):u.icon=p});l.data?this._gotIconData(l):this._state=ym(l,this._state.inline,this._state)}_forceRender(){if(!this._visible){const a=zd(this._shadowRoot);a&&this._shadowRoot.removeChild(a);return}this._queueCheck()}_gotIconData(a){this._checkQueued=!1,this._renderIcon(a,nm(this),this.getAttribute("mode"))}_renderIcon(a,l,c){const h=V2(a.data.body,c),d=this._state.inline;bm(this._shadowRoot,this._state={rendered:!0,icon:a,inline:d,customisations:l,attrMode:c,renderedMode:h})}startObserver(){if(!this._observer&&!this.hasAttribute("noobserver"))try{this._observer=new IntersectionObserver(a=>{const l=a.some(c=>c.isIntersecting);l!==this._visible&&(this._visible=l,this._forceRender())}),this._observer.observe(this)}catch{if(this._observer){try{this._observer.disconnect()}catch{}this._observer=null}}}stopObserver(){this._observer&&(this._observer.disconnect(),this._observer=null,this._visible=!0,this._connected&&this._forceRender())}};n.forEach(a=>{a in r.prototype||Object.defineProperty(r.prototype,a,{get:function(){return this.getAttribute(a)},set:function(l){l!==null?this.setAttribute(a,l):this.removeAttribute(a)}})});const o=bv();for(const a in o)r[a]=r.prototype[a]=o[a];return t.define(i,r),r}const mk=fk()||bv(),{iconLoaded:qz,getIcon:Yz,listIcons:Zz,addIcon:Gz,addCollection:gk,calculateSize:Xz,buildIcon:Kz,iconToHTML:Qz,svgToURL:Jz,loadIcons:bk,loadIcon:t5,setCustomIconLoader:e5,setCustomIconsLoader:i5,addAPIProvider:s5,_api:n5}=mk,yk=At`
  ::-webkit-scrollbar {
    width: 0.4rem;
    height: 0.4rem;
    overflow: hidden;
  }

  ::-webkit-scrollbar-thumb {
    border-radius: 0.25rem;
    background-color: var(
      --bim-scrollbar--c,
      color-mix(in lab, var(--bim-ui_main-base), white 15%)
    );
  }

  ::-webkit-scrollbar-track {
    background-color: var(--bim-scrollbar--bgc, var(--bim-ui_bg-base));
  }
`,vk=At`
  :root {
    /* Grayscale Colors */
    --bim-ui_gray-0: hsl(210 10% 5%);
    --bim-ui_gray-1: hsl(210 10% 10%);
    --bim-ui_gray-2: hsl(210 10% 20%);
    --bim-ui_gray-3: hsl(210 10% 30%);
    --bim-ui_gray-4: hsl(210 10% 40%);
    --bim-ui_gray-5: hsl(210 10% 50%);
    --bim-ui_gray-6: hsl(210 10% 60%);
    --bim-ui_gray-7: hsl(210 10% 70%);
    --bim-ui_gray-8: hsl(210 10% 80%);
    --bim-ui_gray-9: hsl(210 10% 90%);
    --bim-ui_gray-10: hsl(210 10% 95%);

    /* Brand Colors */
    --bim-ui_main-base: #6528d7;
    --bim-ui_accent-base: #bcf124;

    /* Brand Colors Contrasts */
    --bim-ui_main-contrast: var(--bim-ui_gray-10);
    --bim-ui_accent-contrast: var(--bim-ui_gray-0);

    /* Sizes */
    --bim-ui_size-4xs: 0.375rem;
    --bim-ui_size-3xs: 0.5rem;
    --bim-ui_size-2xs: 0.625rem;
    --bim-ui_size-xs: 0.75rem;
    --bim-ui_size-sm: 0.875rem;
    --bim-ui_size-base: 1rem;
    --bim-ui_size-lg: 1.125rem;
    --bim-ui_size-xl: 1.25rem;
    --bim-ui_size-2xl: 1.375rem;
    --bim-ui_size-3xl: 1.5rem;
    --bim-ui_size-4xl: 1.625rem;
    --bim-ui_size-5xl: 1.75rem;
    --bim-ui_size-6xl: 1.875rem;
    --bim-ui_size-7xl: 2rem;
    --bim-ui_size-8xl: 2.125rem;
    --bim-ui_size-9xl: 2.25rem;
  }

  /* Background Colors */
  @media (prefers-color-scheme: dark) {
    :root {
      --bim-ui_bg-base: var(--bim-ui_gray-0);
      --bim-ui_bg-contrast-10: var(--bim-ui_gray-1);
      --bim-ui_bg-contrast-20: var(--bim-ui_gray-2);
      --bim-ui_bg-contrast-30: var(--bim-ui_gray-3);
      --bim-ui_bg-contrast-40: var(--bim-ui_gray-4);
      --bim-ui_bg-contrast-60: var(--bim-ui_gray-6);
      --bim-ui_bg-contrast-80: var(--bim-ui_gray-8);
      --bim-ui_bg-contrast-100: var(--bim-ui_gray-10);
    }
  }

  @media (prefers-color-scheme: light) {
    :root {
      --bim-ui_bg-base: var(--bim-ui_gray-10);
      --bim-ui_bg-contrast-10: var(--bim-ui_gray-9);
      --bim-ui_bg-contrast-20: var(--bim-ui_gray-8);
      --bim-ui_bg-contrast-30: var(--bim-ui_gray-7);
      --bim-ui_bg-contrast-40: var(--bim-ui_gray-6);
      --bim-ui_bg-contrast-60: var(--bim-ui_gray-4);
      --bim-ui_bg-contrast-80: var(--bim-ui_gray-2);
      --bim-ui_bg-contrast-100: var(--bim-ui_gray-0);
      --bim-ui_accent-base: #6528d7;
    }
  }

  .theme-transition-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    filter: drop-shadow(0 0 10px var(--bim-ui_bg-base));
    z-index: 9999;
  }

  .theme-transition-overlay > div {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--bim-ui_bg-base);
  }

  html.bim-ui-dark {
    --bim-ui_bg-base: var(--bim-ui_gray-0);
    --bim-ui_bg-contrast-10: var(--bim-ui_gray-1);
    --bim-ui_bg-contrast-20: var(--bim-ui_gray-2);
    --bim-ui_bg-contrast-30: var(--bim-ui_gray-3);
    --bim-ui_bg-contrast-40: var(--bim-ui_gray-4);
    --bim-ui_bg-contrast-60: var(--bim-ui_gray-6);
    --bim-ui_bg-contrast-80: var(--bim-ui_gray-8);
    --bim-ui_bg-contrast-100: var(--bim-ui_gray-10);
  }

  html.bim-ui-light {
    --bim-ui_bg-base: var(--bim-ui_gray-10);
    --bim-ui_bg-contrast-10: var(--bim-ui_gray-9);
    --bim-ui_bg-contrast-20: var(--bim-ui_gray-8);
    --bim-ui_bg-contrast-30: var(--bim-ui_gray-7);
    --bim-ui_bg-contrast-40: var(--bim-ui_gray-6);
    --bim-ui_bg-contrast-60: var(--bim-ui_gray-4);
    --bim-ui_bg-contrast-80: var(--bim-ui_gray-2);
    --bim-ui_bg-contrast-100: var(--bim-ui_gray-0);
    --bim-ui_accent-base: #6528d7;
  }

  @keyframes toggleOverlay {
    0%,
    99% {
      display: block;
    }

    100% {
      display: none;
    }
  }

  @keyframes toggleThemeAnimation {
    0% {
      clip-path: circle(0% at center top);
    }
    45%,
    55% {
      clip-path: circle(150% at center center);
    }
    100% {
      clip-path: circle(0% at center bottom);
    }
  }

  [data-context-dialog]::backdrop {
    background-color: transparent;
  }
`,Gs={scrollbar:yk,globalStyles:vk},vv=class Ct{static set config(t){this._config={...Ct._config,...t}}static get config(){return Ct._config}static addGlobalStyles(){let t=document.querySelector("style[id='bim-ui']");if(t)return;t=document.createElement("style"),t.id="bim-ui",t.textContent=Gs.globalStyles.cssText;const e=document.head.firstChild;e?document.head.insertBefore(t,e):document.head.append(t)}static preloadIcons(t,e=!1){bk(t,(s,n,r)=>{e&&(console.log("Icons loaded:",s),n.length&&console.warn("Icons missing:",n),r.length&&console.info("Icons pending:",r))})}static addIconsCollection(t,e){gk({prefix:(e==null?void 0:e.prefix)??"bim",icons:t,width:24,height:24})}static defineCustomElement(t,e){customElements.get(t)||customElements.define(t,e)}static registerComponents(){Ct.init()}static init(t="",e=!0){Ct.addGlobalStyles(),Ct.defineCustomElement("bim-button",kk),Ct.defineCustomElement("bim-checkbox",Ar),Ct.defineCustomElement("bim-color-input",Xs),Ct.defineCustomElement("bim-context-menu",ko),Ct.defineCustomElement("bim-dropdown",fi),Ct.defineCustomElement("bim-grid",fa),Ct.defineCustomElement("bim-icon",Hk),Ct.defineCustomElement("bim-input",ma),Ct.defineCustomElement("bim-label",Tr),Ct.defineCustomElement("bim-number-input",ii),Ct.defineCustomElement("bim-option",le),Ct.defineCustomElement("bim-panel",Tn),Ct.defineCustomElement("bim-panel-section",Mr),Ct.defineCustomElement("bim-selector",Pr),Ct.defineCustomElement("bim-table",Wu),Ct.defineCustomElement("bim-tabs",ls),Ct.defineCustomElement("bim-tab",Ze),Ct.defineCustomElement("bim-table-cell",Dv),Ct.defineCustomElement("bim-table-children",lA),Ct.defineCustomElement("bim-table-group",Lv),Ct.defineCustomElement("bim-table-row",_a),Ct.defineCustomElement("bim-text-input",qe),Ct.defineCustomElement("bim-toolbar",jc),Ct.defineCustomElement("bim-toolbar-group",Fc),Ct.defineCustomElement("bim-toolbar-section",Or),Ct.defineCustomElement("bim-viewport",qv),Ct.defineCustomElement("bim-chart-legend",Zv),Ct.defineCustomElement("bim-chart",te),Ct.defineCustomElement("bim-tooltip",hD),e&&this.animateOnLoad(t)}static newRandomId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let s=0;s<10;s++){const n=Math.floor(Math.random()*t.length);e+=t.charAt(n)}return e}static animateOnLoad(t=""){const e=`
      bim-input,
      bim-button,
      bim-checkbox,
      bim-selector,
      bim-label,
      bim-table-row,
      bim-panel-section,
      bim-table-children .branch-vertical,
      .switchers
    `,s=[];function n(r,o=document,a=new Set){const l=[];return Array.from(o.querySelectorAll(r)).forEach(c=>{a.has(c)||(a.add(c),l.push(c))}),Array.from(o.querySelectorAll("*")).filter(c=>c.shadowRoot).forEach(c=>{a.has(c)||(a.add(c),l.push(...n(r,c.shadowRoot,a)))}),l}requestAnimationFrame(()=>{n(t||e).forEach(o=>{const a=o;let l="auto";l=window.getComputedStyle(a).getPropertyValue("transition"),a.style.setProperty("opacity","0"),a.style.setProperty("transition","none"),requestAnimationFrame(()=>{a.style.setProperty("transition",l)}),s.push(a)});const r=()=>{s.forEach(o=>{const a=o,l=(a.getBoundingClientRect().x+a.getBoundingClientRect().y)/(window.innerWidth+window.innerHeight),c=window.getComputedStyle(a).getPropertyValue("transform"),h=400,d=200+l*1e3;a.animate([{transform:"translateY(-20px)",opacity:"0"},{transform:"translateY(0)",opacity:"1"}],{duration:h,easing:"ease-in-out",delay:d}),setTimeout(()=>{a.style.removeProperty("opacity"),c!=="none"?a.style.setProperty("transform",c):a.style.removeProperty("transform")},d+h)})};document.readyState==="complete"?r():window.addEventListener("load",r)})}static toggleTheme(t=!0){const e=document.querySelector("html");if(!e)return;const s=()=>{e.classList.contains("bim-ui-dark")?e.classList.replace("bim-ui-dark","bim-ui-light"):e.classList.contains("bim-ui-light")?e.classList.replace("bim-ui-light","bim-ui-dark"):e.classList.add("bim-ui-light")};if(t){const n=document.createElement("div");n.classList.add("theme-transition-overlay");const r=document.createElement("div");n.appendChild(r),r.style.setProperty("transition",`background-color ${1e3/3200}s`),document.body.appendChild(n),n.style.setProperty("animation",`toggleOverlay ${1e3/1e3}s ease-in forwards`),r.style.setProperty("animation",`toggleThemeAnimation ${1e3/1e3}s ease forwards`),setTimeout(()=>{s()},1e3/4),setTimeout(()=>{document.body.querySelectorAll(".theme-transition-overlay").forEach(o=>{document.body.removeChild(o)})},1e3)}else s()}};vv._config={sectionLabelOnVerticalToolbar:!1,internalComponentNameAttribute:"bim-element-name"};let we=vv;class Zt extends St{constructor(){super(...arguments),this._lazyLoadObserver=null,this._visibleElements=[],this.ELEMENTS_BEFORE_OBSERVER=20,this.useObserver=!1,this.elements=new Set,this.observe=t=>{if(!this.useObserver)return;for(const s of t)this.elements.add(s);const e=t.slice(this.ELEMENTS_BEFORE_OBSERVER);for(const s of e)s.remove();this.observeLastElement()}}set visibleElements(t){this._visibleElements=this.useObserver?t:[],this.requestUpdate()}get visibleElements(){return this._visibleElements}getLazyObserver(){if(!this.useObserver)return null;if(this._lazyLoadObserver)return this._lazyLoadObserver;const t=new IntersectionObserver(e=>{const s=e[0];if(!s.isIntersecting)return;const n=s.target;t.unobserve(n);const r=this.ELEMENTS_BEFORE_OBSERVER+this.visibleElements.length,o=[...this.elements][r];o&&(this.visibleElements=[...this.visibleElements,o],t.observe(o))},{threshold:.5});return t}observeLastElement(){const t=this.getLazyObserver();if(!t)return;const e=this.ELEMENTS_BEFORE_OBSERVER+this.visibleElements.length-1,s=[...this.elements][e];s&&t.observe(s)}resetVisibleElements(){const t=this.getLazyObserver();if(t){for(const e of this.elements)t.unobserve(e);this.visibleElements=[],this.observeLastElement()}}static create(t,e){const s=document.createDocumentFragment();if(t.length===0)return Td(t(),s),s.firstElementChild;if(!e)throw new Error("UIComponent: Initial state is required for statefull components.");let n=e;const r=t,o=c=>(n={...n,...c},Td(r(n,o),s),n);o(e);const a=s.firstElementChild,l={getElement:c=>a.querySelector(`[data-${we.config.internalComponentNameAttribute}="${c}"]`),getCurrentState:()=>n,dispose:()=>{a.remove(),n={},l.updates={}},updates:{}};return[a,o,l]}}const Ko=(i,t={},e=!0)=>{let s={};for(const n of i.children){const r=n,o=r.getAttribute("name")||r.getAttribute("label"),a=o?t[o]:void 0;if(o){if("value"in r&&typeof r.value<"u"&&r.value!==null){const l=r.value;if(typeof l=="object"&&!Array.isArray(l)&&Object.keys(l).length===0)continue;s[o]=a?a(r.value):r.value}else if(e){const l=Ko(r,t);if(Object.keys(l).length===0)continue;s[o]=a?a(l):l}}else e&&(s={...s,...Ko(r,t)})}return s},zc=i=>i==="true"||i==="false"?i==="true":i&&!isNaN(Number(i))&&i.trim()!==""?Number(i):i,_k=[">=","<=","=",">","<","?","/","#"];function vm(i){const t=_k.find(o=>i.split(o).length===2),e=i.split(t).map(o=>o.trim()),[s,n]=e,r=n.startsWith("'")&&n.endsWith("'")?n.replace(/'/g,""):zc(n);return{key:s,condition:t,value:r}}const Ld=i=>{try{const t=[],e=i.split(/&(?![^()]*\))/).map(s=>s.trim());for(const s of e){const n=!s.startsWith("(")&&!s.endsWith(")"),r=s.startsWith("(")&&s.endsWith(")");if(n){const o=vm(s);t.push(o)}if(r){const o={operator:"&",queries:s.replace(/^(\()|(\))$/g,"").split("&").map(a=>a.trim()).map((a,l)=>{const c=vm(a);return l>0&&(c.operator="&"),c})};t.push(o)}}return t}catch{return null}},_m=(i,t,e)=>{let s=!1;switch(t){case"=":s=i===e;break;case"?":s=String(i).includes(String(e));break;case"<":(typeof i=="number"||typeof e=="number")&&(s=i<e);break;case"<=":(typeof i=="number"||typeof e=="number")&&(s=i<=e);break;case">":(typeof i=="number"||typeof e=="number")&&(s=i>e);break;case">=":(typeof i=="number"||typeof e=="number")&&(s=i>=e);break;case"/":s=String(i).startsWith(String(e));break}return s};let rn=class{constructor(){this.enabled=!0,this.trigger=i=>{if(!this.enabled)return;const t=this.handlers.slice(0);for(const e of t)e(i)},this.handlers=[]}add(i){this.handlers.push(i)}remove(i){this.handlers=this.handlers.filter(t=>t!==i)}reset(){this.handlers.length=0}};class wk extends Set{constructor(t){super(t),this.onUpdated=new rn,this.onItemAdded=new rn,this.onBeforeDelete=new rn,this.onItemDeleted=new rn,this.onCleared=new rn,this.guard=()=>!0,this.deleteGuard=()=>!0}set eventsEnabled(t){this.onUpdated.enabled=t,this.onItemAdded.enabled=t,this.onItemDeleted.enabled=t,this.onBeforeDelete.enabled=t,this.onCleared.enabled=t}clear(){for(const t of this)this.onBeforeDelete.trigger(t);super.clear(),this.onCleared.trigger(),this.onUpdated.trigger()}add(...t){for(const e of t)this.has(e)||!(this.guard??(()=>!0))(e)||(super.add(e),this.onItemAdded||(this.onItemAdded=new rn),this.onItemAdded.trigger(e));return this.onUpdated||(this.onUpdated=new rn),this.onUpdated.trigger(),this}delete(t){if(!this.has(t)||!this.deleteGuard(t))return!1;this.onBeforeDelete.trigger(t);const e=super.delete(t);return e&&(this.onItemDeleted.trigger(t),this.onUpdated.trigger()),e}deleteIf(t){for(const e of this)t(e)&&this.delete(e)}getIndex(t){let e=0;for(const s of this){if(s===t)return e;e++}return-1}dispose(){this.clear(),this.onItemAdded.reset(),this.onItemDeleted.reset(),this.onCleared.reset(),this.onBeforeDelete.reset(),this.onUpdated.reset()}}var xk=Object.defineProperty,Ck=Object.getOwnPropertyDescriptor,_v=(i,t,e,s)=>{for(var n=Ck(t,e),r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&xk(t,e,n),n},Ee;const Vu=(Ee=class extends St{constructor(){super(...arguments),this._previousContainer=null,this._visible=!1}get placement(){return this._placement}set placement(i){this._placement=i,this.updatePosition()}static removeMenus(){for(const i of[...Ee.dialog.children])i instanceof Ee&&(i.remove(),i.visible=!1);setTimeout(()=>{Ee.dialog.close(),Ee.dialog.remove()},310)}get visible(){return this._visible}set visible(i){this._visible=i,i?(Ee.dialog.parentElement||document.body.append(Ee.dialog),this._previousContainer=this.parentElement,Ee.dialog.style.top=`${window.scrollY||document.documentElement.scrollTop}px`,this.style.setProperty("display","flex"),Ee.dialog.append(this),Ee.dialog.showModal(),this.updatePosition(),this.dispatchEvent(new Event("visible"))):setTimeout(()=>{var t;(t=this._previousContainer)==null||t.append(this),this._previousContainer=null,this.style.setProperty("display","none"),this.dispatchEvent(new Event("hidden"))},310)}async updatePosition(){if(!(this.visible&&this._previousContainer))return;const i=this.placement??"right",t=await zu(this._previousContainer,this,{placement:i,middleware:[Mu(10),Iu(),Du(),Ou({padding:5})]}),{x:e,y:s}=t;this.style.left=`${e}px`,this.style.top=`${s}px`}connectedCallback(){super.connectedCallback(),this.visible?(this.style.setProperty("width","auto"),this.style.setProperty("height","auto")):(this.style.setProperty("display","none"),this.style.setProperty("width","0"),this.style.setProperty("height","0"))}render(){return F` <slot></slot> `}},Ee.styles=[Gs.scrollbar,At`
      :host {
        pointer-events: auto;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 999;
        overflow: auto;
        max-height: 20rem;
        min-width: 3rem;
        flex-direction: column;
        box-shadow: 1px 2px 8px 2px rgba(0, 0, 0, 0.15);
        padding: 0.5rem;
        border-radius: var(--bim-ui_size-4xs);
        display: flex;
        transform-origin: top left;
        transform: scale(1);
        clip-path: circle(150% at top left);
        background-color: var(--bim-ui_bg-contrast-20);
        transition:
          clip-path 0.2s cubic-bezier(0.72, 0.1, 0.43, 0.93),
          transform 0.3s cubic-bezier(0.72, 0.1, 0.45, 2.35);
      }

      :host(:not([visible])) {
        transform: scale(0.8);
        clip-path: circle(0 at top left);
      }
    `],Ee.dialog=Zt.create(()=>F` <dialog
      @click=${i=>{i.target===Ee.dialog&&Ee.removeMenus()}}
      @cancel=${()=>Ee.removeMenus()}
      data-context-dialog
      style="
      width: 0;
      height: 0;
      position: relative;
      padding: 0;
      border: none;
      outline: none;
      margin: none;
      overflow: visible;
      background-color: transparent;
    "
    ></dialog>`),Ee);_v([j({type:String,reflect:!0})],Vu.prototype,"placement");_v([j({type:Boolean,reflect:!0})],Vu.prototype,"visible");let ko=Vu;var Sk=Object.defineProperty,Ek=Object.getOwnPropertyDescriptor,Si=(i,t,e,s)=>{for(var n=s>1?void 0:s?Ek(t,e):t,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=(s?o(t,e,n):o(n))||n);return s&&n&&Sk(t,e,n),n},io;const pi=(io=class extends St{constructor(){super(),this.labelHidden=!1,this.active=!1,this.disabled=!1,this.vertical=!1,this.tooltipVisible=!1,this._stateBeforeLoading={disabled:!1,icon:""},this._loading=!1,this._parent=br(),this._tooltip=br(),this._mouseLeave=!1,this.onClick=i=>{i.stopPropagation(),this.disabled||this.dispatchEvent(new Event("click"))},this.showContextMenu=()=>{let i=this._contextMenu;if(this.contextMenuTemplate){const t=this.disabled;this.disabled=!0,i=Zt.create(()=>{const e=Zt.create(this.contextMenuTemplate);return e instanceof ko?F`${e}`:F`
          <bim-context-menu>${e}</bim-context-menu>
          `}),this.append(i),i.addEventListener("hidden",()=>{i==null||i.remove()}),this.disabled=t}if(i){const t=this.getAttribute("data-context-group");t&&i.setAttribute("data-context-group",t),this.closeNestedContexts();const e=we.newRandomId();for(const s of i.children)s instanceof io&&s.setAttribute("data-context-group",e);i.visible=!0}},this.mouseLeave=!0}set loading(i){if(this._loading=i,i)this._stateBeforeLoading={disabled:this.disabled,icon:this.icon},this.disabled=i,this.icon="eos-icons:loading";else{const{disabled:t,icon:e}=this._stateBeforeLoading;this.disabled=t,this.icon=e}}get loading(){return this._loading}set mouseLeave(i){this._mouseLeave=i,i&&(this.tooltipVisible=!1,clearTimeout(this.timeoutID))}get mouseLeave(){return this._mouseLeave}computeTooltipPosition(){const{value:i}=this._parent,{value:t}=this._tooltip;i&&t&&zu(i,t,{placement:"bottom",middleware:[Mu(10),Iu(),Du(),Ou({padding:5})]}).then(e=>{const{x:s,y:n}=e;Object.assign(t.style,{left:`${s}px`,top:`${n}px`})})}onMouseEnter(){if(!(this.tooltipTitle||this.tooltipText))return;this.mouseLeave=!1;const i=this.tooltipTime??700;this.timeoutID=setTimeout(()=>{this.mouseLeave||(this.computeTooltipPosition(),this.tooltipVisible=!0)},i)}closeNestedContexts(){const i=this.getAttribute("data-context-group");if(i)for(const t of ko.dialog.children){const e=t.getAttribute("data-context-group");if(t instanceof ko&&e===i){t.visible=!1,t.removeAttribute("data-context-group");for(const s of t.children)s instanceof io&&(s.closeNestedContexts(),s.removeAttribute("data-context-group"))}}}click(){this.disabled||super.click()}get _contextMenu(){return this.querySelector("bim-context-menu")}connectedCallback(){super.connectedCallback(),this.addEventListener("click",this.showContextMenu)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("click",this.showContextMenu)}render(){const i=F`
      <div ${Yt(this._tooltip)} class="tooltip">
        ${this.tooltipTitle?F`<p style="text-wrap: nowrap;">
              <strong>${this.tooltipTitle}</strong>
            </p>`:null}
        ${this.tooltipText?F`<p style="width: 9rem;">${this.tooltipText}</p>`:null}
      </div>
    `;let t=F`${this.label}`;if((this._contextMenu||this.contextMenuTemplate)&&this.label){const e=F`<svg
        xmlns="http://www.w3.org/2000/svg"
        height="1.125rem"
        viewBox="0 0 24 24"
        width="1.125rem"
        style="fill: var(--bim-label--c)"
      >
        <path d="M0 0h24v24H0V0z" fill="none" />
        <path d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
      </svg>`;t=F`
        <div style="display: flex; align-items: center;">
          ${this.label}
          ${e}
        </div>
      `}return F`
      <div ${Yt(this._parent)} class="parent" @click=${this.onClick}>
        ${this.label||this.icon?F`
              <div
                class="button"
                @mouseenter=${this.onMouseEnter}
                @mouseleave=${()=>this.mouseLeave=!0}
              >
                <bim-label
                  .icon=${this.icon}
                  .vertical=${this.vertical}
                  .labelHidden=${this.labelHidden}
                  >${t}</bim-label
                >
              </div>
            `:null}
        ${this.tooltipTitle||this.tooltipText?i:null}
      </div>
      <slot></slot>
    `}},io.styles=At`
    :host {
      --bim-label--c: var(--bim-ui_bg-contrast-100, white);
      position: relative;
      display: block;
      flex: 1;
      pointer-events: none;
      background-color: var(--bim-button--bgc, var(--bim-ui_bg-contrast-20));
      border-radius: var(--bim-ui_size-4xs);
      transition: all 0.15s;
    }

    :host(:not([disabled]))::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: inherit;
      background-color: var(--bim-ui_main-base);
      clip-path: circle(0 at center center);
      box-sizing: border-box;
      transition:
        clip-path 0.3s cubic-bezier(0.65, 0.05, 0.36, 1),
        transform 0.15s;
    }

    :host(:not([disabled]):hover) {
      cursor: pointer;
    }

    bim-label {
      pointer-events: none;
    }

    .parent {
      --bim-icon--c: var(--bim-label--c);
      position: relative;
      display: flex;
      height: 100%;
      user-select: none;
      row-gap: 0.125rem;
      min-height: var(--bim-ui_size-5xl);
      min-width: var(--bim-ui_size-5xl);
    }

    .button,
    .children {
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
    }

    .children {
      padding: 0 0.375rem;
      position: absolute;
      height: 100%;
      right: 0;
    }

    :host(:not([label-hidden])[icon][vertical]) .parent {
      min-height: 2.5rem;
    }

    .button {
      flex-grow: 1;
      transition: transform 0.15s;
    }

    :host(:not([label-hidden])[label]) .button {
      justify-content: var(--bim-button--jc, center);
    }

    :host(:hover)::before {
      clip-path: circle(120% at center center);
    }

    :host(:hover) {
      --bim-label--c: var(--bim-ui_main-contrast);
      z-index: 2;
    }

    :host([active]) {
      background-color: var(--bim-ui_main-base);
    }

    :host(:not([disabled]):active) {
      background: transparent;
    }

    :host(:not([disabled]):active) .button,
    :host(:not([disabled]):active)::before {
      transform: scale(0.98);
    }

    :host(:not([label]):not([icon])) .children {
      flex: 1;
    }

    :host([vertical]) .parent {
      justify-content: center;
    }

    :host(:not([label-hidden])[label]) .button {
      padding: 0 0.5rem;
    }

    :host([disabled]) {
      --bim-label--c: var(--bim-ui_bg-contrast-80) !important;
      background-color: gray !important;
    }

    ::slotted(bim-button) {
      --bim-icon--fz: var(--bim-ui_size-base);
      --bim-button--bdrs: var(--bim-ui_size-4xs);
      --bim-button--olw: 0;
      --bim-button--olc: transparent;
    }

    .tooltip {
      position: absolute;
      padding: 0.75rem;
      z-index: 99;
      display: flex;
      flex-flow: column;
      row-gap: 0.375rem;
      box-shadow: 0 0 10px 3px rgba(0 0 0 / 20%);
      outline: 1px solid var(--bim-ui_bg-contrast-40);
      font-size: var(--bim-ui_size-xs);
      border-radius: var(--bim-ui_size-4xs);
      background-color: var(--bim-ui_bg-contrast-20);
      color: var(--bim-ui_bg-contrast-100);
      animation: openTooltips 0.15s ease-out forwards;
      transition: visibility 0.2s;
    }

    .tooltip p {
      margin: 0;
      padding: 0;
    }

    :host(:not([tooltip-visible])) .tooltip {
      animation: closeTooltips 0.15s ease-in forwards;
      visibility: hidden;
      display: none;
    }

    @keyframes closeTooltips {
      0% {
        display: flex;
        padding: 0.75rem;
        transform: translateY(0);
        opacity: 1;
      }
      90% {
        padding: 0.75rem;
      }
      100% {
        display: none;
        padding: 0;
        transform: translateY(-10px);
        opacity: 0;
      }
    }

    @keyframes openTooltips {
      0% {
        display: flex;
        transform: translateY(-10px);
        opacity: 0;
      }
      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }
  `,io);Si([j({type:String,reflect:!0})],pi.prototype,"label",2);Si([j({type:Boolean,attribute:"label-hidden",reflect:!0})],pi.prototype,"labelHidden",2);Si([j({type:Boolean,reflect:!0})],pi.prototype,"active",2);Si([j({type:Boolean,reflect:!0,attribute:"disabled"})],pi.prototype,"disabled",2);Si([j({type:String,reflect:!0})],pi.prototype,"icon",2);Si([j({type:Boolean,reflect:!0})],pi.prototype,"vertical",2);Si([j({type:Number,attribute:"tooltip-time",reflect:!0})],pi.prototype,"tooltipTime",2);Si([j({type:Boolean,attribute:"tooltip-visible",reflect:!0})],pi.prototype,"tooltipVisible",2);Si([j({type:String,attribute:"tooltip-title",reflect:!0})],pi.prototype,"tooltipTitle",2);Si([j({type:String,attribute:"tooltip-text",reflect:!0})],pi.prototype,"tooltipText",2);Si([j({type:Boolean,reflect:!0})],pi.prototype,"loading",1);let kk=pi;var Ak=Object.defineProperty,pa=(i,t,e,s)=>{for(var n=void 0,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&Ak(t,e,n),n};const wv=class extends St{constructor(){super(...arguments),this.checked=!1,this.inverted=!1,this.onValueChange=new Event("change")}get value(){return this.checked}onChange(i){i.stopPropagation(),this.checked=i.target.checked,this.dispatchEvent(this.onValueChange)}render(){const i=F`
      <svg viewBox="0 0 21 21">
        <polyline points="5 10.75 8.5 14.25 16 6"></polyline>
      </svg>
    `;return F`
      <div class="parent">
        <label class="parent-label">
          ${this.label?F`<bim-label .icon="${this.icon}">${this.label}</bim-label> `:null}
          <div class="input-container">
            <input
              type="checkbox"
              aria-label=${this.label||this.name||"Checkbox Input"}
              @change="${this.onChange}"
              .checked="${this.checked}"
            />
            ${i}
          </div>
        </label>
      </div>
    `}};wv.styles=At`
    :host {
      display: block;
    }

    .parent-label {
      --background: #fff;
      --border: #dfdfe6;
      --stroke: #fff;
      --border-hover: var(--bim-ui_main-base);
      --border-active: var(--bim-ui_main-base);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      width: 100%;
      height: 1.75rem;
      column-gap: 0.25rem;
      position: relative;
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }

    :host([inverted]) .parent-label {
      flex-direction: row-reverse;
      justify-content: start;
    }

    input,
    svg {
      width: 1rem;
      height: 1rem;
      display: block;
    }

    input {
      -webkit-appearance: none;
      -moz-appearance: none;
      position: relative;
      outline: none;
      background: var(--background);
      border: none;
      margin: 0;
      padding: 0;
      cursor: pointer;
      border-radius: 4px;
      transition: box-shadow 0.3s;
      box-shadow: inset 0 0 0 var(--s, 1px) var(--b, var(--border));
    }

    svg {
      pointer-events: none;
      fill: none;
      stroke-width: 2.2px;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke: var(--stroke, var(--border-active));
      transform: translateY(-100%) scale(0);
      position: absolute;
      width: 1rem;
      height: 1rem;
    }

    input:hover {
      --s: 2px;
      --b: var(--border-hover);
    }

    input:checked {
      --b: var(--border-active);
      --s: 11px;
    }

    input:checked + svg {
      -webkit-animation: bounce 0.4s linear forwards 0.2s;
      animation: bounce 0.4s linear forwards 0.2s;
    }

    @keyframes bounce {
      0% {
        transform: translateY(-100%) scale(0);
      }
      50% {
        transform: translateY(-100%) scale(1.2);
      }
      75% {
        transform: translateY(-100%) scale(0.9);
      }
      100% {
        transform: translateY(-100%) scale(1);
      }
    }
  `;let Ar=wv;pa([j({type:String,reflect:!0})],Ar.prototype,"icon");pa([j({type:String,reflect:!0})],Ar.prototype,"name");pa([j({type:String,reflect:!0})],Ar.prototype,"label");pa([j({type:Boolean,reflect:!0})],Ar.prototype,"checked");pa([j({type:Boolean,reflect:!0})],Ar.prototype,"inverted");var Tk=Object.defineProperty,An=(i,t,e,s)=>{for(var n=void 0,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&Tk(t,e,n),n};const xv=class extends St{constructor(){super(...arguments),this.vertical=!1,this.color="#bcf124",this.disabled=!1,this._colorInput=br(),this._textInput=br(),this.onValueChange=new Event("input"),this.onOpacityInput=i=>{const t=i.target;this.opacity=t.value,this.dispatchEvent(this.onValueChange)}}set value(i){const{color:t,opacity:e}=i;this.color=t,e&&(this.opacity=e)}get value(){const i={color:this.color};return this.opacity&&(i.opacity=this.opacity),i}onColorInput(i){i.stopPropagation();const{value:t}=this._colorInput;t&&(this.color=t.value,this.dispatchEvent(this.onValueChange))}onTextInput(i){i.stopPropagation();const{value:t}=this._textInput;if(!t)return;const{value:e}=t;let s=e.replace(/[^a-fA-F0-9]/g,"");s.startsWith("#")||(s=`#${s}`),t.value=s.slice(0,7),t.value.length===7&&(this.color=t.value,this.dispatchEvent(this.onValueChange))}focus(){const{value:i}=this._colorInput;i&&i.click()}render(){return F`
      <div class="parent">
        <bim-input
          .label=${this.label}
          .icon=${this.icon}
          .vertical="${this.vertical}"
        >
          <div class="color-container">
            <div
              style="display: flex; align-items: center; gap: .375rem; height: 100%; flex: 1; padding: 0 0.5rem;"
            >
              <input
                ${Yt(this._colorInput)}
                @input="${this.onColorInput}"
                type="color"
                aria-label=${this.label||this.name||"Color Input"}
                value="${this.color}"
                ?disabled=${this.disabled}
              />
              <div
                @click=${this.focus}
                class="sample"
                style="background-color: ${this.color}"
              ></div>
              <input
                ${Yt(this._textInput)}
                @input="${this.onTextInput}"
                value="${this.color}"
                type="text"
                aria-label=${this.label||this.name||"Text Color Input"}
                ?disabled=${this.disabled}
              />
            </div>
            ${this.opacity!==void 0?F`<bim-number-input
                  @change=${this.onOpacityInput}
                  slider
                  suffix="%"
                  min="0"
                  value=${this.opacity}
                  max="100"
                ></bim-number-input>`:null}
          </div>
        </bim-input>
      </div>
    `}};xv.styles=At`
    :host {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
      flex: 1;
      display: block;
    }

    :host(:focus) {
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(--bim-ui_accent-base);
    }

    .parent {
      display: flex;
      gap: 0.375rem;
    }

    .color-container {
      position: relative;
      outline: none;
      display: flex;
      height: 100%;
      gap: 0.5rem;
      justify-content: flex-start;
      align-items: center;
      flex: 1;
      border-radius: var(--bim-color-input--bdrs, var(--bim-ui_size-4xs));
    }

    .color-container input[type="color"] {
      position: absolute;
      bottom: -0.25rem;
      visibility: hidden;
      width: 0;
      height: 0;
    }

    .color-container .sample {
      width: 1rem;
      height: 1rem;
      border-radius: 0.125rem;
      background-color: #fff;
    }

    .color-container input[type="text"] {
      height: 100%;
      flex: 1;
      width: 3.25rem;
      text-transform: uppercase;
      font-size: 0.75rem;
      background-color: transparent;
      padding: 0%;
      outline: none;
      border: none;
      color: var(--bim-color-input--c, var(--bim-ui_bg-contrast-100));
    }

    :host([disabled]) .color-container input[type="text"] {
      color: var(--bim-ui_bg-contrast-60);
    }

    bim-number-input {
      flex-grow: 0;
    }
  `;let Xs=xv;An([j({type:String,reflect:!0})],Xs.prototype,"name");An([j({type:String,reflect:!0})],Xs.prototype,"label");An([j({type:String,reflect:!0})],Xs.prototype,"icon");An([j({type:Boolean,reflect:!0})],Xs.prototype,"vertical");An([j({type:Number,reflect:!0})],Xs.prototype,"opacity");An([j({type:String,reflect:!0})],Xs.prototype,"color");An([j({type:Boolean,reflect:!0})],Xs.prototype,"disabled");var Mk=Object.defineProperty,Pk=Object.getOwnPropertyDescriptor,Ks=(i,t,e,s)=>{for(var n=s>1?void 0:s?Pk(t,e):t,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=(s?o(t,e,n):o(n))||n);return s&&n&&Mk(t,e,n),n};const Cv=class extends St{constructor(){super(...arguments),this.checked=!1,this.checkbox=!1,this.noMark=!1,this.vertical=!1}get value(){return this._value!==void 0?this._value:this.label?zc(this.label):this.label}set value(i){this._value=i}render(){return F`
      <div class="parent" .title=${this.label??""}>
        ${this.img||this.icon||this.label?F` <div style="display: flex; column-gap: 0.375rem">
              ${this.checkbox&&!this.noMark?F`<bim-checkbox
                    style="pointer-events: none"
                    .checked=${this.checked}
                  ></bim-checkbox>`:null}
              <bim-label
                .vertical=${this.vertical}
                .icon=${this.icon}
                .img=${this.img}
                >${this.label}</bim-label
              >
            </div>`:null}
        ${!this.checkbox&&!this.noMark&&this.checked?F`<svg
              xmlns="http://www.w3.org/2000/svg"
              height="1.125rem"
              viewBox="0 0 24 24"
              width="1.125rem"
              fill="#FFFFFF"
            >
              <path d="M0 0h24v24H0z" fill="none" />
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
            </svg>`:null}
        <slot></slot>
      </div>
    `}};Cv.styles=At`
    :host {
      --bim-label--c: var(--bim-ui_bg-contrast-100);
      display: block;
      box-sizing: border-box;
      flex: 1;
      padding: 0rem 0.5rem;
      border-radius: var(--bim-ui_size-4xs);
      transition: all 0.15s;
    }

    :host(:hover) {
      cursor: pointer;
    }

    :host([checked]) {
      --bim-label--c: color-mix(in lab, var(--bim-ui_main-base), white 30%);
    }

    :host([checked]) svg {
      fill: color-mix(in lab, var(--bim-ui_main-base), white 30%);
    }

    .parent {
      box-sizing: border-box;
      display: flex;
      justify-content: var(--bim-option--jc, space-between);
      column-gap: 0.5rem;
      align-items: center;
      min-height: 1.75rem;
      height: 100%;
    }

    input {
      height: 1rem;
      width: 1rem;
      cursor: pointer;
      border: none;
      outline: none;
      accent-color: var(--bim-checkbox--c, var(--bim-ui_main-base));
    }

    input:focus {
      outline: var(--bim-checkbox--olw, 2px) solid
        var(--bim-checkbox--olc, var(--bim-ui_accent-base));
    }

    bim-label {
      pointer-events: none;
      z-index: 1;
    }
  `;let le=Cv;Ks([j({type:String,reflect:!0})],le.prototype,"img",2);Ks([j({type:String,reflect:!0})],le.prototype,"label",2);Ks([j({type:String,reflect:!0})],le.prototype,"icon",2);Ks([j({type:Boolean,reflect:!0})],le.prototype,"checked",2);Ks([j({type:Boolean,reflect:!0})],le.prototype,"checkbox",2);Ks([j({type:Boolean,attribute:"no-mark",reflect:!0})],le.prototype,"noMark",2);Ks([j({converter:{fromAttribute(i){return i&&zc(i)}}})],le.prototype,"value",1);Ks([j({type:Boolean,reflect:!0})],le.prototype,"vertical",2);var $k=Object.defineProperty,Ok=Object.getOwnPropertyDescriptor,Ei=(i,t,e,s)=>{for(var n=s>1?void 0:s?Ok(t,e):t,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=(s?o(t,e,n):o(n))||n);return s&&n&&$k(t,e,n),n};const Sv=class extends Zt{constructor(){super(),this.multiple=!1,this.required=!1,this.vertical=!1,this._visible=!1,this._value=new Set,this._hasVisibleOptions=!0,this.onValueChange=new Event("change"),this._contextMenu=br(),this.onOptionClick=i=>{const t=i.target,e=this._value.has(t);if(!this.multiple&&!this.required&&!e)this._value=new Set([t]);else if(!this.multiple&&!this.required&&e)this._value=new Set([]);else if(!this.multiple&&this.required&&!e)this._value=new Set([t]);else if(this.multiple&&!this.required&&!e)this._value=new Set([...this._value,t]);else if(this.multiple&&!this.required&&e){const s=[...this._value].filter(n=>n!==t);this._value=new Set(s)}else if(this.multiple&&this.required&&!e)this._value=new Set([...this._value,t]);else if(this.multiple&&this.required&&e){const s=[...this._value].filter(r=>r!==t),n=new Set(s);n.size!==0&&(this._value=n)}this.updateOptionsState(),this.dispatchEvent(this.onValueChange)},this.onSearch=({target:i})=>{const t=i.value.toLowerCase();let e=0;for(const s of this._options)s instanceof le&&((s.label||s.value||"").toLowerCase().includes(t)?(s.style.display="",e++):s.style.display="none");this._hasVisibleOptions=e>0},this.useObserver=!0}set visible(i){var t;if(i){const{value:e}=this._contextMenu;if(!e)return;for(const s of this.elements)e.append(s);this._visible=!0}else{for(const s of this.elements)this.append(s);this._visible=!1,this.resetVisibleElements();for(const s of this._options)s instanceof le&&(s.style.display="");const e=(t=this._contextMenu.value)==null?void 0:t.querySelector("bim-text-input");e&&(e.value=""),this._hasVisibleOptions=!0}}get visible(){return this._visible}set value(i){if(this.required&&Object.keys(i).length===0)return;const t=new Set;for(const e of i){const s=this.findOption(e);if(s&&(t.add(s),!this.multiple&&Object.keys(i).length===1))break}this._value=t,this.updateOptionsState(),this.dispatchEvent(this.onValueChange)}get value(){return[...this._value].filter(i=>i instanceof le&&i.checked).map(i=>i.value)}get _options(){const i=new Set([...this.elements]);for(const t of this.children)t instanceof le&&i.add(t);return[...i]}onSlotChange(i){const t=i.target.assignedElements();this.observe(t);const e=new Set;for(const s of this.elements){if(!(s instanceof le)){s.remove();continue}s.checked&&e.add(s),s.removeEventListener("click",this.onOptionClick),s.addEventListener("click",this.onOptionClick)}this._value=e}updateOptionsState(){for(const i of this._options)i instanceof le&&(i.checked=this._value.has(i))}findOption(i){return this._options.find(t=>t instanceof le?t.label===i||t.value===i:!1)}render(){let i,t,e;if(this._value.size===0)i=this.placeholder??"Select an option...";else if(this._value.size===1){const s=[...this._value][0];i=(s==null?void 0:s.label)||(s==null?void 0:s.value),t=s==null?void 0:s.img,e=s==null?void 0:s.icon}else i=`Multiple (${this._value.size})`;return F`
      <bim-input
        title=${this.label??""}
        .label=${this.label}
        .icon=${this.icon}
        .vertical=${this.vertical}
      >
        <div class="input" @click=${()=>this.visible=!this.visible}>
          <bim-label
            .img=${t}
            .icon=${e}
            style="overflow: hidden;"
            >${i}</bim-label
          >
          <svg
            style="flex-shrink: 0; fill: var(--bim-dropdown--c, var(--bim-ui_bg-contrast-100))"
            xmlns="http://www.w3.org/2000/svg"
            height="1.125rem"
            viewBox="0 0 24 24"
            width="1.125rem"
            fill="#9ca3af"
          >
            <path d="M0 0h24v24H0V0z" fill="none" />
            <path d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
          </svg>
          <bim-context-menu
            ${Yt(this._contextMenu)}
            .visible=${this.visible}
            @hidden=${()=>{this.visible&&(this.visible=!1)}}
          >
            ${this.searchBox?F`<bim-text-input @input=${this.onSearch} placeholder="Search..." debounce=200 style="--bim-input--bgc: var(--bim-ui_bg-contrast-30)"></bim-text-input>`:$t}
            <slot @slotchange=${this.onSlotChange}></slot>
            ${this._hasVisibleOptions?$t:F`<bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-60); padding: 0.5rem;">No options found...</bim-label>`}
          </bim-context-menu>
        </div>
      </bim-input>
    `}};Sv.styles=[Gs.scrollbar,At`
      :host {
        --bim-input--bgc: var(
          --bim-dropdown--bgc,
          var(--bim-ui_bg-contrast-20)
        );
        --bim-input--olw: 2px;
        --bim-input--olc: transparent;
        --bim-input--bdrs: var(--bim-ui_size-4xs);
        flex: 1;
        display: block;
      }

      :host([visible]) {
        --bim-input--olc: var(--bim-ui_accent-base);
      }

      .input {
        --bim-label--fz: var(--bim-drodown--fz, var(--bim-ui_size-xs));
        --bim-label--c: var(--bim-dropdown--c, var(--bim-ui_bg-contrast-100));
        height: 100%;
        display: flex;
        flex: 1;
        overflow: hidden;
        column-gap: 0.25rem;
        outline: none;
        cursor: pointer;
        align-items: center;
        justify-content: space-between;
        padding: 0 0.5rem;
      }

      bim-label {
        pointer-events: none;
      }
    `];let fi=Sv;Ei([j({type:String,reflect:!0})],fi.prototype,"name",2);Ei([j({type:String,reflect:!0})],fi.prototype,"icon",2);Ei([j({type:String,reflect:!0})],fi.prototype,"label",2);Ei([j({type:Boolean,reflect:!0})],fi.prototype,"multiple",2);Ei([j({type:Boolean,reflect:!0})],fi.prototype,"required",2);Ei([j({type:Boolean,reflect:!0})],fi.prototype,"vertical",2);Ei([j({type:String,reflect:!0})],fi.prototype,"placeholder",2);Ei([j({type:Boolean,reflect:!0,attribute:"search-box"})],fi.prototype,"searchBox",2);Ei([j({type:Boolean,reflect:!0})],fi.prototype,"visible",1);Ei([us()],fi.prototype,"_value",2);Ei([us()],fi.prototype,"_hasVisibleOptions",2);function Dk(i){const t=[],e=/(["'])(.*?)\1/g;let s;for(;(s=e.exec(i))!==null;){const n=s[2].trim();if(n===""){t.push([]);continue}const r=n.split(/\s+/).map(o=>o==="."?null:o);t.push(r)}if(t.length===0){const n=i.split(/\r?\n/).map(r=>r.trim()).filter(Boolean);for(const r of n){const o=r.replace(/^["']|["']$/g,"").trim();o&&t.push(o.split(/\s+/).map(a=>a==="."?null:a))}}return t}function Ik(i){const t=i.split(`
`).map(s=>s.trim()).map(s=>s.split('"')[1]).filter(s=>s!==void 0),e=[];for(const s of t){let n="",r=0;for(let o=0;o<s.length;o++){const a=s[o];a==="["?(r++,n+=a):a==="]"?(r--,n+=a):a===" "&&r===0?n!==""&&(e.push(n),n=""):n+=a}n!==""&&e.push(n)}return[...new Set(e)].filter(s=>s!=="")}function zk(i){var t;const e=[],s=i.length,n=((t=i[0])==null?void 0:t.length)||0;for(let r=0;r<s;r++)for(let o=0;o<n-1;o++){const a=i[r][o],l=i[r][o+1];if(a!==l){const c=e.find(h=>h.type==="vertical"&&h.from[0]===o+1&&h.to[0]===o+1&&h.from[1]<=r&&h.to[1]>=r);c?(c.to[1]=r+1,c.left&&a&&c.left.push(a),c.right&&l&&c.right.push(l)):e.push({type:"vertical",from:[o+1,r],to:[o+1,r+1],left:a?[a]:[],right:l?[l]:[]})}}for(let r=0;r<s-1;r++)for(let o=0;o<n;o++){const a=i[r][o],l=i[r+1][o];if(a!==l){const c=e.find(h=>h.type==="horizontal"&&h.from[1]===r+1&&h.to[1]===r+1&&h.from[0]<=o&&h.to[0]>=o);c?(c.to[0]=o+1,c.above&&a&&c.above.push(a),c.below&&l&&c.below.push(l)):e.push({type:"horizontal",from:[o,r+1],to:[o+1,r+1],above:a?[a]:[],below:l?[l]:[]})}}return Lk(e)}function Lk(i){for(const t of i)t.left&&(t.left=[...new Set(t.left)]),t.right&&(t.right=[...new Set(t.right)]),t.above&&(t.above=[...new Set(t.above)]),t.below&&(t.below=[...new Set(t.below)]);return i}function Rk(i,t,e,s){const n=(parseFloat(i.colSizesComputed[e-1])||0)+t;let r;return r=(parseFloat(i.colSizesComputed[e])||0)-t,{left:n,right:r}}function Bk(i,t,e,s){const n=(parseFloat(i.rowSizesComputed[e-1])||0)+t;let r;return r=(parseFloat(i.rowSizesComputed[e])||0)-t,{top:n,bottom:r}}function Nk(i,t,e,s){return!(i<s&&e<0||t<s&&e>0)}function Fk(i,t,e,s){return!(i<s&&e<0||t<s&&e>0)}function Uk(i,t){const[e,s]=i.from,[n,r]=i.to,o=t.gap.split(" "),a=o[1]||o[0]||"0px",l=o[0]||"0px",c=i.type==="horizontal"?"0":`calc(-50% - ${a} / 2)`,h=i.type==="horizontal"?`calc(-50% - ${l} / 2)`:"0",d={"grid-column":`${e+1} / ${n+1}`,"grid-row":`${s+1} / ${r+1}`,transform:`translate(${c}, ${h})`},u=parseFloat(t.fontSize);return i.type==="vertical"?d.width=`${Math.max(parseFloat(a),u)}px`:d.height=`${Math.max(parseFloat(l),u)}px`,d}/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ev="important",jk=" !"+Ev,Ni=Qy(class extends Jy{constructor(i){var t;if(super(i),i.type!==Ky.ATTRIBUTE||i.name!=="style"||((t=i.strings)==null?void 0:t.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(i){return Object.keys(i).reduce((t,e)=>{const s=i[e];return s==null?t:t+`${e=e.includes("-")?e:e.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${s};`},"")}update(i,[t]){const{style:e}=i.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(t)),this.render(t);for(const s of this.ft)t[s]==null&&(this.ft.delete(s),s.includes("-")?e.removeProperty(s):e[s]=null);for(const s in t){const n=t[s];if(n!=null){this.ft.add(s);const r=typeof n=="string"&&n.endsWith(jk);s.includes("-")||r?e.setProperty(s,r?n.slice(0,-11):n,r?Ev:""):e[s]=n}}return Sn}});var Vk=Object.defineProperty,Lc=(i,t,e,s)=>{for(var n=void 0,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&Vk(t,e,n),n};const kv=class extends St{constructor(){super(...arguments),this.floating=!1,this.resizeableAreas=!1,this.areasResizeExceptions=[],this._layouts={},this._elements={},this._templateIds=new Map,this._updateFunctions={},this._slotNames={notAllowed:"not-allowed",notFound:"not-found",emptyLayout:"empty-layout"},this._colSizesRaw=[],this._rowSizesRaw=[],this._colSizesComputed=[],this._rowSizesComputed=[],this._start=null,this.layoutsResize={},this._onMouseMove=i=>{if(!this._start||!this.layout)return;const t=i.clientX-this._start.x,e=i.clientY-this._start.y,s=this._start.divider,n=getComputedStyle(this),r=parseFloat(n.fontSize)*3;if(s.type==="vertical"){const o=s.from[0],a=this._colSizesRaw.length-1,l=o===a,c=Rk(this._start,t,o);if(!Nk(c.left,c.right,t,r))return;const h=Math.max(r,c.left),d=Math.max(r,c.right);this._colSizesRaw[o-1]=`${h}px`,this._colSizesRaw[o]=l?"1fr":`${d}px`,this.style.gridTemplateColumns=this._colSizesRaw.join(" ")}if(s.type==="horizontal"){const o=s.from[1],a=this._rowSizesRaw.length-1,l=o===a,c=Bk(this._start,e,o);if(!Fk(c.top,c.bottom,e,r))return;const h=Math.max(r,c.top),d=Math.max(r,c.bottom);this._rowSizesRaw[o-1]=`${h}px`,this._rowSizesRaw[o]=l?"1fr":`${d}px`,this.style.gridTemplateRows=this._rowSizesRaw.join(" ")}this.layoutsResize[this.layout]={cols:this._colSizesRaw,rows:this._rowSizesRaw}},this._onMouseUp=()=>{window.removeEventListener("mousemove",this._onMouseMove),window.removeEventListener("mouseup",this._onMouseUp),this._start=null},this.updateComponent={},this.emitLayoutChange=()=>{this.dispatchEvent(new Event("layoutchange"))}}set layouts(i){this._layouts=i,this._templateIds.clear()}get layouts(){return this._layouts}set elements(i){this._elements=i,this.setUpdateFunctions()}get elements(){return this._elements}getLayoutAreas(i){return Ik(i.template)}setUpdateFunctions(){const i={};for(const[t,e]of Object.entries(this.elements))"template"in e&&(i[t]=s=>{var n,r;(r=(n=this._updateFunctions)[t])==null||r.call(n,s)});this.updateComponent=i}disconnectedCallback(){super.disconnectedCallback(),this._templateIds.clear(),this._updateFunctions={},this.updateComponent={}}getTemplateId(i){let t=this._templateIds.get(i);return t||(t=we.newRandomId(),this._templateIds.set(i,t)),t}isAreaResizeable(i){return this.areasResizeExceptions.includes(i)?!1:this.resizeableAreas}canResizeVerticalDivider(i){const t=i.left||[],e=i.right||[];for(const s of t)if(!this.isAreaResizeable(s))return!1;for(const s of e)if(!this.isAreaResizeable(s))return!1;return!0}canResizeHorizontalDivider(i){const t=i.above||[],e=i.below||[];for(const s of t)if(!this.isAreaResizeable(s))return!1;for(const s of e)if(!this.isAreaResizeable(s))return!1;return!0}computeDividers(){var i;if(!this.layout)return;const t=(i=this.layouts[this.layout])==null?void 0:i.template;if(!t)return;const e=Dk(t),s=zk(e),n=getComputedStyle(this),r=[];for(const o of s){let a=!1;if(o.type==="vertical"?a=this.canResizeVerticalDivider(o):a=this.canResizeHorizontalDivider(o),!a)continue;const l=u=>{this._colSizesRaw=this.style.gridTemplateColumns.split(" "),this._rowSizesRaw=this.style.gridTemplateRows.split(" "),this._rowSizesComputed=n.gridTemplateRows.split(" "),this._colSizesComputed=n.gridTemplateColumns.split(" "),this._start={x:u.clientX,y:u.clientY,divider:o,colSizesRaw:[...this._colSizesRaw],rowSizesRaw:[...this._rowSizesRaw],colSizesComputed:[...this._colSizesComputed],rowSizesComputed:[...this._rowSizesComputed]},window.addEventListener("mousemove",this._onMouseMove),window.addEventListener("mouseup",this._onMouseUp)},c=u=>{u.preventDefault()},h=Uk(o,n),d=F`
        <div @mousedown=${l} @contextmenu=${c} class="grid-divider divider-${o.type}" style=${Ni(h)}>
          <div></div>
        </div>
      `;r.push(d)}return r}cleanUpdateFunctions(){if(!this.layout){this._updateFunctions={};return}const i=this.layouts[this.layout],t=this.getLayoutAreas(i).map(e=>{const s=e.match(/\[([^\]]+)\]/);return s?s[1].split(":")[0].split(",").map(n=>n.trim()):[e]}).flat();for(const e in this.elements)t.includes(e)||delete this._updateFunctions[e]}clean(){this.style.gridTemplate="";for(const i of[...this.children])Object.values(this._slotNames).some(t=>i.getAttribute("slot")===t)||i.remove();this.cleanUpdateFunctions()}emitElementCreation(i){this.dispatchEvent(new CustomEvent("elementcreated",{detail:i}))}getSanitizedLayoutTemplate(i){return i.replace(/\b(\w+)\[[^\]]+\]/g,"$1")}createElementFromDefinition(i,t){if(t instanceof HTMLElement)return t;if("template"in t){const{template:r,initialState:o}=t,a=this.getTemplateId(r),l=this.querySelector(`[data-grid-template-id="${a}"]`);if(l){let d=this._updateFunctions[i];if(!d){for(const[,u]of Object.entries(this._updateFunctions))if(this.querySelector(`[data-grid-template-id="${this.getTemplateId(r)}"]`)===l){d=u;break}}return d&&(this._updateFunctions[i]=d),l}const[c,h]=Zt.create(r,o);return c.setAttribute("data-grid-template-id",a),this._updateFunctions[i]=h,c}const e=this.getTemplateId(t),s=this.querySelector(`[data-grid-template-id="${e}"]`);if(s)return s;const n=Zt.create(t);return n.setAttribute("data-grid-template-id",this.getTemplateId(t)),n}render(){if(this.layout){const i=this.layouts[this.layout];if(i){if(!(i.guard??(()=>!0))())return this.clean(),F`<slot name=${this._slotNames.notAllowed}></slot>`;const t=this.getLayoutAreas(i).map(s=>{var n,r;let o=s,a=[];const l=s.match(/^([^\[]+)\[([^\]]+)\]$/),c=!!l;if(l?(o=l[1],a=l[2].split(",").map(p=>{const m=p.trim(),f=m.indexOf(":");if(f>-1){const b=m.substring(0,f).trim(),g=m.substring(f+1).trim();return{key:b,label:g||void 0}}return{key:m}})):a=[{key:s}],!c){const p=a[0].key,m=((n=i.elements)==null?void 0:n[p])||this.elements[p];if(!m)return null;const f=this.createElementFromDefinition(p,m);return f?(this.emitElementCreation({name:p,element:f}),f.style.gridArea=s,f):null}const h=`tabs-${o}`;let d=this.querySelector(`[data-grid-tabs-id="${h}"]`);d||(d=document.createElement("bim-tabs"),d.setAttribute("data-grid-tabs-id",h),d.setAttribute("switchers-full","")),d.style.gridArea=o;const u=[];for(const p of a){const m=p.key,f=p.label||m,b=((r=i.elements)==null?void 0:r[m])||this.elements[m];if(!b)continue;const g=this.createElementFromDefinition(m,b);if(!g)continue;this.emitElementCreation({name:m,element:g});const y=`tab-${o}-${m}`;let v=d.querySelector(`[data-grid-tab-id="${y}"]`);v||(v=document.createElement("bim-tab"),v.setAttribute("data-grid-tab-id",y),v.name=m),v.label=f,v.innerHTML="",v.appendChild(g),u.push(v)}return d.innerHTML="",d.append(...u),d}).filter(s=>s!==null);this.clean(),this.style.gridTemplate=this.getSanitizedLayoutTemplate(i.template);const e=this.layoutsResize[this.layout];e&&(this.style.gridTemplateColumns=e.cols.join(" "),this.style.gridTemplateRows=e.rows.join(" ")),this.append(...t),this.emitLayoutChange()}else return this.clean(),F`<slot name=${this._slotNames.notFound}></slot>`}else return this.clean(),this.emitLayoutChange(),F`<slot name=${this._slotNames.emptyLayout}></slot>`;return F`
      ${this.resizeableAreas?this.computeDividers():null}
      <slot></slot>
    `}};kv.styles=At`
    :host {
      display: grid;
      height: 100%;
      width: 100%;
      overflow: hidden;
      box-sizing: border-box;
    }

    /* :host(:not([layout])) {
      display: none;
    } */

    :host([floating]) {
      --bim-panel--bdrs: var(--bim-ui_size-4xs);
      background-color: transparent;
      padding: 1rem;
      gap: 1rem;
      position: absolute;
      pointer-events: none;
      top: 0px;
      left: 0px;
    }

    :host(:not([floating])) {
      --bim-panel--bdrs: 0;
      background-color: var(--bim-ui_bg-contrast-20);
      gap: 1px;
    }

    .grid-divider {
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
      user-select: none;
    }

    .grid-divider > div {
      transition: background-color 150ms ease-in-out;
    }
    
    .grid-divider:hover > div {
      background-color: var(--bim-ui_accent-base);
    }
    
    .divider-horizontal {
      /* background-color: #ff00003d; */
      transform: translateY(-50%);
      cursor: n-resize;
    }
    
    .divider-horizontal > div {
      height: 3px;
      width: 100%;
      /* transform: translateY(-50%); */
    }
    
    .divider-vertical {
      /* background-color: #ff00003d; */
      transform: translateX(-50%);
      cursor: e-resize;
    }
    
    .divider-vertical > div {
      width: 3px;
      height: 100%;
      /* transform: translateX(-50%); */
    }
  `;let fa=kv;Lc([j({type:Boolean,reflect:!0})],fa.prototype,"floating");Lc([j({type:String,reflect:!0})],fa.prototype,"layout");Lc([j({type:Boolean,attribute:"areas-resizeable",reflect:!0})],fa.prototype,"resizeableAreas");Lc([j({type:Array,attribute:!1})],fa.prototype,"areasResizeExceptions");const Rd=class extends St{render(){return F`
      <iconify-icon .icon=${this.icon} height="none"></iconify-icon>
    `}};Rd.styles=At`
    :host {
      height: var(--bim-icon--fz, var(--bim-ui_size-sm));
      width: var(--bim-icon--fz, var(--bim-ui_size-sm));
    }

    iconify-icon {
      height: var(--bim-icon--fz, var(--bim-ui_size-sm));
      width: var(--bim-icon--fz, var(--bim-ui_size-sm));
      color: var(--bim-icon--c);
      transition: all 0.15s;
      display: flex;
    }
  `,Rd.properties={icon:{type:String}};let Hk=Rd;var Wk=Object.defineProperty,Rc=(i,t,e,s)=>{for(var n=void 0,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&Wk(t,e,n),n};const Av=class extends St{constructor(){super(...arguments),this.vertical=!1,this.onValueChange=new Event("change")}get value(){const i={};for(const t of this.children){const e=t;"value"in e?i[e.name||e.label]=e.value:"checked"in e&&(i[e.name||e.label]=e.checked)}return i}set value(i){const t=[...this.children];for(const e in i){const s=t.find(o=>{const a=o;return a.name===e||a.label===e});if(!s)continue;const n=s,r=i[e];typeof r=="boolean"?n.checked=r:n.value=r}}render(){return F`
      <div class="parent">
        ${this.label||this.icon?F`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        <div class="input">
          <slot></slot>
        </div>
      </div>
    `}};Av.styles=At`
    :host {
      flex: 1;
      display: block;
    }

    .parent {
      display: flex;
      flex-wrap: wrap;
      column-gap: 1rem;
      row-gap: 0.375rem;
      user-select: none;
      flex: 1;
    }

    :host(:not([vertical])) .parent {
      justify-content: space-between;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    .input {
      position: relative;
      overflow: hidden;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      min-height: 1.75rem;
      min-width: 3rem;
      gap: var(--bim-input--g, var(--bim-ui_size-4xs));
      padding: var(--bim-input--p, 0);
      background-color: var(--bim-input--bgc, transparent);
      border: var(--bim-input--olw, 2px) solid
        var(--bim-input--olc, transparent);
      border-radius: var(--bim-input--bdrs, var(--bim-ui_size-4xs));
      transition: all 0.15s;
    }

    :host(:not([vertical])) .input {
      flex: 1;
      justify-content: flex-end;
    }

    :host(:not([vertical])[label]) .input {
      max-width: fit-content;
    }
  `;let ma=Av;Rc([j({type:String,reflect:!0})],ma.prototype,"name");Rc([j({type:String,reflect:!0})],ma.prototype,"label");Rc([j({type:String,reflect:!0})],ma.prototype,"icon");Rc([j({type:Boolean,reflect:!0})],ma.prototype,"vertical");/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function sr(i,t,e){return i?t(i):e==null?void 0:e(i)}/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Bd=i=>i??$t;var qk=Object.defineProperty,ga=(i,t,e,s)=>{for(var n=void 0,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&qk(t,e,n),n},Dh;let Tr=(Dh=class extends St{constructor(){super(...arguments),this.labelHidden=!1,this.iconHidden=!1,this.vertical=!1,this._imgTemplate=()=>F`<img src=${Bd(this.img)} .alt=${this.textContent||""} />`,this._iconTemplate=()=>F`<bim-icon .icon=${this.icon}></bim-icon>`}get value(){return this.textContent?zc(this.textContent):this.textContent}render(){return F`
      <div class="parent" title=${this.textContent}>
        ${sr(this.img,this._imgTemplate,()=>$t)}
        ${sr(!this.iconHidden&&this.icon,this._iconTemplate,()=>$t)}
        <p><slot></slot></p>
      </div>
    `}},Dh.styles=At`
    :host {
      --bim-icon--c: var(--bim-label--ic);
      overflow: auto;
      color: var(--bim-label--c, var(--bim-ui_bg-contrast-60));
      font-size: var(--bim-label--fz, var(--bim-ui_size-xs));
      display: block;
      white-space: nowrap;
      transition: all 0.15s;
      user-select: none;
    }

    :host([icon]) {
      line-height: 1.1rem;
    }

    .parent {
      display: flex;
      align-items: center;
      column-gap: 0.25rem;
      row-gap: 0.125rem;
      height: 100%;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    .parent p {
      margin: 0;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    :host([label-hidden]) .parent p,
    :host(:empty) .parent p {
      display: none;
    }

    img {
      height: 100%;
      aspect-ratio: 1;
      border-radius: 100%;
      margin-right: 0.125rem;
    }

    :host(:not([vertical])) img {
      max-height: var(
        --bim-label_icon--sz,
        calc(var(--bim-label--fz, var(--bim-ui_size-xs)) * 1.8)
      );
    }

    :host([vertical]) img {
      max-height: var(
        --bim-label_icon--sz,
        calc(var(--bim-label--fz, var(--bim-ui_size-xs)) * 4)
      );
    }
  `,Dh);ga([j({type:String,reflect:!0})],Tr.prototype,"img");ga([j({type:Boolean,attribute:"label-hidden",reflect:!0})],Tr.prototype,"labelHidden");ga([j({type:String,reflect:!0})],Tr.prototype,"icon");ga([j({type:Boolean,attribute:"icon-hidden",reflect:!0})],Tr.prototype,"iconHidden");ga([j({type:Boolean,reflect:!0})],Tr.prototype,"vertical");var Yk=Object.defineProperty,Zk=Object.getOwnPropertyDescriptor,mi=(i,t,e,s)=>{for(var n=s>1?void 0:s?Zk(t,e):t,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=(s?o(t,e,n):o(n))||n);return s&&n&&Yk(t,e,n),n};const Tv=class extends St{constructor(){super(...arguments),this._value=0,this.vertical=!1,this.slider=!1,this._input=br(),this.onValueChange=new Event("change")}set value(i){this.setValue(i.toString())}get value(){return this._value}onChange(i){i.stopPropagation();const{value:t}=this._input;t&&this.setValue(t.value)}setValue(i){const{value:t}=this._input;let e=i;if(e=e.replace(/[^0-9.-]/g,""),e=e.replace(/(\..*)\./g,"$1"),e.endsWith(".")||(e.lastIndexOf("-")>0&&(e=e[0]+e.substring(1).replace(/-/g,"")),e==="-"||e==="-0"))return;let s=Number(e);Number.isNaN(s)||(s=this.min!==void 0?Math.max(s,this.min):s,s=this.max!==void 0?Math.min(s,this.max):s,this.value!==s&&(this._value=s,t&&(t.value=this.value.toString()),this.requestUpdate(),this.dispatchEvent(this.onValueChange)))}onBlur(){const{value:i}=this._input;i&&Number.isNaN(Number(i.value))&&(i.value=this.value.toString())}onSliderMouseDown(i){document.body.style.cursor="w-resize";const{clientX:t}=i,e=this.value;let s=!1;const n=a=>{var l;s=!0;const{clientX:c}=a,h=this.step??1,d=((l=h.toString().split(".")[1])==null?void 0:l.length)||0,u=1/(this.sensitivity??1),p=(c-t)/u;if(Math.floor(Math.abs(p))!==Math.abs(p))return;const m=e+p*h;this.setValue(m.toFixed(d))},r=()=>{this.slider=!0,this.removeEventListener("blur",r)},o=()=>{document.removeEventListener("mousemove",n),document.body.style.cursor="default",s?s=!1:(this.addEventListener("blur",r),this.slider=!1,requestAnimationFrame(()=>this.focus())),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)}onFocus(i){i.stopPropagation();const t=e=>{e.key==="Escape"&&(this.blur(),window.removeEventListener("keydown",t))};window.addEventListener("keydown",t)}connectedCallback(){super.connectedCallback(),this.min&&this.min>this.value&&(this._value=this.min),this.max&&this.max<this.value&&(this._value=this.max)}focus(){const{value:i}=this._input;i&&i.focus()}render(){const i=F`
      ${this.pref||this.icon?F`<bim-label
            style="pointer-events: auto"
            @mousedown=${this.onSliderMouseDown}
            .icon=${this.icon}
            >${this.pref}</bim-label
          >`:null}
      <input
        ${Yt(this._input)}
        type="text"
        aria-label=${this.label||this.name||"Number Input"}
        size="1"
        @input=${o=>o.stopPropagation()}
        @change=${this.onChange}
        @blur=${this.onBlur}
        @focus=${this.onFocus}
        .value=${this.value.toString()}
      />
      ${this.suffix?F`<bim-label
            style="pointer-events: auto"
            @mousedown=${this.onSliderMouseDown}
            >${this.suffix}</bim-label
          >`:null}
    `,t=this.min??-1/0,e=this.max??1/0,s=100*(this.value-t)/(e-t),n=F`
      <style>
        .slider-indicator {
          width: ${`${s}%`};
        }
      </style>
      <div class="slider" @mousedown=${this.onSliderMouseDown}>
        <div class="slider-indicator"></div>
        ${this.pref||this.icon?F`<bim-label
              style="z-index: 1; margin-right: 0.125rem"
              .icon=${this.icon}
              >${`${this.pref}: `}</bim-label
            >`:null}
        <bim-label style="z-index: 1;">${this.value}</bim-label>
        ${this.suffix?F`<bim-label style="z-index: 1;">${this.suffix}</bim-label>`:null}
      </div>
    `,r=`${this.label||this.name||this.pref?`${this.label||this.name||this.pref}: `:""}${this.value}${this.suffix??""}`;return F`
      <bim-input
        title=${r}
        .label=${this.label}
        .icon=${this.icon}
        .vertical=${this.vertical}
      >
        ${this.slider?n:i}
      </bim-input>
    `}};Tv.styles=At`
    :host {
      --bim-input--bgc: var(
        --bim-number-input--bgc,
        var(--bim-ui_bg-contrast-20)
      );
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(--bim-number-input--olc, transparent);
      --bim-input--bdrs: var(--bim-number-input--bdrs, var(--bim-ui_size-4xs));
      --bim-input--p: 0 0.375rem;
      flex: 1;
      display: block;
    }

    :host(:focus) {
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(
        --bim-number-input¡focus--c,
        var(--bim-ui_accent-base)
      );
    }

    :host(:not([slider])) bim-label {
      --bim-label--c: var(
        --bim-number-input_affixes--c,
        var(--bim-ui_bg-contrast-60)
      );
      --bim-label--fz: var(
        --bim-number-input_affixes--fz,
        var(--bim-ui_size-xs)
      );
    }

    p {
      margin: 0;
      padding: 0;
    }

    input {
      background-color: transparent;
      outline: none;
      border: none;
      padding: 0;
      flex-grow: 1;
      text-align: right;
      font-family: inherit;
      font-feature-settings: inherit;
      font-variation-settings: inherit;
      font-size: var(--bim-number-input--fz, var(--bim-ui_size-xs));
      color: var(--bim-number-input--c, var(--bim-ui_bg-contrast-100));
    }

    :host([suffix]:not([pref])) input {
      text-align: left;
    }

    :host([slider]) {
      --bim-input--p: 0;
    }

    :host([slider]) .slider {
      --bim-label--c: var(--bim-ui_bg-contrast-100);
    }

    .slider {
      position: relative;
      display: flex;
      justify-content: center;
      width: 100%;
      height: 100%;
      padding: 0 0.5rem;
    }

    .slider-indicator {
      height: 100%;
      background-color: var(--bim-ui_main-base);
      position: absolute;
      top: 0;
      left: 0;
      border-radius: var(--bim-input--bdrs, var(--bim-ui_size-4xs));
    }

    bim-input {
      display: flex;
    }

    bim-label {
      pointer-events: none;
    }
  `;let ii=Tv;mi([j({type:String,reflect:!0})],ii.prototype,"name",2);mi([j({type:String,reflect:!0})],ii.prototype,"icon",2);mi([j({type:String,reflect:!0})],ii.prototype,"label",2);mi([j({type:String,reflect:!0})],ii.prototype,"pref",2);mi([j({type:Number,reflect:!0})],ii.prototype,"min",2);mi([j({type:Number,reflect:!0})],ii.prototype,"value",1);mi([j({type:Number,reflect:!0})],ii.prototype,"step",2);mi([j({type:Number,reflect:!0})],ii.prototype,"sensitivity",2);mi([j({type:Number,reflect:!0})],ii.prototype,"max",2);mi([j({type:String,reflect:!0})],ii.prototype,"suffix",2);mi([j({type:Boolean,reflect:!0})],ii.prototype,"vertical",2);mi([j({type:Boolean,reflect:!0})],ii.prototype,"slider",2);var Gk=Object.defineProperty,Xk=Object.getOwnPropertyDescriptor,ba=(i,t,e,s)=>{for(var n=s>1?void 0:s?Xk(t,e):t,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=(s?o(t,e,n):o(n))||n);return s&&n&&Gk(t,e,n),n};const Mv=class extends St{constructor(){super(...arguments),this.onValueChange=new Event("change"),this._hidden=!1,this.headerHidden=!1,this.valueTransform={},this.activationButton=document.createElement("bim-button")}set hidden(i){this._hidden=i,this.activationButton.active=!i,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}get value(){return Ko(this,this.valueTransform)}set value(i){const t=[...this.children];for(const e in i){const s=t.find(r=>{const o=r;return o.name===e||o.label===e});if(!s)continue;const n=s;n.value=i[e]}}animatePanles(){const i=[{maxHeight:"100vh",maxWidth:"100vw",opacity:1},{maxHeight:"100vh",maxWidth:"100vw",opacity:0},{maxHeight:0,maxWidth:0,opacity:0}];this.animate(i,{duration:300,easing:"cubic-bezier(0.65, 0.05, 0.36, 1)",direction:this.hidden?"normal":"reverse",fill:"forwards"})}connectedCallback(){super.connectedCallback(),this.activationButton.active=!this.hidden,this.activationButton.onclick=()=>{this.hidden=!this.hidden,this.animatePanles()}}disconnectedCallback(){super.disconnectedCallback(),this.activationButton.remove()}collapseSections(){const i=this.querySelectorAll("bim-panel-section");for(const t of i)t.collapsed=!0}expandSections(){const i=this.querySelectorAll("bim-panel-section");for(const t of i)t.collapsed=!1}render(){return this.activationButton.icon=this.icon,this.activationButton.label=this.label||this.name,this.activationButton.tooltipTitle=this.label||this.name,F`
      <div class="parent">
        ${this.label||this.name||this.icon?F`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        <div class="sections">
          <slot></slot>
        </div>
      </div>
    `}};Mv.styles=[Gs.scrollbar,At`
      :host {
        display: flex;
        border-radius: var(--bim-ui_size-base);
        background-color: var(--bim-ui_bg-base);
        overflow: auto;
      }

      :host([hidden]) {
        max-height: 0;
        max-width: 0;
        opacity: 0;
      }

      .parent {
        display: flex;
        flex: 1;
        flex-direction: column;
        pointer-events: auto;
        overflow: auto;
      }

      .parent bim-label {
        --bim-label--c: var(--bim-panel--c, var(--bim-ui_bg-contrast-80));
        --bim-label--fz: var(--bim-panel--fz, var(--bim-ui_size-sm));
        font-weight: 600;
        padding: 1rem;
        flex-shrink: 0;
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([header-hidden]) .parent bim-label {
        display: none;
      }

      .sections {
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow: auto;
        flex: 1;
      }

      ::slotted(bim-panel-section:not(:last-child)) {
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }
    `];let Tn=Mv;ba([j({type:String,reflect:!0})],Tn.prototype,"icon",2);ba([j({type:String,reflect:!0})],Tn.prototype,"name",2);ba([j({type:String,reflect:!0})],Tn.prototype,"label",2);ba([j({type:Boolean,reflect:!0})],Tn.prototype,"hidden",1);ba([j({type:Boolean,attribute:"header-hidden",reflect:!0})],Tn.prototype,"headerHidden",2);var Kk=Object.defineProperty,ya=(i,t,e,s)=>{for(var n=void 0,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&Kk(t,e,n),n};const Pv=class extends St{constructor(){super(...arguments),this.onValueChange=new Event("change"),this.valueTransform={},this.componentHeight=-1}get value(){const i=this.parentElement;let t;return i instanceof Tn&&(t=i.valueTransform),Object.values(this.valueTransform).length!==0&&(t=this.valueTransform),Ko(this,t)}set value(i){const t=[...this.children];for(const e in i){const s=t.find(r=>{const o=r;return o.name===e||o.label===e});if(!s)continue;const n=s;n.value=i[e]}}setFlexAfterTransition(){var i;const t=(i=this.shadowRoot)==null?void 0:i.querySelector(".components");t&&setTimeout(()=>{this.collapsed?t.style.removeProperty("flex"):t.style.setProperty("flex","1")},150)}animateHeader(){var i;const t=(i=this.shadowRoot)==null?void 0:i.querySelector(".components");this.componentHeight<0&&(this.collapsed?this.componentHeight=t.clientHeight:(t.style.setProperty("transition","none"),t.style.setProperty("height","auto"),t.style.setProperty("padding","0.125rem 1rem 1rem"),this.componentHeight=t.clientHeight,requestAnimationFrame(()=>{t.style.setProperty("height","0px"),t.style.setProperty("padding","0 1rem 0"),t.style.setProperty("transition","height 0.25s cubic-bezier(0.65, 0.05, 0.36, 1), padding 0.25s cubic-bezier(0.65, 0.05, 0.36, 1)")}))),this.collapsed?(t.style.setProperty("height",`${this.componentHeight}px`),requestAnimationFrame(()=>{t.style.setProperty("height","0px"),t.style.setProperty("padding","0 1rem 0")})):(t.style.setProperty("height","0px"),t.style.setProperty("padding","0 1rem 0"),requestAnimationFrame(()=>{t.style.setProperty("height",`${this.componentHeight}px`),t.style.setProperty("padding","0.125rem 1rem 1rem")})),this.setFlexAfterTransition()}onHeaderClick(){this.fixed||(this.collapsed=!this.collapsed,this.animateHeader())}handelSlotChange(i){i.target.assignedElements({flatten:!0}).forEach((t,e)=>{const s=e*.05;t.style.setProperty("transition-delay",`${s}s`)})}handlePointerEnter(){const i=this.renderRoot.querySelector(".expand-icon");this.collapsed?i==null||i.style.setProperty("animation","collapseAnim 0.5s"):i==null||i.style.setProperty("animation","expandAnim 0.5s")}handlePointerLeave(){const i=this.renderRoot.querySelector(".expand-icon");i==null||i.style.setProperty("animation","none")}render(){const i=this.label||this.icon||this.name||this.fixed,t=F`<svg
      xmlns="http://www.w3.org/2000/svg"
      height="1.125rem"
      viewBox="0 0 24 24"
      width="1.125rem"
      class="expand-icon"
    >
      <path d="M0 0h24v24H0z" fill="none" />
      <path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z" />
    </svg>`,e=F`
      <div
        class="header"
        title=${this.label??""}
        @pointerenter=${this.handlePointerEnter}
        @pointerleave=${this.handlePointerLeave}
        @click=${this.onHeaderClick}
      >
        ${this.label||this.icon||this.name?F`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        ${this.fixed?null:t}
      </div>
    `;return F`
      <div class="parent">
        ${i?e:null}
        <div class="components" style="flex: 1;">
          <div>
            <slot @slotchange=${this.handelSlotChange}></slot>
          </div>
        </div>
      </div>
    `}};Pv.styles=[Gs.scrollbar,At`
      :host {
        display: block;
        pointer-events: auto;
      }

      :host .parent {
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      :host(:not([fixed])) .header:hover {
        --bim-label--c: var(--bim-ui_accent-base);
        color: var(--bim-ui_accent-base);
        cursor: pointer;
      }

      :host(:not([fixed])) .header:hover .expand-icon {
        fill: var(--bim-ui_accent-base);
      }

      .header {
        --bim-label--fz: var(--bim-ui_size-sm);
        --bim-label--c: var(
          --bim-panel-section_hc,
          var(--bim-ui_bg-contrast-80)
        );
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        height: 1.5rem;
        padding: 0.75rem 1rem;
      }

      .expand-icon {
        fill: var(--bim-ui_bg-contrast-80);
        transition: transform 0.2s;
      }

      :host([collapsed]) .expand-icon {
        transform: rotateZ(-180deg);
      }

      .title {
        display: flex;
        align-items: center;
        column-gap: 0.5rem;
      }

      .title p {
        font-size: var(--bim-ui_size-sm);
      }

      .components {
        display: flex;
        flex-direction: column;
        overflow: hidden;
        row-gap: 0.75rem;
        padding: 0 1rem 1rem;
        box-sizing: border-box;
        transition:
          height 0.25s cubic-bezier(0.65, 0.05, 0.36, 1),
          padding 0.25s cubic-bezier(0.65, 0.05, 0.36, 1);
      }

      .components > div {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        flex: 1;
        overflow: auto;
      }

      :host(:not([icon]):not([label])) .components {
        padding: 1rem;
      }

      :host(:not([fixed])[collapsed]) .components {
        padding: 0 1rem 0;
        height: 0px;
      }

      bim-label {
        pointer-events: none;
      }

      ::slotted(*) {
        transition:
          transform 0.25s cubic-bezier(0.65, 0.05, 0.36, 1),
          opacity 0.25s cubic-bezier(0.65, 0.05, 0.36, 1);
      }

      :host(:not([fixed])[collapsed]) ::slotted(*) {
        transform: translateX(-20%);
        opacity: 0;
      }

      @keyframes expandAnim {
        0%,
        100% {
          transform: translateY(0%);
        }
        25% {
          transform: translateY(-30%);
        }
        50% {
          transform: translateY(10%);
        }
        75% {
          transform: translateY(-30%);
        }
      }

      @keyframes collapseAnim {
        0%,
        100% {
          transform: translateY(0%) rotateZ(-180deg);
        }
        25% {
          transform: translateY(30%) rotateZ(-180deg);
        }
        50% {
          transform: translateY(-10%) rotateZ(-180deg);
        }
        75% {
          transform: translateY(30%) rotateZ(-180deg);
        }
      }
    `];let Mr=Pv;ya([j({type:String,reflect:!0})],Mr.prototype,"icon");ya([j({type:String,reflect:!0})],Mr.prototype,"label");ya([j({type:String,reflect:!0})],Mr.prototype,"name");ya([j({type:Boolean,reflect:!0})],Mr.prototype,"fixed");ya([j({type:Boolean,reflect:!0})],Mr.prototype,"collapsed");var Qk=Object.defineProperty,va=(i,t,e,s)=>{for(var n=void 0,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&Qk(t,e,n),n};const $v=class extends St{constructor(){super(...arguments),this.vertical=!1,this.onValueChange=new Event("change"),this._canEmitEvents=!1,this._value=document.createElement("bim-option"),this.onOptionClick=i=>{this._value=i.target,this.setAnimatedBackgound(),this.dispatchEvent(this.onValueChange);for(const t of this.children)t instanceof le&&(t.checked=t===i.target)}}get _options(){return[...this.querySelectorAll("bim-option")]}set value(i){const t=this.findOption(i);if(t){for(const e of this._options)e.checked=e===t;this._value=t,this.setAnimatedBackgound(),this._canEmitEvents&&this.dispatchEvent(this.onValueChange)}}get value(){return this._value.value}onSlotChange(i){const t=i.target.assignedElements();for(const e of t)e instanceof le&&(e.noMark=!0,e.removeEventListener("click",this.onOptionClick),e.addEventListener("click",this.onOptionClick))}findOption(i){return this._options.find(t=>t instanceof le?t.label===i||t.value===i:!1)}doubleRequestAnimationFrames(i){requestAnimationFrame(()=>requestAnimationFrame(i))}setAnimatedBackgound(i=!1){const t=this.renderRoot.querySelector(".animated-background"),e=this._value;requestAnimationFrame(()=>{var s,n,r,o;const a=(o=(r=(n=(s=e==null?void 0:e.parentElement)==null?void 0:s.shadowRoot)==null?void 0:n.querySelector("bim-input"))==null?void 0:r.shadowRoot)==null?void 0:o.querySelector(".input"),l={width:e==null?void 0:e.clientWidth,height:e==null?void 0:e.clientHeight,top:((e==null?void 0:e.offsetTop)??0)-((a==null?void 0:a.offsetTop)??0),left:((e==null?void 0:e.offsetLeft)??0)-((a==null?void 0:a.offsetLeft)??0)};t==null||t.style.setProperty("width",`${l.width}px`),t==null||t.style.setProperty("height",`${l.height}px`),t==null||t.style.setProperty("top",`${l.top}px`),t==null||t.style.setProperty("left",`${l.left}px`)}),i&&this.doubleRequestAnimationFrames(()=>{const s="ease";t==null||t.style.setProperty("transition",`width ${.3}s ${s}, height ${.3}s ${s}, top ${.3}s ${s}, left ${.3}s ${s}`)})}firstUpdated(){const i=[...this.children].find(t=>t instanceof le&&t.checked);i&&(this._value=i),window.addEventListener("load",()=>{this.setAnimatedBackgound(!0)}),new ResizeObserver(()=>{this.setAnimatedBackgound()}).observe(this)}render(){return F`
      <bim-input
        .vertical=${this.vertical}
        .label=${this.label}
        .icon=${this.icon}
      >
        <div class="animated-background"></div>
        <slot @slotchange=${this.onSlotChange}></slot>
      </bim-input>
    `}};$v.styles=At`
    :host {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
      --bim-input--g: 0;
      --bim-option--jc: center;
      flex: 1;
      display: block;
    }

    ::slotted(bim-option) {
      position: relative;
      border-radius: 0;
      overflow: hidden;
      min-width: min-content;
      min-height: min-content;
      transition: background-color 0.2s;
    }

    .animated-background {
      position: absolute;
      background: var(--bim-ui_main-base);
      width: 0;
      height: 0;
      top: 0;
      left: 0;
    }

    ::slotted(bim-option[checked]) {
      --bim-label--c: var(--bim-ui_main-contrast);
    }

    ::slotted(bim-option:not([checked]):hover) {
      background-color: #0003;
    }
  `;let Pr=$v;va([j({type:String,reflect:!0})],Pr.prototype,"name");va([j({type:String,reflect:!0})],Pr.prototype,"icon");va([j({type:String,reflect:!0})],Pr.prototype,"label");va([j({type:Boolean,reflect:!0})],Pr.prototype,"vertical");va([us()],Pr.prototype,"_value");function Jk(i,t,e){if(t.length===0||i.length===0)return i;const s=Wu.flattenData(i);return Hu(s,t,e)}function Hu(i,t,e){if(t.length===0)return i;const[s,...n]=t,r=e==null?void 0:e[s];return r?tA(i,s,r,n,e):iA(i,s,n,e)}function tA(i,t,e,s,n){const r=new Map;for(const o of i){const a=o.data[t];if(a===void 0)continue;const l=e(a,o.data),c=l.join("|");r.has(c)||r.set(c,{path:l,rows:[]}),r.get(c).rows.push(o)}return eA(r,t,s,n)}function eA(i,t,e,s){const n=new sA;for(const{path:r,rows:o}of i.values())n.addPath(r,o,t);return n.buildResult(e,s)}function iA(i,t,e,s){const n=new Map;for(const o of i){const a=o.data[t];n.has(a)||n.set(a,[]),n.get(a).push(o)}const r=[];for(const[o,a]of n){const l=e.length>0?Hu(a,e,s):a;r.push({data:{[t]:o},children:l,_isComputedGroup:!0})}return r}class sA{constructor(){this.tree=new Map}addPath(t,e,s){let n=this.tree;for(let r=0;r<t.length;r++){const o=t[r];n.has(o)||n.set(o,{value:o,column:s,children:new Map,rows:[]});const a=n.get(o);r===t.length-1&&a.rows.push(...e),n=a.children}}buildResult(t,e){return this.convertMapToResult(this.tree,t,e)}convertMapToResult(t,e,s){const n=[];for(const r of t.values()){const o=[];if(r.children.size>0&&o.push(...this.convertMapToResult(r.children,e,s)),r.rows.length>0){const a=e.length>0?Hu(r.rows,e,s):r.rows;o.push(...a)}n.push({data:{[r.column]:r.value},children:o,_isComputedGroup:!0})}return n}}const nA=()=>F`
    <style>
      div {
        display: flex;
        gap: 0.375rem;
        border-radius: 0.25rem;
        min-height: 1.25rem;
      }

      [data-type="row"] {
        background-color: var(--bim-ui_bg-contrast-10);
        animation: row-loading 1s linear infinite alternate;
        padding: 0.5rem;
      }

      [data-type="cell"] {
        background-color: var(--bim-ui_bg-contrast-20);
        flex: 0.25;
      }

      @keyframes row-loading {
        0% {
          background-color: var(--bim-ui_bg-contrast-10);
        }
        100% {
          background-color: var(--bim-ui_bg-contrast-20);
        }
      }
    </style>
    <div style="display: flex; flex-direction: column;">
      <div data-type="row" style="gap: 2rem">
        <div data-type="cell" style="flex: 1"></div>
        <div data-type="cell" style="flex: 2"></div>
        <div data-type="cell" style="flex: 1"></div>
        <div data-type="cell" style="flex: 0.5"></div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.7s5"></div>
        </div>
      </div>
    </div>
  `,rA=()=>F`
    <style>
      .loader {
        grid-area: Processing;
        position: relative;
        padding: 0.125rem;
      }
      .loader:before {
        content: "";
        position: absolute;
      }
      .loader .loaderBar {
        position: absolute;
        top: 0;
        right: 100%;
        bottom: 0;
        left: 0;
        background: var(--bim-ui_main-base);
        /* width: 25%; */
        width: 0;
        animation: borealisBar 2s linear infinite;
      }

      @keyframes borealisBar {
        0% {
          left: 0%;
          right: 100%;
          width: 0%;
        }
        10% {
          left: 0%;
          right: 75%;
          width: 25%;
        }
        90% {
          right: 0%;
          left: 75%;
          width: 25%;
        }
        100% {
          left: 100%;
          right: 0%;
          width: 0%;
        }
      }
    </style>
    <div class="loader">
      <div class="loaderBar"></div>
    </div>
  `;var oA=Object.defineProperty,aA=(i,t,e,s)=>{for(var n=void 0,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&oA(t,e,n),n};const Ov=class extends St{constructor(){super(...arguments),this.column="",this.columnIndex=0,this.table=null,this.group=null,this.row=null,this.rowData={}}get data(){return this.column?this.rowData[this.column]:null}get dataTransform(){var i,t,e,s;const n=(t=(i=this.row)==null?void 0:i.dataTransform)==null?void 0:t[this.column],r=(e=this.table)==null?void 0:e.dataTransform[this.column],o=(s=this.table)==null?void 0:s.defaultContentTemplate;return n||r||o}get templateValue(){const{data:i,rowData:t,group:e}=this,s=this.dataTransform;if(s&&i!=null&&e){const n=s(i,t,e);return typeof n=="string"||typeof n=="boolean"||typeof n=="number"?F`<bim-label>${n}</bim-label>`:n}return i!=null?F`<bim-label>${i}</bim-label>`:$t}connectedCallback(){var i,t;super.connectedCallback(),(i=this.group)!=null&&i.data._isComputedGroup&&(t=this.table)!=null&&t.groupedBy.includes(this.column)?(this.style.gridColumn="1",this.style.gridRow="1"):this.style.gridArea=this.column.toString()}render(){return F`${this.templateValue}`}};Ov.styles=At`
    :host {
      padding: 0.375rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    :host([data-column-index="0"]) {
      justify-content: normal;
    }

    :host([data-column-index="0"]:not([data-cell-header]))
      ::slotted(bim-label) {
      text-align: left;
    }

    ::slotted(*) {
      --bim-input--bgc: transparent;
      --bim-input--olc: var(--bim-ui_bg-contrast-20);
      --bim-input--olw: 1px;
    }

    ::slotted(bim-input) {
      --bim-input--olw: 0;
    }
  `;let Dv=Ov;aA([j({type:String,reflect:!0})],Dv.prototype,"column");const Iv=class extends St{constructor(){super(...arguments),this._groups=[],this.group=this.closest("bim-table-group"),this._data=[],this.table=this.closest("bim-table")}get data(){var i;return((i=this.group)==null?void 0:i.data.children)??this._data}set data(i){this._data=i}clean(){for(const i of this._groups)i.remove();this._groups=[]}render(){return this.clean(),F`
      <slot></slot>
      ${this.data.map(i=>{const t=document.createElement("bim-table-group");return this._groups.push(t),t.table=this.table,t.data=i,t})}
    `}};Iv.styles=At`
    :host {
      --bim-button--bgc: transparent;
      position: relative;
      display: block;
      overflow: hidden;
      grid-area: Children;
    }

    :host([hidden]) {
      height: 0;
      opacity: 0;
    }

    ::slotted(.branch.branch-vertical) {
      top: 0;
      bottom: 1.125rem;
    }
  `;let lA=Iv;var cA=Object.defineProperty,hA=(i,t,e,s)=>{for(var n=void 0,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&cA(t,e,n),n};const zv=class extends St{constructor(){super(...arguments),this.childrenHidden=!0,this.table=null,this.data={data:{}}}get rowElement(){const i=this.shadowRoot;return i?i.querySelector("bim-table-row"):null}get childrenElement(){const i=this.shadowRoot;return i?i.querySelector("bim-table-children"):null}get _isChildrenEmpty(){return!(this.data.children&&this.data.children.length!==0)}connectedCallback(){super.connectedCallback(),this.table&&this.table.expanded?this.childrenHidden=!1:this.childrenHidden=!0}disconnectedCallback(){super.disconnectedCallback(),this.data={data:{}}}toggleChildren(i){this.childrenHidden=typeof i>"u"?!this.childrenHidden:!i,this.animateTableChildren(!0)}animateTableChildren(i=!0){if(!i){requestAnimationFrame(()=>{var r;const o=this.renderRoot.querySelector(".caret"),a=this.renderRoot.querySelector(".branch-vertical"),l=(r=this.renderRoot.querySelector("bim-table-children"))==null?void 0:r.querySelector(".branch-vertical");o.style.setProperty("transform",`translateY(-50%) rotate(${this.childrenHidden?"0":"90"}deg)`),a.style.setProperty("transform",`scaleY(${this.childrenHidden?"0":"1"})`),l==null||l.style.setProperty("transform",`scaleY(${this.childrenHidden?"0":"1"})`)});return}const t=500,e=0,s=200,n=350;requestAnimationFrame(()=>{var r;const o=this.renderRoot.querySelector("bim-table-children"),a=this.renderRoot.querySelector(".caret"),l=this.renderRoot.querySelector(".branch-vertical"),c=(r=this.renderRoot.querySelector("bim-table-children"))==null?void 0:r.querySelector(".branch-vertical"),h=()=>{var f;const b=(f=o==null?void 0:o.renderRoot)==null?void 0:f.querySelectorAll("bim-table-group");b==null||b.forEach((g,y)=>{g.style.setProperty("opacity","0"),g.style.setProperty("left","-30px");const v=[{opacity:"0",left:"-30px"},{opacity:"1",left:"0"}];g.animate(v,{duration:t/2,delay:50+y*e,easing:"cubic-bezier(0.65, 0.05, 0.36, 1)",fill:"forwards"})})},d=()=>{const f=[{transform:"translateY(-50%) rotate(90deg)"},{transform:"translateY(-50%) rotate(0deg)"}];a==null||a.animate(f,{duration:n,easing:"cubic-bezier(0.68, -0.55, 0.27, 1.55)",fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})},u=()=>{const f=[{transform:"scaleY(1)"},{transform:"scaleY(0)"}];l==null||l.animate(f,{duration:s,easing:"cubic-bezier(0.4, 0, 0.2, 1)",delay:e,fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})},p=()=>{var f;const b=(f=this.renderRoot.querySelector("bim-table-row"))==null?void 0:f.querySelector(".branch-horizontal");if(b){b.style.setProperty("transform-origin","center right");const g=[{transform:"scaleX(0)"},{transform:"scaleX(1)"}];b.animate(g,{duration:s,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})}},m=()=>{const f=[{transform:"scaleY(0)"},{transform:"scaleY(1)"}];c==null||c.animate(f,{duration:s*1.2,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"forwards",delay:(e+s)*.7})};h(),d(),u(),p(),m()})}firstUpdated(){this.renderRoot.querySelectorAll(".caret").forEach(i=>{var t,e,s;if(!this.childrenHidden){i.style.setProperty("transform","translateY(-50%) rotate(90deg)");const n=(t=i.parentElement)==null?void 0:t.querySelector(".branch-horizontal");n&&n.style.setProperty("transform","scaleX(0)");const r=(s=(e=i.parentElement)==null?void 0:e.parentElement)==null?void 0:s.querySelectorAll(".branch-vertical");r==null||r.forEach(o=>{o.style.setProperty("transform","scaleY(1)")})}})}render(){if(!this.table)return F`${$t}`;const i=this.table.getGroupIndentation(this.data)??0;let t;if(!this.table.noIndentation){const r={left:`${i-1+(this.table.selectableRows?2.05:.5625)}rem`};t=F`<div style=${Ni(r)} class="branch branch-horizontal"></div>`}const e=F`
      ${this.table.noIndentation?null:F`
            <style>
              .branch-vertical {
                left: ${i+(this.table.selectableRows?1.9375:.5625)}rem;
              }
            </style>
            <div class="branch branch-vertical"></div>
          `}
    `;let s;if(!this.table.noIndentation){const r=document.createElementNS("http://www.w3.org/2000/svg","svg");if(r.setAttribute("height","9.9"),r.setAttribute("width","7.5"),r.setAttribute("viewBox","0 0 4.6666672 7.7"),this.table.noCarets){const a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx","2.3333336"),a.setAttribute("cy","3.85"),a.setAttribute("r","2.5"),r.append(a)}else{const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d","m 1.7470835,6.9583848 2.5899999,-2.59 c 0.39,-0.39 0.39,-1.02 0,-1.41 L 1.7470835,0.36838483 c -0.63,-0.62000003 -1.71000005,-0.18 -1.71000005,0.70999997 v 5.17 c 0,0.9 1.08000005,1.34 1.71000005,0.71 z"),r.append(a)}const o={left:`${(this.table.selectableRows?1.5:.125)+i}rem`,cursor:`${this.table.noCarets?"unset":"pointer"}`};s=F`<div @click=${a=>{var l;(l=this.table)!=null&&l.noCarets||(a.stopPropagation(),this.toggleChildren())}} style=${Ni(o)} class="caret">${r}</div>`}let n;return!this._isChildrenEmpty&&!this.childrenHidden&&(n=F`
        <bim-table-children ${Yt(r=>{if(!r)return;const o=r;o.table=this.table,o.group=this})}>${e}</bim-table-children>
      `),F`
      <div class="parent">
        <bim-table-row ${Yt(r=>{var o;if(!r)return;const a=r;a.table=this.table,a.group=this,(o=this.table)==null||o.dispatchEvent(new CustomEvent("rowcreated",{detail:{row:a}}))})}>
          ${sr(!this._isChildrenEmpty,()=>e)}
          ${sr(i!==0,()=>t)}
          ${sr(!this.table.noIndentation&&!this._isChildrenEmpty,()=>s)}
        </bim-table-row>
        ${n}
      </div>
    `}};zv.styles=At`
    :host {
      position: relative;
    }

    .parent {
      display: grid;
      grid-template-areas: "Data" "Children";
    }

    .branch {
      position: absolute;
      z-index: 1;
    }

    .branch-vertical {
      border-left: 1px dotted var(--bim-ui_bg-contrast-40);
      transform-origin: top center;
      transform: scaleY(0);
    }

    .branch-horizontal {
      top: 50%;
      width: 1rem;
      border-bottom: 1px dotted var(--bim-ui_bg-contrast-40);
    }

    .branch-horizontal {
      transform-origin: center left;
    }

    .caret {
      position: absolute;
      z-index: 2;
      transform: translateY(-50%) rotate(0deg);
      top: 50%;
      display: flex;
      width: 0.95rem;
      height: 0.95rem;
      justify-content: center;
      align-items: center;
    }

    .caret svg {
      fill: var(--bim-ui_bg-contrast-60);
    }
  `;let Lv=zv;hA([j({type:Boolean,attribute:"children-hidden",reflect:!0})],Lv.prototype,"childrenHidden");var dA=Object.defineProperty,Bc=(i,t,e,s)=>{for(var n=void 0,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&dA(t,e,n),n};const Rv=class extends St{constructor(){super(...arguments),this.selected=!1,this.group=null,this._data={},this.isHeader=!1,this.table=null,this.onTableColumnsChange=()=>{this.table&&this.requestUpdate()},this._intersecting=!1,this._timeOutDelay=250,this._observer=new IntersectionObserver(i=>{window.clearTimeout(this._intersectTimeout),this._intersectTimeout=void 0,i[0].isIntersecting?this._intersectTimeout=window.setTimeout(()=>{this._intersecting=!0},this._timeOutDelay):this._intersecting=!1},{rootMargin:"36px"}),this._onDataSelected=()=>{var i;this.toggleAttribute("selected",(i=this.table)==null?void 0:i.selection.has(this.data))},this._onDataDeselected=()=>{var i;(i=this.table)!=null&&i.selection.has(this.data)||this.removeAttribute("selected")},this._onDataSelectionCleared=()=>{this.removeAttribute("selected")},this.dataTransform=null,this._interval=null,this.clearDataTransform=()=>{this.dataTransform=null,this._interval!==null&&(clearInterval(this._interval),this._interval=null)}}get columns(){var i;return((i=this.table)==null?void 0:i.columns)??[]}get hiddenColumns(){var i;return((i=this.table)==null?void 0:i.hiddenColumns)??[]}get groupData(){var i;return(i=this.group)==null?void 0:i.data}get data(){var i;return((i=this.group)==null?void 0:i.data.data)??this._data}set data(i){this._data=i}get _columnNames(){return this.columns.filter(i=>!this.hiddenColumns.includes(i.name)).map(i=>i.name)}get _columnWidths(){return this.columns.filter(i=>!this.hiddenColumns.includes(i.name)).map(i=>i.width)}get _isSelected(){var i;return(i=this.table)==null?void 0:i.selection.has(this.data)}onSelectionChange(i){if(!this.table)return;const t=i.target;if(this.selected=t.value,t.value){let e=[this.data];this.isHeader&&(e=Wu.flattenData(this.table.data).map(s=>s.data)),this.table.selection.add(...e),this.isHeader&&this.table.dispatchEvent(new CustomEvent("rowselected",{detail:{data:this.data}}))}else this.isHeader?this.table.selection.clear():(this.table.selection.delete(this.data),this.table.dispatchEvent(new CustomEvent("rowdeselected",{detail:{data:this.data}})))}firstUpdated(i){super.firstUpdated(i),this._observer.observe(this)}connectedCallback(){super.connectedCallback(),this.table&&(this.table.addEventListener("dataselected",this._onDataSelected),this.table.addEventListener("datadeselected",this._onDataDeselected),this.table.addEventListener("dataselectioncleared",this._onDataSelectionCleared),this.toggleAttribute("selected",this._isSelected),this.table.addEventListener("columnschange",this.onTableColumnsChange))}disconnectedCallback(){var i,t,e;super.disconnectedCallback(),this._observer.unobserve(this),(i=this.table)==null||i.removeEventListener("dataselected",this._onDataSelected),(t=this.table)==null||t.removeEventListener("datadeselected",this._onDataDeselected),(e=this.table)==null||e.removeEventListener("dataselectioncleared",this._onDataSelectionCleared),this.data={},this.table=null}applyAdaptativeDataTransform(i){this.addEventListener("pointerenter",()=>{this.dataTransform=i,this._interval=window.setInterval(()=>{this.matches(":hover")||this.clearDataTransform()},50)})}render(){var i,t,e;if(!(this.table&&this._intersecting))return F`${$t}`;this.style.gridTemplateAreas=`"${this.table.selectableRows?"Selection":""} ${this._columnNames.join(" ")}"`,this.style.gridTemplateColumns=`${this.table.selectableRows?"1.6rem":""} ${this._columnWidths.join(" ")}`;const s=this.table.getRowIndentation(this.data)??0,n=[];let r=this.data;if((i=this.groupData)!=null&&i._isComputedGroup){const o=this.table.dataKeys.filter(a=>{var l;return!((l=this.table)!=null&&l.hiddenColumns.includes(a))});for(const a of o)this._columnNames.indexOf(a)!==0&&(r[a]="")}for(const o in r){if(!((t=this.groupData)!=null&&t._isComputedGroup)&&this.hiddenColumns.includes(o))continue;const a=document.createElement("bim-table-cell");a.group=this.group,a.table=this.table,a.row=this,a.column=o;const l=(e=this.group)!=null&&e.data._isComputedGroup&&this.table.groupedBy.includes(o)?0:this._columnNames.indexOf(o);l===0&&(a.style.marginLeft=`${this.table.noIndentation?0:s+.75}rem`),a.setAttribute("data-column-index",String(l)),a.toggleAttribute("data-no-indentation",l===0&&this.table.noIndentation),a.toggleAttribute("data-cell-header",this.isHeader),a.rowData=this.data,this.table.dispatchEvent(new CustomEvent("cellcreated",{detail:{cell:a}})),n.push(a)}return this._timeOutDelay=0,F`
      ${this.table.selectableRows?F`<bim-checkbox
            @change=${this.onSelectionChange}
            .checked=${this._isSelected??!1}
            style="align-self: center; justify-self: center"
          ></bim-checkbox>`:null}
      ${n}
      <slot></slot>
    `}};Rv.styles=At`
    :host {
      position: relative;
      grid-area: Data;
      display: grid;
      min-height: 2.25rem;
      transition: all 0.15s;
    }

    ::slotted(.branch.branch-vertical) {
      top: 50%;
      bottom: 0;
    }

    :host([selected]) {
      background-color: color-mix(
        in lab,
        var(--bim-ui_bg-contrast-20) 30%,
        var(--bim-ui_accent-base) 10%
      );
    }
  `;let _a=Rv;Bc([j({type:Boolean,reflect:!0})],_a.prototype,"selected");Bc([j({type:Boolean,attribute:"is-header",reflect:!0})],_a.prototype,"isHeader");Bc([us()],_a.prototype,"_intersecting");Bc([us()],_a.prototype,"dataTransform");var uA=Object.defineProperty,pA=Object.getOwnPropertyDescriptor,Ne=(i,t,e,s)=>{for(var n=s>1?void 0:s?pA(t,e):t,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=(s?o(t,e,n):o(n))||n);return s&&n&&uA(t,e,n),n},il;const Oe=(il=class extends St{constructor(){super(),this._value=[],this.headersHidden=!1,this.minColWidth="4rem",this._columns=[],this._textDelimiters={comma:",",tab:"	"},this._queryString=null,this._data=[],this.expanded=!1,this.preserveStructureOnFilter=!1,this.indentationInText=!1,this.dataTransform={},this.groupingTransform={},this.selectableRows=!1,this.selection=new wk,this.noIndentation=!1,this.noCarets=!1,this.loading=!1,this._groupedBy=[],this._errorLoading=!1,this._defaultVisibility=!0,this._visibilityExceptions=[],this.defaultContentTemplate=i=>F`<bim-label style="white-space: normal; user-select: text;">${i}</bim-label>`,this._stringFilterFunction=(i,t)=>Object.values(t.data).some(e=>String(e).toLowerCase().includes(i.toLowerCase())),this._queryFilterFunction=(i,t)=>{let e=!1;const s=Ld(i)??[];for(const n of s){if("queries"in n){e=!1;break}const{condition:r,value:o}=n;let{key:a}=n;if(a.startsWith("[")&&a.endsWith("]")){const l=a.replace("[","").replace("]","");a=l,e=Object.keys(t.data).filter(c=>c.includes(l)).map(c=>_m(t.data[c],r,o)).some(c=>c)}else e=_m(t.data[a],r,o);if(!e)break}return e},this.selection.onItemAdded.add(i=>this.emitDataSelected({data:i})),this.selection.onItemDeleted.add(i=>this.emitDataDeselected({data:i})),this.selection.onCleared.add(()=>this.emitDataCleared())}static flattenData(i){const t=[];for(const e of i)t.push({data:e.data}),e.children&&e.children.length>0&&t.push(...il.flattenData(e.children));return t}set columns(i){const t=[];for(const e of i){const s=typeof e=="string"?{name:e,width:`minmax(${this.minColWidth}, 1fr)`}:e;t.push(s)}this._columns=t,this.computeMissingColumns(this.data),this.dispatchEvent(new Event("columnschange"))}get columns(){return this._columns}get _headerRowData(){const i={};for(const t of this.columns){const{name:e}=t;i[e]=String(e)}return i}get value(){return this._value}set queryString(i){this.toggleAttribute("data-processing",!0),this._queryString=i&&i.trim()!==""?i.trim():null,this.updateValue(),this.toggleAttribute("data-processing",!1)}get queryString(){return this._queryString}set data(i){this._data=i,this.updateValue(),this.computeMissingColumns(i)&&(this.columns=this._columns)}get data(){return this._data}get dataAsync(){return new Promise(i=>{setTimeout(()=>{i(this.data)})})}set groupedBy(i){this._groupedBy=i,this.updateValue()}get groupedBy(){return this._groupedBy}set defaultVisibility(i){this._defaultVisibility=i}get defaultVisibility(){return this._defaultVisibility}set visibilityExceptions(i){this._visibilityExceptions=i}get visibilityExceptions(){return this._visibilityExceptions}set hiddenColumns(i){this.defaultVisibility=!0,this.visibilityExceptions=i}get hiddenColumns(){const i=this.dataKeys,t=[];for(const e of i){const s=this._visibilityExceptions.includes(e);(this._defaultVisibility?s:!s)&&t.push(e)}return t}set visibleColumns(i){this.defaultVisibility=!1,this.visibilityExceptions=i}get visibleColumns(){const i=this.dataKeys,t=[];for(const e of i){const s=this._visibilityExceptions.includes(e);(this._defaultVisibility?!s:s)&&t.push(e)}return t}emitDataSelected(i){this.dispatchEvent(new CustomEvent("dataselected",{detail:i}))}emitDataDeselected(i){this.dispatchEvent(new CustomEvent("datadeselected",{detail:i}))}emitDataCleared(){this.dispatchEvent(new Event("dataselectioncleared"))}filterData(i=this.data){let t=[];return this.queryString?(Ld(this.queryString)?(this.filterFunction=this._queryFilterFunction,t=this.filter(this.queryString,this.filterFunction,i)):(this.filterFunction=this._stringFilterFunction,t=this.filter(this.queryString,this.filterFunction,i)),this.preserveStructureOnFilter&&(this._expandedBeforeFilter===void 0&&(this._expandedBeforeFilter=this.expanded),this.expanded=!0)):(this.preserveStructureOnFilter&&this._expandedBeforeFilter!==void 0&&(this.expanded=this._expandedBeforeFilter,this._expandedBeforeFilter=void 0),t=i),t}computeMissingColumns(i){let t=!1;for(const e of i){const{children:s,data:n}=e;for(const r in n)this._columns.map(o=>typeof o=="string"?o:o.name).includes(r)||(this._columns.push({name:r,width:`minmax(${this.minColWidth}, 1fr)`}),t=!0);if(s){const r=this.computeMissingColumns(s);r&&!t&&(t=r)}}return t}generateText(i="comma",t=this.value,e="",s=!0){const n=this._textDelimiters[i];let r="";const o=this.columns.map(a=>a.name);if(s){this.indentationInText&&(r+=`Indentation${n}`);const a=`${o.join(n)}
`;r+=a}for(const[a,l]of t.entries()){const{data:c,children:h}=l,d=this.indentationInText?`${e}${a+1}${n}`:"",u=o.map(m=>c[m]??""),p=`${d}${u.join(n)}
`;r+=p,h&&(r+=this.generateText(i,l.children,`${e}${a+1}.`,!1))}return r}get csv(){return this.generateText("comma")}get tsv(){return this.generateText("tab")}get dataKeys(){const i=new Set,t=e=>{for(const s of e){for(const n in s.data)i.add(n);s.children&&t(s.children)}};return t(this.data),Array.from(i)}applyDataTransform(i){const t={};if(!i)return t;const{data:e}=i.data;for(const n of Object.keys(this.dataTransform)){const r=this.columns.find(o=>o.name===n);r&&r.forceDataTransform&&(n in e||(e[n]=""))}const s=e;for(const n in s){const r=this.dataTransform[n];r?t[n]=r(s[n],e,i):t[n]=e[n]}return t}downloadData(i="BIM Table Data",t="json"){let e=null;if(t==="json"&&(e=new File([JSON.stringify(this.value,void 0,2)],`${i}.json`)),t==="csv"&&(e=new File([this.csv],`${i}.csv`)),t==="tsv"&&(e=new File([this.tsv],`${i}.tsv`)),!e)return;const s=document.createElement("a");s.href=URL.createObjectURL(e),s.download=e.name,s.click(),URL.revokeObjectURL(s.href)}getRowIndentation(i,t=this.value,e=0){for(const s of t){if(s.data===i)return e;if(s.children){const n=this.getRowIndentation(i,s.children,e+1);if(n!==null)return n}}return null}getGroupIndentation(i,t=this.value,e=0){for(const s of t){if(s===i)return e;if(s.children){const n=this.getGroupIndentation(i,s.children,e+1);if(n!==null)return n}}return null}connectedCallback(){super.connectedCallback(),this.dispatchEvent(new Event("connected"))}disconnectedCallback(){super.disconnectedCallback(),this.dispatchEvent(new Event("disconnected"))}async loadData(i=!1){if(this._value.length!==0&&!i||!this.loadFunction)return!1;this.loading=!0;try{const t=await this.loadFunction();return this.data=t,this.loading=!1,this._errorLoading=!1,!0}catch(t){if(this.loading=!1,this._value.length!==0)return!1;const e=this.querySelector("[slot='error-loading']"),s=e==null?void 0:e.querySelector("[data-table-element='error-message']");return t instanceof Error&&s&&t.message.trim()!==""&&(s.textContent=t.message),this._errorLoading=!0,!1}}groupData(i=this.data){return Jk(i,this.groupedBy,this.groupingTransform)}updateValue(){const i=this.filterData(),t=this.groupData(i);this._value=t}filter(i,t=this.filterFunction??this._stringFilterFunction,e=this.data){const s=[];for(const n of e)if(t(i,n)){if(this.preserveStructureOnFilter){const r={data:n.data};if(n.children){const o=this.filter(i,t,n.children);o.length&&(r.children=o)}s.push(r)}else if(s.push({data:n.data}),n.children){const r=this.filter(i,t,n.children);s.push(...r)}}else if(n.children){const r=this.filter(i,t,n.children);this.preserveStructureOnFilter&&r.length?s.push({data:n.data,children:r}):s.push(...r)}return s}get _missingDataElement(){return this.querySelector("[slot='missing-data']")}getGroupingMessageTemplate(){if(this.groupedBy.length===0)return $t;const i=this.groupedBy.join(" → ");return F`
      <bim-label part="grouping-message" style="
        background-color: var(--bim-ui_bg-contrast-10);
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
        padding: 0.5rem 0.75rem;
        font-weight: 500;
        display: block;
      ">
        Grouped By: ${i}
      </bim-label>
    `}render(){if(this.loading)return nA();if(this._errorLoading)return F`<slot name="error-loading"></slot>`;if(this._value.length===0&&this._missingDataElement)return F`<slot name="missing-data"></slot>`;const i=e=>{if(!e)return;const s=e;s.table=this,s.data=this._headerRowData,s.requestUpdate()},t=e=>{if(!e)return;const s=e;s.table=this,s.data=this.value,s.requestUpdate()};return F`
      <div class="parent">
        ${rA()}
        <div style="
          grid-area: Header;
          position: sticky;
          top: 0;
          z-index: 5;
        ">
          ${sr(!this.headersHidden,()=>F`<bim-table-row is-header style="background-color: var(--bim-ui_bg-contrast-20);" ${Yt(i)}></bim-table-row>`)}
          ${this.getGroupingMessageTemplate()}
        </div>
        <div style="overflow-x: hidden; grid-area: Body">
          <bim-table-children ${Yt(t)} style="grid-area: Body; background-color: transparent"></bim-table-children>
        </div>
      </div>
    `}},il.styles=[Gs.scrollbar,At`
      :host {
        position: relative;
        overflow: auto;
        display: block;
        pointer-events: auto;
      }

      :host(:not([data-processing])) .loader {
        display: none;
      }

      .parent {
        display: grid;
        grid-template:
          "Header" auto
          "Processing" auto
          "Body" 1fr
          "Footer" auto;
        overflow: auto;
        height: 100%;
      }

      .parent > bim-table-row[is-header] {
        color: var(--bim-table_header--c, var(--bim-ui_bg-contrast-100));
        background-color: var(
          --bim-table_header--bgc,
          var(--bim-ui_bg-contrast-20)
        );
      }

      .controls {
        display: flex;
        gap: 0.375rem;
        flex-wrap: wrap;
        margin-bottom: 0.5rem;
      }
    `],il);Ne([us()],Oe.prototype,"_value",2);Ne([j({type:Boolean,attribute:"headers-hidden",reflect:!0})],Oe.prototype,"headersHidden",2);Ne([j({type:String,attribute:"min-col-width",reflect:!0})],Oe.prototype,"minColWidth",2);Ne([j({type:Array,attribute:!1})],Oe.prototype,"columns",1);Ne([j({type:Array,attribute:!1})],Oe.prototype,"data",1);Ne([j({type:Boolean,reflect:!0})],Oe.prototype,"expanded",2);Ne([j({attribute:!1})],Oe.prototype,"groupingTransform",2);Ne([j({type:Boolean,reflect:!0,attribute:"selectable-rows"})],Oe.prototype,"selectableRows",2);Ne([j({type:Boolean,attribute:"no-indentation",reflect:!0})],Oe.prototype,"noIndentation",2);Ne([j({type:Boolean,attribute:"no-carets",reflect:!0})],Oe.prototype,"noCarets",2);Ne([j({type:Boolean,reflect:!0})],Oe.prototype,"loading",2);Ne([j({type:String,attribute:"grouped-by",reflect:!0,converter:{toAttribute:i=>Array.isArray(i)&&i.length>0?i.join(","):null,fromAttribute:i=>i&&i.trim()!==""?i.split(",").map(t=>t.trim()):[]}})],Oe.prototype,"groupedBy",1);Ne([us()],Oe.prototype,"_errorLoading",2);Ne([j({type:Boolean,attribute:"columns-hidden",reflect:!0,converter:{toAttribute:i=>i?null:"",fromAttribute:i=>i===null}})],Oe.prototype,"defaultVisibility",1);Ne([j({type:String,attribute:"visibility-exceptions",reflect:!0,converter:{toAttribute:i=>Array.isArray(i)&&i.length>0?i.join(","):null,fromAttribute:i=>i&&i.trim()!==""?i.split(",").map(t=>t.trim()):[]}})],Oe.prototype,"visibilityExceptions",1);let Wu=Oe;var fA=Object.defineProperty,mA=Object.getOwnPropertyDescriptor,$r=(i,t,e,s)=>{for(var n=s>1?void 0:s?mA(t,e):t,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=(s?o(t,e,n):o(n))||n);return s&&n&&fA(t,e,n),n};const Bv=class extends St{constructor(){super(...arguments),this._switchers=[],this.bottom=!1,this.switchersHidden=!1,this.floating=!1,this.switchersFull=!1,this.onTabHiddenChange=i=>{const t=i.target;t instanceof Ze&&!t.hidden&&(t.removeEventListener("hiddenchange",this.onTabHiddenChange),this.tab=t.name,t.addEventListener("hiddenchange",this.onTabHiddenChange))}}set tab(i){this._tab=i;const t=[...this.children],e=t.find(s=>s instanceof Ze&&s.name===i);for(const s of t){if(!(s instanceof Ze))continue;s.hidden=e!==s;const n=this.getTabSwitcher(s.name);n&&n.toggleAttribute("data-active",!s.hidden)}e||(this._tab="hidden",this.setAttribute("tab","hidden"))}get tab(){return this._tab}getTabSwitcher(i){return this._switchers.find(t=>t.getAttribute("data-name")===i)}createSwitchers(){this._switchers=[];for(const i of this.children){if(!(i instanceof Ze))continue;const t=document.createElement("div");t.addEventListener("click",()=>{this.tab===i.name?this.toggleAttribute("tab",!1):this.tab=i.name,this.setAnimatedBackgound()}),t.setAttribute("data-name",i.name),t.className="switcher";const e=document.createElement("bim-label");e.textContent=i.label??null,e.icon=i.icon,t.append(e),this._switchers.push(t)}}updateSwitchers(){for(const i of this.children){if(!(i instanceof Ze))continue;const t=this._switchers.find(s=>s.getAttribute("data-name")===i.name);if(!t)continue;const e=t.querySelector("bim-label");e&&(e.textContent=i.label??null,e.icon=i.icon)}}onSlotChange(i){this.createSwitchers();const t=i.target.assignedElements(),e=t.find(s=>s instanceof Ze?this.tab?s.name===this.tab:!s.hidden:!1);e&&e instanceof Ze&&(this.tab=e.name);for(const s of t){if(!(s instanceof Ze)){s.remove();continue}s.removeEventListener("hiddenchange",this.onTabHiddenChange),e!==s&&(s.hidden=!0),s.addEventListener("hiddenchange",this.onTabHiddenChange)}}doubleRequestAnimationFrames(i){requestAnimationFrame(()=>requestAnimationFrame(i))}setAnimatedBackgound(i=!1){var t;const e=this.renderRoot.querySelector(".animated-background"),s=[...((t=this.renderRoot.querySelector(".switchers"))==null?void 0:t.querySelectorAll(".switcher"))||[]].filter(n=>n.hasAttribute("data-active"))[0];requestAnimationFrame(()=>{var n,r,o,a;const l=(a=(o=(r=(n=s==null?void 0:s.parentElement)==null?void 0:n.shadowRoot)==null?void 0:r.querySelector("bim-input"))==null?void 0:o.shadowRoot)==null?void 0:a.querySelector(".input"),c={width:s==null?void 0:s.clientWidth,height:s==null?void 0:s.clientHeight,top:((s==null?void 0:s.offsetTop)??0)-((l==null?void 0:l.offsetTop)??0),left:((s==null?void 0:s.offsetLeft)??0)-((l==null?void 0:l.offsetLeft)??0)};s?(e==null||e.style.setProperty("width",`${c.width}px`),e==null||e.style.setProperty("height",`${c.height}px`),e==null||e.style.setProperty("left",`${c.left}px`)):e==null||e.style.setProperty("width","0"),this.bottom?(e==null||e.style.setProperty("top","100%"),e==null||e.style.setProperty("transform","translateY(-100%)")):e==null||e.style.setProperty("top",`${c.top}px`)}),i&&this.doubleRequestAnimationFrames(()=>{const n="ease";e==null||e.style.setProperty("transition",`width ${.3}s ${n}, height ${.3}s ${n}, top ${.3}s ${n}, left ${.3}s ${n}`)})}firstUpdated(){requestAnimationFrame(()=>{this.setAnimatedBackgound(!0)}),new ResizeObserver(()=>{this.setAnimatedBackgound()}).observe(this)}render(){return F`
      <div class="parent">
        <div class="switchers">
          <div class="animated-background"></div>
          ${this._switchers}
        </div>
        <div class="content">
          <slot @slotchange=${this.onSlotChange}></slot>
        </div>
      </div>
    `}};Bv.styles=[Gs.scrollbar,At`
      * {
        box-sizing: border-box;
      }

      :host {
        background-color: var(--bim-ui_bg-base);
        display: block;
        overflow: auto;
      }

      .parent {
        display: grid;
        overflow: hidden;
        position: relative;
        grid-template: "switchers" auto "content" 1fr;
        height: 100%;
      }

      :host([bottom]) .parent {
        grid-template: "content" 1fr "switchers" auto;
      }

      .switchers {
        position: relative;
        display: flex;
        flex-wrap: wrap;
        min-height: 2.25rem;
        font-weight: 600;
        grid-area: switchers;
      }

      .switcher {
        --bim-label--c: var(--bim-ui_bg-contrast-80);
        background-color: transparent;
        position: relative;
        cursor: pointer;
        pointer-events: auto;
        padding: 0rem 0.75rem;
        display: flex;
        justify-content: center;
        z-index: 2;
        transition: all 0.15s;
        min-height: 2.25rem;
        min-width: 10rem;
      }

      .switcher:not([data-active]):hover {
        filter: brightness(150%);
      }

      :host([switchers-full]) .switcher {
        flex: 1;
      }

      .switcher[data-active] {
        --bim-label--c: var(--bim-ui_main-contrast);
      }

      .switchers bim-label {
        pointer-events: none;
      }

      :host([switchers-hidden]) .switchers {
        display: none;
      }

      .content {
        position: relative;
        display: grid;
        grid-template-columns: 1fr;
        grid-area: content;
        max-height: 100vh;
        overflow: auto;
        transition: max-height 0.2s;
      }

      :host([tab="hidden"]) .content {
        max-height: 0;
      }

      .animated-background {
        position: absolute;
        background: var(--bim-ui_main-base);
        width: 0;
        height: 0;
        top: 0;
        left: 0;
      }

      :host(:not([bottom])) .content {
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([bottom]) .content {
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating]) {
        background-color: transparent;
      }

      :host([floating]) .switchers {
        justify-self: center;
        overflow: hidden;
        background-color: var(--bim-ui_bg-base);
      }

      :host([floating]:not([bottom])) .switchers {
        border-radius: var(--bim-ui_size-2xs) var(--bim-ui_size-2xs) 0 0;
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
        border-left: 1px solid var(--bim-ui_bg-contrast-20);
        border-right: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][bottom]) .switchers {
        border-radius: 0 0 var(--bim-ui_size-2xs) var(--bim-ui_size-2xs);
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
        border-left: 1px solid var(--bim-ui_bg-contrast-20);
        border-right: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][tab="hidden"]) .switchers {
        border-radius: var(--bim-ui_size-2xs);
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][bottom][tab="hidden"]) .switchers {
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating]) .content {
        border: 1px solid var(--bim-ui_bg-contrast-20);
        border-radius: var(--bim-ui_size-2xs);
        background-color: var(--bim-ui_bg-base);
      }
    `];let ls=Bv;$r([us()],ls.prototype,"_switchers",2);$r([j({type:Boolean,reflect:!0})],ls.prototype,"bottom",2);$r([j({type:Boolean,attribute:"switchers-hidden",reflect:!0})],ls.prototype,"switchersHidden",2);$r([j({type:Boolean,reflect:!0})],ls.prototype,"floating",2);$r([j({type:String,reflect:!0})],ls.prototype,"tab",1);$r([j({type:Boolean,attribute:"switchers-full",reflect:!0})],ls.prototype,"switchersFull",2);var gA=Object.defineProperty,bA=Object.getOwnPropertyDescriptor,Nc=(i,t,e,s)=>{for(var n=s>1?void 0:s?bA(t,e):t,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=(s?o(t,e,n):o(n))||n);return s&&n&&gA(t,e,n),n};const Nv=class extends St{constructor(){super(...arguments),this._defaultName="__unnamed__",this.name=this._defaultName,this._hidden=!1}set label(i){this._label=i;const t=this.parentElement;t instanceof ls&&t.updateSwitchers()}get label(){return this._label}set icon(i){this._icon=i;const t=this.parentElement;t instanceof ls&&t.updateSwitchers()}get icon(){return this._icon}set hidden(i){this._hidden=i,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}connectedCallback(){super.connectedCallback();const{parentElement:i}=this;if(i&&this.name===this._defaultName){const t=[...i.children].indexOf(this);this.name=`${this._defaultName}${t}`}}render(){return F` <slot></slot> `}};Nv.styles=At`
    :host {
      display: block;
      height: 100%;
      grid-row-start: 1;
      grid-column-start: 1;
      animation: openAnim 3s forwards;
      transform: translateY(0);
      max-height: 100vh;
      transition:
        opacity 0.3s ease,
        max-height 0.6s ease,
        transform 0.3s ease;
    }

    :host([hidden]) {
      transform: translateY(-20px);
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      visibility: hidden;
    }
  `;let Ze=Nv;Nc([j({type:String,reflect:!0})],Ze.prototype,"name",2);Nc([j({type:String,reflect:!0})],Ze.prototype,"label",1);Nc([j({type:String,reflect:!0})],Ze.prototype,"icon",1);Nc([j({type:Boolean,reflect:!0})],Ze.prototype,"hidden",1);var yA=Object.defineProperty,vA=Object.getOwnPropertyDescriptor,ki=(i,t,e,s)=>{for(var n=s>1?void 0:s?vA(t,e):t,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=(s?o(t,e,n):o(n))||n);return s&&n&&yA(t,e,n),n};const Fv=class extends St{constructor(){super(...arguments),this._inputTypes=["date","datetime-local","email","month","password","search","tel","text","time","url","week","area"],this.value="",this.vertical=!1,this.disabled=!1,this.resize="vertical",this._type="text",this.onValueChange=new Event("input")}set type(i){this._inputTypes.includes(i)&&(this._type=i)}get type(){return this._type}get query(){return Ld(this.value)}onInputChange(i){i.stopPropagation();const t=i.target;clearTimeout(this._debounceTimeoutID),this._debounceTimeoutID=setTimeout(()=>{this.value=t.value,this.dispatchEvent(this.onValueChange)},this.debounce)}focus(){setTimeout(()=>{var i;const t=(i=this.shadowRoot)==null?void 0:i.querySelector("input");t==null||t.focus()})}render(){return F`
      <bim-input
        .name=${this.name}
        .icon=${this.icon}
        .label=${this.label}
        .vertical=${this.vertical}
      >
        ${this.type==="area"?F` <textarea
              aria-label=${this.label||this.name||"Text Input"}
              .value=${this.value}
              .rows=${this.rows??5}
              ?disabled=${this.disabled}
              placeholder=${Bd(this.placeholder)}
              @input=${this.onInputChange}
              style="resize: ${this.resize};"
            ></textarea>`:F` <input
              aria-label=${this.label||this.name||"Text Input"}
              .type=${this.type}
              .value=${this.value}
              ?disabled=${this.disabled}
              placeholder=${Bd(this.placeholder)}
              @input=${this.onInputChange}
            />`}
      </bim-input>
    `}};Fv.styles=[Gs.scrollbar,At`
      :host {
        --bim-input--bgc: var(--bim-ui_bg-contrast-20);
        flex: 1;
        display: block;
      }

      input,
      textarea {
        font-family: inherit;
        background-color: transparent;
        border: none;
        width: 100%;
        padding: var(--bim-ui_size-3xs);
        color: var(--bim-text-input--c, var(--bim-ui_bg-contrast-100));
      }

      input {
        outline: none;
        height: 100%;
        padding: 0 var(--bim-ui_size-3xs); /* Override padding */
        border-radius: var(--bim-text-input--bdrs, var(--bim-ui_size-4xs));
      }

      :host([disabled]) input,
      :host([disabled]) textarea {
        color: var(--bim-ui_bg-contrast-60);
      }

      textarea {
        line-height: 1.1rem;
        outline: none;
      }

      :host(:focus) {
        --bim-input--olc: var(--bim-ui_accent-base);
      }

      /* :host([disabled]) {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
    } */
    `];let qe=Fv;ki([j({type:String,reflect:!0})],qe.prototype,"icon",2);ki([j({type:String,reflect:!0})],qe.prototype,"label",2);ki([j({type:String,reflect:!0})],qe.prototype,"name",2);ki([j({type:String,reflect:!0})],qe.prototype,"placeholder",2);ki([j({type:String,reflect:!0})],qe.prototype,"value",2);ki([j({type:Boolean,reflect:!0})],qe.prototype,"vertical",2);ki([j({type:Number,reflect:!0})],qe.prototype,"debounce",2);ki([j({type:Number,reflect:!0})],qe.prototype,"rows",2);ki([j({type:Boolean,reflect:!0})],qe.prototype,"disabled",2);ki([j({type:String,reflect:!0})],qe.prototype,"resize",2);ki([j({type:String,reflect:!0})],qe.prototype,"type",1);var _A=Object.defineProperty,wA=Object.getOwnPropertyDescriptor,Uv=(i,t,e,s)=>{for(var n=s>1?void 0:s?wA(t,e):t,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=(s?o(t,e,n):o(n))||n);return s&&n&&_A(t,e,n),n};const jv=class extends St{constructor(){super(...arguments),this.rows=2,this._vertical=!1}set vertical(i){this._vertical=i,this.updateChildren()}get vertical(){return this._vertical}updateChildren(){const i=this.children;for(const t of i)this.vertical?t.setAttribute("label-hidden",""):t.removeAttribute("label-hidden")}render(){return F`
      <style>
        .parent {
          grid-auto-flow: ${this.vertical?"row":"column"};
          grid-template-rows: repeat(${this.rows}, 1fr);
        }
      </style>
      <div class="parent">
        <slot @slotchange=${this.updateChildren}></slot>
      </div>
    `}};jv.styles=At`
    .parent {
      display: grid;
      gap: 0.25rem;
    }

    ::slotted(bim-button[label]:not([vertical])) {
      --bim-button--jc: flex-start;
    }

    ::slotted(bim-button) {
      --bim-label--c: var(--bim-ui_bg-contrast-80);
    }
  `;let Fc=jv;Uv([j({type:Number,reflect:!0})],Fc.prototype,"rows",2);Uv([j({type:Boolean,reflect:!0})],Fc.prototype,"vertical",1);var xA=Object.defineProperty,CA=Object.getOwnPropertyDescriptor,Uc=(i,t,e,s)=>{for(var n=s>1?void 0:s?CA(t,e):t,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=(s?o(t,e,n):o(n))||n);return s&&n&&xA(t,e,n),n};const Vv=class extends St{constructor(){super(...arguments),this._vertical=!1,this._labelHidden=!1}set vertical(i){this._vertical=i,this.updateChildren()}get vertical(){return this._vertical}set labelHidden(i){this._labelHidden=i,this.updateChildren()}get labelHidden(){return this._labelHidden}updateChildren(){const i=this.children;for(const t of i)t instanceof Fc&&(t.vertical=this.vertical),t.toggleAttribute("label-hidden",this.vertical)}render(){return F`
      <div class="parent">
        <div class="children">
          <slot @slotchange=${this.updateChildren}></slot>
        </div>
        ${!this.labelHidden&&(this.label||this.icon)?F`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
      </div>
    `}};Vv.styles=At`
    :host {
      --bim-label--fz: var(--bim-ui_size-xs);
      --bim-label--c: var(--bim-ui_bg-contrast-60);
      display: block;
      flex: 1;
    }

    :host(:not([vertical])) ::slotted(bim-button[vertical]) {
      --bim-icon--fz: var(--bim-ui_size-5xl);
      min-height: 3.75rem;
    }

    .parent {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      align-items: center;
      padding: 0.5rem;
      height: 100%;
      box-sizing: border-box;
      justify-content: space-between;
    }

    :host([vertical]) .parent {
      flex-direction: row-reverse;
    }

    :host([vertical]) .parent > bim-label {
      writing-mode: tb;
    }

    .children {
      display: flex;
      gap: 0.25rem;
    }

    :host([vertical]) .children {
      flex-direction: column;
    }
  `;let Or=Vv;Uc([j({type:String,reflect:!0})],Or.prototype,"label",2);Uc([j({type:String,reflect:!0})],Or.prototype,"icon",2);Uc([j({type:Boolean,reflect:!0})],Or.prototype,"vertical",1);Uc([j({type:Boolean,attribute:"label-hidden",reflect:!0})],Or.prototype,"labelHidden",1);var SA=Object.defineProperty,EA=Object.getOwnPropertyDescriptor,qu=(i,t,e,s)=>{for(var n=s>1?void 0:s?EA(t,e):t,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=(s?o(t,e,n):o(n))||n);return s&&n&&SA(t,e,n),n};const Hv=class extends St{constructor(){super(...arguments),this.labelsHidden=!1,this._vertical=!1,this._hidden=!1}set vertical(i){this._vertical=i,this.updateSections()}get vertical(){return this._vertical}set hidden(i){this._hidden=i,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}updateSections(){const i=this.children;for(const t of i)t instanceof Or&&(t.labelHidden=this.vertical&&!we.config.sectionLabelOnVerticalToolbar,t.vertical=this.vertical)}render(){return F`
      <div class="parent">
        <slot @slotchange=${this.updateSections}></slot>
      </div>
    `}};Hv.styles=At`
    :host {
      --bim-button--bgc: transparent;
      background-color: var(--bim-ui_bg-base);
      border-radius: var(--bim-ui_size-2xs);
      display: block;
    }

    :host([hidden]) {
      display: none;
    }

    .parent {
      display: flex;
      width: max-content;
      pointer-events: auto;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    :host([vertical]) {
      width: min-content;
      border-radius: var(--bim-ui_size-2xs);
      border: 1px solid var(--bim-ui_bg-contrast-20);
    }

    ::slotted(bim-toolbar-section:not(:last-child)) {
      border-right: 1px solid var(--bim-ui_bg-contrast-20);
      border-bottom: none;
    }

    :host([vertical]) ::slotted(bim-toolbar-section:not(:last-child)) {
      border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      border-right: none;
    }
  `;let jc=Hv;qu([j({type:String,reflect:!0})],jc.prototype,"icon",2);qu([j({type:Boolean,attribute:"labels-hidden",reflect:!0})],jc.prototype,"labelsHidden",2);qu([j({type:Boolean,reflect:!0})],jc.prototype,"vertical",1);var kA=Object.defineProperty,AA=(i,t,e,s)=>{for(var n=void 0,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&kA(t,e,n),n};const Wv=class extends St{constructor(){super(),this._onResize=new Event("resize"),new ResizeObserver(()=>{setTimeout(()=>{this.dispatchEvent(this._onResize)})}).observe(this)}render(){return F`
      <div class="parent">
        <slot></slot>
      </div>
    `}};Wv.styles=At`
    :host {
      display: grid;
      min-width: 0;
      min-height: 0;
      height: 100%;
    }

    .parent {
      overflow: hidden;
      position: relative;
    }
  `;let qv=Wv;AA([j({type:String,reflect:!0})],qv.prototype,"name");var TA=Object.defineProperty,MA=(i,t,e,s)=>{for(var n=void 0,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&TA(t,e,n),n};const Yv=class extends St{constructor(){super(...arguments),this.charts=[],this._charts=[],this.labels=[]}willUpdate(i){const t=[];this.charts&&t.push(...this.charts),this._charts=[...new Set(t)]}_getLabelColorMap(i){const t={};return i.colors&&this.labels.forEach((e,s)=>{t[e]=i.colors[s%i.colors.length]}),t}_getHideEventData(){var i;const t={};for(const e in this.labels){const s=this.labels[e],n=[];for(const r of Object.values(this._charts[0].inputData.datasets))n.push((i=r[e])==null?void 0:i.data);t[s]=n}return t}render(){if(this._charts.length===0||!this._charts[0].data)return F`<slot name="no-chart"></slot>`;const i=this._charts[0];this.labels=i.inputData.labels;const t=this._getLabelColorMap(i),e=this._getHideEventData();return this.labels.length===0?F`<slot name="missing-data"></slot>`:F`
      <div class="parent">
        ${this.labels.map(s=>F`
            <div style="display: flex; gap: 0.25rem; align-items: center;">
              <span
                style="
                display: inline-block;
                width: 0.6rem;
                height: 0.6rem;
                border-radius: 50%;
                background: ${t[s]??"gray"};
              "
                aria-hidden="true"
              ></span>
              <bim-label
                @click=${n=>{const r=n.currentTarget,o=r.style.textDecoration==="line-through";r.style.textDecoration=o?"none":"line-through";const a=e[s];this.dispatchEvent(new CustomEvent("label-click",{detail:{label:s,data:a,visibility:o}}));for(const l of this._charts)l.filterByLabel(s)}}
              >
                ${s}
              </bim-label>
            </div>
          `)}
      </div>
    `}};Yv.styles=At`
    :host {
      display: block;
      box-sizing: border-box;
      padding: 0.5rem;
    }

    .parent {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
      /* height: 100%;
      width: 100%; */
    }
  `;let Zv=Yv;MA([j({type:Array,attribute:!1,hasChanged:()=>!0})],Zv.prototype,"charts");/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function wa(i){return i+.5|0}const ks=(i,t,e)=>Math.max(Math.min(i,e),t);function mo(i){return ks(wa(i*2.55),0,255)}function zs(i){return ks(wa(i*255),0,255)}function Xi(i){return ks(wa(i/2.55)/100,0,1)}function wm(i){return ks(wa(i*100),0,100)}const ri={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Nd=[..."0123456789ABCDEF"],PA=i=>Nd[i&15],$A=i=>Nd[(i&240)>>4]+Nd[i&15],sl=i=>(i&240)>>4===(i&15),OA=i=>sl(i.r)&&sl(i.g)&&sl(i.b)&&sl(i.a);function DA(i){var t=i.length,e;return i[0]==="#"&&(t===4||t===5?e={r:255&ri[i[1]]*17,g:255&ri[i[2]]*17,b:255&ri[i[3]]*17,a:t===5?ri[i[4]]*17:255}:(t===7||t===9)&&(e={r:ri[i[1]]<<4|ri[i[2]],g:ri[i[3]]<<4|ri[i[4]],b:ri[i[5]]<<4|ri[i[6]],a:t===9?ri[i[7]]<<4|ri[i[8]]:255})),e}const IA=(i,t)=>i<255?t(i):"";function zA(i){var t=OA(i)?PA:$A;return i?"#"+t(i.r)+t(i.g)+t(i.b)+IA(i.a,t):void 0}const LA=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Gv(i,t,e){const s=t*Math.min(e,1-e),n=(r,o=(r+i/30)%12)=>e-s*Math.max(Math.min(o-3,9-o,1),-1);return[n(0),n(8),n(4)]}function RA(i,t,e){const s=(n,r=(n+i/60)%6)=>e-e*t*Math.max(Math.min(r,4-r,1),0);return[s(5),s(3),s(1)]}function BA(i,t,e){const s=Gv(i,1,.5);let n;for(t+e>1&&(n=1/(t+e),t*=n,e*=n),n=0;n<3;n++)s[n]*=1-t-e,s[n]+=t;return s}function NA(i,t,e,s,n){return i===n?(t-e)/s+(t<e?6:0):t===n?(e-i)/s+2:(i-t)/s+4}function Yu(i){const t=i.r/255,e=i.g/255,s=i.b/255,n=Math.max(t,e,s),r=Math.min(t,e,s),o=(n+r)/2;let a,l,c;return n!==r&&(c=n-r,l=o>.5?c/(2-n-r):c/(n+r),a=NA(t,e,s,c,n),a=a*60+.5),[a|0,l||0,o]}function Zu(i,t,e,s){return(Array.isArray(t)?i(t[0],t[1],t[2]):i(t,e,s)).map(zs)}function Gu(i,t,e){return Zu(Gv,i,t,e)}function FA(i,t,e){return Zu(BA,i,t,e)}function UA(i,t,e){return Zu(RA,i,t,e)}function Xv(i){return(i%360+360)%360}function jA(i){const t=LA.exec(i);let e=255,s;if(!t)return;t[5]!==s&&(e=t[6]?mo(+t[5]):zs(+t[5]));const n=Xv(+t[2]),r=+t[3]/100,o=+t[4]/100;return t[1]==="hwb"?s=FA(n,r,o):t[1]==="hsv"?s=UA(n,r,o):s=Gu(n,r,o),{r:s[0],g:s[1],b:s[2],a:e}}function VA(i,t){var e=Yu(i);e[0]=Xv(e[0]+t),e=Gu(e),i.r=e[0],i.g=e[1],i.b=e[2]}function HA(i){if(!i)return;const t=Yu(i),e=t[0],s=wm(t[1]),n=wm(t[2]);return i.a<255?`hsla(${e}, ${s}%, ${n}%, ${Xi(i.a)})`:`hsl(${e}, ${s}%, ${n}%)`}const xm={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Cm={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function WA(){const i={},t=Object.keys(Cm),e=Object.keys(xm);let s,n,r,o,a;for(s=0;s<t.length;s++){for(o=a=t[s],n=0;n<e.length;n++)r=e[n],a=a.replace(r,xm[r]);r=parseInt(Cm[o],16),i[a]=[r>>16&255,r>>8&255,r&255]}return i}let nl;function qA(i){nl||(nl=WA(),nl.transparent=[0,0,0,0]);const t=nl[i.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const YA=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function ZA(i){const t=YA.exec(i);let e=255,s,n,r;if(t){if(t[7]!==s){const o=+t[7];e=t[8]?mo(o):ks(o*255,0,255)}return s=+t[1],n=+t[3],r=+t[5],s=255&(t[2]?mo(s):ks(s,0,255)),n=255&(t[4]?mo(n):ks(n,0,255)),r=255&(t[6]?mo(r):ks(r,0,255)),{r:s,g:n,b:r,a:e}}}function GA(i){return i&&(i.a<255?`rgba(${i.r}, ${i.g}, ${i.b}, ${Xi(i.a)})`:`rgb(${i.r}, ${i.g}, ${i.b})`)}const Ih=i=>i<=.0031308?i*12.92:Math.pow(i,1/2.4)*1.055-.055,Yn=i=>i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4);function XA(i,t,e){const s=Yn(Xi(i.r)),n=Yn(Xi(i.g)),r=Yn(Xi(i.b));return{r:zs(Ih(s+e*(Yn(Xi(t.r))-s))),g:zs(Ih(n+e*(Yn(Xi(t.g))-n))),b:zs(Ih(r+e*(Yn(Xi(t.b))-r))),a:i.a+e*(t.a-i.a)}}function rl(i,t,e){if(i){let s=Yu(i);s[t]=Math.max(0,Math.min(s[t]+s[t]*e,t===0?360:1)),s=Gu(s),i.r=s[0],i.g=s[1],i.b=s[2]}}function Kv(i,t){return i&&Object.assign(t||{},i)}function Sm(i){var t={r:0,g:0,b:0,a:255};return Array.isArray(i)?i.length>=3&&(t={r:i[0],g:i[1],b:i[2],a:255},i.length>3&&(t.a=zs(i[3]))):(t=Kv(i,{r:0,g:0,b:0,a:1}),t.a=zs(t.a)),t}function KA(i){return i.charAt(0)==="r"?ZA(i):jA(i)}class yr{constructor(t){if(t instanceof yr)return t;const e=typeof t;let s;e==="object"?s=Sm(t):e==="string"&&(s=DA(t)||qA(t)||KA(t)),this._rgb=s,this._valid=!!s}get valid(){return this._valid}get rgb(){var t=Kv(this._rgb);return t&&(t.a=Xi(t.a)),t}set rgb(t){this._rgb=Sm(t)}rgbString(){return this._valid?GA(this._rgb):void 0}hexString(){return this._valid?zA(this._rgb):void 0}hslString(){return this._valid?HA(this._rgb):void 0}mix(t,e){if(t){const s=this.rgb,n=t.rgb;let r;const o=e===r?.5:e,a=2*o-1,l=s.a-n.a,c=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;r=1-c,s.r=255&c*s.r+r*n.r+.5,s.g=255&c*s.g+r*n.g+.5,s.b=255&c*s.b+r*n.b+.5,s.a=o*s.a+(1-o)*n.a,this.rgb=s}return this}interpolate(t,e){return t&&(this._rgb=XA(this._rgb,t._rgb,e)),this}clone(){return new yr(this.rgb)}alpha(t){return this._rgb.a=zs(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=wa(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return rl(this._rgb,2,t),this}darken(t){return rl(this._rgb,2,-t),this}saturate(t){return rl(this._rgb,1,t),this}desaturate(t){return rl(this._rgb,1,-t),this}rotate(t){return VA(this._rgb,t),this}}function QA(i){return new yr(i)}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function qi(){}const JA=(()=>{let i=0;return()=>i++})();function bt(i){return i==null}function jt(i){if(Array.isArray&&Array.isArray(i))return!0;const t=Object.prototype.toString.call(i);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function wt(i){return i!==null&&Object.prototype.toString.call(i)==="[object Object]"}function Jt(i){return(typeof i=="number"||i instanceof Number)&&isFinite(+i)}function Ye(i,t){return Jt(i)?i:t}function mt(i,t){return typeof i>"u"?t:i}const tT=(i,t)=>typeof i=="string"&&i.endsWith("%")?parseFloat(i)/100:+i/t,Qv=(i,t)=>typeof i=="string"&&i.endsWith("%")?parseFloat(i)/100*t:+i;function Dt(i,t,e){if(i&&typeof i.call=="function")return i.apply(e,t)}function Mt(i,t,e,s){let n,r,o;if(jt(i))for(r=i.length,n=0;n<r;n++)t.call(e,i[n],n);else if(wt(i))for(o=Object.keys(i),r=o.length,n=0;n<r;n++)t.call(e,i[o[n]],o[n])}function nc(i,t){let e,s,n,r;if(!i||!t||i.length!==t.length)return!1;for(e=0,s=i.length;e<s;++e)if(n=i[e],r=t[e],n.datasetIndex!==r.datasetIndex||n.index!==r.index)return!1;return!0}function rc(i){if(jt(i))return i.map(rc);if(wt(i)){const t=Object.create(null),e=Object.keys(i),s=e.length;let n=0;for(;n<s;++n)t[e[n]]=rc(i[e[n]]);return t}return i}function Jv(i){return["__proto__","prototype","constructor"].indexOf(i)===-1}function eT(i,t,e,s){if(!Jv(i))return;const n=t[i],r=e[i];wt(n)&&wt(r)?Hi(n,r,s):t[i]=rc(r)}function Hi(i,t,e){const s=jt(t)?t:[t],n=s.length;if(!wt(i))return i;e=e||{};const r=e.merger||eT;let o;for(let a=0;a<n;++a){if(o=s[a],!wt(o))continue;const l=Object.keys(o);for(let c=0,h=l.length;c<h;++c)r(l[c],i,o,e)}return i}function Ao(i,t){return Hi(i,t,{merger:iT})}function iT(i,t,e){if(!Jv(i))return;const s=t[i],n=e[i];wt(s)&&wt(n)?Ao(s,n):Object.prototype.hasOwnProperty.call(t,i)||(t[i]=rc(n))}const Em={"":i=>i,x:i=>i.x,y:i=>i.y};function sT(i){const t=i.split("."),e=[];let s="";for(const n of t)s+=n,s.endsWith("\\")?s=s.slice(0,-1)+".":(e.push(s),s="");return e}function nT(i){const t=sT(i);return e=>{for(const s of t){if(s==="")break;e=e&&e[s]}return e}}function Hs(i,t){return(Em[t]||(Em[t]=nT(t)))(i)}function Xu(i){return i.charAt(0).toUpperCase()+i.slice(1)}const Qo=i=>typeof i<"u",Ws=i=>typeof i=="function",km=(i,t)=>{if(i.size!==t.size)return!1;for(const e of i)if(!t.has(e))return!1;return!0};function rT(i){return i.type==="mouseup"||i.type==="click"||i.type==="contextmenu"}const kt=Math.PI,Vt=2*kt,oT=Vt+kt,oc=Number.POSITIVE_INFINITY,aT=kt/180,re=kt/2,on=kt/4,Am=kt*2/3,As=Math.log10,Fi=Math.sign;function To(i,t,e){return Math.abs(i-t)<e}function Tm(i){const t=Math.round(i);i=To(i,t,i/1e3)?t:i;const e=Math.pow(10,Math.floor(As(i))),s=i/e;return(s<=1?1:s<=2?2:s<=5?5:10)*e}function lT(i){const t=[],e=Math.sqrt(i);let s;for(s=1;s<e;s++)i%s===0&&(t.push(s),t.push(i/s));return e===(e|0)&&t.push(e),t.sort((n,r)=>n-r).pop(),t}function cT(i){return typeof i=="symbol"||typeof i=="object"&&i!==null&&!(Symbol.toPrimitive in i||"toString"in i||"valueOf"in i)}function vr(i){return!cT(i)&&!isNaN(parseFloat(i))&&isFinite(i)}function hT(i,t){const e=Math.round(i);return e-t<=i&&e+t>=i}function t_(i,t,e){let s,n,r;for(s=0,n=i.length;s<n;s++)r=i[s][e],isNaN(r)||(t.min=Math.min(t.min,r),t.max=Math.max(t.max,r))}function wi(i){return i*(kt/180)}function Ku(i){return i*(180/kt)}function Mm(i){if(!Jt(i))return;let t=1,e=0;for(;Math.round(i*t)/t!==i;)t*=10,e++;return e}function e_(i,t){const e=t.x-i.x,s=t.y-i.y,n=Math.sqrt(e*e+s*s);let r=Math.atan2(s,e);return r<-.5*kt&&(r+=Vt),{angle:r,distance:n}}function Fd(i,t){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))}function dT(i,t){return(i-t+oT)%Vt-kt}function Pe(i){return(i%Vt+Vt)%Vt}function Jo(i,t,e,s){const n=Pe(i),r=Pe(t),o=Pe(e),a=Pe(r-n),l=Pe(o-n),c=Pe(n-r),h=Pe(n-o);return n===r||n===o||s&&r===o||a>l&&c<h}function fe(i,t,e){return Math.max(t,Math.min(e,i))}function uT(i){return fe(i,-32768,32767)}function Ji(i,t,e,s=1e-6){return i>=Math.min(t,e)-s&&i<=Math.max(t,e)+s}function Qu(i,t,e){e=e||(o=>i[o]<t);let s=i.length-1,n=0,r;for(;s-n>1;)r=n+s>>1,e(r)?n=r:s=r;return{lo:n,hi:s}}const ts=(i,t,e,s)=>Qu(i,e,s?n=>{const r=i[n][t];return r<e||r===e&&i[n+1][t]===e}:n=>i[n][t]<e),pT=(i,t,e)=>Qu(i,e,s=>i[s][t]>=e);function fT(i,t,e){let s=0,n=i.length;for(;s<n&&i[s]<t;)s++;for(;n>s&&i[n-1]>e;)n--;return s>0||n<i.length?i.slice(s,n):i}const i_=["push","pop","shift","splice","unshift"];function mT(i,t){if(i._chartjs){i._chartjs.listeners.push(t);return}Object.defineProperty(i,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),i_.forEach(e=>{const s="_onData"+Xu(e),n=i[e];Object.defineProperty(i,e,{configurable:!0,enumerable:!1,value(...r){const o=n.apply(this,r);return i._chartjs.listeners.forEach(a=>{typeof a[s]=="function"&&a[s](...r)}),o}})})}function Pm(i,t){const e=i._chartjs;if(!e)return;const s=e.listeners,n=s.indexOf(t);n!==-1&&s.splice(n,1),!(s.length>0)&&(i_.forEach(r=>{delete i[r]}),delete i._chartjs)}function s_(i){const t=new Set(i);return t.size===i.length?i:Array.from(t)}const n_=function(){return typeof window>"u"?function(i){return i()}:window.requestAnimationFrame}();function r_(i,t){let e=[],s=!1;return function(...n){e=n,s||(s=!0,n_.call(window,()=>{s=!1,i.apply(t,e)}))}}function gT(i,t){let e;return function(...s){return t?(clearTimeout(e),e=setTimeout(i,t,s)):i.apply(this,s),t}}const Ju=i=>i==="start"?"left":i==="end"?"right":"center",Me=(i,t,e)=>i==="start"?t:i==="end"?e:(t+e)/2,bT=(i,t,e,s)=>i===(s?"left":"right")?e:i==="center"?(t+e)/2:t;function o_(i,t,e){const s=t.length;let n=0,r=s;if(i._sorted){const{iScale:o,vScale:a,_parsed:l}=i,c=i.dataset&&i.dataset.options?i.dataset.options.spanGaps:null,h=o.axis,{min:d,max:u,minDefined:p,maxDefined:m}=o.getUserBounds();if(p){if(n=Math.min(ts(l,h,d).lo,e?s:ts(t,h,o.getPixelForValue(d)).lo),c){const f=l.slice(0,n+1).reverse().findIndex(b=>!bt(b[a.axis]));n-=Math.max(0,f)}n=fe(n,0,s-1)}if(m){let f=Math.max(ts(l,o.axis,u,!0).hi+1,e?0:ts(t,h,o.getPixelForValue(u),!0).hi+1);if(c){const b=l.slice(f-1).findIndex(g=>!bt(g[a.axis]));f+=Math.max(0,b)}r=fe(f,n,s)-n}else r=s-n}return{start:n,count:r}}function a_(i){const{xScale:t,yScale:e,_scaleRanges:s}=i,n={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!s)return i._scaleRanges=n,!0;const r=s.xmin!==t.min||s.xmax!==t.max||s.ymin!==e.min||s.ymax!==e.max;return Object.assign(s,n),r}const ol=i=>i===0||i===1,$m=(i,t,e)=>-(Math.pow(2,10*(i-=1))*Math.sin((i-t)*Vt/e)),Om=(i,t,e)=>Math.pow(2,-10*i)*Math.sin((i-t)*Vt/e)+1,Mo={linear:i=>i,easeInQuad:i=>i*i,easeOutQuad:i=>-i*(i-2),easeInOutQuad:i=>(i/=.5)<1?.5*i*i:-.5*(--i*(i-2)-1),easeInCubic:i=>i*i*i,easeOutCubic:i=>(i-=1)*i*i+1,easeInOutCubic:i=>(i/=.5)<1?.5*i*i*i:.5*((i-=2)*i*i+2),easeInQuart:i=>i*i*i*i,easeOutQuart:i=>-((i-=1)*i*i*i-1),easeInOutQuart:i=>(i/=.5)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2),easeInQuint:i=>i*i*i*i*i,easeOutQuint:i=>(i-=1)*i*i*i*i+1,easeInOutQuint:i=>(i/=.5)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2),easeInSine:i=>-Math.cos(i*re)+1,easeOutSine:i=>Math.sin(i*re),easeInOutSine:i=>-.5*(Math.cos(kt*i)-1),easeInExpo:i=>i===0?0:Math.pow(2,10*(i-1)),easeOutExpo:i=>i===1?1:-Math.pow(2,-10*i)+1,easeInOutExpo:i=>ol(i)?i:i<.5?.5*Math.pow(2,10*(i*2-1)):.5*(-Math.pow(2,-10*(i*2-1))+2),easeInCirc:i=>i>=1?i:-(Math.sqrt(1-i*i)-1),easeOutCirc:i=>Math.sqrt(1-(i-=1)*i),easeInOutCirc:i=>(i/=.5)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1),easeInElastic:i=>ol(i)?i:$m(i,.075,.3),easeOutElastic:i=>ol(i)?i:Om(i,.075,.3),easeInOutElastic(i){return ol(i)?i:i<.5?.5*$m(i*2,.1125,.45):.5+.5*Om(i*2-1,.1125,.45)},easeInBack(i){return i*i*((1.70158+1)*i-1.70158)},easeOutBack(i){return(i-=1)*i*((1.70158+1)*i+1.70158)+1},easeInOutBack(i){let t=1.70158;return(i/=.5)<1?.5*(i*i*(((t*=1.525)+1)*i-t)):.5*((i-=2)*i*(((t*=1.525)+1)*i+t)+2)},easeInBounce:i=>1-Mo.easeOutBounce(1-i),easeOutBounce(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},easeInOutBounce:i=>i<.5?Mo.easeInBounce(i*2)*.5:Mo.easeOutBounce(i*2-1)*.5+.5};function tp(i){if(i&&typeof i=="object"){const t=i.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function Dm(i){return tp(i)?i:new yr(i)}function zh(i){return tp(i)?i:new yr(i).saturate(.5).darken(.1).hexString()}const yT=["x","y","borderWidth","radius","tension"],vT=["color","borderColor","backgroundColor"];function _T(i){i.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),i.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),i.set("animations",{colors:{type:"color",properties:vT},numbers:{type:"number",properties:yT}}),i.describe("animations",{_fallback:"animation"}),i.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function wT(i){i.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const Im=new Map;function xT(i,t){t=t||{};const e=i+JSON.stringify(t);let s=Im.get(e);return s||(s=new Intl.NumberFormat(i,t),Im.set(e,s)),s}function xa(i,t,e){return xT(t,e).format(i)}const l_={values(i){return jt(i)?i:""+i},numeric(i,t,e){if(i===0)return"0";const s=this.chart.options.locale;let n,r=i;if(e.length>1){const c=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(c<1e-4||c>1e15)&&(n="scientific"),r=CT(i,e)}const o=As(Math.abs(r)),a=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:n,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),xa(i,s,l)},logarithmic(i,t,e){if(i===0)return"0";const s=e[t].significand||i/Math.pow(10,Math.floor(As(i)));return[1,2,3,5,10,15].includes(s)||t>.8*e.length?l_.numeric.call(this,i,t,e):""}};function CT(i,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&i!==Math.floor(i)&&(e=i-Math.floor(i)),e}var Vc={formatters:l_};function ST(i){i.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Vc.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),i.route("scale.ticks","color","","color"),i.route("scale.grid","color","","borderColor"),i.route("scale.border","color","","borderColor"),i.route("scale.title","color","","color"),i.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),i.describe("scales",{_fallback:"scale"}),i.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const En=Object.create(null),Ud=Object.create(null);function Po(i,t){if(!t)return i;const e=t.split(".");for(let s=0,n=e.length;s<n;++s){const r=e[s];i=i[r]||(i[r]=Object.create(null))}return i}function Lh(i,t,e){return typeof t=="string"?Hi(Po(i,t),e):Hi(Po(i,""),t)}class ET{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=s=>s.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(s,n)=>zh(n.backgroundColor),this.hoverBorderColor=(s,n)=>zh(n.borderColor),this.hoverColor=(s,n)=>zh(n.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return Lh(this,t,e)}get(t){return Po(this,t)}describe(t,e){return Lh(Ud,t,e)}override(t,e){return Lh(En,t,e)}route(t,e,s,n){const r=Po(this,t),o=Po(this,s),a="_"+e;Object.defineProperties(r,{[a]:{value:r[e],writable:!0},[e]:{enumerable:!0,get(){const l=this[a],c=o[n];return wt(l)?Object.assign({},c,l):mt(l,c)},set(l){this[a]=l}}})}apply(t){t.forEach(e=>e(this))}}var Ht=new ET({_scriptable:i=>!i.startsWith("on"),_indexable:i=>i!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[_T,wT,ST]);function kT(i){return!i||bt(i.size)||bt(i.family)?null:(i.style?i.style+" ":"")+(i.weight?i.weight+" ":"")+i.size+"px "+i.family}function ac(i,t,e,s,n){let r=t[n];return r||(r=t[n]=i.measureText(n).width,e.push(n)),r>s&&(s=r),s}function AT(i,t,e,s){s=s||{};let n=s.data=s.data||{},r=s.garbageCollect=s.garbageCollect||[];s.font!==t&&(n=s.data={},r=s.garbageCollect=[],s.font=t),i.save(),i.font=t;let o=0;const a=e.length;let l,c,h,d,u;for(l=0;l<a;l++)if(d=e[l],d!=null&&!jt(d))o=ac(i,n,r,o,d);else if(jt(d))for(c=0,h=d.length;c<h;c++)u=d[c],u!=null&&!jt(u)&&(o=ac(i,n,r,o,u));i.restore();const p=r.length/2;if(p>e.length){for(l=0;l<p;l++)delete n[r[l]];r.splice(0,p)}return o}function an(i,t,e){const s=i.currentDevicePixelRatio,n=e!==0?Math.max(e/2,.5):0;return Math.round((t-n)*s)/s+n}function zm(i,t){!t&&!i||(t=t||i.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,i.width,i.height),t.restore())}function jd(i,t,e,s){c_(i,t,e,s,null)}function c_(i,t,e,s,n){let r,o,a,l,c,h,d,u;const p=t.pointStyle,m=t.rotation,f=t.radius;let b=(m||0)*aT;if(p&&typeof p=="object"&&(r=p.toString(),r==="[object HTMLImageElement]"||r==="[object HTMLCanvasElement]")){i.save(),i.translate(e,s),i.rotate(b),i.drawImage(p,-p.width/2,-p.height/2,p.width,p.height),i.restore();return}if(!(isNaN(f)||f<=0)){switch(i.beginPath(),p){default:n?i.ellipse(e,s,n/2,f,0,0,Vt):i.arc(e,s,f,0,Vt),i.closePath();break;case"triangle":h=n?n/2:f,i.moveTo(e+Math.sin(b)*h,s-Math.cos(b)*f),b+=Am,i.lineTo(e+Math.sin(b)*h,s-Math.cos(b)*f),b+=Am,i.lineTo(e+Math.sin(b)*h,s-Math.cos(b)*f),i.closePath();break;case"rectRounded":c=f*.516,l=f-c,o=Math.cos(b+on)*l,d=Math.cos(b+on)*(n?n/2-c:l),a=Math.sin(b+on)*l,u=Math.sin(b+on)*(n?n/2-c:l),i.arc(e-d,s-a,c,b-kt,b-re),i.arc(e+u,s-o,c,b-re,b),i.arc(e+d,s+a,c,b,b+re),i.arc(e-u,s+o,c,b+re,b+kt),i.closePath();break;case"rect":if(!m){l=Math.SQRT1_2*f,h=n?n/2:l,i.rect(e-h,s-l,2*h,2*l);break}b+=on;case"rectRot":d=Math.cos(b)*(n?n/2:f),o=Math.cos(b)*f,a=Math.sin(b)*f,u=Math.sin(b)*(n?n/2:f),i.moveTo(e-d,s-a),i.lineTo(e+u,s-o),i.lineTo(e+d,s+a),i.lineTo(e-u,s+o),i.closePath();break;case"crossRot":b+=on;case"cross":d=Math.cos(b)*(n?n/2:f),o=Math.cos(b)*f,a=Math.sin(b)*f,u=Math.sin(b)*(n?n/2:f),i.moveTo(e-d,s-a),i.lineTo(e+d,s+a),i.moveTo(e+u,s-o),i.lineTo(e-u,s+o);break;case"star":d=Math.cos(b)*(n?n/2:f),o=Math.cos(b)*f,a=Math.sin(b)*f,u=Math.sin(b)*(n?n/2:f),i.moveTo(e-d,s-a),i.lineTo(e+d,s+a),i.moveTo(e+u,s-o),i.lineTo(e-u,s+o),b+=on,d=Math.cos(b)*(n?n/2:f),o=Math.cos(b)*f,a=Math.sin(b)*f,u=Math.sin(b)*(n?n/2:f),i.moveTo(e-d,s-a),i.lineTo(e+d,s+a),i.moveTo(e+u,s-o),i.lineTo(e-u,s+o);break;case"line":o=n?n/2:Math.cos(b)*f,a=Math.sin(b)*f,i.moveTo(e-o,s-a),i.lineTo(e+o,s+a);break;case"dash":i.moveTo(e,s),i.lineTo(e+Math.cos(b)*(n?n/2:f),s+Math.sin(b)*f);break;case!1:i.closePath();break}i.fill(),t.borderWidth>0&&i.stroke()}}function es(i,t,e){return e=e||.5,!t||i&&i.x>t.left-e&&i.x<t.right+e&&i.y>t.top-e&&i.y<t.bottom+e}function Hc(i,t){i.save(),i.beginPath(),i.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),i.clip()}function Wc(i){i.restore()}function TT(i,t,e,s,n){if(!t)return i.lineTo(e.x,e.y);if(n==="middle"){const r=(t.x+e.x)/2;i.lineTo(r,t.y),i.lineTo(r,e.y)}else n==="after"!=!!s?i.lineTo(t.x,e.y):i.lineTo(e.x,t.y);i.lineTo(e.x,e.y)}function MT(i,t,e,s){if(!t)return i.lineTo(e.x,e.y);i.bezierCurveTo(s?t.cp1x:t.cp2x,s?t.cp1y:t.cp2y,s?e.cp2x:e.cp1x,s?e.cp2y:e.cp1y,e.x,e.y)}function PT(i,t){t.translation&&i.translate(t.translation[0],t.translation[1]),bt(t.rotation)||i.rotate(t.rotation),t.color&&(i.fillStyle=t.color),t.textAlign&&(i.textAlign=t.textAlign),t.textBaseline&&(i.textBaseline=t.textBaseline)}function $T(i,t,e,s,n){if(n.strikethrough||n.underline){const r=i.measureText(s),o=t-r.actualBoundingBoxLeft,a=t+r.actualBoundingBoxRight,l=e-r.actualBoundingBoxAscent,c=e+r.actualBoundingBoxDescent,h=n.strikethrough?(l+c)/2:c;i.strokeStyle=i.fillStyle,i.beginPath(),i.lineWidth=n.decorationWidth||2,i.moveTo(o,h),i.lineTo(a,h),i.stroke()}}function OT(i,t){const e=i.fillStyle;i.fillStyle=t.color,i.fillRect(t.left,t.top,t.width,t.height),i.fillStyle=e}function kn(i,t,e,s,n,r={}){const o=jt(t)?t:[t],a=r.strokeWidth>0&&r.strokeColor!=="";let l,c;for(i.save(),i.font=n.string,PT(i,r),l=0;l<o.length;++l)c=o[l],r.backdrop&&OT(i,r.backdrop),a&&(r.strokeColor&&(i.strokeStyle=r.strokeColor),bt(r.strokeWidth)||(i.lineWidth=r.strokeWidth),i.strokeText(c,e,s,r.maxWidth)),i.fillText(c,e,s,r.maxWidth),$T(i,e,s,c,r),s+=Number(n.lineHeight);i.restore()}function ta(i,t){const{x:e,y:s,w:n,h:r,radius:o}=t;i.arc(e+o.topLeft,s+o.topLeft,o.topLeft,1.5*kt,kt,!0),i.lineTo(e,s+r-o.bottomLeft),i.arc(e+o.bottomLeft,s+r-o.bottomLeft,o.bottomLeft,kt,re,!0),i.lineTo(e+n-o.bottomRight,s+r),i.arc(e+n-o.bottomRight,s+r-o.bottomRight,o.bottomRight,re,0,!0),i.lineTo(e+n,s+o.topRight),i.arc(e+n-o.topRight,s+o.topRight,o.topRight,0,-re,!0),i.lineTo(e+o.topLeft,s)}const DT=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,IT=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function zT(i,t){const e=(""+i).match(DT);if(!e||e[1]==="normal")return t*1.2;switch(i=+e[2],e[3]){case"px":return i;case"%":i/=100;break}return t*i}const LT=i=>+i||0;function ep(i,t){const e={},s=wt(t),n=s?Object.keys(t):t,r=wt(i)?s?o=>mt(i[o],i[t[o]]):o=>i[o]:()=>i;for(const o of n)e[o]=LT(r(o));return e}function h_(i){return ep(i,{top:"y",right:"x",bottom:"y",left:"x"})}function _n(i){return ep(i,["topLeft","topRight","bottomLeft","bottomRight"])}function Ce(i){const t=h_(i);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function de(i,t){i=i||{},t=t||Ht.font;let e=mt(i.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let s=mt(i.style,t.style);s&&!(""+s).match(IT)&&(console.warn('Invalid font style specified: "'+s+'"'),s=void 0);const n={family:mt(i.family,t.family),lineHeight:zT(mt(i.lineHeight,t.lineHeight),e),size:e,style:s,weight:mt(i.weight,t.weight),string:""};return n.string=kT(n),n}function Ut(i,t,e,s){let n,r,o;for(n=0,r=i.length;n<r;++n)if(o=i[n],o!==void 0&&(t!==void 0&&typeof o=="function"&&(o=o(t)),e!==void 0&&jt(o)&&(o=o[e%o.length]),o!==void 0))return o}function RT(i,t,e){const{min:s,max:n}=i,r=Qv(t,(n-s)/2),o=(a,l)=>e&&a===0?0:a+l;return{min:o(s,-Math.abs(r)),max:o(n,r)}}function Qs(i,t){return Object.assign(Object.create(i),t)}function ip(i,t=[""],e,s,n=()=>i[0]){const r=e||i;typeof s>"u"&&(s=f_("_fallback",i));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:i,_rootScopes:r,_fallback:s,_getTarget:n,override:a=>ip([a,...i],t,r,s)};return new Proxy(o,{deleteProperty(a,l){return delete a[l],delete a._keys,delete i[0][l],!0},get(a,l){return u_(a,l,()=>WT(l,t,i,a))},getOwnPropertyDescriptor(a,l){return Reflect.getOwnPropertyDescriptor(a._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(i[0])},has(a,l){return Rm(a).includes(l)},ownKeys(a){return Rm(a)},set(a,l,c){const h=a._storage||(a._storage=n());return a[l]=h[l]=c,delete a._keys,!0}})}function _r(i,t,e,s){const n={_cacheable:!1,_proxy:i,_context:t,_subProxy:e,_stack:new Set,_descriptors:d_(i,s),setContext:r=>_r(i,r,e,s),override:r=>_r(i.override(r),t,e,s)};return new Proxy(n,{deleteProperty(r,o){return delete r[o],delete i[o],!0},get(r,o,a){return u_(r,o,()=>NT(r,o,a))},getOwnPropertyDescriptor(r,o){return r._descriptors.allKeys?Reflect.has(i,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(i,o)},getPrototypeOf(){return Reflect.getPrototypeOf(i)},has(r,o){return Reflect.has(i,o)},ownKeys(){return Reflect.ownKeys(i)},set(r,o,a){return i[o]=a,delete r[o],!0}})}function d_(i,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:s=t.indexable,_allKeys:n=t.allKeys}=i;return{allKeys:n,scriptable:e,indexable:s,isScriptable:Ws(e)?e:()=>e,isIndexable:Ws(s)?s:()=>s}}const BT=(i,t)=>i?i+Xu(t):t,sp=(i,t)=>wt(t)&&i!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function u_(i,t,e){if(Object.prototype.hasOwnProperty.call(i,t)||t==="constructor")return i[t];const s=e();return i[t]=s,s}function NT(i,t,e){const{_proxy:s,_context:n,_subProxy:r,_descriptors:o}=i;let a=s[t];return Ws(a)&&o.isScriptable(t)&&(a=FT(t,a,i,e)),jt(a)&&a.length&&(a=UT(t,a,i,o.isIndexable)),sp(t,a)&&(a=_r(a,n,r&&r[t],o)),a}function FT(i,t,e,s){const{_proxy:n,_context:r,_subProxy:o,_stack:a}=e;if(a.has(i))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+i);a.add(i);let l=t(r,o||s);return a.delete(i),sp(i,l)&&(l=np(n._scopes,n,i,l)),l}function UT(i,t,e,s){const{_proxy:n,_context:r,_subProxy:o,_descriptors:a}=e;if(typeof r.index<"u"&&s(i))return t[r.index%t.length];if(wt(t[0])){const l=t,c=n._scopes.filter(h=>h!==l);t=[];for(const h of l){const d=np(c,n,i,h);t.push(_r(d,r,o&&o[i],a))}}return t}function p_(i,t,e){return Ws(i)?i(t,e):i}const jT=(i,t)=>i===!0?t:typeof i=="string"?Hs(t,i):void 0;function VT(i,t,e,s,n){for(const r of t){const o=jT(e,r);if(o){i.add(o);const a=p_(o._fallback,e,n);if(typeof a<"u"&&a!==e&&a!==s)return a}else if(o===!1&&typeof s<"u"&&e!==s)return null}return!1}function np(i,t,e,s){const n=t._rootScopes,r=p_(t._fallback,e,s),o=[...i,...n],a=new Set;a.add(s);let l=Lm(a,o,e,r||e,s);return l===null||typeof r<"u"&&r!==e&&(l=Lm(a,o,r,l,s),l===null)?!1:ip(Array.from(a),[""],n,r,()=>HT(t,e,s))}function Lm(i,t,e,s,n){for(;e;)e=VT(i,t,e,s,n);return e}function HT(i,t,e){const s=i._getTarget();t in s||(s[t]={});const n=s[t];return jt(n)&&wt(e)?e:n||{}}function WT(i,t,e,s){let n;for(const r of t)if(n=f_(BT(r,i),e),typeof n<"u")return sp(i,n)?np(e,s,i,n):n}function f_(i,t){for(const e of t){if(!e)continue;const s=e[i];if(typeof s<"u")return s}}function Rm(i){let t=i._keys;return t||(t=i._keys=qT(i._scopes)),t}function qT(i){const t=new Set;for(const e of i)for(const s of Object.keys(e).filter(n=>!n.startsWith("_")))t.add(s);return Array.from(t)}function m_(i,t,e,s){const{iScale:n}=i,{key:r="r"}=this._parsing,o=new Array(s);let a,l,c,h;for(a=0,l=s;a<l;++a)c=a+e,h=t[c],o[a]={r:n.parse(Hs(h,r),c)};return o}const YT=Number.EPSILON||1e-14,wr=(i,t)=>t<i.length&&!i[t].skip&&i[t],g_=i=>i==="x"?"y":"x";function ZT(i,t,e,s){const n=i.skip?t:i,r=t,o=e.skip?t:e,a=Fd(r,n),l=Fd(o,r);let c=a/(a+l),h=l/(a+l);c=isNaN(c)?0:c,h=isNaN(h)?0:h;const d=s*c,u=s*h;return{previous:{x:r.x-d*(o.x-n.x),y:r.y-d*(o.y-n.y)},next:{x:r.x+u*(o.x-n.x),y:r.y+u*(o.y-n.y)}}}function GT(i,t,e){const s=i.length;let n,r,o,a,l,c=wr(i,0);for(let h=0;h<s-1;++h)if(l=c,c=wr(i,h+1),!(!l||!c)){if(To(t[h],0,YT)){e[h]=e[h+1]=0;continue}n=e[h]/t[h],r=e[h+1]/t[h],a=Math.pow(n,2)+Math.pow(r,2),!(a<=9)&&(o=3/Math.sqrt(a),e[h]=n*o*t[h],e[h+1]=r*o*t[h])}}function XT(i,t,e="x"){const s=g_(e),n=i.length;let r,o,a,l=wr(i,0);for(let c=0;c<n;++c){if(o=a,a=l,l=wr(i,c+1),!a)continue;const h=a[e],d=a[s];o&&(r=(h-o[e])/3,a[`cp1${e}`]=h-r,a[`cp1${s}`]=d-r*t[c]),l&&(r=(l[e]-h)/3,a[`cp2${e}`]=h+r,a[`cp2${s}`]=d+r*t[c])}}function KT(i,t="x"){const e=g_(t),s=i.length,n=Array(s).fill(0),r=Array(s);let o,a,l,c=wr(i,0);for(o=0;o<s;++o)if(a=l,l=c,c=wr(i,o+1),!!l){if(c){const h=c[t]-l[t];n[o]=h!==0?(c[e]-l[e])/h:0}r[o]=a?c?Fi(n[o-1])!==Fi(n[o])?0:(n[o-1]+n[o])/2:n[o-1]:n[o]}GT(i,n,r),XT(i,r,t)}function al(i,t,e){return Math.max(Math.min(i,e),t)}function QT(i,t){let e,s,n,r,o,a=es(i[0],t);for(e=0,s=i.length;e<s;++e)o=r,r=a,a=e<s-1&&es(i[e+1],t),r&&(n=i[e],o&&(n.cp1x=al(n.cp1x,t.left,t.right),n.cp1y=al(n.cp1y,t.top,t.bottom)),a&&(n.cp2x=al(n.cp2x,t.left,t.right),n.cp2y=al(n.cp2y,t.top,t.bottom)))}function JT(i,t,e,s,n){let r,o,a,l;if(t.spanGaps&&(i=i.filter(c=>!c.skip)),t.cubicInterpolationMode==="monotone")KT(i,n);else{let c=s?i[i.length-1]:i[0];for(r=0,o=i.length;r<o;++r)a=i[r],l=ZT(c,a,i[Math.min(r+1,o-(s?0:1))%o],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,c=a}t.capBezierPoints&&QT(i,e)}function rp(){return typeof window<"u"&&typeof document<"u"}function op(i){let t=i.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function lc(i,t,e){let s;return typeof i=="string"?(s=parseInt(i,10),i.indexOf("%")!==-1&&(s=s/100*t.parentNode[e])):s=i,s}const qc=i=>i.ownerDocument.defaultView.getComputedStyle(i,null);function tM(i,t){return qc(i).getPropertyValue(t)}const eM=["top","right","bottom","left"];function wn(i,t,e){const s={};e=e?"-"+e:"";for(let n=0;n<4;n++){const r=eM[n];s[r]=parseFloat(i[t+"-"+r+e])||0}return s.width=s.left+s.right,s.height=s.top+s.bottom,s}const iM=(i,t,e)=>(i>0||t>0)&&(!e||!e.shadowRoot);function sM(i,t){const e=i.touches,s=e&&e.length?e[0]:i,{offsetX:n,offsetY:r}=s;let o=!1,a,l;if(iM(n,r,i.target))a=n,l=r;else{const c=t.getBoundingClientRect();a=s.clientX-c.left,l=s.clientY-c.top,o=!0}return{x:a,y:l,box:o}}function dn(i,t){if("native"in i)return i;const{canvas:e,currentDevicePixelRatio:s}=t,n=qc(e),r=n.boxSizing==="border-box",o=wn(n,"padding"),a=wn(n,"border","width"),{x:l,y:c,box:h}=sM(i,e),d=o.left+(h&&a.left),u=o.top+(h&&a.top);let{width:p,height:m}=t;return r&&(p-=o.width+a.width,m-=o.height+a.height),{x:Math.round((l-d)/p*e.width/s),y:Math.round((c-u)/m*e.height/s)}}function nM(i,t,e){let s,n;if(t===void 0||e===void 0){const r=i&&op(i);if(!r)t=i.clientWidth,e=i.clientHeight;else{const o=r.getBoundingClientRect(),a=qc(r),l=wn(a,"border","width"),c=wn(a,"padding");t=o.width-c.width-l.width,e=o.height-c.height-l.height,s=lc(a.maxWidth,r,"clientWidth"),n=lc(a.maxHeight,r,"clientHeight")}}return{width:t,height:e,maxWidth:s||oc,maxHeight:n||oc}}const Ts=i=>Math.round(i*10)/10;function rM(i,t,e,s){const n=qc(i),r=wn(n,"margin"),o=lc(n.maxWidth,i,"clientWidth")||oc,a=lc(n.maxHeight,i,"clientHeight")||oc,l=nM(i,t,e);let{width:c,height:h}=l;if(n.boxSizing==="content-box"){const d=wn(n,"border","width"),u=wn(n,"padding");c-=u.width+d.width,h-=u.height+d.height}return c=Math.max(0,c-r.width),h=Math.max(0,s?c/s:h-r.height),c=Ts(Math.min(c,o,l.maxWidth)),h=Ts(Math.min(h,a,l.maxHeight)),c&&!h&&(h=Ts(c/2)),(t!==void 0||e!==void 0)&&s&&l.height&&h>l.height&&(h=l.height,c=Ts(Math.floor(h*s))),{width:c,height:h}}function Bm(i,t,e){const s=t||1,n=Ts(i.height*s),r=Ts(i.width*s);i.height=Ts(i.height),i.width=Ts(i.width);const o=i.canvas;return o.style&&(e||!o.style.height&&!o.style.width)&&(o.style.height=`${i.height}px`,o.style.width=`${i.width}px`),i.currentDevicePixelRatio!==s||o.height!==n||o.width!==r?(i.currentDevicePixelRatio=s,o.height=n,o.width=r,i.ctx.setTransform(s,0,0,s,0,0),!0):!1}const oM=function(){let i=!1;try{const t={get passive(){return i=!0,!1}};rp()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return i}();function Nm(i,t){const e=tM(i,t),s=e&&e.match(/^(\d+)(\.\d+)?px$/);return s?+s[1]:void 0}function un(i,t,e,s){return{x:i.x+e*(t.x-i.x),y:i.y+e*(t.y-i.y)}}function aM(i,t,e,s){return{x:i.x+e*(t.x-i.x),y:s==="middle"?e<.5?i.y:t.y:s==="after"?e<1?i.y:t.y:e>0?t.y:i.y}}function lM(i,t,e,s){const n={x:i.cp2x,y:i.cp2y},r={x:t.cp1x,y:t.cp1y},o=un(i,n,e),a=un(n,r,e),l=un(r,t,e),c=un(o,a,e),h=un(a,l,e);return un(c,h,e)}const cM=function(i,t){return{x(e){return i+i+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,s){return e-s},leftForLtr(e,s){return e-s}}},hM=function(){return{x(i){return i},setWidth(i){},textAlign(i){return i},xPlus(i,t){return i+t},leftForLtr(i,t){return i}}};function nr(i,t,e){return i?cM(t,e):hM()}function b_(i,t){let e,s;(t==="ltr"||t==="rtl")&&(e=i.canvas.style,s=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),i.prevTextDirection=s)}function y_(i,t){t!==void 0&&(delete i.prevTextDirection,i.canvas.style.setProperty("direction",t[0],t[1]))}function v_(i){return i==="angle"?{between:Jo,compare:dT,normalize:Pe}:{between:Ji,compare:(t,e)=>t-e,normalize:t=>t}}function Fm({start:i,end:t,count:e,loop:s,style:n}){return{start:i%e,end:t%e,loop:s&&(t-i+1)%e===0,style:n}}function dM(i,t,e){const{property:s,start:n,end:r}=e,{between:o,normalize:a}=v_(s),l=t.length;let{start:c,end:h,loop:d}=i,u,p;if(d){for(c+=l,h+=l,u=0,p=l;u<p&&o(a(t[c%l][s]),n,r);++u)c--,h--;c%=l,h%=l}return h<c&&(h+=l),{start:c,end:h,loop:d,style:i.style}}function __(i,t,e){if(!e)return[i];const{property:s,start:n,end:r}=e,o=t.length,{compare:a,between:l,normalize:c}=v_(s),{start:h,end:d,loop:u,style:p}=dM(i,t,e),m=[];let f=!1,b=null,g,y,v;const _=()=>l(n,v,g)&&a(n,v)!==0,x=()=>a(r,g)===0||l(r,v,g),S=()=>f||_(),k=()=>!f||x();for(let T=h,M=h;T<=d;++T)y=t[T%o],!y.skip&&(g=c(y[s]),g!==v&&(f=l(g,n,r),b===null&&S()&&(b=a(g,n)===0?T:M),b!==null&&k()&&(m.push(Fm({start:b,end:T,loop:u,count:o,style:p})),b=null),M=T,v=g));return b!==null&&m.push(Fm({start:b,end:d,loop:u,count:o,style:p})),m}function w_(i,t){const e=[],s=i.segments;for(let n=0;n<s.length;n++){const r=__(s[n],i.points,t);r.length&&e.push(...r)}return e}function uM(i,t,e,s){let n=0,r=t-1;if(e&&!s)for(;n<t&&!i[n].skip;)n++;for(;n<t&&i[n].skip;)n++;for(n%=t,e&&(r+=n);r>n&&i[r%t].skip;)r--;return r%=t,{start:n,end:r}}function pM(i,t,e,s){const n=i.length,r=[];let o=t,a=i[t],l;for(l=t+1;l<=e;++l){const c=i[l%n];c.skip||c.stop?a.skip||(s=!1,r.push({start:t%n,end:(l-1)%n,loop:s}),t=o=c.stop?l:null):(o=l,a.skip&&(t=l)),a=c}return o!==null&&r.push({start:t%n,end:o%n,loop:s}),r}function fM(i,t){const e=i.points,s=i.options.spanGaps,n=e.length;if(!n)return[];const r=!!i._loop,{start:o,end:a}=uM(e,n,r,s);if(s===!0)return Um(i,[{start:o,end:a,loop:r}],e,t);const l=a<o?a+n:a,c=!!i._fullLoop&&o===0&&a===n-1;return Um(i,pM(e,o,l,c),e,t)}function Um(i,t,e,s){return!s||!s.setContext||!e?t:mM(i,t,e,s)}function mM(i,t,e,s){const n=i._chart.getContext(),r=jm(i.options),{_datasetIndex:o,options:{spanGaps:a}}=i,l=e.length,c=[];let h=r,d=t[0].start,u=d;function p(m,f,b,g){const y=a?-1:1;if(m!==f){for(m+=l;e[m%l].skip;)m-=y;for(;e[f%l].skip;)f+=y;m%l!==f%l&&(c.push({start:m%l,end:f%l,loop:b,style:g}),h=g,d=f%l)}}for(const m of t){d=a?d:m.start;let f=e[d%l],b;for(u=d+1;u<=m.end;u++){const g=e[u%l];b=jm(s.setContext(Qs(n,{type:"segment",p0:f,p1:g,p0DataIndex:(u-1)%l,p1DataIndex:u%l,datasetIndex:o}))),gM(b,h)&&p(d,u-1,m.loop,h),f=g,h=b}d<u-1&&p(d,u-1,m.loop,h)}return c}function jm(i){return{backgroundColor:i.backgroundColor,borderCapStyle:i.borderCapStyle,borderDash:i.borderDash,borderDashOffset:i.borderDashOffset,borderJoinStyle:i.borderJoinStyle,borderWidth:i.borderWidth,borderColor:i.borderColor}}function gM(i,t){if(!t)return!1;const e=[],s=function(n,r){return tp(r)?(e.includes(r)||e.push(r),e.indexOf(r)):r};return JSON.stringify(i,s)!==JSON.stringify(t,s)}function ll(i,t,e){return i.options.clip?i[e]:t[e]}function bM(i,t){const{xScale:e,yScale:s}=i;return e&&s?{left:ll(e,t,"left"),right:ll(e,t,"right"),top:ll(s,t,"top"),bottom:ll(s,t,"bottom")}:t}function x_(i,t){const e=t._clip;if(e.disabled)return!1;const s=bM(t,i.chartArea);return{left:e.left===!1?0:s.left-(e.left===!0?0:e.left),right:e.right===!1?i.width:s.right+(e.right===!0?0:e.right),top:e.top===!1?0:s.top-(e.top===!0?0:e.top),bottom:e.bottom===!1?i.height:s.bottom+(e.bottom===!0?0:e.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class yM{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,s,n){const r=e.listeners[n],o=e.duration;r.forEach(a=>a({chart:t,initial:e.initial,numSteps:o,currentStep:Math.min(s-e.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=n_.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((s,n)=>{if(!s.running||!s.items.length)return;const r=s.items;let o=r.length-1,a=!1,l;for(;o>=0;--o)l=r[o],l._active?(l._total>s.duration&&(s.duration=l._total),l.tick(t),a=!0):(r[o]=r[r.length-1],r.pop());a&&(n.draw(),this._notify(n,s,t,"progress")),r.length||(s.running=!1,this._notify(n,s,t,"complete"),s.initial=!1),e+=r.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let s=e.get(t);return s||(s={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,s)),s}listen(t,e,s){this._getAnims(t).listeners[e].push(s)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((s,n)=>Math.max(s,n._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const s=e.items;let n=s.length-1;for(;n>=0;--n)s[n].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var Zi=new yM;const Vm="transparent",vM={boolean(i,t,e){return e>.5?t:i},color(i,t,e){const s=Dm(i||Vm),n=s.valid&&Dm(t||Vm);return n&&n.valid?n.mix(s,e).hexString():t},number(i,t,e){return i+(t-i)*e}};class _M{constructor(t,e,s,n){const r=e[s];n=Ut([t.to,n,r,t.from]);const o=Ut([t.from,r,n]);this._active=!0,this._fn=t.fn||vM[t.type||typeof o],this._easing=Mo[t.easing]||Mo.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=s,this._from=o,this._to=n,this._promises=void 0}active(){return this._active}update(t,e,s){if(this._active){this._notify(!1);const n=this._target[this._prop],r=s-this._start,o=this._duration-r;this._start=s,this._duration=Math.floor(Math.max(o,t.duration)),this._total+=r,this._loop=!!t.loop,this._to=Ut([t.to,e,n,t.from]),this._from=Ut([t.from,n,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,s=this._duration,n=this._prop,r=this._from,o=this._loop,a=this._to;let l;if(this._active=r!==a&&(o||e<s),!this._active){this._target[n]=a,this._notify(!0);return}if(e<0){this._target[n]=r;return}l=e/s%2,l=o&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[n]=this._fn(r,a,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,s)=>{t.push({res:e,rej:s})})}_notify(t){const e=t?"res":"rej",s=this._promises||[];for(let n=0;n<s.length;n++)s[n][e]()}}class C_{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!wt(t))return;const e=Object.keys(Ht.animation),s=this._properties;Object.getOwnPropertyNames(t).forEach(n=>{const r=t[n];if(!wt(r))return;const o={};for(const a of e)o[a]=r[a];(jt(r.properties)&&r.properties||[n]).forEach(a=>{(a===n||!s.has(a))&&s.set(a,o)})})}_animateOptions(t,e){const s=e.options,n=xM(t,s);if(!n)return[];const r=this._createAnimations(n,s);return s.$shared&&wM(t.options.$animations,s).then(()=>{t.options=s},()=>{}),r}_createAnimations(t,e){const s=this._properties,n=[],r=t.$animations||(t.$animations={}),o=Object.keys(e),a=Date.now();let l;for(l=o.length-1;l>=0;--l){const c=o[l];if(c.charAt(0)==="$")continue;if(c==="options"){n.push(...this._animateOptions(t,e));continue}const h=e[c];let d=r[c];const u=s.get(c);if(d)if(u&&d.active()){d.update(u,h,a);continue}else d.cancel();if(!u||!u.duration){t[c]=h;continue}r[c]=d=new _M(u,t,c,h),n.push(d)}return n}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const s=this._createAnimations(t,e);if(s.length)return Zi.add(this._chart,s),!0}}function wM(i,t){const e=[],s=Object.keys(t);for(let n=0;n<s.length;n++){const r=i[s[n]];r&&r.active()&&e.push(r.wait())}return Promise.all(e)}function xM(i,t){if(!t)return;let e=i.options;if(!e){i.options=t;return}return e.$shared&&(i.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function Hm(i,t){const e=i&&i.options||{},s=e.reverse,n=e.min===void 0?t:0,r=e.max===void 0?t:0;return{start:s?r:n,end:s?n:r}}function CM(i,t,e){if(e===!1)return!1;const s=Hm(i,e),n=Hm(t,e);return{top:n.end,right:s.end,bottom:n.start,left:s.start}}function SM(i){let t,e,s,n;return wt(i)?(t=i.top,e=i.right,s=i.bottom,n=i.left):t=e=s=n=i,{top:t,right:e,bottom:s,left:n,disabled:i===!1}}function S_(i,t){const e=[],s=i._getSortedDatasetMetas(t);let n,r;for(n=0,r=s.length;n<r;++n)e.push(s[n].index);return e}function Wm(i,t,e,s={}){const n=i.keys,r=s.mode==="single";let o,a,l,c;if(t===null)return;let h=!1;for(o=0,a=n.length;o<a;++o){if(l=+n[o],l===e){if(h=!0,s.all)continue;break}c=i.values[l],Jt(c)&&(r||t===0||Fi(t)===Fi(c))&&(t+=c)}return!h&&!s.all?0:t}function EM(i,t){const{iScale:e,vScale:s}=t,n=e.axis==="x"?"x":"y",r=s.axis==="x"?"x":"y",o=Object.keys(i),a=new Array(o.length);let l,c,h;for(l=0,c=o.length;l<c;++l)h=o[l],a[l]={[n]:h,[r]:i[h]};return a}function Rh(i,t){const e=i&&i.options.stacked;return e||e===void 0&&t.stack!==void 0}function kM(i,t,e){return`${i.id}.${t.id}.${e.stack||e.type}`}function AM(i){const{min:t,max:e,minDefined:s,maxDefined:n}=i.getUserBounds();return{min:s?t:Number.NEGATIVE_INFINITY,max:n?e:Number.POSITIVE_INFINITY}}function TM(i,t,e){const s=i[t]||(i[t]={});return s[e]||(s[e]={})}function qm(i,t,e,s){for(const n of t.getMatchingVisibleMetas(s).reverse()){const r=i[n.index];if(e&&r>0||!e&&r<0)return n.index}return null}function Ym(i,t){const{chart:e,_cachedMeta:s}=i,n=e._stacks||(e._stacks={}),{iScale:r,vScale:o,index:a}=s,l=r.axis,c=o.axis,h=kM(r,o,s),d=t.length;let u;for(let p=0;p<d;++p){const m=t[p],{[l]:f,[c]:b}=m,g=m._stacks||(m._stacks={});u=g[c]=TM(n,h,f),u[a]=b,u._top=qm(u,o,!0,s.type),u._bottom=qm(u,o,!1,s.type);const y=u._visualValues||(u._visualValues={});y[a]=b}}function Bh(i,t){const e=i.scales;return Object.keys(e).filter(s=>e[s].axis===t).shift()}function MM(i,t){return Qs(i,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function PM(i,t,e){return Qs(i,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function so(i,t){const e=i.controller.index,s=i.vScale&&i.vScale.axis;if(s){t=t||i._parsed;for(const n of t){const r=n._stacks;if(!r||r[s]===void 0||r[s][e]===void 0)return;delete r[s][e],r[s]._visualValues!==void 0&&r[s]._visualValues[e]!==void 0&&delete r[s]._visualValues[e]}}}const Nh=i=>i==="reset"||i==="none",Zm=(i,t)=>t?i:Object.assign({},i),$M=(i,t,e)=>i&&!t.hidden&&t._stacked&&{keys:S_(e,!0),values:null};class xi{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=Rh(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&so(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,s=this.getDataset(),n=(d,u,p,m)=>d==="x"?u:d==="r"?m:p,r=e.xAxisID=mt(s.xAxisID,Bh(t,"x")),o=e.yAxisID=mt(s.yAxisID,Bh(t,"y")),a=e.rAxisID=mt(s.rAxisID,Bh(t,"r")),l=e.indexAxis,c=e.iAxisID=n(l,r,o,a),h=e.vAxisID=n(l,o,r,a);e.xScale=this.getScaleForId(r),e.yScale=this.getScaleForId(o),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(c),e.vScale=this.getScaleForId(h)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Pm(this._data,this),t._stacked&&so(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),s=this._data;if(wt(e)){const n=this._cachedMeta;this._data=EM(e,n)}else if(s!==e){if(s){Pm(s,this);const n=this._cachedMeta;so(n),n._parsed=[]}e&&Object.isExtensible(e)&&mT(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,s=this.getDataset();let n=!1;this._dataCheck();const r=e._stacked;e._stacked=Rh(e.vScale,e),e.stack!==s.stack&&(n=!0,so(e),e.stack=s.stack),this._resyncElements(t),(n||r!==e._stacked)&&(Ym(this,e._parsed),e._stacked=Rh(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),s=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(s,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:s,_data:n}=this,{iScale:r,_stacked:o}=s,a=r.axis;let l=t===0&&e===n.length?!0:s._sorted,c=t>0&&s._parsed[t-1],h,d,u;if(this._parsing===!1)s._parsed=n,s._sorted=!0,u=n;else{jt(n[t])?u=this.parseArrayData(s,n,t,e):wt(n[t])?u=this.parseObjectData(s,n,t,e):u=this.parsePrimitiveData(s,n,t,e);const p=()=>d[a]===null||c&&d[a]<c[a];for(h=0;h<e;++h)s._parsed[h+t]=d=u[h],l&&(p()&&(l=!1),c=d);s._sorted=l}o&&Ym(this,u)}parsePrimitiveData(t,e,s,n){const{iScale:r,vScale:o}=t,a=r.axis,l=o.axis,c=r.getLabels(),h=r===o,d=new Array(n);let u,p,m;for(u=0,p=n;u<p;++u)m=u+s,d[u]={[a]:h||r.parse(c[m],m),[l]:o.parse(e[m],m)};return d}parseArrayData(t,e,s,n){const{xScale:r,yScale:o}=t,a=new Array(n);let l,c,h,d;for(l=0,c=n;l<c;++l)h=l+s,d=e[h],a[l]={x:r.parse(d[0],h),y:o.parse(d[1],h)};return a}parseObjectData(t,e,s,n){const{xScale:r,yScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=new Array(n);let h,d,u,p;for(h=0,d=n;h<d;++h)u=h+s,p=e[u],c[h]={x:r.parse(Hs(p,a),u),y:o.parse(Hs(p,l),u)};return c}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,s){const n=this.chart,r=this._cachedMeta,o=e[t.axis],a={keys:S_(n,!0),values:e._stacks[t.axis]._visualValues};return Wm(a,o,r.index,{mode:s})}updateRangeFromParsed(t,e,s,n){const r=s[e.axis];let o=r===null?NaN:r;const a=n&&s._stacks[e.axis];n&&a&&(n.values=a,o=Wm(n,r,this._cachedMeta.index)),t.min=Math.min(t.min,o),t.max=Math.max(t.max,o)}getMinMax(t,e){const s=this._cachedMeta,n=s._parsed,r=s._sorted&&t===s.iScale,o=n.length,a=this._getOtherScale(t),l=$M(e,s,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:h,max:d}=AM(a);let u,p;function m(){p=n[u];const f=p[a.axis];return!Jt(p[t.axis])||h>f||d<f}for(u=0;u<o&&!(!m()&&(this.updateRangeFromParsed(c,t,p,l),r));++u);if(r){for(u=o-1;u>=0;--u)if(!m()){this.updateRangeFromParsed(c,t,p,l);break}}return c}getAllParsedValues(t){const e=this._cachedMeta._parsed,s=[];let n,r,o;for(n=0,r=e.length;n<r;++n)o=e[n][t.axis],Jt(o)&&s.push(o);return s}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,s=e.iScale,n=e.vScale,r=this.getParsed(t);return{label:s?""+s.getLabelForValue(r[s.axis]):"",value:n?""+n.getLabelForValue(r[n.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=SM(mt(this.options.clip,CM(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,s=this._cachedMeta,n=s.data||[],r=e.chartArea,o=[],a=this._drawStart||0,l=this._drawCount||n.length-a,c=this.options.drawActiveElementsOnTop;let h;for(s.dataset&&s.dataset.draw(t,r,a,l),h=a;h<a+l;++h){const d=n[h];d.hidden||(d.active&&c?o.push(d):d.draw(t,r))}for(h=0;h<o.length;++h)o[h].draw(t,r)}getStyle(t,e){const s=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(s):this.resolveDataElementOptions(t||0,s)}getContext(t,e,s){const n=this.getDataset();let r;if(t>=0&&t<this._cachedMeta.data.length){const o=this._cachedMeta.data[t];r=o.$context||(o.$context=PM(this.getContext(),t,o)),r.parsed=this.getParsed(t),r.raw=n.data[t],r.index=r.dataIndex=t}else r=this.$context||(this.$context=MM(this.chart.getContext(),this.index)),r.dataset=n,r.index=r.datasetIndex=this.index;return r.active=!!e,r.mode=s,r}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",s){const n=e==="active",r=this._cachedDataOpts,o=t+"-"+e,a=r[o],l=this.enableOptionSharing&&Qo(s);if(a)return Zm(a,l);const c=this.chart.config,h=c.datasetElementScopeKeys(this._type,t),d=n?[`${t}Hover`,"hover",t,""]:[t,""],u=c.getOptionScopes(this.getDataset(),h),p=Object.keys(Ht.elements[t]),m=()=>this.getContext(s,n,e),f=c.resolveNamedOptions(u,p,m,d);return f.$shared&&(f.$shared=l,r[o]=Object.freeze(Zm(f,l))),f}_resolveAnimations(t,e,s){const n=this.chart,r=this._cachedDataOpts,o=`animation-${e}`,a=r[o];if(a)return a;let l;if(n.options.animation!==!1){const h=this.chart.config,d=h.datasetAnimationScopeKeys(this._type,e),u=h.getOptionScopes(this.getDataset(),d);l=h.createResolver(u,this.getContext(t,s,e))}const c=new C_(n,l&&l.animations);return l&&l._cacheable&&(r[o]=Object.freeze(c)),c}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||Nh(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const s=this.resolveDataElementOptions(t,e),n=this._sharedOptions,r=this.getSharedOptions(s),o=this.includeOptions(e,r)||r!==n;return this.updateSharedOptions(r,e,s),{sharedOptions:r,includeOptions:o}}updateElement(t,e,s,n){Nh(n)?Object.assign(t,s):this._resolveAnimations(e,n).update(t,s)}updateSharedOptions(t,e,s){t&&!Nh(e)&&this._resolveAnimations(void 0,e).update(t,s)}_setStyle(t,e,s,n){t.active=n;const r=this.getStyle(e,n);this._resolveAnimations(e,s,n).update(t,{options:!n&&this.getSharedOptions(r)||r})}removeHoverStyle(t,e,s){this._setStyle(t,s,"active",!1)}setHoverStyle(t,e,s){this._setStyle(t,s,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,s=this._cachedMeta.data;for(const[a,l,c]of this._syncList)this[a](l,c);this._syncList=[];const n=s.length,r=e.length,o=Math.min(r,n);o&&this.parse(0,o),r>n?this._insertElements(n,r-n,t):r<n&&this._removeElements(r,n-r)}_insertElements(t,e,s=!0){const n=this._cachedMeta,r=n.data,o=t+e;let a;const l=c=>{for(c.length+=e,a=c.length-1;a>=o;a--)c[a]=c[a-e]};for(l(r),a=t;a<o;++a)r[a]=new this.dataElementType;this._parsing&&l(n._parsed),this.parse(t,e),s&&this.updateElements(r,t,e,"reset")}updateElements(t,e,s,n){}_removeElements(t,e){const s=this._cachedMeta;if(this._parsing){const n=s._parsed.splice(t,e);s._stacked&&so(s,n)}s.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,s,n]=t;this[e](s,n)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const s=arguments.length-2;s&&this._sync(["_insertElements",t,s])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}it(xi,"defaults",{}),it(xi,"datasetElementType",null),it(xi,"dataElementType",null);function OM(i,t){if(!i._cache.$bar){const e=i.getMatchingVisibleMetas(t);let s=[];for(let n=0,r=e.length;n<r;n++)s=s.concat(e[n].controller.getAllParsedValues(i));i._cache.$bar=s_(s.sort((n,r)=>n-r))}return i._cache.$bar}function DM(i){const t=i.iScale,e=OM(t,i.type);let s=t._length,n,r,o,a;const l=()=>{o===32767||o===-32768||(Qo(a)&&(s=Math.min(s,Math.abs(o-a)||s)),a=o)};for(n=0,r=e.length;n<r;++n)o=t.getPixelForValue(e[n]),l();for(a=void 0,n=0,r=t.ticks.length;n<r;++n)o=t.getPixelForTick(n),l();return s}function IM(i,t,e,s){const n=e.barThickness;let r,o;return bt(n)?(r=t.min*e.categoryPercentage,o=e.barPercentage):(r=n*s,o=1),{chunk:r/s,ratio:o,start:t.pixels[i]-r/2}}function zM(i,t,e,s){const n=t.pixels,r=n[i];let o=i>0?n[i-1]:null,a=i<n.length-1?n[i+1]:null;const l=e.categoryPercentage;o===null&&(o=r-(a===null?t.end-t.start:a-r)),a===null&&(a=r+r-o);const c=r-(r-Math.min(o,a))/2*l;return{chunk:Math.abs(a-o)/2*l/s,ratio:e.barPercentage,start:c}}function LM(i,t,e,s){const n=e.parse(i[0],s),r=e.parse(i[1],s),o=Math.min(n,r),a=Math.max(n,r);let l=o,c=a;Math.abs(o)>Math.abs(a)&&(l=a,c=o),t[e.axis]=c,t._custom={barStart:l,barEnd:c,start:n,end:r,min:o,max:a}}function E_(i,t,e,s){return jt(i)?LM(i,t,e,s):t[e.axis]=e.parse(i,s),t}function Gm(i,t,e,s){const n=i.iScale,r=i.vScale,o=n.getLabels(),a=n===r,l=[];let c,h,d,u;for(c=e,h=e+s;c<h;++c)u=t[c],d={},d[n.axis]=a||n.parse(o[c],c),l.push(E_(u,d,r,c));return l}function Fh(i){return i&&i.barStart!==void 0&&i.barEnd!==void 0}function RM(i,t,e){return i!==0?Fi(i):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function BM(i){let t,e,s,n,r;return i.horizontal?(t=i.base>i.x,e="left",s="right"):(t=i.base<i.y,e="bottom",s="top"),t?(n="end",r="start"):(n="start",r="end"),{start:e,end:s,reverse:t,top:n,bottom:r}}function NM(i,t,e,s){let n=t.borderSkipped;const r={};if(!n){i.borderSkipped=r;return}if(n===!0){i.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:o,end:a,reverse:l,top:c,bottom:h}=BM(i);n==="middle"&&e&&(i.enableBorderRadius=!0,(e._top||0)===s?n=c:(e._bottom||0)===s?n=h:(r[Xm(h,o,a,l)]=!0,n=c)),r[Xm(n,o,a,l)]=!0,i.borderSkipped=r}function Xm(i,t,e,s){return s?(i=FM(i,t,e),i=Km(i,e,t)):i=Km(i,t,e),i}function FM(i,t,e){return i===t?e:i===e?t:i}function Km(i,t,e){return i==="start"?t:i==="end"?e:i}function UM(i,{inflateAmount:t},e){i.inflateAmount=t==="auto"?e===1?.33:0:t}class Pl extends xi{parsePrimitiveData(t,e,s,n){return Gm(t,e,s,n)}parseArrayData(t,e,s,n){return Gm(t,e,s,n)}parseObjectData(t,e,s,n){const{iScale:r,vScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=r.axis==="x"?a:l,h=o.axis==="x"?a:l,d=[];let u,p,m,f;for(u=s,p=s+n;u<p;++u)f=e[u],m={},m[r.axis]=r.parse(Hs(f,c),u),d.push(E_(Hs(f,h),m,o,u));return d}updateRangeFromParsed(t,e,s,n){super.updateRangeFromParsed(t,e,s,n);const r=s._custom;r&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:s,vScale:n}=e,r=this.getParsed(t),o=r._custom,a=Fh(o)?"["+o.start+", "+o.end+"]":""+n.getLabelForValue(r[n.axis]);return{label:""+s.getLabelForValue(r[s.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,s,n){const r=n==="reset",{index:o,_cachedMeta:{vScale:a}}=this,l=a.getBasePixel(),c=a.isHorizontal(),h=this._getRuler(),{sharedOptions:d,includeOptions:u}=this._getSharedOptions(e,n);for(let p=e;p<e+s;p++){const m=this.getParsed(p),f=r||bt(m[a.axis])?{base:l,head:l}:this._calculateBarValuePixels(p),b=this._calculateBarIndexPixels(p,h),g=(m._stacks||{})[a.axis],y={horizontal:c,base:f.base,enableBorderRadius:!g||Fh(m._custom)||o===g._top||o===g._bottom,x:c?f.head:b.center,y:c?b.center:f.head,height:c?b.size:Math.abs(f.size),width:c?Math.abs(f.size):b.size};u&&(y.options=d||this.resolveDataElementOptions(p,t[p].active?"active":n));const v=y.options||t[p].options;NM(y,v,g,o),UM(y,v,h.ratio),this.updateElement(t[p],p,y,n)}}_getStacks(t,e){const{iScale:s}=this._cachedMeta,n=s.getMatchingVisibleMetas(this._type).filter(h=>h.controller.options.grouped),r=s.options.stacked,o=[],a=this._cachedMeta.controller.getParsed(e),l=a&&a[s.axis],c=h=>{const d=h._parsed.find(p=>p[s.axis]===l),u=d&&d[h.vScale.axis];if(bt(u)||isNaN(u))return!0};for(const h of n)if(!(e!==void 0&&c(h))&&((r===!1||o.indexOf(h.stack)===-1||r===void 0&&h.stack===void 0)&&o.push(h.stack),h.index===t))break;return o.length||o.push(void 0),o}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(s=>t[s].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const s of this.chart.data.datasets)t[mt(this.chart.options.indexAxis==="x"?s.xAxisID:s.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,s){const n=this._getStacks(t,s),r=e!==void 0?n.indexOf(e):-1;return r===-1?n.length-1:r}_getRuler(){const t=this.options,e=this._cachedMeta,s=e.iScale,n=[];let r,o;for(r=0,o=e.data.length;r<o;++r)n.push(s.getPixelForValue(this.getParsed(r)[s.axis],r));const a=t.barThickness;return{min:a||DM(e),pixels:n,start:s._startPixel,end:s._endPixel,stackCount:this._getStackCount(),scale:s,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:s,index:n},options:{base:r,minBarLength:o}}=this,a=r||0,l=this.getParsed(t),c=l._custom,h=Fh(c);let d=l[e.axis],u=0,p=s?this.applyStack(e,l,s):d,m,f;p!==d&&(u=p-d,p=d),h&&(d=c.barStart,p=c.barEnd-c.barStart,d!==0&&Fi(d)!==Fi(c.barEnd)&&(u=0),u+=d);const b=!bt(r)&&!h?r:u;let g=e.getPixelForValue(b);if(this.chart.getDataVisibility(t)?m=e.getPixelForValue(u+p):m=g,f=m-g,Math.abs(f)<o){f=RM(f,e,a)*o,d===a&&(g-=f/2);const y=e.getPixelForDecimal(0),v=e.getPixelForDecimal(1),_=Math.min(y,v),x=Math.max(y,v);g=Math.max(Math.min(g,x),_),m=g+f,s&&!h&&(l._stacks[e.axis]._visualValues[n]=e.getValueForPixel(m)-e.getValueForPixel(g))}if(g===e.getPixelForValue(a)){const y=Fi(f)*e.getLineWidthForValue(a)/2;g+=y,f-=y}return{size:f,base:g,head:m,center:m+f/2}}_calculateBarIndexPixels(t,e){const s=e.scale,n=this.options,r=n.skipNull,o=mt(n.maxBarThickness,1/0);let a,l;const c=this._getAxisCount();if(e.grouped){const h=r?this._getStackCount(t):e.stackCount,d=n.barThickness==="flex"?zM(t,e,n,h*c):IM(t,e,n,h*c),u=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,p=this._getAxis().indexOf(mt(u,this.getFirstScaleIdForIndexAxis())),m=this._getStackIndex(this.index,this._cachedMeta.stack,r?t:void 0)+p;a=d.start+d.chunk*m+d.chunk/2,l=Math.min(o,d.chunk*d.ratio)}else a=s.getPixelForValue(this.getParsed(t)[s.axis],t),l=Math.min(o,e.min*e.ratio);return{base:a-l/2,head:a+l/2,center:a,size:l}}draw(){const t=this._cachedMeta,e=t.vScale,s=t.data,n=s.length;let r=0;for(;r<n;++r)this.getParsed(r)[e.axis]!==null&&!s[r].hidden&&s[r].draw(this._ctx)}}it(Pl,"id","bar"),it(Pl,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),it(Pl,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class $l extends xi{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,s,n){const r=super.parsePrimitiveData(t,e,s,n);for(let o=0;o<r.length;o++)r[o]._custom=this.resolveDataElementOptions(o+s).radius;return r}parseArrayData(t,e,s,n){const r=super.parseArrayData(t,e,s,n);for(let o=0;o<r.length;o++){const a=e[s+o];r[o]._custom=mt(a[2],this.resolveDataElementOptions(o+s).radius)}return r}parseObjectData(t,e,s,n){const r=super.parseObjectData(t,e,s,n);for(let o=0;o<r.length;o++){const a=e[s+o];r[o]._custom=mt(a&&a.r&&+a.r,this.resolveDataElementOptions(o+s).radius)}return r}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let s=t.length-1;s>=0;--s)e=Math.max(e,t[s].size(this.resolveDataElementOptions(s))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart.data.labels||[],{xScale:n,yScale:r}=e,o=this.getParsed(t),a=n.getLabelForValue(o.x),l=r.getLabelForValue(o.y),c=o._custom;return{label:s[t]||"",value:"("+a+", "+l+(c?", "+c:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,s,n){const r=n==="reset",{iScale:o,vScale:a}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(e,n),h=o.axis,d=a.axis;for(let u=e;u<e+s;u++){const p=t[u],m=!r&&this.getParsed(u),f={},b=f[h]=r?o.getPixelForDecimal(.5):o.getPixelForValue(m[h]),g=f[d]=r?a.getBasePixel():a.getPixelForValue(m[d]);f.skip=isNaN(b)||isNaN(g),c&&(f.options=l||this.resolveDataElementOptions(u,p.active?"active":n),r&&(f.options.radius=0)),this.updateElement(p,u,f,n)}}resolveDataElementOptions(t,e){const s=this.getParsed(t);let n=super.resolveDataElementOptions(t,e);n.$shared&&(n=Object.assign({},n,{$shared:!1}));const r=n.radius;return e!=="active"&&(n.radius=0),n.radius+=mt(s&&s._custom,r),n}}it($l,"id","bubble"),it($l,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),it($l,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function jM(i,t,e){let s=1,n=1,r=0,o=0;if(t<Vt){const a=i,l=a+t,c=Math.cos(a),h=Math.sin(a),d=Math.cos(l),u=Math.sin(l),p=(v,_,x)=>Jo(v,a,l,!0)?1:Math.max(_,_*e,x,x*e),m=(v,_,x)=>Jo(v,a,l,!0)?-1:Math.min(_,_*e,x,x*e),f=p(0,c,d),b=p(re,h,u),g=m(kt,c,d),y=m(kt+re,h,u);s=(f-g)/2,n=(b-y)/2,r=-(f+g)/2,o=-(b+y)/2}return{ratioX:s,ratioY:n,offsetX:r,offsetY:o}}class gn extends xi{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const s=this.getDataset().data,n=this._cachedMeta;if(this._parsing===!1)n._parsed=s;else{let r=l=>+s[l];if(wt(s[t])){const{key:l="value"}=this._parsing;r=c=>+Hs(s[c],l)}let o,a;for(o=t,a=t+e;o<a;++o)n._parsed[o]=r(o)}}_getRotation(){return wi(this.options.rotation-90)}_getCircumference(){return wi(this.options.circumference)}_getRotationExtents(){let t=Vt,e=-Vt;for(let s=0;s<this.chart.data.datasets.length;++s)if(this.chart.isDatasetVisible(s)&&this.chart.getDatasetMeta(s).type===this._type){const n=this.chart.getDatasetMeta(s).controller,r=n._getRotation(),o=n._getCircumference();t=Math.min(t,r),e=Math.max(e,r+o)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:s}=e,n=this._cachedMeta,r=n.data,o=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,a=Math.max((Math.min(s.width,s.height)-o)/2,0),l=Math.min(tT(this.options.cutout,a),1),c=this._getRingWeight(this.index),{circumference:h,rotation:d}=this._getRotationExtents(),{ratioX:u,ratioY:p,offsetX:m,offsetY:f}=jM(d,h,l),b=(s.width-o)/u,g=(s.height-o)/p,y=Math.max(Math.min(b,g)/2,0),v=Qv(this.options.radius,y),_=Math.max(v*l,0),x=(v-_)/this._getVisibleDatasetWeightTotal();this.offsetX=m*v,this.offsetY=f*v,n.total=this.calculateTotal(),this.outerRadius=v-x*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-x*c,0),this.updateElements(r,0,r.length,t)}_circumference(t,e){const s=this.options,n=this._cachedMeta,r=this._getCircumference();return e&&s.animation.animateRotate||!this.chart.getDataVisibility(t)||n._parsed[t]===null||n.data[t].hidden?0:this.calculateCircumference(n._parsed[t]*r/Vt)}updateElements(t,e,s,n){const r=n==="reset",o=this.chart,a=o.chartArea,l=o.options.animation,c=(a.left+a.right)/2,h=(a.top+a.bottom)/2,d=r&&l.animateScale,u=d?0:this.innerRadius,p=d?0:this.outerRadius,{sharedOptions:m,includeOptions:f}=this._getSharedOptions(e,n);let b=this._getRotation(),g;for(g=0;g<e;++g)b+=this._circumference(g,r);for(g=e;g<e+s;++g){const y=this._circumference(g,r),v=t[g],_={x:c+this.offsetX,y:h+this.offsetY,startAngle:b,endAngle:b+y,circumference:y,outerRadius:p,innerRadius:u};f&&(_.options=m||this.resolveDataElementOptions(g,v.active?"active":n)),b+=y,this.updateElement(v,g,_,n)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let s=0,n;for(n=0;n<e.length;n++){const r=t._parsed[n];r!==null&&!isNaN(r)&&this.chart.getDataVisibility(n)&&!e[n].hidden&&(s+=Math.abs(r))}return s}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?Vt*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,n=s.data.labels||[],r=xa(e._parsed[t],s.options.locale);return{label:n[t]||"",value:r}}getMaxBorderWidth(t){let e=0;const s=this.chart;let n,r,o,a,l;if(!t){for(n=0,r=s.data.datasets.length;n<r;++n)if(s.isDatasetVisible(n)){o=s.getDatasetMeta(n),t=o.data,a=o.controller;break}}if(!t)return 0;for(n=0,r=t.length;n<r;++n)l=a.resolveDataElementOptions(n),l.borderAlign!=="inner"&&(e=Math.max(e,l.borderWidth||0,l.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let s=0,n=t.length;s<n;++s){const r=this.resolveDataElementOptions(s);e=Math.max(e,r.offset||0,r.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let s=0;s<t;++s)this.chart.isDatasetVisible(s)&&(e+=this._getRingWeight(s));return e}_getRingWeight(t){return Math.max(mt(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}it(gn,"id","doughnut"),it(gn,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),it(gn,"descriptors",{_scriptable:i=>i!=="spacing",_indexable:i=>i!=="spacing"&&!i.startsWith("borderDash")&&!i.startsWith("hoverBorderDash")}),it(gn,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(i){const t=i.data,{labels:{pointStyle:e,textAlign:s,color:n,useBorderRadius:r,borderRadius:o}}=i.legend.options;return t.labels.length&&t.datasets.length?t.labels.map((a,l)=>{const c=i.getDatasetMeta(0).controller.getStyle(l);return{text:a,fillStyle:c.backgroundColor,fontColor:n,hidden:!i.getDataVisibility(l),lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:c.borderWidth,strokeStyle:c.borderColor,textAlign:s,pointStyle:e,borderRadius:r&&(o||c.borderRadius),index:l}}):[]}},onClick(i,t,e){e.chart.toggleDataVisibility(t.index),e.chart.update()}}}});class Ol extends xi{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:s,data:n=[],_dataset:r}=e,o=this.chart._animationsDisabled;let{start:a,count:l}=o_(e,n,o);this._drawStart=a,this._drawCount=l,a_(e)&&(a=0,l=n.length),s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!r._decimated,s.points=n;const c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(s,void 0,{animated:!o,options:c},t),this.updateElements(n,a,l,t)}updateElements(t,e,s,n){const r=n==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:h,includeOptions:d}=this._getSharedOptions(e,n),u=o.axis,p=a.axis,{spanGaps:m,segment:f}=this.options,b=vr(m)?m:Number.POSITIVE_INFINITY,g=this.chart._animationsDisabled||r||n==="none",y=e+s,v=t.length;let _=e>0&&this.getParsed(e-1);for(let x=0;x<v;++x){const S=t[x],k=g?S:{};if(x<e||x>=y){k.skip=!0;continue}const T=this.getParsed(x),M=bt(T[p]),O=k[u]=o.getPixelForValue(T[u],x),R=k[p]=r||M?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,T,l):T[p],x);k.skip=isNaN(O)||isNaN(R)||M,k.stop=x>0&&Math.abs(T[u]-_[u])>b,f&&(k.parsed=T,k.raw=c.data[x]),d&&(k.options=h||this.resolveDataElementOptions(x,S.active?"active":n)),g||this.updateElement(S,x,k,n),_=T}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,s=e.options&&e.options.borderWidth||0,n=t.data||[];if(!n.length)return s;const r=n[0].size(this.resolveDataElementOptions(0)),o=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(s,r,o)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}it(Ol,"id","line"),it(Ol,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),it(Ol,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class $o extends xi{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,s=this.chart,n=s.data.labels||[],r=xa(e._parsed[t].r,s.options.locale);return{label:n[t]||"",value:r}}parseObjectData(t,e,s,n){return m_.bind(this)(t,e,s,n)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((s,n)=>{const r=this.getParsed(n).r;!isNaN(r)&&this.chart.getDataVisibility(n)&&(r<e.min&&(e.min=r),r>e.max&&(e.max=r))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,s=t.options,n=Math.min(e.right-e.left,e.bottom-e.top),r=Math.max(n/2,0),o=Math.max(s.cutoutPercentage?r/100*s.cutoutPercentage:1,0),a=(r-o)/t.getVisibleDatasetCount();this.outerRadius=r-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,e,s,n){const r=n==="reset",o=this.chart,a=o.options.animation,l=this._cachedMeta.rScale,c=l.xCenter,h=l.yCenter,d=l.getIndexAngle(0)-.5*kt;let u=d,p;const m=360/this.countVisibleElements();for(p=0;p<e;++p)u+=this._computeAngle(p,n,m);for(p=e;p<e+s;p++){const f=t[p];let b=u,g=u+this._computeAngle(p,n,m),y=o.getDataVisibility(p)?l.getDistanceFromCenterForValue(this.getParsed(p).r):0;u=g,r&&(a.animateScale&&(y=0),a.animateRotate&&(b=g=d));const v={x:c,y:h,innerRadius:0,outerRadius:y,startAngle:b,endAngle:g,options:this.resolveDataElementOptions(p,f.active?"active":n)};this.updateElement(f,p,v,n)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((s,n)=>{!isNaN(this.getParsed(n).r)&&this.chart.getDataVisibility(n)&&e++}),e}_computeAngle(t,e,s){return this.chart.getDataVisibility(t)?wi(this.resolveDataElementOptions(t,e).angle||s):0}}it($o,"id","polarArea"),it($o,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),it($o,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(i){const t=i.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:e,color:s}}=i.legend.options;return t.labels.map((n,r)=>{const o=i.getDatasetMeta(0).controller.getStyle(r);return{text:n,fillStyle:o.backgroundColor,strokeStyle:o.borderColor,fontColor:s,lineWidth:o.borderWidth,pointStyle:e,hidden:!i.getDataVisibility(r),index:r}})}return[]}},onClick(i,t,e){e.chart.toggleDataVisibility(t.index),e.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class Vd extends gn{}it(Vd,"id","pie"),it(Vd,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class Dl extends xi{getLabelAndValue(t){const e=this._cachedMeta.vScale,s=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(s[e.axis])}}parseObjectData(t,e,s,n){return m_.bind(this)(t,e,s,n)}update(t){const e=this._cachedMeta,s=e.dataset,n=e.data||[],r=e.iScale.getLabels();if(s.points=n,t!=="resize"){const o=this.resolveDatasetElementOptions(t);this.options.showLine||(o.borderWidth=0);const a={_loop:!0,_fullLoop:r.length===n.length,options:o};this.updateElement(s,void 0,a,t)}this.updateElements(n,0,n.length,t)}updateElements(t,e,s,n){const r=this._cachedMeta.rScale,o=n==="reset";for(let a=e;a<e+s;a++){const l=t[a],c=this.resolveDataElementOptions(a,l.active?"active":n),h=r.getPointPositionForValue(a,this.getParsed(a).r),d=o?r.xCenter:h.x,u=o?r.yCenter:h.y,p={x:d,y:u,angle:h.angle,skip:isNaN(d)||isNaN(u),options:c};this.updateElement(l,a,p,n)}}}it(Dl,"id","radar"),it(Dl,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),it(Dl,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class Il extends xi{getLabelAndValue(t){const e=this._cachedMeta,s=this.chart.data.labels||[],{xScale:n,yScale:r}=e,o=this.getParsed(t),a=n.getLabelForValue(o.x),l=r.getLabelForValue(o.y);return{label:s[t]||"",value:"("+a+", "+l+")"}}update(t){const e=this._cachedMeta,{data:s=[]}=e,n=this.chart._animationsDisabled;let{start:r,count:o}=o_(e,s,n);if(this._drawStart=r,this._drawCount=o,a_(e)&&(r=0,o=s.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:l}=e;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!l._decimated,a.points=s;const c=this.resolveDatasetElementOptions(t);c.segment=this.options.segment,this.updateElement(a,void 0,{animated:!n,options:c},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(s,r,o,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,s,n){const r=n==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,h=this.resolveDataElementOptions(e,n),d=this.getSharedOptions(h),u=this.includeOptions(n,d),p=o.axis,m=a.axis,{spanGaps:f,segment:b}=this.options,g=vr(f)?f:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||r||n==="none";let v=e>0&&this.getParsed(e-1);for(let _=e;_<e+s;++_){const x=t[_],S=this.getParsed(_),k=y?x:{},T=bt(S[m]),M=k[p]=o.getPixelForValue(S[p],_),O=k[m]=r||T?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,S,l):S[m],_);k.skip=isNaN(M)||isNaN(O)||T,k.stop=_>0&&Math.abs(S[p]-v[p])>g,b&&(k.parsed=S,k.raw=c.data[_]),u&&(k.options=d||this.resolveDataElementOptions(_,x.active?"active":n)),y||this.updateElement(x,_,k,n),v=S}this.updateSharedOptions(d,n,h)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let a=0;for(let l=e.length-1;l>=0;--l)a=Math.max(a,e[l].size(this.resolveDataElementOptions(l))/2);return a>0&&a}const s=t.dataset,n=s.options&&s.options.borderWidth||0;if(!e.length)return n;const r=e[0].size(this.resolveDataElementOptions(0)),o=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(n,r,o)/2}}it(Il,"id","scatter"),it(Il,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),it(Il,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var VM=Object.freeze({__proto__:null,BarController:Pl,BubbleController:$l,DoughnutController:gn,LineController:Ol,PieController:Vd,PolarAreaController:$o,RadarController:Dl,ScatterController:Il});function ln(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class ap{constructor(t){it(this,"options"),this.options=t||{}}static override(t){Object.assign(ap.prototype,t)}init(){}formats(){return ln()}parse(){return ln()}format(){return ln()}add(){return ln()}diff(){return ln()}startOf(){return ln()}endOf(){return ln()}}var HM={_date:ap};function WM(i,t,e,s){const{controller:n,data:r,_sorted:o}=i,a=n._cachedMeta.iScale,l=i.dataset&&i.dataset.options?i.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&o&&r.length){const c=a._reversePixels?pT:ts;if(s){if(n._sharedOptions){const h=r[0],d=typeof h.getRange=="function"&&h.getRange(t);if(d){const u=c(r,t,e-d),p=c(r,t,e+d);return{lo:u.lo,hi:p.hi}}}}else{const h=c(r,t,e);if(l){const{vScale:d}=n._cachedMeta,{_parsed:u}=i,p=u.slice(0,h.lo+1).reverse().findIndex(f=>!bt(f[d.axis]));h.lo-=Math.max(0,p);const m=u.slice(h.hi).findIndex(f=>!bt(f[d.axis]));h.hi+=Math.max(0,m)}return h}}return{lo:0,hi:r.length-1}}function Yc(i,t,e,s,n){const r=i.getSortedVisibleDatasetMetas(),o=e[t];for(let a=0,l=r.length;a<l;++a){const{index:c,data:h}=r[a],{lo:d,hi:u}=WM(r[a],t,o,n);for(let p=d;p<=u;++p){const m=h[p];m.skip||s(m,c,p)}}}function qM(i){const t=i.indexOf("x")!==-1,e=i.indexOf("y")!==-1;return function(s,n){const r=t?Math.abs(s.x-n.x):0,o=e?Math.abs(s.y-n.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(o,2))}}function Uh(i,t,e,s,n){const r=[];return!n&&!i.isPointInArea(t)||Yc(i,e,t,function(o,a,l){!n&&!es(o,i.chartArea,0)||o.inRange(t.x,t.y,s)&&r.push({element:o,datasetIndex:a,index:l})},!0),r}function YM(i,t,e,s){let n=[];function r(o,a,l){const{startAngle:c,endAngle:h}=o.getProps(["startAngle","endAngle"],s),{angle:d}=e_(o,{x:t.x,y:t.y});Jo(d,c,h)&&n.push({element:o,datasetIndex:a,index:l})}return Yc(i,e,t,r),n}function ZM(i,t,e,s,n,r){let o=[];const a=qM(e);let l=Number.POSITIVE_INFINITY;function c(h,d,u){const p=h.inRange(t.x,t.y,n);if(s&&!p)return;const m=h.getCenterPoint(n);if(!(r||i.isPointInArea(m))&&!p)return;const f=a(t,m);f<l?(o=[{element:h,datasetIndex:d,index:u}],l=f):f===l&&o.push({element:h,datasetIndex:d,index:u})}return Yc(i,e,t,c),o}function jh(i,t,e,s,n,r){return!r&&!i.isPointInArea(t)?[]:e==="r"&&!s?YM(i,t,e,n):ZM(i,t,e,s,n,r)}function Qm(i,t,e,s,n){const r=[],o=e==="x"?"inXRange":"inYRange";let a=!1;return Yc(i,e,t,(l,c,h)=>{l[o]&&l[o](t[e],n)&&(r.push({element:l,datasetIndex:c,index:h}),a=a||l.inRange(t.x,t.y,n))}),s&&!a?[]:r}var GM={modes:{index(i,t,e,s){const n=dn(t,i),r=e.axis||"x",o=e.includeInvisible||!1,a=e.intersect?Uh(i,n,r,s,o):jh(i,n,r,!1,s,o),l=[];return a.length?(i.getSortedVisibleDatasetMetas().forEach(c=>{const h=a[0].index,d=c.data[h];d&&!d.skip&&l.push({element:d,datasetIndex:c.index,index:h})}),l):[]},dataset(i,t,e,s){const n=dn(t,i),r=e.axis||"xy",o=e.includeInvisible||!1;let a=e.intersect?Uh(i,n,r,s,o):jh(i,n,r,!1,s,o);if(a.length>0){const l=a[0].datasetIndex,c=i.getDatasetMeta(l).data;a=[];for(let h=0;h<c.length;++h)a.push({element:c[h],datasetIndex:l,index:h})}return a},point(i,t,e,s){const n=dn(t,i),r=e.axis||"xy",o=e.includeInvisible||!1;return Uh(i,n,r,s,o)},nearest(i,t,e,s){const n=dn(t,i),r=e.axis||"xy",o=e.includeInvisible||!1;return jh(i,n,r,e.intersect,s,o)},x(i,t,e,s){const n=dn(t,i);return Qm(i,n,"x",e.intersect,s)},y(i,t,e,s){const n=dn(t,i);return Qm(i,n,"y",e.intersect,s)}}};const k_=["left","top","right","bottom"];function no(i,t){return i.filter(e=>e.pos===t)}function Jm(i,t){return i.filter(e=>k_.indexOf(e.pos)===-1&&e.box.axis===t)}function ro(i,t){return i.sort((e,s)=>{const n=t?s:e,r=t?e:s;return n.weight===r.weight?n.index-r.index:n.weight-r.weight})}function XM(i){const t=[];let e,s,n,r,o,a;for(e=0,s=(i||[]).length;e<s;++e)n=i[e],{position:r,options:{stack:o,stackWeight:a=1}}=n,t.push({index:e,box:n,pos:r,horizontal:n.isHorizontal(),weight:n.weight,stack:o&&r+o,stackWeight:a});return t}function KM(i){const t={};for(const e of i){const{stack:s,pos:n,stackWeight:r}=e;if(!s||!k_.includes(n))continue;const o=t[s]||(t[s]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=r}return t}function QM(i,t){const e=KM(i),{vBoxMaxWidth:s,hBoxMaxHeight:n}=t;let r,o,a;for(r=0,o=i.length;r<o;++r){a=i[r];const{fullSize:l}=a.box,c=e[a.stack],h=c&&a.stackWeight/c.weight;a.horizontal?(a.width=h?h*s:l&&t.availableWidth,a.height=n):(a.width=s,a.height=h?h*n:l&&t.availableHeight)}return e}function JM(i){const t=XM(i),e=ro(t.filter(c=>c.box.fullSize),!0),s=ro(no(t,"left"),!0),n=ro(no(t,"right")),r=ro(no(t,"top"),!0),o=ro(no(t,"bottom")),a=Jm(t,"x"),l=Jm(t,"y");return{fullSize:e,leftAndTop:s.concat(r),rightAndBottom:n.concat(l).concat(o).concat(a),chartArea:no(t,"chartArea"),vertical:s.concat(n).concat(l),horizontal:r.concat(o).concat(a)}}function tg(i,t,e,s){return Math.max(i[e],t[e])+Math.max(i[s],t[s])}function A_(i,t){i.top=Math.max(i.top,t.top),i.left=Math.max(i.left,t.left),i.bottom=Math.max(i.bottom,t.bottom),i.right=Math.max(i.right,t.right)}function tP(i,t,e,s){const{pos:n,box:r}=e,o=i.maxPadding;if(!wt(n)){e.size&&(i[n]-=e.size);const d=s[e.stack]||{size:0,count:1};d.size=Math.max(d.size,e.horizontal?r.height:r.width),e.size=d.size/d.count,i[n]+=e.size}r.getPadding&&A_(o,r.getPadding());const a=Math.max(0,t.outerWidth-tg(o,i,"left","right")),l=Math.max(0,t.outerHeight-tg(o,i,"top","bottom")),c=a!==i.w,h=l!==i.h;return i.w=a,i.h=l,e.horizontal?{same:c,other:h}:{same:h,other:c}}function eP(i){const t=i.maxPadding;function e(s){const n=Math.max(t[s]-i[s],0);return i[s]+=n,n}i.y+=e("top"),i.x+=e("left"),e("right"),e("bottom")}function iP(i,t){const e=t.maxPadding;function s(n){const r={left:0,top:0,right:0,bottom:0};return n.forEach(o=>{r[o]=Math.max(t[o],e[o])}),r}return s(i?["left","right"]:["top","bottom"])}function go(i,t,e,s){const n=[];let r,o,a,l,c,h;for(r=0,o=i.length,c=0;r<o;++r){a=i[r],l=a.box,l.update(a.width||t.w,a.height||t.h,iP(a.horizontal,t));const{same:d,other:u}=tP(t,e,a,s);c|=d&&n.length,h=h||u,l.fullSize||n.push(a)}return c&&go(n,t,e,s)||h}function cl(i,t,e,s,n){i.top=e,i.left=t,i.right=t+s,i.bottom=e+n,i.width=s,i.height=n}function eg(i,t,e,s){const n=e.padding;let{x:r,y:o}=t;for(const a of i){const l=a.box,c=s[a.stack]||{placed:0,weight:1},h=a.stackWeight/c.weight||1;if(a.horizontal){const d=t.w*h,u=c.size||l.height;Qo(c.start)&&(o=c.start),l.fullSize?cl(l,n.left,o,e.outerWidth-n.right-n.left,u):cl(l,t.left+c.placed,o,d,u),c.start=o,c.placed+=d,o=l.bottom}else{const d=t.h*h,u=c.size||l.width;Qo(c.start)&&(r=c.start),l.fullSize?cl(l,r,n.top,u,e.outerHeight-n.bottom-n.top):cl(l,r,t.top+c.placed,u,d),c.start=r,c.placed+=d,r=l.right}}t.x=r,t.y=o}var $e={addBox(i,t){i.boxes||(i.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},i.boxes.push(t)},removeBox(i,t){const e=i.boxes?i.boxes.indexOf(t):-1;e!==-1&&i.boxes.splice(e,1)},configure(i,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(i,t,e,s){if(!i)return;const n=Ce(i.options.layout.padding),r=Math.max(t-n.width,0),o=Math.max(e-n.height,0),a=JM(i.boxes),l=a.vertical,c=a.horizontal;Mt(i.boxes,f=>{typeof f.beforeLayout=="function"&&f.beforeLayout()});const h=l.reduce((f,b)=>b.box.options&&b.box.options.display===!1?f:f+1,0)||1,d=Object.freeze({outerWidth:t,outerHeight:e,padding:n,availableWidth:r,availableHeight:o,vBoxMaxWidth:r/2/h,hBoxMaxHeight:o/2}),u=Object.assign({},n);A_(u,Ce(s));const p=Object.assign({maxPadding:u,w:r,h:o,x:n.left,y:n.top},n),m=QM(l.concat(c),d);go(a.fullSize,p,d,m),go(l,p,d,m),go(c,p,d,m)&&go(l,p,d,m),eP(p),eg(a.leftAndTop,p,d,m),p.x+=p.w,p.y+=p.h,eg(a.rightAndBottom,p,d,m),i.chartArea={left:p.left,top:p.top,right:p.left+p.w,bottom:p.top+p.h,height:p.h,width:p.w},Mt(a.chartArea,f=>{const b=f.box;Object.assign(b,i.chartArea),b.update(p.w,p.h,{left:0,top:0,right:0,bottom:0})})}};class T_{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,s){}removeEventListener(t,e,s){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,s,n){return e=Math.max(0,e||t.width),s=s||t.height,{width:e,height:Math.max(0,n?Math.floor(e/n):s)}}isAttached(t){return!0}updateConfig(t){}}class sP extends T_{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const zl="$chartjs",nP={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},ig=i=>i===null||i==="";function rP(i,t){const e=i.style,s=i.getAttribute("height"),n=i.getAttribute("width");if(i[zl]={initial:{height:s,width:n,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",ig(n)){const r=Nm(i,"width");r!==void 0&&(i.width=r)}if(ig(s))if(i.style.height==="")i.height=i.width/(t||2);else{const r=Nm(i,"height");r!==void 0&&(i.height=r)}return i}const M_=oM?{passive:!0}:!1;function oP(i,t,e){i&&i.addEventListener(t,e,M_)}function aP(i,t,e){i&&i.canvas&&i.canvas.removeEventListener(t,e,M_)}function lP(i,t){const e=nP[i.type]||i.type,{x:s,y:n}=dn(i,t);return{type:e,chart:t,native:i,x:s!==void 0?s:null,y:n!==void 0?n:null}}function cc(i,t){for(const e of i)if(e===t||e.contains(t))return!0}function cP(i,t,e){const s=i.canvas,n=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||cc(a.addedNodes,s),o=o&&!cc(a.removedNodes,s);o&&e()});return n.observe(document,{childList:!0,subtree:!0}),n}function hP(i,t,e){const s=i.canvas,n=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||cc(a.removedNodes,s),o=o&&!cc(a.addedNodes,s);o&&e()});return n.observe(document,{childList:!0,subtree:!0}),n}const ea=new Map;let sg=0;function P_(){const i=window.devicePixelRatio;i!==sg&&(sg=i,ea.forEach((t,e)=>{e.currentDevicePixelRatio!==i&&t()}))}function dP(i,t){ea.size||window.addEventListener("resize",P_),ea.set(i,t)}function uP(i){ea.delete(i),ea.size||window.removeEventListener("resize",P_)}function pP(i,t,e){const s=i.canvas,n=s&&op(s);if(!n)return;const r=r_((a,l)=>{const c=n.clientWidth;e(a,l),c<n.clientWidth&&e()},window),o=new ResizeObserver(a=>{const l=a[0],c=l.contentRect.width,h=l.contentRect.height;c===0&&h===0||r(c,h)});return o.observe(n),dP(i,r),o}function Vh(i,t,e){e&&e.disconnect(),t==="resize"&&uP(i)}function fP(i,t,e){const s=i.canvas,n=r_(r=>{i.ctx!==null&&e(lP(r,i))},i);return oP(s,t,n),n}class mP extends T_{acquireContext(t,e){const s=t&&t.getContext&&t.getContext("2d");return s&&s.canvas===t?(rP(t,e),s):null}releaseContext(t){const e=t.canvas;if(!e[zl])return!1;const s=e[zl].initial;["height","width"].forEach(r=>{const o=s[r];bt(o)?e.removeAttribute(r):e.setAttribute(r,o)});const n=s.style||{};return Object.keys(n).forEach(r=>{e.style[r]=n[r]}),e.width=e.width,delete e[zl],!0}addEventListener(t,e,s){this.removeEventListener(t,e);const n=t.$proxies||(t.$proxies={}),r={attach:cP,detach:hP,resize:pP}[e]||fP;n[e]=r(t,e,s)}removeEventListener(t,e){const s=t.$proxies||(t.$proxies={}),n=s[e];n&&(({attach:Vh,detach:Vh,resize:Vh}[e]||aP)(t,e,n),s[e]=void 0)}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,s,n){return rM(t,e,s,n)}isAttached(t){const e=t&&op(t);return!!(e&&e.isConnected)}}function gP(i){return!rp()||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas?sP:mP}var hl;let ps=(hl=class{constructor(){it(this,"x"),it(this,"y"),it(this,"active",!1),it(this,"options"),it(this,"$animations")}tooltipPosition(i){const{x:t,y:e}=this.getProps(["x","y"],i);return{x:t,y:e}}hasValue(){return vr(this.x)&&vr(this.y)}getProps(i,t){const e=this.$animations;if(!t||!e)return this;const s={};return i.forEach(n=>{s[n]=e[n]&&e[n].active()?e[n]._to:this[n]}),s}},it(hl,"defaults",{}),it(hl,"defaultRoutes"),hl);function bP(i,t){const e=i.options.ticks,s=yP(i),n=Math.min(e.maxTicksLimit||s,s),r=e.major.enabled?_P(t):[],o=r.length,a=r[0],l=r[o-1],c=[];if(o>n)return wP(t,c,r,o/n),c;const h=vP(r,t,n);if(o>0){let d,u;const p=o>1?Math.round((l-a)/(o-1)):null;for(dl(t,c,h,bt(p)?0:a-p,a),d=0,u=o-1;d<u;d++)dl(t,c,h,r[d],r[d+1]);return dl(t,c,h,l,bt(p)?t.length:l+p),c}return dl(t,c,h),c}function yP(i){const t=i.options.offset,e=i._tickSize(),s=i._length/e+(t?0:1),n=i._maxLength/e;return Math.floor(Math.min(s,n))}function vP(i,t,e){const s=xP(i),n=t.length/e;if(!s)return Math.max(n,1);const r=lT(s);for(let o=0,a=r.length-1;o<a;o++){const l=r[o];if(l>n)return l}return Math.max(n,1)}function _P(i){const t=[];let e,s;for(e=0,s=i.length;e<s;e++)i[e].major&&t.push(e);return t}function wP(i,t,e,s){let n=0,r=e[0],o;for(s=Math.ceil(s),o=0;o<i.length;o++)o===r&&(t.push(i[o]),n++,r=e[n*s])}function dl(i,t,e,s,n){const r=mt(s,0),o=Math.min(mt(n,i.length),i.length);let a=0,l,c,h;for(e=Math.ceil(e),n&&(l=n-s,e=l/Math.floor(l/e)),h=r;h<0;)a++,h=Math.round(r+a*e);for(c=Math.max(r,0);c<o;c++)c===h&&(t.push(i[c]),a++,h=Math.round(r+a*e))}function xP(i){const t=i.length;let e,s;if(t<2)return!1;for(s=i[0],e=1;e<t;++e)if(i[e]-i[e-1]!==s)return!1;return s}const CP=i=>i==="left"?"right":i==="right"?"left":i,ng=(i,t,e)=>t==="top"||t==="left"?i[t]+e:i[t]-e,rg=(i,t)=>Math.min(t||i,i);function og(i,t){const e=[],s=i.length/t,n=i.length;let r=0;for(;r<n;r+=s)e.push(i[Math.floor(r)]);return e}function SP(i,t,e){const s=i.ticks.length,n=Math.min(t,s-1),r=i._startPixel,o=i._endPixel,a=1e-6;let l=i.getPixelForTick(n),c;if(!(e&&(s===1?c=Math.max(l-r,o-l):t===0?c=(i.getPixelForTick(1)-l)/2:c=(l-i.getPixelForTick(n-1))/2,l+=n<t?c:-c,l<r-a||l>o+a)))return l}function EP(i,t){Mt(i,e=>{const s=e.gc,n=s.length/2;let r;if(n>t){for(r=0;r<n;++r)delete e.data[s[r]];s.splice(0,n)}})}function oo(i){return i.drawTicks?i.tickLength:0}function ag(i,t){if(!i.display)return 0;const e=de(i.font,t),s=Ce(i.padding);return(jt(i.text)?i.text.length:1)*e.lineHeight+s.height}function kP(i,t){return Qs(i,{scale:t,type:"scale"})}function AP(i,t,e){return Qs(i,{tick:e,index:t,type:"tick"})}function TP(i,t,e){let s=Ju(i);return(e&&t!=="right"||!e&&t==="right")&&(s=CP(s)),s}function MP(i,t,e,s){const{top:n,left:r,bottom:o,right:a,chart:l}=i,{chartArea:c,scales:h}=l;let d=0,u,p,m;const f=o-n,b=a-r;if(i.isHorizontal()){if(p=Me(s,r,a),wt(e)){const g=Object.keys(e)[0],y=e[g];m=h[g].getPixelForValue(y)+f-t}else e==="center"?m=(c.bottom+c.top)/2+f-t:m=ng(i,e,t);u=a-r}else{if(wt(e)){const g=Object.keys(e)[0],y=e[g];p=h[g].getPixelForValue(y)-b+t}else e==="center"?p=(c.left+c.right)/2-b+t:p=ng(i,e,t);m=Me(s,o,n),d=e==="left"?-re:re}return{titleX:p,titleY:m,maxWidth:u,rotation:d}}class Mn extends ps{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:s,_suggestedMax:n}=this;return t=Ye(t,Number.POSITIVE_INFINITY),e=Ye(e,Number.NEGATIVE_INFINITY),s=Ye(s,Number.POSITIVE_INFINITY),n=Ye(n,Number.NEGATIVE_INFINITY),{min:Ye(t,s),max:Ye(e,n),minDefined:Jt(t),maxDefined:Jt(e)}}getMinMax(t){let{min:e,max:s,minDefined:n,maxDefined:r}=this.getUserBounds(),o;if(n&&r)return{min:e,max:s};const a=this.getMatchingVisibleMetas();for(let l=0,c=a.length;l<c;++l)o=a[l].controller.getMinMax(this,t),n||(e=Math.min(e,o.min)),r||(s=Math.max(s,o.max));return e=r&&e>s?s:e,s=n&&e>s?e:s,{min:Ye(e,Ye(s,e)),max:Ye(s,Ye(e,s))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Dt(this.options.beforeUpdate,[this])}update(t,e,s){const{beginAtZero:n,grace:r,ticks:o}=this.options,a=o.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=s=Object.assign({left:0,right:0,top:0,bottom:0},s),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+s.left+s.right:this.height+s.top+s.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=RT(this,r,n),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?og(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=bP(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,s;this.isHorizontal()?(e=this.left,s=this.right):(e=this.top,s=this.bottom,t=!t),this._startPixel=e,this._endPixel=s,this._reversePixels=t,this._length=s-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Dt(this.options.afterUpdate,[this])}beforeSetDimensions(){Dt(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Dt(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),Dt(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Dt(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let s,n,r;for(s=0,n=t.length;s<n;s++)r=t[s],r.label=Dt(e.callback,[r.value,s,t],this)}afterTickToLabelConversion(){Dt(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Dt(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,s=rg(this.ticks.length,t.ticks.maxTicksLimit),n=e.minRotation||0,r=e.maxRotation;let o=n,a,l,c;if(!this._isVisible()||!e.display||n>=r||s<=1||!this.isHorizontal()){this.labelRotation=n;return}const h=this._getLabelSizes(),d=h.widest.width,u=h.highest.height,p=fe(this.chart.width-d,0,this.maxWidth);a=t.offset?this.maxWidth/s:p/(s-1),d+6>a&&(a=p/(s-(t.offset?.5:1)),l=this.maxHeight-oo(t.grid)-e.padding-ag(t.title,this.chart.options.font),c=Math.sqrt(d*d+u*u),o=Ku(Math.min(Math.asin(fe((h.highest.height+6)/a,-1,1)),Math.asin(fe(l/c,-1,1))-Math.asin(fe(u/c,-1,1)))),o=Math.max(n,Math.min(r,o))),this.labelRotation=o}afterCalculateLabelRotation(){Dt(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Dt(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:s,title:n,grid:r}}=this,o=this._isVisible(),a=this.isHorizontal();if(o){const l=ag(n,e.options.font);if(a?(t.width=this.maxWidth,t.height=oo(r)+l):(t.height=this.maxHeight,t.width=oo(r)+l),s.display&&this.ticks.length){const{first:c,last:h,widest:d,highest:u}=this._getLabelSizes(),p=s.padding*2,m=wi(this.labelRotation),f=Math.cos(m),b=Math.sin(m);if(a){const g=s.mirror?0:b*d.width+f*u.height;t.height=Math.min(this.maxHeight,t.height+g+p)}else{const g=s.mirror?0:f*d.width+b*u.height;t.width=Math.min(this.maxWidth,t.width+g+p)}this._calculatePadding(c,h,b,f)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,s,n){const{ticks:{align:r,padding:o},position:a}=this.options,l=this.labelRotation!==0,c=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const h=this.getPixelForTick(0)-this.left,d=this.right-this.getPixelForTick(this.ticks.length-1);let u=0,p=0;l?c?(u=n*t.width,p=s*e.height):(u=s*t.height,p=n*e.width):r==="start"?p=e.width:r==="end"?u=t.width:r!=="inner"&&(u=t.width/2,p=e.width/2),this.paddingLeft=Math.max((u-h+o)*this.width/(this.width-h),0),this.paddingRight=Math.max((p-d+o)*this.width/(this.width-d),0)}else{let h=e.height/2,d=t.height/2;r==="start"?(h=0,d=t.height):r==="end"&&(h=e.height,d=0),this.paddingTop=h+o,this.paddingBottom=d+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Dt(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,s;for(e=0,s=t.length;e<s;e++)bt(t[e].label)&&(t.splice(e,1),s--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let s=this.ticks;e<s.length&&(s=og(s,e)),this._labelSizes=t=this._computeLabelSizes(s,s.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,s){const{ctx:n,_longestTextCache:r}=this,o=[],a=[],l=Math.floor(e/rg(e,s));let c=0,h=0,d,u,p,m,f,b,g,y,v,_,x;for(d=0;d<e;d+=l){if(m=t[d].label,f=this._resolveTickFontOptions(d),n.font=b=f.string,g=r[b]=r[b]||{data:{},gc:[]},y=f.lineHeight,v=_=0,!bt(m)&&!jt(m))v=ac(n,g.data,g.gc,v,m),_=y;else if(jt(m))for(u=0,p=m.length;u<p;++u)x=m[u],!bt(x)&&!jt(x)&&(v=ac(n,g.data,g.gc,v,x),_+=y);o.push(v),a.push(_),c=Math.max(v,c),h=Math.max(_,h)}EP(r,e);const S=o.indexOf(c),k=a.indexOf(h),T=M=>({width:o[M]||0,height:a[M]||0});return{first:T(0),last:T(e-1),widest:T(S),highest:T(k),widths:o,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return uT(this._alignToPixels?an(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const s=e[t];return s.$context||(s.$context=AP(this.getContext(),t,s))}return this.$context||(this.$context=kP(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=wi(this.labelRotation),s=Math.abs(Math.cos(e)),n=Math.abs(Math.sin(e)),r=this._getLabelSizes(),o=t.autoSkipPadding||0,a=r?r.widest.width+o:0,l=r?r.highest.height+o:0;return this.isHorizontal()?l*s>a*n?a/s:l/n:l*n<a*s?l/s:a/n}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,s=this.chart,n=this.options,{grid:r,position:o,border:a}=n,l=r.offset,c=this.isHorizontal(),h=this.ticks.length+(l?1:0),d=oo(r),u=[],p=a.setContext(this.getContext()),m=p.display?p.width:0,f=m/2,b=function(z){return an(s,z,m)};let g,y,v,_,x,S,k,T,M,O,R,A;if(o==="top")g=b(this.bottom),S=this.bottom-d,T=g-f,O=b(t.top)+f,A=t.bottom;else if(o==="bottom")g=b(this.top),O=t.top,A=b(t.bottom)-f,S=g+f,T=this.top+d;else if(o==="left")g=b(this.right),x=this.right-d,k=g-f,M=b(t.left)+f,R=t.right;else if(o==="right")g=b(this.left),M=t.left,R=b(t.right)-f,x=g+f,k=this.left+d;else if(e==="x"){if(o==="center")g=b((t.top+t.bottom)/2+.5);else if(wt(o)){const z=Object.keys(o)[0],Y=o[z];g=b(this.chart.scales[z].getPixelForValue(Y))}O=t.top,A=t.bottom,S=g+f,T=S+d}else if(e==="y"){if(o==="center")g=b((t.left+t.right)/2);else if(wt(o)){const z=Object.keys(o)[0],Y=o[z];g=b(this.chart.scales[z].getPixelForValue(Y))}x=g-f,k=x-d,M=t.left,R=t.right}const $=mt(n.ticks.maxTicksLimit,h),w=Math.max(1,Math.ceil(h/$));for(y=0;y<h;y+=w){const z=this.getContext(y),Y=r.setContext(z),V=a.setContext(z),K=Y.lineWidth,q=Y.color,rt=V.dash||[],U=V.dashOffset,B=Y.tickWidth,ot=Y.tickColor,J=Y.tickBorderDash||[],tt=Y.tickBorderDashOffset;v=SP(this,y,l),v!==void 0&&(_=an(s,v,K),c?x=k=M=R=_:S=T=O=A=_,u.push({tx1:x,ty1:S,tx2:k,ty2:T,x1:M,y1:O,x2:R,y2:A,width:K,color:q,borderDash:rt,borderDashOffset:U,tickWidth:B,tickColor:ot,tickBorderDash:J,tickBorderDashOffset:tt}))}return this._ticksLength=h,this._borderValue=g,u}_computeLabelItems(t){const e=this.axis,s=this.options,{position:n,ticks:r}=s,o=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:c,padding:h,mirror:d}=r,u=oo(s.grid),p=u+h,m=d?-h:p,f=-wi(this.labelRotation),b=[];let g,y,v,_,x,S,k,T,M,O,R,A,$="middle";if(n==="top")S=this.bottom-m,k=this._getXAxisLabelAlignment();else if(n==="bottom")S=this.top+m,k=this._getXAxisLabelAlignment();else if(n==="left"){const z=this._getYAxisLabelAlignment(u);k=z.textAlign,x=z.x}else if(n==="right"){const z=this._getYAxisLabelAlignment(u);k=z.textAlign,x=z.x}else if(e==="x"){if(n==="center")S=(t.top+t.bottom)/2+p;else if(wt(n)){const z=Object.keys(n)[0],Y=n[z];S=this.chart.scales[z].getPixelForValue(Y)+p}k=this._getXAxisLabelAlignment()}else if(e==="y"){if(n==="center")x=(t.left+t.right)/2-p;else if(wt(n)){const z=Object.keys(n)[0],Y=n[z];x=this.chart.scales[z].getPixelForValue(Y)}k=this._getYAxisLabelAlignment(u).textAlign}e==="y"&&(l==="start"?$="top":l==="end"&&($="bottom"));const w=this._getLabelSizes();for(g=0,y=a.length;g<y;++g){v=a[g],_=v.label;const z=r.setContext(this.getContext(g));T=this.getPixelForTick(g)+r.labelOffset,M=this._resolveTickFontOptions(g),O=M.lineHeight,R=jt(_)?_.length:1;const Y=R/2,V=z.color,K=z.textStrokeColor,q=z.textStrokeWidth;let rt=k;o?(x=T,k==="inner"&&(g===y-1?rt=this.options.reverse?"left":"right":g===0?rt=this.options.reverse?"right":"left":rt="center"),n==="top"?c==="near"||f!==0?A=-R*O+O/2:c==="center"?A=-w.highest.height/2-Y*O+O:A=-w.highest.height+O/2:c==="near"||f!==0?A=O/2:c==="center"?A=w.highest.height/2-Y*O:A=w.highest.height-R*O,d&&(A*=-1),f!==0&&!z.showLabelBackdrop&&(x+=O/2*Math.sin(f))):(S=T,A=(1-R)*O/2);let U;if(z.showLabelBackdrop){const B=Ce(z.backdropPadding),ot=w.heights[g],J=w.widths[g];let tt=A-B.top,dt=0-B.left;switch($){case"middle":tt-=ot/2;break;case"bottom":tt-=ot;break}switch(k){case"center":dt-=J/2;break;case"right":dt-=J;break;case"inner":g===y-1?dt-=J:g>0&&(dt-=J/2);break}U={left:dt,top:tt,width:J+B.width,height:ot+B.height,color:z.backdropColor}}b.push({label:_,font:M,textOffset:A,options:{rotation:f,color:V,strokeColor:K,strokeWidth:q,textAlign:rt,textBaseline:$,translation:[x,S],backdrop:U}})}return b}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-wi(this.labelRotation))return t==="top"?"left":"right";let s="center";return e.align==="start"?s="left":e.align==="end"?s="right":e.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:s,mirror:n,padding:r}}=this.options,o=this._getLabelSizes(),a=t+r,l=o.widest.width;let c,h;return e==="left"?n?(h=this.right+r,s==="near"?c="left":s==="center"?(c="center",h+=l/2):(c="right",h+=l)):(h=this.right-a,s==="near"?c="right":s==="center"?(c="center",h-=l/2):(c="left",h=this.left)):e==="right"?n?(h=this.left+r,s==="near"?c="right":s==="center"?(c="center",h-=l/2):(c="left",h-=l)):(h=this.left+a,s==="near"?c="left":s==="center"?(c="center",h+=l/2):(c="right",h=this.right)):c="right",{textAlign:c,x:h}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:s,top:n,width:r,height:o}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(s,n,r,o),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const s=this.ticks.findIndex(n=>n.value===t);return s>=0?e.setContext(this.getContext(s)).lineWidth:0}drawGrid(t){const e=this.options.grid,s=this.ctx,n=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let r,o;const a=(l,c,h)=>{!h.width||!h.color||(s.save(),s.lineWidth=h.width,s.strokeStyle=h.color,s.setLineDash(h.borderDash||[]),s.lineDashOffset=h.borderDashOffset,s.beginPath(),s.moveTo(l.x,l.y),s.lineTo(c.x,c.y),s.stroke(),s.restore())};if(e.display)for(r=0,o=n.length;r<o;++r){const l=n[r];e.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),e.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:s,grid:n}}=this,r=s.setContext(this.getContext()),o=s.display?r.width:0;if(!o)return;const a=n.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,h,d,u;this.isHorizontal()?(c=an(t,this.left,o)-o/2,h=an(t,this.right,a)+a/2,d=u=l):(d=an(t,this.top,o)-o/2,u=an(t,this.bottom,a)+a/2,c=h=l),e.save(),e.lineWidth=r.width,e.strokeStyle=r.color,e.beginPath(),e.moveTo(c,d),e.lineTo(h,u),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const e=this.ctx,s=this._computeLabelArea();s&&Hc(e,s);const n=this.getLabelItems(t);for(const r of n){const o=r.options,a=r.font,l=r.label,c=r.textOffset;kn(e,l,0,c,a,o)}s&&Wc(e)}drawTitle(){const{ctx:t,options:{position:e,title:s,reverse:n}}=this;if(!s.display)return;const r=de(s.font),o=Ce(s.padding),a=s.align;let l=r.lineHeight/2;e==="bottom"||e==="center"||wt(e)?(l+=o.bottom,jt(s.text)&&(l+=r.lineHeight*(s.text.length-1))):l+=o.top;const{titleX:c,titleY:h,maxWidth:d,rotation:u}=MP(this,l,e,a);kn(t,s.text,0,0,r,{color:s.color,maxWidth:d,rotation:u,textAlign:TP(a,e,n),textBaseline:"middle",translation:[c,h]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,s=mt(t.grid&&t.grid.z,-1),n=mt(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==Mn.prototype.draw?[{z:e,draw:r=>{this.draw(r)}}]:[{z:s,draw:r=>{this.drawBackground(),this.drawGrid(r),this.drawTitle()}},{z:n,draw:()=>{this.drawBorder()}},{z:e,draw:r=>{this.drawLabels(r)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),s=this.axis+"AxisID",n=[];let r,o;for(r=0,o=e.length;r<o;++r){const a=e[r];a[s]===this.id&&(!t||a.type===t)&&n.push(a)}return n}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return de(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class ul{constructor(t,e,s){this.type=t,this.scope=e,this.override=s,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let s;OP(e)&&(s=this.register(e));const n=this.items,r=t.id,o=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+t);return r in n||(n[r]=t,PP(t,o,s),this.override&&Ht.override(t.id,t.overrides)),o}get(t){return this.items[t]}unregister(t){const e=this.items,s=t.id,n=this.scope;s in e&&delete e[s],n&&s in Ht[n]&&(delete Ht[n][s],this.override&&delete En[s])}}function PP(i,t,e){const s=Hi(Object.create(null),[e?Ht.get(e):{},Ht.get(t),i.defaults]);Ht.set(t,s),i.defaultRoutes&&$P(t,i.defaultRoutes),i.descriptors&&Ht.describe(t,i.descriptors)}function $P(i,t){Object.keys(t).forEach(e=>{const s=e.split("."),n=s.pop(),r=[i].concat(s).join("."),o=t[e].split("."),a=o.pop(),l=o.join(".");Ht.route(r,n,l,a)})}function OP(i){return"id"in i&&"defaults"in i}class DP{constructor(){this.controllers=new ul(xi,"datasets",!0),this.elements=new ul(ps,"elements"),this.plugins=new ul(Object,"plugins"),this.scales=new ul(Mn,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,s){[...e].forEach(n=>{const r=s||this._getRegistryForType(n);s||r.isForType(n)||r===this.plugins&&n.id?this._exec(t,r,n):Mt(n,o=>{const a=s||this._getRegistryForType(o);this._exec(t,a,o)})})}_exec(t,e,s){const n=Xu(t);Dt(s["before"+n],[],s),e[t](s),Dt(s["after"+n],[],s)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const s=this._typedRegistries[e];if(s.isForType(t))return s}return this.plugins}_get(t,e,s){const n=e.get(t);if(n===void 0)throw new Error('"'+t+'" is not a registered '+s+".");return n}}var Li=new DP;class IP{constructor(){this._init=void 0}notify(t,e,s,n){if(e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const r=n?this._descriptors(t).filter(n):this._descriptors(t),o=this._notify(r,t,e,s);return e==="afterDestroy"&&(this._notify(r,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),o}_notify(t,e,s,n){n=n||{};for(const r of t){const o=r.plugin,a=o[s],l=[e,n,r.options];if(Dt(a,l,o)===!1&&n.cancelable)return!1}return!0}invalidate(){bt(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const s=t&&t.config,n=mt(s.options&&s.options.plugins,{}),r=zP(s);return n===!1&&!e?[]:RP(t,r,n,e)}_notifyStateChanges(t){const e=this._oldCache||[],s=this._cache,n=(r,o)=>r.filter(a=>!o.some(l=>a.plugin.id===l.plugin.id));this._notify(n(e,s),t,"stop"),this._notify(n(s,e),t,"start")}}function zP(i){const t={},e=[],s=Object.keys(Li.plugins.items);for(let r=0;r<s.length;r++)e.push(Li.getPlugin(s[r]));const n=i.plugins||[];for(let r=0;r<n.length;r++){const o=n[r];e.indexOf(o)===-1&&(e.push(o),t[o.id]=!0)}return{plugins:e,localIds:t}}function LP(i,t){return!t&&i===!1?null:i===!0?{}:i}function RP(i,{plugins:t,localIds:e},s,n){const r=[],o=i.getContext();for(const a of t){const l=a.id,c=LP(s[l],n);c!==null&&r.push({plugin:a,options:BP(i.config,{plugin:a,local:e[l]},c,o)})}return r}function BP(i,{plugin:t,local:e},s,n){const r=i.pluginScopeKeys(t),o=i.getOptionScopes(s,r);return e&&t.defaults&&o.push(t.defaults),i.createResolver(o,n,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Hd(i,t){const e=Ht.datasets[i]||{};return((t.datasets||{})[i]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function NP(i,t){let e=i;return i==="_index_"?e=t:i==="_value_"&&(e=t==="x"?"y":"x"),e}function FP(i,t){return i===t?"_index_":"_value_"}function lg(i){if(i==="x"||i==="y"||i==="r")return i}function UP(i){if(i==="top"||i==="bottom")return"x";if(i==="left"||i==="right")return"y"}function Wd(i,...t){if(lg(i))return i;for(const e of t){const s=e.axis||UP(e.position)||i.length>1&&lg(i[0].toLowerCase());if(s)return s}throw new Error(`Cannot determine type of '${i}' axis. Please provide 'axis' or 'position' option.`)}function cg(i,t,e){if(e[t+"AxisID"]===i)return{axis:t}}function jP(i,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(s=>s.xAxisID===i||s.yAxisID===i);if(e.length)return cg(i,"x",e[0])||cg(i,"y",e[0])}return{}}function VP(i,t){const e=En[i.type]||{scales:{}},s=t.scales||{},n=Hd(i.type,t),r=Object.create(null);return Object.keys(s).forEach(o=>{const a=s[o];if(!wt(a))return console.error(`Invalid scale configuration for scale: ${o}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);const l=Wd(o,a,jP(o,i),Ht.scales[a.type]),c=FP(l,n),h=e.scales||{};r[o]=Ao(Object.create(null),[{axis:l},a,h[l],h[c]])}),i.data.datasets.forEach(o=>{const a=o.type||i.type,l=o.indexAxis||Hd(a,t),c=(En[a]||{}).scales||{};Object.keys(c).forEach(h=>{const d=NP(h,l),u=o[d+"AxisID"]||d;r[u]=r[u]||Object.create(null),Ao(r[u],[{axis:d},s[u],c[h]])})}),Object.keys(r).forEach(o=>{const a=r[o];Ao(a,[Ht.scales[a.type],Ht.scale])}),r}function $_(i){const t=i.options||(i.options={});t.plugins=mt(t.plugins,{}),t.scales=VP(i,t)}function O_(i){return i=i||{},i.datasets=i.datasets||[],i.labels=i.labels||[],i}function HP(i){return i=i||{},i.data=O_(i.data),$_(i),i}const hg=new Map,D_=new Set;function pl(i,t){let e=hg.get(i);return e||(e=t(),hg.set(i,e),D_.add(e)),e}const ao=(i,t,e)=>{const s=Hs(t,e);s!==void 0&&i.add(s)};class WP{constructor(t){this._config=HP(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=O_(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),$_(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return pl(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return pl(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return pl(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,s=this.type;return pl(`${s}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const s=this._scopeCache;let n=s.get(t);return(!n||e)&&(n=new Map,s.set(t,n)),n}getOptionScopes(t,e,s){const{options:n,type:r}=this,o=this._cachedScopes(t,s),a=o.get(e);if(a)return a;const l=new Set;e.forEach(h=>{t&&(l.add(t),h.forEach(d=>ao(l,t,d))),h.forEach(d=>ao(l,n,d)),h.forEach(d=>ao(l,En[r]||{},d)),h.forEach(d=>ao(l,Ht,d)),h.forEach(d=>ao(l,Ud,d))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),D_.has(e)&&o.set(e,c),c}chartOptionScopes(){const{options:t,type:e}=this;return[t,En[e]||{},Ht.datasets[e]||{},{type:e},Ht,Ud]}resolveNamedOptions(t,e,s,n=[""]){const r={$shared:!0},{resolver:o,subPrefixes:a}=dg(this._resolverCache,t,n);let l=o;if(YP(o,e)){r.$shared=!1,s=Ws(s)?s():s;const c=this.createResolver(t,s,a);l=_r(o,s,c)}for(const c of e)r[c]=l[c];return r}createResolver(t,e,s=[""],n){const{resolver:r}=dg(this._resolverCache,t,s);return wt(e)?_r(r,e,void 0,n):r}}function dg(i,t,e){let s=i.get(t);s||(s=new Map,i.set(t,s));const n=e.join();let r=s.get(n);return r||(r={resolver:ip(t,e),subPrefixes:e.filter(o=>!o.toLowerCase().includes("hover"))},s.set(n,r)),r}const qP=i=>wt(i)&&Object.getOwnPropertyNames(i).some(t=>Ws(i[t]));function YP(i,t){const{isScriptable:e,isIndexable:s}=d_(i);for(const n of t){const r=e(n),o=s(n),a=(o||r)&&i[n];if(r&&(Ws(a)||qP(a))||o&&jt(a))return!0}return!1}var ZP="4.5.1";const GP=["top","bottom","left","right","chartArea"];function ug(i,t){return i==="top"||i==="bottom"||GP.indexOf(i)===-1&&t==="x"}function pg(i,t){return function(e,s){return e[i]===s[i]?e[t]-s[t]:e[i]-s[i]}}function fg(i){const t=i.chart,e=t.options.animation;t.notifyPlugins("afterRender"),Dt(e&&e.onComplete,[i],t)}function XP(i){const t=i.chart,e=t.options.animation;Dt(e&&e.onProgress,[i],t)}function I_(i){return rp()&&typeof i=="string"?i=document.getElementById(i):i&&i.length&&(i=i[0]),i&&i.canvas&&(i=i.canvas),i}const Ll={},mg=i=>{const t=I_(i);return Object.values(Ll).filter(e=>e.canvas===t).pop()};function KP(i,t,e){const s=Object.keys(i);for(const n of s){const r=+n;if(r>=t){const o=i[n];delete i[n],(e>0||r>t)&&(i[r+e]=o)}}}function QP(i,t,e,s){return!e||i.type==="mouseout"?null:s?t:i}var bs;let ia=(bs=class{static register(...i){Li.add(...i),gg()}static unregister(...i){Li.remove(...i),gg()}constructor(i,t){const e=this.config=new WP(t),s=I_(i),n=mg(s);if(n)throw new Error("Canvas is already in use. Chart with ID '"+n.id+"' must be destroyed before the canvas with ID '"+n.canvas.id+"' can be reused.");const r=e.createResolver(e.chartOptionScopes(),this.getContext());this.platform=new(e.platform||gP(s)),this.platform.updateConfig(e);const o=this.platform.acquireContext(s,r.aspectRatio),a=o&&o.canvas,l=a&&a.height,c=a&&a.width;if(this.id=JA(),this.ctx=o,this.canvas=a,this.width=c,this.height=l,this._options=r,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new IP,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=gT(h=>this.update(h),r.resizeDelay||0),this._dataChanges=[],Ll[this.id]=this,!o||!a){console.error("Failed to create chart: can't acquire context from the given item");return}Zi.listen(this,"complete",fg),Zi.listen(this,"progress",XP),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:i,maintainAspectRatio:t},width:e,height:s,_aspectRatio:n}=this;return bt(i)?t&&n?n:s?e/s:null:i}get data(){return this.config.data}set data(i){this.config.data=i}get options(){return this._options}set options(i){this.config.options=i}get registry(){return Li}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Bm(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return zm(this.canvas,this.ctx),this}stop(){return Zi.stop(this),this}resize(i,t){Zi.running(this)?this._resizeBeforeDraw={width:i,height:t}:this._resize(i,t)}_resize(i,t){const e=this.options,s=this.canvas,n=e.maintainAspectRatio&&this.aspectRatio,r=this.platform.getMaximumSize(s,i,t,n),o=e.devicePixelRatio||this.platform.getDevicePixelRatio(),a=this.width?"resize":"attach";this.width=r.width,this.height=r.height,this._aspectRatio=this.aspectRatio,Bm(this,o,!0)&&(this.notifyPlugins("resize",{size:r}),Dt(e.onResize,[this,r],this),this.attached&&this._doResize(a)&&this.render())}ensureScalesHaveIDs(){const i=this.options.scales||{};Mt(i,(t,e)=>{t.id=e})}buildOrUpdateScales(){const i=this.options,t=i.scales,e=this.scales,s=Object.keys(e).reduce((r,o)=>(r[o]=!1,r),{});let n=[];t&&(n=n.concat(Object.keys(t).map(r=>{const o=t[r],a=Wd(r,o),l=a==="r",c=a==="x";return{options:o,dposition:l?"chartArea":c?"bottom":"left",dtype:l?"radialLinear":c?"category":"linear"}}))),Mt(n,r=>{const o=r.options,a=o.id,l=Wd(a,o),c=mt(o.type,r.dtype);(o.position===void 0||ug(o.position,l)!==ug(r.dposition))&&(o.position=r.dposition),s[a]=!0;let h=null;if(a in e&&e[a].type===c)h=e[a];else{const d=Li.getScale(c);h=new d({id:a,type:c,ctx:this.ctx,chart:this}),e[h.id]=h}h.init(o,i)}),Mt(s,(r,o)=>{r||delete e[o]}),Mt(e,r=>{$e.configure(this,r,r.options),$e.addBox(this,r)})}_updateMetasets(){const i=this._metasets,t=this.data.datasets.length,e=i.length;if(i.sort((s,n)=>s.index-n.index),e>t){for(let s=t;s<e;++s)this._destroyDatasetMeta(s);i.splice(t,e-t)}this._sortedMetasets=i.slice(0).sort(pg("order","index"))}_removeUnreferencedMetasets(){const{_metasets:i,data:{datasets:t}}=this;i.length>t.length&&delete this._stacks,i.forEach((e,s)=>{t.filter(n=>n===e._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const i=[],t=this.data.datasets;let e,s;for(this._removeUnreferencedMetasets(),e=0,s=t.length;e<s;e++){const n=t[e];let r=this.getDatasetMeta(e);const o=n.type||this.config.type;if(r.type&&r.type!==o&&(this._destroyDatasetMeta(e),r=this.getDatasetMeta(e)),r.type=o,r.indexAxis=n.indexAxis||Hd(o,this.options),r.order=n.order||0,r.index=e,r.label=""+n.label,r.visible=this.isDatasetVisible(e),r.controller)r.controller.updateIndex(e),r.controller.linkScales();else{const a=Li.getController(o),{datasetElementType:l,dataElementType:c}=Ht.datasets[o];Object.assign(a,{dataElementType:Li.getElement(c),datasetElementType:l&&Li.getElement(l)}),r.controller=new a(this,e),i.push(r.controller)}}return this._updateMetasets(),i}_resetElements(){Mt(this.data.datasets,(i,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(i){const t=this.config;t.update();const e=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!e.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:i,cancelable:!0})===!1)return;const n=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let r=0;for(let l=0,c=this.data.datasets.length;l<c;l++){const{controller:h}=this.getDatasetMeta(l),d=!s&&n.indexOf(h)===-1;h.buildOrUpdateElements(d),r=Math.max(+h.getMaxOverflow(),r)}r=this._minPadding=e.layout.autoPadding?r:0,this._updateLayout(r),s||Mt(n,l=>{l.reset()}),this._updateDatasets(i),this.notifyPlugins("afterUpdate",{mode:i}),this._layers.sort(pg("z","_idx"));const{_active:o,_lastEvent:a}=this;a?this._eventHandler(a,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){Mt(this.scales,i=>{$e.removeBox(this,i)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const i=this.options,t=new Set(Object.keys(this._listeners)),e=new Set(i.events);(!km(t,e)||!!this._responsiveListeners!==i.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:i}=this,t=this._getUniformDataChanges()||[];for(const{method:e,start:s,count:n}of t){const r=e==="_removeElements"?-n:n;KP(i,s,r)}}_getUniformDataChanges(){const i=this._dataChanges;if(!i||!i.length)return;this._dataChanges=[];const t=this.data.datasets.length,e=n=>new Set(i.filter(r=>r[0]===n).map((r,o)=>o+","+r.splice(1).join(","))),s=e(0);for(let n=1;n<t;n++)if(!km(s,e(n)))return;return Array.from(s).map(n=>n.split(",")).map(n=>({method:n[1],start:+n[2],count:+n[3]}))}_updateLayout(i){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;$e.update(this,this.width,this.height,i);const t=this.chartArea,e=t.width<=0||t.height<=0;this._layers=[],Mt(this.boxes,s=>{e&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,n)=>{s._idx=n}),this.notifyPlugins("afterLayout")}_updateDatasets(i){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:i,cancelable:!0})!==!1){for(let t=0,e=this.data.datasets.length;t<e;++t)this.getDatasetMeta(t).controller.configure();for(let t=0,e=this.data.datasets.length;t<e;++t)this._updateDataset(t,Ws(i)?i({datasetIndex:t}):i);this.notifyPlugins("afterDatasetsUpdate",{mode:i})}}_updateDataset(i,t){const e=this.getDatasetMeta(i),s={meta:e,index:i,mode:t,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(e.controller._update(t),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Zi.has(this)?this.attached&&!Zi.running(this)&&Zi.start(this):(this.draw(),fg({chart:this})))}draw(){let i;if(this._resizeBeforeDraw){const{width:e,height:s}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(e,s)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const t=this._layers;for(i=0;i<t.length&&t[i].z<=0;++i)t[i].draw(this.chartArea);for(this._drawDatasets();i<t.length;++i)t[i].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(i){const t=this._sortedMetasets,e=[];let s,n;for(s=0,n=t.length;s<n;++s){const r=t[s];(!i||r.visible)&&e.push(r)}return e}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const i=this.getSortedVisibleDatasetMetas();for(let t=i.length-1;t>=0;--t)this._drawDataset(i[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(i){const t=this.ctx,e={meta:i,index:i.index,cancelable:!0},s=x_(this,i);this.notifyPlugins("beforeDatasetDraw",e)!==!1&&(s&&Hc(t,s),i.controller.draw(),s&&Wc(t),e.cancelable=!1,this.notifyPlugins("afterDatasetDraw",e))}isPointInArea(i){return es(i,this.chartArea,this._minPadding)}getElementsAtEventForMode(i,t,e,s){const n=GM.modes[t];return typeof n=="function"?n(this,i,e,s):[]}getDatasetMeta(i){const t=this.data.datasets[i],e=this._metasets;let s=e.filter(n=>n&&n._dataset===t).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:i,_dataset:t,_parsed:[],_sorted:!1},e.push(s)),s}getContext(){return this.$context||(this.$context=Qs(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(i){const t=this.data.datasets[i];if(!t)return!1;const e=this.getDatasetMeta(i);return typeof e.hidden=="boolean"?!e.hidden:!t.hidden}setDatasetVisibility(i,t){const e=this.getDatasetMeta(i);e.hidden=!t}toggleDataVisibility(i){this._hiddenIndices[i]=!this._hiddenIndices[i]}getDataVisibility(i){return!this._hiddenIndices[i]}_updateVisibility(i,t,e){const s=e?"show":"hide",n=this.getDatasetMeta(i),r=n.controller._resolveAnimations(void 0,s);Qo(t)?(n.data[t].hidden=!e,this.update()):(this.setDatasetVisibility(i,e),r.update(n,{visible:e}),this.update(o=>o.datasetIndex===i?s:void 0))}hide(i,t){this._updateVisibility(i,t,!1)}show(i,t){this._updateVisibility(i,t,!0)}_destroyDatasetMeta(i){const t=this._metasets[i];t&&t.controller&&t.controller._destroy(),delete this._metasets[i]}_stop(){let i,t;for(this.stop(),Zi.remove(this),i=0,t=this.data.datasets.length;i<t;++i)this._destroyDatasetMeta(i)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:i,ctx:t}=this;this._stop(),this.config.clearCache(),i&&(this.unbindEvents(),zm(i,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete Ll[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...i){return this.canvas.toDataURL(...i)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const i=this._listeners,t=this.platform,e=(n,r)=>{t.addEventListener(this,n,r),i[n]=r},s=(n,r,o)=>{n.offsetX=r,n.offsetY=o,this._eventHandler(n)};Mt(this.options.events,n=>e(n,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const i=this._responsiveListeners,t=this.platform,e=(a,l)=>{t.addEventListener(this,a,l),i[a]=l},s=(a,l)=>{i[a]&&(t.removeEventListener(this,a,l),delete i[a])},n=(a,l)=>{this.canvas&&this.resize(a,l)};let r;const o=()=>{s("attach",o),this.attached=!0,this.resize(),e("resize",n),e("detach",r)};r=()=>{this.attached=!1,s("resize",n),this._stop(),this._resize(0,0),e("attach",o)},t.isAttached(this.canvas)?o():r()}unbindEvents(){Mt(this._listeners,(i,t)=>{this.platform.removeEventListener(this,t,i)}),this._listeners={},Mt(this._responsiveListeners,(i,t)=>{this.platform.removeEventListener(this,t,i)}),this._responsiveListeners=void 0}updateHoverStyle(i,t,e){const s=e?"set":"remove";let n,r,o,a;for(t==="dataset"&&(n=this.getDatasetMeta(i[0].datasetIndex),n.controller["_"+s+"DatasetHoverStyle"]()),o=0,a=i.length;o<a;++o){r=i[o];const l=r&&this.getDatasetMeta(r.datasetIndex).controller;l&&l[s+"HoverStyle"](r.element,r.datasetIndex,r.index)}}getActiveElements(){return this._active||[]}setActiveElements(i){const t=this._active||[],e=i.map(({datasetIndex:s,index:n})=>{const r=this.getDatasetMeta(s);if(!r)throw new Error("No dataset found at index "+s);return{datasetIndex:s,element:r.data[n],index:n}});!nc(e,t)&&(this._active=e,this._lastEvent=null,this._updateHoverStyles(e,t))}notifyPlugins(i,t,e){return this._plugins.notify(this,i,t,e)}isPluginEnabled(i){return this._plugins._cache.filter(t=>t.plugin.id===i).length===1}_updateHoverStyles(i,t,e){const s=this.options.hover,n=(a,l)=>a.filter(c=>!l.some(h=>c.datasetIndex===h.datasetIndex&&c.index===h.index)),r=n(t,i),o=e?i:n(i,t);r.length&&this.updateHoverStyle(r,s.mode,!1),o.length&&s.mode&&this.updateHoverStyle(o,s.mode,!0)}_eventHandler(i,t){const e={event:i,replay:t,cancelable:!0,inChartArea:this.isPointInArea(i)},s=r=>(r.options.events||this.options.events).includes(i.native.type);if(this.notifyPlugins("beforeEvent",e,s)===!1)return;const n=this._handleEvent(i,t,e.inChartArea);return e.cancelable=!1,this.notifyPlugins("afterEvent",e,s),(n||e.changed)&&this.render(),this}_handleEvent(i,t,e){const{_active:s=[],options:n}=this,r=t,o=this._getActiveElements(i,s,e,r),a=rT(i),l=QP(i,this._lastEvent,e,a);e&&(this._lastEvent=null,Dt(n.onHover,[i,o,this],this),a&&Dt(n.onClick,[i,o,this],this));const c=!nc(o,s);return(c||t)&&(this._active=o,this._updateHoverStyles(o,s,t)),this._lastEvent=l,c}_getActiveElements(i,t,e,s){if(i.type==="mouseout")return[];if(!e)return t;const n=this.options.hover;return this.getElementsAtEventForMode(i,n.mode,n,s)}},it(bs,"defaults",Ht),it(bs,"instances",Ll),it(bs,"overrides",En),it(bs,"registry",Li),it(bs,"version",ZP),it(bs,"getChart",mg),bs);function gg(){return Mt(ia.instances,i=>i._plugins.invalidate())}function JP(i,t,e){const{startAngle:s,x:n,y:r,outerRadius:o,innerRadius:a,options:l}=t,{borderWidth:c,borderJoinStyle:h}=l,d=Math.min(c/o,Pe(s-e));if(i.beginPath(),i.arc(n,r,o-c/2,s+d/2,e-d/2),a>0){const u=Math.min(c/a,Pe(s-e));i.arc(n,r,a+c/2,e-u/2,s+u/2,!0)}else{const u=Math.min(c/2,o*Pe(s-e));if(h==="round")i.arc(n,r,u,e-kt/2,s+kt/2,!0);else if(h==="bevel"){const p=2*u*u,m=-p*Math.cos(e+kt/2)+n,f=-p*Math.sin(e+kt/2)+r,b=p*Math.cos(s+kt/2)+n,g=p*Math.sin(s+kt/2)+r;i.lineTo(m,f),i.lineTo(b,g)}}i.closePath(),i.moveTo(0,0),i.rect(0,0,i.canvas.width,i.canvas.height),i.clip("evenodd")}function t$(i,t,e){const{startAngle:s,pixelMargin:n,x:r,y:o,outerRadius:a,innerRadius:l}=t;let c=n/a;i.beginPath(),i.arc(r,o,a,s-c,e+c),l>n?(c=n/l,i.arc(r,o,l,e+c,s-c,!0)):i.arc(r,o,n,e+re,s-re),i.closePath(),i.clip()}function e$(i){return ep(i,["outerStart","outerEnd","innerStart","innerEnd"])}function i$(i,t,e,s){const n=e$(i.options.borderRadius),r=(e-t)/2,o=Math.min(r,s*t/2),a=l=>{const c=(e-Math.min(r,l))*s/2;return fe(l,0,Math.min(r,c))};return{outerStart:a(n.outerStart),outerEnd:a(n.outerEnd),innerStart:fe(n.innerStart,0,o),innerEnd:fe(n.innerEnd,0,o)}}function Zn(i,t,e,s){return{x:e+i*Math.cos(t),y:s+i*Math.sin(t)}}function hc(i,t,e,s,n,r){const{x:o,y:a,startAngle:l,pixelMargin:c,innerRadius:h}=t,d=Math.max(t.outerRadius+s+e-c,0),u=h>0?h+s+e+c:0;let p=0;const m=n-l;if(s){const z=h>0?h-s:0,Y=d>0?d-s:0,V=(z+Y)/2,K=V!==0?m*V/(V+s):m;p=(m-K)/2}const f=Math.max(.001,m*d-e/kt)/d,b=(m-f)/2,g=l+b+p,y=n-b-p,{outerStart:v,outerEnd:_,innerStart:x,innerEnd:S}=i$(t,u,d,y-g),k=d-v,T=d-_,M=g+v/k,O=y-_/T,R=u+x,A=u+S,$=g+x/R,w=y-S/A;if(i.beginPath(),r){const z=(M+O)/2;if(i.arc(o,a,d,M,z),i.arc(o,a,d,z,O),_>0){const q=Zn(T,O,o,a);i.arc(q.x,q.y,_,O,y+re)}const Y=Zn(A,y,o,a);if(i.lineTo(Y.x,Y.y),S>0){const q=Zn(A,w,o,a);i.arc(q.x,q.y,S,y+re,w+Math.PI)}const V=(y-S/u+(g+x/u))/2;if(i.arc(o,a,u,y-S/u,V,!0),i.arc(o,a,u,V,g+x/u,!0),x>0){const q=Zn(R,$,o,a);i.arc(q.x,q.y,x,$+Math.PI,g-re)}const K=Zn(k,g,o,a);if(i.lineTo(K.x,K.y),v>0){const q=Zn(k,M,o,a);i.arc(q.x,q.y,v,g-re,M)}}else{i.moveTo(o,a);const z=Math.cos(M)*d+o,Y=Math.sin(M)*d+a;i.lineTo(z,Y);const V=Math.cos(O)*d+o,K=Math.sin(O)*d+a;i.lineTo(V,K)}i.closePath()}function s$(i,t,e,s,n){const{fullCircles:r,startAngle:o,circumference:a}=t;let l=t.endAngle;if(r){hc(i,t,e,s,l,n);for(let c=0;c<r;++c)i.fill();isNaN(a)||(l=o+(a%Vt||Vt))}return hc(i,t,e,s,l,n),i.fill(),l}function n$(i,t,e,s,n){const{fullCircles:r,startAngle:o,circumference:a,options:l}=t,{borderWidth:c,borderJoinStyle:h,borderDash:d,borderDashOffset:u,borderRadius:p}=l,m=l.borderAlign==="inner";if(!c)return;i.setLineDash(d||[]),i.lineDashOffset=u,m?(i.lineWidth=c*2,i.lineJoin=h||"round"):(i.lineWidth=c,i.lineJoin=h||"bevel");let f=t.endAngle;if(r){hc(i,t,e,s,f,n);for(let b=0;b<r;++b)i.stroke();isNaN(a)||(f=o+(a%Vt||Vt))}m&&t$(i,t,f),l.selfJoin&&f-o>=kt&&p===0&&h!=="miter"&&JP(i,t,f),r||(hc(i,t,e,s,f,n),i.stroke())}class tr extends ps{constructor(t){super(),it(this,"circumference"),it(this,"endAngle"),it(this,"fullCircles"),it(this,"innerRadius"),it(this,"outerRadius"),it(this,"pixelMargin"),it(this,"startAngle"),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,e,s){const n=this.getProps(["x","y"],s),{angle:r,distance:o}=e_(n,{x:t,y:e}),{startAngle:a,endAngle:l,innerRadius:c,outerRadius:h,circumference:d}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],s),u=(this.options.spacing+this.options.borderWidth)/2,p=mt(d,l-a),m=Jo(r,a,l)&&a!==l,f=p>=Vt||m,b=Ji(o,c+u,h+u);return f&&b}getCenterPoint(t){const{x:e,y:s,startAngle:n,endAngle:r,innerRadius:o,outerRadius:a}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],t),{offset:l,spacing:c}=this.options,h=(n+r)/2,d=(o+a+c+l)/2;return{x:e+Math.cos(h)*d,y:s+Math.sin(h)*d}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:e,circumference:s}=this,n=(e.offset||0)/4,r=(e.spacing||0)/2,o=e.circular;if(this.pixelMargin=e.borderAlign==="inner"?.33:0,this.fullCircles=s>Vt?Math.floor(s/Vt):0,s===0||this.innerRadius<0||this.outerRadius<0)return;t.save();const a=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(a)*n,Math.sin(a)*n);const l=1-Math.sin(Math.min(kt,s||0)),c=n*l;t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor,s$(t,this,c,r,o),n$(t,this,c,r,o),t.restore()}}it(tr,"id","arc"),it(tr,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),it(tr,"defaultRoutes",{backgroundColor:"backgroundColor"}),it(tr,"descriptors",{_scriptable:!0,_indexable:i=>i!=="borderDash"});function z_(i,t,e=t){i.lineCap=mt(e.borderCapStyle,t.borderCapStyle),i.setLineDash(mt(e.borderDash,t.borderDash)),i.lineDashOffset=mt(e.borderDashOffset,t.borderDashOffset),i.lineJoin=mt(e.borderJoinStyle,t.borderJoinStyle),i.lineWidth=mt(e.borderWidth,t.borderWidth),i.strokeStyle=mt(e.borderColor,t.borderColor)}function r$(i,t,e){i.lineTo(e.x,e.y)}function o$(i){return i.stepped?TT:i.tension||i.cubicInterpolationMode==="monotone"?MT:r$}function L_(i,t,e={}){const s=i.length,{start:n=0,end:r=s-1}=e,{start:o,end:a}=t,l=Math.max(n,o),c=Math.min(r,a),h=n<o&&r<o||n>a&&r>a;return{count:s,start:l,loop:t.loop,ilen:c<l&&!h?s+c-l:c-l}}function a$(i,t,e,s){const{points:n,options:r}=t,{count:o,start:a,loop:l,ilen:c}=L_(n,e,s),h=o$(r);let{move:d=!0,reverse:u}=s||{},p,m,f;for(p=0;p<=c;++p)m=n[(a+(u?c-p:p))%o],!m.skip&&(d?(i.moveTo(m.x,m.y),d=!1):h(i,f,m,u,r.stepped),f=m);return l&&(m=n[(a+(u?c:0))%o],h(i,f,m,u,r.stepped)),!!l}function l$(i,t,e,s){const n=t.points,{count:r,start:o,ilen:a}=L_(n,e,s),{move:l=!0,reverse:c}=s||{};let h=0,d=0,u,p,m,f,b,g;const y=_=>(o+(c?a-_:_))%r,v=()=>{f!==b&&(i.lineTo(h,b),i.lineTo(h,f),i.lineTo(h,g))};for(l&&(p=n[y(0)],i.moveTo(p.x,p.y)),u=0;u<=a;++u){if(p=n[y(u)],p.skip)continue;const _=p.x,x=p.y,S=_|0;S===m?(x<f?f=x:x>b&&(b=x),h=(d*h+_)/++d):(v(),i.lineTo(_,x),m=S,d=0,f=b=x),g=x}v()}function qd(i){const t=i.options,e=t.borderDash&&t.borderDash.length;return!i._decimated&&!i._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?l$:a$}function c$(i){return i.stepped?aM:i.tension||i.cubicInterpolationMode==="monotone"?lM:un}function h$(i,t,e,s){let n=t._path;n||(n=t._path=new Path2D,t.path(n,e,s)&&n.closePath()),z_(i,t.options),i.stroke(n)}function d$(i,t,e,s){const{segments:n,options:r}=t,o=qd(t);for(const a of n)z_(i,r,a.style),i.beginPath(),o(i,t,a,{start:e,end:e+s-1})&&i.closePath(),i.stroke()}const u$=typeof Path2D=="function";function p$(i,t,e,s){u$&&!t.options.segment?h$(i,t,e,s):d$(i,t,e,s)}class Ms extends ps{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const s=this.options;if((s.tension||s.cubicInterpolationMode==="monotone")&&!s.stepped&&!this._pointsUpdated){const n=s.spanGaps?this._loop:this._fullLoop;JT(this._points,s,t,n,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=fM(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,s=t.length;return s&&e[t[s-1].end]}interpolate(t,e){const s=this.options,n=t[e],r=this.points,o=w_(this,{property:e,start:n,end:n});if(!o.length)return;const a=[],l=c$(s);let c,h;for(c=0,h=o.length;c<h;++c){const{start:d,end:u}=o[c],p=r[d],m=r[u];if(p===m){a.push(p);continue}const f=Math.abs((n-p[e])/(m[e]-p[e])),b=l(p,m,f,s.stepped);b[e]=t[e],a.push(b)}return a.length===1?a[0]:a}pathSegment(t,e,s){return qd(this)(t,this,e,s)}path(t,e,s){const n=this.segments,r=qd(this);let o=this._loop;e=e||0,s=s||this.points.length-e;for(const a of n)o&=r(t,this,a,{start:e,end:e+s-1});return!!o}draw(t,e,s,n){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(t.save(),p$(t,this,s,n),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}it(Ms,"id","line"),it(Ms,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),it(Ms,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),it(Ms,"descriptors",{_scriptable:!0,_indexable:i=>i!=="borderDash"&&i!=="fill"});function bg(i,t,e,s){const n=i.options,{[e]:r}=i.getProps([e],s);return Math.abs(t-r)<n.radius+n.hitRadius}class Oo extends ps{constructor(t){super(),it(this,"parsed"),it(this,"skip"),it(this,"stop"),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,s){const n=this.options,{x:r,y:o}=this.getProps(["x","y"],s);return Math.pow(t-r,2)+Math.pow(e-o,2)<Math.pow(n.hitRadius+n.radius,2)}inXRange(t,e){return bg(this,t,"x",e)}inYRange(t,e){return bg(this,t,"y",e)}getCenterPoint(t){const{x:e,y:s}=this.getProps(["x","y"],t);return{x:e,y:s}}size(t){t=t||this.options||{};let e=t.radius||0;e=Math.max(e,e&&t.hoverRadius||0);const s=e&&t.borderWidth||0;return(e+s)*2}draw(t,e){const s=this.options;this.skip||s.radius<.1||!es(this,e,this.size(s)/2)||(t.strokeStyle=s.borderColor,t.lineWidth=s.borderWidth,t.fillStyle=s.backgroundColor,jd(t,s,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}it(Oo,"id","point"),it(Oo,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),it(Oo,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function R_(i,t){const{x:e,y:s,base:n,width:r,height:o}=i.getProps(["x","y","base","width","height"],t);let a,l,c,h,d;return i.horizontal?(d=o/2,a=Math.min(e,n),l=Math.max(e,n),c=s-d,h=s+d):(d=r/2,a=e-d,l=e+d,c=Math.min(s,n),h=Math.max(s,n)),{left:a,top:c,right:l,bottom:h}}function Ps(i,t,e,s){return i?0:fe(t,e,s)}function f$(i,t,e){const s=i.options.borderWidth,n=i.borderSkipped,r=h_(s);return{t:Ps(n.top,r.top,0,e),r:Ps(n.right,r.right,0,t),b:Ps(n.bottom,r.bottom,0,e),l:Ps(n.left,r.left,0,t)}}function m$(i,t,e){const{enableBorderRadius:s}=i.getProps(["enableBorderRadius"]),n=i.options.borderRadius,r=_n(n),o=Math.min(t,e),a=i.borderSkipped,l=s||wt(n);return{topLeft:Ps(!l||a.top||a.left,r.topLeft,0,o),topRight:Ps(!l||a.top||a.right,r.topRight,0,o),bottomLeft:Ps(!l||a.bottom||a.left,r.bottomLeft,0,o),bottomRight:Ps(!l||a.bottom||a.right,r.bottomRight,0,o)}}function g$(i){const t=R_(i),e=t.right-t.left,s=t.bottom-t.top,n=f$(i,e/2,s/2),r=m$(i,e/2,s/2);return{outer:{x:t.left,y:t.top,w:e,h:s,radius:r},inner:{x:t.left+n.l,y:t.top+n.t,w:e-n.l-n.r,h:s-n.t-n.b,radius:{topLeft:Math.max(0,r.topLeft-Math.max(n.t,n.l)),topRight:Math.max(0,r.topRight-Math.max(n.t,n.r)),bottomLeft:Math.max(0,r.bottomLeft-Math.max(n.b,n.l)),bottomRight:Math.max(0,r.bottomRight-Math.max(n.b,n.r))}}}}function Hh(i,t,e,s){const n=t===null,r=e===null,o=i&&!(n&&r)&&R_(i,s);return o&&(n||Ji(t,o.left,o.right))&&(r||Ji(e,o.top,o.bottom))}function b$(i){return i.topLeft||i.topRight||i.bottomLeft||i.bottomRight}function y$(i,t){i.rect(t.x,t.y,t.w,t.h)}function Wh(i,t,e={}){const s=i.x!==e.x?-t:0,n=i.y!==e.y?-t:0,r=(i.x+i.w!==e.x+e.w?t:0)-s,o=(i.y+i.h!==e.y+e.h?t:0)-n;return{x:i.x+s,y:i.y+n,w:i.w+r,h:i.h+o,radius:i.radius}}class Do extends ps{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:s,backgroundColor:n}}=this,{inner:r,outer:o}=g$(this),a=b$(o.radius)?ta:y$;t.save(),(o.w!==r.w||o.h!==r.h)&&(t.beginPath(),a(t,Wh(o,e,r)),t.clip(),a(t,Wh(r,-e,o)),t.fillStyle=s,t.fill("evenodd")),t.beginPath(),a(t,Wh(r,e)),t.fillStyle=n,t.fill(),t.restore()}inRange(t,e,s){return Hh(this,t,e,s)}inXRange(t,e){return Hh(this,t,null,e)}inYRange(t,e){return Hh(this,null,t,e)}getCenterPoint(t){const{x:e,y:s,base:n,horizontal:r}=this.getProps(["x","y","base","horizontal"],t);return{x:r?(e+n)/2:e,y:r?s:(s+n)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}it(Do,"id","bar"),it(Do,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),it(Do,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var v$=Object.freeze({__proto__:null,ArcElement:tr,BarElement:Do,LineElement:Ms,PointElement:Oo});const Yd=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],yg=Yd.map(i=>i.replace("rgb(","rgba(").replace(")",", 0.5)"));function B_(i){return Yd[i%Yd.length]}function N_(i){return yg[i%yg.length]}function _$(i,t){return i.borderColor=B_(t),i.backgroundColor=N_(t),++t}function w$(i,t){return i.backgroundColor=i.data.map(()=>B_(t++)),t}function x$(i,t){return i.backgroundColor=i.data.map(()=>N_(t++)),t}function C$(i){let t=0;return(e,s)=>{const n=i.getDatasetMeta(s).controller;n instanceof gn?t=w$(e,t):n instanceof $o?t=x$(e,t):n&&(t=_$(e,t))}}function vg(i){let t;for(t in i)if(i[t].borderColor||i[t].backgroundColor)return!0;return!1}function S$(i){return i&&(i.borderColor||i.backgroundColor)}function E$(){return Ht.borderColor!=="rgba(0,0,0,0.1)"||Ht.backgroundColor!=="rgba(0,0,0,0.1)"}var k$={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(i,t,e){if(!e.enabled)return;const{data:{datasets:s},options:n}=i.config,{elements:r}=n,o=vg(s)||S$(n)||r&&vg(r)||E$();if(!e.forceOverride&&o)return;const a=C$(i);s.forEach(a)}};function A$(i,t,e,s,n){const r=n.samples||s;if(r>=e)return i.slice(t,t+e);const o=[],a=(e-2)/(r-2);let l=0;const c=t+e-1;let h=t,d,u,p,m,f;for(o[l++]=i[h],d=0;d<r-2;d++){let b=0,g=0,y;const v=Math.floor((d+1)*a)+1+t,_=Math.min(Math.floor((d+2)*a)+1,e)+t,x=_-v;for(y=v;y<_;y++)b+=i[y].x,g+=i[y].y;b/=x,g/=x;const S=Math.floor(d*a)+1+t,k=Math.min(Math.floor((d+1)*a)+1,e)+t,{x:T,y:M}=i[h];for(p=m=-1,y=S;y<k;y++)m=.5*Math.abs((T-b)*(i[y].y-M)-(T-i[y].x)*(g-M)),m>p&&(p=m,u=i[y],f=y);o[l++]=u,h=f}return o[l++]=i[c],o}function T$(i,t,e,s){let n=0,r=0,o,a,l,c,h,d,u,p,m,f;const b=[],g=t+e-1,y=i[t].x,v=i[g].x-y;for(o=t;o<t+e;++o){a=i[o],l=(a.x-y)/v*s,c=a.y;const _=l|0;if(_===h)c<m?(m=c,d=o):c>f&&(f=c,u=o),n=(r*n+a.x)/++r;else{const x=o-1;if(!bt(d)&&!bt(u)){const S=Math.min(d,u),k=Math.max(d,u);S!==p&&S!==x&&b.push({...i[S],x:n}),k!==p&&k!==x&&b.push({...i[k],x:n})}o>0&&x!==p&&b.push(i[x]),b.push(a),h=_,r=0,m=f=c,d=u=p=o}}return b}function F_(i){if(i._decimated){const t=i._data;delete i._decimated,delete i._data,Object.defineProperty(i,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function _g(i){i.data.datasets.forEach(t=>{F_(t)})}function M$(i,t){const e=t.length;let s=0,n;const{iScale:r}=i,{min:o,max:a,minDefined:l,maxDefined:c}=r.getUserBounds();return l&&(s=fe(ts(t,r.axis,o).lo,0,e-1)),c?n=fe(ts(t,r.axis,a).hi+1,s,e)-s:n=e-s,{start:s,count:n}}var P$={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(i,t,e)=>{if(!e.enabled){_g(i);return}const s=i.width;i.data.datasets.forEach((n,r)=>{const{_data:o,indexAxis:a}=n,l=i.getDatasetMeta(r),c=o||n.data;if(Ut([a,i.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const h=i.scales[l.xAxisID];if(h.type!=="linear"&&h.type!=="time"||i.options.parsing)return;let{start:d,count:u}=M$(l,c);const p=e.threshold||4*s;if(u<=p){F_(n);return}bt(o)&&(n._data=c,delete n.data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(f){this._data=f}}));let m;switch(e.algorithm){case"lttb":m=A$(c,d,u,s,e);break;case"min-max":m=T$(c,d,u,s);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}n._decimated=m})},destroy(i){_g(i)}};function $$(i,t,e){const s=i.segments,n=i.points,r=t.points,o=[];for(const a of s){let{start:l,end:c}=a;c=Zc(l,c,n);const h=Zd(e,n[l],n[c],a.loop);if(!t.segments){o.push({source:a,target:h,start:n[l],end:n[c]});continue}const d=w_(t,h);for(const u of d){const p=Zd(e,r[u.start],r[u.end],u.loop),m=__(a,n,p);for(const f of m)o.push({source:f,target:u,start:{[e]:wg(h,p,"start",Math.max)},end:{[e]:wg(h,p,"end",Math.min)}})}}return o}function Zd(i,t,e,s){if(s)return;let n=t[i],r=e[i];return i==="angle"&&(n=Pe(n),r=Pe(r)),{property:i,start:n,end:r}}function O$(i,t){const{x:e=null,y:s=null}=i||{},n=t.points,r=[];return t.segments.forEach(({start:o,end:a})=>{a=Zc(o,a,n);const l=n[o],c=n[a];s!==null?(r.push({x:l.x,y:s}),r.push({x:c.x,y:s})):e!==null&&(r.push({x:e,y:l.y}),r.push({x:e,y:c.y}))}),r}function Zc(i,t,e){for(;t>i;t--){const s=e[t];if(!isNaN(s.x)&&!isNaN(s.y))break}return t}function wg(i,t,e,s){return i&&t?s(i[e],t[e]):i?i[e]:t?t[e]:0}function U_(i,t){let e=[],s=!1;return jt(i)?(s=!0,e=i):e=O$(i,t),e.length?new Ms({points:e,options:{tension:0},_loop:s,_fullLoop:s}):null}function xg(i){return i&&i.fill!==!1}function D$(i,t,e){let s=i[t].fill;const n=[t];let r;if(!e)return s;for(;s!==!1&&n.indexOf(s)===-1;){if(!Jt(s))return s;if(r=i[s],!r)return!1;if(r.visible)return s;n.push(s),s=r.fill}return!1}function I$(i,t,e){const s=B$(i);if(wt(s))return isNaN(s.value)?!1:s;let n=parseFloat(s);return Jt(n)&&Math.floor(n)===n?z$(s[0],t,n,e):["origin","start","end","stack","shape"].indexOf(s)>=0&&s}function z$(i,t,e,s){return(i==="-"||i==="+")&&(e=t+e),e===t||e<0||e>=s?!1:e}function L$(i,t){let e=null;return i==="start"?e=t.bottom:i==="end"?e=t.top:wt(i)?e=t.getPixelForValue(i.value):t.getBasePixel&&(e=t.getBasePixel()),e}function R$(i,t,e){let s;return i==="start"?s=e:i==="end"?s=t.options.reverse?t.min:t.max:wt(i)?s=i.value:s=t.getBaseValue(),s}function B$(i){const t=i.options,e=t.fill;let s=mt(e&&e.target,e);return s===void 0&&(s=!!t.backgroundColor),s===!1||s===null?!1:s===!0?"origin":s}function N$(i){const{scale:t,index:e,line:s}=i,n=[],r=s.segments,o=s.points,a=F$(t,e);a.push(U_({x:null,y:t.bottom},s));for(let l=0;l<r.length;l++){const c=r[l];for(let h=c.start;h<=c.end;h++)U$(n,o[h],a)}return new Ms({points:n,options:{}})}function F$(i,t){const e=[],s=i.getMatchingVisibleMetas("line");for(let n=0;n<s.length;n++){const r=s[n];if(r.index===t)break;r.hidden||e.unshift(r.dataset)}return e}function U$(i,t,e){const s=[];for(let n=0;n<e.length;n++){const r=e[n],{first:o,last:a,point:l}=j$(r,t,"x");if(!(!l||o&&a)){if(o)s.unshift(l);else if(i.push(l),!a)break}}i.push(...s)}function j$(i,t,e){const s=i.interpolate(t,e);if(!s)return{};const n=s[e],r=i.segments,o=i.points;let a=!1,l=!1;for(let c=0;c<r.length;c++){const h=r[c],d=o[h.start][e],u=o[h.end][e];if(Ji(n,d,u)){a=n===d,l=n===u;break}}return{first:a,last:l,point:s}}class j_{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,s){const{x:n,y:r,radius:o}=this;return e=e||{start:0,end:Vt},t.arc(n,r,o,e.end,e.start,!0),!s.bounds}interpolate(t){const{x:e,y:s,radius:n}=this,r=t.angle;return{x:e+Math.cos(r)*n,y:s+Math.sin(r)*n,angle:r}}}function V$(i){const{chart:t,fill:e,line:s}=i;if(Jt(e))return H$(t,e);if(e==="stack")return N$(i);if(e==="shape")return!0;const n=W$(i);return n instanceof j_?n:U_(n,s)}function H$(i,t){const e=i.getDatasetMeta(t);return e&&i.isDatasetVisible(t)?e.dataset:null}function W$(i){return(i.scale||{}).getPointPositionForValue?Y$(i):q$(i)}function q$(i){const{scale:t={},fill:e}=i,s=L$(e,t);if(Jt(s)){const n=t.isHorizontal();return{x:n?s:null,y:n?null:s}}return null}function Y$(i){const{scale:t,fill:e}=i,s=t.options,n=t.getLabels().length,r=s.reverse?t.max:t.min,o=R$(e,t,r),a=[];if(s.grid.circular){const l=t.getPointPositionForValue(0,r);return new j_({x:l.x,y:l.y,radius:t.getDistanceFromCenterForValue(o)})}for(let l=0;l<n;++l)a.push(t.getPointPositionForValue(l,o));return a}function qh(i,t,e){const s=V$(t),{chart:n,index:r,line:o,scale:a,axis:l}=t,c=o.options,h=c.fill,d=c.backgroundColor,{above:u=d,below:p=d}=h||{},m=n.getDatasetMeta(r),f=x_(n,m);s&&o.points.length&&(Hc(i,e),Z$(i,{line:o,target:s,above:u,below:p,area:e,scale:a,axis:l,clip:f}),Wc(i))}function Z$(i,t){const{line:e,target:s,above:n,below:r,area:o,scale:a,clip:l}=t,c=e._loop?"angle":t.axis;i.save();let h=r;r!==n&&(c==="x"?(Cg(i,s,o.top),Yh(i,{line:e,target:s,color:n,scale:a,property:c,clip:l}),i.restore(),i.save(),Cg(i,s,o.bottom)):c==="y"&&(Sg(i,s,o.left),Yh(i,{line:e,target:s,color:r,scale:a,property:c,clip:l}),i.restore(),i.save(),Sg(i,s,o.right),h=n)),Yh(i,{line:e,target:s,color:h,scale:a,property:c,clip:l}),i.restore()}function Cg(i,t,e){const{segments:s,points:n}=t;let r=!0,o=!1;i.beginPath();for(const a of s){const{start:l,end:c}=a,h=n[l],d=n[Zc(l,c,n)];r?(i.moveTo(h.x,h.y),r=!1):(i.lineTo(h.x,e),i.lineTo(h.x,h.y)),o=!!t.pathSegment(i,a,{move:o}),o?i.closePath():i.lineTo(d.x,e)}i.lineTo(t.first().x,e),i.closePath(),i.clip()}function Sg(i,t,e){const{segments:s,points:n}=t;let r=!0,o=!1;i.beginPath();for(const a of s){const{start:l,end:c}=a,h=n[l],d=n[Zc(l,c,n)];r?(i.moveTo(h.x,h.y),r=!1):(i.lineTo(e,h.y),i.lineTo(h.x,h.y)),o=!!t.pathSegment(i,a,{move:o}),o?i.closePath():i.lineTo(e,d.y)}i.lineTo(e,t.first().y),i.closePath(),i.clip()}function Yh(i,t){const{line:e,target:s,property:n,color:r,scale:o,clip:a}=t,l=$$(e,s,n);for(const{source:c,target:h,start:d,end:u}of l){const{style:{backgroundColor:p=r}={}}=c,m=s!==!0;i.save(),i.fillStyle=p,G$(i,o,a,m&&Zd(n,d,u)),i.beginPath();const f=!!e.pathSegment(i,c);let b;if(m){f?i.closePath():Eg(i,s,u,n);const g=!!s.pathSegment(i,h,{move:f,reverse:!0});b=f&&g,b||Eg(i,s,d,n)}i.closePath(),i.fill(b?"evenodd":"nonzero"),i.restore()}}function G$(i,t,e,s){const n=t.chart.chartArea,{property:r,start:o,end:a}=s||{};if(r==="x"||r==="y"){let l,c,h,d;r==="x"?(l=o,c=n.top,h=a,d=n.bottom):(l=n.left,c=o,h=n.right,d=a),i.beginPath(),e&&(l=Math.max(l,e.left),h=Math.min(h,e.right),c=Math.max(c,e.top),d=Math.min(d,e.bottom)),i.rect(l,c,h-l,d-c),i.clip()}}function Eg(i,t,e,s){const n=t.interpolate(e,s);n&&i.lineTo(n.x,n.y)}var X$={id:"filler",afterDatasetsUpdate(i,t,e){const s=(i.data.datasets||[]).length,n=[];let r,o,a,l;for(o=0;o<s;++o)r=i.getDatasetMeta(o),a=r.dataset,l=null,a&&a.options&&a instanceof Ms&&(l={visible:i.isDatasetVisible(o),index:o,fill:I$(a,o,s),chart:i,axis:r.controller.options.indexAxis,scale:r.vScale,line:a}),r.$filler=l,n.push(l);for(o=0;o<s;++o)l=n[o],!(!l||l.fill===!1)&&(l.fill=D$(n,o,e.propagate))},beforeDraw(i,t,e){const s=e.drawTime==="beforeDraw",n=i.getSortedVisibleDatasetMetas(),r=i.chartArea;for(let o=n.length-1;o>=0;--o){const a=n[o].$filler;a&&(a.line.updateControlPoints(r,a.axis),s&&a.fill&&qh(i.ctx,a,r))}},beforeDatasetsDraw(i,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const s=i.getSortedVisibleDatasetMetas();for(let n=s.length-1;n>=0;--n){const r=s[n].$filler;xg(r)&&qh(i.ctx,r,i.chartArea)}},beforeDatasetDraw(i,t,e){const s=t.meta.$filler;!xg(s)||e.drawTime!=="beforeDatasetDraw"||qh(i.ctx,s,i.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const kg=(i,t)=>{let{boxHeight:e=t,boxWidth:s=t}=i;return i.usePointStyle&&(e=Math.min(e,t),s=i.pointStyleWidth||Math.min(s,t)),{boxWidth:s,boxHeight:e,itemHeight:Math.max(t,e)}},K$=(i,t)=>i!==null&&t!==null&&i.datasetIndex===t.datasetIndex&&i.index===t.index;class Ag extends ps{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,s){this.maxWidth=t,this.maxHeight=e,this._margins=s,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=Dt(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(s=>t.filter(s,this.chart.data))),t.sort&&(e=e.sort((s,n)=>t.sort(s,n,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const s=t.labels,n=de(s.font),r=n.size,o=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=kg(s,r);let c,h;e.font=n.string,this.isHorizontal()?(c=this.maxWidth,h=this._fitRows(o,r,a,l)+10):(h=this.maxHeight,c=this._fitCols(o,n,a,l)+10),this.width=Math.min(c,t.maxWidth||this.maxWidth),this.height=Math.min(h,t.maxHeight||this.maxHeight)}_fitRows(t,e,s,n){const{ctx:r,maxWidth:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],h=n+a;let d=t;r.textAlign="left",r.textBaseline="middle";let u=-1,p=-h;return this.legendItems.forEach((m,f)=>{const b=s+e/2+r.measureText(m.text).width;(f===0||c[c.length-1]+b+2*a>o)&&(d+=h,c[c.length-(f>0?0:1)]=0,p+=h,u++),l[f]={left:0,top:p,row:u,width:b,height:n},c[c.length-1]+=b+a}),d}_fitCols(t,e,s,n){const{ctx:r,maxHeight:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],h=o-t;let d=a,u=0,p=0,m=0,f=0;return this.legendItems.forEach((b,g)=>{const{itemWidth:y,itemHeight:v}=Q$(s,e,r,b,n);g>0&&p+v+2*a>h&&(d+=u+a,c.push({width:u,height:p}),m+=u+a,f++,u=p=0),l[g]={left:m,top:p,col:f,width:y,height:v},u=Math.max(u,y),p+=v+a}),d+=u,c.push({width:u,height:p}),d}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:s,labels:{padding:n},rtl:r}}=this,o=nr(r,this.left,this.width);if(this.isHorizontal()){let a=0,l=Me(s,this.left+n,this.right-this.lineWidths[a]);for(const c of e)a!==c.row&&(a=c.row,l=Me(s,this.left+n,this.right-this.lineWidths[a])),c.top+=this.top+t+n,c.left=o.leftForLtr(o.x(l),c.width),l+=c.width+n}else{let a=0,l=Me(s,this.top+t+n,this.bottom-this.columnSizes[a].height);for(const c of e)c.col!==a&&(a=c.col,l=Me(s,this.top+t+n,this.bottom-this.columnSizes[a].height)),c.top=l,c.left+=this.left+n,c.left=o.leftForLtr(o.x(c.left),c.width),l+=c.height+n}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;Hc(t,this),this._draw(),Wc(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:s,ctx:n}=this,{align:r,labels:o}=t,a=Ht.color,l=nr(t.rtl,this.left,this.width),c=de(o.font),{padding:h}=o,d=c.size,u=d/2;let p;this.drawTitle(),n.textAlign=l.textAlign("left"),n.textBaseline="middle",n.lineWidth=.5,n.font=c.string;const{boxWidth:m,boxHeight:f,itemHeight:b}=kg(o,d),g=function(S,k,T){if(isNaN(m)||m<=0||isNaN(f)||f<0)return;n.save();const M=mt(T.lineWidth,1);if(n.fillStyle=mt(T.fillStyle,a),n.lineCap=mt(T.lineCap,"butt"),n.lineDashOffset=mt(T.lineDashOffset,0),n.lineJoin=mt(T.lineJoin,"miter"),n.lineWidth=M,n.strokeStyle=mt(T.strokeStyle,a),n.setLineDash(mt(T.lineDash,[])),o.usePointStyle){const O={radius:f*Math.SQRT2/2,pointStyle:T.pointStyle,rotation:T.rotation,borderWidth:M},R=l.xPlus(S,m/2),A=k+u;c_(n,O,R,A,o.pointStyleWidth&&m)}else{const O=k+Math.max((d-f)/2,0),R=l.leftForLtr(S,m),A=_n(T.borderRadius);n.beginPath(),Object.values(A).some($=>$!==0)?ta(n,{x:R,y:O,w:m,h:f,radius:A}):n.rect(R,O,m,f),n.fill(),M!==0&&n.stroke()}n.restore()},y=function(S,k,T){kn(n,T.text,S,k+b/2,c,{strikethrough:T.hidden,textAlign:l.textAlign(T.textAlign)})},v=this.isHorizontal(),_=this._computeTitleHeight();v?p={x:Me(r,this.left+h,this.right-s[0]),y:this.top+h+_,line:0}:p={x:this.left+h,y:Me(r,this.top+_+h,this.bottom-e[0].height),line:0},b_(this.ctx,t.textDirection);const x=b+h;this.legendItems.forEach((S,k)=>{n.strokeStyle=S.fontColor,n.fillStyle=S.fontColor;const T=n.measureText(S.text).width,M=l.textAlign(S.textAlign||(S.textAlign=o.textAlign)),O=m+u+T;let R=p.x,A=p.y;l.setWidth(this.width),v?k>0&&R+O+h>this.right&&(A=p.y+=x,p.line++,R=p.x=Me(r,this.left+h,this.right-s[p.line])):k>0&&A+x>this.bottom&&(R=p.x=R+e[p.line].width+h,p.line++,A=p.y=Me(r,this.top+_+h,this.bottom-e[p.line].height));const $=l.x(R);if(g($,A,S),R=bT(M,R+m+u,v?R+O:this.right,t.rtl),y(l.x(R),A,S),v)p.x+=O+h;else if(typeof S.text!="string"){const w=c.lineHeight;p.y+=V_(S,w)+h}else p.y+=x}),y_(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,s=de(e.font),n=Ce(e.padding);if(!e.display)return;const r=nr(t.rtl,this.left,this.width),o=this.ctx,a=e.position,l=s.size/2,c=n.top+l;let h,d=this.left,u=this.width;if(this.isHorizontal())u=Math.max(...this.lineWidths),h=this.top+c,d=Me(t.align,d,this.right-u);else{const m=this.columnSizes.reduce((f,b)=>Math.max(f,b.height),0);h=c+Me(t.align,this.top,this.bottom-m-t.labels.padding-this._computeTitleHeight())}const p=Me(a,d,d+u);o.textAlign=r.textAlign(Ju(a)),o.textBaseline="middle",o.strokeStyle=e.color,o.fillStyle=e.color,o.font=s.string,kn(o,e.text,p,h,s)}_computeTitleHeight(){const t=this.options.title,e=de(t.font),s=Ce(t.padding);return t.display?e.lineHeight+s.height:0}_getLegendItemAt(t,e){let s,n,r;if(Ji(t,this.left,this.right)&&Ji(e,this.top,this.bottom)){for(r=this.legendHitBoxes,s=0;s<r.length;++s)if(n=r[s],Ji(t,n.left,n.left+n.width)&&Ji(e,n.top,n.top+n.height))return this.legendItems[s]}return null}handleEvent(t){const e=this.options;if(!eO(t.type,e))return;const s=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const n=this._hoveredItem,r=K$(n,s);n&&!r&&Dt(e.onLeave,[t,n,this],this),this._hoveredItem=s,s&&!r&&Dt(e.onHover,[t,s,this],this)}else s&&Dt(e.onClick,[t,s,this],this)}}function Q$(i,t,e,s,n){const r=J$(s,i,t,e),o=tO(n,s,t.lineHeight);return{itemWidth:r,itemHeight:o}}function J$(i,t,e,s){let n=i.text;return n&&typeof n!="string"&&(n=n.reduce((r,o)=>r.length>o.length?r:o)),t+e.size/2+s.measureText(n).width}function tO(i,t,e){let s=i;return typeof t.text!="string"&&(s=V_(t,e)),s}function V_(i,t){const e=i.text?i.text.length:0;return t*e}function eO(i,t){return!!((i==="mousemove"||i==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(i==="click"||i==="mouseup"))}var iO={id:"legend",_element:Ag,start(i,t,e){const s=i.legend=new Ag({ctx:i.ctx,options:e,chart:i});$e.configure(i,s,e),$e.addBox(i,s)},stop(i){$e.removeBox(i,i.legend),delete i.legend},beforeUpdate(i,t,e){const s=i.legend;$e.configure(i,s,e),s.options=e},afterUpdate(i){const t=i.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(i,t){t.replay||i.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(i,t,e){const s=t.datasetIndex,n=e.chart;n.isDatasetVisible(s)?(n.hide(s),t.hidden=!0):(n.show(s),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:i=>i.chart.options.color,boxWidth:40,padding:10,generateLabels(i){const t=i.data.datasets,{labels:{usePointStyle:e,pointStyle:s,textAlign:n,color:r,useBorderRadius:o,borderRadius:a}}=i.legend.options;return i._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(e?0:void 0),h=Ce(c.borderWidth);return{text:t[l.index].label,fillStyle:c.backgroundColor,fontColor:r,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(h.width+h.height)/4,strokeStyle:c.borderColor,pointStyle:s||c.pointStyle,rotation:c.rotation,textAlign:n||c.textAlign,borderRadius:o&&(a||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:i=>i.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:i=>!i.startsWith("on"),labels:{_scriptable:i=>!["generateLabels","filter","sort"].includes(i)}}};class lp extends ps{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const s=this.options;if(this.left=0,this.top=0,!s.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const n=jt(s.text)?s.text.length:1;this._padding=Ce(s.padding);const r=n*de(s.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:s,bottom:n,right:r,options:o}=this,a=o.align;let l=0,c,h,d;return this.isHorizontal()?(h=Me(a,s,r),d=e+t,c=r-s):(o.position==="left"?(h=s+t,d=Me(a,n,e),l=kt*-.5):(h=r-t,d=Me(a,e,n),l=kt*.5),c=n-e),{titleX:h,titleY:d,maxWidth:c,rotation:l}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const s=de(e.font),n=s.lineHeight/2+this._padding.top,{titleX:r,titleY:o,maxWidth:a,rotation:l}=this._drawArgs(n);kn(t,e.text,0,0,s,{color:e.color,maxWidth:a,rotation:l,textAlign:Ju(e.align),textBaseline:"middle",translation:[r,o]})}}function sO(i,t){const e=new lp({ctx:i.ctx,options:t,chart:i});$e.configure(i,e,t),$e.addBox(i,e),i.titleBlock=e}var nO={id:"title",_element:lp,start(i,t,e){sO(i,e)},stop(i){const t=i.titleBlock;$e.removeBox(i,t),delete i.titleBlock},beforeUpdate(i,t,e){const s=i.titleBlock;$e.configure(i,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const fl=new WeakMap;var rO={id:"subtitle",start(i,t,e){const s=new lp({ctx:i.ctx,options:e,chart:i});$e.configure(i,s,e),$e.addBox(i,s),fl.set(i,s)},stop(i){$e.removeBox(i,fl.get(i)),fl.delete(i)},beforeUpdate(i,t,e){const s=fl.get(i);$e.configure(i,s,e),s.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const bo={average(i){if(!i.length)return!1;let t,e,s=new Set,n=0,r=0;for(t=0,e=i.length;t<e;++t){const o=i[t].element;if(o&&o.hasValue()){const a=o.tooltipPosition();s.add(a.x),n+=a.y,++r}}return r===0||s.size===0?!1:{x:[...s].reduce((o,a)=>o+a)/s.size,y:n/r}},nearest(i,t){if(!i.length)return!1;let e=t.x,s=t.y,n=Number.POSITIVE_INFINITY,r,o,a;for(r=0,o=i.length;r<o;++r){const l=i[r].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),h=Fd(t,c);h<n&&(n=h,a=l)}}if(a){const l=a.tooltipPosition();e=l.x,s=l.y}return{x:e,y:s}}};function zi(i,t){return t&&(jt(t)?Array.prototype.push.apply(i,t):i.push(t)),i}function Gi(i){return(typeof i=="string"||i instanceof String)&&i.indexOf(`
`)>-1?i.split(`
`):i}function oO(i,t){const{element:e,datasetIndex:s,index:n}=t,r=i.getDatasetMeta(s).controller,{label:o,value:a}=r.getLabelAndValue(n);return{chart:i,label:o,parsed:r.getParsed(n),raw:i.data.datasets[s].data[n],formattedValue:a,dataset:r.getDataset(),dataIndex:n,datasetIndex:s,element:e}}function Tg(i,t){const e=i.chart.ctx,{body:s,footer:n,title:r}=i,{boxWidth:o,boxHeight:a}=t,l=de(t.bodyFont),c=de(t.titleFont),h=de(t.footerFont),d=r.length,u=n.length,p=s.length,m=Ce(t.padding);let f=m.height,b=0,g=s.reduce((_,x)=>_+x.before.length+x.lines.length+x.after.length,0);if(g+=i.beforeBody.length+i.afterBody.length,d&&(f+=d*c.lineHeight+(d-1)*t.titleSpacing+t.titleMarginBottom),g){const _=t.displayColors?Math.max(a,l.lineHeight):l.lineHeight;f+=p*_+(g-p)*l.lineHeight+(g-1)*t.bodySpacing}u&&(f+=t.footerMarginTop+u*h.lineHeight+(u-1)*t.footerSpacing);let y=0;const v=function(_){b=Math.max(b,e.measureText(_).width+y)};return e.save(),e.font=c.string,Mt(i.title,v),e.font=l.string,Mt(i.beforeBody.concat(i.afterBody),v),y=t.displayColors?o+2+t.boxPadding:0,Mt(s,_=>{Mt(_.before,v),Mt(_.lines,v),Mt(_.after,v)}),y=0,e.font=h.string,Mt(i.footer,v),e.restore(),b+=m.width,{width:b,height:f}}function aO(i,t){const{y:e,height:s}=t;return e<s/2?"top":e>i.height-s/2?"bottom":"center"}function lO(i,t,e,s){const{x:n,width:r}=s,o=e.caretSize+e.caretPadding;if(i==="left"&&n+r+o>t.width||i==="right"&&n-r-o<0)return!0}function cO(i,t,e,s){const{x:n,width:r}=e,{width:o,chartArea:{left:a,right:l}}=i;let c="center";return s==="center"?c=n<=(a+l)/2?"left":"right":n<=r/2?c="left":n>=o-r/2&&(c="right"),lO(c,i,t,e)&&(c="center"),c}function Mg(i,t,e){const s=e.yAlign||t.yAlign||aO(i,e);return{xAlign:e.xAlign||t.xAlign||cO(i,t,e,s),yAlign:s}}function hO(i,t){let{x:e,width:s}=i;return t==="right"?e-=s:t==="center"&&(e-=s/2),e}function dO(i,t,e){let{y:s,height:n}=i;return t==="top"?s+=e:t==="bottom"?s-=n+e:s-=n/2,s}function Pg(i,t,e,s){const{caretSize:n,caretPadding:r,cornerRadius:o}=i,{xAlign:a,yAlign:l}=e,c=n+r,{topLeft:h,topRight:d,bottomLeft:u,bottomRight:p}=_n(o);let m=hO(t,a);const f=dO(t,l,c);return l==="center"?a==="left"?m+=c:a==="right"&&(m-=c):a==="left"?m-=Math.max(h,u)+n:a==="right"&&(m+=Math.max(d,p)+n),{x:fe(m,0,s.width-t.width),y:fe(f,0,s.height-t.height)}}function ml(i,t,e){const s=Ce(e.padding);return t==="center"?i.x+i.width/2:t==="right"?i.x+i.width-s.right:i.x+s.left}function $g(i){return zi([],Gi(i))}function uO(i,t,e){return Qs(i,{tooltip:t,tooltipItems:e,type:"tooltip"})}function Og(i,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?i.override(e):i}const H_={beforeTitle:qi,title(i){if(i.length>0){const t=i[0],e=t.chart.data.labels,s=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(s>0&&t.dataIndex<s)return e[t.dataIndex]}return""},afterTitle:qi,beforeBody:qi,beforeLabel:qi,label(i){if(this&&this.options&&this.options.mode==="dataset")return i.label+": "+i.formattedValue||i.formattedValue;let t=i.dataset.label||"";t&&(t+=": ");const e=i.formattedValue;return bt(e)||(t+=e),t},labelColor(i){const t=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(i){const t=i.chart.getDatasetMeta(i.datasetIndex).controller.getStyle(i.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:qi,afterBody:qi,beforeFooter:qi,footer:qi,afterFooter:qi};function Ue(i,t,e,s){const n=i[t].call(e,s);return typeof n>"u"?H_[t].call(e,s):n}var Zh;let Dg=(Zh=class extends ps{constructor(i){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=i.chart,this.options=i.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(i){this.options=i,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const i=this._cachedAnimations;if(i)return i;const t=this.chart,e=this.options.setContext(this.getContext()),s=e.enabled&&t.options.animation&&e.animations,n=new C_(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(n)),n}getContext(){return this.$context||(this.$context=uO(this.chart.getContext(),this,this._tooltipItems))}getTitle(i,t){const{callbacks:e}=t,s=Ue(e,"beforeTitle",this,i),n=Ue(e,"title",this,i),r=Ue(e,"afterTitle",this,i);let o=[];return o=zi(o,Gi(s)),o=zi(o,Gi(n)),o=zi(o,Gi(r)),o}getBeforeBody(i,t){return $g(Ue(t.callbacks,"beforeBody",this,i))}getBody(i,t){const{callbacks:e}=t,s=[];return Mt(i,n=>{const r={before:[],lines:[],after:[]},o=Og(e,n);zi(r.before,Gi(Ue(o,"beforeLabel",this,n))),zi(r.lines,Ue(o,"label",this,n)),zi(r.after,Gi(Ue(o,"afterLabel",this,n))),s.push(r)}),s}getAfterBody(i,t){return $g(Ue(t.callbacks,"afterBody",this,i))}getFooter(i,t){const{callbacks:e}=t,s=Ue(e,"beforeFooter",this,i),n=Ue(e,"footer",this,i),r=Ue(e,"afterFooter",this,i);let o=[];return o=zi(o,Gi(s)),o=zi(o,Gi(n)),o=zi(o,Gi(r)),o}_createItems(i){const t=this._active,e=this.chart.data,s=[],n=[],r=[];let o=[],a,l;for(a=0,l=t.length;a<l;++a)o.push(oO(this.chart,t[a]));return i.filter&&(o=o.filter((c,h,d)=>i.filter(c,h,d,e))),i.itemSort&&(o=o.sort((c,h)=>i.itemSort(c,h,e))),Mt(o,c=>{const h=Og(i.callbacks,c);s.push(Ue(h,"labelColor",this,c)),n.push(Ue(h,"labelPointStyle",this,c)),r.push(Ue(h,"labelTextColor",this,c))}),this.labelColors=s,this.labelPointStyles=n,this.labelTextColors=r,this.dataPoints=o,o}update(i,t){const e=this.options.setContext(this.getContext()),s=this._active;let n,r=[];if(!s.length)this.opacity!==0&&(n={opacity:0});else{const o=bo[e.position].call(this,s,this._eventPosition);r=this._createItems(e),this.title=this.getTitle(r,e),this.beforeBody=this.getBeforeBody(r,e),this.body=this.getBody(r,e),this.afterBody=this.getAfterBody(r,e),this.footer=this.getFooter(r,e);const a=this._size=Tg(this,e),l=Object.assign({},o,a),c=Mg(this.chart,e,l),h=Pg(e,l,c,this.chart);this.xAlign=c.xAlign,this.yAlign=c.yAlign,n={opacity:1,x:h.x,y:h.y,width:a.width,height:a.height,caretX:o.x,caretY:o.y}}this._tooltipItems=r,this.$context=void 0,n&&this._resolveAnimations().update(this,n),i&&e.external&&e.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(i,t,e,s){const n=this.getCaretPosition(i,e,s);t.lineTo(n.x1,n.y1),t.lineTo(n.x2,n.y2),t.lineTo(n.x3,n.y3)}getCaretPosition(i,t,e){const{xAlign:s,yAlign:n}=this,{caretSize:r,cornerRadius:o}=e,{topLeft:a,topRight:l,bottomLeft:c,bottomRight:h}=_n(o),{x:d,y:u}=i,{width:p,height:m}=t;let f,b,g,y,v,_;return n==="center"?(v=u+m/2,s==="left"?(f=d,b=f-r,y=v+r,_=v-r):(f=d+p,b=f+r,y=v-r,_=v+r),g=f):(s==="left"?b=d+Math.max(a,c)+r:s==="right"?b=d+p-Math.max(l,h)-r:b=this.caretX,n==="top"?(y=u,v=y-r,f=b-r,g=b+r):(y=u+m,v=y+r,f=b+r,g=b-r),_=y),{x1:f,x2:b,x3:g,y1:y,y2:v,y3:_}}drawTitle(i,t,e){const s=this.title,n=s.length;let r,o,a;if(n){const l=nr(e.rtl,this.x,this.width);for(i.x=ml(this,e.titleAlign,e),t.textAlign=l.textAlign(e.titleAlign),t.textBaseline="middle",r=de(e.titleFont),o=e.titleSpacing,t.fillStyle=e.titleColor,t.font=r.string,a=0;a<n;++a)t.fillText(s[a],l.x(i.x),i.y+r.lineHeight/2),i.y+=r.lineHeight+o,a+1===n&&(i.y+=e.titleMarginBottom-o)}}_drawColorBox(i,t,e,s,n){const r=this.labelColors[e],o=this.labelPointStyles[e],{boxHeight:a,boxWidth:l}=n,c=de(n.bodyFont),h=ml(this,"left",n),d=s.x(h),u=a<c.lineHeight?(c.lineHeight-a)/2:0,p=t.y+u;if(n.usePointStyle){const m={radius:Math.min(l,a)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},f=s.leftForLtr(d,l)+l/2,b=p+a/2;i.strokeStyle=n.multiKeyBackground,i.fillStyle=n.multiKeyBackground,jd(i,m,f,b),i.strokeStyle=r.borderColor,i.fillStyle=r.backgroundColor,jd(i,m,f,b)}else{i.lineWidth=wt(r.borderWidth)?Math.max(...Object.values(r.borderWidth)):r.borderWidth||1,i.strokeStyle=r.borderColor,i.setLineDash(r.borderDash||[]),i.lineDashOffset=r.borderDashOffset||0;const m=s.leftForLtr(d,l),f=s.leftForLtr(s.xPlus(d,1),l-2),b=_n(r.borderRadius);Object.values(b).some(g=>g!==0)?(i.beginPath(),i.fillStyle=n.multiKeyBackground,ta(i,{x:m,y:p,w:l,h:a,radius:b}),i.fill(),i.stroke(),i.fillStyle=r.backgroundColor,i.beginPath(),ta(i,{x:f,y:p+1,w:l-2,h:a-2,radius:b}),i.fill()):(i.fillStyle=n.multiKeyBackground,i.fillRect(m,p,l,a),i.strokeRect(m,p,l,a),i.fillStyle=r.backgroundColor,i.fillRect(f,p+1,l-2,a-2))}i.fillStyle=this.labelTextColors[e]}drawBody(i,t,e){const{body:s}=this,{bodySpacing:n,bodyAlign:r,displayColors:o,boxHeight:a,boxWidth:l,boxPadding:c}=e,h=de(e.bodyFont);let d=h.lineHeight,u=0;const p=nr(e.rtl,this.x,this.width),m=function(k){t.fillText(k,p.x(i.x+u),i.y+d/2),i.y+=d+n},f=p.textAlign(r);let b,g,y,v,_,x,S;for(t.textAlign=r,t.textBaseline="middle",t.font=h.string,i.x=ml(this,f,e),t.fillStyle=e.bodyColor,Mt(this.beforeBody,m),u=o&&f!=="right"?r==="center"?l/2+c:l+2+c:0,v=0,x=s.length;v<x;++v){for(b=s[v],g=this.labelTextColors[v],t.fillStyle=g,Mt(b.before,m),y=b.lines,o&&y.length&&(this._drawColorBox(t,i,v,p,e),d=Math.max(h.lineHeight,a)),_=0,S=y.length;_<S;++_)m(y[_]),d=h.lineHeight;Mt(b.after,m)}u=0,d=h.lineHeight,Mt(this.afterBody,m),i.y-=n}drawFooter(i,t,e){const s=this.footer,n=s.length;let r,o;if(n){const a=nr(e.rtl,this.x,this.width);for(i.x=ml(this,e.footerAlign,e),i.y+=e.footerMarginTop,t.textAlign=a.textAlign(e.footerAlign),t.textBaseline="middle",r=de(e.footerFont),t.fillStyle=e.footerColor,t.font=r.string,o=0;o<n;++o)t.fillText(s[o],a.x(i.x),i.y+r.lineHeight/2),i.y+=r.lineHeight+e.footerSpacing}}drawBackground(i,t,e,s){const{xAlign:n,yAlign:r}=this,{x:o,y:a}=i,{width:l,height:c}=e,{topLeft:h,topRight:d,bottomLeft:u,bottomRight:p}=_n(s.cornerRadius);t.fillStyle=s.backgroundColor,t.strokeStyle=s.borderColor,t.lineWidth=s.borderWidth,t.beginPath(),t.moveTo(o+h,a),r==="top"&&this.drawCaret(i,t,e,s),t.lineTo(o+l-d,a),t.quadraticCurveTo(o+l,a,o+l,a+d),r==="center"&&n==="right"&&this.drawCaret(i,t,e,s),t.lineTo(o+l,a+c-p),t.quadraticCurveTo(o+l,a+c,o+l-p,a+c),r==="bottom"&&this.drawCaret(i,t,e,s),t.lineTo(o+u,a+c),t.quadraticCurveTo(o,a+c,o,a+c-u),r==="center"&&n==="left"&&this.drawCaret(i,t,e,s),t.lineTo(o,a+h),t.quadraticCurveTo(o,a,o+h,a),t.closePath(),t.fill(),s.borderWidth>0&&t.stroke()}_updateAnimationTarget(i){const t=this.chart,e=this.$animations,s=e&&e.x,n=e&&e.y;if(s||n){const r=bo[i.position].call(this,this._active,this._eventPosition);if(!r)return;const o=this._size=Tg(this,i),a=Object.assign({},r,this._size),l=Mg(t,i,a),c=Pg(i,a,l,t);(s._to!==c.x||n._to!==c.y)&&(this.xAlign=l.xAlign,this.yAlign=l.yAlign,this.width=o.width,this.height=o.height,this.caretX=r.x,this.caretY=r.y,this._resolveAnimations().update(this,c))}}_willRender(){return!!this.opacity}draw(i){const t=this.options.setContext(this.getContext());let e=this.opacity;if(!e)return;this._updateAnimationTarget(t);const s={width:this.width,height:this.height},n={x:this.x,y:this.y};e=Math.abs(e)<.001?0:e;const r=Ce(t.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&o&&(i.save(),i.globalAlpha=e,this.drawBackground(n,i,s,t),b_(i,t.textDirection),n.y+=r.top,this.drawTitle(n,i,t),this.drawBody(n,i,t),this.drawFooter(n,i,t),y_(i,t.textDirection),i.restore())}getActiveElements(){return this._active||[]}setActiveElements(i,t){const e=this._active,s=i.map(({datasetIndex:o,index:a})=>{const l=this.chart.getDatasetMeta(o);if(!l)throw new Error("Cannot find a dataset at index "+o);return{datasetIndex:o,element:l.data[a],index:a}}),n=!nc(e,s),r=this._positionChanged(s,t);(n||r)&&(this._active=s,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(i,t,e=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,n=this._active||[],r=this._getActiveElements(i,n,t,e),o=this._positionChanged(r,i),a=t||!nc(r,n)||o;return a&&(this._active=r,(s.enabled||s.external)&&(this._eventPosition={x:i.x,y:i.y},this.update(!0,t))),a}_getActiveElements(i,t,e,s){const n=this.options;if(i.type==="mouseout")return[];if(!s)return t.filter(o=>this.chart.data.datasets[o.datasetIndex]&&this.chart.getDatasetMeta(o.datasetIndex).controller.getParsed(o.index)!==void 0);const r=this.chart.getElementsAtEventForMode(i,n.mode,n,e);return n.reverse&&r.reverse(),r}_positionChanged(i,t){const{caretX:e,caretY:s,options:n}=this,r=bo[n.position].call(this,i,t);return r!==!1&&(e!==r.x||s!==r.y)}},it(Zh,"positioners",bo),Zh);var pO={id:"tooltip",_element:Dg,positioners:bo,afterInit(i,t,e){e&&(i.tooltip=new Dg({chart:i,options:e}))},beforeUpdate(i,t,e){i.tooltip&&i.tooltip.initialize(e)},reset(i,t,e){i.tooltip&&i.tooltip.initialize(e)},afterDraw(i){const t=i.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(i.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(i.ctx),i.notifyPlugins("afterTooltipDraw",e)}},afterEvent(i,t){if(i.tooltip){const e=t.replay;i.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(i,t)=>t.bodyFont.size,boxWidth:(i,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:H_},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:i=>i!=="filter"&&i!=="itemSort"&&i!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},fO=Object.freeze({__proto__:null,Colors:k$,Decimation:P$,Filler:X$,Legend:iO,SubTitle:rO,Title:nO,Tooltip:pO});const mO=(i,t,e,s)=>(typeof t=="string"?(e=i.push(t)-1,s.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function gO(i,t,e,s){const n=i.indexOf(t);if(n===-1)return mO(i,t,e,s);const r=i.lastIndexOf(t);return n!==r?e:n}const bO=(i,t)=>i===null?null:fe(Math.round(i),0,t);function W_(i){const t=this.getLabels();return i>=0&&i<t.length?t[i]:i}class Gd extends Mn{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const s=this.getLabels();for(const{index:n,label:r}of e)s[n]===r&&s.splice(n,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(bt(t))return null;const s=this.getLabels();return e=isFinite(e)&&s[e]===t?e:gO(s,t,mt(e,t),this._addedLabels),bO(e,s.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:s,max:n}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(s=0),e||(n=this.getLabels().length-1)),this.min=s,this.max=n}buildTicks(){const t=this.min,e=this.max,s=this.options.offset,n=[];let r=this.getLabels();r=t===0&&e===r.length-1?r:r.slice(t,e+1),this._valueRange=Math.max(r.length-(s?0:1),1),this._startValue=this.min-(s?.5:0);for(let o=t;o<=e;o++)n.push({value:o});return n}getLabelForValue(t){return W_.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}it(Gd,"id","category"),it(Gd,"defaults",{ticks:{callback:W_}});function yO(i,t){const e=[],{bounds:s,step:n,min:r,max:o,precision:a,count:l,maxTicks:c,maxDigits:h,includeBounds:d}=i,u=n||1,p=c-1,{min:m,max:f}=t,b=!bt(r),g=!bt(o),y=!bt(l),v=(f-m)/(h+1);let _=Tm((f-m)/p/u)*u,x,S,k,T;if(_<1e-14&&!b&&!g)return[{value:m},{value:f}];T=Math.ceil(f/_)-Math.floor(m/_),T>p&&(_=Tm(T*_/p/u)*u),bt(a)||(x=Math.pow(10,a),_=Math.ceil(_*x)/x),s==="ticks"?(S=Math.floor(m/_)*_,k=Math.ceil(f/_)*_):(S=m,k=f),b&&g&&n&&hT((o-r)/n,_/1e3)?(T=Math.round(Math.min((o-r)/_,c)),_=(o-r)/T,S=r,k=o):y?(S=b?r:S,k=g?o:k,T=l-1,_=(k-S)/T):(T=(k-S)/_,To(T,Math.round(T),_/1e3)?T=Math.round(T):T=Math.ceil(T));const M=Math.max(Mm(_),Mm(S));x=Math.pow(10,bt(a)?M:a),S=Math.round(S*x)/x,k=Math.round(k*x)/x;let O=0;for(b&&(d&&S!==r?(e.push({value:r}),S<r&&O++,To(Math.round((S+O*_)*x)/x,r,Ig(r,v,i))&&O++):S<r&&O++);O<T;++O){const R=Math.round((S+O*_)*x)/x;if(g&&R>o)break;e.push({value:R})}return g&&d&&k!==o?e.length&&To(e[e.length-1].value,o,Ig(o,v,i))?e[e.length-1].value=o:e.push({value:o}):(!g||k===o)&&e.push({value:k}),e}function Ig(i,t,{horizontal:e,minRotation:s}){const n=wi(s),r=(e?Math.sin(n):Math.cos(n))||.001,o=.75*t*(""+i).length;return Math.min(t/r,o)}class dc extends Mn{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return bt(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:s}=this.getUserBounds();let{min:n,max:r}=this;const o=l=>n=e?n:l,a=l=>r=s?r:l;if(t){const l=Fi(n),c=Fi(r);l<0&&c<0?a(0):l>0&&c>0&&o(0)}if(n===r){let l=r===0?1:Math.abs(r*.05);a(r+l),t||o(n-l)}this.min=n,this.max=r}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:s}=t,n;return s?(n=Math.ceil(this.max/s)-Math.floor(this.min/s)+1,n>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${s} would result generating up to ${n} ticks. Limiting to 1000.`),n=1e3)):(n=this.computeTickLimit(),e=e||11),e&&(n=Math.min(e,n)),n}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let s=this.getTickLimit();s=Math.max(2,s);const n={maxTicks:s,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},r=this._range||this,o=yO(n,r);return t.bounds==="ticks"&&t_(o,this,"value"),t.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const t=this.ticks;let e=this.min,s=this.max;if(super.configure(),this.options.offset&&t.length){const n=(s-e)/Math.max(t.length-1,1)/2;e-=n,s+=n}this._startValue=e,this._endValue=s,this._valueRange=s-e}getLabelForValue(t){return xa(t,this.chart.options.locale,this.options.ticks.format)}}class Xd extends dc{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=Jt(t)?t:0,this.max=Jt(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,s=wi(this.options.ticks.minRotation),n=(t?Math.sin(s):Math.cos(s))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,r.lineHeight/n))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}it(Xd,"id","linear"),it(Xd,"defaults",{ticks:{callback:Vc.formatters.numeric}});const sa=i=>Math.floor(As(i)),cn=(i,t)=>Math.pow(10,sa(i)+t);function zg(i){return i/Math.pow(10,sa(i))===1}function Lg(i,t,e){const s=Math.pow(10,e),n=Math.floor(i/s);return Math.ceil(t/s)-n}function vO(i,t){const e=t-i;let s=sa(e);for(;Lg(i,t,s)>10;)s++;for(;Lg(i,t,s)<10;)s--;return Math.min(s,sa(i))}function _O(i,{min:t,max:e}){t=Ye(i.min,t);const s=[],n=sa(t);let r=vO(t,e),o=r<0?Math.pow(10,Math.abs(r)):1;const a=Math.pow(10,r),l=n>r?Math.pow(10,n):0,c=Math.round((t-l)*o)/o,h=Math.floor((t-l)/a/10)*a*10;let d=Math.floor((c-h)/Math.pow(10,r)),u=Ye(i.min,Math.round((l+h+d*Math.pow(10,r))*o)/o);for(;u<e;)s.push({value:u,major:zg(u),significand:d}),d>=10?d=d<15?15:20:d++,d>=20&&(r++,d=2,o=r>=0?1:o),u=Math.round((l+h+d*Math.pow(10,r))*o)/o;const p=Ye(i.max,u);return s.push({value:p,major:zg(p),significand:d}),s}class Kd extends Mn{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const s=dc.prototype.parse.apply(this,[t,e]);if(s===0){this._zero=!0;return}return Jt(s)&&s>0?s:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=Jt(t)?Math.max(0,t):null,this.max=Jt(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Jt(this._userMin)&&(this.min=t===cn(this.min,0)?cn(this.min,-1):cn(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let s=this.min,n=this.max;const r=a=>s=t?s:a,o=a=>n=e?n:a;s===n&&(s<=0?(r(1),o(10)):(r(cn(s,-1)),o(cn(n,1)))),s<=0&&r(cn(n,-1)),n<=0&&o(cn(s,1)),this.min=s,this.max=n}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},s=_O(e,this);return t.bounds==="ticks"&&t_(s,this,"value"),t.reverse?(s.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),s}getLabelForValue(t){return t===void 0?"0":xa(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=As(t),this._valueRange=As(this.max)-As(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(As(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}it(Kd,"id","logarithmic"),it(Kd,"defaults",{ticks:{callback:Vc.formatters.logarithmic,major:{enabled:!0}}});function Qd(i){const t=i.ticks;if(t.display&&i.display){const e=Ce(t.backdropPadding);return mt(t.font&&t.font.size,Ht.font.size)+e.height}return 0}function wO(i,t,e){return e=jt(e)?e:[e],{w:AT(i,t.string,e),h:e.length*t.lineHeight}}function Rg(i,t,e,s,n){return i===s||i===n?{start:t-e/2,end:t+e/2}:i<s||i>n?{start:t-e,end:t}:{start:t,end:t+e}}function xO(i){const t={l:i.left+i._padding.left,r:i.right-i._padding.right,t:i.top+i._padding.top,b:i.bottom-i._padding.bottom},e=Object.assign({},t),s=[],n=[],r=i._pointLabels.length,o=i.options.pointLabels,a=o.centerPointLabels?kt/r:0;for(let l=0;l<r;l++){const c=o.setContext(i.getPointLabelContext(l));n[l]=c.padding;const h=i.getPointPosition(l,i.drawingArea+n[l],a),d=de(c.font),u=wO(i.ctx,d,i._pointLabels[l]);s[l]=u;const p=Pe(i.getIndexAngle(l)+a),m=Math.round(Ku(p)),f=Rg(m,h.x,u.w,0,180),b=Rg(m,h.y,u.h,90,270);CO(e,t,p,f,b)}i.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),i._pointLabelItems=kO(i,s,n)}function CO(i,t,e,s,n){const r=Math.abs(Math.sin(e)),o=Math.abs(Math.cos(e));let a=0,l=0;s.start<t.l?(a=(t.l-s.start)/r,i.l=Math.min(i.l,t.l-a)):s.end>t.r&&(a=(s.end-t.r)/r,i.r=Math.max(i.r,t.r+a)),n.start<t.t?(l=(t.t-n.start)/o,i.t=Math.min(i.t,t.t-l)):n.end>t.b&&(l=(n.end-t.b)/o,i.b=Math.max(i.b,t.b+l))}function SO(i,t,e){const s=i.drawingArea,{extra:n,additionalAngle:r,padding:o,size:a}=e,l=i.getPointPosition(t,s+n+o,r),c=Math.round(Ku(Pe(l.angle+re))),h=MO(l.y,a.h,c),d=AO(c),u=TO(l.x,a.w,d);return{visible:!0,x:l.x,y:h,textAlign:d,left:u,top:h,right:u+a.w,bottom:h+a.h}}function EO(i,t){if(!t)return!0;const{left:e,top:s,right:n,bottom:r}=i;return!(es({x:e,y:s},t)||es({x:e,y:r},t)||es({x:n,y:s},t)||es({x:n,y:r},t))}function kO(i,t,e){const s=[],n=i._pointLabels.length,r=i.options,{centerPointLabels:o,display:a}=r.pointLabels,l={extra:Qd(r)/2,additionalAngle:o?kt/n:0};let c;for(let h=0;h<n;h++){l.padding=e[h],l.size=t[h];const d=SO(i,h,l);s.push(d),a==="auto"&&(d.visible=EO(d,c),d.visible&&(c=d))}return s}function AO(i){return i===0||i===180?"center":i<180?"left":"right"}function TO(i,t,e){return e==="right"?i-=t:e==="center"&&(i-=t/2),i}function MO(i,t,e){return e===90||e===270?i-=t/2:(e>270||e<90)&&(i-=t),i}function PO(i,t,e){const{left:s,top:n,right:r,bottom:o}=e,{backdropColor:a}=t;if(!bt(a)){const l=_n(t.borderRadius),c=Ce(t.backdropPadding);i.fillStyle=a;const h=s-c.left,d=n-c.top,u=r-s+c.width,p=o-n+c.height;Object.values(l).some(m=>m!==0)?(i.beginPath(),ta(i,{x:h,y:d,w:u,h:p,radius:l}),i.fill()):i.fillRect(h,d,u,p)}}function $O(i,t){const{ctx:e,options:{pointLabels:s}}=i;for(let n=t-1;n>=0;n--){const r=i._pointLabelItems[n];if(!r.visible)continue;const o=s.setContext(i.getPointLabelContext(n));PO(e,o,r);const a=de(o.font),{x:l,y:c,textAlign:h}=r;kn(e,i._pointLabels[n],l,c+a.lineHeight/2,a,{color:o.color,textAlign:h,textBaseline:"middle"})}}function q_(i,t,e,s){const{ctx:n}=i;if(e)n.arc(i.xCenter,i.yCenter,t,0,Vt);else{let r=i.getPointPosition(0,t);n.moveTo(r.x,r.y);for(let o=1;o<s;o++)r=i.getPointPosition(o,t),n.lineTo(r.x,r.y)}}function OO(i,t,e,s,n){const r=i.ctx,o=t.circular,{color:a,lineWidth:l}=t;!o&&!s||!a||!l||e<0||(r.save(),r.strokeStyle=a,r.lineWidth=l,r.setLineDash(n.dash||[]),r.lineDashOffset=n.dashOffset,r.beginPath(),q_(i,e,o,s),r.closePath(),r.stroke(),r.restore())}function DO(i,t,e){return Qs(i,{label:e,index:t,type:"pointLabel"})}class yo extends dc{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=Ce(Qd(this.options)/2),e=this.width=this.maxWidth-t.width,s=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+s/2+t.top),this.drawingArea=Math.floor(Math.min(e,s)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=Jt(t)&&!isNaN(t)?t:0,this.max=Jt(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Qd(this.options))}generateTickLabels(t){dc.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,s)=>{const n=Dt(this.options.pointLabels.callback,[e,s],this);return n||n===0?n:""}).filter((e,s)=>this.chart.getDataVisibility(s))}fit(){const t=this.options;t.display&&t.pointLabels.display?xO(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,s,n){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((s-n)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,s,n))}getIndexAngle(t){const e=Vt/(this._pointLabels.length||1),s=this.options.startAngle||0;return Pe(t*e+wi(s))}getDistanceFromCenterForValue(t){if(bt(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(bt(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const s=e[t];return DO(this.getContext(),t,s)}}getPointPosition(t,e,s=0){const n=this.getIndexAngle(t)-re+s;return{x:Math.cos(n)*e+this.xCenter,y:Math.sin(n)*e+this.yCenter,angle:n}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:s,right:n,bottom:r}=this._pointLabelItems[t];return{left:e,top:s,right:n,bottom:r}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const s=this.ctx;s.save(),s.beginPath(),q_(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),s.closePath(),s.fillStyle=t,s.fill(),s.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:s,grid:n,border:r}=e,o=this._pointLabels.length;let a,l,c;if(e.pointLabels.display&&$O(this,o),n.display&&this.ticks.forEach((h,d)=>{if(d!==0||d===0&&this.min<0){l=this.getDistanceFromCenterForValue(h.value);const u=this.getContext(d),p=n.setContext(u),m=r.setContext(u);OO(this,p,l,o,m)}}),s.display){for(t.save(),a=o-1;a>=0;a--){const h=s.setContext(this.getPointLabelContext(a)),{color:d,lineWidth:u}=h;!u||!d||(t.lineWidth=u,t.strokeStyle=d,t.setLineDash(h.borderDash),t.lineDashOffset=h.borderDashOffset,l=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),c=this.getPointPosition(a,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(c.x,c.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,s=e.ticks;if(!s.display)return;const n=this.getIndexAngle(0);let r,o;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(n),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&this.min>=0&&!e.reverse)return;const c=s.setContext(this.getContext(l)),h=de(c.font);if(r=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){t.font=h.string,o=t.measureText(a.label).width,t.fillStyle=c.backdropColor;const d=Ce(c.backdropPadding);t.fillRect(-o/2-d.left,-r-h.size/2-d.top,o+d.width,h.size+d.height)}kn(t,a.label,0,-r,h,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),t.restore()}drawTitle(){}}it(yo,"id","radialLinear"),it(yo,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Vc.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(i){return i},padding:5,centerPointLabels:!1}}),it(yo,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),it(yo,"descriptors",{angleLines:{_fallback:"grid"}});const Gc={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},He=Object.keys(Gc);function Bg(i,t){return i-t}function Ng(i,t){if(bt(t))return null;const e=i._adapter,{parser:s,round:n,isoWeekday:r}=i._parseOpts;let o=t;return typeof s=="function"&&(o=s(o)),Jt(o)||(o=typeof s=="string"?e.parse(o,s):e.parse(o)),o===null?null:(n&&(o=n==="week"&&(vr(r)||r===!0)?e.startOf(o,"isoWeek",r):e.startOf(o,n)),+o)}function Fg(i,t,e,s){const n=He.length;for(let r=He.indexOf(i);r<n-1;++r){const o=Gc[He[r]],a=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((e-t)/(a*o.size))<=s)return He[r]}return He[n-1]}function IO(i,t,e,s,n){for(let r=He.length-1;r>=He.indexOf(e);r--){const o=He[r];if(Gc[o].common&&i._adapter.diff(n,s,o)>=t-1)return o}return He[e?He.indexOf(e):0]}function zO(i){for(let t=He.indexOf(i)+1,e=He.length;t<e;++t)if(Gc[He[t]].common)return He[t]}function Ug(i,t,e){if(!e)i[t]=!0;else if(e.length){const{lo:s,hi:n}=Qu(e,t),r=e[s]>=t?e[s]:e[n];i[r]=!0}}function LO(i,t,e,s){const n=i._adapter,r=+n.startOf(t[0].value,s),o=t[t.length-1].value;let a,l;for(a=r;a<=o;a=+n.add(a,1,s))l=e[a],l>=0&&(t[l].major=!0);return t}function jg(i,t,e){const s=[],n={},r=t.length;let o,a;for(o=0;o<r;++o)a=t[o],n[a]=o,s.push({value:a,major:!1});return r===0||!e?s:LO(i,s,n,e)}class na extends Mn{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const s=t.time||(t.time={}),n=this._adapter=new HM._date(t.adapters.date);n.init(e),Ao(s.displayFormats,n.formats()),this._parseOpts={parser:s.parser,round:s.round,isoWeekday:s.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:Ng(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,s=t.time.unit||"day";let{min:n,max:r,minDefined:o,maxDefined:a}=this.getUserBounds();function l(c){!o&&!isNaN(c.min)&&(n=Math.min(n,c.min)),!a&&!isNaN(c.max)&&(r=Math.max(r,c.max))}(!o||!a)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),n=Jt(n)&&!isNaN(n)?n:+e.startOf(Date.now(),s),r=Jt(r)&&!isNaN(r)?r:+e.endOf(Date.now(),s)+1,this.min=Math.min(n,r-1),this.max=Math.max(n+1,r)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],s=t[t.length-1]),{min:e,max:s}}buildTicks(){const t=this.options,e=t.time,s=t.ticks,n=s.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&n.length&&(this.min=this._userMin||n[0],this.max=this._userMax||n[n.length-1]);const r=this.min,o=this.max,a=fT(n,r,o);return this._unit=e.unit||(s.autoSkip?Fg(e.minUnit,this.min,this.max,this._getLabelCapacity(r)):IO(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=!s.major.enabled||this._unit==="year"?void 0:zO(this._unit),this.initOffsets(n),t.reverse&&a.reverse(),jg(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,s=0,n,r;this.options.offset&&t.length&&(n=this.getDecimalForValue(t[0]),t.length===1?e=1-n:e=(this.getDecimalForValue(t[1])-n)/2,r=this.getDecimalForValue(t[t.length-1]),t.length===1?s=r:s=(r-this.getDecimalForValue(t[t.length-2]))/2);const o=t.length<3?.5:.25;e=fe(e,0,o),s=fe(s,0,o),this._offsets={start:e,end:s,factor:1/(e+1+s)}}_generate(){const t=this._adapter,e=this.min,s=this.max,n=this.options,r=n.time,o=r.unit||Fg(r.minUnit,e,s,this._getLabelCapacity(e)),a=mt(n.ticks.stepSize,1),l=o==="week"?r.isoWeekday:!1,c=vr(l)||l===!0,h={};let d=e,u,p;if(c&&(d=+t.startOf(d,"isoWeek",l)),d=+t.startOf(d,c?"day":o),t.diff(s,e,o)>1e5*a)throw new Error(e+" and "+s+" are too far apart with stepSize of "+a+" "+o);const m=n.ticks.source==="data"&&this.getDataTimestamps();for(u=d,p=0;u<s;u=+t.add(u,a,o),p++)Ug(h,u,m);return(u===s||n.bounds==="ticks"||p===1)&&Ug(h,u,m),Object.keys(h).sort(Bg).map(f=>+f)}getLabelForValue(t){const e=this._adapter,s=this.options.time;return s.tooltipFormat?e.format(t,s.tooltipFormat):e.format(t,s.displayFormats.datetime)}format(t,e){const s=this.options.time.displayFormats,n=this._unit,r=e||s[n];return this._adapter.format(t,r)}_tickFormatFunction(t,e,s,n){const r=this.options,o=r.ticks.callback;if(o)return Dt(o,[t,e,s],this);const a=r.time.displayFormats,l=this._unit,c=this._majorUnit,h=l&&a[l],d=c&&a[c],u=s[e],p=c&&d&&u&&u.major;return this._adapter.format(t,n||(p?d:h))}generateTickLabels(t){let e,s,n;for(e=0,s=t.length;e<s;++e)n=t[e],n.label=this._tickFormatFunction(n.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,s=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+s)*e.factor)}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+s*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,s=this.ctx.measureText(t).width,n=wi(this.isHorizontal()?e.maxRotation:e.minRotation),r=Math.cos(n),o=Math.sin(n),a=this._resolveTickFontOptions(0).size;return{w:s*r+a*o,h:s*o+a*r}}_getLabelCapacity(t){const e=this.options.time,s=e.displayFormats,n=s[e.unit]||s.millisecond,r=this._tickFormatFunction(t,0,jg(this,[t],this._majorUnit),n),o=this._getLabelSize(r),a=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],e,s;if(t.length)return t;const n=this.getMatchingVisibleMetas();if(this._normalized&&n.length)return this._cache.data=n[0].controller.getAllParsedValues(this);for(e=0,s=n.length;e<s;++e)t=t.concat(n[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,s;if(t.length)return t;const n=this.getLabels();for(e=0,s=n.length;e<s;++e)t.push(Ng(this,n[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return s_(t.sort(Bg))}}it(na,"id","time"),it(na,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function gl(i,t,e){let s=0,n=i.length-1,r,o,a,l;e?(t>=i[s].pos&&t<=i[n].pos&&({lo:s,hi:n}=ts(i,"pos",t)),{pos:r,time:a}=i[s],{pos:o,time:l}=i[n]):(t>=i[s].time&&t<=i[n].time&&({lo:s,hi:n}=ts(i,"time",t)),{time:r,pos:a}=i[s],{time:o,pos:l}=i[n]);const c=o-r;return c?a+(l-a)*(t-r)/c:a}class Jd extends na{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=gl(e,this.min),this._tableRange=gl(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:s}=this,n=[],r=[];let o,a,l,c,h;for(o=0,a=t.length;o<a;++o)c=t[o],c>=e&&c<=s&&n.push(c);if(n.length<2)return[{time:e,pos:0},{time:s,pos:1}];for(o=0,a=n.length;o<a;++o)h=n[o+1],l=n[o-1],c=n[o],Math.round((h+l)/2)!==c&&r.push({time:c,pos:o/(a-1)});return r}_generate(){const t=this.min,e=this.max;let s=super.getDataTimestamps();return(!s.includes(t)||!s.length)&&s.splice(0,0,t),(!s.includes(e)||s.length===1)&&s.push(e),s.sort((n,r)=>n-r)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),s=this.getLabelTimestamps();return e.length&&s.length?t=this.normalize(e.concat(s)):t=e.length?e:s,t=this._cache.all=t,t}getDecimalForValue(t){return(gl(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,s=this.getDecimalForPixel(t)/e.factor-e.end;return gl(this._table,s*this._tableRange+this._minPos,!0)}}it(Jd,"id","timeseries"),it(Jd,"defaults",na.defaults);var RO=Object.freeze({__proto__:null,CategoryScale:Gd,LinearScale:Xd,LogarithmicScale:Kd,RadialLinearScale:yo,TimeScale:na,TimeSeriesScale:Jd});const BO=[VM,v$,fO,RO];ia.register(...BO);/*!
 * chartjs-plugin-datalabels v2.2.0
 * https://chartjs-plugin-datalabels.netlify.app
 * (c) 2017-2022 chartjs-plugin-datalabels contributors
 * Released under the MIT license
 */var Vg=function(){if(typeof window<"u"){if(window.devicePixelRatio)return window.devicePixelRatio;var i=window.screen;if(i)return(i.deviceXDPI||1)/(i.logicalXDPI||1)}return 1}(),Io={toTextLines:function(i){var t=[],e;for(i=[].concat(i);i.length;)e=i.pop(),typeof e=="string"?t.unshift.apply(t,e.split(`
`)):Array.isArray(e)?i.push.apply(i,e):bt(i)||t.unshift(""+e);return t},textSize:function(i,t,e){var s=[].concat(t),n=s.length,r=i.font,o=0,a;for(i.font=e.string,a=0;a<n;++a)o=Math.max(i.measureText(s[a]).width,o);return i.font=r,{height:n*e.lineHeight,width:o}},bound:function(i,t,e){return Math.max(i,Math.min(t,e))},arrayDiff:function(i,t){var e=i.slice(),s=[],n,r,o,a;for(n=0,o=t.length;n<o;++n)a=t[n],r=e.indexOf(a),r===-1?s.push([a,1]):e.splice(r,1);for(n=0,o=e.length;n<o;++n)s.push([e[n],-1]);return s},rasterize:function(i){return Math.round(i*Vg)/Vg}};function Gh(i,t){var e=t.x,s=t.y;if(e===null)return{x:0,y:-1};if(s===null)return{x:1,y:0};var n=i.x-e,r=i.y-s,o=Math.sqrt(n*n+r*r);return{x:o?n/o:0,y:o?r/o:-1}}function NO(i,t,e,s,n){switch(n){case"center":e=s=0;break;case"bottom":e=0,s=1;break;case"right":e=1,s=0;break;case"left":e=-1,s=0;break;case"top":e=0,s=-1;break;case"start":e=-e,s=-s;break;case"end":break;default:n*=Math.PI/180,e=Math.cos(n),s=Math.sin(n);break}return{x:i,y:t,vx:e,vy:s}}var FO=0,Y_=1,Z_=2,G_=4,X_=8;function bl(i,t,e){var s=FO;return i<e.left?s|=Y_:i>e.right&&(s|=Z_),t<e.top?s|=X_:t>e.bottom&&(s|=G_),s}function UO(i,t){for(var e=i.x0,s=i.y0,n=i.x1,r=i.y1,o=bl(e,s,t),a=bl(n,r,t),l,c,h;!(!(o|a)||o&a);)l=o||a,l&X_?(c=e+(n-e)*(t.top-s)/(r-s),h=t.top):l&G_?(c=e+(n-e)*(t.bottom-s)/(r-s),h=t.bottom):l&Z_?(h=s+(r-s)*(t.right-e)/(n-e),c=t.right):l&Y_&&(h=s+(r-s)*(t.left-e)/(n-e),c=t.left),l===o?(e=c,s=h,o=bl(e,s,t)):(n=c,r=h,a=bl(n,r,t));return{x0:e,x1:n,y0:s,y1:r}}function yl(i,t){var e=t.anchor,s=i,n,r;return t.clamp&&(s=UO(s,t.area)),e==="start"?(n=s.x0,r=s.y0):e==="end"?(n=s.x1,r=s.y1):(n=(s.x0+s.x1)/2,r=(s.y0+s.y1)/2),NO(n,r,i.vx,i.vy,t.align)}var vl={arc:function(i,t){var e=(i.startAngle+i.endAngle)/2,s=Math.cos(e),n=Math.sin(e),r=i.innerRadius,o=i.outerRadius;return yl({x0:i.x+s*r,y0:i.y+n*r,x1:i.x+s*o,y1:i.y+n*o,vx:s,vy:n},t)},point:function(i,t){var e=Gh(i,t.origin),s=e.x*i.options.radius,n=e.y*i.options.radius;return yl({x0:i.x-s,y0:i.y-n,x1:i.x+s,y1:i.y+n,vx:e.x,vy:e.y},t)},bar:function(i,t){var e=Gh(i,t.origin),s=i.x,n=i.y,r=0,o=0;return i.horizontal?(s=Math.min(i.x,i.base),r=Math.abs(i.base-i.x)):(n=Math.min(i.y,i.base),o=Math.abs(i.base-i.y)),yl({x0:s,y0:n+o,x1:s+r,y1:n,vx:e.x,vy:e.y},t)},fallback:function(i,t){var e=Gh(i,t.origin);return yl({x0:i.x,y0:i.y,x1:i.x+(i.width||0),y1:i.y+(i.height||0),vx:e.x,vy:e.y},t)}},is=Io.rasterize;function jO(i){var t=i.borderWidth||0,e=i.padding,s=i.size.height,n=i.size.width,r=-n/2,o=-s/2;return{frame:{x:r-e.left-t,y:o-e.top-t,w:n+e.width+t*2,h:s+e.height+t*2},text:{x:r,y:o,w:n,h:s}}}function VO(i,t){var e=t.chart.getDatasetMeta(t.datasetIndex).vScale;if(!e)return null;if(e.xCenter!==void 0&&e.yCenter!==void 0)return{x:e.xCenter,y:e.yCenter};var s=e.getBasePixel();return i.horizontal?{x:s,y:null}:{x:null,y:s}}function HO(i){return i instanceof tr?vl.arc:i instanceof Oo?vl.point:i instanceof Do?vl.bar:vl.fallback}function WO(i,t,e,s,n,r){var o=Math.PI/2;if(r){var a=Math.min(r,n/2,s/2),l=t+a,c=e+a,h=t+s-a,d=e+n-a;i.moveTo(t,c),l<h&&c<d?(i.arc(l,c,a,-Math.PI,-o),i.arc(h,c,a,-o,0),i.arc(h,d,a,0,o),i.arc(l,d,a,o,Math.PI)):l<h?(i.moveTo(l,e),i.arc(h,c,a,-o,o),i.arc(l,c,a,o,Math.PI+o)):c<d?(i.arc(l,c,a,-Math.PI,0),i.arc(l,d,a,0,Math.PI)):i.arc(l,c,a,-Math.PI,Math.PI),i.closePath(),i.moveTo(t,e)}else i.rect(t,e,s,n)}function qO(i,t,e){var s=e.backgroundColor,n=e.borderColor,r=e.borderWidth;!s&&(!n||!r)||(i.beginPath(),WO(i,is(t.x)+r/2,is(t.y)+r/2,is(t.w)-r,is(t.h)-r,e.borderRadius),i.closePath(),s&&(i.fillStyle=s,i.fill()),n&&r&&(i.strokeStyle=n,i.lineWidth=r,i.lineJoin="miter",i.stroke()))}function YO(i,t,e){var s=e.lineHeight,n=i.w,r=i.x,o=i.y+s/2;return t==="center"?r+=n/2:(t==="end"||t==="right")&&(r+=n),{h:s,w:n,x:r,y:o}}function ZO(i,t,e){var s=i.shadowBlur,n=e.stroked,r=is(e.x),o=is(e.y),a=is(e.w);n&&i.strokeText(t,r,o,a),e.filled&&(s&&n&&(i.shadowBlur=0),i.fillText(t,r,o,a),s&&n&&(i.shadowBlur=s))}function GO(i,t,e,s){var n=s.textAlign,r=s.color,o=!!r,a=s.font,l=t.length,c=s.textStrokeColor,h=s.textStrokeWidth,d=c&&h,u;if(!(!l||!o&&!d))for(e=YO(e,n,a),i.font=a.string,i.textAlign=n,i.textBaseline="middle",i.shadowBlur=s.textShadowBlur,i.shadowColor=s.textShadowColor,o&&(i.fillStyle=r),d&&(i.lineJoin="round",i.lineWidth=h,i.strokeStyle=c),u=0,l=t.length;u<l;++u)ZO(i,t[u],{stroked:d,filled:o,w:e.w,x:e.x,y:e.y+e.h*u})}var K_=function(i,t,e,s){var n=this;n._config=i,n._index=s,n._model=null,n._rects=null,n._ctx=t,n._el=e};Hi(K_.prototype,{_modelize:function(i,t,e,s){var n=this,r=n._index,o=de(Ut([e.font,{}],s,r)),a=Ut([e.color,Ht.color],s,r);return{align:Ut([e.align,"center"],s,r),anchor:Ut([e.anchor,"center"],s,r),area:s.chart.chartArea,backgroundColor:Ut([e.backgroundColor,null],s,r),borderColor:Ut([e.borderColor,null],s,r),borderRadius:Ut([e.borderRadius,0],s,r),borderWidth:Ut([e.borderWidth,0],s,r),clamp:Ut([e.clamp,!1],s,r),clip:Ut([e.clip,!1],s,r),color:a,display:i,font:o,lines:t,offset:Ut([e.offset,4],s,r),opacity:Ut([e.opacity,1],s,r),origin:VO(n._el,s),padding:Ce(Ut([e.padding,4],s,r)),positioner:HO(n._el),rotation:Ut([e.rotation,0],s,r)*(Math.PI/180),size:Io.textSize(n._ctx,t,o),textAlign:Ut([e.textAlign,"start"],s,r),textShadowBlur:Ut([e.textShadowBlur,0],s,r),textShadowColor:Ut([e.textShadowColor,a],s,r),textStrokeColor:Ut([e.textStrokeColor,a],s,r),textStrokeWidth:Ut([e.textStrokeWidth,0],s,r)}},update:function(i){var t=this,e=null,s=null,n=t._index,r=t._config,o,a,l,c=Ut([r.display,!0],i,n);c&&(o=i.dataset.data[n],a=mt(Dt(r.formatter,[o,i]),o),l=bt(a)?[]:Io.toTextLines(a),l.length&&(e=t._modelize(c,l,r,i),s=jO(e))),t._model=e,t._rects=s},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(i,t){var e=this,s=i.ctx,n=e._model,r=e._rects,o;this.visible()&&(s.save(),n.clip&&(o=n.area,s.beginPath(),s.rect(o.left,o.top,o.right-o.left,o.bottom-o.top),s.clip()),s.globalAlpha=Io.bound(0,n.opacity,1),s.translate(is(t.x),is(t.y)),s.rotate(n.rotation),qO(s,r.frame,n),GO(s,n.lines,r.text,n),s.restore())}});var XO=Number.MIN_SAFE_INTEGER||-9007199254740991,KO=Number.MAX_SAFE_INTEGER||9007199254740991;function lo(i,t,e){var s=Math.cos(e),n=Math.sin(e),r=t.x,o=t.y;return{x:r+s*(i.x-r)-n*(i.y-o),y:o+n*(i.x-r)+s*(i.y-o)}}function Hg(i,t){var e=KO,s=XO,n=t.origin,r,o,a,l,c;for(r=0;r<i.length;++r)o=i[r],a=o.x-n.x,l=o.y-n.y,c=t.vx*a+t.vy*l,e=Math.min(e,c),s=Math.max(s,c);return{min:e,max:s}}function _l(i,t){var e=t.x-i.x,s=t.y-i.y,n=Math.sqrt(e*e+s*s);return{vx:(t.x-i.x)/n,vy:(t.y-i.y)/n,origin:i,ln:n}}var Q_=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};Hi(Q_.prototype,{center:function(){var i=this._rect;return{x:i.x+i.w/2,y:i.y+i.h/2}},update:function(i,t,e){this._rotation=e,this._rect={x:t.x+i.x,y:t.y+i.y,w:t.w,h:t.h}},contains:function(i){var t=this,e=1,s=t._rect;return i=lo(i,t.center(),-t._rotation),!(i.x<s.x-e||i.y<s.y-e||i.x>s.x+s.w+e*2||i.y>s.y+s.h+e*2)},intersects:function(i){var t=this._points(),e=i._points(),s=[_l(t[0],t[1]),_l(t[0],t[3])],n,r,o;for(this._rotation!==i._rotation&&s.push(_l(e[0],e[1]),_l(e[0],e[3])),n=0;n<s.length;++n)if(r=Hg(t,s[n]),o=Hg(e,s[n]),r.max<o.min||o.max<r.min)return!1;return!0},_points:function(){var i=this,t=i._rect,e=i._rotation,s=i.center();return[lo({x:t.x,y:t.y},s,e),lo({x:t.x+t.w,y:t.y},s,e),lo({x:t.x+t.w,y:t.y+t.h},s,e),lo({x:t.x,y:t.y+t.h},s,e)]}});function J_(i,t,e){var s=t.positioner(i,t),n=s.vx,r=s.vy;if(!n&&!r)return{x:s.x,y:s.y};var o=e.w,a=e.h,l=t.rotation,c=Math.abs(o/2*Math.cos(l))+Math.abs(a/2*Math.sin(l)),h=Math.abs(o/2*Math.sin(l))+Math.abs(a/2*Math.cos(l)),d=1/Math.max(Math.abs(n),Math.abs(r));return c*=n*d,h*=r*d,c+=t.offset*n,h+=t.offset*r,{x:s.x+c,y:s.y+h}}function QO(i,t){var e,s,n,r;for(e=i.length-1;e>=0;--e)for(n=i[e].$layout,s=e-1;s>=0&&n._visible;--s)r=i[s].$layout,r._visible&&n._box.intersects(r._box)&&t(n,r);return i}function JO(i){var t,e,s,n,r,o,a;for(t=0,e=i.length;t<e;++t)s=i[t],n=s.$layout,n._visible&&(a=new Proxy(s._el,{get:(l,c)=>l.getProps([c],!0)[c]}),r=s.geometry(),o=J_(a,s.model(),r),n._box.update(o,r,s.rotation()));return QO(i,function(l,c){var h=l._hidable,d=c._hidable;h&&d||d?c._visible=!1:h&&(l._visible=!1)})}var zo={prepare:function(i){var t=[],e,s,n,r,o;for(e=0,n=i.length;e<n;++e)for(s=0,r=i[e].length;s<r;++s)o=i[e][s],t.push(o),o.$layout={_box:new Q_,_hidable:!1,_visible:!0,_set:e,_idx:o._index};return t.sort(function(a,l){var c=a.$layout,h=l.$layout;return c._idx===h._idx?h._set-c._set:h._idx-c._idx}),this.update(t),t},update:function(i){var t=!1,e,s,n,r,o;for(e=0,s=i.length;e<s;++e)n=i[e],r=n.model(),o=n.$layout,o._hidable=r&&r.display==="auto",o._visible=n.visible(),t|=o._hidable;t&&JO(i)},lookup:function(i,t){var e,s;for(e=i.length-1;e>=0;--e)if(s=i[e].$layout,s&&s._visible&&s._box.contains(t))return i[e];return null},draw:function(i,t){var e,s,n,r,o,a;for(e=0,s=t.length;e<s;++e)n=t[e],r=n.$layout,r._visible&&(o=n.geometry(),a=J_(n._el,n.model(),o),r._box.update(a,o,n.rotation()),n.draw(i,a))}},tD=function(i){if(bt(i))return null;var t=i,e,s,n;if(wt(i))if(!bt(i.label))t=i.label;else if(!bt(i.r))t=i.r;else for(t="",e=Object.keys(i),n=0,s=e.length;n<s;++n)t+=(n!==0?", ":"")+e[n]+": "+i[e[n]];return""+t},eD={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:tD,labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},je="$datalabels",t0="$default";function iD(i,t){var e=i.datalabels,s={},n=[],r,o;return e===!1?null:(e===!0&&(e={}),t=Hi({},[t,e]),r=t.labels||{},o=Object.keys(r),delete t.labels,o.length?o.forEach(function(a){r[a]&&n.push(Hi({},[t,r[a],{_key:a}]))}):n.push(t),s=n.reduce(function(a,l){return Mt(l.listeners||{},function(c,h){a[h]=a[h]||{},a[h][l._key||t0]=c}),delete l.listeners,a},{}),{labels:n,listeners:s})}function tu(i,t,e,s){if(t){var n=e.$context,r=e.$groups,o;t[r._set]&&(o=t[r._set][r._key],o&&Dt(o,[n,s])===!0&&(i[je]._dirty=!0,e.update(n)))}}function sD(i,t,e,s,n){var r,o;!e&&!s||(e?s?e!==s&&(o=r=!0):o=!0:r=!0,o&&tu(i,t.leave,e,n),r&&tu(i,t.enter,s,n))}function nD(i,t){var e=i[je],s=e._listeners,n,r;if(!(!s.enter&&!s.leave)){if(t.type==="mousemove")r=zo.lookup(e._labels,t);else if(t.type!=="mouseout")return;n=e._hovered,e._hovered=r,sD(i,s,n,r,t)}}function rD(i,t){var e=i[je],s=e._listeners.click,n=s&&zo.lookup(e._labels,t);n&&tu(i,s,n,t)}var oD={id:"datalabels",defaults:eD,beforeInit:function(i){i[je]={_actives:[]}},beforeUpdate:function(i){var t=i[je];t._listened=!1,t._listeners={},t._datasets=[],t._labels=[]},afterDatasetUpdate:function(i,t,e){var s=t.index,n=i[je],r=n._datasets[s]=[],o=i.isDatasetVisible(s),a=i.data.datasets[s],l=iD(a,e),c=t.meta.data||[],h=i.ctx,d,u,p,m,f,b,g,y;for(h.save(),d=0,p=c.length;d<p;++d)if(g=c[d],g[je]=[],o&&g&&i.getDataVisibility(d)&&!g.skip)for(u=0,m=l.labels.length;u<m;++u)f=l.labels[u],b=f._key,y=new K_(f,h,g,d),y.$groups={_set:s,_key:b||t0},y.$context={active:!1,chart:i,dataIndex:d,dataset:a,datasetIndex:s},y.update(y.$context),g[je].push(y),r.push(y);h.restore(),Hi(n._listeners,l.listeners,{merger:function(v,_,x){_[v]=_[v]||{},_[v][t.index]=x[v],n._listened=!0}})},afterUpdate:function(i){i[je]._labels=zo.prepare(i[je]._datasets)},afterDatasetsDraw:function(i){zo.draw(i,i[je]._labels)},beforeEvent:function(i,t){if(i[je]._listened){var e=t.event;switch(e.type){case"mousemove":case"mouseout":nD(i,e);break;case"click":rD(i,e);break}}},afterEvent:function(i){var t=i[je],e=t._actives,s=t._actives=i.getActiveElements(),n=Io.arrayDiff(e,s),r,o,a,l,c,h,d;for(r=0,o=n.length;r<o;++r)if(c=n[r],c[1])for(d=c[0].element[je]||[],a=0,l=d.length;a<l;++a)h=d[a],h.$context.active=c[1]===1,h.update(h.$context);(t._dirty||n.length)&&(zo.update(t._labels),i.render()),delete t._dirty}};const aD=()=>F`
    <style>
      .chart-skeleton {
        display: flex;
        gap: 1rem;
        height: 100%;
        width: 100%;
      }

      .y-axis {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding-bottom: 2.25rem; /* Space for x-axis labels and gap */
      }

      .y-label {
        height: 1rem;
        border-radius: 0.25rem;
        background-color: var(--bim-ui_bg-contrast-10);
        animation: bar-loading 1s linear infinite alternate;
      }

      .main-chart-area {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .bars-container {
        display: flex;
        justify-content: space-around;
        align-items: flex-end;
        flex-grow: 1;
        gap: 0.5rem;
        padding: 0 1rem;
        border-left: 2px solid var(--bim-ui_bg-contrast-20);
        border-bottom: 2px solid var(--bim-ui_bg-contrast-20);
        position: relative;
      }

      .grid-lines {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      .grid-line {
        width: 100%;
        height: 1px;
        background-color: var(--bim-ui_bg-contrast-10);
        opacity: 0.5;
      }

      .bar {
        flex: 1;
        background-color: var(--bim-ui_bg-contrast-10);
        animation: bar-loading 1s linear infinite alternate;
        z-index: 1; /* To appear above grid lines */
      }

      .x-axis {
        display: flex;
        justify-content: space-around;
        gap: 0.5rem;
        padding: 0 1rem;
        height: 1.25rem;
        margin-top: 1rem;
      }

      .x-label {
        flex: 1;
        height: 100%;
        border-radius: 0.25rem;
        background-color: var(--bim-ui_bg-contrast-10);
        animation: bar-loading 1s linear infinite alternate;
      }

      @keyframes bar-loading {
        0% {
          background-color: var(--bim-ui_bg-contrast-10);
        }
        100% {
          background-color: var(--bim-ui_bg-contrast-20);
        }
      }
    </style>
    <div class="chart-skeleton">
      <div class="y-axis">
        <div class="y-label" style="width: 2.5rem"></div>
        <div class="y-label" style="width: 1.5rem"></div>
        <div class="y-label" style="width: 2rem"></div>
        <div class="y-label" style="width: 1rem"></div>
      </div>
      <div class="main-chart-area">
        <div class="bars-container">
          <div class="grid-lines">
            <div class="grid-line"></div>
            <div class="grid-line"></div>
            <div class="grid-line"></div>
            <div class="grid-line"></div>
            <div class="grid-line"></div>
          </div>
          <div class="bar" style="height: 60%"></div>
          <div class="bar" style="height: 30%"></div>
          <div class="bar" style="height: 80%"></div>
          <div class="bar" style="height: 50%"></div>
          <div class="bar" style="height: 90%"></div>
        </div>
        <div class="x-axis">
          <div class="x-label"></div>
          <div class="x-label"></div>
          <div class="x-label"></div>
          <div class="x-label"></div>
          <div class="x-label"></div>
        </div>
      </div>
    </div>
  `;var lD=Object.defineProperty,ae=(i,t,e,s)=>{for(var n=void 0,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&lD(t,e,n),n};ia.register(oD);const e0=class extends St{constructor(){super(...arguments),this.colors=Array.from({length:20},(i,t)=>this.generateColor(t)),this.type=null,this.xBeginAtZero=!0,this.yBeginAtZero=!0,this.indexAxis="x",this.loading=!1,this.hoverBorderColor="#ffffffff",this.linePointStyle="circle",this.pointRadius=10,this.lineFill=!1,this.transparentBackground=!0,this.displayLabels=!0,this.dataLabelsColor="#ffffffff",this.smoothLine=!1,this.borderColor="#000000",this.inputData={labels:[],datasets:{}},this.colorfulBars=!1,this._errorLoading=!1,this._options={responsive:!1,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",display:!1},datalabels:{display:this.displayLabels,color:this.dataLabelsColor,font:{weight:"bold",family:"Fira Code"}},title:{text:this.label,display:!0}},elements:{line:{tension:this.smoothLine?.4:0}}},this._chartCfg={type:this.type,data:{labels:[],datasets:[]},options:this._options},this._canvas=document.createElement("canvas")}generateColor(i){return`hsl(${i*137.5%360}, 70%, 50%)`}async loadData(i=!1){if(this.inputData.labels.length!==0&&!i||!this.loadFunction)return!1;this.loading=!0;try{const t=await this.loadFunction();return this.inputData=t,this.loading=!1,this._errorLoading=!1,this.dispatchEvent(new Event("data-loaded")),!0}catch(t){if(this.loading=!1,this.inputData.labels.length!==0)return!1;const e=this.querySelector("[slot='error-loading']"),s=e==null?void 0:e.querySelector("[data-chart-element='error-message']");return t instanceof Error&&s&&t.message.trim()!==""&&(s.textContent=t.message),this._errorLoading=!0,!1}}get data(){return this.chart.data}_getDefaultColors(i){const t=Object.keys(i.datasets).length;return Array.from({length:t},(e,s)=>this.generateColor(s))}isScatterData(i){return"x"in i&&"y"in i}parseInputData(i){const{labels:t}=i,e=this.colors.length<Object.keys(i.datasets).length?this._getDefaultColors(i):this.colors,s=Object.entries(i.datasets).map(([n,r],o)=>{const a=e[o%e.length],l=this.type==="scatter"||this.type==="bubble",c=this.type==="bar";let h;return l||c&&!this.colorfulBars?h=this.transparentBackground?this.transparentize(a):a:h=this.transparentBackground?e.map(d=>this.transparentize(d)):e,{label:n,data:Object.values(r).map(d=>{if(l){if(this.isScatterData(d)){const u={x:d.x,y:d.y};return this.type==="bubble"&&d.r!==void 0&&(u.r=d.r),u}return{x:0,y:0}}return this.isScatterData(d)?0:d.value}),backgroundColor:h,borderColor:l?void 0:this.borderColor,pointStyle:l?void 0:this.linePointStyle,pointRadius:l?void 0:this.pointRadius,fill:l?void 0:this.lineFill,hoverBorderColor:l?void 0:this.hoverBorderColor}});return{labels:t,datasets:s}}transparentize(i,t){const e=t===void 0?.5:1-t;return QA(i).alpha(e).rgbString()}updateFromTable(i){const t=i.data,e=[],s={},n=[];let r=0;const o=`dataset_${r}`;r++;for(const a of t){const{data:l}=a;let c,h;for(const[d,u]of Object.entries(l))d==="name"&&typeof u=="string"?c=u:typeof u=="number"&&(h=u);c&&h!==void 0&&(e.push(c),n.push({value:h}))}s[o]=n,this.inputData={labels:e,datasets:s}}highlight(i){if(!this.chart)return;const t=[],e=Object.values(this.inputData.datasets);for(const s in e){const n=e[s];for(const r in n){const o=n[r];if(!i(o))continue;const a={datasetIndex:Number(s),index:Number(r)};t.push(a)}}this.chart.setActiveElements(t),this.chart.update()}filterByValue(i){if(!this.chart)return;const t=structuredClone(this.inputData);for(const e of Object.values(t.datasets))for(const s in e)i(e[s])||delete e[s];this.chart.data=this.parseInputData(t),this.chart.update()}triggerFilter(i){this.dispatchEvent(new CustomEvent("labelfilter",{detail:i}))}filterByLabel(i){if(!this.chart||!this.chart.data.labels)return;const t=this.chart.data.labels.indexOf(i);if(t===-1)return;this.chart.toggleDataVisibility(t);const e=this.chart.data.labels.filter((n,r)=>this.chart.getDataVisibility(r)),s=this.chart.data.labels.filter((n,r)=>!this.chart.getDataVisibility(r));this.chart.update(),this.triggerFilter({label:i,visible:e,hidden:s})}reset(){this.chart.data=this.parseInputData(this.inputData),this.chart.update()}updated(i){var t,e;if(this.chart){if(i.has("type")||i.has("indexAxis")||i.has("linePointStyle")||i.has("pointRadius")||i.has("lineFill")){this.chart.destroy();const s=structuredClone(this._options);this.label!==void 0&&(s.plugins||(s.plugins={}),s.plugins.title={text:this.label,display:!0}),this.indexAxis!==void 0&&(s.indexAxis=this.indexAxis),this.chart=new ia(this._canvas,{type:this.type,data:this.parseInputData(this.inputData),options:s})}else for(const s of i.keys())switch(s){case"label":this.chart.options.plugins.title={text:this.label,display:this.label!==void 0};break;case"inputData":this.chart.data=this.parseInputData(this.inputData);break;case"smoothLine":this.chart.options.elements&&this.chart.options.elements.line&&(this.chart.options.elements.line.tension=this.smoothLine?.4:0);break;case"dataLabelsColor":this.chart.options.plugins.datalabels.color=this.dataLabelsColor;break;case"displayLabels":this.chart.options.plugins.datalabels.display=this.displayLabels;break;case"borderColor":this.chart.data.datasets.forEach(n=>{n.borderColor=this.borderColor});break;case"xStacked":this.type==="bar"&&(t=this.chart.options.scales)!=null&&t.x&&Object.assign(this.chart.options.scales.x,{stacked:this.xStacked});break;case"yStacked":this.type==="bar"&&(e=this.chart.options.scales)!=null&&e.y&&Object.assign(this.chart.options.scales.y,{stacked:this.yStacked});break;case"transparentBackground":{const n=this.colors||this._getDefaultColors(this.inputData),r=this.type==="scatter"||this.type==="bubble",o=this.type==="bar";this.chart.data.datasets.forEach((a,l)=>{const c=n[l%n.length];let h;r||o&&!this.colorfulBars?h=this.transparentBackground?this.transparentize(c):c:h=this.transparentBackground?n.map(d=>this.transparentize(d)):n,a.backgroundColor=h});break}case"colors":{const n=this.colors||this._getDefaultColors(this.inputData),r=this.type==="scatter"||this.type==="bubble",o=this.type==="bar";this.chart.data.datasets.forEach((a,l)=>{const c=n[l%n.length];let h;r||o&&!this.colorfulBars?h=this.transparentBackground?this.transparentize(c):c:h=this.transparentBackground?n.map(d=>this.transparentize(d)):n,a.backgroundColor=h});break}}this.chart.update(),this.chart.resize()}}updateChartTitle(){if(this.chart)try{const i=this.chart.options;i&&i.plugins&&i.plugins.title&&(i.plugins.title.text=this.label,this.chart.update())}catch(i){console.warn("Chart: failed to update chart title",i)}}firstUpdated(){this.chart=new ia(this._canvas,this._chartCfg);const i=this.renderRoot.querySelector(".parent");i&&new ResizeObserver(()=>this.chart.resize()).observe(i),this._canvas.onclick=t=>{if(this.inputData.labels.length===0)return;const e=this.chart.getElementsAtEventForMode(t,"point",{intersect:!0},!1);for(const s of e){const{index:n,datasetIndex:r}=s,o=this.inputData.labels[n],a=[];for(const h of Object.values(this.inputData.datasets))a.push(h[n]);const l={datasetIndex:r,index:n,values:a,label:o,value:{value:0}},c=()=>{var h,d;return(d=(h=Object.values(this.inputData.datasets))==null?void 0:h[r])==null?void 0:d[n]};Object.defineProperty(l,"value",{get:()=>c()}),this.dispatchEvent(new CustomEvent("sectionclick",{detail:l}))}}}render(){if(this.loading)return aD();if(this._errorLoading)return F`<slot name="error-loading"></slot>`;let i;return this.inputData.labels.length===0?(this._canvas.style.display="none",i=F`
        <slot name="missing-data">
          <bim-label>No data to display in this chart.</bim-label>
        </slot>
      `):this._canvas.style.display="block",F`
      <div class="parent">
        ${i} ${this._canvas}
        <slot name="labels"></slot>
      </div>
    `}};e0.styles=At`
    :host {
      display: block;
      width: 100%;
      height: 100%;
      min-width: 10rem;
      min-height: 10rem;
      padding: 1rem;
      box-sizing: border-box;
      flex: 1;
    }

    .parent {
      position: relative;
      height: 100%;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
  `;let te=e0;ae([j({type:Array})],te.prototype,"colors");ae([j({type:String,reflect:!0})],te.prototype,"type");ae([j({type:Boolean,reflect:!0,attribute:"x-zero"})],te.prototype,"xBeginAtZero");ae([j({type:Boolean,reflect:!0,attribute:"y-zero"})],te.prototype,"yBeginAtZero");ae([j({type:String,reflect:!0,attribute:"index-axis"})],te.prototype,"indexAxis");ae([j({type:Boolean,reflect:!0,attribute:"x-stacked"})],te.prototype,"xStacked");ae([j({type:Boolean,reflect:!0,attribute:"y-stacked"})],te.prototype,"yStacked");ae([j({type:Boolean,reflect:!0})],te.prototype,"loading");ae([j({type:String,reflect:!1})],te.prototype,"hoverBorderColor");ae([j({type:String,reflect:!0})],te.prototype,"label");ae([j({type:String,reflect:!0,attribute:"point-style"})],te.prototype,"linePointStyle");ae([j({type:Number,reflect:!0})],te.prototype,"pointRadius");ae([j({type:String,reflect:!0})],te.prototype,"lineFill");ae([j({type:Boolean,reflect:!0,attribute:"transparent-background"})],te.prototype,"transparentBackground");ae([j({type:Boolean,reflect:!0})],te.prototype,"displayLabels");ae([j({type:String,reflect:!0,attribute:"data-label-color"})],te.prototype,"dataLabelsColor");ae([j({type:Boolean,reflect:!0})],te.prototype,"smoothLine");ae([j({type:String,reflect:!0})],te.prototype,"borderColor");ae([j({type:Object,attribute:!1})],te.prototype,"inputData");ae([j({type:Boolean,reflect:!0})],te.prototype,"colorfulBars");ae([us()],te.prototype,"_errorLoading");var cD=Object.defineProperty,cp=(i,t,e,s)=>{for(var n=void 0,r=i.length-1,o;r>=0;r--)(o=i[r])&&(n=o(t,e,n)||n);return n&&cD(t,e,n),n},ke;const Xc=(ke=class extends St{constructor(){super(...arguments),this.visible=!1,this._previousContainer=null,this._showToolTip=async()=>{this.timeoutId=setTimeout(async()=>{if(this.visible=!0,!ke.container.parentElement){const i=document.querySelector("[data-context-dialog]");i?i.append(ke.container):document.body.append(ke.container)}this._previousContainer=this.parentElement,ke.container.style.top=`${window.scrollY||document.documentElement.scrollTop}px`,ke.container.append(this),await this.computePosition()},this.timeout===void 0?800:this.timeout)},this._hideToolTip=()=>{clearTimeout(this.timeoutId),this.visible=!1,this._previousContainer&&(this._previousContainer.append(this),this._previousContainer=null),ke.container.children.length===0&&ke.container.parentElement&&ke.container.remove()}}static get container(){return ke._container||(ke._container=document.createElement("div"),ke._container.style.cssText=`
        position: absolute;
        top: 0;
        left: 0;
        width: 0;
        height: 0;
        overflow: visible;
        pointer-events: none;
        z-index: 9999;
      `),ke._container}async computePosition(){const i=this._previousContainer||this.parentElement;if(!i)return;const t=this.style.display;this.style.display="block",this.style.visibility="hidden",await new Promise(requestAnimationFrame);const{x:e,y:s}=await zu(i,this,{placement:this.placement,middleware:[Mu(10),Du(),Ou({padding:8}),Iu()]});Object.assign(this.style,{left:`${e}px`,top:`${s}px`,display:t,visibility:""})}connectedCallback(){super.connectedCallback();const i=this.parentElement;i&&(i.addEventListener("mouseenter",this._showToolTip),i.addEventListener("mouseleave",this._hideToolTip))}disconnectedCallback(){super.disconnectedCallback();const i=this.parentElement;i&&(i.removeEventListener("mouseenter",this._showToolTip),i.removeEventListener("mouseleave",this._hideToolTip))}render(){return F`<div><slot></slot></div>`}},ke.styles=At`
    :host {
      position: absolute;
      background: var(--bim-ui_bg-contrast-20, #fff);
      color: var(--bim-ui_bg-contrast-100, #000);
      border-radius: var(--bim-ui_size-4xs, 4px);
      box-shadow: 0 0 10px 3px rgba(0, 0, 0, 0.2);
      padding: 0.75rem;
      font-size: var(--bim-ui_size-xs, 0.875rem);
      display: none;
    }
    :host([visible]) {
      display: flex;
    }
  `,ke._container=null,ke);cp([j({type:Boolean,reflect:!0})],Xc.prototype,"visible");cp([j({type:Number,reflect:!0})],Xc.prototype,"timeout");cp([j({type:String,reflect:!0})],Xc.prototype,"placement");let hD=Xc;class dD{static init(){we.defineCustomElement("bim-view-cube",ds),we.defineCustomElement("bim-world-2d",kr),we.defineCustomElement("bim-world",My)}}const rr=(i,t)=>{const e=t[i],s=(e==null?void 0:e.name)??i,n=s.trim().split(/\s+/);let r,o;return n[0]&&n[0][0]&&(r=n[0][0].toUpperCase(),n[0][1]&&(o=n[0][1].toUpperCase())),n[1]&&n[1][0]&&(o=n[1][0].toUpperCase()),F`
    <div style="display: flex; gap: 0.25rem; overflow: hidden;">
      ${!(e!=null&&e.picture)&&(r||o)?F`
        <bim-label
          style=${Ni({borderRadius:"999px",padding:"0.375rem",backgroundColor:"var(--bim-ui_bg-contrast-20)",aspectRatio:"1",fontSize:"0.7rem"})}>${r}${o}</bim-label>
        `:null}
      <bim-label .img=${e==null?void 0:e.picture}>${s}</bim-label>
    </div>
  `},Ge={users:{"jhon.doe@example.com":{name:"Jhon Doe"}},priorities:{"On hold":{icon:"flowbite:circle-pause-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#767676"}},Minor:{icon:"mingcute:arrows-down-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#4CAF50"}},Normal:{icon:"fa6-solid:grip-lines",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Major:{icon:"mingcute:arrows-up-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Critical:{icon:"ph:warning",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}}},statuses:{Active:{icon:"prime:circle-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)"}},"In Progress":{icon:"prime:circle-fill",style:{backgroundColor:"#fa89004d","--bim-label--c":"#FB8C00","--bim-icon--c":"#FB8C00"}},"In Review":{icon:"prime:circle-fill",style:{backgroundColor:"#9c6bff4d","--bim-label--c":"#9D6BFF","--bim-icon--c":"#9D6BFF"}},Done:{icon:"prime:circle-fill",style:{backgroundColor:"#4CAF504D","--bim-label--c":"#4CAF50","--bim-icon--c":"#4CAF50"}},Closed:{icon:"prime:circle-fill",style:{backgroundColor:"#414141","--bim-label--c":"#727272","--bim-icon--c":"#727272"}}},types:{Clash:{icon:"gg:close-r",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Issue:{icon:"mdi:bug-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Failure:{icon:"mdi:bug-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Inquiry:{icon:"majesticons:comment-line",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Fault:{icon:"ph:warning",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Remark:{icon:"ph:note-blank-bold",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Request:{icon:"mynaui:edit-one",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#9D6BFF"}}}},or={padding:"0.25rem 0.5rem",borderRadius:"999px","--bim-label--c":"var(--bim-ui_bg-contrast-100)"},uD={dueDate:i=>{if(typeof i=="string"&&i.trim()!=="")return new Date(i)},status:i=>{if(Array.isArray(i)&&i.length!==0)return i[0]},type:i=>{if(Array.isArray(i)&&i.length!==0)return i[0]},priority:i=>{if(Array.isArray(i)&&i.length!==0)return i[0]},stage:i=>{if(Array.isArray(i)&&i.length!==0)return i[0]},assignedTo:i=>{if(Array.isArray(i)&&i.length!==0)return i[0]},labels:i=>{if(Array.isArray(i))return new Set(i)}},i0=i=>{const{components:t,topic:e,value:s,onCancel:n,onSubmit:r,styles:o}=i,a=r??(()=>{}),l=t.get(ra),c=(s==null?void 0:s.title)??(e==null?void 0:e.title)??fs.default.title,h=(s==null?void 0:s.status)??(e==null?void 0:e.status)??fs.default.status,d=(s==null?void 0:s.type)??(e==null?void 0:e.type)??fs.default.type,u=(s==null?void 0:s.priority)??(e==null?void 0:e.priority)??fs.default.priority,p=(s==null?void 0:s.assignedTo)??(e==null?void 0:e.assignedTo)??fs.default.assignedTo,m=(s==null?void 0:s.labels)??(e==null?void 0:e.labels)??fs.default.labels,f=(s==null?void 0:s.stage)??(e==null?void 0:e.stage)??fs.default.stage,b=(s==null?void 0:s.description)??(e==null?void 0:e.description)??fs.default.description,g=e!=null&&e.dueDate?e.dueDate.toISOString().split("T")[0]:null,y=new Set([...l.config.statuses]);h&&y.add(h);const v=new Set([...l.config.types]);d&&v.add(d);const _=new Set([...l.config.priorities]);u&&_.add(u);const x=new Set([...l.config.users]);p&&x.add(p);const S=new Set([...l.config.labels]);if(m)for(const w of m)S.add(w);const k=new Set([...l.config.stages]);f&&k.add(f);const T=kd(),M=async()=>{const{value:w}=T;if(!w)return;const z=Ko(w,uD);if(e)e.set(z),await a(e);else{const Y=l.create(z);await a(Y)}},O=kd(),R=w=>{const{value:z}=O;if(!z)return;const Y=w.target;z.disabled=Y.value.trim()===""},A=`btn-${we.newRandomId()}`,$=`btn-${we.newRandomId()}`;return F`
    <div ${Yt(T)} style="display: flex; flex-direction: column; gap: 0.75rem;">
      <div style="display: flex; gap: 0.375rem">
        <bim-text-input @input=${R} vertical label="Title" name="title" .value=${c}></bim-text-input>
        ${e?F`
            <bim-dropdown vertical label="Status" name="status" required>
              ${[...y].map(w=>F`<bim-option label=${w} .checked=${h===w}></bim-option>`)}
            </bim-dropdown>`:F``}
      </div>
      <div style="display: flex; gap: 0.375rem">
        <bim-dropdown vertical label="Type" name="type" required>
          ${[...v].map(w=>F`<bim-option label=${w} .checked=${d===w}></bim-option>`)}
        </bim-dropdown>
        <bim-dropdown vertical label="Priority" name="priority">
          ${[..._].map(w=>F`<bim-option label=${w} .checked=${u===w}></bim-option>`)}
        </bim-dropdown>
      </div>
      <div style="display: flex; gap: 0.375rem">
        <bim-dropdown vertical label="Labels" name="labels" multiple>
          ${[...S].map(w=>F`<bim-option label=${w} .checked=${m?[...m].includes(w):!1}></bim-option>`)}
        </bim-dropdown>
        <bim-dropdown vertical label="Assignee" name="assignedTo">
          ${[...x].map(w=>{const z=o!=null&&o.users?o.users[w]:null,Y=z?z.name:w,V=z==null?void 0:z.picture;return F`<bim-option label=${Y} value=${w} .img=${V} .checked=${p===w}></bim-option>`})}
        </bim-dropdown>
      </div>
      <div style="display: flex; gap: 0.375rem">
        <bim-text-input vertical type="date" label="Due Date" name="dueDate" .value=${g}></bim-text-input> 
        <bim-dropdown vertical label="Stage" name="stage">
          ${[...k].map(w=>F`<bim-option label=${w} .checked=${f===w}></bim-option>`)}
        </bim-dropdown>
      </div>
      <bim-text-input vertical label="Description" name="description" type="area" .value=${b??null}></bim-text-input>
      <div style="justify-content: right; display: flex; gap: 0.375rem">
        <style>
          #${$} {
            background-color: transparent;
          }

          #${$}:hover {
            --bim-label--c: #FF5252;
          }

          #${A}:hover {
            background-color: #329936;
          }
        </style>
        <bim-button id=${$} style="flex: 0" @click=${n} label="Cancel"></bim-button>
        <bim-button id=${A} style="flex: 0" @click=${M} ${Yt(O)} label=${e?"Update Topic":"Add Topic"} icon=${e?"tabler:refresh":"mi:add"}></bim-button>
      </div>
    </div>
  `},pD=i=>{const{components:t,modelUserData:e,worldName:s}=i;return F`
    <bim-button
      data-ui-id="import-ifc"
      label="Load IFC"
      icon="mage:box-3d-fill"
      @click=${()=>{if(!(t&&s))return;const n=[...t.get(yc).list.values()].find(o=>"name"in o&&o.name===s);if(!n)return;const r=document.createElement("input");r.type="file",r.accept=".ifc",r.onchange=async()=>{if(r.files===null||r.files.length===0)return;const o=r.files[0],a=await o.arrayBuffer(),l=new Uint8Array(a),c=o.name.replace(".ifc",""),h=t.get(Se),d=t.get(nw);d.settings.autoSetWasm=!1,d.settings.wasm={path:"https://unpkg.com/web-ifc@0.0.74/",absolute:!1};const u=await d.load(l,!0,c,{userData:e});n.scene.three.add(u.object),u.useCamera(n.camera.three),h.core.update(!0)},r.click()}}
    ></bim-button>
  `},fD=i=>Zt.create(pD,i),mD=Object.freeze(Object.defineProperty({__proto__:null,loadIfc:fD},Symbol.toStringTag,{value:"Module"})),gD=i=>{const{components:t,world:e}=i;return F`
    <bim-button @click=${()=>{const s=document.createElement("input");s.type="file",s.accept=".frag",s.onchange=async()=>{if(s.files===null||s.files.length===0)return;const n=s.files[0],r=await n.arrayBuffer(),o=new Uint8Array(r),a=n.name.replace(".frag",""),l=t.get(Se),c=await l.core.load(o,{modelId:a});e&&(e.scene.three.add(c.object),c.useCamera(e.camera.three),l.core.update(!0))},s.click()}}></bim-button>
  `},bD=i=>{const t=Zt.create(gD,i),[e]=t;return e.label="Load FRAG",e.icon="mage:box-3d-fill",t},yD=Object.freeze(Object.defineProperty({__proto__:null,loadFrag:bD},Symbol.toStringTag,{value:"Module"}));({...mD,...yD});const eu=async(i,t)=>{const{localId:e,category:s,children:n}=t;if(s&&n){const r={data:{Name:s,modelId:i.modelId,children:JSON.stringify(n.map(o=>o.localId))}};for(const o of n){const a=await eu(i,o);a&&(r.children||(r.children=[]),r.children.push(a))}return r}if(e!==null){const r=await i.getItem(e).getAttributes();if(!r)return null;const o={data:{Name:String(r.getValue("Name")),modelId:i.modelId,localId:e}};for(const a of n??[]){const l=await eu(i,a);l&&(o.children||(o.children=[]),o.children.push(l))}return o}return null},vD=async i=>{const t=[];for(const e of i){const s=await e.getSpatialStructure(),n=await eu(e,s);if(!n)continue;const r={data:{Name:e.modelId,modelId:e.modelId},children:[n]};t.push(r)}return t},s0=i=>{const{components:t,models:e}=i,s=i.selectHighlighterName??"select";return F`
    <bim-table @rowcreated=${n=>{n.stopImmediatePropagation();const{row:r}=n.detail,o=t.get(Ds),a=t.get(Se);r.onclick=async()=>{if(!s)return;const{data:{modelId:l,localId:c,children:h}}=r;if(!(l&&(c!==void 0||h)))return;const d=a.list.get(l);if(d){if(c!==void 0){const u=await d.getItemsChildren([c]),p={[l]:u.length!==0?new Set(u):new Set([c])};o.highlightByID(s,p,!0,!0)}else if(h){const u=JSON.parse(h),p=await d.getItemsChildren(u),m={[l]:p.length!==0?p:u};o.highlightByID(s,m,!0,!0)}}}}} @cellcreated=${({detail:n})=>{const{cell:r}=n;r.column==="Name"&&!r.rowData.Name&&(r.style.gridColumn="1 / -1")}} ${Yt(async n=>{if(!n)return;const r=n;r.loadFunction=async()=>new Promise(o=>{setTimeout(()=>{o(vD(e))})}),r.loadData(!0)})} headers-hidden>
      <bim-label slot="missing-data" style="--bim-icon--c: gold" icon="ic:round-warning">
        No models available to display the spatial structure!
      </bim-label>
    </bim-table>
  `},_D=(i,t=!0)=>{const e=Zt.create(s0,i),[s,n]=e;if(s.hiddenColumns=["modelId","localId","children"],s.columns=["Name"],s.headersHidden=!0,t){const{components:r}=i,o=r.get(Se);o.list.onItemSet.add(()=>n({models:o.list.values()})),o.list.onItemDeleted.add(()=>n())}return e},wD=Object.freeze(Object.defineProperty({__proto__:null,spatialTree:_D,spatialTreeTemplate:s0},Symbol.toStringTag,{value:"Module"}));let bn={};const Wg={_category:"Category",_localId:"LocalId",_guid:"Guid"},xD=(i,t,e,s,n,r)=>{const o={data:{type:"attribute",modelId:s,localId:n,Name:t in Wg?Wg[t]:t,Value:e,dataType:r}};i.children||(i.children=[]),i.children.push(o)},n0=(i,t,e)=>{var s;i in bn||(bn[i]=new Map);const n=bn[i],r=t._localId.value;if(n.has(r))return n.get(r);const o=(s=t[e.defaultItemNameKey])==null?void 0:s.value,a=t._category.value,l={data:{modelId:i,localId:r,type:"item",Name:(o==null?void 0:o.toString().length)>0?o.toString():a??String(r)}};n.set(r,l);for(const c in t){const h=t[c];if(!Array.isArray(h))xD(l,c,h.value,i,r,h.type);else{const d={data:{Name:c,type:"relation"}};l.children||(l.children=[]),l.children.push(d);for(const u of h){const p=n0(i,u,e);d.children||(d.children=[]),d.children.push(p)}}}return l},CD=async(i,t,e)=>{const s=i.get(Se);Object.keys(t).length===0&&(bn={});const n=[];for(const r in t){const o=s.list.get(r);if(!o)continue;r in bn||(bn[r]=new Map);const a=bn[r],l=t[r];for(const c of l){let h=a.get(c);if(h){n.push(h);continue}const[d]=await o.getItemsData([c],e.itemsDataConfig);h=n0(r,d,e),n.push(h)}}return n},r0=i=>{const t={defaultItemNameKey:"Name",itemsDataConfig:{attributesDefault:!0,relationsDefault:{attributes:!1,relations:!1},relations:{IsDefinedBy:{attributes:!0,relations:!0},DefinesOcurrence:{attributes:!1,relations:!1},ContainedInStructure:{attributes:!0,relations:!0},ContainsElements:{attributes:!1,relations:!1},Decomposes:{attributes:!1,relations:!1}}},...i},{components:e,modelIdMap:s,emptySelectionWarning:n}=i,r=Object.keys(s).reduce((o,a)=>(a.includes("DELTA")||(o[a]=s[a]),o),{});return F`
    <bim-table @cellcreated=${({detail:o})=>{const{cell:a}=o,{Name:l,Value:c}=a.rowData;l&&c===void 0&&setTimeout(()=>{a.style.gridColumn="1 / -1"})}} ${Yt(async o=>{if(!o)return;const a=o;a.loadFunction=async()=>CD(e,r,t),await a.loadData(!0)&&a.dispatchEvent(new Event("datacomputed"))})}>
      ${n?F`
            <bim-label slot="missing-data" style="--bim-icon--c: gold" icon="ic:round-warning">
              Select some elements to display its properties
            </bim-label>
            `:null}
      <bim-label slot="error-loading" style="--bim-icon--c: #e72e2e" icon="bxs:error-alt">
        Something went wrong with the properties
      </bim-label>
    </bim-table>
  `},SD=new Map,ED={METRE:"m",SQUARE_METRE:"m²",CUBIC_METRE:"m³"},kD=async(i,t)=>{const e=i.get(Se).list.get(t);if(!e)throw new Error(`ItemsDataUI: model ${t} not found.`);let s=SD.get(e.modelId);if(!s){const[n]=Object.values(await e.getItemsOfCategories([/UNITASSIGNMENT/])).flat(),[r]=await e.getItemsData([n],{relations:{Units:{relations:!1,attributes:!0}}});if(!Array.isArray(r.Units))return[];s=r.Units}return s},AD=(i,t)=>{const{components:e}=i;t.columns=[{name:"Name",width:"12rem"}],t.visibleColumns=["Name","Value"],t.headersHidden=!0,t.dataTransform={Value:(s,n)=>{const{dataType:r,modelId:o}=n;return r?F`<bim-label ${Yt(async a=>{if(!(a&&o))return;const l=await kD(e,o),c=r.replace("IFC","").replace("MEASURE","UNIT"),h=l.find(u=>u.UnitType&&"value"in u.UnitType?u.UnitType.value===c:!1);if(!h||!(h.Name&&"value"in h.Name))return s;const d=`${s.toFixed(2)} ${ED[h.Name.value]??h.Name.value}`;a.textContent=d})}></bim-label>`:s}}},TD=i=>{const t=Zt.create(r0,i),[e]=t;return AD(i,e),t},MD=Object.freeze(Object.defineProperty({__proto__:null,itemsData:TD,itemsDataTemplate:r0},Symbol.toStringTag,{value:"Module"})),o0=i=>{const{components:t}=i,e=i.missingDataMessage??"No models has been loaded yet",s=t.get(Se),n=({detail:r})=>{const{cell:o}=r;o.style.padding="0.25rem 0"};return F`
    <bim-table ${Yt(async r=>{if(!r)return;const o=r,a=[];if(s.initialized)for(const[,l]of s.list){if(!(l&&!l.isDeltaModel))continue;const c=await l.getMetadata(),h={data:{Name:l.modelId,modelId:l.modelId,metadata:JSON.stringify(c)}};a.push(h)}o.data=a})} @cellcreated=${n}>
      <bim-label slot="missing-data" style="--bim-icon--c: gold" icon="ic:round-warning">
        ${e}
      </bim-label>
    </bim-table>
  `},PD=(i,t)=>{const{components:e,actions:s,metaDataTags:n}=i,r=e.get(Se),o=(s==null?void 0:s.dispose)??!0,a=(s==null?void 0:s.download)??!0,l=(s==null?void 0:s.visibility)??!0,c=n??[];t.hiddenColumns=["modelId","metadata"],t.headersHidden=!0,t.noIndentation=!0,t.dataTransform={Name:(h,d)=>{if(!r.initialized)return h;const{modelId:u,metadata:p}=d;if(!u)return h;const m=r.list.get(u);if(!m)return u;const f=[];if(p){const v=JSON.parse(p);for(const _ of c){const x=v[_];if(!(typeof x=="string"||typeof x=="boolean"||typeof x=="number"))continue;const S=F`
            <bim-label style="background-color: var(--bim-ui_main-base); padding: 0 0.25rem; color: var(--bim-ui_main-contrast); border-radius: 0.25rem;">${x}</bim-label>
            `;f.push(S)}}let b;o&&(b=F`<bim-button @click=${()=>r.core.disposeModel(m.modelId)} icon="mdi:delete"></bim-button>`);let g;l&&(g=F`<bim-button @click=${async({target:v})=>{v.loading=!0,await m.setVisible(void 0,v.hasAttribute("data-model-hidden")),await r.core.update(!0),v.toggleAttribute("data-model-hidden"),v.icon=v.hasAttribute("data-model-hidden")?"mdi:eye-off":"mdi:eye",v.loading=!1}} icon="mdi:eye"></bim-button>`);let y;return a&&(y=F`<bim-button @click=${async()=>{const v=await m.getBuffer(!1),_=new File([v],`${m.modelId}.frag`),x=document.createElement("a");x.href=URL.createObjectURL(_),x.download=_.name,x.click(),URL.revokeObjectURL(x.href)}} icon="flowbite:download-solid"></bim-button>`),F`
       <div style="display: flex; flex: 1; gap: var(--bim-ui_size-4xs); justify-content: space-between; overflow: auto;">
        <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 0 var(--bim-ui_size-4xs); flex-grow: 1; overflow: auto;">
          <div style="min-height: 1.75rem; overflow: auto; display: flex;">
            <bim-label style="white-space: normal;">${h}</bim-label>
          </div>
          <div style="display: flex; flex-wrap: wrap; gap: var(--bim-ui_size-4xs); overflow: auto;">
            ${f}
          </div>
        </div>
        <div style="display: flex; align-self: flex-start; flex-shrink: 0;">
          ${y}
          ${g}
          ${b}
        </div>
       </div>
      `}}},$D=(i,t=!0)=>{const e=Zt.create(o0,i),[s,n]=e;if(PD(i,s),t){const{components:r}=i,o=r.get(Se),a=()=>setTimeout(()=>n());o.list.onItemSet.add(a),o.list.onItemDeleted.add(a)}return e},OD=Object.freeze(Object.defineProperty({__proto__:null,modelsList:$D,modelsListTemplate:o0},Symbol.toStringTag,{value:"Module"})),a0=i=>{var t;const{components:e}=i,s=i.missingDataMessage??"No viewpoints to display",n=e.get(vc),r=((t=i.topic)==null?void 0:t.viewpoints)??n.list.keys(),o=[];for(const c of r){const h=n.list.get(c);h&&o.push(h)}const a=c=>{if(!c)return;const h=c;h.data=o.map((d,u)=>({data:{Guid:d.guid,Title:d.title??`Viewpoint ${i.topic?u+1:""}`,Actions:""}}))},l=({detail:c})=>{const{cell:h}=c;h.style.padding="0.25rem"};return F`
    <bim-table ${Yt(a)} @cellcreated=${l}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${s}</bim-label>
    </bim-table>
  `},DD=(i,t)=>{const{components:e,topic:s}=i;t.noIndentation=!0,t.headersHidden=!0,t.hiddenColumns=["Guid"],t.columns=["Title",{name:"Actions",width:"auto"}];const n={selectComponents:!0,colorizeComponent:!0,resetColors:!0,updateCamera:!0,delete:!0,unlink:!!s,...i.actions},r=e.get(vc);t.dataTransform={Actions:(o,a)=>{const{Guid:l}=a;if(!(l&&typeof l=="string"))return o;const c=r.list.get(l);if(!c)return o;const h=async({target:y})=>{y.loading=!0,await c.go(),y.loading=!1};let d;n.selectComponents&&(d=F`
          <bim-button label="Select Components" @click=${async({target:y})=>{const v=e.get(Se),_=e.get(Ds);if(!_.isSetup)return;y.loading=!0;const x=await v.guidsToModelIdMap([...c.selectionComponents]);await _.highlightByID("select",x),y.loading=!1}}></bim-button>
        `);let u;n.colorizeComponent&&(u=F`
          <bim-button label="Colorize Components" @click=${async({target:y})=>{y.loading=!0,await c.setColorizationState(!0),y.loading=!1}}></bim-button>
        `);let p;n.resetColors&&(p=F`
          <bim-button label="Reset Colors" @click=${async({target:y})=>{y.loading=!0,await c.setColorizationState(!1),y.loading=!1}}></bim-button>
        `);let m;n.updateCamera&&(m=F`
          <bim-button label="Update Camera" @click=${()=>c.updateCamera()}></bim-button>
        `);let f;n.unlink&&(f=F`
          <bim-button label="Unlink" @click=${()=>s==null?void 0:s.viewpoints.delete(c.guid)}></bim-button>
        `);let b;n.delete&&(b=F`
          <bim-button label="Delete" @click=${()=>{r.list.delete(c.guid),ko.removeMenus()}}></bim-button>
        `);let g;return Object.values(n).includes(!0)&&(g=F`
          <bim-button icon="prime:ellipsis-v">
            <bim-context-menu>
              ${d}
              ${u}
              ${p}
              ${m}
              ${f}
              ${b}
            </bim-context-menu>
          </bim-button>
        `),F`
        <bim-button icon="ph:eye-fill" @click=${h}></bim-button>
        ${g}
      `}}},l0=(i,t=!0)=>{const e=Zt.create(a0,i),[s,n]=e;if(DD(i,s),t){const{components:r,topic:o}=i,a=r.get(vc);a.list.onItemUpdated.add(()=>n()),a.list.onItemDeleted.add(()=>n()),a.list.onCleared.add(()=>n()),o?(o.viewpoints.onItemAdded.add(()=>n()),o.viewpoints.onItemDeleted.add(()=>n()),o.viewpoints.onCleared.add(()=>n())):a.list.onItemSet.add(()=>n())}return e},ID=Object.freeze(Object.defineProperty({__proto__:null,viewpointsList:l0,viewpointsListTemplate:a0},Symbol.toStringTag,{value:"Module"})),c0=i=>{const{components:t}=i,e=i.missingDataMessage??"No topics to display",s=t.get(ra),n=i.topics??s.list.values();return F`
    <bim-table no-indentation ${Yt(r=>{if(!r)return;const o=r;o.data=[...n].map(a=>{var l;return{data:{Guid:a.guid,Title:a.title,Status:a.status,Description:a.description??"",Author:a.creationAuthor,Assignee:a.assignedTo??"",Date:a.creationDate.toDateString(),DueDate:((l=a.dueDate)==null?void 0:l.toDateString())??"",Type:a.type,Priority:a.priority??"",Actions:""}}})})}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${e}</bim-label>
    </bim-table>
  `},zD=(i,t)=>{const{dataStyles:e}=i;t.hiddenColumns.length===0&&(t.hiddenColumns=["Guid","Actions"]),t.columns=["Title"],t.dataTransform={Priority:s=>{if(typeof s!="string")return s;const n=((e==null?void 0:e.priorities)??Ge.priorities)[s];return F`
            <bim-label
              .icon=${n==null?void 0:n.icon}
              style=${Ni({...or,...n==null?void 0:n.style})}
            >${s}
            </bim-label>
          `},Status:s=>{if(typeof s!="string")return s;const n=((e==null?void 0:e.statuses)??Ge.statuses)[s];return F`
            <bim-label
              .icon=${n==null?void 0:n.icon}
              style=${Ni({...or,...n==null?void 0:n.style})}
            >${s}
            </bim-label>
          `},Type:s=>{if(typeof s!="string")return s;const n=((e==null?void 0:e.types)??Ge.types)[s];return F`
            <bim-label
              .icon=${n==null?void 0:n.icon}
              style=${Ni({...or,...n==null?void 0:n.style})}
            >${s}
            </bim-label>
          `},Author:s=>typeof s!="string"?s:rr(s,(e==null?void 0:e.users)??Ge.users),Assignee:s=>typeof s!="string"?s:rr(s,(e==null?void 0:e.users)??Ge.users)}},h0=(i,t=!0)=>{const e=Zt.create(c0,i),[s,n]=e;if(zD(i,s),t){const{components:r,topics:o}=i,a=r.get(ra),l=()=>n();if(a.list.onItemUpdated.add(l),a.list.onItemDeleted.add(l),o)for(const c of o)c.relatedTopics.onItemAdded.add(l),c.relatedTopics.onItemDeleted.add(l),c.relatedTopics.onCleared.add(l);else a.list.onItemSet.add(l)}return e},LD=Object.freeze(Object.defineProperty({__proto__:null,topicsList:h0,topicsListTemplate:c0},Symbol.toStringTag,{value:"Module"})),d0=i=>{const{topic:t,styles:e,viewpoint:s}=i,n=i.missingDataMessage??"The topic has no comments";return F`
    <bim-table no-indentation ${Yt(r=>{if(!r)return;const o=r;let a=t.comments.values();s&&(a=[...t.comments.values()].filter(l=>l.viewpoint===s.guid)),o.data=[...a].map(l=>({data:{guid:l.guid,Comment:l.comment,author:(()=>{const c=e;if(!c)return l.author;const h=c[l.author];return(h==null?void 0:h.name)??l.author})()}}))})}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${n}</bim-label>
    </bim-table>
  `},RD=(i,t)=>{const{topic:e,styles:s}=i,n={delete:!0,...i.actions};t.headersHidden=!0,t.hiddenColumns=["guid","author"],t.dataTransform={Comment:(r,o)=>{const{guid:a}=o;if(typeof a!="string")return r;const l=e.comments.get(a);if(!l)return r;const c=()=>{e.comments.delete(a)};let h;if(n.delete){const d=`btn-${we.newRandomId()}`;h=F`
          <div>
            <style>
              #${d} {
                background-color: transparent;
                --bim-label--c: var(--bim-ui_bg-contrast-60)
              }
  
              #${d}:hover {
                --bim-label--c: #FF5252;
              }
            </style>
            <bim-button @click=${c} id=${d} icon="majesticons:delete-bin"></bim-button>
          </div>
        `}return F`
        <div style="display: flex; flex-direction: column; gap: 0.25rem; flex: 1">
          <div style="display: flex; justify-content: space-between;">
            <div style="display: flex; gap: 0.375rem;">
              ${rr(l.author,s??Ge.users)}
              <bim-label style="color: var(--bim-ui_bg-contrast-40)">@ ${l.date.toDateString()}</bim-label>
            </div>
            ${h}
          </div>
          <bim-label style="margin-left: 1.7rem; white-space: normal">${l.comment}</bim-label>
        </div>
      `}}},u0=(i,t=!0)=>{const e=Zt.create(d0,i),[s,n]=e;if(RD(i,s),t){const{topic:r}=i,o=()=>n();r.comments.onItemSet.add(o),r.comments.onItemUpdated.add(o),r.comments.onItemDeleted.add(o),r.comments.onCleared.add(o)}return e},BD=Object.freeze(Object.defineProperty({__proto__:null,commentsList:u0,commentsListTemplate:d0},Symbol.toStringTag,{value:"Module"}));({...wD,...MD,...OD,...ID,...LD,...BD});const p0=(i,t)=>{const{showInput:e,topic:s,styles:n}=i,r={add:!0,delete:!0,...i.actions},o=`input-${we.newRandomId()}`,a=`btn-${we.newRandomId()}`,l=`btn-${we.newRandomId()}`,c=()=>document.getElementById(a),h=()=>document.getElementById(o),d=()=>{const v=h();return v?v.value.trim().length>0:!1},u=()=>{t({showInput:!0})},p=()=>{const v=h(),_=d();v&&_&&(s.createComment(v.value),t({showInput:!1}))},m=()=>{t({showInput:!1})},f=()=>{const v=c();if(v){if(!h()){v.disabled=!0;return}v.disabled=!d()}},b=F`
    ${r.add?F`<bim-button @click=${u} label="Add Comment" icon="majesticons:comment-line"></bim-button>`:null}
  `,g=F`
    <bim-text-input id=${o} @input=${f} @keypress=${v=>{v.code==="Enter"&&v.ctrlKey&&p()}} type="area"></bim-text-input>

    <div style="justify-content: right; display: flex; gap: 0.375rem">
      <style>
        #${a} {
          background-color: #329936;
        }  

        #${l} {
          background-color: transparent;
        }

        #${l}:hover {
          --bim-label--c: #FF5252;
        }
      </style>

      <bim-button style="flex: 0" id=${l} @click=${m} label="Cancel"></bim-button>
      <bim-button style="flex: 0" id=${a} @click=${p} label="Accept" icon="material-symbols:check" disabled></bim-button>
    </div>
  `,[y]=u0({topic:s,actions:r,styles:n??Ge.users});return F`
    <div style="display: flex; flex-direction: column; gap: 0.5rem">
      ${y}
      ${e?g:b}
    </div>
  `},ND=i=>Zt.create(p0,i),FD=Object.freeze(Object.defineProperty({__proto__:null,topicComments:ND,topicCommentsSectionTemplate:p0},Symbol.toStringTag,{value:"Module"})),f0=(i,t)=>{const{components:e,editing:s,topic:n,styles:r}=i,o={update:!0,...i.actions},a=(r==null?void 0:r.priorities)??Ge.priorities,l=(r==null?void 0:r.statuses)??Ge.statuses,c=(r==null?void 0:r.types)??Ge.types;let h;n!=null&&n.priority&&(h=a[n.priority]);let d;n!=null&&n.type&&(d=c[n.type]);let u;n!=null&&n.type&&(u=l[n.status]);let p,m;return s?p=i0({components:e,topic:n,styles:r,onSubmit:()=>{t({editing:!1})},onCancel:()=>{t({editing:!1})}}):m=F`
      <div>
        <bim-label>Title</bim-label>
        <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${n.title}</bim-label>
      </div>

      ${n.description?F`
            <div>
              <bim-label>Description</bim-label>
              <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100); white-space: normal">${n.description}</bim-label>
            </div>
          `:null}

      <div style="display: flex; gap: 0.375rem">
        <bim-label>Status</bim-label>
        <bim-label .icon=${u==null?void 0:u.icon} style=${Ni({...or,...u==null?void 0:u.style})}
        >${n.status}
        </bim-label>
      </div>

      <div style="display: flex; gap: 0.375rem">
        <bim-label>Type</bim-label>
        <bim-label .icon=${d==null?void 0:d.icon} style=${Ni({...or,...d==null?void 0:d.style})}
        >${n.type}
        </bim-label>
      </div>

      ${n.priority?F`
            <div style="display: flex; gap: 0.375rem">
              <bim-label>Priority</bim-label>
              <bim-label .icon=${h==null?void 0:h.icon} style=${Ni({...or,...h==null?void 0:h.style})}
              >${n.priority}
              </bim-label>
            </div>`:null}

      <div style="display: flex; gap: 0.375rem">
        <bim-label>Author</bim-label>
        ${rr(n.creationAuthor,(r==null?void 0:r.users)??Ge.users)}
      </div>

      ${n.assignedTo?F`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Assignee</bim-label>
            ${rr(n.assignedTo,(r==null?void 0:r.users)??Ge.users)}
          </div>`:null}

      ${n.dueDate?F`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Due Date</bim-label>
            <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${n.dueDate.toDateString()}</bim-label>
          </div>`:null}

      ${n.modifiedAuthor?F`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Modified By</bim-label>
            ${rr(n.modifiedAuthor,(r==null?void 0:r.users)??Ge.users)}
          </div>`:null}

      ${n.modifiedDate?F`
            <div style="display: flex; gap: 0.375rem">
              <bim-label>Modified Date</bim-label>
              <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${n.modifiedDate.toDateString()}</bim-label>
            </div>`:null}

      ${n.labels.size!==0?F`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Labels</bim-label>
            <bim-label style="white-space: normal; --bim-label--c: var(--bim-ui_bg-contrast-100)">${[...n.labels].join(", ")}</bim-label>
          </div>`:null}

      ${o.update?F`
              <bim-button @click=${()=>t({editing:!0})} label="Update Information" icon="tabler:refresh"></bim-button> 
            `:null}
    `,F`
    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
      ${s?p:m}
    </div>
  `},UD=i=>Zt.create(f0,i),jD=Object.freeze(Object.defineProperty({__proto__:null,topicInformation:UD,topicInformationSectionTemplate:f0},Symbol.toStringTag,{value:"Module"})),m0=(i,t)=>{const{components:e,topic:s,linking:n}=i,r=e.get(ra),o={link:!0,...i.actions},[a,l]=h0({components:e,topics:[...s.relatedTopics].map(u=>r.list.get(u)).map(u=>u)});a.headersHidden=!0,a.hiddenColumns=["Guid","Status","Description","Author","Assignee","Date","DueDate","Type","Priority"];const c=()=>F`
      <bim-text-input placeholder="Search..." debounce="100" @input=${u=>{const p=u.target;p instanceof qe&&(a.queryString=p.value)}}></bim-text-input> 
    `;let h,d;if(n){a.selectableRows=!0,l({topics:void 0});const u=a.data.filter(g=>{const{Guid:y}=g.data;return typeof y!="string"?!1:s.relatedTopics.has(y)}).map(g=>g.data);a.selection.add(...u);const p=()=>{const g=[...a.selection].map(({Guid:y})=>typeof y!="string"?null:r.list.has(y)?y:null).map(y=>y);s.relatedTopics.clear(),s.relatedTopics.add(...g),t({linking:!1})},m=()=>{t({linking:!1})},f=`btn-${we.newRandomId()}`,b=`btn-${we.newRandomId()}`;h=F`
      <div style="display: flex; gap: 0.25rem">
        <style>
          #${f}:hover {
            background-color: #329936;
          }  

          #${b} {
            background-color: transparent;
          }

          #${b}:hover {
            --bim-label--c: #FF5252;
          }
        </style>
        ${c()}
        <div style="display: flex; justify-content: right; gap: 0.25rem">
          <bim-button id=${b} @click=${m} style="flex: 0" label="Cancel" icon="material-symbols:close"></bim-button>
          <bim-button id=${f} @click=${p} style="flex: 0" label="Accept" icon="material-symbols:check"></bim-button>
        </div>
      </div> 
    `}else{a.selectableRows=!1;const u=()=>{t({linking:!0})};d=F`
      <div style="display: flex; justify-content: right; gap: 0.25rem">
        ${c()}
        ${o.link?F`<bim-button style="flex: 0" @click=${u} icon="tabler:link"></bim-button>`:null}
      </div> 
    `}return F`
    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
      ${d}
      ${h}
      ${a}
    </div> 
  `},VD=i=>Zt.create(m0,i),HD=Object.freeze(Object.defineProperty({__proto__:null,topicRelations:VD,topicRelationsSectionTemplate:m0},Symbol.toStringTag,{value:"Module"})),g0=(i,t)=>{const{components:e,topic:s,world:n,linking:r}=i,o={add:!0,link:!0,selectComponents:!0,colorizeComponent:!0,resetColors:!0,updateCamera:!0,delete:!0,unlink:!0,...i.actions},a=e.get(vc),[l,c]=l0({components:e,topic:s,actions:o}),h=()=>F`
      <bim-text-input placeholder="Search..." debounce="100" @input=${p=>{const m=p.target;m instanceof qe&&(l.queryString=m.value)}}></bim-text-input> 
    `;let d,u;if(r){l.selectableRows=!0,c({topic:void 0,actions:{delete:!1,updateCamera:!1,colorizeComponent:!1,resetColors:!1}});const p=l.data.filter(y=>{const{Guid:v}=y.data;return typeof v!="string"?!1:s.viewpoints.has(v)}).map(y=>y.data);l.selection.add(...p);const m=()=>{const y=[...l.selection].map(({Guid:v})=>typeof v!="string"?null:a.list.has(v)?v:null).map(v=>v);s.viewpoints.clear(),s.viewpoints.add(...y),t({linking:!1})},f=()=>{t({linking:!1})},b=`btn-${we.newRandomId()}`,g=`btn-${we.newRandomId()}`;d=F`
      <div style="display: flex; gap: 0.25rem">
        <style>
          #${b}:hover {
            background-color: #329936;
          }  

          #${g} {
            background-color: transparent;
          }

          #${g}:hover {
            --bim-label--c: #FF5252;
          }
        </style>
        ${h()}
        <div style="display: flex; justify-content: right; gap: 0.25rem">
          <bim-button id=${g} @click=${f} style="flex: 0" label="Cancel" icon="material-symbols:close"></bim-button>
          <bim-button id=${b} @click=${m} style="flex: 0" label="Accept" icon="material-symbols:check"></bim-button>
        </div>
      </div> 
    `}else{l.selectableRows=!1,c({topic:s,actions:o});const p=()=>{if(!(s&&o.add&&!r))return;const g=a.create();n&&(g.world=n),s.viewpoints.add(g.guid)},m=()=>{t({linking:!0})},f=F`<bim-button style="flex: 0" @click=${p} .disabled=${!n} icon="mi:add"></bim-button>`,b=F`<bim-button style="flex: 0" @click=${m} icon="tabler:link"></bim-button>`;u=F`
      <div style="display: flex; justify-content: right; gap: 0.25rem">
        ${h()}
        <div style="display: flex; justify-content: right; gap: 0.25rem">
          ${o.add?f:null}
          ${o.link?b:null}
        </div>
      </div> 
    `}return F`
    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
      ${u}
      ${d}
      ${l}
    </div> 
  `},WD=i=>Zt.create(g0,i),qD=Object.freeze(Object.defineProperty({__proto__:null,topicViewpoints:WD,topicViewpointsSectionTemplate:g0},Symbol.toStringTag,{value:"Module"}));({...FD,...jD,...HD,...qD});const YD=i=>F`
    <bim-panel-section fixed label="New Topic" name="topic">
      ${i0(i)}
    </bim-panel-section>
  `,ZD=i=>Zt.create(YD,i),GD=Object.freeze(Object.defineProperty({__proto__:null,topic:ZD},Symbol.toStringTag,{value:"Module"}));({...GD});async function XD(i,t){const e=t.get(Se),s=new rw;for(const[o,a]of e.list)for(const[l,c]of Object.entries(i)){const h=await a.getItemsData(Array.from(c));for(const d of h){if(!d||!("value"in d._category))continue;const u=d._category.value,p=s.get(u)??0;s.set(u,p+1)}}const n=[...s.keys()],r=[...s.values()].map(o=>({value:o}));return{labels:n,datasets:{Categories:r}}}const KD=i=>{const{type:t,modelIdMap:e,components:s,addLabels:n=!0}=i,r=s.get(Se),o=s.get(Ds),a=s.get(cu),l=i.missingDataMessage??"No data in this chart.";return F`
    <bim-chart ${Yt(async c=>{if(!c)return;const h=c;if(h.loadFunction=async()=>XD(e,s),await h.loadData(!0),n){const d=h.querySelector("[slot='labels']");d&&(d.charts=[h],d.addEventListener("label-click",async u=>{const p=u,{label:m,visibility:f}=p.detail,b=[];for(const[g,y]of r.list){const v=await y.getItemsOfCategories([new RegExp(m)]),_=Object.values(v).flat(),x={[g]:new Set(_)};b.push(a.set(f,x))}b.push(r.core.update(!0)),await Promise.all(b)}))}h.addEventListener("sectionclick",async d=>{const u=d,{label:p}=u.detail;for(const[m,f]of r.list){const b=await f.getItemsOfCategories([new RegExp(p)]),g=Object.values(b).flat(),y={[m]:new Set(g)};o.highlightByID("select",y,!0,!0)}})})} type=${t??"bar"}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${l}</bim-label>
      ${n?F`<bim-chart-legend slot="labels"></bim-chart-legend>`:""}
    </bim-chart>
  `},QD=i=>Zt.create(KD,i),JD=Object.freeze(Object.defineProperty({__proto__:null,categoriesChart:QD},Symbol.toStringTag,{value:"Module"})),b0="Passed",y0="Failed";async function tI(i){const t=[],e=[],s={};for(const o of i)for(const[a,l]of o.entries()){for(const c of l.values()){const{guid:h,pass:d}=c;h&&(d?t.push(h):e.push(h))}s[a]={Passed:t,Failed:e}}const n={value:t.length,data:{guids:t,guidsMap:s}},r={value:e.length,data:{guids:e,guidsMap:s}};return{labels:[b0,y0],datasets:{"IDS Compliance":[n,r]}}}const eI=i=>{const{type:t,idsResult:e,components:s,addLabels:n=!0}=i,r=s.get(Se),o=s.get(Ds),a=s.get(cu);o.styles.set(b0,{color:new gt("green"),renderedFaces:Bl.ONE,opacity:1,transparent:!1}),o.styles.set(y0,{color:new gt("red"),renderedFaces:Bl.ONE,opacity:1,transparent:!1});const l=i.missingDataMessage??"No data in this chart.";return F`
    <bim-chart ${Yt(async c=>{if(!c)return;const h=c;if(h.loadFunction=async()=>{const d=Array.isArray(e)?e:[e];return tI(d)},h.colors=["green","red"],await h.loadData(!0),n){const d=h.querySelector("[slot='labels']");d&&(d.charts=[h]),d.addEventListener("label-click",async u=>{const{label:p,data:m,visibility:f}=u.detail,b=[];for(const g of m){const{guidsMap:y}=g;for(const[v,_]of Object.entries(y)){const x=r.list.get(v);if(!x)continue;const S=_[p];if(!S||S.length===0)continue;const k=(async()=>{const T=(await x.getLocalIdsByGuids(S)).filter(O=>O!==null);if(T.length===0)return;const M={[v]:new Set(T)};await a.set(f,M)})();b.push(k)}}await Promise.all(b)})}h.addEventListener("sectionclick",async d=>{const{values:u,label:p}=d.detail;await o.clear();for(const m of u){const{data:f}=m;if(!f)continue;const{guids:b}=f;for(const[g,y]of r.list){const v=(await y.getLocalIdsByGuids(b)).filter(x=>x!==null),_={[g]:new Set(v)};await o.highlightByID(p,_,!0,!1)}}})})} type=${t??"bar"} colorfulBars=${t==="bar"}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${l}</bim-label>
      ${n?F`<bim-chart-legend slot="labels"></bim-chart-legend>`:""}
    </bim-chart>
  `},iI=i=>Zt.create(eI,i),sI=Object.freeze(Object.defineProperty({__proto__:null,idsChart:iI},Symbol.toStringTag,{value:"Module"})),nI=i=>{const{charts:t}=i,e=i.missingDataMessage??"No charts attached";return F`
    <bim-chart-legend ${Yt(async s=>{if(!s)return;const n=s;n.charts=t})}>
      <bim-label slot="no-chart" icon="ph:warning-fill" style="--bim-icon--c: gold;">${e}</bim-label>
    </bim-chart-legend>
  `},rI=i=>Zt.create(nI,i),oI=Object.freeze(Object.defineProperty({__proto__:null,labels:rI},Symbol.toStringTag,{value:"Module"}));async function aI(i,t){const e={};for(const r of i){let o=r[t];o==null?o="Not defined":o instanceof Date?o=o.toLocaleDateString():o=String(o),e[o]||(e[o]=[]),e[o].push(r)}const s=Object.keys(e),n=[];for(const r of s){const o=e[r];n.push({value:o.length,data:{topics:o.map(({guid:a})=>a)}})}return{labels:s,datasets:{Topics:n}}}const lI=i=>{const{components:t,type:e,addLabels:s=!0,grouper:n="stage"}=i,r=i.filterFunction??(()=>!0),o=[...t.get(ra).list.values()].filter(r),a=i.missingDataMessage??"No data in this chart.";return F`
    <bim-chart ${Yt(async l=>{if(!l)return;const c=l;if(c.loadFunction=async()=>aI(o,n),await c.loadData(!0),s){const h=c.querySelector("[slot='labels']");h&&(h.charts=[c])}})} type=${e??"bar"}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${a}</bim-label>
      ${s?F`<bim-chart-legend slot="labels"></bim-chart-legend>`:""}
    </bim-chart>
  `},cI=i=>Zt.create(lI,i),hI=Object.freeze(Object.defineProperty({__proto__:null,topicsChart:cI},Symbol.toStringTag,{value:"Module"}));async function dI(i,t,e,s){const n=s.get(Se).list.get(e);if(!n)return{labels:[],datasets:{}};const r=await n.getAttributesUniqueValues([{categories:[t],get:i}]);if(!r)return{labels:[],datasets:{}};const o=[],a=[];for(const[l,c]of Object.entries(r))for(const{value:h,localIds:d}of Object.values(c)){o.push(h);const u=d.length;a.push({value:u,data:{modelIdMap:{[e]:new Set(d)}}})}return{labels:o,datasets:{[i.toString()]:a}}}const uI=i=>{const{type:t,attribute:e,category:s,modelId:n,components:r,addLabels:o=!0}=i,a={zoom:!0,...i.highlight},l=r.get(Se),c=r.get(Ds),h=r.get(cu),d=i.missingDataMessage??"No data in this chart.";return F`
    <bim-chart ${Yt(async u=>{if(!u)return;const p=u;if(p.loadFunction=async()=>dI(e,s,n,r),await p.loadData(!0),o){const m=p.querySelector("[slot='labels']");m&&(m.charts=[p]),m.addEventListener("label-click",async f=>{const{data:b,visibility:g}=f.detail;for(const y of b){const{modelIdMap:v}=y;await h.set(g,v)}await l.core.update(!0)})}p.addEventListener("sectionclick",async m=>{const{values:f}=m.detail,b=[];for(const g of f){const{data:y}=g;if(!y)continue;const{modelIdMap:v}=y;b.push(c.highlightByID("select",v,!0,a.zoom))}await Promise.all(b)})})} type=${t??"bar"}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${d}</bim-label>
      ${o?F`<bim-chart-legend slot="labels"></bim-chart-legend>`:""}
    </bim-chart>
  `},pI=i=>Zt.create(uI,i),fI=Object.freeze(Object.defineProperty({__proto__:null,attributesChart:pI},Symbol.toStringTag,{value:"Module"}));({...JD,...sI,...hI,...oI,...fI});const v0=document.getElementById("container"),Ai=new ow,mI=Ai.get(yc),Qt=mI.create();Qt.scene=new lu(Ai);Qt.renderer=new aw(Ai,v0);Qt.camera=new lw(Ai);Ai.init();J0.init();dD.init();Qt.scene.setup();Qt.camera.controls.setLookAt(5,5,5,0,0,0);v0.appendChild(Qt.renderer.three2D.domElement);const gI=Ai.get(ib);gI.create(Qt);Qt.camera.three.far=1e4;Qt.camera.three.updateProjectionMatrix();Qt.scene.three.background=null;const Kc=Ai.get(Se);Kc.init("https://thatopen.github.io/engine_fragment/resources/worker.mjs");const _0="https://thatopen.github.io/engine_components/resources/frags/small_road.frag",bI=await fetch(_0),yI=await bI.arrayBuffer(),vI=new Uint8Array(yI),Qc=await Kc.core.load(vI,{modelId:_0,camera:Qt.camera.three});Qt.scene.three.add(Qc.object);await Kc.core.update(!0);Qt.camera.controls.addEventListener("control",()=>Kc.core.update());Qc.getClippingPlanesEvent=()=>Array.from(Qt.renderer.three.clippingPlanes)||[];const cs=await Qc.getAlignments();Qt.scene.three.add(cs);const Le=Ai.get(Jh),me=Le.create("absolute");me.world=Qt;for(const i of cs.children)i.userData.initialStation=1925;me.alignments.push(cs);me.updateAlignments();console.log(cs);const uc=new Rs(void 0,20);me.onMarkerChange.add(({point:i})=>{uc.center.copy(i),Qt.camera.controls.fitToSphere(uc,!0)});const _i=Ai.get(td);_i.world=Qt;const _I=document.getElementById("horizontal-menu"),Pn=document.createElement("bim-world-2d");Pn.components=Ai;if(!Pn.world)throw new Error("World not found!");_I.appendChild(Pn);const hs=Le.create("horizontal");hs.world=Pn.world;const $n=await Qc.getHorizontalAlignments();for(const i of $n.children)i.rotation.x=Math.PI/2,i.rotation.y=Math.PI/2;hs.alignments.push($n);hs.updateAlignments();const w0=Pn.world.scene.three;w0.background=null;w0.add($n);for(const i of $n.children)i.userData.initialStation=1925;me.onMarkerChange.add(i=>{console.log(i);const t=$s.curvePointToAlignmentPercentage(i.alignment,i.point,i.curve);if(t===null)return;const e=$s.alignmentPercentageToPoint($n.children[0],t);e!==null&&(hs.setMarkerAtPoint(e,"select"),hs.setCursorValue(me.getCursorValue(),"select"))});const wI=Ai.get(au),xI=wI.get(Pn.world);xI.three.params.Line.threshold=10;await Pn.world.camera.controls.setLookAt(0,0,1e4,0,0,0,!1);const Dr=new tw;Dr.showPanel(2);document.body.append(Dr.dom);Dr.dom.style.left="0px";Dr.dom.style.zIndex="unset";Qt.renderer.onBeforeUpdate.add(()=>Dr.begin());Qt.renderer.onAfterUpdate.add(()=>Dr.end());let ns=0,Xh=null,qg=0,Rl=!0,er=!1;function iu(){const i=cs.children[ns],t=$n.children[ns];Rl?(me.highlight(i),hs.highlight(t)):(me.clearHighlight(),hs.clearHighlight())}iu();let Yg=-1;function Ss(){Yg!==ns&&me.clearStations(),Yg=ns;const i=cs.children[ns];er?(me.createStations(i),me.updateStations()):me.clearStations()}function Zg(i){const t=$s.alignmentPercentageToPoint(cs.children[ns],i);t&&(uc.center.copy(t.point),Qt.camera.controls.fitToSphere(uc,!0),me.setMarkerAtPoint(t,"select"),_i.set(t.point,t.normal),Xh&&clearTimeout(Xh),_i.sectionVisible=!1,Xh=setTimeout(()=>{_i.plane.enabled&&_i.update()},1e3),er&&_i.plane.enabled&&Ss());const e=$s.alignmentPercentageToPoint($n.children[ns],i);e&&(hs.setMarkerAtPoint(e,"select"),hs.setCursorValue(me.getCursorValue(),"select"))}const x0=1e3;let pc=0;Qt.camera.controls.addEventListener("update",()=>{const i=Date.now();i-pc>x0&&(Ss(),pc=i)});Qt.camera.controls.addEventListener("update",()=>{const i=Date.now();i-pc>x0&&(Ss(),pc=i)});const Lo=Jg.create(()=>Qh`
  <bim-panel active label="Civil 3D Navigator Tutorial" class="options-menu">

      <bim-panel-section label="Alignments">

         <bim-dropdown required label="Selected alignment"
             @change="${({target:i})=>{ns=i.value[0],Rl&&iu(),er&&Ss()}}">

          ${cs.children.map(()=>Qh`
              <bim-option ?checked=${qg===0} label="${qg++}"></bim-option>
            `)}
        </bim-dropdown>
        
        <bim-number-input
          slider step="1" label="Highlight width" value="${me.highlightMaterial.linewidth}" min="1" max="10"
          @change="${({target:i})=>{Le.highlightMaterial.linewidth=i.value}}">
        </bim-number-input>

        <bim-color-input 
          label="Highlight Color" color="#${Le.highlightMaterial.color.getHexString()}" 
          @input="${({target:i})=>{Le.highlightMaterial.color=new gt(i.color)}}">
        </bim-color-input>

        
        <bim-color-input 
          label="Station Label Color" color="#${Le.stationLabelColor.getHexString()}" 
          @input="${({target:i})=>{Le.stationLabelColor=new gt(i.color)}}">
        </bim-color-input>

        
        <bim-color-input 
          label="Station Label Background Color" color="#${Le.stationLabelBackgroundColor.getHexString()}" 
          @input="${({target:i})=>{Le.stationLabelBackgroundColor=new gt(i.color)}}">
        </bim-color-input>

        <bim-color-input 
          label="Station Pointer Color" color="#${Le.stationPointerColor.getHexString()}" 
          @input="${({target:i})=>{Le.stationPointerColor=new gt(i.color)}}">
        </bim-color-input>

        <bim-color-input 
          label="Station Pointer Background Color" color="#${Le.stationPointerBackgroundColor.getHexString()}" 
          @input="${({target:i})=>{Le.stationPointerBackgroundColor=new gt(i.color)}}">
        </bim-color-input>

        <bim-number-input
          slider step="0.05" label="Screen distance limit" value="${Le.screenDistanceLimit}" min="0" max="1"
          @change="${({target:i})=>{Le.screenDistanceLimit=i.value,me.updateStations()}}">
        </bim-number-input>

        <bim-checkbox
          label="Highlight selected" checked="${Rl}"
          @change="${({target:i})=>{Rl=i.checked,iu()}}">
        </bim-checkbox>

        <bim-checkbox
          label="Show kps"
          @change="${({target:i})=>{er=i.checked,Ss()}}">
        </bim-checkbox>

        
        <bim-checkbox
          label="Clip"
          @change="${({target:i})=>{_i.plane.enabled=i.checked,_i.sectionVisible=i.checked,i.checked&&(_i.update(),_i.plane.update()),er&&Ss()}}">
        </bim-checkbox>

        
      <bim-checkbox
        label="Flip"
        @change="${({target:i})=>{_i.flip=i.checked,er&&Ss()}}">
      </bim-checkbox>

      <bim-number-input
      slider step="10" label="Increments" value="${me.increments}" min="10" max="100"
      @change="${({target:i})=>{me.increments=i.value,Ss()}}">
    </bim-number-input>

    <bim-number-input
      slider step="0.01" label="Alignment navigation" value="0.5" min="0" max="1"
      @change="${({target:i})=>{Zg(i.value)}}">
    </bim-number-input>

    <bim-number-input
      slider step="10" label="Move to KP" value="2000" min="1925" max="3000"
      @change="${({target:i})=>{const t=cs.children[ns],e=$s.alignmentLength(t),n=(i.value-t.userData.initialStation)/e,r=Math.min(Math.max(n,0),1);Zg(r)}}">
    </bim-number-input>

    </bim-panel-section>

    </bim-panel>
    `);Lo.style.zIndex="9999";document.body.append(Lo);const CI=Jg.create(()=>Qh`
      <bim-button class="phone-menu-toggler" icon="solar:settings-bold"
        @click="${()=>{Lo.classList.contains("options-menu-visible")?Lo.classList.remove("options-menu-visible"):Lo.classList.add("options-menu-visible")}}">
      </bim-button>
    `);document.body.append(CI);
