var gm=Object.defineProperty;var bm=(s,t,e)=>t in s?gm(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var lt=(s,t,e)=>(bm(s,typeof t!="symbol"?t+"":t,e),e);import{d as se,e as Fe,o as xe,b as M,C as bt,G as zi,af as Bl,x as xt,q as Lo,g as Vt,P as Te,L as ze,i as Ft,ag as Nl,s as Bo,ah as so,U as Bd,ai as no,aj as rn,S as Di,O as Fs,ak as ym,al as Ac,am as vm,W as Zt,Y as Nt,an as Un,w as _m,M as rt,l as ur,D as Mi,ao as wm,ap as xm,F as Li,z as Nd,m as Cm,n as Em,k as Ul,j as fo,aq as Sm,ar as Rl,t as Ud,as as Am,at as Rd,au as ce,av as Ws,aw as $m,ax as $c,p as Tm,ay as km,az as Wa,aA as Ns,aB as Pm,h as Om,c as Im,B as re,aC as Fd,aD as zm,aE as je,aF as Dm,aG as Tc,aH as Mm,aI as $r,aJ as _n,aK as Lm,aL as Bm,aM as Nm,ae as Um,aN as kc,u as Rm,a as Fm,V as jd,f as Ya}from"./index-BVinSk0X.js";import{R as Fl,E as mo,i as jm,c as Hd,g as Hm,F as qe,W as No,S as jl,O as Vd,j as Vm,d as qd,k as Uo,l as Ro,m as qm,T as wi,C as Wm,h as Ym,n as Zm}from"./graphic-vertex-picker-DIM7gQA5.js";import{b as Wd,a as Xm,L as Gm}from"./LineSegments2-D_Nwb4su.js";class Qm{constructor(t){lt(this,"alignments",[]);lt(this,"enabled",!0);lt(this,"world",null);lt(this,"_raycastable",[]);lt(this,"_components");this._components=t}update(){this.dispose();for(const t of this.alignments)for(const e of t.children){const i=e;i.updateWorldMatrix(!0,!0);for(const n of i.children){const r=n;if(r.isLine2&&r.userData.points){const o=new se,a=new Fe;a.geometry.setIndex(r.geometry.index);const l=new Float32Array(r.userData.points),c=new xe(l,3);o.setAttribute("position",c),a.geometry=o,a.userData.curve=r,a.applyMatrix4(r.matrixWorld),a.updateMatrixWorld(),this._raycastable.push(a)}}}}dispose(){for(const t of this._raycastable)t.geometry.dispose(),t.geometry=void 0;this._raycastable=[]}castRay(){if(!this.enabled||!this.world)return null;const i=this._components.get(Fl).get(this.world).castRayToObjects(this._raycastable);if(!i)return null;const n=i.object,r=n.geometry,o=i.index,a=r.attributes.position.array[o*3],l=r.attributes.position.array[o*3+1],c=r.attributes.position.array[o*3+2],h=r.attributes.position.array[o*3+3],d=r.attributes.position.array[o*3+4],p=r.attributes.position.array[o*3+5],u=new M(h-a,d-l,p-c).normalize();return{point:i.point,normal:u,curve:n.userData.curve,alignment:n.userData.curve.parent}}}class Ii{static alignmentPercentageToPoint(t,e){const i=new M,n=new M,r=this.alignmentLength(t),o=e*r;let a=0;if(t.updateWorldMatrix(!0,!0),e===1)for(let l=t.children.length-1;l>=0;l--){const c=t.children[l],h=c.userData.points;if(!h)continue;const d=new M(h[h.length-3],h[h.length-2],h[h.length-1]);return d.applyMatrix4(c.matrixWorld),{normal:new M,point:d,curve:c,alignment:t}}for(const l of t.children){const c=l.userData.points;if(c)for(let h=0;h<c.length-3;h+=3){const d=i.set(c[h],c[h+1],c[h+2]),p=n.set(c[h+3],c[h+4],c[h+5]),u=d.distanceTo(p);if(a+u>=o){const g=o-a,m=p.clone().sub(d).normalize(),b=m.clone().multiplyScalar(g);return d.add(b),d.applyMatrix4(l.matrixWorld),{normal:m,point:d,curve:l,alignment:t}}a+=u}}return null}static curvePercentageToPoint(t,e,i){const n=new M,r=new M,o=this.curveLength(e),a=i*o;let l=0;const c=e.userData.points;if(!c)throw new Error("No points found in curve");for(let h=0;h<c.length-3;h+=3){const d=n.set(c[h],c[h+1],c[h+2]),p=r.set(c[h+3],c[h+4],c[h+5]),u=d.distanceTo(p);if(l+u>=a){const g=a-l,m=p.clone().sub(d).normalize(),b=m.clone().multiplyScalar(g);return d.add(b),{normal:m,point:d,curve:e,alignment:t}}l+=u}return null}static alignmentLength(t){let e=0;if(t.userData.length!==void 0)return t.userData.length;for(const i of t.children)"isLine2"in i&&(e+=this.curveLength(i));return t.userData.length=e,e}static curveLength(t){let e=0;if(t.userData.length!==void 0)return t.userData.length;const i=new M,n=new M,r=t.userData.points;if(!r)throw new Error("No points found in curve");for(let o=0;o<r.length-2-3;o+=3){const a=i.set(r[o],r[o+1],r[o+2]),l=n.set(r[o+3],r[o+4],r[o+5]);e+=a.distanceTo(l)}return t.userData.length=e,e}static curvePointToAlignmentPercentage(t,e,i){const n=new M,r=new M,o=this.alignmentLength(t);let a=0;t.updateWorldMatrix(!0,!0);for(const l of t.children){const c=l.userData.points;if(c)for(let h=0;h<c.length-3;h+=3){const d=n.set(c[h],c[h+1],c[h+2]),p=r.set(c[h+3],c[h+4],c[h+5]);d.applyMatrix4(l.matrixWorld),p.applyMatrix4(l.matrixWorld);const u=d.distanceTo(p),g=d.distanceTo(e)<.001,m=p.distanceTo(e)<.001,b=this.isPointbetweenTwoOthers(d,p,e);if(l===i&&(g||m||b)){const f=d.distanceTo(e);return(a+f)/o}a+=u}}return null}static isPointbetweenTwoOthers(t,e,i){const n=new M;n.subVectors(e,t).normalize();const r=new M;r.subVectors(i,t).normalize();const o=new M;o.subVectors(i,e).normalize();const l=1-.0016;return n.dot(r)>l&&n.dot(o)<-l}}class Km{constructor(t,e){lt(this,"onDisposed",new mo);lt(this,"alignments",[]);lt(this,"components");lt(this,"onMarkerChange",new mo);lt(this,"enabled",!0);lt(this,"highlightMaterial");lt(this,"increments",20);lt(this,"screenDistanceLimit",.1);lt(this,"fadeInTime",500);lt(this,"_mouseMarkers");lt(this,"_highlighted",new Set);lt(this,"_stationPoints",new Map);lt(this,"_originalHighlightMaterialId","originalHighlightMaterial");lt(this,"_world",null);lt(this,"_raycaster");lt(this,"_stationLabelColor",new bt(16777215));lt(this,"_stationLabelBackgroundColor",new bt(8014801));lt(this,"_stationPointerColor",new bt(16777215));lt(this,"_stationPointerBackgroundColor",new bt(4803766));lt(this,"_pointerDown",performance.now());lt(this,"_pointerDownTime",150);lt(this,"onPointerDown",()=>{this._pointerDown=performance.now()});lt(this,"onPointerUp",()=>{if(performance.now()-this._pointerDown>this._pointerDownTime)return;const t=this.setMarkerToMouse("select");t&&this.onMarkerChange.trigger(t)});lt(this,"onMouseMove",()=>{this.setMarkerToMouse("hover")});this.components=t,this.highlightMaterial=e,this._raycaster=new Qm(t),this._raycaster.alignments=this.alignments}get world(){return this._world}set world(t){var n,r,o,a;if(t===this._world||(this._world&&this.setupEvents(!1),this._world=t,(n=this._mouseMarkers)==null||n.hover.removeFromParent(),(r=this._mouseMarkers)==null||r.select.removeFromParent(),(o=this._mouseMarkers)==null||o.hover.element.remove(),(a=this._mouseMarkers)==null||a.select.element.remove(),!t))return;this._raycaster.world=t;const e=this.newCivilLabel(0,"stationPointer");t.scene.three.add(e),e.visible=!1,e.element.style.transition="";const i=this.newCivilLabel(0,"stationPointer");i.element.style.transition="",i.element.style.opacity="0.5",t.scene.three.add(i),i.visible=!1,this._mouseMarkers={select:e,hover:i},this.setupEvents(!0)}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(t){this._stationLabelColor=t;const e=`#${t.getHexString()}`;for(const[,{labels:i}]of this._stationPoints){const n=[...i.children];for(const r of n){const o=this.getLabel(r);o.style.color=e;const a=this.getPoint(r);a.style.backgroundColor=e}}}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(t){this._stationLabelBackgroundColor=t;const e=`#${t.getHexString()}`;for(const[,{labels:i}]of this._stationPoints){const n=[...i.children];for(const r of n){const o=this.getLabel(r);o.style.backgroundColor=e;const a=this.getPoint(r);a.style.border=`2px solid ${e}`}}}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(t){this._stationPointerColor=t;const e=`#${t.getHexString()}`;if(this._mouseMarkers){const i=this._mouseMarkers.select,n=this.getLabel(i);n.style.color=e;const r=this.getPoint(i);r.style.backgroundColor=e}}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(t){this._stationPointerBackgroundColor=t;const e=`#${t.getHexString()}`;if(this._mouseMarkers){const i=this._mouseMarkers.select,n=this.getLabel(i);n.style.backgroundColor=e;const r=this.getPoint(i);r.style.border=`2px solid ${e}`}}dispose(){var t,e,i,n;this.clearHighlight(),this.clearStations(),this.alignments=[],(t=this._mouseMarkers)==null||t.hover.removeFromParent(),(e=this._mouseMarkers)==null||e.select.removeFromParent(),(i=this._mouseMarkers)==null||i.hover.element.remove(),(n=this._mouseMarkers)==null||n.select.element.remove(),this._raycaster.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){this._raycaster.update()}setMarkerAtPoint(t,e){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");this.updateMarkerValue(t,e),this._mouseMarkers[e].visible=!0,this._mouseMarkers[e].position.copy(t.point)}highlight(t,e=!0){e&&this.clearHighlight(this._highlighted);for(const i of t.children)"isLineSegments2"in i&&"material"in i&&(i.userData[this._originalHighlightMaterialId]=i.material,i.material=this.highlightMaterial);this._highlighted.add(t)}clearHighlight(t=this._highlighted){for(const e of t)for(const i of e.children)"isLineSegments2"in i&&"material"in i&&(i.material=i.userData[this._originalHighlightMaterialId],delete i.userData[this._originalHighlightMaterialId]);this._highlighted.clear()}createStations(t){if(!this.world||this._stationPoints.has(t.uuid))return;const e=new zi;this.world.scene.three.add(e),this._stationPoints.set(t.uuid,{alignment:t,labels:e})}clearStations(t=this._stationPoints.keys()){for(const e of t){const i=this._stationPoints.get(e);i&&(this.clearLabels(i.labels),this._stationPoints.delete(e))}}updateStations(){if(!this.world)throw new Error("No world found!");if(!this.world.renderer)throw new Error("No renderer found!");const t=this.world.camera.three,e=this.world.renderer.three,i=new Bl,n=e.clippingPlanes,r=new M,o=new M;let a=!0;const l=new M;for(const[,{alignment:c,labels:h}]of this._stationPoints){this.clearLabels(h),c.updateWorldMatrix(!0,!0);const d=c.userData.initialStation;let p=d||0;const u=p%this.increments;let g=d+this.increments-u;for(const m of c.children){if(!("isLine2"in m))continue;const b=m;if(b.geometry.boundingBox||b.geometry.computeBoundingBox(),i.setFromProjectionMatrix(new xt().multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse)),!i.intersectsBox(b.geometry.boundingBox)){const k=Ii.curveLength(m);p+=k;const v=p%this.increments;g=p+this.increments-v;continue}const f=m.userData.points,y=f[0],_=f[1],x=f[2];if(l.set(y,_,x),l.applyMatrix4(m.matrixWorld),!this.isLabelClipped(n,l)){if(a){a=!1,r.set(l.x,l.y,l.z),r.project(t),r.z=0;const k=this.newCivilLabel(p,"stationLabel");k.position.set(l.x,l.y,l.z),h.children.push(k)}else if(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit){const v=this.newCivilLabel(p,"stationLabel");v.position.set(l.x,l.y,l.z),h.children.push(v),r.copy(o)}}const S=new M,$=new M;for(let k=0;k<f.length-3;k+=3){S.set(f[k],f[k+1],f[k+2]),$.set(f[k+3],f[k+4],f[k+5]);const v=S.distanceTo($),L=p+v,X=$.clone().sub(S).normalize();for(;L>g;){const V=g-p,J=X.clone();J.multiplyScalar(V);const{x:Y,y:nt,z:U}=S.clone().add(J);if(l.set(Y,nt,U),l.applyMatrix4(m.matrixWorld),!this.isLabelClipped(n,l)&&i.containsPoint(l)&&(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit)){const it=this.newCivilLabel(g,"stationLabel");it.position.set(l.x,l.y,l.z),h.children.push(it),r.copy(o)}g+=this.increments}p+=v}const O=f[f.length-3],z=f[f.length-2],D=f[f.length-1];if(l.set(O,z,D),l.applyMatrix4(m.matrixWorld),this.isLabelClipped(n,l)||!i.containsPoint(l))continue;if(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit){const k=this.newCivilLabel(p,"stationLabel");k.position.set(l.x,l.y,l.z),h.children.push(k),r.copy(o)}}}}getCursorValue(){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");return this._mouseMarkers.select.element.children[0].children[0].innerText}setCursorValue(t,e){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const n=this._mouseMarkers[e].element.children[0].children[0];n.innerText=t}isLabelClipped(t,e){for(const i of t)if(!(i.distanceToPoint(e)>0))return!0;return!1}clearLabels(t){const e=[...t.children];for(const i of e)i.element.style.opacity="0";setTimeout(()=>{for(const i of e)i.removeFromParent(),i.element.remove(),i.visible=!1},this.fadeInTime)}newCivilLabel(t,e){const i=document.createElement("div"),n=e==="stationLabel"?this.stationLabelColor:this.stationPointerColor,r=e==="stationLabel"?this.stationLabelBackgroundColor:this.stationPointerBackgroundColor,o=document.createElement("div");o.style.width="4px",o.style.height="4px",o.style.borderRadius="50%",o.style.backgroundColor=`#${n.getHexString()}`,o.style.border=`2px solid #${r.getHexString()}`,o.style.display="flex",o.style.justifyContent="center";const a=this.getFormattedStation(t),l=document.createElement("div");l.innerText=a,l.style.backgroundColor=`#${r.getHexString()}`,l.style.color=`#${n.getHexString()}`,l.style.padding="0.3rem",l.style.position="absolute",l.style.bottom="1rem",l.style.borderRadius="6px",l.style.boxShadow="rgba(0, 0, 0, 0.6) 0px 4px 6px",o.appendChild(l);const c=new jm(i);return i.appendChild(o),e==="stationLabel"&&(i.style.transition=`opacity ${this.fadeInTime}ms ease-in-out`,i.style.opacity="0",setTimeout(()=>{i.style.opacity="1"})),c}setupEvents(t){if(!this.world)throw new Error("No world found!");if(this.world.isDisposing||!this.world.renderer)return;const e=this.world.renderer.three.domElement,n=this.components.get(Fl).get(this.world);n.three.params.Line||(n.three.params.Line={threshold:10}),e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointerup",this.onPointerUp),e.removeEventListener("pointermove",this.onMouseMove),t&&(e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointerup",this.onPointerUp),e.addEventListener("pointermove",this.onMouseMove))}setMarkerToMouse(t){if(!this.enabled||!this._mouseMarkers)return null;if(!this.world)throw new Error("No world found!");const e=this._raycaster.castRay();if(!e)return this._mouseMarkers[t].visible=!1,null;this._mouseMarkers[t].visible=!0;const i=e.point;return this._mouseMarkers[t].position.copy(i),this.updateMarkerValue(e,t),e}updateMarkerValue(t,e){if(!this._mouseMarkers)return;const{alignment:i,curve:n,point:r}=t,o=Ii.curvePointToAlignmentPercentage(i,r,n);if(o===null)throw new Error("Point is not on the curve");const l=o*Ii.alignmentLength(i)+i.userData.initialStation,c=this.getFormattedStation(l);this.setCursorValue(c,e)}getFormattedStation(t){const e=Math.floor(t/1e3),i=Math.round(t-e*1e3);return`${e}+${i}`}getLabel(t){return t.element.children[0].children[0]}getPoint(t){return t.element.children[0]}}const Do=class Do extends Hd{constructor(e){super(e);lt(this,"onDisposed",new mo);lt(this,"list",new Map);lt(this,"enabled",!0);lt(this,"highlightMaterial",new Wd({color:8014801,linewidth:5,depthTest:!1}));lt(this,"_increments",20);lt(this,"_screenDistanceLimit",.1);lt(this,"_fadeInTime",500);lt(this,"_stationLabelColor",new bt(16777215));lt(this,"_stationLabelBackgroundColor",new bt(8014801));lt(this,"_stationPointerColor",new bt(16777215));lt(this,"_stationPointerBackgroundColor",new bt(4803766));this.components.add(Do.uuid,this)}get increments(){return this._increments}set increments(e){this._increments=e;for(const[,i]of this.list)i.increments=e}get screenDistanceLimit(){return this._screenDistanceLimit}set screenDistanceLimit(e){this._screenDistanceLimit=e;for(const[,i]of this.list)i.screenDistanceLimit=e}get fadeInTime(){return this._fadeInTime}set fadeInTime(e){this._fadeInTime=e;for(const[,i]of this.list)i.fadeInTime=e}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(e){this._stationLabelColor=e;for(const[,i]of this.list)i.stationLabelColor=e}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(e){this._stationLabelBackgroundColor=e;for(const[,i]of this.list)i.stationLabelBackgroundColor=e}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(e){this._stationPointerColor=e;for(const[,i]of this.list)i.stationPointerColor=e}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(e){this._stationPointerBackgroundColor=e;for(const[,i]of this.list)i.stationPointerBackgroundColor=e}create(e){const i=new Km(this.components,this.highlightMaterial);return this.list.set(e,i),i}delete(e){const i=this.list.get(e);i&&(i.dispose(),this.list.delete(e))}dispose(){for(const[,e]of this.list)e.dispose();this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){for(const[,e]of this.list)e.updateAlignments()}};lt(Do,"uuid","0a59c09e-2b49-474a-9320-99f51f40f182");let Za=Do;const Mo=class Mo extends Hd{constructor(e){super(e);lt(this,"enabled",!0);lt(this,"onDisposed",new mo);lt(this,"_world",null);lt(this,"_flip",!1);lt(this,"_plane");lt(this,"_point",new M);lt(this,"_edgeMeshes",[]);lt(this,"_sectionVisible",!1);lt(this,"_sectionOffset",.1);lt(this,"edgeMaterial",new Wd({color:0,linewidth:5,depthTest:!1}));this.components.add(Mo.uuid,this)}get plane(){if(!this._plane)throw new Error("Plane is not set. You must give a world.");return this._plane}set plane(e){this._plane=e}get sectionVisible(){return this._sectionVisible}set sectionVisible(e){this._sectionVisible=e;for(const i of this._edgeMeshes)i.visible=e}get world(){return this._world}set world(e){var r;if(this._world=e,(r=this._plane)==null||r.dispose(),!e)return;const i=this.components.get(Hm),n=i.createFromNormalAndCoplanarPoint(e,new M(1,0,0),new M);this.plane=i.list.get(n),this.plane.visible=!1,this.plane.enabled=!1}get flip(){return this._flip}set flip(e){var n;if(e===this._flip)return;this._flip=e;const i=(n=this.plane)==null?void 0:n.normal.clone().multiplyScalar(-1);for(const r of this._edgeMeshes)r.position.add(i.clone().multiplyScalar(this._sectionOffset));this.plane.setFromNormalAndCoplanarPoint(i,this._point),this.plane.update()}dispose(){var e;this.clearMeshes(),(e=this.plane)==null||e.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}async set(e,i){this.flip&&i.multiplyScalar(-1),this.plane.setFromNormalAndCoplanarPoint(i,e),this._point.copy(e)}async update(){this.clearMeshes();const e=this.components.get(qe);this.plane.update();const i=[];for(const[,n]of e.list)i.push(this.generateModelSection(n));await Promise.all(i)}async generateModelSection(e){if(!this.world)return;const i=this.plane.three.clone();i.constant-=.01;const{buffer:n}=await e.getSection(i),r=new se,o=new xe(n,3,!1);r.setAttribute("position",o);const a=new Lo(r),l=new Xm;l.fromLineSegments(a);const c=new Gm(l,this.edgeMaterial);c.frustumCulled=!1,this.world.scene.three.add(c),this._edgeMeshes.push(c),c.renderOrder=3,a.geometry.dispose()}clearMeshes(){for(const e of this._edgeMeshes)e.removeFromParent(),e.geometry.dispose(),e.material=void 0;this._edgeMeshes=[]}};lt(Mo,"uuid","96b2c87e-d90b-4639-8257-8f01136fe324");let Xa=Mo;var Jm=Object.defineProperty,tg=(s,t,e)=>t in s?Jm(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,T=(s,t,e)=>(tg(s,typeof t!="symbol"?t+"":t,e),e),eg=Object.defineProperty,ig=(s,t,e)=>t in s?eg(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,E=(s,t,e)=>(ig(s,typeof t!="symbol"?t+"":t,e),e);let K=class{constructor(){E(this,"enabled",!0),E(this,"trigger",t=>{if(!this.enabled)return;const e=this.handlers.slice(0);for(const i of e)i(t)}),E(this,"handlers",[])}add(t){this.handlers.push(t)}remove(t){this.handlers=this.handlers.filter(e=>e!==t)}reset(){this.handlers.length=0}},Hl=class{constructor(t){E(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),E(this,"isResizeable",()=>"resize"in this&&"getSize"in this),E(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),E(this,"isHideable",()=>"visible"in this),E(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),E(this,"isSerializable",()=>"import"in this&&"export"in this),this.components=t}},Tt=class extends Hl{},Yd=class extends Hl{constructor(t){super(t),E(this,"worlds",new Nt),E(this,"onWorldChanged",new K),E(this,"_currentWorld",null),this.onWorldChanged.add(({world:e,action:i})=>{i==="removed"&&this.worlds.delete(e.uuid)})}set currentWorld(t){this._currentWorld=t}get currentWorld(){return this._currentWorld}},sg=class extends Yd{constructor(){super(...arguments),E(this,"hasCameraControls",()=>"controls"in this)}},ng=class extends Yd{constructor(){super(...arguments),E(this,"onAfterUpdate",new K),E(this,"onBeforeUpdate",new K),E(this,"onDisposed",new K),E(this,"onResize",new K),E(this,"onClippingPlanesUpdated",new K),E(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(t,e,i){e.isLocal=i;const n=this.clippingPlanes.indexOf(e);t&&n===-1?this.clippingPlanes.push(e):!t&&n>-1&&this.clippingPlanes.splice(n,1),this.three.clippingPlanes=this.clippingPlanes.filter(r=>!r.isLocal)}};const Zd=class Ga extends Tt{constructor(t){super(t),E(this,"_disposedComponents",new Set),E(this,"enabled",!0),t.add(Ga.uuid,this)}get(){return this._disposedComponents}destroy(t,e=!0,i=!0){t.removeFromParent();const n=t;n.dispose&&n.dispose(),this.disposeGeometryAndMaterials(t,e),i&&n.children&&n.children.length&&this.disposeChildren(n),t.children.length=0}disposeGeometry(t){t.boundsTree&&t.disposeBoundsTree&&t.disposeBoundsTree(),t.dispose()}disposeGeometryAndMaterials(t,e){const i=t;i.geometry&&this.disposeGeometry(i.geometry),e&&i.material&&Ga.disposeMaterial(i),i.material=[],i.geometry=null}disposeChildren(t){for(const e of t.children)this.destroy(e)}static disposeMaterial(t){if(t.material)if(Array.isArray(t.material))for(const e of t.material)e.dispose();else t.material.dispose()}};E(Zd,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let si=Zd,ha=class extends Set{constructor(t){super(t),E(this,"onItemAdded",new K),E(this,"onItemDeleted",new K),E(this,"onCleared",new K),E(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}add(...t){for(const e of t)this.has(e)||!this.guard(e)||(super.add(e),this.onItemAdded||(this.onItemAdded=new K),this.onItemAdded.trigger(e));return this}delete(t){const e=super.delete(t);return e&&this.onItemDeleted.trigger(),e}dispose(){this.clear(),this.onItemAdded.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}};const Vl=class Wt{static create(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return`${Wt._lut[t&255]+Wt._lut[t>>8&255]+Wt._lut[t>>16&255]+Wt._lut[t>>24&255]}-${Wt._lut[e&255]}${Wt._lut[e>>8&255]}-${Wt._lut[e>>16&15|64]}${Wt._lut[e>>24&255]}-${Wt._lut[i&63|128]}${Wt._lut[i>>8&255]}-${Wt._lut[i>>16&255]}${Wt._lut[i>>24&255]}${Wt._lut[n&255]}${Wt._lut[n>>8&255]}${Wt._lut[n>>16&255]}${Wt._lut[n>>24&255]}`.toLowerCase()}static validate(t){if(!Wt._pattern.test(t))throw new Error(`${t} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};E(Vl,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/);E(Vl,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let ie=Vl;var Tr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function rg(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Xd={},Fo={};(function(s){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",e=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",i="["+t+"]["+e+"]*",n=new RegExp("^"+i+"$"),r=function(a,l){const c=[];let h=l.exec(a);for(;h;){const d=[];d.startIndex=l.lastIndex-h[0].length;const p=h.length;for(let u=0;u<p;u++)d.push(h[u]);c.push(d),h=l.exec(a)}return c},o=function(a){const l=n.exec(a);return!(l===null||typeof l>"u")};s.isExist=function(a){return typeof a<"u"},s.isEmptyObject=function(a){return Object.keys(a).length===0},s.merge=function(a,l,c){if(l){const h=Object.keys(l),d=h.length;for(let p=0;p<d;p++)c==="strict"?a[h[p]]=[l[h[p]]]:a[h[p]]=l[h[p]]}},s.getValue=function(a){return s.isExist(a)?a:""},s.isName=o,s.getAllMatches=r,s.nameRegexp=i})(Fo);const ql=Fo,og={allowBooleanAttributes:!1,unpairedTags:[]};Xd.validate=function(s,t){t=Object.assign({},og,t);const e=[];let i=!1,n=!1;s[0]==="\uFEFF"&&(s=s.substr(1));for(let r=0;r<s.length;r++)if(s[r]==="<"&&s[r+1]==="?"){if(r+=2,r=Oc(s,r),r.err)return r}else if(s[r]==="<"){let o=r;if(r++,s[r]==="!"){r=Ic(s,r);continue}else{let a=!1;s[r]==="/"&&(a=!0,r++);let l="";for(;r<s.length&&s[r]!==">"&&s[r]!==" "&&s[r]!=="	"&&s[r]!==`
`&&s[r]!=="\r";r++)l+=s[r];if(l=l.trim(),l[l.length-1]==="/"&&(l=l.substring(0,l.length-1),r--),!fg(l)){let d;return l.trim().length===0?d="Invalid space after '<'.":d="Tag '"+l+"' is an invalid name.",Rt("InvalidTag",d,he(s,r))}const c=cg(s,r);if(c===!1)return Rt("InvalidAttr","Attributes for '"+l+"' have open quote.",he(s,r));let h=c.value;if(r=c.index,h[h.length-1]==="/"){const d=r-h.length;h=h.substring(0,h.length-1);const p=zc(h,t);if(p===!0)i=!0;else return Rt(p.err.code,p.err.msg,he(s,d+p.err.line))}else if(a)if(c.tagClosed){if(h.trim().length>0)return Rt("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",he(s,o));if(e.length===0)return Rt("InvalidTag","Closing tag '"+l+"' has not been opened.",he(s,o));{const d=e.pop();if(l!==d.tagName){let p=he(s,d.tagStartPos);return Rt("InvalidTag","Expected closing tag '"+d.tagName+"' (opened in line "+p.line+", col "+p.col+") instead of closing tag '"+l+"'.",he(s,o))}e.length==0&&(n=!0)}}else return Rt("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",he(s,r));else{const d=zc(h,t);if(d!==!0)return Rt(d.err.code,d.err.msg,he(s,r-h.length+d.err.line));if(n===!0)return Rt("InvalidXml","Multiple possible root nodes found.",he(s,r));t.unpairedTags.indexOf(l)!==-1||e.push({tagName:l,tagStartPos:o}),i=!0}for(r++;r<s.length;r++)if(s[r]==="<")if(s[r+1]==="!"){r++,r=Ic(s,r);continue}else if(s[r+1]==="?"){if(r=Oc(s,++r),r.err)return r}else break;else if(s[r]==="&"){const d=ug(s,r);if(d==-1)return Rt("InvalidChar","char '&' is not expected.",he(s,r));r=d}else if(n===!0&&!Pc(s[r]))return Rt("InvalidXml","Extra text at the end",he(s,r));s[r]==="<"&&r--}}else{if(Pc(s[r]))continue;return Rt("InvalidChar","char '"+s[r]+"' is not expected.",he(s,r))}if(i){if(e.length==1)return Rt("InvalidTag","Unclosed tag '"+e[0].tagName+"'.",he(s,e[0].tagStartPos));if(e.length>0)return Rt("InvalidXml","Invalid '"+JSON.stringify(e.map(r=>r.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Rt("InvalidXml","Start tag expected.",1);return!0};function Pc(s){return s===" "||s==="	"||s===`
`||s==="\r"}function Oc(s,t){const e=t;for(;t<s.length;t++)if(s[t]=="?"||s[t]==" "){const i=s.substr(e,t-e);if(t>5&&i==="xml")return Rt("InvalidXml","XML declaration allowed only at the start of the document.",he(s,t));if(s[t]=="?"&&s[t+1]==">"){t++;break}else continue}return t}function Ic(s,t){if(s.length>t+5&&s[t+1]==="-"&&s[t+2]==="-"){for(t+=3;t<s.length;t++)if(s[t]==="-"&&s[t+1]==="-"&&s[t+2]===">"){t+=2;break}}else if(s.length>t+8&&s[t+1]==="D"&&s[t+2]==="O"&&s[t+3]==="C"&&s[t+4]==="T"&&s[t+5]==="Y"&&s[t+6]==="P"&&s[t+7]==="E"){let e=1;for(t+=8;t<s.length;t++)if(s[t]==="<")e++;else if(s[t]===">"&&(e--,e===0))break}else if(s.length>t+9&&s[t+1]==="["&&s[t+2]==="C"&&s[t+3]==="D"&&s[t+4]==="A"&&s[t+5]==="T"&&s[t+6]==="A"&&s[t+7]==="["){for(t+=8;t<s.length;t++)if(s[t]==="]"&&s[t+1]==="]"&&s[t+2]===">"){t+=2;break}}return t}const ag='"',lg="'";function cg(s,t){let e="",i="",n=!1;for(;t<s.length;t++){if(s[t]===ag||s[t]===lg)i===""?i=s[t]:i!==s[t]||(i="");else if(s[t]===">"&&i===""){n=!0;break}e+=s[t]}return i!==""?!1:{value:e,index:t,tagClosed:n}}const hg=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function zc(s,t){const e=ql.getAllMatches(s,hg),i={};for(let n=0;n<e.length;n++){if(e[n][1].length===0)return Rt("InvalidAttr","Attribute '"+e[n][2]+"' has no space in starting.",wn(e[n]));if(e[n][3]!==void 0&&e[n][4]===void 0)return Rt("InvalidAttr","Attribute '"+e[n][2]+"' is without value.",wn(e[n]));if(e[n][3]===void 0&&!t.allowBooleanAttributes)return Rt("InvalidAttr","boolean attribute '"+e[n][2]+"' is not allowed.",wn(e[n]));const r=e[n][2];if(!pg(r))return Rt("InvalidAttr","Attribute '"+r+"' is an invalid name.",wn(e[n]));if(!i.hasOwnProperty(r))i[r]=1;else return Rt("InvalidAttr","Attribute '"+r+"' is repeated.",wn(e[n]))}return!0}function dg(s,t){let e=/\d/;for(s[t]==="x"&&(t++,e=/[\da-fA-F]/);t<s.length;t++){if(s[t]===";")return t;if(!s[t].match(e))break}return-1}function ug(s,t){if(t++,s[t]===";")return-1;if(s[t]==="#")return t++,dg(s,t);let e=0;for(;t<s.length;t++,e++)if(!(s[t].match(/\w/)&&e<20)){if(s[t]===";")break;return-1}return t}function Rt(s,t,e){return{err:{code:s,msg:t,line:e.line||e,col:e.col}}}function pg(s){return ql.isName(s)}function fg(s){return ql.isName(s)}function he(s,t){const e=s.substring(0,t).split(/\r?\n/);return{line:e.length,col:e[e.length-1].length+1}}function wn(s){return s.startIndex+s[1].length}var Wl={};const Gd={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(s,t){return t},attributeValueProcessor:function(s,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(s,t,e){return s}},mg=function(s){return Object.assign({},Gd,s)};Wl.buildOptions=mg;Wl.defaultOptions=Gd;let gg=class{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}};var bg=gg;const yg=Fo;function vg(s,t){const e={};if(s[t+3]==="O"&&s[t+4]==="C"&&s[t+5]==="T"&&s[t+6]==="Y"&&s[t+7]==="P"&&s[t+8]==="E"){t=t+9;let i=1,n=!1,r=!1,o="";for(;t<s.length;t++)if(s[t]==="<"&&!r){if(n&&xg(s,t))t+=7,[entityName,val,t]=_g(s,t+1),val.indexOf("&")===-1&&(e[Ag(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(n&&Cg(s,t))t+=8;else if(n&&Eg(s,t))t+=8;else if(n&&Sg(s,t))t+=9;else if(wg)r=!0;else throw new Error("Invalid DOCTYPE");i++,o=""}else if(s[t]===">"){if(r?s[t-1]==="-"&&s[t-2]==="-"&&(r=!1,i--):i--,i===0)break}else s[t]==="["?n=!0:o+=s[t];if(i!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:e,i:t}}function _g(s,t){let e="";for(;t<s.length&&s[t]!=="'"&&s[t]!=='"';t++)e+=s[t];if(e=e.trim(),e.indexOf(" ")!==-1)throw new Error("External entites are not supported");const i=s[t++];let n="";for(;t<s.length&&s[t]!==i;t++)n+=s[t];return[e,n,t]}function wg(s,t){return s[t+1]==="!"&&s[t+2]==="-"&&s[t+3]==="-"}function xg(s,t){return s[t+1]==="!"&&s[t+2]==="E"&&s[t+3]==="N"&&s[t+4]==="T"&&s[t+5]==="I"&&s[t+6]==="T"&&s[t+7]==="Y"}function Cg(s,t){return s[t+1]==="!"&&s[t+2]==="E"&&s[t+3]==="L"&&s[t+4]==="E"&&s[t+5]==="M"&&s[t+6]==="E"&&s[t+7]==="N"&&s[t+8]==="T"}function Eg(s,t){return s[t+1]==="!"&&s[t+2]==="A"&&s[t+3]==="T"&&s[t+4]==="T"&&s[t+5]==="L"&&s[t+6]==="I"&&s[t+7]==="S"&&s[t+8]==="T"}function Sg(s,t){return s[t+1]==="!"&&s[t+2]==="N"&&s[t+3]==="O"&&s[t+4]==="T"&&s[t+5]==="A"&&s[t+6]==="T"&&s[t+7]==="I"&&s[t+8]==="O"&&s[t+9]==="N"}function Ag(s){if(yg.isName(s))return s;throw new Error(`Invalid entity name ${s}`)}var $g=vg;const Tg=/^[-+]?0x[a-fA-F0-9]+$/,kg=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,Pg={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function Og(s,t={}){if(t=Object.assign({},Pg,t),!s||typeof s!="string")return s;let e=s.trim();if(t.skipLike!==void 0&&t.skipLike.test(e))return s;if(s==="0")return 0;if(t.hex&&Tg.test(e))return zg(e,16);if(e.search(/[eE]/)!==-1){const i=e.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(i){if(t.leadingZeros)e=(i[1]||"")+i[3];else if(!(i[2]==="0"&&i[3][0]==="."))return s;return t.eNotation?Number(e):s}else return s}else{const i=kg.exec(e);if(i){const n=i[1],r=i[2];let o=Ig(i[3]);if(!t.leadingZeros&&r.length>0&&n&&e[2]!=="."||!t.leadingZeros&&r.length>0&&!n&&e[1]!==".")return s;if(t.leadingZeros&&r===s)return 0;{const a=Number(e),l=""+a;return l.search(/[eE]/)!==-1?t.eNotation?a:s:e.indexOf(".")!==-1?l==="0"&&o===""||l===o||n&&l==="-"+o?a:s:r?o===l||n+o===l?a:s:e===l||e===n+l?a:s}}else return s}}function Ig(s){return s&&s.indexOf(".")!==-1&&(s=s.replace(/0+$/,""),s==="."?s="0":s[0]==="."?s="0"+s:s[s.length-1]==="."&&(s=s.substr(0,s.length-1))),s}function zg(s,t){if(parseInt)return parseInt(s,t);if(Number.parseInt)return Number.parseInt(s,t);if(window&&window.parseInt)return window.parseInt(s,t);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}var Dg=Og;const Qd=Fo,xn=bg,Mg=$g,Lg=Dg;let Bg=class{constructor(t){this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,i)=>String.fromCharCode(Number.parseInt(i,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,i)=>String.fromCharCode(Number.parseInt(i,16))}},this.addExternalEntities=Ng,this.parseXml=Hg,this.parseTextData=Ug,this.resolveNameSpace=Rg,this.buildAttributesMap=jg,this.isItStopNode=Yg,this.replaceEntitiesValue=qg,this.readStopNodeData=Xg,this.saveTextToParentTag=Wg,this.addChild=Vg}};function Ng(s){const t=Object.keys(s);for(let e=0;e<t.length;e++){const i=t[e];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:s[i]}}}function Ug(s,t,e,i,n,r,o){if(s!==void 0&&(this.options.trimValues&&!i&&(s=s.trim()),s.length>0)){o||(s=this.replaceEntitiesValue(s));const a=this.options.tagValueProcessor(t,s,e,n,r);return a==null?s:typeof a!=typeof s||a!==s?a:this.options.trimValues?Ka(s,this.options.parseTagValue,this.options.numberParseOptions):s.trim()===s?Ka(s,this.options.parseTagValue,this.options.numberParseOptions):s}}function Rg(s){if(this.options.removeNSPrefix){const t=s.split(":"),e=s.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(s=e+t[1])}return s}const Fg=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function jg(s,t,e){if(!this.options.ignoreAttributes&&typeof s=="string"){const i=Qd.getAllMatches(s,Fg),n=i.length,r={};for(let o=0;o<n;o++){const a=this.resolveNameSpace(i[o][1]);let l=i[o][4],c=this.options.attributeNamePrefix+a;if(a.length)if(this.options.transformAttributeName&&(c=this.options.transformAttributeName(c)),c==="__proto__"&&(c="#__proto__"),l!==void 0){this.options.trimValues&&(l=l.trim()),l=this.replaceEntitiesValue(l);const h=this.options.attributeValueProcessor(a,l,t);h==null?r[c]=l:typeof h!=typeof l||h!==l?r[c]=h:r[c]=Ka(l,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(r[c]=!0)}if(!Object.keys(r).length)return;if(this.options.attributesGroupName){const o={};return o[this.options.attributesGroupName]=r,o}return r}}const Hg=function(s){s=s.replace(/\r\n?/g,`
`);const t=new xn("!xml");let e=t,i="",n="";for(let r=0;r<s.length;r++)if(s[r]==="<")if(s[r+1]==="/"){const o=es(s,">",r,"Closing Tag is not closed.");let a=s.substring(r+2,o).trim();if(this.options.removeNSPrefix){const h=a.indexOf(":");h!==-1&&(a=a.substr(h+1))}this.options.transformTagName&&(a=this.options.transformTagName(a)),e&&(i=this.saveTextToParentTag(i,e,n));const l=n.substring(n.lastIndexOf(".")+1);if(a&&this.options.unpairedTags.indexOf(a)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${a}>`);let c=0;l&&this.options.unpairedTags.indexOf(l)!==-1?(c=n.lastIndexOf(".",n.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=n.lastIndexOf("."),n=n.substring(0,c),e=this.tagsNodeStack.pop(),i="",r=o}else if(s[r+1]==="?"){let o=Qa(s,r,!1,"?>");if(!o)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,e,n),!(this.options.ignoreDeclaration&&o.tagName==="?xml"||this.options.ignorePiTags)){const a=new xn(o.tagName);a.add(this.options.textNodeName,""),o.tagName!==o.tagExp&&o.attrExpPresent&&(a[":@"]=this.buildAttributesMap(o.tagExp,n,o.tagName)),this.addChild(e,a,n)}r=o.closeIndex+1}else if(s.substr(r+1,3)==="!--"){const o=es(s,"-->",r+4,"Comment is not closed.");if(this.options.commentPropName){const a=s.substring(r+4,o-2);i=this.saveTextToParentTag(i,e,n),e.add(this.options.commentPropName,[{[this.options.textNodeName]:a}])}r=o}else if(s.substr(r+1,2)==="!D"){const o=Mg(s,r);this.docTypeEntities=o.entities,r=o.i}else if(s.substr(r+1,2)==="!["){const o=es(s,"]]>",r,"CDATA is not closed.")-2,a=s.substring(r+9,o);i=this.saveTextToParentTag(i,e,n);let l=this.parseTextData(a,e.tagname,n,!0,!1,!0,!0);l==null&&(l=""),this.options.cdataPropName?e.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]):e.add(this.options.textNodeName,l),r=o+2}else{let o=Qa(s,r,this.options.removeNSPrefix),a=o.tagName;const l=o.rawTagName;let c=o.tagExp,h=o.attrExpPresent,d=o.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),e&&i&&e.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,e,n,!1));const p=e;if(p&&this.options.unpairedTags.indexOf(p.tagname)!==-1&&(e=this.tagsNodeStack.pop(),n=n.substring(0,n.lastIndexOf("."))),a!==t.tagname&&(n+=n?"."+a:a),this.isItStopNode(this.options.stopNodes,n,a)){let u="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)a[a.length-1]==="/"?(a=a.substr(0,a.length-1),n=n.substr(0,n.length-1),c=a):c=c.substr(0,c.length-1),r=o.closeIndex;else if(this.options.unpairedTags.indexOf(a)!==-1)r=o.closeIndex;else{const m=this.readStopNodeData(s,l,d+1);if(!m)throw new Error(`Unexpected end of ${l}`);r=m.i,u=m.tagContent}const g=new xn(a);a!==c&&h&&(g[":@"]=this.buildAttributesMap(c,n,a)),u&&(u=this.parseTextData(u,a,n,!0,h,!0,!0)),n=n.substr(0,n.lastIndexOf(".")),g.add(this.options.textNodeName,u),this.addChild(e,g,n)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){a[a.length-1]==="/"?(a=a.substr(0,a.length-1),n=n.substr(0,n.length-1),c=a):c=c.substr(0,c.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));const u=new xn(a);a!==c&&h&&(u[":@"]=this.buildAttributesMap(c,n,a)),this.addChild(e,u,n),n=n.substr(0,n.lastIndexOf("."))}else{const u=new xn(a);this.tagsNodeStack.push(e),a!==c&&h&&(u[":@"]=this.buildAttributesMap(c,n,a)),this.addChild(e,u,n),e=u}i="",r=d}}else i+=s[r];return t.child};function Vg(s,t,e){const i=this.options.updateTag(t.tagname,e,t[":@"]);i===!1||(typeof i=="string"&&(t.tagname=i),s.addChild(t))}const qg=function(s){if(this.options.processEntities){for(let t in this.docTypeEntities){const e=this.docTypeEntities[t];s=s.replace(e.regx,e.val)}for(let t in this.lastEntities){const e=this.lastEntities[t];s=s.replace(e.regex,e.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const e=this.htmlEntities[t];s=s.replace(e.regex,e.val)}s=s.replace(this.ampEntity.regex,this.ampEntity.val)}return s};function Wg(s,t,e,i){return s&&(i===void 0&&(i=Object.keys(t.child).length===0),s=this.parseTextData(s,t.tagname,e,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,i),s!==void 0&&s!==""&&t.add(this.options.textNodeName,s),s=""),s}function Yg(s,t,e){const i="*."+e;for(const n in s){const r=s[n];if(i===r||t===r)return!0}return!1}function Zg(s,t,e=">"){let i,n="";for(let r=t;r<s.length;r++){let o=s[r];if(i)o===i&&(i="");else if(o==='"'||o==="'")i=o;else if(o===e[0])if(e[1]){if(s[r+1]===e[1])return{data:n,index:r}}else return{data:n,index:r};else o==="	"&&(o=" ");n+=o}}function es(s,t,e,i){const n=s.indexOf(t,e);if(n===-1)throw new Error(i);return n+t.length-1}function Qa(s,t,e,i=">"){const n=Zg(s,t+1,i);if(!n)return;let r=n.data;const o=n.index,a=r.search(/\s/);let l=r,c=!0;a!==-1&&(l=r.substring(0,a),r=r.substring(a+1).trimStart());const h=l;if(e){const d=l.indexOf(":");d!==-1&&(l=l.substr(d+1),c=l!==n.data.substr(d+1))}return{tagName:l,tagExp:r,closeIndex:o,attrExpPresent:c,rawTagName:h}}function Xg(s,t,e){const i=e;let n=1;for(;e<s.length;e++)if(s[e]==="<")if(s[e+1]==="/"){const r=es(s,">",e,`${t} is not closed`);if(s.substring(e+2,r).trim()===t&&(n--,n===0))return{tagContent:s.substring(i,e),i:r};e=r}else if(s[e+1]==="?")e=es(s,"?>",e+1,"StopNode is not closed.");else if(s.substr(e+1,3)==="!--")e=es(s,"-->",e+3,"StopNode is not closed.");else if(s.substr(e+1,2)==="![")e=es(s,"]]>",e,"StopNode is not closed.")-2;else{const r=Qa(s,e,">");r&&((r&&r.tagName)===t&&r.tagExp[r.tagExp.length-1]!=="/"&&n++,e=r.closeIndex)}}function Ka(s,t,e){if(t&&typeof s=="string"){const i=s.trim();return i==="true"?!0:i==="false"?!1:Lg(s,e)}else return Qd.isExist(s)?s:""}var Gg=Bg,Kd={};function Qg(s,t){return Jd(s,t)}function Jd(s,t,e){let i;const n={};for(let r=0;r<s.length;r++){const o=s[r],a=Kg(o);let l="";if(e===void 0?l=a:l=e+"."+a,a===t.textNodeName)i===void 0?i=o[a]:i+=""+o[a];else{if(a===void 0)continue;if(o[a]){let c=Jd(o[a],t,l);const h=tb(c,t);o[":@"]?Jg(c,o[":@"],l,t):Object.keys(c).length===1&&c[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?c=c[t.textNodeName]:Object.keys(c).length===0&&(t.alwaysCreateTextNode?c[t.textNodeName]="":c=""),n[a]!==void 0&&n.hasOwnProperty(a)?(Array.isArray(n[a])||(n[a]=[n[a]]),n[a].push(c)):t.isArray(a,l,h)?n[a]=[c]:n[a]=c}}}return typeof i=="string"?i.length>0&&(n[t.textNodeName]=i):i!==void 0&&(n[t.textNodeName]=i),n}function Kg(s){const t=Object.keys(s);for(let e=0;e<t.length;e++){const i=t[e];if(i!==":@")return i}}function Jg(s,t,e,i){if(t){const n=Object.keys(t),r=n.length;for(let o=0;o<r;o++){const a=n[o];i.isArray(a,e+"."+a,!0,!0)?s[a]=[t[a]]:s[a]=t[a]}}}function tb(s,t){const{textNodeName:e}=t,i=Object.keys(s).length;return!!(i===0||i===1&&(s[e]||typeof s[e]=="boolean"||s[e]===0))}Kd.prettify=Qg;const{buildOptions:eb}=Wl,ib=Gg,{prettify:sb}=Kd,nb=Xd;let rb=class{constructor(t){this.externalEntities={},this.options=eb(t)}parse(t,e){if(typeof t!="string")if(t.toString)t=t.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(e){e===!0&&(e={});const r=nb.validate(t,e);if(r!==!0)throw Error(`${r.err.msg}:${r.err.line}:${r.err.col}`)}const i=new ib(this.options);i.addExternalEntities(this.externalEntities);const n=i.parseXml(t);return this.options.preserveOrder||n===void 0?n:sb(n,this.options)}addEntity(t,e){if(e.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(t.indexOf("&")!==-1||t.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(e==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=e}};var ob=rb;const ab=`
`;function lb(s,t){let e="";return t.format&&t.indentBy.length>0&&(e=ab),tu(s,t,"",e)}function tu(s,t,e,i){let n="",r=!1;for(let o=0;o<s.length;o++){const a=s[o],l=cb(a);if(l===void 0)continue;let c="";if(e.length===0?c=l:c=`${e}.${l}`,l===t.textNodeName){let g=a[l];hb(c,t)||(g=t.tagValueProcessor(l,g),g=eu(g,t)),r&&(n+=i),n+=g,r=!1;continue}else if(l===t.cdataPropName){r&&(n+=i),n+=`<![CDATA[${a[l][0][t.textNodeName]}]]>`,r=!1;continue}else if(l===t.commentPropName){n+=i+`<!--${a[l][0][t.textNodeName]}-->`,r=!0;continue}else if(l[0]==="?"){const g=Dc(a[":@"],t),m=l==="?xml"?"":i;let b=a[l][0][t.textNodeName];b=b.length!==0?" "+b:"",n+=m+`<${l}${b}${g}?>`,r=!0;continue}let h=i;h!==""&&(h+=t.indentBy);const d=Dc(a[":@"],t),p=i+`<${l}${d}`,u=tu(a[l],t,c,h);t.unpairedTags.indexOf(l)!==-1?t.suppressUnpairedNode?n+=p+">":n+=p+"/>":(!u||u.length===0)&&t.suppressEmptyNode?n+=p+"/>":u&&u.endsWith(">")?n+=p+`>${u}${i}</${l}>`:(n+=p+">",u&&i!==""&&(u.includes("/>")||u.includes("</"))?n+=i+t.indentBy+u+i:n+=u,n+=`</${l}>`),r=!0}return n}function cb(s){const t=Object.keys(s);for(let e=0;e<t.length;e++){const i=t[e];if(s.hasOwnProperty(i)&&i!==":@")return i}}function Dc(s,t){let e="";if(s&&!t.ignoreAttributes)for(let i in s){if(!s.hasOwnProperty(i))continue;let n=t.attributeValueProcessor(i,s[i]);n=eu(n,t),n===!0&&t.suppressBooleanAttributes?e+=` ${i.substr(t.attributeNamePrefix.length)}`:e+=` ${i.substr(t.attributeNamePrefix.length)}="${n}"`}return e}function hb(s,t){s=s.substr(0,s.length-t.textNodeName.length-1);let e=s.substr(s.lastIndexOf(".")+1);for(let i in t.stopNodes)if(t.stopNodes[i]===s||t.stopNodes[i]==="*."+e)return!0;return!1}function eu(s,t){if(s&&s.length>0&&t.processEntities)for(let e=0;e<t.entities.length;e++){const i=t.entities[e];s=s.replace(i.regex,i.val)}return s}var db=lb;const ub=db,pb={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(s,t){return t},attributeValueProcessor:function(s,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function ji(s){this.options=Object.assign({},pb,s),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=gb),this.processTextOrObjNode=fb,this.options.format?(this.indentate=mb,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}ji.prototype.build=function(s){return this.options.preserveOrder?ub(s,this.options):(Array.isArray(s)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(s={[this.options.arrayNodeName]:s}),this.j2x(s,0).val)};ji.prototype.j2x=function(s,t){let e="",i="";for(let n in s)if(Object.prototype.hasOwnProperty.call(s,n))if(typeof s[n]>"u")this.isAttribute(n)&&(i+="");else if(s[n]===null)this.isAttribute(n)?i+="":n[0]==="?"?i+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+n+"/"+this.tagEndChar;else if(s[n]instanceof Date)i+=this.buildTextValNode(s[n],n,"",t);else if(typeof s[n]!="object"){const r=this.isAttribute(n);if(r)e+=this.buildAttrPairStr(r,""+s[n]);else if(n===this.options.textNodeName){let o=this.options.tagValueProcessor(n,""+s[n]);i+=this.replaceEntitiesValue(o)}else i+=this.buildTextValNode(s[n],n,"",t)}else if(Array.isArray(s[n])){const r=s[n].length;let o="",a="";for(let l=0;l<r;l++){const c=s[n][l];if(!(typeof c>"u"))if(c===null)n[0]==="?"?i+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+n+"/"+this.tagEndChar;else if(typeof c=="object")if(this.options.oneListGroup){const h=this.j2x(c,t+1);o+=h.val,this.options.attributesGroupName&&c.hasOwnProperty(this.options.attributesGroupName)&&(a+=h.attrStr)}else o+=this.processTextOrObjNode(c,n,t);else if(this.options.oneListGroup){let h=this.options.tagValueProcessor(n,c);h=this.replaceEntitiesValue(h),o+=h}else o+=this.buildTextValNode(c,n,"",t)}this.options.oneListGroup&&(o=this.buildObjectNode(o,n,a,t)),i+=o}else if(this.options.attributesGroupName&&n===this.options.attributesGroupName){const r=Object.keys(s[n]),o=r.length;for(let a=0;a<o;a++)e+=this.buildAttrPairStr(r[a],""+s[n][r[a]])}else i+=this.processTextOrObjNode(s[n],n,t);return{attrStr:e,val:i}};ji.prototype.buildAttrPairStr=function(s,t){return t=this.options.attributeValueProcessor(s,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&t==="true"?" "+s:" "+s+'="'+t+'"'};function fb(s,t,e){const i=this.j2x(s,e+1);return s[this.options.textNodeName]!==void 0&&Object.keys(s).length===1?this.buildTextValNode(s[this.options.textNodeName],t,i.attrStr,e):this.buildObjectNode(i.val,t,i.attrStr,e)}ji.prototype.buildObjectNode=function(s,t,e,i){if(s==="")return t[0]==="?"?this.indentate(i)+"<"+t+e+"?"+this.tagEndChar:this.indentate(i)+"<"+t+e+this.closeTag(t)+this.tagEndChar;{let n="</"+t+this.tagEndChar,r="";return t[0]==="?"&&(r="?",n=""),(e||e==="")&&s.indexOf("<")===-1?this.indentate(i)+"<"+t+e+r+">"+s+n:this.options.commentPropName!==!1&&t===this.options.commentPropName&&r.length===0?this.indentate(i)+`<!--${s}-->`+this.newLine:this.indentate(i)+"<"+t+e+r+this.tagEndChar+s+this.indentate(i)+n}};ji.prototype.closeTag=function(s){let t="";return this.options.unpairedTags.indexOf(s)!==-1?this.options.suppressUnpairedNode||(t="/"):this.options.suppressEmptyNode?t="/":t=`></${s}`,t};ji.prototype.buildTextValNode=function(s,t,e,i){if(this.options.cdataPropName!==!1&&t===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${s}]]>`+this.newLine;if(this.options.commentPropName!==!1&&t===this.options.commentPropName)return this.indentate(i)+`<!--${s}-->`+this.newLine;if(t[0]==="?")return this.indentate(i)+"<"+t+e+"?"+this.tagEndChar;{let n=this.options.tagValueProcessor(t,s);return n=this.replaceEntitiesValue(n),n===""?this.indentate(i)+"<"+t+e+this.closeTag(t)+this.tagEndChar:this.indentate(i)+"<"+t+e+">"+n+"</"+t+this.tagEndChar}};ji.prototype.replaceEntitiesValue=function(s){if(s&&s.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const e=this.options.entities[t];s=s.replace(e.regex,e.val)}return s};function mb(s){return this.options.indentBy.repeat(s)}function gb(s){return s.startsWith(this.options.attributeNamePrefix)&&s!==this.options.textNodeName?s.substr(this.attrPrefixLen):!1}var bb=ji;const yb=ob,vb=bb;var jo={XMLParser:yb,XMLBuilder:vb};let Ho=class{};E(Ho,"parser",new jo.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));E(Ho,"builder",new jo.XMLBuilder({attributeNamePrefix:"$",ignoreAttributes:!1,suppressBooleanAttributes:!1}));let St=class ro{static join(t){const e={};for(const i of t)for(const n in i)if(!e[n])e[n]=new Set(i[n]);else for(const r of i[n])e[n].add(r);return e}static intersect(t){if(t.length===0)return{};let e=ro.clone(t[0]);for(let i=1;i<t.length;i++){const n=t[i],r={};for(const o in e)if(n[o]){const a=new Set;for(const l of e[o])n[o].has(l)&&a.add(l);a.size>0&&(r[o]=a)}e=r}return e}static clone(t){const e={};for(const i in t)e[i]=new Set(t[i]);return e}static remove(t,e,i=!1){i&&(t=ro.clone(t));for(const n in e)if(t[n]){for(const r of e[n])t[n].delete(r);t[n].size===0&&delete t[n]}}static add(t,e,i=!1){i&&(t=ro.clone(t));for(const n in e)if(!t[n])t[n]=new Set(e[n]);else for(const r of e[n])t[n].add(r)}static append(t,e,...i){let n=t[e];n||(n=new Set,t[e]=n);for(const r of i)n.add(r)}static isEqual(t,e){const i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(const r of i){if(!e[r]||t[r].size!==e[r].size)return!1;for(const o of t[r])if(!e[r].has(o))return!1}return!0}static isEmpty(t){return Object.values(t).reduce((e,i)=>e+i.size,0)===0}static toRaw(t){const e={};for(const i in t)e[i]=Array.from(t[i]);return e}static fromRaw(t){const e={};for(const i in t)e[i]=new Set(t[i]);return e}},Ys=class extends Map{constructor(t){super(t),E(this,"onItemSet",new K),E(this,"onItemUpdated",new K),E(this,"onItemDeleted",new K),E(this,"onCleared",new K),E(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}set(t,e){const i=this.has(t);if(!(this.guard??(()=>!0))(t,e))return this;const n=super.set(t,e);return i?(this.onItemUpdated||(this.onItemUpdated=new K),this.onItemUpdated.trigger({key:t,value:e})):(this.onItemSet||(this.onItemSet=new K),this.onItemSet.trigger({key:t,value:e})),n}add(t){const e=ie.create();return this.set(e,t),e}delete(t){const e=super.delete(t);return e&&this.onItemDeleted.trigger(t),e}dispose(){this.clear(),this.onItemSet.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}},da=class{static isEntry(t){return new Set(["Boolean","Color","Text","Number","Select","Vector3","TextSet","None"]).has(t.type)}static copySchema(t,e={}){for(const i in t){const n=t[i];this.isEntry(n)?e[i]=this.copyEntry(n):(e[i]={},this.copySchema(n,e[i]))}return e}static copyEntry(t){if(t.type==="Boolean"){const e=t;return{type:e.type,value:e.value}}if(t.type==="Color"){const e=t;return{type:e.type,value:e.value.clone()}}if(t.type==="Text"){const e=t;return{type:e.type,value:e.value}}if(t.type==="Number"){const e=t;return{type:e.type,value:e.value,min:e.min,max:e.max,interpolable:e.interpolable}}if(t.type==="Select"){const e=t;return{type:e.type,value:e.value,multiple:e.multiple,options:new Set(e.options)}}if(t.type==="Vector3"){const e=t;return{type:e.type,value:e.value.clone()}}if(t.type==="TextSet"){const e=t;return{type:e.type,value:new Set(e.value)}}if(t.type==="None"){const e=t;return{type:e.type,value:e.value}}throw new Error("Invalid entry!")}},_b=class{constructor(){E(this,"list",new Set)}add(t){for(const e of t)this.list.add(e)}remove(t){for(const e of t)this.list.delete(e)}set(t){for(const e of this.list)e.enabled=t}reset(){for(const t of this.list)t.reset()}},Vo=class{constructor(t,e,i,n){E(this,"_component"),E(this,"name"),E(this,"uuid"),this._component=t,this.name=i,this.uuid=n??ie.create(),e.get(Yl).list.set(this.uuid,this)}get controls(){return da.copySchema(this._config)}set(t){for(const e in t)if(e in this){const i=e;this[i]=t[e].value}}export(t=this._config,e={}){for(const i in t){const n=t[i];if(da.isEntry(n))if(n.type==="Color"){const{r,g:o,b:a}=n.value;e[i]={...n,value:{r,g:o,b:a}}}else if(n.type==="Vector3"){const{x:r,y:o,z:a}=n.value;e[i]={...n,value:{x:r,y:o,z:a}}}else if(n.type==="TextSet"){const r=Array.from(n.value);e[i]={...n,value:r}}else if(n.type==="Select"){const r=Array.from(n.options);e[i]={...n,options:r}}else e[i]={...n};else e[i]={},this.export(n,e[i])}return e}import(t,e={},i=!0){for(const n in t){const r=t[n];if(da.isEntry(r))if(r.type==="Color"){const{r:o,g:a,b:l}=r.value;e[n]={...r,value:new bt(o,a,l)}}else if(r.type==="Vector3"){const{x:o,y:a,z:l}=r.value;e[n]={...r,value:new M(o,a,l)}}else r.type==="TextSet"?e[n]={...r,value:new Set(r.value)}:r.type==="Select"?e[n]={...r,options:new Set(r.options)}:e[n]={...r};else e[n]={},this.import(r,e[n],!1)}i&&this.set(e)}};const iu=class su extends Tt{constructor(t){super(t),E(this,"list",new Ys),E(this,"enabled",!0),t.add(su.uuid,this)}};E(iu,"uuid","b8c764e0-6b24-4e77-9a32-35fa728ee5b4");let Yl=iu,wb=class{constructor(t){E(this,"_event"),E(this,"_position",new Vt),E(this,"onDisposed",new K),E(this,"updateMouseInfo",e=>{this._event=e}),this.dom=t,this.setupEvents(!0)}get position(){return this.updatePosition(!1),this._position.clone()}get rawPosition(){return this.updatePosition(!0),this._position.clone()}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}updatePosition(t){if(this._event){const e=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(e,this._event,t),this._position.y=this.getPositionY(e,this._event,t)}}getPositionY(t,e,i){const n=this.getDataObject(e);return i?n.clientY:-((n.clientY-t.top)/(t.bottom-t.top))*2+1}getPositionX(t,e,i){const n=this.getDataObject(e);return i?n.clientX:(n.clientX-t.left)/(t.right-t.left)*2-1}getDataObject(t){return t instanceof MouseEvent?t:t.touches[0]}setupEvents(t){t?(this.dom.addEventListener("pointermove",this.updateMouseInfo),this.dom.addEventListener("touchstart",this.updateMouseInfo)):(this.dom.removeEventListener("pointermove",this.updateMouseInfo),this.dom.removeEventListener("touchstart",this.updateMouseInfo))}};const nu=class ru extends Tt{constructor(t){super(t),E(this,"onDisposed",new K),E(this,"onBeforeDispose",new K),E(this,"onFragmentsLoaded",new K),E(this,"baseCoordinationModel",""),E(this,"baseCoordinationMatrix",new xt),E(this,"enabled",!0),E(this,"_core"),this.components.add(ru.uuid,this)}get initialized(){return!!this._core}get list(){return this.core.models.list}get core(){if(!this._core)throw new Error("FragmentsManager not initialized. Call init() first.");return this._core}get _hasCoordinationModel(){return this.baseCoordinationModel!==""}dispose(){this.onBeforeDispose.trigger(),this._core&&(this.core.dispose(),this._core=void 0),this.baseCoordinationModel="",this.onFragmentsLoaded.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}init(t){this._core=new ym(t),this.core.onModelLoaded.add(async()=>{if(this._hasCoordinationModel)return;const e=[...this.list.values()][0];e&&(this.baseCoordinationModel=e.modelId,this.baseCoordinationMatrix=await e.getCoordinationMatrix())}),this.list.onItemDeleted.add(()=>{this.list.size>0||(this.baseCoordinationModel="",this.baseCoordinationMatrix=new xt)})}async raycast(t){const e=[];for(const r of this.core.models.list.values())if(t.snappingClasses&&t.snappingClasses.length>0){const o=await r.raycastWithSnapping(t);if(o&&o.length>0)e.push(o[0]);else{const a=await r.raycast(t);a&&e.push(a)}}else{const o=await r.raycast(t);o&&e.push(o)}if(await Promise.all(e),e.length===0)return;let i=e[0],n=i.distance;for(let r=1;r<e.length;r++)e[r].distance<n&&(n=e[r].distance,i=e[r]);return i}async getPositions(t){const e=[],i=async(r,o)=>{const a=await r.getPositions(o);for(const l of a)e.push(l)},n=[];for(const r in t){const o=this.core.models.list.get(r);o&&n.push(i(o,Array.from(t[r])))}return await Promise.all(n),e}async getBBoxes(t){const e=[],i=async(r,o)=>{const a=await r.getBoxes(o);if(a)for(const l of a)e.push(l)},n=[];for(const r in t){const o=this.core.models.list.get(r);o&&n.push(i(o,Array.from(t[r])))}return await Promise.all(n),e}async highlight(t,e){await this.forEachModel(e,"highlight",t)}async getData(t,e){const i={};for(const[n,r]of Object.entries(t)){const o=this.list.get(n);if(!o)continue;const a=await o.getItemsData([...r],e);i[n]=a}return i}async resetHighlight(t){await this.forEachModel(t,"resetHighlight")}async forEachModel(t,e,...i){const n={};if(t)for(const o in t){const a=t[o];n[o]=Array.from(a)}else for(const o of this.core.models.list.keys())n[o]=void 0;const r=[];for(const o in n){const a=this.core.models.list.get(o);if(a){const l=n[o],c=a[e](l,...i);r.push(c)}}await Promise.all(r)}async guidsToModelIdMap(t){const e={};for(const[i,n]of this.list){const r=(await n.getLocalIdsByGuids([...t])).filter(o=>o!==null);e[i]=new Set(r)}return e}async modelIdMapToGuids(t){const e=[];for(const[i,n]of Object.entries(t)){const r=this.list.get(i);if(!r)continue;const o=(await r.getGuidsByLocalIds([...n])).filter(a=>a!==null);e.push(...o)}return e}applyBaseCoordinateSystem(t,e){const i=new xt;return e&&i.copy(e.clone()).invert(),i.multiply(this.baseCoordinationMatrix),t.applyMatrix4(i),i}};E(nu,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let ut=nu,xb=class{constructor(){E(this,"wasm",{path:"",absolute:!1,logLevel:Sm.LOG_LEVEL_OFF}),E(this,"webIfc",{COORDINATE_TO_ORIGIN:!0}),E(this,"autoSetWasm",!0),E(this,"customLocateFileHandler",null)}};const Cb=class Ja extends Tt{constructor(t){super(t),E(this,"onDisposed",new K),E(this,"onIfcStartedLoading",new K),E(this,"onSetup",new K),E(this,"settings",new xb),E(this,"webIfc",new Ac),E(this,"enabled",!0),this.components.add(Ja.uuid,this)}dispose(){this.webIfc=null,this.onDisposed.trigger(Ja.uuid),this.onDisposed.reset()}async setup(t){this.settings={...this.settings,...t},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(t,e,i,n){const r=this.components.get(ut);if(!r.initialized)throw new Error("You need to initialize fragments first.");this.settings.autoSetWasm&&await this.autoSetWasm(),r.core.settings.autoCoordinate=e;const o=new vm;o.wasm.path=this.settings.wasm.path,o.wasm.absolute=this.settings.wasm.absolute,o.webIfcSettings=this.settings.webIfc,n!=null&&n.instanceCallback&&n.instanceCallback(o);const a=await o.process({...n==null?void 0:n.processData,bytes:t});return await r.core.load(a,{modelId:i,userData:n==null?void 0:n.userData})}async readIfcFile(t){const{path:e,absolute:i,logLevel:n}=this.settings.wasm;return this.webIfc.SetWasmPath(e,i),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModel(t,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new Ac}async autoSetWasm(){const t=await fetch(`https://unpkg.com/@thatopen/components@${Tu.release}/package.json`);if(!t.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const e=await t.json();if(!("web-ifc"in e.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const i=e.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${i}/`,this.settings.wasm.absolute=!0}}};E(Cb,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");const ou=class au extends Tt{constructor(t){super(t),E(this,"enabled",!0),this.components.add(au.uuid,this)}async set(t,e){const i=this.components.get(ut),n=[];if(e)for(const[r,o]of Object.entries(e)){const a=i.list.get(r);a&&n.push(a.setVisible([...o],t))}else for(const r of i.list.values())n.push(r.setVisible(void 0,t));await Promise.all(n),await i.core.update(!0)}async isolate(t){await Promise.all([this.set(!1),this.set(!0,t)])}async toggle(t){const e=[],i=this.components.get(ut);for(const[n,r]of Object.entries(t)){const o=i.list.get(n);o&&e.push(o.toggleVisible([...r]))}await Promise.all(e),await i.core.update(!0)}async getVisibilityMap(t,e){const i=[],n=[],r=this.components.get(ut);if(e)for(const l of e){const c=r.list.get(l);c&&(i.push(c.modelId),n.push(c.getItemsByVisibility(t)))}else for(const l of r.list.values())i.push(l.modelId),n.push(l.getItemsByVisibility(t));const o=await Promise.all(n),a={};for(const[l,c]of i.entries())a[c]=o[l];return a}};E(ou,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");let Eb=ou;const lu=class tl extends Tt{constructor(t){super(t),E(this,"enabled",!0),E(this,"onDisposed",new K),E(this,"list",new Zt),this.components.add(tl.uuid,this)}dispose(t=!0){this.list.clear(),this.onDisposed.trigger(tl.uuid),t&&(this.onDisposed.reset(),this.list.eventsEnabled=!1,this.list.dispose())}get(){const t=new Ft;for(const e of this.list)t.union(e);return t}async addFromModelIdMap(t){const e=this.components.get(ut),i=new Ft;for(const[n,r]of Object.entries(t)){const o=e.list.get(n);if(!o)continue;const a=await o.getMergedBox([...r]);i.union(a)}this.list.add(i)}addFromModels(t){const e=this.components.get(ut);for(const[i,n]of e.list)t&&!t.some(r=>r.test(i))||this.list.add(n.box)}async getCenter(t){this.list.clear(),await this.addFromModelIdMap(t);const e=this.get();this.list.clear();const i=new M;return e.getCenter(i),i}async getCameraOrientation(t,e=1){const i=this.components.get(ut);this.list.clear();for(const[c,h]of i.list)this.list.add(h.box);const n=this.get();this.list.clear();const r=new M;n.getCenter(r);const o=new M;n.getSize(o);const a=Math.max(o.x,o.y,o.z)*e,l=new M;switch(t){case"front":l.set(r.x,r.y,r.z+a);break;case"back":l.set(r.x,r.y,r.z-a);break;case"left":l.set(r.x-a,r.y,r.z);break;case"right":l.set(r.x+a,r.y,r.z);break;case"top":l.set(r.x,r.y+a,r.z);break;case"bottom":l.set(r.x,r.y-a,r.z);break;default:l.set(r.x,r.y,r.z+a)}return{position:l,target:r}}};E(lu,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");let go=lu,Sb=class{constructor(t,e){E(this,"customData",{}),E(this,"_components"),E(this,"_queries",[]),E(this,"_aggregation","exclusive"),E(this,"result",null),E(this,"cache",!0),E(this,"serializeQueryParameters",i=>{var n;return{categories:(n=i.categories)==null?void 0:n.map(r=>r.source),attributes:i.attributes?{aggregation:i.attributes.aggregation,queries:i.attributes.queries.map(this.serializeAttributeQuery)}:void 0,relation:i.relation?{name:i.relation.name,query:i.relation.query?this.serializeQueryParameters(i.relation.query):void 0}:void 0}}),E(this,"deserializeQueryParameters",i=>{var n;return{categories:(n=i.categories)==null?void 0:n.map(r=>new RegExp(r)),attributes:i.attributes?{aggregation:i.attributes.aggregation,queries:i.attributes.queries.map(this.deserializeAttributeQuery)}:void 0,relation:i.relation?{name:i.relation.name,query:i.relation.query?this.deserializeQueryParameters(i.relation.query):void 0}:void 0}}),this._components=t,this.queries=e}set queries(t){this._queries=t,this.clearCache()}get queries(){return this._queries}set aggregation(t){t!==this._aggregation&&this.clearCache(),this._aggregation=t}get aggregation(){return this._aggregation}async test(t){const{modelIds:e,force:i}={force:!1,...t};if(this.result&&!i)return this.result;const n=await this._components.get(Hn).getItems(this.queries,{modelIds:e,aggregation:this.aggregation});return this.cache&&(this.result=n),n}clearCache(){this.result=null}serializeAttributeQuery(t){let e;return Array.isArray(t.value)?e=t.value.map(i=>i.source):t.value instanceof RegExp?e=t.value.source:e=t.value,{name:t.name.source,value:e,type:t.type instanceof RegExp?t.type.source:t.type,negate:t.negate,itemIds:t.itemIds}}toJSON(){return{name:this._components.get(Hn).list.getKey(this)??"Finder Query",customData:this.customData,queries:this.queries.map(this.serializeQueryParameters),aggregation:this.aggregation,cache:this.cache}}deserializeAttributeQuery(t){let e;return Array.isArray(t.value)?e=t.value.map(i=>new RegExp(i)):typeof t.value=="string"?e=new RegExp(t.value):e=t.value,{name:new RegExp(t.name),value:e,type:t.type?new RegExp(t.type):void 0,negate:t.negate,itemIds:t.itemIds}}fromJSON(t){return this.customData=t.customData,this.aggregation=t.aggregation,this.cache=t.cache,this.queries=t.queries.map(this.deserializeQueryParameters),this}};const cu=class hu extends Tt{constructor(t){super(t),E(this,"enabled",!0),E(this,"list",new Nt),t.add(hu.uuid,this)}async getItems(t,e){const{modelIds:i}=e??{},n=(e==null?void 0:e.aggregation)??"exclusive",r=this.components.get(ut),o=await Promise.all(t.map(async a=>{const l={};return await Promise.all(Array.from(r.list).map(async([c,h])=>{if(i&&!i.some(p=>p.test(c)))return;const d=await h.getItemsByQuery(a);l[c]=new Set(d)})),l}));return n==="inclusive"?St.join(o):St.intersect(o)}create(t,e){const i=new Sb(this.components,e);return this.list.set(t,i),i}async addFromCategories(t){const e=new Set,i=this.components.get(ut);for(const[n,r]of i.list){if(t&&!t.some(l=>l.test(n)))continue;const o=(await r.getItemsWithGeometryCategories()).filter(l=>l!==null),a=new Set(o);for(const l of a)this.list.has(l)||(this.create(l,[{categories:[new RegExp(`^${l}$`)]}]),e.add(l))}return[...e]}import(t){const{data:e}=t,i=[];if(!e)return i;for(const n of e){const{name:r,customData:o,queries:a,aggregation:l,cache:c}=n,h=this.create(r,[]);h.fromJSON({customData:o,queries:a,aggregation:l,cache:c}),i.push(h)}return i}export(){const t=[];for(const[e,i]of this.list.entries()){const n={...i.toJSON(),name:e};t.push(n)}return{data:t}}};E(cu,"uuid","0da7ad77-f734-42ca-942f-a074adfd1e3a");let Hn=cu;const du=class uu extends Tt{constructor(t){super(t),E(this,"enabled",!0),E(this,"onDisposed",new K),E(this,"list",new Nt),E(this,"defaultSaveFunction",e=>"value"in e.Name?e.Name.value:null),E(this,"onBeforeFragmentsDispose",async e=>{const{key:i,value:n}=e,r=await n.getLocalIds(),o={[i]:new Set(r)};this.removeItems(o)}),t.add(uu.uuid,this),this.setupEvents(),t.get(ut).list.onBeforeDelete.add(this.onBeforeFragmentsDispose)}setupEvents(){this.list.onBeforeDelete.add(({value:t})=>t.dispose())}getClassificationGroups(t){let e=this.list.get(t);return e||(e=new Nt,this.list.set(t,e)),e}getModelItems(t,e,i){const{map:n}=this.getGroupData(t,e);let r=n[i];return r||(r=new Set,n[i]=r),r}getGroupData(t,e){const i=this.components.get(Hn),n=this.getClassificationGroups(t);let r=n.get(e);return r||(r={map:{},get(){return new Promise(o=>{if(!r){o({});return}if(r.query){const{name:a,config:l}=r.query,c=i.list.get(a);if(!c)throw new Error("Classifier: the query name associated with the group doesn't exist in the ItemsFinder component");c.test(l).then(h=>{if(!r){o({});return}const d=St.join([h,r.map]);o(d)})}else o(r.map)})}},n.set(e,r)),r}async aggregateItems(t,e,i){const n=(i==null?void 0:i.data)??void 0,r=(i==null?void 0:i.aggregationCallback)??this.defaultSaveFunction,o=this.components.get(ut),a=await this.components.get(Hn).getItems([e],{modelIds:i==null?void 0:i.modelIds});for(const[l,c]of Object.entries(a)){const h=o.list.get(l);if(!h)continue;const d=(u,...g)=>{const m=this.getModelItems(t,u,l);for(const b of g)m.add(b)},p=await h.getItemsData([...c],n);for(const u of p)r(u,d)}}addGroupItems(t,e,i){const{map:n}=this.getGroupData(t,e);St.add(n,i)}setGroupQuery(t,e,i){const n=this.getGroupData(t,e);n.query=i}async find(t){const e=[];for(const[i,n]of Object.entries(t)){const r=[],o=this.list.get(i);if(!o)continue;for(const l of n){const c=o.get(l);if(!c)continue;const h=await c.get();r.push(h)}const a=St.join(r);e.push(a)}return St.intersect(e)}async aggregateItemRelations(t,e,i,n){const r=(n==null?void 0:n.attribute)??"Name",o={relations:{[i]:{attributes:!0,relations:!1}}};await this.aggregateItems(t,e,{modelIds:n==null?void 0:n.modelIds,data:o,aggregationCallback:(a,l)=>{if(!(a!=null&&a[r]))return;const c=a[r];if(!("value"in c))return;const h=a[i];if(Array.isArray(h))for(const d of h)"value"in d._localId&&l(c.value,d._localId.value)}})}async byIfcBuildingStorey(t){await this.aggregateItemRelations((t==null?void 0:t.classificationName)??"Storeys",{categories:[/BUILDINGSTOREY/]},"ContainsElements",{modelIds:t==null?void 0:t.modelIds})}async byCategory(t){const e=await this.components.get(Hn).addFromCategories(t==null?void 0:t.modelIds);for(const i of e)this.setGroupQuery((t==null?void 0:t.classificationName)??"Categories",i,{name:i})}dispose(){this.list.clear(),this.components.get(ut).list.onBeforeDelete.remove(this.onBeforeFragmentsDispose),this.onDisposed.trigger()}removeItems(t,e){if(e&&e.classificationName){const i=this.list.get(e.classificationName);if(!i||e.groupName&&!i.get(e.groupName))return;for(const[,n]of i)St.remove(n.map,t);return}for(const[,i]of this.list.entries())for(const[,n]of i)St.remove(n.map,t)}async byModel(t){const e=this.components.get(ut),i=(t==null?void 0:t.classificationName)??"Models";for(const[n,r]of e.list){if(t&&t.modelIds&&!t.modelIds.some(l=>l.test(n)))continue;const o=await r.getItemsIdsWithGeometry(),a={[n]:new Set(o)};this.getGroupData(i,n),this.addGroupItems(i,n,a)}}};E(du,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");let Ab=du;class $b{constructor(t,e){E(this,"enabled",!0),E(this,"components"),E(this,"onDisposed",new K),E(this,"mouse"),E(this,"three",new Nl),E(this,"world");const i=e.renderer;if(!i)throw new Error("A renderer is needed for the raycaster to work!");this.world=e,this.mouse=new wb(i.three.domElement),this.components=t}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRayToObjects(t=Array.from(this.world.meshes),e=this.mouse.position){if(!this.world)throw new Error("A world is needed to cast rays!");const i=this.world.camera.three;return this.three.setFromCamera(e,i),this.intersect(t)}async castRay(t){const e=t==null?void 0:t.snappingClasses,i=(t==null?void 0:t.items)??Array.from(this.world.meshes),n=(t==null?void 0:t.position)??this.mouse.position;if(!this.world)throw new Error("A world is needed to cast rays!");const r=this.world.camera.three,o=this.components.get(ut),a=this.world.renderer.three.domElement,l=this.mouse.rawPosition;let c=null;if(o.initialized&&(c=await o.raycast({camera:r,dom:a,mouse:l,snappingClasses:e}),i.length===0))return c;this.three.setFromCamera(n,r);const h=this.intersect(i);return c?h&&h.distance<c.distance?h:c:h}intersect(t=Array.from(this.world.meshes)){const e=this.three.intersectObjects(t),i=this.filterClippingPlanes(e);return i.length>0?i[0]:null}filterClippingPlanes(t){if(!this.world.renderer)throw new Error("Renderer not found!");const e=this.world.renderer.three;if(!e.clippingPlanes)return t;const i=e.clippingPlanes;return t.length<=0||!i||(i==null?void 0:i.length)<=0?t:t.filter(n=>i.every(r=>r.distanceToPoint(n.point)>0))}}const pu=class fu extends Tt{constructor(t){super(t),E(this,"enabled",!0),E(this,"list",new Map),E(this,"onDisposed",new K),t.add(fu.uuid,this)}get(t){if(this.list.has(t.uuid))return this.list.get(t.uuid);const e=new $b(this.components,t);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}};E(pu,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let fe=pu;class Tb extends Hl{constructor(){super(...arguments),E(this,"onCameraChanged",new K),E(this,"meshes",new Set),E(this,"onAfterUpdate",new K),E(this,"onBeforeUpdate",new K),E(this,"onDisposed",new K),E(this,"isDisposing",!1),E(this,"enabled",!0),E(this,"_dynamicAnchor",!1),E(this,"uuid",ie.create()),E(this,"name"),E(this,"_scene"),E(this,"_camera"),E(this,"_renderer",null),E(this,"onPointerDown",async t=>{if(!this.camera.hasCameraControls())throw new Error("World: can't set dynamic anchor if the camera doesn't have controls.");const e=await this.components.get(fe).get(this).castRay();e&&e.point&&t.button===0&&this.camera.controls.setOrbitPoint(e.point.x,e.point.y,e.point.z)}),E(this,"_defaultCamera")}set dynamicAnchor(t){var e;const i=(e=this.renderer)==null?void 0:e.three.domElement.parentElement;if(!i)throw new Error("World: the renderer must have a parentElement to set dynamic anchoring.");t?(this.camera.controls&&(this.camera.controls.minDistance=.01),i.addEventListener("pointerdown",this.onPointerDown)):i.removeEventListener("pointerdown",this.onPointerDown)}get dynamicAnchor(){return this._dynamicAnchor}get defaultCamera(){if(!this._defaultCamera)throw new Error("World: there is no default camera defined.");return this._defaultCamera}set defaultCamera(t){this._defaultCamera=t}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(t){this._scene=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(t){this._camera||(this.defaultCamera=t),this._camera=t,t.currentWorld=this,this.onCameraChanged.trigger(t)}get renderer(){return this._renderer}set renderer(t){this._renderer=t,t&&(t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"}))}useDefaultCamera(){this.camera=this.defaultCamera}update(t){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(t),this.camera.isUpdateable()&&this.camera.update(t),this.renderer&&this.renderer.update(t),this.onAfterUpdate.trigger()))}dispose(t=!0){if(this.enabled=!1,this.isDisposing=!0,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),t){const e=this.components.get(si);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const i of this.meshes)e.destroy(i);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.components.get(vu).list.delete(this.uuid),this.onDisposed.trigger(),this.onDisposed.reset()}}class kb extends ng{constructor(t,e,i){super(t),E(this,"enabled",!0),E(this,"container"),E(this,"three"),E(this,"_canvas"),E(this,"_parameters"),E(this,"_resizeObserver",null),E(this,"onContainerUpdated",new K),E(this,"_resizing",!1),E(this,"resize",o=>{if(this._resizing)return;this._resizing=!0,this.onContainerUpdated.trigger();const a=o?o.x:this.container.clientWidth,l=o?o.y:this.container.clientHeight;this.three.setSize(a,l),this.onResize.trigger(new Vt(a,l)),this._resizing=!1}),E(this,"resizeEvent",()=>{this.resize()}),E(this,"onContextLost",o=>{o.preventDefault(),this.enabled=!1}),E(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new kc({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0}),this.container=e,this._parameters=i,this.three=new kc({antialias:!0,alpha:!0,...i}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const n=this.three.getContext(),{canvas:r}=n;r.addEventListener("webglcontextlost",this.onContextLost,!1),r.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const t=this.currentWorld.scene.three,e=this.currentWorld.camera.three;this.three.render(t,e),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.forceContextLoss(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new Vt(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(t){const e=this.three.domElement.parentElement;if(!e)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),t&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(e),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Mt={LEFT:1,RIGHT:2,MIDDLE:4},F=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),vs={NONE:0,IN:1,OUT:-1};function Zi(s){return s.isPerspectiveCamera}function Ei(s){return s.isOrthographicCamera}const _s=Math.PI*2,Mc=Math.PI/2,mu=1e-5,Cn=Math.PI/180;function Ue(s,t,e){return Math.max(t,Math.min(e,s))}function Ot(s,t=mu){return Math.abs(s)<t}function wt(s,t,e=mu){return Ot(s-t,e)}function Lc(s,t){return Math.round(s/t)*t}function En(s){return isFinite(s)?s:s<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Sn(s){return Math.abs(s)<Number.MAX_VALUE?s:s*(1/0)}function kr(s,t,e,i,n=1/0,r){i=Math.max(1e-4,i);const o=2/i,a=o*r,l=1/(1+a+.48*a*a+.235*a*a*a);let c=s-t;const h=t,d=n*i;c=Ue(c,-d,d),t=s-c;const p=(e.value+o*c)*r;e.value=(e.value-o*p)*l;let u=t+(c+p)*l;return h-s>0==u>h&&(u=h,e.value=(u-h)/r),u}function Bc(s,t,e,i,n=1/0,r,o){i=Math.max(1e-4,i);const a=2/i,l=a*r,c=1/(1+l+.48*l*l+.235*l*l*l);let h=t.x,d=t.y,p=t.z,u=s.x-h,g=s.y-d,m=s.z-p;const b=h,f=d,y=p,_=n*i,x=_*_,C=u*u+g*g+m*m;if(C>x){const L=Math.sqrt(C);u=u/L*_,g=g/L*_,m=m/L*_}h=s.x-u,d=s.y-g,p=s.z-m;const S=(e.x+a*u)*r,$=(e.y+a*g)*r,O=(e.z+a*m)*r;e.x=(e.x-a*S)*c,e.y=(e.y-a*$)*c,e.z=(e.z-a*O)*c,o.x=h+(u+S)*c,o.y=d+(g+$)*c,o.z=p+(m+O)*c;const z=b-s.x,D=f-s.y,j=y-s.z,A=o.x-b,k=o.y-f,v=o.z-y;return z*A+D*k+j*v>0&&(o.x=b,o.y=f,o.z=y,e.x=(o.x-b)/r,e.y=(o.y-f)/r,e.z=(o.z-y)/r),o}function ua(s,t){t.set(0,0),s.forEach(e=>{t.x+=e.clientX,t.y+=e.clientY}),t.x/=s.length,t.y/=s.length}function pa(s,t){return Ei(s)?(console.warn(`${t} is not supported in OrthographicCamera`),!0):!1}class Pb{constructor(){this._listeners={}}addEventListener(t,e){const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){const i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){const i=this._listeners[t];if(i!==void 0){const n=i.indexOf(e);n!==-1&&i.splice(n,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){const e=this._listeners[t.type];if(e!==void 0){t.target=this;const i=e.slice(0);for(let n=0,r=i.length;n<r;n++)i[n].call(this,t)}}}var fa;const Ob="2.10.1",Pr=1/8,Ib=/Mac/.test((fa=globalThis==null?void 0:globalThis.navigator)===null||fa===void 0?void 0:fa.platform);let dt,Nc,Or,ma,pe,gt,vt,ws,An,Ge,Qe,Xi,Uc,Rc,$e,$n,xs,Fc,ga,jc,ba,ya,Ir,ve=class el extends Pb{static install(t){dt=t.THREE,Nc=Object.freeze(new dt.Vector3(0,0,0)),Or=Object.freeze(new dt.Vector3(0,1,0)),ma=Object.freeze(new dt.Vector3(0,0,1)),pe=new dt.Vector2,gt=new dt.Vector3,vt=new dt.Vector3,ws=new dt.Vector3,An=new dt.Vector3,Ge=new dt.Vector3,Qe=new dt.Vector3,Xi=new dt.Vector3,Uc=new dt.Vector3,Rc=new dt.Vector3,$e=new dt.Spherical,$n=new dt.Spherical,xs=new dt.Box3,Fc=new dt.Box3,ga=new dt.Sphere,jc=new dt.Quaternion,ba=new dt.Quaternion,ya=new dt.Matrix4,Ir=new dt.Raycaster}static get ACTION(){return F}set verticalDragToForward(t){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(t,e){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=F.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=vs.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new dt.Vector3,this._focalOffsetVelocity=new dt.Vector3,this._zoomVelocity={value:0},this._truckInternal=(f,y,_,x)=>{let C,S;if(Zi(this._camera)){const $=gt.copy(this._camera.position).sub(this._target),O=this._camera.getEffectiveFOV()*Cn,z=$.length()*Math.tan(O*.5);C=this.truckSpeed*f*z/this._elementRect.height,S=this.truckSpeed*y*z/this._elementRect.height}else if(Ei(this._camera)){const $=this._camera;C=this.truckSpeed*f*($.right-$.left)/$.zoom/this._elementRect.width,S=this.truckSpeed*y*($.top-$.bottom)/$.zoom/this._elementRect.height}else return;x?(_?this.setFocalOffset(this._focalOffsetEnd.x+C,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(C,0,!0),this.forward(-S,!0)):_?this.setFocalOffset(this._focalOffsetEnd.x+C,this._focalOffsetEnd.y+S,this._focalOffsetEnd.z,!0):this.truck(C,S,!0)},this._rotateInternal=(f,y)=>{const _=_s*this.azimuthRotateSpeed*f/this._elementRect.height,x=_s*this.polarRotateSpeed*y/this._elementRect.height;this.rotate(_,x,!0)},this._dollyInternal=(f,y,_)=>{const x=Math.pow(.95,-f*this.dollySpeed),C=this._sphericalEnd.radius,S=this._sphericalEnd.radius*x,$=Ue(S,this.minDistance,this.maxDistance),O=$-S;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(S,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(O,!0),this._dollyToNoClamp($,!0)):this._dollyToNoClamp($,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?S:$)-C,this._dollyControlCoord.set(y,_)),this._lastDollyDirection=Math.sign(-f)},this._zoomInternal=(f,y,_)=>{const x=Math.pow(.95,f*this.dollySpeed),C=this._zoom,S=this._zoom*x;this.zoomTo(S,!0),this.dollyToCursor&&(this._changedZoom+=S-C,this._dollyControlCoord.set(y,_))},typeof dt>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new dt.Quaternion().setFromUnitVectors(this._camera.up,Or),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=F.NONE,this._target=new dt.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new dt.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new dt.Spherical().setFromVector3(gt.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new dt.Vector3,new dt.Vector3,new dt.Vector3,new dt.Vector3],this._updateNearPlaneCorners(),this._boundary=new dt.Box3(new dt.Vector3(-1/0,-1/0,-1/0),new dt.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new dt.Vector2,this.mouseButtons={left:F.ROTATE,middle:F.DOLLY,right:F.TRUCK,wheel:Zi(this._camera)?F.DOLLY:Ei(this._camera)?F.ZOOM:F.NONE},this.touches={one:F.TOUCH_ROTATE,two:Zi(this._camera)?F.TOUCH_DOLLY_TRUCK:Ei(this._camera)?F.TOUCH_ZOOM_TRUCK:F.NONE,three:F.TOUCH_TRUCK};const i=new dt.Vector2,n=new dt.Vector2,r=new dt.Vector2,o=f=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const x=this._domElement.getBoundingClientRect(),C=f.clientX/x.width,S=f.clientY/x.height;if(C<this._interactiveArea.left||C>this._interactiveArea.right||S<this._interactiveArea.top||S>this._interactiveArea.bottom)return}const y=f.pointerType!=="mouse"?null:(f.buttons&Mt.LEFT)===Mt.LEFT?Mt.LEFT:(f.buttons&Mt.MIDDLE)===Mt.MIDDLE?Mt.MIDDLE:(f.buttons&Mt.RIGHT)===Mt.RIGHT?Mt.RIGHT:null;if(y!==null){const x=this._findPointerByMouseButton(y);x&&this._disposePointer(x)}if((f.buttons&Mt.LEFT)===Mt.LEFT&&this._lockedPointer)return;const _={pointerId:f.pointerId,clientX:f.clientX,clientY:f.clientY,deltaX:0,deltaY:0,mouseButton:y};this._activePointers.push(_),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,p(f)},a=f=>{f.cancelable&&f.preventDefault();const y=f.pointerId,_=this._lockedPointer||this._findPointerById(y);if(_){if(_.clientX=f.clientX,_.clientY=f.clientY,_.deltaX=f.movementX,_.deltaY=f.movementY,this._state=0,f.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(f.buttons&Mt.LEFT)===Mt.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(f.buttons&Mt.MIDDLE)===Mt.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(f.buttons&Mt.RIGHT)===Mt.RIGHT&&(this._state=this._state|this.mouseButtons.right);u()}},l=f=>{const y=this._findPointerById(f.pointerId);if(!(y&&y===this._lockedPointer)){if(y&&this._disposePointer(y),f.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=F.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=F.NONE;g()}};let c=-1;const h=f=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===F.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const S=this._domElement.getBoundingClientRect(),$=f.clientX/S.width,O=f.clientY/S.height;if($<this._interactiveArea.left||$>this._interactiveArea.right||O<this._interactiveArea.top||O>this._interactiveArea.bottom)return}if(f.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===F.ROTATE||this.mouseButtons.wheel===F.TRUCK){const S=performance.now();c-S<1e3&&this._getClientRect(this._elementRect),c=S}const y=Ib?-1:-3,_=f.deltaMode===1||f.ctrlKey?f.deltaY/y:f.deltaY/(y*10),x=this.dollyToCursor?(f.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,C=this.dollyToCursor?(f.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case F.ROTATE:{this._rotateInternal(f.deltaX,f.deltaY),this._isUserControllingRotate=!0;break}case F.TRUCK:{this._truckInternal(f.deltaX,f.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case F.SCREEN_PAN:{this._truckInternal(f.deltaX,f.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case F.OFFSET:{this._truckInternal(f.deltaX,f.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case F.DOLLY:{this._dollyInternal(-_,x,C),this._isUserControllingDolly=!0;break}case F.ZOOM:{this._zoomInternal(-_,x,C),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},d=f=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===el.ACTION.NONE){const y=f instanceof PointerEvent?f.pointerId:0,_=this._findPointerById(y);_&&this._disposePointer(_),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l);return}f.preventDefault()}},p=f=>{if(this._enabled){if(ua(this._activePointers,pe),this._getClientRect(this._elementRect),i.copy(pe),n.copy(pe),this._activePointers.length>=2){const y=pe.x-this._activePointers[1].clientX,_=pe.y-this._activePointers[1].clientY,x=Math.sqrt(y*y+_*_);r.set(0,x);const C=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,S=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;n.set(C,S)}if(this._state=0,!f)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in f&&f.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(f.buttons&Mt.LEFT)===Mt.LEFT&&(this._state=this._state|this.mouseButtons.left),(f.buttons&Mt.MIDDLE)===Mt.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(f.buttons&Mt.RIGHT)===Mt.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&F.ROTATE)===F.ROTATE||(this._state&F.TOUCH_ROTATE)===F.TOUCH_ROTATE||(this._state&F.TOUCH_DOLLY_ROTATE)===F.TOUCH_DOLLY_ROTATE||(this._state&F.TOUCH_ZOOM_ROTATE)===F.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&F.TRUCK)===F.TRUCK||(this._state&F.SCREEN_PAN)===F.SCREEN_PAN||(this._state&F.TOUCH_TRUCK)===F.TOUCH_TRUCK||(this._state&F.TOUCH_SCREEN_PAN)===F.TOUCH_SCREEN_PAN||(this._state&F.TOUCH_DOLLY_TRUCK)===F.TOUCH_DOLLY_TRUCK||(this._state&F.TOUCH_DOLLY_SCREEN_PAN)===F.TOUCH_DOLLY_SCREEN_PAN||(this._state&F.TOUCH_ZOOM_TRUCK)===F.TOUCH_ZOOM_TRUCK||(this._state&F.TOUCH_ZOOM_SCREEN_PAN)===F.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&F.DOLLY)===F.DOLLY||(this._state&F.TOUCH_DOLLY)===F.TOUCH_DOLLY||(this._state&F.TOUCH_DOLLY_TRUCK)===F.TOUCH_DOLLY_TRUCK||(this._state&F.TOUCH_DOLLY_SCREEN_PAN)===F.TOUCH_DOLLY_SCREEN_PAN||(this._state&F.TOUCH_DOLLY_OFFSET)===F.TOUCH_DOLLY_OFFSET||(this._state&F.TOUCH_DOLLY_ROTATE)===F.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&F.ZOOM)===F.ZOOM||(this._state&F.TOUCH_ZOOM)===F.TOUCH_ZOOM||(this._state&F.TOUCH_ZOOM_TRUCK)===F.TOUCH_ZOOM_TRUCK||(this._state&F.TOUCH_ZOOM_SCREEN_PAN)===F.TOUCH_ZOOM_SCREEN_PAN||(this._state&F.TOUCH_ZOOM_OFFSET)===F.TOUCH_ZOOM_OFFSET||(this._state&F.TOUCH_ZOOM_ROTATE)===F.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&F.OFFSET)===F.OFFSET||(this._state&F.TOUCH_OFFSET)===F.TOUCH_OFFSET||(this._state&F.TOUCH_DOLLY_OFFSET)===F.TOUCH_DOLLY_OFFSET||(this._state&F.TOUCH_ZOOM_OFFSET)===F.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},u=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,ua(this._activePointers,pe);const f=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,y=f?-f.deltaX:n.x-pe.x,_=f?-f.deltaY:n.y-pe.y;if(n.copy(pe),((this._state&F.ROTATE)===F.ROTATE||(this._state&F.TOUCH_ROTATE)===F.TOUCH_ROTATE||(this._state&F.TOUCH_DOLLY_ROTATE)===F.TOUCH_DOLLY_ROTATE||(this._state&F.TOUCH_ZOOM_ROTATE)===F.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(y,_),this._isUserControllingRotate=!0),(this._state&F.DOLLY)===F.DOLLY||(this._state&F.ZOOM)===F.ZOOM){const x=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,C=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0,S=this.dollyDragInverted?-1:1;(this._state&F.DOLLY)===F.DOLLY?(this._dollyInternal(S*_*Pr,x,C),this._isUserControllingDolly=!0):(this._zoomInternal(S*_*Pr,x,C),this._isUserControllingZoom=!0)}if((this._state&F.TOUCH_DOLLY)===F.TOUCH_DOLLY||(this._state&F.TOUCH_ZOOM)===F.TOUCH_ZOOM||(this._state&F.TOUCH_DOLLY_TRUCK)===F.TOUCH_DOLLY_TRUCK||(this._state&F.TOUCH_ZOOM_TRUCK)===F.TOUCH_ZOOM_TRUCK||(this._state&F.TOUCH_DOLLY_SCREEN_PAN)===F.TOUCH_DOLLY_SCREEN_PAN||(this._state&F.TOUCH_ZOOM_SCREEN_PAN)===F.TOUCH_ZOOM_SCREEN_PAN||(this._state&F.TOUCH_DOLLY_OFFSET)===F.TOUCH_DOLLY_OFFSET||(this._state&F.TOUCH_ZOOM_OFFSET)===F.TOUCH_ZOOM_OFFSET||(this._state&F.TOUCH_DOLLY_ROTATE)===F.TOUCH_DOLLY_ROTATE||(this._state&F.TOUCH_ZOOM_ROTATE)===F.TOUCH_ZOOM_ROTATE){const x=pe.x-this._activePointers[1].clientX,C=pe.y-this._activePointers[1].clientY,S=Math.sqrt(x*x+C*C),$=r.y-S;r.set(0,S);const O=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,z=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&F.TOUCH_DOLLY)===F.TOUCH_DOLLY||(this._state&F.TOUCH_DOLLY_ROTATE)===F.TOUCH_DOLLY_ROTATE||(this._state&F.TOUCH_DOLLY_TRUCK)===F.TOUCH_DOLLY_TRUCK||(this._state&F.TOUCH_DOLLY_SCREEN_PAN)===F.TOUCH_DOLLY_SCREEN_PAN||(this._state&F.TOUCH_DOLLY_OFFSET)===F.TOUCH_DOLLY_OFFSET?(this._dollyInternal($*Pr,O,z),this._isUserControllingDolly=!0):(this._zoomInternal($*Pr,O,z),this._isUserControllingZoom=!0)}((this._state&F.TRUCK)===F.TRUCK||(this._state&F.TOUCH_TRUCK)===F.TOUCH_TRUCK||(this._state&F.TOUCH_DOLLY_TRUCK)===F.TOUCH_DOLLY_TRUCK||(this._state&F.TOUCH_ZOOM_TRUCK)===F.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(y,_,!1,!1),this._isUserControllingTruck=!0),((this._state&F.SCREEN_PAN)===F.SCREEN_PAN||(this._state&F.TOUCH_SCREEN_PAN)===F.TOUCH_SCREEN_PAN||(this._state&F.TOUCH_DOLLY_SCREEN_PAN)===F.TOUCH_DOLLY_SCREEN_PAN||(this._state&F.TOUCH_ZOOM_SCREEN_PAN)===F.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(y,_,!1,!0),this._isUserControllingTruck=!0),((this._state&F.OFFSET)===F.OFFSET||(this._state&F.TOUCH_OFFSET)===F.TOUCH_OFFSET||(this._state&F.TOUCH_DOLLY_OFFSET)===F.TOUCH_DOLLY_OFFSET||(this._state&F.TOUCH_ZOOM_OFFSET)===F.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(y,_,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},g=()=>{ua(this._activePointers,pe),n.copy(pe),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",m),this._domElement.ownerDocument.addEventListener("pointerlockerror",b),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),p())},this.unlockPointer=()=>{var f,y,_;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(f=this._domElement)===null||f===void 0||f.ownerDocument.exitPointerLock(),(y=this._domElement)===null||y===void 0||y.ownerDocument.removeEventListener("pointerlockchange",m),(_=this._domElement)===null||_===void 0||_.ownerDocument.removeEventListener("pointerlockerror",b),this.cancel()};const m=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},b=()=>{this.unlockPointer()};this._addAllEventListeners=f=>{this._domElement=f,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",h,{passive:!1}),this._domElement.addEventListener("contextmenu",d)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",h,{passive:!1}),this._domElement.removeEventListener("contextmenu",d),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",m),this._domElement.ownerDocument.removeEventListener("pointerlockerror",b))},this.cancel=()=>{this._state!==F.NONE&&(this._state=F.NONE,this._activePointers.length=0,g())},e&&this.connect(e),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=Ue(t.width,0,1),this._interactiveArea.height=Ue(t.height,0,1),this._interactiveArea.x=Ue(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Ue(t.y,0,1-this._interactiveArea.height)}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,i=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,i=!1){this._isUserControllingRotate=!1;const n=Ue(t,this.minAzimuthAngle,this.maxAzimuthAngle),r=Ue(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=n,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!i||wt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&wt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=vs.NONE,this._changedDolly=0,this._dollyToNoClamp(Ue(t,this.minDistance,this.maxDistance),e)}_dollyToNoClamp(t,e=!1){const i=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const r=this._collisionTest(),o=wt(r,this._spherical.radius);if(!(i>t)&&o)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,r)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);const n=!e||wt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(n)}dollyInFixed(t,e=!1){this._targetEnd.add(this._getCameraDirection(An).multiplyScalar(t)),e||this._target.copy(this._targetEnd);const i=!e||wt(this._target.x,this._targetEnd.x,this.restThreshold)&&wt(this._target.y,this._targetEnd.y,this.restThreshold)&&wt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._isUserControllingZoom=!1,this._zoomEnd=Ue(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);const i=!e||wt(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(i)}pan(t,e,i=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,i)}truck(t,e,i=!1){this._camera.updateMatrix(),Ge.setFromMatrixColumn(this._camera.matrix,0),Qe.setFromMatrixColumn(this._camera.matrix,1),Ge.multiplyScalar(t),Qe.multiplyScalar(-e);const n=gt.copy(Ge).add(Qe),r=vt.copy(this._targetEnd).add(n);return this.moveTo(r.x,r.y,r.z,i)}forward(t,e=!1){gt.setFromMatrixColumn(this._camera.matrix,0),gt.crossVectors(this._camera.up,gt),gt.multiplyScalar(t);const i=vt.copy(this._targetEnd).add(gt);return this.moveTo(i.x,i.y,i.z,e)}elevate(t,e=!1){return gt.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+gt.x,this._targetEnd.y+gt.y,this._targetEnd.z+gt.z,e)}moveTo(t,e,i,n=!1){this._isUserControllingTruck=!1;const r=gt.set(t,e,i).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,n||this._target.copy(this._targetEnd);const o=!n||wt(this._target.x,this._targetEnd.x,this.restThreshold)&&wt(this._target.y,this._targetEnd.y,this.restThreshold)&&wt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(t,e,i,n=!1){const r=gt.set(t,e,i).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(r.x,r.y,r.z,n)}fitToBox(t,e,{cover:i=!1,paddingLeft:n=0,paddingRight:r=0,paddingBottom:o=0,paddingTop:a=0}={}){const l=[],c=t.isBox3?xs.copy(t):xs.setFromObject(t);c.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const h=Lc(this._sphericalEnd.theta,Mc),d=Lc(this._sphericalEnd.phi,Mc);l.push(this.rotateTo(h,d,e));const p=gt.setFromSpherical(this._sphericalEnd).normalize(),u=jc.setFromUnitVectors(p,ma),g=wt(Math.abs(p.y),1);g&&u.multiply(ba.setFromAxisAngle(Or,h)),u.multiply(this._yAxisUpSpaceInverse);const m=Fc.makeEmpty();vt.copy(c.min).applyQuaternion(u),m.expandByPoint(vt),vt.copy(c.min).setX(c.max.x).applyQuaternion(u),m.expandByPoint(vt),vt.copy(c.min).setY(c.max.y).applyQuaternion(u),m.expandByPoint(vt),vt.copy(c.max).setZ(c.min.z).applyQuaternion(u),m.expandByPoint(vt),vt.copy(c.min).setZ(c.max.z).applyQuaternion(u),m.expandByPoint(vt),vt.copy(c.max).setY(c.min.y).applyQuaternion(u),m.expandByPoint(vt),vt.copy(c.max).setX(c.min.x).applyQuaternion(u),m.expandByPoint(vt),vt.copy(c.max).applyQuaternion(u),m.expandByPoint(vt),m.min.x-=n,m.min.y-=o,m.max.x+=r,m.max.y+=a,u.setFromUnitVectors(ma,p),g&&u.premultiply(ba.invert()),u.premultiply(this._yAxisUpSpace);const b=m.getSize(gt),f=m.getCenter(vt).applyQuaternion(u);if(Zi(this._camera)){const y=this.getDistanceToFitBox(b.x,b.y,b.z,i);l.push(this.moveTo(f.x,f.y,f.z,e)),l.push(this.dollyTo(y,e)),l.push(this.setFocalOffset(0,0,0,e))}else if(Ei(this._camera)){const y=this._camera,_=y.right-y.left,x=y.top-y.bottom,C=i?Math.max(_/b.x,x/b.y):Math.min(_/b.x,x/b.y);l.push(this.moveTo(f.x,f.y,f.z,e)),l.push(this.zoomTo(C,e)),l.push(this.setFocalOffset(0,0,0,e))}return Promise.all(l)}fitToSphere(t,e){const i=[],n="isObject3D"in t?el.createBoundingSphere(t,ga):ga.copy(t);if(i.push(this.moveTo(n.center.x,n.center.y,n.center.z,e)),Zi(this._camera)){const r=this.getDistanceToFitSphere(n.radius);i.push(this.dollyTo(r,e))}else if(Ei(this._camera)){const r=this._camera.right-this._camera.left,o=this._camera.top-this._camera.bottom,a=2*n.radius,l=Math.min(r/a,o/a);i.push(this.zoomTo(l,e))}return i.push(this.setFocalOffset(0,0,0,e)),Promise.all(i)}setLookAt(t,e,i,n,r,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=vs.NONE,this._changedDolly=0;const l=vt.set(n,r,o),c=gt.set(t,e,i);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(c.sub(l).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const h=!a||wt(this._target.x,this._targetEnd.x,this.restThreshold)&&wt(this._target.y,this._targetEnd.y,this.restThreshold)&&wt(this._target.z,this._targetEnd.z,this.restThreshold)&&wt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&wt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&wt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(h)}lerpLookAt(t,e,i,n,r,o,a,l,c,h,d,p,u,g=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=vs.NONE,this._changedDolly=0;const m=gt.set(n,r,o),b=vt.set(t,e,i);$e.setFromVector3(b.sub(m).applyQuaternion(this._yAxisUpSpace));const f=ws.set(h,d,p),y=vt.set(a,l,c);$n.setFromVector3(y.sub(f).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(m.lerp(f,u));const _=$n.theta-$e.theta,x=$n.phi-$e.phi,C=$n.radius-$e.radius;this._sphericalEnd.set($e.radius+C*u,$e.phi+x*u,$e.theta+_*u),this.normalizeRotations(),this._needsUpdate=!0,g||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const S=!g||wt(this._target.x,this._targetEnd.x,this.restThreshold)&&wt(this._target.y,this._targetEnd.y,this.restThreshold)&&wt(this._target.z,this._targetEnd.z,this.restThreshold)&&wt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&wt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&wt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(S)}setPosition(t,e,i,n=!1){return this.setLookAt(t,e,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,n)}setTarget(t,e,i,n=!1){const r=this.getPosition(gt),o=this.setLookAt(r.x,r.y,r.z,t,e,i,n);return this._sphericalEnd.phi=Ue(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(t,e,i,n=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,e,i),this._needsUpdate=!0,n||this._focalOffset.copy(this._focalOffsetEnd);const r=!n||wt(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&wt(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&wt(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(t,e,i){this._camera.updateMatrixWorld(),Ge.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Qe.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Xi.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const n=gt.set(t,e,i),r=n.distanceTo(this._camera.position),o=n.sub(this._camera.position);Ge.multiplyScalar(o.x),Qe.multiplyScalar(o.y),Xi.multiplyScalar(o.z),gt.copy(Ge).add(Qe).add(Xi),gt.z=gt.z+r,this.dollyTo(r,!1),this.setFocalOffset(-gt.x,gt.y,-gt.z,!1),this.moveTo(t,e,i,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,i,n){if(t===null){this._viewport=null;return}this._viewport=this._viewport||new dt.Vector4,typeof t=="number"?this._viewport.set(t,e,i,n):this._viewport.copy(t)}getDistanceToFitBox(t,e,i,n=!1){if(pa(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const r=t/e,o=this._camera.getEffectiveFOV()*Cn,a=this._camera.aspect;return((n?r>a:r<a)?e:t/a)*.5/Math.tan(o*.5)+i*.5}getDistanceToFitSphere(t){if(pa(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const e=this._camera.getEffectiveFOV()*Cn,i=Math.atan(Math.tan(e*.5)*this._camera.aspect)*2,n=1<this._camera.aspect?e:i;return t/Math.sin(n*.5)}getTarget(t,e=!0){return(t&&t.isVector3?t:new dt.Vector3).copy(e?this._targetEnd:this._target)}getPosition(t,e=!0){return(t&&t.isVector3?t:new dt.Vector3).setFromSpherical(e?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(e?this._targetEnd:this._target)}getSpherical(t,e=!0){return(t||new dt.Spherical).copy(e?this._sphericalEnd:this._spherical)}getFocalOffset(t,e=!0){return(t&&t.isVector3?t:new dt.Vector3).copy(e?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%_s,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=_s),this._spherical.theta+=_s*Math.round((this._sphericalEnd.theta-this._spherical.theta)/_s)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(t=!1){if(!wt(this._camera.up.x,this._cameraUp0.x)||!wt(this._camera.up.y,this._cameraUp0.y)||!wt(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const i=this.getPosition(gt);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}const e=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(e)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Or),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const t=gt.subVectors(this._target,this._camera.position).normalize(),e=vt.crossVectors(t,this._camera.up);this._camera.up.crossVectors(e,t).normalize(),this._camera.updateMatrixWorld();const i=this.getPosition(gt);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}update(t){const e=this._sphericalEnd.theta-this._spherical.theta,i=this._sphericalEnd.phi-this._spherical.phi,n=this._sphericalEnd.radius-this._spherical.radius,r=Uc.subVectors(this._targetEnd,this._target),o=Rc.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(Ot(e))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=kr(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,h,1/0,t),this._needsUpdate=!0}if(Ot(i))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=kr(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,h,1/0,t),this._needsUpdate=!0}if(Ot(n))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const h=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=kr(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,h,this.maxSpeed,t),this._needsUpdate=!0}if(Ot(r.x)&&Ot(r.y)&&Ot(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const h=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Bc(this._target,this._targetEnd,this._targetVelocity,h,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(Ot(o.x)&&Ot(o.y)&&Ot(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const h=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Bc(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,h,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(Ot(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const h=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=kr(this._zoom,this._zoomEnd,this._zoomVelocity,h,1/0,t)}if(this.dollyToCursor){if(Zi(this._camera)&&this._changedDolly!==0){const h=this._spherical.radius-this._lastDistance,d=this._camera,p=this._getCameraDirection(An),u=gt.copy(p).cross(d.up).normalize();u.lengthSq()===0&&(u.x=1);const g=vt.crossVectors(u,p),m=this._sphericalEnd.radius*Math.tan(d.getEffectiveFOV()*Cn*.5),b=(this._sphericalEnd.radius-h-this._sphericalEnd.radius)/this._sphericalEnd.radius,f=ws.copy(this._targetEnd).add(u.multiplyScalar(this._dollyControlCoord.x*m*d.aspect)).add(g.multiplyScalar(this._dollyControlCoord.y*m)),y=gt.copy(this._targetEnd).lerp(f,b),_=this._lastDollyDirection===vs.IN&&this._spherical.radius<=this.minDistance,x=this._lastDollyDirection===vs.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(_||x)){this._sphericalEnd.radius-=h,this._spherical.radius-=h;const S=vt.copy(p).multiplyScalar(-h);y.add(S)}this._boundary.clampPoint(y,y);const C=vt.subVectors(y,this._targetEnd);this._targetEnd.copy(y),this._target.add(C),this._changedDolly-=h,Ot(this._changedDolly)&&(this._changedDolly=0)}else if(Ei(this._camera)&&this._changedZoom!==0){const h=this._zoom-this._lastZoom,d=this._camera,p=gt.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(d.near+d.far)/(d.near-d.far)).unproject(d),u=vt.set(0,0,-1).applyQuaternion(d.quaternion),g=ws.copy(p).add(u.multiplyScalar(-p.dot(d.up))),m=-(this._zoom-h-this._zoom)/this._zoom,b=this._getCameraDirection(An),f=this._targetEnd.dot(b),y=gt.copy(this._targetEnd).lerp(g,m),_=y.dot(b),x=b.multiplyScalar(_-f);y.sub(x),this._boundary.clampPoint(y,y);const C=vt.subVectors(y,this._targetEnd);this._targetEnd.copy(y),this._target.add(C),this._changedZoom-=h,Ot(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!Ot(this._focalOffset.x)||!Ot(this._focalOffset.y)||!Ot(this._focalOffset.z))&&(Ge.setFromMatrixColumn(this._camera.matrix,0),Qe.setFromMatrixColumn(this._camera.matrix,1),Xi.setFromMatrixColumn(this._camera.matrix,2),Ge.multiplyScalar(this._focalOffset.x),Qe.multiplyScalar(-this._focalOffset.y),Xi.multiplyScalar(this._focalOffset.z),gt.copy(Ge).add(Qe).add(Xi),this._camera.position.add(gt),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),gt.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const c=this._needsUpdate;return c&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):c?(this.dispatchEvent({type:"update"}),Ot(e,this.restThreshold)&&Ot(i,this.restThreshold)&&Ot(n,this.restThreshold)&&Ot(r.x,this.restThreshold)&&Ot(r.y,this.restThreshold)&&Ot(r.z,this.restThreshold)&&Ot(o.x,this.restThreshold)&&Ot(o.y,this.restThreshold)&&Ot(o.z,this.restThreshold)&&Ot(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!c&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=c,this._needsUpdate=!1,c}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:En(this.maxDistance),minZoom:this.minZoom,maxZoom:En(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:En(this.maxPolarAngle),minAzimuthAngle:En(this.minAzimuthAngle),maxAzimuthAngle:En(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:gt.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){const i=JSON.parse(t);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=Sn(i.maxDistance),this.minZoom=i.minZoom,this.maxZoom=Sn(i.maxZoom),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=Sn(i.maxPolarAngle),this.minAzimuthAngle=Sn(i.minAzimuthAngle),this.maxAzimuthAngle=Sn(i.maxAzimuthAngle),this.smoothTime=i.smoothTime,this.draggingSmoothTime=i.draggingSmoothTime,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._zoom0=i.zoom0,this._focalOffset0.fromArray(i.focalOffset0),this.moveTo(i.target[0],i.target[1],i.target[2],e),$e.setFromVector3(gt.fromArray(i.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo($e.theta,$e.phi,e),this.dollyTo($e.radius,e),this.zoomTo(i.zoom,e),this.setFocalOffset(i.focalOffset[0],i.focalOffset[1],i.focalOffset[2],e),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version",Ob),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(e=>e.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(e=>e.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,e,i){const n=e.lengthSq();if(n===0)return t;const r=vt.copy(e).add(t),o=this._boundary.clampPoint(r,ws).sub(r),a=o.lengthSq();if(a===0)return t.add(e);if(a===n)return t;if(i===0)return t.add(e).add(o);{const l=1+i*a/e.dot(o);return t.add(vt.copy(e).multiplyScalar(l)).add(o.multiplyScalar(1-i))}}_updateNearPlaneCorners(){if(Zi(this._camera)){const t=this._camera,e=t.near,i=t.getEffectiveFOV()*Cn,n=Math.tan(i*.5)*e,r=n*t.aspect;this._nearPlaneCorners[0].set(-r,-n,0),this._nearPlaneCorners[1].set(r,-n,0),this._nearPlaneCorners[2].set(r,n,0),this._nearPlaneCorners[3].set(-r,n,0)}else if(Ei(this._camera)){const t=this._camera,e=1/t.zoom,i=t.left*e,n=t.right*e,r=t.top*e,o=t.bottom*e;this._nearPlaneCorners[0].set(i,r,0),this._nearPlaneCorners[1].set(n,r,0),this._nearPlaneCorners[2].set(n,o,0),this._nearPlaneCorners[3].set(i,o,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||pa(this._camera,"_collisionTest"))return t;const e=this._getTargetDirection(An);ya.lookAt(Nc,e,this._camera.up);for(let i=0;i<4;i++){const n=vt.copy(this._nearPlaneCorners[i]);n.applyMatrix4(ya);const r=ws.addVectors(this._target,n);Ir.set(r,e),Ir.far=this._spherical.radius+1;const o=Ir.intersectObjects(this.colliderMeshes);o.length!==0&&o[0].distance<t&&(t=o[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;const e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{const i=()=>{this.removeEventListener("rest",i),e()};this.addEventListener("rest",i)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,e=new dt.Sphere){const i=e,n=i.center;xs.makeEmpty(),t.traverseVisible(o=>{o.isMesh&&xs.expandByObject(o)}),xs.getCenter(n);let r=0;return t.traverseVisible(o=>{if(!o.isMesh)return;const a=o;if(!a.geometry)return;const l=a.geometry.clone();l.applyMatrix4(a.matrixWorld);const c=l.attributes.position;for(let h=0,d=c.count;h<d;h++)gt.fromBufferAttribute(c,h),r=Math.max(r,n.distanceToSquared(gt))}),i.radius=Math.sqrt(r),i}},il=class gu extends sg{constructor(t){super(t),E(this,"onBeforeUpdate",new K),E(this,"onAfterUpdate",new K),E(this,"onAspectUpdated",new K),E(this,"onDisposed",new K),E(this,"three"),E(this,"_allControls",new Map),E(this,"updateAspect",()=>{var e;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof Bo){this.onAspectUpdated.trigger();return}if((e=this.currentWorld.renderer)!=null&&e.isResizeable()){const i=this.currentWorld.renderer.getSize();this.three.aspect=i.width/i.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.worlds.onItemSet.add(({value:e})=>{const i=this.newCameraControls();this._allControls.set(e.uuid,i)}),this.worlds.onBeforeDelete.add(({value:e})=>{const i=this._allControls.get(e.uuid);i&&(i.dispose(),this._allControls.delete(e.uuid))})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const t=this._allControls.get(this.currentWorld.uuid);if(!t)throw new Error("Controls not found!");return t}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(t){this.currentWorld!==null&&(this.controls.enabled=t)}set currentWorld(t){super.currentWorld=t,t&&(this.worlds.get(t.uuid)||this.worlds.set(t.uuid,t))}get currentWorld(){return this._currentWorld}dispose(){this.setupEvents(!1),this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[t,e]of this._allControls)e.dispose();this.worlds.clear()}async fitToItems(t){const e=await this.getItemsBounding(t);await this.controls.fitToSphere(e,!0)}async setOrbitToItems(t){const e=await this.getItemsBounding(t);this.controls.setOrbitPoint(e.center.x,e.center.y,e.center.z)}update(t){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(t),this.onAfterUpdate.trigger(this))}async getItemsBounding(t){const e=this.components.get(ut),i=this.components.get(go);i.list.clear();const n=new Di;if(t)await i.addFromModelIdMap(t);else for(const[,r]of e.list)i.list.add(r.box);return i.get().getBoundingSphere(n),i.list.clear(),n}setupCamera(){const t=window.innerWidth/window.innerHeight,e=new Rd(60,t,1,1e3);return e.position.set(50,50,50),e.lookAt(new M(0,0,0)),e}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");ve.install({THREE:gu.getSubsetOfThree()});const{domElement:t}=this.currentWorld.renderer.three,e=new ve(this.three,t);return e.smoothTime=.2,e.dollyToCursor=!0,e.infinityDolly=!0,e.minDistance=6,e}setupEvents(t){t?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:Dm,Vector2:Vt,Vector3:M,Vector4:rn,Quaternion:je,Matrix4:xt,Spherical:zm,Box3:Ft,Sphere:Di,Raycaster:Nl,MathUtils:Fd}}};const bu=class yu extends Tt{constructor(t){super(t),E(this,"onAfterUpdate",new K),E(this,"onBeforeUpdate",new K),E(this,"onDisposed",new K),E(this,"list",new Ys),E(this,"enabled",!0),t.add(yu.uuid,this)}create(){const t=new Tb(this.components),e=t.uuid;if(this.list.has(e))throw new Error("There is already a world with this name!");return this.list.set(e,t),t}delete(t){if(!this.list.has(t.uuid))throw new Error("The provided world is not found in the list!");this.list.delete(t.uuid),t.dispose()}dispose(){this.enabled=!1;for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}update(t){if(this.enabled)for(const[e,i]of this.list)i.update(t)}};E(bu,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let vu=bu;class zb extends Vo{constructor(){super(...arguments),E(this,"_config",{visible:{value:!0,type:"Boolean"},color:{value:new bt,type:"Color"},primarySize:{type:"Number",interpolable:!0,value:1,min:0,max:1e3},secondarySize:{type:"Number",interpolable:!0,value:10,min:0,max:1e3},distance:{type:"Number",interpolable:!0,value:500,min:0,max:500}})}get visible(){return this._config.visible.value}set visible(t){this._config.visible.value=t,this._component.visible=t}get color(){return this._config.color.value}set color(t){this._config.color.value=t,this._component.material.uniforms.uColor.value=t,this._component.material.uniformsNeedUpdate=!0}get primarySize(){return this._config.primarySize.value}set primarySize(t){this._config.primarySize.value=t,this._component.material.uniforms.uSize1.value=t,this._component.material.uniformsNeedUpdate=!0}get secondarySize(){return this._config.secondarySize.value}set secondarySize(t){this._config.secondarySize.value=t,this._component.material.uniforms.uSize2.value=t,this._component.material.uniformsNeedUpdate=!0}get distance(){return this._config.distance.value}set distance(t){this._config.distance.value=t,this._component.material.uniforms.uDistance.value=t,this._component.material.uniformsNeedUpdate=!0}}class Db{constructor(t,e){E(this,"onDisposed",new K),E(this,"onSetup",new K),E(this,"isSetup",!1),E(this,"world"),E(this,"components"),E(this,"config"),E(this,"_defaultConfig",{visible:!0,color:new bt(12303291),primarySize:1,secondarySize:10,distance:500}),E(this,"three"),E(this,"_fade",3),E(this,"updateZoom",()=>{this.world.camera instanceof il&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=e;const{color:i,primarySize:n,secondarySize:r,distance:o}=this._defaultConfig;this.components=t,this.config=new zb(this,this.components,"Grid");const a=new Rl(2,2,1,1),l=new Ud({side:Mi,uniforms:{uSize1:{value:n},uSize2:{value:r},uColor:{value:i},uDistance:{value:o},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new rt(a,l),this.three.frustumCulled=!1,e.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(t){this.three.visible=t,t?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(t){this._fade=t?3:0,this.material.uniforms.uFade.value=this._fade}setup(t){const e={...this._defaultConfig,...t};this.config.visible=!0,this.config.color=e.color,this.config.primarySize=e.primarySize,this.config.secondarySize=e.secondarySize,this.config.distance=e.distance,this.isSetup=!0,this.onSetup.trigger()}dispose(){this.setupEvents(!1),this.components.get(Yl).list.delete(this.config.uuid),this.components.get(si).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(t){if(this.world.isDisposing||!(this.world.camera instanceof il))return;const e=this.world.camera.controls;t?e.addEventListener("update",this.updateZoom):e.removeEventListener("update",this.updateZoom)}}const Mb=class _u extends Tt{constructor(t){super(t),E(this,"list",new Map),E(this,"onDisposed",new K),E(this,"enabled",!0),t.add(_u.uuid,this)}create(t){if(this.list.has(t.uuid))throw new Error("This world already has a grid!");const e=new Db(this.components,t);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}};E(Mb,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");const wu=0,Lb=1,Bb=2,Hc=2,va=1.25,Vc=1,oo=6*4+4+4,qo=65535,Nb=Math.pow(2,-24),_a=Symbol("SKIP_GENERATION");function Ub(s){return s.index?s.index.count:s.attributes.position.count}function on(s){return Ub(s)/3}function Rb(s,t=ArrayBuffer){return s>65535?new Uint32Array(new t(4*s)):new Uint16Array(new t(2*s))}function Fb(s,t){if(!s.index){const e=s.attributes.position.count,i=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=Rb(e,i);s.setIndex(new xe(n,1));for(let r=0;r<e;r++)n[r]=r}}function xu(s){const t=on(s),e=s.drawRange,i=e.start/3,n=(e.start+e.count)/3,r=Math.max(0,i),o=Math.min(t,n)-r;return[{offset:Math.floor(r),count:Math.floor(o)}]}function Cu(s){if(!s.groups||!s.groups.length)return xu(s);const t=[],e=new Set,i=s.drawRange,n=i.start/3,r=(i.start+i.count)/3;for(const a of s.groups){const l=a.start/3,c=(a.start+a.count)/3;e.add(Math.max(n,l)),e.add(Math.min(r,c))}const o=Array.from(e.values()).sort((a,l)=>a-l);for(let a=0;a<o.length-1;a++){const l=o[a],c=o[a+1];t.push({offset:Math.floor(l),count:Math.floor(c-l)})}return t}function jb(s){if(s.groups.length===0)return!1;const t=on(s),e=Cu(s).sort((r,o)=>r.offset-o.offset),i=e[e.length-1];i.count=Math.min(t-i.offset,i.count);let n=0;return e.forEach(({count:r})=>n+=r),t!==n}function Lt(s,t,e){return e.min.x=t[s],e.min.y=t[s+1],e.min.z=t[s+2],e.max.x=t[s+3],e.max.y=t[s+4],e.max.z=t[s+5],e}function Hb(s){s[0]=s[1]=s[2]=1/0,s[3]=s[4]=s[5]=-1/0}function qc(s){let t=-1,e=-1/0;for(let i=0;i<3;i++){const n=s[i+3]-s[i];n>e&&(e=n,t=i)}return t}function Wc(s,t){t.set(s)}function Yc(s,t,e){let i,n;for(let r=0;r<3;r++){const o=r+3;i=s[r],n=t[r],e[r]=i<n?i:n,i=s[o],n=t[o],e[o]=i>n?i:n}}function zr(s,t,e){for(let i=0;i<3;i++){const n=t[s+2*i],r=t[s+2*i+1],o=n-r,a=n+r;o<e[i]&&(e[i]=o),a>e[i+3]&&(e[i+3]=a)}}function Tn(s){const t=s[3]-s[0],e=s[4]-s[1],i=s[5]-s[2];return 2*(t*e+e*i+i*t)}function wa(s,t,e,i,n=null){let r=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,h=-1/0,d=1/0,p=1/0,u=1/0,g=-1/0,m=-1/0,b=-1/0;const f=n!==null;for(let y=t*6,_=(t+e)*6;y<_;y+=6){const x=s[y+0],C=s[y+1],S=x-C,$=x+C;S<r&&(r=S),$>l&&(l=$),f&&x<d&&(d=x),f&&x>g&&(g=x);const O=s[y+2],z=s[y+3],D=O-z,j=O+z;D<o&&(o=D),j>c&&(c=j),f&&O<p&&(p=O),f&&O>m&&(m=O);const A=s[y+4],k=s[y+5],v=A-k,L=A+k;v<a&&(a=v),L>h&&(h=L),f&&A<u&&(u=A),f&&A>b&&(b=A)}i[0]=r,i[1]=o,i[2]=a,i[3]=l,i[4]=c,i[5]=h,f&&(n[0]=d,n[1]=p,n[2]=u,n[3]=g,n[4]=m,n[5]=b)}function Vb(s,t,e,i){let n=1/0,r=1/0,o=1/0,a=-1/0,l=-1/0,c=-1/0;for(let h=t*6,d=(t+e)*6;h<d;h+=6){const p=s[h+0];p<n&&(n=p),p>a&&(a=p);const u=s[h+2];u<r&&(r=u),u>l&&(l=u);const g=s[h+4];g<o&&(o=g),g>c&&(c=g)}i[0]=n,i[1]=r,i[2]=o,i[3]=a,i[4]=l,i[5]=c}function qb(s,t){Hb(t);const e=s.attributes.position,i=s.index?s.index.array:null,n=on(s),r=new Float32Array(n*6),o=e.normalized,a=e.array,l=e.offset||0;let c=3;e.isInterleavedBufferAttribute&&(c=e.data.stride);const h=["getX","getY","getZ"];for(let d=0;d<n;d++){const p=d*3,u=d*6;let g=p+0,m=p+1,b=p+2;i&&(g=i[g],m=i[m],b=i[b]),o||(g=g*c+l,m=m*c+l,b=b*c+l);for(let f=0;f<3;f++){let y,_,x;o?(y=e[h[f]](g),_=e[h[f]](m),x=e[h[f]](b)):(y=a[g+f],_=a[m+f],x=a[b+f]);let C=y;_<C&&(C=_),x<C&&(C=x);let S=y;_>S&&(S=_),x>S&&(S=x);const $=(S-C)/2,O=f*2;r[u+O+0]=C+$,r[u+O+1]=$+(Math.abs(C)+$)*Nb,C<t[f]&&(t[f]=C),S>t[f+3]&&(t[f+3]=S)}}return r}const li=32,Wb=(s,t)=>s.candidate-t.candidate,xi=new Array(li).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Dr=new Float32Array(6);function Yb(s,t,e,i,n,r){let o=-1,a=0;if(r===wu)o=qc(t),o!==-1&&(a=(t[o]+t[o+3])/2);else if(r===Lb)o=qc(s),o!==-1&&(a=Zb(e,i,n,o));else if(r===Bb){const l=Tn(s);let c=va*n;const h=i*6,d=(i+n)*6;for(let p=0;p<3;p++){const u=t[p],g=(t[p+3]-u)/li;if(n<li/4){const m=[...xi];m.length=n;let b=0;for(let y=h;y<d;y+=6,b++){const _=m[b];_.candidate=e[y+2*p],_.count=0;const{bounds:x,leftCacheBounds:C,rightCacheBounds:S}=_;for(let $=0;$<3;$++)S[$]=1/0,S[$+3]=-1/0,C[$]=1/0,C[$+3]=-1/0,x[$]=1/0,x[$+3]=-1/0;zr(y,e,x)}m.sort(Wb);let f=n;for(let y=0;y<f;y++){const _=m[y];for(;y+1<f&&m[y+1].candidate===_.candidate;)m.splice(y+1,1),f--}for(let y=h;y<d;y+=6){const _=e[y+2*p];for(let x=0;x<f;x++){const C=m[x];_>=C.candidate?zr(y,e,C.rightCacheBounds):(zr(y,e,C.leftCacheBounds),C.count++)}}for(let y=0;y<f;y++){const _=m[y],x=_.count,C=n-_.count,S=_.leftCacheBounds,$=_.rightCacheBounds;let O=0;x!==0&&(O=Tn(S)/l);let z=0;C!==0&&(z=Tn($)/l);const D=Vc+va*(O*x+z*C);D<c&&(o=p,c=D,a=_.candidate)}}else{for(let f=0;f<li;f++){const y=xi[f];y.count=0,y.candidate=u+g+f*g;const _=y.bounds;for(let x=0;x<3;x++)_[x]=1/0,_[x+3]=-1/0}for(let f=h;f<d;f+=6){let y=~~((e[f+2*p]-u)/g);y>=li&&(y=li-1);const _=xi[y];_.count++,zr(f,e,_.bounds)}const m=xi[li-1];Wc(m.bounds,m.rightCacheBounds);for(let f=li-2;f>=0;f--){const y=xi[f],_=xi[f+1];Yc(y.bounds,_.rightCacheBounds,y.rightCacheBounds)}let b=0;for(let f=0;f<li-1;f++){const y=xi[f],_=y.count,x=y.bounds,C=xi[f+1].rightCacheBounds;_!==0&&(b===0?Wc(x,Dr):Yc(x,Dr,Dr)),b+=_;let S=0,$=0;b!==0&&(S=Tn(Dr)/l);const O=n-b;O!==0&&($=Tn(C)/l);const z=Vc+va*(S*b+$*O);z<c&&(o=p,c=z,a=y.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:o,pos:a}}function Zb(s,t,e,i){let n=0;for(let r=t,o=t+e;r<o;r++)n+=s[r*6+i*2];return n/e}let Mr=class{constructor(){}};function Xb(s,t,e,i,n,r){let o=i,a=i+n-1;const l=r.pos,c=r.axis*2;for(;;){for(;o<=a&&e[o*6+c]<l;)o++;for(;o<=a&&e[a*6+c]>=l;)a--;if(o<a){for(let h=0;h<3;h++){let d=t[o*3+h];t[o*3+h]=t[a*3+h],t[a*3+h]=d}for(let h=0;h<6;h++){let d=e[o*6+h];e[o*6+h]=e[a*6+h],e[a*6+h]=d}o++,a--}else return o}}function Gb(s,t,e,i,n,r){let o=i,a=i+n-1;const l=r.pos,c=r.axis*2;for(;;){for(;o<=a&&e[o*6+c]<l;)o++;for(;o<=a&&e[a*6+c]>=l;)a--;if(o<a){let h=s[o];s[o]=s[a],s[a]=h;for(let d=0;d<6;d++){let p=e[o*6+d];e[o*6+d]=e[a*6+d],e[a*6+d]=p}o++,a--}else return o}}function Qb(s,t){const e=(s.index?s.index.count:s.attributes.position.count)/3,i=e>2**16,n=i?4:2,r=t?new SharedArrayBuffer(e*n):new ArrayBuffer(e*n),o=i?new Uint32Array(r):new Uint16Array(r);for(let a=0,l=o.length;a<l;a++)o[a]=a;return o}function Kb(s,t){const e=s.geometry,i=e.index?e.index.array:null,n=t.maxDepth,r=t.verbose,o=t.maxLeafTris,a=t.strategy,l=t.onProgress,c=on(e),h=s._indirectBuffer;let d=!1;const p=new Float32Array(6),u=new Float32Array(6),g=qb(e,p),m=t.indirect?Gb:Xb,b=[],f=t.indirect?xu(e):Cu(e);if(f.length===1){const x=f[0],C=new Mr;C.boundingData=p,Vb(g,x.offset,x.count,u),_(C,x.offset,x.count,u),b.push(C)}else for(let x of f){const C=new Mr;C.boundingData=new Float32Array(6),wa(g,x.offset,x.count,C.boundingData,u),_(C,x.offset,x.count,u),b.push(C)}return b;function y(x){l&&l(x/c)}function _(x,C,S,$=null,O=0){if(!d&&O>=n&&(d=!0,r&&(console.warn(`MeshBVH: Max depth of ${n} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),S<=o||O>=n)return y(C+S),x.offset=C,x.count=S,x;const z=Yb(x.boundingData,$,g,C,S,a);if(z.axis===-1)return y(C+S),x.offset=C,x.count=S,x;const D=m(h,i,g,C,S,z);if(D===C||D===C+S)y(C+S),x.offset=C,x.count=S;else{x.splitAxis=z.axis;const j=new Mr,A=C,k=D-C;x.left=j,j.boundingData=new Float32Array(6),wa(g,A,k,j.boundingData,u),_(j,A,k,u,O+1);const v=new Mr,L=D,X=S-k;x.right=v,v.boundingData=new Float32Array(6),wa(g,L,X,v.boundingData,u),_(v,L,X,u,O+1)}return x}}function Jb(s,t){const e=s.geometry;t.indirect&&(s._indirectBuffer=Qb(e,t.useSharedArrayBuffer),jb(e)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),s._indirectBuffer||Fb(e,t);const i=Kb(s,t);let n,r,o;const a=[],l=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let d=0;d<i.length;d++){const p=i[d];let u=c(p);const g=new l(oo*u);n=new Float32Array(g),r=new Uint32Array(g),o=new Uint16Array(g),h(0,p),a.push(g)}s._roots=a;return;function c(d){return d.count?1:1+c(d.left)+c(d.right)}function h(d,p){const u=d/4,g=d/2,m=!!p.count,b=p.boundingData;for(let f=0;f<6;f++)n[u+f]=b[f];if(m){const f=p.offset,y=p.count;return r[u+6]=f,o[g+14]=y,o[g+15]=qo,d+oo}else{const f=p.left,y=p.right,_=p.splitAxis;let x;if(x=h(d+oo,f),x/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[u+6]=x/4,x=h(x,y),r[u+7]=_,x}}}let fi=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let i=1/0,n=-1/0;for(let r=0,o=t.length;r<o;r++){const a=t[r][e];i=a<i?a:i,n=a>n?a:n}this.min=i,this.max=n}setFromPoints(t,e){let i=1/0,n=-1/0;for(let r=0,o=e.length;r<o;r++){const a=e[r],l=t.dot(a);i=l<i?l:i,n=l>n?l:n}this.min=i,this.max=n}isSeparated(t){return this.min>t.max||t.min>this.max}};fi.prototype.setFromBox=function(){const s=new M;return function(t,e){const i=e.min,n=e.max;let r=1/0,o=-1/0;for(let a=0;a<=1;a++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){s.x=i.x*a+n.x*(1-a),s.y=i.y*l+n.y*(1-l),s.z=i.z*c+n.z*(1-c);const h=t.dot(s);r=Math.min(h,r),o=Math.max(h,o)}this.min=r,this.max=o}}();const ty=function(){const s=new M,t=new M,e=new M;return function(i,n,r){const o=i.start,a=s,l=n.start,c=t;e.subVectors(o,l),s.subVectors(i.end,i.start),t.subVectors(n.end,n.start);const h=e.dot(c),d=c.dot(a),p=c.dot(c),u=e.dot(a),g=a.dot(a)*p-d*d;let m,b;g!==0?m=(h*d-u*p)/g:m=0,b=(h+m*d)/p,r.x=m,r.y=b}}(),Zl=function(){const s=new Vt,t=new M,e=new M;return function(i,n,r,o){ty(i,n,s);let a=s.x,l=s.y;if(a>=0&&a<=1&&l>=0&&l<=1){i.at(a,r),n.at(l,o);return}else if(a>=0&&a<=1){l<0?n.at(0,o):n.at(1,o),i.closestPointToPoint(o,!0,r);return}else if(l>=0&&l<=1){a<0?i.at(0,r):i.at(1,r),n.closestPointToPoint(r,!0,o);return}else{let c;a<0?c=i.start:c=i.end;let h;l<0?h=n.start:h=n.end;const d=t,p=e;if(i.closestPointToPoint(h,!0,t),n.closestPointToPoint(c,!0,e),d.distanceToSquared(h)<=p.distanceToSquared(c)){r.copy(d),o.copy(h);return}else{r.copy(c),o.copy(p);return}}}}(),ey=function(){const s=new M,t=new M,e=new Te,i=new ze;return function(n,r){const{radius:o,center:a}=n,{a:l,b:c,c:h}=r;if(i.start=l,i.end=c,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o||(i.start=l,i.end=h,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o)||(i.start=c,i.end=h,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o))return!0;const d=r.getPlane(e);if(Math.abs(d.distanceToPoint(a))<=o){const p=d.projectPoint(a,t);if(r.containsPoint(p))return!0}return!1}}(),iy=1e-15;function xa(s){return Math.abs(s)<iy}let Ve=class extends Un{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new M),this.satBounds=new Array(4).fill().map(()=>new fi),this.points=[this.a,this.b,this.c],this.sphere=new Di,this.plane=new Te,this.needsUpdate=!0}intersectsSphere(t){return ey(t,this)}update(){const t=this.a,e=this.b,i=this.c,n=this.points,r=this.satAxes,o=this.satBounds,a=r[0],l=o[0];this.getNormal(a),l.setFromPoints(a,n);const c=r[1],h=o[1];c.subVectors(t,e),h.setFromPoints(c,n);const d=r[2],p=o[2];d.subVectors(e,i),p.setFromPoints(d,n);const u=r[3],g=o[3];u.subVectors(i,t),g.setFromPoints(u,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,t),this.needsUpdate=!1}};Ve.prototype.closestPointToSegment=function(){const s=new M,t=new M,e=new ze;return function(i,n=null,r=null){const{start:o,end:a}=i,l=this.points;let c,h=1/0;for(let d=0;d<3;d++){const p=(d+1)%3;e.start.copy(l[d]),e.end.copy(l[p]),Zl(e,i,s,t),c=s.distanceToSquared(t),c<h&&(h=c,n&&n.copy(s),r&&r.copy(t))}return this.closestPointToPoint(o,s),c=o.distanceToSquared(s),c<h&&(h=c,n&&n.copy(s),r&&r.copy(o)),this.closestPointToPoint(a,s),c=a.distanceToSquared(s),c<h&&(h=c,n&&n.copy(s),r&&r.copy(a)),Math.sqrt(h)}}();Ve.prototype.intersectsTriangle=function(){const s=new Ve,t=new Array(3),e=new Array(3),i=new fi,n=new fi,r=new M,o=new M,a=new M,l=new M,c=new M,h=new ze,d=new ze,p=new ze,u=new M;function g(m,b,f){const y=m.points;let _=0,x=-1;for(let C=0;C<3;C++){const{start:S,end:$}=h;S.copy(y[C]),$.copy(y[(C+1)%3]),h.delta(o);const O=xa(b.distanceToPoint(S));if(xa(b.normal.dot(o))&&O){f.copy(h),_=2;break}const z=b.intersectLine(h,u);if(!z&&O&&u.copy(S),(z||O)&&!xa(u.distanceTo($))){if(_<=1)(_===1?f.start:f.end).copy(u),O&&(x=_);else if(_>=2){(x===1?f.start:f.end).copy(u),_=2;break}if(_++,_===2&&x===-1)break}}return _}return function(m,b=null,f=!1){this.needsUpdate&&this.update(),m.isExtendedTriangle?m.needsUpdate&&m.update():(s.copy(m),s.update(),m=s);const y=this.plane,_=m.plane;if(Math.abs(y.normal.dot(_.normal))>1-1e-10){const x=this.satBounds,C=this.satAxes;e[0]=m.a,e[1]=m.b,e[2]=m.c;for(let O=0;O<4;O++){const z=x[O],D=C[O];if(i.setFromPoints(D,e),z.isSeparated(i))return!1}const S=m.satBounds,$=m.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let O=0;O<4;O++){const z=S[O],D=$[O];if(i.setFromPoints(D,t),z.isSeparated(i))return!1}for(let O=0;O<4;O++){const z=C[O];for(let D=0;D<4;D++){const j=$[D];if(r.crossVectors(z,j),i.setFromPoints(r,t),n.setFromPoints(r,e),i.isSeparated(n))return!1}}return b&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),b.start.set(0,0,0),b.end.set(0,0,0)),!0}else{const x=g(this,_,d);if(x===1&&m.containsPoint(d.end))return b&&(b.start.copy(d.end),b.end.copy(d.end)),!0;if(x!==2)return!1;const C=g(m,y,p);if(C===1&&this.containsPoint(p.end))return b&&(b.start.copy(p.end),b.end.copy(p.end)),!0;if(C!==2)return!1;if(d.delta(a),p.delta(l),a.dot(l)<0){let A=p.start;p.start=p.end,p.end=A}const S=d.start.dot(a),$=d.end.dot(a),O=p.start.dot(a),z=p.end.dot(a),D=$<O,j=S<z;return S!==z&&O!==$&&D===j?!1:(b&&(c.subVectors(d.start,p.start),c.dot(a)>0?b.start.copy(d.start):b.start.copy(p.start),c.subVectors(d.end,p.end),c.dot(a)<0?b.end.copy(d.end):b.end.copy(p.end)),!0)}}}();Ve.prototype.distanceToPoint=function(){const s=new M;return function(t){return this.closestPointToPoint(t,s),t.distanceTo(s)}}();Ve.prototype.distanceToTriangle=function(){const s=new M,t=new M,e=["a","b","c"],i=new ze,n=new ze;return function(r,o=null,a=null){const l=o||a?i:null;if(this.intersectsTriangle(r,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let c=1/0;for(let h=0;h<3;h++){let d;const p=e[h],u=r[p];this.closestPointToPoint(u,s),d=u.distanceToSquared(s),d<c&&(c=d,o&&o.copy(s),a&&a.copy(u));const g=this[p];r.closestPointToPoint(g,s),d=g.distanceToSquared(s),d<c&&(c=d,o&&o.copy(g),a&&a.copy(s))}for(let h=0;h<3;h++){const d=e[h],p=e[(h+1)%3];i.set(this[d],this[p]);for(let u=0;u<3;u++){const g=e[u],m=e[(u+1)%3];n.set(r[g],r[m]),Zl(i,n,s,t);const b=s.distanceToSquared(t);b<c&&(c=b,o&&o.copy(s),a&&a.copy(t))}}return Math.sqrt(c)}}();let ue=class{constructor(t,e,i){this.isOrientedBox=!0,this.min=new M,this.max=new M,this.matrix=new xt,this.invMatrix=new xt,this.points=new Array(8).fill().map(()=>new M),this.satAxes=new Array(3).fill().map(()=>new M),this.satBounds=new Array(3).fill().map(()=>new fi),this.alignedSatBounds=new Array(3).fill().map(()=>new fi),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),i&&this.matrix.copy(i)}set(t,e,i){this.min.copy(t),this.max.copy(e),this.matrix.copy(i),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}};ue.prototype.update=function(){return function(){const s=this.matrix,t=this.min,e=this.max,i=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){const d=1*l|2*c|4*h,p=i[d];p.x=l?e.x:t.x,p.y=c?e.y:t.y,p.z=h?e.z:t.z,p.applyMatrix4(s)}const n=this.satBounds,r=this.satAxes,o=i[0];for(let l=0;l<3;l++){const c=r[l],h=n[l],d=1<<l,p=i[d];c.subVectors(o,p),h.setFromPoints(c,i)}const a=this.alignedSatBounds;a[0].setFromPointsField(i,"x"),a[1].setFromPointsField(i,"y"),a[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();ue.prototype.intersectsBox=function(){const s=new fi;return function(t){this.needsUpdate&&this.update();const e=t.min,i=t.max,n=this.satBounds,r=this.satAxes,o=this.alignedSatBounds;if(s.min=e.x,s.max=i.x,o[0].isSeparated(s)||(s.min=e.y,s.max=i.y,o[1].isSeparated(s))||(s.min=e.z,s.max=i.z,o[2].isSeparated(s)))return!1;for(let a=0;a<3;a++){const l=r[a],c=n[a];if(s.setFromBox(l,t),c.isSeparated(s))return!1}return!0}}();ue.prototype.intersectsTriangle=function(){const s=new Ve,t=new Array(3),e=new fi,i=new fi,n=new M;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(s.copy(r),s.update(),r=s);const o=this.satBounds,a=this.satAxes;t[0]=r.a,t[1]=r.b,t[2]=r.c;for(let d=0;d<3;d++){const p=o[d],u=a[d];if(e.setFromPoints(u,t),p.isSeparated(e))return!1}const l=r.satBounds,c=r.satAxes,h=this.points;for(let d=0;d<3;d++){const p=l[d],u=c[d];if(e.setFromPoints(u,h),p.isSeparated(e))return!1}for(let d=0;d<3;d++){const p=a[d];for(let u=0;u<4;u++){const g=c[u];if(n.crossVectors(p,g),e.setFromPoints(n,t),i.setFromPoints(n,h),e.isSeparated(i))return!1}}return!0}}();ue.prototype.closestPointToPoint=function(){return function(s,t){return this.needsUpdate&&this.update(),t.copy(s).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();ue.prototype.distanceToPoint=function(){const s=new M;return function(t){return this.closestPointToPoint(t,s),t.distanceTo(s)}}();ue.prototype.distanceToBox=function(){const s=["x","y","z"],t=new Array(12).fill().map(()=>new ze),e=new Array(12).fill().map(()=>new ze),i=new M,n=new M;return function(r,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(a||l)&&(r.getCenter(n),this.closestPointToPoint(n,i),r.closestPointToPoint(i,n),a&&a.copy(i),l&&l.copy(n)),0;const c=o*o,h=r.min,d=r.max,p=this.points;let u=1/0;for(let m=0;m<8;m++){const b=p[m];n.copy(b).clamp(h,d);const f=b.distanceToSquared(n);if(f<u&&(u=f,a&&a.copy(b),l&&l.copy(n),f<c))return Math.sqrt(f)}let g=0;for(let m=0;m<3;m++)for(let b=0;b<=1;b++)for(let f=0;f<=1;f++){const y=(m+1)%3,_=(m+2)%3,x=b<<y|f<<_,C=1<<m|b<<y|f<<_,S=p[x],$=p[C];t[g].set(S,$);const O=s[m],z=s[y],D=s[_],j=e[g],A=j.start,k=j.end;A[O]=h[O],A[z]=b?h[z]:d[z],A[D]=f?h[D]:d[z],k[O]=d[O],k[z]=b?h[z]:d[z],k[D]=f?h[D]:d[z],g++}for(let m=0;m<=1;m++)for(let b=0;b<=1;b++)for(let f=0;f<=1;f++){n.x=m?d.x:h.x,n.y=b?d.y:h.y,n.z=f?d.z:h.z,this.closestPointToPoint(n,i);const y=n.distanceToSquared(i);if(y<u&&(u=y,a&&a.copy(i),l&&l.copy(n),y<c))return Math.sqrt(y)}for(let m=0;m<12;m++){const b=t[m];for(let f=0;f<12;f++){const y=e[f];Zl(b,y,i,n);const _=i.distanceToSquared(n);if(_<u&&(u=_,a&&a.copy(i),l&&l.copy(n),_<c))return Math.sqrt(_)}}return Math.sqrt(u)}}();let Xl=class{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}};class sy extends Xl{constructor(){super(()=>new Ve)}}const ke=new sy;function _e(s,t){return t[s+15]===65535}function we(s,t){return t[s+6]}function Pe(s,t){return t[s+14]}function Oe(s){return s+8}function Ie(s,t){return t[s+6]}function Eu(s,t){return t[s+7]}class ny{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=i=>{e&&t.push(e),e=i,this.float32Array=new Float32Array(i),this.uint16Array=new Uint16Array(i),this.uint32Array=new Uint32Array(i)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,t.length!==0&&this.setBuffer(t.pop())}}}const zt=new ny;let Oi,Us;const Cs=[],Lr=new Xl(()=>new Ft);function ry(s,t,e,i,n,r){Oi=Lr.getPrimitive(),Us=Lr.getPrimitive(),Cs.push(Oi,Us),zt.setBuffer(s._roots[t]);const o=sl(0,s.geometry,e,i,n,r);zt.clearBuffer(),Lr.releasePrimitive(Oi),Lr.releasePrimitive(Us),Cs.pop(),Cs.pop();const a=Cs.length;return a>0&&(Us=Cs[a-1],Oi=Cs[a-2]),o}function sl(s,t,e,i,n=null,r=0,o=0){const{float32Array:a,uint16Array:l,uint32Array:c}=zt;let h=s*2;if(_e(h,l)){const d=we(s,c),p=Pe(h,l);return Lt(s,a,Oi),i(d,p,!1,o,r+s,Oi)}else{let d=function(j){const{uint16Array:A,uint32Array:k}=zt;let v=j*2;for(;!_e(v,A);)j=Oe(j),v=j*2;return we(j,k)},p=function(j){const{uint16Array:A,uint32Array:k}=zt;let v=j*2;for(;!_e(v,A);)j=Ie(j,k),v=j*2;return we(j,k)+Pe(v,A)};const u=Oe(s),g=Ie(s,c);let m=u,b=g,f,y,_,x;if(n&&(_=Oi,x=Us,Lt(m,a,_),Lt(b,a,x),f=n(_),y=n(x),y<f)){m=g,b=u;const j=f;f=y,y=j,_=x}_||(_=Oi,Lt(m,a,_));const C=_e(m*2,l),S=e(_,C,f,o+1,r+m);let $;if(S===Hc){const j=d(m),A=p(m)-j;$=i(j,A,!0,o+1,r+m,_)}else $=S&&sl(m,t,e,i,n,r,o+1);if($)return!0;x=Us,Lt(b,a,x);const O=_e(b*2,l),z=e(x,O,y,o+1,r+b);let D;if(z===Hc){const j=d(b),A=p(b)-j;D=i(j,A,!0,o+1,r+b,x)}else D=z&&sl(b,t,e,i,n,r,o+1);return!!D}}const kn=new M,Ca=new M;function oy(s,t,e={},i=0,n=1/0){const r=i*i,o=n*n;let a=1/0,l=null;if(s.shapecast({boundsTraverseOrder:h=>(kn.copy(t).clamp(h.min,h.max),kn.distanceToSquared(t)),intersectsBounds:(h,d,p)=>p<a&&p<o,intersectsTriangle:(h,d)=>{h.closestPointToPoint(t,kn);const p=t.distanceToSquared(kn);return p<a&&(Ca.copy(kn),a=p,l=d),p<r}}),a===1/0)return null;const c=Math.sqrt(a);return e.point?e.point.copy(Ca):e.point=Ca.clone(),e.distance=c,e.faceIndex=l,e}const Es=new M,Ss=new M,As=new M,Br=new Vt,Nr=new Vt,Ur=new Vt,Zc=new M,Xc=new M,Gc=new M,Rr=new M;function ay(s,t,e,i,n,r){let o;return r===Nm?o=s.intersectTriangle(i,e,t,!0,n):o=s.intersectTriangle(t,e,i,r!==Mi,n),o===null?null:{distance:s.origin.distanceTo(n),point:n.clone()}}function ly(s,t,e,i,n,r,o,a,l){Es.fromBufferAttribute(t,r),Ss.fromBufferAttribute(t,o),As.fromBufferAttribute(t,a);const c=ay(s,Es,Ss,As,Rr,l);if(c){i&&(Br.fromBufferAttribute(i,r),Nr.fromBufferAttribute(i,o),Ur.fromBufferAttribute(i,a),c.uv=Un.getInterpolation(Rr,Es,Ss,As,Br,Nr,Ur,new Vt)),n&&(Br.fromBufferAttribute(n,r),Nr.fromBufferAttribute(n,o),Ur.fromBufferAttribute(n,a),c.uv1=Un.getInterpolation(Rr,Es,Ss,As,Br,Nr,Ur,new Vt)),e&&(Zc.fromBufferAttribute(e,r),Xc.fromBufferAttribute(e,o),Gc.fromBufferAttribute(e,a),c.normal=Un.getInterpolation(Rr,Es,Ss,As,Zc,Xc,Gc,new M),c.normal.dot(s.direction)>0&&c.normal.multiplyScalar(-1));const h={a:r,b:o,c:a,normal:new M,materialIndex:0};Un.getNormal(Es,Ss,As,h.normal),c.face=h,c.faceIndex=r}return c}function Wo(s,t,e,i,n){const r=i*3;let o=r+0,a=r+1,l=r+2;const c=s.index;s.index&&(o=c.getX(o),a=c.getX(a),l=c.getX(l));const{position:h,normal:d,uv:p,uv1:u}=s.attributes,g=ly(e,h,d,p,u,o,a,l,t);return g?(g.faceIndex=i,n&&n.push(g),g):null}function Ht(s,t,e,i){const n=s.a,r=s.b,o=s.c;let a=t,l=t+1,c=t+2;e&&(a=e.getX(a),l=e.getX(l),c=e.getX(c)),n.x=i.getX(a),n.y=i.getY(a),n.z=i.getZ(a),r.x=i.getX(l),r.y=i.getY(l),r.z=i.getZ(l),o.x=i.getX(c),o.y=i.getY(c),o.z=i.getZ(c)}function cy(s,t,e,i,n,r){const{geometry:o,_indirectBuffer:a}=s;for(let l=i,c=i+n;l<c;l++)Wo(o,t,e,l,r)}function hy(s,t,e,i,n){const{geometry:r,_indirectBuffer:o}=s;let a=1/0,l=null;for(let c=i,h=i+n;c<h;c++){let d;d=Wo(r,t,e,c),d&&d.distance<a&&(l=d,a=d.distance)}return l}function dy(s,t,e,i,n,r,o){const{geometry:a}=e,{index:l}=a,c=a.attributes.position;for(let h=s,d=t+s;h<d;h++){let p;if(p=h,Ht(o,p*3,l,c),o.needsUpdate=!0,i(o,p,n,r))return!0}return!1}function uy(s,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=s.geometry,i=e.index?e.index.array:null,n=e.attributes.position;let r,o,a,l,c=0;const h=s._roots;for(let p=0,u=h.length;p<u;p++)r=h[p],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),d(0,c),c+=r.byteLength;function d(p,u,g=!1){const m=p*2;if(a[m+15]===qo){const b=o[p+6],f=a[m+14];let y=1/0,_=1/0,x=1/0,C=-1/0,S=-1/0,$=-1/0;for(let O=3*b,z=3*(b+f);O<z;O++){let D=i[O];const j=n.getX(D),A=n.getY(D),k=n.getZ(D);j<y&&(y=j),j>C&&(C=j),A<_&&(_=A),A>S&&(S=A),k<x&&(x=k),k>$&&($=k)}return l[p+0]!==y||l[p+1]!==_||l[p+2]!==x||l[p+3]!==C||l[p+4]!==S||l[p+5]!==$?(l[p+0]=y,l[p+1]=_,l[p+2]=x,l[p+3]=C,l[p+4]=S,l[p+5]=$,!0):!1}else{const b=p+8,f=o[p+6],y=b+u,_=f+u;let x=g,C=!1,S=!1;t?x||(C=t.has(y),S=t.has(_),x=!C&&!S):(C=!0,S=!0);const $=x||C,O=x||S;let z=!1;$&&(z=d(b,u,x));let D=!1;O&&(D=d(f,u,x));const j=z||D;if(j)for(let A=0;A<3;A++){const k=b+A,v=f+A,L=l[k],X=l[k+3],V=l[v],J=l[v+3];l[p+A]=L<V?L:V,l[p+A+3]=X>J?X:J}return j}}}const Qc=new Ft;function Bi(s,t,e,i){return Lt(s,t,Qc),e.intersectBox(Qc,i)}function py(s,t,e,i,n,r){const{geometry:o,_indirectBuffer:a}=s;for(let l=i,c=i+n;l<c;l++){let h=a?a[l]:l;Wo(o,t,e,h,r)}}function fy(s,t,e,i,n){const{geometry:r,_indirectBuffer:o}=s;let a=1/0,l=null;for(let c=i,h=i+n;c<h;c++){let d;d=Wo(r,t,e,o?o[c]:c),d&&d.distance<a&&(l=d,a=d.distance)}return l}function my(s,t,e,i,n,r,o){const{geometry:a}=e,{index:l}=a,c=a.attributes.position;for(let h=s,d=t+s;h<d;h++){let p;if(p=e.resolveTriangleIndex(h),Ht(o,p*3,l,c),o.needsUpdate=!0,i(o,p,n,r))return!0}return!1}const Kc=new M;function gy(s,t,e,i,n){zt.setBuffer(s._roots[t]),nl(0,s,e,i,n),zt.clearBuffer()}function nl(s,t,e,i,n){const{float32Array:r,uint16Array:o,uint32Array:a}=zt,l=s*2;if(_e(l,o)){const c=we(s,a),h=Pe(l,o);cy(t,e,i,c,h,n)}else{const c=Oe(s);Bi(c,r,i,Kc)&&nl(c,t,e,i,n);const h=Ie(s,a);Bi(h,r,i,Kc)&&nl(h,t,e,i,n)}}const Jc=new M,by=["x","y","z"];function yy(s,t,e,i){zt.setBuffer(s._roots[t]);const n=rl(0,s,e,i);return zt.clearBuffer(),n}function rl(s,t,e,i){const{float32Array:n,uint16Array:r,uint32Array:o}=zt;let a=s*2;if(_e(a,r)){const l=we(s,o),c=Pe(a,r);return hy(t,e,i,l,c)}else{const l=Eu(s,o),c=by[l],h=i.direction[c]>=0;let d,p;h?(d=Oe(s),p=Ie(s,o)):(d=Ie(s,o),p=Oe(s));const u=Bi(d,n,i,Jc)?rl(d,t,e,i):null;if(u){const m=u.point[c];if(h?m<=n[p+l]:m>=n[p+l+3])return u}const g=Bi(p,n,i,Jc)?rl(p,t,e,i):null;return u&&g?u.distance<=g.distance?u:g:u||g||null}}const Fr=new Ft,$s=new Ve,Ts=new Ve,Pn=new xt,th=new ue,jr=new ue;function vy(s,t,e,i){zt.setBuffer(s._roots[t]);const n=ol(0,s,e,i);return zt.clearBuffer(),n}function ol(s,t,e,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=zt;let l=s*2;if(n===null&&(e.boundingBox||e.computeBoundingBox(),th.set(e.boundingBox.min,e.boundingBox.max,i),n=th),_e(l,o)){const c=t.geometry,h=c.index,d=c.attributes.position,p=e.index,u=e.attributes.position,g=we(s,a),m=Pe(l,o);if(Pn.copy(i).invert(),e.boundsTree)return Lt(s,r,jr),jr.matrix.copy(Pn),jr.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:b=>jr.intersectsBox(b),intersectsTriangle:b=>{b.a.applyMatrix4(i),b.b.applyMatrix4(i),b.c.applyMatrix4(i),b.needsUpdate=!0;for(let f=g*3,y=(m+g)*3;f<y;f+=3)if(Ht(Ts,f,h,d),Ts.needsUpdate=!0,b.intersectsTriangle(Ts))return!0;return!1}});for(let b=g*3,f=(m+g)*3;b<f;b+=3){Ht($s,b,h,d),$s.a.applyMatrix4(Pn),$s.b.applyMatrix4(Pn),$s.c.applyMatrix4(Pn),$s.needsUpdate=!0;for(let y=0,_=p.count;y<_;y+=3)if(Ht(Ts,y,p,u),Ts.needsUpdate=!0,$s.intersectsTriangle(Ts))return!0}}else{const c=s+8,h=a[s+6];return Lt(c,r,Fr),!!(n.intersectsBox(Fr)&&ol(c,t,e,i,n)||(Lt(h,r,Fr),n.intersectsBox(Fr)&&ol(h,t,e,i,n)))}}const Hr=new xt,Ea=new ue,On=new ue,_y=new M,wy=new M,xy=new M,Cy=new M;function Ey(s,t,e,i={},n={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),Ea.set(t.boundingBox.min,t.boundingBox.max,e),Ea.needsUpdate=!0;const a=s.geometry,l=a.attributes.position,c=a.index,h=t.attributes.position,d=t.index,p=ke.getPrimitive(),u=ke.getPrimitive();let g=_y,m=wy,b=null,f=null;n&&(b=xy,f=Cy);let y=1/0,_=null,x=null;return Hr.copy(e).invert(),On.matrix.copy(Hr),s.shapecast({boundsTraverseOrder:C=>Ea.distanceToBox(C),intersectsBounds:(C,S,$)=>$<y&&$<o?(S&&(On.min.copy(C.min),On.max.copy(C.max),On.needsUpdate=!0),!0):!1,intersectsRange:(C,S)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:$=>On.distanceToBox($),intersectsBounds:($,O,z)=>z<y&&z<o,intersectsRange:($,O)=>{for(let z=$,D=$+O;z<D;z++){Ht(u,3*z,d,h),u.a.applyMatrix4(e),u.b.applyMatrix4(e),u.c.applyMatrix4(e),u.needsUpdate=!0;for(let j=C,A=C+S;j<A;j++){Ht(p,3*j,c,l),p.needsUpdate=!0;const k=p.distanceToTriangle(u,g,b);if(k<y&&(m.copy(g),f&&f.copy(b),y=k,_=j,x=z),k<r)return!0}}}});{const $=on(t);for(let O=0,z=$;O<z;O++){Ht(u,3*O,d,h),u.a.applyMatrix4(e),u.b.applyMatrix4(e),u.c.applyMatrix4(e),u.needsUpdate=!0;for(let D=C,j=C+S;D<j;D++){Ht(p,3*D,c,l),p.needsUpdate=!0;const A=p.distanceToTriangle(u,g,b);if(A<y&&(m.copy(g),f&&f.copy(b),y=A,_=D,x=O),A<r)return!0}}}}}),ke.releasePrimitive(p),ke.releasePrimitive(u),y===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=y,i.faceIndex=_,n&&(n.point?n.point.copy(f):n.point=f.clone(),n.point.applyMatrix4(Hr),m.applyMatrix4(Hr),n.distance=m.sub(n.point).length(),n.faceIndex=x),i)}function Sy(s,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=s.geometry,i=e.index?e.index.array:null,n=e.attributes.position;let r,o,a,l,c=0;const h=s._roots;for(let p=0,u=h.length;p<u;p++)r=h[p],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),d(0,c),c+=r.byteLength;function d(p,u,g=!1){const m=p*2;if(a[m+15]===qo){const b=o[p+6],f=a[m+14];let y=1/0,_=1/0,x=1/0,C=-1/0,S=-1/0,$=-1/0;for(let O=b,z=b+f;O<z;O++){const D=3*s.resolveTriangleIndex(O);for(let j=0;j<3;j++){let A=D+j;A=i?i[A]:A;const k=n.getX(A),v=n.getY(A),L=n.getZ(A);k<y&&(y=k),k>C&&(C=k),v<_&&(_=v),v>S&&(S=v),L<x&&(x=L),L>$&&($=L)}}return l[p+0]!==y||l[p+1]!==_||l[p+2]!==x||l[p+3]!==C||l[p+4]!==S||l[p+5]!==$?(l[p+0]=y,l[p+1]=_,l[p+2]=x,l[p+3]=C,l[p+4]=S,l[p+5]=$,!0):!1}else{const b=p+8,f=o[p+6],y=b+u,_=f+u;let x=g,C=!1,S=!1;t?x||(C=t.has(y),S=t.has(_),x=!C&&!S):(C=!0,S=!0);const $=x||C,O=x||S;let z=!1;$&&(z=d(b,u,x));let D=!1;O&&(D=d(f,u,x));const j=z||D;if(j)for(let A=0;A<3;A++){const k=b+A,v=f+A,L=l[k],X=l[k+3],V=l[v],J=l[v+3];l[p+A]=L<V?L:V,l[p+A+3]=X>J?X:J}return j}}}const eh=new M;function Ay(s,t,e,i,n){zt.setBuffer(s._roots[t]),al(0,s,e,i,n),zt.clearBuffer()}function al(s,t,e,i,n){const{float32Array:r,uint16Array:o,uint32Array:a}=zt,l=s*2;if(_e(l,o)){const c=we(s,a),h=Pe(l,o);py(t,e,i,c,h,n)}else{const c=Oe(s);Bi(c,r,i,eh)&&al(c,t,e,i,n);const h=Ie(s,a);Bi(h,r,i,eh)&&al(h,t,e,i,n)}}const ih=new M,$y=["x","y","z"];function Ty(s,t,e,i){zt.setBuffer(s._roots[t]);const n=ll(0,s,e,i);return zt.clearBuffer(),n}function ll(s,t,e,i){const{float32Array:n,uint16Array:r,uint32Array:o}=zt;let a=s*2;if(_e(a,r)){const l=we(s,o),c=Pe(a,r);return fy(t,e,i,l,c)}else{const l=Eu(s,o),c=$y[l],h=i.direction[c]>=0;let d,p;h?(d=Oe(s),p=Ie(s,o)):(d=Ie(s,o),p=Oe(s));const u=Bi(d,n,i,ih)?ll(d,t,e,i):null;if(u){const m=u.point[c];if(h?m<=n[p+l]:m>=n[p+l+3])return u}const g=Bi(p,n,i,ih)?ll(p,t,e,i):null;return u&&g?u.distance<=g.distance?u:g:u||g||null}}const Vr=new Ft,ks=new Ve,Ps=new Ve,In=new xt,sh=new ue,qr=new ue;function ky(s,t,e,i){zt.setBuffer(s._roots[t]);const n=cl(0,s,e,i);return zt.clearBuffer(),n}function cl(s,t,e,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=zt;let l=s*2;if(n===null&&(e.boundingBox||e.computeBoundingBox(),sh.set(e.boundingBox.min,e.boundingBox.max,i),n=sh),_e(l,o)){const c=t.geometry,h=c.index,d=c.attributes.position,p=e.index,u=e.attributes.position,g=we(s,a),m=Pe(l,o);if(In.copy(i).invert(),e.boundsTree)return Lt(s,r,qr),qr.matrix.copy(In),qr.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:b=>qr.intersectsBox(b),intersectsTriangle:b=>{b.a.applyMatrix4(i),b.b.applyMatrix4(i),b.c.applyMatrix4(i),b.needsUpdate=!0;for(let f=g,y=m+g;f<y;f++)if(Ht(Ps,3*t.resolveTriangleIndex(f),h,d),Ps.needsUpdate=!0,b.intersectsTriangle(Ps))return!0;return!1}});for(let b=g,f=m+g;b<f;b++){const y=t.resolveTriangleIndex(b);Ht(ks,3*y,h,d),ks.a.applyMatrix4(In),ks.b.applyMatrix4(In),ks.c.applyMatrix4(In),ks.needsUpdate=!0;for(let _=0,x=p.count;_<x;_+=3)if(Ht(Ps,_,p,u),Ps.needsUpdate=!0,ks.intersectsTriangle(Ps))return!0}}else{const c=s+8,h=a[s+6];return Lt(c,r,Vr),!!(n.intersectsBox(Vr)&&cl(c,t,e,i,n)||(Lt(h,r,Vr),n.intersectsBox(Vr)&&cl(h,t,e,i,n)))}}const Wr=new xt,Sa=new ue,zn=new ue,Py=new M,Oy=new M,Iy=new M,zy=new M;function Dy(s,t,e,i={},n={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),Sa.set(t.boundingBox.min,t.boundingBox.max,e),Sa.needsUpdate=!0;const a=s.geometry,l=a.attributes.position,c=a.index,h=t.attributes.position,d=t.index,p=ke.getPrimitive(),u=ke.getPrimitive();let g=Py,m=Oy,b=null,f=null;n&&(b=Iy,f=zy);let y=1/0,_=null,x=null;return Wr.copy(e).invert(),zn.matrix.copy(Wr),s.shapecast({boundsTraverseOrder:C=>Sa.distanceToBox(C),intersectsBounds:(C,S,$)=>$<y&&$<o?(S&&(zn.min.copy(C.min),zn.max.copy(C.max),zn.needsUpdate=!0),!0):!1,intersectsRange:(C,S)=>{if(t.boundsTree){const $=t.boundsTree;return $.shapecast({boundsTraverseOrder:O=>zn.distanceToBox(O),intersectsBounds:(O,z,D)=>D<y&&D<o,intersectsRange:(O,z)=>{for(let D=O,j=O+z;D<j;D++){const A=$.resolveTriangleIndex(D);Ht(u,3*A,d,h),u.a.applyMatrix4(e),u.b.applyMatrix4(e),u.c.applyMatrix4(e),u.needsUpdate=!0;for(let k=C,v=C+S;k<v;k++){const L=s.resolveTriangleIndex(k);Ht(p,3*L,c,l),p.needsUpdate=!0;const X=p.distanceToTriangle(u,g,b);if(X<y&&(m.copy(g),f&&f.copy(b),y=X,_=k,x=D),X<r)return!0}}}})}else{const $=on(t);for(let O=0,z=$;O<z;O++){Ht(u,3*O,d,h),u.a.applyMatrix4(e),u.b.applyMatrix4(e),u.c.applyMatrix4(e),u.needsUpdate=!0;for(let D=C,j=C+S;D<j;D++){const A=s.resolveTriangleIndex(D);Ht(p,3*A,c,l),p.needsUpdate=!0;const k=p.distanceToTriangle(u,g,b);if(k<y&&(m.copy(g),f&&f.copy(b),y=k,_=D,x=O),k<r)return!0}}}}}),ke.releasePrimitive(p),ke.releasePrimitive(u),y===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=y,i.faceIndex=_,n&&(n.point?n.point.copy(f):n.point=f.clone(),n.point.applyMatrix4(Wr),m.applyMatrix4(Wr),n.distance=m.sub(n.point).length(),n.faceIndex=x),i)}function My(){return typeof SharedArrayBuffer<"u"}const Vn=new zt.constructor,bo=new zt.constructor,Ai=new Xl(()=>new Ft),Os=new Ft,Is=new Ft,Aa=new Ft,$a=new Ft;let Ta=!1;function Ly(s,t,e,i){if(Ta)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Ta=!0;const n=s._roots,r=t._roots;let o,a=0,l=0;const c=new xt().copy(e).invert();for(let h=0,d=n.length;h<d;h++){Vn.setBuffer(n[h]),l=0;const p=Ai.getPrimitive();Lt(0,Vn.float32Array,p),p.applyMatrix4(c);for(let u=0,g=r.length;u<g&&(bo.setBuffer(r[h]),o=Re(0,0,e,c,i,a,l,0,0,p),bo.clearBuffer(),l+=r[u].length,!o);u++);if(Ai.releasePrimitive(p),Vn.clearBuffer(),a+=n[h].length,o)break}return Ta=!1,o}function Re(s,t,e,i,n,r=0,o=0,a=0,l=0,c=null,h=!1){let d,p;h?(d=bo,p=Vn):(d=Vn,p=bo);const u=d.float32Array,g=d.uint32Array,m=d.uint16Array,b=p.float32Array,f=p.uint32Array,y=p.uint16Array,_=s*2,x=t*2,C=_e(_,m),S=_e(x,y);let $=!1;if(S&&C)h?$=n(we(t,f),Pe(t*2,y),we(s,g),Pe(s*2,m),l,o+t,a,r+s):$=n(we(s,g),Pe(s*2,m),we(t,f),Pe(t*2,y),a,r+s,l,o+t);else if(S){const O=Ai.getPrimitive();Lt(t,b,O),O.applyMatrix4(e);const z=Oe(s),D=Ie(s,g);Lt(z,u,Os),Lt(D,u,Is);const j=O.intersectsBox(Os),A=O.intersectsBox(Is);$=j&&Re(t,z,i,e,n,o,r,l,a+1,O,!h)||A&&Re(t,D,i,e,n,o,r,l,a+1,O,!h),Ai.releasePrimitive(O)}else{const O=Oe(t),z=Ie(t,f);Lt(O,b,Aa),Lt(z,b,$a);const D=c.intersectsBox(Aa),j=c.intersectsBox($a);if(D&&j)$=Re(s,O,e,i,n,r,o,a,l+1,c,h)||Re(s,z,e,i,n,r,o,a,l+1,c,h);else if(D)if(C)$=Re(s,O,e,i,n,r,o,a,l+1,c,h);else{const A=Ai.getPrimitive();A.copy(Aa).applyMatrix4(e);const k=Oe(s),v=Ie(s,g);Lt(k,u,Os),Lt(v,u,Is);const L=A.intersectsBox(Os),X=A.intersectsBox(Is);$=L&&Re(O,k,i,e,n,o,r,l,a+1,A,!h)||X&&Re(O,v,i,e,n,o,r,l,a+1,A,!h),Ai.releasePrimitive(A)}else if(j)if(C)$=Re(s,z,e,i,n,r,o,a,l+1,c,h);else{const A=Ai.getPrimitive();A.copy($a).applyMatrix4(e);const k=Oe(s),v=Ie(s,g);Lt(k,u,Os),Lt(v,u,Is);const L=A.intersectsBox(Os),X=A.intersectsBox(Is);$=L&&Re(z,k,i,e,n,o,r,l,a+1,A,!h)||X&&Re(z,v,i,e,n,o,r,l,a+1,A,!h),Ai.releasePrimitive(A)}}return $}const Yr=new ue,nh=new Ft;let By=class Su{static serialize(t,e={}){e={cloneBuffers:!0,...e};const i=t.geometry,n=t._roots,r=t._indirectBuffer,o=i.getIndex();let a;return e.cloneBuffers?a={roots:n.map(l=>l.slice()),index:o.array.slice(),indirectBuffer:r?r.slice():null}:a={roots:n,index:o.array,indirectBuffer:r},a}static deserialize(t,e,i={}){i={setIndex:!0,indirect:!!t.indirectBuffer,...i};const{index:n,roots:r,indirectBuffer:o}=t,a=new Su(e,{...i,[_a]:!0});if(a._roots=r,a._indirectBuffer=o||null,i.setIndex){const l=e.getIndex();if(l===null){const c=new xe(t.index,1,!1);e.setIndex(c)}else l.array!==n&&(l.array.set(n),l.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({strategy:wu,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[_a]:!1},e),e.useSharedArrayBuffer&&!My())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[_a]||(Jb(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new Ft)));const{_indirectBuffer:i}=this;this.resolveTriangleIndex=e.indirect?n=>i[n]:n=>n}refit(t=null){return(this.indirect?Sy:uy)(this,t)}traverse(t,e=0){const i=this._roots[e],n=new Uint32Array(i),r=new Uint16Array(i);o(0);function o(a,l=0){const c=a*2,h=r[c+15]===qo;if(h){const d=n[a+6],p=r[c+14];t(l,h,new Float32Array(i,a*4,6),d,p)}else{const d=a+oo/4,p=n[a+6],u=n[a+7];t(l,h,new Float32Array(i,a*4,6),u)||(o(d,l+1),o(p,l+1))}}}raycast(t,e=Tc){const i=this._roots,n=this.geometry,r=[],o=e.isMaterial,a=Array.isArray(e),l=n.groups,c=o?e.side:e,h=this.indirect?Ay:gy;for(let d=0,p=i.length;d<p;d++){const u=a?e[l[d].materialIndex].side:c,g=r.length;if(h(this,d,u,t,r),a){const m=l[d].materialIndex;for(let b=g,f=r.length;b<f;b++)r[b].face.materialIndex=m}}return r}raycastFirst(t,e=Tc){const i=this._roots,n=this.geometry,r=e.isMaterial,o=Array.isArray(e);let a=null;const l=n.groups,c=r?e.side:e,h=this.indirect?Ty:yy;for(let d=0,p=i.length;d<p;d++){const u=o?e[l[d].materialIndex].side:c,g=h(this,d,u,t);g!=null&&(a==null||g.distance<a.distance)&&(a=g,o&&(g.face.materialIndex=l[d].materialIndex))}return a}intersectsGeometry(t,e){let i=!1;const n=this._roots,r=this.indirect?ky:vy;for(let o=0,a=n.length;o<a&&(i=r(this,o,t,e),!i);o++);return i}shapecast(t){const e=ke.getPrimitive(),i=this.indirect?my:dy;let{boundsTraverseOrder:n,intersectsBounds:r,intersectsRange:o,intersectsTriangle:a}=t;if(o&&a){const d=o;o=(p,u,g,m,b)=>d(p,u,g,m,b)?!0:i(p,u,this,a,g,m,e)}else o||(a?o=(d,p,u,g)=>i(d,p,this,a,u,g,e):o=(d,p,u)=>u);let l=!1,c=0;const h=this._roots;for(let d=0,p=h.length;d<p;d++){const u=h[d];if(l=ry(this,d,r,o,n,c),l)break;c+=u.byteLength}return ke.releasePrimitive(e),l}bvhcast(t,e,i){let{intersectsRanges:n,intersectsTriangles:r}=i;const o=ke.getPrimitive(),a=this.geometry.index,l=this.geometry.attributes.position,c=this.indirect?g=>{const m=this.resolveTriangleIndex(g);Ht(o,m*3,a,l)}:g=>{Ht(o,g*3,a,l)},h=ke.getPrimitive(),d=t.geometry.index,p=t.geometry.attributes.position,u=t.indirect?g=>{const m=t.resolveTriangleIndex(g);Ht(h,m*3,d,p)}:g=>{Ht(h,g*3,d,p)};if(r){const g=(m,b,f,y,_,x,C,S)=>{for(let $=f,O=f+y;$<O;$++){u($),h.a.applyMatrix4(e),h.b.applyMatrix4(e),h.c.applyMatrix4(e),h.needsUpdate=!0;for(let z=m,D=m+b;z<D;z++)if(c(z),o.needsUpdate=!0,r(o,h,z,$,_,x,C,S))return!0}return!1};if(n){const m=n;n=function(b,f,y,_,x,C,S,$){return m(b,f,y,_,x,C,S,$)?!0:g(b,f,y,_,x,C,S,$)}}else n=g}return Ly(this,t,e,n)}intersectsBox(t,e){return Yr.set(t.min,t.max,e),Yr.needsUpdate=!0,this.shapecast({intersectsBounds:i=>Yr.intersectsBox(i),intersectsTriangle:i=>Yr.intersectsTriangle(i)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,i={},n={},r=0,o=1/0){return(this.indirect?Dy:Ey)(this,t,e,i,n,r,o)}closestPointToPoint(t,e={},i=0,n=1/0){return oy(this,t,e,i,n)}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(e=>{Lt(0,new Float32Array(e),nh),t.union(nh)}),t}};function rh(s,t,e){return s===null||(s.point.applyMatrix4(t.matrixWorld),s.distance=s.point.distanceTo(e.ray.origin),s.object=t,s.distance<e.near||s.distance>e.far)?null:s}const ka=new Am,oh=new xt,Ny=rt.prototype.raycast;function Uy(s,t){if(this.geometry.boundsTree){if(this.material===void 0)return;oh.copy(this.matrixWorld).invert(),ka.copy(s.ray).applyMatrix4(oh);const e=this.geometry.boundsTree;if(s.firstHitOnly===!0){const i=rh(e.raycastFirst(ka,this.material),this,s);i&&t.push(i)}else{const i=e.raycast(ka,this.material);for(let n=0,r=i.length;n<r;n++){const o=rh(i[n],this,s);o&&t.push(o)}}}else Ny.call(this,s,t)}function Ry(s){return this.boundsTree=new By(this,s),this.boundsTree}function Fy(){this.boundsTree=null}const Au=class $u{constructor(){E(this,"onDisposed",new K),E(this,"list",new Nt),E(this,"enabled",!1),E(this,"_clock"),E(this,"onInit",new K),E(this,"update",()=>{if(!this.enabled)return;const t=this._clock.getDelta();for(const[e,i]of this.list)i.enabled&&i.isUpdateable()&&i.update(t);requestAnimationFrame(this.update)}),this._clock=new _m,$u.setupBVH()}add(t,e){if(this.list.has(t))throw new Error("You're trying to add a component that already exists in the components instance. Use Components.get() instead.");ie.validate(t),this.list.set(t,e)}get(t){const e=t.uuid;if(!this.list.has(e)){const i=new t(this);return i.isDisposeable()&&i.onDisposed.add(()=>this.list.delete(e)),this.list.has(e)||this.add(e,i),i}return this.list.get(e)}init(){this.enabled=!0;for(const[t,e]of this.list.entries())e.enabled=!0;this._clock.start(),this.update(),this.onInit.trigger()}dispose(){this.enabled=!1;let t;for(const[e,i]of this.list){if(i.enabled=!1,e===ut.uuid){t=i;continue}i.isDisposeable()&&i.dispose()}t==null||t.dispose(),this._clock.stop(),this.onDisposed.trigger()}static setupBVH(){se.prototype.computeBoundsTree=Ry,se.prototype.disposeBoundsTree=Fy,rt.prototype.raycast=Uy}};E(Au,"release","2.4.3");let Tu=Au,jy=class{constructor(t){E(this,"enabled",!1),E(this,"id","FirstPerson"),this.camera=t}set(t){if(this.enabled=t,t){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const t=this.camera.controls,e=new M;t.distance--,t.getPosition(e),t.minDistance=1,t.maxDistance=1,t.distance=1,t.moveTo(e.x,e.y,e.z),t.truckSpeed=50,t.mouseButtons.wheel=ve.ACTION.DOLLY,t.touches.two=ve.ACTION.TOUCH_ZOOM_TRUCK}},Hy=class{constructor(t){E(this,"enabled",!0),E(this,"id","Orbit"),this.camera=t,this.activateOrbitControls()}set(t){this.enabled=t,t&&this.activateOrbitControls()}activateOrbitControls(){const t=this.camera.controls;t.minDistance=1,t.maxDistance=300;const e=new M;t.getPosition(e);const i=e.length();t.distance=i,t.truckSpeed=2;const{rotation:n}=this.camera.three,r=new M(0,0,-1).applyEuler(n),o=e.addScaledVector(r,i);t.moveTo(o.x,o.y,o.z)}},Vy=class{constructor(t){E(this,"enabled",!1),E(this,"id","Plan"),E(this,"mouseAction1"),E(this,"mouseAction2"),E(this,"mouseInitialized",!1),E(this,"defaultAzimuthSpeed"),E(this,"defaultPolarSpeed"),this.camera=t,this.defaultAzimuthSpeed=t.controls.azimuthRotateSpeed,this.defaultPolarSpeed=t.controls.polarRotateSpeed}set(t){this.enabled=t;const e=this.camera.controls;e.azimuthRotateSpeed=t?0:this.defaultAzimuthSpeed,e.polarRotateSpeed=t?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=e.touches.one,this.mouseAction2=e.touches.two,this.mouseInitialized=!0),t?(e.mouseButtons.left=ve.ACTION.TRUCK,e.touches.one=ve.ACTION.TOUCH_TRUCK,e.touches.two=ve.ACTION.TOUCH_ZOOM):(e.mouseButtons.left=ve.ACTION.ROTATE,e.touches.one=this.mouseAction1,e.touches.two=this.mouseAction2)}},qy=class{constructor(t){E(this,"onChanged",new K),E(this,"current","Perspective"),E(this,"camera"),E(this,"matchOrthoDistanceEnabled",!1),E(this,"_component"),E(this,"_previousDistance",-1),this._component=t,this.camera=t.three}async set(t){this.current!==t&&(t==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const t=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(t)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const t=this.getPerspectiveDims();if(!t)return;const{width:e,height:i}=t;this.setupOrthoCamera(i,e),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const t=this._component.currentWorld;if(!t||!t.renderer)return null;const e=new M;this._component.threePersp.getWorldDirection(e);const i=new M;this._component.controls.getTarget(i);const n=i.clone().sub(this._component.threePersp.position).dot(e),r=t.renderer.getSize(),o=r.x/r.y,a=this._component.threePersp,l=n*2*Math.atan(a.fov*(Math.PI/180)/2);return{width:l*o,height:l}}setupOrthoCamera(t,e){this._component.controls.mouseButtons.wheel=ve.ACTION.ZOOM,this._component.controls.mouseButtons.middle=ve.ACTION.ZOOM;const i=this._component.threePersp,n=this._component.threeOrtho;n.zoom=1,n.left=e/-2,n.right=e/2,n.top=t/2,n.bottom=t/-2,n.updateProjectionMatrix(),n.position.copy(i.position),n.quaternion.copy(i.quaternion),this._component.controls.camera=n}getDistance(){const t=this._component.threePersp,e=this._component.threeOrtho;return(e.top-e.bottom)/e.zoom/(2*Math.atan(t.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=ve.ACTION.DOLLY,this._component.controls.mouseButtons.middle=ve.ACTION.DOLLY;const t=this._component.threePersp,e=this._component.threeOrtho;t.position.copy(e.position),t.quaternion.copy(e.quaternion),this._component.controls.mouseButtons.wheel=ve.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),t.updateProjectionMatrix(),this._component.controls.camera=t,this.camera=t,this.current="Perspective"}},ku=class extends il{constructor(t){super(t),E(this,"projection"),E(this,"threeOrtho"),E(this,"threePersp"),E(this,"_userInputButtons",{}),E(this,"_frustumSize",50),E(this,"_navigationModes",new Map),E(this,"_mode",null),E(this,"previousSize",null),this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new qy(this),this.onAspectUpdated.add(()=>{this.setOrthoPerspCameraAspect()}),this.projection.onChanged.add(e=>{this.three=e,this.updateAspect()}),this.worlds.onItemSet.add(()=>{this._navigationModes.clear(),this._navigationModes.set("Orbit",new Hy(this)),this._navigationModes.set("FirstPerson",new jy(this)),this._navigationModes.set("Plan",new Vy(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0}),this.currentWorld&&this.currentWorld.renderer&&(this.previousSize=this.currentWorld.renderer.getSize().clone())}),this.worlds.onItemDeleted.add(()=>{this._navigationModes.clear()})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(t){if(this.mode!==null&&this.mode.id!==t){if(this.mode.set(!1),!this._navigationModes.has(t))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(t),this.mode.set(!0)}}async fit(t,e=1.5){if(!this.enabled)return;const i=Number.MAX_VALUE,n=Number.MIN_VALUE,r=new M(i,i,i),o=new M(n,n,n);for(const u of t){const g=new Ft().setFromObject(u);g.min.x<r.x&&(r.x=g.min.x),g.min.y<r.y&&(r.y=g.min.y),g.min.z<r.z&&(r.z=g.min.z),g.max.x>o.x&&(o.x=g.max.x),g.max.y>o.y&&(o.y=g.max.y),g.max.z>o.z&&(o.z=g.max.z)}const a=new Ft(r,o),l=this.components.get(ut);if(l.initialized)for(const[,u]of l.list){const g=u.box;g.min.x<r.x&&(r.x=g.min.x),g.min.y<r.y&&(r.y=g.min.y),g.min.z<r.z&&(r.z=g.min.z),g.max.x>o.x&&(o.x=g.max.x),g.max.y>o.y&&(o.y=g.max.y),g.max.z>o.z&&(o.z=g.max.z)}const c=new M;a.getSize(c);const h=new M;a.getCenter(h);const d=Math.max(c.x,c.y,c.z)*e,p=new Di(h,d);await this.controls.fitToSphere(p,!0)}setUserInput(t){t?this.enableUserInput():this.disableUserInput()}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const t=window.innerWidth/window.innerHeight;return new Bo(this._frustumSize*t/-2,this._frustumSize*t/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoPerspCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer||!this.previousSize)return;const t=this.currentWorld.renderer.getSize(),e=this.threeOrtho.top,i=this.threeOrtho.right,n=t.y/this.previousSize.y,r=t.x/this.previousSize.x,o=e*n,a=i*r;this.threeOrtho.left=-a,this.threeOrtho.right=a,this.threeOrtho.top=o,this.threeOrtho.bottom=-o,this.threeOrtho.updateProjectionMatrix(),this.previousSize.copy(t)}};function Zr(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Pu={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(s,t){(function(e){s.exports=e()})(function(){return function e(i,n,r){function o(c,h){if(!n[c]){if(!i[c]){var d=typeof Zr=="function"&&Zr;if(!h&&d)return d(c,!0);if(a)return a(c,!0);var p=new Error("Cannot find module '"+c+"'");throw p.code="MODULE_NOT_FOUND",p}var u=n[c]={exports:{}};i[c][0].call(u.exports,function(g){var m=i[c][1][g];return o(m||g)},u,u.exports,e,i,n,r)}return n[c].exports}for(var a=typeof Zr=="function"&&Zr,l=0;l<r.length;l++)o(r[l]);return o}({1:[function(e,i,n){var r=e("./utils"),o=e("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(l){for(var c,h,d,p,u,g,m,b=[],f=0,y=l.length,_=y,x=r.getTypeOf(l)!=="string";f<l.length;)_=y-f,d=x?(c=l[f++],h=f<y?l[f++]:0,f<y?l[f++]:0):(c=l.charCodeAt(f++),h=f<y?l.charCodeAt(f++):0,f<y?l.charCodeAt(f++):0),p=c>>2,u=(3&c)<<4|h>>4,g=1<_?(15&h)<<2|d>>6:64,m=2<_?63&d:64,b.push(a.charAt(p)+a.charAt(u)+a.charAt(g)+a.charAt(m));return b.join("")},n.decode=function(l){var c,h,d,p,u,g,m=0,b=0,f="data:";if(l.substr(0,f.length)===f)throw new Error("Invalid base64 input, it looks like a data url.");var y,_=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&_--,l.charAt(l.length-2)===a.charAt(64)&&_--,_%1!=0)throw new Error("Invalid base64 input, bad content length.");for(y=o.uint8array?new Uint8Array(0|_):new Array(0|_);m<l.length;)c=a.indexOf(l.charAt(m++))<<2|(p=a.indexOf(l.charAt(m++)))>>4,h=(15&p)<<4|(u=a.indexOf(l.charAt(m++)))>>2,d=(3&u)<<6|(g=a.indexOf(l.charAt(m++))),y[b++]=c,u!==64&&(y[b++]=h),g!==64&&(y[b++]=d);return y}},{"./support":30,"./utils":32}],2:[function(e,i,n){var r=e("./external"),o=e("./stream/DataWorker"),a=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function c(h,d,p,u,g){this.compressedSize=h,this.uncompressedSize=d,this.crc32=p,this.compression=u,this.compressedContent=g}c.prototype={getContentWorker:function(){var h=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return h.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(h,d,p){return h.pipe(new a).pipe(new l("uncompressedSize")).pipe(d.compressWorker(p)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},i.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,i,n){var r=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,i,n){var r=e("./utils"),o=function(){for(var a,l=[],c=0;c<256;c++){a=c;for(var h=0;h<8;h++)a=1&a?3988292384^a>>>1:a>>>1;l[c]=a}return l}();i.exports=function(a,l){return a!==void 0&&a.length?r.getTypeOf(a)!=="string"?function(c,h,d,p){var u=o,g=p+d;c^=-1;for(var m=p;m<g;m++)c=c>>>8^u[255&(c^h[m])];return-1^c}(0|l,a,a.length,0):function(c,h,d,p){var u=o,g=p+d;c^=-1;for(var m=p;m<g;m++)c=c>>>8^u[255&(c^h.charCodeAt(m))];return-1^c}(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(e,i,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,i,n){var r=null;r=typeof Promise<"u"?Promise:e("lie"),i.exports={Promise:r}},{lie:37}],7:[function(e,i,n){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=e("pako"),a=e("./utils"),l=e("./stream/GenericWorker"),c=r?"uint8array":"array";function h(d,p){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=p,this.meta={}}n.magic="\b\0",a.inherits(h,l),h.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,d.data),!1)},h.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(p){d.push({data:p,meta:d.meta})}},n.compressWorker=function(d){return new h("Deflate",d)},n.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,i,n){function r(u,g){var m,b="";for(m=0;m<g;m++)b+=String.fromCharCode(255&u),u>>>=8;return b}function o(u,g,m,b,f,y){var _,x,C=u.file,S=u.compression,$=y!==c.utf8encode,O=a.transformTo("string",y(C.name)),z=a.transformTo("string",c.utf8encode(C.name)),D=C.comment,j=a.transformTo("string",y(D)),A=a.transformTo("string",c.utf8encode(D)),k=z.length!==C.name.length,v=A.length!==D.length,L="",X="",V="",J=C.dir,Y=C.date,nt={crc32:0,compressedSize:0,uncompressedSize:0};g&&!m||(nt.crc32=u.crc32,nt.compressedSize=u.compressedSize,nt.uncompressedSize=u.uncompressedSize);var U=0;g&&(U|=8),$||!k&&!v||(U|=2048);var N=0,ot=0;J&&(N|=16),f==="UNIX"?(ot=798,N|=function(et,pt){var ft=et;return et||(ft=pt?16893:33204),(65535&ft)<<16}(C.unixPermissions,J)):(ot=20,N|=function(et){return 63&(et||0)}(C.dosPermissions)),_=Y.getUTCHours(),_<<=6,_|=Y.getUTCMinutes(),_<<=5,_|=Y.getUTCSeconds()/2,x=Y.getUTCFullYear()-1980,x<<=4,x|=Y.getUTCMonth()+1,x<<=5,x|=Y.getUTCDate(),k&&(X=r(1,1)+r(h(O),4)+z,L+="up"+r(X.length,2)+X),v&&(V=r(1,1)+r(h(j),4)+A,L+="uc"+r(V.length,2)+V);var it="";return it+=`
\0`,it+=r(U,2),it+=S.magic,it+=r(_,2),it+=r(x,2),it+=r(nt.crc32,4),it+=r(nt.compressedSize,4),it+=r(nt.uncompressedSize,4),it+=r(O.length,2),it+=r(L.length,2),{fileRecord:d.LOCAL_FILE_HEADER+it+O+L,dirRecord:d.CENTRAL_FILE_HEADER+r(ot,2)+it+r(j.length,2)+"\0\0\0\0"+r(N,4)+r(b,4)+O+L+j}}var a=e("../utils"),l=e("../stream/GenericWorker"),c=e("../utf8"),h=e("../crc32"),d=e("../signature");function p(u,g,m,b){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=m,this.encodeFileName=b,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(p,l),p.prototype.push=function(u){var g=u.meta.percent||0,m=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,l.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:m?(g+100*(m-b-1))/m:100}}))},p.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var g=this.streamFiles&&!u.file.dir;if(g){var m=o(u,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},p.prototype.closedSource=function(u){this.accumulate=!1;var g=this.streamFiles&&!u.file.dir,m=o(u,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),g)this.push({data:function(b){return d.DATA_DESCRIPTOR+r(b.crc32,4)+r(b.compressedSize,4)+r(b.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},p.prototype.flush=function(){for(var u=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var m=this.bytesWritten-u,b=function(f,y,_,x,C){var S=a.transformTo("string",C(x));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(f,2)+r(f,2)+r(y,4)+r(_,4)+r(S.length,2)+S}(this.dirRecords.length,m,u,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},p.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},p.prototype.registerPrevious=function(u){this._sources.push(u);var g=this;return u.on("data",function(m){g.processChunk(m)}),u.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),u.on("error",function(m){g.error(m)}),this},p.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},p.prototype.error=function(u){var g=this._sources;if(!l.prototype.error.call(this,u))return!1;for(var m=0;m<g.length;m++)try{g[m].error(u)}catch{}return!0},p.prototype.lock=function(){l.prototype.lock.call(this);for(var u=this._sources,g=0;g<u.length;g++)u[g].lock()},i.exports=p},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,i,n){var r=e("../compressions"),o=e("./ZipFileWorker");n.generateWorker=function(a,l,c){var h=new o(l.streamFiles,c,l.platform,l.encodeFileName),d=0;try{a.forEach(function(p,u){d++;var g=function(y,_){var x=y||_,C=r[x];if(!C)throw new Error(x+" is not a valid compression method !");return C}(u.options.compression,l.compression),m=u.options.compressionOptions||l.compressionOptions||{},b=u.dir,f=u.date;u._compressWorker(g,m).withStreamInfo("file",{name:p,dir:b,date:f,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(h)}),h.entriesCount=d}catch(p){h.error(p)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,i,n){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new r;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(r.prototype=e("./object")).loadAsync=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.version="3.10.1",r.loadAsync=function(o,a){return new r().loadAsync(o,a)},r.external=e("./external"),i.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,i,n){var r=e("./utils"),o=e("./external"),a=e("./utf8"),l=e("./zipEntries"),c=e("./stream/Crc32Probe"),h=e("./nodejsUtils");function d(p){return new o.Promise(function(u,g){var m=p.decompressed.getContentWorker().pipe(new c);m.on("error",function(b){g(b)}).on("end",function(){m.streamInfo.crc32!==p.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}i.exports=function(p,u){var g=this;return u=r.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),h.isNode&&h.isStream(p)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",p,!0,u.optimizedBinaryString,u.base64).then(function(m){var b=new l(u);return b.load(m),b}).then(function(m){var b=[o.Promise.resolve(m)],f=m.files;if(u.checkCRC32)for(var y=0;y<f.length;y++)b.push(d(f[y]));return o.Promise.all(b)}).then(function(m){for(var b=m.shift(),f=b.files,y=0;y<f.length;y++){var _=f[y],x=_.fileNameStr,C=r.resolve(_.fileNameStr);g.file(C,_.decompressed,{binary:!0,optimizedBinaryString:!0,date:_.date,dir:_.dir,comment:_.fileCommentStr.length?_.fileCommentStr:null,unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions,createFolders:u.createFolders}),_.dir||(g.file(C).unsafeOriginalName=x)}return b.zipComment.length&&(g.comment=b.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,i,n){var r=e("../utils"),o=e("../stream/GenericWorker");function a(l,c){o.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}r.inherits(a,o),a.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(h){c.push({data:h,meta:{percent:0}})}).on("error",function(h){c.isPaused?this.generatedError=h:c.error(h)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,i,n){var r=e("readable-stream").Readable;function o(a,l,c){r.call(this,l),this._helper=a;var h=this;a.on("data",function(d,p){h.push(d)||h._helper.pause(),c&&c(p)}).on("error",function(d){h.emit("error",d)}).on("end",function(){h.push(null)})}e("../utils").inherits(o,r),o.prototype._read=function(){this._helper.resume()},i.exports=o},{"../utils":32,"readable-stream":16}],14:[function(e,i,n){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,o);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,o)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var o=new Buffer(r);return o.fill(0),o},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(e,i,n){function r(C,S,$){var O,z=a.getTypeOf(S),D=a.extend($||{},h);D.date=D.date||new Date,D.compression!==null&&(D.compression=D.compression.toUpperCase()),typeof D.unixPermissions=="string"&&(D.unixPermissions=parseInt(D.unixPermissions,8)),D.unixPermissions&&16384&D.unixPermissions&&(D.dir=!0),D.dosPermissions&&16&D.dosPermissions&&(D.dir=!0),D.dir&&(C=f(C)),D.createFolders&&(O=b(C))&&y.call(this,O,!0);var j=z==="string"&&D.binary===!1&&D.base64===!1;$&&$.binary!==void 0||(D.binary=!j),(S instanceof d&&S.uncompressedSize===0||D.dir||!S||S.length===0)&&(D.base64=!1,D.binary=!0,S="",D.compression="STORE",z="string");var A=null;A=S instanceof d||S instanceof l?S:g.isNode&&g.isStream(S)?new m(C,S):a.prepareContent(C,S,D.binary,D.optimizedBinaryString,D.base64);var k=new p(C,A,D);this.files[C]=k}var o=e("./utf8"),a=e("./utils"),l=e("./stream/GenericWorker"),c=e("./stream/StreamHelper"),h=e("./defaults"),d=e("./compressedObject"),p=e("./zipObject"),u=e("./generate"),g=e("./nodejsUtils"),m=e("./nodejs/NodejsStreamInputAdapter"),b=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var S=C.lastIndexOf("/");return 0<S?C.substring(0,S):""},f=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},y=function(C,S){return S=S!==void 0?S:h.createFolders,C=f(C),this.files[C]||r.call(this,C,null,{dir:!0,createFolders:S}),this.files[C]};function _(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var x={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var S,$,O;for(S in this.files)O=this.files[S],($=S.slice(this.root.length,S.length))&&S.slice(0,this.root.length)===this.root&&C($,O)},filter:function(C){var S=[];return this.forEach(function($,O){C($,O)&&S.push(O)}),S},file:function(C,S,$){if(arguments.length!==1)return C=this.root+C,r.call(this,C,S,$),this;if(_(C)){var O=C;return this.filter(function(D,j){return!j.dir&&O.test(D)})}var z=this.files[this.root+C];return z&&!z.dir?z:null},folder:function(C){if(!C)return this;if(_(C))return this.filter(function(z,D){return D.dir&&C.test(z)});var S=this.root+C,$=y.call(this,S),O=this.clone();return O.root=$.name,O},remove:function(C){C=this.root+C;var S=this.files[C];if(S||(C.slice(-1)!=="/"&&(C+="/"),S=this.files[C]),S&&!S.dir)delete this.files[C];else for(var $=this.filter(function(z,D){return D.name.slice(0,C.length)===C}),O=0;O<$.length;O++)delete this.files[$[O].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var S,$={};try{if(($=a.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=$.type.toLowerCase(),$.compression=$.compression.toUpperCase(),$.type==="binarystring"&&($.type="string"),!$.type)throw new Error("No output type specified.");a.checkSupport($.type),$.platform!=="darwin"&&$.platform!=="freebsd"&&$.platform!=="linux"&&$.platform!=="sunos"||($.platform="UNIX"),$.platform==="win32"&&($.platform="DOS");var O=$.comment||this.comment||"";S=u.generateWorker(this,$,O)}catch(z){(S=new l("error")).error(z)}return new c(S,$.type||"string",$.mimeType)},generateAsync:function(C,S){return this.generateInternalStream(C).accumulate(S)},generateNodeStream:function(C,S){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(S)}};i.exports=x},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,i,n){i.exports=e("stream")},{stream:void 0}],17:[function(e,i,n){var r=e("./DataReader");function o(a){r.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}e("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),c=a.charCodeAt(1),h=a.charCodeAt(2),d=a.charCodeAt(3),p=this.length-4;0<=p;--p)if(this.data[p]===l&&this.data[p+1]===c&&this.data[p+2]===h&&this.data[p+3]===d)return p-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),c=a.charCodeAt(1),h=a.charCodeAt(2),d=a.charCodeAt(3),p=this.readData(4);return l===p[0]&&c===p[1]&&h===p[2]&&d===p[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./DataReader":18}],18:[function(e,i,n){var r=e("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,c=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=a,c},readString:function(a){return r.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},i.exports=o},{"../utils":32}],19:[function(e,i,n){var r=e("./Uint8ArrayReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,i,n){var r=e("./DataReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./DataReader":18}],21:[function(e,i,n){var r=e("./ArrayReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(e,i,n){var r=e("../utils"),o=e("../support"),a=e("./ArrayReader"),l=e("./StringReader"),c=e("./NodeBufferReader"),h=e("./Uint8ArrayReader");i.exports=function(d){var p=r.getTypeOf(d);return r.checkSupport(p),p!=="string"||o.uint8array?p==="nodebuffer"?new c(d):o.uint8array?new h(r.transformTo("uint8array",d)):new a(r.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,i,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,i,n){var r=e("./GenericWorker"),o=e("../utils");function a(l){r.call(this,"ConvertWorker to "+l),this.destType=l}o.inherits(a,r),a.prototype.processChunk=function(l){this.push({data:o.transformTo(this.destType,l.data),meta:l.meta})},i.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,i,n){var r=e("./GenericWorker"),o=e("../crc32");function a(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(a,r),a.prototype.processChunk=function(l){this.streamInfo.crc32=o(l.data,this.streamInfo.crc32||0),this.push(l)},i.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,i,n){var r=e("../utils"),o=e("./GenericWorker");function a(l){o.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}r.inherits(a,o),a.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}o.prototype.processChunk.call(this,l)},i.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,i,n){var r=e("../utils"),o=e("./GenericWorker");function a(l){o.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(h){c.dataIsReady=!0,c.data=h,c.max=h&&h.length||0,c.type=r.getTypeOf(h),c.isPaused||c._tickAndRepeat()},function(h){c.error(h)})}r.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(e,i,n){function r(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var l=0;l<this._listeners[o].length;l++)this._listeners[o][l].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(l){a.processChunk(l)}),o.on("end",function(){a.end()}),o.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},i.exports=r},{}],29:[function(e,i,n){var r=e("../utils"),o=e("./ConvertWorker"),a=e("./GenericWorker"),l=e("../base64"),c=e("../support"),h=e("../external"),d=null;if(c.nodestream)try{d=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function p(g,m){return new h.Promise(function(b,f){var y=[],_=g._internalType,x=g._outputType,C=g._mimeType;g.on("data",function(S,$){y.push(S),m&&m($)}).on("error",function(S){y=[],f(S)}).on("end",function(){try{var S=function($,O,z){switch($){case"blob":return r.newBlob(r.transformTo("arraybuffer",O),z);case"base64":return l.encode(O);default:return r.transformTo($,O)}}(x,function($,O){var z,D=0,j=null,A=0;for(z=0;z<O.length;z++)A+=O[z].length;switch($){case"string":return O.join("");case"array":return Array.prototype.concat.apply([],O);case"uint8array":for(j=new Uint8Array(A),z=0;z<O.length;z++)j.set(O[z],D),D+=O[z].length;return j;case"nodebuffer":return Buffer.concat(O);default:throw new Error("concat : unsupported type '"+$+"'")}}(_,y),C);b(S)}catch($){f($)}y=[]}).resume()})}function u(g,m,b){var f=m;switch(m){case"blob":case"arraybuffer":f="uint8array";break;case"base64":f="string"}try{this._internalType=f,this._outputType=m,this._mimeType=b,r.checkSupport(f),this._worker=g.pipe(new o(f)),g.lock()}catch(y){this._worker=new a("error"),this._worker.error(y)}}u.prototype={accumulate:function(g){return p(this,g)},on:function(g,m){var b=this;return g==="data"?this._worker.on(g,function(f){m.call(b,f.data,f.meta)}):this._worker.on(g,function(){r.delay(m,arguments,b)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},g)}},i.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,i,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var r=new ArrayBuffer(0);try{n.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(r),n.blob=o.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(e,i,n){for(var r=e("./utils"),o=e("./support"),a=e("./nodejsUtils"),l=e("./stream/GenericWorker"),c=new Array(256),h=0;h<256;h++)c[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;c[254]=c[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}function p(){l.call(this,"utf-8 encode")}n.utf8encode=function(u){return o.nodebuffer?a.newBufferFrom(u,"utf-8"):function(g){var m,b,f,y,_,x=g.length,C=0;for(y=0;y<x;y++)(64512&(b=g.charCodeAt(y)))==55296&&y+1<x&&(64512&(f=g.charCodeAt(y+1)))==56320&&(b=65536+(b-55296<<10)+(f-56320),y++),C+=b<128?1:b<2048?2:b<65536?3:4;for(m=o.uint8array?new Uint8Array(C):new Array(C),y=_=0;_<C;y++)(64512&(b=g.charCodeAt(y)))==55296&&y+1<x&&(64512&(f=g.charCodeAt(y+1)))==56320&&(b=65536+(b-55296<<10)+(f-56320),y++),b<128?m[_++]=b:(b<2048?m[_++]=192|b>>>6:(b<65536?m[_++]=224|b>>>12:(m[_++]=240|b>>>18,m[_++]=128|b>>>12&63),m[_++]=128|b>>>6&63),m[_++]=128|63&b);return m}(u)},n.utf8decode=function(u){return o.nodebuffer?r.transformTo("nodebuffer",u).toString("utf-8"):function(g){var m,b,f,y,_=g.length,x=new Array(2*_);for(m=b=0;m<_;)if((f=g[m++])<128)x[b++]=f;else if(4<(y=c[f]))x[b++]=65533,m+=y-1;else{for(f&=y===2?31:y===3?15:7;1<y&&m<_;)f=f<<6|63&g[m++],y--;1<y?x[b++]=65533:f<65536?x[b++]=f:(f-=65536,x[b++]=55296|f>>10&1023,x[b++]=56320|1023&f)}return x.length!==b&&(x.subarray?x=x.subarray(0,b):x.length=b),r.applyFromCharCode(x)}(u=r.transformTo(o.uint8array?"uint8array":"array",u))},r.inherits(d,l),d.prototype.processChunk=function(u){var g=r.transformTo(o.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=g;(g=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),g.set(m,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var b=function(y,_){var x;for((_=_||y.length)>y.length&&(_=y.length),x=_-1;0<=x&&(192&y[x])==128;)x--;return x<0||x===0?_:x+c[y[x]]>_?x:_}(g),f=g;b!==g.length&&(o.uint8array?(f=g.subarray(0,b),this.leftOver=g.subarray(b,g.length)):(f=g.slice(0,b),this.leftOver=g.slice(b,g.length))),this.push({data:n.utf8decode(f),meta:u.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=d,r.inherits(p,l),p.prototype.processChunk=function(u){this.push({data:n.utf8encode(u.data),meta:u.meta})},n.Utf8EncodeWorker=p},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,i,n){var r=e("./support"),o=e("./base64"),a=e("./nodejsUtils"),l=e("./external");function c(m){return m}function h(m,b){for(var f=0;f<m.length;++f)b[f]=255&m.charCodeAt(f);return b}e("setimmediate"),n.newBlob=function(m,b){n.checkSupport("blob");try{return new Blob([m],{type:b})}catch{try{var f=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return f.append(m),f.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(m,b,f){var y=[],_=0,x=m.length;if(x<=f)return String.fromCharCode.apply(null,m);for(;_<x;)b==="array"||b==="nodebuffer"?y.push(String.fromCharCode.apply(null,m.slice(_,Math.min(_+f,x)))):y.push(String.fromCharCode.apply(null,m.subarray(_,Math.min(_+f,x)))),_+=f;return y.join("")},stringifyByChar:function(m){for(var b="",f=0;f<m.length;f++)b+=String.fromCharCode(m[f]);return b},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function p(m){var b=65536,f=n.getTypeOf(m),y=!0;if(f==="uint8array"?y=d.applyCanBeUsed.uint8array:f==="nodebuffer"&&(y=d.applyCanBeUsed.nodebuffer),y)for(;1<b;)try{return d.stringifyByChunk(m,f,b)}catch{b=Math.floor(b/2)}return d.stringifyByChar(m)}function u(m,b){for(var f=0;f<m.length;f++)b[f]=m[f];return b}n.applyFromCharCode=p;var g={};g.string={string:c,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return g.string.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:function(m){return h(m,a.allocBuffer(m.length))}},g.array={string:p,array:c,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},g.arraybuffer={string:function(m){return p(new Uint8Array(m))},array:function(m){return u(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:c,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},g.uint8array={string:p,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:c,nodebuffer:function(m){return a.newBufferFrom(m)}},g.nodebuffer={string:p,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return g.nodebuffer.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:c},n.transformTo=function(m,b){if(b=b||"",!m)return b;n.checkSupport(m);var f=n.getTypeOf(b);return g[f][m](b)},n.resolve=function(m){for(var b=m.split("/"),f=[],y=0;y<b.length;y++){var _=b[y];_==="."||_===""&&y!==0&&y!==b.length-1||(_===".."?f.pop():f.push(_))}return f.join("/")},n.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":r.nodebuffer&&a.isBuffer(m)?"nodebuffer":r.uint8array&&m instanceof Uint8Array?"uint8array":r.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(m){if(!r[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(m){var b,f,y="";for(f=0;f<(m||"").length;f++)y+="\\x"+((b=m.charCodeAt(f))<16?"0":"")+b.toString(16).toUpperCase();return y},n.delay=function(m,b,f){setImmediate(function(){m.apply(f||null,b||[])})},n.inherits=function(m,b){function f(){}f.prototype=b.prototype,m.prototype=new f},n.extend=function(){var m,b,f={};for(m=0;m<arguments.length;m++)for(b in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],b)&&f[b]===void 0&&(f[b]=arguments[m][b]);return f},n.prepareContent=function(m,b,f,y,_){return l.Promise.resolve(b).then(function(x){return r.blob&&(x instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(x))!==-1)&&typeof FileReader<"u"?new l.Promise(function(C,S){var $=new FileReader;$.onload=function(O){C(O.target.result)},$.onerror=function(O){S(O.target.error)},$.readAsArrayBuffer(x)}):x}).then(function(x){var C=n.getTypeOf(x);return C?(C==="arraybuffer"?x=n.transformTo("uint8array",x):C==="string"&&(_?x=o.decode(x):f&&y!==!0&&(x=function(S){return h(S,r.uint8array?new Uint8Array(S.length):new Array(S.length))}(x))),x):l.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,i,n){var r=e("./reader/readerFor"),o=e("./utils"),a=e("./signature"),l=e("./zipEntry"),c=e("./support");function h(d){this.files=[],this.loadOptions=d}h.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var p=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(p)+", expected "+o.pretty(d)+")")}},isSignature:function(d,p){var u=this.reader.index;this.reader.setIndex(d);var g=this.reader.readString(4)===p;return this.reader.setIndex(u),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),p=c.uint8array?"uint8array":"array",u=o.transformTo(p,d);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,p,u,g=this.zip64EndOfCentralSize-44;0<g;)d=this.reader.readInt(2),p=this.reader.readInt(4),u=this.reader.readData(p),this.zip64ExtensibleData[d]={id:d,length:p,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,p;for(d=0;d<this.files.length;d++)p=this.files[d],this.reader.setIndex(p.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),p.readLocalPart(this.reader),p.handleUTF8(),p.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var p=d;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var g=p-u;if(0<g)this.isSignature(p,a.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(d){this.reader=r(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,i,n){var r=e("./reader/readerFor"),o=e("./utils"),a=e("./compressedObject"),l=e("./crc32"),c=e("./utf8"),h=e("./compressions"),d=e("./support");function p(u,g){this.options=u,this.loadOptions=g}p.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var g,m;if(u.skip(22),this.fileNameLength=u.readInt(2),m=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=function(b){for(var f in h)if(Object.prototype.hasOwnProperty.call(h,f)&&h[f].magic===b)return h[f];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,g,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var g=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(g),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var g,m,b,f=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<f;)g=u.readInt(2),m=u.readInt(2),b=u.readData(m),this.extraFields[g]={id:g,length:m,value:b};u.setIndex(f)},handleUTF8:function(){var u=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var m=o.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var f=o.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(f)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var g=r(u.value);return g.readInt(1)!==1||l(this.fileName)!==g.readInt(4)?null:c.utf8decode(g.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var g=r(u.value);return g.readInt(1)!==1||l(this.fileComment)!==g.readInt(4)?null:c.utf8decode(g.readData(u.length-5))}return null}},i.exports=p},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,i,n){function r(g,m,b){this.name=g,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=m,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=e("./stream/StreamHelper"),a=e("./stream/DataWorker"),l=e("./utf8"),c=e("./compressedObject"),h=e("./stream/GenericWorker");r.prototype={internalStream:function(g){var m=null,b="string";try{if(!g)throw new Error("No output type specified.");var f=(b=g.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),m=this._decompressWorker();var y=!this._dataBinary;y&&!f&&(m=m.pipe(new l.Utf8EncodeWorker)),!y&&f&&(m=m.pipe(new l.Utf8DecodeWorker))}catch(_){(m=new h("error")).error(_)}return new o(m,b,"")},async:function(g,m){return this.internalStream(g).accumulate(m)},nodeStream:function(g,m){return this.internalStream(g||"nodebuffer").toNodejsStream(m)},_compressWorker:function(g,m){if(this._data instanceof c&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(b,g,m)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof h?this._data:new a(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],p=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<d.length;u++)r.prototype[d[u]]=p;i.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,i,n){(function(r){var o,a,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var c=0,h=new l(g),d=r.document.createTextNode("");h.observe(d,{characterData:!0}),o=function(){d.data=c=++c%2}}else if(r.setImmediate||r.MessageChannel===void 0)o="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var m=r.document.createElement("script");m.onreadystatechange=function(){g(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},r.document.documentElement.appendChild(m)}:function(){setTimeout(g,0)};else{var p=new r.MessageChannel;p.port1.onmessage=g,o=function(){p.port2.postMessage(0)}}var u=[];function g(){var m,b;a=!0;for(var f=u.length;f;){for(b=u,u=[],m=-1;++m<f;)b[m]();f=u.length}a=!1}i.exports=function(m){u.push(m)!==1||a||o()}}).call(this,typeof Tr<"u"?Tr:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,i,n){var r=e("immediate");function o(){}var a={},l=["REJECTED"],c=["FULFILLED"],h=["PENDING"];function d(f){if(typeof f!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,f!==o&&m(this,f)}function p(f,y,_){this.promise=f,typeof y=="function"&&(this.onFulfilled=y,this.callFulfilled=this.otherCallFulfilled),typeof _=="function"&&(this.onRejected=_,this.callRejected=this.otherCallRejected)}function u(f,y,_){r(function(){var x;try{x=y(_)}catch(C){return a.reject(f,C)}x===f?a.reject(f,new TypeError("Cannot resolve promise with itself")):a.resolve(f,x)})}function g(f){var y=f&&f.then;if(f&&(typeof f=="object"||typeof f=="function")&&typeof y=="function")return function(){y.apply(f,arguments)}}function m(f,y){var _=!1;function x($){_||(_=!0,a.reject(f,$))}function C($){_||(_=!0,a.resolve(f,$))}var S=b(function(){y(C,x)});S.status==="error"&&x(S.value)}function b(f,y){var _={};try{_.value=f(y),_.status="success"}catch(x){_.status="error",_.value=x}return _}(i.exports=d).prototype.finally=function(f){if(typeof f!="function")return this;var y=this.constructor;return this.then(function(_){return y.resolve(f()).then(function(){return _})},function(_){return y.resolve(f()).then(function(){throw _})})},d.prototype.catch=function(f){return this.then(null,f)},d.prototype.then=function(f,y){if(typeof f!="function"&&this.state===c||typeof y!="function"&&this.state===l)return this;var _=new this.constructor(o);return this.state!==h?u(_,this.state===c?f:y,this.outcome):this.queue.push(new p(_,f,y)),_},p.prototype.callFulfilled=function(f){a.resolve(this.promise,f)},p.prototype.otherCallFulfilled=function(f){u(this.promise,this.onFulfilled,f)},p.prototype.callRejected=function(f){a.reject(this.promise,f)},p.prototype.otherCallRejected=function(f){u(this.promise,this.onRejected,f)},a.resolve=function(f,y){var _=b(g,y);if(_.status==="error")return a.reject(f,_.value);var x=_.value;if(x)m(f,x);else{f.state=c,f.outcome=y;for(var C=-1,S=f.queue.length;++C<S;)f.queue[C].callFulfilled(y)}return f},a.reject=function(f,y){f.state=l,f.outcome=y;for(var _=-1,x=f.queue.length;++_<x;)f.queue[_].callRejected(y);return f},d.resolve=function(f){return f instanceof this?f:a.resolve(new this(o),f)},d.reject=function(f){var y=new this(o);return a.reject(y,f)},d.all=function(f){var y=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=f.length,x=!1;if(!_)return this.resolve([]);for(var C=new Array(_),S=0,$=-1,O=new this(o);++$<_;)z(f[$],$);return O;function z(D,j){y.resolve(D).then(function(A){C[j]=A,++S!==_||x||(x=!0,a.resolve(O,C))},function(A){x||(x=!0,a.reject(O,A))})}},d.race=function(f){var y=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=f.length,x=!1;if(!_)return this.resolve([]);for(var C=-1,S=new this(o);++C<_;)$=f[C],y.resolve($).then(function(O){x||(x=!0,a.resolve(S,O))},function(O){x||(x=!0,a.reject(S,O))});var $;return S}},{immediate:36}],38:[function(e,i,n){var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),i.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,i,n){var r=e("./zlib/deflate"),o=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/messages"),c=e("./zlib/zstream"),h=Object.prototype.toString,d=0,p=-1,u=0,g=8;function m(f){if(!(this instanceof m))return new m(f);this.options=o.assign({level:p,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},f||{});var y=this.options;y.raw&&0<y.windowBits?y.windowBits=-y.windowBits:y.gzip&&0<y.windowBits&&y.windowBits<16&&(y.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var _=r.deflateInit2(this.strm,y.level,y.method,y.windowBits,y.memLevel,y.strategy);if(_!==d)throw new Error(l[_]);if(y.header&&r.deflateSetHeader(this.strm,y.header),y.dictionary){var x;if(x=typeof y.dictionary=="string"?a.string2buf(y.dictionary):h.call(y.dictionary)==="[object ArrayBuffer]"?new Uint8Array(y.dictionary):y.dictionary,(_=r.deflateSetDictionary(this.strm,x))!==d)throw new Error(l[_]);this._dict_set=!0}}function b(f,y){var _=new m(y);if(_.push(f,!0),_.err)throw _.msg||l[_.err];return _.result}m.prototype.push=function(f,y){var _,x,C=this.strm,S=this.options.chunkSize;if(this.ended)return!1;x=y===~~y?y:y===!0?4:0,typeof f=="string"?C.input=a.string2buf(f):h.call(f)==="[object ArrayBuffer]"?C.input=new Uint8Array(f):C.input=f,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(S),C.next_out=0,C.avail_out=S),(_=r.deflate(C,x))!==1&&_!==d)return this.onEnd(_),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||x!==4&&x!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(C.output,C.next_out))):this.onData(o.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&_!==1);return x===4?(_=r.deflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===d):x!==2||(this.onEnd(d),!(C.avail_out=0))},m.prototype.onData=function(f){this.chunks.push(f)},m.prototype.onEnd=function(f){f===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},n.Deflate=m,n.deflate=b,n.deflateRaw=function(f,y){return(y=y||{}).raw=!0,b(f,y)},n.gzip=function(f,y){return(y=y||{}).gzip=!0,b(f,y)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,i,n){var r=e("./zlib/inflate"),o=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),h=e("./zlib/zstream"),d=e("./zlib/gzheader"),p=Object.prototype.toString;function u(m){if(!(this instanceof u))return new u(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||m&&m.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var f=r.inflateInit2(this.strm,b.windowBits);if(f!==l.Z_OK)throw new Error(c[f]);this.header=new d,r.inflateGetHeader(this.strm,this.header)}function g(m,b){var f=new u(b);if(f.push(m,!0),f.err)throw f.msg||c[f.err];return f.result}u.prototype.push=function(m,b){var f,y,_,x,C,S,$=this.strm,O=this.options.chunkSize,z=this.options.dictionary,D=!1;if(this.ended)return!1;y=b===~~b?b:b===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof m=="string"?$.input=a.binstring2buf(m):p.call(m)==="[object ArrayBuffer]"?$.input=new Uint8Array(m):$.input=m,$.next_in=0,$.avail_in=$.input.length;do{if($.avail_out===0&&($.output=new o.Buf8(O),$.next_out=0,$.avail_out=O),(f=r.inflate($,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&z&&(S=typeof z=="string"?a.string2buf(z):p.call(z)==="[object ArrayBuffer]"?new Uint8Array(z):z,f=r.inflateSetDictionary(this.strm,S)),f===l.Z_BUF_ERROR&&D===!0&&(f=l.Z_OK,D=!1),f!==l.Z_STREAM_END&&f!==l.Z_OK)return this.onEnd(f),!(this.ended=!0);$.next_out&&($.avail_out!==0&&f!==l.Z_STREAM_END&&($.avail_in!==0||y!==l.Z_FINISH&&y!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(_=a.utf8border($.output,$.next_out),x=$.next_out-_,C=a.buf2string($.output,_),$.next_out=x,$.avail_out=O-x,x&&o.arraySet($.output,$.output,_,x,0),this.onData(C)):this.onData(o.shrinkBuf($.output,$.next_out)))),$.avail_in===0&&$.avail_out===0&&(D=!0)}while((0<$.avail_in||$.avail_out===0)&&f!==l.Z_STREAM_END);return f===l.Z_STREAM_END&&(y=l.Z_FINISH),y===l.Z_FINISH?(f=r.inflateEnd(this.strm),this.onEnd(f),this.ended=!0,f===l.Z_OK):y!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!($.avail_out=0))},u.prototype.onData=function(m){this.chunks.push(m)},u.prototype.onEnd=function(m){m===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},n.Inflate=u,n.inflate=g,n.inflateRaw=function(m,b){return(b=b||{}).raw=!0,g(m,b)},n.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,i,n){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var h=c.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var d in h)h.hasOwnProperty(d)&&(l[d]=h[d])}}return l},n.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var o={arraySet:function(l,c,h,d,p){if(c.subarray&&l.subarray)l.set(c.subarray(h,h+d),p);else for(var u=0;u<d;u++)l[p+u]=c[h+u]},flattenChunks:function(l){var c,h,d,p,u,g;for(c=d=0,h=l.length;c<h;c++)d+=l[c].length;for(g=new Uint8Array(d),c=p=0,h=l.length;c<h;c++)u=l[c],g.set(u,p),p+=u.length;return g}},a={arraySet:function(l,c,h,d,p){for(var u=0;u<d;u++)l[p+u]=c[h+u]},flattenChunks:function(l){return[].concat.apply([],l)}};n.setTyped=function(l){l?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(r)},{}],42:[function(e,i,n){var r=e("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new r.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function h(d,p){if(p<65537&&(d.subarray&&a||!d.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(d,p));for(var u="",g=0;g<p;g++)u+=String.fromCharCode(d[g]);return u}l[254]=l[254]=1,n.string2buf=function(d){var p,u,g,m,b,f=d.length,y=0;for(m=0;m<f;m++)(64512&(u=d.charCodeAt(m)))==55296&&m+1<f&&(64512&(g=d.charCodeAt(m+1)))==56320&&(u=65536+(u-55296<<10)+(g-56320),m++),y+=u<128?1:u<2048?2:u<65536?3:4;for(p=new r.Buf8(y),m=b=0;b<y;m++)(64512&(u=d.charCodeAt(m)))==55296&&m+1<f&&(64512&(g=d.charCodeAt(m+1)))==56320&&(u=65536+(u-55296<<10)+(g-56320),m++),u<128?p[b++]=u:(u<2048?p[b++]=192|u>>>6:(u<65536?p[b++]=224|u>>>12:(p[b++]=240|u>>>18,p[b++]=128|u>>>12&63),p[b++]=128|u>>>6&63),p[b++]=128|63&u);return p},n.buf2binstring=function(d){return h(d,d.length)},n.binstring2buf=function(d){for(var p=new r.Buf8(d.length),u=0,g=p.length;u<g;u++)p[u]=d.charCodeAt(u);return p},n.buf2string=function(d,p){var u,g,m,b,f=p||d.length,y=new Array(2*f);for(u=g=0;u<f;)if((m=d[u++])<128)y[g++]=m;else if(4<(b=l[m]))y[g++]=65533,u+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&u<f;)m=m<<6|63&d[u++],b--;1<b?y[g++]=65533:m<65536?y[g++]=m:(m-=65536,y[g++]=55296|m>>10&1023,y[g++]=56320|1023&m)}return h(y,g)},n.utf8border=function(d,p){var u;for((p=p||d.length)>d.length&&(p=d.length),u=p-1;0<=u&&(192&d[u])==128;)u--;return u<0||u===0?p:u+l[d[u]]>p?u:p}},{"./common":41}],43:[function(e,i,n){i.exports=function(r,o,a,l){for(var c=65535&r|0,h=r>>>16&65535|0,d=0;a!==0;){for(a-=d=2e3<a?2e3:a;h=h+(c=c+o[l++]|0)|0,--d;);c%=65521,h%=65521}return c|h<<16|0}},{}],44:[function(e,i,n){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,i,n){var r=function(){for(var o,a=[],l=0;l<256;l++){o=l;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;a[l]=o}return a}();i.exports=function(o,a,l,c){var h=r,d=c+l;o^=-1;for(var p=c;p<d;p++)o=o>>>8^h[255&(o^a[p])];return-1^o}},{}],46:[function(e,i,n){var r,o=e("../utils/common"),a=e("./trees"),l=e("./adler32"),c=e("./crc32"),h=e("./messages"),d=0,p=4,u=0,g=-2,m=-1,b=4,f=2,y=8,_=9,x=286,C=30,S=19,$=2*x+1,O=15,z=3,D=258,j=D+z+1,A=42,k=113,v=1,L=2,X=3,V=4;function J(w,Z){return w.msg=h[Z],Z}function Y(w){return(w<<1)-(4<w?9:0)}function nt(w){for(var Z=w.length;0<=--Z;)w[Z]=0}function U(w){var Z=w.state,q=Z.pending;q>w.avail_out&&(q=w.avail_out),q!==0&&(o.arraySet(w.output,Z.pending_buf,Z.pending_out,q,w.next_out),w.next_out+=q,Z.pending_out+=q,w.total_out+=q,w.avail_out-=q,Z.pending-=q,Z.pending===0&&(Z.pending_out=0))}function N(w,Z){a._tr_flush_block(w,0<=w.block_start?w.block_start:-1,w.strstart-w.block_start,Z),w.block_start=w.strstart,U(w.strm)}function ot(w,Z){w.pending_buf[w.pending++]=Z}function it(w,Z){w.pending_buf[w.pending++]=Z>>>8&255,w.pending_buf[w.pending++]=255&Z}function et(w,Z){var q,I,P=w.max_chain_length,B=w.strstart,G=w.prev_length,Q=w.nice_match,R=w.strstart>w.w_size-j?w.strstart-(w.w_size-j):0,tt=w.window,at=w.w_mask,st=w.prev,ct=w.strstart+D,Pt=tt[B+G-1],yt=tt[B+G];w.prev_length>=w.good_match&&(P>>=2),Q>w.lookahead&&(Q=w.lookahead);do if(tt[(q=Z)+G]===yt&&tt[q+G-1]===Pt&&tt[q]===tt[B]&&tt[++q]===tt[B+1]){B+=2,q++;do;while(tt[++B]===tt[++q]&&tt[++B]===tt[++q]&&tt[++B]===tt[++q]&&tt[++B]===tt[++q]&&tt[++B]===tt[++q]&&tt[++B]===tt[++q]&&tt[++B]===tt[++q]&&tt[++B]===tt[++q]&&B<ct);if(I=D-(ct-B),B=ct-D,G<I){if(w.match_start=Z,Q<=(G=I))break;Pt=tt[B+G-1],yt=tt[B+G]}}while((Z=st[Z&at])>R&&--P!=0);return G<=w.lookahead?G:w.lookahead}function pt(w){var Z,q,I,P,B,G,Q,R,tt,at,st=w.w_size;do{if(P=w.window_size-w.lookahead-w.strstart,w.strstart>=st+(st-j)){for(o.arraySet(w.window,w.window,st,st,0),w.match_start-=st,w.strstart-=st,w.block_start-=st,Z=q=w.hash_size;I=w.head[--Z],w.head[Z]=st<=I?I-st:0,--q;);for(Z=q=st;I=w.prev[--Z],w.prev[Z]=st<=I?I-st:0,--q;);P+=st}if(w.strm.avail_in===0)break;if(G=w.strm,Q=w.window,R=w.strstart+w.lookahead,tt=P,at=void 0,at=G.avail_in,tt<at&&(at=tt),q=at===0?0:(G.avail_in-=at,o.arraySet(Q,G.input,G.next_in,at,R),G.state.wrap===1?G.adler=l(G.adler,Q,at,R):G.state.wrap===2&&(G.adler=c(G.adler,Q,at,R)),G.next_in+=at,G.total_in+=at,at),w.lookahead+=q,w.lookahead+w.insert>=z)for(B=w.strstart-w.insert,w.ins_h=w.window[B],w.ins_h=(w.ins_h<<w.hash_shift^w.window[B+1])&w.hash_mask;w.insert&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[B+z-1])&w.hash_mask,w.prev[B&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=B,B++,w.insert--,!(w.lookahead+w.insert<z)););}while(w.lookahead<j&&w.strm.avail_in!==0)}function ft(w,Z){for(var q,I;;){if(w.lookahead<j){if(pt(w),w.lookahead<j&&Z===d)return v;if(w.lookahead===0)break}if(q=0,w.lookahead>=z&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+z-1])&w.hash_mask,q=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),q!==0&&w.strstart-q<=w.w_size-j&&(w.match_length=et(w,q)),w.match_length>=z)if(I=a._tr_tally(w,w.strstart-w.match_start,w.match_length-z),w.lookahead-=w.match_length,w.match_length<=w.max_lazy_match&&w.lookahead>=z){for(w.match_length--;w.strstart++,w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+z-1])&w.hash_mask,q=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart,--w.match_length!=0;);w.strstart++}else w.strstart+=w.match_length,w.match_length=0,w.ins_h=w.window[w.strstart],w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+1])&w.hash_mask;else I=a._tr_tally(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++;if(I&&(N(w,!1),w.strm.avail_out===0))return v}return w.insert=w.strstart<z-1?w.strstart:z-1,Z===p?(N(w,!0),w.strm.avail_out===0?X:V):w.last_lit&&(N(w,!1),w.strm.avail_out===0)?v:L}function ht(w,Z){for(var q,I,P;;){if(w.lookahead<j){if(pt(w),w.lookahead<j&&Z===d)return v;if(w.lookahead===0)break}if(q=0,w.lookahead>=z&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+z-1])&w.hash_mask,q=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),w.prev_length=w.match_length,w.prev_match=w.match_start,w.match_length=z-1,q!==0&&w.prev_length<w.max_lazy_match&&w.strstart-q<=w.w_size-j&&(w.match_length=et(w,q),w.match_length<=5&&(w.strategy===1||w.match_length===z&&4096<w.strstart-w.match_start)&&(w.match_length=z-1)),w.prev_length>=z&&w.match_length<=w.prev_length){for(P=w.strstart+w.lookahead-z,I=a._tr_tally(w,w.strstart-1-w.prev_match,w.prev_length-z),w.lookahead-=w.prev_length-1,w.prev_length-=2;++w.strstart<=P&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+z-1])&w.hash_mask,q=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),--w.prev_length!=0;);if(w.match_available=0,w.match_length=z-1,w.strstart++,I&&(N(w,!1),w.strm.avail_out===0))return v}else if(w.match_available){if((I=a._tr_tally(w,0,w.window[w.strstart-1]))&&N(w,!1),w.strstart++,w.lookahead--,w.strm.avail_out===0)return v}else w.match_available=1,w.strstart++,w.lookahead--}return w.match_available&&(I=a._tr_tally(w,0,w.window[w.strstart-1]),w.match_available=0),w.insert=w.strstart<z-1?w.strstart:z-1,Z===p?(N(w,!0),w.strm.avail_out===0?X:V):w.last_lit&&(N(w,!1),w.strm.avail_out===0)?v:L}function mt(w,Z,q,I,P){this.good_length=w,this.max_lazy=Z,this.nice_length=q,this.max_chain=I,this.func=P}function Et(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*$),this.dyn_dtree=new o.Buf16(2*(2*C+1)),this.bl_tree=new o.Buf16(2*(2*S+1)),nt(this.dyn_ltree),nt(this.dyn_dtree),nt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(O+1),this.heap=new o.Buf16(2*x+1),nt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*x+1),nt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function kt(w){var Z;return w&&w.state?(w.total_in=w.total_out=0,w.data_type=f,(Z=w.state).pending=0,Z.pending_out=0,Z.wrap<0&&(Z.wrap=-Z.wrap),Z.status=Z.wrap?A:k,w.adler=Z.wrap===2?0:1,Z.last_flush=d,a._tr_init(Z),u):J(w,g)}function le(w){var Z=kt(w);return Z===u&&function(q){q.window_size=2*q.w_size,nt(q.head),q.max_lazy_match=r[q.level].max_lazy,q.good_match=r[q.level].good_length,q.nice_match=r[q.level].nice_length,q.max_chain_length=r[q.level].max_chain,q.strstart=0,q.block_start=0,q.lookahead=0,q.insert=0,q.match_length=q.prev_length=z-1,q.match_available=0,q.ins_h=0}(w.state),Z}function Kt(w,Z,q,I,P,B){if(!w)return g;var G=1;if(Z===m&&(Z=6),I<0?(G=0,I=-I):15<I&&(G=2,I-=16),P<1||_<P||q!==y||I<8||15<I||Z<0||9<Z||B<0||b<B)return J(w,g);I===8&&(I=9);var Q=new Et;return(w.state=Q).strm=w,Q.wrap=G,Q.gzhead=null,Q.w_bits=I,Q.w_size=1<<Q.w_bits,Q.w_mask=Q.w_size-1,Q.hash_bits=P+7,Q.hash_size=1<<Q.hash_bits,Q.hash_mask=Q.hash_size-1,Q.hash_shift=~~((Q.hash_bits+z-1)/z),Q.window=new o.Buf8(2*Q.w_size),Q.head=new o.Buf16(Q.hash_size),Q.prev=new o.Buf16(Q.w_size),Q.lit_bufsize=1<<P+6,Q.pending_buf_size=4*Q.lit_bufsize,Q.pending_buf=new o.Buf8(Q.pending_buf_size),Q.d_buf=1*Q.lit_bufsize,Q.l_buf=3*Q.lit_bufsize,Q.level=Z,Q.strategy=B,Q.method=q,le(w)}r=[new mt(0,0,0,0,function(w,Z){var q=65535;for(q>w.pending_buf_size-5&&(q=w.pending_buf_size-5);;){if(w.lookahead<=1){if(pt(w),w.lookahead===0&&Z===d)return v;if(w.lookahead===0)break}w.strstart+=w.lookahead,w.lookahead=0;var I=w.block_start+q;if((w.strstart===0||w.strstart>=I)&&(w.lookahead=w.strstart-I,w.strstart=I,N(w,!1),w.strm.avail_out===0)||w.strstart-w.block_start>=w.w_size-j&&(N(w,!1),w.strm.avail_out===0))return v}return w.insert=0,Z===p?(N(w,!0),w.strm.avail_out===0?X:V):(w.strstart>w.block_start&&(N(w,!1),w.strm.avail_out),v)}),new mt(4,4,8,4,ft),new mt(4,5,16,8,ft),new mt(4,6,32,32,ft),new mt(4,4,16,16,ht),new mt(8,16,32,32,ht),new mt(8,16,128,128,ht),new mt(8,32,128,256,ht),new mt(32,128,258,1024,ht),new mt(32,258,258,4096,ht)],n.deflateInit=function(w,Z){return Kt(w,Z,y,15,8,0)},n.deflateInit2=Kt,n.deflateReset=le,n.deflateResetKeep=kt,n.deflateSetHeader=function(w,Z){return w&&w.state?w.state.wrap!==2?g:(w.state.gzhead=Z,u):g},n.deflate=function(w,Z){var q,I,P,B;if(!w||!w.state||5<Z||Z<0)return w?J(w,g):g;if(I=w.state,!w.output||!w.input&&w.avail_in!==0||I.status===666&&Z!==p)return J(w,w.avail_out===0?-5:g);if(I.strm=w,q=I.last_flush,I.last_flush=Z,I.status===A)if(I.wrap===2)w.adler=0,ot(I,31),ot(I,139),ot(I,8),I.gzhead?(ot(I,(I.gzhead.text?1:0)+(I.gzhead.hcrc?2:0)+(I.gzhead.extra?4:0)+(I.gzhead.name?8:0)+(I.gzhead.comment?16:0)),ot(I,255&I.gzhead.time),ot(I,I.gzhead.time>>8&255),ot(I,I.gzhead.time>>16&255),ot(I,I.gzhead.time>>24&255),ot(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),ot(I,255&I.gzhead.os),I.gzhead.extra&&I.gzhead.extra.length&&(ot(I,255&I.gzhead.extra.length),ot(I,I.gzhead.extra.length>>8&255)),I.gzhead.hcrc&&(w.adler=c(w.adler,I.pending_buf,I.pending,0)),I.gzindex=0,I.status=69):(ot(I,0),ot(I,0),ot(I,0),ot(I,0),ot(I,0),ot(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),ot(I,3),I.status=k);else{var G=y+(I.w_bits-8<<4)<<8;G|=(2<=I.strategy||I.level<2?0:I.level<6?1:I.level===6?2:3)<<6,I.strstart!==0&&(G|=32),G+=31-G%31,I.status=k,it(I,G),I.strstart!==0&&(it(I,w.adler>>>16),it(I,65535&w.adler)),w.adler=1}if(I.status===69)if(I.gzhead.extra){for(P=I.pending;I.gzindex<(65535&I.gzhead.extra.length)&&(I.pending!==I.pending_buf_size||(I.gzhead.hcrc&&I.pending>P&&(w.adler=c(w.adler,I.pending_buf,I.pending-P,P)),U(w),P=I.pending,I.pending!==I.pending_buf_size));)ot(I,255&I.gzhead.extra[I.gzindex]),I.gzindex++;I.gzhead.hcrc&&I.pending>P&&(w.adler=c(w.adler,I.pending_buf,I.pending-P,P)),I.gzindex===I.gzhead.extra.length&&(I.gzindex=0,I.status=73)}else I.status=73;if(I.status===73)if(I.gzhead.name){P=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>P&&(w.adler=c(w.adler,I.pending_buf,I.pending-P,P)),U(w),P=I.pending,I.pending===I.pending_buf_size)){B=1;break}B=I.gzindex<I.gzhead.name.length?255&I.gzhead.name.charCodeAt(I.gzindex++):0,ot(I,B)}while(B!==0);I.gzhead.hcrc&&I.pending>P&&(w.adler=c(w.adler,I.pending_buf,I.pending-P,P)),B===0&&(I.gzindex=0,I.status=91)}else I.status=91;if(I.status===91)if(I.gzhead.comment){P=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>P&&(w.adler=c(w.adler,I.pending_buf,I.pending-P,P)),U(w),P=I.pending,I.pending===I.pending_buf_size)){B=1;break}B=I.gzindex<I.gzhead.comment.length?255&I.gzhead.comment.charCodeAt(I.gzindex++):0,ot(I,B)}while(B!==0);I.gzhead.hcrc&&I.pending>P&&(w.adler=c(w.adler,I.pending_buf,I.pending-P,P)),B===0&&(I.status=103)}else I.status=103;if(I.status===103&&(I.gzhead.hcrc?(I.pending+2>I.pending_buf_size&&U(w),I.pending+2<=I.pending_buf_size&&(ot(I,255&w.adler),ot(I,w.adler>>8&255),w.adler=0,I.status=k)):I.status=k),I.pending!==0){if(U(w),w.avail_out===0)return I.last_flush=-1,u}else if(w.avail_in===0&&Y(Z)<=Y(q)&&Z!==p)return J(w,-5);if(I.status===666&&w.avail_in!==0)return J(w,-5);if(w.avail_in!==0||I.lookahead!==0||Z!==d&&I.status!==666){var Q=I.strategy===2?function(R,tt){for(var at;;){if(R.lookahead===0&&(pt(R),R.lookahead===0)){if(tt===d)return v;break}if(R.match_length=0,at=a._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++,at&&(N(R,!1),R.strm.avail_out===0))return v}return R.insert=0,tt===p?(N(R,!0),R.strm.avail_out===0?X:V):R.last_lit&&(N(R,!1),R.strm.avail_out===0)?v:L}(I,Z):I.strategy===3?function(R,tt){for(var at,st,ct,Pt,yt=R.window;;){if(R.lookahead<=D){if(pt(R),R.lookahead<=D&&tt===d)return v;if(R.lookahead===0)break}if(R.match_length=0,R.lookahead>=z&&0<R.strstart&&(st=yt[ct=R.strstart-1])===yt[++ct]&&st===yt[++ct]&&st===yt[++ct]){Pt=R.strstart+D;do;while(st===yt[++ct]&&st===yt[++ct]&&st===yt[++ct]&&st===yt[++ct]&&st===yt[++ct]&&st===yt[++ct]&&st===yt[++ct]&&st===yt[++ct]&&ct<Pt);R.match_length=D-(Pt-ct),R.match_length>R.lookahead&&(R.match_length=R.lookahead)}if(R.match_length>=z?(at=a._tr_tally(R,1,R.match_length-z),R.lookahead-=R.match_length,R.strstart+=R.match_length,R.match_length=0):(at=a._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++),at&&(N(R,!1),R.strm.avail_out===0))return v}return R.insert=0,tt===p?(N(R,!0),R.strm.avail_out===0?X:V):R.last_lit&&(N(R,!1),R.strm.avail_out===0)?v:L}(I,Z):r[I.level].func(I,Z);if(Q!==X&&Q!==V||(I.status=666),Q===v||Q===X)return w.avail_out===0&&(I.last_flush=-1),u;if(Q===L&&(Z===1?a._tr_align(I):Z!==5&&(a._tr_stored_block(I,0,0,!1),Z===3&&(nt(I.head),I.lookahead===0&&(I.strstart=0,I.block_start=0,I.insert=0))),U(w),w.avail_out===0))return I.last_flush=-1,u}return Z!==p?u:I.wrap<=0?1:(I.wrap===2?(ot(I,255&w.adler),ot(I,w.adler>>8&255),ot(I,w.adler>>16&255),ot(I,w.adler>>24&255),ot(I,255&w.total_in),ot(I,w.total_in>>8&255),ot(I,w.total_in>>16&255),ot(I,w.total_in>>24&255)):(it(I,w.adler>>>16),it(I,65535&w.adler)),U(w),0<I.wrap&&(I.wrap=-I.wrap),I.pending!==0?u:1)},n.deflateEnd=function(w){var Z;return w&&w.state?(Z=w.state.status)!==A&&Z!==69&&Z!==73&&Z!==91&&Z!==103&&Z!==k&&Z!==666?J(w,g):(w.state=null,Z===k?J(w,-3):u):g},n.deflateSetDictionary=function(w,Z){var q,I,P,B,G,Q,R,tt,at=Z.length;if(!w||!w.state||(B=(q=w.state).wrap)===2||B===1&&q.status!==A||q.lookahead)return g;for(B===1&&(w.adler=l(w.adler,Z,at,0)),q.wrap=0,at>=q.w_size&&(B===0&&(nt(q.head),q.strstart=0,q.block_start=0,q.insert=0),tt=new o.Buf8(q.w_size),o.arraySet(tt,Z,at-q.w_size,q.w_size,0),Z=tt,at=q.w_size),G=w.avail_in,Q=w.next_in,R=w.input,w.avail_in=at,w.next_in=0,w.input=Z,pt(q);q.lookahead>=z;){for(I=q.strstart,P=q.lookahead-(z-1);q.ins_h=(q.ins_h<<q.hash_shift^q.window[I+z-1])&q.hash_mask,q.prev[I&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=I,I++,--P;);q.strstart=I,q.lookahead=z-1,pt(q)}return q.strstart+=q.lookahead,q.block_start=q.strstart,q.insert=q.lookahead,q.lookahead=0,q.match_length=q.prev_length=z-1,q.match_available=0,w.next_in=Q,w.input=R,w.avail_in=G,q.wrap=B,u},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,i,n){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,i,n){i.exports=function(r,o){var a,l,c,h,d,p,u,g,m,b,f,y,_,x,C,S,$,O,z,D,j,A,k,v,L;a=r.state,l=r.next_in,v=r.input,c=l+(r.avail_in-5),h=r.next_out,L=r.output,d=h-(o-r.avail_out),p=h+(r.avail_out-257),u=a.dmax,g=a.wsize,m=a.whave,b=a.wnext,f=a.window,y=a.hold,_=a.bits,x=a.lencode,C=a.distcode,S=(1<<a.lenbits)-1,$=(1<<a.distbits)-1;t:do{_<15&&(y+=v[l++]<<_,_+=8,y+=v[l++]<<_,_+=8),O=x[y&S];e:for(;;){if(y>>>=z=O>>>24,_-=z,(z=O>>>16&255)===0)L[h++]=65535&O;else{if(!(16&z)){if(!(64&z)){O=x[(65535&O)+(y&(1<<z)-1)];continue e}if(32&z){a.mode=12;break t}r.msg="invalid literal/length code",a.mode=30;break t}D=65535&O,(z&=15)&&(_<z&&(y+=v[l++]<<_,_+=8),D+=y&(1<<z)-1,y>>>=z,_-=z),_<15&&(y+=v[l++]<<_,_+=8,y+=v[l++]<<_,_+=8),O=C[y&$];i:for(;;){if(y>>>=z=O>>>24,_-=z,!(16&(z=O>>>16&255))){if(!(64&z)){O=C[(65535&O)+(y&(1<<z)-1)];continue i}r.msg="invalid distance code",a.mode=30;break t}if(j=65535&O,_<(z&=15)&&(y+=v[l++]<<_,(_+=8)<z&&(y+=v[l++]<<_,_+=8)),u<(j+=y&(1<<z)-1)){r.msg="invalid distance too far back",a.mode=30;break t}if(y>>>=z,_-=z,(z=h-d)<j){if(m<(z=j-z)&&a.sane){r.msg="invalid distance too far back",a.mode=30;break t}if(k=f,(A=0)===b){if(A+=g-z,z<D){for(D-=z;L[h++]=f[A++],--z;);A=h-j,k=L}}else if(b<z){if(A+=g+b-z,(z-=b)<D){for(D-=z;L[h++]=f[A++],--z;);if(A=0,b<D){for(D-=z=b;L[h++]=f[A++],--z;);A=h-j,k=L}}}else if(A+=b-z,z<D){for(D-=z;L[h++]=f[A++],--z;);A=h-j,k=L}for(;2<D;)L[h++]=k[A++],L[h++]=k[A++],L[h++]=k[A++],D-=3;D&&(L[h++]=k[A++],1<D&&(L[h++]=k[A++]))}else{for(A=h-j;L[h++]=L[A++],L[h++]=L[A++],L[h++]=L[A++],2<(D-=3););D&&(L[h++]=L[A++],1<D&&(L[h++]=L[A++]))}break}}break}}while(l<c&&h<p);l-=D=_>>3,y&=(1<<(_-=D<<3))-1,r.next_in=l,r.next_out=h,r.avail_in=l<c?c-l+5:5-(l-c),r.avail_out=h<p?p-h+257:257-(h-p),a.hold=y,a.bits=_}},{}],49:[function(e,i,n){var r=e("../utils/common"),o=e("./adler32"),a=e("./crc32"),l=e("./inffast"),c=e("./inftrees"),h=1,d=2,p=0,u=-2,g=1,m=852,b=592;function f(A){return(A>>>24&255)+(A>>>8&65280)+((65280&A)<<8)+((255&A)<<24)}function y(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function _(A){var k;return A&&A.state?(k=A.state,A.total_in=A.total_out=k.total=0,A.msg="",k.wrap&&(A.adler=1&k.wrap),k.mode=g,k.last=0,k.havedict=0,k.dmax=32768,k.head=null,k.hold=0,k.bits=0,k.lencode=k.lendyn=new r.Buf32(m),k.distcode=k.distdyn=new r.Buf32(b),k.sane=1,k.back=-1,p):u}function x(A){var k;return A&&A.state?((k=A.state).wsize=0,k.whave=0,k.wnext=0,_(A)):u}function C(A,k){var v,L;return A&&A.state?(L=A.state,k<0?(v=0,k=-k):(v=1+(k>>4),k<48&&(k&=15)),k&&(k<8||15<k)?u:(L.window!==null&&L.wbits!==k&&(L.window=null),L.wrap=v,L.wbits=k,x(A))):u}function S(A,k){var v,L;return A?(L=new y,(A.state=L).window=null,(v=C(A,k))!==p&&(A.state=null),v):u}var $,O,z=!0;function D(A){if(z){var k;for($=new r.Buf32(512),O=new r.Buf32(32),k=0;k<144;)A.lens[k++]=8;for(;k<256;)A.lens[k++]=9;for(;k<280;)A.lens[k++]=7;for(;k<288;)A.lens[k++]=8;for(c(h,A.lens,0,288,$,0,A.work,{bits:9}),k=0;k<32;)A.lens[k++]=5;c(d,A.lens,0,32,O,0,A.work,{bits:5}),z=!1}A.lencode=$,A.lenbits=9,A.distcode=O,A.distbits=5}function j(A,k,v,L){var X,V=A.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new r.Buf8(V.wsize)),L>=V.wsize?(r.arraySet(V.window,k,v-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(L<(X=V.wsize-V.wnext)&&(X=L),r.arraySet(V.window,k,v-L,X,V.wnext),(L-=X)?(r.arraySet(V.window,k,v-L,L,0),V.wnext=L,V.whave=V.wsize):(V.wnext+=X,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=X))),0}n.inflateReset=x,n.inflateReset2=C,n.inflateResetKeep=_,n.inflateInit=function(A){return S(A,15)},n.inflateInit2=S,n.inflate=function(A,k){var v,L,X,V,J,Y,nt,U,N,ot,it,et,pt,ft,ht,mt,Et,kt,le,Kt,w,Z,q,I,P=0,B=new r.Buf8(4),G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!A||!A.state||!A.output||!A.input&&A.avail_in!==0)return u;(v=A.state).mode===12&&(v.mode=13),J=A.next_out,X=A.output,nt=A.avail_out,V=A.next_in,L=A.input,Y=A.avail_in,U=v.hold,N=v.bits,ot=Y,it=nt,Z=p;t:for(;;)switch(v.mode){case g:if(v.wrap===0){v.mode=13;break}for(;N<16;){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}if(2&v.wrap&&U===35615){B[v.check=0]=255&U,B[1]=U>>>8&255,v.check=a(v.check,B,2,0),N=U=0,v.mode=2;break}if(v.flags=0,v.head&&(v.head.done=!1),!(1&v.wrap)||(((255&U)<<8)+(U>>8))%31){A.msg="incorrect header check",v.mode=30;break}if((15&U)!=8){A.msg="unknown compression method",v.mode=30;break}if(N-=4,w=8+(15&(U>>>=4)),v.wbits===0)v.wbits=w;else if(w>v.wbits){A.msg="invalid window size",v.mode=30;break}v.dmax=1<<w,A.adler=v.check=1,v.mode=512&U?10:12,N=U=0;break;case 2:for(;N<16;){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}if(v.flags=U,(255&v.flags)!=8){A.msg="unknown compression method",v.mode=30;break}if(57344&v.flags){A.msg="unknown header flags set",v.mode=30;break}v.head&&(v.head.text=U>>8&1),512&v.flags&&(B[0]=255&U,B[1]=U>>>8&255,v.check=a(v.check,B,2,0)),N=U=0,v.mode=3;case 3:for(;N<32;){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}v.head&&(v.head.time=U),512&v.flags&&(B[0]=255&U,B[1]=U>>>8&255,B[2]=U>>>16&255,B[3]=U>>>24&255,v.check=a(v.check,B,4,0)),N=U=0,v.mode=4;case 4:for(;N<16;){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}v.head&&(v.head.xflags=255&U,v.head.os=U>>8),512&v.flags&&(B[0]=255&U,B[1]=U>>>8&255,v.check=a(v.check,B,2,0)),N=U=0,v.mode=5;case 5:if(1024&v.flags){for(;N<16;){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}v.length=U,v.head&&(v.head.extra_len=U),512&v.flags&&(B[0]=255&U,B[1]=U>>>8&255,v.check=a(v.check,B,2,0)),N=U=0}else v.head&&(v.head.extra=null);v.mode=6;case 6:if(1024&v.flags&&(Y<(et=v.length)&&(et=Y),et&&(v.head&&(w=v.head.extra_len-v.length,v.head.extra||(v.head.extra=new Array(v.head.extra_len)),r.arraySet(v.head.extra,L,V,et,w)),512&v.flags&&(v.check=a(v.check,L,et,V)),Y-=et,V+=et,v.length-=et),v.length))break t;v.length=0,v.mode=7;case 7:if(2048&v.flags){if(Y===0)break t;for(et=0;w=L[V+et++],v.head&&w&&v.length<65536&&(v.head.name+=String.fromCharCode(w)),w&&et<Y;);if(512&v.flags&&(v.check=a(v.check,L,et,V)),Y-=et,V+=et,w)break t}else v.head&&(v.head.name=null);v.length=0,v.mode=8;case 8:if(4096&v.flags){if(Y===0)break t;for(et=0;w=L[V+et++],v.head&&w&&v.length<65536&&(v.head.comment+=String.fromCharCode(w)),w&&et<Y;);if(512&v.flags&&(v.check=a(v.check,L,et,V)),Y-=et,V+=et,w)break t}else v.head&&(v.head.comment=null);v.mode=9;case 9:if(512&v.flags){for(;N<16;){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}if(U!==(65535&v.check)){A.msg="header crc mismatch",v.mode=30;break}N=U=0}v.head&&(v.head.hcrc=v.flags>>9&1,v.head.done=!0),A.adler=v.check=0,v.mode=12;break;case 10:for(;N<32;){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}A.adler=v.check=f(U),N=U=0,v.mode=11;case 11:if(v.havedict===0)return A.next_out=J,A.avail_out=nt,A.next_in=V,A.avail_in=Y,v.hold=U,v.bits=N,2;A.adler=v.check=1,v.mode=12;case 12:if(k===5||k===6)break t;case 13:if(v.last){U>>>=7&N,N-=7&N,v.mode=27;break}for(;N<3;){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}switch(v.last=1&U,N-=1,3&(U>>>=1)){case 0:v.mode=14;break;case 1:if(D(v),v.mode=20,k!==6)break;U>>>=2,N-=2;break t;case 2:v.mode=17;break;case 3:A.msg="invalid block type",v.mode=30}U>>>=2,N-=2;break;case 14:for(U>>>=7&N,N-=7&N;N<32;){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}if((65535&U)!=(U>>>16^65535)){A.msg="invalid stored block lengths",v.mode=30;break}if(v.length=65535&U,N=U=0,v.mode=15,k===6)break t;case 15:v.mode=16;case 16:if(et=v.length){if(Y<et&&(et=Y),nt<et&&(et=nt),et===0)break t;r.arraySet(X,L,V,et,J),Y-=et,V+=et,nt-=et,J+=et,v.length-=et;break}v.mode=12;break;case 17:for(;N<14;){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}if(v.nlen=257+(31&U),U>>>=5,N-=5,v.ndist=1+(31&U),U>>>=5,N-=5,v.ncode=4+(15&U),U>>>=4,N-=4,286<v.nlen||30<v.ndist){A.msg="too many length or distance symbols",v.mode=30;break}v.have=0,v.mode=18;case 18:for(;v.have<v.ncode;){for(;N<3;){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}v.lens[G[v.have++]]=7&U,U>>>=3,N-=3}for(;v.have<19;)v.lens[G[v.have++]]=0;if(v.lencode=v.lendyn,v.lenbits=7,q={bits:v.lenbits},Z=c(0,v.lens,0,19,v.lencode,0,v.work,q),v.lenbits=q.bits,Z){A.msg="invalid code lengths set",v.mode=30;break}v.have=0,v.mode=19;case 19:for(;v.have<v.nlen+v.ndist;){for(;mt=(P=v.lencode[U&(1<<v.lenbits)-1])>>>16&255,Et=65535&P,!((ht=P>>>24)<=N);){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}if(Et<16)U>>>=ht,N-=ht,v.lens[v.have++]=Et;else{if(Et===16){for(I=ht+2;N<I;){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}if(U>>>=ht,N-=ht,v.have===0){A.msg="invalid bit length repeat",v.mode=30;break}w=v.lens[v.have-1],et=3+(3&U),U>>>=2,N-=2}else if(Et===17){for(I=ht+3;N<I;){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}N-=ht,w=0,et=3+(7&(U>>>=ht)),U>>>=3,N-=3}else{for(I=ht+7;N<I;){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}N-=ht,w=0,et=11+(127&(U>>>=ht)),U>>>=7,N-=7}if(v.have+et>v.nlen+v.ndist){A.msg="invalid bit length repeat",v.mode=30;break}for(;et--;)v.lens[v.have++]=w}}if(v.mode===30)break;if(v.lens[256]===0){A.msg="invalid code -- missing end-of-block",v.mode=30;break}if(v.lenbits=9,q={bits:v.lenbits},Z=c(h,v.lens,0,v.nlen,v.lencode,0,v.work,q),v.lenbits=q.bits,Z){A.msg="invalid literal/lengths set",v.mode=30;break}if(v.distbits=6,v.distcode=v.distdyn,q={bits:v.distbits},Z=c(d,v.lens,v.nlen,v.ndist,v.distcode,0,v.work,q),v.distbits=q.bits,Z){A.msg="invalid distances set",v.mode=30;break}if(v.mode=20,k===6)break t;case 20:v.mode=21;case 21:if(6<=Y&&258<=nt){A.next_out=J,A.avail_out=nt,A.next_in=V,A.avail_in=Y,v.hold=U,v.bits=N,l(A,it),J=A.next_out,X=A.output,nt=A.avail_out,V=A.next_in,L=A.input,Y=A.avail_in,U=v.hold,N=v.bits,v.mode===12&&(v.back=-1);break}for(v.back=0;mt=(P=v.lencode[U&(1<<v.lenbits)-1])>>>16&255,Et=65535&P,!((ht=P>>>24)<=N);){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}if(mt&&!(240&mt)){for(kt=ht,le=mt,Kt=Et;mt=(P=v.lencode[Kt+((U&(1<<kt+le)-1)>>kt)])>>>16&255,Et=65535&P,!(kt+(ht=P>>>24)<=N);){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}U>>>=kt,N-=kt,v.back+=kt}if(U>>>=ht,N-=ht,v.back+=ht,v.length=Et,mt===0){v.mode=26;break}if(32&mt){v.back=-1,v.mode=12;break}if(64&mt){A.msg="invalid literal/length code",v.mode=30;break}v.extra=15&mt,v.mode=22;case 22:if(v.extra){for(I=v.extra;N<I;){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}v.length+=U&(1<<v.extra)-1,U>>>=v.extra,N-=v.extra,v.back+=v.extra}v.was=v.length,v.mode=23;case 23:for(;mt=(P=v.distcode[U&(1<<v.distbits)-1])>>>16&255,Et=65535&P,!((ht=P>>>24)<=N);){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}if(!(240&mt)){for(kt=ht,le=mt,Kt=Et;mt=(P=v.distcode[Kt+((U&(1<<kt+le)-1)>>kt)])>>>16&255,Et=65535&P,!(kt+(ht=P>>>24)<=N);){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}U>>>=kt,N-=kt,v.back+=kt}if(U>>>=ht,N-=ht,v.back+=ht,64&mt){A.msg="invalid distance code",v.mode=30;break}v.offset=Et,v.extra=15&mt,v.mode=24;case 24:if(v.extra){for(I=v.extra;N<I;){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}v.offset+=U&(1<<v.extra)-1,U>>>=v.extra,N-=v.extra,v.back+=v.extra}if(v.offset>v.dmax){A.msg="invalid distance too far back",v.mode=30;break}v.mode=25;case 25:if(nt===0)break t;if(et=it-nt,v.offset>et){if((et=v.offset-et)>v.whave&&v.sane){A.msg="invalid distance too far back",v.mode=30;break}pt=et>v.wnext?(et-=v.wnext,v.wsize-et):v.wnext-et,et>v.length&&(et=v.length),ft=v.window}else ft=X,pt=J-v.offset,et=v.length;for(nt<et&&(et=nt),nt-=et,v.length-=et;X[J++]=ft[pt++],--et;);v.length===0&&(v.mode=21);break;case 26:if(nt===0)break t;X[J++]=v.length,nt--,v.mode=21;break;case 27:if(v.wrap){for(;N<32;){if(Y===0)break t;Y--,U|=L[V++]<<N,N+=8}if(it-=nt,A.total_out+=it,v.total+=it,it&&(A.adler=v.check=v.flags?a(v.check,X,it,J-it):o(v.check,X,it,J-it)),it=nt,(v.flags?U:f(U))!==v.check){A.msg="incorrect data check",v.mode=30;break}N=U=0}v.mode=28;case 28:if(v.wrap&&v.flags){for(;N<32;){if(Y===0)break t;Y--,U+=L[V++]<<N,N+=8}if(U!==(4294967295&v.total)){A.msg="incorrect length check",v.mode=30;break}N=U=0}v.mode=29;case 29:Z=1;break t;case 30:Z=-3;break t;case 31:return-4;case 32:default:return u}return A.next_out=J,A.avail_out=nt,A.next_in=V,A.avail_in=Y,v.hold=U,v.bits=N,(v.wsize||it!==A.avail_out&&v.mode<30&&(v.mode<27||k!==4))&&j(A,A.output,A.next_out,it-A.avail_out)?(v.mode=31,-4):(ot-=A.avail_in,it-=A.avail_out,A.total_in+=ot,A.total_out+=it,v.total+=it,v.wrap&&it&&(A.adler=v.check=v.flags?a(v.check,X,it,A.next_out-it):o(v.check,X,it,A.next_out-it)),A.data_type=v.bits+(v.last?64:0)+(v.mode===12?128:0)+(v.mode===20||v.mode===15?256:0),(ot==0&&it===0||k===4)&&Z===p&&(Z=-5),Z)},n.inflateEnd=function(A){if(!A||!A.state)return u;var k=A.state;return k.window&&(k.window=null),A.state=null,p},n.inflateGetHeader=function(A,k){var v;return A&&A.state&&2&(v=A.state).wrap?((v.head=k).done=!1,p):u},n.inflateSetDictionary=function(A,k){var v,L=k.length;return A&&A.state?(v=A.state).wrap!==0&&v.mode!==11?u:v.mode===11&&o(1,k,L,0)!==v.check?-3:j(A,k,L,L)?(v.mode=31,-4):(v.havedict=1,p):u},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,i,n){var r=e("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(h,d,p,u,g,m,b,f){var y,_,x,C,S,$,O,z,D,j=f.bits,A=0,k=0,v=0,L=0,X=0,V=0,J=0,Y=0,nt=0,U=0,N=null,ot=0,it=new r.Buf16(16),et=new r.Buf16(16),pt=null,ft=0;for(A=0;A<=15;A++)it[A]=0;for(k=0;k<u;k++)it[d[p+k]]++;for(X=j,L=15;1<=L&&it[L]===0;L--);if(L<X&&(X=L),L===0)return g[m++]=20971520,g[m++]=20971520,f.bits=1,0;for(v=1;v<L&&it[v]===0;v++);for(X<v&&(X=v),A=Y=1;A<=15;A++)if(Y<<=1,(Y-=it[A])<0)return-1;if(0<Y&&(h===0||L!==1))return-1;for(et[1]=0,A=1;A<15;A++)et[A+1]=et[A]+it[A];for(k=0;k<u;k++)d[p+k]!==0&&(b[et[d[p+k]]++]=k);if($=h===0?(N=pt=b,19):h===1?(N=o,ot-=257,pt=a,ft-=257,256):(N=l,pt=c,-1),A=v,S=m,J=k=U=0,x=-1,C=(nt=1<<(V=X))-1,h===1&&852<nt||h===2&&592<nt)return 1;for(;;){for(O=A-J,D=b[k]<$?(z=0,b[k]):b[k]>$?(z=pt[ft+b[k]],N[ot+b[k]]):(z=96,0),y=1<<A-J,v=_=1<<V;g[S+(U>>J)+(_-=y)]=O<<24|z<<16|D|0,_!==0;);for(y=1<<A-1;U&y;)y>>=1;if(y!==0?(U&=y-1,U+=y):U=0,k++,--it[A]==0){if(A===L)break;A=d[p+b[k]]}if(X<A&&(U&C)!==x){for(J===0&&(J=X),S+=v,Y=1<<(V=A-J);V+J<L&&!((Y-=it[V+J])<=0);)V++,Y<<=1;if(nt+=1<<V,h===1&&852<nt||h===2&&592<nt)return 1;g[x=U&C]=X<<24|V<<16|S-m|0}}return U!==0&&(g[S+U]=A-J<<24|64<<16|0),f.bits=X,0}},{"../utils/common":41}],51:[function(e,i,n){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,i,n){var r=e("../utils/common"),o=0,a=1;function l(P){for(var B=P.length;0<=--B;)P[B]=0}var c=0,h=29,d=256,p=d+1+h,u=30,g=19,m=2*p+1,b=15,f=16,y=7,_=256,x=16,C=17,S=18,$=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],O=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],j=new Array(2*(p+2));l(j);var A=new Array(2*u);l(A);var k=new Array(512);l(k);var v=new Array(256);l(v);var L=new Array(h);l(L);var X,V,J,Y=new Array(u);function nt(P,B,G,Q,R){this.static_tree=P,this.extra_bits=B,this.extra_base=G,this.elems=Q,this.max_length=R,this.has_stree=P&&P.length}function U(P,B){this.dyn_tree=P,this.max_code=0,this.stat_desc=B}function N(P){return P<256?k[P]:k[256+(P>>>7)]}function ot(P,B){P.pending_buf[P.pending++]=255&B,P.pending_buf[P.pending++]=B>>>8&255}function it(P,B,G){P.bi_valid>f-G?(P.bi_buf|=B<<P.bi_valid&65535,ot(P,P.bi_buf),P.bi_buf=B>>f-P.bi_valid,P.bi_valid+=G-f):(P.bi_buf|=B<<P.bi_valid&65535,P.bi_valid+=G)}function et(P,B,G){it(P,G[2*B],G[2*B+1])}function pt(P,B){for(var G=0;G|=1&P,P>>>=1,G<<=1,0<--B;);return G>>>1}function ft(P,B,G){var Q,R,tt=new Array(b+1),at=0;for(Q=1;Q<=b;Q++)tt[Q]=at=at+G[Q-1]<<1;for(R=0;R<=B;R++){var st=P[2*R+1];st!==0&&(P[2*R]=pt(tt[st]++,st))}}function ht(P){var B;for(B=0;B<p;B++)P.dyn_ltree[2*B]=0;for(B=0;B<u;B++)P.dyn_dtree[2*B]=0;for(B=0;B<g;B++)P.bl_tree[2*B]=0;P.dyn_ltree[2*_]=1,P.opt_len=P.static_len=0,P.last_lit=P.matches=0}function mt(P){8<P.bi_valid?ot(P,P.bi_buf):0<P.bi_valid&&(P.pending_buf[P.pending++]=P.bi_buf),P.bi_buf=0,P.bi_valid=0}function Et(P,B,G,Q){var R=2*B,tt=2*G;return P[R]<P[tt]||P[R]===P[tt]&&Q[B]<=Q[G]}function kt(P,B,G){for(var Q=P.heap[G],R=G<<1;R<=P.heap_len&&(R<P.heap_len&&Et(B,P.heap[R+1],P.heap[R],P.depth)&&R++,!Et(B,Q,P.heap[R],P.depth));)P.heap[G]=P.heap[R],G=R,R<<=1;P.heap[G]=Q}function le(P,B,G){var Q,R,tt,at,st=0;if(P.last_lit!==0)for(;Q=P.pending_buf[P.d_buf+2*st]<<8|P.pending_buf[P.d_buf+2*st+1],R=P.pending_buf[P.l_buf+st],st++,Q===0?et(P,R,B):(et(P,(tt=v[R])+d+1,B),(at=$[tt])!==0&&it(P,R-=L[tt],at),et(P,tt=N(--Q),G),(at=O[tt])!==0&&it(P,Q-=Y[tt],at)),st<P.last_lit;);et(P,_,B)}function Kt(P,B){var G,Q,R,tt=B.dyn_tree,at=B.stat_desc.static_tree,st=B.stat_desc.has_stree,ct=B.stat_desc.elems,Pt=-1;for(P.heap_len=0,P.heap_max=m,G=0;G<ct;G++)tt[2*G]!==0?(P.heap[++P.heap_len]=Pt=G,P.depth[G]=0):tt[2*G+1]=0;for(;P.heap_len<2;)tt[2*(R=P.heap[++P.heap_len]=Pt<2?++Pt:0)]=1,P.depth[R]=0,P.opt_len--,st&&(P.static_len-=at[2*R+1]);for(B.max_code=Pt,G=P.heap_len>>1;1<=G;G--)kt(P,tt,G);for(R=ct;G=P.heap[1],P.heap[1]=P.heap[P.heap_len--],kt(P,tt,1),Q=P.heap[1],P.heap[--P.heap_max]=G,P.heap[--P.heap_max]=Q,tt[2*R]=tt[2*G]+tt[2*Q],P.depth[R]=(P.depth[G]>=P.depth[Q]?P.depth[G]:P.depth[Q])+1,tt[2*G+1]=tt[2*Q+1]=R,P.heap[1]=R++,kt(P,tt,1),2<=P.heap_len;);P.heap[--P.heap_max]=P.heap[1],function(yt,Ae){var bn,Xe,yn,Ut,Sr,ca,ai=Ae.dyn_tree,Ec=Ae.max_code,pm=Ae.stat_desc.static_tree,fm=Ae.stat_desc.has_stree,mm=Ae.stat_desc.extra_bits,Sc=Ae.stat_desc.extra_base,vn=Ae.stat_desc.max_length,Ar=0;for(Ut=0;Ut<=b;Ut++)yt.bl_count[Ut]=0;for(ai[2*yt.heap[yt.heap_max]+1]=0,bn=yt.heap_max+1;bn<m;bn++)vn<(Ut=ai[2*ai[2*(Xe=yt.heap[bn])+1]+1]+1)&&(Ut=vn,Ar++),ai[2*Xe+1]=Ut,Ec<Xe||(yt.bl_count[Ut]++,Sr=0,Sc<=Xe&&(Sr=mm[Xe-Sc]),ca=ai[2*Xe],yt.opt_len+=ca*(Ut+Sr),fm&&(yt.static_len+=ca*(pm[2*Xe+1]+Sr)));if(Ar!==0){do{for(Ut=vn-1;yt.bl_count[Ut]===0;)Ut--;yt.bl_count[Ut]--,yt.bl_count[Ut+1]+=2,yt.bl_count[vn]--,Ar-=2}while(0<Ar);for(Ut=vn;Ut!==0;Ut--)for(Xe=yt.bl_count[Ut];Xe!==0;)Ec<(yn=yt.heap[--bn])||(ai[2*yn+1]!==Ut&&(yt.opt_len+=(Ut-ai[2*yn+1])*ai[2*yn],ai[2*yn+1]=Ut),Xe--)}}(P,B),ft(tt,Pt,P.bl_count)}function w(P,B,G){var Q,R,tt=-1,at=B[1],st=0,ct=7,Pt=4;for(at===0&&(ct=138,Pt=3),B[2*(G+1)+1]=65535,Q=0;Q<=G;Q++)R=at,at=B[2*(Q+1)+1],++st<ct&&R===at||(st<Pt?P.bl_tree[2*R]+=st:R!==0?(R!==tt&&P.bl_tree[2*R]++,P.bl_tree[2*x]++):st<=10?P.bl_tree[2*C]++:P.bl_tree[2*S]++,tt=R,Pt=(st=0)===at?(ct=138,3):R===at?(ct=6,3):(ct=7,4))}function Z(P,B,G){var Q,R,tt=-1,at=B[1],st=0,ct=7,Pt=4;for(at===0&&(ct=138,Pt=3),Q=0;Q<=G;Q++)if(R=at,at=B[2*(Q+1)+1],!(++st<ct&&R===at)){if(st<Pt)for(;et(P,R,P.bl_tree),--st!=0;);else R!==0?(R!==tt&&(et(P,R,P.bl_tree),st--),et(P,x,P.bl_tree),it(P,st-3,2)):st<=10?(et(P,C,P.bl_tree),it(P,st-3,3)):(et(P,S,P.bl_tree),it(P,st-11,7));tt=R,Pt=(st=0)===at?(ct=138,3):R===at?(ct=6,3):(ct=7,4)}}l(Y);var q=!1;function I(P,B,G,Q){it(P,(c<<1)+(Q?1:0),3),function(R,tt,at,st){mt(R),ot(R,at),ot(R,~at),r.arraySet(R.pending_buf,R.window,tt,at,R.pending),R.pending+=at}(P,B,G)}n._tr_init=function(P){q||(function(){var B,G,Q,R,tt,at=new Array(b+1);for(R=Q=0;R<h-1;R++)for(L[R]=Q,B=0;B<1<<$[R];B++)v[Q++]=R;for(v[Q-1]=R,R=tt=0;R<16;R++)for(Y[R]=tt,B=0;B<1<<O[R];B++)k[tt++]=R;for(tt>>=7;R<u;R++)for(Y[R]=tt<<7,B=0;B<1<<O[R]-7;B++)k[256+tt++]=R;for(G=0;G<=b;G++)at[G]=0;for(B=0;B<=143;)j[2*B+1]=8,B++,at[8]++;for(;B<=255;)j[2*B+1]=9,B++,at[9]++;for(;B<=279;)j[2*B+1]=7,B++,at[7]++;for(;B<=287;)j[2*B+1]=8,B++,at[8]++;for(ft(j,p+1,at),B=0;B<u;B++)A[2*B+1]=5,A[2*B]=pt(B,5);X=new nt(j,$,d+1,p,b),V=new nt(A,O,0,u,b),J=new nt(new Array(0),z,0,g,y)}(),q=!0),P.l_desc=new U(P.dyn_ltree,X),P.d_desc=new U(P.dyn_dtree,V),P.bl_desc=new U(P.bl_tree,J),P.bi_buf=0,P.bi_valid=0,ht(P)},n._tr_stored_block=I,n._tr_flush_block=function(P,B,G,Q){var R,tt,at=0;0<P.level?(P.strm.data_type===2&&(P.strm.data_type=function(st){var ct,Pt=4093624447;for(ct=0;ct<=31;ct++,Pt>>>=1)if(1&Pt&&st.dyn_ltree[2*ct]!==0)return o;if(st.dyn_ltree[18]!==0||st.dyn_ltree[20]!==0||st.dyn_ltree[26]!==0)return a;for(ct=32;ct<d;ct++)if(st.dyn_ltree[2*ct]!==0)return a;return o}(P)),Kt(P,P.l_desc),Kt(P,P.d_desc),at=function(st){var ct;for(w(st,st.dyn_ltree,st.l_desc.max_code),w(st,st.dyn_dtree,st.d_desc.max_code),Kt(st,st.bl_desc),ct=g-1;3<=ct&&st.bl_tree[2*D[ct]+1]===0;ct--);return st.opt_len+=3*(ct+1)+5+5+4,ct}(P),R=P.opt_len+3+7>>>3,(tt=P.static_len+3+7>>>3)<=R&&(R=tt)):R=tt=G+5,G+4<=R&&B!==-1?I(P,B,G,Q):P.strategy===4||tt===R?(it(P,2+(Q?1:0),3),le(P,j,A)):(it(P,4+(Q?1:0),3),function(st,ct,Pt,yt){var Ae;for(it(st,ct-257,5),it(st,Pt-1,5),it(st,yt-4,4),Ae=0;Ae<yt;Ae++)it(st,st.bl_tree[2*D[Ae]+1],3);Z(st,st.dyn_ltree,ct-1),Z(st,st.dyn_dtree,Pt-1)}(P,P.l_desc.max_code+1,P.d_desc.max_code+1,at+1),le(P,P.dyn_ltree,P.dyn_dtree)),ht(P),Q&&mt(P)},n._tr_tally=function(P,B,G){return P.pending_buf[P.d_buf+2*P.last_lit]=B>>>8&255,P.pending_buf[P.d_buf+2*P.last_lit+1]=255&B,P.pending_buf[P.l_buf+P.last_lit]=255&G,P.last_lit++,B===0?P.dyn_ltree[2*G]++:(P.matches++,B--,P.dyn_ltree[2*(v[G]+d+1)]++,P.dyn_dtree[2*N(B)]++),P.last_lit===P.lit_bufsize-1},n._tr_align=function(P){it(P,2,3),et(P,_,j),function(B){B.bi_valid===16?(ot(B,B.bi_buf),B.bi_buf=0,B.bi_valid=0):8<=B.bi_valid&&(B.pending_buf[B.pending++]=255&B.bi_buf,B.bi_buf>>=8,B.bi_valid-=8)}(P)}},{"../utils/common":41}],53:[function(e,i,n){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,i,n){(function(r){(function(o,a){if(!o.setImmediate){var l,c,h,d,p=1,u={},g=!1,m=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,l={}.toString.call(o.process)==="[object process]"?function(x){process.nextTick(function(){y(x)})}:function(){if(o.postMessage&&!o.importScripts){var x=!0,C=o.onmessage;return o.onmessage=function(){x=!1},o.postMessage("","*"),o.onmessage=C,x}}()?(d="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",_,!1):o.attachEvent("onmessage",_),function(x){o.postMessage(d+x,"*")}):o.MessageChannel?((h=new MessageChannel).port1.onmessage=function(x){y(x.data)},function(x){h.port2.postMessage(x)}):m&&"onreadystatechange"in m.createElement("script")?(c=m.documentElement,function(x){var C=m.createElement("script");C.onreadystatechange=function(){y(x),C.onreadystatechange=null,c.removeChild(C),C=null},c.appendChild(C)}):function(x){setTimeout(y,0,x)},b.setImmediate=function(x){typeof x!="function"&&(x=new Function(""+x));for(var C=new Array(arguments.length-1),S=0;S<C.length;S++)C[S]=arguments[S+1];var $={callback:x,args:C};return u[p]=$,l(p),p++},b.clearImmediate=f}function f(x){delete u[x]}function y(x){if(g)setTimeout(y,0,x);else{var C=u[x];if(C){g=!0;try{(function(S){var $=S.callback,O=S.args;switch(O.length){case 0:$();break;case 1:$(O[0]);break;case 2:$(O[0],O[1]);break;case 3:$(O[0],O[1],O[2]);break;default:$.apply(a,O)}})(C)}finally{f(x),g=!1}}}}function _(x){x.source===o&&typeof x.data=="string"&&x.data.indexOf(d)===0&&y(+x.data.slice(d.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof Tr<"u"?Tr:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Pu);var Wy=Pu.exports;const ah=rg(Wy);let hl=class{constructor(t,e){E(this,"date",new Date),E(this,"author"),E(this,"guid",ie.create()),E(this,"viewpoint"),E(this,"modifiedAuthor"),E(this,"modifiedDate"),E(this,"topic"),E(this,"_components"),E(this,"_comment",""),this._components=t,this._comment=e;const i=this._components.get(Yt);this.author=i.config.author}set comment(t){var e;const i=this._components.get(Yt);this._comment=t,this.modifiedDate=new Date,this.modifiedAuthor=i.config.author,(e=this.topic)==null||e.comments.set(this.guid,this)}get comment(){return this._comment}toJSON(){var t,e;const i={guid:this.guid,date:this.date.toISOString(),author:this.author,comment:this.comment,topic_guid:(t=this.topic)==null?void 0:t.guid,viewpoint_guid:this.viewpoint,modified_date:(e=this.modifiedDate)==null?void 0:e.toISOString(),modified_author:this.modifiedAuthor};for(const[n,r]of Object.entries(i))r===void 0&&delete i[n];return i}};const Ou=class Si{constructor(t){E(this,"guid",ie.create()),E(this,"title",Si.default.title),E(this,"creationDate",new Date),E(this,"creationAuthor",""),E(this,"viewpoints",new ha),E(this,"relatedTopics",new ha),E(this,"comments",new Ys),E(this,"documentReferences",new ha),E(this,"customData",{}),E(this,"description"),E(this,"serverAssignedId"),E(this,"dueDate"),E(this,"modifiedAuthor"),E(this,"modifiedDate"),E(this,"index"),E(this,"_type",Si.default.type),E(this,"_status",Si.default.status),E(this,"_priority",Si.default.priority),E(this,"_stage",Si.default.stage),E(this,"_assignedTo",Si.default.assignedTo),E(this,"_labels",Si.default.labels??new Set),E(this,"_components"),this._components=t;const e=t.get(Yt);this.creationAuthor=e.config.author,this.relatedTopics.guard=i=>i!==this.guid}set type(t){const e=this._components.get(Yt),{strict:i,types:n}=e.config;(!i||n.has(t))&&(this._type=t)}get type(){return this._type}set status(t){const e=this._components.get(Yt),{strict:i,statuses:n}=e.config;(!i||n.has(t))&&(this._status=t)}get status(){return this._status}set priority(t){const e=this._components.get(Yt);if(t){const{strict:i,priorities:n}=e.config;if(!(!i||n.has(t)))return;this._priority=t}else this._priority=t}get priority(){return this._priority}set stage(t){const e=this._components.get(Yt);if(t){const{strict:i,stages:n}=e.config;if(!(!i||n.has(t)))return;this._stage=t}else this._stage=t}get stage(){return this._stage}set assignedTo(t){const e=this._components.get(Yt);if(t){const{strict:i,users:n}=e.config;if(!(!i||n.has(t)))return;this._assignedTo=t}else this._assignedTo=t}get assignedTo(){return this._assignedTo}set labels(t){const e=this._components.get(Yt),{strict:i,labels:n}=e.config;if(i){const r=new Set;for(const o of t)(!i||n.has(o))&&r.add(o);this._labels=r}else this._labels=t}get labels(){return this._labels}get _managerVersion(){return this._components.get(Yt).config.version}set(t){const e=t,i=this;for(const n in t){if(n==="guid")continue;const r=e[n];n in this&&(i[n]=r)}return this._components.get(Yt).list.set(this.guid,this),this}createComment(t,e){const i=new hl(this._components,t);return i.viewpoint=e,i.topic=this,this.comments.set(i.guid,i),i}createLabelTags(){const t=[...this.labels];if(this._components.get(Yt).config.exportCustomDataAsLabels)for(const e in this.customData){const i=this.customData[e];typeof i=="string"&&t.push(i)}return t}createCommentTags(){return[...this.comments.values()].map(t=>{var e;return{$Guid:t.guid,Date:t.date.toISOString(),Author:t.author,Comment:t.comment,ModifiedAuthor:t.modifiedAuthor,ModifiedDate:(e=t.modifiedDate)==null?void 0:e.toISOString(),Viewpoint:t.viewpoint?{$Guid:t.viewpoint}:void 0}})}createViewpointTags(){const t=this._components.get(ci);return[...this.viewpoints].map(e=>t.list.get(e)).filter(e=>e).map(e=>{const i={$Guid:e.guid,Viewpoint:`${e.title??e.guid}.bcfv`};if(t.snapshots.get(e.snapshot)){const n=t.getSnapshotExtension(e.snapshot);i.Snapshot=`${e.snapshot}.${n}`}return i})}createRelatedTopicTags(){return[...this.relatedTopics].map(t=>({$Guid:t}))}createDocumentReferencesTag(t=this._managerVersion){const e=[];if(!(t==="3"||t==="2.1"))return e;const i=this._components.get(Yt);for(const n of this.documentReferences){const r=i.documents.get(n);if(!r)continue;let o={$Guid:ie.create(),Description:r.description};t==="2.1"&&(o={...o,$isExternal:r.type==="external"?!0:void 0,ReferencedDocument:r.type==="external"?r.url:`../${r.fileName}`}),t==="3"&&(o={...o,DocumentGuid:r.type==="internal"?n:void 0,Url:r.type==="external"?r.url:void 0}),Object.keys(o).length>0&&e.push(o)}return e}toJSON(){var t,e;const i={guid:this.guid,server_assigned_id:this.serverAssignedId,topic_type:this.type,topic_status:this.status,title:this.title,priority:this.priority,index:this.index,labels:[...this.labels],creation_date:this.creationDate.toISOString(),creation_author:this.creationAuthor,modified_date:(t=this.modifiedDate)==null?void 0:t.toISOString(),modified_author:this.modifiedAuthor,assigned_to:this.assignedTo,stage:this.stage,description:this.description,due_date:(e=this.dueDate)==null?void 0:e.toISOString(),comments:[...this.comments].map(([o,a])=>a.toJSON()),relatedTopics:[...this.relatedTopics].map(o=>({related_topic_guid:o}))},n=this._components.get(ci);for(const o of this.viewpoints){const a=n.list.get(o);a&&(i.viewpoints||(i.viewpoints=[]),i.viewpoints.push(a.toJSON()))}const r=this._components.get(Yt);for(const o of this.documentReferences){const a=r.documents.get(o);a&&(i.document_references||(i.document_references=[]),a.type==="external"?i.document_references.push({guid:ie.create(),description:a.description,url:a.url}):i.document_references.push({guid:ie.create(),description:a.description,document_guid:o}))}for(const[o,a]of Object.entries(i))(a===void 0||Array.isArray(a)&&a.length===0)&&delete i[o];return i}serialize(){var t,e;const i=this._managerVersion,n={$Guid:this.guid,$TopicType:this.type,$TopicStatus:this.status,$ServerAssignedId:this.serverAssignedId,Title:this.title,CreationAuthor:this.creationAuthor,CreationDate:this.creationDate.toISOString(),Priority:this.priority,Index:i==="2.1"?this.index:void 0,ModifiedDate:(t=this.modifiedDate)==null?void 0:t.toISOString(),ModifiedAuthor:this.modifiedAuthor,DueDate:(e=this.dueDate)==null?void 0:e.toISOString(),AssignedTo:this.assignedTo,Description:this.description,Stage:this.stage,DocumentReferences:i==="3"?{DocumentReference:this.createDocumentReferencesTag(i)}:void 0,RelatedTopics:i==="3"?{RelatedTopic:this.createRelatedTopicTags()}:void 0,RelatedTopic:i==="2.1"?this.createRelatedTopicTags():void 0,Labels:i==="3"?{Label:this.createLabelTags()}:void 0,Viewpoints:i==="3"?{ViewPoint:this.createViewpointTags()}:void 0,Comments:i==="3"?{Comment:this.createCommentTags()}:void 0};i==="2.1"&&(n.Labels=this.createLabelTags(),n.DocumentReference=this.createDocumentReferencesTag(i));const r={Markup:{Topic:n}};return i==="2.1"&&(r.Markup.Viewpoints=this.createViewpointTags(),r.Markup.Comment=this.createCommentTags()),`<?xml version="1.0" encoding="UTF-8"?>
    ${Ho.builder.build(r)}`}};E(Ou,"default",{title:"BCF Topic",type:"Issue",status:"Active"});let lh=Ou;const Yy=(s,t)=>{if(t.trim()==="")return;const e=Yt.xmlParser.parse(t).Extensions;if(!e)return;const{Priorities:i,TopicStatuses:n,TopicTypes:r,Users:o}=e;if(i&&i.Priority){const a=Array.isArray(i.Priority)?i.Priority:[i.Priority];for(const l of a)s.config.priorities.add(l)}if(n&&n.TopicStatus){const a=Array.isArray(n.TopicStatus)?n.TopicStatus:[n.TopicStatus];for(const l of a)s.config.statuses.add(l)}if(r&&r.TopicType){const a=Array.isArray(r.TopicType)?r.TopicType:[r.TopicType];for(const l of a)s.config.types.add(l)}if(o&&o.User){const a=Array.isArray(o.User)?o.User:[o.User];for(const l of a)s.config.users.add(l)}};let Zy=class extends Vo{constructor(){super(...arguments),E(this,"_config",{version:{type:"Select",options:new Set(["2.1","3"]),multiple:!1,value:""},author:{type:"Text",value:""},types:{type:"TextSet",value:new Set},statuses:{type:"TextSet",value:new Set},priorities:{type:"TextSet",value:new Set},labels:{type:"TextSet",value:new Set},stages:{type:"TextSet",value:new Set},users:{type:"TextSet",value:new Set},includeSelectionTag:{type:"Boolean",value:!1},updateExtensionsOnImport:{type:"Boolean",value:!1},strict:{type:"Boolean",value:!1},includeAllExtensionsOnExport:{type:"Boolean",value:!1},fallbackVersionOnImport:{type:"Select",multiple:!1,options:new Set(["2.1","3"]),value:""},ignoreIncompleteTopicsOnImport:{type:"Boolean",value:!1},exportCustomDataAsLabels:{type:"Boolean",value:!1}})}get version(){return this._config.version.value}set version(t){this._config.version.value=t}get author(){return this._config.author.value}set author(t){this._config.author.value=t}get types(){return this._config.types.value}set types(t){this._config.types.value=t}get statuses(){return this._config.statuses.value}set statuses(t){this._config.statuses.value=t}get priorities(){return this._config.priorities.value}set priorities(t){this._config.priorities.value=t}get labels(){return this._config.labels.value}set labels(t){this._config.labels.value=t}get stages(){return this._config.stages.value}set stages(t){this._config.stages.value=t}get users(){return this._config.users.value}set users(t){this._config.users.value=t}get includeSelectionTag(){return this._config.includeSelectionTag.value}set includeSelectionTag(t){this._config.includeSelectionTag.value=t}get updateExtensionsOnImport(){return this._config.updateExtensionsOnImport.value}set updateExtensionsOnImport(t){this._config.updateExtensionsOnImport.value=t}get strict(){return this._config.strict.value}set strict(t){this._config.strict.value=t}get includeAllExtensionsOnExport(){return this._config.includeAllExtensionsOnExport.value}set includeAllExtensionsOnExport(t){this._config.includeAllExtensionsOnExport.value=t}get fallbackVersionOnImport(){return this._config.fallbackVersionOnImport.value}set fallbackVersionOnImport(t){this._config.fallbackVersionOnImport.value=t}get ignoreIncompleteTopicsOnImport(){return this._config.ignoreIncompleteTopicsOnImport.value}set ignoreIncompleteTopicsOnImport(t){this._config.ignoreIncompleteTopicsOnImport.value=t}get exportCustomDataAsLabels(){return this._config.exportCustomDataAsLabels.value}set exportCustomDataAsLabels(t){this._config.exportCustomDataAsLabels.value=t}};const Gl=class Rn extends Tt{constructor(){super(...arguments),E(this,"enabled",!1),E(this,"_defaultConfig",{author:"jhon.doe@example.com",version:"2.1",types:new Set(["Clash","Failure","Fault","Inquiry","Issue","Remark","Request"]),statuses:new Set(["Active","In Progress","Done","In Review","Closed"]),priorities:new Set(["On hold","Minor","Normal","Major","Critical"]),labels:new Set,stages:new Set,users:new Set,includeSelectionTag:!1,updateExtensionsOnImport:!0,strict:!1,includeAllExtensionsOnExport:!0,fallbackVersionOnImport:"2.1",ignoreIncompleteTopicsOnImport:!1,exportCustomDataAsLabels:!1}),E(this,"config",new Zy(this,this.components,"BCF Topics",Rn.uuid)),E(this,"list",new Ys),E(this,"documents",new Ys),E(this,"onSetup",new K),E(this,"isSetup",!1),E(this,"onBCFImported",new K),E(this,"onDisposed",new K)}setup(t){if(this.isSetup)return;const e={...this._defaultConfig,...t};this.config.version=e.version,this.config.author=e.author,this.config.types=e.types,this.config.statuses=e.statuses,this.config.priorities=e.priorities,this.config.labels=e.labels,this.config.stages=e.stages,this.config.users=e.users,this.config.includeSelectionTag=e.includeSelectionTag,this.config.updateExtensionsOnImport=e.updateExtensionsOnImport,this.config.strict=e.strict,this.config.includeAllExtensionsOnExport=e.includeAllExtensionsOnExport,this.config.fallbackVersionOnImport=e.fallbackVersionOnImport||"",this.config.ignoreIncompleteTopicsOnImport=e.ignoreIncompleteTopicsOnImport,this.isSetup=!0,this.enabled=!0,this.onSetup.trigger()}create(t){const e=new lh(this.components);return t?(e.guid=t.guid??e.guid,e.set(t)):this.list.set(e.guid,e),e}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get usedTypes(){const t=[...this.list].map(([e,i])=>i.type);return new Set(t)}get usedStatuses(){const t=[...this.list].map(([e,i])=>i.status);return new Set(t)}get usedPriorities(){const t=[...this.list].map(([e,i])=>i.priority).filter(e=>e);return new Set(t)}get usedStages(){const t=[...this.list].map(([e,i])=>i.stage).filter(e=>e);return new Set(t)}get usedUsers(){const t=[];for(const[e,i]of this.list){t.push(i.creationAuthor),i.assignedTo&&t.push(i.assignedTo),i.modifiedAuthor&&t.push(i.modifiedAuthor);for(const[n,r]of i.comments)t.push(r.author),r.modifiedAuthor&&t.push(r.modifiedAuthor)}return new Set(t)}get usedLabels(){const t=[];for(const[e,i]of this.list)t.push(...i.labels);return new Set(t)}updateExtensions(){for(const[t,e]of this.list){for(const i of e.labels)this.config.labels.add(i);this.config.types.add(e.type),e.priority&&this.config.priorities.add(e.priority),e.stage&&this.config.stages.add(e.stage),this.config.statuses.add(e.status),this.config.users.add(e.creationAuthor),e.assignedTo&&this.config.users.add(e.assignedTo),e.modifiedAuthor&&this.config.users.add(e.modifiedAuthor);for(const[i,n]of e.comments)this.config.users.add(n.author),n.modifiedAuthor&&this.config.users.add(n.modifiedAuthor)}}updateViewpointReferences(){const t=this.components.get(ci);for(const[e,i]of this.list)for(const n of i.viewpoints)t.list.has(n)||i.viewpoints.delete(n)}async export(t=this.list.values()){const e=new ah;e.file("bcf.version",`<?xml version="1.0" encoding="UTF-8"?>
    <Version VersionId="${this.config.version}" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/buildingSMART/BCF-XML/release_3_0/Schemas/version.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    </Version>`);for(const[n,r]of this.documents.entries())r.type!=="external"&&e.file(this.config.version==="2.1"?r.fileName:`documents/${n}`,r.data);if(this.config.version==="3"){const n=[];for(const[r,o]of this.documents.entries()){const{type:a,description:l}=o;a!=="external"&&n.push(`<Document Guid="${r}">
        <Filename>${o.fileName}</Filename>
        ${l?`<Description>${l}</Description>`:""}
      </Document>`)}n.length>0&&e.file("documents.xml",`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
  <DocumentInfo xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="documents.xsd">
    <Documents>
      ${n.join(`
`)}
    </Documents>
  </DocumentInfo>`)}e.file("bcf.extensions",this.serializeExtensions());const i=this.components.get(ci);for(const n of t){const r=e.folder(n.guid);r.file("markup.bcf",n.serialize());for(const o of n.viewpoints){const a=i.list.get(o);if(!a)continue;const l=a.title??a.guid;r.file(`${l}.bcfv`,await a.serialize());const c=i.snapshots.get(a.snapshot);if(!c)continue;const h=c?a.snapshot:a.guid,d=i.getSnapshotExtension(a.snapshot);r.file(`${h}.${d}`,c,{binary:!0})}}return await e.generateAsync({type:"blob"})}serializeExtensions(){const t=[...this.config.types].map(a=>`<TopicType>${a}</TopicType>`).join(`
`),e=[...this.config.statuses].map(a=>`<TopicStatus>${a}</TopicStatus>`).join(`
`),i=[...this.config.priorities].map(a=>`<Priority>${a}</Priority>`).join(`
`),n=[...this.config.labels].map(a=>`<TopicLabel>${a}</TopicLabel>`).join(`
`),r=[...this.config.stages].map(a=>`<Stage>${a}</Stage>`).join(`
`),o=[...this.config.users].map(a=>`<User>${a}</User>`).join(`
`);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Extensions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="your-schema-location.xsd">
        ${t.length!==0?`<TopicTypes>
${t}
</TopicTypes>`:""}
        ${e.length!==0?`<TopicStatuses>
${e}
</TopicStatuses>`:""}
        ${i.length!==0?`<Priorities>
${i}
</Priorities>`:""}
        ${n.length!==0?`<TopicLabels>
${n}
</TopicLabels>`:""}
        ${r.length!==0?`<Stages>
${r}
</Stages>`:""}
        ${o.length!==0?`<Users>
${o}
</Users>`:""}
      </Extensions>
    `}processMarkupComment(t){const{Guid:e,Date:i,Author:n,Comment:r,Viewpoint:o}=t;if(!(e&&i&&n&&(hl||o)))return null;const a=new hl(this.components,r??"");return a.guid=e,a.date=new Date(i),a.author=n,a.viewpoint=o==null?void 0:o.Guid,a.modifiedAuthor=t.ModifiedAuthor,a.modifiedDate=t.ModifiedDate?new Date(t.ModifiedDate):void 0,a}getMarkupComments(t,e){var i;let n;if(e==="2.1"&&(n=t.Comment),e==="3"&&(n=(i=t.Topic.Comments)==null?void 0:i.Comment),!n)return[];n=Array.isArray(n)?n:[n];const r=n.map(o=>this.processMarkupComment(o)).filter(o=>o);return Array.isArray(r)?r:[r]}getMarkupLabels(t,e){var i;let n;return e==="2.1"&&(n=t.Topic.Labels),e==="3"&&(n=(i=t.Topic.Labels)==null?void 0:i.Label),n?Array.isArray(n)?n:[n]:[]}getMarkupViewpoints(t,e){var i;let n;return e==="2.1"&&(n=t.Viewpoints),e==="3"&&(n=(i=t.Topic.Viewpoints)==null?void 0:i.ViewPoint),n?(n=Array.isArray(n)?n:[n],n):[]}getMarkupRelatedTopics(t,e){var i;let n;return e==="2.1"&&(n=t.Topic.RelatedTopic),e==="3"&&(n=(i=t.Topic.RelatedTopics)==null?void 0:i.RelatedTopic),n?(Array.isArray(n)?n:[n]).map(r=>r.Guid):[]}getMarkupDocumentReferences(t,e){var i;let n;return e==="2.1"&&(n=t.Topic.DocumentReference),e==="3"&&(n=(i=t.Topic.DocumentReferences)==null?void 0:i.DocumentReference),n?Array.isArray(n)?n:[n]:[]}async load(t){var e,i,n;const{fallbackVersionOnImport:r,ignoreIncompleteTopicsOnImport:o,updateExtensionsOnImport:a}=this.config,l=new ah;await l.loadAsync(t);const c=Object.values(l.files);let h=r;const d=c.find(_=>_.name.endsWith(".version"));if(d){const _=await d.async("string"),x=Rn.xmlParser.parse(_).Version.VersionId;h=String(x)}if(!(h&&(h==="2.1"||h==="3")))throw new Error(`BCFTopics: ${h} is not supported.`);const p=c.find(_=>_.name.endsWith(".extensions"));if(a&&p){const _=await p.async("string");Yy(this,_)}const u=[],g=this.components.get(ci),m=c.filter(_=>_.name.endsWith(".bcfv"));for(const _ of m){const x=await _.async("string"),C=Rn.xmlParser.parse(x).VisualizationInfo;if(!C){console.warn("Missing VisualizationInfo in Viewpoint");continue}const S={},{Guid:$,ClippingPlanes:O,Components:z,OrthogonalCamera:D,PerspectiveCamera:j}=C;if($&&(S.guid=$),z){const k={selection:[],coloring:[],visibility:{default_visibility:!1,exceptions:[],view_setup_hints:{spaces_visible:!1,space_boundaries_visible:!1,openings_visible:!1}}};S.components=k;const{Selection:v,Visibility:L}=z;if(v&&v.Component){const J=Array.isArray(v.Component)?v.Component:[v.Component];k.selection=J.map(Y=>Y.IfcGuid?{ifc_guid:Y.IfcGuid}:null).filter(Y=>Y!==null)}if(L&&"DefaultVisibility"in L&&(k.visibility.default_visibility=L.DefaultVisibility),L&&L.Exceptions&&"Component"in L.Exceptions){const{Component:J}=L.Exceptions,Y=Array.isArray(J)?J:[J];k.visibility.exceptions=Y.map(nt=>nt.IfcGuid?{ifc_guid:nt.IfcGuid}:null).filter(nt=>nt!==null)}let X;h==="2.1"&&(X=z.ViewSetupHints),h==="3"&&(X=(e=z.Visibility)==null?void 0:e.ViewSetupHints),X&&("OpeningsVisible"in X&&(k.visibility.view_setup_hints.openings_visible=X.OpeningsVisible),"SpacesVisible"in X&&(k.visibility.view_setup_hints.spaces_visible=X.SpacesVisible),"SpaceBoundariesVisible"in X&&(k.visibility.view_setup_hints.space_boundaries_visible=X.SpaceBoundariesVisible));const{Coloring:V}=z;if(V&&V.Color){const J=Array.isArray(V.Color)?V.Color:[V.Color];for(const Y of J){const{Color:nt,Component:U}=Y;if(!(nt.length===6||nt.length===8))continue;const N=nt.length===6?nt:nt.slice(2),ot=(Array.isArray(U)?U:[U]).map(it=>it.IfcGuid?{ifc_guid:it.IfcGuid}:null).filter(it=>it!==null);k.coloring.push({color:N,components:ot})}}}if(D||j){const k=C.PerspectiveCamera??C.OrthogonalCamera,{CameraViewPoint:v,CameraDirection:L}=k,X=new M(Number(v.X),Number(v.Z),Number(-v.Y)),V=new M(Number(L.X),Number(L.Z),Number(-L.Y)),J={camera_view_point:{x:X.x,y:X.y,z:X.z},camera_direction:{x:V.x,y:V.y,z:V.z},aspect_ratio:"AspectRatio"in k?k.AspectRatio:1,camera_up_vector:{x:0,y:0,z:0}};"ViewToWorldScale"in k&&(S.orthogonal_camera={...J,view_to_world_scale:k.ViewToWorldScale}),"FieldOfView"in k&&(S.perspective_camera={...J,field_of_view:k.FieldOfView})}if(O){const k=(Array.isArray(O.ClippingPlane)?O.ClippingPlane:[O.ClippingPlane]).map(({Location:v,Direction:L})=>({location:{x:v.x,y:v.y,z:v.z},direction:{x:L.x,y:L.y,z:L.z}}));S.clipping_planes=k}const A=new Du(this.components,S);u.push(A)}const b={},f=[],y=c.filter(_=>_.name.endsWith(".bcf"));for(const _ of y){const x=await _.async("string"),C=Rn.xmlParser.parse(x).Markup,S=C.Topic,{Guid:$,TopicType:O,TopicStatus:z,Title:D,CreationDate:j,CreationAuthor:A}=S;if(o&&!($&&O&&z&&D&&j&&A))continue;const k=new lh(this.components);k.guid=$??k.guid;const v=this.getMarkupRelatedTopics(C,h);b[k.guid]=new Set(v),k.type=O??k.type,k.status=z??k.status,k.title=D??k.title,k.creationDate=j?new Date(j):k.creationDate,k.creationAuthor=A??k.creationAuthor,k.serverAssignedId=S.ServerAssignedId,k.priority=S.Priority,k.index=S.Index,k.modifiedDate=S.ModifiedDate?new Date(S.ModifiedDate):void 0,k.modifiedAuthor=S.ModifiedAuthor,k.dueDate=S.DueDate?new Date(S.DueDate):void 0,k.assignedTo=S.AssignedTo,k.description=S.Description,k.stage=S.Stage;const L=this.getMarkupLabels(C,h);for(const N of L)k.labels.add(N);const X=this.getMarkupComments(C,h);for(const N of X)k.comments.set(N.guid,N);const V=this.getMarkupViewpoints(C,h);for(const N of V){if(!(N&&N.Guid))continue;const ot=g.list.get(N.Guid);if(!ot)continue;k.viewpoints.add(ot.guid);const it=`${k.guid}/${N.Snapshot}`,et=c.find(({name:pt})=>pt===it);if(et){const pt=await et.async("arraybuffer"),ft=new Uint8Array(pt);g.snapshots.set(ot.guid,ft),ot.snapshot=ot.guid??null}}const J=this.getMarkupDocumentReferences(C,h),Y=c.find(N=>N.name==="documents.xml");let nt=[];const U=await(Y==null?void 0:Y.async("string"));if(U){const N=(n=(i=Ho.parser.parse(U).DocumentInfo)==null?void 0:i.Documents)==null?void 0:n.Document;nt=Array.isArray(N)?N:[N]}for(const N of J){const{Description:ot,DocumentGuid:it,Url:et,isExternal:pt,ReferencedDocument:ft}=N;if(it&&nt.length>0){const ht=nt.find(({Guid:Kt})=>Kt===it),mt=c.find(Kt=>Kt.name.endsWith(it)),Et=await(mt==null?void 0:mt.async("uint8array"));if(!(ht&&Et))continue;const{Description:kt,Filename:le}=ht;this.documents.set(it,{type:"internal",fileName:le,description:kt,data:Et}),k.documentReferences.add(it)}if(et){const ht=this.documents.add({type:"external",url:et,description:ot});k.documentReferences.add(ht)}if(ft){let ht=null;if(pt)ht=this.documents.add({type:"external",url:ft,description:ot});else{const mt=ft.split("/"),Et=mt[mt.length-1],kt=c.find(Kt=>Kt.name.endsWith(Et)),le=await(kt==null?void 0:kt.async("uint8array"));if(!le)continue;ht=this.documents.add({type:"internal",fileName:Et,data:le,description:ot})}k.documentReferences.add(ht)}}this.list.set(k.guid,k),f.push(k)}for(const _ in b){const x=this.list.get(_);if(!x)continue;const C=b[_];for(const S of C)x.relatedTopics.add(S)}return this.onBCFImported.trigger(f),{viewpoints:u,topics:f}}};E(Gl,"uuid","de977976-e4f6-4e4f-a01a-204727839802");E(Gl,"xmlParser",new jo.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let Yt=Gl;const Gi=new Nl,oe=new M,Ci=new M,Dt=new je,ch={X:new M(1,0,0),Y:new M(0,1,0),Z:new M(0,0,1)},Pa={type:"change"},hh={type:"mouseDown",mode:null},dh={type:"mouseUp",mode:null},uh={type:"objectChange"};let Xy=class extends Mm{constructor(t,e=null){super(void 0,e);const i=new ev(this);this._root=i;const n=new iv;this._gizmo=n,i.add(n);const r=new sv;this._plane=r,i.add(r);const o=this;function a(_,x){let C=x;Object.defineProperty(o,_,{get:function(){return C!==void 0?C:x},set:function(S){C!==S&&(C=S,r[_]=S,n[_]=S,o.dispatchEvent({type:_+"-changed",value:S}),o.dispatchEvent(Pa))}}),o[_]=x,r[_]=x,n[_]=x}a("camera",t),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0),a("minX",-1/0),a("maxX",1/0),a("minY",-1/0),a("maxY",1/0),a("minZ",-1/0),a("maxZ",1/0);const l=new M,c=new M,h=new je,d=new je,p=new M,u=new je,g=new M,m=new M,b=new M,f=0,y=new M;a("worldPosition",l),a("worldPositionStart",c),a("worldQuaternion",h),a("worldQuaternionStart",d),a("cameraPosition",p),a("cameraQuaternion",u),a("pointStart",g),a("pointEnd",m),a("rotationAxis",b),a("rotationAngle",f),a("eye",y),this._offset=new M,this._startNorm=new M,this._endNorm=new M,this._cameraScale=new M,this._parentPosition=new M,this._parentQuaternion=new je,this._parentQuaternionInv=new je,this._parentScale=new M,this._worldScaleStart=new M,this._worldQuaternionInv=new je,this._worldScale=new M,this._positionStart=new M,this._quaternionStart=new je,this._scaleStart=new M,this._getPointer=Gy.bind(this),this._onPointerDown=Ky.bind(this),this._onPointerHover=Qy.bind(this),this._onPointerMove=Jy.bind(this),this._onPointerUp=tv.bind(this),e!==null&&this.connect(e)}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(t){if(this.object===void 0||this.dragging===!0)return;t!==null&&Gi.setFromCamera(t,this.camera);const e=Oa(this._gizmo.picker[this.mode],Gi);e?this.axis=e.object.name:this.axis=null}pointerDown(t){if(!(this.object===void 0||this.dragging===!0||t!=null&&t.button!==0)&&this.axis!==null){t!==null&&Gi.setFromCamera(t,this.camera);const e=Oa(this._plane,Gi,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,hh.mode=this.mode,this.dispatchEvent(hh)}}pointerMove(t){const e=this.axis,i=this.mode,n=this.object;let r=this.space;if(i==="scale"?r="local":(e==="E"||e==="XYZE"||e==="XYZ")&&(r="world"),n===void 0||e===null||this.dragging===!1||t!==null&&t.button!==-1)return;t!==null&&Gi.setFromCamera(t,this.camera);const o=Oa(this._plane,Gi,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&e!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),e.indexOf("X")===-1&&(this._offset.x=0),e.indexOf("Y")===-1&&(this._offset.y=0),e.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&e!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(n.position.applyQuaternion(Dt.copy(this._quaternionStart).invert()),e.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),r==="world"&&(n.parent&&n.position.add(oe.setFromMatrixPosition(n.parent.matrixWorld)),e.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(oe.setFromMatrixPosition(n.parent.matrixWorld)))),n.position.x=Math.max(this.minX,Math.min(this.maxX,n.position.x)),n.position.y=Math.max(this.minY,Math.min(this.maxY,n.position.y)),n.position.z=Math.max(this.minZ,Math.min(this.maxZ,n.position.z));else if(i==="scale"){if(e.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),Ci.set(a,a,a)}else oe.copy(this.pointStart),Ci.copy(this.pointEnd),oe.applyQuaternion(this._worldQuaternionInv),Ci.applyQuaternion(this._worldQuaternionInv),Ci.divide(oe),e.search("X")===-1&&(Ci.x=1),e.search("Y")===-1&&(Ci.y=1),e.search("Z")===-1&&(Ci.z=1);n.scale.copy(this._scaleStart).multiply(Ci),this.scaleSnap&&(e.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(oe.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;e==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(oe.copy(this.rotationAxis).cross(this.eye))*a):(e==="X"||e==="Y"||e==="Z")&&(this.rotationAxis.copy(ch[e]),oe.copy(ch[e]),r==="local"&&oe.applyQuaternion(this.worldQuaternion),oe.cross(this.eye),oe.length()===0?l=!0:this.rotationAngle=this._offset.dot(oe.normalize())*a),(e==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&e!=="E"&&e!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(Dt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(Dt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Pa),this.dispatchEvent(uh)}}pointerUp(t){t!==null&&t.button!==0||(this.dragging&&this.axis!==null&&(dh.mode=this.mode,this.dispatchEvent(dh)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(t){return this.object=t,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Pa),this.dispatchEvent(uh),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Gi}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}};function Gy(s){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:s.button};{const t=this.domElement.getBoundingClientRect();return{x:(s.clientX-t.left)/t.width*2-1,y:-(s.clientY-t.top)/t.height*2+1,button:s.button}}}function Qy(s){if(this.enabled)switch(s.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(s));break}}function Ky(s){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(s)),this.pointerDown(this._getPointer(s)))}function Jy(s){this.enabled&&this.pointerMove(this._getPointer(s))}function tv(s){this.enabled&&(this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(s)))}function Oa(s,t,e){const i=t.intersectObject(s,!0);for(let n=0;n<i.length;n++)if(i[n].object.visible||e)return i[n];return!1}const Xr=new Bm,$t=new M(0,1,0),ph=new M(0,0,0),fh=new xt,Gr=new je,ao=new je,Ke=new M,mh=new xt,Fn=new M(1,0,0),ts=new M(0,1,0),jn=new M(0,0,1),Qr=new M,Dn=new M,Mn=new M;let ev=class extends Ws{constructor(t){super(),this.isTransformControlsRoot=!0,this.controls=t,this.visible=!1}updateMatrixWorld(t){const e=this.controls;e.object!==void 0&&(e.object.updateMatrixWorld(),e.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):e.object.parent.matrixWorld.decompose(e._parentPosition,e._parentQuaternion,e._parentScale),e.object.matrixWorld.decompose(e.worldPosition,e.worldQuaternion,e._worldScale),e._parentQuaternionInv.copy(e._parentQuaternion).invert(),e._worldQuaternionInv.copy(e.worldQuaternion).invert()),e.camera.updateMatrixWorld(),e.camera.matrixWorld.decompose(e.cameraPosition,e.cameraQuaternion,e._cameraScale),e.camera.isOrthographicCamera?e.camera.getWorldDirection(e.eye).negate():e.eye.copy(e.cameraPosition).sub(e.worldPosition).normalize(),super.updateMatrixWorld(t)}dispose(){this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}},iv=class extends Ws{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const t=new ur({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),e=new Ul({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=t.clone();i.opacity=.15;const n=e.clone();n.opacity=.5;const r=t.clone();r.color.setHex(16711680);const o=t.clone();o.color.setHex(65280);const a=t.clone();a.color.setHex(255);const l=t.clone();l.color.setHex(16711680),l.opacity=.5;const c=t.clone();c.color.setHex(65280),c.opacity=.5;const h=t.clone();h.color.setHex(255),h.opacity=.5;const d=t.clone();d.opacity=.25;const p=t.clone();p.color.setHex(16776960),p.opacity=.25,t.clone().color.setHex(16776960);const u=t.clone();u.color.setHex(7895160);const g=new ce(0,.04,.1,12);g.translate(0,.05,0);const m=new re(.08,.08,.08);m.translate(0,.04,0);const b=new se;b.setAttribute("position",new Li([0,0,0,1,0,0],3));const f=new ce(.0075,.0075,.5,3);f.translate(0,.25,0);function y(v,L){const X=new _n(v,.0075,3,64,L*Math.PI*2);return X.rotateY(Math.PI/2),X.rotateX(Math.PI/2),X}function _(){const v=new se;return v.setAttribute("position",new Li([0,0,0,1,1,1],3)),v}const x={X:[[new rt(g,r),[.5,0,0],[0,0,-Math.PI/2]],[new rt(g,r),[-.5,0,0],[0,0,Math.PI/2]],[new rt(f,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new rt(g,o),[0,.5,0]],[new rt(g,o),[0,-.5,0],[Math.PI,0,0]],[new rt(f,o)]],Z:[[new rt(g,a),[0,0,.5],[Math.PI/2,0,0]],[new rt(g,a),[0,0,-.5],[-Math.PI/2,0,0]],[new rt(f,a),null,[Math.PI/2,0,0]]],XYZ:[[new rt(new $r(.1,0),d.clone()),[0,0,0]]],XY:[[new rt(new re(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new rt(new re(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new rt(new re(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},C={X:[[new rt(new ce(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new rt(new ce(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new rt(new ce(.2,0,.6,4),i),[0,.3,0]],[new rt(new ce(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new rt(new ce(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new rt(new ce(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new rt(new $r(.2,0),i)]],XY:[[new rt(new re(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new rt(new re(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new rt(new re(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},S={START:[[new rt(new $r(.01,2),n),null,null,null,"helper"]],END:[[new rt(new $r(.01,2),n),null,null,null,"helper"]],DELTA:[[new Fe(_(),n),null,null,null,"helper"]],X:[[new Fe(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Fe(b,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Fe(b,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},$={XYZE:[[new rt(y(.5,1),u),null,[0,Math.PI/2,0]]],X:[[new rt(y(.5,.5),r)]],Y:[[new rt(y(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new rt(y(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new rt(y(.75,1),p),null,[0,Math.PI/2,0]]]},O={AXIS:[[new Fe(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},z={XYZE:[[new rt(new Lm(.25,10,8),i)]],X:[[new rt(new _n(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new rt(new _n(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new rt(new _n(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new rt(new _n(.75,.1,2,24),i)]]},D={X:[[new rt(m,r),[.5,0,0],[0,0,-Math.PI/2]],[new rt(f,r),[0,0,0],[0,0,-Math.PI/2]],[new rt(m,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new rt(m,o),[0,.5,0]],[new rt(f,o)],[new rt(m,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new rt(m,a),[0,0,.5],[Math.PI/2,0,0]],[new rt(f,a),[0,0,0],[Math.PI/2,0,0]],[new rt(m,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new rt(new re(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new rt(new re(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new rt(new re(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new rt(new re(.1,.1,.1),d.clone())]]},j={X:[[new rt(new ce(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new rt(new ce(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new rt(new ce(.2,0,.6,4),i),[0,.3,0]],[new rt(new ce(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new rt(new ce(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new rt(new ce(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new rt(new re(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new rt(new re(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new rt(new re(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new rt(new re(.2,.2,.2),i),[0,0,0]]]},A={X:[[new Fe(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Fe(b,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Fe(b,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function k(v){const L=new Ws;for(const X in v)for(let V=v[X].length;V--;){const J=v[X][V][0].clone(),Y=v[X][V][1],nt=v[X][V][2],U=v[X][V][3],N=v[X][V][4];J.name=X,J.tag=N,Y&&J.position.set(Y[0],Y[1],Y[2]),nt&&J.rotation.set(nt[0],nt[1],nt[2]),U&&J.scale.set(U[0],U[1],U[2]),J.updateMatrix();const ot=J.geometry.clone();ot.applyMatrix4(J.matrix),J.geometry=ot,J.renderOrder=1/0,J.position.set(0,0,0),J.rotation.set(0,0,0),J.scale.set(1,1,1),L.add(J)}return L}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=k(x)),this.add(this.gizmo.rotate=k($)),this.add(this.gizmo.scale=k(D)),this.add(this.picker.translate=k(C)),this.add(this.picker.rotate=k(z)),this.add(this.picker.scale=k(j)),this.add(this.helper.translate=k(S)),this.add(this.helper.rotate=k(O)),this.add(this.helper.scale=k(A)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const e=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:ao;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let n=0;n<i.length;n++){const r=i[n];r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition);let o;if(this.camera.isOrthographicCamera?o=(this.camera.top-this.camera.bottom)/this.camera.zoom:o=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),r.scale.set(1,1,1).multiplyScalar(o*this.size/4),r.tag==="helper"){r.visible=!1,r.name==="AXIS"?(r.visible=!!this.axis,this.axis==="X"&&(Dt.setFromEuler(Xr.set(0,0,0)),r.quaternion.copy(e).multiply(Dt),Math.abs($t.copy(Fn).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Y"&&(Dt.setFromEuler(Xr.set(0,0,Math.PI/2)),r.quaternion.copy(e).multiply(Dt),Math.abs($t.copy(ts).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Z"&&(Dt.setFromEuler(Xr.set(0,Math.PI/2,0)),r.quaternion.copy(e).multiply(Dt),Math.abs($t.copy(jn).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="XYZE"&&(Dt.setFromEuler(Xr.set(0,Math.PI/2,0)),$t.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix(fh.lookAt(ph,$t,ts)),r.quaternion.multiply(Dt),r.visible=this.dragging),this.axis==="E"&&(r.visible=!1)):r.name==="START"?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):r.name==="END"?(r.position.copy(this.worldPosition),r.visible=this.dragging):r.name==="DELTA"?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),oe.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),oe.applyQuaternion(this.worldQuaternionStart.clone().invert()),r.scale.copy(oe),r.visible=this.dragging):(r.quaternion.copy(e),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=this.axis.search(r.name)!==-1));continue}r.quaternion.copy(e),this.mode==="translate"||this.mode==="scale"?(r.name==="X"&&Math.abs($t.copy(Fn).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Y"&&Math.abs($t.copy(ts).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Z"&&Math.abs($t.copy(jn).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XY"&&Math.abs($t.copy(jn).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="YZ"&&Math.abs($t.copy(Fn).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XZ"&&Math.abs($t.copy(ts).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1)):this.mode==="rotate"&&(Gr.copy(e),$t.copy(this.eye).applyQuaternion(Dt.copy(e).invert()),r.name.search("E")!==-1&&r.quaternion.setFromRotationMatrix(fh.lookAt(this.eye,ph,ts)),r.name==="X"&&(Dt.setFromAxisAngle(Fn,Math.atan2(-$t.y,$t.z)),Dt.multiplyQuaternions(Gr,Dt),r.quaternion.copy(Dt)),r.name==="Y"&&(Dt.setFromAxisAngle(ts,Math.atan2($t.x,$t.z)),Dt.multiplyQuaternions(Gr,Dt),r.quaternion.copy(Dt)),r.name==="Z"&&(Dt.setFromAxisAngle(jn,Math.atan2($t.y,$t.x)),Dt.multiplyQuaternions(Gr,Dt),r.quaternion.copy(Dt))),r.visible=r.visible&&(r.name.indexOf("X")===-1||this.showX),r.visible=r.visible&&(r.name.indexOf("Y")===-1||this.showY),r.visible=r.visible&&(r.name.indexOf("Z")===-1||this.showZ),r.visible=r.visible&&(r.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),r.material._color=r.material._color||r.material.color.clone(),r.material._opacity=r.material._opacity||r.material.opacity,r.material.color.copy(r.material._color),r.material.opacity=r.material._opacity,this.enabled&&this.axis&&(r.name===this.axis||this.axis.split("").some(function(a){return r.name===a}))&&(r.material.color.setHex(16776960),r.material.opacity=1)}super.updateMatrixWorld(t)}},sv=class extends rt{constructor(){super(new Rl(1e5,1e5,2,2),new ur({visible:!1,wireframe:!0,side:Mi,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(t){let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),Qr.copy(Fn).applyQuaternion(e==="local"?this.worldQuaternion:ao),Dn.copy(ts).applyQuaternion(e==="local"?this.worldQuaternion:ao),Mn.copy(jn).applyQuaternion(e==="local"?this.worldQuaternion:ao),$t.copy(Dn),this.mode){case"translate":case"scale":switch(this.axis){case"X":$t.copy(this.eye).cross(Qr),Ke.copy(Qr).cross($t);break;case"Y":$t.copy(this.eye).cross(Dn),Ke.copy(Dn).cross($t);break;case"Z":$t.copy(this.eye).cross(Mn),Ke.copy(Mn).cross($t);break;case"XY":Ke.copy(Mn);break;case"YZ":Ke.copy(Qr);break;case"XZ":$t.copy(Mn),Ke.copy(Dn);break;case"XYZ":case"E":Ke.set(0,0,0);break}break;case"rotate":default:Ke.set(0,0,0)}Ke.length()===0?this.quaternion.copy(this.cameraQuaternion):(mh.lookAt(oe.set(0,0,0),Ke,$t),this.quaternion.setFromRotationMatrix(mh)),super.updateMatrixWorld(t)}},nv=class Iu{constructor(t,e,i,n,r,o=5,a=!0){if(E(this,"onDraggingStarted",new K),E(this,"onDraggingEnded",new K),E(this,"onDisposed",new K),E(this,"normal"),E(this,"origin"),E(this,"three",new Te),E(this,"components"),E(this,"world"),E(this,"type","default"),E(this,"_title","Clipping Plane"),E(this,"_helper"),E(this,"_visible",!0),E(this,"_enabled",!0),E(this,"_controlsActive",!1),E(this,"_arrowBoundBox",new rt),E(this,"_planeMesh"),E(this,"_controls"),E(this,"_hiddenMaterial",new ur({visible:!1})),E(this,"_visibilityBeforeDisabled",!0),E(this,"notifyManager",()=>{const l=this.components.get($i),c=l.list.getKey(this);c&&l.list.set(c,this)}),E(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),E(this,"changeDrag",l=>{this._visible=!l.value,this.preventCameraMovement(),this.notifyDraggingChanged(l)}),this.components=t,this.world=e,!e.renderer)throw new Error("The given world must have a renderer!");this.normal=n,this.origin=i,e.renderer.setPlane(!0,this.three),this._planeMesh=Iu.newPlaneMesh(o,r),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(n,i),a&&this.toggleControls(!0)}set title(t){this._title=t,this.notifyManager()}get title(){return this._title}get enabled(){return this._enabled}set enabled(t){if(!this.world.isDisposing){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=t,t?this.visible=this._visibilityBeforeDisabled:(this._visibilityBeforeDisabled=this.visible,this.visible=!1),this.world.renderer.setPlane(t,this.three),this.notifyManager()}}get visible(){return this._visible}set visible(t){this._visible=t,this._controls.getHelper().visible=t,this._helper.visible=t,this.toggleControls(t),this.notifyManager()}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(t){this._planeMesh.material=t}get size(){return this._planeMesh.scale.x}set size(t){this._planeMesh.scale.set(t,t,t)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(t,e){this.reset(),this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.getHelper().removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const t=new M(1,0,0),e=new M;this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix()}toggleControls(t){if(t){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=t}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const t=this.world.camera.three,e=this.world.renderer.three.domElement,i=new Xy(t,e);return this.initializeControls(i),this.world.scene.three.add(i.getHelper()),i}initializeControls(t){t.attach(this._helper),t.showX=!1,t.showY=!1,t.setSpace("local"),this.createArrowBoundingBox(),t.getHelper().children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new ce(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(t){t.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const t=new Ws;return t.lookAt(this.normal),t.position.copy(this.origin),this._planeMesh.position.z+=.01,t.add(this._planeMesh),this.world.scene.three.add(t),t}static newPlaneMesh(t,e){const i=new Rl(1),n=new rt(i,e);return n.scale.set(t,t,t),n}},rv=class extends Vo{constructor(){super(...arguments),E(this,"_config",{enabled:{value:!0,type:"Boolean"},visible:{value:!0,type:"Boolean"},color:{value:new bt,type:"Color"},opacity:{type:"Number",interpolable:!0,value:1,min:0,max:1},size:{type:"Number",interpolable:!0,value:2,min:0,max:100}})}get enabled(){return this._config.enabled.value}set enabled(t){this._config.enabled.value=t,this._component.enabled=t}get visible(){return this._config.visible.value}set visible(t){this._config.visible.value=t,this._component.visible=t}get color(){return this._config.color.value}set color(t){this._config.color.value=t,this._component.material.color.copy(t)}get opacity(){return this._config.opacity.value}set opacity(t){this._config.opacity.value=t,this._component.material.opacity=t}get size(){return this._config.size.value}set size(t){this._config.size.value=t,this._component.size=t}};const zu=class lo extends Tt{constructor(t){super(t),E(this,"onSetup",new K),E(this,"onBeforeDrag",new K),E(this,"onAfterDrag",new K),E(this,"onBeforeCreate",new K),E(this,"onBeforeCancel",new K),E(this,"onAfterCancel",new K),E(this,"onBeforeDelete",new K),E(this,"onAfterCreate",new K),E(this,"onAfterDelete",new K),E(this,"onDisposed",new K),E(this,"isSetup",!1),E(this,"orthogonalY",!1),E(this,"toleranceOrthogonalY",.7),E(this,"Type",nv),E(this,"list",new Nt),E(this,"config",new rv(this,this.components,"Clipper",lo.uuid)),E(this,"_defaultConfig",{color:new bt(12255487),opacity:.2,size:2}),E(this,"_material",new ur({color:12255487,side:Mi,transparent:!0,opacity:.2})),E(this,"_size",5),E(this,"_enabled",!1),E(this,"_visible",!0),E(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),E(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(lo.uuid,this),this.setEvents()}get enabled(){return this._enabled}set enabled(t){this._enabled=t}get visible(){return this._visible}set visible(t){this._visible=t;for(const[e,i]of this.list)i.visible=t}get material(){return this._material}set material(t){this._material=t;for(const[e,i]of this.list)i.planeMaterial=t}get size(){return this._size}set size(t){this._size=t;for(const[e,i]of this.list)i.size=t}setEvents(){this.list.onBeforeDelete.add(({value:t})=>{if(!t.world.renderer)throw new Error("Renderer not found for this plane's world!");t.world.renderer.setPlane(!1,t.three),t.dispose(),this.updateMaterialsAndPlanes()})}dispose(){this._enabled=!1,this.components.get(Yl).list.delete(this.config.uuid),this.list.clear(),this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(lo.uuid),this.onDisposed.reset()}async create(t){const e=await this.components.get(fe).get(t).castRay();return e?this.createPlaneFromIntersection(t,e):null}createFromNormalAndCoplanarPoint(t,e,i){const n=this.newPlane(t,i,e);return this.updateMaterialsAndPlanes(),n}async delete(t,e){if(!e){const i=await this.pickPlane(t);if(!i)return;e=this.list.getKey(i)}e&&this.list.delete(e)}deleteAll(t){for(const[e,i]of this.list)(!t||t.has(i.type))&&this.list.delete(e)}setup(t){const e={...this._defaultConfig,...t};this.config.color=e.color,this.config.opacity=e.opacity,this.config.size=e.size,this.isSetup=!0,this.onSetup.trigger()}async pickPlane(t){const e=this.components.get(fe).get(t),i=this.getAllPlaneMeshes(),n=await e.castRay({items:i});if(n){const r=n.object;return[...this.list.values()].find(o=>o.meshes.includes(r))}}getAllPlaneMeshes(){const t=[];for(const[e,i]of this.list)t.push(...i.meshes);return t}createPlaneFromIntersection(t,e){var i;if(!t.renderer)throw new Error("The given world must have a renderer!");const n=e.point.distanceTo(new M(0,0,0)),r=e.normal||((i=e.face)==null?void 0:i.normal);if(!n||!r)return null;const o=this.getWorldNormal(e,r),a=this.newPlane(t,e.point,o.negate()),l=this.list.get(a);return l.visible=this._visible,l.size=this._size,t.renderer.setPlane(!0,l.three),this.updateMaterialsAndPlanes(),l}getWorldNormal(t,e){const i=t.object;let n=t.object.matrixWorld.clone();if(i instanceof wm&&t.instanceId!==void 0){const a=new xt;i.getMatrixAt(t.instanceId,a),n=a.multiply(n)}const r=new xm().getNormalMatrix(n),o=e.clone().applyMatrix3(r).normalize();return this.normalizePlaneDirectionY(o),o}normalizePlaneDirectionY(t){this.orthogonalY&&(t.y>this.toleranceOrthogonalY&&(t.x=0,t.y=1,t.z=0),t.y<-this.toleranceOrthogonalY&&(t.x=0,t.y=-1,t.z=0))}newPlane(t,e,i){const n=new this.Type(this.components,t,e,i,this._material);n.onDraggingStarted.add(this._onStartDragging),n.onDraggingEnded.add(this._onEndDragging);const r=ie.create();return this.list.set(r,n),this.onAfterCreate.trigger(n),r}updateMaterialsAndPlanes(){const t=this.components.get(vu);for(const[e,i]of t.list){if(!i.renderer)continue;i.renderer.updateClippingPlanes();const{clippingPlanes:n}=i.renderer;for(const r of i.meshes)if(r.material)if(Array.isArray(r.material))for(const o of r.material)o.clippingPlanes=n;else r.material.clippingPlanes=n}}};E(zu,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let $i=zu,Du=class{constructor(t,e){E(this,"title"),E(this,"guid",ie.create()),E(this,"clippingPlanes",new Zt),E(this,"camera",{aspect_ratio:1,field_of_view:60,camera_direction:{x:0,y:0,z:0},camera_view_point:{x:0,y:0,z:0},camera_up_vector:{x:0,y:1,z:0}}),E(this,"exceptionComponents",new Zt),E(this,"selectionComponents",new Zt),E(this,"componentColors",new Nt),E(this,"spacesVisible",!1),E(this,"spaceBoundariesVisible",!1),E(this,"openingsVisible",!1),E(this,"defaultVisibility",!0),E(this,"snapshot",this.guid),E(this,"_components"),E(this,"_world",null),E(this,"notifyUpdate",()=>{this._components.get(ci).list.set(this.guid,this)}),this._components=t,e&&(this.guid=e.guid??this.guid,this.set(e)),this.setEvents()}async getSelectionMap(){return await this._components.get(ut).guidsToModelIdMap([...this.selectionComponents])}async getExceptionMap(){return await this._components.get(ut).guidsToModelIdMap([...this.exceptionComponents])}get projection(){return"field_of_view"in this.camera?"Perspective":"Orthographic"}get position(){const t=this._components.get(ut),{camera_view_point:e}=this.camera,{x:i,y:n,z:r}=e,o=new M(i,n,r);return t.applyBaseCoordinateSystem(o,new xt),o}set position(t){const e=t.clone(),i=this._components.get(ut);t.clone().applyMatrix4(i.baseCoordinationMatrix.clone().invert()),this.camera.camera_view_point={x:e.x,y:e.y,z:e.z}}get direction(){const{camera_direction:t}=this.camera,{x:e,y:i,z:n}=t;return new M(e,i,n)}set world(t){this._world=t}get world(){return this._world}get _managerVersion(){return this._components.get(Yt).config.version}get topics(){return[...this._components.get(Yt).list.values()].filter(t=>t.viewpoints.has(this.guid))}setEvents(){this.selectionComponents.onUpdated.add(this.notifyUpdate),this.exceptionComponents.onUpdated.add(this.notifyUpdate),this.clippingPlanes.onUpdated.add(this.notifyUpdate),this.componentColors.onItemSet.add(this.notifyUpdate),this.componentColors.onItemDeleted.add(this.notifyUpdate),this.componentColors.onItemUpdated.add(this.notifyUpdate),this.componentColors.onCleared.add(this.notifyUpdate)}set(t){this.title=t.title;const{components:e,perspective_camera:i,orthogonal_camera:n,clipping_planes:r}=t;if(e){const{selection:o,visibility:a,coloring:l}=e;if(o){this.selectionComponents.clear();for(const{ifc_guid:c}of o)c&&this.selectionComponents.add(c)}if(a){const{default_visibility:c,exceptions:h,view_setup_hints:d}=a;if(c!==void 0&&(this.defaultVisibility=c),h){this.exceptionComponents.clear();for(const{ifc_guid:p}of h)p&&this.exceptionComponents.add(p)}if(d){const{spaces_visible:p,space_boundaries_visible:u,openings_visible:g}=d;p!==void 0&&(this.spacesVisible=p),u!==void 0&&(this.spaceBoundariesVisible=u),g!==void 0&&(this.openingsVisible=g)}}if(l){this.componentColors.clear();for(const c of l){const{color:h,components:d}=c,p=d.map(u=>u.ifc_guid).filter(u=>u!==null);this.componentColors.set(h,p)}}}if((i||n)&&(this.camera=i??n),r&&this.world){const o=this._components.get($i);for(const a of r){const{location:l,direction:c}=a,h=new M(l.x,l.z,-l.y),d=new M(c.x,c.z,-c.y),p=o.createFromNormalAndCoplanarPoint(this.world,d,h);this.clippingPlanes.add(p),o.list.get(p).enabled=!1,o.list.get(p).visible=!1}}this.notifyUpdate()}async go(t){if(!this.world)return;const{camera:e}=this.world;if(!(e instanceof ku))throw new Error("Viewpoint: the world's camera component must be of type OrthoPerspectiveCamera to switch between perspective and orthographic projections.");const{transition:i,applyClippings:n,applyVisibility:r,clippingsVisibility:o}={transition:!0,applyClippings:!0,applyVisibility:!0,clippingsVisibility:!0,...t};e.projection.set(this.projection);const a=new M(this.camera.camera_view_point.x,this.camera.camera_view_point.y,this.camera.camera_view_point.z),l=new M(this.camera.camera_direction.x,this.camera.camera_direction.y,this.camera.camera_direction.z);if(a.equals(new M)&&l.equals(new M))return;const c=this.position,h=this.direction,d=80,p={x:c.x+h.x*d,y:c.y+h.y*d,z:c.z+h.z*d},u=[];n&&this.setClippingState(!0),r&&u.push(this.applyVisibility()),this.setClippingVisibility(o),u.push(e.controls.setLookAt(c.x,c.y,c.z,p.x,p.y,p.z,i)),await Promise.all(u)}async updateCamera(t=!0){return new Promise(e=>{if(!this.world){e(!1);return}const{camera:i,renderer:n}=this.world;if(!n)throw new Error("Viewpoint: the world needs to have a renderer!");if(!i.hasCameraControls())throw new Error("Viewpoint: world's camera need camera controls!");const r=new M;i.controls.getPosition(r);const o=i.three,a=new M(0,0,-1).applyEuler(o.rotation),{width:l,height:c}=n.getSize();let h=l/c;Number.isNaN(h)&&(h=1);const d=this._components.get(ut);r.applyMatrix4(d.baseCoordinationMatrix.clone().invert());const p={aspect_ratio:h,camera_view_point:{x:r.x,y:r.y,z:r.z},camera_direction:{x:a.x,y:a.y,z:a.z},camera_up_vector:{x:0,y:1,z:0}};if(o instanceof Rd?this.camera={...p,field_of_view:o.fov}:o instanceof Bo&&(this.camera={...p,view_to_world_scale:o.top-o.bottom}),t){const u=this._components.get(ci),g=n.three.domElement;n.three.render(this.world.scene.three,i.three),g.toBlob(async m=>{if(m){const b=await m.arrayBuffer(),f=new Uint8Array(b);u.snapshots.set(this.guid,f)}this.notifyUpdate(),e(!0)})}else this.notifyUpdate(),e(!0)})}takeSnapshot(){return new Promise(t=>{if(!this.world){t(!1);return}const{camera:e,renderer:i}=this.world;if(!i)throw new Error("Viewpoint: the world needs to have a renderer!");const n=this._components.get(ci),r=i.three.domElement;i.three.render(this.world.scene.three,e.three),r.toBlob(async o=>{if(o){const a=await o.arrayBuffer(),l=new Uint8Array(a);n.snapshots.set(this.guid,l)}this.notifyUpdate(),t(!0)})})}updateClippingPlanes(){this.clippingPlanes.clear();const t=this._components.get($i);for(const[e,i]of t.list)i.enabled&&this.clippingPlanes.add(e)}async applyVisibility(){const t=this._components.get(Eb);t.set(this.defaultVisibility);const e=await this.getExceptionMap();t.set(!this.defaultVisibility,e);const i=await this.getSelectionMap();t.set(!0,i)}async setColorizationState(t){const e=this._components.get(ut),i=[];if(t)for(const[n,r]of this.componentColors){const o=`#${n}`,a=await e.guidsToModelIdMap(r);for(const[l,c]of Object.entries(a)){const h=e.list.get(l);h&&i.push(h.highlight([...c],{customId:o,color:new bt(o),renderedFaces:Nd.ONE,opacity:1,transparent:!1}))}}else for(const[n,r]of this.componentColors){const o=await e.guidsToModelIdMap(r);for(const[a,l]of Object.entries(o)){const c=e.list.get(a);c&&i.push(c.resetHighlight([...l]))}}i.push(e.core.update(!0)),await Promise.all(i)}setClippingState(t){const e=this._components.get($i);for(const[i,n]of e.list)n.enabled=t&&this.clippingPlanes.has(i)}setClippingVisibility(t){const e=this._components.get($i);for(const i of this.clippingPlanes){const n=e.list.get(i);n&&(n.visible=t)}}async createComponentTags(t){var e;const i=this._components.get(ut),n=this._components.get(Yt);let r="";if(n.config.includeSelectionTag){const o=t==="selection"?await this.getSelectionMap():await this.getExceptionMap();for(const a in o){const l=i.list.get(a);if(!l)continue;const c=o[a];for(const h of c){const d=l.getItem(h),p=await d.getGuid();if(!p)continue;const u=(e=await d.getAttributes())==null?void 0:e.getValue("Tag");let g=null;u&&(g=`AuthoringToolId="${u}"`),r+=`
<Component IfcGuid="${p}" ${g??""} />`}}}else r=[...this.selectionComponents].map(o=>`<Component IfcGuid="${o}" />`).join(`
`);return r}createColorTags(){let t="";for(const[e,i]of this.componentColors.entries()){const n=i.map(r=>`
<Component IfcGuid="${r}" />`).join(`
`);t+=`<Color Color="${e}">
${n}
</Color>`}return t.length!==0?`<Coloring>
${t}
</Coloring>`:"<Coloring />"}toJSON(){const t=this._components.get($i),e={guid:this.guid,components:{selection:[...this.selectionComponents].map(r=>({ifc_guid:r,authoring_tool_id:null})),coloring:[...this.componentColors].map(([r,o])=>({color:r,components:o.map(a=>({ifc_guid:a,authoring_tool_id:null}))})),visibility:{default_visibility:this.defaultVisibility,exceptions:[...this.exceptionComponents].map(r=>({ifc_guid:r,authoring_tool_id:null})),view_setup_hints:{spaces_visible:this.spacesVisible,space_boundaries_visible:this.spaceBoundariesVisible,openings_visible:this.openingsVisible}}},clipping_planes:[...this.clippingPlanes].map(r=>{const o=t.list.get(r);if(!o)return null;const a=o._controls.worldPosition??o.origin,{normal:l}=o;return{location:{x:a.x,y:-a.z,z:a.y},direction:{x:l.x,y:-l.z,z:l.y}}}).filter(r=>r!==null)};"field_of_view"in this.camera?e.perspective_camera=this.camera:e.orthogonal_camera=this.camera;const i=this._components.get(ci),n=i.snapshots.get(this.snapshot);if(n){const r=n.toString(),o=btoa(r),a=i.getSnapshotExtension(this.snapshot);e.snapshot={snapshot_type:a,snapshot_data:o}}return e}async serialize(t=this._managerVersion){const e=this._components.get(ut),i=this.position;i.applyMatrix4(e.baseCoordinationMatrix.clone().invert());const n=this.direction;n.normalize();const r=new xt().makeRotationX(Math.PI/2),o=n.clone().applyMatrix4(r);o.normalize();const a=`<CameraViewPoint>
      <X>${i.x}</X>
      <Y>${-i.z}</Y>
      <Z>${i.y}</Z>
    </CameraViewPoint>`,l=`<CameraDirection>
      <X>${n.x}</X>
      <Y>${-n.z}</Y>
      <Z>${n.y}</Z>
    </CameraDirection>`,c=`<CameraUpVector>
      <X>${o.x}</X>
      <Y>${-o.z}</Y>
      <Z>${o.y}</Z>
    </CameraUpVector>`,h=`<AspectRatio>${this.camera.aspect_ratio}</AspectRatio>`;let d="";"view_to_world_scale"in this.camera?d=`<OrthogonalCamera>
        ${a}
        ${l}
        ${c}
        ${h}
        <ViewToWorldScale>${this.camera.view_to_world_scale}</ViewToWorldScale>
      </OrthogonalCamera>`:"field_of_view"in this.camera&&(d=`<PerspectiveCamera>
        ${a}
        ${l}
        ${c}
        ${h}
        <FieldOfView>${this.camera.field_of_view}</FieldOfView>
      </PerspectiveCamera>`);const p=`<ViewSetupHints SpacesVisible="${this.spacesVisible??!1}" SpaceBoundariesVisible="${this.spaceBoundariesVisible??!1}" OpeningsVisible="${this.openingsVisible??!1}" />`,u=(await this.createComponentTags("selection")).trim(),g=(await this.createComponentTags("exception")).trim(),m=this.createColorTags();return`<?xml version="1.0" encoding="UTF-8"?>
    <VisualizationInfo Guid="${this.guid}">
      <Components>
        ${t==="2.1"?p:""}
        ${u.length!==0?`<Selection>${u}</Selection>`:""}
        <Visibility DefaultVisibility="${this.defaultVisibility}">
          ${t==="3"?p:""}
          ${g.length!==0?`<Exceptions>${g}</Exceptions>`:""}
        </Visibility>
        ${m}
      </Components>
      ${d}
    </VisualizationInfo>`}},ov=class extends Vo{constructor(){super(...arguments),E(this,"_config",{overwriteColors:{value:!1,type:"Boolean"}})}get overwriteColors(){return this._config.overwriteColors.value}set overwriteColors(t){this._config.overwriteColors.value=t}};const Mu=class dl extends Tt{constructor(t){super(t),E(this,"enabled",!0),E(this,"world",null),E(this,"list",new Nt),E(this,"snapshots",new Nt),E(this,"isSetup",!1),E(this,"onSetup",new K),E(this,"config",new ov(this,this.components,"Viewpoints",dl.uuid)),E(this,"onDisposed",new K),t.add(dl.uuid,this)}create(t){const e=new Du(this.components,t);return e.world=this.world,t||this.list.set(e.guid,e),e}getSnapshotExtension(t){let e="jpeg";const i=this.snapshots.get(t);if(!i)return e;const n=i.subarray(0,4);let r="";for(let o=0;o<n.length;o++)r+=n[o].toString(16);return r.startsWith("89504e47")&&(e="png"),r.startsWith("ffd8ffe")&&(e="jpeg"),e}setup(){}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}};E(Mu,"uuid","ee867824-a796-408d-8aa0-4e5962a83c66");let ci=Mu,gh=class{constructor(t,e){E(this,"_components"),E(this,"_cameraOffset",10),E(this,"_planeHelper"),E(this,"_farPlaneHelper"),E(this,"_cameraHelper"),E(this,"onStateChanged",new K),E(this,"onUpdated",new K),E(this,"onDisposed",new K),E(this,"camera"),E(this,"plane",new Te),E(this,"farPlane",new Te),E(this,"id",ie.create()),E(this,"_open",!1),E(this,"_range",av.defaultRange),E(this,"_world",null),E(this,"_helpersVisible",!1),E(this,"_planesEnabled",!1),this._components=t,this.camera=new ku(this._components);const{threeOrtho:i}=this.camera;if(e!=null&&e.id&&(this.id=e.id),e!=null&&e.normal&&e!=null&&e.point){const{normal:n,point:r}=e;this.plane.setFromNormalAndCoplanarPoint(n,r)}this._cameraHelper=new $m(i),this._planeHelper=new $c(this.plane,50),this._farPlaneHelper=new $c(this.farPlane,50),this.farPlaneHelperColor=new bt("blue"),this.update()}get _planeNormalOpposite(){return this.plane.normal.clone().negate()}get _planePosition(){return this.plane.normal.clone().multiplyScalar(-this.plane.constant)}get _cameraPosition(){return this._planePosition.addScaledVector(this._planeNormalOpposite,this._cameraOffset)}set open(t){this._open=t,this.onStateChanged.trigger(["open"])}get open(){return this._open}set planeHelperColor(t){!Array.isArray(this._planeHelper.material)&&"color"in this._planeHelper.material&&this._planeHelper.material.color instanceof bt&&(this._planeHelper.material.color=t)}set farPlaneHelperColor(t){!Array.isArray(this._farPlaneHelper.material)&&"color"in this._farPlaneHelper.material&&this._farPlaneHelper.material.color instanceof bt&&(this._farPlaneHelper.material.color=t)}set range(t){this._range=t,this.update()}get range(){return this._range}set distance(t){this.plane.constant=t,this.update()}get distance(){return this.plane.constant}set world(t){this._world=t,this.camera.currentWorld=t,t&&(this.camera.projection.set("Orthographic"),this.camera.set("Plan"),this.camera.controls.dollySpeed=6,this.camera.controls.restThreshold=.005,this.update())}get world(){return this._world}set helpersVisible(t){if(!t){this._helpersVisible=t,this._planeHelper.removeFromParent(),this._farPlaneHelper.removeFromParent(),this._cameraHelper.removeFromParent();return}this.world&&(this._helpersVisible=t,this.world.scene.three.add(this._planeHelper,this._farPlaneHelper))}get helpersVisible(){return this._helpersVisible}set planesEnabled(t){const{world:e}=this;if(!e)return;const{renderer:i}=e;i&&(i.setPlane(t,this.plane),i.setPlane(t,this.farPlane),this._planesEnabled=t)}get planesEnabled(){return this._planesEnabled}dispose(){this.helpersVisible=!1;const t=this._components.get(si);t.destroy(this._planeHelper),t.destroy(this._farPlaneHelper),t.destroy(this._cameraHelper),this.camera.dispose(),this.onDisposed.trigger()}update(){if(this.world){const t=this._cameraPosition,e=this._planePosition;this.camera.controls.setLookAt(t.x,t.y,t.z,e.x,e.y,e.z,!1)}this.farPlane.normal.copy(this._planeNormalOpposite),this.farPlane.constant=this.range-this.plane.constant,this.onUpdated.trigger()}flip(){this.plane.normal.negate(),this.update()}};const Ql=class Lu extends Tt{constructor(t){super(t),E(this,"list",new Nt),E(this,"enabled",!0),E(this,"world",null),E(this,"_fragmentsUpdateEvent",()=>{this.components.get(ut).core.update(!0)}),t.add(Lu.uuid,this),this.setupEvents()}get hasOpenViews(){return[...this.list.values()].some(t=>t.open)}setupEvents(){this.list.onBeforeDelete.add(({key:t,value:e})=>{e.open&&this.close(t),e.dispose()})}create(t,e,i){const n=new gh(this.components,{id:i==null?void 0:i.id,normal:t,point:e});return n.world=(i==null?void 0:i.world)??this.world,this.list.set(n.id,n),n}createFromPlane(t,e){const i=new gh(this.components,{id:e==null?void 0:e.id});return i.plane.copy(t),i.update(),i.world=(e==null?void 0:e.world)??this.world,this.list.set(i.id,i),i}async createFromIfcStoreys(t){const e=[],i=this.components.get(ut),n=(t==null?void 0:t.offset)===void 0?.25:t.offset;for(const[r,o]of i.list){if(t&&t.modelIds&&!t.modelIds.some(d=>d.test(r)))continue;const a=Object.values(await o.getItemsOfCategories([/BUILDINGSTOREY/])).flat();if(a.length===0)continue;const l=await o.getItemsData(a),[,c]=await o.getCoordinates(),h=new M(0,-1,0);for(const d of l){if(!("value"in d.Name&&"value"in d.Elevation))continue;const{value:p}=d.Name;if(t!=null&&t.storeyNames&&!t.storeyNames.some(b=>b.test(p)))continue;const u=d.Elevation.value+c+n,g=new Te(h,u),m=this.createFromPlane(g,{id:p,world:t==null?void 0:t.world});e.push(m)}}return e}createElevations(t){const e=[],i=this.components.get(ut),n=(t==null?void 0:t.combine)===void 0?!1:t.combine,r=(t==null?void 0:t.namingCallback)??(a=>({front:`${n?"Front":`${a}: Front`}`,back:`${n?"Back":`${a}: Back`}`,left:`${n?"Left":`${a}: Left`}`,right:`${n?"Right":`${a}: Right`}`}));let o=[];for(const[a,l]of i.list)t&&t.modelIds&&!t.modelIds.some(c=>c.test(a))||o.push({id:a,box:l.box});if(n){const a=this.components.get(go);a.list.clear(),a.list.add(...o.map(l=>l.box)),o=[{id:"combined",box:a.get()}]}for(const{id:a,box:l}of o){const{min:c,max:h}=l,d=Math.abs(h.x-c.x),p=Math.abs(h.z-c.z),u=new M;l.getCenter(u);const g=new Te(new M(0,0,-1),h.z),m=new Te(new M(0,0,1),-c.z),b=new Te(new M(-1,0,0),h.x),f=new Te(new M(1,0,0),-c.x),{front:y,back:_,left:x,right:C}=r(a),S=this.createFromPlane(g,{id:y,world:t==null?void 0:t.world});S.range=p;const $=this.createFromPlane(m,{id:_,world:t==null?void 0:t.world});$.range=p;const O=this.createFromPlane(b,{id:x,world:t==null?void 0:t.world});O.range=d;const z=this.createFromPlane(f,{id:C,world:t==null?void 0:t.world});z.range=d,e.push(S,$,O,z)}return e}open(t){const e=this.list.get(t);if(!e)throw new Error(`Views: the view with id ${t} doesn't exist.`);if(e.open)return;const{world:i}=e;if(!i)throw new Error(`Views: no world found for view with id ${t}.`);const{renderer:n}=i;if(!n)throw new Error(`Views: no renderer found for world with id ${i.uuid}.`);for(const[,r]of this.list)r.world===i&&this.close(r.id);n.setPlane(!0,e.plane),n.setPlane(!0,e.farPlane),e.camera.controls.addEventListener("rest",this._fragmentsUpdateEvent),i.camera=e.camera,e.open=!0}close(t){let e;if(t?e=this.list.get(t):e=[...this.list.values()].find(r=>r.open),t&&!e)throw new Error(`Views: the view with id ${t} doesn't exist.`);if(!e||!e.open)return;const{world:i}=e;if(!i)throw new Error(`Views: no world found for view with id ${t}.`);const{renderer:n}=i;if(!n)throw new Error(`Views: no renderer found for world with id ${i.uuid}.`);n.setPlane(!1,e.plane),n.setPlane(!1,e.farPlane),e.camera.controls.removeEventListener("rest",this._fragmentsUpdateEvent),i.useDefaultCamera(),e.open=!1}};E(Ql,"uuid","fb22f1f5-6598-4664-a11d-de8963ae420f");E(Ql,"defaultRange",15);let av=Ql,an=class{constructor(t){E(this,"cardinality","required"),E(this,"instructions"),E(this,"evalRequirement",(e,i,n,r)=>{const o={parameter:n,currentValue:e,requiredValue:i,pass:!1};r&&this.addCheckResult(o,r);let a=!1;if(i.type==="simple"&&(a=e===i.parameter),i.type==="enumeration"&&(a=i.parameter.includes(e)),i.type==="pattern"&&(a=new RegExp(i.parameter).test(String(e))),i.type==="length"){const{min:l,length:c,max:h}=i.parameter;c!==void 0&&(a=String(e).length===c),l!==void 0&&(a=String(e).length>=l),h!==void 0&&(a=String(e).length<=h)}if(i.type==="bounds"&&typeof e=="number"){const{min:l,minInclusive:c,max:h,maxInclusive:d}=i.parameter;let p=!0,u=!0;l!==void 0&&(p=c?e>=l:e>l),h!==void 0&&(u=d?e<=h:e<h),a=p&&u}return this.cardinality==="prohibited"&&(a=!a),this.cardinality==="optional"&&(a=!0),o.pass=a,o.pass}),this._components=t}addCheckResult(t,e){const i=e.findIndex(({parameter:n})=>n===t.parameter);i!==-1?e[i]=t:e.push(t)}getItemChecks(t,e,i,n){if(!("value"in i._localId&&typeof i._localId.value=="number"))return null;let r=t.get(e);r||(r=new Nt,t.set(e,r));let o=r.get(i._localId.value);if(o&&n&&!o.pass)return null;if(!o){const c=[];o={guid:Array.isArray(i._guid)?void 0:i._guid.value,pass:!1,checks:c},Object.defineProperty(o,"pass",{get:()=>c.every(({pass:h})=>h)}),r.set(i._localId.value,o)}const a=[],l={facetType:this.facetType,cardinality:this.cardinality,checks:a,pass:!1};return Object.defineProperty(l,"pass",{get:()=>a.every(({pass:c})=>c)}),o.checks.push(l),l.checks}};const ii=(s,t)=>{let e="";if(!t)return e;if(t.type==="simple"&&(e=`<simpleValue>${t.parameter}</simpleValue>`),t.type==="enumeration"&&(e=`<xs:restriction base="xs:string">
    ${t.parameter.map(i=>`<xs:enumeration value="${i}" />`).join(`
`)}
    </xs:restriction>`),t.type==="pattern"&&(e=`<xs:restriction base="xs:string">
      <xs:pattern value="${t.parameter}" />
    </xs:restriction>`),t.type==="bounds"){const{min:i,minInclusive:n,max:r,maxInclusive:o}=t.parameter;let a="";i!==void 0&&(a=`<xs:min${n?"Inclusive":"Exclusive"} value="${i}">`);let l="";r!==void 0&&(l=`<xs:max${o?"Inclusive":"Exclusive"} value="${r}">`),e=`<xs:restriction base="xs:double">
      ${a}
      ${l}
    </xs:restriction>`}if(t.type==="length"){const{length:i,min:n,max:r}=t.parameter;let o="";i!==void 0&&n===void 0&&r===void 0&&(o=`<xs:length value="${i}" />`);let a="";n!==void 0&&i===void 0&&(a=`<xs:minLength value="${n}" />`);let l="";r!==void 0&&i===void 0&&(l=`<xs:maxLength value="${r}" />`),e=`<xs:restriction base="xs:string">
      ${o}
      ${a}
      ${l}
    </xs:restriction>`}return`<${s[0].toLowerCase()+s.slice(1)}>
    ${e}
  </${s[0].toLowerCase()+s.slice(1)}>`};let lv=class extends an{constructor(t,e){super(t),E(this,"facetType","Attribute"),E(this,"name"),E(this,"value"),this.name=e}serialize(t){const e=ii("Name",this.name),i=ii("Value",this.value);let n="";return t==="requirement"&&(n+=`cardinality="${this.cardinality}"`,n+=this.instructions?`instructions="${this.instructions}"`:""),`<attribute ${n}>
  ${e}
  ${i}
</attribute>`}async getEntities(){}async test(t,e,i={skipIfFails:!0}){const n=this._components.get(ut);for(const[r,o]of Object.entries(t)){const a=n.list.get(r);if(!a)continue;const l=await a.getItemsData([...o]);for(const c of l){const h=this.getItemChecks(e,r,c,i.skipIfFails);if(!h)continue;const d=Object.keys(c).filter(u=>{const g=this.evalRequirement(u,this.name,"Name");if(!g)return!1;const m=c[u];return Array.isArray(m)?!0:m===null||m.value===null?this.cardinality==="optional"||this.cardinality==="prohibited":Array.isArray(m.value)&&m.value.length===0||typeof m.value=="string"&&m.value.trim()===""?!1:g}),p=d.length>0;if(h.push({parameter:"Name",currentValue:p?d[0]:null,requiredValue:this.name,pass:this.cardinality==="prohibited"?!p:p}),this.value)if(d[0]){const u=c[d[0]];Array.isArray(u)?h.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"}):Array.isArray(u.value)?h.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"}):this.evalRequirement(u.value,this.value,"Value",h)}else h.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"})}}}},cv=class extends an{constructor(t,e){super(t),E(this,"facetType","Classification"),E(this,"system"),E(this,"value"),E(this,"uri"),this.system=e}serialize(t){const e=ii("System",this.system),i=ii("Value",this.value);let n="";return t==="requirement"&&(n+=`cardinality="${this.cardinality}"`,n+=this.uri?`uri=${this.uri}`:"",n+=this.instructions?`instructions="${this.instructions}"`:""),`<classification ${n}>
  ${e}
  ${i}
</classification>`}async getEntities(t,e){}async test(t,e){}},ul=class extends an{constructor(t,e){super(t),E(this,"facetType","Entity"),E(this,"name"),E(this,"predefinedType"),this.name=e}serialize(t){const e=ii("Name",this.name),i=ii("Name",this.predefinedType);let n="";return t==="requirement"&&(n+=`cardinality="${this.cardinality}"`,n+=this.instructions?`instructions="${this.instructions}"`:""),`<entity ${n}>
  ${e}
  ${i}
</entity>`}async getEntities(t,e){const i=this._components.get(ut),n=new Map;for(const[o,a]of i.list){if(!t.find(c=>c.test(o)))continue;const l=await a.getCategories();for(const c of l){if(!await this.evalName(c))continue;let h=n.get(o);h||(h=[],n.set(o,h)),h.push(c)}}const r={};if(await Promise.all(Array.from(n.entries()).map(async([o,a])=>{const l=i.list.get(o);if(!l)return;const c=a.map(p=>new RegExp(`^${p}$`)),h=await l.getItemsOfCategories(c),d=Object.values(h).flat();r[o]=new Set(d)})),!this.predefinedType){St.add(e,r);return}for(const[o,a]of Object.entries(r)){const l=i.list.get(o);if(!l)continue;const c=await l.getItemsData([...a]);for(const h of c)"value"in h._localId&&await this.evalPredefinedType(o,h)&&St.append(e,o,h._localId.value)}}async test(t,e,i){const n=this._components.get(ut);for(const[r,o]of Object.entries(t)){const a=n.list.get(r);if(!a)continue;const l=await a.getItemsData([...o]);for(const c of l){if(!("value"in c._category))continue;const h=this.getItemChecks(e,r,c,i.skipIfFails);h&&(await this.evalName(c._category.value,h),await this.evalPredefinedType(r,c,h))}}}async evalName(t,e){return this.evalRequirement(t,this.name,"Name",e)}async evalPredefinedType(t,e,i){if(!this.predefinedType||!("value"in e.PredefinedType))return null;const n=typeof this.predefinedType.parameter=="string"&&this.predefinedType.parameter==="USERDEFINED";let r=e.PredefinedType.value;if(r==="USERDEFINED"&&!n){const o=Object.keys(e).find(a=>/^((?!Predefined).)*Type$/.test(a));if(o){const a=e[o];"value"in a&&(r=a.value)}else r="USERDEFINED"}if(!r){const o=this._components.get(ut).list.get(t);if(o&&"value"in e._localId){const[a]=await o.getItemsData([e._localId.value],{relations:{IsTypedBy:{attributes:!0,relations:!1}}});if(Array.isArray(a.IsTypedBy)){const l=a.IsTypedBy[0];if(l&&"value"in l.PredefinedType&&(r=l.PredefinedType.value,r==="USERDEFINED"&&!n)){const c=Object.keys(l).find(h=>/^((?!Predefined).)*Type$/.test(h));if(c){const h=l[c];"value"in h&&(r=h.value)}else r="USERDEFINED"}}}}return this.evalRequirement(r,this.predefinedType,"PredefinedType",i)}},hv=class extends an{constructor(t,e,i){super(t),E(this,"facetType","Property"),E(this,"propertySet"),E(this,"baseName"),E(this,"value"),E(this,"dataType"),E(this,"uri"),E(this,"_unsupportedTypes",["IFCCOMPLEXPROPERTY","IFCPHYSICALCOMPLEXQUANTITY"]),this.propertySet=e,this.baseName=i}serialize(t){const e=ii("PropertySet",this.propertySet),i=ii("BaseName",this.baseName),n=ii("Value",this.value),r=this.dataType?`dataType=${this.dataType}`:"";let o="";return t==="requirement"&&(o+=`cardinality="${this.cardinality}"`,o+=this.uri?`uri=${this.uri}`:"",o+=this.instructions?`instructions="${this.instructions}"`:""),`<property ${r} ${o}>
  ${e}
  ${i}
  ${n}
</property>`}async getEntities(t,e){const i=this._components.get(ut);for(const[n,r]of i.list){if(!t.find(c=>c.test(n)))continue;const o=await r.getItemsOfCategories([/PROPERTYSET/,/ELEMENTQUANTITY/]),a=Object.values(o).flat();if(a.length===0)continue;const l=await r.getItemsData(a,{relations:{HasProperties:{attributes:!0,relations:!1},DefinesOcurrence:{attributes:!0,relations:!1}}});for(const c of l){if(!("value"in c._localId&&"value"in c._category&&"value"in c.Name&&Array.isArray(c.DefinesOcurrence))||!this.evalRequirement(c.Name.value,this.propertySet,"PropertySet"))continue;let h;if(c._category.value==="IFCPROPERTYSET"&&(h="HasProperties"),c._category.value==="IFCELEMENTQUANTITY"&&(h="Quantities"),!h)continue;const d=c[h];if(Array.isArray(d))for(const p of d){const u=Object.keys(p),g=u.find(f=>/Name/.test(f));if(!(g&&"value"in p[g]))continue;const m=p[g];if(!("value"in m)||!this.evalRequirement(m.value,this.baseName,"BaseName"))continue;if(this.value){const f=u.find(_=>/Value/.test(_));if(!f)continue;const y=p[f];if(!("value"in y)||!this.evalRequirement(y.value,this.value,"Value"))continue}const b=c.DefinesOcurrence.map(f=>"value"in f._localId&&typeof f._localId.value=="number"?f._localId.value:null).filter(f=>f!==null);St.append(e,n,...b)}}}}async test(t,e,i={skipIfFails:!0}){const n=this._components.get(ut);for(const[r,o]of Object.entries(t)){const a=n.list.get(r);if(!a)continue;const l=await a.getItemsData([...o],{relations:{IsDefinedBy:{attributes:!0,relations:!0},IsTypedBy:{attributes:!0,relations:!1},HasPropertySets:{attributes:!0,relations:!0},DefinesOcurrence:{attributes:!1,relations:!1}}});for(const c of l){const h=this.getItemChecks(e,r,c,i.skipIfFails);if(!h)continue;const d=(await this.getPsets(c)).filter(p=>!("value"in p.Name)||!this.evalRequirement(p.Name.value,this.propertySet,"PropertySet")?!1:(h.push({currentValue:p.Name.value,parameter:"PropertySet",pass:!0,requiredValue:this.propertySet}),!0));if(d.length===0){h.push({currentValue:null,parameter:"PropertySet",pass:!1,requiredValue:this.propertySet});continue}for(const p of d){const u=this.getPropertyListName(p);if(!u)continue;const g=p[u];if(!Array.isArray(g)){h.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName});continue}const m=g.filter(b=>!("value"in b._category&&"value"in b.Name)||this._unsupportedTypes.includes(b._category.value)||!this.evalRequirement(b.Name.value,this.baseName,"BaseName")?!1:(h.push({currentValue:b.Name.value,parameter:"BaseName",pass:!0,requiredValue:this.baseName}),!0));if(m.length===0){h.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName});continue}for(const b of m)this.evalValue(b,h),this.evalDataType(b,h),this.evalURI()}}}}getPropertyListName(t){let e;return"value"in t._category&&(t._category.value==="IFCPROPERTYSET"&&(e="HasProperties"),t._category.value==="IFCELEMENTQUANTITY"&&(e="Quantities")),e}getValueKey(t){return Object.keys(t).find(e=>/Value/.test(e)||/Values/.test(e))}getTypePsets(t){if(!Array.isArray(t.IsTypedBy))return[];const[e]=t.IsTypedBy;return e&&Array.isArray(e.HasPropertySets)?e.HasPropertySets:[]}async getPsets(t){const e=this.getTypePsets(t);if(!Array.isArray(t.IsDefinedBy))return e;const i=[];for(const n of t.IsDefinedBy){if(!("value"in n.Name))continue;const r=n.Name.value,o=this.getPropertyListName(n);if(!(r&&o))continue;const a=e.find(l=>"value"in l.Name?l.Name.value===r:!1);if(a&&Array.isArray(a.HasProperties)&&Array.isArray(n.HasProperties))for(const l of a.HasProperties){if(!("value"in l.Name))continue;const c=l.Name.value;n.HasProperties.find(h=>"value"in h.Name?h.Name.value===c:!1)||n.HasProperties.push(l)}i.push(n)}return i}evalValue(t,e){const i=this.getValueKey(t),n=t[i];if(!("value"in n))return!1;if(this.value){if(!i)return e==null||e.push({parameter:"Value",currentValue:null,pass:!1,requiredValue:this.value}),!1;const r=structuredClone(this.value);return n.type==="IFCLABEL"&&r.type==="simple"&&(r.parameter=String(r.parameter)),this.evalRequirement(n.value,r,"Value",e)}return i&&typeof n.value=="string"&&n.value.trim()===""?(e==null||e.push({parameter:"Value",currentValue:"",pass:!1,requiredValue:this.value}),!1):!0}evalDataType(t,e){if(!this.dataType)return!0;const i=this.getValueKey(t);if(!(i&&"value"in t[i]))return e==null||e.push({parameter:"DataType",currentValue:null,pass:!1,requiredValue:this.dataType}),!1;const n=t[i];return this.evalRequirement(n.type??null,{type:"simple",parameter:this.dataType},"DataType",e)}evalURI(){return!0}},dv=class extends an{constructor(){super(...arguments),E(this,"_ifcMaterialEntities",[/^IFCMATERIALLAYERSETUSAGE$/,/^IFCMATERIALCONSTITUENTSET$/,/^IFCMATERIAL$/,/^IFCMATERIALLIST$/]),E(this,"facetType","Material"),E(this,"value"),E(this,"uri")}serialize(t){if(!(this.value&&this.uri))return"<material />";const e=ii("Value",this.value);let i="";return t==="requirement"&&(i+=`cardinality="${this.cardinality}"`,i+=this.uri?`uri=${this.uri}`:"",i+=this.instructions?`instructions="${this.instructions}"`:""),`<material ${i}>
  ${e}
</material>`}async getEntities(t,e){const i=this._components.get(ut);for(const[n,r]of i.list){if(!t.find(c=>c.test(n)))continue;const o=await r.getItemsOfCategories(this._ifcMaterialEntities),a=Object.values(o).flat();if(a.length===0)continue;const l=await r.getItemsData(a,{relations:{AssociatedTo:{attributes:!0,relations:!1},MaterialConstituents:{attributes:!0,relations:!0},ForLayerSet:{attributes:!0,relations:!0},MaterialLayers:{attributes:!0,relations:!0},Materials:{attributes:!0,relations:!1}}});for(const c of l){if(!("value"in c._localId&&"value"in c._category&&Array.isArray(c.AssociatedTo))||!this.hasValidMaterial(c))continue;const h=c.AssociatedTo.map(d=>"value"in d._localId&&d._localId.value?d._localId.value:null).filter(d=>d!==null);St.append(e,n,...h)}}}async test(t,e,i={skipIfFails:!0}){const n=this._components.get(ut);for(const[r,o]of Object.entries(t)){const a=n.list.get(r);if(!a)continue;const l=await a.getItemsData([[...o][0]],{relations:{AssociatedTo:{attributes:!1,relations:!1},HasAssociations:{attributes:!0,relations:!0},MaterialConstituents:{attributes:!0,relations:!0},ForLayerSet:{attributes:!0,relations:!0},MaterialLayers:{attributes:!0,relations:!0},Materials:{attributes:!0,relations:!1}}});for(const c of l){const h=this.getItemChecks(e,r,c,i.skipIfFails);if(h){if(!Array.isArray(c.HasAssociations)){h.push({parameter:null,currentValue:null,requiredValue:this.value,pass:!1});continue}for(const d of c.HasAssociations)if(this._ifcMaterialEntities.some(p=>"value"in d._category?p.test(d._category.value):!1)&&this.hasValidMaterial(d,h))break}}}}hasValidMaterial(t,e){let i=!1;if("value"in t._category&&t._category.value==="IFCMATERIAL")this.evalValue(t,e)&&(i=!0);else for(const[n,r]of Object.entries(t))if(["ForLayerSet","MaterialLayers","Material","MaterialConstituents","Materials"].includes(n)&&Array.isArray(r)){for(const o of r)if("value"in o._category&&o._category.value==="IFCMATERIAL"){if(this.evalValue(o,e)){i=!0;break}}else if(this.hasValidMaterial(o)){i=!0;break}}return i}evalValue(t,e){if(!this.value)return e==null||e.push({parameter:null,currentValue:t.Name&&"value"in t.Name?t.Name.value:null,pass:!0}),!0;if(!("value"in t._category&&t._category.value==="IFCMATERIAL"))return null;let i=!1;return t.Name&&"value"in t.Name&&(i=this.evalRequirement(t.Name.value,this.value,"Value",e)),i||(t.Category&&"value"in t.Category&&(i=this.evalRequirement(t.Category.value,this.value,"Value",e)),i)}},uv=class extends an{constructor(t,e){super(t),E(this,"facetType","PartOf"),E(this,"_entityFacet"),E(this,"_entity"),E(this,"relation"),E(this,"cardinality","required"),this._entity=e,this._entityFacet=new ul(t,e.name),this._entityFacet.predefinedType=e.predefinedType}set entity(t){this._entity=t;const{name:e,predefinedType:i}=t;this._entityFacet=new ul(this._components,e),this._entityFacet.predefinedType=i}get entity(){return this._entity}serialize(){return""}async getEntities(t,e){}async test(t){}},pv=class{constructor(t,e,i){E(this,"name"),E(this,"ifcVersion",new Set),E(this,"identifier",ie.create()),E(this,"description"),E(this,"instructions"),E(this,"requirementsDescription"),E(this,"applicability",new Zt),E(this,"requirements",new Zt),E(this,"components"),this.components=t,this.name=e;for(const n of i)this.ifcVersion.add(n)}set(t){const e=t,i=this;for(const n in t){if(n==="identifier")continue;const r=e[n];n in this&&(i[n]=r)}return this.components.get(fv).list.set(this.identifier,this),this}async test(t,e={skipIfFails:!0}){const i=new Nt;if(this.requirements.size===0)return i;const n={},r=[];for(const a of this.applicability)r.push(a.getEntities(t,n));await Promise.all(r);const o=[];for(const a of this.requirements)o.push(a.test(n,i,e));return await Promise.all(o),i}serialize(){const t=`name="${this.name}"`,e=this.identifier?`identifier="${this.identifier}"`:"",i=this.description?`description="${this.description}"`:"",n=this.instructions?`instructions="${this.instructions}"`:"";return`<specification ifcVersion="${[...this.ifcVersion].join(" ")}" ${t} ${e} ${i} ${n}>
      <applicability minOccurs="1" maxOccurs="unbounded">
        ${[...this.applicability].map(r=>r.serialize("applicability")).join(`
`)}
      </applicability>
      <requirements>
        ${[...this.requirements].map(r=>r.serialize("requirement")).join(`
`)}
      </requirements>
    </specification>`}};const De=s=>{if(!s)return;const t={};if("simpleValue"in s&&(t.type="simple",t.parameter=s.simpleValue),"restriction"in s){const e=s.restriction,i=Object.keys(e);if("pattern"in e&&(t.type="pattern",t.parameter=e.pattern.value),"enumeration"in e){t.type="enumeration";const n=e.enumeration.map(({value:r})=>r);t.parameter=n}if(i.some(n=>["minInclusive","minExclusive","maxInclusive","maxExclusive"].includes(n))){t.type="bounds";const n={},r=i.find(a=>a.includes("min")),o=i.find(a=>a.includes("max"));r&&(n.minInclusive=r==="minInclusive",n.min=e[r].value),o&&(n.maxInclusive=o==="maxInclusive",n.max=e[o].value),t.parameter=n}if(i.some(n=>["minLength","length","maxLength"].includes(n))){t.type="length";const n={};e.length!==void 0&&(n.length=e.length.value),e.minLength!==void 0&&(n.min=e.minLength.value),e.maxLength!==void 0&&(n.max=e.maxLength.value),t.parameter=n}}if(t.parameter!==void 0)return t},bh=(s,t)=>{const e=[];for(const i of t){const n=i.name,r=De(n);if(!r)continue;const o=new ul(s,r);i.cardinality&&(o.cardinality=i.cardinality),o.predefinedType=De(i.predefinedType),o.instructions=i.instructions,e.push(o)}return e},yh=(s,t)=>{const e=[];for(const i of t){const n=i.name,r=De(n);if(!r)continue;const o=new lv(s,r);i.cardinality&&(o.cardinality=i.cardinality),o.value=De(i.value),o.instructions=i.instructions,e.push(o)}return e},vh=(s,t)=>{const e=[];for(const i of t){const n=new dv(s);i.cardinality&&(n.cardinality=i.cardinality);const r=De(i.value);(r==null?void 0:r.type)==="enumeration"&&Array.isArray(r.parameter)&&(r.parameter=r.parameter.map(String)),n.value=r,n.uri=i.uri,n.instructions=i.instructions,e.push(n)}return e},_h=(s,t)=>{const e=[];for(const i of t){const n=i.propertySet,r=i.baseName,o=De(n),a=De(r);if(!(a&&o))continue;const l=new hv(s,o,a);i.cardinality&&(l.cardinality=i.cardinality);const c=De(i.value);l.value=c,l.dataType=i.dataType,l.uri=i.uri,l.instructions=i.instructions,e.push(l)}return e},wh=(s,t)=>{const e=[];for(const i of t){const n=i.system,r=De(n);if(!r)continue;const o=new cv(s,r);i.cardinality&&(o.cardinality=i.cardinality);const a=De(i.value);(a==null?void 0:a.type)==="simple"&&(a.parameter=String(a.parameter)),(a==null?void 0:a.type)==="enumeration"&&Array.isArray(a.parameter)&&(a.parameter=a.parameter.map(String)),o.value=a,o.uri=i.uri,o.instructions=i.instructions,e.push(o)}return e},xh=(s,t)=>{const e=[];for(const i of t){const n=De(i.entity.name);if(!n)continue;const r=De(i.entity.predefinedType),o=new uv(s,{name:n,predefinedType:r});o.relation=i.relation,i.cardinality&&(o.cardinality=i.cardinality),o.instructions=i.instructions,e.push(o)}return e},Kl=class pl extends Tt{constructor(t){super(t),E(this,"enabled",!0),E(this,"list",new Ys),t.add(pl.uuid,this)}getModelIdMap(t){const e={},i={};for(const[n,r]of t){const o=[...r].filter(([,l])=>l.pass).map(([l])=>l);St.append(e,n,...o);const a=[...r].filter(([,l])=>!l.pass).map(([l])=>l);St.append(i,n,...a)}return{pass:e,fail:i}}create(t,e,i){const n=new pv(this.components,t,e);return i&&(n.identifier=i),this.list.set(n.identifier,n),n}load(t){const e=[],i=pl.xmlParser.parse(t).ids,{specifications:n}=i;if(n&&n.specification){const r=Array.isArray(n.specification)?n.specification:[n.specification];for(const o of r){const{name:a,ifcVersion:l,description:c,instructions:h,identifier:d}=o;if(!(a&&l))continue;const p=[],u=[],{applicability:g,requirements:m}=o;if(g){const{maxOccurs:y,..._}=g,x=Array.isArray(_)?_:[_];for(const C of x)for(const S in C){const $=Array.isArray(C[S])?C[S]:[C[S]];if(S==="entity"){const O=bh(this.components,$);p.push(...O)}if(S==="attribute"){const O=yh(this.components,$);p.push(...O)}if(S==="material"){const O=vh(this.components,$);p.push(...O)}if(S==="classification"){const O=wh(this.components,$);p.push(...O)}if(S==="property"){const O=_h(this.components,$);p.push(...O)}if(S==="partOf"){const O=xh(this.components,$);p.push(...O)}}}let b;if(m){const{maxOccurs:y,..._}=m;b=m.description;const x=Array.isArray(_)?_:[_];for(const C of x)for(const S in C){const $=Array.isArray(C[S])?C[S]:[C[S]];if(S==="entity"){const O=bh(this.components,$);u.push(...O)}if(S==="attribute"){const O=yh(this.components,$);u.push(...O)}if(S==="material"){const O=vh(this.components,$);u.push(...O)}if(S==="classification"){const O=wh(this.components,$);u.push(...O)}if(S==="property"){const O=_h(this.components,$);u.push(...O)}if(S==="partOf"){const O=xh(this.components,$);u.push(...O)}}}const f=this.create(a,l.split(/\s+/),d);f.description=c,f.instructions=h,f.requirementsDescription=b,f.applicability.add(...p),f.requirements.add(...u),e.push(f)}}return e}export(t,e=this.list.values()){const i=e??this.list;return`<ids xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://standards.buildingsmart.org/IDS http://standards.buildingsmart.org/IDS/1.0/ids.xsd" xmlns:ids="http://standards.buildingsmart.org/IDS">
  <!-- Made with That Open Engine ${Tu.release} (https://github.com/thatopen/engine_components) -->
  <info>
    <title>${t.title}</title>
    ${t.copyright?`<copyright>${t.copyright}</copyright>`:""}
    ${t.version?`<version>${t.version}</version>`:""}
    ${t.description?`<description>${t.description}</description>`:""}
    ${t.author?`<author>${t.author}</author>`:""}
    ${t.date?`<date>${t.date.toISOString().split("T")[0]}</date>`:""}
    ${t.purpose?`<purpose>${t.purpose}</purpose>`:""}
    ${t.milestone?`<milestone>${t.milestone}</milestone>`:""}
  </info>
  <specifications>
    ${[...i].map(n=>n.serialize()).join(`
`)}
  </specifications>
</ids>`}};E(Kl,"uuid","9f0b9f78-9b2e-481a-b766-2fbfd01f342c");E(Kl,"xmlParser",new jo.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let fv=Kl;const Bu=class Nu extends Tt{constructor(t){super(t),E(this,"enabled",!0),t.add(Nu.uuid,this)}static distanceFromPointToLine(t,e,i,n=!1){const r=new ze,o=new M;return r.set(e,i),r.closestPointToPoint(t,n,o),o.distanceTo(t)}round(t){t.x=Math.trunc(t.x*1e3)/1e3,t.y=Math.trunc(t.y*1e3)/1e3,t.z=Math.trunc(t.z*1e3)/1e3}async getVolumeFromFragments(t){return console.warn("getVolumeFromFragments is deprecated. Use getItemsVolume instead."),this.getItemsVolume(t)}async getItemsVolume(t){let e=0;const i=this.components.get(ut);for(const[n,r]of Object.entries(t)){const o=i.list.get(n);o&&(e+=await o.getItemsVolume([...r]))}return e}static convertUnits(t,e,i,n=2){const r={m:1,cm:.01,mm:.001,km:1e3,m2:1,cm2:1e-4,mm2:1e-6,km2:1e6,m3:1,cm3:1e-6,mm3:1e-9,km3:1e9};if(!r[e]||!r[i])throw new Error("Invalid units provided for conversion.");if(!Number.isInteger(n)||n<0||n>5)throw new Error("Precision must be an integer between 0 and 5.");let o=r[e]/r[i];e.endsWith("2")&&i.endsWith("2")?o**=2:e.endsWith("3")&&i.endsWith("3")&&(o**=3);const a=t*o,l=10**n;return Math.round(a*l)/l}};E(Bu,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");let Zs=Bu;const mv=class Uu extends Tt{constructor(t){super(t),T(this,"enabled",!0),T(this,"inputs",["OBC","BUI"]),T(this,"_requestEventID","thatOpenCompanyComponentRequested"),T(this,"_createEventID","thatOpenCompanyComponentCreated"),t.add(Uu.uuid,this)}async import(t){return new Promise(e=>{const i=document.createElement("script"),n=`
        function main() {
          const { ${this.inputs} } = window.ThatOpenCompany;
        
          ${t}
        
          const onComponentRequested = () => {
            window.removeEventListener("${this._requestEventID}", onComponentRequested);
            const event = new CustomEvent("${this._createEventID}", { detail: main });
            window.dispatchEvent(event);
          };
          
          window.addEventListener("${this._requestEventID}", onComponentRequested);
        }
        
        main();
      `,r=o=>{window.removeEventListener(this._createEventID,r);const a=o.detail,l=this.components.get(a);i.remove(),e(l)};i.addEventListener("load",()=>{window.addEventListener(this._createEventID,r),window.dispatchEvent(new Event(this._requestEventID))}),i.src=URL.createObjectURL(new File([n],"temp.js")),document.head.appendChild(i)})}};T(mv,"uuid","74c0c370-1af8-4ca9-900a-4a4196c0f2f5");let Ru=class extends Ws{constructor(t=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Vt(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&e.element.parentNode!==null&&e.element.remove()})})}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this.center=t.center,this}};const zs=new M,Ch=new xt,Eh=new xt,Sh=new M,Ah=new M;let gv=class{constructor(t={}){const e=this;let i,n,r,o;const a={objects:new WeakMap},l=t.element!==void 0?t.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:i,height:n}},this.render=function(g,m){g.matrixWorldAutoUpdate===!0&&g.updateMatrixWorld(),m.parent===null&&m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),Ch.copy(m.matrixWorldInverse),Eh.multiplyMatrices(m.projectionMatrix,Ch),h(g,g,m),u(g)},this.setSize=function(g,m){i=g,n=m,r=i/2,o=n/2,l.style.width=g+"px",l.style.height=m+"px"};function c(g){g.isCSS2DObject&&(g.element.style.display="none");for(let m=0,b=g.children.length;m<b;m++)c(g.children[m])}function h(g,m,b){if(g.visible===!1){c(g);return}if(g.isCSS2DObject){zs.setFromMatrixPosition(g.matrixWorld),zs.applyMatrix4(Eh);const f=zs.z>=-1&&zs.z<=1&&g.layers.test(b.layers)===!0,y=g.element;y.style.display=f===!0?"":"none",f===!0&&(g.onBeforeRender(e,m,b),y.style.transform="translate("+-100*g.center.x+"%,"+-100*g.center.y+"%)translate("+(zs.x*r+r)+"px,"+(-zs.y*o+o)+"px)",y.parentNode!==l&&l.appendChild(y),g.onAfterRender(e,m,b));const _={distanceToCameraSquared:d(b,g)};a.objects.set(g,_)}for(let f=0,y=g.children.length;f<y;f++)h(g.children[f],m,b)}function d(g,m){return Sh.setFromMatrixPosition(g.matrixWorld),Ah.setFromMatrixPosition(m.matrixWorld),Sh.distanceToSquared(Ah)}function p(g){const m=[];return g.traverseVisible(function(b){b.isCSS2DObject&&m.push(b)}),m}function u(g){const m=p(g).sort(function(f,y){if(f.renderOrder!==y.renderOrder)return y.renderOrder-f.renderOrder;const _=a.objects.get(f).distanceToCameraSquared,x=a.objects.get(y).distanceToCameraSquared;return _-x}),b=m.length;for(let f=0,y=m.length;f<y;f++)m[f].element.style.zIndex=b-f}}},rs=class{constructor(t,e,i){T(this,"three"),T(this,"world"),T(this,"onDisposed",new K),this.world=t;let n;if(e)n=e;else{n=document.createElement("div");const r="6px";n.style.color="white",n.style.height=r,n.style.width=r,n.style.borderRadius="50%",n.style.border="2px solid rgb(122, 75, 209)",n.style.zIndex="-20"}this.three=new Ru(n),(i||t.scene.three).add(this.three),this.visible=!0}set visible(t){this.three.visible=t}get visible(){return this.three.visible}toggleVisibility(){this.visible=!this.visible}notDisplay(){this.visible=!1}dispose(){this.three.removeFromParent(),this.three.element.remove(),this.onDisposed.trigger(),this.onDisposed.reset()}},bv=class extends kb{constructor(t,e,i){super(t,e,i),T(this,"three2D",new gv),this.onAfterUpdate.add(()=>{if(this.onBeforeUpdate.trigger(this),!this.enabled||!this.currentWorld)return;const n=this.currentWorld.scene.three,r=this.currentWorld.camera.three;n instanceof Um&&this.three2D.render(n,r)}),this.onDisposed.add(()=>{this.three2D.domElement.remove()}),this.onResize.add(({x:n,y:r})=>{this.three2D.setSize(n,r)}),this.setupHtmlRenderer(),this.resize()}setupHtmlRenderer(){this.three2D.domElement.style.position="absolute",this.three2D.domElement.style.top="0px",this.three2D.domElement.style.pointerEvents="none",this.container&&(this.container.appendChild(this.three2D.domElement),this.container.style.position="relative")}};const yv=class Fu extends Tt{constructor(t){super(t),T(this,"onDisposed",new K),T(this,"enabled",!0),T(this,"threshold",50),T(this,"autoCluster",!0),T(this,"list",new Map),T(this,"clusterLabels",new Set),T(this,"currentKeys",new Set),T(this,"_color","white"),T(this,"_markerKey",0),T(this,"_clusterKey",0),T(this,"_worldEvents",new Map),T(this,"_setupWorlds",new Set),T(this,"clusterElementFactory",()=>{const e=document.createElement("div");return e.style.color="#000000",e.style.background="#FFFFFF",e.style.fontSize="1.2rem",e.style.fontWeight="500",e.style.borderRadius="50%",e.style.padding="5px 11px",e.style.textAlign="center",e.addEventListener("pointerover",()=>{e.style.background="#BCF124"}),e.addEventListener("pointerout",()=>{e.style.background="#FFFFFF"}),e}),t.add(Fu.uuid,this)}get color(){return this._color}set color(t){this._color=t;for(const[e,i]of this.list)for(const[n,r]of i)r.label.three.element.style.color=t}create(t,e,i,n=!1){this.setupEvents(t,!0);const r=this._markerKey.toString(),o=this.getWorldMarkerList(t);if(o.has(r))return null;const a=document.createElement("span");a.append(e);const l=new rs(t,a);return l.three.position.copy(i),o.set(r,{key:r,label:l,merged:!1,static:n}),this._markerKey++,r}delete(t){for(const[e,i]of this.list){const n=i.get(t);n&&n.label.dispose(),i.delete(t)}}getWorldMarkerList(t){return this.list.has(t.uuid)||this.list.set(t.uuid,new Map),this.list.get(t.uuid)}dispose(t){for(const[e,i]of this.list){const n=[...i.keys()];for(const r of n){const o=i.get(r);t&&o.type!==t||(o.label.dispose(),i.delete(r))}}if(!t){this.list.clear(),this._markerKey=0;for(const e of this.clusterLabels)e.label.dispose();this.clusterLabels.clear(),this._clusterKey=0,this.currentKeys.clear()}this.onDisposed.trigger()}setupEvents(t,e){if(e&&this._setupWorlds.has(t.uuid)||!t.camera.hasCameraControls())return;const i=this.getWorldEvent(t);t.camera.controls.removeEventListener("sleep",i),t.camera.controls.removeEventListener("rest",i),e&&(t.camera.controls.addEventListener("sleep",i),t.camera.controls.addEventListener("rest",i))}cluster(t){if(!this.autoCluster)return;this.resetMarkers();const e=this.list.get(t.uuid);if(e){for(const[i,n]of e)if(!n.merged&&!n.static){this.currentKeys.clear();for(const[r,o]of e)o.static||n.key!==o.key&&!o.merged&&this.distance(n.label,o.label)<this.threshold&&(this.currentKeys.add(o.key),o.merged=!0);if(this.currentKeys.size>0){this.currentKeys.add(n.key),n.merged=!0;const r=Array.from(this.currentKeys),o=this.getAveragePositionFromLabels(r),a=new rs(n.label.world,this.createClusterElement(this._clusterKey.toString())),{element:l}=a.three;l.firstChild.textContent=r.length.toString(),a.three.position.copy(o),this.clusterLabels.add({key:this._clusterKey.toString(),markerKeys:r,label:a}),this._clusterKey++}}this.removeMergeMarkers(t)}}getWorldEvent(t){if(!this._worldEvents.has(t.uuid)){const e=()=>{this.cluster(t)};this._worldEvents.set(t.uuid,e)}return this._worldEvents.get(t.uuid)}resetMarkers(){for(const[t,e]of this.list)for(const[i,n]of e)n.merged=!1;for(const t of this.clusterLabels)t.label.dispose();this.clusterLabels.clear(),this._clusterKey=0}removeMergeMarkers(t){const e=this.list.get(t.uuid);if(e){for(const[i,n]of e)n.merged?n.label.dispose():n.label.world.scene.three.add(n.label.three);for(const i of this.clusterLabels)if(i.markerKeys.length===1){for(const[n,r]of this.list){const o=r.get(i.markerKeys[0]);o&&(o.label.world.scene.three.add(o.label.three),o.merged=!1)}i.label.dispose(),this.clusterLabels.delete(i)}}}getAveragePositionFromLabels(t){const e=t.map(i=>{for(const[n,r]of this.list){const o=r.get(i);if(o)return o.label.three.position}return new M});return e.reduce((i,n)=>i.add(n),new M).divideScalar(e.length)}createClusterElement(t){const e=this.clusterElementFactory();e.textContent=t;const i=document.createElement("span");return i.append(e),i.style.pointerEvents="auto",i.style.cursor="pointer",i.addEventListener("pointerdown",()=>{this.navigateToCluster(t)}),i}getScreenPosition(t){const e=new M;if(!t.world.renderer)throw new Error("Renderer not found!");const i=t.three.position.clone();i.project(t.world.camera.three);const n=t.world.renderer.getSize();return e.x=i.x*n.x/2+n.x/2,e.y=-(i.y*n.y/2)+n.y/2,e}distance(t,e){const i=this.getScreenPosition(t),n=this.getScreenPosition(e),r=i.x-n.x,o=i.y-n.y,a=Math.sqrt(r*r+o*o)*.5;return a===0?this.threshold+1:a}navigateToCluster(t){const e=[],i=Array.from(this.clusterLabels).find(c=>c.key===t);if(!i)return;const n=i.label.world.camera;if(!n.hasCameraControls()){console.warn("Zoom to clusters only supported with Camera Controls!");return}for(const c of i.markerKeys)for(const[h,d]of this.list){const p=d.get(c);if(p){const{x:u,y:g,z:m}=p.label.three.position;e.push(u,g,m)}}i.label.dispose(),this.clusterLabels.delete(i);const r=new se,o=new Float32Array(e),a=new xe(o,3);r.setAttribute("position",a);const l=new rt(r);l.geometry.computeBoundingSphere(),l.geometry.boundingSphere&&n.controls.fitToSphere(l,!0),r.dispose(),l.clear(),e.length=0}};T(yv,"uuid","4079eb91-79b0-4ede-bcf2-15b837129236");new Bo(-1,1,1,-1,0,1);let vv=class extends se{constructor(){super(),this.setAttribute("position",new Li([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Li([0,2,0,0,2,0],2))}};new vv;new Vt,new xt,new xt,new xt,new M(-1,-1,-1),new M(1,1,1);_v(16,2,1),new Vt,new xt;function _v(s,t,e){const i=wv(s,t,e);let n="vec3[SAMPLES](";for(let r=0;r<s;r++){const o=i[r];n+=`vec3(${o.x}, ${o.y}, ${o.z})${r<s-1?",":")"}`}return n}function wv(s,t,e){const i=[];for(let n=0;n<s;n++){const r=2*Math.PI*t*n/s,o=Math.pow(n/(s-1),e);i.push(new M(Math.cos(r),Math.sin(r),o))}return i}new Vt(1/1024,1/512);new Vt(1/1024,1/512);new Vt(1/1024,1/512);const $h=new Ft,Kr=new M;let Jl=class extends km{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this.setAttribute("position",new Li(t,3)),this.setAttribute("uv",new Li(e,2))}applyMatrix4(t){const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;return e!==void 0&&(e.applyMatrix4(t),i.applyMatrix4(t),e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));const i=new Wa(e,6,1);return this.setAttribute("instanceStart",new Ns(i,3,0)),this.setAttribute("instanceEnd",new Ns(i,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));const i=new Wa(e,6,1);return this.setAttribute("instanceColorStart",new Ns(i,3,0)),this.setAttribute("instanceColorEnd",new Ns(i,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new Pm(t.geometry)),this}fromLineSegments(t){const e=t.geometry;return this.setPositions(e.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ft);const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;t!==void 0&&e!==void 0&&(this.boundingBox.setFromBufferAttribute(t),$h.setFromBufferAttribute(e),this.boundingBox.union($h))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Di),this.boundingBox===null&&this.computeBoundingBox();const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(t!==void 0&&e!==void 0){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let n=0;for(let r=0,o=t.count;r<o;r++)Kr.fromBufferAttribute(t,r),n=Math.max(n,i.distanceToSquared(Kr)),Kr.fromBufferAttribute(e,r),n=Math.max(n,i.distanceToSquared(Kr));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}};so.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Vt(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};no.line={uniforms:Bd.merge([so.common,so.fog,so.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class tc extends Ud{constructor(t){super({type:"LineMaterial",uniforms:Bd.clone(no.line.uniforms),vertexShader:no.line.vertexShader,fragmentShader:no.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(t)}get color(){return this.uniforms.diffuse.value}set color(t){this.uniforms.diffuse.value=t}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(t){this.uniforms.linewidth&&(this.uniforms.linewidth.value=t)}get dashed(){return"USE_DASH"in this.defines}set dashed(t){t===!0!==this.dashed&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(t){this.uniforms.dashScale.value=t}get dashSize(){return this.uniforms.dashSize.value}set dashSize(t){this.uniforms.dashSize.value=t}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(t){this.uniforms.dashOffset.value=t}get gapSize(){return this.uniforms.gapSize.value}set gapSize(t){this.uniforms.gapSize.value=t}get opacity(){return this.uniforms.opacity.value}set opacity(t){this.uniforms&&(this.uniforms.opacity.value=t)}get resolution(){return this.uniforms.resolution.value}set resolution(t){this.uniforms.resolution.value.copy(t)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(t){this.defines&&(t===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),t===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const Ia=new rn,Th=new M,kh=new M,Jt=new rn,te=new rn,Je=new rn,za=new M,Da=new xt,ee=new ze,Ph=new M,Jr=new Ft,to=new Di,ti=new rn;let ei,os;function Oh(s,t,e){return ti.set(0,0,-t,1).applyMatrix4(s.projectionMatrix),ti.multiplyScalar(1/ti.w),ti.x=os/e.width,ti.y=os/e.height,ti.applyMatrix4(s.projectionMatrixInverse),ti.multiplyScalar(1/ti.w),Math.abs(Math.max(ti.x,ti.y))}function xv(s,t){const e=s.matrixWorld,i=s.geometry,n=i.attributes.instanceStart,r=i.attributes.instanceEnd,o=Math.min(i.instanceCount,n.count);for(let a=0,l=o;a<l;a++){ee.start.fromBufferAttribute(n,a),ee.end.fromBufferAttribute(r,a),ee.applyMatrix4(e);const c=new M,h=new M;ei.distanceSqToSegment(ee.start,ee.end,h,c),h.distanceTo(c)<os*.5&&t.push({point:h,pointOnLine:c,distance:ei.origin.distanceTo(h),object:s,face:null,faceIndex:a,uv:null,uv1:null})}}function Cv(s,t,e){const i=t.projectionMatrix,n=s.material.resolution,r=s.matrixWorld,o=s.geometry,a=o.attributes.instanceStart,l=o.attributes.instanceEnd,c=Math.min(o.instanceCount,a.count),h=-t.near;ei.at(1,Je),Je.w=1,Je.applyMatrix4(t.matrixWorldInverse),Je.applyMatrix4(i),Je.multiplyScalar(1/Je.w),Je.x*=n.x/2,Je.y*=n.y/2,Je.z=0,za.copy(Je),Da.multiplyMatrices(t.matrixWorldInverse,r);for(let d=0,p=c;d<p;d++){if(Jt.fromBufferAttribute(a,d),te.fromBufferAttribute(l,d),Jt.w=1,te.w=1,Jt.applyMatrix4(Da),te.applyMatrix4(Da),Jt.z>h&&te.z>h)continue;if(Jt.z>h){const f=Jt.z-te.z,y=(Jt.z-h)/f;Jt.lerp(te,y)}else if(te.z>h){const f=te.z-Jt.z,y=(te.z-h)/f;te.lerp(Jt,y)}Jt.applyMatrix4(i),te.applyMatrix4(i),Jt.multiplyScalar(1/Jt.w),te.multiplyScalar(1/te.w),Jt.x*=n.x/2,Jt.y*=n.y/2,te.x*=n.x/2,te.y*=n.y/2,ee.start.copy(Jt),ee.start.z=0,ee.end.copy(te),ee.end.z=0;const u=ee.closestPointToPointParameter(za,!0);ee.at(u,Ph);const g=Fd.lerp(Jt.z,te.z,u),m=g>=-1&&g<=1,b=za.distanceTo(Ph)<os*.5;if(m&&b){ee.start.fromBufferAttribute(a,d),ee.end.fromBufferAttribute(l,d),ee.start.applyMatrix4(r),ee.end.applyMatrix4(r);const f=new M,y=new M;ei.distanceSqToSegment(ee.start,ee.end,y,f),e.push({point:y,pointOnLine:f,distance:ei.origin.distanceTo(y),object:s,face:null,faceIndex:d,uv:null,uv1:null})}}}let ju=class extends rt{constructor(t=new Jl,e=new tc({color:Math.random()*16777215})){super(t,e),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const t=this.geometry,e=t.attributes.instanceStart,i=t.attributes.instanceEnd,n=new Float32Array(2*e.count);for(let o=0,a=0,l=e.count;o<l;o++,a+=2)Th.fromBufferAttribute(e,o),kh.fromBufferAttribute(i,o),n[a]=a===0?0:n[a-1],n[a+1]=n[a]+Th.distanceTo(kh);const r=new Wa(n,2,1);return t.setAttribute("instanceDistanceStart",new Ns(r,1,0)),t.setAttribute("instanceDistanceEnd",new Ns(r,1,1)),this}raycast(t,e){const i=this.material.worldUnits,n=t.camera;n===null&&!i&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const r=t.params.Line2!==void 0&&t.params.Line2.threshold||0;ei=t.ray;const o=this.matrixWorld,a=this.geometry,l=this.material;os=l.linewidth+r,a.boundingSphere===null&&a.computeBoundingSphere(),to.copy(a.boundingSphere).applyMatrix4(o);let c;if(i)c=os*.5;else{const d=Math.max(n.near,to.distanceToPoint(ei.origin));c=Oh(n,d,l.resolution)}if(to.radius+=c,ei.intersectsSphere(to)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),Jr.copy(a.boundingBox).applyMatrix4(o);let h;if(i)h=os*.5;else{const d=Math.max(n.near,Jr.distanceToPoint(ei.origin));h=Oh(n,d,l.resolution)}Jr.expandByScalar(h),ei.intersectsBox(Jr)!==!1&&(i?xv(this,e):Cv(this,n,e))}onBeforeRender(t){const e=this.material.uniforms;e&&e.resolution&&(t.getViewport(Ia),this.material.uniforms.resolution.value.set(Ia.z,Ia.w))}},Ev=class{constructor(t,e){T(this,"_components"),T(this,"_modelStyleGeometries",new Nt),T(this,"onDisposed",new K),T(this,"three",new zi),T(this,"plane"),T(this,"items",new Nt),T(this,"world",null),T(this,"_visible",!1),this._components=t,this.plane=e,this.setupEvents()}set visible(t){t?this.world&&(this.world.scene.three.add(this.three),this._visible=!0):(this.three.removeFromParent(),this._visible=!1)}get visible(){return this._visible}setupEvents(){const t=this._components.get(Ma);this.items.guard=(e,{style:i})=>!!t.styles.get(i),this.items.onItemSet.add(({value:e})=>{const{style:i,data:n}=e;this.create(i,n)})}getStyleMeshes(t,e){const i=this._components.get(Ma).styles.get(e);if(!i)throw new Error(`ClipStyler: "${e}" style not found.`);const n=this._components.get(ut).list.get(t);if(!n)throw new Error(`ClipEdges: model with id "${t}" not found.`);const{linesMaterial:r,fillsMaterial:o}=i;let a=this._modelStyleGeometries.get(t);a||(a=new Nt,this._modelStyleGeometries.set(t,a));let l=a.get(e);if(!l){let c;r&&(c=new ju(new Jl,r),c.frustumCulled=!1,n&&c.applyMatrix4(n.object.matrixWorld),this.three.add(c));let h;o&&(h=new rt(new se,o),n&&h.applyMatrix4(n.object.matrixWorld),this.three.add(h)),l={edges:c,fills:h},a.set(e,l)}return l}async updateMeshes(t,e,i){const n=this._components.get(ut).list.get(t);if(!n)return;const r=this._components.get(si),o=this.plane.clone();o.constant-=.01;const a=await n.getSection(o,i),{buffer:l,index:c,fillsIndices:h}=a,d=this.getStyleMeshes(t,e),{edges:p,fills:u}=d,g=new xe(l,3,!1);if(p){g.setUsage(Tm);const m=new se;m.setAttribute("position",g),m.setDrawRange(0,c);const b=new Lo(m);p.geometry.fromLineSegments(b),r.destroy(b)}u&&(u.geometry.attributes.position=g,u.geometry.setIndex(h))}async create(t,e){if(!this._components.get(Ma).styles.get(t))throw new Error(`ClipEdges: "${t}" style not found.`);const i=this._components.get(Ab);let n=null;e&&(n=await i.find(e));const r=this._components.get(ut);if(n)for(const[o,a]of Object.entries(n))r.list.get(o)&&this.updateMeshes(o,t,[...a]);else for(const[o]of r.list)this.updateMeshes(o,t)}async update(t){for(const[e,{data:i,style:n}]of this.items)t&&!t.includes(e)||this.create(n,i)}dispose(){this._components.get(si).destroy(this.three,!0,!0),this._modelStyleGeometries.clear()}};const Hu=class fl extends Tt{constructor(t){super(t),T(this,"onDisposed",new K),T(this,"enabled",!0),T(this,"world",null),T(this,"styles",new Nt),T(this,"list",new Nt),T(this,"_visible",!0),this.components.list.set(fl.uuid,this),this.setEvents()}get visible(){return this._visible}set visible(t){this._visible=t;for(const[,e]of this.list)e.visible=t}setEvents(){this.list.onBeforeDelete.add(({value:t})=>t.dispose())}setEdgesConfig(t,e){if(t.world=(e==null?void 0:e.world)??this.world,e!=null&&e.items)for(const[n,r]of Object.entries(e.items))t.items.set(n,r);const i=(e==null?void 0:e.id)??ie.create();this.list.set(i,t)}create(t,e){const i=new Ev(this.components,t);return e&&this.setEdgesConfig(i,e),i}createFromView(t,e){const i=this.create(t.plane,e);return((e==null?void 0:e.link)===void 0||e.link)&&(t.onDisposed.add(()=>i.dispose()),t.onUpdated.add(()=>i.update()),t.onStateChanged.add(()=>i.visible=t.open)),i}createFromClipping(t,e){const i=this.components.get($i).list.get(t);if(!i)throw new Error(`ClipStyler: Clipping plane with ID ${t} not found.`);const n=this.create(i.three,e);return n.visible=!0,((e==null?void 0:e.link)===void 0||e.link)&&(i.onDraggingEnded.add(()=>n.update()),i.onDisposed.add(()=>n.dispose())),n}dispose(){this.styles.clear(),this.list.clear(),this.onDisposed.trigger(fl.uuid)}};T(Hu,"uuid","24dfc306-a3c4-410f-8071-babc4afa5e4d");let Ma=Hu;const Vu=class ml extends Tt{constructor(t){super(t),T(this,"onDisposed",new K),T(this,"onBeforeUpdate",new K),T(this,"onAfterUpdate",new K),T(this,"onSetup",new K),T(this,"isSetup",!1),T(this,"enabled",!0),T(this,"events",{}),T(this,"multiple","ctrlKey"),T(this,"zoomFactor",1.5),T(this,"zoomToSelection",!1),T(this,"backupColor",null),T(this,"selection",{}),T(this,"config",{selectName:"select",selectionColor:null,autoHighlightOnClick:!0,world:null,selectEnabled:!0,selectMaterialDefinition:{color:new bt("#BCF124"),renderedFaces:Nd.ONE,opacity:1,transparent:!1}}),T(this,"styles",new Nt),T(this,"autoToggle",new Set),T(this,"mouseDownPosition",{x:0,y:0}),T(this,"mouseMoveThreshold",5),T(this,"selectable",{}),T(this,"eventManager",new _b),T(this,"_mouseState",{down:!1,moved:!1}),T(this,"_fromHighlight",!1),T(this,"restorePreviousColors",(e=this.selection.select)=>{for(const[i,n]of Object.entries(this.selection))if(!(i===this.config.selectName||!this.styles.get(i)))for(const[r,o]of Object.entries(e)){const a=n[r];if(!a)continue;const l=[...o].filter(c=>a.has(c));l.length!==0&&new Set(l)}}),T(this,"onMouseDown",e=>{this.enabled&&(this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.mouseDownPosition={x:e.clientX,y:e.clientY},this._mouseState.down=!0)}),T(this,"debounceTimeout",null),T(this,"onMouseUp",async e=>{if(!this.enabled)return;const{world:i,autoHighlightOnClick:n,selectEnabled:r}=this.config;if(!i)throw new Error("No world found!");if(!i.renderer)throw new Error("This world doesn't have a renderer!");if(e.target===i.renderer.three.domElement){if(this._mouseState.down=!1,this._mouseState.moved||e.button!==0){this._mouseState.moved=!1;return}if(this._mouseState.moved=!1,n&&r){const o=this.multiple==="none"?!0:!e[this.multiple];await this.highlight(this.config.selectName,o,this.zoomToSelection)}}}),T(this,"onMouseMove",async e=>{if(!this.enabled)return;const i=e.clientX-this.mouseDownPosition.x,n=e.clientY-this.mouseDownPosition.y,r=Math.sqrt(i*i+n*n);this._mouseState.moved||r>this.mouseMoveThreshold&&(this._mouseState.moved=this._mouseState.down)}),this.components.add(ml.uuid,this),this.eventManager.list.add(this.onSetup),this.eventManager.list.add(this.onDisposed),this.setStyleEvents()}setStyleEvents(){this.styles.onBeforeDelete.add(async({key:t})=>{if(await this.clear(t),delete this.selection[t],!(t in this.events))return;const{onClear:e,onHighlight:i,onBeforeHighlight:n}=this.events[t];this.eventManager.list.delete(e),this.eventManager.list.delete(i),this.eventManager.list.delete(n),delete this.events[t]}),this.styles.onItemSet.add(({key:t})=>{this.selection[t]={};const e=new K,i=new K,n=new K;this.events[t]={onHighlight:e,onClear:n,onBeforeHighlight:i},this.eventManager.add([n,e,i])})}async dispose(){this.setupEvents(!1),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.selection={},this.styles.clear(),this.onDisposed.trigger(ml.uuid),this.eventManager.reset(),this.isSetup=!1}add(t){if(console.warn("highlighter.add() is deprecated, use highlighter.styles.set() instead"),typeof t=="string")this.styles.set(t,null);else{const{customId:e}=t;this.styles.set(e,t)}}async remove(t){console.warn("highlighter.remove() is deprecated, use highlighter.styles.delete() instead"),this.styles.delete(t)}async highlight(t,e=!0,i=this.zoomToSelection,n=null){if(!this.enabled)return;if(!this.config.world)throw new Error("No world found in config!");const r=this.config.world;if(!this.selection[t])throw new Error(`Selection ${t} does not exist.`);const o=await this.components.get(fe).get(r).castRay();if(!o||o.localId===void 0||o.localId===null){e&&this.clear(t);return}const{localId:a,fragments:{modelId:l}}=o,c={[l]:new Set([a])};await this.highlightByID(t,c,e,i,n,!0)}async highlightByID(t,e,i=!0,n=this.zoomToSelection,r=null,o=!1){var a;if(!this.enabled)return;this._fromHighlight=!0,this.events[t].onBeforeHighlight.trigger(this.selection[t]),i&&await this.clear(t);let l=St.clone(e);const c=this.components.get(ut);for(const[d,p]of Object.entries(e)){const u=c.list.get(d);u!=null&&u.isDeltaModel&&u.parentModelId&&St.add(l,{[u.parentModelId]:p})}const h=(a=this.selectable)==null?void 0:a[t];if(h){const d=St.clone(h);for(const[p,u]of Object.entries(d)){const g=c.list.get(p);g!=null&&g.deltaModelId&&St.add(d,{[g.deltaModelId]:u})}l=St.intersect([l,d])}if(r){const d=St.clone(r);for(const[p,u]of Object.entries(d)){const g=c.list.get(p);g!=null&&g.deltaModelId&&St.add(d,{[g.deltaModelId]:u})}l=St.intersect([l,r])}if(o&&this.autoToggle.has(t)){const d={};let p=!1;for(const u in l){const g=this.selection[t][u];if(!g)continue;const m=l[u];for(const b of m)if(g.has(b)){g.delete(b);let f=d[u];f||(f=new Set,d[u]=f),f.add(b),p=!0}else g.add(b);l[u]=g}p&&(this.events[t].onClear.trigger(d),t===this.config.selectName&&this.restorePreviousColors(d))}this.updateStyleMap(t,l),this.events[t].onHighlight.trigger(this.selection[t]),this._fromHighlight=!1,await this.updateColors(),n&&await this.zoomSelection(l)}async updateColors(){const t=this.components.get(ut),e=[t.resetHighlight()];for(const[i,n]of Object.entries(this.selection)){const r=this.styles.get(i);if(!r)continue;const o=i==="select"||!this.styles.get(this.config.selectName)?n:this.getMapWithoutSelection(i);o&&e.push(t.highlight({...r,customId:i},o))}e.push(t.core.update(!0)),await Promise.allSettled(e)}updateStyleMap(t,e){const i=this.selection[t];for(const n in e){let r=i[n];r||(r=new Set,i[n]=r);const o=e[n];for(const a of o)r.add(a)}if(t!==this.config.selectName)for(const[n,r]of Object.entries(this.selection)){if(n===this.config.selectName||n===t)continue;const o=r;for(const[a,l]of Object.entries(i)){const c=o[a];if(c)for(const h of l)c.delete(h)}}}getMapWithoutSelection(t,e){const i=this.selection[t];if(!i)throw new Error(`Style ${t} does not exist.`);const n=this.selection[this.config.selectName]??{},r={};for(const o in i){const a=i[o],l=t===this.config.selectName?new Set:n[o]??new Set,c=Array.from(a).filter(h=>{var d;return!l.has(h)&&(!e||((d=e[o])==null?void 0:d.has(h)))});c.length>0&&(r[o]=new Set(c))}return Object.keys(r).length>0?r:null}async clear(t,e){const i=t?[t]:Object.keys(this.selection),n=e??void 0;for(const r of i){const o=this.selection[r]??{},a=n??o;r===this.config.selectName&&this.restorePreviousColors();const l={};for(const[c,h]of Object.entries(a)){const d=o[c];if(d)for(const p of h){if(!d.delete(p))continue;let u=l[c];u||(u=new Set,l[c]=u),u.add(p)}}Object.keys(l).length>0&&this.events[r].onClear.trigger(l),this.selection[r]={}}this._fromHighlight||await this.updateColors()}setup(t){if(this.isSetup)return;this.config={...this.config,...t};const{selectName:e,selectionColor:i,selectMaterialDefinition:n}=this.config;this.config.world&&this.components.get(fe).get(this.config.world),n?(i&&(console.warn("highlighter.config.selectionColor is deprecated, use selectMaterialDefinition instead"),n.color=i),this.styles.set(e,n)):this.styles.set(e,null),this.autoToggle.add(this.config.selectName),this.setupEvents(!0),this.enabled=!0,this.isSetup=!0,this.onSetup.trigger(this)}async zoomSelection(t){if(!this.config.world)throw new Error("No world found in config!");const e=this.config.world;let i=!1;for(const m in t)if(t[m].size>0){i=!0;break}if(!i||!e.camera.hasCameraControls())return;const n=await this.components.get(ut).getBBoxes(t),r=new Di,o=new Ft;for(const m of n)o.union(m);o.getBoundingSphere(r);const a=1/0,l=-1/0,{x:c,y:h,z:d}=r.center,p=r.radius===a||c===a||h===a||d===a,u=r.radius===l||c===l||h===l||d===l,g=r.radius===0;p||u||g||(r.radius*=this.zoomFactor,await e.camera.controls.fitToSphere(r,!0))}setupEvents(t){if(!this.config.world){console.log("No world found while setting up events!");return}if(this.config.world.isDisposing)return;if(!this.config.world.renderer)throw new Error("The given world doesn't have a renderer!");const e=this.config.world.renderer.three.domElement;e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("mouseup",this.onMouseUp),e.removeEventListener("pointermove",this.onMouseMove),t&&(e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("mouseup",this.onMouseUp),e.addEventListener("pointermove",this.onMouseMove))}};T(Vu,"uuid","cb8a76f2-654a-4b50-80c6-66fd83cafd77");let qn=Vu;const qu=class Wu extends Tt{constructor(){super(...arguments),T(this,"enabled",!0),T(this,"geometries",new Nt),T(this,"onDisposed",new K)}async get(t,e){const{material:i,applyTransformation:n}={applyTransformation:!0,...e},r=this.components.get(ut),o=new Nt;for(const[a,l]of Object.entries(t)){const c=r.list.get(a);if(!c)continue;const h=this.getModelMeshes(a);for(const d of l){let p=o.get(a);p||(p=new Nt,o.set(a,p));let u=h.get(d);if(u&&u.length>0){const b=[];for(const[f,{geometry:y,transform:_}]of u.entries()){const x=await this.createMesh(c,y,_,{material:i,applyTransformation:n});b.push(x)}p.set(d,b);continue}else u=[],h.set(d,u);const[g]=await c.getItemsGeometry([d]);if(!g)continue;const m=[];for(const b of g){const f=this.createGeometry(b);if(!f)continue;const{geometry:y,transform:_}=f;u.push(f);const x=await this.createMesh(c,y,_,{material:i,applyTransformation:n});m.push(x)}p.set(d,m)}}return o}getModelMeshes(t){let e=this.geometries.get(t);return e||(e=new Nt,this.geometries.set(t,e)),e}remove(t=[...this.geometries.keys()]){for(const e of t){const i=this.geometries.get(e);if(i){for(const[n,r]of i)for(const{geometry:o}of r)o.dispose();this.geometries.delete(e)}}}dispose(t=!0){this.remove(),t&&this.geometries.dispose(),this.onDisposed.trigger(Wu.uuid)}getMeshesFromResult(t){const e=[];for(const i of t.values())for(const n of i.values())e.push(...n);return e}createGeometry(t){const{positions:e,indices:i,normals:n,transform:r}=t;if(!(e&&i&&n))return null;const o=new se;return o.setAttribute("position",new xe(e,3)),o.setAttribute("normal",new xe(n,3,!0)),o.setIndex(new xe(i,1)),{geometry:o,transform:r}}async createMesh(t,e,i,n){const{material:r,applyTransformation:o}={applyTransformation:!0,...n},a=new rt(e,r);return a.applyMatrix4(i),a.applyMatrix4(t.object.matrixWorld),o||(a.position.set(0,0,0),a.rotation.set(0,0,0)),a}};T(qu,"uuid","ab45d0a7-feea-4afc-927c-80832dae76dd");let yo=qu;const Sv=class gl extends Tt{constructor(t){super(t),T(this,"_world"),T(this,"styles",new Zt),T(this,"outlinePositions",!1),T(this,"_mesh",null),T(this,"onDisposed",new K),T(this,"_meshes",[]),T(this,"_map",{}),T(this,"_activeStyles",new Set),T(this,"_styleCallbacks",{}),t.add(gl.uuid,this),this.setupEvents()}set world(t){this._world=t,t&&this.getRenderer().postproduction.excludedObjectsPass.addExcludedMaterial(this._points.material)}get world(){return this._world}get _points(){return this._mesh||(this._mesh=new Cm(new se,new Em({size:10,sizeAttenuation:!1,depthTest:!1}))),this._mesh}get enabled(){return!this.world||this.world.isDisposing?!1:this.getRenderer().postproduction.outlinesEnabled}set enabled(t){if(!this.world||this.world.isDisposing)return;const e=this.getRenderer();e.postproduction.outlinesEnabled=t,this.outlinePositions&&(this._points.material.color=this.color,this.world.scene.three.add(this._points))}get color(){return this.getRenderer().postproduction.outlinePass.outlineColor}set color(t){this.getRenderer().postproduction.outlinePass.outlineColor.copy(t),this._points.material.color.copy(t)}get thickness(){return this.getRenderer().postproduction.outlinePass.thickness}set thickness(t){this.getRenderer().postproduction.outlinePass.thickness=t}get fillColor(){return this.getRenderer().postproduction.outlinePass.fillColor}set fillColor(t){this.getRenderer().postproduction.outlinePass.fillColor.copy(t)}get fillOpacity(){return this.getRenderer().postproduction.outlinePass.fillOpacity}set fillOpacity(t){const e=this.getRenderer().postproduction;e.outlinePass.fillOpacity=t}setupEvents(){const t=this.components.get(qn);this.styles.guard=e=>t.styles.has(e),this.styles.onItemAdded.add(e=>{const i=this.components.get(qn),n=()=>{this._activeStyles.add(e),this.updateFromStyles()},r=()=>{this._activeStyles.delete(e),this.updateFromStyles()};this._styleCallbacks[e]={onHighlight:n,onClear:r},i.events[e].onHighlight.add(n),i.events[e].onClear.add(r)}),this.styles.onBeforeDelete.add(e=>{const{onHighlight:i,onClear:n}=this._styleCallbacks[e];t.events[e].onHighlight.remove(i),t.events[e].onClear.remove(n),this._activeStyles.delete(e),delete this._styleCallbacks[e]}),t.styles.onItemDeleted.add(e=>this.styles.delete(e))}async updateFromStyles(){const t=this.components.get(qn),e=[];for(const n of this._activeStyles){const r=t.selection[n];r&&e.push(r)}const i=St.join(e);this._map=i,await this.update()}async update(t=this._map){if(t===this._map&&this.cleanMeshes(),this.outlinePositions&&this.updatePoints(),Object.keys(t).length===0)return;const e=this.components.get(ut),i=this.getRenderer().postproduction.outlinePass,n=await this.components.get(yo).get(t);for(const r of Object.keys(t))if(e.list.get(r))for(const[o,a]of n.entries()){const l=[...a.values()].flat();for(const c of l)this._meshes.push(c),i.scene.add(c)}}async addItems(t){St.add(this._map,t),await this.update(t)}async removeItems(t){St.remove(this._map,t),await this.update()}clean(){this._map={},this._activeStyles.clear(),this.cleanMeshes(),this._mesh&&this.components.get(si).destroy(this._mesh,!0,!0),this._mesh=null}dispose(){this.styles.clear(),this.clean(),this.onDisposed.trigger(gl.uuid)}cleanMeshes(){for(const t of this._meshes)t.removeFromParent();this._meshes=[]}async updatePoints(){let t=0;for(const[i,n]of Object.entries(this._map))t+=n.size;this._points.geometry.setAttribute("position",new Li(new Float32Array(t*3),3));const e=await this.components.get(ut).getPositions(this._map);for(let i=0;i<e.length;i++){const{x:n,y:r,z:o}=e[i];this._points.geometry.attributes.position.array[i*3]=n,this._points.geometry.attributes.position.array[i*3+1]=r,this._points.geometry.attributes.position.array[i*3+2]=o}this._points.geometry.attributes.position.needsUpdate=!0}getRenderer(){if(!this.world)throw new Error("You must set a world to use the outliner!");const t=this.world.renderer;if(!t.postproduction)throw new Error("The world given to the outliner must use the postproduction renderer.");return t}};T(Sv,"uuid","2fd3bcc5-b3b6-4ded-9f64-f47a02854a10");const Yu=class Zu extends Tt{constructor(t){super(t),T(this,"HOVERER_OPACITY_KEY","_maxHoverOpacity"),T(this,"_hoverTimeout",null),T(this,"_meshes",new Zt),T(this,"_localId",null),T(this,"_fadeAnimation",null),T(this,"_world",null),T(this,"_enabled",!1),T(this,"_material",new ur({color:16777215,transparent:!0,opacity:.5,depthTest:!1,userData:{[this.HOVERER_OPACITY_KEY]:.5}})),T(this,"onDisposed",new K),T(this,"duration",200),T(this,"animation",!0),T(this,"mouseStopTimeout",null),T(this,"onMouseMove",()=>{this.mouseStopTimeout!==null&&clearTimeout(this.mouseStopTimeout),this.mouseStopTimeout=window.setTimeout(()=>this.hover(),50)}),T(this,"onMouseLeave",()=>{this._meshes.clear()}),T(this,"animate",()=>{if(!(this._fadeAnimation&&this.animation&&this.material.transparent))return;const{startTime:e,duration:i,fadeIn:n}=this._fadeAnimation,r=Date.now()-e,o=Math.min(r/i,1),a=n?o:1-o,l=this.material.userData[this.HOVERER_OPACITY_KEY],c=a*(l!==void 0?l:1);this.material.opacity=c,o<1?requestAnimationFrame(this.animate):(n||this._meshes.clear(),this._fadeAnimation=null)}),t.add(Zu.uuid,this),this._meshes.onBeforeDelete.add(e=>{e.removeFromParent(),e.geometry.dispose()}),this._meshes.onItemAdded.add(e=>{this.world&&this.world.scene.three.add(e)}),this._meshes.onCleared.add(()=>{this._localId=null,this._hoverTimeout&&(clearTimeout(this._hoverTimeout),this._hoverTimeout=null)})}set world(t){if(t){this.components.get(fe).get(t),this._world=t,this.setupEvents(!0);for(const e of this._meshes)t.scene.three.add(e)}else{this.setupEvents(!1),this._world=null;for(const e of this._meshes)e.removeFromParent()}}get world(){return this._world}set enabled(t){this.setupEvents(t),this._enabled=t}get enabled(){return this._enabled}set material(t){t.userData[this.HOVERER_OPACITY_KEY]=t.opacity;for(const e of this._meshes)e.material=t;this._material.dispose(),this._material=t}get material(){return this._material}setupEvents(t){if(!this.world||this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The given world doesn't have a renderer!");const e=this.world.renderer.three.domElement;e.removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("mouseleave",this.onMouseMove),t&&(e.addEventListener("mousemove",this.onMouseMove),e.addEventListener("mouseleave",this.onMouseLeave))}async hover(){if(!this.enabled||!this.world)return;const t=await this.components.get(fe).get(this.world).castRay();if(!t){this._meshes.clear();return}const{fragments:e,localId:i}=t;this._localId!==i&&(this._meshes.clear(),this._localId=i,this._hoverTimeout=window.setTimeout(async()=>{const n={[e.modelId]:new Set([i])},r=await this.components.get(yo).get(n);for(const[o,a]of r.entries()){const l=[...a.values()].flat();for(const c of l)c.material=this.material,this._meshes.add(c)}this._fadeAnimation={startTime:Date.now(),duration:this.duration,fadeIn:!0},this.animate()},100))}clear(){this._meshes.clear()}dispose(){this._enabled=!1,this._meshes.clear(),this._fadeAnimation=null,this._hoverTimeout=null,this.onDisposed.trigger()}};T(Yu,"uuid","26fbd870-b1b2-4b71-b747-4063d484de1b");let Av=Yu,$v=class{constructor(t){T(this,"alignments",[]),T(this,"enabled",!0),T(this,"world",null),T(this,"_raycastable",[]),T(this,"_components"),this._components=t}update(){this.dispose();for(const t of this.alignments)for(const e of t.children){const i=e;i.updateWorldMatrix(!0,!0);for(const n of i.children){const r=n;if(r.isLine2&&r.userData.points){const o=new se,a=new Fe;a.geometry.setIndex(r.geometry.index);const l=new Float32Array(r.userData.points),c=new xe(l,3);o.setAttribute("position",c),a.geometry=o,a.userData.curve=r,a.applyMatrix4(r.matrixWorld),a.updateMatrixWorld(),this._raycastable.push(a)}}}}dispose(){for(const t of this._raycastable)t.geometry.dispose(),t.geometry=void 0;this._raycastable=[]}castRay(){if(!this.enabled||!this.world)return null;const t=this._components.get(fe).get(this.world).castRayToObjects(this._raycastable);if(!t)return null;const e=t.object,i=e.geometry,n=t.index,r=i.attributes.position.array[n*3],o=i.attributes.position.array[n*3+1],a=i.attributes.position.array[n*3+2],l=i.attributes.position.array[n*3+3],c=i.attributes.position.array[n*3+4],h=i.attributes.position.array[n*3+5],d=new M(l-r,c-o,h-a).normalize();return{point:t.point,normal:d,curve:e.userData.curve,alignment:e.userData.curve.parent}}},La=class{static alignmentPercentageToPoint(t,e){const i=new M,n=new M,r=this.alignmentLength(t),o=e*r;let a=0;if(t.updateWorldMatrix(!0,!0),e===1)for(let l=t.children.length-1;l>=0;l--){const c=t.children[l],h=c.userData.points;if(!h)continue;const d=new M(h[h.length-3],h[h.length-2],h[h.length-1]);return d.applyMatrix4(c.matrixWorld),{normal:new M,point:d,curve:c,alignment:t}}for(const l of t.children){const c=l.userData.points;if(c)for(let h=0;h<c.length-3;h+=3){const d=i.set(c[h],c[h+1],c[h+2]),p=n.set(c[h+3],c[h+4],c[h+5]),u=d.distanceTo(p);if(a+u>=o){const g=o-a,m=p.clone().sub(d).normalize(),b=m.clone().multiplyScalar(g);return d.add(b),d.applyMatrix4(l.matrixWorld),{normal:m,point:d,curve:l,alignment:t}}a+=u}}return null}static curvePercentageToPoint(t,e,i){const n=new M,r=new M,o=this.curveLength(e),a=i*o;let l=0;const c=e.userData.points;if(!c)throw new Error("No points found in curve");for(let h=0;h<c.length-3;h+=3){const d=n.set(c[h],c[h+1],c[h+2]),p=r.set(c[h+3],c[h+4],c[h+5]),u=d.distanceTo(p);if(l+u>=a){const g=a-l,m=p.clone().sub(d).normalize(),b=m.clone().multiplyScalar(g);return d.add(b),{normal:m,point:d,curve:e,alignment:t}}l+=u}return null}static alignmentLength(t){let e=0;if(t.userData.length!==void 0)return t.userData.length;for(const i of t.children)"isLine2"in i&&(e+=this.curveLength(i));return t.userData.length=e,e}static curveLength(t){let e=0;if(t.userData.length!==void 0)return t.userData.length;const i=new M,n=new M,r=t.userData.points;if(!r)throw new Error("No points found in curve");for(let o=0;o<r.length-2-3;o+=3){const a=i.set(r[o],r[o+1],r[o+2]),l=n.set(r[o+3],r[o+4],r[o+5]);e+=a.distanceTo(l)}return t.userData.length=e,e}static curvePointToAlignmentPercentage(t,e,i){const n=new M,r=new M,o=this.alignmentLength(t);let a=0;t.updateWorldMatrix(!0,!0);for(const l of t.children){const c=l.userData.points;if(c)for(let h=0;h<c.length-3;h+=3){const d=n.set(c[h],c[h+1],c[h+2]),p=r.set(c[h+3],c[h+4],c[h+5]);d.applyMatrix4(l.matrixWorld),p.applyMatrix4(l.matrixWorld);const u=d.distanceTo(p),g=d.distanceTo(e)<.001,m=p.distanceTo(e)<.001,b=this.isPointbetweenTwoOthers(d,p,e);if(l===i&&(g||m||b)){const f=d.distanceTo(e);return(a+f)/o}a+=u}}return null}static isPointbetweenTwoOthers(t,e,i){const n=new M;n.subVectors(e,t).normalize();const r=new M;r.subVectors(i,t).normalize();const o=new M;o.subVectors(i,e).normalize();const a=1-.0016;return n.dot(r)>a&&n.dot(o)<-a}},Tv=class{constructor(t,e){T(this,"onDisposed",new K),T(this,"alignments",[]),T(this,"components"),T(this,"onMarkerChange",new K),T(this,"enabled",!0),T(this,"highlightMaterial"),T(this,"increments",20),T(this,"screenDistanceLimit",.1),T(this,"fadeInTime",500),T(this,"_mouseMarkers"),T(this,"_highlighted",new Set),T(this,"_stationPoints",new Map),T(this,"_originalHighlightMaterialId","originalHighlightMaterial"),T(this,"_world",null),T(this,"_raycaster"),T(this,"_stationLabelColor",new bt(16777215)),T(this,"_stationLabelBackgroundColor",new bt(8014801)),T(this,"_stationPointerColor",new bt(16777215)),T(this,"_stationPointerBackgroundColor",new bt(4803766)),T(this,"_pointerDown",performance.now()),T(this,"_pointerDownTime",150),T(this,"onPointerDown",()=>{this._pointerDown=performance.now()}),T(this,"onPointerUp",()=>{if(performance.now()-this._pointerDown>this._pointerDownTime)return;const i=this.setMarkerToMouse("select");i&&this.onMarkerChange.trigger(i)}),T(this,"onMouseMove",()=>{this.setMarkerToMouse("hover")}),this.components=t,this.highlightMaterial=e,this._raycaster=new $v(t),this._raycaster.alignments=this.alignments}get world(){return this._world}set world(t){var e,i,n,r;if(t===this._world||(this._world&&this.setupEvents(!1),this._world=t,(e=this._mouseMarkers)==null||e.hover.removeFromParent(),(i=this._mouseMarkers)==null||i.select.removeFromParent(),(n=this._mouseMarkers)==null||n.hover.element.remove(),(r=this._mouseMarkers)==null||r.select.element.remove(),!t))return;this._raycaster.world=t;const o=this.newCivilLabel(0,"stationPointer");t.scene.three.add(o),o.visible=!1,o.element.style.transition="";const a=this.newCivilLabel(0,"stationPointer");a.element.style.transition="",a.element.style.opacity="0.5",t.scene.three.add(a),a.visible=!1,this._mouseMarkers={select:o,hover:a},this.setupEvents(!0)}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(t){this._stationLabelColor=t;const e=`#${t.getHexString()}`;for(const[,{labels:i}]of this._stationPoints){const n=[...i.children];for(const r of n){const o=this.getLabel(r);o.style.color=e;const a=this.getPoint(r);a.style.backgroundColor=e}}}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(t){this._stationLabelBackgroundColor=t;const e=`#${t.getHexString()}`;for(const[,{labels:i}]of this._stationPoints){const n=[...i.children];for(const r of n){const o=this.getLabel(r);o.style.backgroundColor=e;const a=this.getPoint(r);a.style.border=`2px solid ${e}`}}}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(t){this._stationPointerColor=t;const e=`#${t.getHexString()}`;if(this._mouseMarkers){const i=this._mouseMarkers.select,n=this.getLabel(i);n.style.color=e;const r=this.getPoint(i);r.style.backgroundColor=e}}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(t){this._stationPointerBackgroundColor=t;const e=`#${t.getHexString()}`;if(this._mouseMarkers){const i=this._mouseMarkers.select,n=this.getLabel(i);n.style.backgroundColor=e;const r=this.getPoint(i);r.style.border=`2px solid ${e}`}}dispose(){var t,e,i,n;this.clearHighlight(),this.clearStations(),this.alignments=[],(t=this._mouseMarkers)==null||t.hover.removeFromParent(),(e=this._mouseMarkers)==null||e.select.removeFromParent(),(i=this._mouseMarkers)==null||i.hover.element.remove(),(n=this._mouseMarkers)==null||n.select.element.remove(),this._raycaster.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){this._raycaster.update()}setMarkerAtPoint(t,e){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");this.updateMarkerValue(t,e),this._mouseMarkers[e].visible=!0,this._mouseMarkers[e].position.copy(t.point)}highlight(t,e=!0){e&&this.clearHighlight(this._highlighted);for(const i of t.children)"isLineSegments2"in i&&"material"in i&&(i.userData[this._originalHighlightMaterialId]=i.material,i.material=this.highlightMaterial);this._highlighted.add(t)}clearHighlight(t=this._highlighted){for(const e of t)for(const i of e.children)"isLineSegments2"in i&&"material"in i&&(i.material=i.userData[this._originalHighlightMaterialId],delete i.userData[this._originalHighlightMaterialId]);this._highlighted.clear()}createStations(t){if(!this.world||this._stationPoints.has(t.uuid))return;const e=new zi;this.world.scene.three.add(e),this._stationPoints.set(t.uuid,{alignment:t,labels:e})}clearStations(t=this._stationPoints.keys()){for(const e of t){const i=this._stationPoints.get(e);i&&(this.clearLabels(i.labels),this._stationPoints.delete(e))}}updateStations(){if(!this.world)throw new Error("No world found!");if(!this.world.renderer)throw new Error("No renderer found!");const t=this.world.camera.three,e=this.world.renderer.three,i=new Bl,n=e.clippingPlanes,r=new M,o=new M;let a=!0;const l=new M;for(const[,{alignment:c,labels:h}]of this._stationPoints){this.clearLabels(h),c.updateWorldMatrix(!0,!0);const d=c.userData.initialStation;let p=d||0;const u=p%this.increments;let g=d+this.increments-u;for(const m of c.children){if(!("isLine2"in m))continue;const b=m;if(b.geometry.boundingBox||b.geometry.computeBoundingBox(),i.setFromProjectionMatrix(new xt().multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse)),!i.intersectsBox(b.geometry.boundingBox)){const D=La.curveLength(m);p+=D;const j=p%this.increments;g=p+this.increments-j;continue}const f=m.userData.points,y=f[0],_=f[1],x=f[2];if(l.set(y,_,x),l.applyMatrix4(m.matrixWorld),!this.isLabelClipped(n,l)){if(a){a=!1,r.set(l.x,l.y,l.z),r.project(t),r.z=0;const D=this.newCivilLabel(p,"stationLabel");D.position.set(l.x,l.y,l.z),h.children.push(D)}else if(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit){const D=this.newCivilLabel(p,"stationLabel");D.position.set(l.x,l.y,l.z),h.children.push(D),r.copy(o)}}const C=new M,S=new M;for(let D=0;D<f.length-3;D+=3){C.set(f[D],f[D+1],f[D+2]),S.set(f[D+3],f[D+4],f[D+5]);const j=C.distanceTo(S),A=p+j,k=S.clone().sub(C).normalize();for(;A>g;){const v=g-p,L=k.clone();L.multiplyScalar(v);const{x:X,y:V,z:J}=C.clone().add(L);if(l.set(X,V,J),l.applyMatrix4(m.matrixWorld),!this.isLabelClipped(n,l)&&i.containsPoint(l)&&(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit)){const Y=this.newCivilLabel(g,"stationLabel");Y.position.set(l.x,l.y,l.z),h.children.push(Y),r.copy(o)}g+=this.increments}p+=j}const $=f[f.length-3],O=f[f.length-2],z=f[f.length-1];if(l.set($,O,z),l.applyMatrix4(m.matrixWorld),!(this.isLabelClipped(n,l)||!i.containsPoint(l))&&(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit)){const D=this.newCivilLabel(p,"stationLabel");D.position.set(l.x,l.y,l.z),h.children.push(D),r.copy(o)}}}}getCursorValue(){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");return this._mouseMarkers.select.element.children[0].children[0].innerText}setCursorValue(t,e){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const i=this._mouseMarkers[e].element.children[0].children[0];i.innerText=t}isLabelClipped(t,e){for(const i of t)if(!(i.distanceToPoint(e)>0))return!0;return!1}clearLabels(t){const e=[...t.children];for(const i of e)i.element.style.opacity="0";setTimeout(()=>{for(const i of e)i.removeFromParent(),i.element.remove(),i.visible=!1},this.fadeInTime)}newCivilLabel(t,e){const i=document.createElement("div"),n=e==="stationLabel"?this.stationLabelColor:this.stationPointerColor,r=e==="stationLabel"?this.stationLabelBackgroundColor:this.stationPointerBackgroundColor,o=document.createElement("div");o.style.width="4px",o.style.height="4px",o.style.borderRadius="50%",o.style.backgroundColor=`#${n.getHexString()}`,o.style.border=`2px solid #${r.getHexString()}`,o.style.display="flex",o.style.justifyContent="center";const a=this.getFormattedStation(t),l=document.createElement("div");l.innerText=a,l.style.backgroundColor=`#${r.getHexString()}`,l.style.color=`#${n.getHexString()}`,l.style.padding="0.3rem",l.style.position="absolute",l.style.bottom="1rem",l.style.borderRadius="6px",l.style.boxShadow="rgba(0, 0, 0, 0.6) 0px 4px 6px",o.appendChild(l);const c=new Ru(i);return i.appendChild(o),e==="stationLabel"&&(i.style.transition=`opacity ${this.fadeInTime}ms ease-in-out`,i.style.opacity="0",setTimeout(()=>{i.style.opacity="1"})),c}setupEvents(t){if(!this.world)throw new Error("No world found!");if(this.world.isDisposing||!this.world.renderer)return;const e=this.world.renderer.three.domElement,i=this.components.get(fe).get(this.world);i.three.params.Line||(i.three.params.Line={threshold:10}),e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointerup",this.onPointerUp),e.removeEventListener("pointermove",this.onMouseMove),t&&(e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointerup",this.onPointerUp),e.addEventListener("pointermove",this.onMouseMove))}setMarkerToMouse(t){if(!this.enabled||!this._mouseMarkers)return null;if(!this.world)throw new Error("No world found!");const e=this._raycaster.castRay();if(!e)return this._mouseMarkers[t].visible=!1,null;this._mouseMarkers[t].visible=!0;const i=e.point;return this._mouseMarkers[t].position.copy(i),this.updateMarkerValue(e,t),e}updateMarkerValue(t,e){if(!this._mouseMarkers)return;const{alignment:i,curve:n,point:r}=t,o=La.curvePointToAlignmentPercentage(i,r,n);if(o===null)throw new Error("Point is not on the curve");const a=o*La.alignmentLength(i)+i.userData.initialStation,l=this.getFormattedStation(a);this.setCursorValue(l,e)}getFormattedStation(t){const e=Math.floor(t/1e3),i=Math.round(t-e*1e3);return`${e}+${i}`}getLabel(t){return t.element.children[0].children[0]}getPoint(t){return t.element.children[0]}};const kv=class Xu extends Tt{constructor(t){super(t),T(this,"onDisposed",new K),T(this,"list",new Map),T(this,"enabled",!0),T(this,"highlightMaterial",new tc({color:8014801,linewidth:5,depthTest:!1})),T(this,"_increments",20),T(this,"_screenDistanceLimit",.1),T(this,"_fadeInTime",500),T(this,"_stationLabelColor",new bt(16777215)),T(this,"_stationLabelBackgroundColor",new bt(8014801)),T(this,"_stationPointerColor",new bt(16777215)),T(this,"_stationPointerBackgroundColor",new bt(4803766)),this.components.add(Xu.uuid,this)}get increments(){return this._increments}set increments(t){this._increments=t;for(const[,e]of this.list)e.increments=t}get screenDistanceLimit(){return this._screenDistanceLimit}set screenDistanceLimit(t){this._screenDistanceLimit=t;for(const[,e]of this.list)e.screenDistanceLimit=t}get fadeInTime(){return this._fadeInTime}set fadeInTime(t){this._fadeInTime=t;for(const[,e]of this.list)e.fadeInTime=t}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(t){this._stationLabelColor=t;for(const[,e]of this.list)e.stationLabelColor=t}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(t){this._stationLabelBackgroundColor=t;for(const[,e]of this.list)e.stationLabelBackgroundColor=t}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(t){this._stationPointerColor=t;for(const[,e]of this.list)e.stationPointerColor=t}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(t){this._stationPointerBackgroundColor=t;for(const[,e]of this.list)e.stationPointerBackgroundColor=t}create(t){const e=new Tv(this.components,this.highlightMaterial);return this.list.set(t,e),e}delete(t){const e=this.list.get(t);e&&(e.dispose(),this.list.delete(t))}dispose(){for(const[,t]of this.list)t.dispose();this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){for(const[,t]of this.list)t.updateAlignments()}};T(kv,"uuid","0a59c09e-2b49-474a-9320-99f51f40f182");const Pv=class Gu extends Tt{constructor(t){super(t),T(this,"enabled",!0),T(this,"onDisposed",new K),T(this,"_world",null),T(this,"_flip",!1),T(this,"_plane"),T(this,"_point",new M),T(this,"_edgeMeshes",[]),T(this,"_sectionVisible",!1),T(this,"_sectionOffset",.1),T(this,"edgeMaterial",new tc({color:0,linewidth:5,depthTest:!1})),this.components.add(Gu.uuid,this)}get plane(){if(!this._plane)throw new Error("Plane is not set. You must give a world.");return this._plane}set plane(t){this._plane=t}get sectionVisible(){return this._sectionVisible}set sectionVisible(t){this._sectionVisible=t;for(const e of this._edgeMeshes)e.visible=t}get world(){return this._world}set world(t){var e;if(this._world=t,(e=this._plane)==null||e.dispose(),!t)return;const i=this.components.get($i),n=i.createFromNormalAndCoplanarPoint(t,new M(1,0,0),new M);this.plane=i.list.get(n),this.plane.visible=!1,this.plane.enabled=!1}get flip(){return this._flip}set flip(t){var e;if(t===this._flip)return;this._flip=t;const i=(e=this.plane)==null?void 0:e.normal.clone().multiplyScalar(-1);for(const n of this._edgeMeshes)n.position.add(i.clone().multiplyScalar(this._sectionOffset));this.plane.setFromNormalAndCoplanarPoint(i,this._point),this.plane.update()}dispose(){var t;this.clearMeshes(),(t=this.plane)==null||t.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}async set(t,e){this.flip&&e.multiplyScalar(-1),this.plane.setFromNormalAndCoplanarPoint(e,t),this._point.copy(t)}async update(){this.clearMeshes();const t=this.components.get(ut);this.plane.update();const e=[];for(const[,i]of t.list)e.push(this.generateModelSection(i));await Promise.all(e)}async generateModelSection(t){if(!this.world)return;const e=this.plane.three.clone();e.constant-=.01;const{buffer:i}=await t.getSection(e),n=new se,r=new xe(i,3,!1);n.setAttribute("position",r);const o=new Lo(n),a=new Jl;a.fromLineSegments(o);const l=new ju(a,this.edgeMaterial);l.frustumCulled=!1,this.world.scene.three.add(l),this._edgeMeshes.push(l),l.renderOrder=3,o.geometry.dispose()}clearMeshes(){for(const t of this._edgeMeshes)t.removeFromParent(),t.geometry.dispose(),t.material=void 0;this._edgeMeshes=[]}};T(Pv,"uuid","96b2c87e-d90b-4639-8257-8f01136fe324");const Ds=class Ms{constructor(t){T(this,"onDisposed",new K),T(this,"marker",null),T(this,"world",null),T(this,"_enabled",!1),T(this,"_components"),T(this,"_preview",document.createElement("div")),T(this,"_pointerVisible",!1),T(this,"_intersectionFound",!1),this._components=t;for(const e in Ms.baseSnappingStyle){const i=Ms.baseSnappingStyle[e];this._preview.style[e]=i}this._preview.style.zIndex="999",this._preview.style.pointerEvents="none",this._preview.style.position="fixed",this._preview.style.top="0",this._preview.style.left="0"}set enabled(t){this._enabled=t,this.marker&&(this.marker.visible=t),t&&this.get()}get enabled(){return this._enabled}dispose(){this.marker&&this.marker.dispose()}async get(t){const e=(t==null?void 0:t.world)??this.world;if(!e)throw new Error("GraphicVertexPicker: a world is need to get a casting result.");const i=await this._components.get(fe).get(e).castRay({snappingClasses:t==null?void 0:t.snappingClasses});if(this._intersectionFound=!!i,i){const{point:n}=i;if(!this.marker){const r=document.createElement("div");this.marker=new rs(e,r)}if(this.marker.world!==e&&(this.marker.world=e,this.marker.three.removeFromParent(),e.scene.three.add(this.marker.three)),this.hidePointer(),this.marker.visible=!0,this.marker.three.position.copy(n),"snappingClass"in i&&typeof i.snappingClass=="number"&&(i.snappingClass===0||i.snappingClass===1||i.snappingClass===2)){const r=Ms.snappingStyles[i.snappingClass]??Ms.baseSnappingStyle;Object.assign(this.marker.three.element.style,r)}else Object.assign(this.marker.three.element.style,Ms.baseSnappingStyle)}else this.marker&&(this.marker.visible=!1);return i}updatePointer(){if(!this.world||!this.marker)return;if(!this._intersectionFound){this.hidePointer();return}this.showPointer(),this.marker.visible&&(this.marker.visible=!1);const t=this._components.get(fe).get(this.world).mouse.rawPosition;this._preview.style.transform=`translate(-50%, -50%) translate(${t.x}px, ${t.y}px)`}showPointer(){var t;!this.world||this._pointerVisible||(this._pointerVisible=!0,(t=this.world.renderer.three.domElement.parentElement)==null||t.appendChild(this._preview))}hidePointer(){var t;!this.world||!this._pointerVisible||(this._pointerVisible=!1,(t=this.world.renderer.three.domElement.parentElement)==null||t.removeChild(this._preview))}};T(Ds,"baseSnappingStyle",{height:"6px",width:"6px",borderRadius:"100%",borderWidth:"2px",borderColor:"rgb(122, 75, 209)",borderStyle:"solid",zIndex:"-20"}),T(Ds,"snappingStyles",{[Fs.FACE]:{...Ds.baseSnappingStyle},[Fs.POINT]:{...Ds.baseSnappingStyle,borderColor:"#e25959",borderRadius:"0"},[Fs.LINE]:{...Ds.baseSnappingStyle,borderColor:"#2d2d2d",borderRadius:"0"}});let Ov=Ds;function Qu(){const s=document.createElement("div");return s.style.backgroundColor="blue",s.style.color="white",s.style.padding="6px",s.style.borderRadius="6px",s.style.boxShadow="0px 4px 6px rgba(0, 0, 0, 0.6)",s.style.zIndex="-10",s}function Iv(s={}){const{color:t="white",size:e="4px",border:i="2px solid blue",background:n="white"}=s,r=document.createElement("div");return r.style.backgroundColor=n,r.style.color=t,r.style.height=e,r.style.width=e,r.style.borderRadius="50%",r.style.border=i,r.style.zIndex="-20",r}let as=class extends ze{constructor(){super(...arguments),T(this,"id",ie.create()),T(this,"_units","m"),T(this,"_rounding",2)}set units(t){this._units=t}get units(){return this._units}set rounding(t){this._rounding=t}get rounding(){return this._rounding}get value(){const t=this.distance();return Zs.convertUnits(t,"m",this.units,this.rounding)}},zv=class bl{constructor(t,e,i,n=2,r="m"){T(this,"label"),T(this,"boundingBox",new rt),T(this,"world"),T(this,"_components"),T(this,"_units","m"),T(this,"_rounding",2),T(this,"startNormal",null),T(this,"line"),T(this,"rectangleComponentLines",[]),T(this,"projectionComponentLines",[]),T(this,"_visible",!0),T(this,"_root",new zi),T(this,"_endpoints",new Zt),T(this,"lineElement"),T(this,"rectangleDimensions",new Zt),T(this,"projectionDimensions",new Zt),T(this,"isSelected",!1),T(this,"_latestRectangularInversion",!1),T(this,"_endpointElement",Iv()),T(this,"_material"),T(this,"_componentsMaterial",new Im({depthTest:!1,gapSize:.2,dashSize:.2,transparent:!0,opacity:.5,color:3026478})),T(this,"valueFormatter",null),this._components=t,this.world=e,this._material=i.lineMaterial,this._rounding=n,this._units=r,this.line=i.line,this.startNormal=i.startNormal??null,this.rectangleComponentLines=[new as,new as],this.updateRectangleComponents(),this.updateProjectionComponents(),this.lineElement=this.createLine(i),this._endpoints.onItemAdded.add(o=>{this._root.add(o.three);const a=this._endpoints.size===1?this.line.start:this.line.end;o.three.position.copy(a)}),this._endpoints.onBeforeDelete.add(o=>o.dispose()),this.createEndpoints();for(const o of this._endpoints)o.three.element.style.borderColor=`#${i.lineMaterial.color.getHexString()}`;this.label=this.newText(),this.label.three.element.style.backgroundColor=`#${i.lineMaterial.color.getHexString()}`,this.label.three.renderOrder=1,this._root.renderOrder=2,this.world.scene.three.add(this._root),this.setupEvents()}set units(t){for(const e of this.rectangleDimensions)e.units=t;for(const e of this.projectionDimensions)e.units=t;this._units=t,this.updateLabel()}get units(){return this._units}set rounding(t){for(const e of this.rectangleDimensions)e.rounding=t;for(const e of this.projectionDimensions)e.rounding=t;this._rounding=t,this.updateLabel()}get rounding(){return this._rounding}get visible(){return this._visible}set visible(t){for(const a of this.rectangleDimensions)a.visible=t;for(const a of this.projectionDimensions)a.visible=t;this._visible=t,this.label.visible=t;for(const a of this._endpoints)a.visible=t;const[e,i]=this._endpoints,n=e.three,r=i.three,o=this.label.three;t?(this.world.scene.three.add(this._root),this._root.add(o,n,r)):(o.removeFromParent(),n.removeFromParent(),r.removeFromParent(),this._root.removeFromParent())}set end(t){this.line.end=t;const e=this.lineElement.geometry.attributes.position;e.setXYZ(1,t.x,t.y,t.z),e.needsUpdate=!0,this.update()}set start(t){this.line.start=t;const e=this.lineElement.geometry.attributes.position;e.setXYZ(0,t.x,t.y,t.z),e.needsUpdate=!0,this.update()}setupEvents(){this.rectangleDimensions.onBeforeDelete.add(t=>t.dispose()),this.projectionDimensions.onBeforeDelete.add(t=>t.dispose())}dispose(){this.visible=!1;const t=this._components.get(si);t.destroy(this._root),t.destroy(this.lineElement),this._endpoints.clear(),this.label.dispose(),this.boundingBox&&t.destroy(this.boundingBox),this.rectangleDimensions.clear(),this.projectionDimensions.clear(),this._components=null}createBoundingBox(){const t=new M;this.line.getCenter(t);const e=this.line.distance();this.boundingBox.geometry=new re(1,1,e),this.boundingBox.position.copy(t),this.boundingBox.lookAt(this.line.end),this.boundingBox.visible=!1,this._root.add(this.boundingBox)}invertRectangularDimensions(){this.rectangleDimensions.size!==0&&(this.rectangleDimensions.clear(),this._latestRectangularInversion=!this._latestRectangularInversion,this.updateRectangleComponents(this._latestRectangularInversion),this.displayRectangularDimensions())}displayRectangularDimensions(){this.rectangleDimensions.clear();for(const t of this.rectangleComponentLines){const e=new bl(this._components,this.world,{line:t,lineMaterial:this._componentsMaterial,endpointElement:this.endpointElement});e.lineElement.computeLineDistances(),this.rectangleDimensions.add(e)}}displayProjectionDimensions(){this.projectionDimensions.clear();for(const t of this.projectionComponentLines){const e=new bl(this._components,this.world,{line:t,lineMaterial:this._componentsMaterial,endpointElement:this.endpointElement});e.lineElement.computeLineDistances(),this.projectionDimensions.add(e)}}set endpointElement(t){for(const e of this.rectangleDimensions)e.endpointElement=t;for(const e of this.projectionDimensions)e.endpointElement=t;this._endpointElement=t,this.createEndpoints()}get endpointElement(){return this._endpointElement}createEndpoints(){this._endpoints.clear();const t=new rs(this.world,this._endpointElement),e=new rs(this.world,this._endpointElement.cloneNode(!0));this._endpoints.add(t,e)}updateProjectionComponents(){if(!this.startNormal)return;const t=new Te().setFromNormalAndCoplanarPoint(this.startNormal,this.line.start),e=new M;t.projectPoint(this.line.end,e);let[i]=this.projectionComponentLines;i||(i=new as,this.projectionComponentLines.push(i)),i.set(this.line.end,e),i.distance()<.01&&this.projectionComponentLines.shift();for(const n of this.projectionDimensions)n&&n.update()}updateRectangleComponents(t=!1){const e=t?this.line.end:this.line.start,i=t?this.line.start:this.line.end,n=new M;n.subVectors(i,e),Math.abs(i.y-e.y)>=.1?n.y=0:n.x=0;const r=e.clone().add(n),[o,a]=this.rectangleComponentLines;o.set(r,e),a.set(r,i);for(const l of this.rectangleDimensions)l.update()}updateLabel(){this.label.three.element.textContent=this.getTextContent();const t=new M;this.line.getCenter(t),this.label.three.position.copy(t)}updateGeometry(){this.updateRectangleComponents(),this.updateProjectionComponents(),[...this._endpoints][0].three.position.copy(this.line.start),[...this._endpoints][1].three.position.copy(this.line.end),this.lineElement.geometry.computeBoundingSphere()}update(){this.updateGeometry(),this.updateLabel()}set material(t){this._material.dispose(),this._material=t,this.lineElement.material=t}get material(){return this._material}createLine(t){const e=new se;e.setFromPoints([t.line.start,t.line.end]);const i=new Fe(e,t.lineMaterial);return this._root.add(i),i}newText(){const t=Qu();t.textContent=this.getTextContent();const e=new rs(this.world,t),i=new M;return this.line.getCenter(i),e.three.position.copy(i),this._root.add(e.three),e}getTextContent(t=this.line.distance()){const e=Zs.convertUnits(t,"m",this._units,this.rounding);return`${Ni.valueFormatter?Ni.valueFormatter(e):e.toFixed(this.rounding)} ${this._units}`}set color(t){const e=`#${t.getHexString()}`;this.label.three.element.style.backgroundColor=e;for(const i of this._endpoints)i.three.element.style.borderColor=e;this._material.color.set(t)}},ec=class Ku{constructor(t){T(this,"id",ie.create()),T(this,"points",new Zt),T(this,"tolerance",.005),T(this,"_plane",null),T(this,"_rounding",2),T(this,"_units","m2"),this.points.guard=e=>{const i=[...this.points].some(r=>r.equals(e)),n=this.isPointInPlane(e);return!i&&n},this.points.onItemAdded.add(e=>{if(this.plane){const i=new M;this.plane.projectPoint(e,i),e.copy(i)}this.points.size<3||this.points.size===3&&this.computePlane()}),this.points.onItemDeleted.add(()=>{this.points.size>=3||(this._plane=null)}),this.points.onCleared.add(()=>{this._plane=null}),t&&this.points.add(...t)}get plane(){return this._plane}get _coordinateSystem(){if(!this.plane)return null;const t=this.plane.normal,e=new M,i=new M;return Math.abs(t.x)>Math.abs(t.z)?e.set(-t.y,t.x,0).normalize():e.set(0,-t.z,t.y).normalize(),i.crossVectors(t,e).normalize(),{normal:t.clone(),x:e.clone(),y:i.clone()}}get points2D(){if(!this.plane)if(this.points.size>=3)this.computePlane();else return null;return[...this.points].map(t=>this.convertPointTo2D(t)).filter(t=>t!==null)}get center(){if(!this.plane||this.points.size<3)return null;const t=this.points2D;if(!t||t.length===0)return null;const e=t.reduce((i,n)=>i.add(n),new Vt).divideScalar(t.length);return this.convertPointTo3D(e)}get value(){return Zs.convertUnits(this.rawValue,"m2",this.units,this.rounding)}get rawValue(){const t=this.points2D;return t?Math.abs(Om.area(t)):0}get boundingBox(){if(this.points.size===0)return null;const t=new Ft;for(const e of this.points)t.expandByPoint(e);return t}get perimeter(){const t=this.points2D;if(!t||t.length<2)return 0;let e=0;for(let i=0;i<t.length;i++){const n=t[i],r=t[(i+1)%t.length];e+=n.distanceTo(r)}return e}set rounding(t){this._rounding=t}get rounding(){return this._rounding}set units(t){this._units=t}get units(){return this._units}isPointInPlane(t){if(!this.plane)return!0;const e=this.plane.distanceToPoint(t);return Math.abs(e)<this.tolerance}clone(){const t=new Ku([...this.points]);return t.units=this.units,t.rounding=this.rounding,t.tolerance=this.tolerance,t}computePlane(){const[t,e,i]=this.points;if(!(t&&e&&i))return null;const n=new M().subVectors(e,t),r=new M().subVectors(i,t),o=new M().crossVectors(n,r).normalize();return this._plane=new Te().setFromNormalAndCoplanarPoint(o,t),this.plane}convertPointTo2D(t){if(!this.isPointInPlane(t)||!this.plane)return null;const e=this._coordinateSystem;if(!e)return null;const i=new M;this.plane.projectPoint(t,i);const n=i.dot(e.x),r=i.dot(e.y);return new Vt(n,r)}convertPointTo3D(t){if(!this.plane)return null;const e=this._coordinateSystem;if(!e)return null;const{x:i,y:n,normal:r}=e;return new M().addScaledVector(i,t.x).addScaledVector(n,t.y).addScaledVector(r,-this.plane.constant)}},Ju=class tp{constructor(t){T(this,"_components"),T(this,"id",ie.create()),T(this,"onItemsChanged",new K),T(this,"_items",{}),T(this,"_units","m3"),T(this,"_rounding",2),this._components=t}set items(t){this._items=t,this.onItemsChanged.trigger()}get items(){return this._items}set units(t){this._units=t}get units(){return this._units}set rounding(t){this._rounding=t}get rounding(){return this._rounding}async getRawValue(){return await this._components.get(Zs).getItemsVolume(this.items)}async getValue(){const t=await this.getRawValue();return Zs.convertUnits(t,"m3",this.units,this.rounding)}async getCenter(){return await this._components.get(go).getCenter(this.items)}async getBox(){const t=this._components.get(go);t.list.clear(),await t.addFromModelIdMap(this.items);const e=t.get();return t.list.clear(),e}clone(){const t=new tp(this._components);return t.items=St.clone(this.items),t}},ep=class extends rs{constructor(t){const e=document.createElement("div");e.style.backgroundColor="blue",e.style.color="white",e.style.padding="6px",e.style.borderRadius="6px",e.style.boxShadow="0px 4px 6px rgba(0, 0, 0, 0.6)",e.style.zIndex="-10",super(t,e),T(this,"_value",0),T(this,"_units","m2"),T(this,"_worldUnits","m2"),T(this,"_color",new bt),T(this,"_textColor",new bt),T(this,"_rounding",2),this.three.renderOrder=1,e.textContent=this.formattedValue}set value(t){this._value=t,this.three.element.textContent=this.formattedValue}get value(){return this._value}set units(t){this._units=t,this.three.element.textContent=this.formattedValue}get units(){return this._units}set worldUnits(t){this._worldUnits=t,this.three.element.textContent=this.formattedValue}get worldUnits(){return this._worldUnits}set color(t){this._color=t;const e=`#${t.getHexString()}`;this.three.element.style.backgroundColor=e}get color(){return this._color}set textColor(t){this._textColor=t;const e=`#${t.getHexString()}`;this.three.element.style.color=e}get textColor(){return this._textColor}set rounding(t){this._rounding=t,this.three.element.textContent=this.formattedValue}get rounding(){return this._rounding}get formattedValue(){const t=Zs.convertUnits(this.value,this.worldUnits,this.units,this.rounding);return`${Ni.valueFormatter?Ni.valueFormatter(t):t.toFixed(this.rounding)} ${this.units}`}},Dv=class{constructor(t,e,i=new ec){T(this,"_root",new zi),T(this,"_components"),T(this,"_material",new fo({color:"red",transparent:!0,opacity:.5,side:Mi,depthTest:!1})),T(this,"_visible",!0),T(this,"_color",new bt),T(this,"label"),T(this,"three",new rt),T(this,"world"),T(this,"area"),T(this,"_triggerUpdate",()=>this.update()),this._components=t,this.world=e,this.area=i,this.world.scene.three.add(this.three),this.label=new ep(e),this._root.renderOrder=2,this.visible=!0,this.update(),i.points.onItemAdded.add(this._triggerUpdate),i.points.onItemDeleted.add(this._triggerUpdate),i.points.onCleared.add(this._triggerUpdate)}set material(t){this._material.dispose(),this._material=t,this.three.material=t}get material(){return this._material}set visible(t){this._visible=t,this.label.visible=t;const e=this.label.three;t?(this._root.add(e,this.three),this.world.scene.three.add(this._root)):(e.removeFromParent(),this._root.removeFromParent())}get visible(){return this._visible}set rounding(t){this.label.rounding=t}get rounding(){return this.label.rounding}set units(t){this.label.units=t}get units(){return this.label.units}set color(t){this._color=t,this.label.color=t,this._material.color.set(t)}get color(){return this._color}updateMesh(){if(this.area.points.size<3)return;const t=[...this.area.points],e=t.flatMap(r=>[r.x,r.y,r.z]),i=[];for(let r=1;r<t.length-1;r++)i.push(0,r,r+1);this.three.geometry.dispose();const n=new se;n.setAttribute("position",new Li(e,3)),n.setIndex(i),this.three.geometry=n,this.three.material=this.material}update(){if(this.updateMesh(),this.area.value===0)this.label.visible=!1;else{this.label.value=this.area.rawValue,this.label.visible=!0;const t=this.area.center;t&&this.label.three.position.copy(t)}}dispose(){this.label.dispose(),this._components.get(si).destroy(this._root,!0,!0),this.area.points.clear()}};const Mv={length:"m",area:"m2",volume:"m3"};let ip=class{constructor(t,e,i=new Ju(t)){T(this,"_root",new zi),T(this,"_components"),T(this,"_material",new fo({color:"red",transparent:!0,opacity:.75,side:Mi,depthTest:!1})),T(this,"_visible",!0),T(this,"_color",new bt),T(this,"label"),T(this,"world"),T(this,"volume"),T(this,"meshes",[]),this._components=t,this.world=e,this.volume=i,this.label=new ep(e),this._root.renderOrder=2,this.visible=!0,this.update(),this.volume.onItemsChanged.add(()=>this.update())}set material(t){this._material.dispose(),this._material=t;for(const e of this.meshes)e.material=t}get material(){return this._material}set visible(t){this._visible=t,this.label.visible=t;for(const e of this.meshes)t?this.world.scene.three.add(e):e.removeFromParent()}get visible(){return this._visible}set rounding(t){this.label.rounding=t}get rounding(){return this.label.rounding}set units(t){this.label.units=t}get units(){return this.label.units}set color(t){this._color=t,this.label.color=t,this._material.color.set(t)}get color(){return this._color}async updateMesh(){this.cleanMeshes();const t=this._components.get(yo),e=await t.get(this.volume.items,{material:this.material});this.meshes=t.getMeshesFromResult(e);for(const i of this.meshes)this.world.scene.three.add(i)}async update(){this.updateMesh();const t=await this.volume.getRawValue();this.label.visible=t!==0,this.label.value=t;const e=await this.volume.getCenter();e&&this.label.three.position.copy(e)}cleanMeshes(){const t=this._components.get(si);for(const e of this.meshes)t.destroy(e,!0,!0);this._components.get(yo).remove(),this.meshes=[]}dispose(){this.label.dispose(),this.cleanMeshes(),this.volume.items={}}},Ni=class extends Tt{constructor(t,e){super(t),T(this,"list",new Zt),T(this,"onDisposed",new K),T(this,"snappings",[Fs.LINE,Fs.POINT,Fs.FACE]),T(this,"lines",new Zt),T(this,"fills",new Zt),T(this,"labels",new Zt),T(this,"volumes",new Zt),T(this,"delay",300),T(this,"_world",null),T(this,"measureType"),T(this,"onPointerStop",new K),T(this,"onPointerMove",new K),T(this,"onStateChanged",new K),T(this,"pointerStopTimeout",null),T(this,"onMove",()=>{this.enabled&&(this._vertexPicker.updatePointer(),this.pointerStopTimeout!==null&&clearTimeout(this.pointerStopTimeout),this.pointerStopTimeout=window.setTimeout(()=>{this.onPointerStop.trigger()},this.delay),this.onPointerMove.trigger())}),T(this,"onKeydown",i=>{this.enabled&&i.key==="Escape"&&this.cancelCreation()}),T(this,"onEnabledChange",new K),T(this,"_enabled",!1),T(this,"onVisibilityChange",new K),T(this,"_visible",!0),T(this,"_units"),T(this,"_rounding",2),T(this,"_linesEndpointElement",Qu()),T(this,"_linesMaterial",new Ul({color:"#0000FF",depthTest:!1})),T(this,"_fillsMaterial",new fo({color:2392594,side:Mi,transparent:!0,opacity:.3,depthTest:!1})),T(this,"_volumesMaterial",new fo({color:2392594,side:Mi,transparent:!0,opacity:.3,depthTest:!1})),T(this,"_color",new bt),T(this,"_vertexPicker",new Ov(this.components)),T(this,"create",i=>{}),T(this,"endCreation",i=>{}),T(this,"cancelCreation",()=>{}),T(this,"delete",i=>{}),this.measureType=e,this._units=Mv[this.measureType],this.lines.onBeforeDelete.add(i=>i.dispose()),this.fills.onBeforeDelete.add(i=>i.dispose()),this.labels.onBeforeDelete.add(i=>i.dispose()),this.volumes.onBeforeDelete.add(i=>i.dispose()),this.list.onCleared.add(()=>{this.lines.clear(),this.fills.clear(),this.labels.clear(),this.volumes.clear()})}set world(t){this._world=t,this._vertexPicker.world=t}get world(){return this._world}get unitsList(){let t=[];return this.measureType==="length"?t=["mm","cm","m","km"]:this.measureType==="area"?t=["mm2","cm2","m2","km2"]:t=["mm3","cm3","m3","km3"],t}setEvents(t){if(!this.world)throw new Error("Measurement: you must specify a world first!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("Measurement: the world needs a renderer!");const e=this.world.renderer.three.domElement.parentElement;e&&(e.removeEventListener("pointermove",this.onMove),window.removeEventListener("keydown",this.onKeydown),t&&(e.addEventListener("pointermove",this.onMove),window.addEventListener("keydown",this.onKeydown)))}set enabled(t){this._enabled=t,this._vertexPicker.enabled=t,this.setEvents(t),this.cancelCreation(),this.onEnabledChange.trigger(t),this.onStateChanged.trigger(["enabled"])}get enabled(){return this._enabled}set visible(t){this._visible=t;for(const e of this.lines)e.visible=t;for(const e of this.fills)e.visible=t;for(const e of this.volumes)e.visible=t;this.onVisibilityChange.trigger(t),this.onStateChanged.trigger(["visibility"])}get visible(){return this._visible}set units(t){this._units=t;let e;t.endsWith("2")?e="area":t.endsWith("3")?e="volume":e="length";for(const i of this.list)(i instanceof as||i instanceof ec||i instanceof Ju)&&(i.units=t);if(e==="length")for(const i of this.lines)i.units=t;else if(e==="area")for(const i of this.fills)i.units=t;else if(e==="volume")for(const i of this.volumes)i.units=t;this.onStateChanged.trigger(["units"])}get units(){return this._units}set rounding(t){this._rounding=t;for(const e of this.list)"rounding"in e&&typeof e.rounding=="number"&&(e.rounding=t);for(const e of this.lines)e.rounding=t;for(const e of this.fills)e.rounding=t;for(const e of this.volumes)e.rounding=t;this.onStateChanged.trigger(["rounding"])}get rounding(){return this._rounding}set linesEndpointElement(t){this._linesEndpointElement=t;for(const e of this.lines)e.endpointElement=t}get linesEndpointElement(){return this._linesEndpointElement}set linesMaterial(t){this._linesMaterial.dispose(),this._linesMaterial=t;for(const e of this.lines)e.material=t}get linesMaterial(){return this._linesMaterial}set fillsMaterial(t){this._fillsMaterial.dispose(),this._fillsMaterial=t;for(const e of this.fills)e.material=t}get fillsMaterial(){return this._fillsMaterial}set volumesMaterial(t){this._volumesMaterial.dispose(),this._volumesMaterial=t;for(const e of this.volumes)e.material=t}get volumesMaterial(){return this._volumesMaterial}set color(t){this._color=t,this._linesMaterial.color.set(t),this._fillsMaterial.color.set(t),this._volumesMaterial.color.set(t);for(const e of this.lines)e.color=t;for(const e of this.fills)e.color=t;for(const e of this.volumes)e.color=t;this.onStateChanged.trigger(["color"])}get color(){return this._color}dispose(){this._vertexPicker.dispose(),this.list.clear(),this.linesMaterial.dispose(),this.fillsMaterial.dispose(),this.volumesMaterial.dispose(),this.onDisposed.trigger()}createLineElement(t,e=null){if(!this.world)throw new Error("Measurement: world is need!");return new zv(this.components,this.world,{line:t,startNormal:e??void 0,lineMaterial:this.linesMaterial,endpointElement:this.linesEndpointElement},this.rounding,this.units)}createFillElement(t){if(!this.world)throw new Error("Measurement: world is need!");const e=new Dv(this.components,this.world,t);return e.rounding=this.rounding,(this.units.endsWith("2")?"area":void 0)==="area"&&(e.units=this.units),e}createVolumeElement(t){if(!this.world)throw new Error("Measurement: world is need!");const e=new ip(this.components,this.world,t);return e.rounding=this.rounding,(this.units.endsWith("3")?"volume":void 0)==="volume"&&(e.units=this.units),e}addLineElementsFromPoints(t){for(let e=0;e<t.length;e++){const i=t[e],n=t[(e+1)%t.length],r=new as(i,n),o=this.createLineElement(r);o.label.visible=!1,this.lines.add(o)}}getLineBoxes(){const t=[];for(const e of this.lines)t.push(e.boundingBox);return t}getFillBoxes(){const t=[];for(const e of this.fills)t.push(e.three);return t}async getVolumeBoxes(){const t=[];for(const e of this.volumes)t.push(e.meshes);return t}};T(Ni,"valueFormatter",null);const Lv=class sp extends Ni{constructor(t){super(t,"area"),T(this,"pickTolerance",.1),T(this,"tolerance",.005),T(this,"modes",["free","square"]),T(this,"_mode","free"),T(this,"_temp",{isDragging:!1,area:new ec,lines:new Zt,point:new M}),T(this,"computeLineElements",()=>{this._temp.lines.clear();const e=[...this._temp.area.points];if(this._temp.area.isPointInPlane(this._temp.point)&&e.push(this._temp.point),!(e.length<2||!this.world))for(let i=0;i<e.length;i++){const n=e[i],r=e[(i+1)%e.length],o=new as(n,r),a=this.createLineElement(o);this._temp.lines.add(a)}}),T(this,"create",async()=>{if(!this.enabled)return;if(!this.world)throw new Error("Area Measurement: world is not defined!");const e=await this._vertexPicker.get({snappingClasses:this.snappings});if(!(e&&e.point))return;const{area:i,point:n}=this._temp;if(this._temp.isDragging||(i.tolerance=this.tolerance,i.points.clear(),this._temp.isDragging=!0),i.points.size===0&&n.copy(e.point),i.points.add(n.clone()),this.mode==="square"&&i.points.size===2&&e.normal){const[r,o]=i.points,a=new M().subVectors(o,r),l=a.clone(),c=a.clone().negate();Math.abs(a.y)>=.1?(l.y=0,c.y=0):(l.x=0,c.x=0);const h=r.clone().add(l),d=o.clone().add(c);i.points.clear(),i.points.add(r,h,o,d),this.endCreation()}}),T(this,"endCreation",()=>{this.enabled&&(this._temp.isDragging=!1,this._temp.area.points.size>=3&&this.list.add(this._temp.area.clone()),this._temp.area.points.clear(),this._temp.lines.clear())}),T(this,"cancelCreation",()=>{this.enabled&&(this._temp.isDragging=!1,this._temp.area.points.clear(),this._temp.lines.clear())}),T(this,"delete",()=>{if(!this.enabled||this.list.size===0||!this.world)return;const e=this.getFillBoxes(),i=this.components.get(fe).get(this.world).castRayToObjects(e),n=this.components.get(si);for(const o of e)n.destroy(o);if(!i)return;const r=[...this.fills].find(o=>o.three===i.object);r&&(this.list.delete(r.area),this.lines.clear())}),t.add(sp.uuid,this),this.initHandlers(),this.color=new bt("#6528d7")}get mode(){return this._mode}set mode(t){this._mode=t,this.cancelCreation(),this.onStateChanged.trigger(["mode"])}initHandlers(){this.onVisibilityChange.add(()=>{for(const t of this.lines)t.label.visible=!1}),this.list.onItemAdded.add(t=>{if(!this.world)return;const e=this.createFillElement(t);e.color=this.color,this.fills.add(e),this.addLineElementsFromPoints([...t.points])}),this.list.onBeforeDelete.add(t=>{const e=[...this.fills].find(i=>i.area===t);e&&this.fills.delete(e)}),this.onPointerStop.add(()=>this.updatePreview()),this._temp.lines.onItemAdded.add(t=>t.label.visible=!1),this._temp.lines.onBeforeDelete.add(t=>t.dispose()),this._temp.area.points.onItemAdded.add(()=>{this.computeLineElements()}),this._temp.area.points.onItemDeleted.add(()=>{this._temp.lines.clear()}),this.onStateChanged.add(t=>{t.includes("rounding")&&(this._temp.area.rounding=this.rounding),t.includes("units")&&(this._temp.area.units=this.units)})}async updatePreview(){if(!this.enabled||!this.world)throw new Error("Measurement is not enabled or world is not defined!");const t=await this._vertexPicker.get({snappingClasses:this.snappings});if(!(t&&t.point&&this._temp.isDragging))return;const e=t.point.clone(),{plane:i}=this._temp.area;if(i){const n=i.distanceToPoint(e);if(Math.abs(n)<.1){const r=new M;i.projectPoint(e,r),e.copy(r)}}this._temp.point.copy(e),this.computeLineElements()}};T(Lv,"uuid","09b78c1f-0ff1-4630-a818-ceda3d878c75");const Bv=class np extends Ni{constructor(t){super(t,"length"),T(this,"_temp",{isDragging:!1,line:new as}),T(this,"modes",["free","edge"]),T(this,"_mode","free"),T(this,"create",()=>{if(this.enabled){if(!this._temp.isDragging){this.initPreview();return}this.endCreation()}}),T(this,"endCreation",()=>{this.enabled&&this._temp.dimension&&(this.list.add(this._temp.line.clone()),this.mode==="free"&&(this._temp.dimension.dispose(),this._temp.dimension=void 0,this._temp.isDragging=!1,this._temp.startNormal=void 0))}),T(this,"cancelCreation",()=>{var e;this.enabled&&(this._temp.isDragging=!1,this._temp.dimension&&((e=this._temp.dimension)==null||e.dispose(),this._temp.dimension=void 0))}),T(this,"delete",()=>{if(!this.enabled||this.list.size===0||!this.world)return;const e=this.getLineBoxes(),i=this.components.get(fe).get(this.world).castRayToObjects(e);if(!i)return;const n=[...this.lines].find(r=>r.boundingBox===i.object);n&&this.list.delete(n.line)}),t.add(np.uuid,this),this.initHandlers()}get mode(){return this._mode}set mode(t){this._mode=t,this.cancelCreation(),t==="edge"&&this.initPreview(),this.onStateChanged.trigger(["mode"])}initHandlers(){this.list.onItemAdded.add(t=>{const e=this.createLineElement(t,this._temp.startNormal);e.createBoundingBox(),this.lines.add(e)}),this.list.onBeforeDelete.add(t=>{const e=[...this.lines].find(i=>i.line===t);e&&this.lines.delete(e)}),this.onPointerStop.add(()=>this.updatePreviewLine()),this.onEnabledChange.add(t=>{t&&this.mode==="edge"&&this.initPreview()})}async initPreview(){if(!this.world)throw new Error("Measurement: world is need!");const t=await this._vertexPicker.get({snappingClasses:this.snappings});if(this.mode==="free"){if(!(t!=null&&t.point))return;const e=t.point;this._temp.line.set(e,e.clone()),this._temp.isDragging=!0,this._temp.dimension=this.createLineElement(this._temp.line),this._temp.startNormal=t.normal??void 0}else if(this.mode==="edge"){const e=t==null?void 0:t.snappedEdgeP1,i=t==null?void 0:t.snappedEdgeP2,n=e||new M,r=n||i;this._temp.line.set(n,r),this._temp.isDragging=!0,this._temp.dimension=this.createLineElement(this._temp.line),this._temp.dimension.visible=!!(e&&i)}}async updatePreviewLine(){if(!this.world)throw new Error("Measurement: world is need!");const t=await this._vertexPicker.get({snappingClasses:this.snappings});if(this.mode==="free"){if(!(t!=null&&t.point)||(this._temp.line.end.copy(t.point),!this._temp.dimension))return;this._temp.dimension.end=this._temp.line.end}else if(this.mode==="edge"){const e=t==null?void 0:t.snappedEdgeP1,i=t==null?void 0:t.snappedEdgeP2;if(this._temp.dimension&&(this._temp.dimension.visible=!!(e&&i)),!(e&&i)||(this._temp.line.start.copy(e),this._temp.line.end.copy(i),!this._temp.dimension))return;this._temp.dimension.start=this._temp.line.start,this._temp.dimension.end=this._temp.line.end}}};T(Bv,"uuid","2f9bcacf-18a9-4be6-a293-e898eae64ea1");const Nv=class rp extends Ni{constructor(t){super(t,"volume"),T(this,"_temp",{}),T(this,"modes",["free"]),T(this,"_mode","free"),T(this,"_previousHovererState",!1),T(this,"create",async()=>{if(!this.enabled)return;const e=await this._vertexPicker.get();e&&(this._temp.preview||this.initPreview(),this._temp.preview.volume.items=St.join([this._temp.preview.volume.items,{[e.fragments.modelId]:new Set([e.localId])}]))}),T(this,"endCreation",()=>{if(!this._temp.preview||St.isEmpty(this._temp.preview.volume.items))return;const e=this._temp.preview.volume.clone();this.list.add(e),this._temp.preview.dispose(),delete this._temp.preview}),T(this,"cancelCreation",()=>{var e;(e=this._temp.preview)==null||e.dispose(),delete this._temp.preview}),T(this,"delete",async()=>{if(this.list.size===0||!this.world)return;const e=await this.getVolumeBoxes(),i=this.components.get(fe).get(this.world);for(const n of e){const r=i.castRayToObjects(n);if(!r)continue;const o=[...this.volumes].find(a=>a.meshes.some(l=>l===r.object));if(!o)return;this.list.delete(o.volume)}}),t.add(rp.uuid,this),this.initHandlers()}get mode(){return this._mode}set mode(t){this._mode=t,this.cancelCreation(),this.onStateChanged.trigger(["mode"])}initHandlers(){this.list.onItemAdded.add(t=>{const e=this.createVolumeElement(t);e.color=this.color,e.rounding=this.rounding,e.units=this.units,this.volumes.add(e)}),this.list.onBeforeDelete.add(t=>{const e=[...this.volumes].find(i=>i.volume===t);e&&this.volumes.delete(e)}),this.onStateChanged.add(t=>{if(t.includes("color")){if(!this._temp.preview)return;this._temp.preview.color=this.color}if(t.includes("units")){if(!this._temp.preview)return;this._temp.preview.units=this.units}if(t.includes("rounding")){if(!this._temp.preview)return;this._temp.preview.rounding=this.rounding}if(t.includes("enabled")){const e=this.components.get(Av);e.world=this.world,this.enabled?(this._previousHovererState=e.enabled,e.enabled=!0):(e.clear(),e.enabled=this._previousHovererState),e.hover()}})}async initPreview(){if(this.enabled){if(!this.world)throw new Error("Measurement: world is need!");this._temp.preview=new ip(this.components,this.world),this._temp.preview.color=this.color,this._temp.preview.rounding=this.rounding,this._temp.preview.units=this.units}}};T(Nv,"uuid","01f885ab-ec4e-4e6c-a853-9dfc0d6766ed");/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const co=globalThis,ic=co.ShadowRoot&&(co.ShadyCSS===void 0||co.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,sc=Symbol(),Ih=new WeakMap;let op=class{constructor(s,t,e){if(this._$cssResult$=!0,e!==sc)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=s,this.t=t}get styleSheet(){let s=this.o;const t=this.t;if(ic&&s===void 0){const e=t!==void 0&&t.length===1;e&&(s=Ih.get(t)),s===void 0&&((this.o=s=new CSSStyleSheet).replaceSync(this.cssText),e&&Ih.set(t,s))}return s}toString(){return this.cssText}};const Uv=s=>new op(typeof s=="string"?s:s+"",void 0,sc),nc=(s,...t)=>{const e=s.length===1?s[0]:t.reduce((i,n,r)=>i+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+s[r+1],s[0]);return new op(e,s,sc)},Rv=(s,t)=>{if(ic)s.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const e of t){const i=document.createElement("style"),n=co.litNonce;n!==void 0&&i.setAttribute("nonce",n),i.textContent=e.cssText,s.appendChild(i)}},zh=ic?s=>s:s=>s instanceof CSSStyleSheet?(t=>{let e="";for(const i of t.cssRules)e+=i.cssText;return Uv(e)})(s):s;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:Fv,defineProperty:jv,getOwnPropertyDescriptor:Hv,getOwnPropertyNames:Vv,getOwnPropertySymbols:qv,getPrototypeOf:Wv}=Object,Xs=globalThis,Dh=Xs.trustedTypes,Yv=Dh?Dh.emptyScript:"",Mh=Xs.reactiveElementPolyfillSupport,Wn=(s,t)=>s,vo={toAttribute(s,t){switch(t){case Boolean:s=s?Yv:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,t){let e=s;switch(t){case Boolean:e=s!==null;break;case Number:e=s===null?null:Number(s);break;case Object:case Array:try{e=JSON.parse(s)}catch{e=null}}return e}},rc=(s,t)=>!Fv(s,t),Lh={attribute:!0,type:String,converter:vo,reflect:!1,useDefault:!1,hasChanged:rc};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Xs.litPropertyMetadata??(Xs.litPropertyMetadata=new WeakMap);let Ls=class extends HTMLElement{static addInitializer(s){this._$Ei(),(this.l??(this.l=[])).push(s)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(s,t=Lh){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(s)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(s,t),!t.noAccessor){const e=Symbol(),i=this.getPropertyDescriptor(s,e,t);i!==void 0&&jv(this.prototype,s,i)}}static getPropertyDescriptor(s,t,e){const{get:i,set:n}=Hv(this.prototype,s)??{get(){return this[t]},set(r){this[t]=r}};return{get:i,set(r){const o=i==null?void 0:i.call(this);n==null||n.call(this,r),this.requestUpdate(s,o,e)},configurable:!0,enumerable:!0}}static getPropertyOptions(s){return this.elementProperties.get(s)??Lh}static _$Ei(){if(this.hasOwnProperty(Wn("elementProperties")))return;const s=Wv(this);s.finalize(),s.l!==void 0&&(this.l=[...s.l]),this.elementProperties=new Map(s.elementProperties)}static finalize(){if(this.hasOwnProperty(Wn("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Wn("properties"))){const t=this.properties,e=[...Vv(t),...qv(t)];for(const i of e)this.createProperty(i,t[i])}const s=this[Symbol.metadata];if(s!==null){const t=litPropertyMetadata.get(s);if(t!==void 0)for(const[e,i]of t)this.elementProperties.set(e,i)}this._$Eh=new Map;for(const[t,e]of this.elementProperties){const i=this._$Eu(t,e);i!==void 0&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(s){const t=[];if(Array.isArray(s)){const e=new Set(s.flat(1/0).reverse());for(const i of e)t.unshift(zh(i))}else s!==void 0&&t.push(zh(s));return t}static _$Eu(s,t){const e=t.attribute;return e===!1?void 0:typeof e=="string"?e:typeof s=="string"?s.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var s;this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(s=this.constructor.l)==null||s.forEach(t=>t(this))}addController(s){var t;(this._$EO??(this._$EO=new Set)).add(s),this.renderRoot!==void 0&&this.isConnected&&((t=s.hostConnected)==null||t.call(s))}removeController(s){var t;(t=this._$EO)==null||t.delete(s)}_$E_(){const s=new Map,t=this.constructor.elementProperties;for(const e of t.keys())this.hasOwnProperty(e)&&(s.set(e,this[e]),delete this[e]);s.size>0&&(this._$Ep=s)}createRenderRoot(){const s=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Rv(s,this.constructor.elementStyles),s}connectedCallback(){var s;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(s=this._$EO)==null||s.forEach(t=>{var e;return(e=t.hostConnected)==null?void 0:e.call(t)})}enableUpdating(s){}disconnectedCallback(){var s;(s=this._$EO)==null||s.forEach(t=>{var e;return(e=t.hostDisconnected)==null?void 0:e.call(t)})}attributeChangedCallback(s,t,e){this._$AK(s,e)}_$ET(s,t){var e;const i=this.constructor.elementProperties.get(s),n=this.constructor._$Eu(s,i);if(n!==void 0&&i.reflect===!0){const r=(((e=i.converter)==null?void 0:e.toAttribute)!==void 0?i.converter:vo).toAttribute(t,i.type);this._$Em=s,r==null?this.removeAttribute(n):this.setAttribute(n,r),this._$Em=null}}_$AK(s,t){var e,i;const n=this.constructor,r=n._$Eh.get(s);if(r!==void 0&&this._$Em!==r){const o=n.getPropertyOptions(r),a=typeof o.converter=="function"?{fromAttribute:o.converter}:((e=o.converter)==null?void 0:e.fromAttribute)!==void 0?o.converter:vo;this._$Em=r,this[r]=a.fromAttribute(t,o.type)??((i=this._$Ej)==null?void 0:i.get(r))??null,this._$Em=null}}requestUpdate(s,t,e){var i;if(s!==void 0){const n=this.constructor,r=this[s];if(e??(e=n.getPropertyOptions(s)),!((e.hasChanged??rc)(r,t)||e.useDefault&&e.reflect&&r===((i=this._$Ej)==null?void 0:i.get(s))&&!this.hasAttribute(n._$Eu(s,e))))return;this.C(s,t,e)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(s,t,{useDefault:e,reflect:i,wrapped:n},r){e&&!(this._$Ej??(this._$Ej=new Map)).has(s)&&(this._$Ej.set(s,r??t??this[s]),n!==!0||r!==void 0)||(this._$AL.has(s)||(this.hasUpdated||e||(t=void 0),this._$AL.set(s,t)),i===!0&&this._$Em!==s&&(this._$Eq??(this._$Eq=new Set)).add(s))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const s=this.scheduleUpdate();return s!=null&&await s,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var s;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[n,r]of this._$Ep)this[n]=r;this._$Ep=void 0}const i=this.constructor.elementProperties;if(i.size>0)for(const[n,r]of i){const{wrapped:o}=r,a=this[n];o!==!0||this._$AL.has(n)||a===void 0||this.C(n,void 0,r,a)}}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),(s=this._$EO)==null||s.forEach(i=>{var n;return(n=i.hostUpdate)==null?void 0:n.call(i)}),this.update(e)):this._$EM()}catch(i){throw t=!1,this._$EM(),i}t&&this._$AE(e)}willUpdate(s){}_$AE(s){var t;(t=this._$EO)==null||t.forEach(e=>{var i;return(i=e.hostUpdated)==null?void 0:i.call(e)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(s)),this.updated(s)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(s){return!0}update(s){this._$Eq&&(this._$Eq=this._$Eq.forEach(t=>this._$ET(t,this[t]))),this._$EM()}updated(s){}firstUpdated(s){}};Ls.elementStyles=[],Ls.shadowRootOptions={mode:"open"},Ls[Wn("elementProperties")]=new Map,Ls[Wn("finalized")]=new Map,Mh==null||Mh({ReactiveElement:Ls}),(Xs.reactiveElementVersions??(Xs.reactiveElementVersions=[])).push("2.1.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const _o=globalThis,wo=_o.trustedTypes,Bh=wo?wo.createPolicy("lit-html",{createHTML:s=>s}):void 0,ap="$lit$",Ti=`lit$${Math.random().toFixed(9).slice(2)}$`,lp="?"+Ti,Zv=`<${lp}>`,hs=document,tr=()=>hs.createComment(""),er=s=>s===null||typeof s!="object"&&typeof s!="function",oc=Array.isArray,Xv=s=>oc(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",Ba=`[ 	
\f\r]`,Ln=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Nh=/-->/g,Uh=/>/g,Qi=RegExp(`>|${Ba}(?:([^\\s"'>=/]+)(${Ba}*=${Ba}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Rh=/'/g,Fh=/"/g,cp=/^(?:script|style|textarea|title)$/i,Gv=s=>(t,...e)=>({_$litType$:s,strings:t,values:e}),ac=Gv(1),Gs=Symbol.for("lit-noChange"),jt=Symbol.for("lit-nothing"),jh=new WeakMap,is=hs.createTreeWalker(hs,129);function hp(s,t){if(!oc(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return Bh!==void 0?Bh.createHTML(t):t}const Qv=(s,t)=>{const e=s.length-1,i=[];let n,r=t===2?"<svg>":t===3?"<math>":"",o=Ln;for(let a=0;a<e;a++){const l=s[a];let c,h,d=-1,p=0;for(;p<l.length&&(o.lastIndex=p,h=o.exec(l),h!==null);)p=o.lastIndex,o===Ln?h[1]==="!--"?o=Nh:h[1]!==void 0?o=Uh:h[2]!==void 0?(cp.test(h[2])&&(n=RegExp("</"+h[2],"g")),o=Qi):h[3]!==void 0&&(o=Qi):o===Qi?h[0]===">"?(o=n??Ln,d=-1):h[1]===void 0?d=-2:(d=o.lastIndex-h[2].length,c=h[1],o=h[3]===void 0?Qi:h[3]==='"'?Fh:Rh):o===Fh||o===Rh?o=Qi:o===Nh||o===Uh?o=Ln:(o=Qi,n=void 0);const u=o===Qi&&s[a+1].startsWith("/>")?" ":"";r+=o===Ln?l+Zv:d>=0?(i.push(c),l.slice(0,d)+ap+l.slice(d)+Ti+u):l+Ti+(d===-2?a:u)}return[hp(s,r+(s[e]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),i]};let yl=class dp{constructor({strings:t,_$litType$:e},i){let n;this.parts=[];let r=0,o=0;const a=t.length-1,l=this.parts,[c,h]=Qv(t,e);if(this.el=dp.createElement(c,i),is.currentNode=this.el.content,e===2||e===3){const d=this.el.content.firstChild;d.replaceWith(...d.childNodes)}for(;(n=is.nextNode())!==null&&l.length<a;){if(n.nodeType===1){if(n.hasAttributes())for(const d of n.getAttributeNames())if(d.endsWith(ap)){const p=h[o++],u=n.getAttribute(d).split(Ti),g=/([.?@])?(.*)/.exec(p);l.push({type:1,index:r,name:g[2],strings:u,ctor:g[1]==="."?Jv:g[1]==="?"?t_:g[1]==="@"?e_:Yo}),n.removeAttribute(d)}else d.startsWith(Ti)&&(l.push({type:6,index:r}),n.removeAttribute(d));if(cp.test(n.tagName)){const d=n.textContent.split(Ti),p=d.length-1;if(p>0){n.textContent=wo?wo.emptyScript:"";for(let u=0;u<p;u++)n.append(d[u],tr()),is.nextNode(),l.push({type:2,index:++r});n.append(d[p],tr())}}}else if(n.nodeType===8)if(n.data===lp)l.push({type:2,index:r});else{let d=-1;for(;(d=n.data.indexOf(Ti,d+1))!==-1;)l.push({type:7,index:r}),d+=Ti.length-1}r++}}static createElement(t,e){const i=hs.createElement("template");return i.innerHTML=t,i}};function Qs(s,t,e=s,i){var n,r;if(t===Gs)return t;let o=i!==void 0?(n=e._$Co)==null?void 0:n[i]:e._$Cl;const a=er(t)?void 0:t._$litDirective$;return(o==null?void 0:o.constructor)!==a&&((r=o==null?void 0:o._$AO)==null||r.call(o,!1),a===void 0?o=void 0:(o=new a(s),o._$AT(s,e,i)),i!==void 0?(e._$Co??(e._$Co=[]))[i]=o:e._$Cl=o),o!==void 0&&(t=Qs(s,o._$AS(s,t.values),o,i)),t}class Kv{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:i}=this._$AD,n=((t==null?void 0:t.creationScope)??hs).importNode(e,!0);is.currentNode=n;let r=is.nextNode(),o=0,a=0,l=i[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new lc(r,r.nextSibling,this,t):l.type===1?c=new l.ctor(r,l.name,l.strings,this,t):l.type===6&&(c=new i_(r,this,t)),this._$AV.push(c),l=i[++a]}o!==(l==null?void 0:l.index)&&(r=is.nextNode(),o++)}return is.currentNode=hs,n}p(t){let e=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}}let lc=class up{get _$AU(){var t;return((t=this._$AM)==null?void 0:t._$AU)??this._$Cv}constructor(t,e,i,n){this.type=2,this._$AH=jt,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=n,this._$Cv=(n==null?void 0:n.isConnected)??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=Qs(this,t,e),er(t)?t===jt||t==null||t===""?(this._$AH!==jt&&this._$AR(),this._$AH=jt):t!==this._$AH&&t!==Gs&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):Xv(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==jt&&er(this._$AH)?this._$AA.nextSibling.data=t:this.T(hs.createTextNode(t)),this._$AH=t}$(t){var e;const{values:i,_$litType$:n}=t,r=typeof n=="number"?this._$AC(t):(n.el===void 0&&(n.el=yl.createElement(hp(n.h,n.h[0]),this.options)),n);if(((e=this._$AH)==null?void 0:e._$AD)===r)this._$AH.p(i);else{const o=new Kv(r,this),a=o.u(this.options);o.p(i),this.T(a),this._$AH=o}}_$AC(t){let e=jh.get(t.strings);return e===void 0&&jh.set(t.strings,e=new yl(t)),e}k(t){oc(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,n=0;for(const r of t)n===e.length?e.push(i=new up(this.O(tr()),this.O(tr()),this,this.options)):i=e[n],i._$AI(r),n++;n<e.length&&(this._$AR(i&&i._$AB.nextSibling,n),e.length=n)}_$AR(t=this._$AA.nextSibling,e){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,e);t&&t!==this._$AB;){const n=t.nextSibling;t.remove(),t=n}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}};class Yo{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,i,n,r){this.type=1,this._$AH=jt,this._$AN=void 0,this.element=t,this.name=e,this._$AM=n,this.options=r,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=jt}_$AI(t,e=this,i,n){const r=this.strings;let o=!1;if(r===void 0)t=Qs(this,t,e,0),o=!er(t)||t!==this._$AH&&t!==Gs,o&&(this._$AH=t);else{const a=t;let l,c;for(t=r[0],l=0;l<r.length-1;l++)c=Qs(this,a[i+l],e,l),c===Gs&&(c=this._$AH[l]),o||(o=!er(c)||c!==this._$AH[l]),c===jt?t=jt:t!==jt&&(t+=(c??"")+r[l+1]),this._$AH[l]=c}o&&!n&&this.j(t)}j(t){t===jt?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}let Jv=class extends Yo{constructor(){super(...arguments),this.type=3}j(s){this.element[this.name]=s===jt?void 0:s}};class t_ extends Yo{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==jt)}}let e_=class extends Yo{constructor(s,t,e,i,n){super(s,t,e,i,n),this.type=5}_$AI(s,t=this){if((s=Qs(this,s,t,0)??jt)===Gs)return;const e=this._$AH,i=s===jt&&e!==jt||s.capture!==e.capture||s.once!==e.once||s.passive!==e.passive,n=s!==jt&&(e===jt||i);i&&this.element.removeEventListener(this.name,this,e),n&&this.element.addEventListener(this.name,this,s),this._$AH=s}handleEvent(s){var t;typeof this._$AH=="function"?this._$AH.call(((t=this.options)==null?void 0:t.host)??this.element,s):this._$AH.handleEvent(s)}},i_=class{constructor(s,t,e){this.element=s,this.type=6,this._$AN=void 0,this._$AM=t,this.options=e}get _$AU(){return this._$AM._$AU}_$AI(s){Qs(this,s)}};const Hh=_o.litHtmlPolyfillSupport;Hh==null||Hh(yl,lc),(_o.litHtmlVersions??(_o.litHtmlVersions=[])).push("3.3.0");const s_=(s,t,e)=>{const i=(e==null?void 0:e.renderBefore)??t;let n=i._$litPart$;if(n===void 0){const r=(e==null?void 0:e.renderBefore)??null;i._$litPart$=n=new lc(t.insertBefore(tr(),r),r,void 0,e??{})}return n._$AI(s),n};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ir=globalThis;let ls=class extends Ls{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var s;const t=super.createRenderRoot();return(s=this.renderOptions).renderBefore??(s.renderBefore=t.firstChild),t}update(s){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(s),this._$Do=s_(t,this.renderRoot,this.renderOptions)}connectedCallback(){var s;super.connectedCallback(),(s=this._$Do)==null||s.setConnected(!0)}disconnectedCallback(){var s;super.disconnectedCallback(),(s=this._$Do)==null||s.setConnected(!1)}render(){return Gs}};var Vh;ls._$litElement$=!0,ls.finalized=!0,(Vh=ir.litElementHydrateSupport)==null||Vh.call(ir,{LitElement:ls});const qh=ir.litElementPolyfillSupport;qh==null||qh({LitElement:ls});(ir.litElementVersions??(ir.litElementVersions=[])).push("4.2.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const n_={attribute:!0,type:String,converter:vo,reflect:!1,hasChanged:rc},r_=(s=n_,t,e)=>{const{kind:i,metadata:n}=e;let r=globalThis.litPropertyMetadata.get(n);if(r===void 0&&globalThis.litPropertyMetadata.set(n,r=new Map),i==="setter"&&((s=Object.create(s)).wrapped=!0),r.set(e.name,s),i==="accessor"){const{name:o}=e;return{set(a){const l=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,l,s)},init(a){return a!==void 0&&this.C(o,void 0,s,a),a}}}if(i==="setter"){const{name:o}=e;return function(a){const l=this[o];t.call(this,a),this.requestUpdate(o,l,s)}}throw Error("Unsupported decorator location: "+i)};function me(s){return(t,e)=>typeof e=="object"?r_(s,t,e):((i,n,r)=>{const o=n.hasOwnProperty(r);return n.constructor.createProperty(r,i),o?Object.getOwnPropertyDescriptor(n,r):void 0})(s,t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function o_(s){return me({...s,state:!0,attribute:!1})}class a_ extends Ws{constructor(t=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Vt(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&e.element.parentNode!==null&&e.element.remove()})})}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this.center=t.center,this}}new M;new xt;new xt;new M;new M;class l_{constructor(t,e){this._group=new zi,this._frustum=new Bl,this._frustumMat=new xt,this._regenerateDelay=200,this._regenerateCounter=0,this.material=new Ul({color:"#2e3338"}),this.numbers=new zi,this.maxRegenerateRetrys=4,this.gridsFactor=5,this._scaleX=1,this._scaleY=1,this._offsetX=0,this._offsetY=0,this._camera=t,this._container=e;const i=this.newGrid(-1),n=this.newGrid(-2);this.grids={main:i,secondary:n},this._group.add(n,i,this.numbers)}set scaleX(t){this._scaleX=t,this.regenerate()}get scaleX(){return this._scaleX}set scaleY(t){this._scaleY=t,this.regenerate()}get scaleY(){return this._scaleY}set offsetX(t){this._offsetX=t,this.regenerate()}get offsetX(){return this._offsetX}set offsetY(t){this._offsetY=t,this.regenerate()}get offsetY(){return this._offsetY}get(){return this._group}dispose(){const{main:t,secondary:e}=this.grids;t.removeFromParent(),e.removeFromParent(),t.geometry.dispose(),t.material.dispose(),e.geometry.dispose(),e.material.dispose()}regenerate(){if(!this.isGridReady()){if(this._regenerateCounter++,this._regenerateCounter>this.maxRegenerateRetrys)throw new Error("Grid could not be regenerated");setTimeout(()=>this.regenerate,this._regenerateDelay);return}this._regenerateCounter=0,this._camera.updateMatrix(),this._camera.updateMatrixWorld();const t=this._frustumMat.multiplyMatrices(this._camera.projectionMatrix,this._camera.matrixWorldInverse);this._frustum.setFromProjectionMatrix(t);const{planes:e}=this._frustum,i=e[0].constant*-e[0].normal.x,n=e[1].constant*-e[1].normal.x,r=e[2].constant*-e[2].normal.y,o=e[3].constant*-e[3].normal.y,a=Math.abs(i-n),l=Math.abs(o-r),{clientWidth:c,clientHeight:h}=this._container,d=Math.max(c,h),p=Math.max(a,l)/d,u=Math.ceil(Math.log10(a/this.scaleX)),g=Math.ceil(Math.log10(l/this.scaleY)),m=10**(u-2)*this.scaleX,b=10**(g-2)*this.scaleY,f=m*this.gridsFactor,y=b*this.gridsFactor,_=Math.ceil(l/y),x=Math.ceil(a/f),C=Math.ceil(l/b),S=Math.ceil(a/m),$=m*Math.ceil(n/m),O=b*Math.ceil(r/b),z=f*Math.ceil(n/f),D=y*Math.ceil(r/y),j=[...this.numbers.children];for(const pt of j)pt.removeFromParent();this.numbers.children=[];const A=[],k=9*p,v=1e4,L=z+this._offsetX,X=Math.round(Math.abs(L/this.scaleX)*v)/v,V=(x-1)*f,J=Math.round(Math.abs((L+V)/this.scaleX)*v)/v,Y=Math.max(X,J).toString().length*k;let nt=Math.ceil(Y/f)*f;for(let pt=0;pt<x;pt++){let ft=z+pt*f;A.push(ft,o,0,ft,r,0),ft=Math.round(ft*v)/v,nt=Math.round(nt*v)/v;const ht=ft%nt;if(!(f<1||y<1)&&Math.abs(ht)>.01)continue;const mt=this.newNumber((ft+this._offsetX)/this.scaleX),Et=12*p;mt.position.set(ft,r+Et,0)}for(let pt=0;pt<_;pt++){const ft=D+pt*y;A.push(n,ft,0,i,ft,0);const ht=this.newNumber(ft/this.scaleY);let mt=12;ht.element.textContent&&(mt+=4*ht.element.textContent.length);const Et=mt*p;ht.position.set(n+Et,ft,0)}const U=[];for(let pt=0;pt<S;pt++){const ft=$+pt*m;U.push(ft,o,0,ft,r,0)}for(let pt=0;pt<C;pt++){const ft=O+pt*b;U.push(n,ft,0,i,ft,0)}const N=new xe(new Float32Array(A),3),ot=new xe(new Float32Array(U),3),{main:it,secondary:et}=this.grids;it.geometry.setAttribute("position",N),et.geometry.setAttribute("position",ot)}newNumber(t){const e=document.createElement("bim-label");e.textContent=String(Math.round(t*100)/100);const i=new a_(e);return this.numbers.add(i),i}newGrid(t){const e=new se,i=new Lo(e,this.material);return i.frustumCulled=!1,i.renderOrder=t,i}isGridReady(){const t=this._camera.projectionMatrix.elements;for(let e=0;e<t.length;e++){const i=t[e];if(Number.isNaN(i))return!1}return!0}}var c_=Object.defineProperty,h_=Object.getOwnPropertyDescriptor,pr=(s,t,e,i)=>{for(var n=h_(t,e),r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&c_(t,e,n),n};const pp=class extends ls{constructor(){super(...arguments),this._grid=null,this._world=null,this.resize=()=>{this._world&&this._grid&&this._grid.regenerate()}}set gridColor(t){if(this._gridColor=t,!(t&&this._grid))return;const e=Number(t.replace("#","0x"));Number.isNaN(e)||this._grid.material.color.setHex(e)}get gridColor(){return this._gridColor}set gridScaleX(t){this._gridScaleX=t,t&&this._grid&&(this._grid.scaleX=t)}get gridScaleX(){return this._gridScaleX}set gridScaleY(t){this._gridScaleY=t,t&&this._grid&&(this._grid.scaleY=t)}get gridScaleY(){return this._gridScaleY}get gridOffsetX(){var t;return((t=this._grid)==null?void 0:t.offsetX)||0}set gridOffsetX(t){this._grid&&(this._grid.offsetX=t)}get gridOffsetY(){var t;return((t=this._grid)==null?void 0:t.offsetY)||0}set gridOffsetY(t){this._grid&&(this._grid.offsetY=t)}set components(t){this.dispose();const e=t.get(No).create();this._world=e,e.scene=new jl(t),e.scene.setup(),e.renderer=new bv(t,this);const i=new Vd(t);e.camera=i;const n=new l_(i.threeOrtho,this);this._grid=n,e.scene.three.add(n.get()),i.controls.addEventListener("update",()=>n.regenerate()),setTimeout(async()=>{e.camera.updateAspect(),i.set("Plan"),await i.controls.setLookAt(0,0,100,0,0,0),await i.projection.set("Orthographic"),i.controls.dollySpeed=3,i.controls.draggingSmoothTime=.085,i.controls.maxZoom=1e3,i.controls.zoom(4)})}get world(){return this._world}dispose(){var t;(t=this.world)==null||t.dispose(),this._world=null,this._grid=null}connectedCallback(){super.connectedCallback(),new ResizeObserver(this.resize).observe(this)}disconnectedCallback(){super.disconnectedCallback(),this.dispose()}render(){return ac`<slot></slot>`}};pp.styles=nc`
    :host {
      position: relative;
      display: flex;
      min-width: 0px;
      height: 100%;
      background-color: var(--bim-ui_bg-base);
    }
  `;let ln=pp;pr([me({type:String,attribute:"grid-color",reflect:!0})],ln.prototype,"gridColor");pr([me({type:Number,attribute:"grid-scale-x",reflect:!0})],ln.prototype,"gridScaleX");pr([me({type:Number,attribute:"grid-scale-y",reflect:!0})],ln.prototype,"gridScaleY");pr([me({type:Number,attribute:"grid-offset-x",reflect:!0})],ln.prototype,"gridOffsetX");pr([me({type:Number,attribute:"grid-offset-y",reflect:!0})],ln.prototype,"gridOffsetY");var d_=Object.defineProperty,Hi=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&d_(t,e,n),n};const fp=class extends ls{constructor(){super(...arguments),this._defaults={size:60},this._cssMatrix3D="",this._matrix=new xt,this._onRightClick=new Event("rightclick"),this._onLeftClick=new Event("leftclick"),this._onTopClick=new Event("topclick"),this._onBottomClick=new Event("bottomclick"),this._onFrontClick=new Event("frontclick"),this._onBackClick=new Event("backclick"),this._camera=null,this._epsilon=t=>Math.abs(t)<1e-10?0:t}set camera(t){this._camera=t,this.updateOrientation()}get camera(){return this._camera}updateOrientation(){if(!this.camera)return;this._matrix.extractRotation(this.camera.matrixWorldInverse);const{elements:t}=this._matrix;this._cssMatrix3D=`matrix3d(
      ${this._epsilon(t[0])},
      ${this._epsilon(-t[1])},
      ${this._epsilon(t[2])},
      ${this._epsilon(t[3])},
      ${this._epsilon(t[4])},
      ${this._epsilon(-t[5])},
      ${this._epsilon(t[6])},
      ${this._epsilon(t[7])},
      ${this._epsilon(t[8])},
      ${this._epsilon(-t[9])},
      ${this._epsilon(t[10])},
      ${this._epsilon(t[11])},
      ${this._epsilon(t[12])},
      ${this._epsilon(-t[13])},
      ${this._epsilon(t[14])},
      ${this._epsilon(t[15])})
    `}render(){const t=this.size??this._defaults.size;return ac`
      <style>
        .face,
        .cube {
          width: ${t}px;
          height: ${t}px;
          transform: translateZ(-300px) ${this._cssMatrix3D};
        }

        .face-right {
          translate: ${t/2}px 0 0;
        }

        .face-left {
          translate: ${-t/2}px 0 0;
        }

        .face-top {
          translate: 0 ${t/2}px 0;
        }

        .face-bottom {
          translate: 0 ${-t/2}px 0;
        }

        .face-front {
          translate: 0 0 ${t/2}px;
        }

        .face-back {
          translate: 0 0 ${-t/2}px;
        }
      </style>
      <div class="parent">
        <div class="cube">
          <div
            class="face x-direction face-right"
            @click=${()=>this.dispatchEvent(this._onRightClick)}
          >
            ${this.rightText}
          </div>
          <div
            class="face x-direction face-left"
            @click=${()=>this.dispatchEvent(this._onLeftClick)}
          >
            ${this.leftText}
          </div>
          <div
            class="face y-direction face-top"
            @click=${()=>this.dispatchEvent(this._onTopClick)}
          >
            ${this.topText}
          </div>
          <div
            class="face y-direction face-bottom"
            @click=${()=>this.dispatchEvent(this._onBottomClick)}
          >
            ${this.bottomText}
          </div>
          <div
            class="face z-direction face-front"
            @click=${()=>this.dispatchEvent(this._onFrontClick)}
          >
            ${this.frontText}
          </div>
          <div
            class="face z-direction face-back"
            @click=${()=>this.dispatchEvent(this._onBackClick)}
          >
            ${this.backText}
          </div>
        </div>
      </div>
    `}};fp.styles=nc`
    :host {
      position: absolute;
      z-index: 999;
      bottom: 1rem;
      right: 1rem;
    }

    .parent {
      perspective: 400px;
    }

    .cube {
      position: relative;
      transform-style: preserve-3d;
    }

    .face {
      position: absolute;
      display: flex;
      justify-content: center;
      user-select: none;
      align-items: center;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
      color: var(--bim-view-cube--c, white);
      font-size: var(--bim-view-cube--fz, --bim-ui_size-2xl);
    }

    .x-direction {
      // background-color: var(--bim-view-cube_x--bgc, #c93830DD);
      background-color: var(--bim-view-cube_x--bgc, #01a6bcde);
    }

    .x-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .y-direction {
      // background-color: var(--bim-view-cube_y--bgc, #54ff19DD);
      background-color: var(--bim-view-cube_y--bgc, #8d0ec8de);
    }

    .y-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .z-direction {
      // background-color: var(--bim-view-cube_z--bgc, #3041c9DD);
      background-color: var(--bim-view-cube_z--bgc, #2718afde);
    }

    .z-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .face-front {
      transform: rotateX(180deg);
    }

    .face-back {
      transform: rotateZ(180deg);
    }

    .face-top {
      transform: rotateX(90deg);
    }

    .face-bottom {
      transform: rotateX(270deg);
    }

    .face-right {
      transform: rotateY(-270deg) rotateX(180deg);
    }

    .face-left {
      transform: rotateY(-90deg) rotateX(180deg);
    }
  `;let vi=fp;Hi([me({type:Number,reflect:!0})],vi.prototype,"size");Hi([me({type:String,attribute:"right-text",reflect:!0})],vi.prototype,"rightText");Hi([me({type:String,attribute:"left-text",reflect:!0})],vi.prototype,"leftText");Hi([me({type:String,attribute:"top-text",reflect:!0})],vi.prototype,"topText");Hi([me({type:String,attribute:"bottom-text",reflect:!0})],vi.prototype,"bottomText");Hi([me({type:String,attribute:"front-text",reflect:!0})],vi.prototype,"frontText");Hi([me({type:String,attribute:"back-text",reflect:!0})],vi.prototype,"backText");Hi([o_()],vi.prototype,"_cssMatrix3D");/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const u_=s=>s.strings===void 0;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const p_={CHILD:2},f_=s=>(...t)=>({_$litDirective$:s,values:t});class m_{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,i){this._$Ct=t,this._$AM=e,this._$Ci=i}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Yn=(s,t)=>{var e;const i=s._$AN;if(i===void 0)return!1;for(const n of i)(e=n._$AO)==null||e.call(n,t,!1),Yn(n,t);return!0},xo=s=>{let t,e;do{if((t=s._$AM)===void 0)break;e=t._$AN,e.delete(s),s=t}while((e==null?void 0:e.size)===0)},mp=s=>{for(let t;t=s._$AM;s=t){let e=t._$AN;if(e===void 0)t._$AN=e=new Set;else if(e.has(s))break;e.add(s),y_(t)}};function g_(s){this._$AN!==void 0?(xo(this),this._$AM=s,mp(this)):this._$AM=s}function b_(s,t=!1,e=0){const i=this._$AH,n=this._$AN;if(n!==void 0&&n.size!==0)if(t)if(Array.isArray(i))for(let r=e;r<i.length;r++)Yn(i[r],!1),xo(i[r]);else i!=null&&(Yn(i,!1),xo(i));else Yn(this,s)}const y_=s=>{s.type==p_.CHILD&&(s._$AP??(s._$AP=b_),s._$AQ??(s._$AQ=g_))};let v_=class extends m_{constructor(){super(...arguments),this._$AN=void 0}_$AT(s,t,e){super._$AT(s,t,e),mp(this),this.isConnected=s._$AU}_$AO(s,t=!0){var e,i;s!==this.isConnected&&(this.isConnected=s,s?(e=this.reconnected)==null||e.call(this):(i=this.disconnected)==null||i.call(this)),t&&(Yn(this,s),xo(this))}setValue(s){if(u_(this._$Ct))this._$Ct._$AI(s,this);else{const t=[...this._$Ct._$AH];t[this._$Ci]=s,this._$Ct._$AI(t,this,0)}}disconnected(){}reconnected(){}};/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const vl=()=>new __;class __{}const Na=new WeakMap,w_=f_(class extends v_{render(s){return jt}update(s,[t]){var e;const i=t!==this.G;return i&&this.G!==void 0&&this.rt(void 0),(i||this.lt!==this.ct)&&(this.G=t,this.ht=(e=s.options)==null?void 0:e.host,this.rt(this.ct=s.element)),jt}rt(s){if(this.isConnected||(s=void 0),typeof this.G=="function"){const t=this.ht??globalThis;let e=Na.get(t);e===void 0&&(e=new WeakMap,Na.set(t,e)),e.get(this.G)!==void 0&&this.G.call(this.ht,void 0),e.set(this.G,s),s!==void 0&&this.G.call(this.ht,s)}else this.G.value=s}get lt(){var s,t;return typeof this.G=="function"?(s=Na.get(this.ht??globalThis))==null?void 0:s.get(this.G):(t=this.G)==null?void 0:t.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});var x_=Object.defineProperty,C_=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&x_(t,e,n),n};const gp=class extends ls{constructor(){super(...arguments),this.world=null,this._components=null,this._viewport=vl()}set components(t){var e;if(this._components=t,this.components){const i=this.components.get(No);this.world=i.create(),this.world.name=this.name}else(e=this.world)==null||e.dispose(),this.world=null}get components(){return this._components}connectedCallback(){super.connectedCallback(),this.world&&(this.world.enabled=!0)}disconnectedCallback(){super.disconnectedCallback(),this.world&&(this.world.enabled=!1)}dispose(){this.components=null,this.remove()}firstUpdated(){const{value:t}=this._viewport;if(!(this.components&&t&&this.world))return;const e=new jl(this.components);this.world.scene=e,e.setup(),e.three.background=null;const i=new Vm(this.components,t);this.world.renderer=i;const n=new Vd(this.components);this.world.camera=n;const r=this.components.get(qd).create(this.world);r.material.uniforms.uColor.value=new bt(4342338),r.material.uniforms.uSize1.value=2,r.material.uniforms.uSize2.value=8}onSlotChange(){const t=new Event("slotchange");this.dispatchEvent(t)}render(){return ac` <bim-viewport ${w_(this._viewport)}>
      <slot @slotchange=${this.onSlotChange}></slot>
    </bim-viewport>`}};gp.styles=nc``;let bp=gp;C_([me({type:String,reflect:!0})],bp.prototype,"name");var E_=Object.defineProperty,S_=(s,t,e)=>t in s?E_(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,Ki=(s,t,e)=>(S_(s,typeof t!="symbol"?t+"":t,e),e);const Ks=Math.min,di=Math.max,Co=Math.round,Ui=s=>({x:s,y:s}),A_={left:"right",right:"left",bottom:"top",top:"bottom"},$_={start:"end",end:"start"};function Wh(s,t,e){return di(s,Ks(t,e))}function fr(s,t){return typeof s=="function"?s(t):s}function mi(s){return s.split("-")[0]}function Zo(s){return s.split("-")[1]}function yp(s){return s==="x"?"y":"x"}function vp(s){return s==="y"?"height":"width"}const T_=new Set(["top","bottom"]);function hi(s){return T_.has(mi(s))?"y":"x"}function _p(s){return yp(hi(s))}function k_(s,t,e){e===void 0&&(e=!1);const i=Zo(s),n=_p(s),r=vp(n);let o=n==="x"?i===(e?"end":"start")?"right":"left":i==="start"?"bottom":"top";return t.reference[r]>t.floating[r]&&(o=Eo(o)),[o,Eo(o)]}function P_(s){const t=Eo(s);return[_l(s),t,_l(t)]}function _l(s){return s.replace(/start|end/g,t=>$_[t])}const Yh=["left","right"],Zh=["right","left"],O_=["top","bottom"],I_=["bottom","top"];function z_(s,t,e){switch(s){case"top":case"bottom":return e?t?Zh:Yh:t?Yh:Zh;case"left":case"right":return t?O_:I_;default:return[]}}function D_(s,t,e,i){const n=Zo(s);let r=z_(mi(s),e==="start",i);return n&&(r=r.map(o=>o+"-"+n),t&&(r=r.concat(r.map(_l)))),r}function Eo(s){return s.replace(/left|right|bottom|top/g,t=>A_[t])}function M_(s){return{top:0,right:0,bottom:0,left:0,...s}}function wp(s){return typeof s!="number"?M_(s):{top:s,right:s,bottom:s,left:s}}function Js(s){const{x:t,y:e,width:i,height:n}=s;return{width:i,height:n,top:e,left:t,right:t+i,bottom:e+n,x:t,y:e}}function Xh(s,t,e){let{reference:i,floating:n}=s;const r=hi(t),o=_p(t),a=vp(o),l=mi(t),c=r==="y",h=i.x+i.width/2-n.width/2,d=i.y+i.height/2-n.height/2,p=i[a]/2-n[a]/2;let u;switch(l){case"top":u={x:h,y:i.y-n.height};break;case"bottom":u={x:h,y:i.y+i.height};break;case"right":u={x:i.x+i.width,y:d};break;case"left":u={x:i.x-n.width,y:d};break;default:u={x:i.x,y:i.y}}switch(Zo(t)){case"start":u[o]-=p*(e&&c?-1:1);break;case"end":u[o]+=p*(e&&c?-1:1);break}return u}const L_=async(s,t,e)=>{const{placement:i="bottom",strategy:n="absolute",middleware:r=[],platform:o}=e,a=r.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(t));let c=await o.getElementRects({reference:s,floating:t,strategy:n}),{x:h,y:d}=Xh(c,i,l),p=i,u={},g=0;for(let m=0;m<a.length;m++){const{name:b,fn:f}=a[m],{x:y,y:_,data:x,reset:C}=await f({x:h,y:d,initialPlacement:i,placement:p,strategy:n,middlewareData:u,rects:c,platform:o,elements:{reference:s,floating:t}});h=y??h,d=_??d,u={...u,[b]:{...u[b],...x}},C&&g<=50&&(g++,typeof C=="object"&&(C.placement&&(p=C.placement),C.rects&&(c=C.rects===!0?await o.getElementRects({reference:s,floating:t,strategy:n}):C.rects),{x:h,y:d}=Xh(c,p,l)),m=-1)}return{x:h,y:d,placement:p,strategy:n,middlewareData:u}};async function xp(s,t){var e;t===void 0&&(t={});const{x:i,y:n,platform:r,rects:o,elements:a,strategy:l}=s,{boundary:c="clippingAncestors",rootBoundary:h="viewport",elementContext:d="floating",altBoundary:p=!1,padding:u=0}=fr(t,s),g=wp(u),m=a[p?d==="floating"?"reference":"floating":d],b=Js(await r.getClippingRect({element:(e=await(r.isElement==null?void 0:r.isElement(m)))==null||e?m:m.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(a.floating)),boundary:c,rootBoundary:h,strategy:l})),f=d==="floating"?{x:i,y:n,width:o.floating.width,height:o.floating.height}:o.reference,y=await(r.getOffsetParent==null?void 0:r.getOffsetParent(a.floating)),_=await(r.isElement==null?void 0:r.isElement(y))?await(r.getScale==null?void 0:r.getScale(y))||{x:1,y:1}:{x:1,y:1},x=Js(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:f,offsetParent:y,strategy:l}):f);return{top:(b.top-x.top+g.top)/_.y,bottom:(x.bottom-b.bottom+g.bottom)/_.y,left:(b.left-x.left+g.left)/_.x,right:(x.right-b.right+g.right)/_.x}}const B_=function(s){return s===void 0&&(s={}),{name:"flip",options:s,async fn(t){var e,i;const{placement:n,middlewareData:r,rects:o,initialPlacement:a,platform:l,elements:c}=t,{mainAxis:h=!0,crossAxis:d=!0,fallbackPlacements:p,fallbackStrategy:u="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:m=!0,...b}=fr(s,t);if((e=r.arrow)!=null&&e.alignmentOffset)return{};const f=mi(n),y=hi(a),_=mi(a)===a,x=await(l.isRTL==null?void 0:l.isRTL(c.floating)),C=p||(_||!m?[Eo(a)]:P_(a)),S=g!=="none";!p&&S&&C.push(...D_(a,m,g,x));const $=[a,...C],O=await xp(t,b),z=[];let D=((i=r.flip)==null?void 0:i.overflows)||[];if(h&&z.push(O[f]),d){const v=k_(n,o,x);z.push(O[v[0]],O[v[1]])}if(D=[...D,{placement:n,overflows:z}],!z.every(v=>v<=0)){var j,A;const v=(((j=r.flip)==null?void 0:j.index)||0)+1,L=$[v];if(L&&(!(d==="alignment"&&y!==hi(L))||D.every(V=>V.overflows[0]>0&&hi(V.placement)===y)))return{data:{index:v,overflows:D},reset:{placement:L}};let X=(A=D.filter(V=>V.overflows[0]<=0).sort((V,J)=>V.overflows[1]-J.overflows[1])[0])==null?void 0:A.placement;if(!X)switch(u){case"bestFit":{var k;const V=(k=D.filter(J=>{if(S){const Y=hi(J.placement);return Y===y||Y==="y"}return!0}).map(J=>[J.placement,J.overflows.filter(Y=>Y>0).reduce((Y,nt)=>Y+nt,0)]).sort((J,Y)=>J[1]-Y[1])[0])==null?void 0:k[0];V&&(X=V);break}case"initialPlacement":X=a;break}if(n!==X)return{reset:{placement:X}}}return{}}}};function Cp(s){const t=Ks(...s.map(r=>r.left)),e=Ks(...s.map(r=>r.top)),i=di(...s.map(r=>r.right)),n=di(...s.map(r=>r.bottom));return{x:t,y:e,width:i-t,height:n-e}}function N_(s){const t=s.slice().sort((n,r)=>n.y-r.y),e=[];let i=null;for(let n=0;n<t.length;n++){const r=t[n];!i||r.y-i.y>i.height/2?e.push([r]):e[e.length-1].push(r),i=r}return e.map(n=>Js(Cp(n)))}const U_=function(s){return s===void 0&&(s={}),{name:"inline",options:s,async fn(t){const{placement:e,elements:i,rects:n,platform:r,strategy:o}=t,{padding:a=2,x:l,y:c}=fr(s,t),h=Array.from(await(r.getClientRects==null?void 0:r.getClientRects(i.reference))||[]),d=N_(h),p=Js(Cp(h)),u=wp(a);function g(){if(d.length===2&&d[0].left>d[1].right&&l!=null&&c!=null)return d.find(b=>l>b.left-u.left&&l<b.right+u.right&&c>b.top-u.top&&c<b.bottom+u.bottom)||p;if(d.length>=2){if(hi(e)==="y"){const D=d[0],j=d[d.length-1],A=mi(e)==="top",k=D.top,v=j.bottom,L=A?D.left:j.left,X=A?D.right:j.right,V=X-L,J=v-k;return{top:k,bottom:v,left:L,right:X,width:V,height:J,x:L,y:k}}const b=mi(e)==="left",f=di(...d.map(D=>D.right)),y=Ks(...d.map(D=>D.left)),_=d.filter(D=>b?D.left===y:D.right===f),x=_[0].top,C=_[_.length-1].bottom,S=y,$=f,O=$-S,z=C-x;return{top:x,bottom:C,left:S,right:$,width:O,height:z,x:S,y:x}}return p}const m=await r.getElementRects({reference:{getBoundingClientRect:g},floating:i.floating,strategy:o});return n.reference.x!==m.reference.x||n.reference.y!==m.reference.y||n.reference.width!==m.reference.width||n.reference.height!==m.reference.height?{reset:{rects:m}}:{}}}},R_=new Set(["left","top"]);async function F_(s,t){const{placement:e,platform:i,elements:n}=s,r=await(i.isRTL==null?void 0:i.isRTL(n.floating)),o=mi(e),a=Zo(e),l=hi(e)==="y",c=R_.has(o)?-1:1,h=r&&l?-1:1,d=fr(t,s);let{mainAxis:p,crossAxis:u,alignmentAxis:g}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof g=="number"&&(u=a==="end"?g*-1:g),l?{x:u*h,y:p*c}:{x:p*c,y:u*h}}const Ep=function(s){return{name:"offset",options:s,async fn(t){var e,i;const{x:n,y:r,placement:o,middlewareData:a}=t,l=await F_(t,s);return o===((e=a.offset)==null?void 0:e.placement)&&(i=a.arrow)!=null&&i.alignmentOffset?{}:{x:n+l.x,y:r+l.y,data:{...l,placement:o}}}}},j_=function(s){return s===void 0&&(s={}),{name:"shift",options:s,async fn(t){const{x:e,y:i,placement:n}=t,{mainAxis:r=!0,crossAxis:o=!1,limiter:a={fn:b=>{let{x:f,y}=b;return{x:f,y}}},...l}=fr(s,t),c={x:e,y:i},h=await xp(t,l),d=hi(mi(n)),p=yp(d);let u=c[p],g=c[d];if(r){const b=p==="y"?"top":"left",f=p==="y"?"bottom":"right",y=u+h[b],_=u-h[f];u=Wh(y,u,_)}if(o){const b=d==="y"?"top":"left",f=d==="y"?"bottom":"right",y=g+h[b],_=g-h[f];g=Wh(y,g,_)}const m=a.fn({...t,[p]:u,[d]:g});return{...m,data:{x:m.x-e,y:m.y-i,enabled:{[p]:r,[d]:o}}}}}};function Xo(){return typeof window<"u"}function Ri(s){return Sp(s)?(s.nodeName||"").toLowerCase():"#document"}function Ce(s){var t;return(s==null||(t=s.ownerDocument)==null?void 0:t.defaultView)||window}function Vi(s){var t;return(t=(Sp(s)?s.ownerDocument:s.document)||window.document)==null?void 0:t.documentElement}function Sp(s){return Xo()?s instanceof Node||s instanceof Ce(s).Node:!1}function ni(s){return Xo()?s instanceof Element||s instanceof Ce(s).Element:!1}function ri(s){return Xo()?s instanceof HTMLElement||s instanceof Ce(s).HTMLElement:!1}function Gh(s){return!Xo()||typeof ShadowRoot>"u"?!1:s instanceof ShadowRoot||s instanceof Ce(s).ShadowRoot}const H_=new Set(["inline","contents"]);function mr(s){const{overflow:t,overflowX:e,overflowY:i,display:n}=Me(s);return/auto|scroll|overlay|hidden|clip/.test(t+i+e)&&!H_.has(n)}const V_=new Set(["table","td","th"]);function q_(s){return V_.has(Ri(s))}const W_=[":popover-open",":modal"];function Y_(s){return W_.some(t=>{try{return s.matches(t)}catch{return!1}})}const Z_=["transform","translate","scale","rotate","perspective"],X_=["transform","translate","scale","rotate","perspective","filter"],G_=["paint","layout","strict","content"];function cc(s){const t=hc(),e=ni(s)?Me(s):s;return Z_.some(i=>e[i]?e[i]!=="none":!1)||(e.containerType?e.containerType!=="normal":!1)||!t&&(e.backdropFilter?e.backdropFilter!=="none":!1)||!t&&(e.filter?e.filter!=="none":!1)||X_.some(i=>(e.willChange||"").includes(i))||G_.some(i=>(e.contain||"").includes(i))}function Q_(s){let t=tn(s);for(;ri(t)&&!Go(t);){if(cc(t))return t;if(Y_(t))return null;t=tn(t)}return null}function hc(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const K_=new Set(["html","body","#document"]);function Go(s){return K_.has(Ri(s))}function Me(s){return Ce(s).getComputedStyle(s)}function Qo(s){return ni(s)?{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}:{scrollLeft:s.scrollX,scrollTop:s.scrollY}}function tn(s){if(Ri(s)==="html")return s;const t=s.assignedSlot||s.parentNode||Gh(s)&&s.host||Vi(s);return Gh(t)?t.host:t}function Ap(s){const t=tn(s);return Go(t)?s.ownerDocument?s.ownerDocument.body:s.body:ri(t)&&mr(t)?t:Ap(t)}function $p(s,t,e){var i;t===void 0&&(t=[]);const n=Ap(s),r=n===((i=s.ownerDocument)==null?void 0:i.body),o=Ce(n);return r?(J_(o),t.concat(o,o.visualViewport||[],mr(n)?n:[],[])):t.concat(n,$p(n,[]))}function J_(s){return s.parent&&Object.getPrototypeOf(s.parent)?s.frameElement:null}function Tp(s){const t=Me(s);let e=parseFloat(t.width)||0,i=parseFloat(t.height)||0;const n=ri(s),r=n?s.offsetWidth:e,o=n?s.offsetHeight:i,a=Co(e)!==r||Co(i)!==o;return a&&(e=r,i=o),{width:e,height:i,$:a}}function kp(s){return ni(s)?s:s.contextElement}function js(s){const t=kp(s);if(!ri(t))return Ui(1);const e=t.getBoundingClientRect(),{width:i,height:n,$:r}=Tp(t);let o=(r?Co(e.width):e.width)/i,a=(r?Co(e.height):e.height)/n;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const t0=Ui(0);function Pp(s){const t=Ce(s);return!hc()||!t.visualViewport?t0:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function e0(s,t,e){return t===void 0&&(t=!1),!e||t&&e!==Ce(s)?!1:t}function sr(s,t,e,i){t===void 0&&(t=!1),e===void 0&&(e=!1);const n=s.getBoundingClientRect(),r=kp(s);let o=Ui(1);t&&(i?ni(i)&&(o=js(i)):o=js(s));const a=e0(r,e,i)?Pp(r):Ui(0);let l=(n.left+a.x)/o.x,c=(n.top+a.y)/o.y,h=n.width/o.x,d=n.height/o.y;if(r){const p=Ce(r),u=i&&ni(i)?Ce(i):i;let g=p,m=g.frameElement;for(;m&&i&&u!==g;){const b=js(m),f=m.getBoundingClientRect(),y=Me(m),_=f.left+(m.clientLeft+parseFloat(y.paddingLeft))*b.x,x=f.top+(m.clientTop+parseFloat(y.paddingTop))*b.y;l*=b.x,c*=b.y,h*=b.x,d*=b.y,l+=_,c+=x,g=Ce(m),m=g.frameElement}}return Js({width:h,height:d,x:l,y:c})}const i0=[":popover-open",":modal"];function Op(s){return i0.some(t=>{try{return s.matches(t)}catch{return!1}})}function s0(s){let{elements:t,rect:e,offsetParent:i,strategy:n}=s;const r=n==="fixed",o=Vi(i),a=t?Op(t.floating):!1;if(i===o||a&&r)return e;let l={scrollLeft:0,scrollTop:0},c=Ui(1);const h=Ui(0),d=ri(i);if((d||!d&&!r)&&((Ri(i)!=="body"||mr(o))&&(l=Qo(i)),ri(i))){const p=sr(i);c=js(i),h.x=p.x+i.clientLeft,h.y=p.y+i.clientTop}return{width:e.width*c.x,height:e.height*c.y,x:e.x*c.x-l.scrollLeft*c.x+h.x,y:e.y*c.y-l.scrollTop*c.y+h.y}}function n0(s){return Array.from(s.getClientRects())}function Ip(s){return sr(Vi(s)).left+Qo(s).scrollLeft}function r0(s){const t=Vi(s),e=Qo(s),i=s.ownerDocument.body,n=di(t.scrollWidth,t.clientWidth,i.scrollWidth,i.clientWidth),r=di(t.scrollHeight,t.clientHeight,i.scrollHeight,i.clientHeight);let o=-e.scrollLeft+Ip(s);const a=-e.scrollTop;return Me(i).direction==="rtl"&&(o+=di(t.clientWidth,i.clientWidth)-n),{width:n,height:r,x:o,y:a}}function o0(s,t){const e=Ce(s),i=Vi(s),n=e.visualViewport;let r=i.clientWidth,o=i.clientHeight,a=0,l=0;if(n){r=n.width,o=n.height;const c=hc();(!c||c&&t==="fixed")&&(a=n.offsetLeft,l=n.offsetTop)}return{width:r,height:o,x:a,y:l}}function a0(s,t){const e=sr(s,!0,t==="fixed"),i=e.top+s.clientTop,n=e.left+s.clientLeft,r=ri(s)?js(s):Ui(1),o=s.clientWidth*r.x,a=s.clientHeight*r.y,l=n*r.x,c=i*r.y;return{width:o,height:a,x:l,y:c}}function Qh(s,t,e){let i;if(t==="viewport")i=o0(s,e);else if(t==="document")i=r0(Vi(s));else if(ni(t))i=a0(t,e);else{const n=Pp(s);i={...t,x:t.x-n.x,y:t.y-n.y}}return Js(i)}function zp(s,t){const e=tn(s);return e===t||!ni(e)||Go(e)?!1:Me(e).position==="fixed"||zp(e,t)}function l0(s,t){const e=t.get(s);if(e)return e;let i=$p(s,[]).filter(a=>ni(a)&&Ri(a)!=="body"),n=null;const r=Me(s).position==="fixed";let o=r?tn(s):s;for(;ni(o)&&!Go(o);){const a=Me(o),l=cc(o);!l&&a.position==="fixed"&&(n=null),(r?!l&&!n:!l&&a.position==="static"&&n&&["absolute","fixed"].includes(n.position)||mr(o)&&!l&&zp(s,o))?i=i.filter(c=>c!==o):n=a,o=tn(o)}return t.set(s,i),i}function c0(s){let{element:t,boundary:e,rootBoundary:i,strategy:n}=s;const r=[...e==="clippingAncestors"?l0(t,this._c):[].concat(e),i],o=r[0],a=r.reduce((l,c)=>{const h=Qh(t,c,n);return l.top=di(h.top,l.top),l.right=Ks(h.right,l.right),l.bottom=Ks(h.bottom,l.bottom),l.left=di(h.left,l.left),l},Qh(t,o,n));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function h0(s){const{width:t,height:e}=Tp(s);return{width:t,height:e}}function d0(s,t,e){const i=ri(t),n=Vi(t),r=e==="fixed",o=sr(s,!0,r,t);let a={scrollLeft:0,scrollTop:0};const l=Ui(0);if(i||!i&&!r)if((Ri(t)!=="body"||mr(n))&&(a=Qo(t)),i){const d=sr(t,!0,r,t);l.x=d.x+t.clientLeft,l.y=d.y+t.clientTop}else n&&(l.x=Ip(n));const c=o.left+a.scrollLeft-l.x,h=o.top+a.scrollTop-l.y;return{x:c,y:h,width:o.width,height:o.height}}function Kh(s,t){return!ri(s)||Me(s).position==="fixed"?null:t?t(s):s.offsetParent}function Dp(s,t){const e=Ce(s);if(!ri(s)||Op(s))return e;let i=Kh(s,t);for(;i&&q_(i)&&Me(i).position==="static";)i=Kh(i,t);return i&&(Ri(i)==="html"||Ri(i)==="body"&&Me(i).position==="static"&&!cc(i))?e:i||Q_(s)||e}const u0=async function(s){const t=this.getOffsetParent||Dp,e=this.getDimensions;return{reference:d0(s.reference,await t(s.floating),s.strategy),floating:{x:0,y:0,...await e(s.floating)}}};function p0(s){return Me(s).direction==="rtl"}const f0={convertOffsetParentRelativeRectToViewportRelativeRect:s0,getDocumentElement:Vi,getClippingRect:c0,getOffsetParent:Dp,getElementRects:u0,getClientRects:n0,getDimensions:h0,getScale:js,isElement:ni,isRTL:p0},Mp=j_,Lp=B_,Bp=U_,Np=(s,t,e)=>{const i=new Map,n={platform:f0,...e},r={...n.platform,_c:i};return L_(s,t,{...n,platform:r})};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ho=globalThis,dc=ho.ShadowRoot&&(ho.ShadyCSS===void 0||ho.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,uc=Symbol(),Jh=new WeakMap;let Up=class{constructor(s,t,e){if(this._$cssResult$=!0,e!==uc)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=s,this.t=t}get styleSheet(){let s=this.o;const t=this.t;if(dc&&s===void 0){const e=t!==void 0&&t.length===1;e&&(s=Jh.get(t)),s===void 0&&((this.o=s=new CSSStyleSheet).replaceSync(this.cssText),e&&Jh.set(t,s))}return s}toString(){return this.cssText}};const m0=s=>new Up(typeof s=="string"?s:s+"",void 0,uc),At=(s,...t)=>{const e=s.length===1?s[0]:t.reduce((i,n,r)=>i+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+s[r+1],s[0]);return new Up(e,s,uc)},g0=(s,t)=>{if(dc)s.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const e of t){const i=document.createElement("style"),n=ho.litNonce;n!==void 0&&i.setAttribute("nonce",n),i.textContent=e.cssText,s.appendChild(i)}},td=dc?s=>s:s=>s instanceof CSSStyleSheet?(t=>{let e="";for(const i of t.cssRules)e+=i.cssText;return m0(e)})(s):s;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:b0,defineProperty:y0,getOwnPropertyDescriptor:v0,getOwnPropertyNames:_0,getOwnPropertySymbols:w0,getPrototypeOf:x0}=Object,en=globalThis,ed=en.trustedTypes,C0=ed?ed.emptyScript:"",id=en.reactiveElementPolyfillSupport,Zn=(s,t)=>s,So={toAttribute(s,t){switch(t){case Boolean:s=s?C0:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,t){let e=s;switch(t){case Boolean:e=s!==null;break;case Number:e=s===null?null:Number(s);break;case Object:case Array:try{e=JSON.parse(s)}catch{e=null}}return e}},pc=(s,t)=>!b0(s,t),sd={attribute:!0,type:String,converter:So,reflect:!1,useDefault:!1,hasChanged:pc};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),en.litPropertyMetadata??(en.litPropertyMetadata=new WeakMap);let Bs=class extends HTMLElement{static addInitializer(s){this._$Ei(),(this.l??(this.l=[])).push(s)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(s,t=sd){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(s)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(s,t),!t.noAccessor){const e=Symbol(),i=this.getPropertyDescriptor(s,e,t);i!==void 0&&y0(this.prototype,s,i)}}static getPropertyDescriptor(s,t,e){const{get:i,set:n}=v0(this.prototype,s)??{get(){return this[t]},set(r){this[t]=r}};return{get:i,set(r){const o=i==null?void 0:i.call(this);n==null||n.call(this,r),this.requestUpdate(s,o,e)},configurable:!0,enumerable:!0}}static getPropertyOptions(s){return this.elementProperties.get(s)??sd}static _$Ei(){if(this.hasOwnProperty(Zn("elementProperties")))return;const s=x0(this);s.finalize(),s.l!==void 0&&(this.l=[...s.l]),this.elementProperties=new Map(s.elementProperties)}static finalize(){if(this.hasOwnProperty(Zn("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Zn("properties"))){const t=this.properties,e=[..._0(t),...w0(t)];for(const i of e)this.createProperty(i,t[i])}const s=this[Symbol.metadata];if(s!==null){const t=litPropertyMetadata.get(s);if(t!==void 0)for(const[e,i]of t)this.elementProperties.set(e,i)}this._$Eh=new Map;for(const[t,e]of this.elementProperties){const i=this._$Eu(t,e);i!==void 0&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(s){const t=[];if(Array.isArray(s)){const e=new Set(s.flat(1/0).reverse());for(const i of e)t.unshift(td(i))}else s!==void 0&&t.push(td(s));return t}static _$Eu(s,t){const e=t.attribute;return e===!1?void 0:typeof e=="string"?e:typeof s=="string"?s.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var s;this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(s=this.constructor.l)==null||s.forEach(t=>t(this))}addController(s){var t;(this._$EO??(this._$EO=new Set)).add(s),this.renderRoot!==void 0&&this.isConnected&&((t=s.hostConnected)==null||t.call(s))}removeController(s){var t;(t=this._$EO)==null||t.delete(s)}_$E_(){const s=new Map,t=this.constructor.elementProperties;for(const e of t.keys())this.hasOwnProperty(e)&&(s.set(e,this[e]),delete this[e]);s.size>0&&(this._$Ep=s)}createRenderRoot(){const s=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return g0(s,this.constructor.elementStyles),s}connectedCallback(){var s;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(s=this._$EO)==null||s.forEach(t=>{var e;return(e=t.hostConnected)==null?void 0:e.call(t)})}enableUpdating(s){}disconnectedCallback(){var s;(s=this._$EO)==null||s.forEach(t=>{var e;return(e=t.hostDisconnected)==null?void 0:e.call(t)})}attributeChangedCallback(s,t,e){this._$AK(s,e)}_$ET(s,t){var e;const i=this.constructor.elementProperties.get(s),n=this.constructor._$Eu(s,i);if(n!==void 0&&i.reflect===!0){const r=(((e=i.converter)==null?void 0:e.toAttribute)!==void 0?i.converter:So).toAttribute(t,i.type);this._$Em=s,r==null?this.removeAttribute(n):this.setAttribute(n,r),this._$Em=null}}_$AK(s,t){var e,i;const n=this.constructor,r=n._$Eh.get(s);if(r!==void 0&&this._$Em!==r){const o=n.getPropertyOptions(r),a=typeof o.converter=="function"?{fromAttribute:o.converter}:((e=o.converter)==null?void 0:e.fromAttribute)!==void 0?o.converter:So;this._$Em=r,this[r]=a.fromAttribute(t,o.type)??((i=this._$Ej)==null?void 0:i.get(r))??null,this._$Em=null}}requestUpdate(s,t,e){var i;if(s!==void 0){const n=this.constructor,r=this[s];if(e??(e=n.getPropertyOptions(s)),!((e.hasChanged??pc)(r,t)||e.useDefault&&e.reflect&&r===((i=this._$Ej)==null?void 0:i.get(s))&&!this.hasAttribute(n._$Eu(s,e))))return;this.C(s,t,e)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(s,t,{useDefault:e,reflect:i,wrapped:n},r){e&&!(this._$Ej??(this._$Ej=new Map)).has(s)&&(this._$Ej.set(s,r??t??this[s]),n!==!0||r!==void 0)||(this._$AL.has(s)||(this.hasUpdated||e||(t=void 0),this._$AL.set(s,t)),i===!0&&this._$Em!==s&&(this._$Eq??(this._$Eq=new Set)).add(s))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const s=this.scheduleUpdate();return s!=null&&await s,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var s;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[n,r]of this._$Ep)this[n]=r;this._$Ep=void 0}const i=this.constructor.elementProperties;if(i.size>0)for(const[n,r]of i){const{wrapped:o}=r,a=this[n];o!==!0||this._$AL.has(n)||a===void 0||this.C(n,void 0,r,a)}}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),(s=this._$EO)==null||s.forEach(i=>{var n;return(n=i.hostUpdate)==null?void 0:n.call(i)}),this.update(e)):this._$EM()}catch(i){throw t=!1,this._$EM(),i}t&&this._$AE(e)}willUpdate(s){}_$AE(s){var t;(t=this._$EO)==null||t.forEach(e=>{var i;return(i=e.hostUpdated)==null?void 0:i.call(e)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(s)),this.updated(s)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(s){return!0}update(s){this._$Eq&&(this._$Eq=this._$Eq.forEach(t=>this._$ET(t,this[t]))),this._$EM()}updated(s){}firstUpdated(s){}};Bs.elementStyles=[],Bs.shadowRootOptions={mode:"open"},Bs[Zn("elementProperties")]=new Map,Bs[Zn("finalized")]=new Map,id==null||id({ReactiveElement:Bs}),(en.reactiveElementVersions??(en.reactiveElementVersions=[])).push("2.1.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ao=globalThis,$o=Ao.trustedTypes,nd=$o?$o.createPolicy("lit-html",{createHTML:s=>s}):void 0,Rp="$lit$",ki=`lit$${Math.random().toFixed(9).slice(2)}$`,Fp="?"+ki,E0=`<${Fp}>`,ds=document,nr=()=>ds.createComment(""),rr=s=>s===null||typeof s!="object"&&typeof s!="function",fc=Array.isArray,S0=s=>fc(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",Ua=`[ 	
\f\r]`,Bn=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,rd=/-->/g,od=/>/g,Ji=RegExp(`>|${Ua}(?:([^\\s"'>=/]+)(${Ua}*=${Ua}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),ad=/'/g,ld=/"/g,jp=/^(?:script|style|textarea|title)$/i,A0=s=>(t,...e)=>({_$litType$:s,strings:t,values:e}),H=A0(1),us=Symbol.for("lit-noChange"),It=Symbol.for("lit-nothing"),cd=new WeakMap,ss=ds.createTreeWalker(ds,129);function Hp(s,t){if(!fc(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return nd!==void 0?nd.createHTML(t):t}const $0=(s,t)=>{const e=s.length-1,i=[];let n,r=t===2?"<svg>":t===3?"<math>":"",o=Bn;for(let a=0;a<e;a++){const l=s[a];let c,h,d=-1,p=0;for(;p<l.length&&(o.lastIndex=p,h=o.exec(l),h!==null);)p=o.lastIndex,o===Bn?h[1]==="!--"?o=rd:h[1]!==void 0?o=od:h[2]!==void 0?(jp.test(h[2])&&(n=RegExp("</"+h[2],"g")),o=Ji):h[3]!==void 0&&(o=Ji):o===Ji?h[0]===">"?(o=n??Bn,d=-1):h[1]===void 0?d=-2:(d=o.lastIndex-h[2].length,c=h[1],o=h[3]===void 0?Ji:h[3]==='"'?ld:ad):o===ld||o===ad?o=Ji:o===rd||o===od?o=Bn:(o=Ji,n=void 0);const u=o===Ji&&s[a+1].startsWith("/>")?" ":"";r+=o===Bn?l+E0:d>=0?(i.push(c),l.slice(0,d)+Rp+l.slice(d)+ki+u):l+ki+(d===-2?a:u)}return[Hp(s,r+(s[e]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),i]};class or{constructor({strings:t,_$litType$:e},i){let n;this.parts=[];let r=0,o=0;const a=t.length-1,l=this.parts,[c,h]=$0(t,e);if(this.el=or.createElement(c,i),ss.currentNode=this.el.content,e===2||e===3){const d=this.el.content.firstChild;d.replaceWith(...d.childNodes)}for(;(n=ss.nextNode())!==null&&l.length<a;){if(n.nodeType===1){if(n.hasAttributes())for(const d of n.getAttributeNames())if(d.endsWith(Rp)){const p=h[o++],u=n.getAttribute(d).split(ki),g=/([.?@])?(.*)/.exec(p);l.push({type:1,index:r,name:g[2],strings:u,ctor:g[1]==="."?k0:g[1]==="?"?P0:g[1]==="@"?O0:Ko}),n.removeAttribute(d)}else d.startsWith(ki)&&(l.push({type:6,index:r}),n.removeAttribute(d));if(jp.test(n.tagName)){const d=n.textContent.split(ki),p=d.length-1;if(p>0){n.textContent=$o?$o.emptyScript:"";for(let u=0;u<p;u++)n.append(d[u],nr()),ss.nextNode(),l.push({type:2,index:++r});n.append(d[p],nr())}}}else if(n.nodeType===8)if(n.data===Fp)l.push({type:2,index:r});else{let d=-1;for(;(d=n.data.indexOf(ki,d+1))!==-1;)l.push({type:7,index:r}),d+=ki.length-1}r++}}static createElement(t,e){const i=ds.createElement("template");return i.innerHTML=t,i}}function sn(s,t,e=s,i){var n,r;if(t===us)return t;let o=i!==void 0?(n=e._$Co)==null?void 0:n[i]:e._$Cl;const a=rr(t)?void 0:t._$litDirective$;return(o==null?void 0:o.constructor)!==a&&((r=o==null?void 0:o._$AO)==null||r.call(o,!1),a===void 0?o=void 0:(o=new a(s),o._$AT(s,e,i)),i!==void 0?(e._$Co??(e._$Co=[]))[i]=o:e._$Cl=o),o!==void 0&&(t=sn(s,o._$AS(s,t.values),o,i)),t}class T0{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:i}=this._$AD,n=((t==null?void 0:t.creationScope)??ds).importNode(e,!0);ss.currentNode=n;let r=ss.nextNode(),o=0,a=0,l=i[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new gr(r,r.nextSibling,this,t):l.type===1?c=new l.ctor(r,l.name,l.strings,this,t):l.type===6&&(c=new I0(r,this,t)),this._$AV.push(c),l=i[++a]}o!==(l==null?void 0:l.index)&&(r=ss.nextNode(),o++)}return ss.currentNode=ds,n}p(t){let e=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}}class gr{get _$AU(){var t;return((t=this._$AM)==null?void 0:t._$AU)??this._$Cv}constructor(t,e,i,n){this.type=2,this._$AH=It,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=n,this._$Cv=(n==null?void 0:n.isConnected)??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=sn(this,t,e),rr(t)?t===It||t==null||t===""?(this._$AH!==It&&this._$AR(),this._$AH=It):t!==this._$AH&&t!==us&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):S0(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==It&&rr(this._$AH)?this._$AA.nextSibling.data=t:this.T(ds.createTextNode(t)),this._$AH=t}$(t){var e;const{values:i,_$litType$:n}=t,r=typeof n=="number"?this._$AC(t):(n.el===void 0&&(n.el=or.createElement(Hp(n.h,n.h[0]),this.options)),n);if(((e=this._$AH)==null?void 0:e._$AD)===r)this._$AH.p(i);else{const o=new T0(r,this),a=o.u(this.options);o.p(i),this.T(a),this._$AH=o}}_$AC(t){let e=cd.get(t.strings);return e===void 0&&cd.set(t.strings,e=new or(t)),e}k(t){fc(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,n=0;for(const r of t)n===e.length?e.push(i=new gr(this.O(nr()),this.O(nr()),this,this.options)):i=e[n],i._$AI(r),n++;n<e.length&&(this._$AR(i&&i._$AB.nextSibling,n),e.length=n)}_$AR(t=this._$AA.nextSibling,e){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,e);t&&t!==this._$AB;){const n=t.nextSibling;t.remove(),t=n}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}}class Ko{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,i,n,r){this.type=1,this._$AH=It,this._$AN=void 0,this.element=t,this.name=e,this._$AM=n,this.options=r,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=It}_$AI(t,e=this,i,n){const r=this.strings;let o=!1;if(r===void 0)t=sn(this,t,e,0),o=!rr(t)||t!==this._$AH&&t!==us,o&&(this._$AH=t);else{const a=t;let l,c;for(t=r[0],l=0;l<r.length-1;l++)c=sn(this,a[i+l],e,l),c===us&&(c=this._$AH[l]),o||(o=!rr(c)||c!==this._$AH[l]),c===It?t=It:t!==It&&(t+=(c??"")+r[l+1]),this._$AH[l]=c}o&&!n&&this.j(t)}j(t){t===It?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class k0 extends Ko{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===It?void 0:t}}class P0 extends Ko{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==It)}}class O0 extends Ko{constructor(t,e,i,n,r){super(t,e,i,n,r),this.type=5}_$AI(t,e=this){if((t=sn(this,t,e,0)??It)===us)return;const i=this._$AH,n=t===It&&i!==It||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,r=t!==It&&(i===It||n);n&&this.element.removeEventListener(this.name,this,i),r&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e;typeof this._$AH=="function"?this._$AH.call(((e=this.options)==null?void 0:e.host)??this.element,t):this._$AH.handleEvent(t)}}class I0{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){sn(this,t)}}const hd=Ao.litHtmlPolyfillSupport;hd==null||hd(or,gr),(Ao.litHtmlVersions??(Ao.litHtmlVersions=[])).push("3.3.0");const wl=(s,t,e)=>{const i=(e==null?void 0:e.renderBefore)??t;let n=i._$litPart$;if(n===void 0){const r=(e==null?void 0:e.renderBefore)??null;i._$litPart$=n=new gr(t.insertBefore(nr(),r),r,void 0,e??{})}return n._$AI(s),n};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ar=globalThis;let Ct=class extends Bs{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var s;const t=super.createRenderRoot();return(s=this.renderOptions).renderBefore??(s.renderBefore=t.firstChild),t}update(s){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(s),this._$Do=wl(t,this.renderRoot,this.renderOptions)}connectedCallback(){var s;super.connectedCallback(),(s=this._$Do)==null||s.setConnected(!0)}disconnectedCallback(){var s;super.disconnectedCallback(),(s=this._$Do)==null||s.setConnected(!1)}render(){return us}};var dd;Ct._$litElement$=!0,Ct.finalized=!0,(dd=ar.litElementHydrateSupport)==null||dd.call(ar,{LitElement:Ct});const ud=ar.litElementPolyfillSupport;ud==null||ud({LitElement:Ct});(ar.litElementVersions??(ar.litElementVersions=[])).push("4.2.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const z0={attribute:!0,type:String,converter:So,reflect:!1,hasChanged:pc},D0=(s=z0,t,e)=>{const{kind:i,metadata:n}=e;let r=globalThis.litPropertyMetadata.get(n);if(r===void 0&&globalThis.litPropertyMetadata.set(n,r=new Map),i==="setter"&&((s=Object.create(s)).wrapped=!0),r.set(e.name,s),i==="accessor"){const{name:o}=e;return{set(a){const l=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,l,s)},init(a){return a!==void 0&&this.C(o,void 0,s,a),a}}}if(i==="setter"){const{name:o}=e;return function(a){const l=this[o];t.call(this,a),this.requestUpdate(o,l,s)}}throw Error("Unsupported decorator location: "+i)};function W(s){return(t,e)=>typeof e=="object"?D0(s,t,e):((i,n,r)=>{const o=n.hasOwnProperty(r);return n.constructor.createProperty(r,i),o?Object.getOwnPropertyDescriptor(n,r):void 0})(s,t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function ps(s){return W({...s,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const M0=s=>s.strings===void 0;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Vp={ATTRIBUTE:1,CHILD:2},qp=s=>(...t)=>({_$litDirective$:s,values:t});let Wp=class{constructor(s){}get _$AU(){return this._$AM._$AU}_$AT(s,t,e){this._$Ct=s,this._$AM=t,this._$Ci=e}_$AS(s,t){return this.update(s,t)}update(s,t){return this.render(...t)}};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Xn=(s,t)=>{var e;const i=s._$AN;if(i===void 0)return!1;for(const n of i)(e=n._$AO)==null||e.call(n,t,!1),Xn(n,t);return!0},To=s=>{let t,e;do{if((t=s._$AM)===void 0)break;e=t._$AN,e.delete(s),s=t}while((e==null?void 0:e.size)===0)},Yp=s=>{for(let t;t=s._$AM;s=t){let e=t._$AN;if(e===void 0)t._$AN=e=new Set;else if(e.has(s))break;e.add(s),N0(t)}};function L0(s){this._$AN!==void 0?(To(this),this._$AM=s,Yp(this)):this._$AM=s}function B0(s,t=!1,e=0){const i=this._$AH,n=this._$AN;if(n!==void 0&&n.size!==0)if(t)if(Array.isArray(i))for(let r=e;r<i.length;r++)Xn(i[r],!1),To(i[r]);else i!=null&&(Xn(i,!1),To(i));else Xn(this,s)}const N0=s=>{s.type==Vp.CHILD&&(s._$AP??(s._$AP=B0),s._$AQ??(s._$AQ=L0))};class U0 extends Wp{constructor(){super(...arguments),this._$AN=void 0}_$AT(t,e,i){super._$AT(t,e,i),Yp(this),this.isConnected=t._$AU}_$AO(t,e=!0){var i,n;t!==this.isConnected&&(this.isConnected=t,t?(i=this.reconnected)==null||i.call(this):(n=this.disconnected)==null||n.call(this)),e&&(Xn(this,t),To(this))}setValue(t){if(M0(this._$Ct))this._$Ct._$AI(t,this);else{const e=[...this._$Ct._$AH];e[this._$Ci]=t,this._$Ct._$AI(e,this,0)}}disconnected(){}reconnected(){}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const nn=()=>new R0;class R0{}const Ra=new WeakMap,Qt=qp(class extends U0{render(s){return It}update(s,[t]){var e;const i=t!==this.G;return i&&this.G!==void 0&&this.rt(void 0),(i||this.lt!==this.ct)&&(this.G=t,this.ht=(e=s.options)==null?void 0:e.host,this.rt(this.ct=s.element)),It}rt(s){if(this.isConnected||(s=void 0),typeof this.G=="function"){const t=this.ht??globalThis;let e=Ra.get(t);e===void 0&&(e=new WeakMap,Ra.set(t,e)),e.get(this.G)!==void 0&&this.G.call(this.ht,void 0),e.set(this.G,s),s!==void 0&&this.G.call(this.ht,s)}else this.G.value=s}get lt(){var s,t;return typeof this.G=="function"?(s=Ra.get(this.ht??globalThis))==null?void 0:s.get(this.G):(t=this.G)==null?void 0:t.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});/**
* (c) Iconify
*
* For the full copyright and license information, please view the license.txt
* files at https://github.com/iconify/iconify
*
* Licensed under MIT.
*
* @license MIT
* @version 2.0.0
*/const Zp=Object.freeze({left:0,top:0,width:16,height:16}),ko=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),br=Object.freeze({...Zp,...ko}),xl=Object.freeze({...br,body:"",hidden:!1}),F0=Object.freeze({width:null,height:null}),Xp=Object.freeze({...F0,...ko});function j0(s,t=0){const e=s.replace(/^-?[0-9.]*/,"");function i(n){for(;n<0;)n+=4;return n%4}if(e===""){const n=parseInt(s);return isNaN(n)?0:i(n)}else if(e!==s){let n=0;switch(e){case"%":n=25;break;case"deg":n=90}if(n){let r=parseFloat(s.slice(0,s.length-e.length));return isNaN(r)?0:(r=r/n,r%1===0?i(r):0)}}return t}const H0=/[\s,]+/;function V0(s,t){t.split(H0).forEach(e=>{switch(e.trim()){case"horizontal":s.hFlip=!0;break;case"vertical":s.vFlip=!0;break}})}const Gp={...Xp,preserveAspectRatio:""};function pd(s){const t={...Gp},e=(i,n)=>s.getAttribute(i)||n;return t.width=e("width",null),t.height=e("height",null),t.rotate=j0(e("rotate","")),V0(t,e("flip","")),t.preserveAspectRatio=e("preserveAspectRatio",e("preserveaspectratio","")),t}function q0(s,t){for(const e in Gp)if(s[e]!==t[e])return!0;return!1}const Gn=/^[a-z0-9]+(-[a-z0-9]+)*$/,yr=(s,t,e,i="")=>{const n=s.split(":");if(s.slice(0,1)==="@"){if(n.length<2||n.length>3)return null;i=n.shift().slice(1)}if(n.length>3||!n.length)return null;if(n.length>1){const a=n.pop(),l=n.pop(),c={provider:n.length>0?n[0]:i,prefix:l,name:a};return t&&!uo(c)?null:c}const r=n[0],o=r.split("-");if(o.length>1){const a={provider:i,prefix:o.shift(),name:o.join("-")};return t&&!uo(a)?null:a}if(e&&i===""){const a={provider:i,prefix:"",name:r};return t&&!uo(a,e)?null:a}return null},uo=(s,t)=>s?!!((s.provider===""||s.provider.match(Gn))&&(t&&s.prefix===""||s.prefix.match(Gn))&&s.name.match(Gn)):!1;function W0(s,t){const e={};!s.hFlip!=!t.hFlip&&(e.hFlip=!0),!s.vFlip!=!t.vFlip&&(e.vFlip=!0);const i=((s.rotate||0)+(t.rotate||0))%4;return i&&(e.rotate=i),e}function fd(s,t){const e=W0(s,t);for(const i in xl)i in ko?i in s&&!(i in e)&&(e[i]=ko[i]):i in t?e[i]=t[i]:i in s&&(e[i]=s[i]);return e}function Y0(s,t){const e=s.icons,i=s.aliases||Object.create(null),n=Object.create(null);function r(o){if(e[o])return n[o]=[];if(!(o in n)){n[o]=null;const a=i[o]&&i[o].parent,l=a&&r(a);l&&(n[o]=[a].concat(l))}return n[o]}return Object.keys(e).concat(Object.keys(i)).forEach(r),n}function Z0(s,t,e){const i=s.icons,n=s.aliases||Object.create(null);let r={};function o(a){r=fd(i[a]||n[a],r)}return o(t),e.forEach(o),fd(s,r)}function Qp(s,t){const e=[];if(typeof s!="object"||typeof s.icons!="object")return e;s.not_found instanceof Array&&s.not_found.forEach(n=>{t(n,null),e.push(n)});const i=Y0(s);for(const n in i){const r=i[n];r&&(t(n,Z0(s,n,r)),e.push(n))}return e}const X0={provider:"",aliases:{},not_found:{},...Zp};function Fa(s,t){for(const e in t)if(e in s&&typeof s[e]!=typeof t[e])return!1;return!0}function Kp(s){if(typeof s!="object"||s===null)return null;const t=s;if(typeof t.prefix!="string"||!s.icons||typeof s.icons!="object"||!Fa(s,X0))return null;const e=t.icons;for(const n in e){const r=e[n];if(!n.match(Gn)||typeof r.body!="string"||!Fa(r,xl))return null}const i=t.aliases||Object.create(null);for(const n in i){const r=i[n],o=r.parent;if(!n.match(Gn)||typeof o!="string"||!e[o]&&!i[o]||!Fa(r,xl))return null}return t}const Po=Object.create(null);function G0(s,t){return{provider:s,prefix:t,icons:Object.create(null),missing:new Set}}function Fi(s,t){const e=Po[s]||(Po[s]=Object.create(null));return e[t]||(e[t]=G0(s,t))}function mc(s,t){return Kp(t)?Qp(t,(e,i)=>{i?s.icons[e]=i:s.missing.add(e)}):[]}function Q0(s,t,e){try{if(typeof e.body=="string")return s.icons[t]={...e},!0}catch{}return!1}function K0(s,t){let e=[];return(typeof s=="string"?[s]:Object.keys(Po)).forEach(i=>{(typeof i=="string"&&typeof t=="string"?[t]:Object.keys(Po[i]||{})).forEach(n=>{const r=Fi(i,n);e=e.concat(Object.keys(r.icons).map(o=>(i!==""?"@"+i+":":"")+n+":"+o))})}),e}let lr=!1;function Jp(s){return typeof s=="boolean"&&(lr=s),lr}function cr(s){const t=typeof s=="string"?yr(s,!0,lr):s;if(t){const e=Fi(t.provider,t.prefix),i=t.name;return e.icons[i]||(e.missing.has(i)?null:void 0)}}function tf(s,t){const e=yr(s,!0,lr);if(!e)return!1;const i=Fi(e.provider,e.prefix);return Q0(i,e.name,t)}function md(s,t){if(typeof s!="object")return!1;if(typeof t!="string"&&(t=s.provider||""),lr&&!t&&!s.prefix){let n=!1;return Kp(s)&&(s.prefix="",Qp(s,(r,o)=>{o&&tf(r,o)&&(n=!0)})),n}const e=s.prefix;if(!uo({provider:t,prefix:e,name:"a"}))return!1;const i=Fi(t,e);return!!mc(i,s)}function gd(s){return!!cr(s)}function J0(s){const t=cr(s);return t?{...br,...t}:null}function tw(s){const t={loaded:[],missing:[],pending:[]},e=Object.create(null);s.sort((n,r)=>n.provider!==r.provider?n.provider.localeCompare(r.provider):n.prefix!==r.prefix?n.prefix.localeCompare(r.prefix):n.name.localeCompare(r.name));let i={provider:"",prefix:"",name:""};return s.forEach(n=>{if(i.name===n.name&&i.prefix===n.prefix&&i.provider===n.provider)return;i=n;const r=n.provider,o=n.prefix,a=n.name,l=e[r]||(e[r]=Object.create(null)),c=l[o]||(l[o]=Fi(r,o));let h;a in c.icons?h=t.loaded:o===""||c.missing.has(a)?h=t.missing:h=t.pending;const d={provider:r,prefix:o,name:a};h.push(d)}),t}function ef(s,t){s.forEach(e=>{const i=e.loaderCallbacks;i&&(e.loaderCallbacks=i.filter(n=>n.id!==t))})}function ew(s){s.pendingCallbacksFlag||(s.pendingCallbacksFlag=!0,setTimeout(()=>{s.pendingCallbacksFlag=!1;const t=s.loaderCallbacks?s.loaderCallbacks.slice(0):[];if(!t.length)return;let e=!1;const i=s.provider,n=s.prefix;t.forEach(r=>{const o=r.icons,a=o.pending.length;o.pending=o.pending.filter(l=>{if(l.prefix!==n)return!0;const c=l.name;if(s.icons[c])o.loaded.push({provider:i,prefix:n,name:c});else if(s.missing.has(c))o.missing.push({provider:i,prefix:n,name:c});else return e=!0,!0;return!1}),o.pending.length!==a&&(e||ef([s],r.id),r.callback(o.loaded.slice(0),o.missing.slice(0),o.pending.slice(0),r.abort))})}))}let iw=0;function sw(s,t,e){const i=iw++,n=ef.bind(null,e,i);if(!t.pending.length)return n;const r={id:i,icons:t,callback:s,abort:n};return e.forEach(o=>{(o.loaderCallbacks||(o.loaderCallbacks=[])).push(r)}),n}const Cl=Object.create(null);function bd(s,t){Cl[s]=t}function El(s){return Cl[s]||Cl[""]}function nw(s,t=!0,e=!1){const i=[];return s.forEach(n=>{const r=typeof n=="string"?yr(n,t,e):n;r&&i.push(r)}),i}var rw={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function ow(s,t,e,i){const n=s.resources.length,r=s.random?Math.floor(Math.random()*n):s.index;let o;if(s.random){let S=s.resources.slice(0);for(o=[];S.length>1;){const $=Math.floor(Math.random()*S.length);o.push(S[$]),S=S.slice(0,$).concat(S.slice($+1))}o=o.concat(S)}else o=s.resources.slice(r).concat(s.resources.slice(0,r));const a=Date.now();let l="pending",c=0,h,d=null,p=[],u=[];typeof i=="function"&&u.push(i);function g(){d&&(clearTimeout(d),d=null)}function m(){l==="pending"&&(l="aborted"),g(),p.forEach(S=>{S.status==="pending"&&(S.status="aborted")}),p=[]}function b(S,$){$&&(u=[]),typeof S=="function"&&u.push(S)}function f(){return{startTime:a,payload:t,status:l,queriesSent:c,queriesPending:p.length,subscribe:b,abort:m}}function y(){l="failed",u.forEach(S=>{S(void 0,h)})}function _(){p.forEach(S=>{S.status==="pending"&&(S.status="aborted")}),p=[]}function x(S,$,O){const z=$!=="success";switch(p=p.filter(D=>D!==S),l){case"pending":break;case"failed":if(z||!s.dataAfterTimeout)return;break;default:return}if($==="abort"){h=O,y();return}if(z){h=O,p.length||(o.length?C():y());return}if(g(),_(),!s.random){const D=s.resources.indexOf(S.resource);D!==-1&&D!==s.index&&(s.index=D)}l="completed",u.forEach(D=>{D(O)})}function C(){if(l!=="pending")return;g();const S=o.shift();if(S===void 0){if(p.length){d=setTimeout(()=>{g(),l==="pending"&&(_(),y())},s.timeout);return}y();return}const $={status:"pending",resource:S,callback:(O,z)=>{x($,O,z)}};p.push($),c++,d=setTimeout(C,s.rotate),e(S,t,$.callback)}return setTimeout(C),f}function sf(s){const t={...rw,...s};let e=[];function i(){e=e.filter(o=>o().status==="pending")}function n(o,a,l){const c=ow(t,o,a,(h,d)=>{i(),l&&l(h,d)});return e.push(c),c}function r(o){return e.find(a=>o(a))||null}return{query:n,find:r,setIndex:o=>{t.index=o},getIndex:()=>t.index,cleanup:i}}function gc(s){let t;if(typeof s.resources=="string")t=[s.resources];else if(t=s.resources,!(t instanceof Array)||!t.length)return null;return{resources:t,path:s.path||"/",maxURL:s.maxURL||500,rotate:s.rotate||750,timeout:s.timeout||5e3,random:s.random===!0,index:s.index||0,dataAfterTimeout:s.dataAfterTimeout!==!1}}const Jo=Object.create(null),eo=["https://api.simplesvg.com","https://api.unisvg.com"],Sl=[];for(;eo.length>0;)eo.length===1||Math.random()>.5?Sl.push(eo.shift()):Sl.push(eo.pop());Jo[""]=gc({resources:["https://api.iconify.design"].concat(Sl)});function yd(s,t){const e=gc(t);return e===null?!1:(Jo[s]=e,!0)}function ta(s){return Jo[s]}function aw(){return Object.keys(Jo)}function vd(){}const ja=Object.create(null);function lw(s){if(!ja[s]){const t=ta(s);if(!t)return;const e=sf(t),i={config:t,redundancy:e};ja[s]=i}return ja[s]}function nf(s,t,e){let i,n;if(typeof s=="string"){const r=El(s);if(!r)return e(void 0,424),vd;n=r.send;const o=lw(s);o&&(i=o.redundancy)}else{const r=gc(s);if(r){i=sf(r);const o=s.resources?s.resources[0]:"",a=El(o);a&&(n=a.send)}}return!i||!n?(e(void 0,424),vd):i.query(t,n,e)().abort}const _d="iconify2",hr="iconify",rf=hr+"-count",wd=hr+"-version",of=36e5,cw=168,hw=50;function Al(s,t){try{return s.getItem(t)}catch{}}function bc(s,t,e){try{return s.setItem(t,e),!0}catch{}}function xd(s,t){try{s.removeItem(t)}catch{}}function $l(s,t){return bc(s,rf,t.toString())}function Tl(s){return parseInt(Al(s,rf))||0}const cs={local:!0,session:!0},af={local:new Set,session:new Set};let yc=!1;function dw(s){yc=s}let io=typeof window>"u"?{}:window;function lf(s){const t=s+"Storage";try{if(io&&io[t]&&typeof io[t].length=="number")return io[t]}catch{}cs[s]=!1}function cf(s,t){const e=lf(s);if(!e)return;const i=Al(e,wd);if(i!==_d){if(i){const a=Tl(e);for(let l=0;l<a;l++)xd(e,hr+l.toString())}bc(e,wd,_d),$l(e,0);return}const n=Math.floor(Date.now()/of)-cw,r=a=>{const l=hr+a.toString(),c=Al(e,l);if(typeof c=="string"){try{const h=JSON.parse(c);if(typeof h=="object"&&typeof h.cached=="number"&&h.cached>n&&typeof h.provider=="string"&&typeof h.data=="object"&&typeof h.data.prefix=="string"&&t(h,a))return!0}catch{}xd(e,l)}};let o=Tl(e);for(let a=o-1;a>=0;a--)r(a)||(a===o-1?(o--,$l(e,o)):af[s].add(a))}function hf(){if(!yc){dw(!0);for(const s in cs)cf(s,t=>{const e=t.data,i=t.provider,n=e.prefix,r=Fi(i,n);if(!mc(r,e).length)return!1;const o=e.lastModified||-1;return r.lastModifiedCached=r.lastModifiedCached?Math.min(r.lastModifiedCached,o):o,!0})}}function uw(s,t){const e=s.lastModifiedCached;if(e&&e>=t)return e===t;if(s.lastModifiedCached=t,e)for(const i in cs)cf(i,n=>{const r=n.data;return n.provider!==s.provider||r.prefix!==s.prefix||r.lastModified===t});return!0}function pw(s,t){yc||hf();function e(i){let n;if(!cs[i]||!(n=lf(i)))return;const r=af[i];let o;if(r.size)r.delete(o=Array.from(r).shift());else if(o=Tl(n),o>=hw||!$l(n,o+1))return;const a={cached:Math.floor(Date.now()/of),provider:s.provider,data:t};return bc(n,hr+o.toString(),JSON.stringify(a))}t.lastModified&&!uw(s,t.lastModified)||Object.keys(t.icons).length&&(t.not_found&&(t=Object.assign({},t),delete t.not_found),e("local")||e("session"))}function Cd(){}function fw(s){s.iconsLoaderFlag||(s.iconsLoaderFlag=!0,setTimeout(()=>{s.iconsLoaderFlag=!1,ew(s)}))}function mw(s,t){s.iconsToLoad?s.iconsToLoad=s.iconsToLoad.concat(t).sort():s.iconsToLoad=t,s.iconsQueueFlag||(s.iconsQueueFlag=!0,setTimeout(()=>{s.iconsQueueFlag=!1;const{provider:e,prefix:i}=s,n=s.iconsToLoad;delete s.iconsToLoad;let r;!n||!(r=El(e))||r.prepare(e,i,n).forEach(o=>{nf(e,o,a=>{if(typeof a!="object")o.icons.forEach(l=>{s.missing.add(l)});else try{const l=mc(s,a);if(!l.length)return;const c=s.pendingIcons;c&&l.forEach(h=>{c.delete(h)}),pw(s,a)}catch(l){console.error(l)}fw(s)})})}))}const vc=(s,t)=>{const e=nw(s,!0,Jp()),i=tw(e);if(!i.pending.length){let l=!0;return t&&setTimeout(()=>{l&&t(i.loaded,i.missing,i.pending,Cd)}),()=>{l=!1}}const n=Object.create(null),r=[];let o,a;return i.pending.forEach(l=>{const{provider:c,prefix:h}=l;if(h===a&&c===o)return;o=c,a=h,r.push(Fi(c,h));const d=n[c]||(n[c]=Object.create(null));d[h]||(d[h]=[])}),i.pending.forEach(l=>{const{provider:c,prefix:h,name:d}=l,p=Fi(c,h),u=p.pendingIcons||(p.pendingIcons=new Set);u.has(d)||(u.add(d),n[c][h].push(d))}),r.forEach(l=>{const{provider:c,prefix:h}=l;n[c][h].length&&mw(l,n[c][h])}),t?sw(t,i,r):Cd},gw=s=>new Promise((t,e)=>{const i=typeof s=="string"?yr(s,!0):s;if(!i){e(s);return}vc([i||s],n=>{if(n.length&&i){const r=cr(i);if(r){t({...br,...r});return}}e(s)})});function bw(s){try{const t=typeof s=="string"?JSON.parse(s):s;if(typeof t.body=="string")return{...t}}catch{}}function yw(s,t){const e=typeof s=="string"?yr(s,!0,!0):null;if(!e){const r=bw(s);return{value:s,data:r}}const i=cr(e);if(i!==void 0||!e.prefix)return{value:s,name:e,data:i};const n=vc([e],()=>t(s,e,cr(e)));return{value:s,name:e,loading:n}}function Ha(s){return s.hasAttribute("inline")}let df=!1;try{df=navigator.vendor.indexOf("Apple")===0}catch{}function vw(s,t){switch(t){case"svg":case"bg":case"mask":return t}return t!=="style"&&(df||s.indexOf("<a")===-1)?"svg":s.indexOf("currentColor")===-1?"bg":"mask"}const _w=/(-?[0-9.]*[0-9]+[0-9.]*)/g,ww=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function kl(s,t,e){if(t===1)return s;if(e=e||100,typeof s=="number")return Math.ceil(s*t*e)/e;if(typeof s!="string")return s;const i=s.split(_w);if(i===null||!i.length)return s;const n=[];let r=i.shift(),o=ww.test(r);for(;;){if(o){const a=parseFloat(r);isNaN(a)?n.push(r):n.push(Math.ceil(a*t*e)/e)}else n.push(r);if(r=i.shift(),r===void 0)return n.join("");o=!o}}function xw(s,t="defs"){let e="";const i=s.indexOf("<"+t);for(;i>=0;){const n=s.indexOf(">",i),r=s.indexOf("</"+t);if(n===-1||r===-1)break;const o=s.indexOf(">",r);if(o===-1)break;e+=s.slice(n+1,r).trim(),s=s.slice(0,i).trim()+s.slice(o+1)}return{defs:e,content:s}}function Cw(s,t){return s?"<defs>"+s+"</defs>"+t:t}function Ew(s,t,e){const i=xw(s);return Cw(i.defs,t+i.content+e)}const Sw=s=>s==="unset"||s==="undefined"||s==="none";function uf(s,t){const e={...br,...s},i={...Xp,...t},n={left:e.left,top:e.top,width:e.width,height:e.height};let r=e.body;[e,i].forEach(m=>{const b=[],f=m.hFlip,y=m.vFlip;let _=m.rotate;f?y?_+=2:(b.push("translate("+(n.width+n.left).toString()+" "+(0-n.top).toString()+")"),b.push("scale(-1 1)"),n.top=n.left=0):y&&(b.push("translate("+(0-n.left).toString()+" "+(n.height+n.top).toString()+")"),b.push("scale(1 -1)"),n.top=n.left=0);let x;switch(_<0&&(_-=Math.floor(_/4)*4),_=_%4,_){case 1:x=n.height/2+n.top,b.unshift("rotate(90 "+x.toString()+" "+x.toString()+")");break;case 2:b.unshift("rotate(180 "+(n.width/2+n.left).toString()+" "+(n.height/2+n.top).toString()+")");break;case 3:x=n.width/2+n.left,b.unshift("rotate(-90 "+x.toString()+" "+x.toString()+")");break}_%2===1&&(n.left!==n.top&&(x=n.left,n.left=n.top,n.top=x),n.width!==n.height&&(x=n.width,n.width=n.height,n.height=x)),b.length&&(r=Ew(r,'<g transform="'+b.join(" ")+'">',"</g>"))});const o=i.width,a=i.height,l=n.width,c=n.height;let h,d;o===null?(d=a===null?"1em":a==="auto"?c:a,h=kl(d,l/c)):(h=o==="auto"?l:o,d=a===null?kl(h,c/l):a==="auto"?c:a);const p={},u=(m,b)=>{Sw(b)||(p[m]=b.toString())};u("width",h),u("height",d);const g=[n.left,n.top,l,c];return p.viewBox=g.join(" "),{attributes:p,viewBox:g,body:r}}function _c(s,t){let e=s.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const i in t)e+=" "+i+'="'+t[i]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+e+">"+s+"</svg>"}function Aw(s){return s.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function $w(s){return"data:image/svg+xml,"+Aw(s)}function pf(s){return'url("'+$w(s)+'")'}const Tw=()=>{let s;try{if(s=fetch,typeof s=="function")return s}catch{}};let Oo=Tw();function kw(s){Oo=s}function Pw(){return Oo}function Ow(s,t){const e=ta(s);if(!e)return 0;let i;if(!e.maxURL)i=0;else{let n=0;e.resources.forEach(o=>{n=Math.max(n,o.length)});const r=t+".json?icons=";i=e.maxURL-n-e.path.length-r.length}return i}function Iw(s){return s===404}const zw=(s,t,e)=>{const i=[],n=Ow(s,t),r="icons";let o={type:r,provider:s,prefix:t,icons:[]},a=0;return e.forEach((l,c)=>{a+=l.length+1,a>=n&&c>0&&(i.push(o),o={type:r,provider:s,prefix:t,icons:[]},a=l.length),o.icons.push(l)}),i.push(o),i};function Dw(s){if(typeof s=="string"){const t=ta(s);if(t)return t.path}return"/"}const Mw=(s,t,e)=>{if(!Oo){e("abort",424);return}let i=Dw(t.provider);switch(t.type){case"icons":{const r=t.prefix,o=t.icons.join(","),a=new URLSearchParams({icons:o});i+=r+".json?"+a.toString();break}case"custom":{const r=t.uri;i+=r.slice(0,1)==="/"?r.slice(1):r;break}default:e("abort",400);return}let n=503;Oo(s+i).then(r=>{const o=r.status;if(o!==200){setTimeout(()=>{e(Iw(o)?"abort":"next",o)});return}return n=501,r.json()}).then(r=>{if(typeof r!="object"||r===null){setTimeout(()=>{r===404?e("abort",r):e("next",n)});return}setTimeout(()=>{e("success",r)})}).catch(()=>{e("next",n)})},Lw={prepare:zw,send:Mw};function Ed(s,t){switch(s){case"local":case"session":cs[s]=t;break;case"all":for(const e in cs)cs[e]=t;break}}const Va="data-style";let ff="";function Bw(s){ff=s}function Sd(s,t){let e=Array.from(s.childNodes).find(i=>i.hasAttribute&&i.hasAttribute(Va));e||(e=document.createElement("style"),e.setAttribute(Va,Va),s.appendChild(e)),e.textContent=":host{display:inline-block;vertical-align:"+(t?"-0.125em":"0")+"}span,svg{display:block}"+ff}function mf(){bd("",Lw),Jp(!0);let s;try{s=window}catch{}if(s){if(hf(),s.IconifyPreload!==void 0){const t=s.IconifyPreload,e="Invalid IconifyPreload syntax.";typeof t=="object"&&t!==null&&(t instanceof Array?t:[t]).forEach(i=>{try{(typeof i!="object"||i===null||i instanceof Array||typeof i.icons!="object"||typeof i.prefix!="string"||!md(i))&&console.error(e)}catch{console.error(e)}})}if(s.IconifyProviders!==void 0){const t=s.IconifyProviders;if(typeof t=="object"&&t!==null)for(const e in t){const i="IconifyProviders["+e+"] is invalid.";try{const n=t[e];if(typeof n!="object"||!n||n.resources===void 0)continue;yd(e,n)||console.error(i)}catch{console.error(i)}}}}return{enableCache:t=>Ed(t,!0),disableCache:t=>Ed(t,!1),iconLoaded:gd,iconExists:gd,getIcon:J0,listIcons:K0,addIcon:tf,addCollection:md,calculateSize:kl,buildIcon:uf,iconToHTML:_c,svgToURL:pf,loadIcons:vc,loadIcon:gw,addAPIProvider:yd,appendCustomStyle:Bw,_api:{getAPIConfig:ta,setAPIModule:bd,sendAPIQuery:nf,setFetch:kw,getFetch:Pw,listAPIProviders:aw}}}const Pl={"background-color":"currentColor"},gf={"background-color":"transparent"},Ad={image:"var(--svg)",repeat:"no-repeat",size:"100% 100%"},$d={"-webkit-mask":Pl,mask:Pl,background:gf};for(const s in $d){const t=$d[s];for(const e in Ad)t[s+"-"+e]=Ad[e]}function Td(s){return s?s+(s.match(/^[-0-9.]+$/)?"px":""):"inherit"}function Nw(s,t,e){const i=document.createElement("span");let n=s.body;n.indexOf("<a")!==-1&&(n+="<!-- "+Date.now()+" -->");const r=s.attributes,o=_c(n,{...r,width:t.width+"",height:t.height+""}),a=pf(o),l=i.style,c={"--svg":a,width:Td(r.width),height:Td(r.height),...e?Pl:gf};for(const h in c)l.setProperty(h,c[h]);return i}let Qn;function Uw(){try{Qn=window.trustedTypes.createPolicy("iconify",{createHTML:s=>s})}catch{Qn=null}}function Rw(s){return Qn===void 0&&Uw(),Qn?Qn.createHTML(s):s}function Fw(s){const t=document.createElement("span"),e=s.attributes;let i="";e.width||(i="width: inherit;"),e.height||(i+="height: inherit;"),i&&(e.style=i);const n=_c(s.body,e);return t.innerHTML=Rw(n),t.firstChild}function Ol(s){return Array.from(s.childNodes).find(t=>{const e=t.tagName&&t.tagName.toUpperCase();return e==="SPAN"||e==="SVG"})}function kd(s,t){const e=t.icon.data,i=t.customisations,n=uf(e,i);i.preserveAspectRatio&&(n.attributes.preserveAspectRatio=i.preserveAspectRatio);const r=t.renderedMode;let o;switch(r){case"svg":o=Fw(n);break;default:o=Nw(n,{...br,...e},r==="mask")}const a=Ol(s);a?o.tagName==="SPAN"&&a.tagName===o.tagName?a.setAttribute("style",o.getAttribute("style")):s.replaceChild(o,a):s.appendChild(o)}function Pd(s,t,e){const i=e&&(e.rendered?e:e.lastRender);return{rendered:!1,inline:t,icon:s,lastRender:i}}function jw(s="iconify-icon"){let t,e;try{t=window.customElements,e=window.HTMLElement}catch{return}if(!t||!e)return;const i=t.get(s);if(i)return i;const n=["icon","mode","inline","observe","width","height","rotate","flip"],r=class extends e{constructor(){super(),Ki(this,"_shadowRoot"),Ki(this,"_initialised",!1),Ki(this,"_state"),Ki(this,"_checkQueued",!1),Ki(this,"_connected",!1),Ki(this,"_observer",null),Ki(this,"_visible",!0);const a=this._shadowRoot=this.attachShadow({mode:"open"}),l=Ha(this);Sd(a,l),this._state=Pd({value:""},l),this._queueCheck()}connectedCallback(){this._connected=!0,this.startObserver()}disconnectedCallback(){this._connected=!1,this.stopObserver()}static get observedAttributes(){return n.slice(0)}attributeChangedCallback(a){switch(a){case"inline":{const l=Ha(this),c=this._state;l!==c.inline&&(c.inline=l,Sd(this._shadowRoot,l));break}case"observer":{this.observer?this.startObserver():this.stopObserver();break}default:this._queueCheck()}}get icon(){const a=this.getAttribute("icon");if(a&&a.slice(0,1)==="{")try{return JSON.parse(a)}catch{}return a}set icon(a){typeof a=="object"&&(a=JSON.stringify(a)),this.setAttribute("icon",a)}get inline(){return Ha(this)}set inline(a){a?this.setAttribute("inline","true"):this.removeAttribute("inline")}get observer(){return this.hasAttribute("observer")}set observer(a){a?this.setAttribute("observer","true"):this.removeAttribute("observer")}restartAnimation(){const a=this._state;if(a.rendered){const l=this._shadowRoot;if(a.renderedMode==="svg")try{l.lastChild.setCurrentTime(0);return}catch{}kd(l,a)}}get status(){const a=this._state;return a.rendered?"rendered":a.icon.data===null?"failed":"loading"}_queueCheck(){this._checkQueued||(this._checkQueued=!0,setTimeout(()=>{this._check()}))}_check(){if(!this._checkQueued)return;this._checkQueued=!1;const a=this._state,l=this.getAttribute("icon");if(l!==a.icon.value){this._iconChanged(l);return}if(!a.rendered||!this._visible)return;const c=this.getAttribute("mode"),h=pd(this);(a.attrMode!==c||q0(a.customisations,h)||!Ol(this._shadowRoot))&&this._renderIcon(a.icon,h,c)}_iconChanged(a){const l=yw(a,(c,h,d)=>{const p=this._state;if(p.rendered||this.getAttribute("icon")!==c)return;const u={value:c,name:h,data:d};u.data?this._gotIconData(u):p.icon=u});l.data?this._gotIconData(l):this._state=Pd(l,this._state.inline,this._state)}_forceRender(){if(!this._visible){const a=Ol(this._shadowRoot);a&&this._shadowRoot.removeChild(a);return}this._queueCheck()}_gotIconData(a){this._checkQueued=!1,this._renderIcon(a,pd(this),this.getAttribute("mode"))}_renderIcon(a,l,c){const h=vw(a.data.body,c),d=this._state.inline;kd(this._shadowRoot,this._state={rendered:!0,icon:a,inline:d,customisations:l,attrMode:c,renderedMode:h})}startObserver(){if(!this._observer)try{this._observer=new IntersectionObserver(a=>{const l=a.some(c=>c.isIntersecting);l!==this._visible&&(this._visible=l,this._forceRender())}),this._observer.observe(this)}catch{if(this._observer){try{this._observer.disconnect()}catch{}this._observer=null}}}stopObserver(){this._observer&&(this._observer.disconnect(),this._observer=null,this._visible=!0,this._connected&&this._forceRender())}};n.forEach(a=>{a in r.prototype||Object.defineProperty(r.prototype,a,{get:function(){return this.getAttribute(a)},set:function(l){l!==null?this.setAttribute(a,l):this.removeAttribute(a)}})});const o=mf();for(const a in o)r[a]=r.prototype[a]=o[a];return t.define(s,r),r}const Hw=jw()||mf(),{enableCache:WC,disableCache:YC,iconLoaded:ZC,iconExists:XC,getIcon:GC,listIcons:QC,addIcon:KC,addCollection:JC,calculateSize:tE,buildIcon:eE,iconToHTML:iE,svgToURL:sE,loadIcons:Vw,loadIcon:nE,addAPIProvider:rE,_api:oE}=Hw,qw=At`
  ::-webkit-scrollbar {
    width: 0.4rem;
    height: 0.4rem;
    overflow: hidden;
  }

  ::-webkit-scrollbar-thumb {
    border-radius: 0.25rem;
    background-color: var(
      --bim-scrollbar--c,
      color-mix(in lab, var(--bim-ui_main-base), white 15%)
    );
  }

  ::-webkit-scrollbar-track {
    background-color: var(--bim-scrollbar--bgc, var(--bim-ui_bg-base));
  }
`,Ww=At`
  :root {
    /* Grayscale Colors */
    --bim-ui_gray-0: hsl(210 10% 5%);
    --bim-ui_gray-1: hsl(210 10% 10%);
    --bim-ui_gray-2: hsl(210 10% 20%);
    --bim-ui_gray-3: hsl(210 10% 30%);
    --bim-ui_gray-4: hsl(210 10% 40%);
    --bim-ui_gray-6: hsl(210 10% 60%);
    --bim-ui_gray-7: hsl(210 10% 70%);
    --bim-ui_gray-8: hsl(210 10% 80%);
    --bim-ui_gray-9: hsl(210 10% 90%);
    --bim-ui_gray-10: hsl(210 10% 95%);

    /* Brand Colors */
    --bim-ui_main-base: #6528d7;
    --bim-ui_accent-base: #bcf124;

    /* Brand Colors Contrasts */
    --bim-ui_main-contrast: var(--bim-ui_gray-10);
    --bim-ui_accent-contrast: var(--bim-ui_gray-0);

    /* Sizes */
    --bim-ui_size-4xs: 0.375rem;
    --bim-ui_size-3xs: 0.5rem;
    --bim-ui_size-2xs: 0.625rem;
    --bim-ui_size-xs: 0.75rem;
    --bim-ui_size-sm: 0.875rem;
    --bim-ui_size-base: 1rem;
    --bim-ui_size-lg: 1.125rem;
    --bim-ui_size-xl: 1.25rem;
    --bim-ui_size-2xl: 1.375rem;
    --bim-ui_size-3xl: 1.5rem;
    --bim-ui_size-4xl: 1.625rem;
    --bim-ui_size-5xl: 1.75rem;
    --bim-ui_size-6xl: 1.875rem;
    --bim-ui_size-7xl: 2rem;
    --bim-ui_size-8xl: 2.125rem;
    --bim-ui_size-9xl: 2.25rem;
  }

  /* Background Colors */
  @media (prefers-color-scheme: dark) {
    :root {
      --bim-ui_bg-base: var(--bim-ui_gray-0);
      --bim-ui_bg-contrast-10: var(--bim-ui_gray-1);
      --bim-ui_bg-contrast-20: var(--bim-ui_gray-2);
      --bim-ui_bg-contrast-30: var(--bim-ui_gray-3);
      --bim-ui_bg-contrast-40: var(--bim-ui_gray-4);
      --bim-ui_bg-contrast-60: var(--bim-ui_gray-6);
      --bim-ui_bg-contrast-80: var(--bim-ui_gray-8);
      --bim-ui_bg-contrast-100: var(--bim-ui_gray-10);
    }
  }

  @media (prefers-color-scheme: light) {
    :root {
      --bim-ui_bg-base: var(--bim-ui_gray-10);
      --bim-ui_bg-contrast-10: var(--bim-ui_gray-9);
      --bim-ui_bg-contrast-20: var(--bim-ui_gray-8);
      --bim-ui_bg-contrast-30: var(--bim-ui_gray-7);
      --bim-ui_bg-contrast-40: var(--bim-ui_gray-6);
      --bim-ui_bg-contrast-60: var(--bim-ui_gray-4);
      --bim-ui_bg-contrast-80: var(--bim-ui_gray-2);
      --bim-ui_bg-contrast-100: var(--bim-ui_gray-0);
      --bim-ui_accent-base: #6528d7;
    }
  }

  .theme-transition-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    filter: drop-shadow(0 0 10px var(--bim-ui_bg-base));
    z-index: 9999;
  }

  .theme-transition-overlay > div {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--bim-ui_bg-base);
  }

  html.bim-ui-dark {
    --bim-ui_bg-base: var(--bim-ui_gray-0);
    --bim-ui_bg-contrast-10: var(--bim-ui_gray-1);
    --bim-ui_bg-contrast-20: var(--bim-ui_gray-2);
    --bim-ui_bg-contrast-30: var(--bim-ui_gray-3);
    --bim-ui_bg-contrast-40: var(--bim-ui_gray-4);
    --bim-ui_bg-contrast-60: var(--bim-ui_gray-6);
    --bim-ui_bg-contrast-80: var(--bim-ui_gray-8);
    --bim-ui_bg-contrast-100: var(--bim-ui_gray-10);
  }

  html.bim-ui-light {
    --bim-ui_bg-base: var(--bim-ui_gray-10);
    --bim-ui_bg-contrast-10: var(--bim-ui_gray-9);
    --bim-ui_bg-contrast-20: var(--bim-ui_gray-8);
    --bim-ui_bg-contrast-30: var(--bim-ui_gray-7);
    --bim-ui_bg-contrast-40: var(--bim-ui_gray-6);
    --bim-ui_bg-contrast-60: var(--bim-ui_gray-4);
    --bim-ui_bg-contrast-80: var(--bim-ui_gray-2);
    --bim-ui_bg-contrast-100: var(--bim-ui_gray-0);
    --bim-ui_accent-base: #6528d7;
  }

  @keyframes toggleOverlay {
    0%,
    99% {
      display: block;
    }

    100% {
      display: none;
    }
  }

  @keyframes toggleThemeAnimation {
    0% {
      clip-path: circle(0% at center top);
    }
    45%,
    55% {
      clip-path: circle(150% at center center);
    }
    100% {
      clip-path: circle(0% at center bottom);
    }
  }

  [data-context-dialog]::backdrop {
    background-color: transparent;
  }
`,qi={scrollbar:qw,globalStyles:Ww},bf=class _t{static set config(t){this._config={..._t._config,...t}}static get config(){return _t._config}static addGlobalStyles(){let t=document.querySelector("style[id='bim-ui']");if(t)return;t=document.createElement("style"),t.id="bim-ui",t.textContent=qi.globalStyles.cssText;const e=document.head.firstChild;e?document.head.insertBefore(t,e):document.head.append(t)}static preloadIcons(t,e=!1){Vw(t,(i,n,r)=>{e&&(console.log("Icons loaded:",i),n.length&&console.warn("Icons missing:",n),r.length&&console.info("Icons pending:",r))})}static defineCustomElement(t,e){customElements.get(t)||customElements.define(t,e)}static registerComponents(){_t.init()}static init(t="",e=!0){_t.addGlobalStyles(),_t.defineCustomElement("bim-button",Kw),_t.defineCustomElement("bim-checkbox",cn),_t.defineCustomElement("bim-color-input",Wi),_t.defineCustomElement("bim-context-menu",Kn),_t.defineCustomElement("bim-dropdown",oi),_t.defineCustomElement("bim-grid",xc),_t.defineCustomElement("bim-icon",o1),_t.defineCustomElement("bim-input",_r),_t.defineCustomElement("bim-label",hn),_t.defineCustomElement("bim-number-input",Ee),_t.defineCustomElement("bim-option",Xt),_t.defineCustomElement("bim-panel",ms),_t.defineCustomElement("bim-panel-section",dn),_t.defineCustomElement("bim-selector",un),_t.defineCustomElement("bim-table",Se),_t.defineCustomElement("bim-tabs",gi),_t.defineCustomElement("bim-tab",be),_t.defineCustomElement("bim-table-cell",If),_t.defineCustomElement("bim-table-children",v1),_t.defineCustomElement("bim-table-group",Lf),_t.defineCustomElement("bim-table-row",gs),_t.defineCustomElement("bim-text-input",ge),_t.defineCustomElement("bim-toolbar",oa),_t.defineCustomElement("bim-toolbar-group",na),_t.defineCustomElement("bim-toolbar-section",mn),_t.defineCustomElement("bim-viewport",Yf),e&&this.animateOnLoad(t)}static newRandomId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let i=0;i<10;i++){const n=Math.floor(Math.random()*t.length);e+=t.charAt(n)}return e}static animateOnLoad(t=""){const e=`
      bim-input,
      bim-button,
      bim-checkbox,
      bim-selector,
      bim-label,
      bim-table-row,
      bim-panel-section,
      bim-table-children .branch-vertical,
      .switchers
    `,i=[];function n(r,o=document,a=new Set){const l=[];return Array.from(o.querySelectorAll(r)).forEach(c=>{a.has(c)||(a.add(c),l.push(c))}),Array.from(o.querySelectorAll("*")).filter(c=>c.shadowRoot).forEach(c=>{a.has(c)||(a.add(c),l.push(...n(r,c.shadowRoot,a)))}),l}requestAnimationFrame(()=>{n(t||e).forEach(o=>{const a=o;let l="auto";l=window.getComputedStyle(a).getPropertyValue("transition"),a.style.setProperty("opacity","0"),a.style.setProperty("transition","none"),requestAnimationFrame(()=>{a.style.setProperty("transition",l)}),i.push(a)});const r=()=>{i.forEach(o=>{const a=o,l=(a.getBoundingClientRect().x+a.getBoundingClientRect().y)/(window.innerWidth+window.innerHeight),c=window.getComputedStyle(a).getPropertyValue("transform"),h=400,d=200+l*1e3;a.animate([{transform:"translateY(-20px)",opacity:"0"},{transform:"translateY(0)",opacity:"1"}],{duration:h,easing:"ease-in-out",delay:d}),setTimeout(()=>{a.style.removeProperty("opacity"),c!=="none"?a.style.setProperty("transform",c):a.style.removeProperty("transform")},d+h)})};document.readyState==="complete"?r():window.addEventListener("load",r)})}static toggleTheme(t=!0){const e=document.querySelector("html");if(!e)return;const i=()=>{e.classList.contains("bim-ui-dark")?e.classList.replace("bim-ui-dark","bim-ui-light"):e.classList.contains("bim-ui-light")?e.classList.replace("bim-ui-light","bim-ui-dark"):e.classList.add("bim-ui-light")};if(t){const n=document.createElement("div");n.classList.add("theme-transition-overlay");const r=document.createElement("div");n.appendChild(r),r.style.setProperty("transition",`background-color ${1e3/3200}s`),document.body.appendChild(n),n.style.setProperty("animation",`toggleOverlay ${1e3/1e3}s ease-in forwards`),r.style.setProperty("animation",`toggleThemeAnimation ${1e3/1e3}s ease forwards`),setTimeout(()=>{i()},1e3/4),setTimeout(()=>{document.body.querySelectorAll(".theme-transition-overlay").forEach(o=>{document.body.removeChild(o)})},1e3)}else i()}};bf._config={sectionLabelOnVerticalToolbar:!1};let ae=bf;class qt extends Ct{constructor(){super(...arguments),this._lazyLoadObserver=null,this._visibleElements=[],this.ELEMENTS_BEFORE_OBSERVER=20,this.useObserver=!1,this.elements=new Set,this.observe=t=>{if(!this.useObserver)return;for(const i of t)this.elements.add(i);const e=t.slice(this.ELEMENTS_BEFORE_OBSERVER);for(const i of e)i.remove();this.observeLastElement()}}set visibleElements(t){this._visibleElements=this.useObserver?t:[],this.requestUpdate()}get visibleElements(){return this._visibleElements}getLazyObserver(){if(!this.useObserver)return null;if(this._lazyLoadObserver)return this._lazyLoadObserver;const t=new IntersectionObserver(e=>{const i=e[0];if(!i.isIntersecting)return;const n=i.target;t.unobserve(n);const r=this.ELEMENTS_BEFORE_OBSERVER+this.visibleElements.length,o=[...this.elements][r];o&&(this.visibleElements=[...this.visibleElements,o],t.observe(o))},{threshold:.5});return t}observeLastElement(){const t=this.getLazyObserver();if(!t)return;const e=this.ELEMENTS_BEFORE_OBSERVER+this.visibleElements.length-1,i=[...this.elements][e];i&&t.observe(i)}resetVisibleElements(){const t=this.getLazyObserver();if(t){for(const e of this.elements)t.unobserve(e);this.visibleElements=[],this.observeLastElement()}}static create(t,e){const i=document.createDocumentFragment();if(t.length===0)return wl(t(),i),i.firstElementChild;if(!e)throw new Error("UIComponent: Initial state is required for statefull components.");let n=e;const r=t,o=l=>(n={...n,...l},wl(r(n,o),i),n);o(e);const a=()=>n;return[i.firstElementChild,o,a]}}const dr=(s,t={},e=!0)=>{let i={};for(const n of s.children){const r=n,o=r.getAttribute("name")||r.getAttribute("label"),a=o?t[o]:void 0;if(o){if("value"in r&&typeof r.value<"u"&&r.value!==null){const l=r.value;if(typeof l=="object"&&!Array.isArray(l)&&Object.keys(l).length===0)continue;i[o]=a?a(r.value):r.value}else if(e){const l=dr(r,t);if(Object.keys(l).length===0)continue;i[o]=a?a(l):l}}else e&&(i={...i,...dr(r,t)})}return i},ea=s=>s==="true"||s==="false"?s==="true":s&&!isNaN(Number(s))&&s.trim()!==""?Number(s):s,Yw=[">=","<=","=",">","<","?","/","#"];function Od(s){const t=Yw.find(o=>s.split(o).length===2),e=s.split(t).map(o=>o.trim()),[i,n]=e,r=n.startsWith("'")&&n.endsWith("'")?n.replace(/'/g,""):ea(n);return{key:i,condition:t,value:r}}const Il=s=>{try{const t=[],e=s.split(/&(?![^()]*\))/).map(i=>i.trim());for(const i of e){const n=!i.startsWith("(")&&!i.endsWith(")"),r=i.startsWith("(")&&i.endsWith(")");if(n){const o=Od(i);t.push(o)}if(r){const o={operator:"&",queries:i.replace(/^(\()|(\))$/g,"").split("&").map(a=>a.trim()).map((a,l)=>{const c=Od(a);return l>0&&(c.operator="&"),c})};t.push(o)}}return t}catch{return null}},Id=(s,t,e)=>{let i=!1;switch(t){case"=":i=s===e;break;case"?":i=String(s).includes(String(e));break;case"<":(typeof s=="number"||typeof e=="number")&&(i=s<e);break;case"<=":(typeof s=="number"||typeof e=="number")&&(i=s<=e);break;case">":(typeof s=="number"||typeof e=="number")&&(i=s>e);break;case">=":(typeof s=="number"||typeof e=="number")&&(i=s>=e);break;case"/":i=String(s).startsWith(String(e));break}return i};var Zw=Object.defineProperty,Xw=Object.getOwnPropertyDescriptor,yf=(s,t,e,i)=>{for(var n=Xw(t,e),r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&Zw(t,e,n),n},ne;const wc=(ne=class extends Ct{constructor(){super(...arguments),this._previousContainer=null,this._visible=!1}get placement(){return this._placement}set placement(s){this._placement=s,this.updatePosition()}static removeMenus(){for(const s of[...ne.dialog.children])s instanceof ne&&(s.remove(),s.visible=!1);setTimeout(()=>{ne.dialog.close(),ne.dialog.remove()},310)}get visible(){return this._visible}set visible(s){this._visible=s,s?(ne.dialog.parentElement||document.body.append(ne.dialog),this._previousContainer=this.parentElement,ne.dialog.style.top=`${window.scrollY||document.documentElement.scrollTop}px`,this.style.setProperty("display","flex"),ne.dialog.append(this),ne.dialog.showModal(),this.updatePosition(),this.dispatchEvent(new Event("visible"))):setTimeout(()=>{var t;(t=this._previousContainer)==null||t.append(this),this._previousContainer=null,this.style.setProperty("display","none"),this.dispatchEvent(new Event("hidden"))},310)}async updatePosition(){if(!(this.visible&&this._previousContainer))return;const s=this.placement??"right",t=await Np(this._previousContainer,this,{placement:s,middleware:[Ep(10),Bp(),Lp(),Mp({padding:5})]}),{x:e,y:i}=t;this.style.left=`${e}px`,this.style.top=`${i}px`}connectedCallback(){super.connectedCallback(),this.visible?(this.style.setProperty("width","auto"),this.style.setProperty("height","auto")):(this.style.setProperty("display","none"),this.style.setProperty("width","0"),this.style.setProperty("height","0"))}render(){return H` <slot></slot> `}},ne.styles=[qi.scrollbar,At`
      :host {
        pointer-events: auto;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 999;
        overflow: auto;
        max-height: 20rem;
        min-width: 3rem;
        flex-direction: column;
        box-shadow: 1px 2px 8px 2px rgba(0, 0, 0, 0.15);
        padding: 0.5rem;
        border-radius: var(--bim-ui_size-4xs);
        display: flex;
        transform-origin: top left;
        transform: scale(1);
        clip-path: circle(150% at top left);
        background-color: var(--bim-ui_bg-contrast-20);
        transition:
          clip-path 0.2s cubic-bezier(0.72, 0.1, 0.43, 0.93),
          transform 0.3s cubic-bezier(0.72, 0.1, 0.45, 2.35);
      }

      :host(:not([visible])) {
        transform: scale(0.8);
        clip-path: circle(0 at top left);
      }
    `],ne.dialog=qt.create(()=>H` <dialog
      @click=${s=>{s.target===ne.dialog&&ne.removeMenus()}}
      @cancel=${()=>ne.removeMenus()}
      data-context-dialog
      style="
      width: 0;
      height: 0;
      position: relative;
      padding: 0;
      border: none;
      outline: none;
      margin: none;
      overflow: visible;
      background-color: transparent;
    "
    ></dialog>`),ne);yf([W({type:String,reflect:!0})],wc.prototype,"placement");yf([W({type:Boolean,reflect:!0})],wc.prototype,"visible");let Kn=wc;var Gw=Object.defineProperty,Qw=Object.getOwnPropertyDescriptor,We=(s,t,e,i)=>{for(var n=i>1?void 0:i?Qw(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&Gw(t,e,n),n},Nn;const Le=(Nn=class extends Ct{constructor(){super(),this.labelHidden=!1,this.active=!1,this.disabled=!1,this.vertical=!1,this.tooltipVisible=!1,this._stateBeforeLoading={disabled:!1,icon:""},this._loading=!1,this._parent=nn(),this._tooltip=nn(),this._mouseLeave=!1,this.onClick=s=>{s.stopPropagation(),this.disabled||this.dispatchEvent(new Event("click"))},this.showContextMenu=()=>{let s=this._contextMenu;if(this.contextMenuTemplate&&(s=qt.create(()=>{const t=qt.create(this.contextMenuTemplate);return t instanceof Kn?H`${t}`:H`
          <bim-context-menu>${t}</bim-context-menu>
        `}),this.append(s),s.addEventListener("hidden",()=>{s==null||s.remove()})),s){const t=this.getAttribute("data-context-group");t&&s.setAttribute("data-context-group",t),this.closeNestedContexts();const e=ae.newRandomId();for(const i of s.children)i instanceof Nn&&i.setAttribute("data-context-group",e);s.visible=!0}},this.mouseLeave=!0}set loading(s){if(this._loading=s,s)this._stateBeforeLoading={disabled:this.disabled,icon:this.icon},this.disabled=s,this.icon="eos-icons:loading";else{const{disabled:t,icon:e}=this._stateBeforeLoading;this.disabled=t,this.icon=e}}get loading(){return this._loading}set mouseLeave(s){this._mouseLeave=s,s&&(this.tooltipVisible=!1,clearTimeout(this.timeoutID))}get mouseLeave(){return this._mouseLeave}computeTooltipPosition(){const{value:s}=this._parent,{value:t}=this._tooltip;s&&t&&Np(s,t,{placement:"bottom",middleware:[Ep(10),Bp(),Lp(),Mp({padding:5})]}).then(e=>{const{x:i,y:n}=e;Object.assign(t.style,{left:`${i}px`,top:`${n}px`})})}onMouseEnter(){if(!(this.tooltipTitle||this.tooltipText))return;this.mouseLeave=!1;const s=this.tooltipTime??700;this.timeoutID=setTimeout(()=>{this.mouseLeave||(this.computeTooltipPosition(),this.tooltipVisible=!0)},s)}closeNestedContexts(){const s=this.getAttribute("data-context-group");if(s)for(const t of Kn.dialog.children){const e=t.getAttribute("data-context-group");if(t instanceof Kn&&e===s){t.visible=!1,t.removeAttribute("data-context-group");for(const i of t.children)i instanceof Nn&&(i.closeNestedContexts(),i.removeAttribute("data-context-group"))}}}click(){this.disabled||super.click()}get _contextMenu(){return this.querySelector("bim-context-menu")}connectedCallback(){super.connectedCallback(),this.addEventListener("click",this.showContextMenu)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("click",this.showContextMenu)}render(){const s=H`
      <div ${Qt(this._tooltip)} class="tooltip">
        ${this.tooltipTitle?H`<p style="text-wrap: nowrap;">
              <strong>${this.tooltipTitle}</strong>
            </p>`:null}
        ${this.tooltipText?H`<p style="width: 9rem;">${this.tooltipText}</p>`:null}
      </div>
    `;let t=H`${this.label}`;if((this._contextMenu||this.contextMenuTemplate)&&this.label){const e=H`<svg
        xmlns="http://www.w3.org/2000/svg"
        height="1.125rem"
        viewBox="0 0 24 24"
        width="1.125rem"
        style="fill: var(--bim-label--c)"
      >
        <path d="M0 0h24v24H0V0z" fill="none" />
        <path d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
      </svg>`;t=H`
        <div style="display: flex; align-items: center;">
          ${this.label}
          ${e}
        </div>
      `}return H`
      <div ${Qt(this._parent)} class="parent" @click=${this.onClick}>
        ${this.label||this.icon?H`
              <div
                class="button"
                @mouseenter=${this.onMouseEnter}
                @mouseleave=${()=>this.mouseLeave=!0}
              >
                <bim-label
                  .icon=${this.icon}
                  .vertical=${this.vertical}
                  .labelHidden=${this.labelHidden}
                  >${t}</bim-label
                >
              </div>
            `:null}
        ${this.tooltipTitle||this.tooltipText?s:null}
      </div>
      <slot></slot>
    `}},Nn.styles=At`
    :host {
      --bim-label--c: var(--bim-ui_bg-contrast-100, white);
      position: relative;
      display: block;
      flex: 1;
      pointer-events: none;
      background-color: var(--bim-button--bgc, var(--bim-ui_bg-contrast-20));
      border-radius: var(--bim-ui_size-4xs);
      transition: all 0.15s;
    }

    :host(:not([disabled]))::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: inherit;
      background-color: var(--bim-ui_main-base);
      clip-path: circle(0 at center center);
      box-sizing: border-box;
      transition:
        clip-path 0.3s cubic-bezier(0.65, 0.05, 0.36, 1),
        transform 0.15s;
    }

    :host(:not([disabled]):hover) {
      cursor: pointer;
    }

    bim-label {
      pointer-events: none;
    }

    .parent {
      --bim-icon--c: var(--bim-label--c);
      position: relative;
      display: flex;
      height: 100%;
      user-select: none;
      row-gap: 0.125rem;
      min-height: var(--bim-ui_size-5xl);
      min-width: var(--bim-ui_size-5xl);
    }

    .button,
    .children {
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
    }

    .children {
      padding: 0 0.375rem;
      position: absolute;
      height: 100%;
      right: 0;
    }

    :host(:not([label-hidden])[icon][vertical]) .parent {
      min-height: 2.5rem;
    }

    .button {
      flex-grow: 1;
      transition: transform 0.15s;
    }

    :host(:not([label-hidden])[label]) .button {
      justify-content: var(--bim-button--jc, center);
    }

    :host(:hover)::before {
      clip-path: circle(120% at center center);
    }

    :host(:hover) {
      --bim-label--c: var(--bim-ui_main-contrast);
      z-index: 2;
    }

    :host([active]) {
      background-color: var(--bim-ui_main-base);
    }

    :host(:not([disabled]):active) {
      background: transparent;
    }

    :host(:not([disabled]):active) .button,
    :host(:not([disabled]):active)::before {
      transform: scale(0.98);
    }

    :host(:not([label]):not([icon])) .children {
      flex: 1;
    }

    :host([vertical]) .parent {
      justify-content: center;
    }

    :host(:not([label-hidden])[label]) .button {
      padding: 0 0.5rem;
    }

    :host([disabled]) {
      --bim-label--c: var(--bim-ui_bg-contrast-80) !important;
      background-color: gray !important;
    }

    ::slotted(bim-button) {
      --bim-icon--fz: var(--bim-ui_size-base);
      --bim-button--bdrs: var(--bim-ui_size-4xs);
      --bim-button--olw: 0;
      --bim-button--olc: transparent;
    }

    .tooltip {
      position: absolute;
      padding: 0.75rem;
      z-index: 99;
      display: flex;
      flex-flow: column;
      row-gap: 0.375rem;
      box-shadow: 0 0 10px 3px rgba(0 0 0 / 20%);
      outline: 1px solid var(--bim-ui_bg-contrast-40);
      font-size: var(--bim-ui_size-xs);
      border-radius: var(--bim-ui_size-4xs);
      background-color: var(--bim-ui_bg-contrast-20);
      color: var(--bim-ui_bg-contrast-100);
      animation: openTooltips 0.15s ease-out forwards;
      transition: visibility 0.2s;
    }

    .tooltip p {
      margin: 0;
      padding: 0;
    }

    :host(:not([tooltip-visible])) .tooltip {
      animation: closeTooltips 0.15s ease-in forwards;
      visibility: hidden;
      display: none;
    }

    @keyframes closeTooltips {
      0% {
        display: flex;
        padding: 0.75rem;
        transform: translateY(0);
        opacity: 1;
      }
      90% {
        padding: 0.75rem;
      }
      100% {
        display: none;
        padding: 0;
        transform: translateY(-10px);
        opacity: 0;
      }
    }

    @keyframes openTooltips {
      0% {
        display: flex;
        transform: translateY(-10px);
        opacity: 0;
      }
      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }
  `,Nn);We([W({type:String,reflect:!0})],Le.prototype,"label",2);We([W({type:Boolean,attribute:"label-hidden",reflect:!0})],Le.prototype,"labelHidden",2);We([W({type:Boolean,reflect:!0})],Le.prototype,"active",2);We([W({type:Boolean,reflect:!0,attribute:"disabled"})],Le.prototype,"disabled",2);We([W({type:String,reflect:!0})],Le.prototype,"icon",2);We([W({type:Boolean,reflect:!0})],Le.prototype,"vertical",2);We([W({type:Number,attribute:"tooltip-time",reflect:!0})],Le.prototype,"tooltipTime",2);We([W({type:Boolean,attribute:"tooltip-visible",reflect:!0})],Le.prototype,"tooltipVisible",2);We([W({type:String,attribute:"tooltip-title",reflect:!0})],Le.prototype,"tooltipTitle",2);We([W({type:String,attribute:"tooltip-text",reflect:!0})],Le.prototype,"tooltipText",2);We([W({type:Boolean,reflect:!0})],Le.prototype,"loading",1);let Kw=Le;var Jw=Object.defineProperty,vr=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&Jw(t,e,n),n};const vf=class extends Ct{constructor(){super(...arguments),this.checked=!1,this.inverted=!1,this.onValueChange=new Event("change")}get value(){return this.checked}onChange(s){s.stopPropagation(),this.checked=s.target.checked,this.dispatchEvent(this.onValueChange)}render(){const s=H`
      <svg viewBox="0 0 21 21">
        <polyline points="5 10.75 8.5 14.25 16 6"></polyline>
      </svg>
    `;return H`
      <div class="parent">
        <label class="parent-label">
          ${this.label?H`<bim-label .icon="${this.icon}">${this.label}</bim-label> `:null}
          <div class="input-container">
            <input
              type="checkbox"
              aria-label=${this.label||this.name||"Checkbox Input"}
              @change="${this.onChange}"
              .checked="${this.checked}"
            />
            ${s}
          </div>
        </label>
      </div>
    `}};vf.styles=At`
    :host {
      display: block;
    }

    .parent-label {
      --background: #fff;
      --border: #dfdfe6;
      --stroke: #fff;
      --border-hover: var(--bim-ui_main-base);
      --border-active: var(--bim-ui_main-base);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      width: 100%;
      height: 1.75rem;
      column-gap: 0.25rem;
      position: relative;
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }

    :host([inverted]) .parent-label {
      flex-direction: row-reverse;
      justify-content: start;
    }

    input,
    svg {
      width: 1rem;
      height: 1rem;
      display: block;
    }

    input {
      -webkit-appearance: none;
      -moz-appearance: none;
      position: relative;
      outline: none;
      background: var(--background);
      border: none;
      margin: 0;
      padding: 0;
      cursor: pointer;
      border-radius: 4px;
      transition: box-shadow 0.3s;
      box-shadow: inset 0 0 0 var(--s, 1px) var(--b, var(--border));
    }

    svg {
      pointer-events: none;
      fill: none;
      stroke-width: 2.2px;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke: var(--stroke, var(--border-active));
      transform: translateY(-100%) scale(0);
      position: absolute;
      width: 1rem;
      height: 1rem;
    }

    input:hover {
      --s: 2px;
      --b: var(--border-hover);
    }

    input:checked {
      --b: var(--border-active);
      --s: 11px;
    }

    input:checked + svg {
      -webkit-animation: bounce 0.4s linear forwards 0.2s;
      animation: bounce 0.4s linear forwards 0.2s;
    }

    @keyframes bounce {
      0% {
        transform: translateY(-100%) scale(0);
      }
      50% {
        transform: translateY(-100%) scale(1.2);
      }
      75% {
        transform: translateY(-100%) scale(0.9);
      }
      100% {
        transform: translateY(-100%) scale(1);
      }
    }
  `;let cn=vf;vr([W({type:String,reflect:!0})],cn.prototype,"icon");vr([W({type:String,reflect:!0})],cn.prototype,"name");vr([W({type:String,reflect:!0})],cn.prototype,"label");vr([W({type:Boolean,reflect:!0})],cn.prototype,"checked");vr([W({type:Boolean,reflect:!0})],cn.prototype,"inverted");var t1=Object.defineProperty,fs=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&t1(t,e,n),n};const _f=class extends Ct{constructor(){super(...arguments),this.vertical=!1,this.color="#bcf124",this.disabled=!1,this._colorInput=nn(),this._textInput=nn(),this.onValueChange=new Event("input"),this.onOpacityInput=s=>{const t=s.target;this.opacity=t.value,this.dispatchEvent(this.onValueChange)}}set value(s){const{color:t,opacity:e}=s;this.color=t,e&&(this.opacity=e)}get value(){const s={color:this.color};return this.opacity&&(s.opacity=this.opacity),s}onColorInput(s){s.stopPropagation();const{value:t}=this._colorInput;t&&(this.color=t.value,this.dispatchEvent(this.onValueChange))}onTextInput(s){s.stopPropagation();const{value:t}=this._textInput;if(!t)return;const{value:e}=t;let i=e.replace(/[^a-fA-F0-9]/g,"");i.startsWith("#")||(i=`#${i}`),t.value=i.slice(0,7),t.value.length===7&&(this.color=t.value,this.dispatchEvent(this.onValueChange))}focus(){const{value:s}=this._colorInput;s&&s.click()}render(){return H`
      <div class="parent">
        <bim-input
          .label=${this.label}
          .icon=${this.icon}
          .vertical="${this.vertical}"
        >
          <div class="color-container">
            <div
              style="display: flex; align-items: center; gap: .375rem; height: 100%; flex: 1; padding: 0 0.5rem;"
            >
              <input
                ${Qt(this._colorInput)}
                @input="${this.onColorInput}"
                type="color"
                aria-label=${this.label||this.name||"Color Input"}
                value="${this.color}"
                ?disabled=${this.disabled}
              />
              <div
                @click=${this.focus}
                class="sample"
                style="background-color: ${this.color}"
              ></div>
              <input
                ${Qt(this._textInput)}
                @input="${this.onTextInput}"
                value="${this.color}"
                type="text"
                aria-label=${this.label||this.name||"Text Color Input"}
                ?disabled=${this.disabled}
              />
            </div>
            ${this.opacity!==void 0?H`<bim-number-input
                  @change=${this.onOpacityInput}
                  slider
                  suffix="%"
                  min="0"
                  value=${this.opacity}
                  max="100"
                ></bim-number-input>`:null}
          </div>
        </bim-input>
      </div>
    `}};_f.styles=At`
    :host {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
      flex: 1;
      display: block;
    }

    :host(:focus) {
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(--bim-ui_accent-base);
    }

    .parent {
      display: flex;
      gap: 0.375rem;
    }

    .color-container {
      position: relative;
      outline: none;
      display: flex;
      height: 100%;
      gap: 0.5rem;
      justify-content: flex-start;
      align-items: center;
      flex: 1;
      border-radius: var(--bim-color-input--bdrs, var(--bim-ui_size-4xs));
    }

    .color-container input[type="color"] {
      position: absolute;
      bottom: -0.25rem;
      visibility: hidden;
      width: 0;
      height: 0;
    }

    .color-container .sample {
      width: 1rem;
      height: 1rem;
      border-radius: 0.125rem;
      background-color: #fff;
    }

    .color-container input[type="text"] {
      height: 100%;
      flex: 1;
      width: 3.25rem;
      text-transform: uppercase;
      font-size: 0.75rem;
      background-color: transparent;
      padding: 0%;
      outline: none;
      border: none;
      color: var(--bim-color-input--c, var(--bim-ui_bg-contrast-100));
    }

    :host([disabled]) .color-container input[type="text"] {
      color: var(--bim-ui_bg-contrast-60);
    }

    bim-number-input {
      flex-grow: 0;
    }
  `;let Wi=_f;fs([W({type:String,reflect:!0})],Wi.prototype,"name");fs([W({type:String,reflect:!0})],Wi.prototype,"label");fs([W({type:String,reflect:!0})],Wi.prototype,"icon");fs([W({type:Boolean,reflect:!0})],Wi.prototype,"vertical");fs([W({type:Number,reflect:!0})],Wi.prototype,"opacity");fs([W({type:String,reflect:!0})],Wi.prototype,"color");fs([W({type:Boolean,reflect:!0})],Wi.prototype,"disabled");var e1=Object.defineProperty,i1=Object.getOwnPropertyDescriptor,Yi=(s,t,e,i)=>{for(var n=i>1?void 0:i?i1(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&e1(t,e,n),n};const wf=class extends Ct{constructor(){super(...arguments),this.checked=!1,this.checkbox=!1,this.noMark=!1,this.vertical=!1}get value(){return this._value!==void 0?this._value:this.label?ea(this.label):this.label}set value(s){this._value=s}render(){return H`
      <div class="parent" .title=${this.label??""}>
        ${this.img||this.icon||this.label?H` <div style="display: flex; column-gap: 0.375rem">
              ${this.checkbox&&!this.noMark?H`<bim-checkbox
                    style="pointer-events: none"
                    .checked=${this.checked}
                  ></bim-checkbox>`:null}
              <bim-label
                .vertical=${this.vertical}
                .icon=${this.icon}
                .img=${this.img}
                >${this.label}</bim-label
              >
            </div>`:null}
        ${!this.checkbox&&!this.noMark&&this.checked?H`<svg
              xmlns="http://www.w3.org/2000/svg"
              height="1.125rem"
              viewBox="0 0 24 24"
              width="1.125rem"
              fill="#FFFFFF"
            >
              <path d="M0 0h24v24H0z" fill="none" />
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
            </svg>`:null}
        <slot></slot>
      </div>
    `}};wf.styles=At`
    :host {
      --bim-label--c: var(--bim-ui_bg-contrast-100);
      display: block;
      box-sizing: border-box;
      flex: 1;
      padding: 0rem 0.5rem;
      border-radius: var(--bim-ui_size-4xs);
      transition: all 0.15s;
    }

    :host(:hover) {
      cursor: pointer;
    }

    :host([checked]) {
      --bim-label--c: color-mix(in lab, var(--bim-ui_main-base), white 30%);
    }

    :host([checked]) svg {
      fill: color-mix(in lab, var(--bim-ui_main-base), white 30%);
    }

    .parent {
      box-sizing: border-box;
      display: flex;
      justify-content: var(--bim-option--jc, space-between);
      column-gap: 0.5rem;
      align-items: center;
      min-height: 1.75rem;
      height: 100%;
    }

    input {
      height: 1rem;
      width: 1rem;
      cursor: pointer;
      border: none;
      outline: none;
      accent-color: var(--bim-checkbox--c, var(--bim-ui_main-base));
    }

    input:focus {
      outline: var(--bim-checkbox--olw, 2px) solid
        var(--bim-checkbox--olc, var(--bim-ui_accent-base));
    }

    bim-label {
      pointer-events: none;
      z-index: 1;
    }
  `;let Xt=wf;Yi([W({type:String,reflect:!0})],Xt.prototype,"img",2);Yi([W({type:String,reflect:!0})],Xt.prototype,"label",2);Yi([W({type:String,reflect:!0})],Xt.prototype,"icon",2);Yi([W({type:Boolean,reflect:!0})],Xt.prototype,"checked",2);Yi([W({type:Boolean,reflect:!0})],Xt.prototype,"checkbox",2);Yi([W({type:Boolean,attribute:"no-mark",reflect:!0})],Xt.prototype,"noMark",2);Yi([W({converter:{fromAttribute(s){return s&&ea(s)}}})],Xt.prototype,"value",1);Yi([W({type:Boolean,reflect:!0})],Xt.prototype,"vertical",2);var s1=Object.defineProperty,n1=Object.getOwnPropertyDescriptor,_i=(s,t,e,i)=>{for(var n=i>1?void 0:i?n1(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&s1(t,e,n),n};const xf=class extends qt{constructor(){super(),this.multiple=!1,this.required=!1,this.vertical=!1,this._visible=!1,this._value=new Set,this.onValueChange=new Event("change"),this._contextMenu=nn(),this.onOptionClick=s=>{const t=s.target,e=this._value.has(t);if(!this.multiple&&!this.required&&!e)this._value=new Set([t]);else if(!this.multiple&&!this.required&&e)this._value=new Set([]);else if(!this.multiple&&this.required&&!e)this._value=new Set([t]);else if(this.multiple&&!this.required&&!e)this._value=new Set([...this._value,t]);else if(this.multiple&&!this.required&&e){const i=[...this._value].filter(n=>n!==t);this._value=new Set(i)}else if(this.multiple&&this.required&&!e)this._value=new Set([...this._value,t]);else if(this.multiple&&this.required&&e){const i=[...this._value].filter(r=>r!==t),n=new Set(i);n.size!==0&&(this._value=n)}this.updateOptionsState(),this.dispatchEvent(this.onValueChange)},this.useObserver=!0}set visible(s){if(s){const{value:t}=this._contextMenu;if(!t)return;for(const e of this.elements)t.append(e);this._visible=!0}else{for(const t of this.elements)this.append(t);this._visible=!1,this.resetVisibleElements()}}get visible(){return this._visible}set value(s){if(this.required&&Object.keys(s).length===0)return;const t=new Set;for(const e of s){const i=this.findOption(e);if(i&&(t.add(i),!this.multiple&&Object.keys(s).length===1))break}this._value=t,this.updateOptionsState(),this.dispatchEvent(this.onValueChange)}get value(){return[...this._value].filter(s=>s instanceof Xt&&s.checked).map(s=>s.value)}get _options(){const s=new Set([...this.elements]);for(const t of this.children)t instanceof Xt&&s.add(t);return[...s]}onSlotChange(s){const t=s.target.assignedElements();this.observe(t);const e=new Set;for(const i of this.elements){if(!(i instanceof Xt)){i.remove();continue}i.checked&&e.add(i),i.removeEventListener("click",this.onOptionClick),i.addEventListener("click",this.onOptionClick)}this._value=e}updateOptionsState(){for(const s of this._options)s instanceof Xt&&(s.checked=this._value.has(s))}findOption(s){return this._options.find(t=>t instanceof Xt?t.label===s||t.value===s:!1)}render(){let s,t,e;if(this._value.size===0)s=this.placeholder??"Select an option...";else if(this._value.size===1){const i=[...this._value][0];s=(i==null?void 0:i.label)||(i==null?void 0:i.value),t=i==null?void 0:i.img,e=i==null?void 0:i.icon}else s=`Multiple (${this._value.size})`;return H`
      <bim-input
        title=${this.label??""}
        .label=${this.label}
        .icon=${this.icon}
        .vertical=${this.vertical}
      >
        <div class="input" @click=${()=>this.visible=!this.visible}>
          <bim-label
            .img=${t}
            .icon=${e}
            style="overflow: hidden;"
            >${s}</bim-label
          >
          <svg
            style="flex-shrink: 0; fill: var(--bim-dropdown--c, var(--bim-ui_bg-contrast-100))"
            xmlns="http://www.w3.org/2000/svg"
            height="1.125rem"
            viewBox="0 0 24 24"
            width="1.125rem"
            fill="#9ca3af"
          >
            <path d="M0 0h24v24H0V0z" fill="none" />
            <path d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
          </svg>
          <bim-context-menu
            ${Qt(this._contextMenu)}
            .visible=${this.visible}
            @hidden=${()=>{this.visible&&(this.visible=!1)}}
          >
            <slot @slotchange=${this.onSlotChange}></slot>
          </bim-context-menu>
        </div>
      </bim-input>
    `}};xf.styles=[qi.scrollbar,At`
      :host {
        --bim-input--bgc: var(
          --bim-dropdown--bgc,
          var(--bim-ui_bg-contrast-20)
        );
        --bim-input--olw: 2px;
        --bim-input--olc: transparent;
        --bim-input--bdrs: var(--bim-ui_size-4xs);
        flex: 1;
        display: block;
      }

      :host([visible]) {
        --bim-input--olc: var(--bim-ui_accent-base);
      }

      .input {
        --bim-label--fz: var(--bim-drodown--fz, var(--bim-ui_size-xs));
        --bim-label--c: var(--bim-dropdown--c, var(--bim-ui_bg-contrast-100));
        height: 100%;
        display: flex;
        flex: 1;
        overflow: hidden;
        column-gap: 0.25rem;
        outline: none;
        cursor: pointer;
        align-items: center;
        justify-content: space-between;
        padding: 0 0.5rem;
      }

      bim-label {
        pointer-events: none;
      }
    `];let oi=xf;_i([W({type:String,reflect:!0})],oi.prototype,"name",2);_i([W({type:String,reflect:!0})],oi.prototype,"icon",2);_i([W({type:String,reflect:!0})],oi.prototype,"label",2);_i([W({type:Boolean,reflect:!0})],oi.prototype,"multiple",2);_i([W({type:Boolean,reflect:!0})],oi.prototype,"required",2);_i([W({type:Boolean,reflect:!0})],oi.prototype,"vertical",2);_i([W({type:String,reflect:!0})],oi.prototype,"placeholder",2);_i([W({type:Boolean,reflect:!0})],oi.prototype,"visible",1);_i([ps()],oi.prototype,"_value",2);var r1=Object.defineProperty,Cf=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&r1(t,e,n),n};const Ef=class extends Ct{constructor(){super(...arguments),this.floating=!1,this._layouts={},this._elements={},this._templateIds=new Map,this._updateFunctions={},this._slotNames={notAllowed:"not-allowed",notFound:"not-found",emptyLayout:"empty-layout"},this.updateComponent={},this.emitLayoutChange=()=>{this.dispatchEvent(new Event("layoutchange"))}}set layouts(s){this._layouts=s,this._templateIds.clear()}get layouts(){return this._layouts}set elements(s){this._elements=s,this.setUpdateFunctions()}get elements(){return this._elements}getLayoutAreas(s){const{template:t}=s,e=t.split(`
`).map(i=>i.trim()).map(i=>i.split('"')[1]).filter(i=>i!==void 0).flatMap(i=>i.split(/\s+/));return[...new Set(e)].filter(i=>i!=="")}setUpdateFunctions(){const s={};for(const[t,e]of Object.entries(this.elements))"template"in e&&(s[t]=i=>{var n,r;(r=(n=this._updateFunctions)[t])==null||r.call(n,i)});this.updateComponent=s}disconnectedCallback(){super.disconnectedCallback(),this._templateIds.clear(),this._updateFunctions={},this.updateComponent={}}getTemplateId(s){let t=this._templateIds.get(s);return t||(t=ae.newRandomId(),this._templateIds.set(s,t)),t}cleanUpdateFunctions(){if(!this.layout){this._updateFunctions={};return}const s=this.layouts[this.layout],t=this.getLayoutAreas(s);for(const e in this.elements)t.includes(e)||delete this._updateFunctions[e]}clean(){this.style.gridTemplate="";for(const s of[...this.children])Object.values(this._slotNames).some(t=>s.getAttribute("slot")===t)||s.remove();this.cleanUpdateFunctions()}emitElementCreation(s){this.dispatchEvent(new CustomEvent("elementcreated",{detail:s}))}render(){if(this.layout){const s=this.layouts[this.layout];if(s){if(!(s.guard??(()=>!0))())return this.clean(),H`<slot name=${this._slotNames.notAllowed}></slot>`;const t=this.getLayoutAreas(s).map(e=>{var i;const n=((i=s.elements)==null?void 0:i[e])||this.elements[e];if(!n)return null;if(n instanceof HTMLElement)return n.style.gridArea=e,n;if("template"in n){const{template:l,initialState:c}=n,h=this.getTemplateId(l),d=this.querySelector(`[data-grid-template-id="${h}"]`);if(d)return d;const[p,u]=qt.create(l,c);return this.emitElementCreation({name:e,element:p}),p.setAttribute("data-grid-template-id",h),p.style.gridArea=e,this._updateFunctions[e]=u,p}const r=this.getTemplateId(n),o=this.querySelector(`[data-grid-template-id="${r}"]`);if(o)return o;const a=qt.create(n);return this.emitElementCreation({name:e,element:a}),a.setAttribute("data-grid-template-id",this.getTemplateId(n)),a.style.gridArea=e,a}).filter(e=>e!==null);this.clean(),this.style.gridTemplate=s.template,this.append(...t),this.emitLayoutChange()}else return this.clean(),H`<slot name=${this._slotNames.notFound}></slot>`}else return this.clean(),this.emitLayoutChange(),H`<slot name=${this._slotNames.emptyLayout}></slot>`;return H`${H`<slot></slot>`}`}};Ef.styles=At`
    :host {
      display: grid;
      height: 100%;
      width: 100%;
      overflow: hidden;
      box-sizing: border-box;
    }

    /* :host(:not([layout])) {
      display: none;
    } */

    :host([floating]) {
      --bim-panel--bdrs: var(--bim-ui_size-4xs);
      background-color: transparent;
      padding: 1rem;
      gap: 1rem;
      position: absolute;
      pointer-events: none;
      top: 0px;
      left: 0px;
    }

    :host(:not([floating])) {
      --bim-panel--bdrs: 0;
      background-color: var(--bim-ui_bg-contrast-20);
      gap: 1px;
    }
  `;let xc=Ef;Cf([W({type:Boolean,reflect:!0})],xc.prototype,"floating");Cf([W({type:String,reflect:!0})],xc.prototype,"layout");const zl=class extends Ct{render(){return H`
      <iconify-icon .icon=${this.icon} height="none"></iconify-icon>
    `}};zl.styles=At`
    :host {
      height: var(--bim-icon--fz, var(--bim-ui_size-sm));
      width: var(--bim-icon--fz, var(--bim-ui_size-sm));
    }

    iconify-icon {
      height: var(--bim-icon--fz, var(--bim-ui_size-sm));
      width: var(--bim-icon--fz, var(--bim-ui_size-sm));
      color: var(--bim-icon--c);
      transition: all 0.15s;
      display: flex;
    }
  `,zl.properties={icon:{type:String}};let o1=zl;var a1=Object.defineProperty,ia=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&a1(t,e,n),n};const Sf=class extends Ct{constructor(){super(...arguments),this.vertical=!1,this.onValueChange=new Event("change")}get value(){const s={};for(const t of this.children){const e=t;"value"in e?s[e.name||e.label]=e.value:"checked"in e&&(s[e.name||e.label]=e.checked)}return s}set value(s){const t=[...this.children];for(const e in s){const i=t.find(o=>{const a=o;return a.name===e||a.label===e});if(!i)continue;const n=i,r=s[e];typeof r=="boolean"?n.checked=r:n.value=r}}render(){return H`
      <div class="parent">
        ${this.label||this.icon?H`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        <div class="input">
          <slot></slot>
        </div>
      </div>
    `}};Sf.styles=At`
    :host {
      flex: 1;
      display: block;
    }

    .parent {
      display: flex;
      flex-wrap: wrap;
      column-gap: 1rem;
      row-gap: 0.375rem;
      user-select: none;
      flex: 1;
    }

    :host(:not([vertical])) .parent {
      justify-content: space-between;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    .input {
      position: relative;
      overflow: hidden;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      min-height: 1.75rem;
      min-width: 3rem;
      gap: var(--bim-input--g, var(--bim-ui_size-4xs));
      padding: var(--bim-input--p, 0);
      background-color: var(--bim-input--bgc, transparent);
      border: var(--bim-input--olw, 2px) solid
        var(--bim-input--olc, transparent);
      border-radius: var(--bim-input--bdrs, var(--bim-ui_size-4xs));
      transition: all 0.15s;
    }

    :host(:not([vertical])) .input {
      flex: 1;
      justify-content: flex-end;
    }

    :host(:not([vertical])[label]) .input {
      max-width: fit-content;
    }
  `;let _r=Sf;ia([W({type:String,reflect:!0})],_r.prototype,"name");ia([W({type:String,reflect:!0})],_r.prototype,"label");ia([W({type:String,reflect:!0})],_r.prototype,"icon");ia([W({type:Boolean,reflect:!0})],_r.prototype,"vertical");/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Hs(s,t,e){return s?t(s):e==null?void 0:e(s)}/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Dl=s=>s??It;var l1=Object.defineProperty,wr=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&l1(t,e,n),n};const Af=class extends Ct{constructor(){super(...arguments),this.labelHidden=!1,this.iconHidden=!1,this.vertical=!1,this._imgTemplate=()=>H`<img src=${Dl(this.img)} .alt=${this.textContent||""} />`,this._iconTemplate=()=>H`<bim-icon .icon=${this.icon}></bim-icon>`}get value(){return this.textContent?ea(this.textContent):this.textContent}render(){return H`
      <div class="parent" title=${this.textContent}>
        ${Hs(this.img,this._imgTemplate,()=>It)}
        ${Hs(!this.iconHidden&&this.icon,this._iconTemplate,()=>It)}
        <p><slot></slot></p>
      </div>
    `}};Af.styles=At`
    :host {
      --bim-icon--c: var(--bim-label--ic);
      overflow: auto;
      color: var(--bim-label--c, var(--bim-ui_bg-contrast-60));
      font-size: var(--bim-label--fz, var(--bim-ui_size-xs));
      display: block;
      white-space: nowrap;
      transition: all 0.15s;
    }

    :host([icon]) {
      line-height: 1.1rem;
    }

    .parent {
      display: flex;
      align-items: center;
      column-gap: 0.25rem;
      row-gap: 0.125rem;
      user-select: none;
      height: 100%;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    .parent p {
      margin: 0;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    :host([label-hidden]) .parent p,
    :host(:empty) .parent p {
      display: none;
    }

    img {
      height: 100%;
      aspect-ratio: 1;
      border-radius: 100%;
      margin-right: 0.125rem;
    }

    :host(:not([vertical])) img {
      max-height: var(
        --bim-label_icon--sz,
        calc(var(--bim-label--fz, var(--bim-ui_size-xs)) * 1.8)
      );
    }

    :host([vertical]) img {
      max-height: var(
        --bim-label_icon--sz,
        calc(var(--bim-label--fz, var(--bim-ui_size-xs)) * 4)
      );
    }
  `;let hn=Af;wr([W({type:String,reflect:!0})],hn.prototype,"img");wr([W({type:Boolean,attribute:"label-hidden",reflect:!0})],hn.prototype,"labelHidden");wr([W({type:String,reflect:!0})],hn.prototype,"icon");wr([W({type:Boolean,attribute:"icon-hidden",reflect:!0})],hn.prototype,"iconHidden");wr([W({type:Boolean,reflect:!0})],hn.prototype,"vertical");var c1=Object.defineProperty,h1=Object.getOwnPropertyDescriptor,Be=(s,t,e,i)=>{for(var n=i>1?void 0:i?h1(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&c1(t,e,n),n};const $f=class extends Ct{constructor(){super(...arguments),this._value=0,this.vertical=!1,this.slider=!1,this._input=nn(),this.onValueChange=new Event("change")}set value(s){this.setValue(s.toString())}get value(){return this._value}onChange(s){s.stopPropagation();const{value:t}=this._input;t&&this.setValue(t.value)}setValue(s){const{value:t}=this._input;let e=s;if(e=e.replace(/[^0-9.-]/g,""),e=e.replace(/(\..*)\./g,"$1"),e.endsWith(".")||(e.lastIndexOf("-")>0&&(e=e[0]+e.substring(1).replace(/-/g,"")),e==="-"||e==="-0"))return;let i=Number(e);Number.isNaN(i)||(i=this.min!==void 0?Math.max(i,this.min):i,i=this.max!==void 0?Math.min(i,this.max):i,this.value!==i&&(this._value=i,t&&(t.value=this.value.toString()),this.requestUpdate(),this.dispatchEvent(this.onValueChange)))}onBlur(){const{value:s}=this._input;s&&Number.isNaN(Number(s.value))&&(s.value=this.value.toString())}onSliderMouseDown(s){document.body.style.cursor="w-resize";const{clientX:t}=s,e=this.value;let i=!1;const n=a=>{var l;i=!0;const{clientX:c}=a,h=this.step??1,d=((l=h.toString().split(".")[1])==null?void 0:l.length)||0,p=1/(this.sensitivity??1),u=(c-t)/p;if(Math.floor(Math.abs(u))!==Math.abs(u))return;const g=e+u*h;this.setValue(g.toFixed(d))},r=()=>{this.slider=!0,this.removeEventListener("blur",r)},o=()=>{document.removeEventListener("mousemove",n),document.body.style.cursor="default",i?i=!1:(this.addEventListener("blur",r),this.slider=!1,requestAnimationFrame(()=>this.focus())),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)}onFocus(s){s.stopPropagation();const t=e=>{e.key==="Escape"&&(this.blur(),window.removeEventListener("keydown",t))};window.addEventListener("keydown",t)}connectedCallback(){super.connectedCallback(),this.min&&this.min>this.value&&(this._value=this.min),this.max&&this.max<this.value&&(this._value=this.max)}focus(){const{value:s}=this._input;s&&s.focus()}render(){const s=H`
      ${this.pref||this.icon?H`<bim-label
            style="pointer-events: auto"
            @mousedown=${this.onSliderMouseDown}
            .icon=${this.icon}
            >${this.pref}</bim-label
          >`:null}
      <input
        ${Qt(this._input)}
        type="text"
        aria-label=${this.label||this.name||"Number Input"}
        size="1"
        @input=${o=>o.stopPropagation()}
        @change=${this.onChange}
        @blur=${this.onBlur}
        @focus=${this.onFocus}
        .value=${this.value.toString()}
      />
      ${this.suffix?H`<bim-label
            style="pointer-events: auto"
            @mousedown=${this.onSliderMouseDown}
            >${this.suffix}</bim-label
          >`:null}
    `,t=this.min??-1/0,e=this.max??1/0,i=100*(this.value-t)/(e-t),n=H`
      <style>
        .slider-indicator {
          width: ${`${i}%`};
        }
      </style>
      <div class="slider" @mousedown=${this.onSliderMouseDown}>
        <div class="slider-indicator"></div>
        ${this.pref||this.icon?H`<bim-label
              style="z-index: 1; margin-right: 0.125rem"
              .icon=${this.icon}
              >${`${this.pref}: `}</bim-label
            >`:null}
        <bim-label style="z-index: 1;">${this.value}</bim-label>
        ${this.suffix?H`<bim-label style="z-index: 1;">${this.suffix}</bim-label>`:null}
      </div>
    `,r=`${this.label||this.name||this.pref?`${this.label||this.name||this.pref}: `:""}${this.value}${this.suffix??""}`;return H`
      <bim-input
        title=${r}
        .label=${this.label}
        .icon=${this.icon}
        .vertical=${this.vertical}
      >
        ${this.slider?n:s}
      </bim-input>
    `}};$f.styles=At`
    :host {
      --bim-input--bgc: var(
        --bim-number-input--bgc,
        var(--bim-ui_bg-contrast-20)
      );
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(--bim-number-input--olc, transparent);
      --bim-input--bdrs: var(--bim-number-input--bdrs, var(--bim-ui_size-4xs));
      --bim-input--p: 0 0.375rem;
      flex: 1;
      display: block;
    }

    :host(:focus) {
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(
        --bim-number-input¡focus--c,
        var(--bim-ui_accent-base)
      );
    }

    :host(:not([slider])) bim-label {
      --bim-label--c: var(
        --bim-number-input_affixes--c,
        var(--bim-ui_bg-contrast-60)
      );
      --bim-label--fz: var(
        --bim-number-input_affixes--fz,
        var(--bim-ui_size-xs)
      );
    }

    p {
      margin: 0;
      padding: 0;
    }

    input {
      background-color: transparent;
      outline: none;
      border: none;
      padding: 0;
      flex-grow: 1;
      text-align: right;
      font-family: inherit;
      font-feature-settings: inherit;
      font-variation-settings: inherit;
      font-size: var(--bim-number-input--fz, var(--bim-ui_size-xs));
      color: var(--bim-number-input--c, var(--bim-ui_bg-contrast-100));
    }

    :host([suffix]:not([pref])) input {
      text-align: left;
    }

    :host([slider]) {
      --bim-input--p: 0;
    }

    :host([slider]) .slider {
      --bim-label--c: var(--bim-ui_bg-contrast-100);
    }

    .slider {
      position: relative;
      display: flex;
      justify-content: center;
      width: 100%;
      height: 100%;
      padding: 0 0.5rem;
    }

    .slider-indicator {
      height: 100%;
      background-color: var(--bim-ui_main-base);
      position: absolute;
      top: 0;
      left: 0;
      border-radius: var(--bim-input--bdrs, var(--bim-ui_size-4xs));
    }

    bim-input {
      display: flex;
    }

    bim-label {
      pointer-events: none;
    }
  `;let Ee=$f;Be([W({type:String,reflect:!0})],Ee.prototype,"name",2);Be([W({type:String,reflect:!0})],Ee.prototype,"icon",2);Be([W({type:String,reflect:!0})],Ee.prototype,"label",2);Be([W({type:String,reflect:!0})],Ee.prototype,"pref",2);Be([W({type:Number,reflect:!0})],Ee.prototype,"min",2);Be([W({type:Number,reflect:!0})],Ee.prototype,"value",1);Be([W({type:Number,reflect:!0})],Ee.prototype,"step",2);Be([W({type:Number,reflect:!0})],Ee.prototype,"sensitivity",2);Be([W({type:Number,reflect:!0})],Ee.prototype,"max",2);Be([W({type:String,reflect:!0})],Ee.prototype,"suffix",2);Be([W({type:Boolean,reflect:!0})],Ee.prototype,"vertical",2);Be([W({type:Boolean,reflect:!0})],Ee.prototype,"slider",2);var d1=Object.defineProperty,u1=Object.getOwnPropertyDescriptor,xr=(s,t,e,i)=>{for(var n=i>1?void 0:i?u1(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&d1(t,e,n),n};const Tf=class extends Ct{constructor(){super(...arguments),this.onValueChange=new Event("change"),this._hidden=!1,this.headerHidden=!1,this.valueTransform={},this.activationButton=document.createElement("bim-button")}set hidden(s){this._hidden=s,this.activationButton.active=!s,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}get value(){return dr(this,this.valueTransform)}set value(s){const t=[...this.children];for(const e in s){const i=t.find(r=>{const o=r;return o.name===e||o.label===e});if(!i)continue;const n=i;n.value=s[e]}}animatePanles(){const s=[{maxHeight:"100vh",maxWidth:"100vw",opacity:1},{maxHeight:"100vh",maxWidth:"100vw",opacity:0},{maxHeight:0,maxWidth:0,opacity:0}];this.animate(s,{duration:300,easing:"cubic-bezier(0.65, 0.05, 0.36, 1)",direction:this.hidden?"normal":"reverse",fill:"forwards"})}connectedCallback(){super.connectedCallback(),this.activationButton.active=!this.hidden,this.activationButton.onclick=()=>{this.hidden=!this.hidden,this.animatePanles()}}disconnectedCallback(){super.disconnectedCallback(),this.activationButton.remove()}collapseSections(){const s=this.querySelectorAll("bim-panel-section");for(const t of s)t.collapsed=!0}expandSections(){const s=this.querySelectorAll("bim-panel-section");for(const t of s)t.collapsed=!1}render(){return this.activationButton.icon=this.icon,this.activationButton.label=this.label||this.name,this.activationButton.tooltipTitle=this.label||this.name,H`
      <div class="parent">
        ${this.label||this.name||this.icon?H`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        <div class="sections">
          <slot></slot>
        </div>
      </div>
    `}};Tf.styles=[qi.scrollbar,At`
      :host {
        display: flex;
        border-radius: var(--bim-ui_size-base);
        background-color: var(--bim-ui_bg-base);
        overflow: auto;
      }

      :host([hidden]) {
        max-height: 0;
        max-width: 0;
        opacity: 0;
      }

      .parent {
        display: flex;
        flex: 1;
        flex-direction: column;
        pointer-events: auto;
        overflow: auto;
      }

      .parent bim-label {
        --bim-label--c: var(--bim-panel--c, var(--bim-ui_bg-contrast-80));
        --bim-label--fz: var(--bim-panel--fz, var(--bim-ui_size-sm));
        font-weight: 600;
        padding: 1rem;
        flex-shrink: 0;
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([header-hidden]) .parent bim-label {
        display: none;
      }

      .sections {
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow: auto;
        flex: 1;
      }

      ::slotted(bim-panel-section:not(:last-child)) {
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }
    `];let ms=Tf;xr([W({type:String,reflect:!0})],ms.prototype,"icon",2);xr([W({type:String,reflect:!0})],ms.prototype,"name",2);xr([W({type:String,reflect:!0})],ms.prototype,"label",2);xr([W({type:Boolean,reflect:!0})],ms.prototype,"hidden",1);xr([W({type:Boolean,attribute:"header-hidden",reflect:!0})],ms.prototype,"headerHidden",2);var p1=Object.defineProperty,Cr=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&p1(t,e,n),n};const kf=class extends Ct{constructor(){super(...arguments),this.onValueChange=new Event("change"),this.valueTransform={},this.componentHeight=-1}get value(){const s=this.parentElement;let t;return s instanceof ms&&(t=s.valueTransform),Object.values(this.valueTransform).length!==0&&(t=this.valueTransform),dr(this,t)}set value(s){const t=[...this.children];for(const e in s){const i=t.find(r=>{const o=r;return o.name===e||o.label===e});if(!i)continue;const n=i;n.value=s[e]}}setFlexAfterTransition(){var s;const t=(s=this.shadowRoot)==null?void 0:s.querySelector(".components");t&&setTimeout(()=>{this.collapsed?t.style.removeProperty("flex"):t.style.setProperty("flex","1")},150)}animateHeader(){var s;const t=(s=this.shadowRoot)==null?void 0:s.querySelector(".components");this.componentHeight<0&&(this.collapsed?this.componentHeight=t.clientHeight:(t.style.setProperty("transition","none"),t.style.setProperty("height","auto"),t.style.setProperty("padding","0.125rem 1rem 1rem"),this.componentHeight=t.clientHeight,requestAnimationFrame(()=>{t.style.setProperty("height","0px"),t.style.setProperty("padding","0 1rem 0"),t.style.setProperty("transition","height 0.25s cubic-bezier(0.65, 0.05, 0.36, 1), padding 0.25s cubic-bezier(0.65, 0.05, 0.36, 1)")}))),this.collapsed?(t.style.setProperty("height",`${this.componentHeight}px`),requestAnimationFrame(()=>{t.style.setProperty("height","0px"),t.style.setProperty("padding","0 1rem 0")})):(t.style.setProperty("height","0px"),t.style.setProperty("padding","0 1rem 0"),requestAnimationFrame(()=>{t.style.setProperty("height",`${this.componentHeight}px`),t.style.setProperty("padding","0.125rem 1rem 1rem")})),this.setFlexAfterTransition()}onHeaderClick(){this.fixed||(this.collapsed=!this.collapsed,this.animateHeader())}handelSlotChange(s){s.target.assignedElements({flatten:!0}).forEach((t,e)=>{const i=e*.05;t.style.setProperty("transition-delay",`${i}s`)})}handlePointerEnter(){const s=this.renderRoot.querySelector(".expand-icon");this.collapsed?s==null||s.style.setProperty("animation","collapseAnim 0.5s"):s==null||s.style.setProperty("animation","expandAnim 0.5s")}handlePointerLeave(){const s=this.renderRoot.querySelector(".expand-icon");s==null||s.style.setProperty("animation","none")}render(){const s=this.label||this.icon||this.name||this.fixed,t=H`<svg
      xmlns="http://www.w3.org/2000/svg"
      height="1.125rem"
      viewBox="0 0 24 24"
      width="1.125rem"
      class="expand-icon"
    >
      <path d="M0 0h24v24H0z" fill="none" />
      <path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z" />
    </svg>`,e=H`
      <div
        class="header"
        title=${this.label??""}
        @pointerenter=${this.handlePointerEnter}
        @pointerleave=${this.handlePointerLeave}
        @click=${this.onHeaderClick}
      >
        ${this.label||this.icon||this.name?H`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        ${this.fixed?null:t}
      </div>
    `;return H`
      <div class="parent">
        ${s?e:null}
        <div class="components" style="flex: 1;">
          <div>
            <slot @slotchange=${this.handelSlotChange}></slot>
          </div>
        </div>
      </div>
    `}};kf.styles=[qi.scrollbar,At`
      :host {
        display: block;
        pointer-events: auto;
      }

      :host .parent {
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      :host(:not([fixed])) .header:hover {
        --bim-label--c: var(--bim-ui_accent-base);
        color: var(--bim-ui_accent-base);
        cursor: pointer;
      }

      :host(:not([fixed])) .header:hover .expand-icon {
        fill: var(--bim-ui_accent-base);
      }

      .header {
        --bim-label--fz: var(--bim-ui_size-sm);
        --bim-label--c: var(
          --bim-panel-section_hc,
          var(--bim-ui_bg-contrast-80)
        );
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        height: 1.5rem;
        padding: 0.75rem 1rem;
      }

      .expand-icon {
        fill: var(--bim-ui_bg-contrast-80);
        transition: transform 0.2s;
      }

      :host([collapsed]) .expand-icon {
        transform: rotateZ(-180deg);
      }

      .title {
        display: flex;
        align-items: center;
        column-gap: 0.5rem;
      }

      .title p {
        font-size: var(--bim-ui_size-sm);
      }

      .components {
        display: flex;
        flex-direction: column;
        overflow: hidden;
        row-gap: 0.75rem;
        padding: 0 1rem 1rem;
        box-sizing: border-box;
        transition:
          height 0.25s cubic-bezier(0.65, 0.05, 0.36, 1),
          padding 0.25s cubic-bezier(0.65, 0.05, 0.36, 1);
      }

      .components > div {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        flex: 1;
        overflow: auto;
      }

      :host(:not([icon]):not([label])) .components {
        padding: 1rem;
      }

      :host(:not([fixed])[collapsed]) .components {
        padding: 0 1rem 0;
        height: 0px;
      }

      bim-label {
        pointer-events: none;
      }

      ::slotted(*) {
        transition:
          transform 0.25s cubic-bezier(0.65, 0.05, 0.36, 1),
          opacity 0.25s cubic-bezier(0.65, 0.05, 0.36, 1);
      }

      :host(:not([fixed])[collapsed]) ::slotted(*) {
        transform: translateX(-20%);
        opacity: 0;
      }

      @keyframes expandAnim {
        0%,
        100% {
          transform: translateY(0%);
        }
        25% {
          transform: translateY(-30%);
        }
        50% {
          transform: translateY(10%);
        }
        75% {
          transform: translateY(-30%);
        }
      }

      @keyframes collapseAnim {
        0%,
        100% {
          transform: translateY(0%) rotateZ(-180deg);
        }
        25% {
          transform: translateY(30%) rotateZ(-180deg);
        }
        50% {
          transform: translateY(-10%) rotateZ(-180deg);
        }
        75% {
          transform: translateY(30%) rotateZ(-180deg);
        }
      }
    `];let dn=kf;Cr([W({type:String,reflect:!0})],dn.prototype,"icon");Cr([W({type:String,reflect:!0})],dn.prototype,"label");Cr([W({type:String,reflect:!0})],dn.prototype,"name");Cr([W({type:Boolean,reflect:!0})],dn.prototype,"fixed");Cr([W({type:Boolean,reflect:!0})],dn.prototype,"collapsed");var f1=Object.defineProperty,Er=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&f1(t,e,n),n};const Pf=class extends Ct{constructor(){super(...arguments),this.vertical=!1,this.onValueChange=new Event("change"),this._canEmitEvents=!1,this._value=document.createElement("bim-option"),this.onOptionClick=s=>{this._value=s.target,this.setAnimatedBackgound(),this.dispatchEvent(this.onValueChange);for(const t of this.children)t instanceof Xt&&(t.checked=t===s.target)}}get _options(){return[...this.querySelectorAll("bim-option")]}set value(s){const t=this.findOption(s);if(t){for(const e of this._options)e.checked=e===t;this._value=t,this.setAnimatedBackgound(),this._canEmitEvents&&this.dispatchEvent(this.onValueChange)}}get value(){return this._value.value}onSlotChange(s){const t=s.target.assignedElements();for(const e of t)e instanceof Xt&&(e.noMark=!0,e.removeEventListener("click",this.onOptionClick),e.addEventListener("click",this.onOptionClick))}findOption(s){return this._options.find(t=>t instanceof Xt?t.label===s||t.value===s:!1)}doubleRequestAnimationFrames(s){requestAnimationFrame(()=>requestAnimationFrame(s))}setAnimatedBackgound(s=!1){const t=this.renderRoot.querySelector(".animated-background"),e=this._value;requestAnimationFrame(()=>{var i,n,r,o;const a=(o=(r=(n=(i=e==null?void 0:e.parentElement)==null?void 0:i.shadowRoot)==null?void 0:n.querySelector("bim-input"))==null?void 0:r.shadowRoot)==null?void 0:o.querySelector(".input"),l={width:e==null?void 0:e.clientWidth,height:e==null?void 0:e.clientHeight,top:((e==null?void 0:e.offsetTop)??0)-((a==null?void 0:a.offsetTop)??0),left:((e==null?void 0:e.offsetLeft)??0)-((a==null?void 0:a.offsetLeft)??0)};t==null||t.style.setProperty("width",`${l.width}px`),t==null||t.style.setProperty("height",`${l.height}px`),t==null||t.style.setProperty("top",`${l.top}px`),t==null||t.style.setProperty("left",`${l.left}px`)}),s&&this.doubleRequestAnimationFrames(()=>{const i="ease";t==null||t.style.setProperty("transition",`width ${.3}s ${i}, height ${.3}s ${i}, top ${.3}s ${i}, left ${.3}s ${i}`)})}firstUpdated(){const s=[...this.children].find(t=>t instanceof Xt&&t.checked);s&&(this._value=s),window.addEventListener("load",()=>{this.setAnimatedBackgound(!0)}),new ResizeObserver(()=>{this.setAnimatedBackgound()}).observe(this)}render(){return H`
      <bim-input
        .vertical=${this.vertical}
        .label=${this.label}
        .icon=${this.icon}
      >
        <div class="animated-background"></div>
        <slot @slotchange=${this.onSlotChange}></slot>
      </bim-input>
    `}};Pf.styles=At`
    :host {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
      --bim-input--g: 0;
      --bim-option--jc: center;
      flex: 1;
      display: block;
    }

    ::slotted(bim-option) {
      position: relative;
      border-radius: 0;
      overflow: hidden;
      min-width: min-content;
      min-height: min-content;
      transition: background-color 0.2s;
    }

    .animated-background {
      position: absolute;
      background: var(--bim-ui_main-base);
      width: 0;
      height: 0;
      top: 0;
      left: 0;
    }

    ::slotted(bim-option[checked]) {
      --bim-label--c: var(--bim-ui_main-contrast);
    }

    ::slotted(bim-option:not([checked]):hover) {
      background-color: #0003;
    }
  `;let un=Pf;Er([W({type:String,reflect:!0})],un.prototype,"name");Er([W({type:String,reflect:!0})],un.prototype,"icon");Er([W({type:String,reflect:!0})],un.prototype,"label");Er([W({type:Boolean,reflect:!0})],un.prototype,"vertical");Er([ps()],un.prototype,"_value");const m1=()=>H`
    <style>
      div {
        display: flex;
        gap: 0.375rem;
        border-radius: 0.25rem;
        min-height: 1.25rem;
      }

      [data-type="row"] {
        background-color: var(--bim-ui_bg-contrast-10);
        animation: row-loading 1s linear infinite alternate;
        padding: 0.5rem;
      }

      [data-type="cell"] {
        background-color: var(--bim-ui_bg-contrast-20);
        flex: 0.25;
      }

      @keyframes row-loading {
        0% {
          background-color: var(--bim-ui_bg-contrast-10);
        }
        100% {
          background-color: var(--bim-ui_bg-contrast-20);
        }
      }
    </style>
    <div style="display: flex; flex-direction: column;">
      <div data-type="row" style="gap: 2rem">
        <div data-type="cell" style="flex: 1"></div>
        <div data-type="cell" style="flex: 2"></div>
        <div data-type="cell" style="flex: 1"></div>
        <div data-type="cell" style="flex: 0.5"></div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.7s5"></div>
        </div>
      </div>
    </div>
  `,g1=()=>H`
    <style>
      .loader {
        grid-area: Processing;
        position: relative;
        padding: 0.125rem;
      }
      .loader:before {
        content: "";
        position: absolute;
      }
      .loader .loaderBar {
        position: absolute;
        top: 0;
        right: 100%;
        bottom: 0;
        left: 0;
        background: var(--bim-ui_main-base);
        /* width: 25%; */
        width: 0;
        animation: borealisBar 2s linear infinite;
      }

      @keyframes borealisBar {
        0% {
          left: 0%;
          right: 100%;
          width: 0%;
        }
        10% {
          left: 0%;
          right: 75%;
          width: 25%;
        }
        90% {
          right: 0%;
          left: 75%;
          width: 25%;
        }
        100% {
          left: 100%;
          right: 0%;
          width: 0%;
        }
      }
    </style>
    <div class="loader">
      <div class="loaderBar"></div>
    </div>
  `;var b1=Object.defineProperty,y1=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&b1(t,e,n),n};const Of=class extends Ct{constructor(){super(...arguments),this.column="",this.columnIndex=0,this.table=null,this.group=null,this.row=null,this.rowData={}}get data(){return this.column?this.rowData[this.column]:null}get dataTransform(){var s,t,e,i;const n=(t=(s=this.row)==null?void 0:s.dataTransform)==null?void 0:t[this.column],r=(e=this.table)==null?void 0:e.dataTransform[this.column],o=(i=this.table)==null?void 0:i.defaultContentTemplate;return n||r||o}get templateValue(){const{data:s,rowData:t,group:e}=this,i=this.dataTransform;if(i&&s!=null&&e){const n=i(s,t,e);return typeof n=="string"||typeof n=="boolean"||typeof n=="number"?H`<bim-label>${n}</bim-label>`:n}return s!=null?H`<bim-label>${s}</bim-label>`:It}connectedCallback(){super.connectedCallback(),this.style.gridArea=this.column.toString()}render(){return H`${this.templateValue}`}};Of.styles=At`
    :host {
      padding: 0.375rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    :host([data-column-index="0"]) {
      justify-content: normal;
    }

    :host([data-column-index="0"]:not([data-cell-header]))
      ::slotted(bim-label) {
      text-align: left;
    }

    ::slotted(*) {
      --bim-input--bgc: transparent;
      --bim-input--olc: var(--bim-ui_bg-contrast-20);
      --bim-input--olw: 1px;
    }

    ::slotted(bim-input) {
      --bim-input--olw: 0;
    }
  `;let If=Of;y1([W({type:String,reflect:!0})],If.prototype,"column");const zf=class extends Ct{constructor(){super(...arguments),this._groups=[],this.group=this.closest("bim-table-group"),this._data=[],this.table=this.closest("bim-table")}get data(){var s;return((s=this.group)==null?void 0:s.data.children)??this._data}set data(s){this._data=s}clean(){for(const s of this._groups)s.remove();this._groups=[]}render(){return this.clean(),H`
      <slot></slot>
      ${this.data.map(s=>{const t=document.createElement("bim-table-group");return this._groups.push(t),t.table=this.table,t.data=s,t})}
    `}};zf.styles=At`
    :host {
      --bim-button--bgc: transparent;
      position: relative;
      display: block;
      overflow: hidden;
      grid-area: Children;
    }

    :host([hidden]) {
      height: 0;
      opacity: 0;
    }

    ::slotted(.branch.branch-vertical) {
      top: 0;
      bottom: 1.125rem;
    }
  `;let v1=zf;/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Df="important",_1=" !"+Df,ui=qp(class extends Wp{constructor(s){var t;if(super(s),s.type!==Vp.ATTRIBUTE||s.name!=="style"||((t=s.strings)==null?void 0:t.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(s){return Object.keys(s).reduce((t,e)=>{const i=s[e];return i==null?t:t+`${e=e.includes("-")?e:e.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${i};`},"")}update(s,[t]){const{style:e}=s.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(t)),this.render(t);for(const i of this.ft)t[i]==null&&(this.ft.delete(i),i.includes("-")?e.removeProperty(i):e[i]=null);for(const i in t){const n=t[i];if(n!=null){this.ft.add(i);const r=typeof n=="string"&&n.endsWith(_1);i.includes("-")||r?e.setProperty(i,r?n.slice(0,-11):n,r?Df:""):e[i]=n}}return us}});var w1=Object.defineProperty,x1=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&w1(t,e,n),n};const Mf=class extends Ct{constructor(){super(...arguments),this.childrenHidden=!0,this.table=null,this.data={data:{}}}get rowElement(){const s=this.shadowRoot;return s?s.querySelector("bim-table-row"):null}get childrenElement(){const s=this.shadowRoot;return s?s.querySelector("bim-table-children"):null}get _isChildrenEmpty(){return!(this.data.children&&this.data.children.length!==0)}connectedCallback(){super.connectedCallback(),this.table&&this.table.expanded?this.childrenHidden=!1:this.childrenHidden=!0}disconnectedCallback(){super.disconnectedCallback(),this.data={data:{}}}toggleChildren(s){this.childrenHidden=typeof s>"u"?!this.childrenHidden:!s,this.animateTableChildren(!0)}animateTableChildren(s=!0){if(!s){requestAnimationFrame(()=>{var r;const o=this.renderRoot.querySelector(".caret"),a=this.renderRoot.querySelector(".branch-vertical"),l=(r=this.renderRoot.querySelector("bim-table-children"))==null?void 0:r.querySelector(".branch-vertical");o.style.setProperty("transform",`translateY(-50%) rotate(${this.childrenHidden?"0":"90"}deg)`),a.style.setProperty("transform",`scaleY(${this.childrenHidden?"0":"1"})`),l==null||l.style.setProperty("transform",`scaleY(${this.childrenHidden?"0":"1"})`)});return}const t=500,e=0,i=200,n=350;requestAnimationFrame(()=>{var r;const o=this.renderRoot.querySelector("bim-table-children"),a=this.renderRoot.querySelector(".caret"),l=this.renderRoot.querySelector(".branch-vertical"),c=(r=this.renderRoot.querySelector("bim-table-children"))==null?void 0:r.querySelector(".branch-vertical"),h=()=>{var m;const b=(m=o==null?void 0:o.renderRoot)==null?void 0:m.querySelectorAll("bim-table-group");b==null||b.forEach((f,y)=>{f.style.setProperty("opacity","0"),f.style.setProperty("left","-30px");const _=[{opacity:"0",left:"-30px"},{opacity:"1",left:"0"}];f.animate(_,{duration:t/2,delay:50+y*e,easing:"cubic-bezier(0.65, 0.05, 0.36, 1)",fill:"forwards"})})},d=()=>{const m=[{transform:"translateY(-50%) rotate(90deg)"},{transform:"translateY(-50%) rotate(0deg)"}];a==null||a.animate(m,{duration:n,easing:"cubic-bezier(0.68, -0.55, 0.27, 1.55)",fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})},p=()=>{const m=[{transform:"scaleY(1)"},{transform:"scaleY(0)"}];l==null||l.animate(m,{duration:i,easing:"cubic-bezier(0.4, 0, 0.2, 1)",delay:e,fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})},u=()=>{var m;const b=(m=this.renderRoot.querySelector("bim-table-row"))==null?void 0:m.querySelector(".branch-horizontal");if(b){b.style.setProperty("transform-origin","center right");const f=[{transform:"scaleX(0)"},{transform:"scaleX(1)"}];b.animate(f,{duration:i,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})}},g=()=>{const m=[{transform:"scaleY(0)"},{transform:"scaleY(1)"}];c==null||c.animate(m,{duration:i*1.2,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"forwards",delay:(e+i)*.7})};h(),d(),p(),u(),g()})}firstUpdated(){this.renderRoot.querySelectorAll(".caret").forEach(s=>{var t,e,i;if(!this.childrenHidden){s.style.setProperty("transform","translateY(-50%) rotate(90deg)");const n=(t=s.parentElement)==null?void 0:t.querySelector(".branch-horizontal");n&&n.style.setProperty("transform","scaleX(0)");const r=(i=(e=s.parentElement)==null?void 0:e.parentElement)==null?void 0:i.querySelectorAll(".branch-vertical");r==null||r.forEach(o=>{o.style.setProperty("transform","scaleY(1)")})}})}render(){if(!this.table)return H`${It}`;const s=this.table.getGroupIndentation(this.data)??0;let t;if(!this.table.noIndentation){const r={left:`${s-1+(this.table.selectableRows?2.05:.5625)}rem`};t=H`<div style=${ui(r)} class="branch branch-horizontal"></div>`}const e=H`
      ${this.table.noIndentation?null:H`
            <style>
              .branch-vertical {
                left: ${s+(this.table.selectableRows?1.9375:.5625)}rem;
              }
            </style>
            <div class="branch branch-vertical"></div>
          `}
    `;let i;if(!this.table.noIndentation){const r=document.createElementNS("http://www.w3.org/2000/svg","svg");if(r.setAttribute("height","9.9"),r.setAttribute("width","7.5"),r.setAttribute("viewBox","0 0 4.6666672 7.7"),this.table.noCarets){const a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx","2.3333336"),a.setAttribute("cy","3.85"),a.setAttribute("r","2.5"),r.append(a)}else{const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d","m 1.7470835,6.9583848 2.5899999,-2.59 c 0.39,-0.39 0.39,-1.02 0,-1.41 L 1.7470835,0.36838483 c -0.63,-0.62000003 -1.71000005,-0.18 -1.71000005,0.70999997 v 5.17 c 0,0.9 1.08000005,1.34 1.71000005,0.71 z"),r.append(a)}const o={left:`${(this.table.selectableRows?1.5:.125)+s}rem`,cursor:`${this.table.noCarets?"unset":"pointer"}`};i=H`<div @click=${a=>{var l;(l=this.table)!=null&&l.noCarets||(a.stopPropagation(),this.toggleChildren())}} style=${ui(o)} class="caret">${r}</div>`}let n;return!this._isChildrenEmpty&&!this.childrenHidden&&(n=H`
        <bim-table-children ${Qt(r=>{if(!r)return;const o=r;o.table=this.table,o.group=this})}>${e}</bim-table-children>
      `),H`
      <div class="parent">
        <bim-table-row ${Qt(r=>{var o;if(!r)return;const a=r;a.table=this.table,a.group=this,(o=this.table)==null||o.dispatchEvent(new CustomEvent("rowcreated",{detail:{row:a}}))})}>
          ${Hs(!this._isChildrenEmpty,()=>e)}
          ${Hs(s!==0,()=>t)}
          ${Hs(!this.table.noIndentation&&!this._isChildrenEmpty,()=>i)}
        </bim-table-row>
        ${n}
      </div>
    `}};Mf.styles=At`
    :host {
      position: relative;
    }

    .parent {
      display: grid;
      grid-template-areas: "Data" "Children";
    }

    .branch {
      position: absolute;
      z-index: 1;
    }

    .branch-vertical {
      border-left: 1px dotted var(--bim-ui_bg-contrast-40);
      transform-origin: top center;
      transform: scaleY(0);
    }

    .branch-horizontal {
      top: 50%;
      width: 1rem;
      border-bottom: 1px dotted var(--bim-ui_bg-contrast-40);
    }

    .branch-horizontal {
      transform-origin: center left;
    }

    .caret {
      position: absolute;
      z-index: 2;
      transform: translateY(-50%) rotate(0deg);
      top: 50%;
      display: flex;
      width: 0.95rem;
      height: 0.95rem;
      justify-content: center;
      align-items: center;
    }

    .caret svg {
      fill: var(--bim-ui_bg-contrast-60);
    }
  `;let Lf=Mf;x1([W({type:Boolean,attribute:"children-hidden",reflect:!0})],Lf.prototype,"childrenHidden");var C1=Object.defineProperty,pn=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&C1(t,e,n),n};const Bf=class extends Ct{constructor(){super(...arguments),this.selected=!1,this.columns=[],this.hiddenColumns=[],this.group=null,this._data={},this.isHeader=!1,this.table=null,this.onTableColumnsChange=()=>{this.table&&(this.columns=this.table.columns)},this.onTableColumnsHidden=()=>{this.table&&(this.hiddenColumns=this.table.hiddenColumns)},this._intersecting=!1,this._timeOutDelay=250,this._observer=new IntersectionObserver(s=>{window.clearTimeout(this._intersectTimeout),this._intersectTimeout=void 0,s[0].isIntersecting?this._intersectTimeout=window.setTimeout(()=>{this._intersecting=!0},this._timeOutDelay):this._intersecting=!1},{rootMargin:"36px"}),this.dataTransform=null,this._interval=null,this.clearDataTransform=()=>{this.dataTransform=null,this._interval!==null&&(clearInterval(this._interval),this._interval=null)},this._cache={}}get groupData(){var s;return(s=this.group)==null?void 0:s.data}get data(){var s;return((s=this.group)==null?void 0:s.data.data)??this._data}set data(s){this._data=s}get _columnNames(){return this.columns.filter(s=>!this.hiddenColumns.includes(s.name)).map(s=>s.name)}get _columnWidths(){return this.columns.filter(s=>!this.hiddenColumns.includes(s.name)).map(s=>s.width)}get _isSelected(){var s;return(s=this.table)==null?void 0:s.selection.has(this.data)}onSelectionChange(s){if(!this.table)return;const t=s.target;this.selected=t.value,t.value?(this.table.selection.add(this.data),this.table.dispatchEvent(new CustomEvent("rowselected",{detail:{data:this.data}}))):(this.table.selection.delete(this.data),this.table.dispatchEvent(new CustomEvent("rowdeselected",{detail:{data:this.data}})))}firstUpdated(s){super.firstUpdated(s),this._observer.observe(this)}connectedCallback(){super.connectedCallback(),this.toggleAttribute("selected",this._isSelected),this.table&&(this.columns=this.table.columns,this.hiddenColumns=this.table.hiddenColumns,this.table.addEventListener("columnschange",this.onTableColumnsChange),this.table.addEventListener("columnshidden",this.onTableColumnsHidden),this.style.gridTemplateAreas=`"${this.table.selectableRows?"Selection":""} ${this._columnNames.join(" ")}"`,this.style.gridTemplateColumns=`${this.table.selectableRows?"1.6rem":""} ${this._columnWidths.join(" ")}`)}disconnectedCallback(){super.disconnectedCallback(),this._observer.unobserve(this),this.columns=[],this.hiddenColumns=[],this.toggleAttribute("selected",!1),this.data={},this.table&&(this.table.removeEventListener("columnschange",this.onTableColumnsChange),this.table.removeEventListener("columnshidden",this.onTableColumnsHidden),this.table=null),this.clean()}applyAdaptativeDataTransform(s){this.addEventListener("pointerenter",()=>{this.dataTransform=s,this._interval=window.setInterval(()=>{this.matches(":hover")||this.clearDataTransform()},50)})}clean(){clearTimeout(this._intersectTimeout),this._intersectTimeout=void 0,this._timeOutDelay=250;for(const[,s]of Object.entries(this._cache))s.remove();this._cache={}}render(){if(!(this.table&&this._intersecting))return H`${It}`;const s=this.table.getRowIndentation(this.data)??0,t=[];for(const e in this.data){if(this.hiddenColumns.includes(e))continue;const i=document.createElement("bim-table-cell");i.group=this.group,i.table=this.table,i.row=this,i.column=e,this._columnNames.indexOf(e)===0&&(i.style.marginLeft=`${this.table.noIndentation?0:s+.75}rem`);const n=this._columnNames.indexOf(e);i.setAttribute("data-column-index",String(n)),i.toggleAttribute("data-no-indentation",n===0&&this.table.noIndentation),i.toggleAttribute("data-cell-header",this.isHeader),i.rowData=this.data,this.table.dispatchEvent(new CustomEvent("cellcreated",{detail:{cell:i}})),t.push(i)}return this._timeOutDelay=0,H`
      ${!this.isHeader&&this.table.selectableRows?H`<bim-checkbox
            @change=${this.onSelectionChange}
            .checked=${this._isSelected??!1}
            style="align-self: center; justify-self: center"
          ></bim-checkbox>`:null}
      ${t}
      <slot></slot>
    `}};Bf.styles=At`
    :host {
      position: relative;
      grid-area: Data;
      display: grid;
      min-height: 2.25rem;
      transition: all 0.15s;
    }

    ::slotted(.branch.branch-vertical) {
      top: 50%;
      bottom: 0;
    }

    :host([selected]) {
      background-color: color-mix(
        in lab,
        var(--bim-ui_bg-contrast-20) 30%,
        var(--bim-ui_accent-base) 10%
      );
    }
  `;let gs=Bf;pn([W({type:Boolean,reflect:!0})],gs.prototype,"selected");pn([W({attribute:!1})],gs.prototype,"columns");pn([W({attribute:!1})],gs.prototype,"hiddenColumns");pn([W({type:Boolean,attribute:"is-header",reflect:!0})],gs.prototype,"isHeader");pn([ps()],gs.prototype,"_intersecting");pn([ps()],gs.prototype,"dataTransform");var E1=Object.defineProperty,S1=Object.getOwnPropertyDescriptor,Ne=(s,t,e,i)=>{for(var n=i>1?void 0:i?S1(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&E1(t,e,n),n};const Nf=class extends Ct{constructor(){super(...arguments),this._filteredData=[],this.headersHidden=!1,this.minColWidth="4rem",this._columns=[],this._textDelimiters={comma:",",tab:"	"},this._queryString=null,this._data=[],this.expanded=!1,this.preserveStructureOnFilter=!1,this.indentationInText=!1,this.dataTransform={},this.selectableRows=!1,this.selection=new Set,this.noIndentation=!1,this.noCarets=!1,this.loading=!1,this._errorLoading=!1,this._onColumnsHidden=new Event("columnshidden"),this._hiddenColumns=[],this.defaultContentTemplate=s=>H`<bim-label style="white-space: normal;">${s}</bim-label>`,this._stringFilterFunction=(s,t)=>Object.values(t.data).some(e=>String(e).toLowerCase().includes(s.toLowerCase())),this._queryFilterFunction=(s,t)=>{let e=!1;const i=Il(s)??[];for(const n of i){if("queries"in n){e=!1;break}const{condition:r,value:o}=n;let{key:a}=n;if(a.startsWith("[")&&a.endsWith("]")){const l=a.replace("[","").replace("]","");a=l,e=Object.keys(t.data).filter(c=>c.includes(l)).map(c=>Id(t.data[c],r,o)).some(c=>c)}else e=Id(t.data[a],r,o);if(!e)break}return e}}set columns(s){const t=[];for(const e of s){const i=typeof e=="string"?{name:e,width:`minmax(${this.minColWidth}, 1fr)`}:e;t.push(i)}this._columns=t,this.computeMissingColumns(this.data),this.dispatchEvent(new Event("columnschange"))}get columns(){return this._columns}get _headerRowData(){const s={};for(const t of this.columns){const{name:e}=t;s[e]=String(e)}return s}get value(){return this._filteredData}set queryString(s){this.toggleAttribute("data-processing",!0),this._queryString=s&&s.trim()!==""?s.trim():null,this.updateFilteredData(),this.toggleAttribute("data-processing",!1)}get queryString(){return this._queryString}set data(s){this._data=s,this.updateFilteredData(),this.computeMissingColumns(s)&&(this.columns=this._columns)}get data(){return this._data}get dataAsync(){return new Promise(s=>{setTimeout(()=>{s(this.data)})})}set hiddenColumns(s){this._hiddenColumns=s,setTimeout(()=>{this.dispatchEvent(this._onColumnsHidden)})}get hiddenColumns(){return this._hiddenColumns}updateFilteredData(){this.queryString?(Il(this.queryString)?(this.filterFunction=this._queryFilterFunction,this._filteredData=this.filter(this.queryString)):(this.filterFunction=this._stringFilterFunction,this._filteredData=this.filter(this.queryString)),this.preserveStructureOnFilter&&(this._expandedBeforeFilter===void 0&&(this._expandedBeforeFilter=this.expanded),this.expanded=!0)):(this.preserveStructureOnFilter&&this._expandedBeforeFilter!==void 0&&(this.expanded=this._expandedBeforeFilter,this._expandedBeforeFilter=void 0),this._filteredData=this.data)}computeMissingColumns(s){let t=!1;for(const e of s){const{children:i,data:n}=e;for(const r in n)this._columns.map(o=>typeof o=="string"?o:o.name).includes(r)||(this._columns.push({name:r,width:`minmax(${this.minColWidth}, 1fr)`}),t=!0);if(i){const r=this.computeMissingColumns(i);r&&!t&&(t=r)}}return t}generateText(s="comma",t=this.value,e="",i=!0){const n=this._textDelimiters[s];let r="";const o=this.columns.map(a=>a.name);if(i){this.indentationInText&&(r+=`Indentation${n}`);const a=`${o.join(n)}
`;r+=a}for(const[a,l]of t.entries()){const{data:c,children:h}=l,d=this.indentationInText?`${e}${a+1}${n}`:"",p=o.map(g=>c[g]??""),u=`${d}${p.join(n)}
`;r+=u,h&&(r+=this.generateText(s,l.children,`${e}${a+1}.`,!1))}return r}get csv(){return this.generateText("comma")}get tsv(){return this.generateText("tab")}applyDataTransform(s){const t={};if(!s)return t;const{data:e}=s.data;for(const n of Object.keys(this.dataTransform)){const r=this.columns.find(o=>o.name===n);r&&r.forceDataTransform&&(n in e||(e[n]=""))}const i=e;for(const n in i){const r=this.dataTransform[n];r?t[n]=r(i[n],e,s):t[n]=e[n]}return t}downloadData(s="BIM Table Data",t="json"){let e=null;if(t==="json"&&(e=new File([JSON.stringify(this.value,void 0,2)],`${s}.json`)),t==="csv"&&(e=new File([this.csv],`${s}.csv`)),t==="tsv"&&(e=new File([this.tsv],`${s}.tsv`)),!e)return;const i=document.createElement("a");i.href=URL.createObjectURL(e),i.download=e.name,i.click(),URL.revokeObjectURL(i.href)}getRowIndentation(s,t=this.value,e=0){for(const i of t){if(i.data===s)return e;if(i.children){const n=this.getRowIndentation(s,i.children,e+1);if(n!==null)return n}}return null}getGroupIndentation(s,t=this.value,e=0){for(const i of t){if(i===s)return e;if(i.children){const n=this.getGroupIndentation(s,i.children,e+1);if(n!==null)return n}}return null}connectedCallback(){super.connectedCallback(),this.dispatchEvent(new Event("connected"))}disconnectedCallback(){super.disconnectedCallback(),this.dispatchEvent(new Event("disconnected"))}async loadData(s=!1){if(this._filteredData.length!==0&&!s||!this.loadFunction)return!1;this.loading=!0;try{const t=await this.loadFunction();return this.data=t,this.loading=!1,this._errorLoading=!1,!0}catch(t){if(this.loading=!1,this._filteredData.length!==0)return!1;const e=this.querySelector("[slot='error-loading']"),i=e==null?void 0:e.querySelector("[data-table-element='error-message']");return t instanceof Error&&i&&t.message.trim()!==""&&(i.textContent=t.message),this._errorLoading=!0,!1}}filter(s,t=this.filterFunction??this._stringFilterFunction,e=this.data){const i=[];for(const n of e)if(t(s,n)){if(this.preserveStructureOnFilter){const r={data:n.data};if(n.children){const o=this.filter(s,t,n.children);o.length&&(r.children=o)}i.push(r)}else if(i.push({data:n.data}),n.children){const r=this.filter(s,t,n.children);i.push(...r)}}else if(n.children){const r=this.filter(s,t,n.children);this.preserveStructureOnFilter&&r.length?i.push({data:n.data,children:r}):i.push(...r)}return i}get _missingDataElement(){return this.querySelector("[slot='missing-data']")}render(){if(this.loading)return m1();if(this._errorLoading)return H`<slot name="error-loading"></slot>`;if(this._filteredData.length===0&&this._missingDataElement)return H`<slot name="missing-data"></slot>`;const s=e=>{if(!e)return;const i=e;i.table=this,i.data=this._headerRowData},t=e=>{if(!e)return;const i=e;i.table=this,i.data=this.value,i.requestUpdate()};return H`
      <div class="parent">
        ${g1()}
        ${Hs(!this.headersHidden,()=>H`<bim-table-row is-header style="grid-area: Header; position: sticky; top: 0; z-index: 5" ${Qt(s)}></bim-table-row>`)} 
        <div style="overflow-x: hidden; grid-area: Body">
          <bim-table-children ${Qt(t)} style="grid-area: Body; background-color: transparent"></bim-table-children>
        </div>
      </div>
    `}};Nf.styles=[qi.scrollbar,At`
      :host {
        position: relative;
        overflow: auto;
        display: block;
        pointer-events: auto;
      }

      :host(:not([data-processing])) .loader {
        display: none;
      }

      .parent {
        display: grid;
        grid-template:
          "Header" auto
          "Processing" auto
          "Body" 1fr
          "Footer" auto;
        overflow: auto;
        height: 100%;
      }

      .parent > bim-table-row[is-header] {
        color: var(--bim-table_header--c, var(--bim-ui_bg-contrast-100));
        background-color: var(
          --bim-table_header--bgc,
          var(--bim-ui_bg-contrast-20)
        );
      }

      .controls {
        display: flex;
        gap: 0.375rem;
        flex-wrap: wrap;
        margin-bottom: 0.5rem;
      }
    `];let Se=Nf;Ne([ps()],Se.prototype,"_filteredData",2);Ne([W({type:Boolean,attribute:"headers-hidden",reflect:!0})],Se.prototype,"headersHidden",2);Ne([W({type:String,attribute:"min-col-width",reflect:!0})],Se.prototype,"minColWidth",2);Ne([W({type:Array,attribute:!1})],Se.prototype,"columns",1);Ne([W({type:Array,attribute:!1})],Se.prototype,"data",1);Ne([W({type:Boolean,reflect:!0})],Se.prototype,"expanded",2);Ne([W({type:Boolean,reflect:!0,attribute:"selectable-rows"})],Se.prototype,"selectableRows",2);Ne([W({attribute:!1})],Se.prototype,"selection",2);Ne([W({type:Boolean,attribute:"no-indentation",reflect:!0})],Se.prototype,"noIndentation",2);Ne([W({type:Boolean,attribute:"no-carets",reflect:!0})],Se.prototype,"noCarets",2);Ne([W({type:Boolean,reflect:!0})],Se.prototype,"loading",2);Ne([ps()],Se.prototype,"_errorLoading",2);var A1=Object.defineProperty,$1=Object.getOwnPropertyDescriptor,fn=(s,t,e,i)=>{for(var n=i>1?void 0:i?$1(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&A1(t,e,n),n};const Uf=class extends Ct{constructor(){super(...arguments),this._switchers=[],this.bottom=!1,this.switchersHidden=!1,this.floating=!1,this.switchersFull=!1,this.onTabHiddenChange=s=>{const t=s.target;t instanceof be&&!t.hidden&&(t.removeEventListener("hiddenchange",this.onTabHiddenChange),this.tab=t.name,t.addEventListener("hiddenchange",this.onTabHiddenChange))}}set tab(s){this._tab=s;const t=[...this.children],e=t.find(i=>i instanceof be&&i.name===s);for(const i of t){if(!(i instanceof be))continue;i.hidden=e!==i;const n=this.getTabSwitcher(i.name);n&&n.toggleAttribute("data-active",!i.hidden)}e||(this._tab="hidden",this.setAttribute("tab","hidden"))}get tab(){return this._tab}getTabSwitcher(s){return this._switchers.find(t=>t.getAttribute("data-name")===s)}createSwitchers(){this._switchers=[];for(const s of this.children){if(!(s instanceof be))continue;const t=document.createElement("div");t.addEventListener("click",()=>{this.tab===s.name?this.toggleAttribute("tab",!1):this.tab=s.name,this.setAnimatedBackgound()}),t.setAttribute("data-name",s.name),t.className="switcher";const e=document.createElement("bim-label");e.textContent=s.label??null,e.icon=s.icon,t.append(e),this._switchers.push(t)}}updateSwitchers(){for(const s of this.children){if(!(s instanceof be))continue;const t=this._switchers.find(i=>i.getAttribute("data-name")===s.name);if(!t)continue;const e=t.querySelector("bim-label");e&&(e.textContent=s.label??null,e.icon=s.icon)}}onSlotChange(s){this.createSwitchers();const t=s.target.assignedElements(),e=t.find(i=>i instanceof be?this.tab?i.name===this.tab:!i.hidden:!1);e&&e instanceof be&&(this.tab=e.name);for(const i of t){if(!(i instanceof be)){i.remove();continue}i.removeEventListener("hiddenchange",this.onTabHiddenChange),e!==i&&(i.hidden=!0),i.addEventListener("hiddenchange",this.onTabHiddenChange)}}doubleRequestAnimationFrames(s){requestAnimationFrame(()=>requestAnimationFrame(s))}setAnimatedBackgound(s=!1){var t;const e=this.renderRoot.querySelector(".animated-background"),i=[...((t=this.renderRoot.querySelector(".switchers"))==null?void 0:t.querySelectorAll(".switcher"))||[]].filter(n=>n.hasAttribute("data-active"))[0];requestAnimationFrame(()=>{var n,r,o,a;const l=(a=(o=(r=(n=i==null?void 0:i.parentElement)==null?void 0:n.shadowRoot)==null?void 0:r.querySelector("bim-input"))==null?void 0:o.shadowRoot)==null?void 0:a.querySelector(".input"),c={width:i==null?void 0:i.clientWidth,height:i==null?void 0:i.clientHeight,top:((i==null?void 0:i.offsetTop)??0)-((l==null?void 0:l.offsetTop)??0),left:((i==null?void 0:i.offsetLeft)??0)-((l==null?void 0:l.offsetLeft)??0)};i?(e==null||e.style.setProperty("width",`${c.width}px`),e==null||e.style.setProperty("height",`${c.height}px`),e==null||e.style.setProperty("left",`${c.left}px`)):e==null||e.style.setProperty("width","0"),this.bottom?(e==null||e.style.setProperty("top","100%"),e==null||e.style.setProperty("transform","translateY(-100%)")):e==null||e.style.setProperty("top",`${c.top}px`)}),s&&this.doubleRequestAnimationFrames(()=>{const n="ease";e==null||e.style.setProperty("transition",`width ${.3}s ${n}, height ${.3}s ${n}, top ${.3}s ${n}, left ${.3}s ${n}`)})}firstUpdated(){requestAnimationFrame(()=>{this.setAnimatedBackgound(!0)}),new ResizeObserver(()=>{this.setAnimatedBackgound()}).observe(this)}render(){return H`
      <div class="parent">
        <div class="switchers">
          <div class="animated-background"></div>
          ${this._switchers}
        </div>
        <div class="content">
          <slot @slotchange=${this.onSlotChange}></slot>
        </div>
      </div>
    `}};Uf.styles=[qi.scrollbar,At`
      * {
        box-sizing: border-box;
      }

      :host {
        background-color: var(--bim-ui_bg-base);
        display: block;
        overflow: auto;
      }

      .parent {
        display: grid;
        overflow: hidden;
        position: relative;
        grid-template: "switchers" auto "content" 1fr;
        height: 100%;
      }

      :host([bottom]) .parent {
        grid-template: "content" 1fr "switchers" auto;
      }

      .switchers {
        position: relative;
        display: flex;
        height: 2.25rem;
        font-weight: 600;
        grid-area: switchers;
      }

      .switcher {
        --bim-label--c: var(--bim-ui_bg-contrast-80);
        background-color: transparent;
        position: relative;
        cursor: pointer;
        pointer-events: auto;
        padding: 0rem 0.75rem;
        display: flex;
        justify-content: center;
        z-index: 2;
        transition: all 0.15s;
      }

      .switcher:not([data-active]):hover {
        filter: brightness(150%);
      }

      :host([switchers-full]) .switcher {
        flex: 1;
      }

      .switcher[data-active] {
        --bim-label--c: var(--bim-ui_main-contrast);
      }

      .switchers bim-label {
        pointer-events: none;
      }

      :host([switchers-hidden]) .switchers {
        display: none;
      }

      .content {
        position: relative;
        display: grid;
        grid-template-columns: 1fr;
        grid-area: content;
        max-height: 100vh;
        overflow: auto;
        transition: max-height 0.2s;
      }

      :host([tab="hidden"]) .content {
        max-height: 0;
      }

      .animated-background {
        position: absolute;
        background: var(--bim-ui_main-base);
        width: 0;
        height: 0;
        top: 0;
        left: 0;
      }

      :host(:not([bottom])) .content {
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([bottom]) .content {
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating]) {
        background-color: transparent;
      }

      :host([floating]) .switchers {
        justify-self: center;
        overflow: hidden;
        background-color: var(--bim-ui_bg-base);
      }

      :host([floating]:not([bottom])) .switchers {
        border-radius: var(--bim-ui_size-2xs) var(--bim-ui_size-2xs) 0 0;
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
        border-left: 1px solid var(--bim-ui_bg-contrast-20);
        border-right: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][bottom]) .switchers {
        border-radius: 0 0 var(--bim-ui_size-2xs) var(--bim-ui_size-2xs);
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
        border-left: 1px solid var(--bim-ui_bg-contrast-20);
        border-right: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][tab="hidden"]) .switchers {
        border-radius: var(--bim-ui_size-2xs);
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][bottom][tab="hidden"]) .switchers {
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating]) .content {
        border: 1px solid var(--bim-ui_bg-contrast-20);
        border-radius: var(--bim-ui_size-2xs);
        background-color: var(--bim-ui_bg-base);
      }
    `];let gi=Uf;fn([ps()],gi.prototype,"_switchers",2);fn([W({type:Boolean,reflect:!0})],gi.prototype,"bottom",2);fn([W({type:Boolean,attribute:"switchers-hidden",reflect:!0})],gi.prototype,"switchersHidden",2);fn([W({type:Boolean,reflect:!0})],gi.prototype,"floating",2);fn([W({type:String,reflect:!0})],gi.prototype,"tab",1);fn([W({type:Boolean,attribute:"switchers-full",reflect:!0})],gi.prototype,"switchersFull",2);var T1=Object.defineProperty,k1=Object.getOwnPropertyDescriptor,sa=(s,t,e,i)=>{for(var n=i>1?void 0:i?k1(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&T1(t,e,n),n};const Rf=class extends Ct{constructor(){super(...arguments),this._defaultName="__unnamed__",this.name=this._defaultName,this._hidden=!1}set label(s){this._label=s;const t=this.parentElement;t instanceof gi&&t.updateSwitchers()}get label(){return this._label}set icon(s){this._icon=s;const t=this.parentElement;t instanceof gi&&t.updateSwitchers()}get icon(){return this._icon}set hidden(s){this._hidden=s,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}connectedCallback(){super.connectedCallback();const{parentElement:s}=this;if(s&&this.name===this._defaultName){const t=[...s.children].indexOf(this);this.name=`${this._defaultName}${t}`}}render(){return H` <slot></slot> `}};Rf.styles=At`
    :host {
      display: block;
      height: 100%;
      grid-row-start: 1;
      grid-column-start: 1;
      animation: openAnim 3s forwards;
      transform: translateY(0);
      max-height: 100vh;
      transition:
        opacity 0.3s ease,
        max-height 0.6s ease,
        transform 0.3s ease;
    }

    :host([hidden]) {
      transform: translateY(-20px);
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      visibility: hidden;
    }
  `;let be=Rf;sa([W({type:String,reflect:!0})],be.prototype,"name",2);sa([W({type:String,reflect:!0})],be.prototype,"label",1);sa([W({type:String,reflect:!0})],be.prototype,"icon",1);sa([W({type:Boolean,reflect:!0})],be.prototype,"hidden",1);var P1=Object.defineProperty,O1=Object.getOwnPropertyDescriptor,Ye=(s,t,e,i)=>{for(var n=i>1?void 0:i?O1(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&P1(t,e,n),n};const Ff=class extends Ct{constructor(){super(...arguments),this._inputTypes=["date","datetime-local","email","month","password","search","tel","text","time","url","week","area"],this.value="",this.vertical=!1,this.disabled=!1,this.resize="vertical",this._type="text",this.onValueChange=new Event("input")}set type(s){this._inputTypes.includes(s)&&(this._type=s)}get type(){return this._type}get query(){return Il(this.value)}onInputChange(s){s.stopPropagation();const t=s.target;clearTimeout(this._debounceTimeoutID),this._debounceTimeoutID=setTimeout(()=>{this.value=t.value,this.dispatchEvent(this.onValueChange)},this.debounce)}focus(){setTimeout(()=>{var s;const t=(s=this.shadowRoot)==null?void 0:s.querySelector("input");t==null||t.focus()})}render(){return H`
      <bim-input
        .name=${this.name}
        .icon=${this.icon}
        .label=${this.label}
        .vertical=${this.vertical}
      >
        ${this.type==="area"?H` <textarea
              aria-label=${this.label||this.name||"Text Input"}
              .value=${this.value}
              .rows=${this.rows??5}
              ?disabled=${this.disabled}
              placeholder=${Dl(this.placeholder)}
              @input=${this.onInputChange}
              style="resize: ${this.resize};"
            ></textarea>`:H` <input
              aria-label=${this.label||this.name||"Text Input"}
              .type=${this.type}
              .value=${this.value}
              ?disabled=${this.disabled}
              placeholder=${Dl(this.placeholder)}
              @input=${this.onInputChange}
            />`}
      </bim-input>
    `}};Ff.styles=[qi.scrollbar,At`
      :host {
        --bim-input--bgc: var(--bim-ui_bg-contrast-20);
        flex: 1;
        display: block;
      }

      input,
      textarea {
        font-family: inherit;
        background-color: transparent;
        border: none;
        width: 100%;
        padding: var(--bim-ui_size-3xs);
        color: var(--bim-text-input--c, var(--bim-ui_bg-contrast-100));
      }

      input {
        outline: none;
        height: 100%;
        padding: 0 var(--bim-ui_size-3xs); /* Override padding */
        border-radius: var(--bim-text-input--bdrs, var(--bim-ui_size-4xs));
      }

      :host([disabled]) input,
      :host([disabled]) textarea {
        color: var(--bim-ui_bg-contrast-60);
      }

      textarea {
        line-height: 1.1rem;
        outline: none;
      }

      :host(:focus) {
        --bim-input--olc: var(--bim-ui_accent-base);
      }

      /* :host([disabled]) {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
    } */
    `];let ge=Ff;Ye([W({type:String,reflect:!0})],ge.prototype,"icon",2);Ye([W({type:String,reflect:!0})],ge.prototype,"label",2);Ye([W({type:String,reflect:!0})],ge.prototype,"name",2);Ye([W({type:String,reflect:!0})],ge.prototype,"placeholder",2);Ye([W({type:String,reflect:!0})],ge.prototype,"value",2);Ye([W({type:Boolean,reflect:!0})],ge.prototype,"vertical",2);Ye([W({type:Number,reflect:!0})],ge.prototype,"debounce",2);Ye([W({type:Number,reflect:!0})],ge.prototype,"rows",2);Ye([W({type:Boolean,reflect:!0})],ge.prototype,"disabled",2);Ye([W({type:String,reflect:!0})],ge.prototype,"resize",2);Ye([W({type:String,reflect:!0})],ge.prototype,"type",1);var I1=Object.defineProperty,z1=Object.getOwnPropertyDescriptor,jf=(s,t,e,i)=>{for(var n=i>1?void 0:i?z1(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&I1(t,e,n),n};const Hf=class extends Ct{constructor(){super(...arguments),this.rows=2,this._vertical=!1}set vertical(s){this._vertical=s,this.updateChildren()}get vertical(){return this._vertical}updateChildren(){const s=this.children;for(const t of s)this.vertical?t.setAttribute("label-hidden",""):t.removeAttribute("label-hidden")}render(){return H`
      <style>
        .parent {
          grid-auto-flow: ${this.vertical?"row":"column"};
          grid-template-rows: repeat(${this.rows}, 1fr);
        }
      </style>
      <div class="parent">
        <slot @slotchange=${this.updateChildren}></slot>
      </div>
    `}};Hf.styles=At`
    .parent {
      display: grid;
      gap: 0.25rem;
    }

    ::slotted(bim-button[label]:not([vertical])) {
      --bim-button--jc: flex-start;
    }

    ::slotted(bim-button) {
      --bim-label--c: var(--bim-ui_bg-contrast-80);
    }
  `;let na=Hf;jf([W({type:Number,reflect:!0})],na.prototype,"rows",2);jf([W({type:Boolean,reflect:!0})],na.prototype,"vertical",1);var D1=Object.defineProperty,M1=Object.getOwnPropertyDescriptor,ra=(s,t,e,i)=>{for(var n=i>1?void 0:i?M1(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&D1(t,e,n),n};const Vf=class extends Ct{constructor(){super(...arguments),this._vertical=!1,this._labelHidden=!1}set vertical(s){this._vertical=s,this.updateChildren()}get vertical(){return this._vertical}set labelHidden(s){this._labelHidden=s,this.updateChildren()}get labelHidden(){return this._labelHidden}updateChildren(){const s=this.children;for(const t of s)t instanceof na&&(t.vertical=this.vertical),t.toggleAttribute("label-hidden",this.vertical)}render(){return H`
      <div class="parent">
        <div class="children">
          <slot @slotchange=${this.updateChildren}></slot>
        </div>
        ${!this.labelHidden&&(this.label||this.icon)?H`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
      </div>
    `}};Vf.styles=At`
    :host {
      --bim-label--fz: var(--bim-ui_size-xs);
      --bim-label--c: var(--bim-ui_bg-contrast-60);
      display: block;
      flex: 1;
    }

    :host(:not([vertical])) ::slotted(bim-button[vertical]) {
      --bim-icon--fz: var(--bim-ui_size-5xl);
      min-height: 3.75rem;
    }

    .parent {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      align-items: center;
      padding: 0.5rem;
      height: 100%;
      box-sizing: border-box;
      justify-content: space-between;
    }

    :host([vertical]) .parent {
      flex-direction: row-reverse;
    }

    :host([vertical]) .parent > bim-label {
      writing-mode: tb;
    }

    .children {
      display: flex;
      gap: 0.25rem;
    }

    :host([vertical]) .children {
      flex-direction: column;
    }
  `;let mn=Vf;ra([W({type:String,reflect:!0})],mn.prototype,"label",2);ra([W({type:String,reflect:!0})],mn.prototype,"icon",2);ra([W({type:Boolean,reflect:!0})],mn.prototype,"vertical",1);ra([W({type:Boolean,attribute:"label-hidden",reflect:!0})],mn.prototype,"labelHidden",1);var L1=Object.defineProperty,B1=Object.getOwnPropertyDescriptor,Cc=(s,t,e,i)=>{for(var n=i>1?void 0:i?B1(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&L1(t,e,n),n};const qf=class extends Ct{constructor(){super(...arguments),this.labelsHidden=!1,this._vertical=!1,this._hidden=!1}set vertical(s){this._vertical=s,this.updateSections()}get vertical(){return this._vertical}set hidden(s){this._hidden=s,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}updateSections(){const s=this.children;for(const t of s)t instanceof mn&&(t.labelHidden=this.vertical&&!ae.config.sectionLabelOnVerticalToolbar,t.vertical=this.vertical)}render(){return H`
      <div class="parent">
        <slot @slotchange=${this.updateSections}></slot>
      </div>
    `}};qf.styles=At`
    :host {
      --bim-button--bgc: transparent;
      background-color: var(--bim-ui_bg-base);
      border-radius: var(--bim-ui_size-2xs);
      display: block;
    }

    :host([hidden]) {
      display: none;
    }

    .parent {
      display: flex;
      width: max-content;
      pointer-events: auto;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    :host([vertical]) {
      width: min-content;
      border-radius: var(--bim-ui_size-2xs);
      border: 1px solid var(--bim-ui_bg-contrast-20);
    }

    ::slotted(bim-toolbar-section:not(:last-child)) {
      border-right: 1px solid var(--bim-ui_bg-contrast-20);
      border-bottom: none;
    }

    :host([vertical]) ::slotted(bim-toolbar-section:not(:last-child)) {
      border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      border-right: none;
    }
  `;let oa=qf;Cc([W({type:String,reflect:!0})],oa.prototype,"icon",2);Cc([W({type:Boolean,attribute:"labels-hidden",reflect:!0})],oa.prototype,"labelsHidden",2);Cc([W({type:Boolean,reflect:!0})],oa.prototype,"vertical",1);var N1=Object.defineProperty,U1=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&N1(t,e,n),n};const Wf=class extends Ct{constructor(){super(),this._onResize=new Event("resize"),new ResizeObserver(()=>{setTimeout(()=>{this.dispatchEvent(this._onResize)})}).observe(this)}render(){return H`
      <div class="parent">
        <slot></slot>
      </div>
    `}};Wf.styles=At`
    :host {
      display: grid;
      min-width: 0;
      min-height: 0;
      height: 100%;
    }

    .parent {
      overflow: hidden;
      position: relative;
    }
  `;let Yf=Wf;U1([W({type:String,reflect:!0})],Yf.prototype,"name");class R1{static init(){ae.defineCustomElement("bim-view-cube",vi),ae.defineCustomElement("bim-world-2d",ln),ae.defineCustomElement("bim-world",bp)}}const Vs=(s,t)=>{const e=t[s],i=(e==null?void 0:e.name)??s,n=i.trim().split(/\s+/);let r,o;return n[0]&&n[0][0]&&(r=n[0][0].toUpperCase(),n[0][1]&&(o=n[0][1].toUpperCase())),n[1]&&n[1][0]&&(o=n[1][0].toUpperCase()),H`
    <div style="display: flex; gap: 0.25rem; overflow: hidden;">
      ${!(e!=null&&e.picture)&&(r||o)?H`
        <bim-label
          style=${ui({borderRadius:"999px",padding:"0.375rem",backgroundColor:"var(--bim-ui_bg-contrast-20)",aspectRatio:"1",fontSize:"0.7rem"})}>${r}${o}</bim-label>
        `:null}
      <bim-label .img=${e==null?void 0:e.picture}>${i}</bim-label>
    </div>
  `},ye={users:{"jhon.doe@example.com":{name:"Jhon Doe"}},priorities:{"On hold":{icon:"flowbite:circle-pause-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#767676"}},Minor:{icon:"mingcute:arrows-down-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#4CAF50"}},Normal:{icon:"fa6-solid:grip-lines",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Major:{icon:"mingcute:arrows-up-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Critical:{icon:"ph:warning",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}}},statuses:{Active:{icon:"prime:circle-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)"}},"In Progress":{icon:"prime:circle-fill",style:{backgroundColor:"#fa89004d","--bim-label--c":"#FB8C00","--bim-icon--c":"#FB8C00"}},"In Review":{icon:"prime:circle-fill",style:{backgroundColor:"#9c6bff4d","--bim-label--c":"#9D6BFF","--bim-icon--c":"#9D6BFF"}},Done:{icon:"prime:circle-fill",style:{backgroundColor:"#4CAF504D","--bim-label--c":"#4CAF50","--bim-icon--c":"#4CAF50"}},Closed:{icon:"prime:circle-fill",style:{backgroundColor:"#414141","--bim-label--c":"#727272","--bim-icon--c":"#727272"}}},types:{Clash:{icon:"gg:close-r",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Issue:{icon:"mdi:bug-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Failure:{icon:"mdi:bug-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Inquiry:{icon:"majesticons:comment-line",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Fault:{icon:"ph:warning",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Remark:{icon:"ph:note-blank-bold",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Request:{icon:"mynaui:edit-one",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#9D6BFF"}}}},qs={padding:"0.25rem 0.5rem",borderRadius:"999px","--bim-label--c":"var(--bim-ui_bg-contrast-100)"},F1={dueDate:s=>{if(typeof s=="string"&&s.trim()!=="")return new Date(s)},status:s=>{if(Array.isArray(s)&&s.length!==0)return s[0]},type:s=>{if(Array.isArray(s)&&s.length!==0)return s[0]},priority:s=>{if(Array.isArray(s)&&s.length!==0)return s[0]},stage:s=>{if(Array.isArray(s)&&s.length!==0)return s[0]},assignedTo:s=>{if(Array.isArray(s)&&s.length!==0)return s[0]},labels:s=>{if(Array.isArray(s))return new Set(s)}},Zf=s=>{const{components:t,topic:e,value:i,onCancel:n,onSubmit:r,styles:o}=s,a=r??(()=>{}),l=t.get(Uo),c=(i==null?void 0:i.title)??(e==null?void 0:e.title)??wi.default.title,h=(i==null?void 0:i.status)??(e==null?void 0:e.status)??wi.default.status,d=(i==null?void 0:i.type)??(e==null?void 0:e.type)??wi.default.type,p=(i==null?void 0:i.priority)??(e==null?void 0:e.priority)??wi.default.priority,u=(i==null?void 0:i.assignedTo)??(e==null?void 0:e.assignedTo)??wi.default.assignedTo,g=(i==null?void 0:i.labels)??(e==null?void 0:e.labels)??wi.default.labels,m=(i==null?void 0:i.stage)??(e==null?void 0:e.stage)??wi.default.stage,b=(i==null?void 0:i.description)??(e==null?void 0:e.description)??wi.default.description,f=e!=null&&e.dueDate?e.dueDate.toISOString().split("T")[0]:null,y=new Set([...l.config.statuses]);h&&y.add(h);const _=new Set([...l.config.types]);d&&_.add(d);const x=new Set([...l.config.priorities]);p&&x.add(p);const C=new Set([...l.config.users]);u&&C.add(u);const S=new Set([...l.config.labels]);if(g)for(const v of g)S.add(v);const $=new Set([...l.config.stages]);m&&$.add(m);const O=vl(),z=async()=>{const{value:v}=O;if(!v)return;const L=dr(v,F1);if(e)e.set(L),await a(e);else{const X=l.create(L);await a(X)}},D=vl(),j=v=>{const{value:L}=D;if(!L)return;const X=v.target;L.disabled=X.value.trim()===""},A=`btn-${ae.newRandomId()}`,k=`btn-${ae.newRandomId()}`;return H`
    <div ${Qt(O)} style="display: flex; flex-direction: column; gap: 0.75rem;">
      <div style="display: flex; gap: 0.375rem">
        <bim-text-input @input=${j} vertical label="Title" name="title" .value=${c}></bim-text-input>
        ${e?H`
            <bim-dropdown vertical label="Status" name="status" required>
              ${[...y].map(v=>H`<bim-option label=${v} .checked=${h===v}></bim-option>`)}
            </bim-dropdown>`:H``}
      </div>
      <div style="display: flex; gap: 0.375rem">
        <bim-dropdown vertical label="Type" name="type" required>
          ${[..._].map(v=>H`<bim-option label=${v} .checked=${d===v}></bim-option>`)}
        </bim-dropdown>
        <bim-dropdown vertical label="Priority" name="priority">
          ${[...x].map(v=>H`<bim-option label=${v} .checked=${p===v}></bim-option>`)}
        </bim-dropdown>
      </div>
      <div style="display: flex; gap: 0.375rem">
        <bim-dropdown vertical label="Labels" name="labels" multiple>
          ${[...S].map(v=>H`<bim-option label=${v} .checked=${g?[...g].includes(v):!1}></bim-option>`)}
        </bim-dropdown>
        <bim-dropdown vertical label="Assignee" name="assignedTo">
          ${[...C].map(v=>{const L=o!=null&&o.users?o.users[v]:null,X=L?L.name:v,V=L==null?void 0:L.picture;return H`<bim-option label=${X} value=${v} .img=${V} .checked=${u===v}></bim-option>`})}
        </bim-dropdown>
      </div>
      <div style="display: flex; gap: 0.375rem">
        <bim-text-input vertical type="date" label="Due Date" name="dueDate" .value=${f}></bim-text-input> 
        <bim-dropdown vertical label="Stage" name="stage">
          ${[...$].map(v=>H`<bim-option label=${v} .checked=${m===v}></bim-option>`)}
        </bim-dropdown>
      </div>
      <bim-text-input vertical label="Description" name="description" type="area" .value=${b??null}></bim-text-input>
      <div style="justify-content: right; display: flex; gap: 0.375rem">
        <style>
          #${k} {
            background-color: transparent;
          }

          #${k}:hover {
            --bim-label--c: #FF5252;
          }

          #${A}:hover {
            background-color: #329936;
          }
        </style>
        <bim-button id=${k} style="flex: 0" @click=${n} label="Cancel"></bim-button>
        <bim-button id=${A} style="flex: 0" @click=${z} ${Qt(D)} label=${e?"Update Topic":"Add Topic"} icon=${e?"tabler:refresh":"mi:add"}></bim-button>
      </div>
    </div>
  `},j1=s=>{const{components:t,modelUserData:e,worldName:i}=s;return H`
    <bim-button
      data-ui-id="import-ifc"
      label="Load IFC"
      icon="mage:box-3d-fill"
      @click=${()=>{if(!(t&&i))return;const n=[...t.get(No).list.values()].find(o=>"name"in o&&o.name===i);if(!n)return;const r=document.createElement("input");r.type="file",r.accept=".ifc",r.onchange=async()=>{if(r.files===null||r.files.length===0)return;const o=r.files[0],a=await o.arrayBuffer(),l=new Uint8Array(a),c=o.name.replace(".ifc",""),h=t.get(qe),d=t.get(qm);d.settings.autoSetWasm=!1,d.settings.wasm={path:"https://unpkg.com/web-ifc@0.0.72/",absolute:!1};const p=await d.load(l,!0,c,{userData:e});n.scene.three.add(p.object),p.useCamera(n.camera.three),h.core.update(!0)},r.click()}}
    ></bim-button>
  `},H1=s=>qt.create(j1,s),V1=Object.freeze(Object.defineProperty({__proto__:null,loadIfc:H1},Symbol.toStringTag,{value:"Module"})),q1=s=>{const{components:t,world:e}=s;return H`
    <bim-button @click=${()=>{const i=document.createElement("input");i.type="file",i.accept=".frag",i.onchange=async()=>{if(i.files===null||i.files.length===0)return;const n=i.files[0],r=await n.arrayBuffer(),o=new Uint8Array(r),a=n.name.replace(".frag",""),l=t.get(qe),c=await l.core.load(o,{modelId:a});e&&(e.scene.three.add(c.object),c.useCamera(e.camera.three),l.core.update(!0))},i.click()}}></bim-button>
  `},W1=s=>{const t=qt.create(q1,s),[e]=t;return e.label="Load FRAG",e.icon="mage:box-3d-fill",t},Y1=Object.freeze(Object.defineProperty({__proto__:null,loadFrag:W1},Symbol.toStringTag,{value:"Module"}));({...V1,...Y1});const Ml=async(s,t)=>{const{localId:e,category:i,children:n}=t;if(i&&n){const r={data:{Name:i,modelId:s.modelId,children:JSON.stringify(n.map(o=>o.localId))}};for(const o of n){const a=await Ml(s,o);a&&(r.children||(r.children=[]),r.children.push(a))}return r}if(e!==null){const r=await s.getItem(e).getAttributes();if(!r)return null;const o={data:{Name:String(r.getValue("Name")),modelId:s.modelId,localId:e}};for(const a of n??[]){const l=await Ml(s,a);l&&(o.children||(o.children=[]),o.children.push(l))}return o}return null},Z1=async s=>{const t=[];for(const e of s){const i=await e.getSpatialStructure(),n=await Ml(e,i);if(!n)continue;const r={data:{Name:e.modelId,modelId:e.modelId},children:[n]};t.push(r)}return t},Xf=s=>{const{components:t,models:e}=s,i=s.selectHighlighterName??"select";return H`
    <bim-table @rowcreated=${n=>{n.stopImmediatePropagation();const{row:r}=n.detail,o=t.get(qn),a=t.get(qe);r.onclick=async()=>{if(!i)return;const{data:{modelId:l,localId:c,children:h}}=r;if(!(l&&(c!==void 0||h)))return;const d=a.list.get(l);if(d){if(c!==void 0){const p=await d.getItemsChildren([c]),u={[l]:p.length!==0?new Set(p):new Set([c])};o.highlightByID(i,u,!0,!0)}else if(h){const p=JSON.parse(h),u=await d.getItemsChildren(p),g={[l]:u.length!==0?u:p};o.highlightByID(i,g,!0,!0)}}}}} @cellcreated=${({detail:n})=>{const{cell:r}=n;r.column==="Name"&&!r.rowData.Name&&(r.style.gridColumn="1 / -1")}} ${Qt(async n=>{if(!n)return;const r=n;r.loadFunction=async()=>new Promise(o=>{setTimeout(()=>{o(Z1(e))})}),r.loadData(!0)})} headers-hidden>
      <bim-label slot="missing-data" style="--bim-icon--c: gold" icon="ic:round-warning">
        No models available to display the spatial structure!
      </bim-label>
    </bim-table>
  `},X1=(s,t=!0)=>{const e=qt.create(Xf,s),[i,n]=e;if(i.hiddenColumns=["modelId","localId","children"],i.columns=["Name"],i.headersHidden=!0,t){const{components:r}=s,o=r.get(qe);o.list.onItemSet.add(()=>n({models:o.list.values()})),o.list.onItemDeleted.add(()=>n())}return e},G1=Object.freeze(Object.defineProperty({__proto__:null,spatialTree:X1,spatialTreeTemplate:Xf},Symbol.toStringTag,{value:"Module"}));let ns={};const zd={_category:"Category",_localId:"LocalId",_guid:"Guid"},Q1=(s,t,e)=>{const i={data:{Name:t in zd?zd[t]:t,Value:e}};s.children||(s.children=[]),s.children.push(i)},Gf=(s,t,e)=>{var i;s in ns||(ns[s]=new Map);const n=ns[s],r=t._localId.value;if(n.has(r))return n.get(r);const o=(i=t[e.defaultItemNameKey])==null?void 0:i.value,a=t._category.value,l={data:{Name:(o==null?void 0:o.toString().length)>0?o.toString():a??String(r)}};n.set(r,l);for(const c in t){const h=t[c];if(!Array.isArray(h))Q1(l,c,h.value);else{const d={data:{Name:c}};l.children||(l.children=[]),l.children.push(d);for(const p of h){const u=Gf(s,p,e);d.children||(d.children=[]),d.children.push(u)}}}return l},K1=async(s,t,e)=>{const i=s.get(qe);Object.keys(t).length===0&&(ns={});const n=[];for(const r in t){const o=i.list.get(r);if(!o)continue;r in ns||(ns[r]=new Map);const a=ns[r],l=t[r];for(const c of l){let h=a.get(c);if(h){n.push(h);continue}const[d]=await o.getItemsData([c],e.itemsDataConfig);h=Gf(r,d,e),n.push(h)}}return n},Qf=s=>{const t={defaultItemNameKey:"Name",itemsDataConfig:{attributesDefault:!0,relationsDefault:{attributes:!1,relations:!1},relations:{IsDefinedBy:{attributes:!0,relations:!0},DefinesOcurrence:{attributes:!1,relations:!1},ContainedInStructure:{attributes:!0,relations:!0},ContainsElements:{attributes:!1,relations:!1},Decomposes:{attributes:!1,relations:!1}}},...s},{components:e,modelIdMap:i,emptySelectionWarning:n}=s;return H`
    <bim-table @cellcreated=${({detail:r})=>{const{cell:o}=r;o.column==="Name"&&!("Value"in o.rowData)&&(o.style.gridColumn="1 / -1")}} ${Qt(async r=>{if(!r)return;const o=r;o.loadFunction=async()=>K1(e,i,t),await o.loadData(!0)&&o.dispatchEvent(new Event("datacomputed"))})}>
      ${n?H`
            <bim-label slot="missing-data" style="--bim-icon--c: gold" icon="ic:round-warning">
              Select some elements to display its properties
            </bim-label>
            `:null}
      <bim-label slot="error-loading" style="--bim-icon--c: #e72e2e" icon="bxs:error-alt">
        Something went wrong with the properties
      </bim-label>
    </bim-table>
  `},J1=(s,t)=>{t.columns=[{name:"Name",width:"12rem"}],t.headersHidden=!0},tx=s=>{const t=qt.create(Qf,s),[e]=t;return J1(s,e),t},ex=Object.freeze(Object.defineProperty({__proto__:null,itemsData:tx,itemsDataTemplate:Qf},Symbol.toStringTag,{value:"Module"})),Kf=s=>{const{components:t}=s,e=s.missingDataMessage??"No models has been loaded yet",i=t.get(qe),n=({detail:r})=>{const{cell:o}=r;o.style.padding="0.25rem 0"};return H`
    <bim-table ${Qt(async r=>{if(!r)return;const o=r,a=[];if(i.initialized)for(const[,l]of i.list){if(!l)continue;const c=await l.getMetadata(),h={data:{Name:l.modelId,modelId:l.modelId,metadata:JSON.stringify(c)}};a.push(h)}o.data=a})} @cellcreated=${n}>
      <bim-label slot="missing-data" style="--bim-icon--c: gold" icon="ic:round-warning">
        ${e}
      </bim-label>
    </bim-table>
  `},ix=(s,t)=>{const{components:e,actions:i,metaDataTags:n}=s,r=e.get(qe),o=(i==null?void 0:i.dispose)??!0,a=(i==null?void 0:i.download)??!0,l=(i==null?void 0:i.visibility)??!0,c=n??[];t.hiddenColumns=["modelId","metadata"],t.headersHidden=!0,t.noIndentation=!0,t.dataTransform={Name:(h,d)=>{if(!r.initialized)return h;const{modelId:p,metadata:u}=d;if(!p)return h;const g=r.list.get(p);if(!g)return p;const m=[];if(u){const _=JSON.parse(u);for(const x of c){const C=_[x];if(!(typeof C=="string"||typeof C=="boolean"||typeof C=="number"))continue;const S=H`
            <bim-label style="background-color: var(--bim-ui_main-base); padding: 0 0.25rem; color: var(--bim-ui_main-contrast); border-radius: 0.25rem;">${C}</bim-label>
            `;m.push(S)}}let b;o&&(b=H`<bim-button @click=${()=>r.core.disposeModel(g.modelId)} icon="mdi:delete"></bim-button>`);let f;l&&(f=H`<bim-button @click=${async({target:_})=>{_.loading=!0,await g.setVisible(void 0,_.hasAttribute("data-model-hidden")),await r.core.update(!0),_.toggleAttribute("data-model-hidden"),_.icon=_.hasAttribute("data-model-hidden")?"mdi:eye-off":"mdi:eye",_.loading=!1}} icon="mdi:eye"></bim-button>`);let y;return a&&(y=H`<bim-button @click=${async()=>{const _=await g.getBuffer(!1),x=new File([_],`${g.modelId}.frag`),C=document.createElement("a");C.href=URL.createObjectURL(x),C.download=x.name,C.click(),URL.revokeObjectURL(C.href)}} icon="flowbite:download-solid"></bim-button>`),H`
       <div style="display: flex; flex: 1; gap: var(--bim-ui_size-4xs); justify-content: space-between; overflow: auto;">
        <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 0 var(--bim-ui_size-4xs); flex-grow: 1; overflow: auto;">
          <div style="min-height: 1.75rem; overflow: auto; display: flex;">
            <bim-label style="white-space: normal;">${h}</bim-label>
          </div>
          <div style="display: flex; flex-wrap: wrap; gap: var(--bim-ui_size-4xs); overflow: auto;">
            ${m}
          </div>
        </div>
        <div style="display: flex; align-self: flex-start; flex-shrink: 0;">
          ${y}
          ${f}
          ${b}
        </div>
       </div>
      `}}},sx=(s,t=!0)=>{const e=qt.create(Kf,s),[i,n]=e;if(ix(s,i),t){const{components:r}=s,o=r.get(qe),a=()=>setTimeout(()=>n());o.list.onItemSet.add(a),o.list.onItemDeleted.add(a)}return e},nx=Object.freeze(Object.defineProperty({__proto__:null,modelsList:sx,modelsListTemplate:Kf},Symbol.toStringTag,{value:"Module"})),Jf=s=>{var t;const{components:e}=s,i=s.missingDataMessage??"No viewpoints to display",n=e.get(Ro),r=((t=s.topic)==null?void 0:t.viewpoints)??n.list.keys(),o=[];for(const c of r){const h=n.list.get(c);h&&o.push(h)}const a=c=>{if(!c)return;const h=c;h.data=o.map((d,p)=>({data:{Guid:d.guid,Title:d.title??`Viewpoint ${s.topic?p+1:""}`,Actions:""}}))},l=({detail:c})=>{const{cell:h}=c;h.style.padding="0.25rem"};return H`
    <bim-table ${Qt(a)} @cellcreated=${l}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${i}</bim-label>
    </bim-table>
  `},rx=(s,t)=>{const{components:e,topic:i}=s;t.noIndentation=!0,t.headersHidden=!0,t.hiddenColumns=["Guid"],t.columns=["Title",{name:"Actions",width:"auto"}];const n={selectComponents:!0,colorizeComponent:!0,resetColors:!0,updateCamera:!0,delete:!0,unlink:!!i,...s.actions},r=e.get(Ro);t.dataTransform={Actions:(o,a)=>{const{Guid:l}=a;if(!(l&&typeof l=="string"))return o;const c=r.list.get(l);if(!c)return o;const h=async({target:y})=>{y.loading=!0,await c.go(),y.loading=!1};let d;n.selectComponents&&(d=H`
          <bim-button label="Select Components" @click=${async({target:y})=>{const _=e.get(qe),x=e.get(qn);if(!x.isSetup)return;y.loading=!0;const C=await _.guidsToModelIdMap([...c.selectionComponents]);await x.highlightByID("select",C),y.loading=!1}}></bim-button>
        `);let p;n.colorizeComponent&&(p=H`
          <bim-button label="Colorize Components" @click=${async({target:y})=>{y.loading=!0,await c.setColorizationState(!0),y.loading=!1}}></bim-button>
        `);let u;n.resetColors&&(u=H`
          <bim-button label="Reset Colors" @click=${async({target:y})=>{y.loading=!0,await c.setColorizationState(!1),y.loading=!1}}></bim-button>
        `);let g;n.updateCamera&&(g=H`
          <bim-button label="Update Camera" @click=${()=>c.updateCamera()}></bim-button>
        `);let m;n.unlink&&(m=H`
          <bim-button label="Unlink" @click=${()=>i==null?void 0:i.viewpoints.delete(c.guid)}></bim-button>
        `);let b;n.delete&&(b=H`
          <bim-button label="Delete" @click=${()=>{r.list.delete(c.guid),Kn.removeMenus()}}></bim-button>
        `);let f;return Object.values(n).includes(!0)&&(f=H`
          <bim-button icon="prime:ellipsis-v">
            <bim-context-menu>
              ${d}
              ${p}
              ${u}
              ${g}
              ${m}
              ${b}
            </bim-context-menu>
          </bim-button>
        `),H`
        <bim-button icon="ph:eye-fill" @click=${h}></bim-button>
        ${f}
      `}}},tm=(s,t=!0)=>{const e=qt.create(Jf,s),[i,n]=e;if(rx(s,i),t){const{components:r,topic:o}=s,a=r.get(Ro);a.list.onItemUpdated.add(()=>n()),a.list.onItemDeleted.add(()=>n()),a.list.onCleared.add(()=>n()),o?(o.viewpoints.onItemAdded.add(()=>n()),o.viewpoints.onItemDeleted.add(()=>n()),o.viewpoints.onCleared.add(()=>n())):a.list.onItemSet.add(()=>n())}return e},ox=Object.freeze(Object.defineProperty({__proto__:null,viewpointsList:tm,viewpointsListTemplate:Jf},Symbol.toStringTag,{value:"Module"})),em=s=>{const{components:t}=s,e=s.missingDataMessage??"No topics to display",i=t.get(Uo),n=s.topics??i.list.values();return H`
    <bim-table no-indentation ${Qt(r=>{if(!r)return;const o=r;o.data=[...n].map(a=>{var l;return{data:{Guid:a.guid,Title:a.title,Status:a.status,Description:a.description??"",Author:a.creationAuthor,Assignee:a.assignedTo??"",Date:a.creationDate.toDateString(),DueDate:((l=a.dueDate)==null?void 0:l.toDateString())??"",Type:a.type,Priority:a.priority??"",Actions:""}}})})}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${e}</bim-label>
    </bim-table>
  `},ax=(s,t)=>{const{dataStyles:e}=s;t.hiddenColumns.length===0&&(t.hiddenColumns=["Guid","Actions"]),t.columns=["Title"],t.dataTransform={Priority:i=>{if(typeof i!="string")return i;const n=((e==null?void 0:e.priorities)??ye.priorities)[i];return H`
            <bim-label
              .icon=${n==null?void 0:n.icon}
              style=${ui({...qs,...n==null?void 0:n.style})}
            >${i}
            </bim-label>
          `},Status:i=>{if(typeof i!="string")return i;const n=((e==null?void 0:e.statuses)??ye.statuses)[i];return H`
            <bim-label
              .icon=${n==null?void 0:n.icon}
              style=${ui({...qs,...n==null?void 0:n.style})}
            >${i}
            </bim-label>
          `},Type:i=>{if(typeof i!="string")return i;const n=((e==null?void 0:e.types)??ye.types)[i];return H`
            <bim-label
              .icon=${n==null?void 0:n.icon}
              style=${ui({...qs,...n==null?void 0:n.style})}
            >${i}
            </bim-label>
          `},Author:i=>typeof i!="string"?i:Vs(i,(e==null?void 0:e.users)??ye.users),Assignee:i=>typeof i!="string"?i:Vs(i,(e==null?void 0:e.users)??ye.users)}},im=(s,t=!0)=>{const e=qt.create(em,s),[i,n]=e;if(ax(s,i),t){const{components:r,topics:o}=s,a=r.get(Uo),l=()=>n();if(a.list.onItemUpdated.add(l),a.list.onItemDeleted.add(l),o)for(const c of o)c.relatedTopics.onItemAdded.add(l),c.relatedTopics.onItemDeleted.add(l),c.relatedTopics.onCleared.add(l);else a.list.onItemSet.add(l)}return e},lx=Object.freeze(Object.defineProperty({__proto__:null,topicsList:im,topicsListTemplate:em},Symbol.toStringTag,{value:"Module"})),sm=s=>{const{topic:t,styles:e,viewpoint:i}=s,n=s.missingDataMessage??"The topic has no comments";return H`
    <bim-table no-indentation ${Qt(r=>{if(!r)return;const o=r;let a=t.comments.values();i&&(a=[...t.comments.values()].filter(l=>l.viewpoint===i.guid)),o.data=[...a].map(l=>({data:{guid:l.guid,Comment:l.comment,author:(()=>{const c=e;if(!c)return l.author;const h=c[l.author];return(h==null?void 0:h.name)??l.author})()}}))})}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${n}</bim-label>
    </bim-table>
  `},cx=(s,t)=>{const{topic:e,styles:i}=s,n={delete:!0,...s.actions};t.headersHidden=!0,t.hiddenColumns=["guid","author"],t.dataTransform={Comment:(r,o)=>{const{guid:a}=o;if(typeof a!="string")return r;const l=e.comments.get(a);if(!l)return r;const c=()=>{e.comments.delete(a)};let h;if(n.delete){const d=`btn-${ae.newRandomId()}`;h=H`
          <div>
            <style>
              #${d} {
                background-color: transparent;
                --bim-label--c: var(--bim-ui_bg-contrast-60)
              }
  
              #${d}:hover {
                --bim-label--c: #FF5252;
              }
            </style>
            <bim-button @click=${c} id=${d} icon="majesticons:delete-bin"></bim-button>
          </div>
        `}return H`
        <div style="display: flex; flex-direction: column; gap: 0.25rem; flex: 1">
          <div style="display: flex; justify-content: space-between;">
            <div style="display: flex; gap: 0.375rem;">
              ${Vs(l.author,i??ye.users)}
              <bim-label style="color: var(--bim-ui_bg-contrast-40)">@ ${l.date.toDateString()}</bim-label>
            </div>
            ${h}
          </div>
          <bim-label style="margin-left: 1.7rem; white-space: normal">${l.comment}</bim-label>
        </div>
      `}}},nm=(s,t=!0)=>{const e=qt.create(sm,s),[i,n]=e;if(cx(s,i),t){const{topic:r}=s,o=()=>n();r.comments.onItemSet.add(o),r.comments.onItemUpdated.add(o),r.comments.onItemDeleted.add(o),r.comments.onCleared.add(o)}return e},hx=Object.freeze(Object.defineProperty({__proto__:null,commentsList:nm,commentsListTemplate:sm},Symbol.toStringTag,{value:"Module"}));({...G1,...ex,...nx,...ox,...lx,...hx});const rm=(s,t)=>{const{showInput:e,topic:i,styles:n}=s,r={add:!0,delete:!0,...s.actions},o=`input-${ae.newRandomId()}`,a=`btn-${ae.newRandomId()}`,l=`btn-${ae.newRandomId()}`,c=()=>document.getElementById(a),h=()=>document.getElementById(o),d=()=>{const _=h();return _?_.value.trim().length>0:!1},p=()=>{t({showInput:!0})},u=()=>{const _=h(),x=d();_&&x&&(i.createComment(_.value),t({showInput:!1}))},g=()=>{t({showInput:!1})},m=()=>{const _=c();if(_){if(!h()){_.disabled=!0;return}_.disabled=!d()}},b=H`
    ${r.add?H`<bim-button @click=${p} label="Add Comment" icon="majesticons:comment-line"></bim-button>`:null}
  `,f=H`
    <bim-text-input id=${o} @input=${m} @keypress=${_=>{_.code==="Enter"&&_.ctrlKey&&u()}} type="area"></bim-text-input>

    <div style="justify-content: right; display: flex; gap: 0.375rem">
      <style>
        #${a} {
          background-color: #329936;
        }  

        #${l} {
          background-color: transparent;
        }

        #${l}:hover {
          --bim-label--c: #FF5252;
        }
      </style>

      <bim-button style="flex: 0" id=${l} @click=${g} label="Cancel"></bim-button>
      <bim-button style="flex: 0" id=${a} @click=${u} label="Accept" icon="material-symbols:check" disabled></bim-button>
    </div>
  `,[y]=nm({topic:i,actions:r,styles:n??ye.users});return H`
    <div style="display: flex; flex-direction: column; gap: 0.5rem">
      ${y}
      ${e?f:b}
    </div>
  `},dx=s=>qt.create(rm,s),ux=Object.freeze(Object.defineProperty({__proto__:null,topicComments:dx,topicCommentsSectionTemplate:rm},Symbol.toStringTag,{value:"Module"})),om=(s,t)=>{const{components:e,editing:i,topic:n,styles:r}=s,o={update:!0,...s.actions},a=(r==null?void 0:r.priorities)??ye.priorities,l=(r==null?void 0:r.statuses)??ye.statuses,c=(r==null?void 0:r.types)??ye.types;let h;n!=null&&n.priority&&(h=a[n.priority]);let d;n!=null&&n.type&&(d=c[n.type]);let p;n!=null&&n.type&&(p=l[n.status]);let u,g;return i?u=Zf({components:e,topic:n,styles:r,onSubmit:()=>{t({editing:!1})},onCancel:()=>{t({editing:!1})}}):g=H`
      <div>
        <bim-label>Title</bim-label>
        <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${n.title}</bim-label>
      </div>

      ${n.description?H`
            <div>
              <bim-label>Description</bim-label>
              <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100); white-space: normal">${n.description}</bim-label>
            </div>
          `:null}

      <div style="display: flex; gap: 0.375rem">
        <bim-label>Status</bim-label>
        <bim-label .icon=${p==null?void 0:p.icon} style=${ui({...qs,...p==null?void 0:p.style})}
        >${n.status}
        </bim-label>
      </div>

      <div style="display: flex; gap: 0.375rem">
        <bim-label>Type</bim-label>
        <bim-label .icon=${d==null?void 0:d.icon} style=${ui({...qs,...d==null?void 0:d.style})}
        >${n.type}
        </bim-label>
      </div>

      ${n.priority?H`
            <div style="display: flex; gap: 0.375rem">
              <bim-label>Priority</bim-label>
              <bim-label .icon=${h==null?void 0:h.icon} style=${ui({...qs,...h==null?void 0:h.style})}
              >${n.priority}
              </bim-label>
            </div>`:null}

      <div style="display: flex; gap: 0.375rem">
        <bim-label>Author</bim-label>
        ${Vs(n.creationAuthor,(r==null?void 0:r.users)??ye.users)}
      </div>

      ${n.assignedTo?H`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Assignee</bim-label>
            ${Vs(n.assignedTo,(r==null?void 0:r.users)??ye.users)}
          </div>`:null}

      ${n.dueDate?H`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Due Date</bim-label>
            <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${n.dueDate.toDateString()}</bim-label>
          </div>`:null}

      ${n.modifiedAuthor?H`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Modified By</bim-label>
            ${Vs(n.modifiedAuthor,(r==null?void 0:r.users)??ye.users)}
          </div>`:null}

      ${n.modifiedDate?H`
            <div style="display: flex; gap: 0.375rem">
              <bim-label>Modified Date</bim-label>
              <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${n.modifiedDate.toDateString()}</bim-label>
            </div>`:null}

      ${n.labels.size!==0?H`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Labels</bim-label>
            <bim-label style="white-space: normal; --bim-label--c: var(--bim-ui_bg-contrast-100)">${[...n.labels].join(", ")}</bim-label>
          </div>`:null}

      ${o.update?H`
              <bim-button @click=${()=>t({editing:!0})} label="Update Information" icon="tabler:refresh"></bim-button> 
            `:null}
    `,H`
    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
      ${i?u:g}
    </div>
  `},px=s=>qt.create(om,s),fx=Object.freeze(Object.defineProperty({__proto__:null,topicInformation:px,topicInformationSectionTemplate:om},Symbol.toStringTag,{value:"Module"})),am=(s,t)=>{const{components:e,topic:i,linking:n}=s,r=e.get(Uo),o={link:!0,...s.actions},[a,l]=im({components:e,topics:[...i.relatedTopics].map(p=>r.list.get(p)).map(p=>p)});a.headersHidden=!0,a.hiddenColumns=["Guid","Status","Description","Author","Assignee","Date","DueDate","Type","Priority"];const c=()=>H`
      <bim-text-input placeholder="Search..." debounce="100" @input=${p=>{const u=p.target;u instanceof ge&&(a.queryString=u.value)}}></bim-text-input> 
    `;let h,d;if(n){a.selectableRows=!0,l({topics:void 0});const p=a.data.filter(f=>{const{Guid:y}=f.data;return typeof y!="string"?!1:i.relatedTopics.has(y)}).map(f=>f.data);a.selection=new Set(p);const u=()=>{const f=[...a.selection].map(({Guid:y})=>typeof y!="string"?null:r.list.has(y)?y:null).map(y=>y);i.relatedTopics.clear(),i.relatedTopics.add(...f),t({linking:!1})},g=()=>{t({linking:!1})},m=`btn-${ae.newRandomId()}`,b=`btn-${ae.newRandomId()}`;h=H`
      <div style="display: flex; gap: 0.25rem">
        <style>
          #${m}:hover {
            background-color: #329936;
          }  

          #${b} {
            background-color: transparent;
          }

          #${b}:hover {
            --bim-label--c: #FF5252;
          }
        </style>
        ${c()}
        <div style="display: flex; justify-content: right; gap: 0.25rem">
          <bim-button id=${b} @click=${g} style="flex: 0" label="Cancel" icon="material-symbols:close"></bim-button>
          <bim-button id=${m} @click=${u} style="flex: 0" label="Accept" icon="material-symbols:check"></bim-button>
        </div>
      </div> 
    `}else{a.selectableRows=!1;const p=()=>{t({linking:!0})};d=H`
      <div style="display: flex; justify-content: right; gap: 0.25rem">
        ${c()}
        ${o.link?H`<bim-button style="flex: 0" @click=${p} icon="tabler:link"></bim-button>`:null}
      </div> 
    `}return H`
    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
      ${d}
      ${h}
      ${a}
    </div> 
  `},mx=s=>qt.create(am,s),gx=Object.freeze(Object.defineProperty({__proto__:null,topicRelations:mx,topicRelationsSectionTemplate:am},Symbol.toStringTag,{value:"Module"})),lm=(s,t)=>{const{components:e,topic:i,world:n,linking:r}=s,o={add:!0,link:!0,selectComponents:!0,colorizeComponent:!0,resetColors:!0,updateCamera:!0,delete:!0,unlink:!0,...s.actions},a=e.get(Ro),[l,c]=tm({components:e,topic:i,actions:o}),h=()=>H`
      <bim-text-input placeholder="Search..." debounce="100" @input=${u=>{const g=u.target;g instanceof ge&&(l.queryString=g.value)}}></bim-text-input> 
    `;let d,p;if(r){l.selectableRows=!0,c({topic:void 0,actions:{delete:!1,updateCamera:!1,colorizeComponent:!1,resetColors:!1}});const u=l.data.filter(y=>{const{Guid:_}=y.data;return typeof _!="string"?!1:i.viewpoints.has(_)}).map(y=>y.data);l.selection=new Set(u);const g=()=>{const y=[...l.selection].map(({Guid:_})=>typeof _!="string"?null:a.list.has(_)?_:null).map(_=>_);i.viewpoints.clear(),i.viewpoints.add(...y),t({linking:!1})},m=()=>{t({linking:!1})},b=`btn-${ae.newRandomId()}`,f=`btn-${ae.newRandomId()}`;d=H`
      <div style="display: flex; gap: 0.25rem">
        <style>
          #${b}:hover {
            background-color: #329936;
          }  

          #${f} {
            background-color: transparent;
          }

          #${f}:hover {
            --bim-label--c: #FF5252;
          }
        </style>
        ${h()}
        <div style="display: flex; justify-content: right; gap: 0.25rem">
          <bim-button id=${f} @click=${m} style="flex: 0" label="Cancel" icon="material-symbols:close"></bim-button>
          <bim-button id=${b} @click=${g} style="flex: 0" label="Accept" icon="material-symbols:check"></bim-button>
        </div>
      </div> 
    `}else{l.selectableRows=!1,c({topic:i,actions:o});const u=()=>{if(!(i&&o.add&&!r))return;const f=a.create();n&&(f.world=n),i.viewpoints.add(f.guid)},g=()=>{t({linking:!0})},m=H`<bim-button style="flex: 0" @click=${u} .disabled=${!n} icon="mi:add"></bim-button>`,b=H`<bim-button style="flex: 0" @click=${g} icon="tabler:link"></bim-button>`;p=H`
      <div style="display: flex; justify-content: right; gap: 0.25rem">
        ${h()}
        <div style="display: flex; justify-content: right; gap: 0.25rem">
          ${o.add?m:null}
          ${o.link?b:null}
        </div>
      </div> 
    `}return H`
    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
      ${p}
      ${d}
      ${l}
    </div> 
  `},bx=s=>qt.create(lm,s),yx=Object.freeze(Object.defineProperty({__proto__:null,topicViewpoints:bx,topicViewpointsSectionTemplate:lm},Symbol.toStringTag,{value:"Module"}));({...ux,...fx,...gx,...yx});const vx=s=>H`
    <bim-panel-section fixed label="New Topic" name="topic">
      ${Zf(s)}
    </bim-panel-section>
  `,_x=s=>qt.create(vx,s),wx=Object.freeze(Object.defineProperty({__proto__:null,topic:_x},Symbol.toStringTag,{value:"Module"}));({...wx});const cm=document.getElementById("container"),Ze=new Wm,xx=Ze.get(No),Bt=xx.create();Bt.scene=new jl(Ze);Bt.renderer=new Ym(Ze,cm);Bt.camera=new Zm(Ze);Ze.init();Rm.init();R1.init();Bt.scene.setup();Bt.camera.controls.setLookAt(5,5,5,0,0,0);cm.appendChild(Bt.renderer.three2D.domElement);const Cx=Ze.get(qd);Cx.create(Bt);Bt.camera.three.far=1e4;Bt.camera.three.updateProjectionMatrix();Bt.scene.three.background=null;const aa=Ze.get(qe);aa.init("https://thatopen.github.io/engine_fragment/resources/worker.mjs");const hm="https://thatopen.github.io/engine_components/resources/frags/small_road.frag",Ex=await fetch(hm),Sx=await Ex.arrayBuffer(),Ax=new Uint8Array(Sx),la=await aa.core.load(Ax,{modelId:hm,camera:Bt.camera.three});Bt.scene.three.add(la.object);await aa.core.update(!0);Bt.camera.controls.addEventListener("control",()=>aa.core.update());la.getClippingPlanesEvent=()=>Array.from(Bt.renderer.three.clippingPlanes)||[];const bi=await la.getAlignments();Bt.scene.three.add(bi);const de=Ze.get(Za),Gt=de.create("absolute");Gt.world=Bt;for(const s of bi.children)s.userData.initialStation=1925;Gt.alignments.push(bi);Gt.updateAlignments();console.log(bi);const Io=new Di(void 0,20);Gt.onMarkerChange.add(({point:s})=>{Io.center.copy(s),Bt.camera.controls.fitToSphere(Io,!0)});const He=Ze.get(Xa);He.world=Bt;const $x=document.getElementById("horizontal-menu"),bs=document.createElement("bim-world-2d");bs.components=Ze;if(!bs.world)throw new Error("World not found!");$x.appendChild(bs);const yi=de.create("horizontal");yi.world=bs.world;const ys=await la.getHorizontalAlignments();for(const s of ys.children)s.rotation.x=Math.PI/2,s.rotation.y=Math.PI/2;yi.alignments.push(ys);yi.updateAlignments();const dm=bs.world.scene.three;dm.background=null;dm.add(ys);for(const s of ys.children)s.userData.initialStation=1925;Gt.onMarkerChange.add(s=>{console.log(s);const t=Ii.curvePointToAlignmentPercentage(s.alignment,s.point,s.curve);if(t===null)return;const e=Ii.alignmentPercentageToPoint(ys.children[0],t);e!==null&&(yi.setMarkerAtPoint(e,"select"),yi.setCursorValue(Gt.getCursorValue(),"select"))});const Tx=Ze.get(Fl),kx=Tx.get(bs.world);kx.three.params.Line.threshold=10;await bs.world.camera.controls.setLookAt(0,0,1e4,0,0,0,!1);const gn=new Fm;gn.showPanel(2);document.body.append(gn.dom);gn.dom.style.left="0px";gn.dom.style.zIndex="unset";Bt.renderer.onBeforeUpdate.add(()=>gn.begin());Bt.renderer.onAfterUpdate.add(()=>gn.end());let pi=0,qa=null,Dd=0,po=!0,Rs=!1;function Ll(){const s=bi.children[pi],t=ys.children[pi];po?(Gt.highlight(s),yi.highlight(t)):(Gt.clearHighlight(),yi.clearHighlight())}Ll();let Md=-1;function Pi(){Md!==pi&&Gt.clearStations(),Md=pi;const s=bi.children[pi];Rs?(Gt.createStations(s),Gt.updateStations()):Gt.clearStations()}function Ld(s){const t=Ii.alignmentPercentageToPoint(bi.children[pi],s);t&&(Io.center.copy(t.point),Bt.camera.controls.fitToSphere(Io,!0),Gt.setMarkerAtPoint(t,"select"),He.set(t.point,t.normal),qa&&clearTimeout(qa),He.sectionVisible=!1,qa=setTimeout(()=>{He.plane.enabled&&He.update()},1e3),Rs&&He.plane.enabled&&Pi());const e=Ii.alignmentPercentageToPoint(ys.children[pi],s);e&&(yi.setMarkerAtPoint(e,"select"),yi.setCursorValue(Gt.getCursorValue(),"select"))}const um=1e3;let zo=0;Bt.camera.controls.addEventListener("update",()=>{const s=Date.now();s-zo>um&&(Pi(),zo=s)});Bt.camera.controls.addEventListener("update",()=>{const s=Date.now();s-zo>um&&(Pi(),zo=s)});const Jn=jd.create(()=>Ya`
  <bim-panel active label="Civil 3D Navigator Tutorial" class="options-menu">

      <bim-panel-section label="Alignments">

         <bim-dropdown required label="Selected alignment"
             @change="${({target:s})=>{pi=s.value[0],po&&Ll(),Rs&&Pi()}}">

          ${bi.children.map(()=>Ya`
              <bim-option ?checked=${Dd===0} label="${Dd++}"></bim-option>
            `)}
        </bim-dropdown>
        
        <bim-number-input
          slider step="1" label="Highlight width" value="${Gt.highlightMaterial.linewidth}" min="1" max="10"
          @change="${({target:s})=>{de.highlightMaterial.linewidth=s.value}}">
        </bim-number-input>

        <bim-color-input 
          label="Highlight Color" color="#${de.highlightMaterial.color.getHexString()}" 
          @input="${({target:s})=>{de.highlightMaterial.color=new bt(s.color)}}">
        </bim-color-input>

        
        <bim-color-input 
          label="Station Label Color" color="#${de.stationLabelColor.getHexString()}" 
          @input="${({target:s})=>{de.stationLabelColor=new bt(s.color)}}">
        </bim-color-input>

        
        <bim-color-input 
          label="Station Label Background Color" color="#${de.stationLabelBackgroundColor.getHexString()}" 
          @input="${({target:s})=>{de.stationLabelBackgroundColor=new bt(s.color)}}">
        </bim-color-input>

        <bim-color-input 
          label="Station Pointer Color" color="#${de.stationPointerColor.getHexString()}" 
          @input="${({target:s})=>{de.stationPointerColor=new bt(s.color)}}">
        </bim-color-input>

        <bim-color-input 
          label="Station Pointer Background Color" color="#${de.stationPointerBackgroundColor.getHexString()}" 
          @input="${({target:s})=>{de.stationPointerBackgroundColor=new bt(s.color)}}">
        </bim-color-input>

        <bim-number-input
          slider step="0.05" label="Screen distance limit" value="${de.screenDistanceLimit}" min="0" max="1"
          @change="${({target:s})=>{de.screenDistanceLimit=s.value,Gt.updateStations()}}">
        </bim-number-input>

        <bim-checkbox
          label="Highlight selected" checked="${po}"
          @change="${({target:s})=>{po=s.checked,Ll()}}">
        </bim-checkbox>

        <bim-checkbox
          label="Show kps"
          @change="${({target:s})=>{Rs=s.checked,Pi()}}">
        </bim-checkbox>

        
        <bim-checkbox
          label="Clip"
          @change="${({target:s})=>{He.plane.enabled=s.checked,He.sectionVisible=s.checked,s.checked&&(He.update(),He.plane.update()),Rs&&Pi()}}">
        </bim-checkbox>

        
      <bim-checkbox
        label="Flip"
        @change="${({target:s})=>{He.flip=s.checked,Rs&&Pi()}}">
      </bim-checkbox>

      <bim-number-input
      slider step="10" label="Increments" value="${Gt.increments}" min="10" max="100"
      @change="${({target:s})=>{Gt.increments=s.value,Pi()}}">
    </bim-number-input>

    <bim-number-input
      slider step="0.01" label="Alignment navigation" value="0.5" min="0" max="1"
      @change="${({target:s})=>{Ld(s.value)}}">
    </bim-number-input>

    <bim-number-input
      slider step="10" label="Move to KP" value="2000" min="1925" max="3000"
      @change="${({target:s})=>{const t=bi.children[pi],e=Ii.alignmentLength(t),n=(s.value-t.userData.initialStation)/e,r=Math.min(Math.max(n,0),1);Ld(r)}}">
    </bim-number-input>

    </bim-panel-section>

    </bim-panel>
    `);Jn.style.zIndex="9999";document.body.append(Jn);const Px=jd.create(()=>Ya`
      <bim-button class="phone-menu-toggler" icon="solar:settings-bold"
        @click="${()=>{Jn.classList.contains("options-menu-visible")?Jn.classList.remove("options-menu-visible"):Jn.classList.add("options-menu-visible")}}">
      </bim-button>
    `);document.body.append(Px);
