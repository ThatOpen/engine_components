var Om=Object.defineProperty;var Mm=(s,e,t)=>e in s?Om(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var le=(s,e,t)=>(Mm(s,typeof e!="symbol"?e+"":e,t),t);import{e as nt,g as Ht,p as Et,b as D,C as be,G as Ni,ag as Yl,x as xe,r as Ho,h as Ne,P as Ot,L as St,j as Ve,ah as Zl,O as Vo,ai as co,U as Xd,aj as ho,af as rn,S as Ri,M as gt,Y as Se,ak as Im,al as Bc,am as zm,W as je,an as Un,w as Dm,c as re,m as on,D as Ui,ao as Lm,ap as Bm,F as Fi,z as Qd,n as Nm,o as Rm,l as Gl,k as _o,aq as Um,v as Fm,a0 as jm,a1 as Hm,ar as Xl,t as Kd,as as Vm,at as Jd,au as ht,av as Ys,aw as qm,ax as Nc,q as Wm,ay as Ym,az as Ja,aA as Us,aB as Zm,i as Gm,d as Xm,B as ot,aC as eu,aD as Qm,aE as Vt,aF as Km,aG as Rc,aH as Jm,aI as Or,aJ as wn,aK as eg,aL as tg,aM as ig,ae as sg,aN as Uc,u as ng,a as rg,V as tu,f as el}from"./index-DcyXhVxI.js";import{R as Ql,E as wo,j as og,c as iu,h as ag,F as Yt,W as qo,S as Kl,O as su,k as lg,d as nu,l as Wo,m as Yo,n as cg,T as Ei,C as hg,i as dg,o as ug}from"./graphic-vertex-picker-ClbEbQzL.js";import{b as ru,a as pg,L as fg}from"./LineSegments2-Bl2G5k3J.js";class mg{constructor(e){le(this,"alignments",[]);le(this,"enabled",!0);le(this,"world",null);le(this,"_raycastable",[]);le(this,"_components");this._components=e}update(){this.dispose();for(const e of this.alignments)for(const t of e.children){const i=t;i.updateWorldMatrix(!0,!0);for(const n of i.children){const r=n;if(r.isLine2&&r.userData.points){const o=new nt,a=new Ht;a.geometry.setIndex(r.geometry.index);const l=new Float32Array(r.userData.points),c=new Et(l,3);o.setAttribute("position",c),a.geometry=o,a.userData.curve=r,a.applyMatrix4(r.matrixWorld),a.updateMatrixWorld(),this._raycastable.push(a)}}}}dispose(){for(const e of this._raycastable)e.geometry.dispose(),e.geometry=void 0;this._raycastable=[]}castRay(){if(!this.enabled||!this.world)return null;const i=this._components.get(Ql).get(this.world).castRayToObjects(this._raycastable);if(!i)return null;const n=i.object,r=n.geometry,o=i.index,a=r.attributes.position.array[o*3],l=r.attributes.position.array[o*3+1],c=r.attributes.position.array[o*3+2],h=r.attributes.position.array[o*3+3],d=r.attributes.position.array[o*3+4],p=r.attributes.position.array[o*3+5],u=new D(h-a,d-l,p-c).normalize();return{point:i.point,normal:u,curve:n.userData.curve,alignment:n.userData.curve.parent}}}class Di{static alignmentPercentageToPoint(e,t){const i=new D,n=new D,r=this.alignmentLength(e),o=t*r;let a=0;if(e.updateWorldMatrix(!0,!0),t===1)for(let l=e.children.length-1;l>=0;l--){const c=e.children[l],h=c.userData.points;if(!h)continue;const d=new D(h[h.length-3],h[h.length-2],h[h.length-1]);return d.applyMatrix4(c.matrixWorld),{normal:new D,point:d,curve:c,alignment:e}}for(const l of e.children){const c=l.userData.points;if(c)for(let h=0;h<c.length-3;h+=3){const d=i.set(c[h],c[h+1],c[h+2]),p=n.set(c[h+3],c[h+4],c[h+5]),u=d.distanceTo(p);if(a+u>=o){const g=o-a,m=p.clone().sub(d).normalize(),b=m.clone().multiplyScalar(g);return d.add(b),d.applyMatrix4(l.matrixWorld),{normal:m,point:d,curve:l,alignment:e}}a+=u}}return null}static curvePercentageToPoint(e,t,i){const n=new D,r=new D,o=this.curveLength(t),a=i*o;let l=0;const c=t.userData.points;if(!c)throw new Error("No points found in curve");for(let h=0;h<c.length-3;h+=3){const d=n.set(c[h],c[h+1],c[h+2]),p=r.set(c[h+3],c[h+4],c[h+5]),u=d.distanceTo(p);if(l+u>=a){const g=a-l,m=p.clone().sub(d).normalize(),b=m.clone().multiplyScalar(g);return d.add(b),{normal:m,point:d,curve:t,alignment:e}}l+=u}return null}static alignmentLength(e){let t=0;if(e.userData.length!==void 0)return e.userData.length;for(const i of e.children)"isLine2"in i&&(t+=this.curveLength(i));return e.userData.length=t,t}static curveLength(e){let t=0;if(e.userData.length!==void 0)return e.userData.length;const i=new D,n=new D,r=e.userData.points;if(!r)throw new Error("No points found in curve");for(let o=0;o<r.length-2-3;o+=3){const a=i.set(r[o],r[o+1],r[o+2]),l=n.set(r[o+3],r[o+4],r[o+5]);t+=a.distanceTo(l)}return e.userData.length=t,t}static curvePointToAlignmentPercentage(e,t,i){const n=new D,r=new D,o=this.alignmentLength(e);let a=0;e.updateWorldMatrix(!0,!0);for(const l of e.children){const c=l.userData.points;if(c)for(let h=0;h<c.length-3;h+=3){const d=n.set(c[h],c[h+1],c[h+2]),p=r.set(c[h+3],c[h+4],c[h+5]);d.applyMatrix4(l.matrixWorld),p.applyMatrix4(l.matrixWorld);const u=d.distanceTo(p),g=d.distanceTo(t)<.001,m=p.distanceTo(t)<.001,b=this.isPointbetweenTwoOthers(d,p,t);if(l===i&&(g||m||b)){const f=d.distanceTo(t);return(a+f)/o}a+=u}}return null}static isPointbetweenTwoOthers(e,t,i){const n=new D;n.subVectors(t,e).normalize();const r=new D;r.subVectors(i,e).normalize();const o=new D;o.subVectors(i,t).normalize();const l=1-.0016;return n.dot(r)>l&&n.dot(o)<-l}}class gg{constructor(e,t){le(this,"onDisposed",new wo);le(this,"alignments",[]);le(this,"components");le(this,"onMarkerChange",new wo);le(this,"enabled",!0);le(this,"highlightMaterial");le(this,"increments",20);le(this,"screenDistanceLimit",.1);le(this,"fadeInTime",500);le(this,"_mouseMarkers");le(this,"_highlighted",new Set);le(this,"_stationPoints",new Map);le(this,"_originalHighlightMaterialId","originalHighlightMaterial");le(this,"_world",null);le(this,"_raycaster");le(this,"_stationLabelColor",new be(16777215));le(this,"_stationLabelBackgroundColor",new be(8014801));le(this,"_stationPointerColor",new be(16777215));le(this,"_stationPointerBackgroundColor",new be(4803766));le(this,"_pointerDown",performance.now());le(this,"_pointerDownTime",150);le(this,"onPointerDown",()=>{this._pointerDown=performance.now()});le(this,"onPointerUp",()=>{if(performance.now()-this._pointerDown>this._pointerDownTime)return;const e=this.setMarkerToMouse("select");e&&this.onMarkerChange.trigger(e)});le(this,"onMouseMove",()=>{this.setMarkerToMouse("hover")});this.components=e,this.highlightMaterial=t,this._raycaster=new mg(e),this._raycaster.alignments=this.alignments}get world(){return this._world}set world(e){var n,r,o,a;if(e===this._world||(this._world&&this.setupEvents(!1),this._world=e,(n=this._mouseMarkers)==null||n.hover.removeFromParent(),(r=this._mouseMarkers)==null||r.select.removeFromParent(),(o=this._mouseMarkers)==null||o.hover.element.remove(),(a=this._mouseMarkers)==null||a.select.element.remove(),!e))return;this._raycaster.world=e;const t=this.newCivilLabel(0,"stationPointer");e.scene.three.add(t),t.visible=!1,t.element.style.transition="";const i=this.newCivilLabel(0,"stationPointer");i.element.style.transition="",i.element.style.opacity="0.5",e.scene.three.add(i),i.visible=!1,this._mouseMarkers={select:t,hover:i},this.setupEvents(!0)}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(e){this._stationLabelColor=e;const t=`#${e.getHexString()}`;for(const[,{labels:i}]of this._stationPoints){const n=[...i.children];for(const r of n){const o=this.getLabel(r);o.style.color=t;const a=this.getPoint(r);a.style.backgroundColor=t}}}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(e){this._stationLabelBackgroundColor=e;const t=`#${e.getHexString()}`;for(const[,{labels:i}]of this._stationPoints){const n=[...i.children];for(const r of n){const o=this.getLabel(r);o.style.backgroundColor=t;const a=this.getPoint(r);a.style.border=`2px solid ${t}`}}}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(e){this._stationPointerColor=e;const t=`#${e.getHexString()}`;if(this._mouseMarkers){const i=this._mouseMarkers.select,n=this.getLabel(i);n.style.color=t;const r=this.getPoint(i);r.style.backgroundColor=t}}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(e){this._stationPointerBackgroundColor=e;const t=`#${e.getHexString()}`;if(this._mouseMarkers){const i=this._mouseMarkers.select,n=this.getLabel(i);n.style.backgroundColor=t;const r=this.getPoint(i);r.style.border=`2px solid ${t}`}}dispose(){var e,t,i,n;this.clearHighlight(),this.clearStations(),this.alignments=[],(e=this._mouseMarkers)==null||e.hover.removeFromParent(),(t=this._mouseMarkers)==null||t.select.removeFromParent(),(i=this._mouseMarkers)==null||i.hover.element.remove(),(n=this._mouseMarkers)==null||n.select.element.remove(),this._raycaster.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){this._raycaster.update()}setMarkerAtPoint(e,t){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");this.updateMarkerValue(e,t),this._mouseMarkers[t].visible=!0,this._mouseMarkers[t].position.copy(e.point)}highlight(e,t=!0){t&&this.clearHighlight(this._highlighted);for(const i of e.children)"isLineSegments2"in i&&"material"in i&&(i.userData[this._originalHighlightMaterialId]=i.material,i.material=this.highlightMaterial);this._highlighted.add(e)}clearHighlight(e=this._highlighted){for(const t of e)for(const i of t.children)"isLineSegments2"in i&&"material"in i&&(i.material=i.userData[this._originalHighlightMaterialId],delete i.userData[this._originalHighlightMaterialId]);this._highlighted.clear()}createStations(e){if(!this.world||this._stationPoints.has(e.uuid))return;const t=new Ni;this.world.scene.three.add(t),this._stationPoints.set(e.uuid,{alignment:e,labels:t})}clearStations(e=this._stationPoints.keys()){for(const t of e){const i=this._stationPoints.get(t);i&&(this.clearLabels(i.labels),this._stationPoints.delete(t))}}updateStations(){if(!this.world)throw new Error("No world found!");if(!this.world.renderer)throw new Error("No renderer found!");const e=this.world.camera.three,t=this.world.renderer.three,i=new Yl,n=t.clippingPlanes,r=new D,o=new D;let a=!0;const l=new D;for(const[,{alignment:c,labels:h}]of this._stationPoints){this.clearLabels(h),c.updateWorldMatrix(!0,!0);const d=c.userData.initialStation;let p=d||0;const u=p%this.increments;let g=d+this.increments-u;for(const m of c.children){if(!("isLine2"in m))continue;const b=m;if(b.geometry.boundingBox||b.geometry.computeBoundingBox(),i.setFromProjectionMatrix(new xe().multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse)),!i.intersectsBox(b.geometry.boundingBox)){const P=Di.curveLength(m);p+=P;const _=p%this.increments;g=p+this.increments-_;continue}const f=m.userData.points,y=f[0],v=f[1],w=f[2];if(l.set(y,v,w),l.applyMatrix4(m.matrixWorld),!this.isLabelClipped(n,l)){if(a){a=!1,r.set(l.x,l.y,l.z),r.project(e),r.z=0;const P=this.newCivilLabel(p,"stationLabel");P.position.set(l.x,l.y,l.z),h.children.push(P)}else if(o.set(l.x,l.y,l.z),o.project(e),o.z=0,r.distanceTo(o)>this.screenDistanceLimit){const _=this.newCivilLabel(p,"stationLabel");_.position.set(l.x,l.y,l.z),h.children.push(_),r.copy(o)}}const S=new D,$=new D;for(let P=0;P<f.length-3;P+=3){S.set(f[P],f[P+1],f[P+2]),$.set(f[P+3],f[P+4],f[P+5]);const _=S.distanceTo($),L=p+_,G=$.clone().sub(S).normalize();for(;L>g;){const V=g-p,K=G.clone();K.multiplyScalar(V);const{x:Y,y:ne,z:R}=S.clone().add(K);if(l.set(Y,ne,R),l.applyMatrix4(m.matrixWorld),!this.isLabelClipped(n,l)&&i.containsPoint(l)&&(o.set(l.x,l.y,l.z),o.project(e),o.z=0,r.distanceTo(o)>this.screenDistanceLimit)){const ie=this.newCivilLabel(g,"stationLabel");ie.position.set(l.x,l.y,l.z),h.children.push(ie),r.copy(o)}g+=this.increments}p+=_}const M=f[f.length-3],k=f[f.length-2],z=f[f.length-1];if(l.set(M,k,z),l.applyMatrix4(m.matrixWorld),this.isLabelClipped(n,l)||!i.containsPoint(l))continue;if(o.set(l.x,l.y,l.z),o.project(e),o.z=0,r.distanceTo(o)>this.screenDistanceLimit){const P=this.newCivilLabel(p,"stationLabel");P.position.set(l.x,l.y,l.z),h.children.push(P),r.copy(o)}}}}getCursorValue(){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");return this._mouseMarkers.select.element.children[0].children[0].innerText}setCursorValue(e,t){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const n=this._mouseMarkers[t].element.children[0].children[0];n.innerText=e}isLabelClipped(e,t){for(const i of e)if(!(i.distanceToPoint(t)>0))return!0;return!1}clearLabels(e){const t=[...e.children];for(const i of t)i.element.style.opacity="0";setTimeout(()=>{for(const i of t)i.removeFromParent(),i.element.remove(),i.visible=!1},this.fadeInTime)}newCivilLabel(e,t){const i=document.createElement("div"),n=t==="stationLabel"?this.stationLabelColor:this.stationPointerColor,r=t==="stationLabel"?this.stationLabelBackgroundColor:this.stationPointerBackgroundColor,o=document.createElement("div");o.style.width="4px",o.style.height="4px",o.style.borderRadius="50%",o.style.backgroundColor=`#${n.getHexString()}`,o.style.border=`2px solid #${r.getHexString()}`,o.style.display="flex",o.style.justifyContent="center";const a=this.getFormattedStation(e),l=document.createElement("div");l.innerText=a,l.style.backgroundColor=`#${r.getHexString()}`,l.style.color=`#${n.getHexString()}`,l.style.padding="0.3rem",l.style.position="absolute",l.style.bottom="1rem",l.style.borderRadius="6px",l.style.boxShadow="rgba(0, 0, 0, 0.6) 0px 4px 6px",o.appendChild(l);const c=new og(i);return i.appendChild(o),t==="stationLabel"&&(i.style.transition=`opacity ${this.fadeInTime}ms ease-in-out`,i.style.opacity="0",setTimeout(()=>{i.style.opacity="1"})),c}setupEvents(e){if(!this.world)throw new Error("No world found!");if(this.world.isDisposing||!this.world.renderer)return;const t=this.world.renderer.three.domElement,n=this.components.get(Ql).get(this.world);n.three.params.Line||(n.three.params.Line={threshold:10}),t.removeEventListener("pointerdown",this.onPointerDown),t.removeEventListener("pointerup",this.onPointerUp),t.removeEventListener("pointermove",this.onMouseMove),e&&(t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointerup",this.onPointerUp),t.addEventListener("pointermove",this.onMouseMove))}setMarkerToMouse(e){if(!this.enabled||!this._mouseMarkers)return null;if(!this.world)throw new Error("No world found!");const t=this._raycaster.castRay();if(!t)return this._mouseMarkers[e].visible=!1,null;this._mouseMarkers[e].visible=!0;const i=t.point;return this._mouseMarkers[e].position.copy(i),this.updateMarkerValue(t,e),t}updateMarkerValue(e,t){if(!this._mouseMarkers)return;const{alignment:i,curve:n,point:r}=e,o=Di.curvePointToAlignmentPercentage(i,r,n);if(o===null)throw new Error("Point is not on the curve");const l=o*Di.alignmentLength(i)+i.userData.initialStation,c=this.getFormattedStation(l);this.setCursorValue(c,t)}getFormattedStation(e){const t=Math.floor(e/1e3),i=Math.round(e-t*1e3);return`${t}+${i}`}getLabel(e){return e.element.children[0].children[0]}getPoint(e){return e.element.children[0]}}const Fo=class Fo extends iu{constructor(t){super(t);le(this,"onDisposed",new wo);le(this,"list",new Map);le(this,"enabled",!0);le(this,"highlightMaterial",new ru({color:8014801,linewidth:5,depthTest:!1}));le(this,"_increments",20);le(this,"_screenDistanceLimit",.1);le(this,"_fadeInTime",500);le(this,"_stationLabelColor",new be(16777215));le(this,"_stationLabelBackgroundColor",new be(8014801));le(this,"_stationPointerColor",new be(16777215));le(this,"_stationPointerBackgroundColor",new be(4803766));this.components.add(Fo.uuid,this)}get increments(){return this._increments}set increments(t){this._increments=t;for(const[,i]of this.list)i.increments=t}get screenDistanceLimit(){return this._screenDistanceLimit}set screenDistanceLimit(t){this._screenDistanceLimit=t;for(const[,i]of this.list)i.screenDistanceLimit=t}get fadeInTime(){return this._fadeInTime}set fadeInTime(t){this._fadeInTime=t;for(const[,i]of this.list)i.fadeInTime=t}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(t){this._stationLabelColor=t;for(const[,i]of this.list)i.stationLabelColor=t}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(t){this._stationLabelBackgroundColor=t;for(const[,i]of this.list)i.stationLabelBackgroundColor=t}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(t){this._stationPointerColor=t;for(const[,i]of this.list)i.stationPointerColor=t}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(t){this._stationPointerBackgroundColor=t;for(const[,i]of this.list)i.stationPointerBackgroundColor=t}create(t){const i=new gg(this.components,this.highlightMaterial);return this.list.set(t,i),i}delete(t){const i=this.list.get(t);i&&(i.dispose(),this.list.delete(t))}dispose(){for(const[,t]of this.list)t.dispose();this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){for(const[,t]of this.list)t.updateAlignments()}};le(Fo,"uuid","0a59c09e-2b49-474a-9320-99f51f40f182");let tl=Fo;const jo=class jo extends iu{constructor(t){super(t);le(this,"enabled",!0);le(this,"onDisposed",new wo);le(this,"_world",null);le(this,"_flip",!1);le(this,"_plane");le(this,"_point",new D);le(this,"_edgeMeshes",[]);le(this,"_sectionVisible",!1);le(this,"_sectionOffset",.1);le(this,"edgeMaterial",new ru({color:0,linewidth:5,depthTest:!1}));this.components.add(jo.uuid,this)}get plane(){if(!this._plane)throw new Error("Plane is not set. You must give a world.");return this._plane}set plane(t){this._plane=t}get sectionVisible(){return this._sectionVisible}set sectionVisible(t){this._sectionVisible=t;for(const i of this._edgeMeshes)i.visible=t}get world(){return this._world}set world(t){var r;if(this._world=t,(r=this._plane)==null||r.dispose(),!t)return;const i=this.components.get(ag),n=i.createFromNormalAndCoplanarPoint(t,new D(1,0,0),new D);this.plane=i.list.get(n),this.plane.visible=!1,this.plane.enabled=!1}get flip(){return this._flip}set flip(t){var n;if(t===this._flip)return;this._flip=t;const i=(n=this.plane)==null?void 0:n.normal.clone().multiplyScalar(-1);for(const r of this._edgeMeshes)r.position.add(i.clone().multiplyScalar(this._sectionOffset));this.plane.setFromNormalAndCoplanarPoint(i,this._point),this.plane.update()}dispose(){var t;this.clearMeshes(),(t=this.plane)==null||t.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}async set(t,i){this.flip&&i.multiplyScalar(-1),this.plane.setFromNormalAndCoplanarPoint(i,t),this._point.copy(t)}async update(){this.clearMeshes();const t=this.components.get(Yt);this.plane.update();const i=[];for(const[,n]of t.list)i.push(this.generateModelSection(n));await Promise.all(i)}async generateModelSection(t){if(!this.world)return;const i=this.plane.three.clone();i.constant-=.01;const{buffer:n}=await t.getSection(i),r=new nt,o=new Et(n,3,!1);r.setAttribute("position",o);const a=new Ho(r),l=new pg;l.fromLineSegments(a);const c=new fg(l,this.edgeMaterial);c.frustumCulled=!1,this.world.scene.three.add(c),this._edgeMeshes.push(c),c.renderOrder=3,a.geometry.dispose()}clearMeshes(){for(const t of this._edgeMeshes)t.removeFromParent(),t.geometry.dispose(),t.material=void 0;this._edgeMeshes=[]}};le(jo,"uuid","96b2c87e-d90b-4639-8257-8f01136fe324");let il=jo;var bg=Object.defineProperty,yg=(s,e,t)=>e in s?bg(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,T=(s,e,t)=>(yg(s,typeof e!="symbol"?e+"":e,t),t),vg=Object.defineProperty,_g=(s,e,t)=>e in s?vg(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,C=(s,e,t)=>(_g(s,typeof e!="symbol"?e+"":e,t),t);let J=class{constructor(){C(this,"enabled",!0),C(this,"trigger",s=>{if(!this.enabled)return;const e=this.handlers.slice(0);for(const t of e)t(s)}),C(this,"handlers",[])}add(s){this.handlers.push(s)}remove(s){this.handlers=this.handlers.filter(e=>e!==s)}reset(){this.handlers.length=0}},Jl=class{constructor(e){C(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),C(this,"isResizeable",()=>"resize"in this&&"getSize"in this),C(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),C(this,"isHideable",()=>"visible"in this),C(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),C(this,"isSerializable",()=>"import"in this&&"export"in this),this.components=e}},Ae=class extends Jl{},ou=class extends Jl{constructor(e){super(e),C(this,"worlds",new Se),C(this,"onWorldChanged",new J),C(this,"_currentWorld",null),this.onWorldChanged.add(({world:t,action:i})=>{i==="removed"&&this.worlds.delete(t.uuid)})}set currentWorld(e){this._currentWorld=e}get currentWorld(){return this._currentWorld}},wg=class extends ou{constructor(){super(...arguments),C(this,"hasCameraControls",()=>"controls"in this)}},xg=class extends ou{constructor(){super(...arguments),C(this,"onAfterUpdate",new J),C(this,"onBeforeUpdate",new J),C(this,"onDisposed",new J),C(this,"onResize",new J),C(this,"onClippingPlanesUpdated",new J),C(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(e,t,i){t.isLocal=i;const n=this.clippingPlanes.indexOf(t);e&&n===-1?this.clippingPlanes.push(t):!e&&n>-1&&this.clippingPlanes.splice(n,1),this.three.clippingPlanes=this.clippingPlanes.filter(r=>!r.isLocal)}};const au=class sl extends Ae{constructor(e){super(e),C(this,"_disposedComponents",new Set),C(this,"enabled",!0),e.add(sl.uuid,this)}get(){return this._disposedComponents}destroy(e,t=!0,i=!0){e.removeFromParent();const n=e;n.dispose&&n.dispose(),this.disposeGeometryAndMaterials(e,t),i&&n.children&&n.children.length&&this.disposeChildren(n),e.children.length=0}disposeGeometry(e){e.boundsTree&&e.disposeBoundsTree&&e.disposeBoundsTree(),e.dispose()}disposeGeometryAndMaterials(e,t){const i=e;i.geometry&&this.disposeGeometry(i.geometry),t&&i.material&&sl.disposeMaterial(i),i.material=[],i.geometry=null}disposeChildren(e){for(const t of e.children)this.destroy(t)}static disposeMaterial(e){if(e.material)if(Array.isArray(e.material))for(const t of e.material)t.dispose();else e.material.dispose()}};C(au,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let oi=au;const ec=class Ze{static create(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return`${Ze._lut[e&255]+Ze._lut[e>>8&255]+Ze._lut[e>>16&255]+Ze._lut[e>>24&255]}-${Ze._lut[t&255]}${Ze._lut[t>>8&255]}-${Ze._lut[t>>16&15|64]}${Ze._lut[t>>24&255]}-${Ze._lut[i&63|128]}${Ze._lut[i>>8&255]}-${Ze._lut[i>>16&255]}${Ze._lut[i>>24&255]}${Ze._lut[n&255]}${Ze._lut[n>>8&255]}${Ze._lut[n>>16&255]}${Ze._lut[n>>24&255]}`.toLowerCase()}static validate(e){if(!Ze._pattern.test(e))throw new Error(`${e} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};C(ec,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/);C(ec,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let st=ec;var Mr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Cg(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var lu={},Zo={};(function(s){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",t=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",i="["+e+"]["+t+"]*",n=new RegExp("^"+i+"$"),r=function(a,l){const c=[];let h=l.exec(a);for(;h;){const d=[];d.startIndex=l.lastIndex-h[0].length;const p=h.length;for(let u=0;u<p;u++)d.push(h[u]);c.push(d),h=l.exec(a)}return c},o=function(a){const l=n.exec(a);return!(l===null||typeof l>"u")};s.isExist=function(a){return typeof a<"u"},s.isEmptyObject=function(a){return Object.keys(a).length===0},s.merge=function(a,l,c){if(l){const h=Object.keys(l),d=h.length;for(let p=0;p<d;p++)c==="strict"?a[h[p]]=[l[h[p]]]:a[h[p]]=l[h[p]]}},s.getValue=function(a){return s.isExist(a)?a:""},s.isName=o,s.getAllMatches=r,s.nameRegexp=i})(Zo);const tc=Zo,Eg={allowBooleanAttributes:!1,unpairedTags:[]};lu.validate=function(s,e){e=Object.assign({},Eg,e);const t=[];let i=!1,n=!1;s[0]==="\uFEFF"&&(s=s.substr(1));for(let r=0;r<s.length;r++)if(s[r]==="<"&&s[r+1]==="?"){if(r+=2,r=jc(s,r),r.err)return r}else if(s[r]==="<"){let o=r;if(r++,s[r]==="!"){r=Hc(s,r);continue}else{let a=!1;s[r]==="/"&&(a=!0,r++);let l="";for(;r<s.length&&s[r]!==">"&&s[r]!==" "&&s[r]!=="	"&&s[r]!==`
`&&s[r]!=="\r";r++)l+=s[r];if(l=l.trim(),l[l.length-1]==="/"&&(l=l.substring(0,l.length-1),r--),!Mg(l)){let d;return l.trim().length===0?d="Invalid space after '<'.":d="Tag '"+l+"' is an invalid name.",Fe("InvalidTag",d,dt(s,r))}const c=$g(s,r);if(c===!1)return Fe("InvalidAttr","Attributes for '"+l+"' have open quote.",dt(s,r));let h=c.value;if(r=c.index,h[h.length-1]==="/"){const d=r-h.length;h=h.substring(0,h.length-1);const p=Vc(h,e);if(p===!0)i=!0;else return Fe(p.err.code,p.err.msg,dt(s,d+p.err.line))}else if(a)if(c.tagClosed){if(h.trim().length>0)return Fe("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",dt(s,o));if(t.length===0)return Fe("InvalidTag","Closing tag '"+l+"' has not been opened.",dt(s,o));{const d=t.pop();if(l!==d.tagName){let p=dt(s,d.tagStartPos);return Fe("InvalidTag","Expected closing tag '"+d.tagName+"' (opened in line "+p.line+", col "+p.col+") instead of closing tag '"+l+"'.",dt(s,o))}t.length==0&&(n=!0)}}else return Fe("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",dt(s,r));else{const d=Vc(h,e);if(d!==!0)return Fe(d.err.code,d.err.msg,dt(s,r-h.length+d.err.line));if(n===!0)return Fe("InvalidXml","Multiple possible root nodes found.",dt(s,r));e.unpairedTags.indexOf(l)!==-1||t.push({tagName:l,tagStartPos:o}),i=!0}for(r++;r<s.length;r++)if(s[r]==="<")if(s[r+1]==="!"){r++,r=Hc(s,r);continue}else if(s[r+1]==="?"){if(r=jc(s,++r),r.err)return r}else break;else if(s[r]==="&"){const d=Pg(s,r);if(d==-1)return Fe("InvalidChar","char '&' is not expected.",dt(s,r));r=d}else if(n===!0&&!Fc(s[r]))return Fe("InvalidXml","Extra text at the end",dt(s,r));s[r]==="<"&&r--}}else{if(Fc(s[r]))continue;return Fe("InvalidChar","char '"+s[r]+"' is not expected.",dt(s,r))}if(i){if(t.length==1)return Fe("InvalidTag","Unclosed tag '"+t[0].tagName+"'.",dt(s,t[0].tagStartPos));if(t.length>0)return Fe("InvalidXml","Invalid '"+JSON.stringify(t.map(r=>r.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Fe("InvalidXml","Start tag expected.",1);return!0};function Fc(s){return s===" "||s==="	"||s===`
`||s==="\r"}function jc(s,e){const t=e;for(;e<s.length;e++)if(s[e]=="?"||s[e]==" "){const i=s.substr(t,e-t);if(e>5&&i==="xml")return Fe("InvalidXml","XML declaration allowed only at the start of the document.",dt(s,e));if(s[e]=="?"&&s[e+1]==">"){e++;break}else continue}return e}function Hc(s,e){if(s.length>e+5&&s[e+1]==="-"&&s[e+2]==="-"){for(e+=3;e<s.length;e++)if(s[e]==="-"&&s[e+1]==="-"&&s[e+2]===">"){e+=2;break}}else if(s.length>e+8&&s[e+1]==="D"&&s[e+2]==="O"&&s[e+3]==="C"&&s[e+4]==="T"&&s[e+5]==="Y"&&s[e+6]==="P"&&s[e+7]==="E"){let t=1;for(e+=8;e<s.length;e++)if(s[e]==="<")t++;else if(s[e]===">"&&(t--,t===0))break}else if(s.length>e+9&&s[e+1]==="["&&s[e+2]==="C"&&s[e+3]==="D"&&s[e+4]==="A"&&s[e+5]==="T"&&s[e+6]==="A"&&s[e+7]==="["){for(e+=8;e<s.length;e++)if(s[e]==="]"&&s[e+1]==="]"&&s[e+2]===">"){e+=2;break}}return e}const Sg='"',Ag="'";function $g(s,e){let t="",i="",n=!1;for(;e<s.length;e++){if(s[e]===Sg||s[e]===Ag)i===""?i=s[e]:i!==s[e]||(i="");else if(s[e]===">"&&i===""){n=!0;break}t+=s[e]}return i!==""?!1:{value:t,index:e,tagClosed:n}}const Tg=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function Vc(s,e){const t=tc.getAllMatches(s,Tg),i={};for(let n=0;n<t.length;n++){if(t[n][1].length===0)return Fe("InvalidAttr","Attribute '"+t[n][2]+"' has no space in starting.",xn(t[n]));if(t[n][3]!==void 0&&t[n][4]===void 0)return Fe("InvalidAttr","Attribute '"+t[n][2]+"' is without value.",xn(t[n]));if(t[n][3]===void 0&&!e.allowBooleanAttributes)return Fe("InvalidAttr","boolean attribute '"+t[n][2]+"' is not allowed.",xn(t[n]));const r=t[n][2];if(!Og(r))return Fe("InvalidAttr","Attribute '"+r+"' is an invalid name.",xn(t[n]));if(!i.hasOwnProperty(r))i[r]=1;else return Fe("InvalidAttr","Attribute '"+r+"' is repeated.",xn(t[n]))}return!0}function kg(s,e){let t=/\d/;for(s[e]==="x"&&(e++,t=/[\da-fA-F]/);e<s.length;e++){if(s[e]===";")return e;if(!s[e].match(t))break}return-1}function Pg(s,e){if(e++,s[e]===";")return-1;if(s[e]==="#")return e++,kg(s,e);let t=0;for(;e<s.length;e++,t++)if(!(s[e].match(/\w/)&&t<20)){if(s[e]===";")break;return-1}return e}function Fe(s,e,t){return{err:{code:s,msg:e,line:t.line||t,col:t.col}}}function Og(s){return tc.isName(s)}function Mg(s){return tc.isName(s)}function dt(s,e){const t=s.substring(0,e).split(/\r?\n/);return{line:t.length,col:t[t.length-1].length+1}}function xn(s){return s.startIndex+s[1].length}var ic={};const cu={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(s,e){return e},attributeValueProcessor:function(s,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(s,e,t){return s}},Ig=function(s){return Object.assign({},cu,s)};ic.buildOptions=Ig;ic.defaultOptions=cu;let zg=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}};var Dg=zg;const Lg=Zo;function Bg(s,e){const t={};if(s[e+3]==="O"&&s[e+4]==="C"&&s[e+5]==="T"&&s[e+6]==="Y"&&s[e+7]==="P"&&s[e+8]==="E"){e=e+9;let i=1,n=!1,r=!1,o="";for(;e<s.length;e++)if(s[e]==="<"&&!r){if(n&&Ug(s,e))e+=7,[entityName,val,e]=Ng(s,e+1),val.indexOf("&")===-1&&(t[Vg(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(n&&Fg(s,e))e+=8;else if(n&&jg(s,e))e+=8;else if(n&&Hg(s,e))e+=9;else if(Rg)r=!0;else throw new Error("Invalid DOCTYPE");i++,o=""}else if(s[e]===">"){if(r?s[e-1]==="-"&&s[e-2]==="-"&&(r=!1,i--):i--,i===0)break}else s[e]==="["?n=!0:o+=s[e];if(i!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:t,i:e}}function Ng(s,e){let t="";for(;e<s.length&&s[e]!=="'"&&s[e]!=='"';e++)t+=s[e];if(t=t.trim(),t.indexOf(" ")!==-1)throw new Error("External entites are not supported");const i=s[e++];let n="";for(;e<s.length&&s[e]!==i;e++)n+=s[e];return[t,n,e]}function Rg(s,e){return s[e+1]==="!"&&s[e+2]==="-"&&s[e+3]==="-"}function Ug(s,e){return s[e+1]==="!"&&s[e+2]==="E"&&s[e+3]==="N"&&s[e+4]==="T"&&s[e+5]==="I"&&s[e+6]==="T"&&s[e+7]==="Y"}function Fg(s,e){return s[e+1]==="!"&&s[e+2]==="E"&&s[e+3]==="L"&&s[e+4]==="E"&&s[e+5]==="M"&&s[e+6]==="E"&&s[e+7]==="N"&&s[e+8]==="T"}function jg(s,e){return s[e+1]==="!"&&s[e+2]==="A"&&s[e+3]==="T"&&s[e+4]==="T"&&s[e+5]==="L"&&s[e+6]==="I"&&s[e+7]==="S"&&s[e+8]==="T"}function Hg(s,e){return s[e+1]==="!"&&s[e+2]==="N"&&s[e+3]==="O"&&s[e+4]==="T"&&s[e+5]==="A"&&s[e+6]==="T"&&s[e+7]==="I"&&s[e+8]==="O"&&s[e+9]==="N"}function Vg(s){if(Lg.isName(s))return s;throw new Error(`Invalid entity name ${s}`)}var qg=Bg;const Wg=/^[-+]?0x[a-fA-F0-9]+$/,Yg=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,Zg={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function Gg(s,e={}){if(e=Object.assign({},Zg,e),!s||typeof s!="string")return s;let t=s.trim();if(e.skipLike!==void 0&&e.skipLike.test(t))return s;if(s==="0")return 0;if(e.hex&&Wg.test(t))return Qg(t,16);if(t.search(/[eE]/)!==-1){const i=t.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(i){if(e.leadingZeros)t=(i[1]||"")+i[3];else if(!(i[2]==="0"&&i[3][0]==="."))return s;return e.eNotation?Number(t):s}else return s}else{const i=Yg.exec(t);if(i){const n=i[1],r=i[2];let o=Xg(i[3]);if(!e.leadingZeros&&r.length>0&&n&&t[2]!=="."||!e.leadingZeros&&r.length>0&&!n&&t[1]!==".")return s;if(e.leadingZeros&&r===s)return 0;{const a=Number(t),l=""+a;return l.search(/[eE]/)!==-1?e.eNotation?a:s:t.indexOf(".")!==-1?l==="0"&&o===""||l===o||n&&l==="-"+o?a:s:r?o===l||n+o===l?a:s:t===l||t===n+l?a:s}}else return s}}function Xg(s){return s&&s.indexOf(".")!==-1&&(s=s.replace(/0+$/,""),s==="."?s="0":s[0]==="."?s="0"+s:s[s.length-1]==="."&&(s=s.substr(0,s.length-1))),s}function Qg(s,e){if(parseInt)return parseInt(s,e);if(Number.parseInt)return Number.parseInt(s,e);if(window&&window.parseInt)return window.parseInt(s,e);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}var Kg=Gg;const hu=Zo,Cn=Dg,Jg=qg,eb=Kg;let tb=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(t,i)=>String.fromCharCode(Number.parseInt(i,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(t,i)=>String.fromCharCode(Number.parseInt(i,16))}},this.addExternalEntities=ib,this.parseXml=ab,this.parseTextData=sb,this.resolveNameSpace=nb,this.buildAttributesMap=ob,this.isItStopNode=db,this.replaceEntitiesValue=cb,this.readStopNodeData=pb,this.saveTextToParentTag=hb,this.addChild=lb}};function ib(s){const e=Object.keys(s);for(let t=0;t<e.length;t++){const i=e[t];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:s[i]}}}function sb(s,e,t,i,n,r,o){if(s!==void 0&&(this.options.trimValues&&!i&&(s=s.trim()),s.length>0)){o||(s=this.replaceEntitiesValue(s));const a=this.options.tagValueProcessor(e,s,t,n,r);return a==null?s:typeof a!=typeof s||a!==s?a:this.options.trimValues?rl(s,this.options.parseTagValue,this.options.numberParseOptions):s.trim()===s?rl(s,this.options.parseTagValue,this.options.numberParseOptions):s}}function nb(s){if(this.options.removeNSPrefix){const e=s.split(":"),t=s.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(s=t+e[1])}return s}const rb=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function ob(s,e,t){if(!this.options.ignoreAttributes&&typeof s=="string"){const i=hu.getAllMatches(s,rb),n=i.length,r={};for(let o=0;o<n;o++){const a=this.resolveNameSpace(i[o][1]);let l=i[o][4],c=this.options.attributeNamePrefix+a;if(a.length)if(this.options.transformAttributeName&&(c=this.options.transformAttributeName(c)),c==="__proto__"&&(c="#__proto__"),l!==void 0){this.options.trimValues&&(l=l.trim()),l=this.replaceEntitiesValue(l);const h=this.options.attributeValueProcessor(a,l,e);h==null?r[c]=l:typeof h!=typeof l||h!==l?r[c]=h:r[c]=rl(l,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(r[c]=!0)}if(!Object.keys(r).length)return;if(this.options.attributesGroupName){const o={};return o[this.options.attributesGroupName]=r,o}return r}}const ab=function(s){s=s.replace(/\r\n?/g,`
`);const e=new Cn("!xml");let t=e,i="",n="";for(let r=0;r<s.length;r++)if(s[r]==="<")if(s[r+1]==="/"){const o=os(s,">",r,"Closing Tag is not closed.");let a=s.substring(r+2,o).trim();if(this.options.removeNSPrefix){const h=a.indexOf(":");h!==-1&&(a=a.substr(h+1))}this.options.transformTagName&&(a=this.options.transformTagName(a)),t&&(i=this.saveTextToParentTag(i,t,n));const l=n.substring(n.lastIndexOf(".")+1);if(a&&this.options.unpairedTags.indexOf(a)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${a}>`);let c=0;l&&this.options.unpairedTags.indexOf(l)!==-1?(c=n.lastIndexOf(".",n.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=n.lastIndexOf("."),n=n.substring(0,c),t=this.tagsNodeStack.pop(),i="",r=o}else if(s[r+1]==="?"){let o=nl(s,r,!1,"?>");if(!o)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,t,n),!(this.options.ignoreDeclaration&&o.tagName==="?xml"||this.options.ignorePiTags)){const a=new Cn(o.tagName);a.add(this.options.textNodeName,""),o.tagName!==o.tagExp&&o.attrExpPresent&&(a[":@"]=this.buildAttributesMap(o.tagExp,n,o.tagName)),this.addChild(t,a,n)}r=o.closeIndex+1}else if(s.substr(r+1,3)==="!--"){const o=os(s,"-->",r+4,"Comment is not closed.");if(this.options.commentPropName){const a=s.substring(r+4,o-2);i=this.saveTextToParentTag(i,t,n),t.add(this.options.commentPropName,[{[this.options.textNodeName]:a}])}r=o}else if(s.substr(r+1,2)==="!D"){const o=Jg(s,r);this.docTypeEntities=o.entities,r=o.i}else if(s.substr(r+1,2)==="!["){const o=os(s,"]]>",r,"CDATA is not closed.")-2,a=s.substring(r+9,o);i=this.saveTextToParentTag(i,t,n);let l=this.parseTextData(a,t.tagname,n,!0,!1,!0,!0);l==null&&(l=""),this.options.cdataPropName?t.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]):t.add(this.options.textNodeName,l),r=o+2}else{let o=nl(s,r,this.options.removeNSPrefix),a=o.tagName;const l=o.rawTagName;let c=o.tagExp,h=o.attrExpPresent,d=o.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),t&&i&&t.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,t,n,!1));const p=t;if(p&&this.options.unpairedTags.indexOf(p.tagname)!==-1&&(t=this.tagsNodeStack.pop(),n=n.substring(0,n.lastIndexOf("."))),a!==e.tagname&&(n+=n?"."+a:a),this.isItStopNode(this.options.stopNodes,n,a)){let u="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)a[a.length-1]==="/"?(a=a.substr(0,a.length-1),n=n.substr(0,n.length-1),c=a):c=c.substr(0,c.length-1),r=o.closeIndex;else if(this.options.unpairedTags.indexOf(a)!==-1)r=o.closeIndex;else{const m=this.readStopNodeData(s,l,d+1);if(!m)throw new Error(`Unexpected end of ${l}`);r=m.i,u=m.tagContent}const g=new Cn(a);a!==c&&h&&(g[":@"]=this.buildAttributesMap(c,n,a)),u&&(u=this.parseTextData(u,a,n,!0,h,!0,!0)),n=n.substr(0,n.lastIndexOf(".")),g.add(this.options.textNodeName,u),this.addChild(t,g,n)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){a[a.length-1]==="/"?(a=a.substr(0,a.length-1),n=n.substr(0,n.length-1),c=a):c=c.substr(0,c.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));const u=new Cn(a);a!==c&&h&&(u[":@"]=this.buildAttributesMap(c,n,a)),this.addChild(t,u,n),n=n.substr(0,n.lastIndexOf("."))}else{const u=new Cn(a);this.tagsNodeStack.push(t),a!==c&&h&&(u[":@"]=this.buildAttributesMap(c,n,a)),this.addChild(t,u,n),t=u}i="",r=d}}else i+=s[r];return e.child};function lb(s,e,t){const i=this.options.updateTag(e.tagname,t,e[":@"]);i===!1||(typeof i=="string"&&(e.tagname=i),s.addChild(e))}const cb=function(s){if(this.options.processEntities){for(let e in this.docTypeEntities){const t=this.docTypeEntities[e];s=s.replace(t.regx,t.val)}for(let e in this.lastEntities){const t=this.lastEntities[e];s=s.replace(t.regex,t.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const t=this.htmlEntities[e];s=s.replace(t.regex,t.val)}s=s.replace(this.ampEntity.regex,this.ampEntity.val)}return s};function hb(s,e,t,i){return s&&(i===void 0&&(i=Object.keys(e.child).length===0),s=this.parseTextData(s,e.tagname,t,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,i),s!==void 0&&s!==""&&e.add(this.options.textNodeName,s),s=""),s}function db(s,e,t){const i="*."+t;for(const n in s){const r=s[n];if(i===r||e===r)return!0}return!1}function ub(s,e,t=">"){let i,n="";for(let r=e;r<s.length;r++){let o=s[r];if(i)o===i&&(i="");else if(o==='"'||o==="'")i=o;else if(o===t[0])if(t[1]){if(s[r+1]===t[1])return{data:n,index:r}}else return{data:n,index:r};else o==="	"&&(o=" ");n+=o}}function os(s,e,t,i){const n=s.indexOf(e,t);if(n===-1)throw new Error(i);return n+e.length-1}function nl(s,e,t,i=">"){const n=ub(s,e+1,i);if(!n)return;let r=n.data;const o=n.index,a=r.search(/\s/);let l=r,c=!0;a!==-1&&(l=r.substring(0,a),r=r.substring(a+1).trimStart());const h=l;if(t){const d=l.indexOf(":");d!==-1&&(l=l.substr(d+1),c=l!==n.data.substr(d+1))}return{tagName:l,tagExp:r,closeIndex:o,attrExpPresent:c,rawTagName:h}}function pb(s,e,t){const i=t;let n=1;for(;t<s.length;t++)if(s[t]==="<")if(s[t+1]==="/"){const r=os(s,">",t,`${e} is not closed`);if(s.substring(t+2,r).trim()===e&&(n--,n===0))return{tagContent:s.substring(i,t),i:r};t=r}else if(s[t+1]==="?")t=os(s,"?>",t+1,"StopNode is not closed.");else if(s.substr(t+1,3)==="!--")t=os(s,"-->",t+3,"StopNode is not closed.");else if(s.substr(t+1,2)==="![")t=os(s,"]]>",t,"StopNode is not closed.")-2;else{const r=nl(s,t,">");r&&((r&&r.tagName)===e&&r.tagExp[r.tagExp.length-1]!=="/"&&n++,t=r.closeIndex)}}function rl(s,e,t){if(e&&typeof s=="string"){const i=s.trim();return i==="true"?!0:i==="false"?!1:eb(s,t)}else return hu.isExist(s)?s:""}var fb=tb,du={};function mb(s,e){return uu(s,e)}function uu(s,e,t){let i;const n={};for(let r=0;r<s.length;r++){const o=s[r],a=gb(o);let l="";if(t===void 0?l=a:l=t+"."+a,a===e.textNodeName)i===void 0?i=o[a]:i+=""+o[a];else{if(a===void 0)continue;if(o[a]){let c=uu(o[a],e,l);const h=yb(c,e);o[":@"]?bb(c,o[":@"],l,e):Object.keys(c).length===1&&c[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?c=c[e.textNodeName]:Object.keys(c).length===0&&(e.alwaysCreateTextNode?c[e.textNodeName]="":c=""),n[a]!==void 0&&n.hasOwnProperty(a)?(Array.isArray(n[a])||(n[a]=[n[a]]),n[a].push(c)):e.isArray(a,l,h)?n[a]=[c]:n[a]=c}}}return typeof i=="string"?i.length>0&&(n[e.textNodeName]=i):i!==void 0&&(n[e.textNodeName]=i),n}function gb(s){const e=Object.keys(s);for(let t=0;t<e.length;t++){const i=e[t];if(i!==":@")return i}}function bb(s,e,t,i){if(e){const n=Object.keys(e),r=n.length;for(let o=0;o<r;o++){const a=n[o];i.isArray(a,t+"."+a,!0,!0)?s[a]=[e[a]]:s[a]=e[a]}}}function yb(s,e){const{textNodeName:t}=e,i=Object.keys(s).length;return!!(i===0||i===1&&(s[t]||typeof s[t]=="boolean"||s[t]===0))}du.prettify=mb;const{buildOptions:vb}=ic,_b=fb,{prettify:wb}=du,xb=lu;let Cb=class{constructor(e){this.externalEntities={},this.options=vb(e)}parse(e,t){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(t){t===!0&&(t={});const r=xb.validate(e,t);if(r!==!0)throw Error(`${r.err.msg}:${r.err.line}:${r.err.col}`)}const i=new _b(this.options);i.addExternalEntities(this.externalEntities);const n=i.parseXml(e);return this.options.preserveOrder||n===void 0?n:wb(n,this.options)}addEntity(e,t){if(t.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(t==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}};var Eb=Cb;const Sb=`
`;function Ab(s,e){let t="";return e.format&&e.indentBy.length>0&&(t=Sb),pu(s,e,"",t)}function pu(s,e,t,i){let n="",r=!1;for(let o=0;o<s.length;o++){const a=s[o],l=$b(a);if(l===void 0)continue;let c="";if(t.length===0?c=l:c=`${t}.${l}`,l===e.textNodeName){let g=a[l];Tb(c,e)||(g=e.tagValueProcessor(l,g),g=fu(g,e)),r&&(n+=i),n+=g,r=!1;continue}else if(l===e.cdataPropName){r&&(n+=i),n+=`<![CDATA[${a[l][0][e.textNodeName]}]]>`,r=!1;continue}else if(l===e.commentPropName){n+=i+`<!--${a[l][0][e.textNodeName]}-->`,r=!0;continue}else if(l[0]==="?"){const g=qc(a[":@"],e),m=l==="?xml"?"":i;let b=a[l][0][e.textNodeName];b=b.length!==0?" "+b:"",n+=m+`<${l}${b}${g}?>`,r=!0;continue}let h=i;h!==""&&(h+=e.indentBy);const d=qc(a[":@"],e),p=i+`<${l}${d}`,u=pu(a[l],e,c,h);e.unpairedTags.indexOf(l)!==-1?e.suppressUnpairedNode?n+=p+">":n+=p+"/>":(!u||u.length===0)&&e.suppressEmptyNode?n+=p+"/>":u&&u.endsWith(">")?n+=p+`>${u}${i}</${l}>`:(n+=p+">",u&&i!==""&&(u.includes("/>")||u.includes("</"))?n+=i+e.indentBy+u+i:n+=u,n+=`</${l}>`),r=!0}return n}function $b(s){const e=Object.keys(s);for(let t=0;t<e.length;t++){const i=e[t];if(s.hasOwnProperty(i)&&i!==":@")return i}}function qc(s,e){let t="";if(s&&!e.ignoreAttributes)for(let i in s){if(!s.hasOwnProperty(i))continue;let n=e.attributeValueProcessor(i,s[i]);n=fu(n,e),n===!0&&e.suppressBooleanAttributes?t+=` ${i.substr(e.attributeNamePrefix.length)}`:t+=` ${i.substr(e.attributeNamePrefix.length)}="${n}"`}return t}function Tb(s,e){s=s.substr(0,s.length-e.textNodeName.length-1);let t=s.substr(s.lastIndexOf(".")+1);for(let i in e.stopNodes)if(e.stopNodes[i]===s||e.stopNodes[i]==="*."+t)return!0;return!1}function fu(s,e){if(s&&s.length>0&&e.processEntities)for(let t=0;t<e.entities.length;t++){const i=e.entities[t];s=s.replace(i.regex,i.val)}return s}var kb=Ab;const Pb=kb,Ob={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(s,e){return e},attributeValueProcessor:function(s,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function Yi(s){this.options=Object.assign({},Ob,s),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=zb),this.processTextOrObjNode=Mb,this.options.format?(this.indentate=Ib,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}Yi.prototype.build=function(s){return this.options.preserveOrder?Pb(s,this.options):(Array.isArray(s)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(s={[this.options.arrayNodeName]:s}),this.j2x(s,0).val)};Yi.prototype.j2x=function(s,e){let t="",i="";for(let n in s)if(Object.prototype.hasOwnProperty.call(s,n))if(typeof s[n]>"u")this.isAttribute(n)&&(i+="");else if(s[n]===null)this.isAttribute(n)?i+="":n[0]==="?"?i+=this.indentate(e)+"<"+n+"?"+this.tagEndChar:i+=this.indentate(e)+"<"+n+"/"+this.tagEndChar;else if(s[n]instanceof Date)i+=this.buildTextValNode(s[n],n,"",e);else if(typeof s[n]!="object"){const r=this.isAttribute(n);if(r)t+=this.buildAttrPairStr(r,""+s[n]);else if(n===this.options.textNodeName){let o=this.options.tagValueProcessor(n,""+s[n]);i+=this.replaceEntitiesValue(o)}else i+=this.buildTextValNode(s[n],n,"",e)}else if(Array.isArray(s[n])){const r=s[n].length;let o="",a="";for(let l=0;l<r;l++){const c=s[n][l];if(!(typeof c>"u"))if(c===null)n[0]==="?"?i+=this.indentate(e)+"<"+n+"?"+this.tagEndChar:i+=this.indentate(e)+"<"+n+"/"+this.tagEndChar;else if(typeof c=="object")if(this.options.oneListGroup){const h=this.j2x(c,e+1);o+=h.val,this.options.attributesGroupName&&c.hasOwnProperty(this.options.attributesGroupName)&&(a+=h.attrStr)}else o+=this.processTextOrObjNode(c,n,e);else if(this.options.oneListGroup){let h=this.options.tagValueProcessor(n,c);h=this.replaceEntitiesValue(h),o+=h}else o+=this.buildTextValNode(c,n,"",e)}this.options.oneListGroup&&(o=this.buildObjectNode(o,n,a,e)),i+=o}else if(this.options.attributesGroupName&&n===this.options.attributesGroupName){const r=Object.keys(s[n]),o=r.length;for(let a=0;a<o;a++)t+=this.buildAttrPairStr(r[a],""+s[n][r[a]])}else i+=this.processTextOrObjNode(s[n],n,e);return{attrStr:t,val:i}};Yi.prototype.buildAttrPairStr=function(s,e){return e=this.options.attributeValueProcessor(s,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+s:" "+s+'="'+e+'"'};function Mb(s,e,t){const i=this.j2x(s,t+1);return s[this.options.textNodeName]!==void 0&&Object.keys(s).length===1?this.buildTextValNode(s[this.options.textNodeName],e,i.attrStr,t):this.buildObjectNode(i.val,e,i.attrStr,t)}Yi.prototype.buildObjectNode=function(s,e,t,i){if(s==="")return e[0]==="?"?this.indentate(i)+"<"+e+t+"?"+this.tagEndChar:this.indentate(i)+"<"+e+t+this.closeTag(e)+this.tagEndChar;{let n="</"+e+this.tagEndChar,r="";return e[0]==="?"&&(r="?",n=""),(t||t==="")&&s.indexOf("<")===-1?this.indentate(i)+"<"+e+t+r+">"+s+n:this.options.commentPropName!==!1&&e===this.options.commentPropName&&r.length===0?this.indentate(i)+`<!--${s}-->`+this.newLine:this.indentate(i)+"<"+e+t+r+this.tagEndChar+s+this.indentate(i)+n}};Yi.prototype.closeTag=function(s){let e="";return this.options.unpairedTags.indexOf(s)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e=`></${s}`,e};Yi.prototype.buildTextValNode=function(s,e,t,i){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${s}]]>`+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(i)+`<!--${s}-->`+this.newLine;if(e[0]==="?")return this.indentate(i)+"<"+e+t+"?"+this.tagEndChar;{let n=this.options.tagValueProcessor(e,s);return n=this.replaceEntitiesValue(n),n===""?this.indentate(i)+"<"+e+t+this.closeTag(e)+this.tagEndChar:this.indentate(i)+"<"+e+t+">"+n+"</"+e+this.tagEndChar}};Yi.prototype.replaceEntitiesValue=function(s){if(s&&s.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const t=this.options.entities[e];s=s.replace(t.regex,t.val)}return s};function Ib(s){return this.options.indentBy.repeat(s)}function zb(s){return s.startsWith(this.options.attributeNamePrefix)&&s!==this.options.textNodeName?s.substr(this.attrPrefixLen):!1}var Db=Yi;const Lb=Eb,Bb=Db;var Go={XMLParser:Lb,XMLBuilder:Bb};let Xo=class{};C(Xo,"parser",new Go.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));C(Xo,"builder",new Go.XMLBuilder({attributeNamePrefix:"$",ignoreAttributes:!1,suppressBooleanAttributes:!1}));let ke=class uo{static join(e){const t={};for(const i of e)for(const n in i)if(!t[n])t[n]=new Set(i[n]);else for(const r of i[n])t[n].add(r);return t}static intersect(e){if(e.length===0)return{};let t=uo.clone(e[0]);for(let i=1;i<e.length;i++){const n=e[i],r={};for(const o in t)if(n[o]){const a=new Set;for(const l of t[o])n[o].has(l)&&a.add(l);a.size>0&&(r[o]=a)}t=r}return t}static clone(e){const t={};for(const i in e)t[i]=new Set(e[i]);return t}static remove(e,t,i=!1){i&&(e=uo.clone(e));for(const n in t)if(e[n]){for(const r of t[n])e[n].delete(r);e[n].size===0&&delete e[n]}}static add(e,t,i=!1){i&&(e=uo.clone(e));for(const n in t)if(!e[n])e[n]=new Set(t[n]);else for(const r of t[n])e[n].add(r)}static append(e,t,...i){let n=e[t];n||(n=new Set,e[t]=n);for(const r of i)n.add(r)}static isEqual(e,t){const i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(const r of i){if(!t[r]||e[r].size!==t[r].size)return!1;for(const o of e[r])if(!t[r].has(o))return!1}return!0}static isEmpty(e){return Object.values(e).reduce((t,i)=>t+i.size,0)===0}static toRaw(e){const t={};for(const i in e)t[i]=Array.from(e[i]);return t}static fromRaw(e){const t={};for(const i in e)t[i]=new Set(e[i]);return t}},ya=class{static isEntry(e){return new Set(["Boolean","Color","Text","Number","Select","Vector3","TextSet","None"]).has(e.type)}static copySchema(e,t={}){for(const i in e){const n=e[i];this.isEntry(n)?t[i]=this.copyEntry(n):(t[i]={},this.copySchema(n,t[i]))}return t}static copyEntry(e){if(e.type==="Boolean"){const t=e;return{type:t.type,value:t.value}}if(e.type==="Color"){const t=e;return{type:t.type,value:t.value.clone()}}if(e.type==="Text"){const t=e;return{type:t.type,value:t.value}}if(e.type==="Number"){const t=e;return{type:t.type,value:t.value,min:t.min,max:t.max,interpolable:t.interpolable}}if(e.type==="Select"){const t=e;return{type:t.type,value:t.value,multiple:t.multiple,options:new Set(t.options)}}if(e.type==="Vector3"){const t=e;return{type:t.type,value:t.value.clone()}}if(e.type==="TextSet"){const t=e;return{type:t.type,value:new Set(t.value)}}if(e.type==="None"){const t=e;return{type:t.type,value:t.value}}throw new Error("Invalid entry!")}};class Nb{constructor(){C(this,"list",new Set)}add(e){for(const t of e)this.list.add(t)}remove(e){for(const t of e)this.list.delete(t)}set(e){for(const t of this.list)t.enabled=e}reset(){for(const e of this.list)e.reset()}}let Qo=class{constructor(e,t,i,n){C(this,"_component"),C(this,"name"),C(this,"uuid"),this._component=e,this.name=i,this.uuid=n??st.create(),t.get(sc).list.set(this.uuid,this)}get controls(){return ya.copySchema(this._config)}set(e){for(const t in e)if(t in this){const i=t;this[i]=e[t].value}}export(e=this._config,t={}){for(const i in e){const n=e[i];if(ya.isEntry(n))if(n.type==="Color"){const{r,g:o,b:a}=n.value;t[i]={...n,value:{r,g:o,b:a}}}else if(n.type==="Vector3"){const{x:r,y:o,z:a}=n.value;t[i]={...n,value:{x:r,y:o,z:a}}}else if(n.type==="TextSet"){const r=Array.from(n.value);t[i]={...n,value:r}}else if(n.type==="Select"){const r=Array.from(n.options);t[i]={...n,options:r}}else t[i]={...n};else t[i]={},this.export(n,t[i])}return t}import(e,t={},i=!0){for(const n in e){const r=e[n];if(ya.isEntry(r))if(r.type==="Color"){const{r:o,g:a,b:l}=r.value;t[n]={...r,value:new be(o,a,l)}}else if(r.type==="Vector3"){const{x:o,y:a,z:l}=r.value;t[n]={...r,value:new D(o,a,l)}}else r.type==="TextSet"?t[n]={...r,value:new Set(r.value)}:r.type==="Select"?t[n]={...r,options:new Set(r.options)}:t[n]={...r};else t[n]={},this.import(r,t[n],!1)}i&&this.set(t)}};const mu=class gu extends Ae{constructor(e){super(e),C(this,"list",new Se),C(this,"enabled",!0),e.add(gu.uuid,this)}};C(mu,"uuid","b8c764e0-6b24-4e77-9a32-35fa728ee5b4");let sc=mu,bu=class{constructor(e){C(this,"_event"),C(this,"_position",new Ne),C(this,"onDisposed",new J),C(this,"updateMouseInfo",t=>{this._event=t}),this.dom=e,this.setupEvents(!0)}get position(){return this.updatePosition(!1),this._position.clone()}get rawPosition(){return this.updatePosition(!0),this._position.clone()}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}updatePosition(e){if(this._event){const t=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(t,this._event,e),this._position.y=this.getPositionY(t,this._event,e)}}getPositionY(e,t,i){const n=this.getDataObject(t);return i?n.clientY:-((n.clientY-e.top)/(e.bottom-e.top))*2+1}getPositionX(e,t,i){const n=this.getDataObject(t);return i?n.clientX:(n.clientX-e.left)/(e.right-e.left)*2-1}getDataObject(e){return e instanceof MouseEvent?e:e.touches[0]}setupEvents(e){e?(this.dom.addEventListener("pointermove",this.updateMouseInfo),this.dom.addEventListener("touchstart",this.updateMouseInfo)):(this.dom.removeEventListener("pointermove",this.updateMouseInfo),this.dom.removeEventListener("touchstart",this.updateMouseInfo))}};const yu=class vu extends Ae{constructor(e){super(e),C(this,"onDisposed",new J),C(this,"onBeforeDispose",new J),C(this,"onFragmentsLoaded",new J),C(this,"baseCoordinationModel",""),C(this,"baseCoordinationMatrix",new xe),C(this,"enabled",!0),C(this,"_core"),this.components.add(vu.uuid,this)}get initialized(){return!!this._core}get list(){return this.core.models.list}get core(){if(!this._core)throw new Error("FragmentsManager not initialized. Call init() first.");return this._core}get _hasCoordinationModel(){return this.baseCoordinationModel!==""}dispose(){this.onBeforeDispose.trigger(),this._core&&(this.core.dispose(),this._core=void 0),this.baseCoordinationModel="",this.onFragmentsLoaded.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}init(e){this._core=new Im(e),this.core.onModelLoaded.add(async()=>{if(this._hasCoordinationModel)return;const t=[...this.list.values()][0];t&&(this.baseCoordinationModel=t.modelId,this.baseCoordinationMatrix=await t.getCoordinationMatrix())}),this.list.onItemDeleted.add(()=>{this.list.size>0||(this.baseCoordinationModel="",this.baseCoordinationMatrix=new xe)})}async raycast(e){const t=[];for(const r of this.core.models.list.values())if(e.snappingClasses&&e.snappingClasses.length>0){const o=await r.raycastWithSnapping(e);if(o&&o.length>0)t.push(o[0]);else{const a=await r.raycast(e);a&&t.push(a)}}else{const o=await r.raycast(e);o&&t.push(o)}if(await Promise.all(t),t.length===0)return;let i=t[0],n=i.distance;for(let r=1;r<t.length;r++)t[r].distance<n&&(n=t[r].distance,i=t[r]);return i}async getPositions(e){const t=[],i=async(r,o)=>{const a=await r.getPositions(o);for(const l of a)t.push(l)},n=[];for(const r in e){const o=this.core.models.list.get(r);o&&n.push(i(o,Array.from(e[r])))}return await Promise.all(n),t}async getBBoxes(e){const t=[],i=async(r,o)=>{const a=await r.getBoxes(o);if(a)for(const l of a)t.push(l)},n=[];for(const r in e){const o=this.core.models.list.get(r);o&&n.push(i(o,Array.from(e[r])))}return await Promise.all(n),t}async highlight(e,t){await this.forEachModel(t,"highlight",e)}async getData(e,t){const i={};for(const[n,r]of Object.entries(e)){const o=this.list.get(n);if(!o)continue;if(r.size===0){i[n]=[];continue}const a=await o.getItemsData([...r],t);i[n]=a}return i}async resetHighlight(e){await this.forEachModel(e,"resetHighlight")}async forEachModel(e,t,...i){const n={};if(e)for(const o in e){const a=e[o];n[o]=Array.from(a)}else for(const o of this.core.models.list.keys())n[o]=void 0;const r=[];for(const o in n){const a=this.core.models.list.get(o);if(a){const l=n[o],c=a[t](l,...i);r.push(c)}}await Promise.all(r)}async guidsToModelIdMap(e){const t={};for(const[i,n]of this.list){const r=(await n.getLocalIdsByGuids([...e])).filter(o=>o!==null);t[i]=new Set(r)}return t}async modelIdMapToGuids(e){const t=[];for(const[i,n]of Object.entries(e)){const r=this.list.get(i);if(!r)continue;const o=(await r.getGuidsByLocalIds([...n])).filter(a=>a!==null);t.push(...o)}return t}applyBaseCoordinateSystem(e,t){const i=new xe;return t&&i.copy(t.clone()).invert(),i.multiply(this.baseCoordinationMatrix),e.applyMatrix4(i),i}};C(yu,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let he=yu;class Rb{constructor(){C(this,"wasm",{path:"",absolute:!1,logLevel:Um.LOG_LEVEL_OFF}),C(this,"webIfc",{COORDINATE_TO_ORIGIN:!0}),C(this,"autoSetWasm",!0),C(this,"customLocateFileHandler",null)}}const Ub=class ol extends Ae{constructor(e){super(e),C(this,"onDisposed",new J),C(this,"onIfcStartedLoading",new J),C(this,"onIfcImporterInitialized",new J),C(this,"onSetup",new J),C(this,"settings",new Rb),C(this,"webIfc",new Bc),C(this,"enabled",!0),this.components.add(ol.uuid,this)}dispose(){this.webIfc=null,this.onDisposed.trigger(ol.uuid),this.onDisposed.reset()}async setup(e){this.settings={...this.settings,...e},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(e,t,i,n){const r=this.components.get(he);if(!r.initialized)throw new Error("You need to initialize fragments first.");this.settings.autoSetWasm&&await this.autoSetWasm(),r.core.settings.autoCoordinate=t;const o=new zm;o.wasm.path=this.settings.wasm.path,o.wasm.absolute=this.settings.wasm.absolute,o.webIfcSettings=this.settings.webIfc,this.onIfcImporterInitialized.trigger(o),n!=null&&n.instanceCallback&&n.instanceCallback(o);const a=await o.process({...n==null?void 0:n.processData,bytes:e});return await r.core.load(a,{modelId:i,userData:n==null?void 0:n.userData})}async readIfcFile(e){const{path:t,absolute:i,logLevel:n}=this.settings.wasm;return this.webIfc.SetWasmPath(t,i),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModel(e,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new Bc}async autoSetWasm(){const e=await fetch(`https://unpkg.com/@thatopen/components@${Hu.release}/package.json`);if(!e.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const t=await e.json();if(!("web-ifc"in t.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const i=t.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${i}/`,this.settings.wasm.absolute=!0}}};C(Ub,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");const _u=class wu extends Ae{constructor(e){super(e),C(this,"enabled",!0),this.components.add(wu.uuid,this)}async set(e,t){const i=this.components.get(he),n=[];if(t)for(const[r,o]of Object.entries(t)){const a=i.list.get(r);a&&n.push(a.setVisible([...o],e))}else for(const r of i.list.values())n.push(r.setVisible(void 0,e));await Promise.all(n),await i.core.update(!0)}async isolate(e){await Promise.all([this.set(!1),this.set(!0,e)])}async toggle(e){const t=[],i=this.components.get(he);for(const[n,r]of Object.entries(e)){const o=i.list.get(n);o&&t.push(o.toggleVisible([...r]))}await Promise.all(t),await i.core.update(!0)}async getVisibilityMap(e,t){const i=[],n=[],r=this.components.get(he);if(t)for(const l of t){const c=r.list.get(l);c&&(i.push(c.modelId),n.push(c.getItemsByVisibility(e)))}else for(const l of r.list.values())i.push(l.modelId),n.push(l.getItemsByVisibility(e));const o=await Promise.all(n),a={};for(const[l,c]of i.entries())a[c]=o[l];return a}};C(_u,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");let Fb=_u;const xu=class al extends Ae{constructor(e){super(e),C(this,"enabled",!0),C(this,"onDisposed",new J),C(this,"list",new je),this.components.add(al.uuid,this)}dispose(e=!0){this.list.clear(),this.onDisposed.trigger(al.uuid),e&&(this.onDisposed.reset(),this.list.eventsEnabled=!1,this.list.dispose())}get(){const e=new Ve;for(const t of this.list)e.union(t);return e}async addFromModelIdMap(e){const t=this.components.get(he),i=new Ve;for(const[n,r]of Object.entries(e)){const o=t.list.get(n);if(!o)continue;const a=await o.getMergedBox([...r]);i.union(a)}this.list.add(i)}addFromModels(e){const t=this.components.get(he);for(const[i,n]of t.list)e&&!e.some(r=>r.test(i))||this.list.add(n.box)}async getCenter(e){this.list.clear(),await this.addFromModelIdMap(e);const t=this.get();this.list.clear();const i=new D;return t.getCenter(i),i}async getCameraOrientation(e,t=1){const i=this.components.get(he);this.list.clear();for(const[c,h]of i.list)this.list.add(h.box);const n=this.get();this.list.clear();const r=new D;n.getCenter(r);const o=new D;n.getSize(o);const a=Math.max(o.x,o.y,o.z)*t,l=new D;switch(e){case"front":l.set(r.x,r.y,r.z+a);break;case"back":l.set(r.x,r.y,r.z-a);break;case"left":l.set(r.x-a,r.y,r.z);break;case"right":l.set(r.x+a,r.y,r.z);break;case"top":l.set(r.x,r.y+a,r.z);break;case"bottom":l.set(r.x,r.y-a,r.z);break;default:l.set(r.x,r.y,r.z+a)}return{position:l,target:r}}};C(xu,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");let xo=xu;class jb{constructor(e,t){C(this,"name","Query"),C(this,"customData",{}),C(this,"_components"),C(this,"_queries",[]),C(this,"_aggregation","exclusive"),C(this,"result",null),C(this,"cache",!0),C(this,"serializeQueryParameters",i=>{var n;return{categories:(n=i.categories)==null?void 0:n.map(r=>r.source),attributes:i.attributes?{aggregation:i.attributes.aggregation,queries:i.attributes.queries.map(this.serializeAttributeQuery)}:void 0,relation:i.relation?{name:i.relation.name,query:i.relation.query?this.serializeQueryParameters(i.relation.query):void 0}:void 0}}),C(this,"deserializeQueryParameters",i=>{var n;return{categories:(n=i.categories)==null?void 0:n.map(r=>new RegExp(r)),attributes:i.attributes?{aggregation:i.attributes.aggregation,queries:i.attributes.queries.map(this.deserializeAttributeQuery)}:void 0,relation:i.relation?{name:i.relation.name,query:i.relation.query?this.deserializeQueryParameters(i.relation.query):void 0}:void 0}}),this._components=e,this.queries=t}set queries(e){this._queries=e,this.clearCache()}get queries(){return this._queries}set aggregation(e){e!==this._aggregation&&this.clearCache(),this._aggregation=e}get aggregation(){return this._aggregation}async test(e){const{modelIds:t,force:i}={force:!1,...e};if(this.result&&!i)return this.result;const n=await this._components.get(qn).getItems(this.queries,{modelIds:t,aggregation:this.aggregation});return this.cache&&(this.result=n),n}clearCache(){this.result=null}serializeAttributeQuery(e){let t;return Array.isArray(e.value)?t=e.value.map(i=>i.source):e.value instanceof RegExp?t=e.value.source:t=e.value,{name:e.name.source,value:t,type:e.type instanceof RegExp?e.type.source:e.type,negate:e.negate,itemIds:e.itemIds}}toJSON(){return{guid:this._components.get(qn).list.getKey(this)??st.create(),name:this.name,customData:this.customData,queries:this.queries.map(this.serializeQueryParameters),aggregation:this.aggregation,cache:this.cache}}deserializeAttributeQuery(e){let t;return Array.isArray(e.value)?t=e.value.map(i=>new RegExp(i)):typeof e.value=="string"?t=new RegExp(e.value):t=e.value,{name:new RegExp(e.name),value:t,type:e.type?new RegExp(e.type):void 0,negate:e.negate,itemIds:e.itemIds}}fromJSON(e){return this.name=e.name,this.customData=e.customData,this.aggregation=e.aggregation,this.cache=e.cache,this.queries=e.queries.map(this.deserializeQueryParameters),this}}const Cu=class Eu extends Ae{constructor(e){super(e),C(this,"enabled",!0),C(this,"list",new Se),e.add(Eu.uuid,this)}async getItems(e,t){let i;if(t){const{modelIds:a,items:l}=t;if(l){const c=Object.keys(l);c.length>0&&(i=c.map(h=>new RegExp(`^${h}$`)))}else a&&(i=a)}const n=(t==null?void 0:t.aggregation)??"exclusive",r=this.components.get(he),o=await Promise.all(e.map(async a=>{const l={};return await Promise.all(Array.from(r.list).map(async([c,h])=>{var d;if(i&&!i.some(g=>g.test(c)))return;const p=(d=t==null?void 0:t.items)==null?void 0:d[c],u=await h.getItemsByQuery(a,{localIds:p?[...p]:void 0});l[c]=new Set(u)})),l}));return n==="inclusive"?ke.join(o):ke.intersect(o)}create(e,t){const i=new jb(this.components,t);return this.list.set(e,i),i}async addFromCategories(e){const t=new Set,i=this.components.get(he);for(const[n,r]of i.list){if(e&&!e.some(l=>l.test(n)))continue;const o=(await r.getItemsWithGeometryCategories()).filter(l=>l!==null),a=new Set(o);for(const l of a)this.list.has(l)||(this.create(l,[{categories:[new RegExp(`^${l}$`)]}]),t.add(l))}return[...t]}import(e){const{data:t}=e,i=[];if(!t)return i;for(const n of t){const r=this.create(n.guid,[]);r.fromJSON(n),i.push(r)}return i}export(){const e=[];for(const[t,i]of this.list.entries()){const n={...i.toJSON(),name:t};e.push(n)}return{data:e}}};C(Cu,"uuid","0da7ad77-f734-42ca-942f-a074adfd1e3a");let qn=Cu;const Su=class Au extends Ae{constructor(e){super(e),C(this,"enabled",!0),C(this,"onDisposed",new J),C(this,"list",new Se),C(this,"defaultSaveFunction",t=>"value"in t.Name?t.Name.value:null),C(this,"onBeforeFragmentsDispose",async t=>{const{key:i,value:n}=t,r=await n.getLocalIds(),o={[i]:new Set(r)};this.removeItems(o)}),e.add(Au.uuid,this),this.setupEvents(),e.get(he).list.onBeforeDelete.add(this.onBeforeFragmentsDispose)}setupEvents(){this.list.onBeforeDelete.add(({value:e})=>e.dispose())}getClassificationGroups(e){let t=this.list.get(e);return t||(t=new Se,this.list.set(e,t)),t}getModelItems(e,t,i){const{map:n}=this.getGroupData(e,t);let r=n[i];return r||(r=new Set,n[i]=r),r}getGroupData(e,t){const i=this.components.get(qn),n=this.getClassificationGroups(e);let r=n.get(t);return r||(r={map:{},get(){return new Promise(o=>{if(!r){o({});return}if(r.query){const{name:a,config:l}=r.query,c=i.list.get(a);if(!c)throw new Error("Classifier: the query name associated with the group doesn't exist in the ItemsFinder component");c.test(l).then(h=>{if(!r){o({});return}const d=ke.join([h,r.map]);o(d)})}else o(r.map)})}},n.set(t,r)),r}async aggregateItems(e,t,i){const n=(i==null?void 0:i.data)??void 0,r=(i==null?void 0:i.aggregationCallback)??this.defaultSaveFunction,o=this.components.get(he),a=await this.components.get(qn).getItems([t],{modelIds:i==null?void 0:i.modelIds});for(const[l,c]of Object.entries(a)){const h=o.list.get(l);if(!h)continue;const d=(u,...g)=>{const m=this.getModelItems(e,u,l);for(const b of g)m.add(b)},p=await h.getItemsData([...c],n);for(const u of p)r(u,d)}}addGroupItems(e,t,i){const{map:n}=this.getGroupData(e,t);ke.add(n,i)}setGroupQuery(e,t,i){const n=this.getGroupData(e,t);n.query=i}async find(e){const t=[];for(const[i,n]of Object.entries(e)){const r=[],o=this.list.get(i);if(!o)continue;for(const l of n){const c=o.get(l);if(!c)continue;const h=await c.get();r.push(h)}const a=ke.join(r);t.push(a)}return ke.intersect(t)}async aggregateItemRelations(e,t,i,n){const r=(n==null?void 0:n.attribute)??"Name",o={relations:{[i]:{attributes:!0,relations:!1}}};await this.aggregateItems(e,t,{modelIds:n==null?void 0:n.modelIds,data:o,aggregationCallback:(a,l)=>{if(!(a!=null&&a[r]))return;const c=a[r];if(!("value"in c))return;const h=a[i];if(Array.isArray(h))for(const d of h)"value"in d._localId&&l(c.value,d._localId.value)}})}async byIfcBuildingStorey(e){await this.aggregateItemRelations((e==null?void 0:e.classificationName)??"Storeys",{categories:[/BUILDINGSTOREY/]},"ContainsElements",{modelIds:e==null?void 0:e.modelIds})}async byCategory(e){const t=await this.components.get(qn).addFromCategories(e==null?void 0:e.modelIds);for(const i of t)this.setGroupQuery((e==null?void 0:e.classificationName)??"Categories",i,{name:i})}dispose(){this.list.clear(),this.components.get(he).list.onBeforeDelete.remove(this.onBeforeFragmentsDispose),this.onDisposed.trigger()}removeItems(e,t){if(t&&t.classificationName){const i=this.list.get(t.classificationName);if(!i||t.groupName&&!i.get(t.groupName))return;for(const[,n]of i)ke.remove(n.map,e);return}for(const[,i]of this.list.entries())for(const[,n]of i)ke.remove(n.map,e)}async byModel(e){const t=this.components.get(he),i=(e==null?void 0:e.classificationName)??"Models";for(const[n,r]of t.list){if(e&&e.modelIds&&!e.modelIds.some(l=>l.test(n)))continue;const o=await r.getItemsIdsWithGeometry(),a={[n]:new Set(o)};this.getGroupData(i,n),this.addGroupItems(i,n,a)}}};C(Su,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");let Hb=Su;class Vb{constructor(e,t){C(this,"enabled",!0),C(this,"components"),C(this,"onDisposed",new J),C(this,"mouse"),C(this,"world"),C(this,"debugMode",!1),C(this,"colorToModelId",new Map),C(this,"modelIdToColor",new Map),C(this,"renderTarget"),C(this,"renderTargetSize",new Ne),C(this,"debugCanvas"),C(this,"debugContainer"),C(this,"colorMaterials",new Map),C(this,"originalMaterials",new Map),C(this,"originalLodColors",new Map),C(this,"colorsNeedUpdate",!0);const i=t.renderer;if(!i)throw new Error("A renderer is needed for the FastModelPicker to work!");this.world=t,this.mouse=new bu(i.three.domElement),this.components=e,this.setupRenderTarget(),this.setupFragmentListeners()}setupFragmentListeners(){const e=this.components.get(he);e.list.onItemSet.add(()=>{this.colorsNeedUpdate=!0}),e.list.onItemDeleted.add(()=>{this.colorsNeedUpdate=!0})}setupRenderTarget(){const e=this.world.renderer.three.getSize(new Ne);this.renderTargetSize.copy(e),this.renderTarget=new Fm(e.x,e.y),this.renderTarget.texture.format=jm,this.renderTarget.texture.type=Hm,this.debugMode&&this.setupDebugCanvas(),this.world.renderer.onResize.add(t=>{this.renderTargetSize.copy(t),this.renderTarget.setSize(t.x,t.y),this.debugCanvas&&(this.debugCanvas.width=t.x,this.debugCanvas.height=t.y)})}setupDebugCanvas(){if(this.debugCanvas)return;const e=this.world.renderer.three.getSize(new Ne);this.debugContainer=document.createElement("div"),this.debugContainer.style.position="fixed",this.debugContainer.style.top="10px",this.debugContainer.style.right="10px",this.debugContainer.style.width="300px",this.debugContainer.style.height="300px",this.debugContainer.style.border="2px solid #fff",this.debugContainer.style.backgroundColor="#000",this.debugContainer.style.zIndex="10000",this.debugContainer.style.pointerEvents="none",this.debugCanvas=document.createElement("canvas"),this.debugCanvas.width=e.x,this.debugCanvas.height=e.y,this.debugCanvas.style.width="100%",this.debugCanvas.style.height="100%",this.debugCanvas.style.imageRendering="pixelated",this.debugContainer.appendChild(this.debugCanvas),document.body.appendChild(this.debugContainer)}generateColorForModel(e){let t=0;for(let a=0;a<e.length;a++)t=(t<<5)-t+e.charCodeAt(a),t&=t;let i=Math.abs(t)%16777215;i===0&&(i=1);const n=i>>16&255||1,r=i>>8&255||1,o=i&255||1;return new be(n/255,r/255,o/255)}colorToId(e){const t=Math.round(e.r*255),i=Math.round(e.g*255),n=Math.round(e.b*255);return t<<16|i<<8|n}assignColors(){const e=this.components.get(he);if(e.initialized){if(!this.colorsNeedUpdate){const t=new Set(e.list.keys()),i=new Set(this.modelIdToColor.keys());(t.size!==i.size||[...t].some(n=>!i.has(n)))&&(this.colorsNeedUpdate=!0)}if(this.colorsNeedUpdate){this.colorToModelId.clear(),this.modelIdToColor.clear();for(const t of this.colorMaterials.values())t.dispose();this.colorMaterials.clear();for(const[t]of e.list){const i=this.generateColorForModel(t),n=this.colorToId(i);this.colorToModelId.set(n,t),this.modelIdToColor.set(t,i);const r=new on({color:i,depthTest:!0,depthWrite:!0});this.colorMaterials.set(t,r)}this.colorsNeedUpdate=!1}}}applyColorMaterials(){const e=this.components.get(he);if(e.initialized)for(const[t,i]of e.list){const n=this.colorMaterials.get(t);n&&i.object.traverse(r=>{if(r instanceof re){if("isLODGeometry"in r.geometry){const o=r.material[0].uniforms.lodColor;this.originalLodColors.has(o)||this.originalLodColors.set(o,o.value),o.value=n.color;return}this.originalMaterials.has(r)||this.originalMaterials.set(r,r.material),r.material=n}})}}restoreOriginalMaterials(){for(const[e,t]of this.originalMaterials)e.material=t;for(const[e,t]of this.originalLodColors)e.value=t;this.originalMaterials.clear()}renderColorCoded(){if(!this.renderTarget||!this.world.renderer)throw new Error("Render target not initialized!");const e=this.world.renderer.three,t=this.world.scene.three,i=this.world.camera.three,n=e.getRenderTarget(),r=e.autoClear,o=new be,a=e.getClearAlpha();e.getClearColor(o),this.applyColorMaterials(),e.setRenderTarget(this.renderTarget),e.autoClear=!0,e.setClearColor(0,1),e.clear(!0,!0,!1),e.render(t,i),e.setRenderTarget(n),e.autoClear=r,e.setClearColor(o,a),this.restoreOriginalMaterials(),this.debugMode&&this.debugCanvas&&this.updateDebugCanvas()}updateDebugCanvas(){if(!this.debugCanvas||!this.renderTarget||!this.world.renderer)return;const e=this.world.renderer.three,t=this.renderTargetSize,i=new Uint8Array(t.x*t.y*4);e.readRenderTargetPixels(this.renderTarget,0,0,t.x,t.y,i);const n=this.debugCanvas.getContext("2d");if(!n)return;const r=n.createImageData(t.x,t.y),o=t.x*4;for(let a=0;a<t.y;a++){const l=a,c=t.y-1-a,h=l*o,d=c*o;r.data.set(i.subarray(h,h+o),d)}n.putImageData(r,0,0)}async getModelAt(e){if(!this.renderTarget||!this.world.renderer)throw new Error("Render target not initialized!");const t=this.components.get(he);if(!t.initialized||t.list.size===0)return null;this.assignColors(),this.renderColorCoded();const i=e||this.mouse.position,n=this.renderTargetSize,r=Math.floor((i.x+1)*.5*n.x),o=Math.floor((i.y+1)*.5*(n.y-1)),a=Math.max(0,Math.min(n.x-1,r)),l=Math.max(0,Math.min(n.y-1,o)),c=this.world.renderer.three,h=new Uint8Array(4);c.readRenderTargetPixels(this.renderTarget,a,l,1,1,h);const d=h[0],p=h[1],u=h[2],g=d<<16|p<<8|u;return this.colorToModelId.get(g)||null}setDebugMode(e){this.debugMode=e,e?this.setupDebugCanvas():this.removeDebugCanvas()}removeDebugCanvas(){this.debugContainer&&(this.debugContainer.remove(),this.debugContainer=void 0,this.debugCanvas=void 0)}dispose(){this.mouse.dispose(),this.removeDebugCanvas();for(const e of this.colorMaterials.values())e.dispose();this.colorMaterials.clear(),this.renderTarget&&this.renderTarget.dispose(),this.colorToModelId.clear(),this.modelIdToColor.clear(),this.originalMaterials.clear(),this.originalLodColors.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}}const $u=class Tu extends Ae{constructor(e){super(e),C(this,"enabled",!0),C(this,"list",new Map),C(this,"onDisposed",new J),e.add(Tu.uuid,this)}get(e){if(this.list.has(e.uuid))return this.list.get(e.uuid);const t=new Vb(this.components,e);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}};C($u,"uuid","4a82430c-7ff2-49ea-9401-60807502dad6");let qb=$u;class Wb{constructor(e,t){C(this,"enabled",!0),C(this,"components"),C(this,"onDisposed",new J),C(this,"mouse"),C(this,"three",new Zl),C(this,"world"),C(this,"useFastModelPicking",!1);const i=t.renderer;if(!i)throw new Error("A renderer is needed for the raycaster to work!");this.world=t,this.mouse=new bu(i.three.domElement),this.components=e}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRayToObjects(e=Array.from(this.world.meshes),t=this.mouse.position){if(!this.world)throw new Error("A world is needed to cast rays!");const i=this.world.camera.three;return this.three.setFromCamera(t,i),this.intersect(e)}async castRay(e){const t=e==null?void 0:e.snappingClasses,i=(e==null?void 0:e.items)??Array.from(this.world.meshes),n=(e==null?void 0:e.position)??this.mouse.position;if(!this.world)throw new Error("A world is needed to cast rays!");const r=this.world.camera.three,o=this.components.get(he),a=this.world.renderer.three.domElement,l=this.mouse.rawPosition;let c=null;if(o.initialized){if(this.useFastModelPicking){const d=await this.components.get(qb).get(this.world).getModelAt(n);if(d){const p=o.list.get(d);if(p)if(t&&t.length>0){const u=await p.raycastWithSnapping({camera:r,dom:a,mouse:l,snappingClasses:t});u&&u.length>0?c=u[0]:c=await p.raycast({camera:r,dom:a,mouse:l})}else c=await p.raycast({camera:r,dom:a,mouse:l})}}else c=await o.raycast({camera:r,dom:a,mouse:l,snappingClasses:t});if(i.length===0)return c}this.three.setFromCamera(n,r);const h=this.intersect(i);return c?h&&h.distance<c.distance?h:c:h}castRayFromVector(e,t,i=Array.from(this.world.meshes)){return this.three.set(e,t),this.intersect(i)}intersect(e=Array.from(this.world.meshes)){const t=this.three.intersectObjects(e),i=this.filterClippingPlanes(t);return i.length>0?i[0]:null}filterClippingPlanes(e){if(!this.world.renderer)throw new Error("Renderer not found!");const t=this.world.renderer.three;if(!t.clippingPlanes)return e;const i=t.clippingPlanes;return e.length<=0||!i||(i==null?void 0:i.length)<=0?e:e.filter(n=>i.every(r=>r.distanceToPoint(n.point)>0))}}const ku=class Pu extends Ae{constructor(e){super(e),C(this,"enabled",!0),C(this,"list",new Map),C(this,"onDisposed",new J),e.add(Pu.uuid,this)}get(e){if(this.list.has(e.uuid))return this.list.get(e.uuid);const t=new Wb(this.components,e);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}};C(ku,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let pt=ku;class Yb extends Jl{constructor(){super(...arguments),C(this,"onCameraChanged",new J),C(this,"meshes",new Set),C(this,"onAfterUpdate",new J),C(this,"onBeforeUpdate",new J),C(this,"onDisposed",new J),C(this,"isDisposing",!1),C(this,"enabled",!0),C(this,"_dynamicAnchor",!1),C(this,"uuid",st.create()),C(this,"name"),C(this,"_scene"),C(this,"_camera"),C(this,"_renderer",null),C(this,"onPointerDown",async e=>{if(!this.camera.hasCameraControls())throw new Error("World: can't set dynamic anchor if the camera doesn't have controls.");const t=await this.components.get(pt).get(this).castRay();t&&t.point&&e.button===0&&this.camera.controls.setOrbitPoint(t.point.x,t.point.y,t.point.z)}),C(this,"_defaultCamera")}set dynamicAnchor(e){var t;const i=(t=this.renderer)==null?void 0:t.three.domElement.parentElement;if(!i)throw new Error("World: the renderer must have a parentElement to set dynamic anchoring.");e?(this.camera.controls&&(this.camera.controls.minDistance=.01),i.addEventListener("pointerdown",this.onPointerDown)):i.removeEventListener("pointerdown",this.onPointerDown)}get dynamicAnchor(){return this._dynamicAnchor}get defaultCamera(){if(!this._defaultCamera)throw new Error("World: there is no default camera defined.");return this._defaultCamera}set defaultCamera(e){this._defaultCamera=e}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(e){this._scene=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(e){this._camera||(this.defaultCamera=e),this._camera=e,e.currentWorld=this,this.onCameraChanged.trigger(e)}get renderer(){return this._renderer}set renderer(e){this._renderer=e,e&&(e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"}))}useDefaultCamera(){this.camera=this.defaultCamera}update(e){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(e),this.camera.isUpdateable()&&this.camera.update(e),this.renderer&&this.renderer.update(e),this.onAfterUpdate.trigger()))}dispose(e=!0){if(this.enabled=!1,this.isDisposing=!0,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),e){const t=this.components.get(oi);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const i of this.meshes)t.destroy(i);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.components.get(Du).list.delete(this.uuid),this.onDisposed.trigger(),this.onDisposed.reset()}}class Zb extends xg{constructor(e,t,i){super(e),C(this,"enabled",!0),C(this,"container"),C(this,"three"),C(this,"mode",1),C(this,"needsUpdate",!1),C(this,"_canvas"),C(this,"_parameters"),C(this,"_resizeObserver",null),C(this,"onContainerUpdated",new J),C(this,"_resizing",!1),C(this,"resize",o=>{if(this._resizing)return;this._resizing=!0,this.onContainerUpdated.trigger();const a=o?o.x:this.container.clientWidth,l=o?o.y:this.container.clientHeight;this.three.setSize(a,l),this.onResize.trigger(new Ne(a,l)),this._resizing=!1}),C(this,"resizeEvent",()=>{this.resize()}),C(this,"onContextLost",o=>{o.preventDefault(),this.enabled=!1}),C(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new Uc({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0}),this.container=t,this._parameters=i,this.three=new Uc({antialias:!0,alpha:!0,...i}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const n=this.three.getContext(),{canvas:r}=n;r.addEventListener("webglcontextlost",this.onContextLost,!1),r.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld||this.mode===0&&!this.needsUpdate)return;this.needsUpdate=!1,this.onBeforeUpdate.trigger(this);const e=this.currentWorld.scene.three,t=this.currentWorld.camera.three;this.three.render(e,t),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.forceContextLoss(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new Ne(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(e){const t=this.three.domElement.parentElement;if(!t)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),e&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(t),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Le={LEFT:1,RIGHT:2,MIDDLE:4},F=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),xs={NONE:0,IN:1,OUT:-1};function Ji(s){return s.isPerspectiveCamera}function $i(s){return s.isOrthographicCamera}const Cs=Math.PI*2,Wc=Math.PI/2,Ou=1e-5,En=Math.PI/180;function Ft(s,e,t){return Math.max(e,Math.min(t,s))}function Me(s,e=Ou){return Math.abs(s)<e}function we(s,e,t=Ou){return Me(s-e,t)}function Yc(s,e){return Math.round(s/e)*e}function Sn(s){return isFinite(s)?s:s<0?-Number.MAX_VALUE:Number.MAX_VALUE}function An(s){return Math.abs(s)<Number.MAX_VALUE?s:s*(1/0)}function Ir(s,e,t,i,n=1/0,r){i=Math.max(1e-4,i);const o=2/i,a=o*r,l=1/(1+a+.48*a*a+.235*a*a*a);let c=s-e;const h=e,d=n*i;c=Ft(c,-d,d),e=s-c;const p=(t.value+o*c)*r;t.value=(t.value-o*p)*l;let u=e+(c+p)*l;return h-s>0==u>h&&(u=h,t.value=(u-h)/r),u}function Zc(s,e,t,i,n=1/0,r,o){i=Math.max(1e-4,i);const a=2/i,l=a*r,c=1/(1+l+.48*l*l+.235*l*l*l);let h=e.x,d=e.y,p=e.z,u=s.x-h,g=s.y-d,m=s.z-p;const b=h,f=d,y=p,v=n*i,w=v*v,E=u*u+g*g+m*m;if(E>w){const L=Math.sqrt(E);u=u/L*v,g=g/L*v,m=m/L*v}h=s.x-u,d=s.y-g,p=s.z-m;const S=(t.x+a*u)*r,$=(t.y+a*g)*r,M=(t.z+a*m)*r;t.x=(t.x-a*S)*c,t.y=(t.y-a*$)*c,t.z=(t.z-a*M)*c,o.x=h+(u+S)*c,o.y=d+(g+$)*c,o.z=p+(m+M)*c;const k=b-s.x,z=f-s.y,j=y-s.z,A=o.x-b,P=o.y-f,_=o.z-y;return k*A+z*P+j*_>0&&(o.x=b,o.y=f,o.z=y,t.x=(o.x-b)/r,t.y=(o.y-f)/r,t.z=(o.z-y)/r),o}function va(s,e){e.set(0,0),s.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=s.length,e.y/=s.length}function _a(s,e){return $i(s)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class Gb{constructor(){this._listeners={}}addEventListener(e,t){const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners[e];if(i!==void 0){const n=i.indexOf(t);n!==-1&&i.splice(n,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const t=this._listeners[e.type];if(t!==void 0){e.target=this;const i=t.slice(0);for(let n=0,r=i.length;n<r;n++)i[n].call(this,e)}}}var wa;const Xb="2.10.1",zr=1/8,Qb=/Mac/.test((wa=globalThis==null?void 0:globalThis.navigator)===null||wa===void 0?void 0:wa.platform);let ue,Gc,Dr,xa,mt,ge,ve,Es,$n,Kt,Jt,es,Xc,Qc,Pt,Tn,Ss,Kc,Ca,Jc,Ea,Sa,Lr,wt=class ll extends Gb{static install(e){ue=e.THREE,Gc=Object.freeze(new ue.Vector3(0,0,0)),Dr=Object.freeze(new ue.Vector3(0,1,0)),xa=Object.freeze(new ue.Vector3(0,0,1)),mt=new ue.Vector2,ge=new ue.Vector3,ve=new ue.Vector3,Es=new ue.Vector3,$n=new ue.Vector3,Kt=new ue.Vector3,Jt=new ue.Vector3,es=new ue.Vector3,Xc=new ue.Vector3,Qc=new ue.Vector3,Pt=new ue.Spherical,Tn=new ue.Spherical,Ss=new ue.Box3,Kc=new ue.Box3,Ca=new ue.Sphere,Jc=new ue.Quaternion,Ea=new ue.Quaternion,Sa=new ue.Matrix4,Lr=new ue.Raycaster}static get ACTION(){return F}set verticalDragToForward(e){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=F.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=xs.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new ue.Vector3,this._focalOffsetVelocity=new ue.Vector3,this._zoomVelocity={value:0},this._truckInternal=(f,y,v,w)=>{let E,S;if(Ji(this._camera)){const $=ge.copy(this._camera.position).sub(this._target),M=this._camera.getEffectiveFOV()*En,k=$.length()*Math.tan(M*.5);E=this.truckSpeed*f*k/this._elementRect.height,S=this.truckSpeed*y*k/this._elementRect.height}else if($i(this._camera)){const $=this._camera;E=this.truckSpeed*f*($.right-$.left)/$.zoom/this._elementRect.width,S=this.truckSpeed*y*($.top-$.bottom)/$.zoom/this._elementRect.height}else return;w?(v?this.setFocalOffset(this._focalOffsetEnd.x+E,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(E,0,!0),this.forward(-S,!0)):v?this.setFocalOffset(this._focalOffsetEnd.x+E,this._focalOffsetEnd.y+S,this._focalOffsetEnd.z,!0):this.truck(E,S,!0)},this._rotateInternal=(f,y)=>{const v=Cs*this.azimuthRotateSpeed*f/this._elementRect.height,w=Cs*this.polarRotateSpeed*y/this._elementRect.height;this.rotate(v,w,!0)},this._dollyInternal=(f,y,v)=>{const w=Math.pow(.95,-f*this.dollySpeed),E=this._sphericalEnd.radius,S=this._sphericalEnd.radius*w,$=Ft(S,this.minDistance,this.maxDistance),M=$-S;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(S,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(M,!0),this._dollyToNoClamp($,!0)):this._dollyToNoClamp($,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?S:$)-E,this._dollyControlCoord.set(y,v)),this._lastDollyDirection=Math.sign(-f)},this._zoomInternal=(f,y,v)=>{const w=Math.pow(.95,f*this.dollySpeed),E=this._zoom,S=this._zoom*w;this.zoomTo(S,!0),this.dollyToCursor&&(this._changedZoom+=S-E,this._dollyControlCoord.set(y,v))},typeof ue>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new ue.Quaternion().setFromUnitVectors(this._camera.up,Dr),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=F.NONE,this._target=new ue.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new ue.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new ue.Spherical().setFromVector3(ge.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new ue.Vector3,new ue.Vector3,new ue.Vector3,new ue.Vector3],this._updateNearPlaneCorners(),this._boundary=new ue.Box3(new ue.Vector3(-1/0,-1/0,-1/0),new ue.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new ue.Vector2,this.mouseButtons={left:F.ROTATE,middle:F.DOLLY,right:F.TRUCK,wheel:Ji(this._camera)?F.DOLLY:$i(this._camera)?F.ZOOM:F.NONE},this.touches={one:F.TOUCH_ROTATE,two:Ji(this._camera)?F.TOUCH_DOLLY_TRUCK:$i(this._camera)?F.TOUCH_ZOOM_TRUCK:F.NONE,three:F.TOUCH_TRUCK};const i=new ue.Vector2,n=new ue.Vector2,r=new ue.Vector2,o=f=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const w=this._domElement.getBoundingClientRect(),E=f.clientX/w.width,S=f.clientY/w.height;if(E<this._interactiveArea.left||E>this._interactiveArea.right||S<this._interactiveArea.top||S>this._interactiveArea.bottom)return}const y=f.pointerType!=="mouse"?null:(f.buttons&Le.LEFT)===Le.LEFT?Le.LEFT:(f.buttons&Le.MIDDLE)===Le.MIDDLE?Le.MIDDLE:(f.buttons&Le.RIGHT)===Le.RIGHT?Le.RIGHT:null;if(y!==null){const w=this._findPointerByMouseButton(y);w&&this._disposePointer(w)}if((f.buttons&Le.LEFT)===Le.LEFT&&this._lockedPointer)return;const v={pointerId:f.pointerId,clientX:f.clientX,clientY:f.clientY,deltaX:0,deltaY:0,mouseButton:y};this._activePointers.push(v),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,p(f)},a=f=>{f.cancelable&&f.preventDefault();const y=f.pointerId,v=this._lockedPointer||this._findPointerById(y);if(v){if(v.clientX=f.clientX,v.clientY=f.clientY,v.deltaX=f.movementX,v.deltaY=f.movementY,this._state=0,f.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(f.buttons&Le.LEFT)===Le.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(f.buttons&Le.MIDDLE)===Le.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(f.buttons&Le.RIGHT)===Le.RIGHT&&(this._state=this._state|this.mouseButtons.right);u()}},l=f=>{const y=this._findPointerById(f.pointerId);if(!(y&&y===this._lockedPointer)){if(y&&this._disposePointer(y),f.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=F.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=F.NONE;g()}};let c=-1;const h=f=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===F.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const S=this._domElement.getBoundingClientRect(),$=f.clientX/S.width,M=f.clientY/S.height;if($<this._interactiveArea.left||$>this._interactiveArea.right||M<this._interactiveArea.top||M>this._interactiveArea.bottom)return}if(f.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===F.ROTATE||this.mouseButtons.wheel===F.TRUCK){const S=performance.now();c-S<1e3&&this._getClientRect(this._elementRect),c=S}const y=Qb?-1:-3,v=f.deltaMode===1||f.ctrlKey?f.deltaY/y:f.deltaY/(y*10),w=this.dollyToCursor?(f.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,E=this.dollyToCursor?(f.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case F.ROTATE:{this._rotateInternal(f.deltaX,f.deltaY),this._isUserControllingRotate=!0;break}case F.TRUCK:{this._truckInternal(f.deltaX,f.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case F.SCREEN_PAN:{this._truckInternal(f.deltaX,f.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case F.OFFSET:{this._truckInternal(f.deltaX,f.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case F.DOLLY:{this._dollyInternal(-v,w,E),this._isUserControllingDolly=!0;break}case F.ZOOM:{this._zoomInternal(-v,w,E),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},d=f=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===ll.ACTION.NONE){const y=f instanceof PointerEvent?f.pointerId:0,v=this._findPointerById(y);v&&this._disposePointer(v),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l);return}f.preventDefault()}},p=f=>{if(this._enabled){if(va(this._activePointers,mt),this._getClientRect(this._elementRect),i.copy(mt),n.copy(mt),this._activePointers.length>=2){const y=mt.x-this._activePointers[1].clientX,v=mt.y-this._activePointers[1].clientY,w=Math.sqrt(y*y+v*v);r.set(0,w);const E=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,S=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;n.set(E,S)}if(this._state=0,!f)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in f&&f.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(f.buttons&Le.LEFT)===Le.LEFT&&(this._state=this._state|this.mouseButtons.left),(f.buttons&Le.MIDDLE)===Le.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(f.buttons&Le.RIGHT)===Le.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&F.ROTATE)===F.ROTATE||(this._state&F.TOUCH_ROTATE)===F.TOUCH_ROTATE||(this._state&F.TOUCH_DOLLY_ROTATE)===F.TOUCH_DOLLY_ROTATE||(this._state&F.TOUCH_ZOOM_ROTATE)===F.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&F.TRUCK)===F.TRUCK||(this._state&F.SCREEN_PAN)===F.SCREEN_PAN||(this._state&F.TOUCH_TRUCK)===F.TOUCH_TRUCK||(this._state&F.TOUCH_SCREEN_PAN)===F.TOUCH_SCREEN_PAN||(this._state&F.TOUCH_DOLLY_TRUCK)===F.TOUCH_DOLLY_TRUCK||(this._state&F.TOUCH_DOLLY_SCREEN_PAN)===F.TOUCH_DOLLY_SCREEN_PAN||(this._state&F.TOUCH_ZOOM_TRUCK)===F.TOUCH_ZOOM_TRUCK||(this._state&F.TOUCH_ZOOM_SCREEN_PAN)===F.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&F.DOLLY)===F.DOLLY||(this._state&F.TOUCH_DOLLY)===F.TOUCH_DOLLY||(this._state&F.TOUCH_DOLLY_TRUCK)===F.TOUCH_DOLLY_TRUCK||(this._state&F.TOUCH_DOLLY_SCREEN_PAN)===F.TOUCH_DOLLY_SCREEN_PAN||(this._state&F.TOUCH_DOLLY_OFFSET)===F.TOUCH_DOLLY_OFFSET||(this._state&F.TOUCH_DOLLY_ROTATE)===F.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&F.ZOOM)===F.ZOOM||(this._state&F.TOUCH_ZOOM)===F.TOUCH_ZOOM||(this._state&F.TOUCH_ZOOM_TRUCK)===F.TOUCH_ZOOM_TRUCK||(this._state&F.TOUCH_ZOOM_SCREEN_PAN)===F.TOUCH_ZOOM_SCREEN_PAN||(this._state&F.TOUCH_ZOOM_OFFSET)===F.TOUCH_ZOOM_OFFSET||(this._state&F.TOUCH_ZOOM_ROTATE)===F.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&F.OFFSET)===F.OFFSET||(this._state&F.TOUCH_OFFSET)===F.TOUCH_OFFSET||(this._state&F.TOUCH_DOLLY_OFFSET)===F.TOUCH_DOLLY_OFFSET||(this._state&F.TOUCH_ZOOM_OFFSET)===F.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},u=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,va(this._activePointers,mt);const f=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,y=f?-f.deltaX:n.x-mt.x,v=f?-f.deltaY:n.y-mt.y;if(n.copy(mt),((this._state&F.ROTATE)===F.ROTATE||(this._state&F.TOUCH_ROTATE)===F.TOUCH_ROTATE||(this._state&F.TOUCH_DOLLY_ROTATE)===F.TOUCH_DOLLY_ROTATE||(this._state&F.TOUCH_ZOOM_ROTATE)===F.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(y,v),this._isUserControllingRotate=!0),(this._state&F.DOLLY)===F.DOLLY||(this._state&F.ZOOM)===F.ZOOM){const w=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,E=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0,S=this.dollyDragInverted?-1:1;(this._state&F.DOLLY)===F.DOLLY?(this._dollyInternal(S*v*zr,w,E),this._isUserControllingDolly=!0):(this._zoomInternal(S*v*zr,w,E),this._isUserControllingZoom=!0)}if((this._state&F.TOUCH_DOLLY)===F.TOUCH_DOLLY||(this._state&F.TOUCH_ZOOM)===F.TOUCH_ZOOM||(this._state&F.TOUCH_DOLLY_TRUCK)===F.TOUCH_DOLLY_TRUCK||(this._state&F.TOUCH_ZOOM_TRUCK)===F.TOUCH_ZOOM_TRUCK||(this._state&F.TOUCH_DOLLY_SCREEN_PAN)===F.TOUCH_DOLLY_SCREEN_PAN||(this._state&F.TOUCH_ZOOM_SCREEN_PAN)===F.TOUCH_ZOOM_SCREEN_PAN||(this._state&F.TOUCH_DOLLY_OFFSET)===F.TOUCH_DOLLY_OFFSET||(this._state&F.TOUCH_ZOOM_OFFSET)===F.TOUCH_ZOOM_OFFSET||(this._state&F.TOUCH_DOLLY_ROTATE)===F.TOUCH_DOLLY_ROTATE||(this._state&F.TOUCH_ZOOM_ROTATE)===F.TOUCH_ZOOM_ROTATE){const w=mt.x-this._activePointers[1].clientX,E=mt.y-this._activePointers[1].clientY,S=Math.sqrt(w*w+E*E),$=r.y-S;r.set(0,S);const M=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,k=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&F.TOUCH_DOLLY)===F.TOUCH_DOLLY||(this._state&F.TOUCH_DOLLY_ROTATE)===F.TOUCH_DOLLY_ROTATE||(this._state&F.TOUCH_DOLLY_TRUCK)===F.TOUCH_DOLLY_TRUCK||(this._state&F.TOUCH_DOLLY_SCREEN_PAN)===F.TOUCH_DOLLY_SCREEN_PAN||(this._state&F.TOUCH_DOLLY_OFFSET)===F.TOUCH_DOLLY_OFFSET?(this._dollyInternal($*zr,M,k),this._isUserControllingDolly=!0):(this._zoomInternal($*zr,M,k),this._isUserControllingZoom=!0)}((this._state&F.TRUCK)===F.TRUCK||(this._state&F.TOUCH_TRUCK)===F.TOUCH_TRUCK||(this._state&F.TOUCH_DOLLY_TRUCK)===F.TOUCH_DOLLY_TRUCK||(this._state&F.TOUCH_ZOOM_TRUCK)===F.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(y,v,!1,!1),this._isUserControllingTruck=!0),((this._state&F.SCREEN_PAN)===F.SCREEN_PAN||(this._state&F.TOUCH_SCREEN_PAN)===F.TOUCH_SCREEN_PAN||(this._state&F.TOUCH_DOLLY_SCREEN_PAN)===F.TOUCH_DOLLY_SCREEN_PAN||(this._state&F.TOUCH_ZOOM_SCREEN_PAN)===F.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(y,v,!1,!0),this._isUserControllingTruck=!0),((this._state&F.OFFSET)===F.OFFSET||(this._state&F.TOUCH_OFFSET)===F.TOUCH_OFFSET||(this._state&F.TOUCH_DOLLY_OFFSET)===F.TOUCH_DOLLY_OFFSET||(this._state&F.TOUCH_ZOOM_OFFSET)===F.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(y,v,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},g=()=>{va(this._activePointers,mt),n.copy(mt),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",m),this._domElement.ownerDocument.addEventListener("pointerlockerror",b),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),p())},this.unlockPointer=()=>{var f,y,v;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(f=this._domElement)===null||f===void 0||f.ownerDocument.exitPointerLock(),(y=this._domElement)===null||y===void 0||y.ownerDocument.removeEventListener("pointerlockchange",m),(v=this._domElement)===null||v===void 0||v.ownerDocument.removeEventListener("pointerlockerror",b),this.cancel()};const m=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},b=()=>{this.unlockPointer()};this._addAllEventListeners=f=>{this._domElement=f,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",h,{passive:!1}),this._domElement.addEventListener("contextmenu",d)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",h,{passive:!1}),this._domElement.removeEventListener("contextmenu",d),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",m),this._domElement.ownerDocument.removeEventListener("pointerlockerror",b))},this.cancel=()=>{this._state!==F.NONE&&(this._state=F.NONE,this._activePointers.length=0,g())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=Ft(e.width,0,1),this._interactiveArea.height=Ft(e.height,0,1),this._interactiveArea.x=Ft(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Ft(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,i=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,i)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,i=!1){this._isUserControllingRotate=!1;const n=Ft(e,this.minAzimuthAngle,this.maxAzimuthAngle),r=Ft(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=n,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!i||we(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&we(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=xs.NONE,this._changedDolly=0,this._dollyToNoClamp(Ft(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const i=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const r=this._collisionTest(),o=we(r,this._spherical.radius);if(!(i>e)&&o)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,r)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const n=!t||we(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(n)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection($n).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const i=!t||we(this._target.x,this._targetEnd.x,this.restThreshold)&&we(this._target.y,this._targetEnd.y,this.restThreshold)&&we(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=Ft(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const i=!t||we(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(i)}pan(e,t,i=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,i)}truck(e,t,i=!1){this._camera.updateMatrix(),Kt.setFromMatrixColumn(this._camera.matrix,0),Jt.setFromMatrixColumn(this._camera.matrix,1),Kt.multiplyScalar(e),Jt.multiplyScalar(-t);const n=ge.copy(Kt).add(Jt),r=ve.copy(this._targetEnd).add(n);return this.moveTo(r.x,r.y,r.z,i)}forward(e,t=!1){ge.setFromMatrixColumn(this._camera.matrix,0),ge.crossVectors(this._camera.up,ge),ge.multiplyScalar(e);const i=ve.copy(this._targetEnd).add(ge);return this.moveTo(i.x,i.y,i.z,t)}elevate(e,t=!1){return ge.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+ge.x,this._targetEnd.y+ge.y,this._targetEnd.z+ge.z,t)}moveTo(e,t,i,n=!1){this._isUserControllingTruck=!1;const r=ge.set(e,t,i).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,n||this._target.copy(this._targetEnd);const o=!n||we(this._target.x,this._targetEnd.x,this.restThreshold)&&we(this._target.y,this._targetEnd.y,this.restThreshold)&&we(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(e,t,i,n=!1){const r=ge.set(e,t,i).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(r.x,r.y,r.z,n)}fitToBox(e,t,{cover:i=!1,paddingLeft:n=0,paddingRight:r=0,paddingBottom:o=0,paddingTop:a=0}={}){const l=[],c=e.isBox3?Ss.copy(e):Ss.setFromObject(e);c.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const h=Yc(this._sphericalEnd.theta,Wc),d=Yc(this._sphericalEnd.phi,Wc);l.push(this.rotateTo(h,d,t));const p=ge.setFromSpherical(this._sphericalEnd).normalize(),u=Jc.setFromUnitVectors(p,xa),g=we(Math.abs(p.y),1);g&&u.multiply(Ea.setFromAxisAngle(Dr,h)),u.multiply(this._yAxisUpSpaceInverse);const m=Kc.makeEmpty();ve.copy(c.min).applyQuaternion(u),m.expandByPoint(ve),ve.copy(c.min).setX(c.max.x).applyQuaternion(u),m.expandByPoint(ve),ve.copy(c.min).setY(c.max.y).applyQuaternion(u),m.expandByPoint(ve),ve.copy(c.max).setZ(c.min.z).applyQuaternion(u),m.expandByPoint(ve),ve.copy(c.min).setZ(c.max.z).applyQuaternion(u),m.expandByPoint(ve),ve.copy(c.max).setY(c.min.y).applyQuaternion(u),m.expandByPoint(ve),ve.copy(c.max).setX(c.min.x).applyQuaternion(u),m.expandByPoint(ve),ve.copy(c.max).applyQuaternion(u),m.expandByPoint(ve),m.min.x-=n,m.min.y-=o,m.max.x+=r,m.max.y+=a,u.setFromUnitVectors(xa,p),g&&u.premultiply(Ea.invert()),u.premultiply(this._yAxisUpSpace);const b=m.getSize(ge),f=m.getCenter(ve).applyQuaternion(u);if(Ji(this._camera)){const y=this.getDistanceToFitBox(b.x,b.y,b.z,i);l.push(this.moveTo(f.x,f.y,f.z,t)),l.push(this.dollyTo(y,t)),l.push(this.setFocalOffset(0,0,0,t))}else if($i(this._camera)){const y=this._camera,v=y.right-y.left,w=y.top-y.bottom,E=i?Math.max(v/b.x,w/b.y):Math.min(v/b.x,w/b.y);l.push(this.moveTo(f.x,f.y,f.z,t)),l.push(this.zoomTo(E,t)),l.push(this.setFocalOffset(0,0,0,t))}return Promise.all(l)}fitToSphere(e,t){const i=[],n="isObject3D"in e?ll.createBoundingSphere(e,Ca):Ca.copy(e);if(i.push(this.moveTo(n.center.x,n.center.y,n.center.z,t)),Ji(this._camera)){const r=this.getDistanceToFitSphere(n.radius);i.push(this.dollyTo(r,t))}else if($i(this._camera)){const r=this._camera.right-this._camera.left,o=this._camera.top-this._camera.bottom,a=2*n.radius,l=Math.min(r/a,o/a);i.push(this.zoomTo(l,t))}return i.push(this.setFocalOffset(0,0,0,t)),Promise.all(i)}setLookAt(e,t,i,n,r,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=xs.NONE,this._changedDolly=0;const l=ve.set(n,r,o),c=ge.set(e,t,i);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(c.sub(l).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const h=!a||we(this._target.x,this._targetEnd.x,this.restThreshold)&&we(this._target.y,this._targetEnd.y,this.restThreshold)&&we(this._target.z,this._targetEnd.z,this.restThreshold)&&we(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&we(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&we(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(h)}lerpLookAt(e,t,i,n,r,o,a,l,c,h,d,p,u,g=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=xs.NONE,this._changedDolly=0;const m=ge.set(n,r,o),b=ve.set(e,t,i);Pt.setFromVector3(b.sub(m).applyQuaternion(this._yAxisUpSpace));const f=Es.set(h,d,p),y=ve.set(a,l,c);Tn.setFromVector3(y.sub(f).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(m.lerp(f,u));const v=Tn.theta-Pt.theta,w=Tn.phi-Pt.phi,E=Tn.radius-Pt.radius;this._sphericalEnd.set(Pt.radius+E*u,Pt.phi+w*u,Pt.theta+v*u),this.normalizeRotations(),this._needsUpdate=!0,g||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const S=!g||we(this._target.x,this._targetEnd.x,this.restThreshold)&&we(this._target.y,this._targetEnd.y,this.restThreshold)&&we(this._target.z,this._targetEnd.z,this.restThreshold)&&we(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&we(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&we(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(S)}setPosition(e,t,i,n=!1){return this.setLookAt(e,t,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,n)}setTarget(e,t,i,n=!1){const r=this.getPosition(ge),o=this.setLookAt(r.x,r.y,r.z,e,t,i,n);return this._sphericalEnd.phi=Ft(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(e,t,i,n=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,i),this._needsUpdate=!0,n||this._focalOffset.copy(this._focalOffsetEnd);const r=!n||we(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&we(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&we(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(e,t,i){this._camera.updateMatrixWorld(),Kt.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Jt.setFromMatrixColumn(this._camera.matrixWorldInverse,1),es.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const n=ge.set(e,t,i),r=n.distanceTo(this._camera.position),o=n.sub(this._camera.position);Kt.multiplyScalar(o.x),Jt.multiplyScalar(o.y),es.multiplyScalar(o.z),ge.copy(Kt).add(Jt).add(es),ge.z=ge.z+r,this.dollyTo(r,!1),this.setFocalOffset(-ge.x,ge.y,-ge.z,!1),this.moveTo(e,t,i,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,i,n){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new ue.Vector4,typeof e=="number"?this._viewport.set(e,t,i,n):this._viewport.copy(e)}getDistanceToFitBox(e,t,i,n=!1){if(_a(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const r=e/t,o=this._camera.getEffectiveFOV()*En,a=this._camera.aspect;return((n?r>a:r<a)?t:e/a)*.5/Math.tan(o*.5)+i*.5}getDistanceToFitSphere(e){if(_a(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*En,i=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,n=1<this._camera.aspect?t:i;return e/Math.sin(n*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new ue.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new ue.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e||new ue.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new ue.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Cs,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Cs),this._spherical.theta+=Cs*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Cs)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!we(this._camera.up.x,this._cameraUp0.x)||!we(this._camera.up.y,this._cameraUp0.y)||!we(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const i=this.getPosition(ge);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Dr),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=ge.subVectors(this._target,this._camera.position).normalize(),t=ve.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const i=this.getPosition(ge);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,i=this._sphericalEnd.phi-this._spherical.phi,n=this._sphericalEnd.radius-this._spherical.radius,r=Xc.subVectors(this._targetEnd,this._target),o=Qc.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(Me(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Ir(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,h,1/0,e),this._needsUpdate=!0}if(Me(i))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Ir(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,h,1/0,e),this._needsUpdate=!0}if(Me(n))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const h=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Ir(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,h,this.maxSpeed,e),this._needsUpdate=!0}if(Me(r.x)&&Me(r.y)&&Me(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const h=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;Zc(this._target,this._targetEnd,this._targetVelocity,h,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(Me(o.x)&&Me(o.y)&&Me(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const h=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;Zc(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,h,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(Me(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const h=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Ir(this._zoom,this._zoomEnd,this._zoomVelocity,h,1/0,e)}if(this.dollyToCursor){if(Ji(this._camera)&&this._changedDolly!==0){const h=this._spherical.radius-this._lastDistance,d=this._camera,p=this._getCameraDirection($n),u=ge.copy(p).cross(d.up).normalize();u.lengthSq()===0&&(u.x=1);const g=ve.crossVectors(u,p),m=this._sphericalEnd.radius*Math.tan(d.getEffectiveFOV()*En*.5),b=(this._sphericalEnd.radius-h-this._sphericalEnd.radius)/this._sphericalEnd.radius,f=Es.copy(this._targetEnd).add(u.multiplyScalar(this._dollyControlCoord.x*m*d.aspect)).add(g.multiplyScalar(this._dollyControlCoord.y*m)),y=ge.copy(this._targetEnd).lerp(f,b),v=this._lastDollyDirection===xs.IN&&this._spherical.radius<=this.minDistance,w=this._lastDollyDirection===xs.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(v||w)){this._sphericalEnd.radius-=h,this._spherical.radius-=h;const S=ve.copy(p).multiplyScalar(-h);y.add(S)}this._boundary.clampPoint(y,y);const E=ve.subVectors(y,this._targetEnd);this._targetEnd.copy(y),this._target.add(E),this._changedDolly-=h,Me(this._changedDolly)&&(this._changedDolly=0)}else if($i(this._camera)&&this._changedZoom!==0){const h=this._zoom-this._lastZoom,d=this._camera,p=ge.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(d.near+d.far)/(d.near-d.far)).unproject(d),u=ve.set(0,0,-1).applyQuaternion(d.quaternion),g=Es.copy(p).add(u.multiplyScalar(-p.dot(d.up))),m=-(this._zoom-h-this._zoom)/this._zoom,b=this._getCameraDirection($n),f=this._targetEnd.dot(b),y=ge.copy(this._targetEnd).lerp(g,m),v=y.dot(b),w=b.multiplyScalar(v-f);y.sub(w),this._boundary.clampPoint(y,y);const E=ve.subVectors(y,this._targetEnd);this._targetEnd.copy(y),this._target.add(E),this._changedZoom-=h,Me(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!Me(this._focalOffset.x)||!Me(this._focalOffset.y)||!Me(this._focalOffset.z))&&(Kt.setFromMatrixColumn(this._camera.matrix,0),Jt.setFromMatrixColumn(this._camera.matrix,1),es.setFromMatrixColumn(this._camera.matrix,2),Kt.multiplyScalar(this._focalOffset.x),Jt.multiplyScalar(-this._focalOffset.y),es.multiplyScalar(this._focalOffset.z),ge.copy(Kt).add(Jt).add(es),this._camera.position.add(ge),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),ge.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const c=this._needsUpdate;return c&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):c?(this.dispatchEvent({type:"update"}),Me(t,this.restThreshold)&&Me(i,this.restThreshold)&&Me(n,this.restThreshold)&&Me(r.x,this.restThreshold)&&Me(r.y,this.restThreshold)&&Me(r.z,this.restThreshold)&&Me(o.x,this.restThreshold)&&Me(o.y,this.restThreshold)&&Me(o.z,this.restThreshold)&&Me(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!c&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=c,this._needsUpdate=!1,c}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Sn(this.maxDistance),minZoom:this.minZoom,maxZoom:Sn(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Sn(this.maxPolarAngle),minAzimuthAngle:Sn(this.minAzimuthAngle),maxAzimuthAngle:Sn(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:ge.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const i=JSON.parse(e);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=An(i.maxDistance),this.minZoom=i.minZoom,this.maxZoom=An(i.maxZoom),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=An(i.maxPolarAngle),this.minAzimuthAngle=An(i.minAzimuthAngle),this.maxAzimuthAngle=An(i.maxAzimuthAngle),this.smoothTime=i.smoothTime,this.draggingSmoothTime=i.draggingSmoothTime,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._zoom0=i.zoom0,this._focalOffset0.fromArray(i.focalOffset0),this.moveTo(i.target[0],i.target[1],i.target[2],t),Pt.setFromVector3(ge.fromArray(i.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Pt.theta,Pt.phi,t),this.dollyTo(Pt.radius,t),this.zoomTo(i.zoom,t),this.setFocalOffset(i.focalOffset[0],i.focalOffset[1],i.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",Xb),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,i){const n=t.lengthSq();if(n===0)return e;const r=ve.copy(t).add(e),o=this._boundary.clampPoint(r,Es).sub(r),a=o.lengthSq();if(a===0)return e.add(t);if(a===n)return e;if(i===0)return e.add(t).add(o);{const l=1+i*a/t.dot(o);return e.add(ve.copy(t).multiplyScalar(l)).add(o.multiplyScalar(1-i))}}_updateNearPlaneCorners(){if(Ji(this._camera)){const e=this._camera,t=e.near,i=e.getEffectiveFOV()*En,n=Math.tan(i*.5)*t,r=n*e.aspect;this._nearPlaneCorners[0].set(-r,-n,0),this._nearPlaneCorners[1].set(r,-n,0),this._nearPlaneCorners[2].set(r,n,0),this._nearPlaneCorners[3].set(-r,n,0)}else if($i(this._camera)){const e=this._camera,t=1/e.zoom,i=e.left*t,n=e.right*t,r=e.top*t,o=e.bottom*t;this._nearPlaneCorners[0].set(i,r,0),this._nearPlaneCorners[1].set(n,r,0),this._nearPlaneCorners[2].set(n,o,0),this._nearPlaneCorners[3].set(i,o,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||_a(this._camera,"_collisionTest"))return e;const t=this._getTargetDirection($n);Sa.lookAt(Gc,t,this._camera.up);for(let i=0;i<4;i++){const n=ve.copy(this._nearPlaneCorners[i]);n.applyMatrix4(Sa);const r=Es.addVectors(this._target,n);Lr.set(r,t),Lr.far=this._spherical.radius+1;const o=Lr.intersectObjects(this.colliderMeshes);o.length!==0&&o[0].distance<e&&(e=o[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const i=()=>{this.removeEventListener("rest",i),t()};this.addEventListener("rest",i)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new ue.Sphere){const i=t,n=i.center;Ss.makeEmpty(),e.traverseVisible(o=>{o.isMesh&&Ss.expandByObject(o)}),Ss.getCenter(n);let r=0;return e.traverseVisible(o=>{if(!o.isMesh)return;const a=o;if(!a.geometry)return;const l=a.geometry.clone();l.applyMatrix4(a.matrixWorld);const c=l.attributes.position;for(let h=0,d=c.count;h<d;h++)ge.fromBufferAttribute(c,h),r=Math.max(r,n.distanceToSquared(ge))}),i.radius=Math.sqrt(r),i}},cl=class Mu extends wg{constructor(e){super(e),C(this,"onBeforeUpdate",new J),C(this,"onAfterUpdate",new J),C(this,"onAspectUpdated",new J),C(this,"onDisposed",new J),C(this,"three"),C(this,"_allControls",new Map),C(this,"updateAspect",()=>{var t;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof Vo){this.onAspectUpdated.trigger();return}if((t=this.currentWorld.renderer)!=null&&t.isResizeable()){const i=this.currentWorld.renderer.getSize();this.three.aspect=i.width/i.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.worlds.onItemSet.add(({value:t})=>{const i=this.newCameraControls();this._allControls.set(t.uuid,i)}),this.worlds.onBeforeDelete.add(({value:t})=>{const i=this._allControls.get(t.uuid);i&&(i.dispose(),this._allControls.delete(t.uuid))})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const e=this._allControls.get(this.currentWorld.uuid);if(!e)throw new Error("Controls not found!");return e}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(e){this.currentWorld!==null&&(this.controls.enabled=e)}set currentWorld(e){super.currentWorld=e,e&&(this.worlds.get(e.uuid)||this.worlds.set(e.uuid,e))}get currentWorld(){return this._currentWorld}dispose(){this.setupEvents(!1),this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[e,t]of this._allControls)t.dispose();this.worlds.clear()}async fitToItems(e){const t=await this.getItemsBounding(e);await this.controls.fitToSphere(t,!0)}async setOrbitToItems(e){const t=await this.getItemsBounding(e);this.controls.setOrbitPoint(t.center.x,t.center.y,t.center.z)}update(e){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(e),this.onAfterUpdate.trigger(this))}async getItemsBounding(e){const t=this.components.get(he),i=this.components.get(xo);i.list.clear();const n=new Ri;if(e)await i.addFromModelIdMap(e);else for(const[,r]of t.list)i.list.add(r.box);return i.get().getBoundingSphere(n),i.list.clear(),n}setupCamera(){const e=window.innerWidth/window.innerHeight,t=new Jd(60,e,1,1e3);return t.position.set(50,50,50),t.lookAt(new D(0,0,0)),t}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");wt.install({THREE:Mu.getSubsetOfThree()});const{domElement:e}=this.currentWorld.renderer.three,t=new wt(this.three,e);return t.smoothTime=.2,t.dollyToCursor=!0,t.infinityDolly=!0,t.minDistance=6,t}setupEvents(e){e?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:Km,Vector2:Ne,Vector3:D,Vector4:rn,Quaternion:Vt,Matrix4:xe,Spherical:Qm,Box3:Ve,Sphere:Ri,Raycaster:Zl,MathUtils:eu}}};const Iu=class zu extends Ae{constructor(e){super(e),C(this,"onAfterUpdate",new J),C(this,"onBeforeUpdate",new J),C(this,"onDisposed",new J),C(this,"list",new Se),C(this,"enabled",!0),e.add(zu.uuid,this)}create(){const e=new Yb(this.components),t=e.uuid;if(this.list.has(t))throw new Error("There is already a world with this name!");return this.list.set(t,e),e}delete(e){if(!this.list.has(e.uuid))throw new Error("The provided world is not found in the list!");this.list.delete(e.uuid),e.dispose()}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(e){if(this.enabled)for(const[t,i]of this.list)i.update(e)}};C(Iu,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let Du=Iu;class Kb extends Qo{constructor(){super(...arguments),C(this,"_config",{visible:{value:!0,type:"Boolean"},color:{value:new be,type:"Color"},primarySize:{type:"Number",interpolable:!0,value:1,min:0,max:1e3},secondarySize:{type:"Number",interpolable:!0,value:10,min:0,max:1e3},distance:{type:"Number",interpolable:!0,value:500,min:0,max:500}})}get visible(){return this._config.visible.value}set visible(e){this._config.visible.value=e,this._component.visible=e}get color(){return this._config.color.value}set color(e){this._config.color.value=e,this._component.material.uniforms.uColor.value=e,this._component.material.uniformsNeedUpdate=!0}get primarySize(){return this._config.primarySize.value}set primarySize(e){this._config.primarySize.value=e,this._component.material.uniforms.uSize1.value=e,this._component.material.uniformsNeedUpdate=!0}get secondarySize(){return this._config.secondarySize.value}set secondarySize(e){this._config.secondarySize.value=e,this._component.material.uniforms.uSize2.value=e,this._component.material.uniformsNeedUpdate=!0}get distance(){return this._config.distance.value}set distance(e){this._config.distance.value=e,this._component.material.uniforms.uDistance.value=e,this._component.material.uniformsNeedUpdate=!0}}class Jb{constructor(e,t){C(this,"onDisposed",new J),C(this,"onSetup",new J),C(this,"isSetup",!1),C(this,"world"),C(this,"components"),C(this,"config"),C(this,"_defaultConfig",{visible:!0,color:new be(12303291),primarySize:1,secondarySize:10,distance:500}),C(this,"three"),C(this,"_fade",3),C(this,"updateZoom",()=>{this.world.camera instanceof cl&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=t;const{color:i,primarySize:n,secondarySize:r,distance:o}=this._defaultConfig;this.components=e,this.config=new Kb(this,this.components,"Grid");const a=new Xl(2,2,1,1),l=new Kd({side:Ui,uniforms:{uSize1:{value:n},uSize2:{value:r},uColor:{value:i},uDistance:{value:o},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new re(a,l),this.three.frustumCulled=!1,t.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(e){this.three.visible=e,e?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(e){this._fade=e?3:0,this.material.uniforms.uFade.value=this._fade}setup(e){const t={...this._defaultConfig,...e};this.config.visible=!0,this.config.color=t.color,this.config.primarySize=t.primarySize,this.config.secondarySize=t.secondarySize,this.config.distance=t.distance,this.isSetup=!0,this.onSetup.trigger()}dispose(){this.setupEvents(!1),this.components.get(sc).list.delete(this.config.uuid),this.components.get(oi).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(e){if(this.world.isDisposing||!(this.world.camera instanceof cl))return;const t=this.world.camera.controls;e?t.addEventListener("update",this.updateZoom):t.removeEventListener("update",this.updateZoom)}}const ey=class Lu extends Ae{constructor(e){super(e),C(this,"list",new Map),C(this,"onDisposed",new J),C(this,"enabled",!0),e.add(Lu.uuid,this)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a grid!");const t=new Jb(this.components,e);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}};C(ey,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");const Bu=0,ty=1,iy=2,eh=2,Aa=1.25,th=1,po=6*4+4+4,Ko=65535,sy=Math.pow(2,-24),$a=Symbol("SKIP_GENERATION");function ny(s){return s.index?s.index.count:s.attributes.position.count}function an(s){return ny(s)/3}function ry(s,e=ArrayBuffer){return s>65535?new Uint32Array(new e(4*s)):new Uint16Array(new e(2*s))}function oy(s,e){if(!s.index){const t=s.attributes.position.count,i=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=ry(t,i);s.setIndex(new Et(n,1));for(let r=0;r<t;r++)n[r]=r}}function Nu(s){const e=an(s),t=s.drawRange,i=t.start/3,n=(t.start+t.count)/3,r=Math.max(0,i),o=Math.min(e,n)-r;return[{offset:Math.floor(r),count:Math.floor(o)}]}function Ru(s){if(!s.groups||!s.groups.length)return Nu(s);const e=[],t=new Set,i=s.drawRange,n=i.start/3,r=(i.start+i.count)/3;for(const a of s.groups){const l=a.start/3,c=(a.start+a.count)/3;t.add(Math.max(n,l)),t.add(Math.min(r,c))}const o=Array.from(t.values()).sort((a,l)=>a-l);for(let a=0;a<o.length-1;a++){const l=o[a],c=o[a+1];e.push({offset:Math.floor(l),count:Math.floor(c-l)})}return e}function ay(s){if(s.groups.length===0)return!1;const e=an(s),t=Ru(s).sort((r,o)=>r.offset-o.offset),i=t[t.length-1];i.count=Math.min(e-i.offset,i.count);let n=0;return t.forEach(({count:r})=>n+=r),e!==n}function Be(s,e,t){return t.min.x=e[s],t.min.y=e[s+1],t.min.z=e[s+2],t.max.x=e[s+3],t.max.y=e[s+4],t.max.z=e[s+5],t}function ly(s){s[0]=s[1]=s[2]=1/0,s[3]=s[4]=s[5]=-1/0}function ih(s){let e=-1,t=-1/0;for(let i=0;i<3;i++){const n=s[i+3]-s[i];n>t&&(t=n,e=i)}return e}function sh(s,e){e.set(s)}function nh(s,e,t){let i,n;for(let r=0;r<3;r++){const o=r+3;i=s[r],n=e[r],t[r]=i<n?i:n,i=s[o],n=e[o],t[o]=i>n?i:n}}function Br(s,e,t){for(let i=0;i<3;i++){const n=e[s+2*i],r=e[s+2*i+1],o=n-r,a=n+r;o<t[i]&&(t[i]=o),a>t[i+3]&&(t[i+3]=a)}}function kn(s){const e=s[3]-s[0],t=s[4]-s[1],i=s[5]-s[2];return 2*(e*t+t*i+i*e)}function Ta(s,e,t,i,n=null){let r=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,h=-1/0,d=1/0,p=1/0,u=1/0,g=-1/0,m=-1/0,b=-1/0;const f=n!==null;for(let y=e*6,v=(e+t)*6;y<v;y+=6){const w=s[y+0],E=s[y+1],S=w-E,$=w+E;S<r&&(r=S),$>l&&(l=$),f&&w<d&&(d=w),f&&w>g&&(g=w);const M=s[y+2],k=s[y+3],z=M-k,j=M+k;z<o&&(o=z),j>c&&(c=j),f&&M<p&&(p=M),f&&M>m&&(m=M);const A=s[y+4],P=s[y+5],_=A-P,L=A+P;_<a&&(a=_),L>h&&(h=L),f&&A<u&&(u=A),f&&A>b&&(b=A)}i[0]=r,i[1]=o,i[2]=a,i[3]=l,i[4]=c,i[5]=h,f&&(n[0]=d,n[1]=p,n[2]=u,n[3]=g,n[4]=m,n[5]=b)}function cy(s,e,t,i){let n=1/0,r=1/0,o=1/0,a=-1/0,l=-1/0,c=-1/0;for(let h=e*6,d=(e+t)*6;h<d;h+=6){const p=s[h+0];p<n&&(n=p),p>a&&(a=p);const u=s[h+2];u<r&&(r=u),u>l&&(l=u);const g=s[h+4];g<o&&(o=g),g>c&&(c=g)}i[0]=n,i[1]=r,i[2]=o,i[3]=a,i[4]=l,i[5]=c}function hy(s,e){ly(e);const t=s.attributes.position,i=s.index?s.index.array:null,n=an(s),r=new Float32Array(n*6),o=t.normalized,a=t.array,l=t.offset||0;let c=3;t.isInterleavedBufferAttribute&&(c=t.data.stride);const h=["getX","getY","getZ"];for(let d=0;d<n;d++){const p=d*3,u=d*6;let g=p+0,m=p+1,b=p+2;i&&(g=i[g],m=i[m],b=i[b]),o||(g=g*c+l,m=m*c+l,b=b*c+l);for(let f=0;f<3;f++){let y,v,w;o?(y=t[h[f]](g),v=t[h[f]](m),w=t[h[f]](b)):(y=a[g+f],v=a[m+f],w=a[b+f]);let E=y;v<E&&(E=v),w<E&&(E=w);let S=y;v>S&&(S=v),w>S&&(S=w);const $=(S-E)/2,M=f*2;r[u+M+0]=E+$,r[u+M+1]=$+(Math.abs(E)+$)*sy,E<e[f]&&(e[f]=E),S>e[f+3]&&(e[f+3]=S)}}return r}const di=32,dy=(s,e)=>s.candidate-e.candidate,Si=new Array(di).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Nr=new Float32Array(6);function uy(s,e,t,i,n,r){let o=-1,a=0;if(r===Bu)o=ih(e),o!==-1&&(a=(e[o]+e[o+3])/2);else if(r===ty)o=ih(s),o!==-1&&(a=py(t,i,n,o));else if(r===iy){const l=kn(s);let c=Aa*n;const h=i*6,d=(i+n)*6;for(let p=0;p<3;p++){const u=e[p],g=(e[p+3]-u)/di;if(n<di/4){const m=[...Si];m.length=n;let b=0;for(let y=h;y<d;y+=6,b++){const v=m[b];v.candidate=t[y+2*p],v.count=0;const{bounds:w,leftCacheBounds:E,rightCacheBounds:S}=v;for(let $=0;$<3;$++)S[$]=1/0,S[$+3]=-1/0,E[$]=1/0,E[$+3]=-1/0,w[$]=1/0,w[$+3]=-1/0;Br(y,t,w)}m.sort(dy);let f=n;for(let y=0;y<f;y++){const v=m[y];for(;y+1<f&&m[y+1].candidate===v.candidate;)m.splice(y+1,1),f--}for(let y=h;y<d;y+=6){const v=t[y+2*p];for(let w=0;w<f;w++){const E=m[w];v>=E.candidate?Br(y,t,E.rightCacheBounds):(Br(y,t,E.leftCacheBounds),E.count++)}}for(let y=0;y<f;y++){const v=m[y],w=v.count,E=n-v.count,S=v.leftCacheBounds,$=v.rightCacheBounds;let M=0;w!==0&&(M=kn(S)/l);let k=0;E!==0&&(k=kn($)/l);const z=th+Aa*(M*w+k*E);z<c&&(o=p,c=z,a=v.candidate)}}else{for(let f=0;f<di;f++){const y=Si[f];y.count=0,y.candidate=u+g+f*g;const v=y.bounds;for(let w=0;w<3;w++)v[w]=1/0,v[w+3]=-1/0}for(let f=h;f<d;f+=6){let y=~~((t[f+2*p]-u)/g);y>=di&&(y=di-1);const v=Si[y];v.count++,Br(f,t,v.bounds)}const m=Si[di-1];sh(m.bounds,m.rightCacheBounds);for(let f=di-2;f>=0;f--){const y=Si[f],v=Si[f+1];nh(y.bounds,v.rightCacheBounds,y.rightCacheBounds)}let b=0;for(let f=0;f<di-1;f++){const y=Si[f],v=y.count,w=y.bounds,E=Si[f+1].rightCacheBounds;v!==0&&(b===0?sh(w,Nr):nh(w,Nr,Nr)),b+=v;let S=0,$=0;b!==0&&(S=kn(Nr)/l);const M=n-b;M!==0&&($=kn(E)/l);const k=th+Aa*(S*b+$*M);k<c&&(o=p,c=k,a=y.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:o,pos:a}}function py(s,e,t,i){let n=0;for(let r=e,o=e+t;r<o;r++)n+=s[r*6+i*2];return n/t}class Rr{constructor(){}}function fy(s,e,t,i,n,r){let o=i,a=i+n-1;const l=r.pos,c=r.axis*2;for(;;){for(;o<=a&&t[o*6+c]<l;)o++;for(;o<=a&&t[a*6+c]>=l;)a--;if(o<a){for(let h=0;h<3;h++){let d=e[o*3+h];e[o*3+h]=e[a*3+h],e[a*3+h]=d}for(let h=0;h<6;h++){let d=t[o*6+h];t[o*6+h]=t[a*6+h],t[a*6+h]=d}o++,a--}else return o}}function my(s,e,t,i,n,r){let o=i,a=i+n-1;const l=r.pos,c=r.axis*2;for(;;){for(;o<=a&&t[o*6+c]<l;)o++;for(;o<=a&&t[a*6+c]>=l;)a--;if(o<a){let h=s[o];s[o]=s[a],s[a]=h;for(let d=0;d<6;d++){let p=t[o*6+d];t[o*6+d]=t[a*6+d],t[a*6+d]=p}o++,a--}else return o}}function gy(s,e){const t=(s.index?s.index.count:s.attributes.position.count)/3,i=t>2**16,n=i?4:2,r=e?new SharedArrayBuffer(t*n):new ArrayBuffer(t*n),o=i?new Uint32Array(r):new Uint16Array(r);for(let a=0,l=o.length;a<l;a++)o[a]=a;return o}function by(s,e){const t=s.geometry,i=t.index?t.index.array:null,n=e.maxDepth,r=e.verbose,o=e.maxLeafTris,a=e.strategy,l=e.onProgress,c=an(t),h=s._indirectBuffer;let d=!1;const p=new Float32Array(6),u=new Float32Array(6),g=hy(t,p),m=e.indirect?my:fy,b=[],f=e.indirect?Nu(t):Ru(t);if(f.length===1){const w=f[0],E=new Rr;E.boundingData=p,cy(g,w.offset,w.count,u),v(E,w.offset,w.count,u),b.push(E)}else for(let w of f){const E=new Rr;E.boundingData=new Float32Array(6),Ta(g,w.offset,w.count,E.boundingData,u),v(E,w.offset,w.count,u),b.push(E)}return b;function y(w){l&&l(w/c)}function v(w,E,S,$=null,M=0){if(!d&&M>=n&&(d=!0,r&&(console.warn(`MeshBVH: Max depth of ${n} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),S<=o||M>=n)return y(E+S),w.offset=E,w.count=S,w;const k=uy(w.boundingData,$,g,E,S,a);if(k.axis===-1)return y(E+S),w.offset=E,w.count=S,w;const z=m(h,i,g,E,S,k);if(z===E||z===E+S)y(E+S),w.offset=E,w.count=S;else{w.splitAxis=k.axis;const j=new Rr,A=E,P=z-E;w.left=j,j.boundingData=new Float32Array(6),Ta(g,A,P,j.boundingData,u),v(j,A,P,u,M+1);const _=new Rr,L=z,G=S-P;w.right=_,_.boundingData=new Float32Array(6),Ta(g,L,G,_.boundingData,u),v(_,L,G,u,M+1)}return w}}function yy(s,e){const t=s.geometry;e.indirect&&(s._indirectBuffer=gy(t,e.useSharedArrayBuffer),ay(t)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),s._indirectBuffer||oy(t,e);const i=by(s,e);let n,r,o;const a=[],l=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let d=0;d<i.length;d++){const p=i[d];let u=c(p);const g=new l(po*u);n=new Float32Array(g),r=new Uint32Array(g),o=new Uint16Array(g),h(0,p),a.push(g)}s._roots=a;return;function c(d){return d.count?1:1+c(d.left)+c(d.right)}function h(d,p){const u=d/4,g=d/2,m=!!p.count,b=p.boundingData;for(let f=0;f<6;f++)n[u+f]=b[f];if(m){const f=p.offset,y=p.count;return r[u+6]=f,o[g+14]=y,o[g+15]=Ko,d+po}else{const f=p.left,y=p.right,v=p.splitAxis;let w;if(w=h(d+po,f),w/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[u+6]=w/4,w=h(w,y),r[u+7]=v,w}}}let bi=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,n=-1/0;for(let r=0,o=e.length;r<o;r++){const a=e[r][t];i=a<i?a:i,n=a>n?a:n}this.min=i,this.max=n}setFromPoints(e,t){let i=1/0,n=-1/0;for(let r=0,o=t.length;r<o;r++){const a=t[r],l=e.dot(a);i=l<i?l:i,n=l>n?l:n}this.min=i,this.max=n}isSeparated(e){return this.min>e.max||e.min>this.max}};bi.prototype.setFromBox=function(){const s=new D;return function(e,t){const i=t.min,n=t.max;let r=1/0,o=-1/0;for(let a=0;a<=1;a++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){s.x=i.x*a+n.x*(1-a),s.y=i.y*l+n.y*(1-l),s.z=i.z*c+n.z*(1-c);const h=e.dot(s);r=Math.min(h,r),o=Math.max(h,o)}this.min=r,this.max=o}}();const vy=function(){const s=new D,e=new D,t=new D;return function(i,n,r){const o=i.start,a=s,l=n.start,c=e;t.subVectors(o,l),s.subVectors(i.end,i.start),e.subVectors(n.end,n.start);const h=t.dot(c),d=c.dot(a),p=c.dot(c),u=t.dot(a),g=a.dot(a)*p-d*d;let m,b;g!==0?m=(h*d-u*p)/g:m=0,b=(h+m*d)/p,r.x=m,r.y=b}}(),nc=function(){const s=new Ne,e=new D,t=new D;return function(i,n,r,o){vy(i,n,s);let a=s.x,l=s.y;if(a>=0&&a<=1&&l>=0&&l<=1){i.at(a,r),n.at(l,o);return}else if(a>=0&&a<=1){l<0?n.at(0,o):n.at(1,o),i.closestPointToPoint(o,!0,r);return}else if(l>=0&&l<=1){a<0?i.at(0,r):i.at(1,r),n.closestPointToPoint(r,!0,o);return}else{let c;a<0?c=i.start:c=i.end;let h;l<0?h=n.start:h=n.end;const d=e,p=t;if(i.closestPointToPoint(h,!0,e),n.closestPointToPoint(c,!0,t),d.distanceToSquared(h)<=p.distanceToSquared(c)){r.copy(d),o.copy(h);return}else{r.copy(c),o.copy(p);return}}}}(),_y=function(){const s=new D,e=new D,t=new Ot,i=new St;return function(n,r){const{radius:o,center:a}=n,{a:l,b:c,c:h}=r;if(i.start=l,i.end=c,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o||(i.start=l,i.end=h,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o)||(i.start=c,i.end=h,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o))return!0;const d=r.getPlane(t);if(Math.abs(d.distanceToPoint(a))<=o){const p=d.projectPoint(a,e);if(r.containsPoint(p))return!0}return!1}}(),wy=1e-15;function ka(s){return Math.abs(s)<wy}let Wt=class extends Un{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new D),this.satBounds=new Array(4).fill().map(()=>new bi),this.points=[this.a,this.b,this.c],this.sphere=new Ri,this.plane=new Ot,this.needsUpdate=!0}intersectsSphere(e){return _y(e,this)}update(){const e=this.a,t=this.b,i=this.c,n=this.points,r=this.satAxes,o=this.satBounds,a=r[0],l=o[0];this.getNormal(a),l.setFromPoints(a,n);const c=r[1],h=o[1];c.subVectors(e,t),h.setFromPoints(c,n);const d=r[2],p=o[2];d.subVectors(t,i),p.setFromPoints(d,n);const u=r[3],g=o[3];u.subVectors(i,e),g.setFromPoints(u,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}};Wt.prototype.closestPointToSegment=function(){const s=new D,e=new D,t=new St;return function(i,n=null,r=null){const{start:o,end:a}=i,l=this.points;let c,h=1/0;for(let d=0;d<3;d++){const p=(d+1)%3;t.start.copy(l[d]),t.end.copy(l[p]),nc(t,i,s,e),c=s.distanceToSquared(e),c<h&&(h=c,n&&n.copy(s),r&&r.copy(e))}return this.closestPointToPoint(o,s),c=o.distanceToSquared(s),c<h&&(h=c,n&&n.copy(s),r&&r.copy(o)),this.closestPointToPoint(a,s),c=a.distanceToSquared(s),c<h&&(h=c,n&&n.copy(s),r&&r.copy(a)),Math.sqrt(h)}}();Wt.prototype.intersectsTriangle=function(){const s=new Wt,e=new Array(3),t=new Array(3),i=new bi,n=new bi,r=new D,o=new D,a=new D,l=new D,c=new D,h=new St,d=new St,p=new St,u=new D;function g(m,b,f){const y=m.points;let v=0,w=-1;for(let E=0;E<3;E++){const{start:S,end:$}=h;S.copy(y[E]),$.copy(y[(E+1)%3]),h.delta(o);const M=ka(b.distanceToPoint(S));if(ka(b.normal.dot(o))&&M){f.copy(h),v=2;break}const k=b.intersectLine(h,u);if(!k&&M&&u.copy(S),(k||M)&&!ka(u.distanceTo($))){if(v<=1)(v===1?f.start:f.end).copy(u),M&&(w=v);else if(v>=2){(w===1?f.start:f.end).copy(u),v=2;break}if(v++,v===2&&w===-1)break}}return v}return function(m,b=null,f=!1){this.needsUpdate&&this.update(),m.isExtendedTriangle?m.needsUpdate&&m.update():(s.copy(m),s.update(),m=s);const y=this.plane,v=m.plane;if(Math.abs(y.normal.dot(v.normal))>1-1e-10){const w=this.satBounds,E=this.satAxes;t[0]=m.a,t[1]=m.b,t[2]=m.c;for(let M=0;M<4;M++){const k=w[M],z=E[M];if(i.setFromPoints(z,t),k.isSeparated(i))return!1}const S=m.satBounds,$=m.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let M=0;M<4;M++){const k=S[M],z=$[M];if(i.setFromPoints(z,e),k.isSeparated(i))return!1}for(let M=0;M<4;M++){const k=E[M];for(let z=0;z<4;z++){const j=$[z];if(r.crossVectors(k,j),i.setFromPoints(r,e),n.setFromPoints(r,t),i.isSeparated(n))return!1}}return b&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),b.start.set(0,0,0),b.end.set(0,0,0)),!0}else{const w=g(this,v,d);if(w===1&&m.containsPoint(d.end))return b&&(b.start.copy(d.end),b.end.copy(d.end)),!0;if(w!==2)return!1;const E=g(m,y,p);if(E===1&&this.containsPoint(p.end))return b&&(b.start.copy(p.end),b.end.copy(p.end)),!0;if(E!==2)return!1;if(d.delta(a),p.delta(l),a.dot(l)<0){let A=p.start;p.start=p.end,p.end=A}const S=d.start.dot(a),$=d.end.dot(a),M=p.start.dot(a),k=p.end.dot(a),z=$<M,j=S<k;return S!==k&&M!==$&&z===j?!1:(b&&(c.subVectors(d.start,p.start),c.dot(a)>0?b.start.copy(d.start):b.start.copy(p.start),c.subVectors(d.end,p.end),c.dot(a)<0?b.end.copy(d.end):b.end.copy(p.end)),!0)}}}();Wt.prototype.distanceToPoint=function(){const s=new D;return function(e){return this.closestPointToPoint(e,s),e.distanceTo(s)}}();Wt.prototype.distanceToTriangle=function(){const s=new D,e=new D,t=["a","b","c"],i=new St,n=new St;return function(r,o=null,a=null){const l=o||a?i:null;if(this.intersectsTriangle(r,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let c=1/0;for(let h=0;h<3;h++){let d;const p=t[h],u=r[p];this.closestPointToPoint(u,s),d=u.distanceToSquared(s),d<c&&(c=d,o&&o.copy(s),a&&a.copy(u));const g=this[p];r.closestPointToPoint(g,s),d=g.distanceToSquared(s),d<c&&(c=d,o&&o.copy(g),a&&a.copy(s))}for(let h=0;h<3;h++){const d=t[h],p=t[(h+1)%3];i.set(this[d],this[p]);for(let u=0;u<3;u++){const g=t[u],m=t[(u+1)%3];n.set(r[g],r[m]),nc(i,n,s,e);const b=s.distanceToSquared(e);b<c&&(c=b,o&&o.copy(s),a&&a.copy(e))}}return Math.sqrt(c)}}();let ft=class{constructor(e,t,i){this.isOrientedBox=!0,this.min=new D,this.max=new D,this.matrix=new xe,this.invMatrix=new xe,this.points=new Array(8).fill().map(()=>new D),this.satAxes=new Array(3).fill().map(()=>new D),this.satBounds=new Array(3).fill().map(()=>new bi),this.alignedSatBounds=new Array(3).fill().map(()=>new bi),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};ft.prototype.update=function(){return function(){const s=this.matrix,e=this.min,t=this.max,i=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){const d=1*l|2*c|4*h,p=i[d];p.x=l?t.x:e.x,p.y=c?t.y:e.y,p.z=h?t.z:e.z,p.applyMatrix4(s)}const n=this.satBounds,r=this.satAxes,o=i[0];for(let l=0;l<3;l++){const c=r[l],h=n[l],d=1<<l,p=i[d];c.subVectors(o,p),h.setFromPoints(c,i)}const a=this.alignedSatBounds;a[0].setFromPointsField(i,"x"),a[1].setFromPointsField(i,"y"),a[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();ft.prototype.intersectsBox=function(){const s=new bi;return function(e){this.needsUpdate&&this.update();const t=e.min,i=e.max,n=this.satBounds,r=this.satAxes,o=this.alignedSatBounds;if(s.min=t.x,s.max=i.x,o[0].isSeparated(s)||(s.min=t.y,s.max=i.y,o[1].isSeparated(s))||(s.min=t.z,s.max=i.z,o[2].isSeparated(s)))return!1;for(let a=0;a<3;a++){const l=r[a],c=n[a];if(s.setFromBox(l,e),c.isSeparated(s))return!1}return!0}}();ft.prototype.intersectsTriangle=function(){const s=new Wt,e=new Array(3),t=new bi,i=new bi,n=new D;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(s.copy(r),s.update(),r=s);const o=this.satBounds,a=this.satAxes;e[0]=r.a,e[1]=r.b,e[2]=r.c;for(let d=0;d<3;d++){const p=o[d],u=a[d];if(t.setFromPoints(u,e),p.isSeparated(t))return!1}const l=r.satBounds,c=r.satAxes,h=this.points;for(let d=0;d<3;d++){const p=l[d],u=c[d];if(t.setFromPoints(u,h),p.isSeparated(t))return!1}for(let d=0;d<3;d++){const p=a[d];for(let u=0;u<4;u++){const g=c[u];if(n.crossVectors(p,g),t.setFromPoints(n,e),i.setFromPoints(n,h),t.isSeparated(i))return!1}}return!0}}();ft.prototype.closestPointToPoint=function(){return function(s,e){return this.needsUpdate&&this.update(),e.copy(s).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();ft.prototype.distanceToPoint=function(){const s=new D;return function(e){return this.closestPointToPoint(e,s),e.distanceTo(s)}}();ft.prototype.distanceToBox=function(){const s=["x","y","z"],e=new Array(12).fill().map(()=>new St),t=new Array(12).fill().map(()=>new St),i=new D,n=new D;return function(r,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(a||l)&&(r.getCenter(n),this.closestPointToPoint(n,i),r.closestPointToPoint(i,n),a&&a.copy(i),l&&l.copy(n)),0;const c=o*o,h=r.min,d=r.max,p=this.points;let u=1/0;for(let m=0;m<8;m++){const b=p[m];n.copy(b).clamp(h,d);const f=b.distanceToSquared(n);if(f<u&&(u=f,a&&a.copy(b),l&&l.copy(n),f<c))return Math.sqrt(f)}let g=0;for(let m=0;m<3;m++)for(let b=0;b<=1;b++)for(let f=0;f<=1;f++){const y=(m+1)%3,v=(m+2)%3,w=b<<y|f<<v,E=1<<m|b<<y|f<<v,S=p[w],$=p[E];e[g].set(S,$);const M=s[m],k=s[y],z=s[v],j=t[g],A=j.start,P=j.end;A[M]=h[M],A[k]=b?h[k]:d[k],A[z]=f?h[z]:d[k],P[M]=d[M],P[k]=b?h[k]:d[k],P[z]=f?h[z]:d[k],g++}for(let m=0;m<=1;m++)for(let b=0;b<=1;b++)for(let f=0;f<=1;f++){n.x=m?d.x:h.x,n.y=b?d.y:h.y,n.z=f?d.z:h.z,this.closestPointToPoint(n,i);const y=n.distanceToSquared(i);if(y<u&&(u=y,a&&a.copy(i),l&&l.copy(n),y<c))return Math.sqrt(y)}for(let m=0;m<12;m++){const b=e[m];for(let f=0;f<12;f++){const y=t[f];nc(b,y,i,n);const v=i.distanceToSquared(n);if(v<u&&(u=v,a&&a.copy(i),l&&l.copy(n),v<c))return Math.sqrt(v)}}return Math.sqrt(u)}}();let rc=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};class xy extends rc{constructor(){super(()=>new Wt)}}const Mt=new xy;function xt(s,e){return e[s+15]===65535}function Ct(s,e){return e[s+6]}function It(s,e){return e[s+14]}function zt(s){return s+8}function Dt(s,e){return e[s+6]}function Uu(s,e){return e[s+7]}class Cy{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=i=>{t&&e.push(t),t=i,this.float32Array=new Float32Array(i),this.uint16Array=new Uint16Array(i),this.uint32Array=new Uint32Array(i)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const ze=new Cy;let zi,Fs;const As=[],Ur=new rc(()=>new Ve);function Ey(s,e,t,i,n,r){zi=Ur.getPrimitive(),Fs=Ur.getPrimitive(),As.push(zi,Fs),ze.setBuffer(s._roots[e]);const o=hl(0,s.geometry,t,i,n,r);ze.clearBuffer(),Ur.releasePrimitive(zi),Ur.releasePrimitive(Fs),As.pop(),As.pop();const a=As.length;return a>0&&(Fs=As[a-1],zi=As[a-2]),o}function hl(s,e,t,i,n=null,r=0,o=0){const{float32Array:a,uint16Array:l,uint32Array:c}=ze;let h=s*2;if(xt(h,l)){const d=Ct(s,c),p=It(h,l);return Be(s,a,zi),i(d,p,!1,o,r+s,zi)}else{let d=function(j){const{uint16Array:A,uint32Array:P}=ze;let _=j*2;for(;!xt(_,A);)j=zt(j),_=j*2;return Ct(j,P)},p=function(j){const{uint16Array:A,uint32Array:P}=ze;let _=j*2;for(;!xt(_,A);)j=Dt(j,P),_=j*2;return Ct(j,P)+It(_,A)};const u=zt(s),g=Dt(s,c);let m=u,b=g,f,y,v,w;if(n&&(v=zi,w=Fs,Be(m,a,v),Be(b,a,w),f=n(v),y=n(w),y<f)){m=g,b=u;const j=f;f=y,y=j,v=w}v||(v=zi,Be(m,a,v));const E=xt(m*2,l),S=t(v,E,f,o+1,r+m);let $;if(S===eh){const j=d(m),A=p(m)-j;$=i(j,A,!0,o+1,r+m,v)}else $=S&&hl(m,e,t,i,n,r,o+1);if($)return!0;w=Fs,Be(b,a,w);const M=xt(b*2,l),k=t(w,M,y,o+1,r+b);let z;if(k===eh){const j=d(b),A=p(b)-j;z=i(j,A,!0,o+1,r+b,w)}else z=k&&hl(b,e,t,i,n,r,o+1);return!!z}}const Pn=new D,Pa=new D;function Sy(s,e,t={},i=0,n=1/0){const r=i*i,o=n*n;let a=1/0,l=null;if(s.shapecast({boundsTraverseOrder:h=>(Pn.copy(e).clamp(h.min,h.max),Pn.distanceToSquared(e)),intersectsBounds:(h,d,p)=>p<a&&p<o,intersectsTriangle:(h,d)=>{h.closestPointToPoint(e,Pn);const p=e.distanceToSquared(Pn);return p<a&&(Pa.copy(Pn),a=p,l=d),p<r}}),a===1/0)return null;const c=Math.sqrt(a);return t.point?t.point.copy(Pa):t.point=Pa.clone(),t.distance=c,t.faceIndex=l,t}const $s=new D,Ts=new D,ks=new D,Fr=new Ne,jr=new Ne,Hr=new Ne,rh=new D,oh=new D,ah=new D,Vr=new D;function Ay(s,e,t,i,n,r){let o;return r===ig?o=s.intersectTriangle(i,t,e,!0,n):o=s.intersectTriangle(e,t,i,r!==Ui,n),o===null?null:{distance:s.origin.distanceTo(n),point:n.clone()}}function $y(s,e,t,i,n,r,o,a,l){$s.fromBufferAttribute(e,r),Ts.fromBufferAttribute(e,o),ks.fromBufferAttribute(e,a);const c=Ay(s,$s,Ts,ks,Vr,l);if(c){i&&(Fr.fromBufferAttribute(i,r),jr.fromBufferAttribute(i,o),Hr.fromBufferAttribute(i,a),c.uv=Un.getInterpolation(Vr,$s,Ts,ks,Fr,jr,Hr,new Ne)),n&&(Fr.fromBufferAttribute(n,r),jr.fromBufferAttribute(n,o),Hr.fromBufferAttribute(n,a),c.uv1=Un.getInterpolation(Vr,$s,Ts,ks,Fr,jr,Hr,new Ne)),t&&(rh.fromBufferAttribute(t,r),oh.fromBufferAttribute(t,o),ah.fromBufferAttribute(t,a),c.normal=Un.getInterpolation(Vr,$s,Ts,ks,rh,oh,ah,new D),c.normal.dot(s.direction)>0&&c.normal.multiplyScalar(-1));const h={a:r,b:o,c:a,normal:new D,materialIndex:0};Un.getNormal($s,Ts,ks,h.normal),c.face=h,c.faceIndex=r}return c}function Jo(s,e,t,i,n){const r=i*3;let o=r+0,a=r+1,l=r+2;const c=s.index;s.index&&(o=c.getX(o),a=c.getX(a),l=c.getX(l));const{position:h,normal:d,uv:p,uv1:u}=s.attributes,g=$y(t,h,d,p,u,o,a,l,e);return g?(g.faceIndex=i,n&&n.push(g),g):null}function We(s,e,t,i){const n=s.a,r=s.b,o=s.c;let a=e,l=e+1,c=e+2;t&&(a=t.getX(a),l=t.getX(l),c=t.getX(c)),n.x=i.getX(a),n.y=i.getY(a),n.z=i.getZ(a),r.x=i.getX(l),r.y=i.getY(l),r.z=i.getZ(l),o.x=i.getX(c),o.y=i.getY(c),o.z=i.getZ(c)}function Ty(s,e,t,i,n,r){const{geometry:o,_indirectBuffer:a}=s;for(let l=i,c=i+n;l<c;l++)Jo(o,e,t,l,r)}function ky(s,e,t,i,n){const{geometry:r,_indirectBuffer:o}=s;let a=1/0,l=null;for(let c=i,h=i+n;c<h;c++){let d;d=Jo(r,e,t,c),d&&d.distance<a&&(l=d,a=d.distance)}return l}function Py(s,e,t,i,n,r,o){const{geometry:a}=t,{index:l}=a,c=a.attributes.position;for(let h=s,d=e+s;h<d;h++){let p;if(p=h,We(o,p*3,l,c),o.needsUpdate=!0,i(o,p,n,r))return!0}return!1}function Oy(s,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=s.geometry,i=t.index?t.index.array:null,n=t.attributes.position;let r,o,a,l,c=0;const h=s._roots;for(let p=0,u=h.length;p<u;p++)r=h[p],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),d(0,c),c+=r.byteLength;function d(p,u,g=!1){const m=p*2;if(a[m+15]===Ko){const b=o[p+6],f=a[m+14];let y=1/0,v=1/0,w=1/0,E=-1/0,S=-1/0,$=-1/0;for(let M=3*b,k=3*(b+f);M<k;M++){let z=i[M];const j=n.getX(z),A=n.getY(z),P=n.getZ(z);j<y&&(y=j),j>E&&(E=j),A<v&&(v=A),A>S&&(S=A),P<w&&(w=P),P>$&&($=P)}return l[p+0]!==y||l[p+1]!==v||l[p+2]!==w||l[p+3]!==E||l[p+4]!==S||l[p+5]!==$?(l[p+0]=y,l[p+1]=v,l[p+2]=w,l[p+3]=E,l[p+4]=S,l[p+5]=$,!0):!1}else{const b=p+8,f=o[p+6],y=b+u,v=f+u;let w=g,E=!1,S=!1;e?w||(E=e.has(y),S=e.has(v),w=!E&&!S):(E=!0,S=!0);const $=w||E,M=w||S;let k=!1;$&&(k=d(b,u,w));let z=!1;M&&(z=d(f,u,w));const j=k||z;if(j)for(let A=0;A<3;A++){const P=b+A,_=f+A,L=l[P],G=l[P+3],V=l[_],K=l[_+3];l[p+A]=L<V?L:V,l[p+A+3]=G>K?G:K}return j}}}const lh=new Ve;function ji(s,e,t,i){return Be(s,e,lh),t.intersectBox(lh,i)}function My(s,e,t,i,n,r){const{geometry:o,_indirectBuffer:a}=s;for(let l=i,c=i+n;l<c;l++){let h=a?a[l]:l;Jo(o,e,t,h,r)}}function Iy(s,e,t,i,n){const{geometry:r,_indirectBuffer:o}=s;let a=1/0,l=null;for(let c=i,h=i+n;c<h;c++){let d;d=Jo(r,e,t,o?o[c]:c),d&&d.distance<a&&(l=d,a=d.distance)}return l}function zy(s,e,t,i,n,r,o){const{geometry:a}=t,{index:l}=a,c=a.attributes.position;for(let h=s,d=e+s;h<d;h++){let p;if(p=t.resolveTriangleIndex(h),We(o,p*3,l,c),o.needsUpdate=!0,i(o,p,n,r))return!0}return!1}const ch=new D;function Dy(s,e,t,i,n){ze.setBuffer(s._roots[e]),dl(0,s,t,i,n),ze.clearBuffer()}function dl(s,e,t,i,n){const{float32Array:r,uint16Array:o,uint32Array:a}=ze,l=s*2;if(xt(l,o)){const c=Ct(s,a),h=It(l,o);Ty(e,t,i,c,h,n)}else{const c=zt(s);ji(c,r,i,ch)&&dl(c,e,t,i,n);const h=Dt(s,a);ji(h,r,i,ch)&&dl(h,e,t,i,n)}}const hh=new D,Ly=["x","y","z"];function By(s,e,t,i){ze.setBuffer(s._roots[e]);const n=ul(0,s,t,i);return ze.clearBuffer(),n}function ul(s,e,t,i){const{float32Array:n,uint16Array:r,uint32Array:o}=ze;let a=s*2;if(xt(a,r)){const l=Ct(s,o),c=It(a,r);return ky(e,t,i,l,c)}else{const l=Uu(s,o),c=Ly[l],h=i.direction[c]>=0;let d,p;h?(d=zt(s),p=Dt(s,o)):(d=Dt(s,o),p=zt(s));const u=ji(d,n,i,hh)?ul(d,e,t,i):null;if(u){const m=u.point[c];if(h?m<=n[p+l]:m>=n[p+l+3])return u}const g=ji(p,n,i,hh)?ul(p,e,t,i):null;return u&&g?u.distance<=g.distance?u:g:u||g||null}}const qr=new Ve,Ps=new Wt,Os=new Wt,On=new xe,dh=new ft,Wr=new ft;function Ny(s,e,t,i){ze.setBuffer(s._roots[e]);const n=pl(0,s,t,i);return ze.clearBuffer(),n}function pl(s,e,t,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=ze;let l=s*2;if(n===null&&(t.boundingBox||t.computeBoundingBox(),dh.set(t.boundingBox.min,t.boundingBox.max,i),n=dh),xt(l,o)){const c=e.geometry,h=c.index,d=c.attributes.position,p=t.index,u=t.attributes.position,g=Ct(s,a),m=It(l,o);if(On.copy(i).invert(),t.boundsTree)return Be(s,r,Wr),Wr.matrix.copy(On),Wr.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:b=>Wr.intersectsBox(b),intersectsTriangle:b=>{b.a.applyMatrix4(i),b.b.applyMatrix4(i),b.c.applyMatrix4(i),b.needsUpdate=!0;for(let f=g*3,y=(m+g)*3;f<y;f+=3)if(We(Os,f,h,d),Os.needsUpdate=!0,b.intersectsTriangle(Os))return!0;return!1}});for(let b=g*3,f=(m+g)*3;b<f;b+=3){We(Ps,b,h,d),Ps.a.applyMatrix4(On),Ps.b.applyMatrix4(On),Ps.c.applyMatrix4(On),Ps.needsUpdate=!0;for(let y=0,v=p.count;y<v;y+=3)if(We(Os,y,p,u),Os.needsUpdate=!0,Ps.intersectsTriangle(Os))return!0}}else{const c=s+8,h=a[s+6];return Be(c,r,qr),!!(n.intersectsBox(qr)&&pl(c,e,t,i,n)||(Be(h,r,qr),n.intersectsBox(qr)&&pl(h,e,t,i,n)))}}const Yr=new xe,Oa=new ft,Mn=new ft,Ry=new D,Uy=new D,Fy=new D,jy=new D;function Hy(s,e,t,i={},n={},r=0,o=1/0){e.boundingBox||e.computeBoundingBox(),Oa.set(e.boundingBox.min,e.boundingBox.max,t),Oa.needsUpdate=!0;const a=s.geometry,l=a.attributes.position,c=a.index,h=e.attributes.position,d=e.index,p=Mt.getPrimitive(),u=Mt.getPrimitive();let g=Ry,m=Uy,b=null,f=null;n&&(b=Fy,f=jy);let y=1/0,v=null,w=null;return Yr.copy(t).invert(),Mn.matrix.copy(Yr),s.shapecast({boundsTraverseOrder:E=>Oa.distanceToBox(E),intersectsBounds:(E,S,$)=>$<y&&$<o?(S&&(Mn.min.copy(E.min),Mn.max.copy(E.max),Mn.needsUpdate=!0),!0):!1,intersectsRange:(E,S)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:$=>Mn.distanceToBox($),intersectsBounds:($,M,k)=>k<y&&k<o,intersectsRange:($,M)=>{for(let k=$,z=$+M;k<z;k++){We(u,3*k,d,h),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let j=E,A=E+S;j<A;j++){We(p,3*j,c,l),p.needsUpdate=!0;const P=p.distanceToTriangle(u,g,b);if(P<y&&(m.copy(g),f&&f.copy(b),y=P,v=j,w=k),P<r)return!0}}}});{const $=an(e);for(let M=0,k=$;M<k;M++){We(u,3*M,d,h),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let z=E,j=E+S;z<j;z++){We(p,3*z,c,l),p.needsUpdate=!0;const A=p.distanceToTriangle(u,g,b);if(A<y&&(m.copy(g),f&&f.copy(b),y=A,v=z,w=M),A<r)return!0}}}}}),Mt.releasePrimitive(p),Mt.releasePrimitive(u),y===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=y,i.faceIndex=v,n&&(n.point?n.point.copy(f):n.point=f.clone(),n.point.applyMatrix4(Yr),m.applyMatrix4(Yr),n.distance=m.sub(n.point).length(),n.faceIndex=w),i)}function Vy(s,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=s.geometry,i=t.index?t.index.array:null,n=t.attributes.position;let r,o,a,l,c=0;const h=s._roots;for(let p=0,u=h.length;p<u;p++)r=h[p],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),d(0,c),c+=r.byteLength;function d(p,u,g=!1){const m=p*2;if(a[m+15]===Ko){const b=o[p+6],f=a[m+14];let y=1/0,v=1/0,w=1/0,E=-1/0,S=-1/0,$=-1/0;for(let M=b,k=b+f;M<k;M++){const z=3*s.resolveTriangleIndex(M);for(let j=0;j<3;j++){let A=z+j;A=i?i[A]:A;const P=n.getX(A),_=n.getY(A),L=n.getZ(A);P<y&&(y=P),P>E&&(E=P),_<v&&(v=_),_>S&&(S=_),L<w&&(w=L),L>$&&($=L)}}return l[p+0]!==y||l[p+1]!==v||l[p+2]!==w||l[p+3]!==E||l[p+4]!==S||l[p+5]!==$?(l[p+0]=y,l[p+1]=v,l[p+2]=w,l[p+3]=E,l[p+4]=S,l[p+5]=$,!0):!1}else{const b=p+8,f=o[p+6],y=b+u,v=f+u;let w=g,E=!1,S=!1;e?w||(E=e.has(y),S=e.has(v),w=!E&&!S):(E=!0,S=!0);const $=w||E,M=w||S;let k=!1;$&&(k=d(b,u,w));let z=!1;M&&(z=d(f,u,w));const j=k||z;if(j)for(let A=0;A<3;A++){const P=b+A,_=f+A,L=l[P],G=l[P+3],V=l[_],K=l[_+3];l[p+A]=L<V?L:V,l[p+A+3]=G>K?G:K}return j}}}const uh=new D;function qy(s,e,t,i,n){ze.setBuffer(s._roots[e]),fl(0,s,t,i,n),ze.clearBuffer()}function fl(s,e,t,i,n){const{float32Array:r,uint16Array:o,uint32Array:a}=ze,l=s*2;if(xt(l,o)){const c=Ct(s,a),h=It(l,o);My(e,t,i,c,h,n)}else{const c=zt(s);ji(c,r,i,uh)&&fl(c,e,t,i,n);const h=Dt(s,a);ji(h,r,i,uh)&&fl(h,e,t,i,n)}}const ph=new D,Wy=["x","y","z"];function Yy(s,e,t,i){ze.setBuffer(s._roots[e]);const n=ml(0,s,t,i);return ze.clearBuffer(),n}function ml(s,e,t,i){const{float32Array:n,uint16Array:r,uint32Array:o}=ze;let a=s*2;if(xt(a,r)){const l=Ct(s,o),c=It(a,r);return Iy(e,t,i,l,c)}else{const l=Uu(s,o),c=Wy[l],h=i.direction[c]>=0;let d,p;h?(d=zt(s),p=Dt(s,o)):(d=Dt(s,o),p=zt(s));const u=ji(d,n,i,ph)?ml(d,e,t,i):null;if(u){const m=u.point[c];if(h?m<=n[p+l]:m>=n[p+l+3])return u}const g=ji(p,n,i,ph)?ml(p,e,t,i):null;return u&&g?u.distance<=g.distance?u:g:u||g||null}}const Zr=new Ve,Ms=new Wt,Is=new Wt,In=new xe,fh=new ft,Gr=new ft;function Zy(s,e,t,i){ze.setBuffer(s._roots[e]);const n=gl(0,s,t,i);return ze.clearBuffer(),n}function gl(s,e,t,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=ze;let l=s*2;if(n===null&&(t.boundingBox||t.computeBoundingBox(),fh.set(t.boundingBox.min,t.boundingBox.max,i),n=fh),xt(l,o)){const c=e.geometry,h=c.index,d=c.attributes.position,p=t.index,u=t.attributes.position,g=Ct(s,a),m=It(l,o);if(In.copy(i).invert(),t.boundsTree)return Be(s,r,Gr),Gr.matrix.copy(In),Gr.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:b=>Gr.intersectsBox(b),intersectsTriangle:b=>{b.a.applyMatrix4(i),b.b.applyMatrix4(i),b.c.applyMatrix4(i),b.needsUpdate=!0;for(let f=g,y=m+g;f<y;f++)if(We(Is,3*e.resolveTriangleIndex(f),h,d),Is.needsUpdate=!0,b.intersectsTriangle(Is))return!0;return!1}});for(let b=g,f=m+g;b<f;b++){const y=e.resolveTriangleIndex(b);We(Ms,3*y,h,d),Ms.a.applyMatrix4(In),Ms.b.applyMatrix4(In),Ms.c.applyMatrix4(In),Ms.needsUpdate=!0;for(let v=0,w=p.count;v<w;v+=3)if(We(Is,v,p,u),Is.needsUpdate=!0,Ms.intersectsTriangle(Is))return!0}}else{const c=s+8,h=a[s+6];return Be(c,r,Zr),!!(n.intersectsBox(Zr)&&gl(c,e,t,i,n)||(Be(h,r,Zr),n.intersectsBox(Zr)&&gl(h,e,t,i,n)))}}const Xr=new xe,Ma=new ft,zn=new ft,Gy=new D,Xy=new D,Qy=new D,Ky=new D;function Jy(s,e,t,i={},n={},r=0,o=1/0){e.boundingBox||e.computeBoundingBox(),Ma.set(e.boundingBox.min,e.boundingBox.max,t),Ma.needsUpdate=!0;const a=s.geometry,l=a.attributes.position,c=a.index,h=e.attributes.position,d=e.index,p=Mt.getPrimitive(),u=Mt.getPrimitive();let g=Gy,m=Xy,b=null,f=null;n&&(b=Qy,f=Ky);let y=1/0,v=null,w=null;return Xr.copy(t).invert(),zn.matrix.copy(Xr),s.shapecast({boundsTraverseOrder:E=>Ma.distanceToBox(E),intersectsBounds:(E,S,$)=>$<y&&$<o?(S&&(zn.min.copy(E.min),zn.max.copy(E.max),zn.needsUpdate=!0),!0):!1,intersectsRange:(E,S)=>{if(e.boundsTree){const $=e.boundsTree;return $.shapecast({boundsTraverseOrder:M=>zn.distanceToBox(M),intersectsBounds:(M,k,z)=>z<y&&z<o,intersectsRange:(M,k)=>{for(let z=M,j=M+k;z<j;z++){const A=$.resolveTriangleIndex(z);We(u,3*A,d,h),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let P=E,_=E+S;P<_;P++){const L=s.resolveTriangleIndex(P);We(p,3*L,c,l),p.needsUpdate=!0;const G=p.distanceToTriangle(u,g,b);if(G<y&&(m.copy(g),f&&f.copy(b),y=G,v=P,w=z),G<r)return!0}}}})}else{const $=an(e);for(let M=0,k=$;M<k;M++){We(u,3*M,d,h),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let z=E,j=E+S;z<j;z++){const A=s.resolveTriangleIndex(z);We(p,3*A,c,l),p.needsUpdate=!0;const P=p.distanceToTriangle(u,g,b);if(P<y&&(m.copy(g),f&&f.copy(b),y=P,v=z,w=M),P<r)return!0}}}}}),Mt.releasePrimitive(p),Mt.releasePrimitive(u),y===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=y,i.faceIndex=v,n&&(n.point?n.point.copy(f):n.point=f.clone(),n.point.applyMatrix4(Xr),m.applyMatrix4(Xr),n.distance=m.sub(n.point).length(),n.faceIndex=w),i)}function ev(){return typeof SharedArrayBuffer<"u"}const Wn=new ze.constructor,Co=new ze.constructor,ki=new rc(()=>new Ve),zs=new Ve,Ds=new Ve,Ia=new Ve,za=new Ve;let Da=!1;function tv(s,e,t,i){if(Da)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Da=!0;const n=s._roots,r=e._roots;let o,a=0,l=0;const c=new xe().copy(t).invert();for(let h=0,d=n.length;h<d;h++){Wn.setBuffer(n[h]),l=0;const p=ki.getPrimitive();Be(0,Wn.float32Array,p),p.applyMatrix4(c);for(let u=0,g=r.length;u<g&&(Co.setBuffer(r[h]),o=jt(0,0,t,c,i,a,l,0,0,p),Co.clearBuffer(),l+=r[u].length,!o);u++);if(ki.releasePrimitive(p),Wn.clearBuffer(),a+=n[h].length,o)break}return Da=!1,o}function jt(s,e,t,i,n,r=0,o=0,a=0,l=0,c=null,h=!1){let d,p;h?(d=Co,p=Wn):(d=Wn,p=Co);const u=d.float32Array,g=d.uint32Array,m=d.uint16Array,b=p.float32Array,f=p.uint32Array,y=p.uint16Array,v=s*2,w=e*2,E=xt(v,m),S=xt(w,y);let $=!1;if(S&&E)h?$=n(Ct(e,f),It(e*2,y),Ct(s,g),It(s*2,m),l,o+e,a,r+s):$=n(Ct(s,g),It(s*2,m),Ct(e,f),It(e*2,y),a,r+s,l,o+e);else if(S){const M=ki.getPrimitive();Be(e,b,M),M.applyMatrix4(t);const k=zt(s),z=Dt(s,g);Be(k,u,zs),Be(z,u,Ds);const j=M.intersectsBox(zs),A=M.intersectsBox(Ds);$=j&&jt(e,k,i,t,n,o,r,l,a+1,M,!h)||A&&jt(e,z,i,t,n,o,r,l,a+1,M,!h),ki.releasePrimitive(M)}else{const M=zt(e),k=Dt(e,f);Be(M,b,Ia),Be(k,b,za);const z=c.intersectsBox(Ia),j=c.intersectsBox(za);if(z&&j)$=jt(s,M,t,i,n,r,o,a,l+1,c,h)||jt(s,k,t,i,n,r,o,a,l+1,c,h);else if(z)if(E)$=jt(s,M,t,i,n,r,o,a,l+1,c,h);else{const A=ki.getPrimitive();A.copy(Ia).applyMatrix4(t);const P=zt(s),_=Dt(s,g);Be(P,u,zs),Be(_,u,Ds);const L=A.intersectsBox(zs),G=A.intersectsBox(Ds);$=L&&jt(M,P,i,t,n,o,r,l,a+1,A,!h)||G&&jt(M,_,i,t,n,o,r,l,a+1,A,!h),ki.releasePrimitive(A)}else if(j)if(E)$=jt(s,k,t,i,n,r,o,a,l+1,c,h);else{const A=ki.getPrimitive();A.copy(za).applyMatrix4(t);const P=zt(s),_=Dt(s,g);Be(P,u,zs),Be(_,u,Ds);const L=A.intersectsBox(zs),G=A.intersectsBox(Ds);$=L&&jt(k,P,i,t,n,o,r,l,a+1,A,!h)||G&&jt(k,_,i,t,n,o,r,l,a+1,A,!h),ki.releasePrimitive(A)}}return $}const Qr=new ft,mh=new Ve;class oc{static serialize(e,t={}){t={cloneBuffers:!0,...t};const i=e.geometry,n=e._roots,r=e._indirectBuffer,o=i.getIndex();let a;return t.cloneBuffers?a={roots:n.map(l=>l.slice()),index:o.array.slice(),indirectBuffer:r?r.slice():null}:a={roots:n,index:o.array,indirectBuffer:r},a}static deserialize(e,t,i={}){i={setIndex:!0,indirect:!!e.indirectBuffer,...i};const{index:n,roots:r,indirectBuffer:o}=e,a=new oc(t,{...i,[$a]:!0});if(a._roots=r,a._indirectBuffer=o||null,i.setIndex){const l=t.getIndex();if(l===null){const c=new Et(e.index,1,!1);t.setIndex(c)}else l.array!==n&&(l.array.set(n),l.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:Bu,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[$a]:!1},t),t.useSharedArrayBuffer&&!ev())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[$a]||(yy(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Ve)));const{_indirectBuffer:i}=this;this.resolveTriangleIndex=t.indirect?n=>i[n]:n=>n}refit(e=null){return(this.indirect?Vy:Oy)(this,e)}traverse(e,t=0){const i=this._roots[t],n=new Uint32Array(i),r=new Uint16Array(i);o(0);function o(a,l=0){const c=a*2,h=r[c+15]===Ko;if(h){const d=n[a+6],p=r[c+14];e(l,h,new Float32Array(i,a*4,6),d,p)}else{const d=a+po/4,p=n[a+6],u=n[a+7];e(l,h,new Float32Array(i,a*4,6),u)||(o(d,l+1),o(p,l+1))}}}raycast(e,t=Rc){const i=this._roots,n=this.geometry,r=[],o=t.isMaterial,a=Array.isArray(t),l=n.groups,c=o?t.side:t,h=this.indirect?qy:Dy;for(let d=0,p=i.length;d<p;d++){const u=a?t[l[d].materialIndex].side:c,g=r.length;if(h(this,d,u,e,r),a){const m=l[d].materialIndex;for(let b=g,f=r.length;b<f;b++)r[b].face.materialIndex=m}}return r}raycastFirst(e,t=Rc){const i=this._roots,n=this.geometry,r=t.isMaterial,o=Array.isArray(t);let a=null;const l=n.groups,c=r?t.side:t,h=this.indirect?Yy:By;for(let d=0,p=i.length;d<p;d++){const u=o?t[l[d].materialIndex].side:c,g=h(this,d,u,e);g!=null&&(a==null||g.distance<a.distance)&&(a=g,o&&(g.face.materialIndex=l[d].materialIndex))}return a}intersectsGeometry(e,t){let i=!1;const n=this._roots,r=this.indirect?Zy:Ny;for(let o=0,a=n.length;o<a&&(i=r(this,o,e,t),!i);o++);return i}shapecast(e){const t=Mt.getPrimitive(),i=this.indirect?zy:Py;let{boundsTraverseOrder:n,intersectsBounds:r,intersectsRange:o,intersectsTriangle:a}=e;if(o&&a){const d=o;o=(p,u,g,m,b)=>d(p,u,g,m,b)?!0:i(p,u,this,a,g,m,t)}else o||(a?o=(d,p,u,g)=>i(d,p,this,a,u,g,t):o=(d,p,u)=>u);let l=!1,c=0;const h=this._roots;for(let d=0,p=h.length;d<p;d++){const u=h[d];if(l=Ey(this,d,r,o,n,c),l)break;c+=u.byteLength}return Mt.releasePrimitive(t),l}bvhcast(e,t,i){let{intersectsRanges:n,intersectsTriangles:r}=i;const o=Mt.getPrimitive(),a=this.geometry.index,l=this.geometry.attributes.position,c=this.indirect?g=>{const m=this.resolveTriangleIndex(g);We(o,m*3,a,l)}:g=>{We(o,g*3,a,l)},h=Mt.getPrimitive(),d=e.geometry.index,p=e.geometry.attributes.position,u=e.indirect?g=>{const m=e.resolveTriangleIndex(g);We(h,m*3,d,p)}:g=>{We(h,g*3,d,p)};if(r){const g=(m,b,f,y,v,w,E,S)=>{for(let $=f,M=f+y;$<M;$++){u($),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let k=m,z=m+b;k<z;k++)if(c(k),o.needsUpdate=!0,r(o,h,k,$,v,w,E,S))return!0}return!1};if(n){const m=n;n=function(b,f,y,v,w,E,S,$){return m(b,f,y,v,w,E,S,$)?!0:g(b,f,y,v,w,E,S,$)}}else n=g}return tv(this,e,t,n)}intersectsBox(e,t){return Qr.set(e.min,e.max,t),Qr.needsUpdate=!0,this.shapecast({intersectsBounds:i=>Qr.intersectsBox(i),intersectsTriangle:i=>Qr.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},n={},r=0,o=1/0){return(this.indirect?Jy:Hy)(this,e,t,i,n,r,o)}closestPointToPoint(e,t={},i=0,n=1/0){return Sy(this,e,t,i,n)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Be(0,new Float32Array(t),mh),e.union(mh)}),e}}function gh(s,e,t){return s===null||(s.point.applyMatrix4(e.matrixWorld),s.distance=s.point.distanceTo(t.ray.origin),s.object=e,s.distance<t.near||s.distance>t.far)?null:s}const La=new Vm,bh=new xe,iv=re.prototype.raycast;function sv(s,e){if(this.geometry.boundsTree){if(this.material===void 0)return;bh.copy(this.matrixWorld).invert(),La.copy(s.ray).applyMatrix4(bh);const t=this.geometry.boundsTree;if(s.firstHitOnly===!0){const i=gh(t.raycastFirst(La,this.material),this,s);i&&e.push(i)}else{const i=t.raycast(La,this.material);for(let n=0,r=i.length;n<r;n++){const o=gh(i[n],this,s);o&&e.push(o)}}}else iv.call(this,s,e)}function nv(s){return this.boundsTree=new oc(this,s),this.boundsTree}function rv(){this.boundsTree=null}const Fu=class ju{constructor(){C(this,"onDisposed",new J),C(this,"list",new Se),C(this,"enabled",!1),C(this,"_clock"),C(this,"onInit",new J),C(this,"update",()=>{if(!this.enabled)return;const e=this._clock.getDelta();for(const[t,i]of this.list)i.enabled&&i.isUpdateable()&&i.update(e);requestAnimationFrame(this.update)}),this._clock=new Dm,ju.setupBVH()}add(e,t){if(this.list.has(e))throw new Error("You're trying to add a component that already exists in the components instance. Use Components.get() instead.");st.validate(e),this.list.set(e,t)}get(e){var t;const i=e.uuid;if(!this.list.has(i)){const n=new e(this);return(t=n.isDisposeable)!=null&&t.call(n)&&n.onDisposed.add(()=>this.list.delete(i)),this.list.has(i)||this.add(i,n),n}return this.list.get(i)}init(){this.enabled=!0;for(const[e,t]of this.list.entries())t.enabled=!0;this._clock.start(),this.update(),this.onInit.trigger()}dispose(){this.enabled=!1;let e;for(const[t,i]of this.list){if(i.enabled=!1,t===he.uuid){e=i;continue}i.isDisposeable()&&i.dispose()}e==null||e.dispose(),this._clock.stop(),this.onDisposed.trigger()}static setupBVH(){nt.prototype.computeBoundsTree=nv,nt.prototype.disposeBoundsTree=rv,re.prototype.raycast=sv}};C(Fu,"release","2.4.3");let Hu=Fu,ov=class{constructor(e){C(this,"enabled",!1),C(this,"id","FirstPerson"),this.camera=e}set(e){if(this.enabled=e,e){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const e=this.camera.controls,t=new D;e.distance--,e.getPosition(t),e.minDistance=1,e.maxDistance=1,e.distance=1,e.moveTo(t.x,t.y,t.z),e.truckSpeed=50,e.mouseButtons.wheel=wt.ACTION.DOLLY,e.touches.two=wt.ACTION.TOUCH_ZOOM_TRUCK}},av=class{constructor(e){C(this,"enabled",!0),C(this,"id","Orbit"),this.camera=e,this.activateOrbitControls()}set(e){this.enabled=e,e&&this.activateOrbitControls()}activateOrbitControls(){const e=this.camera.controls;e.minDistance=1,e.maxDistance=300;const t=new D;e.getPosition(t);const i=t.length();e.distance=i,e.truckSpeed=2;const{rotation:n}=this.camera.three,r=new D(0,0,-1).applyEuler(n),o=t.addScaledVector(r,i);e.moveTo(o.x,o.y,o.z)}},lv=class{constructor(e){C(this,"enabled",!1),C(this,"id","Plan"),C(this,"mouseAction1"),C(this,"mouseAction2"),C(this,"mouseInitialized",!1),C(this,"defaultAzimuthSpeed"),C(this,"defaultPolarSpeed"),this.camera=e,this.defaultAzimuthSpeed=e.controls.azimuthRotateSpeed,this.defaultPolarSpeed=e.controls.polarRotateSpeed}set(e){this.enabled=e;const t=this.camera.controls;t.azimuthRotateSpeed=e?0:this.defaultAzimuthSpeed,t.polarRotateSpeed=e?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=t.touches.one,this.mouseAction2=t.touches.two,this.mouseInitialized=!0),e?(t.mouseButtons.left=wt.ACTION.TRUCK,t.touches.one=wt.ACTION.TOUCH_TRUCK,t.touches.two=wt.ACTION.TOUCH_ZOOM):(t.mouseButtons.left=wt.ACTION.ROTATE,t.touches.one=this.mouseAction1,t.touches.two=this.mouseAction2)}},cv=class{constructor(e){C(this,"onChanged",new J),C(this,"current","Perspective"),C(this,"camera"),C(this,"matchOrthoDistanceEnabled",!1),C(this,"_component"),C(this,"_previousDistance",-1),this._component=e,this.camera=e.three}async set(e){this.current!==e&&(e==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const e=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(e)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const e=this.getPerspectiveDims();if(!e)return;const{width:t,height:i}=e;this.setupOrthoCamera(i,t),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const e=this._component.currentWorld;if(!e||!e.renderer)return null;const t=new D;this._component.threePersp.getWorldDirection(t);const i=new D;this._component.controls.getTarget(i);const n=i.clone().sub(this._component.threePersp.position).dot(t),r=e.renderer.getSize(),o=r.x/r.y,a=this._component.threePersp,l=n*2*Math.atan(a.fov*(Math.PI/180)/2);return{width:l*o,height:l}}setupOrthoCamera(e,t){this._component.controls.mouseButtons.wheel=wt.ACTION.ZOOM,this._component.controls.mouseButtons.middle=wt.ACTION.ZOOM;const i=this._component.threePersp,n=this._component.threeOrtho;n.zoom=1,n.left=t/-2,n.right=t/2,n.top=e/2,n.bottom=e/-2,n.updateProjectionMatrix(),n.position.copy(i.position),n.quaternion.copy(i.quaternion),this._component.controls.camera=n}getDistance(){const e=this._component.threePersp,t=this._component.threeOrtho;return(t.top-t.bottom)/t.zoom/(2*Math.atan(e.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=wt.ACTION.DOLLY,this._component.controls.mouseButtons.middle=wt.ACTION.DOLLY;const e=this._component.threePersp,t=this._component.threeOrtho;e.position.copy(t.position),e.quaternion.copy(t.quaternion),this._component.controls.mouseButtons.wheel=wt.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),e.updateProjectionMatrix(),this._component.controls.camera=e,this.camera=e,this.current="Perspective"}},Vu=class extends cl{constructor(e){super(e),C(this,"projection"),C(this,"threeOrtho"),C(this,"threePersp"),C(this,"_userInputButtons",{}),C(this,"_frustumSize",50),C(this,"_navigationModes",new Map),C(this,"_mode",null),C(this,"previousSize",null),this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new cv(this),this.onAspectUpdated.add(()=>{this.setOrthoPerspCameraAspect()}),this.projection.onChanged.add(t=>{this.three=t,this.updateAspect()}),this.worlds.onItemSet.add(()=>{this._navigationModes.clear(),this._navigationModes.set("Orbit",new av(this)),this._navigationModes.set("FirstPerson",new ov(this)),this._navigationModes.set("Plan",new lv(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0}),this.currentWorld&&this.currentWorld.renderer&&(this.previousSize=this.currentWorld.renderer.getSize().clone())}),this.worlds.onItemDeleted.add(()=>{this._navigationModes.clear()})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(e){if(this.mode!==null&&this.mode.id!==e){if(this.mode.set(!1),!this._navigationModes.has(e))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(e),this.mode.set(!0)}}async fit(e,t=1.5){if(!this.enabled)return;const i=Number.MAX_VALUE,n=Number.MIN_VALUE,r=new D(i,i,i),o=new D(n,n,n);for(const u of e){const g=new Ve().setFromObject(u);g.min.x<r.x&&(r.x=g.min.x),g.min.y<r.y&&(r.y=g.min.y),g.min.z<r.z&&(r.z=g.min.z),g.max.x>o.x&&(o.x=g.max.x),g.max.y>o.y&&(o.y=g.max.y),g.max.z>o.z&&(o.z=g.max.z)}const a=new Ve(r,o),l=this.components.get(he);if(l.initialized)for(const[,u]of l.list){const g=u.box;g.min.x<r.x&&(r.x=g.min.x),g.min.y<r.y&&(r.y=g.min.y),g.min.z<r.z&&(r.z=g.min.z),g.max.x>o.x&&(o.x=g.max.x),g.max.y>o.y&&(o.y=g.max.y),g.max.z>o.z&&(o.z=g.max.z)}const c=new D;a.getSize(c);const h=new D;a.getCenter(h);const d=Math.max(c.x,c.y,c.z)*t,p=new Ri(h,d);await this.controls.fitToSphere(p,!0)}setUserInput(e){e?this.enableUserInput():this.disableUserInput()}addCustomNavigationMode(e){this._navigationModes.set(e.id,e)}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const e=window.innerWidth/window.innerHeight;return new Vo(this._frustumSize*e/-2,this._frustumSize*e/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoPerspCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer||!this.previousSize)return;const e=this.currentWorld.renderer.getSize(),t=this.threeOrtho.top,i=this.threeOrtho.right,n=e.y/this.previousSize.y,r=e.x/this.previousSize.x,o=t*n,a=i*r;this.threeOrtho.left=-a,this.threeOrtho.right=a,this.threeOrtho.top=o,this.threeOrtho.bottom=-o,this.threeOrtho.updateProjectionMatrix(),this.previousSize.copy(e)}};function Kr(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var qu={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(s,e){(function(t){s.exports=t()})(function(){return function t(i,n,r){function o(c,h){if(!n[c]){if(!i[c]){var d=typeof Kr=="function"&&Kr;if(!h&&d)return d(c,!0);if(a)return a(c,!0);var p=new Error("Cannot find module '"+c+"'");throw p.code="MODULE_NOT_FOUND",p}var u=n[c]={exports:{}};i[c][0].call(u.exports,function(g){var m=i[c][1][g];return o(m||g)},u,u.exports,t,i,n,r)}return n[c].exports}for(var a=typeof Kr=="function"&&Kr,l=0;l<r.length;l++)o(r[l]);return o}({1:[function(t,i,n){var r=t("./utils"),o=t("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(l){for(var c,h,d,p,u,g,m,b=[],f=0,y=l.length,v=y,w=r.getTypeOf(l)!=="string";f<l.length;)v=y-f,d=w?(c=l[f++],h=f<y?l[f++]:0,f<y?l[f++]:0):(c=l.charCodeAt(f++),h=f<y?l.charCodeAt(f++):0,f<y?l.charCodeAt(f++):0),p=c>>2,u=(3&c)<<4|h>>4,g=1<v?(15&h)<<2|d>>6:64,m=2<v?63&d:64,b.push(a.charAt(p)+a.charAt(u)+a.charAt(g)+a.charAt(m));return b.join("")},n.decode=function(l){var c,h,d,p,u,g,m=0,b=0,f="data:";if(l.substr(0,f.length)===f)throw new Error("Invalid base64 input, it looks like a data url.");var y,v=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&v--,l.charAt(l.length-2)===a.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(y=o.uint8array?new Uint8Array(0|v):new Array(0|v);m<l.length;)c=a.indexOf(l.charAt(m++))<<2|(p=a.indexOf(l.charAt(m++)))>>4,h=(15&p)<<4|(u=a.indexOf(l.charAt(m++)))>>2,d=(3&u)<<6|(g=a.indexOf(l.charAt(m++))),y[b++]=c,u!==64&&(y[b++]=h),g!==64&&(y[b++]=d);return y}},{"./support":30,"./utils":32}],2:[function(t,i,n){var r=t("./external"),o=t("./stream/DataWorker"),a=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function c(h,d,p,u,g){this.compressedSize=h,this.uncompressedSize=d,this.crc32=p,this.compression=u,this.compressedContent=g}c.prototype={getContentWorker:function(){var h=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return h.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(h,d,p){return h.pipe(new a).pipe(new l("uncompressedSize")).pipe(d.compressWorker(p)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},i.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,i,n){var r=t("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},n.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,i,n){var r=t("./utils"),o=function(){for(var a,l=[],c=0;c<256;c++){a=c;for(var h=0;h<8;h++)a=1&a?3988292384^a>>>1:a>>>1;l[c]=a}return l}();i.exports=function(a,l){return a!==void 0&&a.length?r.getTypeOf(a)!=="string"?function(c,h,d,p){var u=o,g=p+d;c^=-1;for(var m=p;m<g;m++)c=c>>>8^u[255&(c^h[m])];return-1^c}(0|l,a,a.length,0):function(c,h,d,p){var u=o,g=p+d;c^=-1;for(var m=p;m<g;m++)c=c>>>8^u[255&(c^h.charCodeAt(m))];return-1^c}(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(t,i,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(t,i,n){var r=null;r=typeof Promise<"u"?Promise:t("lie"),i.exports={Promise:r}},{lie:37}],7:[function(t,i,n){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=t("pako"),a=t("./utils"),l=t("./stream/GenericWorker"),c=r?"uint8array":"array";function h(d,p){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=p,this.meta={}}n.magic="\b\0",a.inherits(h,l),h.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,d.data),!1)},h.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(p){d.push({data:p,meta:d.meta})}},n.compressWorker=function(d){return new h("Deflate",d)},n.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,i,n){function r(u,g){var m,b="";for(m=0;m<g;m++)b+=String.fromCharCode(255&u),u>>>=8;return b}function o(u,g,m,b,f,y){var v,w,E=u.file,S=u.compression,$=y!==c.utf8encode,M=a.transformTo("string",y(E.name)),k=a.transformTo("string",c.utf8encode(E.name)),z=E.comment,j=a.transformTo("string",y(z)),A=a.transformTo("string",c.utf8encode(z)),P=k.length!==E.name.length,_=A.length!==z.length,L="",G="",V="",K=E.dir,Y=E.date,ne={crc32:0,compressedSize:0,uncompressedSize:0};g&&!m||(ne.crc32=u.crc32,ne.compressedSize=u.compressedSize,ne.uncompressedSize=u.uncompressedSize);var R=0;g&&(R|=8),$||!P&&!_||(R|=2048);var N=0,oe=0;K&&(N|=16),f==="UNIX"?(oe=798,N|=function(te,pe){var fe=te;return te||(fe=pe?16893:33204),(65535&fe)<<16}(E.unixPermissions,K)):(oe=20,N|=function(te){return 63&(te||0)}(E.dosPermissions)),v=Y.getUTCHours(),v<<=6,v|=Y.getUTCMinutes(),v<<=5,v|=Y.getUTCSeconds()/2,w=Y.getUTCFullYear()-1980,w<<=4,w|=Y.getUTCMonth()+1,w<<=5,w|=Y.getUTCDate(),P&&(G=r(1,1)+r(h(M),4)+k,L+="up"+r(G.length,2)+G),_&&(V=r(1,1)+r(h(j),4)+A,L+="uc"+r(V.length,2)+V);var ie="";return ie+=`
\0`,ie+=r(R,2),ie+=S.magic,ie+=r(v,2),ie+=r(w,2),ie+=r(ne.crc32,4),ie+=r(ne.compressedSize,4),ie+=r(ne.uncompressedSize,4),ie+=r(M.length,2),ie+=r(L.length,2),{fileRecord:d.LOCAL_FILE_HEADER+ie+M+L,dirRecord:d.CENTRAL_FILE_HEADER+r(oe,2)+ie+r(j.length,2)+"\0\0\0\0"+r(N,4)+r(b,4)+M+L+j}}var a=t("../utils"),l=t("../stream/GenericWorker"),c=t("../utf8"),h=t("../crc32"),d=t("../signature");function p(u,g,m,b){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=m,this.encodeFileName=b,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(p,l),p.prototype.push=function(u){var g=u.meta.percent||0,m=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,l.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:m?(g+100*(m-b-1))/m:100}}))},p.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var g=this.streamFiles&&!u.file.dir;if(g){var m=o(u,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},p.prototype.closedSource=function(u){this.accumulate=!1;var g=this.streamFiles&&!u.file.dir,m=o(u,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),g)this.push({data:function(b){return d.DATA_DESCRIPTOR+r(b.crc32,4)+r(b.compressedSize,4)+r(b.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},p.prototype.flush=function(){for(var u=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var m=this.bytesWritten-u,b=function(f,y,v,w,E){var S=a.transformTo("string",E(w));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(f,2)+r(f,2)+r(y,4)+r(v,4)+r(S.length,2)+S}(this.dirRecords.length,m,u,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},p.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},p.prototype.registerPrevious=function(u){this._sources.push(u);var g=this;return u.on("data",function(m){g.processChunk(m)}),u.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),u.on("error",function(m){g.error(m)}),this},p.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},p.prototype.error=function(u){var g=this._sources;if(!l.prototype.error.call(this,u))return!1;for(var m=0;m<g.length;m++)try{g[m].error(u)}catch{}return!0},p.prototype.lock=function(){l.prototype.lock.call(this);for(var u=this._sources,g=0;g<u.length;g++)u[g].lock()},i.exports=p},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,i,n){var r=t("../compressions"),o=t("./ZipFileWorker");n.generateWorker=function(a,l,c){var h=new o(l.streamFiles,c,l.platform,l.encodeFileName),d=0;try{a.forEach(function(p,u){d++;var g=function(y,v){var w=y||v,E=r[w];if(!E)throw new Error(w+" is not a valid compression method !");return E}(u.options.compression,l.compression),m=u.options.compressionOptions||l.compressionOptions||{},b=u.dir,f=u.date;u._compressWorker(g,m).withStreamInfo("file",{name:p,dir:b,date:f,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(h)}),h.entriesCount=d}catch(p){h.error(p)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,i,n){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new r;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(r.prototype=t("./object")).loadAsync=t("./load"),r.support=t("./support"),r.defaults=t("./defaults"),r.version="3.10.1",r.loadAsync=function(o,a){return new r().loadAsync(o,a)},r.external=t("./external"),i.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,i,n){var r=t("./utils"),o=t("./external"),a=t("./utf8"),l=t("./zipEntries"),c=t("./stream/Crc32Probe"),h=t("./nodejsUtils");function d(p){return new o.Promise(function(u,g){var m=p.decompressed.getContentWorker().pipe(new c);m.on("error",function(b){g(b)}).on("end",function(){m.streamInfo.crc32!==p.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}i.exports=function(p,u){var g=this;return u=r.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),h.isNode&&h.isStream(p)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",p,!0,u.optimizedBinaryString,u.base64).then(function(m){var b=new l(u);return b.load(m),b}).then(function(m){var b=[o.Promise.resolve(m)],f=m.files;if(u.checkCRC32)for(var y=0;y<f.length;y++)b.push(d(f[y]));return o.Promise.all(b)}).then(function(m){for(var b=m.shift(),f=b.files,y=0;y<f.length;y++){var v=f[y],w=v.fileNameStr,E=r.resolve(v.fileNameStr);g.file(E,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:u.createFolders}),v.dir||(g.file(E).unsafeOriginalName=w)}return b.zipComment.length&&(g.comment=b.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,i,n){var r=t("../utils"),o=t("../stream/GenericWorker");function a(l,c){o.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}r.inherits(a,o),a.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(h){c.push({data:h,meta:{percent:0}})}).on("error",function(h){c.isPaused?this.generatedError=h:c.error(h)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,i,n){var r=t("readable-stream").Readable;function o(a,l,c){r.call(this,l),this._helper=a;var h=this;a.on("data",function(d,p){h.push(d)||h._helper.pause(),c&&c(p)}).on("error",function(d){h.emit("error",d)}).on("end",function(){h.push(null)})}t("../utils").inherits(o,r),o.prototype._read=function(){this._helper.resume()},i.exports=o},{"../utils":32,"readable-stream":16}],14:[function(t,i,n){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,o);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,o)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var o=new Buffer(r);return o.fill(0),o},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(t,i,n){function r(E,S,$){var M,k=a.getTypeOf(S),z=a.extend($||{},h);z.date=z.date||new Date,z.compression!==null&&(z.compression=z.compression.toUpperCase()),typeof z.unixPermissions=="string"&&(z.unixPermissions=parseInt(z.unixPermissions,8)),z.unixPermissions&&16384&z.unixPermissions&&(z.dir=!0),z.dosPermissions&&16&z.dosPermissions&&(z.dir=!0),z.dir&&(E=f(E)),z.createFolders&&(M=b(E))&&y.call(this,M,!0);var j=k==="string"&&z.binary===!1&&z.base64===!1;$&&$.binary!==void 0||(z.binary=!j),(S instanceof d&&S.uncompressedSize===0||z.dir||!S||S.length===0)&&(z.base64=!1,z.binary=!0,S="",z.compression="STORE",k="string");var A=null;A=S instanceof d||S instanceof l?S:g.isNode&&g.isStream(S)?new m(E,S):a.prepareContent(E,S,z.binary,z.optimizedBinaryString,z.base64);var P=new p(E,A,z);this.files[E]=P}var o=t("./utf8"),a=t("./utils"),l=t("./stream/GenericWorker"),c=t("./stream/StreamHelper"),h=t("./defaults"),d=t("./compressedObject"),p=t("./zipObject"),u=t("./generate"),g=t("./nodejsUtils"),m=t("./nodejs/NodejsStreamInputAdapter"),b=function(E){E.slice(-1)==="/"&&(E=E.substring(0,E.length-1));var S=E.lastIndexOf("/");return 0<S?E.substring(0,S):""},f=function(E){return E.slice(-1)!=="/"&&(E+="/"),E},y=function(E,S){return S=S!==void 0?S:h.createFolders,E=f(E),this.files[E]||r.call(this,E,null,{dir:!0,createFolders:S}),this.files[E]};function v(E){return Object.prototype.toString.call(E)==="[object RegExp]"}var w={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(E){var S,$,M;for(S in this.files)M=this.files[S],($=S.slice(this.root.length,S.length))&&S.slice(0,this.root.length)===this.root&&E($,M)},filter:function(E){var S=[];return this.forEach(function($,M){E($,M)&&S.push(M)}),S},file:function(E,S,$){if(arguments.length!==1)return E=this.root+E,r.call(this,E,S,$),this;if(v(E)){var M=E;return this.filter(function(z,j){return!j.dir&&M.test(z)})}var k=this.files[this.root+E];return k&&!k.dir?k:null},folder:function(E){if(!E)return this;if(v(E))return this.filter(function(k,z){return z.dir&&E.test(k)});var S=this.root+E,$=y.call(this,S),M=this.clone();return M.root=$.name,M},remove:function(E){E=this.root+E;var S=this.files[E];if(S||(E.slice(-1)!=="/"&&(E+="/"),S=this.files[E]),S&&!S.dir)delete this.files[E];else for(var $=this.filter(function(k,z){return z.name.slice(0,E.length)===E}),M=0;M<$.length;M++)delete this.files[$[M].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(E){var S,$={};try{if(($=a.extend(E||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=$.type.toLowerCase(),$.compression=$.compression.toUpperCase(),$.type==="binarystring"&&($.type="string"),!$.type)throw new Error("No output type specified.");a.checkSupport($.type),$.platform!=="darwin"&&$.platform!=="freebsd"&&$.platform!=="linux"&&$.platform!=="sunos"||($.platform="UNIX"),$.platform==="win32"&&($.platform="DOS");var M=$.comment||this.comment||"";S=u.generateWorker(this,$,M)}catch(k){(S=new l("error")).error(k)}return new c(S,$.type||"string",$.mimeType)},generateAsync:function(E,S){return this.generateInternalStream(E).accumulate(S)},generateNodeStream:function(E,S){return(E=E||{}).type||(E.type="nodebuffer"),this.generateInternalStream(E).toNodejsStream(S)}};i.exports=w},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,i,n){i.exports=t("stream")},{stream:void 0}],17:[function(t,i,n){var r=t("./DataReader");function o(a){r.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}t("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),c=a.charCodeAt(1),h=a.charCodeAt(2),d=a.charCodeAt(3),p=this.length-4;0<=p;--p)if(this.data[p]===l&&this.data[p+1]===c&&this.data[p+2]===h&&this.data[p+3]===d)return p-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),c=a.charCodeAt(1),h=a.charCodeAt(2),d=a.charCodeAt(3),p=this.readData(4);return l===p[0]&&c===p[1]&&h===p[2]&&d===p[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./DataReader":18}],18:[function(t,i,n){var r=t("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,c=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=a,c},readString:function(a){return r.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},i.exports=o},{"../utils":32}],19:[function(t,i,n){var r=t("./Uint8ArrayReader");function o(a){r.call(this,a)}t("../utils").inherits(o,r),o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,i,n){var r=t("./DataReader");function o(a){r.call(this,a)}t("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./DataReader":18}],21:[function(t,i,n){var r=t("./ArrayReader");function o(a){r.call(this,a)}t("../utils").inherits(o,r),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(t,i,n){var r=t("../utils"),o=t("../support"),a=t("./ArrayReader"),l=t("./StringReader"),c=t("./NodeBufferReader"),h=t("./Uint8ArrayReader");i.exports=function(d){var p=r.getTypeOf(d);return r.checkSupport(p),p!=="string"||o.uint8array?p==="nodebuffer"?new c(d):o.uint8array?new h(r.transformTo("uint8array",d)):new a(r.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,i,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,i,n){var r=t("./GenericWorker"),o=t("../utils");function a(l){r.call(this,"ConvertWorker to "+l),this.destType=l}o.inherits(a,r),a.prototype.processChunk=function(l){this.push({data:o.transformTo(this.destType,l.data),meta:l.meta})},i.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(t,i,n){var r=t("./GenericWorker"),o=t("../crc32");function a(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(a,r),a.prototype.processChunk=function(l){this.streamInfo.crc32=o(l.data,this.streamInfo.crc32||0),this.push(l)},i.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,i,n){var r=t("../utils"),o=t("./GenericWorker");function a(l){o.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}r.inherits(a,o),a.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}o.prototype.processChunk.call(this,l)},i.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(t,i,n){var r=t("../utils"),o=t("./GenericWorker");function a(l){o.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(h){c.dataIsReady=!0,c.data=h,c.max=h&&h.length||0,c.type=r.getTypeOf(h),c.isPaused||c._tickAndRepeat()},function(h){c.error(h)})}r.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,i,n){function r(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var l=0;l<this._listeners[o].length;l++)this._listeners[o][l].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(l){a.processChunk(l)}),o.on("end",function(){a.end()}),o.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},i.exports=r},{}],29:[function(t,i,n){var r=t("../utils"),o=t("./ConvertWorker"),a=t("./GenericWorker"),l=t("../base64"),c=t("../support"),h=t("../external"),d=null;if(c.nodestream)try{d=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function p(g,m){return new h.Promise(function(b,f){var y=[],v=g._internalType,w=g._outputType,E=g._mimeType;g.on("data",function(S,$){y.push(S),m&&m($)}).on("error",function(S){y=[],f(S)}).on("end",function(){try{var S=function($,M,k){switch($){case"blob":return r.newBlob(r.transformTo("arraybuffer",M),k);case"base64":return l.encode(M);default:return r.transformTo($,M)}}(w,function($,M){var k,z=0,j=null,A=0;for(k=0;k<M.length;k++)A+=M[k].length;switch($){case"string":return M.join("");case"array":return Array.prototype.concat.apply([],M);case"uint8array":for(j=new Uint8Array(A),k=0;k<M.length;k++)j.set(M[k],z),z+=M[k].length;return j;case"nodebuffer":return Buffer.concat(M);default:throw new Error("concat : unsupported type '"+$+"'")}}(v,y),E);b(S)}catch($){f($)}y=[]}).resume()})}function u(g,m,b){var f=m;switch(m){case"blob":case"arraybuffer":f="uint8array";break;case"base64":f="string"}try{this._internalType=f,this._outputType=m,this._mimeType=b,r.checkSupport(f),this._worker=g.pipe(new o(f)),g.lock()}catch(y){this._worker=new a("error"),this._worker.error(y)}}u.prototype={accumulate:function(g){return p(this,g)},on:function(g,m){var b=this;return g==="data"?this._worker.on(g,function(f){m.call(b,f.data,f.meta)}):this._worker.on(g,function(){r.delay(m,arguments,b)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},g)}},i.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,i,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var r=new ArrayBuffer(0);try{n.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(r),n.blob=o.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!t("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(t,i,n){for(var r=t("./utils"),o=t("./support"),a=t("./nodejsUtils"),l=t("./stream/GenericWorker"),c=new Array(256),h=0;h<256;h++)c[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;c[254]=c[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}function p(){l.call(this,"utf-8 encode")}n.utf8encode=function(u){return o.nodebuffer?a.newBufferFrom(u,"utf-8"):function(g){var m,b,f,y,v,w=g.length,E=0;for(y=0;y<w;y++)(64512&(b=g.charCodeAt(y)))==55296&&y+1<w&&(64512&(f=g.charCodeAt(y+1)))==56320&&(b=65536+(b-55296<<10)+(f-56320),y++),E+=b<128?1:b<2048?2:b<65536?3:4;for(m=o.uint8array?new Uint8Array(E):new Array(E),y=v=0;v<E;y++)(64512&(b=g.charCodeAt(y)))==55296&&y+1<w&&(64512&(f=g.charCodeAt(y+1)))==56320&&(b=65536+(b-55296<<10)+(f-56320),y++),b<128?m[v++]=b:(b<2048?m[v++]=192|b>>>6:(b<65536?m[v++]=224|b>>>12:(m[v++]=240|b>>>18,m[v++]=128|b>>>12&63),m[v++]=128|b>>>6&63),m[v++]=128|63&b);return m}(u)},n.utf8decode=function(u){return o.nodebuffer?r.transformTo("nodebuffer",u).toString("utf-8"):function(g){var m,b,f,y,v=g.length,w=new Array(2*v);for(m=b=0;m<v;)if((f=g[m++])<128)w[b++]=f;else if(4<(y=c[f]))w[b++]=65533,m+=y-1;else{for(f&=y===2?31:y===3?15:7;1<y&&m<v;)f=f<<6|63&g[m++],y--;1<y?w[b++]=65533:f<65536?w[b++]=f:(f-=65536,w[b++]=55296|f>>10&1023,w[b++]=56320|1023&f)}return w.length!==b&&(w.subarray?w=w.subarray(0,b):w.length=b),r.applyFromCharCode(w)}(u=r.transformTo(o.uint8array?"uint8array":"array",u))},r.inherits(d,l),d.prototype.processChunk=function(u){var g=r.transformTo(o.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=g;(g=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),g.set(m,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var b=function(y,v){var w;for((v=v||y.length)>y.length&&(v=y.length),w=v-1;0<=w&&(192&y[w])==128;)w--;return w<0||w===0?v:w+c[y[w]]>v?w:v}(g),f=g;b!==g.length&&(o.uint8array?(f=g.subarray(0,b),this.leftOver=g.subarray(b,g.length)):(f=g.slice(0,b),this.leftOver=g.slice(b,g.length))),this.push({data:n.utf8decode(f),meta:u.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=d,r.inherits(p,l),p.prototype.processChunk=function(u){this.push({data:n.utf8encode(u.data),meta:u.meta})},n.Utf8EncodeWorker=p},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,i,n){var r=t("./support"),o=t("./base64"),a=t("./nodejsUtils"),l=t("./external");function c(m){return m}function h(m,b){for(var f=0;f<m.length;++f)b[f]=255&m.charCodeAt(f);return b}t("setimmediate"),n.newBlob=function(m,b){n.checkSupport("blob");try{return new Blob([m],{type:b})}catch{try{var f=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return f.append(m),f.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(m,b,f){var y=[],v=0,w=m.length;if(w<=f)return String.fromCharCode.apply(null,m);for(;v<w;)b==="array"||b==="nodebuffer"?y.push(String.fromCharCode.apply(null,m.slice(v,Math.min(v+f,w)))):y.push(String.fromCharCode.apply(null,m.subarray(v,Math.min(v+f,w)))),v+=f;return y.join("")},stringifyByChar:function(m){for(var b="",f=0;f<m.length;f++)b+=String.fromCharCode(m[f]);return b},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function p(m){var b=65536,f=n.getTypeOf(m),y=!0;if(f==="uint8array"?y=d.applyCanBeUsed.uint8array:f==="nodebuffer"&&(y=d.applyCanBeUsed.nodebuffer),y)for(;1<b;)try{return d.stringifyByChunk(m,f,b)}catch{b=Math.floor(b/2)}return d.stringifyByChar(m)}function u(m,b){for(var f=0;f<m.length;f++)b[f]=m[f];return b}n.applyFromCharCode=p;var g={};g.string={string:c,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return g.string.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:function(m){return h(m,a.allocBuffer(m.length))}},g.array={string:p,array:c,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},g.arraybuffer={string:function(m){return p(new Uint8Array(m))},array:function(m){return u(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:c,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},g.uint8array={string:p,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:c,nodebuffer:function(m){return a.newBufferFrom(m)}},g.nodebuffer={string:p,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return g.nodebuffer.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:c},n.transformTo=function(m,b){if(b=b||"",!m)return b;n.checkSupport(m);var f=n.getTypeOf(b);return g[f][m](b)},n.resolve=function(m){for(var b=m.split("/"),f=[],y=0;y<b.length;y++){var v=b[y];v==="."||v===""&&y!==0&&y!==b.length-1||(v===".."?f.pop():f.push(v))}return f.join("/")},n.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":r.nodebuffer&&a.isBuffer(m)?"nodebuffer":r.uint8array&&m instanceof Uint8Array?"uint8array":r.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(m){if(!r[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(m){var b,f,y="";for(f=0;f<(m||"").length;f++)y+="\\x"+((b=m.charCodeAt(f))<16?"0":"")+b.toString(16).toUpperCase();return y},n.delay=function(m,b,f){setImmediate(function(){m.apply(f||null,b||[])})},n.inherits=function(m,b){function f(){}f.prototype=b.prototype,m.prototype=new f},n.extend=function(){var m,b,f={};for(m=0;m<arguments.length;m++)for(b in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],b)&&f[b]===void 0&&(f[b]=arguments[m][b]);return f},n.prepareContent=function(m,b,f,y,v){return l.Promise.resolve(b).then(function(w){return r.blob&&(w instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(w))!==-1)&&typeof FileReader<"u"?new l.Promise(function(E,S){var $=new FileReader;$.onload=function(M){E(M.target.result)},$.onerror=function(M){S(M.target.error)},$.readAsArrayBuffer(w)}):w}).then(function(w){var E=n.getTypeOf(w);return E?(E==="arraybuffer"?w=n.transformTo("uint8array",w):E==="string"&&(v?w=o.decode(w):f&&y!==!0&&(w=function(S){return h(S,r.uint8array?new Uint8Array(S.length):new Array(S.length))}(w))),w):l.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,i,n){var r=t("./reader/readerFor"),o=t("./utils"),a=t("./signature"),l=t("./zipEntry"),c=t("./support");function h(d){this.files=[],this.loadOptions=d}h.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var p=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(p)+", expected "+o.pretty(d)+")")}},isSignature:function(d,p){var u=this.reader.index;this.reader.setIndex(d);var g=this.reader.readString(4)===p;return this.reader.setIndex(u),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),p=c.uint8array?"uint8array":"array",u=o.transformTo(p,d);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,p,u,g=this.zip64EndOfCentralSize-44;0<g;)d=this.reader.readInt(2),p=this.reader.readInt(4),u=this.reader.readData(p),this.zip64ExtensibleData[d]={id:d,length:p,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,p;for(d=0;d<this.files.length;d++)p=this.files[d],this.reader.setIndex(p.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),p.readLocalPart(this.reader),p.handleUTF8(),p.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var p=d;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var g=p-u;if(0<g)this.isSignature(p,a.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(d){this.reader=r(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,i,n){var r=t("./reader/readerFor"),o=t("./utils"),a=t("./compressedObject"),l=t("./crc32"),c=t("./utf8"),h=t("./compressions"),d=t("./support");function p(u,g){this.options=u,this.loadOptions=g}p.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var g,m;if(u.skip(22),this.fileNameLength=u.readInt(2),m=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=function(b){for(var f in h)if(Object.prototype.hasOwnProperty.call(h,f)&&h[f].magic===b)return h[f];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,g,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var g=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(g),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var g,m,b,f=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<f;)g=u.readInt(2),m=u.readInt(2),b=u.readData(m),this.extraFields[g]={id:g,length:m,value:b};u.setIndex(f)},handleUTF8:function(){var u=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var m=o.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var f=o.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(f)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var g=r(u.value);return g.readInt(1)!==1||l(this.fileName)!==g.readInt(4)?null:c.utf8decode(g.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var g=r(u.value);return g.readInt(1)!==1||l(this.fileComment)!==g.readInt(4)?null:c.utf8decode(g.readData(u.length-5))}return null}},i.exports=p},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,i,n){function r(g,m,b){this.name=g,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=m,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=t("./stream/StreamHelper"),a=t("./stream/DataWorker"),l=t("./utf8"),c=t("./compressedObject"),h=t("./stream/GenericWorker");r.prototype={internalStream:function(g){var m=null,b="string";try{if(!g)throw new Error("No output type specified.");var f=(b=g.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),m=this._decompressWorker();var y=!this._dataBinary;y&&!f&&(m=m.pipe(new l.Utf8EncodeWorker)),!y&&f&&(m=m.pipe(new l.Utf8DecodeWorker))}catch(v){(m=new h("error")).error(v)}return new o(m,b,"")},async:function(g,m){return this.internalStream(g).accumulate(m)},nodeStream:function(g,m){return this.internalStream(g||"nodebuffer").toNodejsStream(m)},_compressWorker:function(g,m){if(this._data instanceof c&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(b,g,m)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof h?this._data:new a(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],p=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<d.length;u++)r.prototype[d[u]]=p;i.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,i,n){(function(r){var o,a,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var c=0,h=new l(g),d=r.document.createTextNode("");h.observe(d,{characterData:!0}),o=function(){d.data=c=++c%2}}else if(r.setImmediate||r.MessageChannel===void 0)o="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var m=r.document.createElement("script");m.onreadystatechange=function(){g(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},r.document.documentElement.appendChild(m)}:function(){setTimeout(g,0)};else{var p=new r.MessageChannel;p.port1.onmessage=g,o=function(){p.port2.postMessage(0)}}var u=[];function g(){var m,b;a=!0;for(var f=u.length;f;){for(b=u,u=[],m=-1;++m<f;)b[m]();f=u.length}a=!1}i.exports=function(m){u.push(m)!==1||a||o()}}).call(this,typeof Mr<"u"?Mr:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,i,n){var r=t("immediate");function o(){}var a={},l=["REJECTED"],c=["FULFILLED"],h=["PENDING"];function d(f){if(typeof f!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,f!==o&&m(this,f)}function p(f,y,v){this.promise=f,typeof y=="function"&&(this.onFulfilled=y,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function u(f,y,v){r(function(){var w;try{w=y(v)}catch(E){return a.reject(f,E)}w===f?a.reject(f,new TypeError("Cannot resolve promise with itself")):a.resolve(f,w)})}function g(f){var y=f&&f.then;if(f&&(typeof f=="object"||typeof f=="function")&&typeof y=="function")return function(){y.apply(f,arguments)}}function m(f,y){var v=!1;function w($){v||(v=!0,a.reject(f,$))}function E($){v||(v=!0,a.resolve(f,$))}var S=b(function(){y(E,w)});S.status==="error"&&w(S.value)}function b(f,y){var v={};try{v.value=f(y),v.status="success"}catch(w){v.status="error",v.value=w}return v}(i.exports=d).prototype.finally=function(f){if(typeof f!="function")return this;var y=this.constructor;return this.then(function(v){return y.resolve(f()).then(function(){return v})},function(v){return y.resolve(f()).then(function(){throw v})})},d.prototype.catch=function(f){return this.then(null,f)},d.prototype.then=function(f,y){if(typeof f!="function"&&this.state===c||typeof y!="function"&&this.state===l)return this;var v=new this.constructor(o);return this.state!==h?u(v,this.state===c?f:y,this.outcome):this.queue.push(new p(v,f,y)),v},p.prototype.callFulfilled=function(f){a.resolve(this.promise,f)},p.prototype.otherCallFulfilled=function(f){u(this.promise,this.onFulfilled,f)},p.prototype.callRejected=function(f){a.reject(this.promise,f)},p.prototype.otherCallRejected=function(f){u(this.promise,this.onRejected,f)},a.resolve=function(f,y){var v=b(g,y);if(v.status==="error")return a.reject(f,v.value);var w=v.value;if(w)m(f,w);else{f.state=c,f.outcome=y;for(var E=-1,S=f.queue.length;++E<S;)f.queue[E].callFulfilled(y)}return f},a.reject=function(f,y){f.state=l,f.outcome=y;for(var v=-1,w=f.queue.length;++v<w;)f.queue[v].callRejected(y);return f},d.resolve=function(f){return f instanceof this?f:a.resolve(new this(o),f)},d.reject=function(f){var y=new this(o);return a.reject(y,f)},d.all=function(f){var y=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=f.length,w=!1;if(!v)return this.resolve([]);for(var E=new Array(v),S=0,$=-1,M=new this(o);++$<v;)k(f[$],$);return M;function k(z,j){y.resolve(z).then(function(A){E[j]=A,++S!==v||w||(w=!0,a.resolve(M,E))},function(A){w||(w=!0,a.reject(M,A))})}},d.race=function(f){var y=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=f.length,w=!1;if(!v)return this.resolve([]);for(var E=-1,S=new this(o);++E<v;)$=f[E],y.resolve($).then(function(M){w||(w=!0,a.resolve(S,M))},function(M){w||(w=!0,a.reject(S,M))});var $;return S}},{immediate:36}],38:[function(t,i,n){var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),i.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,i,n){var r=t("./zlib/deflate"),o=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/messages"),c=t("./zlib/zstream"),h=Object.prototype.toString,d=0,p=-1,u=0,g=8;function m(f){if(!(this instanceof m))return new m(f);this.options=o.assign({level:p,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},f||{});var y=this.options;y.raw&&0<y.windowBits?y.windowBits=-y.windowBits:y.gzip&&0<y.windowBits&&y.windowBits<16&&(y.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var v=r.deflateInit2(this.strm,y.level,y.method,y.windowBits,y.memLevel,y.strategy);if(v!==d)throw new Error(l[v]);if(y.header&&r.deflateSetHeader(this.strm,y.header),y.dictionary){var w;if(w=typeof y.dictionary=="string"?a.string2buf(y.dictionary):h.call(y.dictionary)==="[object ArrayBuffer]"?new Uint8Array(y.dictionary):y.dictionary,(v=r.deflateSetDictionary(this.strm,w))!==d)throw new Error(l[v]);this._dict_set=!0}}function b(f,y){var v=new m(y);if(v.push(f,!0),v.err)throw v.msg||l[v.err];return v.result}m.prototype.push=function(f,y){var v,w,E=this.strm,S=this.options.chunkSize;if(this.ended)return!1;w=y===~~y?y:y===!0?4:0,typeof f=="string"?E.input=a.string2buf(f):h.call(f)==="[object ArrayBuffer]"?E.input=new Uint8Array(f):E.input=f,E.next_in=0,E.avail_in=E.input.length;do{if(E.avail_out===0&&(E.output=new o.Buf8(S),E.next_out=0,E.avail_out=S),(v=r.deflate(E,w))!==1&&v!==d)return this.onEnd(v),!(this.ended=!0);E.avail_out!==0&&(E.avail_in!==0||w!==4&&w!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(E.output,E.next_out))):this.onData(o.shrinkBuf(E.output,E.next_out)))}while((0<E.avail_in||E.avail_out===0)&&v!==1);return w===4?(v=r.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===d):w!==2||(this.onEnd(d),!(E.avail_out=0))},m.prototype.onData=function(f){this.chunks.push(f)},m.prototype.onEnd=function(f){f===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},n.Deflate=m,n.deflate=b,n.deflateRaw=function(f,y){return(y=y||{}).raw=!0,b(f,y)},n.gzip=function(f,y){return(y=y||{}).gzip=!0,b(f,y)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,i,n){var r=t("./zlib/inflate"),o=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/constants"),c=t("./zlib/messages"),h=t("./zlib/zstream"),d=t("./zlib/gzheader"),p=Object.prototype.toString;function u(m){if(!(this instanceof u))return new u(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||m&&m.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var f=r.inflateInit2(this.strm,b.windowBits);if(f!==l.Z_OK)throw new Error(c[f]);this.header=new d,r.inflateGetHeader(this.strm,this.header)}function g(m,b){var f=new u(b);if(f.push(m,!0),f.err)throw f.msg||c[f.err];return f.result}u.prototype.push=function(m,b){var f,y,v,w,E,S,$=this.strm,M=this.options.chunkSize,k=this.options.dictionary,z=!1;if(this.ended)return!1;y=b===~~b?b:b===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof m=="string"?$.input=a.binstring2buf(m):p.call(m)==="[object ArrayBuffer]"?$.input=new Uint8Array(m):$.input=m,$.next_in=0,$.avail_in=$.input.length;do{if($.avail_out===0&&($.output=new o.Buf8(M),$.next_out=0,$.avail_out=M),(f=r.inflate($,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&k&&(S=typeof k=="string"?a.string2buf(k):p.call(k)==="[object ArrayBuffer]"?new Uint8Array(k):k,f=r.inflateSetDictionary(this.strm,S)),f===l.Z_BUF_ERROR&&z===!0&&(f=l.Z_OK,z=!1),f!==l.Z_STREAM_END&&f!==l.Z_OK)return this.onEnd(f),!(this.ended=!0);$.next_out&&($.avail_out!==0&&f!==l.Z_STREAM_END&&($.avail_in!==0||y!==l.Z_FINISH&&y!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=a.utf8border($.output,$.next_out),w=$.next_out-v,E=a.buf2string($.output,v),$.next_out=w,$.avail_out=M-w,w&&o.arraySet($.output,$.output,v,w,0),this.onData(E)):this.onData(o.shrinkBuf($.output,$.next_out)))),$.avail_in===0&&$.avail_out===0&&(z=!0)}while((0<$.avail_in||$.avail_out===0)&&f!==l.Z_STREAM_END);return f===l.Z_STREAM_END&&(y=l.Z_FINISH),y===l.Z_FINISH?(f=r.inflateEnd(this.strm),this.onEnd(f),this.ended=!0,f===l.Z_OK):y!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!($.avail_out=0))},u.prototype.onData=function(m){this.chunks.push(m)},u.prototype.onEnd=function(m){m===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},n.Inflate=u,n.inflate=g,n.inflateRaw=function(m,b){return(b=b||{}).raw=!0,g(m,b)},n.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,i,n){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var h=c.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var d in h)h.hasOwnProperty(d)&&(l[d]=h[d])}}return l},n.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var o={arraySet:function(l,c,h,d,p){if(c.subarray&&l.subarray)l.set(c.subarray(h,h+d),p);else for(var u=0;u<d;u++)l[p+u]=c[h+u]},flattenChunks:function(l){var c,h,d,p,u,g;for(c=d=0,h=l.length;c<h;c++)d+=l[c].length;for(g=new Uint8Array(d),c=p=0,h=l.length;c<h;c++)u=l[c],g.set(u,p),p+=u.length;return g}},a={arraySet:function(l,c,h,d,p){for(var u=0;u<d;u++)l[p+u]=c[h+u]},flattenChunks:function(l){return[].concat.apply([],l)}};n.setTyped=function(l){l?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(r)},{}],42:[function(t,i,n){var r=t("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new r.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function h(d,p){if(p<65537&&(d.subarray&&a||!d.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(d,p));for(var u="",g=0;g<p;g++)u+=String.fromCharCode(d[g]);return u}l[254]=l[254]=1,n.string2buf=function(d){var p,u,g,m,b,f=d.length,y=0;for(m=0;m<f;m++)(64512&(u=d.charCodeAt(m)))==55296&&m+1<f&&(64512&(g=d.charCodeAt(m+1)))==56320&&(u=65536+(u-55296<<10)+(g-56320),m++),y+=u<128?1:u<2048?2:u<65536?3:4;for(p=new r.Buf8(y),m=b=0;b<y;m++)(64512&(u=d.charCodeAt(m)))==55296&&m+1<f&&(64512&(g=d.charCodeAt(m+1)))==56320&&(u=65536+(u-55296<<10)+(g-56320),m++),u<128?p[b++]=u:(u<2048?p[b++]=192|u>>>6:(u<65536?p[b++]=224|u>>>12:(p[b++]=240|u>>>18,p[b++]=128|u>>>12&63),p[b++]=128|u>>>6&63),p[b++]=128|63&u);return p},n.buf2binstring=function(d){return h(d,d.length)},n.binstring2buf=function(d){for(var p=new r.Buf8(d.length),u=0,g=p.length;u<g;u++)p[u]=d.charCodeAt(u);return p},n.buf2string=function(d,p){var u,g,m,b,f=p||d.length,y=new Array(2*f);for(u=g=0;u<f;)if((m=d[u++])<128)y[g++]=m;else if(4<(b=l[m]))y[g++]=65533,u+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&u<f;)m=m<<6|63&d[u++],b--;1<b?y[g++]=65533:m<65536?y[g++]=m:(m-=65536,y[g++]=55296|m>>10&1023,y[g++]=56320|1023&m)}return h(y,g)},n.utf8border=function(d,p){var u;for((p=p||d.length)>d.length&&(p=d.length),u=p-1;0<=u&&(192&d[u])==128;)u--;return u<0||u===0?p:u+l[d[u]]>p?u:p}},{"./common":41}],43:[function(t,i,n){i.exports=function(r,o,a,l){for(var c=65535&r|0,h=r>>>16&65535|0,d=0;a!==0;){for(a-=d=2e3<a?2e3:a;h=h+(c=c+o[l++]|0)|0,--d;);c%=65521,h%=65521}return c|h<<16|0}},{}],44:[function(t,i,n){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,i,n){var r=function(){for(var o,a=[],l=0;l<256;l++){o=l;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;a[l]=o}return a}();i.exports=function(o,a,l,c){var h=r,d=c+l;o^=-1;for(var p=c;p<d;p++)o=o>>>8^h[255&(o^a[p])];return-1^o}},{}],46:[function(t,i,n){var r,o=t("../utils/common"),a=t("./trees"),l=t("./adler32"),c=t("./crc32"),h=t("./messages"),d=0,p=4,u=0,g=-2,m=-1,b=4,f=2,y=8,v=9,w=286,E=30,S=19,$=2*w+1,M=15,k=3,z=258,j=z+k+1,A=42,P=113,_=1,L=2,G=3,V=4;function K(x,Z){return x.msg=h[Z],Z}function Y(x){return(x<<1)-(4<x?9:0)}function ne(x){for(var Z=x.length;0<=--Z;)x[Z]=0}function R(x){var Z=x.state,q=Z.pending;q>x.avail_out&&(q=x.avail_out),q!==0&&(o.arraySet(x.output,Z.pending_buf,Z.pending_out,q,x.next_out),x.next_out+=q,Z.pending_out+=q,x.total_out+=q,x.avail_out-=q,Z.pending-=q,Z.pending===0&&(Z.pending_out=0))}function N(x,Z){a._tr_flush_block(x,0<=x.block_start?x.block_start:-1,x.strstart-x.block_start,Z),x.block_start=x.strstart,R(x.strm)}function oe(x,Z){x.pending_buf[x.pending++]=Z}function ie(x,Z){x.pending_buf[x.pending++]=Z>>>8&255,x.pending_buf[x.pending++]=255&Z}function te(x,Z){var q,I,O=x.max_chain_length,B=x.strstart,X=x.prev_length,Q=x.nice_match,U=x.strstart>x.w_size-j?x.strstart-(x.w_size-j):0,ee=x.window,ae=x.w_mask,se=x.prev,ce=x.strstart+z,Oe=ee[B+X-1],ye=ee[B+X];x.prev_length>=x.good_match&&(O>>=2),Q>x.lookahead&&(Q=x.lookahead);do if(ee[(q=Z)+X]===ye&&ee[q+X-1]===Oe&&ee[q]===ee[B]&&ee[++q]===ee[B+1]){B+=2,q++;do;while(ee[++B]===ee[++q]&&ee[++B]===ee[++q]&&ee[++B]===ee[++q]&&ee[++B]===ee[++q]&&ee[++B]===ee[++q]&&ee[++B]===ee[++q]&&ee[++B]===ee[++q]&&ee[++B]===ee[++q]&&B<ce);if(I=z-(ce-B),B=ce-z,X<I){if(x.match_start=Z,Q<=(X=I))break;Oe=ee[B+X-1],ye=ee[B+X]}}while((Z=se[Z&ae])>U&&--O!=0);return X<=x.lookahead?X:x.lookahead}function pe(x){var Z,q,I,O,B,X,Q,U,ee,ae,se=x.w_size;do{if(O=x.window_size-x.lookahead-x.strstart,x.strstart>=se+(se-j)){for(o.arraySet(x.window,x.window,se,se,0),x.match_start-=se,x.strstart-=se,x.block_start-=se,Z=q=x.hash_size;I=x.head[--Z],x.head[Z]=se<=I?I-se:0,--q;);for(Z=q=se;I=x.prev[--Z],x.prev[Z]=se<=I?I-se:0,--q;);O+=se}if(x.strm.avail_in===0)break;if(X=x.strm,Q=x.window,U=x.strstart+x.lookahead,ee=O,ae=void 0,ae=X.avail_in,ee<ae&&(ae=ee),q=ae===0?0:(X.avail_in-=ae,o.arraySet(Q,X.input,X.next_in,ae,U),X.state.wrap===1?X.adler=l(X.adler,Q,ae,U):X.state.wrap===2&&(X.adler=c(X.adler,Q,ae,U)),X.next_in+=ae,X.total_in+=ae,ae),x.lookahead+=q,x.lookahead+x.insert>=k)for(B=x.strstart-x.insert,x.ins_h=x.window[B],x.ins_h=(x.ins_h<<x.hash_shift^x.window[B+1])&x.hash_mask;x.insert&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[B+k-1])&x.hash_mask,x.prev[B&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=B,B++,x.insert--,!(x.lookahead+x.insert<k)););}while(x.lookahead<j&&x.strm.avail_in!==0)}function fe(x,Z){for(var q,I;;){if(x.lookahead<j){if(pe(x),x.lookahead<j&&Z===d)return _;if(x.lookahead===0)break}if(q=0,x.lookahead>=k&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+k-1])&x.hash_mask,q=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),q!==0&&x.strstart-q<=x.w_size-j&&(x.match_length=te(x,q)),x.match_length>=k)if(I=a._tr_tally(x,x.strstart-x.match_start,x.match_length-k),x.lookahead-=x.match_length,x.match_length<=x.max_lazy_match&&x.lookahead>=k){for(x.match_length--;x.strstart++,x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+k-1])&x.hash_mask,q=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart,--x.match_length!=0;);x.strstart++}else x.strstart+=x.match_length,x.match_length=0,x.ins_h=x.window[x.strstart],x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+1])&x.hash_mask;else I=a._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++;if(I&&(N(x,!1),x.strm.avail_out===0))return _}return x.insert=x.strstart<k-1?x.strstart:k-1,Z===p?(N(x,!0),x.strm.avail_out===0?G:V):x.last_lit&&(N(x,!1),x.strm.avail_out===0)?_:L}function de(x,Z){for(var q,I,O;;){if(x.lookahead<j){if(pe(x),x.lookahead<j&&Z===d)return _;if(x.lookahead===0)break}if(q=0,x.lookahead>=k&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+k-1])&x.hash_mask,q=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),x.prev_length=x.match_length,x.prev_match=x.match_start,x.match_length=k-1,q!==0&&x.prev_length<x.max_lazy_match&&x.strstart-q<=x.w_size-j&&(x.match_length=te(x,q),x.match_length<=5&&(x.strategy===1||x.match_length===k&&4096<x.strstart-x.match_start)&&(x.match_length=k-1)),x.prev_length>=k&&x.match_length<=x.prev_length){for(O=x.strstart+x.lookahead-k,I=a._tr_tally(x,x.strstart-1-x.prev_match,x.prev_length-k),x.lookahead-=x.prev_length-1,x.prev_length-=2;++x.strstart<=O&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+k-1])&x.hash_mask,q=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),--x.prev_length!=0;);if(x.match_available=0,x.match_length=k-1,x.strstart++,I&&(N(x,!1),x.strm.avail_out===0))return _}else if(x.match_available){if((I=a._tr_tally(x,0,x.window[x.strstart-1]))&&N(x,!1),x.strstart++,x.lookahead--,x.strm.avail_out===0)return _}else x.match_available=1,x.strstart++,x.lookahead--}return x.match_available&&(I=a._tr_tally(x,0,x.window[x.strstart-1]),x.match_available=0),x.insert=x.strstart<k-1?x.strstart:k-1,Z===p?(N(x,!0),x.strm.avail_out===0?G:V):x.last_lit&&(N(x,!1),x.strm.avail_out===0)?_:L}function me(x,Z,q,I,O){this.good_length=x,this.max_lazy=Z,this.nice_length=q,this.max_chain=I,this.func=O}function Ee(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*$),this.dyn_dtree=new o.Buf16(2*(2*E+1)),this.bl_tree=new o.Buf16(2*(2*S+1)),ne(this.dyn_ltree),ne(this.dyn_dtree),ne(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(M+1),this.heap=new o.Buf16(2*w+1),ne(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*w+1),ne(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Pe(x){var Z;return x&&x.state?(x.total_in=x.total_out=0,x.data_type=f,(Z=x.state).pending=0,Z.pending_out=0,Z.wrap<0&&(Z.wrap=-Z.wrap),Z.status=Z.wrap?A:P,x.adler=Z.wrap===2?0:1,Z.last_flush=d,a._tr_init(Z),u):K(x,g)}function ct(x){var Z=Pe(x);return Z===u&&function(q){q.window_size=2*q.w_size,ne(q.head),q.max_lazy_match=r[q.level].max_lazy,q.good_match=r[q.level].good_length,q.nice_match=r[q.level].nice_length,q.max_chain_length=r[q.level].max_chain,q.strstart=0,q.block_start=0,q.lookahead=0,q.insert=0,q.match_length=q.prev_length=k-1,q.match_available=0,q.ins_h=0}(x.state),Z}function Je(x,Z,q,I,O,B){if(!x)return g;var X=1;if(Z===m&&(Z=6),I<0?(X=0,I=-I):15<I&&(X=2,I-=16),O<1||v<O||q!==y||I<8||15<I||Z<0||9<Z||B<0||b<B)return K(x,g);I===8&&(I=9);var Q=new Ee;return(x.state=Q).strm=x,Q.wrap=X,Q.gzhead=null,Q.w_bits=I,Q.w_size=1<<Q.w_bits,Q.w_mask=Q.w_size-1,Q.hash_bits=O+7,Q.hash_size=1<<Q.hash_bits,Q.hash_mask=Q.hash_size-1,Q.hash_shift=~~((Q.hash_bits+k-1)/k),Q.window=new o.Buf8(2*Q.w_size),Q.head=new o.Buf16(Q.hash_size),Q.prev=new o.Buf16(Q.w_size),Q.lit_bufsize=1<<O+6,Q.pending_buf_size=4*Q.lit_bufsize,Q.pending_buf=new o.Buf8(Q.pending_buf_size),Q.d_buf=1*Q.lit_bufsize,Q.l_buf=3*Q.lit_bufsize,Q.level=Z,Q.strategy=B,Q.method=q,ct(x)}r=[new me(0,0,0,0,function(x,Z){var q=65535;for(q>x.pending_buf_size-5&&(q=x.pending_buf_size-5);;){if(x.lookahead<=1){if(pe(x),x.lookahead===0&&Z===d)return _;if(x.lookahead===0)break}x.strstart+=x.lookahead,x.lookahead=0;var I=x.block_start+q;if((x.strstart===0||x.strstart>=I)&&(x.lookahead=x.strstart-I,x.strstart=I,N(x,!1),x.strm.avail_out===0)||x.strstart-x.block_start>=x.w_size-j&&(N(x,!1),x.strm.avail_out===0))return _}return x.insert=0,Z===p?(N(x,!0),x.strm.avail_out===0?G:V):(x.strstart>x.block_start&&(N(x,!1),x.strm.avail_out),_)}),new me(4,4,8,4,fe),new me(4,5,16,8,fe),new me(4,6,32,32,fe),new me(4,4,16,16,de),new me(8,16,32,32,de),new me(8,16,128,128,de),new me(8,32,128,256,de),new me(32,128,258,1024,de),new me(32,258,258,4096,de)],n.deflateInit=function(x,Z){return Je(x,Z,y,15,8,0)},n.deflateInit2=Je,n.deflateReset=ct,n.deflateResetKeep=Pe,n.deflateSetHeader=function(x,Z){return x&&x.state?x.state.wrap!==2?g:(x.state.gzhead=Z,u):g},n.deflate=function(x,Z){var q,I,O,B;if(!x||!x.state||5<Z||Z<0)return x?K(x,g):g;if(I=x.state,!x.output||!x.input&&x.avail_in!==0||I.status===666&&Z!==p)return K(x,x.avail_out===0?-5:g);if(I.strm=x,q=I.last_flush,I.last_flush=Z,I.status===A)if(I.wrap===2)x.adler=0,oe(I,31),oe(I,139),oe(I,8),I.gzhead?(oe(I,(I.gzhead.text?1:0)+(I.gzhead.hcrc?2:0)+(I.gzhead.extra?4:0)+(I.gzhead.name?8:0)+(I.gzhead.comment?16:0)),oe(I,255&I.gzhead.time),oe(I,I.gzhead.time>>8&255),oe(I,I.gzhead.time>>16&255),oe(I,I.gzhead.time>>24&255),oe(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),oe(I,255&I.gzhead.os),I.gzhead.extra&&I.gzhead.extra.length&&(oe(I,255&I.gzhead.extra.length),oe(I,I.gzhead.extra.length>>8&255)),I.gzhead.hcrc&&(x.adler=c(x.adler,I.pending_buf,I.pending,0)),I.gzindex=0,I.status=69):(oe(I,0),oe(I,0),oe(I,0),oe(I,0),oe(I,0),oe(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),oe(I,3),I.status=P);else{var X=y+(I.w_bits-8<<4)<<8;X|=(2<=I.strategy||I.level<2?0:I.level<6?1:I.level===6?2:3)<<6,I.strstart!==0&&(X|=32),X+=31-X%31,I.status=P,ie(I,X),I.strstart!==0&&(ie(I,x.adler>>>16),ie(I,65535&x.adler)),x.adler=1}if(I.status===69)if(I.gzhead.extra){for(O=I.pending;I.gzindex<(65535&I.gzhead.extra.length)&&(I.pending!==I.pending_buf_size||(I.gzhead.hcrc&&I.pending>O&&(x.adler=c(x.adler,I.pending_buf,I.pending-O,O)),R(x),O=I.pending,I.pending!==I.pending_buf_size));)oe(I,255&I.gzhead.extra[I.gzindex]),I.gzindex++;I.gzhead.hcrc&&I.pending>O&&(x.adler=c(x.adler,I.pending_buf,I.pending-O,O)),I.gzindex===I.gzhead.extra.length&&(I.gzindex=0,I.status=73)}else I.status=73;if(I.status===73)if(I.gzhead.name){O=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>O&&(x.adler=c(x.adler,I.pending_buf,I.pending-O,O)),R(x),O=I.pending,I.pending===I.pending_buf_size)){B=1;break}B=I.gzindex<I.gzhead.name.length?255&I.gzhead.name.charCodeAt(I.gzindex++):0,oe(I,B)}while(B!==0);I.gzhead.hcrc&&I.pending>O&&(x.adler=c(x.adler,I.pending_buf,I.pending-O,O)),B===0&&(I.gzindex=0,I.status=91)}else I.status=91;if(I.status===91)if(I.gzhead.comment){O=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>O&&(x.adler=c(x.adler,I.pending_buf,I.pending-O,O)),R(x),O=I.pending,I.pending===I.pending_buf_size)){B=1;break}B=I.gzindex<I.gzhead.comment.length?255&I.gzhead.comment.charCodeAt(I.gzindex++):0,oe(I,B)}while(B!==0);I.gzhead.hcrc&&I.pending>O&&(x.adler=c(x.adler,I.pending_buf,I.pending-O,O)),B===0&&(I.status=103)}else I.status=103;if(I.status===103&&(I.gzhead.hcrc?(I.pending+2>I.pending_buf_size&&R(x),I.pending+2<=I.pending_buf_size&&(oe(I,255&x.adler),oe(I,x.adler>>8&255),x.adler=0,I.status=P)):I.status=P),I.pending!==0){if(R(x),x.avail_out===0)return I.last_flush=-1,u}else if(x.avail_in===0&&Y(Z)<=Y(q)&&Z!==p)return K(x,-5);if(I.status===666&&x.avail_in!==0)return K(x,-5);if(x.avail_in!==0||I.lookahead!==0||Z!==d&&I.status!==666){var Q=I.strategy===2?function(U,ee){for(var ae;;){if(U.lookahead===0&&(pe(U),U.lookahead===0)){if(ee===d)return _;break}if(U.match_length=0,ae=a._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++,ae&&(N(U,!1),U.strm.avail_out===0))return _}return U.insert=0,ee===p?(N(U,!0),U.strm.avail_out===0?G:V):U.last_lit&&(N(U,!1),U.strm.avail_out===0)?_:L}(I,Z):I.strategy===3?function(U,ee){for(var ae,se,ce,Oe,ye=U.window;;){if(U.lookahead<=z){if(pe(U),U.lookahead<=z&&ee===d)return _;if(U.lookahead===0)break}if(U.match_length=0,U.lookahead>=k&&0<U.strstart&&(se=ye[ce=U.strstart-1])===ye[++ce]&&se===ye[++ce]&&se===ye[++ce]){Oe=U.strstart+z;do;while(se===ye[++ce]&&se===ye[++ce]&&se===ye[++ce]&&se===ye[++ce]&&se===ye[++ce]&&se===ye[++ce]&&se===ye[++ce]&&se===ye[++ce]&&ce<Oe);U.match_length=z-(Oe-ce),U.match_length>U.lookahead&&(U.match_length=U.lookahead)}if(U.match_length>=k?(ae=a._tr_tally(U,1,U.match_length-k),U.lookahead-=U.match_length,U.strstart+=U.match_length,U.match_length=0):(ae=a._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++),ae&&(N(U,!1),U.strm.avail_out===0))return _}return U.insert=0,ee===p?(N(U,!0),U.strm.avail_out===0?G:V):U.last_lit&&(N(U,!1),U.strm.avail_out===0)?_:L}(I,Z):r[I.level].func(I,Z);if(Q!==G&&Q!==V||(I.status=666),Q===_||Q===G)return x.avail_out===0&&(I.last_flush=-1),u;if(Q===L&&(Z===1?a._tr_align(I):Z!==5&&(a._tr_stored_block(I,0,0,!1),Z===3&&(ne(I.head),I.lookahead===0&&(I.strstart=0,I.block_start=0,I.insert=0))),R(x),x.avail_out===0))return I.last_flush=-1,u}return Z!==p?u:I.wrap<=0?1:(I.wrap===2?(oe(I,255&x.adler),oe(I,x.adler>>8&255),oe(I,x.adler>>16&255),oe(I,x.adler>>24&255),oe(I,255&x.total_in),oe(I,x.total_in>>8&255),oe(I,x.total_in>>16&255),oe(I,x.total_in>>24&255)):(ie(I,x.adler>>>16),ie(I,65535&x.adler)),R(x),0<I.wrap&&(I.wrap=-I.wrap),I.pending!==0?u:1)},n.deflateEnd=function(x){var Z;return x&&x.state?(Z=x.state.status)!==A&&Z!==69&&Z!==73&&Z!==91&&Z!==103&&Z!==P&&Z!==666?K(x,g):(x.state=null,Z===P?K(x,-3):u):g},n.deflateSetDictionary=function(x,Z){var q,I,O,B,X,Q,U,ee,ae=Z.length;if(!x||!x.state||(B=(q=x.state).wrap)===2||B===1&&q.status!==A||q.lookahead)return g;for(B===1&&(x.adler=l(x.adler,Z,ae,0)),q.wrap=0,ae>=q.w_size&&(B===0&&(ne(q.head),q.strstart=0,q.block_start=0,q.insert=0),ee=new o.Buf8(q.w_size),o.arraySet(ee,Z,ae-q.w_size,q.w_size,0),Z=ee,ae=q.w_size),X=x.avail_in,Q=x.next_in,U=x.input,x.avail_in=ae,x.next_in=0,x.input=Z,pe(q);q.lookahead>=k;){for(I=q.strstart,O=q.lookahead-(k-1);q.ins_h=(q.ins_h<<q.hash_shift^q.window[I+k-1])&q.hash_mask,q.prev[I&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=I,I++,--O;);q.strstart=I,q.lookahead=k-1,pe(q)}return q.strstart+=q.lookahead,q.block_start=q.strstart,q.insert=q.lookahead,q.lookahead=0,q.match_length=q.prev_length=k-1,q.match_available=0,x.next_in=Q,x.input=U,x.avail_in=X,q.wrap=B,u},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,i,n){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,i,n){i.exports=function(r,o){var a,l,c,h,d,p,u,g,m,b,f,y,v,w,E,S,$,M,k,z,j,A,P,_,L;a=r.state,l=r.next_in,_=r.input,c=l+(r.avail_in-5),h=r.next_out,L=r.output,d=h-(o-r.avail_out),p=h+(r.avail_out-257),u=a.dmax,g=a.wsize,m=a.whave,b=a.wnext,f=a.window,y=a.hold,v=a.bits,w=a.lencode,E=a.distcode,S=(1<<a.lenbits)-1,$=(1<<a.distbits)-1;e:do{v<15&&(y+=_[l++]<<v,v+=8,y+=_[l++]<<v,v+=8),M=w[y&S];t:for(;;){if(y>>>=k=M>>>24,v-=k,(k=M>>>16&255)===0)L[h++]=65535&M;else{if(!(16&k)){if(!(64&k)){M=w[(65535&M)+(y&(1<<k)-1)];continue t}if(32&k){a.mode=12;break e}r.msg="invalid literal/length code",a.mode=30;break e}z=65535&M,(k&=15)&&(v<k&&(y+=_[l++]<<v,v+=8),z+=y&(1<<k)-1,y>>>=k,v-=k),v<15&&(y+=_[l++]<<v,v+=8,y+=_[l++]<<v,v+=8),M=E[y&$];i:for(;;){if(y>>>=k=M>>>24,v-=k,!(16&(k=M>>>16&255))){if(!(64&k)){M=E[(65535&M)+(y&(1<<k)-1)];continue i}r.msg="invalid distance code",a.mode=30;break e}if(j=65535&M,v<(k&=15)&&(y+=_[l++]<<v,(v+=8)<k&&(y+=_[l++]<<v,v+=8)),u<(j+=y&(1<<k)-1)){r.msg="invalid distance too far back",a.mode=30;break e}if(y>>>=k,v-=k,(k=h-d)<j){if(m<(k=j-k)&&a.sane){r.msg="invalid distance too far back",a.mode=30;break e}if(P=f,(A=0)===b){if(A+=g-k,k<z){for(z-=k;L[h++]=f[A++],--k;);A=h-j,P=L}}else if(b<k){if(A+=g+b-k,(k-=b)<z){for(z-=k;L[h++]=f[A++],--k;);if(A=0,b<z){for(z-=k=b;L[h++]=f[A++],--k;);A=h-j,P=L}}}else if(A+=b-k,k<z){for(z-=k;L[h++]=f[A++],--k;);A=h-j,P=L}for(;2<z;)L[h++]=P[A++],L[h++]=P[A++],L[h++]=P[A++],z-=3;z&&(L[h++]=P[A++],1<z&&(L[h++]=P[A++]))}else{for(A=h-j;L[h++]=L[A++],L[h++]=L[A++],L[h++]=L[A++],2<(z-=3););z&&(L[h++]=L[A++],1<z&&(L[h++]=L[A++]))}break}}break}}while(l<c&&h<p);l-=z=v>>3,y&=(1<<(v-=z<<3))-1,r.next_in=l,r.next_out=h,r.avail_in=l<c?c-l+5:5-(l-c),r.avail_out=h<p?p-h+257:257-(h-p),a.hold=y,a.bits=v}},{}],49:[function(t,i,n){var r=t("../utils/common"),o=t("./adler32"),a=t("./crc32"),l=t("./inffast"),c=t("./inftrees"),h=1,d=2,p=0,u=-2,g=1,m=852,b=592;function f(A){return(A>>>24&255)+(A>>>8&65280)+((65280&A)<<8)+((255&A)<<24)}function y(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(A){var P;return A&&A.state?(P=A.state,A.total_in=A.total_out=P.total=0,A.msg="",P.wrap&&(A.adler=1&P.wrap),P.mode=g,P.last=0,P.havedict=0,P.dmax=32768,P.head=null,P.hold=0,P.bits=0,P.lencode=P.lendyn=new r.Buf32(m),P.distcode=P.distdyn=new r.Buf32(b),P.sane=1,P.back=-1,p):u}function w(A){var P;return A&&A.state?((P=A.state).wsize=0,P.whave=0,P.wnext=0,v(A)):u}function E(A,P){var _,L;return A&&A.state?(L=A.state,P<0?(_=0,P=-P):(_=1+(P>>4),P<48&&(P&=15)),P&&(P<8||15<P)?u:(L.window!==null&&L.wbits!==P&&(L.window=null),L.wrap=_,L.wbits=P,w(A))):u}function S(A,P){var _,L;return A?(L=new y,(A.state=L).window=null,(_=E(A,P))!==p&&(A.state=null),_):u}var $,M,k=!0;function z(A){if(k){var P;for($=new r.Buf32(512),M=new r.Buf32(32),P=0;P<144;)A.lens[P++]=8;for(;P<256;)A.lens[P++]=9;for(;P<280;)A.lens[P++]=7;for(;P<288;)A.lens[P++]=8;for(c(h,A.lens,0,288,$,0,A.work,{bits:9}),P=0;P<32;)A.lens[P++]=5;c(d,A.lens,0,32,M,0,A.work,{bits:5}),k=!1}A.lencode=$,A.lenbits=9,A.distcode=M,A.distbits=5}function j(A,P,_,L){var G,V=A.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new r.Buf8(V.wsize)),L>=V.wsize?(r.arraySet(V.window,P,_-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(L<(G=V.wsize-V.wnext)&&(G=L),r.arraySet(V.window,P,_-L,G,V.wnext),(L-=G)?(r.arraySet(V.window,P,_-L,L,0),V.wnext=L,V.whave=V.wsize):(V.wnext+=G,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=G))),0}n.inflateReset=w,n.inflateReset2=E,n.inflateResetKeep=v,n.inflateInit=function(A){return S(A,15)},n.inflateInit2=S,n.inflate=function(A,P){var _,L,G,V,K,Y,ne,R,N,oe,ie,te,pe,fe,de,me,Ee,Pe,ct,Je,x,Z,q,I,O=0,B=new r.Buf8(4),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!A||!A.state||!A.output||!A.input&&A.avail_in!==0)return u;(_=A.state).mode===12&&(_.mode=13),K=A.next_out,G=A.output,ne=A.avail_out,V=A.next_in,L=A.input,Y=A.avail_in,R=_.hold,N=_.bits,oe=Y,ie=ne,Z=p;e:for(;;)switch(_.mode){case g:if(_.wrap===0){_.mode=13;break}for(;N<16;){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}if(2&_.wrap&&R===35615){B[_.check=0]=255&R,B[1]=R>>>8&255,_.check=a(_.check,B,2,0),N=R=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&R)<<8)+(R>>8))%31){A.msg="incorrect header check",_.mode=30;break}if((15&R)!=8){A.msg="unknown compression method",_.mode=30;break}if(N-=4,x=8+(15&(R>>>=4)),_.wbits===0)_.wbits=x;else if(x>_.wbits){A.msg="invalid window size",_.mode=30;break}_.dmax=1<<x,A.adler=_.check=1,_.mode=512&R?10:12,N=R=0;break;case 2:for(;N<16;){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}if(_.flags=R,(255&_.flags)!=8){A.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){A.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=R>>8&1),512&_.flags&&(B[0]=255&R,B[1]=R>>>8&255,_.check=a(_.check,B,2,0)),N=R=0,_.mode=3;case 3:for(;N<32;){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}_.head&&(_.head.time=R),512&_.flags&&(B[0]=255&R,B[1]=R>>>8&255,B[2]=R>>>16&255,B[3]=R>>>24&255,_.check=a(_.check,B,4,0)),N=R=0,_.mode=4;case 4:for(;N<16;){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}_.head&&(_.head.xflags=255&R,_.head.os=R>>8),512&_.flags&&(B[0]=255&R,B[1]=R>>>8&255,_.check=a(_.check,B,2,0)),N=R=0,_.mode=5;case 5:if(1024&_.flags){for(;N<16;){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}_.length=R,_.head&&(_.head.extra_len=R),512&_.flags&&(B[0]=255&R,B[1]=R>>>8&255,_.check=a(_.check,B,2,0)),N=R=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(Y<(te=_.length)&&(te=Y),te&&(_.head&&(x=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),r.arraySet(_.head.extra,L,V,te,x)),512&_.flags&&(_.check=a(_.check,L,te,V)),Y-=te,V+=te,_.length-=te),_.length))break e;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(Y===0)break e;for(te=0;x=L[V+te++],_.head&&x&&_.length<65536&&(_.head.name+=String.fromCharCode(x)),x&&te<Y;);if(512&_.flags&&(_.check=a(_.check,L,te,V)),Y-=te,V+=te,x)break e}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(Y===0)break e;for(te=0;x=L[V+te++],_.head&&x&&_.length<65536&&(_.head.comment+=String.fromCharCode(x)),x&&te<Y;);if(512&_.flags&&(_.check=a(_.check,L,te,V)),Y-=te,V+=te,x)break e}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;N<16;){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}if(R!==(65535&_.check)){A.msg="header crc mismatch",_.mode=30;break}N=R=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),A.adler=_.check=0,_.mode=12;break;case 10:for(;N<32;){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}A.adler=_.check=f(R),N=R=0,_.mode=11;case 11:if(_.havedict===0)return A.next_out=K,A.avail_out=ne,A.next_in=V,A.avail_in=Y,_.hold=R,_.bits=N,2;A.adler=_.check=1,_.mode=12;case 12:if(P===5||P===6)break e;case 13:if(_.last){R>>>=7&N,N-=7&N,_.mode=27;break}for(;N<3;){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}switch(_.last=1&R,N-=1,3&(R>>>=1)){case 0:_.mode=14;break;case 1:if(z(_),_.mode=20,P!==6)break;R>>>=2,N-=2;break e;case 2:_.mode=17;break;case 3:A.msg="invalid block type",_.mode=30}R>>>=2,N-=2;break;case 14:for(R>>>=7&N,N-=7&N;N<32;){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}if((65535&R)!=(R>>>16^65535)){A.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&R,N=R=0,_.mode=15,P===6)break e;case 15:_.mode=16;case 16:if(te=_.length){if(Y<te&&(te=Y),ne<te&&(te=ne),te===0)break e;r.arraySet(G,L,V,te,K),Y-=te,V+=te,ne-=te,K+=te,_.length-=te;break}_.mode=12;break;case 17:for(;N<14;){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}if(_.nlen=257+(31&R),R>>>=5,N-=5,_.ndist=1+(31&R),R>>>=5,N-=5,_.ncode=4+(15&R),R>>>=4,N-=4,286<_.nlen||30<_.ndist){A.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;N<3;){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}_.lens[X[_.have++]]=7&R,R>>>=3,N-=3}for(;_.have<19;)_.lens[X[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,q={bits:_.lenbits},Z=c(0,_.lens,0,19,_.lencode,0,_.work,q),_.lenbits=q.bits,Z){A.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;me=(O=_.lencode[R&(1<<_.lenbits)-1])>>>16&255,Ee=65535&O,!((de=O>>>24)<=N);){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}if(Ee<16)R>>>=de,N-=de,_.lens[_.have++]=Ee;else{if(Ee===16){for(I=de+2;N<I;){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}if(R>>>=de,N-=de,_.have===0){A.msg="invalid bit length repeat",_.mode=30;break}x=_.lens[_.have-1],te=3+(3&R),R>>>=2,N-=2}else if(Ee===17){for(I=de+3;N<I;){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}N-=de,x=0,te=3+(7&(R>>>=de)),R>>>=3,N-=3}else{for(I=de+7;N<I;){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}N-=de,x=0,te=11+(127&(R>>>=de)),R>>>=7,N-=7}if(_.have+te>_.nlen+_.ndist){A.msg="invalid bit length repeat",_.mode=30;break}for(;te--;)_.lens[_.have++]=x}}if(_.mode===30)break;if(_.lens[256]===0){A.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,q={bits:_.lenbits},Z=c(h,_.lens,0,_.nlen,_.lencode,0,_.work,q),_.lenbits=q.bits,Z){A.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,q={bits:_.distbits},Z=c(d,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,q),_.distbits=q.bits,Z){A.msg="invalid distances set",_.mode=30;break}if(_.mode=20,P===6)break e;case 20:_.mode=21;case 21:if(6<=Y&&258<=ne){A.next_out=K,A.avail_out=ne,A.next_in=V,A.avail_in=Y,_.hold=R,_.bits=N,l(A,ie),K=A.next_out,G=A.output,ne=A.avail_out,V=A.next_in,L=A.input,Y=A.avail_in,R=_.hold,N=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;me=(O=_.lencode[R&(1<<_.lenbits)-1])>>>16&255,Ee=65535&O,!((de=O>>>24)<=N);){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}if(me&&!(240&me)){for(Pe=de,ct=me,Je=Ee;me=(O=_.lencode[Je+((R&(1<<Pe+ct)-1)>>Pe)])>>>16&255,Ee=65535&O,!(Pe+(de=O>>>24)<=N);){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}R>>>=Pe,N-=Pe,_.back+=Pe}if(R>>>=de,N-=de,_.back+=de,_.length=Ee,me===0){_.mode=26;break}if(32&me){_.back=-1,_.mode=12;break}if(64&me){A.msg="invalid literal/length code",_.mode=30;break}_.extra=15&me,_.mode=22;case 22:if(_.extra){for(I=_.extra;N<I;){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}_.length+=R&(1<<_.extra)-1,R>>>=_.extra,N-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;me=(O=_.distcode[R&(1<<_.distbits)-1])>>>16&255,Ee=65535&O,!((de=O>>>24)<=N);){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}if(!(240&me)){for(Pe=de,ct=me,Je=Ee;me=(O=_.distcode[Je+((R&(1<<Pe+ct)-1)>>Pe)])>>>16&255,Ee=65535&O,!(Pe+(de=O>>>24)<=N);){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}R>>>=Pe,N-=Pe,_.back+=Pe}if(R>>>=de,N-=de,_.back+=de,64&me){A.msg="invalid distance code",_.mode=30;break}_.offset=Ee,_.extra=15&me,_.mode=24;case 24:if(_.extra){for(I=_.extra;N<I;){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}_.offset+=R&(1<<_.extra)-1,R>>>=_.extra,N-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){A.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(ne===0)break e;if(te=ie-ne,_.offset>te){if((te=_.offset-te)>_.whave&&_.sane){A.msg="invalid distance too far back",_.mode=30;break}pe=te>_.wnext?(te-=_.wnext,_.wsize-te):_.wnext-te,te>_.length&&(te=_.length),fe=_.window}else fe=G,pe=K-_.offset,te=_.length;for(ne<te&&(te=ne),ne-=te,_.length-=te;G[K++]=fe[pe++],--te;);_.length===0&&(_.mode=21);break;case 26:if(ne===0)break e;G[K++]=_.length,ne--,_.mode=21;break;case 27:if(_.wrap){for(;N<32;){if(Y===0)break e;Y--,R|=L[V++]<<N,N+=8}if(ie-=ne,A.total_out+=ie,_.total+=ie,ie&&(A.adler=_.check=_.flags?a(_.check,G,ie,K-ie):o(_.check,G,ie,K-ie)),ie=ne,(_.flags?R:f(R))!==_.check){A.msg="incorrect data check",_.mode=30;break}N=R=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;N<32;){if(Y===0)break e;Y--,R+=L[V++]<<N,N+=8}if(R!==(4294967295&_.total)){A.msg="incorrect length check",_.mode=30;break}N=R=0}_.mode=29;case 29:Z=1;break e;case 30:Z=-3;break e;case 31:return-4;case 32:default:return u}return A.next_out=K,A.avail_out=ne,A.next_in=V,A.avail_in=Y,_.hold=R,_.bits=N,(_.wsize||ie!==A.avail_out&&_.mode<30&&(_.mode<27||P!==4))&&j(A,A.output,A.next_out,ie-A.avail_out)?(_.mode=31,-4):(oe-=A.avail_in,ie-=A.avail_out,A.total_in+=oe,A.total_out+=ie,_.total+=ie,_.wrap&&ie&&(A.adler=_.check=_.flags?a(_.check,G,ie,A.next_out-ie):o(_.check,G,ie,A.next_out-ie)),A.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(oe==0&&ie===0||P===4)&&Z===p&&(Z=-5),Z)},n.inflateEnd=function(A){if(!A||!A.state)return u;var P=A.state;return P.window&&(P.window=null),A.state=null,p},n.inflateGetHeader=function(A,P){var _;return A&&A.state&&2&(_=A.state).wrap?((_.head=P).done=!1,p):u},n.inflateSetDictionary=function(A,P){var _,L=P.length;return A&&A.state?(_=A.state).wrap!==0&&_.mode!==11?u:_.mode===11&&o(1,P,L,0)!==_.check?-3:j(A,P,L,L)?(_.mode=31,-4):(_.havedict=1,p):u},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,i,n){var r=t("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(h,d,p,u,g,m,b,f){var y,v,w,E,S,$,M,k,z,j=f.bits,A=0,P=0,_=0,L=0,G=0,V=0,K=0,Y=0,ne=0,R=0,N=null,oe=0,ie=new r.Buf16(16),te=new r.Buf16(16),pe=null,fe=0;for(A=0;A<=15;A++)ie[A]=0;for(P=0;P<u;P++)ie[d[p+P]]++;for(G=j,L=15;1<=L&&ie[L]===0;L--);if(L<G&&(G=L),L===0)return g[m++]=20971520,g[m++]=20971520,f.bits=1,0;for(_=1;_<L&&ie[_]===0;_++);for(G<_&&(G=_),A=Y=1;A<=15;A++)if(Y<<=1,(Y-=ie[A])<0)return-1;if(0<Y&&(h===0||L!==1))return-1;for(te[1]=0,A=1;A<15;A++)te[A+1]=te[A]+ie[A];for(P=0;P<u;P++)d[p+P]!==0&&(b[te[d[p+P]]++]=P);if($=h===0?(N=pe=b,19):h===1?(N=o,oe-=257,pe=a,fe-=257,256):(N=l,pe=c,-1),A=_,S=m,K=P=R=0,w=-1,E=(ne=1<<(V=G))-1,h===1&&852<ne||h===2&&592<ne)return 1;for(;;){for(M=A-K,z=b[P]<$?(k=0,b[P]):b[P]>$?(k=pe[fe+b[P]],N[oe+b[P]]):(k=96,0),y=1<<A-K,_=v=1<<V;g[S+(R>>K)+(v-=y)]=M<<24|k<<16|z|0,v!==0;);for(y=1<<A-1;R&y;)y>>=1;if(y!==0?(R&=y-1,R+=y):R=0,P++,--ie[A]==0){if(A===L)break;A=d[p+b[P]]}if(G<A&&(R&E)!==w){for(K===0&&(K=G),S+=_,Y=1<<(V=A-K);V+K<L&&!((Y-=ie[V+K])<=0);)V++,Y<<=1;if(ne+=1<<V,h===1&&852<ne||h===2&&592<ne)return 1;g[w=R&E]=G<<24|V<<16|S-m|0}}return R!==0&&(g[S+R]=A-K<<24|64<<16|0),f.bits=G,0}},{"../utils/common":41}],51:[function(t,i,n){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,i,n){var r=t("../utils/common"),o=0,a=1;function l(O){for(var B=O.length;0<=--B;)O[B]=0}var c=0,h=29,d=256,p=d+1+h,u=30,g=19,m=2*p+1,b=15,f=16,y=7,v=256,w=16,E=17,S=18,$=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],j=new Array(2*(p+2));l(j);var A=new Array(2*u);l(A);var P=new Array(512);l(P);var _=new Array(256);l(_);var L=new Array(h);l(L);var G,V,K,Y=new Array(u);function ne(O,B,X,Q,U){this.static_tree=O,this.extra_bits=B,this.extra_base=X,this.elems=Q,this.max_length=U,this.has_stree=O&&O.length}function R(O,B){this.dyn_tree=O,this.max_code=0,this.stat_desc=B}function N(O){return O<256?P[O]:P[256+(O>>>7)]}function oe(O,B){O.pending_buf[O.pending++]=255&B,O.pending_buf[O.pending++]=B>>>8&255}function ie(O,B,X){O.bi_valid>f-X?(O.bi_buf|=B<<O.bi_valid&65535,oe(O,O.bi_buf),O.bi_buf=B>>f-O.bi_valid,O.bi_valid+=X-f):(O.bi_buf|=B<<O.bi_valid&65535,O.bi_valid+=X)}function te(O,B,X){ie(O,X[2*B],X[2*B+1])}function pe(O,B){for(var X=0;X|=1&O,O>>>=1,X<<=1,0<--B;);return X>>>1}function fe(O,B,X){var Q,U,ee=new Array(b+1),ae=0;for(Q=1;Q<=b;Q++)ee[Q]=ae=ae+X[Q-1]<<1;for(U=0;U<=B;U++){var se=O[2*U+1];se!==0&&(O[2*U]=pe(ee[se]++,se))}}function de(O){var B;for(B=0;B<p;B++)O.dyn_ltree[2*B]=0;for(B=0;B<u;B++)O.dyn_dtree[2*B]=0;for(B=0;B<g;B++)O.bl_tree[2*B]=0;O.dyn_ltree[2*v]=1,O.opt_len=O.static_len=0,O.last_lit=O.matches=0}function me(O){8<O.bi_valid?oe(O,O.bi_buf):0<O.bi_valid&&(O.pending_buf[O.pending++]=O.bi_buf),O.bi_buf=0,O.bi_valid=0}function Ee(O,B,X,Q){var U=2*B,ee=2*X;return O[U]<O[ee]||O[U]===O[ee]&&Q[B]<=Q[X]}function Pe(O,B,X){for(var Q=O.heap[X],U=X<<1;U<=O.heap_len&&(U<O.heap_len&&Ee(B,O.heap[U+1],O.heap[U],O.depth)&&U++,!Ee(B,Q,O.heap[U],O.depth));)O.heap[X]=O.heap[U],X=U,U<<=1;O.heap[X]=Q}function ct(O,B,X){var Q,U,ee,ae,se=0;if(O.last_lit!==0)for(;Q=O.pending_buf[O.d_buf+2*se]<<8|O.pending_buf[O.d_buf+2*se+1],U=O.pending_buf[O.l_buf+se],se++,Q===0?te(O,U,B):(te(O,(ee=_[U])+d+1,B),(ae=$[ee])!==0&&ie(O,U-=L[ee],ae),te(O,ee=N(--Q),X),(ae=M[ee])!==0&&ie(O,Q-=Y[ee],ae)),se<O.last_lit;);te(O,v,B)}function Je(O,B){var X,Q,U,ee=B.dyn_tree,ae=B.stat_desc.static_tree,se=B.stat_desc.has_stree,ce=B.stat_desc.elems,Oe=-1;for(O.heap_len=0,O.heap_max=m,X=0;X<ce;X++)ee[2*X]!==0?(O.heap[++O.heap_len]=Oe=X,O.depth[X]=0):ee[2*X+1]=0;for(;O.heap_len<2;)ee[2*(U=O.heap[++O.heap_len]=Oe<2?++Oe:0)]=1,O.depth[U]=0,O.opt_len--,se&&(O.static_len-=ae[2*U+1]);for(B.max_code=Oe,X=O.heap_len>>1;1<=X;X--)Pe(O,ee,X);for(U=ce;X=O.heap[1],O.heap[1]=O.heap[O.heap_len--],Pe(O,ee,1),Q=O.heap[1],O.heap[--O.heap_max]=X,O.heap[--O.heap_max]=Q,ee[2*U]=ee[2*X]+ee[2*Q],O.depth[U]=(O.depth[X]>=O.depth[Q]?O.depth[X]:O.depth[Q])+1,ee[2*X+1]=ee[2*Q+1]=U,O.heap[1]=U++,Pe(O,ee,1),2<=O.heap_len;);O.heap[--O.heap_max]=O.heap[1],function(ye,kt){var yn,Qt,vn,Ue,kr,ba,hi=kt.dyn_tree,Dc=kt.max_code,Tm=kt.stat_desc.static_tree,km=kt.stat_desc.has_stree,Pm=kt.stat_desc.extra_bits,Lc=kt.stat_desc.extra_base,_n=kt.stat_desc.max_length,Pr=0;for(Ue=0;Ue<=b;Ue++)ye.bl_count[Ue]=0;for(hi[2*ye.heap[ye.heap_max]+1]=0,yn=ye.heap_max+1;yn<m;yn++)_n<(Ue=hi[2*hi[2*(Qt=ye.heap[yn])+1]+1]+1)&&(Ue=_n,Pr++),hi[2*Qt+1]=Ue,Dc<Qt||(ye.bl_count[Ue]++,kr=0,Lc<=Qt&&(kr=Pm[Qt-Lc]),ba=hi[2*Qt],ye.opt_len+=ba*(Ue+kr),km&&(ye.static_len+=ba*(Tm[2*Qt+1]+kr)));if(Pr!==0){do{for(Ue=_n-1;ye.bl_count[Ue]===0;)Ue--;ye.bl_count[Ue]--,ye.bl_count[Ue+1]+=2,ye.bl_count[_n]--,Pr-=2}while(0<Pr);for(Ue=_n;Ue!==0;Ue--)for(Qt=ye.bl_count[Ue];Qt!==0;)Dc<(vn=ye.heap[--yn])||(hi[2*vn+1]!==Ue&&(ye.opt_len+=(Ue-hi[2*vn+1])*hi[2*vn],hi[2*vn+1]=Ue),Qt--)}}(O,B),fe(ee,Oe,O.bl_count)}function x(O,B,X){var Q,U,ee=-1,ae=B[1],se=0,ce=7,Oe=4;for(ae===0&&(ce=138,Oe=3),B[2*(X+1)+1]=65535,Q=0;Q<=X;Q++)U=ae,ae=B[2*(Q+1)+1],++se<ce&&U===ae||(se<Oe?O.bl_tree[2*U]+=se:U!==0?(U!==ee&&O.bl_tree[2*U]++,O.bl_tree[2*w]++):se<=10?O.bl_tree[2*E]++:O.bl_tree[2*S]++,ee=U,Oe=(se=0)===ae?(ce=138,3):U===ae?(ce=6,3):(ce=7,4))}function Z(O,B,X){var Q,U,ee=-1,ae=B[1],se=0,ce=7,Oe=4;for(ae===0&&(ce=138,Oe=3),Q=0;Q<=X;Q++)if(U=ae,ae=B[2*(Q+1)+1],!(++se<ce&&U===ae)){if(se<Oe)for(;te(O,U,O.bl_tree),--se!=0;);else U!==0?(U!==ee&&(te(O,U,O.bl_tree),se--),te(O,w,O.bl_tree),ie(O,se-3,2)):se<=10?(te(O,E,O.bl_tree),ie(O,se-3,3)):(te(O,S,O.bl_tree),ie(O,se-11,7));ee=U,Oe=(se=0)===ae?(ce=138,3):U===ae?(ce=6,3):(ce=7,4)}}l(Y);var q=!1;function I(O,B,X,Q){ie(O,(c<<1)+(Q?1:0),3),function(U,ee,ae,se){me(U),oe(U,ae),oe(U,~ae),r.arraySet(U.pending_buf,U.window,ee,ae,U.pending),U.pending+=ae}(O,B,X)}n._tr_init=function(O){q||(function(){var B,X,Q,U,ee,ae=new Array(b+1);for(U=Q=0;U<h-1;U++)for(L[U]=Q,B=0;B<1<<$[U];B++)_[Q++]=U;for(_[Q-1]=U,U=ee=0;U<16;U++)for(Y[U]=ee,B=0;B<1<<M[U];B++)P[ee++]=U;for(ee>>=7;U<u;U++)for(Y[U]=ee<<7,B=0;B<1<<M[U]-7;B++)P[256+ee++]=U;for(X=0;X<=b;X++)ae[X]=0;for(B=0;B<=143;)j[2*B+1]=8,B++,ae[8]++;for(;B<=255;)j[2*B+1]=9,B++,ae[9]++;for(;B<=279;)j[2*B+1]=7,B++,ae[7]++;for(;B<=287;)j[2*B+1]=8,B++,ae[8]++;for(fe(j,p+1,ae),B=0;B<u;B++)A[2*B+1]=5,A[2*B]=pe(B,5);G=new ne(j,$,d+1,p,b),V=new ne(A,M,0,u,b),K=new ne(new Array(0),k,0,g,y)}(),q=!0),O.l_desc=new R(O.dyn_ltree,G),O.d_desc=new R(O.dyn_dtree,V),O.bl_desc=new R(O.bl_tree,K),O.bi_buf=0,O.bi_valid=0,de(O)},n._tr_stored_block=I,n._tr_flush_block=function(O,B,X,Q){var U,ee,ae=0;0<O.level?(O.strm.data_type===2&&(O.strm.data_type=function(se){var ce,Oe=4093624447;for(ce=0;ce<=31;ce++,Oe>>>=1)if(1&Oe&&se.dyn_ltree[2*ce]!==0)return o;if(se.dyn_ltree[18]!==0||se.dyn_ltree[20]!==0||se.dyn_ltree[26]!==0)return a;for(ce=32;ce<d;ce++)if(se.dyn_ltree[2*ce]!==0)return a;return o}(O)),Je(O,O.l_desc),Je(O,O.d_desc),ae=function(se){var ce;for(x(se,se.dyn_ltree,se.l_desc.max_code),x(se,se.dyn_dtree,se.d_desc.max_code),Je(se,se.bl_desc),ce=g-1;3<=ce&&se.bl_tree[2*z[ce]+1]===0;ce--);return se.opt_len+=3*(ce+1)+5+5+4,ce}(O),U=O.opt_len+3+7>>>3,(ee=O.static_len+3+7>>>3)<=U&&(U=ee)):U=ee=X+5,X+4<=U&&B!==-1?I(O,B,X,Q):O.strategy===4||ee===U?(ie(O,2+(Q?1:0),3),ct(O,j,A)):(ie(O,4+(Q?1:0),3),function(se,ce,Oe,ye){var kt;for(ie(se,ce-257,5),ie(se,Oe-1,5),ie(se,ye-4,4),kt=0;kt<ye;kt++)ie(se,se.bl_tree[2*z[kt]+1],3);Z(se,se.dyn_ltree,ce-1),Z(se,se.dyn_dtree,Oe-1)}(O,O.l_desc.max_code+1,O.d_desc.max_code+1,ae+1),ct(O,O.dyn_ltree,O.dyn_dtree)),de(O),Q&&me(O)},n._tr_tally=function(O,B,X){return O.pending_buf[O.d_buf+2*O.last_lit]=B>>>8&255,O.pending_buf[O.d_buf+2*O.last_lit+1]=255&B,O.pending_buf[O.l_buf+O.last_lit]=255&X,O.last_lit++,B===0?O.dyn_ltree[2*X]++:(O.matches++,B--,O.dyn_ltree[2*(_[X]+d+1)]++,O.dyn_dtree[2*N(B)]++),O.last_lit===O.lit_bufsize-1},n._tr_align=function(O){ie(O,2,3),te(O,v,j),function(B){B.bi_valid===16?(oe(B,B.bi_buf),B.bi_buf=0,B.bi_valid=0):8<=B.bi_valid&&(B.pending_buf[B.pending++]=255&B.bi_buf,B.bi_buf>>=8,B.bi_valid-=8)}(O)}},{"../utils/common":41}],53:[function(t,i,n){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,i,n){(function(r){(function(o,a){if(!o.setImmediate){var l,c,h,d,p=1,u={},g=!1,m=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,l={}.toString.call(o.process)==="[object process]"?function(w){process.nextTick(function(){y(w)})}:function(){if(o.postMessage&&!o.importScripts){var w=!0,E=o.onmessage;return o.onmessage=function(){w=!1},o.postMessage("","*"),o.onmessage=E,w}}()?(d="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",v,!1):o.attachEvent("onmessage",v),function(w){o.postMessage(d+w,"*")}):o.MessageChannel?((h=new MessageChannel).port1.onmessage=function(w){y(w.data)},function(w){h.port2.postMessage(w)}):m&&"onreadystatechange"in m.createElement("script")?(c=m.documentElement,function(w){var E=m.createElement("script");E.onreadystatechange=function(){y(w),E.onreadystatechange=null,c.removeChild(E),E=null},c.appendChild(E)}):function(w){setTimeout(y,0,w)},b.setImmediate=function(w){typeof w!="function"&&(w=new Function(""+w));for(var E=new Array(arguments.length-1),S=0;S<E.length;S++)E[S]=arguments[S+1];var $={callback:w,args:E};return u[p]=$,l(p),p++},b.clearImmediate=f}function f(w){delete u[w]}function y(w){if(g)setTimeout(y,0,w);else{var E=u[w];if(E){g=!0;try{(function(S){var $=S.callback,M=S.args;switch(M.length){case 0:$();break;case 1:$(M[0]);break;case 2:$(M[0],M[1]);break;case 3:$(M[0],M[1],M[2]);break;default:$.apply(a,M)}})(E)}finally{f(w),g=!1}}}}function v(w){w.source===o&&typeof w.data=="string"&&w.data.indexOf(d)===0&&y(+w.data.slice(d.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof Mr<"u"?Mr:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(qu);var hv=qu.exports;const yh=Cg(hv);let bl=class{constructor(e,t){C(this,"date",new Date),C(this,"author"),C(this,"guid",st.create()),C(this,"viewpoint"),C(this,"modifiedAuthor"),C(this,"modifiedDate"),C(this,"topic"),C(this,"_components"),C(this,"_comment",""),this._components=e,this._comment=t;const i=this._components.get(Ge);this.author=i.config.author}set comment(e){var t;const i=this._components.get(Ge);this._comment=e,this.modifiedDate=new Date,this.modifiedAuthor=i.config.author,(t=this.topic)==null||t.comments.set(this.guid,this)}get comment(){return this._comment}toJSON(){var e,t;const i={guid:this.guid,date:this.date.toISOString(),author:this.author,comment:this.comment,topic_guid:(e=this.topic)==null?void 0:e.guid,viewpoint_guid:this.viewpoint,modified_date:(t=this.modifiedDate)==null?void 0:t.toISOString(),modified_author:this.modifiedAuthor};for(const[n,r]of Object.entries(i))r===void 0&&delete i[n];return i}};const Wu=class Ti{constructor(e){C(this,"guid",st.create()),C(this,"title",Ti.default.title),C(this,"creationDate",new Date),C(this,"creationAuthor",""),C(this,"viewpoints",new je),C(this,"relatedTopics",new je),C(this,"comments",new Se),C(this,"documentReferences",new je),C(this,"customData",{}),C(this,"description"),C(this,"serverAssignedId"),C(this,"dueDate"),C(this,"modifiedAuthor"),C(this,"modifiedDate"),C(this,"index"),C(this,"_type",Ti.default.type),C(this,"_status",Ti.default.status),C(this,"_priority",Ti.default.priority),C(this,"_stage",Ti.default.stage),C(this,"_assignedTo",Ti.default.assignedTo),C(this,"_labels",Ti.default.labels??new Set),C(this,"_components"),this._components=e;const t=e.get(Ge);this.creationAuthor=t.config.author,this.relatedTopics.guard=i=>i!==this.guid}set type(e){const t=this._components.get(Ge),{strict:i,types:n}=t.config;(!i||n.has(e))&&(this._type=e)}get type(){return this._type}set status(e){const t=this._components.get(Ge),{strict:i,statuses:n}=t.config;(!i||n.has(e))&&(this._status=e)}get status(){return this._status}set priority(e){const t=this._components.get(Ge);if(e){const{strict:i,priorities:n}=t.config;if(!(!i||n.has(e)))return;this._priority=e}else this._priority=e}get priority(){return this._priority}set stage(e){const t=this._components.get(Ge);if(e){const{strict:i,stages:n}=t.config;if(!(!i||n.has(e)))return;this._stage=e}else this._stage=e}get stage(){return this._stage}set assignedTo(e){const t=this._components.get(Ge);if(e){const{strict:i,users:n}=t.config;if(!(!i||n.has(e)))return;this._assignedTo=e}else this._assignedTo=e}get assignedTo(){return this._assignedTo}set labels(e){const t=this._components.get(Ge),{strict:i,labels:n}=t.config;if(i){const r=new Set;for(const o of e)(!i||n.has(o))&&r.add(o);this._labels=r}else this._labels=e}get labels(){return this._labels}get _managerVersion(){return this._components.get(Ge).config.version}set(e){const t=e,i=this;for(const n in e){if(n==="guid")continue;const r=t[n];n in this&&(i[n]=r)}return this._components.get(Ge).list.set(this.guid,this),this}createComment(e,t){const i=new bl(this._components,e);return i.viewpoint=t,i.topic=this,this.comments.set(i.guid,i),i}createLabelTags(){const e=[...this.labels];if(this._components.get(Ge).config.exportCustomDataAsLabels)for(const t in this.customData){const i=this.customData[t];typeof i=="string"&&e.push(i)}return e}createCommentTags(){return[...this.comments.values()].map(e=>{var t;return{$Guid:e.guid,Date:e.date.toISOString(),Author:e.author,Comment:e.comment,ModifiedAuthor:e.modifiedAuthor,ModifiedDate:(t=e.modifiedDate)==null?void 0:t.toISOString(),Viewpoint:e.viewpoint?{$Guid:e.viewpoint}:void 0}})}createViewpointTags(){const e=this._components.get(ui);return[...this.viewpoints].map(t=>e.list.get(t)).filter(t=>t).map(t=>{const i={$Guid:t.guid,Viewpoint:`${t.title??t.guid}.bcfv`};if(e.snapshots.get(t.snapshot)){const n=e.getSnapshotExtension(t.snapshot);i.Snapshot=`${t.snapshot}.${n}`}return i})}createRelatedTopicTags(){return[...this.relatedTopics].map(e=>({$Guid:e}))}createDocumentReferencesTag(e=this._managerVersion){const t=[];if(!(e==="3"||e==="2.1"))return t;const i=this._components.get(Ge);for(const n of this.documentReferences){const r=i.documents.get(n);if(!r)continue;let o={$Guid:st.create(),Description:r.description};e==="2.1"&&(o={...o,$isExternal:r.type==="external"?!0:void 0,ReferencedDocument:r.type==="external"?r.url:`../${r.fileName}`}),e==="3"&&(o={...o,DocumentGuid:r.type==="internal"?n:void 0,Url:r.type==="external"?r.url:void 0}),Object.keys(o).length>0&&t.push(o)}return t}toJSON(){var e,t;const i={guid:this.guid,server_assigned_id:this.serverAssignedId,topic_type:this.type,topic_status:this.status,title:this.title,priority:this.priority,index:this.index,labels:[...this.labels],creation_date:this.creationDate.toISOString(),creation_author:this.creationAuthor,modified_date:(e=this.modifiedDate)==null?void 0:e.toISOString(),modified_author:this.modifiedAuthor,assigned_to:this.assignedTo,stage:this.stage,description:this.description,due_date:(t=this.dueDate)==null?void 0:t.toISOString(),comments:[...this.comments].map(([o,a])=>a.toJSON()),relatedTopics:[...this.relatedTopics].map(o=>({related_topic_guid:o}))},n=this._components.get(ui);for(const o of this.viewpoints){const a=n.list.get(o);a&&(i.viewpoints||(i.viewpoints=[]),i.viewpoints.push(a.toJSON()))}const r=this._components.get(Ge);for(const o of this.documentReferences){const a=r.documents.get(o);a&&(i.document_references||(i.document_references=[]),a.type==="external"?i.document_references.push({guid:st.create(),description:a.description,url:a.url}):i.document_references.push({guid:st.create(),description:a.description,document_guid:o}))}for(const[o,a]of Object.entries(i))(a===void 0||Array.isArray(a)&&a.length===0)&&delete i[o];return i}serialize(){var e,t;const i=this._managerVersion,n={$Guid:this.guid,$TopicType:this.type,$TopicStatus:this.status,$ServerAssignedId:this.serverAssignedId,Title:this.title,CreationAuthor:this.creationAuthor,CreationDate:this.creationDate.toISOString(),Priority:this.priority,Index:i==="2.1"?this.index:void 0,ModifiedDate:(e=this.modifiedDate)==null?void 0:e.toISOString(),ModifiedAuthor:this.modifiedAuthor,DueDate:(t=this.dueDate)==null?void 0:t.toISOString(),AssignedTo:this.assignedTo,Description:this.description,Stage:this.stage,DocumentReferences:i==="3"?{DocumentReference:this.createDocumentReferencesTag(i)}:void 0,RelatedTopics:i==="3"?{RelatedTopic:this.createRelatedTopicTags()}:void 0,RelatedTopic:i==="2.1"?this.createRelatedTopicTags():void 0,Labels:i==="3"?{Label:this.createLabelTags()}:void 0,Viewpoints:i==="3"?{ViewPoint:this.createViewpointTags()}:void 0,Comments:i==="3"?{Comment:this.createCommentTags()}:void 0};i==="2.1"&&(n.Labels=this.createLabelTags(),n.DocumentReference=this.createDocumentReferencesTag(i));const r={Markup:{Topic:n}};return i==="2.1"&&(r.Markup.Viewpoints=this.createViewpointTags(),r.Markup.Comment=this.createCommentTags()),`<?xml version="1.0" encoding="UTF-8"?>
    ${Xo.builder.build(r)}`}};C(Wu,"default",{title:"BCF Topic",type:"Issue",status:"Active"});let vh=Wu;const dv=(s,e)=>{if(e.trim()==="")return;const t=Ge.xmlParser.parse(e).Extensions;if(!t)return;const{Priorities:i,TopicStatuses:n,TopicTypes:r,Users:o}=t;if(i&&i.Priority){const a=Array.isArray(i.Priority)?i.Priority:[i.Priority];for(const l of a)s.config.priorities.add(l)}if(n&&n.TopicStatus){const a=Array.isArray(n.TopicStatus)?n.TopicStatus:[n.TopicStatus];for(const l of a)s.config.statuses.add(l)}if(r&&r.TopicType){const a=Array.isArray(r.TopicType)?r.TopicType:[r.TopicType];for(const l of a)s.config.types.add(l)}if(o&&o.User){const a=Array.isArray(o.User)?o.User:[o.User];for(const l of a)s.config.users.add(l)}};let uv=class extends Qo{constructor(){super(...arguments),C(this,"_config",{version:{type:"Select",options:new Set(["2.1","3"]),multiple:!1,value:""},author:{type:"Text",value:""},types:{type:"TextSet",value:new Set},statuses:{type:"TextSet",value:new Set},priorities:{type:"TextSet",value:new Set},labels:{type:"TextSet",value:new Set},stages:{type:"TextSet",value:new Set},users:{type:"TextSet",value:new Set},includeSelectionTag:{type:"Boolean",value:!1},updateExtensionsOnImport:{type:"Boolean",value:!1},strict:{type:"Boolean",value:!1},includeAllExtensionsOnExport:{type:"Boolean",value:!1},fallbackVersionOnImport:{type:"Select",multiple:!1,options:new Set(["2.1","3"]),value:""},ignoreIncompleteTopicsOnImport:{type:"Boolean",value:!1},exportCustomDataAsLabels:{type:"Boolean",value:!1}})}get version(){return this._config.version.value}set version(e){this._config.version.value=e}get author(){return this._config.author.value}set author(e){this._config.author.value=e}get types(){return this._config.types.value}set types(e){this._config.types.value=e}get statuses(){return this._config.statuses.value}set statuses(e){this._config.statuses.value=e}get priorities(){return this._config.priorities.value}set priorities(e){this._config.priorities.value=e}get labels(){return this._config.labels.value}set labels(e){this._config.labels.value=e}get stages(){return this._config.stages.value}set stages(e){this._config.stages.value=e}get users(){return this._config.users.value}set users(e){this._config.users.value=e}get includeSelectionTag(){return this._config.includeSelectionTag.value}set includeSelectionTag(e){this._config.includeSelectionTag.value=e}get updateExtensionsOnImport(){return this._config.updateExtensionsOnImport.value}set updateExtensionsOnImport(e){this._config.updateExtensionsOnImport.value=e}get strict(){return this._config.strict.value}set strict(e){this._config.strict.value=e}get includeAllExtensionsOnExport(){return this._config.includeAllExtensionsOnExport.value}set includeAllExtensionsOnExport(e){this._config.includeAllExtensionsOnExport.value=e}get fallbackVersionOnImport(){return this._config.fallbackVersionOnImport.value}set fallbackVersionOnImport(e){this._config.fallbackVersionOnImport.value=e}get ignoreIncompleteTopicsOnImport(){return this._config.ignoreIncompleteTopicsOnImport.value}set ignoreIncompleteTopicsOnImport(e){this._config.ignoreIncompleteTopicsOnImport.value=e}get exportCustomDataAsLabels(){return this._config.exportCustomDataAsLabels.value}set exportCustomDataAsLabels(e){this._config.exportCustomDataAsLabels.value=e}};const ac=class Fn extends Ae{constructor(){super(...arguments),C(this,"enabled",!1),C(this,"_defaultConfig",{author:"jhon.doe@example.com",version:"2.1",types:new Set(["Clash","Failure","Fault","Inquiry","Issue","Remark","Request"]),statuses:new Set(["Active","In Progress","Done","In Review","Closed"]),priorities:new Set(["On hold","Minor","Normal","Major","Critical"]),labels:new Set,stages:new Set,users:new Set,includeSelectionTag:!1,updateExtensionsOnImport:!0,strict:!1,includeAllExtensionsOnExport:!0,fallbackVersionOnImport:"2.1",ignoreIncompleteTopicsOnImport:!1,exportCustomDataAsLabels:!1}),C(this,"config",new uv(this,this.components,"BCF Topics",Fn.uuid)),C(this,"list",new Se),C(this,"documents",new Se),C(this,"onSetup",new J),C(this,"isSetup",!1),C(this,"onBCFImported",new J),C(this,"onDisposed",new J)}setup(e){if(this.isSetup)return;const t={...this._defaultConfig,...e};this.config.version=t.version,this.config.author=t.author,this.config.types=t.types,this.config.statuses=t.statuses,this.config.priorities=t.priorities,this.config.labels=t.labels,this.config.stages=t.stages,this.config.users=t.users,this.config.includeSelectionTag=t.includeSelectionTag,this.config.updateExtensionsOnImport=t.updateExtensionsOnImport,this.config.strict=t.strict,this.config.includeAllExtensionsOnExport=t.includeAllExtensionsOnExport,this.config.fallbackVersionOnImport=t.fallbackVersionOnImport||"",this.config.ignoreIncompleteTopicsOnImport=t.ignoreIncompleteTopicsOnImport,this.isSetup=!0,this.enabled=!0,this.onSetup.trigger()}create(e){const t=new vh(this.components);return e?(t.guid=e.guid??t.guid,t.set(e)):this.list.set(t.guid,t),t}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get usedTypes(){const e=[...this.list].map(([t,i])=>i.type);return new Set(e)}get usedStatuses(){const e=[...this.list].map(([t,i])=>i.status);return new Set(e)}get usedPriorities(){const e=[...this.list].map(([t,i])=>i.priority).filter(t=>t);return new Set(e)}get usedStages(){const e=[...this.list].map(([t,i])=>i.stage).filter(t=>t);return new Set(e)}get usedUsers(){const e=[];for(const[t,i]of this.list){e.push(i.creationAuthor),i.assignedTo&&e.push(i.assignedTo),i.modifiedAuthor&&e.push(i.modifiedAuthor);for(const[n,r]of i.comments)e.push(r.author),r.modifiedAuthor&&e.push(r.modifiedAuthor)}return new Set(e)}get usedLabels(){const e=[];for(const[t,i]of this.list)e.push(...i.labels);return new Set(e)}updateExtensions(){for(const[e,t]of this.list){for(const i of t.labels)this.config.labels.add(i);this.config.types.add(t.type),t.priority&&this.config.priorities.add(t.priority),t.stage&&this.config.stages.add(t.stage),this.config.statuses.add(t.status),this.config.users.add(t.creationAuthor),t.assignedTo&&this.config.users.add(t.assignedTo),t.modifiedAuthor&&this.config.users.add(t.modifiedAuthor);for(const[i,n]of t.comments)this.config.users.add(n.author),n.modifiedAuthor&&this.config.users.add(n.modifiedAuthor)}}updateViewpointReferences(){const e=this.components.get(ui);for(const[t,i]of this.list)for(const n of i.viewpoints)e.list.has(n)||i.viewpoints.delete(n)}async export(e=this.list.values()){const t=new yh;t.file("bcf.version",`<?xml version="1.0" encoding="UTF-8"?>
    <Version VersionId="${this.config.version}" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/buildingSMART/BCF-XML/release_3_0/Schemas/version.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    </Version>`);for(const[n,r]of this.documents.entries())r.type!=="external"&&t.file(this.config.version==="2.1"?r.fileName:`documents/${n}`,r.data);if(this.config.version==="3"){const n=[];for(const[r,o]of this.documents.entries()){const{type:a,description:l}=o;a!=="external"&&n.push(`<Document Guid="${r}">
        <Filename>${o.fileName}</Filename>
        ${l?`<Description>${l}</Description>`:""}
      </Document>`)}n.length>0&&t.file("documents.xml",`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
  <DocumentInfo xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="documents.xsd">
    <Documents>
      ${n.join(`
`)}
    </Documents>
  </DocumentInfo>`)}t.file("bcf.extensions",this.serializeExtensions());const i=this.components.get(ui);for(const n of e){const r=t.folder(n.guid);r.file("markup.bcf",n.serialize());for(const o of n.viewpoints){const a=i.list.get(o);if(!a)continue;const l=a.title??a.guid;r.file(`${l}.bcfv`,await a.serialize());const c=i.snapshots.get(a.snapshot);if(!c)continue;const h=c?a.snapshot:a.guid,d=i.getSnapshotExtension(a.snapshot);r.file(`${h}.${d}`,c,{binary:!0})}}return await t.generateAsync({type:"blob"})}serializeExtensions(){const e=[...this.config.types].map(a=>`<TopicType>${a}</TopicType>`).join(`
`),t=[...this.config.statuses].map(a=>`<TopicStatus>${a}</TopicStatus>`).join(`
`),i=[...this.config.priorities].map(a=>`<Priority>${a}</Priority>`).join(`
`),n=[...this.config.labels].map(a=>`<TopicLabel>${a}</TopicLabel>`).join(`
`),r=[...this.config.stages].map(a=>`<Stage>${a}</Stage>`).join(`
`),o=[...this.config.users].map(a=>`<User>${a}</User>`).join(`
`);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Extensions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="your-schema-location.xsd">
        ${e.length!==0?`<TopicTypes>
${e}
</TopicTypes>`:""}
        ${t.length!==0?`<TopicStatuses>
${t}
</TopicStatuses>`:""}
        ${i.length!==0?`<Priorities>
${i}
</Priorities>`:""}
        ${n.length!==0?`<TopicLabels>
${n}
</TopicLabels>`:""}
        ${r.length!==0?`<Stages>
${r}
</Stages>`:""}
        ${o.length!==0?`<Users>
${o}
</Users>`:""}
      </Extensions>
    `}processMarkupComment(e){const{Guid:t,Date:i,Author:n,Comment:r,Viewpoint:o}=e;if(!(t&&i&&n&&(bl||o)))return null;const a=new bl(this.components,r??"");return a.guid=t,a.date=new Date(i),a.author=n,a.viewpoint=o==null?void 0:o.Guid,a.modifiedAuthor=e.ModifiedAuthor,a.modifiedDate=e.ModifiedDate?new Date(e.ModifiedDate):void 0,a}getMarkupComments(e,t){var i;let n;if(t==="2.1"&&(n=e.Comment),t==="3"&&(n=(i=e.Topic.Comments)==null?void 0:i.Comment),!n)return[];n=Array.isArray(n)?n:[n];const r=n.map(o=>this.processMarkupComment(o)).filter(o=>o);return Array.isArray(r)?r:[r]}getMarkupLabels(e,t){var i;let n;return t==="2.1"&&(n=e.Topic.Labels),t==="3"&&(n=(i=e.Topic.Labels)==null?void 0:i.Label),n?Array.isArray(n)?n:[n]:[]}getMarkupViewpoints(e,t){var i;let n;return t==="2.1"&&(n=e.Viewpoints),t==="3"&&(n=(i=e.Topic.Viewpoints)==null?void 0:i.ViewPoint),n?(n=Array.isArray(n)?n:[n],n):[]}getMarkupRelatedTopics(e,t){var i;let n;return t==="2.1"&&(n=e.Topic.RelatedTopic),t==="3"&&(n=(i=e.Topic.RelatedTopics)==null?void 0:i.RelatedTopic),n?(Array.isArray(n)?n:[n]).map(r=>r.Guid):[]}getMarkupDocumentReferences(e,t){var i;let n;return t==="2.1"&&(n=e.Topic.DocumentReference),t==="3"&&(n=(i=e.Topic.DocumentReferences)==null?void 0:i.DocumentReference),n?Array.isArray(n)?n:[n]:[]}async load(e){var t,i,n;const{fallbackVersionOnImport:r,ignoreIncompleteTopicsOnImport:o,updateExtensionsOnImport:a}=this.config,l=new yh;await l.loadAsync(e);const c=Object.values(l.files);let h=r;const d=c.find(v=>v.name.endsWith(".version"));if(d){const v=await d.async("string"),w=Fn.xmlParser.parse(v).Version.VersionId;h=String(w)}if(!(h&&(h==="2.1"||h==="3")))throw new Error(`BCFTopics: ${h} is not supported.`);const p=c.find(v=>v.name.endsWith(".extensions"));if(a&&p){const v=await p.async("string");dv(this,v)}const u=[],g=this.components.get(ui),m=c.filter(v=>v.name.endsWith(".bcfv"));for(const v of m){const w=await v.async("string"),E=Fn.xmlParser.parse(w).VisualizationInfo;if(!E){console.warn("Missing VisualizationInfo in Viewpoint");continue}const S={},{Guid:$,ClippingPlanes:M,Components:k,OrthogonalCamera:z,PerspectiveCamera:j}=E;if($&&(S.guid=$),k){const P={selection:[],coloring:[],visibility:{default_visibility:!1,exceptions:[],view_setup_hints:{spaces_visible:!1,space_boundaries_visible:!1,openings_visible:!1}}};S.components=P;const{Selection:_,Visibility:L}=k;if(_&&_.Component){const K=Array.isArray(_.Component)?_.Component:[_.Component];P.selection=K.map(Y=>Y.IfcGuid?{ifc_guid:Y.IfcGuid}:null).filter(Y=>Y!==null)}if(L&&"DefaultVisibility"in L&&(P.visibility.default_visibility=L.DefaultVisibility),L&&L.Exceptions&&"Component"in L.Exceptions){const{Component:K}=L.Exceptions,Y=Array.isArray(K)?K:[K];P.visibility.exceptions=Y.map(ne=>ne.IfcGuid?{ifc_guid:ne.IfcGuid}:null).filter(ne=>ne!==null)}let G;h==="2.1"&&(G=k.ViewSetupHints),h==="3"&&(G=(t=k.Visibility)==null?void 0:t.ViewSetupHints),G&&("OpeningsVisible"in G&&(P.visibility.view_setup_hints.openings_visible=G.OpeningsVisible),"SpacesVisible"in G&&(P.visibility.view_setup_hints.spaces_visible=G.SpacesVisible),"SpaceBoundariesVisible"in G&&(P.visibility.view_setup_hints.space_boundaries_visible=G.SpaceBoundariesVisible));const{Coloring:V}=k;if(V&&V.Color){const K=Array.isArray(V.Color)?V.Color:[V.Color];for(const Y of K){const{Color:ne,Component:R}=Y;if(!(ne.length===6||ne.length===8))continue;const N=ne.length===6?ne:ne.slice(2),oe=(Array.isArray(R)?R:[R]).map(ie=>ie.IfcGuid?{ifc_guid:ie.IfcGuid}:null).filter(ie=>ie!==null);P.coloring.push({color:N,components:oe})}}}if(z||j){const P=E.PerspectiveCamera??E.OrthogonalCamera,{CameraViewPoint:_,CameraDirection:L}=P,G=new D(Number(_.X),Number(_.Z),Number(-_.Y)),V=new D(Number(L.X),Number(L.Z),Number(-L.Y)),K={camera_view_point:{x:G.x,y:G.y,z:G.z},camera_direction:{x:V.x,y:V.y,z:V.z},aspect_ratio:"AspectRatio"in P?P.AspectRatio:1,camera_up_vector:{x:0,y:0,z:0}};"ViewToWorldScale"in P&&(S.orthogonal_camera={...K,view_to_world_scale:P.ViewToWorldScale}),"FieldOfView"in P&&(S.perspective_camera={...K,field_of_view:P.FieldOfView})}if(M){const P=(Array.isArray(M.ClippingPlane)?M.ClippingPlane:[M.ClippingPlane]).map(({Location:_,Direction:L})=>({location:{x:_.x,y:_.y,z:_.z},direction:{x:L.x,y:L.y,z:L.z}}));S.clipping_planes=P}const A=new Gu(this.components,S);u.push(A)}const b={},f=[],y=c.filter(v=>v.name.endsWith(".bcf"));for(const v of y){const w=await v.async("string"),E=Fn.xmlParser.parse(w).Markup,S=E.Topic,{Guid:$,TopicType:M,TopicStatus:k,Title:z,CreationDate:j,CreationAuthor:A}=S;if(o&&!($&&M&&k&&z&&j&&A))continue;const P=new vh(this.components);P.guid=$??P.guid;const _=this.getMarkupRelatedTopics(E,h);b[P.guid]=new Set(_),P.type=M??P.type,P.status=k??P.status,P.title=z??P.title,P.creationDate=j?new Date(j):P.creationDate,P.creationAuthor=A??P.creationAuthor,P.serverAssignedId=S.ServerAssignedId,P.priority=S.Priority,P.index=S.Index,P.modifiedDate=S.ModifiedDate?new Date(S.ModifiedDate):void 0,P.modifiedAuthor=S.ModifiedAuthor,P.dueDate=S.DueDate?new Date(S.DueDate):void 0,P.assignedTo=S.AssignedTo,P.description=S.Description,P.stage=S.Stage;const L=this.getMarkupLabels(E,h);for(const N of L)P.labels.add(N);const G=this.getMarkupComments(E,h);for(const N of G)P.comments.set(N.guid,N);const V=this.getMarkupViewpoints(E,h);for(const N of V){if(!(N&&N.Guid))continue;const oe=g.list.get(N.Guid);if(!oe)continue;P.viewpoints.add(oe.guid);const ie=`${P.guid}/${N.Snapshot}`,te=c.find(({name:pe})=>pe===ie);if(te){const pe=await te.async("arraybuffer"),fe=new Uint8Array(pe);g.snapshots.set(oe.guid,fe),oe.snapshot=oe.guid??null}}const K=this.getMarkupDocumentReferences(E,h),Y=c.find(N=>N.name==="documents.xml");let ne=[];const R=await(Y==null?void 0:Y.async("string"));if(R){const N=(n=(i=Xo.parser.parse(R).DocumentInfo)==null?void 0:i.Documents)==null?void 0:n.Document;ne=Array.isArray(N)?N:[N]}for(const N of K){const{Description:oe,DocumentGuid:ie,Url:te,isExternal:pe,ReferencedDocument:fe}=N;if(ie&&ne.length>0){const de=ne.find(({Guid:Je})=>Je===ie),me=c.find(Je=>Je.name.endsWith(ie)),Ee=await(me==null?void 0:me.async("uint8array"));if(!(de&&Ee))continue;const{Description:Pe,Filename:ct}=de;this.documents.set(ie,{type:"internal",fileName:ct,description:Pe,data:Ee}),P.documentReferences.add(ie)}if(te){const de=this.documents.add({type:"external",url:te,description:oe});P.documentReferences.add(de)}if(fe){let de=null;if(pe)de=this.documents.add({type:"external",url:fe,description:oe});else{const me=fe.split("/"),Ee=me[me.length-1],Pe=c.find(Je=>Je.name.endsWith(Ee)),ct=await(Pe==null?void 0:Pe.async("uint8array"));if(!ct)continue;de=this.documents.add({type:"internal",fileName:Ee,data:ct,description:oe})}P.documentReferences.add(de)}}this.list.set(P.guid,P),f.push(P)}for(const v in b){const w=this.list.get(v);if(!w)continue;const E=b[v];for(const S of E)w.relatedTopics.add(S)}return this.onBCFImported.trigger(f),{viewpoints:u,topics:f}}};C(ac,"uuid","de977976-e4f6-4e4f-a01a-204727839802");C(ac,"xmlParser",new Go.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let Ge=ac;const ts=new Zl,at=new D,Ai=new D,De=new Vt,_h={X:new D(1,0,0),Y:new D(0,1,0),Z:new D(0,0,1)},Ba={type:"change"},wh={type:"mouseDown",mode:null},xh={type:"mouseUp",mode:null},Ch={type:"objectChange"};let pv=class extends Jm{constructor(e,t=null){super(void 0,t);const i=new vv(this);this._root=i;const n=new _v;this._gizmo=n,i.add(n);const r=new wv;this._plane=r,i.add(r);const o=this;function a(v,w){let E=w;Object.defineProperty(o,v,{get:function(){return E!==void 0?E:w},set:function(S){E!==S&&(E=S,r[v]=S,n[v]=S,o.dispatchEvent({type:v+"-changed",value:S}),o.dispatchEvent(Ba))}}),o[v]=w,r[v]=w,n[v]=w}a("camera",e),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0),a("minX",-1/0),a("maxX",1/0),a("minY",-1/0),a("maxY",1/0),a("minZ",-1/0),a("maxZ",1/0);const l=new D,c=new D,h=new Vt,d=new Vt,p=new D,u=new Vt,g=new D,m=new D,b=new D,f=0,y=new D;a("worldPosition",l),a("worldPositionStart",c),a("worldQuaternion",h),a("worldQuaternionStart",d),a("cameraPosition",p),a("cameraQuaternion",u),a("pointStart",g),a("pointEnd",m),a("rotationAxis",b),a("rotationAngle",f),a("eye",y),this._offset=new D,this._startNorm=new D,this._endNorm=new D,this._cameraScale=new D,this._parentPosition=new D,this._parentQuaternion=new Vt,this._parentQuaternionInv=new Vt,this._parentScale=new D,this._worldScaleStart=new D,this._worldQuaternionInv=new Vt,this._worldScale=new D,this._positionStart=new D,this._quaternionStart=new Vt,this._scaleStart=new D,this._getPointer=fv.bind(this),this._onPointerDown=gv.bind(this),this._onPointerHover=mv.bind(this),this._onPointerMove=bv.bind(this),this._onPointerUp=yv.bind(this),t!==null&&this.connect(t)}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&ts.setFromCamera(e,this.camera);const t=Na(this._gizmo.picker[this.mode],ts);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&ts.setFromCamera(e,this.camera);const t=Na(this._plane,ts,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,wh.mode=this.mode,this.dispatchEvent(wh)}}pointerMove(e){const t=this.axis,i=this.mode,n=this.object;let r=this.space;if(i==="scale"?r="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(r="world"),n===void 0||t===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&ts.setFromCamera(e,this.camera);const o=Na(this._plane,ts,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(n.position.applyQuaternion(De.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),r==="world"&&(n.parent&&n.position.add(at.setFromMatrixPosition(n.parent.matrixWorld)),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(at.setFromMatrixPosition(n.parent.matrixWorld)))),n.position.x=Math.max(this.minX,Math.min(this.maxX,n.position.x)),n.position.y=Math.max(this.minY,Math.min(this.maxY,n.position.y)),n.position.z=Math.max(this.minZ,Math.min(this.maxZ,n.position.z));else if(i==="scale"){if(t.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),Ai.set(a,a,a)}else at.copy(this.pointStart),Ai.copy(this.pointEnd),at.applyQuaternion(this._worldQuaternionInv),Ai.applyQuaternion(this._worldQuaternionInv),Ai.divide(at),t.search("X")===-1&&(Ai.x=1),t.search("Y")===-1&&(Ai.y=1),t.search("Z")===-1&&(Ai.z=1);n.scale.copy(this._scaleStart).multiply(Ai),this.scaleSnap&&(t.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(at.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(at.copy(this.rotationAxis).cross(this.eye))*a):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(_h[t]),at.copy(_h[t]),r==="local"&&at.applyQuaternion(this.worldQuaternion),at.cross(this.eye),at.length()===0?l=!0:this.rotationAngle=this._offset.dot(at.normalize())*a),(t==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&t!=="E"&&t!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(De.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(De.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Ba),this.dispatchEvent(Ch)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(xh.mode=this.mode,this.dispatchEvent(xh)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(e){return this.object=e,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Ba),this.dispatchEvent(Ch),this.pointStart.copy(this.pointEnd))}getRaycaster(){return ts}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}};function fv(s){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:s.button};{const e=this.domElement.getBoundingClientRect();return{x:(s.clientX-e.left)/e.width*2-1,y:-(s.clientY-e.top)/e.height*2+1,button:s.button}}}function mv(s){if(this.enabled)switch(s.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(s));break}}function gv(s){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(s)),this.pointerDown(this._getPointer(s)))}function bv(s){this.enabled&&this.pointerMove(this._getPointer(s))}function yv(s){this.enabled&&(this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(s)))}function Na(s,e,t){const i=e.intersectObject(s,!0);for(let n=0;n<i.length;n++)if(i[n].object.visible||t)return i[n];return!1}const Jr=new tg,Te=new D(0,1,0),Eh=new D(0,0,0),Sh=new xe,eo=new Vt,fo=new Vt,ei=new D,Ah=new xe,jn=new D(1,0,0),rs=new D(0,1,0),Hn=new D(0,0,1),to=new D,Dn=new D,Ln=new D;let vv=class extends Ys{constructor(e){super(),this.isTransformControlsRoot=!0,this.controls=e,this.visible=!1}updateMatrixWorld(e){const t=this.controls;t.object!==void 0&&(t.object.updateMatrixWorld(),t.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):t.object.parent.matrixWorld.decompose(t._parentPosition,t._parentQuaternion,t._parentScale),t.object.matrixWorld.decompose(t.worldPosition,t.worldQuaternion,t._worldScale),t._parentQuaternionInv.copy(t._parentQuaternion).invert(),t._worldQuaternionInv.copy(t.worldQuaternion).invert()),t.camera.updateMatrixWorld(),t.camera.matrixWorld.decompose(t.cameraPosition,t.cameraQuaternion,t._cameraScale),t.camera.isOrthographicCamera?t.camera.getWorldDirection(t.eye).negate():t.eye.copy(t.cameraPosition).sub(t.worldPosition).normalize(),super.updateMatrixWorld(e)}dispose(){this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}},_v=class extends Ys{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new on({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Gl({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const n=t.clone();n.opacity=.5;const r=e.clone();r.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const a=e.clone();a.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const h=e.clone();h.color.setHex(255),h.opacity=.5;const d=e.clone();d.opacity=.25;const p=e.clone();p.color.setHex(16776960),p.opacity=.25,e.clone().color.setHex(16776960);const u=e.clone();u.color.setHex(7895160);const g=new ht(0,.04,.1,12);g.translate(0,.05,0);const m=new ot(.08,.08,.08);m.translate(0,.04,0);const b=new nt;b.setAttribute("position",new Fi([0,0,0,1,0,0],3));const f=new ht(.0075,.0075,.5,3);f.translate(0,.25,0);function y(_,L){const G=new wn(_,.0075,3,64,L*Math.PI*2);return G.rotateY(Math.PI/2),G.rotateX(Math.PI/2),G}function v(){const _=new nt;return _.setAttribute("position",new Fi([0,0,0,1,1,1],3)),_}const w={X:[[new re(g,r),[.5,0,0],[0,0,-Math.PI/2]],[new re(g,r),[-.5,0,0],[0,0,Math.PI/2]],[new re(f,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new re(g,o),[0,.5,0]],[new re(g,o),[0,-.5,0],[Math.PI,0,0]],[new re(f,o)]],Z:[[new re(g,a),[0,0,.5],[Math.PI/2,0,0]],[new re(g,a),[0,0,-.5],[-Math.PI/2,0,0]],[new re(f,a),null,[Math.PI/2,0,0]]],XYZ:[[new re(new Or(.1,0),d.clone()),[0,0,0]]],XY:[[new re(new ot(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new re(new ot(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new re(new ot(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},E={X:[[new re(new ht(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new re(new ht(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new re(new ht(.2,0,.6,4),i),[0,.3,0]],[new re(new ht(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new re(new ht(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new re(new ht(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new re(new Or(.2,0),i)]],XY:[[new re(new ot(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new re(new ot(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new re(new ot(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},S={START:[[new re(new Or(.01,2),n),null,null,null,"helper"]],END:[[new re(new Or(.01,2),n),null,null,null,"helper"]],DELTA:[[new Ht(v(),n),null,null,null,"helper"]],X:[[new Ht(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ht(b,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ht(b,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},$={XYZE:[[new re(y(.5,1),u),null,[0,Math.PI/2,0]]],X:[[new re(y(.5,.5),r)]],Y:[[new re(y(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new re(y(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new re(y(.75,1),p),null,[0,Math.PI/2,0]]]},M={AXIS:[[new Ht(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},k={XYZE:[[new re(new eg(.25,10,8),i)]],X:[[new re(new wn(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new re(new wn(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new re(new wn(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new re(new wn(.75,.1,2,24),i)]]},z={X:[[new re(m,r),[.5,0,0],[0,0,-Math.PI/2]],[new re(f,r),[0,0,0],[0,0,-Math.PI/2]],[new re(m,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new re(m,o),[0,.5,0]],[new re(f,o)],[new re(m,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new re(m,a),[0,0,.5],[Math.PI/2,0,0]],[new re(f,a),[0,0,0],[Math.PI/2,0,0]],[new re(m,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new re(new ot(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new re(new ot(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new re(new ot(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new re(new ot(.1,.1,.1),d.clone())]]},j={X:[[new re(new ht(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new re(new ht(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new re(new ht(.2,0,.6,4),i),[0,.3,0]],[new re(new ht(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new re(new ht(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new re(new ht(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new re(new ot(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new re(new ot(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new re(new ot(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new re(new ot(.2,.2,.2),i),[0,0,0]]]},A={X:[[new Ht(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ht(b,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ht(b,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function P(_){const L=new Ys;for(const G in _)for(let V=_[G].length;V--;){const K=_[G][V][0].clone(),Y=_[G][V][1],ne=_[G][V][2],R=_[G][V][3],N=_[G][V][4];K.name=G,K.tag=N,Y&&K.position.set(Y[0],Y[1],Y[2]),ne&&K.rotation.set(ne[0],ne[1],ne[2]),R&&K.scale.set(R[0],R[1],R[2]),K.updateMatrix();const oe=K.geometry.clone();oe.applyMatrix4(K.matrix),K.geometry=oe,K.renderOrder=1/0,K.position.set(0,0,0),K.rotation.set(0,0,0),K.scale.set(1,1,1),L.add(K)}return L}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=P(w)),this.add(this.gizmo.rotate=P($)),this.add(this.gizmo.scale=P(z)),this.add(this.picker.translate=P(E)),this.add(this.picker.rotate=P(k)),this.add(this.picker.scale=P(j)),this.add(this.helper.translate=P(S)),this.add(this.helper.rotate=P(M)),this.add(this.helper.scale=P(A)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:fo;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let n=0;n<i.length;n++){const r=i[n];r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition);let o;if(this.camera.isOrthographicCamera?o=(this.camera.top-this.camera.bottom)/this.camera.zoom:o=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),r.scale.set(1,1,1).multiplyScalar(o*this.size/4),r.tag==="helper"){r.visible=!1,r.name==="AXIS"?(r.visible=!!this.axis,this.axis==="X"&&(De.setFromEuler(Jr.set(0,0,0)),r.quaternion.copy(t).multiply(De),Math.abs(Te.copy(jn).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Y"&&(De.setFromEuler(Jr.set(0,0,Math.PI/2)),r.quaternion.copy(t).multiply(De),Math.abs(Te.copy(rs).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Z"&&(De.setFromEuler(Jr.set(0,Math.PI/2,0)),r.quaternion.copy(t).multiply(De),Math.abs(Te.copy(Hn).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="XYZE"&&(De.setFromEuler(Jr.set(0,Math.PI/2,0)),Te.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix(Sh.lookAt(Eh,Te,rs)),r.quaternion.multiply(De),r.visible=this.dragging),this.axis==="E"&&(r.visible=!1)):r.name==="START"?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):r.name==="END"?(r.position.copy(this.worldPosition),r.visible=this.dragging):r.name==="DELTA"?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),at.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),at.applyQuaternion(this.worldQuaternionStart.clone().invert()),r.scale.copy(at),r.visible=this.dragging):(r.quaternion.copy(t),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=this.axis.search(r.name)!==-1));continue}r.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(r.name==="X"&&Math.abs(Te.copy(jn).applyQuaternion(t).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Y"&&Math.abs(Te.copy(rs).applyQuaternion(t).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Z"&&Math.abs(Te.copy(Hn).applyQuaternion(t).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XY"&&Math.abs(Te.copy(Hn).applyQuaternion(t).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="YZ"&&Math.abs(Te.copy(jn).applyQuaternion(t).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XZ"&&Math.abs(Te.copy(rs).applyQuaternion(t).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1)):this.mode==="rotate"&&(eo.copy(t),Te.copy(this.eye).applyQuaternion(De.copy(t).invert()),r.name.search("E")!==-1&&r.quaternion.setFromRotationMatrix(Sh.lookAt(this.eye,Eh,rs)),r.name==="X"&&(De.setFromAxisAngle(jn,Math.atan2(-Te.y,Te.z)),De.multiplyQuaternions(eo,De),r.quaternion.copy(De)),r.name==="Y"&&(De.setFromAxisAngle(rs,Math.atan2(Te.x,Te.z)),De.multiplyQuaternions(eo,De),r.quaternion.copy(De)),r.name==="Z"&&(De.setFromAxisAngle(Hn,Math.atan2(Te.y,Te.x)),De.multiplyQuaternions(eo,De),r.quaternion.copy(De))),r.visible=r.visible&&(r.name.indexOf("X")===-1||this.showX),r.visible=r.visible&&(r.name.indexOf("Y")===-1||this.showY),r.visible=r.visible&&(r.name.indexOf("Z")===-1||this.showZ),r.visible=r.visible&&(r.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),r.material._color=r.material._color||r.material.color.clone(),r.material._opacity=r.material._opacity||r.material.opacity,r.material.color.copy(r.material._color),r.material.opacity=r.material._opacity,this.enabled&&this.axis&&(r.name===this.axis||this.axis.split("").some(function(a){return r.name===a}))&&(r.material.color.setHex(16776960),r.material.opacity=1)}super.updateMatrixWorld(e)}},wv=class extends re{constructor(){super(new Xl(1e5,1e5,2,2),new on({visible:!1,wireframe:!0,side:Ui,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),to.copy(jn).applyQuaternion(t==="local"?this.worldQuaternion:fo),Dn.copy(rs).applyQuaternion(t==="local"?this.worldQuaternion:fo),Ln.copy(Hn).applyQuaternion(t==="local"?this.worldQuaternion:fo),Te.copy(Dn),this.mode){case"translate":case"scale":switch(this.axis){case"X":Te.copy(this.eye).cross(to),ei.copy(to).cross(Te);break;case"Y":Te.copy(this.eye).cross(Dn),ei.copy(Dn).cross(Te);break;case"Z":Te.copy(this.eye).cross(Ln),ei.copy(Ln).cross(Te);break;case"XY":ei.copy(Ln);break;case"YZ":ei.copy(to);break;case"XZ":Te.copy(Ln),ei.copy(Dn);break;case"XYZ":case"E":ei.set(0,0,0);break}break;case"rotate":default:ei.set(0,0,0)}ei.length()===0?this.quaternion.copy(this.cameraQuaternion):(Ah.lookAt(at.set(0,0,0),ei,Te),this.quaternion.setFromRotationMatrix(Ah)),super.updateMatrixWorld(e)}},xv=class Yu{constructor(e,t,i,n,r,o=5,a=!0){if(C(this,"onDraggingStarted",new J),C(this,"onDraggingEnded",new J),C(this,"onDisposed",new J),C(this,"normal"),C(this,"origin"),C(this,"three",new Ot),C(this,"components"),C(this,"world"),C(this,"type","default"),C(this,"_title","Clipping Plane"),C(this,"_helper"),C(this,"_visible",!0),C(this,"_enabled",!0),C(this,"_controlsActive",!1),C(this,"_arrowBoundBox",new re),C(this,"_planeMesh"),C(this,"_controls"),C(this,"_hiddenMaterial",new on({visible:!1})),C(this,"_visibilityBeforeDisabled",!0),C(this,"notifyManager",()=>{const l=this.components.get(Pi),c=l.list.getKey(this);c&&l.list.set(c,this)}),C(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),C(this,"changeDrag",l=>{this._visible=!l.value,this.preventCameraMovement(),this.notifyDraggingChanged(l)}),this.components=e,this.world=t,!t.renderer)throw new Error("The given world must have a renderer!");this.normal=n,this.origin=i,t.renderer.setPlane(!0,this.three),this._planeMesh=Yu.newPlaneMesh(o,r),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(n,i),a&&this.toggleControls(!0)}set title(e){this._title=e,this.notifyManager()}get title(){return this._title}get enabled(){return this._enabled}set enabled(e){if(!this.world.isDisposing){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=e,e?this.visible=this._visibilityBeforeDisabled:(this._visibilityBeforeDisabled=this.visible,this.visible=!1),this.world.renderer.setPlane(e,this.three),this.notifyManager()}}get visible(){return this._visible}set visible(e){this._visible=e,this._controls.getHelper().visible=e,this._helper.visible=e,this.toggleControls(e),this.notifyManager()}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(e){this._planeMesh.material=e}get size(){return this._planeMesh.scale.x}set size(e){this._planeMesh.scale.set(e,e,e)}get helper(){return this._helper}get controls(){return this._controls}setFromNormalAndCoplanarPoint(e,t){this.reset(),this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.getHelper().removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const e=new D(1,0,0),t=new D;this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix()}toggleControls(e){if(e){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=e}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const e=this.world.camera.three,t=this.world.renderer.three.domElement,i=new pv(e,t);return this.initializeControls(i),this.world.scene.three.add(i.getHelper()),i}initializeControls(e){e.attach(this._helper),e.showX=!1,e.showY=!1,e.setSpace("local"),this.createArrowBoundingBox(),e.getHelper().children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new ht(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(e){e.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const e=new Ys;return e.lookAt(this.normal),e.position.copy(this.origin),this._planeMesh.position.z+=.01,e.add(this._planeMesh),this.world.scene.three.add(e),e}static newPlaneMesh(e,t){const i=new Xl(1),n=new re(i,t);return n.scale.set(e,e,e),n}},Cv=class extends Qo{constructor(){super(...arguments),C(this,"_config",{enabled:{value:!0,type:"Boolean"},visible:{value:!0,type:"Boolean"},color:{value:new be,type:"Color"},opacity:{type:"Number",interpolable:!0,value:1,min:0,max:1},size:{type:"Number",interpolable:!0,value:2,min:0,max:100}})}get enabled(){return this._config.enabled.value}set enabled(e){this._config.enabled.value=e,this._component.enabled=e}get visible(){return this._config.visible.value}set visible(e){this._config.visible.value=e,this._component.visible=e}get color(){return this._config.color.value}set color(e){this._config.color.value=e,this._component.material.color.copy(e)}get opacity(){return this._config.opacity.value}set opacity(e){this._config.opacity.value=e,this._component.material.opacity=e}get size(){return this._config.size.value}set size(e){this._config.size.value=e,this._component.size=e}};const Zu=class mo extends Ae{constructor(e){super(e),C(this,"onSetup",new J),C(this,"onBeforeDrag",new J),C(this,"onAfterDrag",new J),C(this,"onBeforeCreate",new J),C(this,"onBeforeCancel",new J),C(this,"onAfterCancel",new J),C(this,"onBeforeDelete",new J),C(this,"onAfterCreate",new J),C(this,"onAfterDelete",new J),C(this,"onDisposed",new J),C(this,"isSetup",!1),C(this,"orthogonalY",!1),C(this,"toleranceOrthogonalY",.7),C(this,"Type",xv),C(this,"list",new Se),C(this,"config",new Cv(this,this.components,"Clipper",mo.uuid)),C(this,"_defaultConfig",{color:new be(12255487),opacity:.2,size:2}),C(this,"_material",new on({color:12255487,side:Ui,transparent:!0,opacity:.2})),C(this,"_size",5),C(this,"_enabled",!1),C(this,"_visible",!0),C(this,"onStateChanged",new J),C(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),C(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(mo.uuid,this),this.setEvents()}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.onStateChanged.trigger(["enabled"])}get visible(){return this._visible}set visible(e){this._visible=e;for(const[t,i]of this.list)i.visible=e;this.onStateChanged.trigger(["visibility"])}get material(){return this._material}set material(e){this._material=e;for(const[t,i]of this.list)i.planeMaterial=e;this.onStateChanged.trigger(["material"])}get size(){return this._size}set size(e){this._size=e;for(const[t,i]of this.list)i.size=e;this.onStateChanged.trigger(["size"])}setEvents(){this.list.onBeforeDelete.add(({value:e})=>{if(!e.world.renderer)throw new Error("Renderer not found for this plane's world!");e.world.renderer.setPlane(!1,e.three),e.dispose(),this.updateMaterialsAndPlanes(),this.onAfterDelete.trigger(e)})}dispose(){this._enabled=!1,this.components.get(sc).list.delete(this.config.uuid),this.list.clear(),this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(mo.uuid),this.onDisposed.reset()}async create(e){const t=await this.components.get(pt).get(e).castRay();return t?this.createPlaneFromIntersection(e,t):null}createFromNormalAndCoplanarPoint(e,t,i){const n=this.newPlane(e,i,t);return this.updateMaterialsAndPlanes(),n}async delete(e,t){if(!t){const i=await this.pickPlane(e);if(!i)return;t=this.list.getKey(i)}t&&this.list.delete(t)}deleteAll(e){for(const[t,i]of this.list)(!e||e.has(i.type))&&this.list.delete(t)}setup(e){const t={...this._defaultConfig,...e};this.config.color=t.color,this.config.opacity=t.opacity,this.config.size=t.size,this.isSetup=!0,this.onSetup.trigger()}async pickPlane(e){const t=this.components.get(pt).get(e),i=this.getAllPlaneMeshes(),n=await t.castRay({items:i});if(n){const r=n.object;return[...this.list.values()].find(o=>o.meshes.includes(r))}}getAllPlaneMeshes(){const e=[];for(const[t,i]of this.list)e.push(...i.meshes);return e}createPlaneFromIntersection(e,t){var i;if(!e.renderer)throw new Error("The given world must have a renderer!");const n=t.point.distanceTo(new D(0,0,0)),r=t.normal||((i=t.face)==null?void 0:i.normal);if(!n||!r)return null;const o=this.getWorldNormal(t,r),a=this.newPlane(e,t.point,o.negate()),l=this.list.get(a);return l.visible=this._visible,l.size=this._size,e.renderer.setPlane(!0,l.three),this.updateMaterialsAndPlanes(),l}getWorldNormal(e,t){const i=e.object;let n=e.object.matrixWorld.clone();if(i instanceof Lm&&e.instanceId!==void 0){const a=new xe;i.getMatrixAt(e.instanceId,a),n=a.multiply(n)}const r=new Bm().getNormalMatrix(n),o=t.clone().applyMatrix3(r).normalize();return this.normalizePlaneDirectionY(o),o}normalizePlaneDirectionY(e){this.orthogonalY&&(e.y>this.toleranceOrthogonalY&&(e.x=0,e.y=1,e.z=0),e.y<-this.toleranceOrthogonalY&&(e.x=0,e.y=-1,e.z=0))}newPlane(e,t,i){const n=new this.Type(this.components,e,t,i,this._material);n.onDraggingStarted.add(this._onStartDragging),n.onDraggingEnded.add(this._onEndDragging);const r=st.create();return this.list.set(r,n),this.onAfterCreate.trigger(n),r}updateMaterialsAndPlanes(){const e=this.components.get(Du);for(const[t,i]of e.list){if(!i.renderer)continue;i.renderer.updateClippingPlanes();const{clippingPlanes:n}=i.renderer;for(const r of i.meshes)if(r.material)if(Array.isArray(r.material))for(const o of r.material)o.clippingPlanes=n;else r.material.clippingPlanes=n}}};C(Zu,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let Pi=Zu,Gu=class{constructor(e,t){C(this,"title"),C(this,"guid",st.create()),C(this,"clippingPlanes",new je),C(this,"camera",{aspect_ratio:1,field_of_view:60,camera_direction:{x:0,y:0,z:0},camera_view_point:{x:0,y:0,z:0},camera_up_vector:{x:0,y:1,z:0}}),C(this,"customData",{}),C(this,"exceptionComponents",new je),C(this,"selectionComponents",new je),C(this,"componentColors",new Se),C(this,"spacesVisible",!1),C(this,"spaceBoundariesVisible",!1),C(this,"openingsVisible",!1),C(this,"defaultVisibility",!0),C(this,"snapshot",this.guid),C(this,"_components"),C(this,"_world",null),C(this,"notifyUpdate",()=>{this._components.get(ui).list.set(this.guid,this)}),this._components=e,t&&(this.guid=t.guid??this.guid,this.set(t)),this.setEvents()}async getSelectionMap(){return await this._components.get(he).guidsToModelIdMap([...this.selectionComponents])}async getExceptionMap(){return await this._components.get(he).guidsToModelIdMap([...this.exceptionComponents])}get projection(){return"field_of_view"in this.camera?"Perspective":"Orthographic"}get position(){const e=this._components.get(he),{camera_view_point:t}=this.camera,{x:i,y:n,z:r}=t,o=new D(i,n,r);return e.applyBaseCoordinateSystem(o,new xe),o}set position(e){const t=e.clone(),i=this._components.get(he);e.clone().applyMatrix4(i.baseCoordinationMatrix.clone().invert()),this.camera.camera_view_point={x:t.x,y:t.y,z:t.z}}get direction(){const{camera_direction:e}=this.camera,{x:t,y:i,z:n}=e;return new D(t,i,n)}set world(e){this._world=e}get world(){return this._world}get _managerVersion(){return this._components.get(Ge).config.version}get topics(){return[...this._components.get(Ge).list.values()].filter(e=>e.viewpoints.has(this.guid))}setEvents(){this.selectionComponents.onUpdated.add(this.notifyUpdate),this.exceptionComponents.onUpdated.add(this.notifyUpdate),this.clippingPlanes.onUpdated.add(this.notifyUpdate),this.componentColors.onItemSet.add(this.notifyUpdate),this.componentColors.onItemDeleted.add(this.notifyUpdate),this.componentColors.onItemUpdated.add(this.notifyUpdate),this.componentColors.onCleared.add(this.notifyUpdate)}set(e){this.title=e.title;const{components:t,perspective_camera:i,orthogonal_camera:n,clipping_planes:r}=e;if(t){const{selection:o,visibility:a,coloring:l}=t;if(o){this.selectionComponents.clear();for(const{ifc_guid:c}of o)c&&this.selectionComponents.add(c)}if(a){const{default_visibility:c,exceptions:h,view_setup_hints:d}=a;if(c!==void 0&&(this.defaultVisibility=c),h){this.exceptionComponents.clear();for(const{ifc_guid:p}of h)p&&this.exceptionComponents.add(p)}if(d){const{spaces_visible:p,space_boundaries_visible:u,openings_visible:g}=d;p!==void 0&&(this.spacesVisible=p),u!==void 0&&(this.spaceBoundariesVisible=u),g!==void 0&&(this.openingsVisible=g)}}if(l){this.componentColors.clear();for(const c of l){const{color:h,components:d}=c,p=d.map(u=>u.ifc_guid).filter(u=>u!==null);this.componentColors.set(h,p)}}}if((i||n)&&(this.camera=i??n),r&&this.world){const o=this._components.get(Pi);for(const a of r){const{location:l,direction:c}=a,h=new D(l.x,l.z,-l.y),d=new D(c.x,c.z,-c.y),p=o.createFromNormalAndCoplanarPoint(this.world,d,h);this.clippingPlanes.add(p),o.list.get(p).enabled=!1,o.list.get(p).visible=!1}}this.notifyUpdate()}async go(e){if(!this.world)return;const{camera:t}=this.world;if(!(t instanceof Vu))throw new Error("Viewpoint: the world's camera component must be of type OrthoPerspectiveCamera to switch between perspective and orthographic projections.");const{transition:i,applyClippings:n,applyVisibility:r,clippingsVisibility:o}={transition:!0,applyClippings:!0,applyVisibility:!0,clippingsVisibility:!0,...e};t.projection.set(this.projection);const a=new D(this.camera.camera_view_point.x,this.camera.camera_view_point.y,this.camera.camera_view_point.z),l=new D(this.camera.camera_direction.x,this.camera.camera_direction.y,this.camera.camera_direction.z);if(a.equals(new D)&&l.equals(new D))return;const c=this.position,h=this.direction,d=80,p={x:c.x+h.x*d,y:c.y+h.y*d,z:c.z+h.z*d},u=[];n&&this.setClippingState(!0),r&&u.push(this.applyVisibility()),this.setClippingVisibility(o),u.push(t.controls.setLookAt(c.x,c.y,c.z,p.x,p.y,p.z,i)),await Promise.all(u)}async updateCamera(e=!0){return new Promise(t=>{if(!this.world){t(!1);return}const{camera:i,renderer:n}=this.world;if(!n)throw new Error("Viewpoint: the world needs to have a renderer!");if(!i.hasCameraControls())throw new Error("Viewpoint: world's camera need camera controls!");const r=new D;i.controls.getPosition(r);const o=i.three,a=new D(0,0,-1).applyEuler(o.rotation),{width:l,height:c}=n.getSize();let h=l/c;Number.isNaN(h)&&(h=1);const d=this._components.get(he);r.applyMatrix4(d.baseCoordinationMatrix.clone().invert());const p={aspect_ratio:h,camera_view_point:{x:r.x,y:r.y,z:r.z},camera_direction:{x:a.x,y:a.y,z:a.z},camera_up_vector:{x:0,y:1,z:0}};if(o instanceof Jd?this.camera={...p,field_of_view:o.fov}:o instanceof Vo&&(this.camera={...p,view_to_world_scale:o.top-o.bottom}),e){const u=this._components.get(ui),g=n.three.domElement;n.three.render(this.world.scene.three,i.three),g.toBlob(async m=>{if(m){const b=await m.arrayBuffer(),f=new Uint8Array(b);u.snapshots.set(this.guid,f)}this.notifyUpdate(),t(!0)})}else this.notifyUpdate(),t(!0)})}takeSnapshot(){return new Promise(e=>{if(!this.world){e(!1);return}const{camera:t,renderer:i}=this.world;if(!i)throw new Error("Viewpoint: the world needs to have a renderer!");const n=this._components.get(ui),r=i.three.domElement;i.three.render(this.world.scene.three,t.three),r.toBlob(async o=>{if(o){const a=await o.arrayBuffer(),l=new Uint8Array(a);n.snapshots.set(this.guid,l)}this.notifyUpdate(),e(!0)})})}updateClippingPlanes(){this.clippingPlanes.clear();const e=this._components.get(Pi);for(const[t,i]of e.list)i.enabled&&this.clippingPlanes.add(t)}async applyVisibility(){const e=this._components.get(Fb);e.set(this.defaultVisibility);const t=await this.getExceptionMap();e.set(!this.defaultVisibility,t);const i=await this.getSelectionMap();e.set(!0,i)}async setColorizationState(e){const t=this._components.get(he),i=[];if(e)for(const[n,r]of this.componentColors){const o=`#${n}`,a=await t.guidsToModelIdMap(r);for(const[l,c]of Object.entries(a)){const h=t.list.get(l);h&&i.push(h.highlight([...c],{customId:o,color:new be(o),renderedFaces:Qd.ONE,opacity:1,transparent:!1}))}}else for(const[n,r]of this.componentColors){const o=await t.guidsToModelIdMap(r);for(const[a,l]of Object.entries(o)){const c=t.list.get(a);c&&i.push(c.resetHighlight([...l]))}}i.push(t.core.update(!0)),await Promise.all(i)}setClippingState(e){const t=this._components.get(Pi);for(const[i,n]of t.list)n.enabled=e&&this.clippingPlanes.has(i)}setClippingVisibility(e){const t=this._components.get(Pi);for(const i of this.clippingPlanes){const n=t.list.get(i);n&&(n.visible=e)}}async createComponentTags(e){var t;const i=this._components.get(he),n=this._components.get(Ge);let r="";if(n.config.includeSelectionTag){const o=e==="selection"?await this.getSelectionMap():await this.getExceptionMap();for(const a in o){const l=i.list.get(a);if(!l)continue;const c=o[a];for(const h of c){const d=l.getItem(h),p=await d.getGuid();if(!p)continue;const u=(t=await d.getAttributes())==null?void 0:t.getValue("Tag");let g=null;u&&(g=`AuthoringToolId="${u}"`),r+=`
<Component IfcGuid="${p}" ${g??""} />`}}}else r=[...this.selectionComponents].map(o=>`<Component IfcGuid="${o}" />`).join(`
`);return r}createColorTags(){let e="";for(const[t,i]of this.componentColors.entries()){const n=i.map(r=>`
<Component IfcGuid="${r}" />`).join(`
`);e+=`<Color Color="${t}">
${n}
</Color>`}return e.length!==0?`<Coloring>
${e}
</Coloring>`:"<Coloring />"}toJSON(){const e=this._components.get(Pi),t={guid:this.guid,components:{selection:[...this.selectionComponents].map(r=>({ifc_guid:r,authoring_tool_id:null})),coloring:[...this.componentColors].map(([r,o])=>({color:r,components:o.map(a=>({ifc_guid:a,authoring_tool_id:null}))})),visibility:{default_visibility:this.defaultVisibility,exceptions:[...this.exceptionComponents].map(r=>({ifc_guid:r,authoring_tool_id:null})),view_setup_hints:{spaces_visible:this.spacesVisible,space_boundaries_visible:this.spaceBoundariesVisible,openings_visible:this.openingsVisible}}},clipping_planes:[...this.clippingPlanes].map(r=>{const o=e.list.get(r);if(!o)return null;const a=o._controls.worldPosition??o.origin,{normal:l}=o;return{location:{x:a.x,y:-a.z,z:a.y},direction:{x:l.x,y:-l.z,z:l.y}}}).filter(r=>r!==null)};"field_of_view"in this.camera?t.perspective_camera=this.camera:t.orthogonal_camera=this.camera;const i=this._components.get(ui),n=i.snapshots.get(this.snapshot);if(n){const r=n.toString(),o=btoa(r),a=i.getSnapshotExtension(this.snapshot);t.snapshot={snapshot_type:a,snapshot_data:o}}return t}async serialize(e=this._managerVersion){const t=this._components.get(he),i=this.position;i.applyMatrix4(t.baseCoordinationMatrix.clone().invert());const n=this.direction;n.normalize();const r=new xe().makeRotationX(Math.PI/2),o=n.clone().applyMatrix4(r);o.normalize();const a=`<CameraViewPoint>
      <X>${i.x}</X>
      <Y>${-i.z}</Y>
      <Z>${i.y}</Z>
    </CameraViewPoint>`,l=`<CameraDirection>
      <X>${n.x}</X>
      <Y>${-n.z}</Y>
      <Z>${n.y}</Z>
    </CameraDirection>`,c=`<CameraUpVector>
      <X>${o.x}</X>
      <Y>${-o.z}</Y>
      <Z>${o.y}</Z>
    </CameraUpVector>`,h=`<AspectRatio>${this.camera.aspect_ratio}</AspectRatio>`;let d="";"view_to_world_scale"in this.camera?d=`<OrthogonalCamera>
        ${a}
        ${l}
        ${c}
        ${h}
        <ViewToWorldScale>${this.camera.view_to_world_scale}</ViewToWorldScale>
      </OrthogonalCamera>`:"field_of_view"in this.camera&&(d=`<PerspectiveCamera>
        ${a}
        ${l}
        ${c}
        ${h}
        <FieldOfView>${this.camera.field_of_view}</FieldOfView>
      </PerspectiveCamera>`);const p=`<ViewSetupHints SpacesVisible="${this.spacesVisible??!1}" SpaceBoundariesVisible="${this.spaceBoundariesVisible??!1}" OpeningsVisible="${this.openingsVisible??!1}" />`,u=(await this.createComponentTags("selection")).trim(),g=(await this.createComponentTags("exception")).trim(),m=this.createColorTags();return`<?xml version="1.0" encoding="UTF-8"?>
    <VisualizationInfo Guid="${this.guid}">
      <Components>
        ${e==="2.1"?p:""}
        ${u.length!==0?`<Selection>${u}</Selection>`:""}
        <Visibility DefaultVisibility="${this.defaultVisibility}">
          ${e==="3"?p:""}
          ${g.length!==0?`<Exceptions>${g}</Exceptions>`:""}
        </Visibility>
        ${m}
      </Components>
      ${d}
    </VisualizationInfo>`}},Ev=class extends Qo{constructor(){super(...arguments),C(this,"_config",{overwriteColors:{value:!1,type:"Boolean"}})}get overwriteColors(){return this._config.overwriteColors.value}set overwriteColors(e){this._config.overwriteColors.value=e}};const Xu=class yl extends Ae{constructor(e){super(e),C(this,"enabled",!0),C(this,"world",null),C(this,"list",new Se),C(this,"snapshots",new Se),C(this,"isSetup",!1),C(this,"onSetup",new J),C(this,"config",new Ev(this,this.components,"Viewpoints",yl.uuid)),C(this,"onDisposed",new J),e.add(yl.uuid,this)}create(e){const t=new Gu(this.components,e);return t.world=this.world,e||this.list.set(t.guid,t),t}getSnapshotExtension(e){let t="jpeg";const i=this.snapshots.get(e);if(!i)return t;const n=i.subarray(0,4);let r="";for(let o=0;o<n.length;o++)r+=n[o].toString(16);return r.startsWith("89504e47")&&(t="png"),r.startsWith("ffd8ffe")&&(t="jpeg"),t}setup(){}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}};C(Xu,"uuid","ee867824-a796-408d-8aa0-4e5962a83c66");let ui=Xu,$h=class{constructor(e,t){C(this,"_components"),C(this,"_cameraOffset",10),C(this,"_planeHelper"),C(this,"_farPlaneHelper"),C(this,"_cameraHelper"),C(this,"onStateChanged",new J),C(this,"onUpdated",new J),C(this,"onDisposed",new J),C(this,"camera"),C(this,"plane",new Ot),C(this,"farPlane",new Ot),C(this,"id",st.create()),C(this,"_open",!1),C(this,"_range",Sv.defaultRange),C(this,"_world",null),C(this,"_helpersVisible",!1),C(this,"_planesEnabled",!1),this._components=e,this.camera=new Vu(this._components);const{threeOrtho:i}=this.camera;if(t!=null&&t.id&&(this.id=t.id),t!=null&&t.normal&&t!=null&&t.point){const{normal:n,point:r}=t;this.plane.setFromNormalAndCoplanarPoint(n,r)}this._cameraHelper=new qm(i),this._planeHelper=new Nc(this.plane,50),this._farPlaneHelper=new Nc(this.farPlane,50),this.farPlaneHelperColor=new be("blue"),this.update()}get _planeNormalOpposite(){return this.plane.normal.clone().negate()}get _planePosition(){return this.plane.normal.clone().multiplyScalar(-this.plane.constant)}get _cameraPosition(){return this._planePosition.addScaledVector(this._planeNormalOpposite,this._cameraOffset)}set open(e){this._open=e,this.onStateChanged.trigger(["open"])}get open(){return this._open}set planeHelperColor(e){!Array.isArray(this._planeHelper.material)&&"color"in this._planeHelper.material&&this._planeHelper.material.color instanceof be&&(this._planeHelper.material.color=e)}set farPlaneHelperColor(e){!Array.isArray(this._farPlaneHelper.material)&&"color"in this._farPlaneHelper.material&&this._farPlaneHelper.material.color instanceof be&&(this._farPlaneHelper.material.color=e)}set range(e){this._range=e,this.update()}get range(){return this._range}set distance(e){this.plane.constant=e,this.update()}get distance(){return this.plane.constant}set world(e){this._world=e,this.camera.currentWorld=e,e&&(this.camera.projection.set("Orthographic"),this.camera.set("Plan"),this.camera.controls.dollySpeed=6,this.camera.controls.restThreshold=.005,this.update())}get world(){return this._world}set helpersVisible(e){if(!e){this._helpersVisible=e,this._planeHelper.removeFromParent(),this._farPlaneHelper.removeFromParent(),this._cameraHelper.removeFromParent();return}this.world&&(this._helpersVisible=e,this.world.scene.three.add(this._planeHelper,this._farPlaneHelper))}get helpersVisible(){return this._helpersVisible}set planesEnabled(e){const{world:t}=this;if(!t)return;const{renderer:i}=t;i&&(i.setPlane(e,this.plane),i.setPlane(e,this.farPlane),this._planesEnabled=e)}get planesEnabled(){return this._planesEnabled}dispose(){this.helpersVisible=!1;const e=this._components.get(oi);e.destroy(this._planeHelper),e.destroy(this._farPlaneHelper),e.destroy(this._cameraHelper),this.camera.dispose(),this.onDisposed.trigger()}update(){if(this.world){const e=this._cameraPosition,t=this._planePosition;this.camera.controls.setLookAt(e.x,e.y,e.z,t.x,t.y,t.z,!1)}this.farPlane.normal.copy(this._planeNormalOpposite),this.farPlane.constant=this.range-this.plane.constant,this.onUpdated.trigger()}flip(){this.plane.normal.negate(),this.update()}};const lc=class Qu extends Ae{constructor(e){super(e),C(this,"list",new Se),C(this,"enabled",!0),C(this,"world",null),C(this,"_fragmentsUpdateEvent",()=>{this.components.get(he).core.update(!0)}),e.add(Qu.uuid,this),this.setupEvents()}get hasOpenViews(){return[...this.list.values()].some(e=>e.open)}setupEvents(){this.list.onBeforeDelete.add(({key:e,value:t})=>{t.open&&this.close(e),t.dispose()})}create(e,t,i){const n=new $h(this.components,{id:i==null?void 0:i.id,normal:e,point:t});return n.world=(i==null?void 0:i.world)??this.world,this.list.set(n.id,n),n}createFromPlane(e,t){const i=new $h(this.components,{id:t==null?void 0:t.id});return i.plane.copy(e),i.update(),i.world=(t==null?void 0:t.world)??this.world,this.list.set(i.id,i),i}async createFromIfcStoreys(e){const t=[],i=this.components.get(he),n=(e==null?void 0:e.offset)===void 0?.25:e.offset;for(const[r,o]of i.list){if(e&&e.modelIds&&!e.modelIds.some(d=>d.test(r)))continue;const a=Object.values(await o.getItemsOfCategories([/BUILDINGSTOREY/])).flat();if(a.length===0)continue;const l=await o.getItemsData(a),[,c]=await o.getCoordinates(),h=new D(0,-1,0);for(const d of l){if(!("value"in d.Name&&"value"in d.Elevation))continue;const{value:p}=d.Name;if(e!=null&&e.storeyNames&&!e.storeyNames.some(b=>b.test(p)))continue;const u=d.Elevation.value+c+n,g=new Ot(h,u),m=this.createFromPlane(g,{id:p,world:e==null?void 0:e.world});t.push(m)}}return t}createElevations(e){const t=[],i=this.components.get(he),n=(e==null?void 0:e.combine)===void 0?!1:e.combine,r=(e==null?void 0:e.namingCallback)??(a=>({front:`${n?"Front":`${a}: Front`}`,back:`${n?"Back":`${a}: Back`}`,left:`${n?"Left":`${a}: Left`}`,right:`${n?"Right":`${a}: Right`}`}));let o=[];for(const[a,l]of i.list)e&&e.modelIds&&!e.modelIds.some(c=>c.test(a))||o.push({id:a,box:l.box});if(n){const a=this.components.get(xo);a.list.clear(),a.list.add(...o.map(l=>l.box)),o=[{id:"combined",box:a.get()}]}for(const{id:a,box:l}of o){const{min:c,max:h}=l,d=Math.abs(h.x-c.x),p=Math.abs(h.z-c.z),u=new D;l.getCenter(u);const g=new Ot(new D(0,0,-1),h.z),m=new Ot(new D(0,0,1),-c.z),b=new Ot(new D(-1,0,0),h.x),f=new Ot(new D(1,0,0),-c.x),{front:y,back:v,left:w,right:E}=r(a),S=this.createFromPlane(g,{id:y,world:e==null?void 0:e.world});S.range=p;const $=this.createFromPlane(m,{id:v,world:e==null?void 0:e.world});$.range=p;const M=this.createFromPlane(b,{id:w,world:e==null?void 0:e.world});M.range=d;const k=this.createFromPlane(f,{id:E,world:e==null?void 0:e.world});k.range=d,t.push(S,$,M,k)}return t}open(e){const t=this.list.get(e);if(!t)throw new Error(`Views: the view with id ${e} doesn't exist.`);if(t.open)return;const{world:i}=t;if(!i)throw new Error(`Views: no world found for view with id ${e}.`);const{renderer:n}=i;if(!n)throw new Error(`Views: no renderer found for world with id ${i.uuid}.`);for(const[,r]of this.list)r.world===i&&this.close(r.id);n.setPlane(!0,t.plane),n.setPlane(!0,t.farPlane),t.camera.controls.addEventListener("rest",this._fragmentsUpdateEvent),i.camera=t.camera,t.open=!0}close(e){let t;if(e?t=this.list.get(e):t=[...this.list.values()].find(r=>r.open),e&&!t)throw new Error(`Views: the view with id ${e} doesn't exist.`);if(!t||!t.open)return;const{world:i}=t;if(!i)throw new Error(`Views: no world found for view with id ${e}.`);const{renderer:n}=i;if(!n)throw new Error(`Views: no renderer found for world with id ${i.uuid}.`);n.setPlane(!1,t.plane),n.setPlane(!1,t.farPlane),t.camera.controls.removeEventListener("rest",this._fragmentsUpdateEvent),i.useDefaultCamera(),t.open=!1}};C(lc,"uuid","fb22f1f5-6598-4664-a11d-de8963ae420f");C(lc,"defaultRange",15);let Sv=lc,ln=class{constructor(e){C(this,"cardinality","required"),C(this,"instructions"),C(this,"evalRequirement",(t,i,n,r)=>{const o={parameter:n,currentValue:t,requiredValue:i,pass:!1};r&&this.addCheckResult(o,r);let a=!1;if(i.type==="simple"&&(a=t===i.parameter),i.type==="enumeration"&&(a=i.parameter.includes(t)),i.type==="pattern"&&(a=new RegExp(i.parameter).test(String(t))),i.type==="length"){const{min:l,length:c,max:h}=i.parameter;c!==void 0&&(a=String(t).length===c),l!==void 0&&(a=String(t).length>=l),h!==void 0&&(a=String(t).length<=h)}if(i.type==="bounds"&&typeof t=="number"){const{min:l,minInclusive:c,max:h,maxInclusive:d}=i.parameter;let p=!0,u=!0;l!==void 0&&(p=c?t>=l:t>l),h!==void 0&&(u=d?t<=h:t<h),a=p&&u}return this.cardinality==="prohibited"&&(a=!a),this.cardinality==="optional"&&(a=!0),o.pass=a,o.pass}),this._components=e}addCheckResult(e,t){const i=t.findIndex(({parameter:n})=>n===e.parameter);i!==-1?t[i]=e:t.push(e)}getItemChecks(e,t,i,n){if(!("value"in i._localId&&typeof i._localId.value=="number"))return null;let r=e.get(t);r||(r=new Se,e.set(t,r));let o=r.get(i._localId.value);if(o&&n&&!o.pass)return null;if(!o){const c=[];o={guid:Array.isArray(i._guid)?void 0:i._guid.value,pass:!1,checks:c},Object.defineProperty(o,"pass",{get:()=>c.every(({pass:h})=>h)}),r.set(i._localId.value,o)}const a=[],l={facetType:this.facetType,cardinality:this.cardinality,checks:a,pass:!1};return Object.defineProperty(l,"pass",{get:()=>a.every(({pass:c})=>c)}),o.checks.push(l),l.checks}};const ri=(s,e)=>{let t="";if(!e)return t;if(e.type==="simple"&&(t=`<simpleValue>${e.parameter}</simpleValue>`),e.type==="enumeration"&&(t=`<xs:restriction base="xs:string">
    ${e.parameter.map(i=>`<xs:enumeration value="${i}" />`).join(`
`)}
    </xs:restriction>`),e.type==="pattern"&&(t=`<xs:restriction base="xs:string">
      <xs:pattern value="${e.parameter}" />
    </xs:restriction>`),e.type==="bounds"){const{min:i,minInclusive:n,max:r,maxInclusive:o}=e.parameter;let a="";i!==void 0&&(a=`<xs:min${n?"Inclusive":"Exclusive"} value="${i}">`);let l="";r!==void 0&&(l=`<xs:max${o?"Inclusive":"Exclusive"} value="${r}">`),t=`<xs:restriction base="xs:double">
      ${a}
      ${l}
    </xs:restriction>`}if(e.type==="length"){const{length:i,min:n,max:r}=e.parameter;let o="";i!==void 0&&n===void 0&&r===void 0&&(o=`<xs:length value="${i}" />`);let a="";n!==void 0&&i===void 0&&(a=`<xs:minLength value="${n}" />`);let l="";r!==void 0&&i===void 0&&(l=`<xs:maxLength value="${r}" />`),t=`<xs:restriction base="xs:string">
      ${o}
      ${a}
      ${l}
    </xs:restriction>`}return`<${s[0].toLowerCase()+s.slice(1)}>
    ${t}
  </${s[0].toLowerCase()+s.slice(1)}>`};let Av=class extends ln{constructor(e,t){super(e),C(this,"facetType","Attribute"),C(this,"name"),C(this,"value"),this.name=t}serialize(e){const t=ri("Name",this.name),i=ri("Value",this.value);let n="";return e==="requirement"&&(n+=`cardinality="${this.cardinality}"`,n+=this.instructions?`instructions="${this.instructions}"`:""),`<attribute ${n}>
  ${t}
  ${i}
</attribute>`}async getEntities(){}async test(e,t,i={skipIfFails:!0}){const n=this._components.get(he);for(const[r,o]of Object.entries(e)){const a=n.list.get(r);if(!a)continue;const l=await a.getItemsData([...o]);for(const c of l){const h=this.getItemChecks(t,r,c,i.skipIfFails);if(!h)continue;const d=Object.keys(c).filter(u=>{const g=this.evalRequirement(u,this.name,"Name");if(!g)return!1;const m=c[u];return Array.isArray(m)?!0:m===null||m.value===null?this.cardinality==="optional"||this.cardinality==="prohibited":Array.isArray(m.value)&&m.value.length===0||typeof m.value=="string"&&m.value.trim()===""?!1:g}),p=d.length>0;if(h.push({parameter:"Name",currentValue:p?d[0]:null,requiredValue:this.name,pass:this.cardinality==="prohibited"?!p:p}),this.value)if(d[0]){const u=c[d[0]];Array.isArray(u)?h.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"}):Array.isArray(u.value)?h.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"}):this.evalRequirement(u.value,this.value,"Value",h)}else h.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"})}}}},$v=class extends ln{constructor(e,t){super(e),C(this,"facetType","Classification"),C(this,"system"),C(this,"value"),C(this,"uri"),this.system=t}serialize(e){const t=ri("System",this.system),i=ri("Value",this.value);let n="";return e==="requirement"&&(n+=`cardinality="${this.cardinality}"`,n+=this.uri?`uri=${this.uri}`:"",n+=this.instructions?`instructions="${this.instructions}"`:""),`<classification ${n}>
  ${t}
  ${i}
</classification>`}async getEntities(e,t){}async test(e,t){}},vl=class extends ln{constructor(e,t){super(e),C(this,"facetType","Entity"),C(this,"name"),C(this,"predefinedType"),this.name=t}serialize(e){const t=ri("Name",this.name),i=ri("Name",this.predefinedType);let n="";return e==="requirement"&&(n+=`cardinality="${this.cardinality}"`,n+=this.instructions?`instructions="${this.instructions}"`:""),`<entity ${n}>
  ${t}
  ${i}
</entity>`}async getEntities(e,t){const i=this._components.get(he),n=new Map;for(const[o,a]of i.list){if(!e.find(c=>c.test(o)))continue;const l=await a.getCategories();for(const c of l){if(!await this.evalName(c))continue;let h=n.get(o);h||(h=[],n.set(o,h)),h.push(c)}}const r={};if(await Promise.all(Array.from(n.entries()).map(async([o,a])=>{const l=i.list.get(o);if(!l)return;const c=a.map(p=>new RegExp(`^${p}$`)),h=await l.getItemsOfCategories(c),d=Object.values(h).flat();r[o]=new Set(d)})),!this.predefinedType){ke.add(t,r);return}for(const[o,a]of Object.entries(r)){const l=i.list.get(o);if(!l)continue;const c=await l.getItemsData([...a]);for(const h of c)"value"in h._localId&&await this.evalPredefinedType(o,h)&&ke.append(t,o,h._localId.value)}}async test(e,t,i){const n=this._components.get(he);for(const[r,o]of Object.entries(e)){const a=n.list.get(r);if(!a)continue;const l=await a.getItemsData([...o]);for(const c of l){if(!("value"in c._category))continue;const h=this.getItemChecks(t,r,c,i.skipIfFails);h&&(await this.evalName(c._category.value,h),await this.evalPredefinedType(r,c,h))}}}async evalName(e,t){return this.evalRequirement(e,this.name,"Name",t)}async evalPredefinedType(e,t,i){if(!this.predefinedType||!("value"in t.PredefinedType))return null;const n=typeof this.predefinedType.parameter=="string"&&this.predefinedType.parameter==="USERDEFINED";let r=t.PredefinedType.value;if(r==="USERDEFINED"&&!n){const o=Object.keys(t).find(a=>/^((?!Predefined).)*Type$/.test(a));if(o){const a=t[o];"value"in a&&(r=a.value)}else r="USERDEFINED"}if(!r){const o=this._components.get(he).list.get(e);if(o&&"value"in t._localId){const[a]=await o.getItemsData([t._localId.value],{relations:{IsTypedBy:{attributes:!0,relations:!1}}});if(Array.isArray(a.IsTypedBy)){const l=a.IsTypedBy[0];if(l&&"value"in l.PredefinedType&&(r=l.PredefinedType.value,r==="USERDEFINED"&&!n)){const c=Object.keys(l).find(h=>/^((?!Predefined).)*Type$/.test(h));if(c){const h=l[c];"value"in h&&(r=h.value)}else r="USERDEFINED"}}}}return this.evalRequirement(r,this.predefinedType,"PredefinedType",i)}},Tv=class extends ln{constructor(e,t,i){super(e),C(this,"facetType","Property"),C(this,"propertySet"),C(this,"baseName"),C(this,"value"),C(this,"dataType"),C(this,"uri"),C(this,"_unsupportedTypes",["IFCCOMPLEXPROPERTY","IFCPHYSICALCOMPLEXQUANTITY"]),this.propertySet=t,this.baseName=i}serialize(e){const t=ri("PropertySet",this.propertySet),i=ri("BaseName",this.baseName),n=ri("Value",this.value),r=this.dataType?`dataType=${this.dataType}`:"";let o="";return e==="requirement"&&(o+=`cardinality="${this.cardinality}"`,o+=this.uri?`uri=${this.uri}`:"",o+=this.instructions?`instructions="${this.instructions}"`:""),`<property ${r} ${o}>
  ${t}
  ${i}
  ${n}
</property>`}async getEntities(e,t){const i=this._components.get(he);for(const[n,r]of i.list){if(!e.find(c=>c.test(n)))continue;const o=await r.getItemsOfCategories([/PROPERTYSET/,/ELEMENTQUANTITY/]),a=Object.values(o).flat();if(a.length===0)continue;const l=await r.getItemsData(a,{relations:{HasProperties:{attributes:!0,relations:!1},DefinesOcurrence:{attributes:!0,relations:!1}}});for(const c of l){if(!("value"in c._localId&&"value"in c._category&&"value"in c.Name&&Array.isArray(c.DefinesOcurrence))||!this.evalRequirement(c.Name.value,this.propertySet,"PropertySet"))continue;let h;if(c._category.value==="IFCPROPERTYSET"&&(h="HasProperties"),c._category.value==="IFCELEMENTQUANTITY"&&(h="Quantities"),!h)continue;const d=c[h];if(Array.isArray(d))for(const p of d){const u=Object.keys(p),g=u.find(f=>/Name/.test(f));if(!(g&&"value"in p[g]))continue;const m=p[g];if(!("value"in m)||!this.evalRequirement(m.value,this.baseName,"BaseName"))continue;if(this.value){const f=u.find(v=>/Value/.test(v));if(!f)continue;const y=p[f];if(!("value"in y)||!this.evalRequirement(y.value,this.value,"Value"))continue}const b=c.DefinesOcurrence.map(f=>"value"in f._localId&&typeof f._localId.value=="number"?f._localId.value:null).filter(f=>f!==null);ke.append(t,n,...b)}}}}async test(e,t,i={skipIfFails:!0}){const n=this._components.get(he);for(const[r,o]of Object.entries(e)){const a=n.list.get(r);if(!a)continue;const l=await a.getItemsData([...o],{relations:{IsDefinedBy:{attributes:!0,relations:!0},IsTypedBy:{attributes:!0,relations:!1},HasPropertySets:{attributes:!0,relations:!0},DefinesOcurrence:{attributes:!1,relations:!1}}});for(const c of l){const h=this.getItemChecks(t,r,c,i.skipIfFails);if(!h)continue;const d=(await this.getPsets(c)).filter(p=>!("value"in p.Name)||!this.evalRequirement(p.Name.value,this.propertySet,"PropertySet")?!1:(h.push({currentValue:p.Name.value,parameter:"PropertySet",pass:!0,requiredValue:this.propertySet}),!0));if(d.length===0){h.push({currentValue:null,parameter:"PropertySet",pass:!1,requiredValue:this.propertySet});continue}for(const p of d){const u=this.getPropertyListName(p);if(!u)continue;const g=p[u];if(!Array.isArray(g)){h.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName});continue}const m=g.filter(b=>!("value"in b._category&&"value"in b.Name)||this._unsupportedTypes.includes(b._category.value)||!this.evalRequirement(b.Name.value,this.baseName,"BaseName")?!1:(h.push({currentValue:b.Name.value,parameter:"BaseName",pass:!0,requiredValue:this.baseName}),!0));if(m.length===0){h.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName});continue}for(const b of m)this.evalValue(b,h),this.evalDataType(b,h),this.evalURI()}}}}getPropertyListName(e){let t;return"value"in e._category&&(e._category.value==="IFCPROPERTYSET"&&(t="HasProperties"),e._category.value==="IFCELEMENTQUANTITY"&&(t="Quantities")),t}getValueKey(e){return Object.keys(e).find(t=>/Value/.test(t)||/Values/.test(t))}getTypePsets(e){if(!Array.isArray(e.IsTypedBy))return[];const[t]=e.IsTypedBy;return t&&Array.isArray(t.HasPropertySets)?t.HasPropertySets:[]}async getPsets(e){const t=this.getTypePsets(e);if(!Array.isArray(e.IsDefinedBy))return t;const i=[];for(const n of e.IsDefinedBy){if(!("value"in n.Name))continue;const r=n.Name.value,o=this.getPropertyListName(n);if(!(r&&o))continue;const a=t.find(l=>"value"in l.Name?l.Name.value===r:!1);if(a&&Array.isArray(a.HasProperties)&&Array.isArray(n.HasProperties))for(const l of a.HasProperties){if(!("value"in l.Name))continue;const c=l.Name.value;n.HasProperties.find(h=>"value"in h.Name?h.Name.value===c:!1)||n.HasProperties.push(l)}i.push(n)}return i}evalValue(e,t){const i=this.getValueKey(e),n=e[i];if(!("value"in n))return!1;if(this.value){if(!i)return t==null||t.push({parameter:"Value",currentValue:null,pass:!1,requiredValue:this.value}),!1;const r=structuredClone(this.value);return n.type==="IFCLABEL"&&r.type==="simple"&&(r.parameter=String(r.parameter)),this.evalRequirement(n.value,r,"Value",t)}return i&&typeof n.value=="string"&&n.value.trim()===""?(t==null||t.push({parameter:"Value",currentValue:"",pass:!1,requiredValue:this.value}),!1):!0}evalDataType(e,t){if(!this.dataType)return!0;const i=this.getValueKey(e);if(!(i&&"value"in e[i]))return t==null||t.push({parameter:"DataType",currentValue:null,pass:!1,requiredValue:this.dataType}),!1;const n=e[i];return this.evalRequirement(n.type??null,{type:"simple",parameter:this.dataType},"DataType",t)}evalURI(){return!0}},kv=class extends ln{constructor(){super(...arguments),C(this,"_ifcMaterialEntities",[/^IFCMATERIALLAYERSETUSAGE$/,/^IFCMATERIALCONSTITUENTSET$/,/^IFCMATERIAL$/,/^IFCMATERIALLIST$/]),C(this,"facetType","Material"),C(this,"value"),C(this,"uri")}serialize(e){if(!(this.value&&this.uri))return"<material />";const t=ri("Value",this.value);let i="";return e==="requirement"&&(i+=`cardinality="${this.cardinality}"`,i+=this.uri?`uri=${this.uri}`:"",i+=this.instructions?`instructions="${this.instructions}"`:""),`<material ${i}>
  ${t}
</material>`}async getEntities(e,t){const i=this._components.get(he);for(const[n,r]of i.list){if(!e.find(c=>c.test(n)))continue;const o=await r.getItemsOfCategories(this._ifcMaterialEntities),a=Object.values(o).flat();if(a.length===0)continue;const l=await r.getItemsData(a,{relations:{AssociatedTo:{attributes:!0,relations:!1},MaterialConstituents:{attributes:!0,relations:!0},ForLayerSet:{attributes:!0,relations:!0},MaterialLayers:{attributes:!0,relations:!0},Materials:{attributes:!0,relations:!1}}});for(const c of l){if(!("value"in c._localId&&"value"in c._category&&Array.isArray(c.AssociatedTo))||!this.hasValidMaterial(c))continue;const h=c.AssociatedTo.map(d=>"value"in d._localId&&d._localId.value?d._localId.value:null).filter(d=>d!==null);ke.append(t,n,...h)}}}async test(e,t,i={skipIfFails:!0}){const n=this._components.get(he);for(const[r,o]of Object.entries(e)){const a=n.list.get(r);if(!a)continue;const l=await a.getItemsData([[...o][0]],{relations:{AssociatedTo:{attributes:!1,relations:!1},HasAssociations:{attributes:!0,relations:!0},MaterialConstituents:{attributes:!0,relations:!0},ForLayerSet:{attributes:!0,relations:!0},MaterialLayers:{attributes:!0,relations:!0},Materials:{attributes:!0,relations:!1}}});for(const c of l){const h=this.getItemChecks(t,r,c,i.skipIfFails);if(h){if(!Array.isArray(c.HasAssociations)){h.push({parameter:null,currentValue:null,requiredValue:this.value,pass:!1});continue}for(const d of c.HasAssociations)if(this._ifcMaterialEntities.some(p=>"value"in d._category?p.test(d._category.value):!1)&&this.hasValidMaterial(d,h))break}}}}hasValidMaterial(e,t){let i=!1;if("value"in e._category&&e._category.value==="IFCMATERIAL")this.evalValue(e,t)&&(i=!0);else for(const[n,r]of Object.entries(e))if(["ForLayerSet","MaterialLayers","Material","MaterialConstituents","Materials"].includes(n)&&Array.isArray(r)){for(const o of r)if("value"in o._category&&o._category.value==="IFCMATERIAL"){if(this.evalValue(o,t)){i=!0;break}}else if(this.hasValidMaterial(o)){i=!0;break}}return i}evalValue(e,t){if(!this.value)return t==null||t.push({parameter:null,currentValue:e.Name&&"value"in e.Name?e.Name.value:null,pass:!0}),!0;if(!("value"in e._category&&e._category.value==="IFCMATERIAL"))return null;let i=!1;return e.Name&&"value"in e.Name&&(i=this.evalRequirement(e.Name.value,this.value,"Value",t)),i||(e.Category&&"value"in e.Category&&(i=this.evalRequirement(e.Category.value,this.value,"Value",t)),i)}},Pv=class extends ln{constructor(e,t){super(e),C(this,"facetType","PartOf"),C(this,"_entityFacet"),C(this,"_entity"),C(this,"relation"),C(this,"cardinality","required"),this._entity=t,this._entityFacet=new vl(e,t.name),this._entityFacet.predefinedType=t.predefinedType}set entity(e){this._entity=e;const{name:t,predefinedType:i}=e;this._entityFacet=new vl(this._components,t),this._entityFacet.predefinedType=i}get entity(){return this._entity}serialize(){return""}async getEntities(e,t){}async test(e){}},Ov=class{constructor(e,t,i){C(this,"name"),C(this,"ifcVersion",new Set),C(this,"identifier",st.create()),C(this,"description"),C(this,"instructions"),C(this,"requirementsDescription"),C(this,"applicability",new je),C(this,"requirements",new je),C(this,"components"),this.components=e,this.name=t;for(const n of i)this.ifcVersion.add(n)}set(e){const t=e,i=this;for(const n in e){if(n==="identifier")continue;const r=t[n];n in this&&(i[n]=r)}return this.components.get(Mv).list.set(this.identifier,this),this}async test(e,t={skipIfFails:!0}){const i=new Se;if(this.requirements.size===0)return i;const n={},r=[];for(const a of this.applicability)r.push(a.getEntities(e,n));await Promise.all(r);const o=[];for(const a of this.requirements)o.push(a.test(n,i,t));return await Promise.all(o),i}serialize(){const e=`name="${this.name}"`,t=this.identifier?`identifier="${this.identifier}"`:"",i=this.description?`description="${this.description}"`:"",n=this.instructions?`instructions="${this.instructions}"`:"";return`<specification ifcVersion="${[...this.ifcVersion].join(" ")}" ${e} ${t} ${i} ${n}>
      <applicability minOccurs="1" maxOccurs="unbounded">
        ${[...this.applicability].map(r=>r.serialize("applicability")).join(`
`)}
      </applicability>
      <requirements>
        ${[...this.requirements].map(r=>r.serialize("requirement")).join(`
`)}
      </requirements>
    </specification>`}};const Lt=s=>{if(!s)return;const e={};if("simpleValue"in s&&(e.type="simple",e.parameter=s.simpleValue),"restriction"in s){const t=s.restriction,i=Object.keys(t);if("pattern"in t&&(e.type="pattern",e.parameter=t.pattern.value),"enumeration"in t){e.type="enumeration";const n=t.enumeration.map(({value:r})=>t.base.includes("string")?String(r):t.base.includes("integer")||t.base.includes("double")?Number(r):r);e.parameter=n}if(i.some(n=>["minInclusive","minExclusive","maxInclusive","maxExclusive"].includes(n))){e.type="bounds";const n={},r=i.find(a=>a.includes("min")),o=i.find(a=>a.includes("max"));r&&(n.minInclusive=r==="minInclusive",n.min=t[r].value),o&&(n.maxInclusive=o==="maxInclusive",n.max=t[o].value),e.parameter=n}if(i.some(n=>["minLength","length","maxLength"].includes(n))){e.type="length";const n={};t.length!==void 0&&(n.length=t.length.value),t.minLength!==void 0&&(n.min=t.minLength.value),t.maxLength!==void 0&&(n.max=t.maxLength.value),e.parameter=n}}if(e.parameter!==void 0)return e},Th=(s,e)=>{const t=[];for(const i of e){const n=i.name,r=Lt(n);if(!r)continue;const o=new vl(s,r);i.cardinality&&(o.cardinality=i.cardinality),o.predefinedType=Lt(i.predefinedType),o.instructions=i.instructions,t.push(o)}return t},kh=(s,e)=>{const t=[];for(const i of e){const n=i.name,r=Lt(n);if(!r)continue;const o=new Av(s,r);i.cardinality&&(o.cardinality=i.cardinality),o.value=Lt(i.value),o.instructions=i.instructions,t.push(o)}return t},Ph=(s,e)=>{const t=[];for(const i of e){const n=new kv(s);i.cardinality&&(n.cardinality=i.cardinality);const r=Lt(i.value);(r==null?void 0:r.type)==="enumeration"&&Array.isArray(r.parameter)&&(r.parameter=r.parameter.map(String)),n.value=r,n.uri=i.uri,n.instructions=i.instructions,t.push(n)}return t},Oh=(s,e)=>{const t=[];for(const i of e){const n=i.propertySet,r=i.baseName,o=Lt(n),a=Lt(r);if(!(a&&o))continue;const l=new Tv(s,o,a);i.cardinality&&(l.cardinality=i.cardinality);const c=Lt(i.value);l.value=c,l.dataType=i.dataType,l.uri=i.uri,l.instructions=i.instructions,t.push(l)}return t},Mh=(s,e)=>{const t=[];for(const i of e){const n=i.system,r=Lt(n);if(!r)continue;const o=new $v(s,r);i.cardinality&&(o.cardinality=i.cardinality);const a=Lt(i.value);(a==null?void 0:a.type)==="simple"&&(a.parameter=String(a.parameter)),(a==null?void 0:a.type)==="enumeration"&&Array.isArray(a.parameter)&&(a.parameter=a.parameter.map(String)),o.value=a,o.uri=i.uri,o.instructions=i.instructions,t.push(o)}return t},Ih=(s,e)=>{const t=[];for(const i of e){const n=Lt(i.entity.name);if(!n)continue;const r=Lt(i.entity.predefinedType),o=new Pv(s,{name:n,predefinedType:r});o.relation=i.relation,i.cardinality&&(o.cardinality=i.cardinality),o.instructions=i.instructions,t.push(o)}return t},cc=class _l extends Ae{constructor(e){super(e),C(this,"enabled",!0),C(this,"IDSInfo"),C(this,"list",new Se),e.add(_l.uuid,this)}getModelIdMap(e){const t={},i={};for(const[n,r]of e){const o=[...r].filter(([,l])=>l.pass).map(([l])=>l);ke.append(t,n,...o);const a=[...r].filter(([,l])=>!l.pass).map(([l])=>l);ke.append(i,n,...a)}return{pass:t,fail:i}}create(e,t,i){const n=new Ov(this.components,e,t);return i&&(n.identifier=i),this.list.set(n.identifier,n),n}load(e){const t=[],i=_l.xmlParser.parse(e).ids,{specifications:n,info:r}=i;if(this.IDSInfo={...r},n&&n.specification){const o=Array.isArray(n.specification)?n.specification:[n.specification];for(const a of o){const{name:l,ifcVersion:c,description:h,instructions:d,identifier:p}=a;if(!(l&&c))continue;const u=[],g=[],{applicability:m,requirements:b}=a;if(m){const{maxOccurs:v,...w}=m,E=Array.isArray(w)?w:[w];for(const S of E)for(const $ in S){const M=Array.isArray(S[$])?S[$]:[S[$]];if($==="entity"){const k=Th(this.components,M);u.push(...k)}if($==="attribute"){const k=kh(this.components,M);u.push(...k)}if($==="material"){const k=Ph(this.components,M);u.push(...k)}if($==="classification"){const k=Mh(this.components,M);u.push(...k)}if($==="property"){const k=Oh(this.components,M);u.push(...k)}if($==="partOf"){const k=Ih(this.components,M);u.push(...k)}}}let f;if(b){const{maxOccurs:v,...w}=b;f=b.description;const E=Array.isArray(w)?w:[w];for(const S of E)for(const $ in S){const M=Array.isArray(S[$])?S[$]:[S[$]];if($==="entity"){const k=Th(this.components,M);g.push(...k)}if($==="attribute"){const k=kh(this.components,M);g.push(...k)}if($==="material"){const k=Ph(this.components,M);g.push(...k)}if($==="classification"){const k=Mh(this.components,M);g.push(...k)}if($==="property"){const k=Oh(this.components,M);g.push(...k)}if($==="partOf"){const k=Ih(this.components,M);g.push(...k)}}}const y=this.create(l,c.split(/\s+/),p);y.description=h,y.instructions=d,y.requirementsDescription=f,y.applicability.add(...u),y.requirements.add(...g),t.push(y)}}return t}export(e,t=this.list.values()){const i=t??this.list;return`<ids xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://standards.buildingsmart.org/IDS http://standards.buildingsmart.org/IDS/1.0/ids.xsd" xmlns:ids="http://standards.buildingsmart.org/IDS">
  <!-- Made with That Open Engine ${Hu.release} (https://github.com/thatopen/engine_components) -->
  <info>
    <title>${e.title}</title>
    ${e.copyright?`<copyright>${e.copyright}</copyright>`:""}
    ${e.version?`<version>${e.version}</version>`:""}
    ${e.description?`<description>${e.description}</description>`:""}
    ${e.author?`<author>${e.author}</author>`:""}
    ${e.date?`<date>${e.date.toISOString().split("T")[0]}</date>`:""}
    ${e.purpose?`<purpose>${e.purpose}</purpose>`:""}
    ${e.milestone?`<milestone>${e.milestone}</milestone>`:""}
  </info>
  <specifications>
    ${[...i].map(n=>n.serialize()).join(`
`)}
  </specifications>
</ids>`}};C(cc,"uuid","9f0b9f78-9b2e-481a-b766-2fbfd01f342c");C(cc,"xmlParser",new Go.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let Mv=cc;const Ku=class Ju extends Ae{constructor(e){super(e),C(this,"enabled",!0),e.add(Ju.uuid,this)}static distanceFromPointToLine(e,t,i,n=!1){const r=new St,o=new D;return r.set(t,i),r.closestPointToPoint(e,n,o),o.distanceTo(e)}round(e){e.x=Math.trunc(e.x*1e3)/1e3,e.y=Math.trunc(e.y*1e3)/1e3,e.z=Math.trunc(e.z*1e3)/1e3}async getVolumeFromFragments(e){return console.warn("getVolumeFromFragments is deprecated. Use getItemsVolume instead."),this.getItemsVolume(e)}async getItemsVolume(e){let t=0;const i=this.components.get(he);for(const[n,r]of Object.entries(e)){const o=i.list.get(n);o&&(t+=await o.getItemsVolume([...r]))}return t}static convertUnits(e,t,i,n=2){const r={m:1,cm:.01,mm:.001,km:1e3,m2:1,cm2:1e-4,mm2:1e-6,km2:1e6,m3:1,cm3:1e-6,mm3:1e-9,km3:1e9};if(!r[t]||!r[i])throw new Error("Invalid units provided for conversion.");if(!Number.isInteger(n)||n<0||n>5)throw new Error("Precision must be an integer between 0 and 5.");let o=r[t]/r[i];const a=e*o,l=10**n;return Math.round(a*l)/l}};C(Ku,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");let Zs=Ku;const Iv=class ep extends Ae{constructor(e){super(e),T(this,"enabled",!0),T(this,"inputs",["OBC","BUI"]),T(this,"_requestEventID","thatOpenCompanyComponentRequested"),T(this,"_createEventID","thatOpenCompanyComponentCreated"),e.add(ep.uuid,this)}async import(e){return new Promise(t=>{const i=document.createElement("script"),n=`
        function loader() {
          const { ${this.inputs} } = window.ThatOpenCompany;
        
          ${e}
        
          const onComponentRequested = () => {
            window.removeEventListener("${this._requestEventID}", onComponentRequested);
            const event = new CustomEvent("${this._createEventID}", { detail: main });
            window.dispatchEvent(event);
          };
          
          window.addEventListener("${this._requestEventID}", onComponentRequested);
        }
        
        loader();
      `,r=o=>{window.removeEventListener(this._createEventID,r);const{componentDefinition:a}=o.detail;let l=null;if(a){const c=a;l=this.components.get(c)}i.remove(),t(l)};i.addEventListener("load",()=>{window.addEventListener(this._createEventID,r),window.dispatchEvent(new Event(this._requestEventID))}),i.src=URL.createObjectURL(new File([n],"temp.js")),document.head.appendChild(i)})}};T(Iv,"uuid","74c0c370-1af8-4ca9-900a-4a4196c0f2f5");let tp=class extends Ys{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Ne(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof t.element.ownerDocument.defaultView.Element&&t.element.parentNode!==null&&t.element.remove()})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}};const Ls=new D,zh=new xe,Dh=new xe,Lh=new D,Bh=new D;let zv=class{constructor(e={}){const t=this;let i,n,r,o;const a={objects:new WeakMap},l=e.element!==void 0?e.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:i,height:n}},this.render=function(g,m){g.matrixWorldAutoUpdate===!0&&g.updateMatrixWorld(),m.parent===null&&m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),zh.copy(m.matrixWorldInverse),Dh.multiplyMatrices(m.projectionMatrix,zh),h(g,g,m),u(g)},this.setSize=function(g,m){i=g,n=m,r=i/2,o=n/2,l.style.width=g+"px",l.style.height=m+"px"};function c(g){g.isCSS2DObject&&(g.element.style.display="none");for(let m=0,b=g.children.length;m<b;m++)c(g.children[m])}function h(g,m,b){if(g.visible===!1){c(g);return}if(g.isCSS2DObject){Ls.setFromMatrixPosition(g.matrixWorld),Ls.applyMatrix4(Dh);const f=Ls.z>=-1&&Ls.z<=1&&g.layers.test(b.layers)===!0,y=g.element;y.style.display=f===!0?"":"none",f===!0&&(g.onBeforeRender(t,m,b),y.style.transform="translate("+-100*g.center.x+"%,"+-100*g.center.y+"%)translate("+(Ls.x*r+r)+"px,"+(-Ls.y*o+o)+"px)",y.parentNode!==l&&l.appendChild(y),g.onAfterRender(t,m,b));const v={distanceToCameraSquared:d(b,g)};a.objects.set(g,v)}for(let f=0,y=g.children.length;f<y;f++)h(g.children[f],m,b)}function d(g,m){return Lh.setFromMatrixPosition(g.matrixWorld),Bh.setFromMatrixPosition(m.matrixWorld),Lh.distanceToSquared(Bh)}function p(g){const m=[];return g.traverseVisible(function(b){b.isCSS2DObject&&m.push(b)}),m}function u(g){const m=p(g).sort(function(f,y){if(f.renderOrder!==y.renderOrder)return y.renderOrder-f.renderOrder;const v=a.objects.get(f).distanceToCameraSquared,w=a.objects.get(y).distanceToCameraSquared;return v-w}),b=m.length;for(let f=0,y=m.length;f<y;f++)m[f].element.style.zIndex=b-f}}},Li=class{constructor(e,t,i){T(this,"three"),T(this,"world"),T(this,"wasVisible",!0),T(this,"onDisposed",new J),this.world=e;let n;if(t)n=t;else{n=document.createElement("div");const r="6px";n.style.color="white",n.style.height=r,n.style.width=r,n.style.borderRadius="50%",n.style.border="2px solid rgb(122, 75, 209)",n.style.zIndex="-20"}this.three=new tp(n),(i||e.scene.three).add(this.three),this.visible=!0}set visible(e){this.three.visible=e,this.wasVisible=e}get visible(){return this.three.visible}toggleVisibility(){this.visible=!this.visible}notDisplay(){this.visible=!1}dispose(){this.three.removeFromParent(),this.three.element.remove(),this.onDisposed.trigger(),this.onDisposed.reset()}},Dv=class extends Zb{constructor(e,t,i){super(e,t,i),T(this,"three2D",new zv),this.onAfterUpdate.add(()=>{if(this.onBeforeUpdate.trigger(this),!this.enabled||!this.currentWorld)return;const n=this.currentWorld.scene.three,r=this.currentWorld.camera.three;n instanceof sg&&this.three2D.render(n,r)}),this.onDisposed.add(()=>{this.three2D.domElement.remove()}),this.onResize.add(({x:n,y:r})=>{this.three2D.setSize(n,r)}),this.setupHtmlRenderer(),this.resize()}setupHtmlRenderer(){this.three2D.domElement.style.position="absolute",this.three2D.domElement.style.top="0px",this.three2D.domElement.style.pointerEvents="none",this.container&&(this.container.appendChild(this.three2D.domElement),this.container.style.position="relative")}};const Nh=class wl extends Ae{constructor(e){super(e),T(this,"onDisposed",new J),T(this,"enabled",!0),T(this,"threshold",50),T(this,"autoCluster",!0),T(this,"clusterElementStyles",{...wl.DEFAULT_CLUSTER_STYLES}),T(this,"list",new Map),T(this,"clusterLabels",new Set),T(this,"currentKeys",new Set),T(this,"_color","white"),T(this,"_markerKey",0),T(this,"_clusterKey",0),T(this,"_worldEvents",new Map),T(this,"_setupWorlds",new Set),T(this,"clusterElementFactory",()=>{const t=document.createElement("div");return t.style.color="#000000",t.style.background="#FFFFFF",t.style.fontSize="1.2rem",t.style.fontWeight="500",t.style.borderRadius="50%",t.style.padding="5px 11px",t.style.textAlign="center",t.addEventListener("pointerover",()=>{t.style.background=this.clusterElementStyles.hoverBackgroundColor||"#BCF124"}),t.addEventListener("pointerout",()=>{t.style.background=this.clusterElementStyles.backgroundColor||"#FFFFFF"}),t}),e.add(wl.uuid,this)}get color(){return this._color}set color(e){this._color=e;for(const[t,i]of this.list)for(const[n,r]of i)r.label.three.element.style.color=e}create(e,t,i,n=!1){this.setupEvents(e,!0);const r=this._markerKey.toString(),o=this.getWorldMarkerList(e);if(o.has(r))return null;const a=document.createElement("span");a.append(t);const l=new Li(e,a);return l.three.position.copy(i),o.set(r,{key:r,label:l,merged:!1,static:n}),this._markerKey++,r}delete(e){for(const[t,i]of this.list){const n=i.get(e);n&&n.label.dispose(),i.delete(e)}}getWorldMarkerList(e){return this.list.has(e.uuid)||this.list.set(e.uuid,new Map),this.list.get(e.uuid)}dispose(e){for(const[t,i]of this.list){const n=[...i.keys()];for(const r of n){const o=i.get(r);e&&o.type!==e||(o.label.dispose(),i.delete(r))}}if(!e){this.list.clear(),this._markerKey=0;for(const t of this.clusterLabels)t.label.dispose();this.clusterLabels.clear(),this._clusterKey=0,this.currentKeys.clear()}this.onDisposed.trigger()}setupEvents(e,t){if(t&&this._setupWorlds.has(e.uuid)||!e.camera.hasCameraControls())return;const i=this.getWorldEvent(e);e.camera.controls.removeEventListener("sleep",i),e.camera.controls.removeEventListener("rest",i),t&&(e.camera.controls.addEventListener("sleep",i),e.camera.controls.addEventListener("rest",i))}cluster(e){if(!this.autoCluster)return;this.resetMarkers();const t=this.list.get(e.uuid);if(t){for(const[i,n]of t)if(!n.merged&&!n.static){this.currentKeys.clear();for(const[r,o]of t)o.static||n.key!==o.key&&!o.merged&&this.distance(n.label,o.label)<this.threshold&&(this.currentKeys.add(o.key),o.merged=!0);if(this.currentKeys.size>0){this.currentKeys.add(n.key),n.merged=!0;const r=Array.from(this.currentKeys),o=this.getAveragePositionFromLabels(r),a=new Li(n.label.world,this.createClusterElement(this._clusterKey.toString())),{element:l}=a.three;l.firstChild.textContent=r.length.toString(),a.three.position.copy(o),this.clusterLabels.add({key:this._clusterKey.toString(),markerKeys:r,label:a}),this._clusterKey++}}this.removeMergeMarkers(e)}}getWorldEvent(e){if(!this._worldEvents.has(e.uuid)){const t=()=>{this.cluster(e)};this._worldEvents.set(e.uuid,t)}return this._worldEvents.get(e.uuid)}resetMarkers(){for(const[e,t]of this.list)for(const[i,n]of t)n.merged=!1;for(const e of this.clusterLabels)e.label.dispose();this.clusterLabels.clear(),this._clusterKey=0}removeMergeMarkers(e){const t=this.list.get(e.uuid);if(t){for(const[i,n]of t)n.merged?n.label.dispose():n.label.world.scene.three.add(n.label.three);for(const i of this.clusterLabels)if(i.markerKeys.length===1){for(const[n,r]of this.list){const o=r.get(i.markerKeys[0]);o&&(o.label.world.scene.three.add(o.label.three),o.merged=!1)}i.label.dispose(),this.clusterLabels.delete(i)}}}getAveragePositionFromLabels(e){const t=e.map(i=>{for(const[n,r]of this.list){const o=r.get(i);if(o)return o.label.three.position}return new D});return t.reduce((i,n)=>i.add(n),new D).divideScalar(t.length)}createClusterElement(e){const t=this.clusterElementFactory();t.textContent=e;const i=document.createElement("span");return i.append(t),i.style.pointerEvents="auto",i.style.cursor="pointer",i.addEventListener("pointerdown",()=>{this.navigateToCluster(e)}),i}getScreenPosition(e){const t=new D;if(!e.world.renderer)throw new Error("Renderer not found!");const i=e.three.position.clone();i.project(e.world.camera.three);const n=e.world.renderer.getSize();return t.x=i.x*n.x/2+n.x/2,t.y=-(i.y*n.y/2)+n.y/2,t}distance(e,t){const i=this.getScreenPosition(e),n=this.getScreenPosition(t),r=i.x-n.x,o=i.y-n.y,a=Math.sqrt(r*r+o*o)*.5;return a===0?this.threshold+1:a}navigateToCluster(e){const t=[],i=Array.from(this.clusterLabels).find(c=>c.key===e);if(!i)return;const n=i.label.world.camera;if(!n.hasCameraControls()){console.warn("Zoom to clusters only supported with Camera Controls!");return}for(const c of i.markerKeys)for(const[h,d]of this.list){const p=d.get(c);if(p){const{x:u,y:g,z:m}=p.label.three.position;t.push(u,g,m)}}i.label.dispose(),this.clusterLabels.delete(i);const r=new nt,o=new Float32Array(t),a=new Et(o,3);r.setAttribute("position",a);const l=new re(r);l.geometry.computeBoundingSphere(),l.geometry.boundingSphere&&n.controls.fitToSphere(l,!0),r.dispose(),l.clear(),t.length=0}};T(Nh,"uuid","4079eb91-79b0-4ede-bcf2-15b837129236"),T(Nh,"DEFAULT_CLUSTER_STYLES",{backgroundColor:"#FFFFFF",textColor:"#000000",fontSize:"1.2rem",fontWeight:"500",borderRadius:"50%",padding:"5px 11px",textAlign:"center",cursor:"pointer",hoverBackgroundColor:"#BCF124",transition:void 0});new Vo(-1,1,1,-1,0,1);let Lv=class extends nt{constructor(){super(),this.setAttribute("position",new Fi([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Fi([0,2,0,0,2,0],2))}};new Lv;new Ne,new xe,new xe,new xe,new D(-1,-1,-1),new D(1,1,1);Bv(16,2,1),new Ne,new xe;function Bv(s,e,t){const i=Nv(s,e,t);let n="vec3[SAMPLES](";for(let r=0;r<s;r++){const o=i[r];n+=`vec3(${o.x}, ${o.y}, ${o.z})${r<s-1?",":")"}`}return n}function Nv(s,e,t){const i=[];for(let n=0;n<s;n++){const r=2*Math.PI*e*n/s,o=Math.pow(n/(s-1),t);i.push(new D(Math.cos(r),Math.sin(r),o))}return i}new Ne(1/1024,1/512);new Ne(1/1024,1/512);new Ne(1/1024,1/512);const Rh=new Ve,io=new D;let hc=class extends Ym{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this.setAttribute("position",new Fi(e,3)),this.setAttribute("uv",new Fi(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new Ja(t,6,1);return this.setAttribute("instanceStart",new Us(i,3,0)),this.setAttribute("instanceEnd",new Us(i,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new Ja(t,6,1);return this.setAttribute("instanceColorStart",new Us(i,3,0)),this.setAttribute("instanceColorEnd",new Us(i,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new Zm(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ve);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),Rh.setFromBufferAttribute(t),this.boundingBox.union(Rh))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ri),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let n=0;for(let r=0,o=e.count;r<o;r++)io.fromBufferAttribute(e,r),n=Math.max(n,i.distanceToSquared(io)),io.fromBufferAttribute(t,r),n=Math.max(n,i.distanceToSquared(io));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}};co.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Ne(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};ho.line={uniforms:Xd.merge([co.common,co.fog,co.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class dc extends Kd{constructor(e){super({type:"LineMaterial",uniforms:Xd.clone(ho.line.uniforms),vertexShader:ho.line.vertexShader,fragmentShader:ho.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const Ra=new rn,Uh=new D,Fh=new D,et=new rn,tt=new rn,ti=new rn,Ua=new D,Fa=new xe,it=new St,jh=new D,so=new Ve,no=new Ri,ii=new rn;let ni,hs;function Hh(s,e,t){return ii.set(0,0,-e,1).applyMatrix4(s.projectionMatrix),ii.multiplyScalar(1/ii.w),ii.x=hs/t.width,ii.y=hs/t.height,ii.applyMatrix4(s.projectionMatrixInverse),ii.multiplyScalar(1/ii.w),Math.abs(Math.max(ii.x,ii.y))}function Rv(s,e){const t=s.matrixWorld,i=s.geometry,n=i.attributes.instanceStart,r=i.attributes.instanceEnd,o=Math.min(i.instanceCount,n.count);for(let a=0,l=o;a<l;a++){it.start.fromBufferAttribute(n,a),it.end.fromBufferAttribute(r,a),it.applyMatrix4(t);const c=new D,h=new D;ni.distanceSqToSegment(it.start,it.end,h,c),h.distanceTo(c)<hs*.5&&e.push({point:h,pointOnLine:c,distance:ni.origin.distanceTo(h),object:s,face:null,faceIndex:a,uv:null,uv1:null})}}function Uv(s,e,t){const i=e.projectionMatrix,n=s.material.resolution,r=s.matrixWorld,o=s.geometry,a=o.attributes.instanceStart,l=o.attributes.instanceEnd,c=Math.min(o.instanceCount,a.count),h=-e.near;ni.at(1,ti),ti.w=1,ti.applyMatrix4(e.matrixWorldInverse),ti.applyMatrix4(i),ti.multiplyScalar(1/ti.w),ti.x*=n.x/2,ti.y*=n.y/2,ti.z=0,Ua.copy(ti),Fa.multiplyMatrices(e.matrixWorldInverse,r);for(let d=0,p=c;d<p;d++){if(et.fromBufferAttribute(a,d),tt.fromBufferAttribute(l,d),et.w=1,tt.w=1,et.applyMatrix4(Fa),tt.applyMatrix4(Fa),et.z>h&&tt.z>h)continue;if(et.z>h){const f=et.z-tt.z,y=(et.z-h)/f;et.lerp(tt,y)}else if(tt.z>h){const f=tt.z-et.z,y=(tt.z-h)/f;tt.lerp(et,y)}et.applyMatrix4(i),tt.applyMatrix4(i),et.multiplyScalar(1/et.w),tt.multiplyScalar(1/tt.w),et.x*=n.x/2,et.y*=n.y/2,tt.x*=n.x/2,tt.y*=n.y/2,it.start.copy(et),it.start.z=0,it.end.copy(tt),it.end.z=0;const u=it.closestPointToPointParameter(Ua,!0);it.at(u,jh);const g=eu.lerp(et.z,tt.z,u),m=g>=-1&&g<=1,b=Ua.distanceTo(jh)<hs*.5;if(m&&b){it.start.fromBufferAttribute(a,d),it.end.fromBufferAttribute(l,d),it.start.applyMatrix4(r),it.end.applyMatrix4(r);const f=new D,y=new D;ni.distanceSqToSegment(it.start,it.end,y,f),t.push({point:y,pointOnLine:f,distance:ni.origin.distanceTo(y),object:s,face:null,faceIndex:d,uv:null,uv1:null})}}}let ip=class extends re{constructor(e=new hc,t=new dc({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,n=new Float32Array(2*t.count);for(let o=0,a=0,l=t.count;o<l;o++,a+=2)Uh.fromBufferAttribute(t,o),Fh.fromBufferAttribute(i,o),n[a]=a===0?0:n[a-1],n[a+1]=n[a]+Uh.distanceTo(Fh);const r=new Ja(n,2,1);return e.setAttribute("instanceDistanceStart",new Us(r,1,0)),e.setAttribute("instanceDistanceEnd",new Us(r,1,1)),this}raycast(e,t){const i=this.material.worldUnits,n=e.camera;n===null&&!i&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const r=e.params.Line2!==void 0&&e.params.Line2.threshold||0;ni=e.ray;const o=this.matrixWorld,a=this.geometry,l=this.material;hs=l.linewidth+r,a.boundingSphere===null&&a.computeBoundingSphere(),no.copy(a.boundingSphere).applyMatrix4(o);let c;if(i)c=hs*.5;else{const d=Math.max(n.near,no.distanceToPoint(ni.origin));c=Hh(n,d,l.resolution)}if(no.radius+=c,ni.intersectsSphere(no)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),so.copy(a.boundingBox).applyMatrix4(o);let h;if(i)h=hs*.5;else{const d=Math.max(n.near,so.distanceToPoint(ni.origin));h=Hh(n,d,l.resolution)}so.expandByScalar(h),ni.intersectsBox(so)!==!1&&(i?Rv(this,t):Uv(this,n,t))}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(Ra),this.material.uniforms.resolution.value.set(Ra.z,Ra.w))}},Fv=class{constructor(e,t){T(this,"_components"),T(this,"_modelStyleGeometries",new Se),T(this,"onDisposed",new J),T(this,"three",new Ni),T(this,"plane"),T(this,"items",new Se),T(this,"world",null),T(this,"_visible",!1),this._components=e,this.plane=t,this.setupEvents()}set visible(e){e?this.world&&(this.world.scene.three.add(this.three),this._visible=!0):(this.three.removeFromParent(),this._visible=!1)}get visible(){return this._visible}setupEvents(){const e=this._components.get(ja);this.items.guard=(t,{style:i})=>!!e.styles.get(i),this.items.onItemSet.add(({value:t})=>{const{style:i,data:n}=t;this.create(i,n)})}async getStyleMeshes(e,t){const i=this._components.get(ja).styles.get(t);if(!i)throw new Error(`ClipStyler: "${t}" style not found.`);const n=this._components.get(he),r=n.list.get(e);if(!r)throw new Error(`ClipEdges: model with id "${e}" not found.`);const{linesMaterial:o,fillsMaterial:a}=i;let l=this._modelStyleGeometries.get(e);l||(l=new Se,this._modelStyleGeometries.set(e,l));let c=l.get(t);if(!c){let h;o&&(h=new ip(new hc,o),h.frustumCulled=!1,r&&n.applyBaseCoordinateSystem(h,await r.getCoordinationMatrix()),this.three.add(h));let d;a&&(d=new re(new nt,a),r&&n.applyBaseCoordinateSystem(d,await r.getCoordinationMatrix()),this.three.add(d)),c={edges:h,fills:d},l.set(t,c)}return c}async updateMeshes(e,t,i){const n=this._components.get(he),r=n.list.get(e);if(!r)return;const o=this._components.get(oi),a=this.plane.clone(),l=(await r.getCoordinationMatrix()).clone().multiply(n.baseCoordinationMatrix.clone().invert());a.applyMatrix4(l),a.constant-=.01;const c=await r.getSection(a,i),{buffer:h,index:d,fillsIndices:p}=c,u=await this.getStyleMeshes(e,t),{edges:g,fills:m}=u,b=new Et(h,3,!1);if(g){b.setUsage(Wm);const f=new nt;f.setAttribute("position",b),f.setDrawRange(0,d);const y=new Ho(f);g.geometry.fromLineSegments(y),o.destroy(y)}m&&(m.geometry.attributes.position=b,m.geometry.setIndex(p))}async create(e,t){if(!this._components.get(ja).styles.get(e))throw new Error(`ClipEdges: "${e}" style not found.`);const i=this._components.get(Hb);let n=null;t&&(n=await i.find(t));const r=this._components.get(he);if(n)for(const[o,a]of Object.entries(n))r.list.get(o)&&this.updateMeshes(o,e,[...a]);else for(const[o]of r.list)this.updateMeshes(o,e)}async update(e){for(const[t,{data:i,style:n}]of this.items)e&&!e.includes(t)||this.create(n,i)}dispose(){this._components.get(oi).destroy(this.three,!0,!0),this._modelStyleGeometries.clear()}};const sp=class xl extends Ae{constructor(e){super(e),T(this,"onDisposed",new J),T(this,"enabled",!0),T(this,"world",null),T(this,"styles",new Se),T(this,"list",new Se),T(this,"_visible",!0),this.components.list.set(xl.uuid,this),this.setEvents()}get visible(){return this._visible}set visible(e){this._visible=e;for(const[,t]of this.list)t.visible=e}setEvents(){this.list.onBeforeDelete.add(({value:e})=>e.dispose())}setEdgesConfig(e,t){if(e.world=(t==null?void 0:t.world)??this.world,t!=null&&t.items)for(const[n,r]of Object.entries(t.items))e.items.set(n,r);const i=(t==null?void 0:t.id)??st.create();this.list.set(i,e)}create(e,t){const i=new Fv(this.components,e);return t&&this.setEdgesConfig(i,t),i}createFromView(e,t){const i=this.create(e.plane,t);return((t==null?void 0:t.link)===void 0||t.link)&&(e.onDisposed.add(()=>i.dispose()),e.onUpdated.add(()=>i.update()),e.onStateChanged.add(()=>i.visible=e.open)),i}createFromClipping(e,t){const i=this.components.get(Pi).list.get(e);if(!i)throw new Error(`ClipStyler: Clipping plane with ID ${e} not found.`);const n=this.create(i.three,t);return n.visible=!0,((t==null?void 0:t.link)===void 0||t.link)&&(i.onDraggingEnded.add(()=>n.update()),i.onDisposed.add(()=>n.dispose())),n}dispose(){this.styles.clear(),this.list.clear(),this.onDisposed.trigger(xl.uuid)}};T(sp,"uuid","24dfc306-a3c4-410f-8071-babc4afa5e4d");let ja=sp;const np=class Cl extends Ae{constructor(e){super(e),T(this,"onDisposed",new J),T(this,"onBeforeUpdate",new J),T(this,"onAfterUpdate",new J),T(this,"onSetup",new J),T(this,"isSetup",!1),T(this,"enabled",!0),T(this,"events",{}),T(this,"multiple","ctrlKey"),T(this,"zoomFactor",1.5),T(this,"zoomToSelection",!1),T(this,"backupColor",null),T(this,"selection",{}),T(this,"config",{selectName:"select",selectionColor:null,autoHighlightOnClick:!0,world:null,selectEnabled:!0,autoUpdateFragments:!0,selectMaterialDefinition:{color:new be("#BCF124"),renderedFaces:Qd.ONE,opacity:1,transparent:!1}}),T(this,"styles",new Se),T(this,"autoToggle",new Set),T(this,"mouseDownPosition",{x:0,y:0}),T(this,"mouseMoveThreshold",5),T(this,"selectable",{}),T(this,"eventManager",new Nb),T(this,"_mouseState",{down:!1,moved:!1}),T(this,"_fromHighlight",!1),T(this,"restorePreviousColors",(t=this.selection.select)=>{for(const[i,n]of Object.entries(this.selection))if(!(i===this.config.selectName||!this.styles.get(i)))for(const[r,o]of Object.entries(t)){const a=n[r];if(!a)continue;const l=[...o].filter(c=>a.has(c));l.length!==0&&new Set(l)}}),T(this,"onMouseDown",t=>{this.enabled&&(this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.mouseDownPosition={x:t.clientX,y:t.clientY},this._mouseState.down=!0)}),T(this,"debounceTimeout",null),T(this,"onMouseUp",async t=>{if(!this.enabled)return;const{world:i,autoHighlightOnClick:n,selectEnabled:r}=this.config;if(!i)throw new Error("No world found!");if(!i.renderer)throw new Error("This world doesn't have a renderer!");if(t.target===i.renderer.three.domElement){if(this._mouseState.down=!1,this._mouseState.moved||t.button!==0){this._mouseState.moved=!1;return}if(this._mouseState.moved=!1,n&&r){const o=this.multiple==="none"?!0:!t[this.multiple];await this.highlight(this.config.selectName,o,this.zoomToSelection)}}}),T(this,"onMouseMove",async t=>{if(!this.enabled)return;const i=t.clientX-this.mouseDownPosition.x,n=t.clientY-this.mouseDownPosition.y,r=Math.sqrt(i*i+n*n);this._mouseState.moved||r>this.mouseMoveThreshold&&(this._mouseState.moved=this._mouseState.down)}),this.components.add(Cl.uuid,this),this.eventManager.list.add(this.onSetup),this.eventManager.list.add(this.onDisposed),this.setStyleEvents()}setStyleEvents(){this.styles.onBeforeDelete.add(async({key:e})=>{if(await this.clear(e),delete this.selection[e],!(e in this.events))return;const{onClear:t,onHighlight:i,onBeforeHighlight:n}=this.events[e];this.eventManager.list.delete(t),this.eventManager.list.delete(i),this.eventManager.list.delete(n),delete this.events[e]}),this.styles.onItemSet.add(({key:e})=>{this.selection[e]={};const t=new J,i=new J,n=new J;this.events[e]={onHighlight:t,onClear:n,onBeforeHighlight:i},this.eventManager.add([n,t,i])})}async dispose(){this.setupEvents(!1),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.selection={},this.styles.clear(),this.onDisposed.trigger(Cl.uuid),this.eventManager.reset(),this.isSetup=!1}add(e){if(console.warn("highlighter.add() is deprecated, use highlighter.styles.set() instead"),typeof e=="string")this.styles.set(e,null);else{const{customId:t}=e;this.styles.set(t,e)}}async remove(e){console.warn("highlighter.remove() is deprecated, use highlighter.styles.delete() instead"),this.styles.delete(e)}async highlight(e,t=!0,i=this.zoomToSelection,n=null){if(!this.enabled)return;if(!this.config.world)throw new Error("No world found in config!");const r=this.config.world;if(!this.selection[e])throw new Error(`Selection ${e} does not exist.`);const o=await this.components.get(pt).get(r).castRay();if(!o||o.localId===void 0||o.localId===null){t&&this.clear(e);return}const{localId:a,fragments:{modelId:l}}=o,c={[l]:new Set([a])};await this.highlightByID(e,c,t,i,n,!0)}async highlightByID(e,t,i=!0,n=this.zoomToSelection,r=null,o=!1){var a;if(!this.enabled)return;this._fromHighlight=!0,this.events[e].onBeforeHighlight.trigger(this.selection[e]),i&&await this.clear(e);let l=ke.clone(t);const c=this.components.get(he);for(const[d,p]of Object.entries(t)){const u=c.list.get(d);u!=null&&u.isDeltaModel&&u.parentModelId&&ke.add(l,{[u.parentModelId]:p})}const h=(a=this.selectable)==null?void 0:a[e];if(h){const d=ke.clone(h);l=ke.intersect([l,d])}if(r){const d=ke.clone(r);for(const[p,u]of Object.entries(d)){const g=c.list.get(p);g!=null&&g.deltaModelId&&ke.add(d,{[g.deltaModelId]:u})}ke.remove(l,r)}if(o&&this.autoToggle.has(e)){const d={};let p=!1;for(const u in l){const g=this.selection[e][u];if(!g)continue;const m=l[u];for(const b of m)if(g.has(b)){g.delete(b);let f=d[u];f||(f=new Set,d[u]=f),f.add(b),p=!0}else g.add(b);l[u]=g}p&&(this.events[e].onClear.trigger(d),e===this.config.selectName&&this.restorePreviousColors(d))}this.updateStyleMap(e,l),this.events[e].onHighlight.trigger(this.selection[e]),this._fromHighlight=!1,await this.updateColors(),n&&await this.zoomSelection(l)}async updateColors(){const e=this.components.get(he),t=[e.resetHighlight()];for(const[i,n]of Object.entries(this.selection)){const r=this.styles.get(i);if(!r)continue;const o=i==="select"||!this.styles.get(this.config.selectName)?n:this.getMapWithoutSelection(i);o&&t.push(e.highlight({...r,customId:i},o))}this.config.autoUpdateFragments&&t.push(e.core.update(!0)),await Promise.allSettled(t)}updateStyleMap(e,t){const i=this.selection[e];for(const n in t){let r=i[n];r||(r=new Set,i[n]=r);const o=t[n];for(const a of o)r.add(a)}if(e!==this.config.selectName)for(const[n,r]of Object.entries(this.selection)){if(n===this.config.selectName||n===e)continue;const o=r;for(const[a,l]of Object.entries(i)){const c=o[a];if(c)for(const h of l)c.delete(h)}}}getMapWithoutSelection(e,t){const i=this.selection[e];if(!i)throw new Error(`Style ${e} does not exist.`);const n=this.selection[this.config.selectName]??{},r={};for(const o in i){const a=i[o],l=e===this.config.selectName?new Set:n[o]??new Set,c=Array.from(a).filter(h=>{var d;return!l.has(h)&&(!t||((d=t[o])==null?void 0:d.has(h)))});c.length>0&&(r[o]=new Set(c))}return Object.keys(r).length>0?r:null}async clear(e,t){const i=e?[e]:Object.keys(this.selection),n=t??void 0;for(const r of i){const o=this.selection[r]??{},a=n??o;r===this.config.selectName&&this.restorePreviousColors();const l={};for(const[c,h]of Object.entries(a)){const d=o[c];if(d)for(const p of h){if(!d.delete(p))continue;let u=l[c];u||(u=new Set,l[c]=u),u.add(p)}}Object.keys(l).length>0&&this.events[r].onClear.trigger(l),this.selection[r]={}}this._fromHighlight||await this.updateColors()}setup(e){if(this.isSetup)return;this.config={...this.config,...e};const{selectName:t,selectionColor:i,selectMaterialDefinition:n}=this.config;this.config.world&&this.components.get(pt).get(this.config.world),n?(i&&(console.warn("highlighter.config.selectionColor is deprecated, use selectMaterialDefinition instead"),n.color=i),this.styles.set(t,n)):this.styles.set(t,null),this.autoToggle.add(this.config.selectName),this.setupEvents(!0),this.enabled=!0,this.isSetup=!0,this.onSetup.trigger(this)}async zoomSelection(e){if(!this.config.world)throw new Error("No world found in config!");const t=this.config.world;let i=!1;for(const m in e)if(e[m].size>0){i=!0;break}if(!i||!t.camera.hasCameraControls())return;const n=await this.components.get(he).getBBoxes(e),r=new Ri,o=new Ve;for(const m of n)o.union(m);o.getBoundingSphere(r);const a=1/0,l=-1/0,{x:c,y:h,z:d}=r.center,p=r.radius===a||c===a||h===a||d===a,u=r.radius===l||c===l||h===l||d===l,g=r.radius===0;p||u||g||(r.radius*=this.zoomFactor,await t.camera.controls.fitToSphere(r,!0))}setupEvents(e){if(!this.config.world){console.log("No world found while setting up events!");return}if(this.config.world.isDisposing)return;if(!this.config.world.renderer)throw new Error("The given world doesn't have a renderer!");const t=this.config.world.renderer.three.domElement;t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("mouseup",this.onMouseUp),t.removeEventListener("pointermove",this.onMouseMove),e&&(t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("mouseup",this.onMouseUp),t.addEventListener("pointermove",this.onMouseMove))}};T(np,"uuid","cb8a76f2-654a-4b50-80c6-66fd83cafd77");let Yn=np;const rp=class op extends Ae{constructor(){super(...arguments),T(this,"enabled",!0),T(this,"geometries",new Se),T(this,"onDisposed",new J)}async get(e,t){const{material:i,applyTransformation:n}={applyTransformation:!0,...t},r=this.components.get(he),o=new Se;for(const[a,l]of Object.entries(e)){const c=r.list.get(a);if(!c)continue;const h=this.getModelMeshes(a);for(const d of l){let p=o.get(a);p||(p=new Se,o.set(a,p));let u=h.get(d);if(u&&u.length>0){const b=[];for(const[f,{geometry:y,transform:v}]of u.entries()){const w=await this.createMesh(c,y,v,{material:i,applyTransformation:n});b.push(w)}p.set(d,b);continue}else u=[],h.set(d,u);const[g]=await c.getItemsGeometry([d]);if(!g)continue;const m=[];for(const b of g){const f=this.createGeometry(b);if(!f)continue;const{geometry:y,transform:v}=f;u.push(f);const w=await this.createMesh(c,y,v,{material:i,applyTransformation:n});m.push(w)}p.set(d,m)}}return o}getModelMeshes(e){let t=this.geometries.get(e);return t||(t=new Se,this.geometries.set(e,t)),t}remove(e=[...this.geometries.keys()]){for(const t of e){const i=this.geometries.get(t);if(i){for(const[n,r]of i)for(const{geometry:o}of r)o.dispose();this.geometries.delete(t)}}}dispose(e=!0){this.remove(),e&&this.geometries.dispose(),this.onDisposed.trigger(op.uuid)}getMeshesFromResult(e){const t=[];for(const i of e.values())for(const n of i.values())t.push(...n);return t}createGeometry(e){const{positions:t,indices:i,normals:n,transform:r}=e;if(!(t&&i&&n))return null;const o=new nt;return o.setAttribute("position",new Et(t,3)),o.setAttribute("normal",new Et(n,3,!0)),o.setIndex(new Et(i,1)),{geometry:o,transform:r}}async createMesh(e,t,i,n){const{material:r,applyTransformation:o}={applyTransformation:!0,...n},a=new re(t,r);return a.applyMatrix4(i),a.applyMatrix4(e.object.matrixWorld),o||(a.position.set(0,0,0),a.rotation.set(0,0,0)),a}};T(rp,"uuid","ab45d0a7-feea-4afc-927c-80832dae76dd");let Eo=rp;const jv=class El extends Ae{constructor(e){super(e),T(this,"_world"),T(this,"styles",new je),T(this,"outlinePositions",!1),T(this,"_mesh",null),T(this,"onDisposed",new J),T(this,"_meshes",[]),T(this,"_map",{}),T(this,"_activeStyles",new Set),T(this,"_styleCallbacks",{}),e.add(El.uuid,this),this.setupEvents()}set world(e){this._world=e,e&&this.getRenderer().postproduction.excludedObjectsPass.addExcludedMaterial(this._points.material)}get world(){return this._world}get _points(){return this._mesh||(this._mesh=new Nm(new nt,new Rm({size:10,sizeAttenuation:!1,depthTest:!1}))),this._mesh}get enabled(){return!this.world||this.world.isDisposing?!1:this.getRenderer().postproduction.outlinesEnabled}set enabled(e){if(!this.world||this.world.isDisposing)return;const t=this.getRenderer();t.postproduction.outlinesEnabled=e,this.outlinePositions&&(this._points.material.color=this.color,this.world.scene.three.add(this._points))}get color(){return this.getRenderer().postproduction.outlinePass.outlineColor}set color(e){this.getRenderer().postproduction.outlinePass.outlineColor.copy(e),this._points.material.color.copy(e)}get thickness(){return this.getRenderer().postproduction.outlinePass.thickness}set thickness(e){this.getRenderer().postproduction.outlinePass.thickness=e}get fillColor(){return this.getRenderer().postproduction.outlinePass.fillColor}set fillColor(e){this.getRenderer().postproduction.outlinePass.fillColor.copy(e)}get fillOpacity(){return this.getRenderer().postproduction.outlinePass.fillOpacity}set fillOpacity(e){const t=this.getRenderer().postproduction;t.outlinePass.fillOpacity=e}setupEvents(){const e=this.components.get(Yn);this.styles.guard=t=>e.styles.has(t),this.styles.onItemAdded.add(t=>{const i=this.components.get(Yn),n=()=>{this._activeStyles.add(t),this.updateFromStyles()},r=()=>{this._activeStyles.delete(t),this.updateFromStyles()};this._styleCallbacks[t]={onHighlight:n,onClear:r},i.events[t].onHighlight.add(n),i.events[t].onClear.add(r)}),this.styles.onBeforeDelete.add(t=>{const{onHighlight:i,onClear:n}=this._styleCallbacks[t];e.events[t].onHighlight.remove(i),e.events[t].onClear.remove(n),this._activeStyles.delete(t),delete this._styleCallbacks[t]}),e.styles.onItemDeleted.add(t=>this.styles.delete(t))}async updateFromStyles(){const e=this.components.get(Yn),t=[];for(const n of this._activeStyles){const r=e.selection[n];r&&t.push(r)}const i=ke.join(t);this._map=i,await this.update()}async update(e=this._map){if(e===this._map&&this.cleanMeshes(),this.outlinePositions&&this.updatePoints(),Object.keys(e).length===0)return;const t=this.components.get(he),i=this.getRenderer().postproduction.outlinePass,n=await this.components.get(Eo).get(e);for(const r of Object.keys(e)){const o=t.list.get(r),a=new Set(await(o==null?void 0:o.getItemsByVisibility(!1)));if(o){for(const[l,c]of n.entries())for(const[h,d]of c)if(!a.has(h))for(const p of d)this._meshes.push(p),i.scene.add(p)}}}async addItems(e){ke.add(this._map,e),await this.update(e)}async removeItems(e){ke.remove(this._map,e),await this.update()}clean(){this._map={},this._activeStyles.clear(),this.cleanMeshes(),this._mesh&&this.components.get(oi).destroy(this._mesh,!0,!0),this._mesh=null}dispose(){this.styles.clear(),this.clean(),this.onDisposed.trigger(El.uuid)}cleanMeshes(){for(const e of this._meshes)e.removeFromParent();this._meshes=[]}async updatePoints(){let e=0;for(const[i,n]of Object.entries(this._map))e+=n.size;this._points.geometry.setAttribute("position",new Fi(new Float32Array(e*3),3));const t=await this.components.get(he).getPositions(this._map);for(let i=0;i<t.length;i++){const{x:n,y:r,z:o}=t[i];this._points.geometry.attributes.position.array[i*3]=n,this._points.geometry.attributes.position.array[i*3+1]=r,this._points.geometry.attributes.position.array[i*3+2]=o}this._points.geometry.attributes.position.needsUpdate=!0}getRenderer(){if(!this.world)throw new Error("You must set a world to use the outliner!");const e=this.world.renderer;if(!e.postproduction)throw new Error("The world given to the outliner must use the postproduction renderer.");return e}};T(jv,"uuid","2fd3bcc5-b3b6-4ded-9f64-f47a02854a10");const ap=class lp extends Ae{constructor(e){super(e),T(this,"onHoverStarted",new J),T(this,"onHoverEnded",new J),T(this,"HOVERER_OPACITY_KEY","_maxHoverOpacity"),T(this,"_hoverTimeout",null),T(this,"_meshes",new je),T(this,"_localId",null),T(this,"_fadeAnimation",null),T(this,"_world",null),T(this,"_enabled",!1),T(this,"_material",new on({color:16777215,transparent:!0,opacity:.5,depthTest:!1,userData:{[this.HOVERER_OPACITY_KEY]:.5}})),T(this,"onDisposed",new J),T(this,"duration",200),T(this,"animation",!0),T(this,"mouseStopTimeout",null),T(this,"onMouseMove",()=>{this.mouseStopTimeout!==null&&clearTimeout(this.mouseStopTimeout),this.mouseStopTimeout=window.setTimeout(()=>this.hover(),50)}),T(this,"onMouseLeave",()=>{this._meshes.clear()}),T(this,"animate",()=>{if(!(this._fadeAnimation&&this.animation&&this.material.transparent))return;const{startTime:t,duration:i,fadeIn:n}=this._fadeAnimation,r=Date.now()-t,o=Math.min(r/i,1),a=n?o:1-o,l=this.material.userData[this.HOVERER_OPACITY_KEY],c=a*(l!==void 0?l:1);this.material.opacity=c,o<1?requestAnimationFrame(this.animate):(n||this._meshes.clear(),this._fadeAnimation=null,this.onHoverEnded.trigger(this))}),e.add(lp.uuid,this),this._meshes.onBeforeDelete.add(t=>{t.removeFromParent(),t.geometry.dispose()}),this._meshes.onItemAdded.add(t=>{this.world&&this.world.scene.three.add(t)}),this._meshes.onCleared.add(()=>{this._localId=null,this._hoverTimeout&&(clearTimeout(this._hoverTimeout),this._hoverTimeout=null)})}set world(e){if(e){this.components.get(pt).get(e),this._world=e,this.setupEvents(!0);for(const t of this._meshes)e.scene.three.add(t)}else{this.setupEvents(!1),this._world=null;for(const t of this._meshes)t.removeFromParent()}}get world(){return this._world}set enabled(e){this.setupEvents(e),this._enabled=e}get enabled(){return this._enabled}set material(e){e.userData[this.HOVERER_OPACITY_KEY]=e.opacity;for(const t of this._meshes)t.material=e;this._material.dispose(),this._material=e}get material(){return this._material}setupEvents(e){if(!this.world||this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The given world doesn't have a renderer!");const t=this.world.renderer.three.domElement;t.removeEventListener("mousemove",this.onMouseMove),t.removeEventListener("mouseleave",this.onMouseMove),e&&(t.addEventListener("mousemove",this.onMouseMove),t.addEventListener("mouseleave",this.onMouseLeave))}async hover(){if(!this.enabled||!this.world)return;const e=await this.components.get(pt).get(this.world).castRay();if(!e){this._meshes.clear();return}const{fragments:t,localId:i}=e;this._localId!==i&&(this._meshes.clear(),this._localId=i,this._hoverTimeout=window.setTimeout(async()=>{const n={[t.modelId]:new Set([i])},r=await this.components.get(Eo).get(n);for(const[o,a]of r.entries()){const l=[...a.values()].flat();for(const c of l)c.material=this.material,this._meshes.add(c)}this._fadeAnimation={startTime:Date.now(),duration:this.duration,fadeIn:!0},this.onHoverStarted.trigger(this),this.animate()},100))}clear(){this._meshes.clear()}dispose(){this._enabled=!1,this._meshes.clear(),this._fadeAnimation=null,this._hoverTimeout=null,this.onHoverStarted.reset(),this.onHoverEnded.reset(),this.onDisposed.trigger()}};T(ap,"uuid","26fbd870-b1b2-4b71-b747-4063d484de1b");let Hv=ap;class Vv{constructor(e){T(this,"alignments",[]),T(this,"enabled",!0),T(this,"world",null),T(this,"_raycastable",[]),T(this,"_components"),this._components=e}update(){this.dispose();for(const e of this.alignments)for(const t of e.children){const i=t;i.updateWorldMatrix(!0,!0);for(const n of i.children){const r=n;if(r.isLine2&&r.userData.points){const o=new nt,a=new Ht;a.geometry.setIndex(r.geometry.index);const l=new Float32Array(r.userData.points),c=new Et(l,3);o.setAttribute("position",c),a.geometry=o,a.userData.curve=r,a.applyMatrix4(r.matrixWorld),a.updateMatrixWorld(),this._raycastable.push(a)}}}}dispose(){for(const e of this._raycastable)e.geometry.dispose(),e.geometry=void 0;this._raycastable=[]}castRay(){if(!this.enabled||!this.world)return null;const e=this._components.get(pt).get(this.world).castRayToObjects(this._raycastable);if(!e)return null;const t=e.object,i=t.geometry,n=e.index,r=i.attributes.position.array[n*3],o=i.attributes.position.array[n*3+1],a=i.attributes.position.array[n*3+2],l=i.attributes.position.array[n*3+3],c=i.attributes.position.array[n*3+4],h=i.attributes.position.array[n*3+5],d=new D(l-r,c-o,h-a).normalize();return{point:e.point,normal:d,curve:t.userData.curve,alignment:t.userData.curve.parent}}}let Ha=class{static alignmentPercentageToPoint(e,t){const i=new D,n=new D,r=this.alignmentLength(e),o=t*r;let a=0;if(e.updateWorldMatrix(!0,!0),t===1)for(let l=e.children.length-1;l>=0;l--){const c=e.children[l],h=c.userData.points;if(!h)continue;const d=new D(h[h.length-3],h[h.length-2],h[h.length-1]);return d.applyMatrix4(c.matrixWorld),{normal:new D,point:d,curve:c,alignment:e}}for(const l of e.children){const c=l.userData.points;if(c)for(let h=0;h<c.length-3;h+=3){const d=i.set(c[h],c[h+1],c[h+2]),p=n.set(c[h+3],c[h+4],c[h+5]),u=d.distanceTo(p);if(a+u>=o){const g=o-a,m=p.clone().sub(d).normalize(),b=m.clone().multiplyScalar(g);return d.add(b),d.applyMatrix4(l.matrixWorld),{normal:m,point:d,curve:l,alignment:e}}a+=u}}return null}static curvePercentageToPoint(e,t,i){const n=new D,r=new D,o=this.curveLength(t),a=i*o;let l=0;const c=t.userData.points;if(!c)throw new Error("No points found in curve");for(let h=0;h<c.length-3;h+=3){const d=n.set(c[h],c[h+1],c[h+2]),p=r.set(c[h+3],c[h+4],c[h+5]),u=d.distanceTo(p);if(l+u>=a){const g=a-l,m=p.clone().sub(d).normalize(),b=m.clone().multiplyScalar(g);return d.add(b),{normal:m,point:d,curve:t,alignment:e}}l+=u}return null}static alignmentLength(e){let t=0;if(e.userData.length!==void 0)return e.userData.length;for(const i of e.children)"isLine2"in i&&(t+=this.curveLength(i));return e.userData.length=t,t}static curveLength(e){let t=0;if(e.userData.length!==void 0)return e.userData.length;const i=new D,n=new D,r=e.userData.points;if(!r)throw new Error("No points found in curve");for(let o=0;o<r.length-2-3;o+=3){const a=i.set(r[o],r[o+1],r[o+2]),l=n.set(r[o+3],r[o+4],r[o+5]);t+=a.distanceTo(l)}return e.userData.length=t,t}static curvePointToAlignmentPercentage(e,t,i){const n=new D,r=new D,o=this.alignmentLength(e);let a=0;e.updateWorldMatrix(!0,!0);for(const l of e.children){const c=l.userData.points;if(c)for(let h=0;h<c.length-3;h+=3){const d=n.set(c[h],c[h+1],c[h+2]),p=r.set(c[h+3],c[h+4],c[h+5]);d.applyMatrix4(l.matrixWorld),p.applyMatrix4(l.matrixWorld);const u=d.distanceTo(p),g=d.distanceTo(t)<.001,m=p.distanceTo(t)<.001,b=this.isPointbetweenTwoOthers(d,p,t);if(l===i&&(g||m||b)){const f=d.distanceTo(t);return(a+f)/o}a+=u}}return null}static isPointbetweenTwoOthers(e,t,i){const n=new D;n.subVectors(t,e).normalize();const r=new D;r.subVectors(i,e).normalize();const o=new D;o.subVectors(i,t).normalize();const a=1-.0016;return n.dot(r)>a&&n.dot(o)<-a}};class qv{constructor(e,t){T(this,"onDisposed",new J),T(this,"alignments",[]),T(this,"components"),T(this,"onMarkerChange",new J),T(this,"enabled",!0),T(this,"highlightMaterial"),T(this,"increments",20),T(this,"screenDistanceLimit",.1),T(this,"fadeInTime",500),T(this,"_mouseMarkers"),T(this,"_highlighted",new Set),T(this,"_stationPoints",new Map),T(this,"_originalHighlightMaterialId","originalHighlightMaterial"),T(this,"_world",null),T(this,"_raycaster"),T(this,"_stationLabelColor",new be(16777215)),T(this,"_stationLabelBackgroundColor",new be(8014801)),T(this,"_stationPointerColor",new be(16777215)),T(this,"_stationPointerBackgroundColor",new be(4803766)),T(this,"_pointerDown",performance.now()),T(this,"_pointerDownTime",150),T(this,"onPointerDown",()=>{this._pointerDown=performance.now()}),T(this,"onPointerUp",()=>{if(performance.now()-this._pointerDown>this._pointerDownTime)return;const i=this.setMarkerToMouse("select");i&&this.onMarkerChange.trigger(i)}),T(this,"onMouseMove",()=>{this.setMarkerToMouse("hover")}),this.components=e,this.highlightMaterial=t,this._raycaster=new Vv(e),this._raycaster.alignments=this.alignments}get world(){return this._world}set world(e){var t,i,n,r;if(e===this._world||(this._world&&this.setupEvents(!1),this._world=e,(t=this._mouseMarkers)==null||t.hover.removeFromParent(),(i=this._mouseMarkers)==null||i.select.removeFromParent(),(n=this._mouseMarkers)==null||n.hover.element.remove(),(r=this._mouseMarkers)==null||r.select.element.remove(),!e))return;this._raycaster.world=e;const o=this.newCivilLabel(0,"stationPointer");e.scene.three.add(o),o.visible=!1,o.element.style.transition="";const a=this.newCivilLabel(0,"stationPointer");a.element.style.transition="",a.element.style.opacity="0.5",e.scene.three.add(a),a.visible=!1,this._mouseMarkers={select:o,hover:a},this.setupEvents(!0)}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(e){this._stationLabelColor=e;const t=`#${e.getHexString()}`;for(const[,{labels:i}]of this._stationPoints){const n=[...i.children];for(const r of n){const o=this.getLabel(r);o.style.color=t;const a=this.getPoint(r);a.style.backgroundColor=t}}}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(e){this._stationLabelBackgroundColor=e;const t=`#${e.getHexString()}`;for(const[,{labels:i}]of this._stationPoints){const n=[...i.children];for(const r of n){const o=this.getLabel(r);o.style.backgroundColor=t;const a=this.getPoint(r);a.style.border=`2px solid ${t}`}}}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(e){this._stationPointerColor=e;const t=`#${e.getHexString()}`;if(this._mouseMarkers){const i=this._mouseMarkers.select,n=this.getLabel(i);n.style.color=t;const r=this.getPoint(i);r.style.backgroundColor=t}}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(e){this._stationPointerBackgroundColor=e;const t=`#${e.getHexString()}`;if(this._mouseMarkers){const i=this._mouseMarkers.select,n=this.getLabel(i);n.style.backgroundColor=t;const r=this.getPoint(i);r.style.border=`2px solid ${t}`}}dispose(){var e,t,i,n;this.clearHighlight(),this.clearStations(),this.alignments=[],(e=this._mouseMarkers)==null||e.hover.removeFromParent(),(t=this._mouseMarkers)==null||t.select.removeFromParent(),(i=this._mouseMarkers)==null||i.hover.element.remove(),(n=this._mouseMarkers)==null||n.select.element.remove(),this._raycaster.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){this._raycaster.update()}setMarkerAtPoint(e,t){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");this.updateMarkerValue(e,t),this._mouseMarkers[t].visible=!0,this._mouseMarkers[t].position.copy(e.point)}highlight(e,t=!0){t&&this.clearHighlight(this._highlighted);for(const i of e.children)"isLineSegments2"in i&&"material"in i&&(i.userData[this._originalHighlightMaterialId]=i.material,i.material=this.highlightMaterial);this._highlighted.add(e)}clearHighlight(e=this._highlighted){for(const t of e)for(const i of t.children)"isLineSegments2"in i&&"material"in i&&(i.material=i.userData[this._originalHighlightMaterialId],delete i.userData[this._originalHighlightMaterialId]);this._highlighted.clear()}createStations(e){if(!this.world||this._stationPoints.has(e.uuid))return;const t=new Ni;this.world.scene.three.add(t),this._stationPoints.set(e.uuid,{alignment:e,labels:t})}clearStations(e=this._stationPoints.keys()){for(const t of e){const i=this._stationPoints.get(t);i&&(this.clearLabels(i.labels),this._stationPoints.delete(t))}}updateStations(){if(!this.world)throw new Error("No world found!");if(!this.world.renderer)throw new Error("No renderer found!");const e=this.world.camera.three,t=this.world.renderer.three,i=new Yl,n=t.clippingPlanes,r=new D,o=new D;let a=!0;const l=new D;for(const[,{alignment:c,labels:h}]of this._stationPoints){this.clearLabels(h),c.updateWorldMatrix(!0,!0);const d=c.userData.initialStation;let p=d||0;const u=p%this.increments;let g=d+this.increments-u;for(const m of c.children){if(!("isLine2"in m))continue;const b=m;if(b.geometry.boundingBox||b.geometry.computeBoundingBox(),i.setFromProjectionMatrix(new xe().multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse)),!i.intersectsBox(b.geometry.boundingBox)){const z=Ha.curveLength(m);p+=z;const j=p%this.increments;g=p+this.increments-j;continue}const f=m.userData.points,y=f[0],v=f[1],w=f[2];if(l.set(y,v,w),l.applyMatrix4(m.matrixWorld),!this.isLabelClipped(n,l)){if(a){a=!1,r.set(l.x,l.y,l.z),r.project(e),r.z=0;const z=this.newCivilLabel(p,"stationLabel");z.position.set(l.x,l.y,l.z),h.children.push(z)}else if(o.set(l.x,l.y,l.z),o.project(e),o.z=0,r.distanceTo(o)>this.screenDistanceLimit){const z=this.newCivilLabel(p,"stationLabel");z.position.set(l.x,l.y,l.z),h.children.push(z),r.copy(o)}}const E=new D,S=new D;for(let z=0;z<f.length-3;z+=3){E.set(f[z],f[z+1],f[z+2]),S.set(f[z+3],f[z+4],f[z+5]);const j=E.distanceTo(S),A=p+j,P=S.clone().sub(E).normalize();for(;A>g;){const _=g-p,L=P.clone();L.multiplyScalar(_);const{x:G,y:V,z:K}=E.clone().add(L);if(l.set(G,V,K),l.applyMatrix4(m.matrixWorld),!this.isLabelClipped(n,l)&&i.containsPoint(l)&&(o.set(l.x,l.y,l.z),o.project(e),o.z=0,r.distanceTo(o)>this.screenDistanceLimit)){const Y=this.newCivilLabel(g,"stationLabel");Y.position.set(l.x,l.y,l.z),h.children.push(Y),r.copy(o)}g+=this.increments}p+=j}const $=f[f.length-3],M=f[f.length-2],k=f[f.length-1];if(l.set($,M,k),l.applyMatrix4(m.matrixWorld),!(this.isLabelClipped(n,l)||!i.containsPoint(l))&&(o.set(l.x,l.y,l.z),o.project(e),o.z=0,r.distanceTo(o)>this.screenDistanceLimit)){const z=this.newCivilLabel(p,"stationLabel");z.position.set(l.x,l.y,l.z),h.children.push(z),r.copy(o)}}}}getCursorValue(){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");return this._mouseMarkers.select.element.children[0].children[0].innerText}setCursorValue(e,t){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const i=this._mouseMarkers[t].element.children[0].children[0];i.innerText=e}isLabelClipped(e,t){for(const i of e)if(!(i.distanceToPoint(t)>0))return!0;return!1}clearLabels(e){const t=[...e.children];for(const i of t)i.element.style.opacity="0";setTimeout(()=>{for(const i of t)i.removeFromParent(),i.element.remove(),i.visible=!1},this.fadeInTime)}newCivilLabel(e,t){const i=document.createElement("div"),n=t==="stationLabel"?this.stationLabelColor:this.stationPointerColor,r=t==="stationLabel"?this.stationLabelBackgroundColor:this.stationPointerBackgroundColor,o=document.createElement("div");o.style.width="4px",o.style.height="4px",o.style.borderRadius="50%",o.style.backgroundColor=`#${n.getHexString()}`,o.style.border=`2px solid #${r.getHexString()}`,o.style.display="flex",o.style.justifyContent="center";const a=this.getFormattedStation(e),l=document.createElement("div");l.innerText=a,l.style.backgroundColor=`#${r.getHexString()}`,l.style.color=`#${n.getHexString()}`,l.style.padding="0.3rem",l.style.position="absolute",l.style.bottom="1rem",l.style.borderRadius="6px",l.style.boxShadow="rgba(0, 0, 0, 0.6) 0px 4px 6px",o.appendChild(l);const c=new tp(i);return i.appendChild(o),t==="stationLabel"&&(i.style.transition=`opacity ${this.fadeInTime}ms ease-in-out`,i.style.opacity="0",setTimeout(()=>{i.style.opacity="1"})),c}setupEvents(e){if(!this.world)throw new Error("No world found!");if(this.world.isDisposing||!this.world.renderer)return;const t=this.world.renderer.three.domElement,i=this.components.get(pt).get(this.world);i.three.params.Line||(i.three.params.Line={threshold:10}),t.removeEventListener("pointerdown",this.onPointerDown),t.removeEventListener("pointerup",this.onPointerUp),t.removeEventListener("pointermove",this.onMouseMove),e&&(t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointerup",this.onPointerUp),t.addEventListener("pointermove",this.onMouseMove))}setMarkerToMouse(e){if(!this.enabled||!this._mouseMarkers)return null;if(!this.world)throw new Error("No world found!");const t=this._raycaster.castRay();if(!t)return this._mouseMarkers[e].visible=!1,null;this._mouseMarkers[e].visible=!0;const i=t.point;return this._mouseMarkers[e].position.copy(i),this.updateMarkerValue(t,e),t}updateMarkerValue(e,t){if(!this._mouseMarkers)return;const{alignment:i,curve:n,point:r}=e,o=Ha.curvePointToAlignmentPercentage(i,r,n);if(o===null)throw new Error("Point is not on the curve");const a=o*Ha.alignmentLength(i)+i.userData.initialStation,l=this.getFormattedStation(a);this.setCursorValue(l,t)}getFormattedStation(e){const t=Math.floor(e/1e3),i=Math.round(e-t*1e3);return`${t}+${i}`}getLabel(e){return e.element.children[0].children[0]}getPoint(e){return e.element.children[0]}}const Wv=class cp extends Ae{constructor(e){super(e),T(this,"onDisposed",new J),T(this,"list",new Map),T(this,"enabled",!0),T(this,"highlightMaterial",new dc({color:8014801,linewidth:5,depthTest:!1})),T(this,"_increments",20),T(this,"_screenDistanceLimit",.1),T(this,"_fadeInTime",500),T(this,"_stationLabelColor",new be(16777215)),T(this,"_stationLabelBackgroundColor",new be(8014801)),T(this,"_stationPointerColor",new be(16777215)),T(this,"_stationPointerBackgroundColor",new be(4803766)),this.components.add(cp.uuid,this)}get increments(){return this._increments}set increments(e){this._increments=e;for(const[,t]of this.list)t.increments=e}get screenDistanceLimit(){return this._screenDistanceLimit}set screenDistanceLimit(e){this._screenDistanceLimit=e;for(const[,t]of this.list)t.screenDistanceLimit=e}get fadeInTime(){return this._fadeInTime}set fadeInTime(e){this._fadeInTime=e;for(const[,t]of this.list)t.fadeInTime=e}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(e){this._stationLabelColor=e;for(const[,t]of this.list)t.stationLabelColor=e}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(e){this._stationLabelBackgroundColor=e;for(const[,t]of this.list)t.stationLabelBackgroundColor=e}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(e){this._stationPointerColor=e;for(const[,t]of this.list)t.stationPointerColor=e}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(e){this._stationPointerBackgroundColor=e;for(const[,t]of this.list)t.stationPointerBackgroundColor=e}create(e){const t=new qv(this.components,this.highlightMaterial);return this.list.set(e,t),t}delete(e){const t=this.list.get(e);t&&(t.dispose(),this.list.delete(e))}dispose(){for(const[,e]of this.list)e.dispose();this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){for(const[,e]of this.list)e.updateAlignments()}};T(Wv,"uuid","0a59c09e-2b49-474a-9320-99f51f40f182");const Yv=class hp extends Ae{constructor(e){super(e),T(this,"enabled",!0),T(this,"onDisposed",new J),T(this,"_world",null),T(this,"_flip",!1),T(this,"_plane"),T(this,"_point",new D),T(this,"_edgeMeshes",[]),T(this,"_sectionVisible",!1),T(this,"_sectionOffset",.1),T(this,"edgeMaterial",new dc({color:0,linewidth:5,depthTest:!1})),this.components.add(hp.uuid,this)}get plane(){if(!this._plane)throw new Error("Plane is not set. You must give a world.");return this._plane}set plane(e){this._plane=e}get sectionVisible(){return this._sectionVisible}set sectionVisible(e){this._sectionVisible=e;for(const t of this._edgeMeshes)t.visible=e}get world(){return this._world}set world(e){var t;if(this._world=e,(t=this._plane)==null||t.dispose(),!e)return;const i=this.components.get(Pi),n=i.createFromNormalAndCoplanarPoint(e,new D(1,0,0),new D);this.plane=i.list.get(n),this.plane.visible=!1,this.plane.enabled=!1}get flip(){return this._flip}set flip(e){var t;if(e===this._flip)return;this._flip=e;const i=(t=this.plane)==null?void 0:t.normal.clone().multiplyScalar(-1);for(const n of this._edgeMeshes)n.position.add(i.clone().multiplyScalar(this._sectionOffset));this.plane.setFromNormalAndCoplanarPoint(i,this._point),this.plane.update()}dispose(){var e;this.clearMeshes(),(e=this.plane)==null||e.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}async set(e,t){this.flip&&t.multiplyScalar(-1),this.plane.setFromNormalAndCoplanarPoint(t,e),this._point.copy(e)}async update(){this.clearMeshes();const e=this.components.get(he);this.plane.update();const t=[];for(const[,i]of e.list)t.push(this.generateModelSection(i));await Promise.all(t)}async generateModelSection(e){if(!this.world)return;const t=this.plane.three.clone();t.constant-=.01;const{buffer:i}=await e.getSection(t),n=new nt,r=new Et(i,3,!1);n.setAttribute("position",r);const o=new Ho(n),a=new hc;a.fromLineSegments(o);const l=new ip(a,this.edgeMaterial);l.frustumCulled=!1,this.world.scene.three.add(l),this._edgeMeshes.push(l),l.renderOrder=3,o.geometry.dispose()}clearMeshes(){for(const e of this._edgeMeshes)e.removeFromParent(),e.geometry.dispose(),e.material=void 0;this._edgeMeshes=[]}};T(Yv,"uuid","96b2c87e-d90b-4639-8257-8f01136fe324");const Bs=class si{constructor(e){T(this,"onDisposed",new J),T(this,"marker",null),T(this,"world",null),T(this,"mode",0),T(this,"maxDistance",1),T(this,"_enabled",!1),T(this,"_components"),T(this,"_preview",document.createElement("div")),T(this,"_pointerVisible",!1),T(this,"_intersectionFound",!1),this._components=e;for(const t in si.baseSnappingStyle){const i=si.baseSnappingStyle[t];this._preview.style[t]=i}this._preview.style.zIndex="999",this._preview.style.pointerEvents="none",this._preview.style.position="fixed",this._preview.style.top="0",this._preview.style.left="0"}set enabled(e){this._enabled=e,this.marker&&(this.marker.visible=e),e&&this.get()}get enabled(){return this._enabled}dispose(){this.marker&&this.marker.dispose()}async get(e){return this.mode===1?this.getSynchronous(e):this.getDefault(e)}async getSynchronous(e){const t=(e==null?void 0:e.world)??this.world;if(!t)throw new Error("GraphicVertexPicker: a world is need to get a casting result.");const i=this._components.get(pt).get(t);let n=null;if(this.mode===0?n=await i.castRay({snappingClasses:e==null?void 0:e.snappingClasses}):this.mode===1&&(n=await i.castRayToObjects()),this._intersectionFound=!!n,n){const{point:r}=n;if(!this.marker){const o=document.createElement("div");this.marker=new Li(t,o)}if(this.marker.world!==t&&(this.marker.world=t,this.marker.three.removeFromParent(),t.scene.three.add(this.marker.three)),this.hidePointer(),this.marker.visible=!0,!!(e!=null&&e.snappingClasses)){const o=(e==null?void 0:e.snappingClasses)||[];let a=gt.FACE;o.includes(gt.POINT)?a=gt.POINT:o.includes(gt.LINE)&&(a=gt.LINE);let l=!1;if(a!==gt.FACE&&(l=this.applySnapping(n,a)),!l)Object.assign(this.marker.three.element.style,si.baseSnappingStyle);else{const c=si.snappingStyles[a]??si.baseSnappingStyle;Object.assign(this.marker.three.element.style,c)}this.marker.three.position.copy(r)}else Object.assign(this.marker.three.element.style,si.baseSnappingStyle)}else this.marker&&(this.marker.visible=!1);return n}async getDefault(e){const t=(e==null?void 0:e.world)??this.world;if(!t)throw new Error("GraphicVertexPicker: a world is need to get a casting result.");const i=await this._components.get(pt).get(t).castRay({snappingClasses:e==null?void 0:e.snappingClasses});if(this._intersectionFound=!!i,i){const{point:n}=i;if(!this.marker){const r=document.createElement("div");this.marker=new Li(t,r)}if(this.marker.world!==t&&(this.marker.world=t,this.marker.three.removeFromParent(),t.scene.three.add(this.marker.three)),this.hidePointer(),this.marker.visible=!0,this.marker.three.position.copy(n),"snappingClass"in i&&typeof i.snappingClass=="number"&&(i.snappingClass===0||i.snappingClass===1||i.snappingClass===2)){const r=si.snappingStyles[i.snappingClass]??si.baseSnappingStyle;Object.assign(this.marker.three.element.style,r)}else Object.assign(this.marker.three.element.style,si.baseSnappingStyle)}else this.marker&&(this.marker.visible=!1);return i}updatePointer(){if(!this.world||!this.marker)return;if(this.mode===1&&this._intersectionFound){this.hidePointer();return}this.showPointer(),this.marker.visible&&(this.marker.visible=!1);const e=this._components.get(pt).get(this.world).mouse.rawPosition;this._preview.style.transform=`translate(-50%, -50%) translate(${e.x}px, ${e.y}px)`}showPointer(){var e;!this.world||this._pointerVisible||(this._pointerVisible=!0,(e=this.world.renderer.three.domElement.parentElement)==null||e.appendChild(this._preview))}hidePointer(){var e;!this.world||!this._pointerVisible||(this._pointerVisible=!1,(e=this.world.renderer.three.domElement.parentElement)==null||e.removeChild(this._preview))}applySnapping(e,t){if(t===gt.FACE)return!0;const i=e.object;if(!e.face||!i||!i.geometry||!i.geometry.index||!i.geometry.attributes||!i.geometry.attributes.position)return!1;const n=e.object.matrixWorld,r=i.geometry.attributes.position.array,o=e.point,a=e.face.a,l=e.face.b,c=e.face.c,h=new D(r[a*3],r[a*3+1],r[a*3+2]).applyMatrix4(n),d=new D(r[l*3],r[l*3+1],r[l*3+2]).applyMatrix4(n),p=new D(r[c*3],r[c*3+1],r[c*3+2]).applyMatrix4(n);if(e.facePoints=[h.x,h.y,h.z,d.x,d.y,d.z,p.x,p.y,p.z],t===gt.LINE){const y=[[h,d],[d,p],[p,h]],v=new D,w=new D,E=new St;let S=Number.MAX_SAFE_INTEGER,$=!1;const M=this.maxDistance*this.maxDistance;for(const[k,z]of y){E.set(k,z),E.closestPointToPoint(o,!0,v);const j=o.distanceToSquared(v);j<M&&j<S&&(e.snappedEdgeP1=k,e.snappedEdgeP2=z,S=j,w.copy(v),$=!0)}return $?(e.point.copy(w),!0):!1}const u=[h,d,p],g=new D;let m=Number.MAX_SAFE_INTEGER,b=!1;const f=this.maxDistance*this.maxDistance;for(let y=0;y<u.length;y++){const v=u[y],w=o.distanceToSquared(v);w<f&&w<m&&(m=w,g.copy(v),b=!0)}return b?(e.point.copy(g),!0):!1}};T(Bs,"baseSnappingStyle",{height:"6px",width:"6px",borderRadius:"100%",borderWidth:"2px",borderColor:"rgb(122, 75, 209)",borderStyle:"solid",zIndex:"-20"}),T(Bs,"snappingStyles",{[gt.FACE]:{...Bs.baseSnappingStyle},[gt.POINT]:{...Bs.baseSnappingStyle,borderColor:"#e25959",borderRadius:"0"},[gt.LINE]:{...Bs.baseSnappingStyle,borderColor:"#2d2d2d",borderRadius:"0"}});let Zv=Bs;function dp(){const s=document.createElement("div");return s.style.backgroundColor="blue",s.style.color="white",s.style.padding="6px",s.style.borderRadius="6px",s.style.boxShadow="0px 4px 6px rgba(0, 0, 0, 0.6)",s.style.zIndex="-10",s}function Gv(s={}){const{color:e="white",size:t="4px",border:i="2px solid blue",background:n="white"}=s,r=document.createElement("div");return r.style.backgroundColor=n,r.style.color=e,r.style.height=t,r.style.width=t,r.style.borderRadius="50%",r.style.border=i,r.style.zIndex="-20",r}let Bi=class extends St{constructor(){super(...arguments),T(this,"id",st.create()),T(this,"_units","m"),T(this,"_rounding",2)}set units(e){this._units=e}get units(){return this._units}set rounding(e){this._rounding=e}get rounding(){return this._rounding}get value(){const e=this.distance();return Zs.convertUnits(e,"m",this.units,this.rounding)}},Xv=class Sl{constructor(e,t,i,n=2,r="m"){T(this,"label"),T(this,"boundingBox",new re),T(this,"world"),T(this,"_components"),T(this,"_units","m"),T(this,"_rounding",2),T(this,"startNormal",null),T(this,"line"),T(this,"rectangleComponentLines",[]),T(this,"projectionComponentLines",[]),T(this,"_visible",!0),T(this,"_root",new Ni),T(this,"_endpoints",new je),T(this,"lineElement"),T(this,"rectangleDimensions",new je),T(this,"projectionDimensions",new je),T(this,"isSelected",!1),T(this,"_latestRectangularInversion",!1),T(this,"_endpointElement",Gv()),T(this,"_material"),T(this,"_componentsMaterial",new Xm({depthTest:!1,gapSize:.2,dashSize:.2,transparent:!0,opacity:.5,color:3026478})),T(this,"valueFormatter",null),this._components=e,this.world=t,this._material=i.lineMaterial,this._rounding=n,this._units=r,this.line=i.line,this.startNormal=i.startNormal??null,this.rectangleComponentLines=[new Bi,new Bi],this.updateRectangleComponents(),this.updateProjectionComponents(),this.lineElement=this.createLine(i),this._endpoints.onItemAdded.add(o=>{this._root.add(o.three);const a=this._endpoints.size===1?this.line.start:this.line.end;o.three.position.copy(a)}),this._endpoints.onBeforeDelete.add(o=>o.dispose()),this.createEndpoints();for(const o of this._endpoints)o.three.element.style.borderColor=`#${i.lineMaterial.color.getHexString()}`;this.label=this.newText(),this.label.three.element.style.backgroundColor=`#${i.lineMaterial.color.getHexString()}`,this.label.three.renderOrder=1,this._root.renderOrder=2,this.world.scene.three.add(this._root),this.setupEvents()}set units(e){for(const t of this.rectangleDimensions)t.units=e;for(const t of this.projectionDimensions)t.units=e;this._units=e,this.updateLabel()}get units(){return this._units}set rounding(e){for(const t of this.rectangleDimensions)t.rounding=e;for(const t of this.projectionDimensions)t.rounding=e;this._rounding=e,this.updateLabel()}get rounding(){return this._rounding}get visible(){return this._visible}set visible(e){for(const a of this.rectangleDimensions)a.visible=e;for(const a of this.projectionDimensions)a.visible=e;this._visible=e,this.label.visible=e;for(const a of this._endpoints)a.visible=e;const[t,i]=this._endpoints,n=t.three,r=i.three,o=this.label.three;e?(this.world.scene.three.add(this._root),this._root.add(o,n,r)):(o.removeFromParent(),n.removeFromParent(),r.removeFromParent(),this._root.removeFromParent())}set end(e){this.line.end=e;const t=this.lineElement.geometry.attributes.position;t.setXYZ(1,e.x,e.y,e.z),t.needsUpdate=!0,this.update()}set start(e){this.line.start=e;const t=this.lineElement.geometry.attributes.position;t.setXYZ(0,e.x,e.y,e.z),t.needsUpdate=!0,this.update()}applyPlanesVisibility(e){for(const t of this._endpoints){if(!t.wasVisible)continue;let i=!1;for(const n of e)if(n.distanceToPoint(t.three.position)<0){i=!0;break}t.three.visible=!i}if(this.label.wasVisible){let t=!1;const i=this.label.three.position;for(const n of e)if(n.distanceToPoint(i)<0){t=!0;break}this.label.three.visible=!t}for(const t of this.rectangleDimensions)t.applyPlanesVisibility(e);for(const t of this.projectionDimensions)t.applyPlanesVisibility(e)}setupEvents(){this.rectangleDimensions.onBeforeDelete.add(e=>e.dispose()),this.projectionDimensions.onBeforeDelete.add(e=>e.dispose())}dispose(){this.visible=!1;const e=this._components.get(oi);e.destroy(this._root),e.destroy(this.lineElement),this._endpoints.clear(),this.label.dispose(),this.boundingBox&&e.destroy(this.boundingBox),this.rectangleDimensions.clear(),this.projectionDimensions.clear(),this._components=null}createBoundingBox(){const e=new D;this.line.getCenter(e);const t=this.line.distance();this.boundingBox.geometry=new ot(1,1,t),this.boundingBox.position.copy(e),this.boundingBox.lookAt(this.line.end),this.boundingBox.visible=!1,this._root.add(this.boundingBox)}invertRectangularDimensions(){this.rectangleDimensions.size!==0&&(this.rectangleDimensions.clear(),this._latestRectangularInversion=!this._latestRectangularInversion,this.updateRectangleComponents(this._latestRectangularInversion),this.displayRectangularDimensions())}displayRectangularDimensions(){this.rectangleDimensions.clear();for(const e of this.rectangleComponentLines){const t=new Sl(this._components,this.world,{line:e,lineMaterial:this._componentsMaterial,endpointElement:this.endpointElement});t.lineElement.computeLineDistances(),this.rectangleDimensions.add(t)}}displayProjectionDimensions(){this.projectionDimensions.clear();for(const e of this.projectionComponentLines){const t=new Sl(this._components,this.world,{line:e,lineMaterial:this._componentsMaterial,endpointElement:this.endpointElement});t.lineElement.computeLineDistances(),this.projectionDimensions.add(t)}}set endpointElement(e){for(const t of this.rectangleDimensions)t.endpointElement=e;for(const t of this.projectionDimensions)t.endpointElement=e;this._endpointElement=e,this.createEndpoints()}get endpointElement(){return this._endpointElement}createEndpoints(){this._endpoints.clear();const e=new Li(this.world,this._endpointElement),t=new Li(this.world,this._endpointElement.cloneNode(!0));this._endpoints.add(e,t)}updateProjectionComponents(){if(!this.startNormal)return;const e=new Ot().setFromNormalAndCoplanarPoint(this.startNormal,this.line.start),t=new D;e.projectPoint(this.line.end,t);let[i]=this.projectionComponentLines;i||(i=new Bi,this.projectionComponentLines.push(i)),i.set(this.line.end,t),i.distance()<.01&&this.projectionComponentLines.shift();for(const n of this.projectionDimensions)n&&n.update()}updateRectangleComponents(e=!1){const t=e?this.line.end:this.line.start,i=e?this.line.start:this.line.end,n=new D;n.subVectors(i,t),Math.abs(i.y-t.y)>=.1?n.y=0:n.x=0;const r=t.clone().add(n),[o,a]=this.rectangleComponentLines;o.set(r,t),a.set(r,i);for(const l of this.rectangleDimensions)l.update()}updateLabel(){this.label.three.element.textContent=this.getTextContent();const e=new D;this.line.getCenter(e),this.label.three.position.copy(e)}updateGeometry(){this.updateRectangleComponents(),this.updateProjectionComponents(),[...this._endpoints][0].three.position.copy(this.line.start),[...this._endpoints][1].three.position.copy(this.line.end),this.lineElement.geometry.computeBoundingSphere()}update(){this.updateGeometry(),this.updateLabel()}set material(e){this._material.dispose(),this._material=e,this.lineElement.material=e}get material(){return this._material}createLine(e){const t=new nt;t.setFromPoints([e.line.start,e.line.end]);const i=new Ht(t,e.lineMaterial);return this._root.add(i),i}newText(){const e=dp();e.textContent=this.getTextContent();const t=new Li(this.world,e),i=new D;return this.line.getCenter(i),t.three.position.copy(i),this._root.add(t.three),t}getTextContent(e=this.line.distance()){const t=Zs.convertUnits(e,"m",this._units,this.rounding);return`${Hi.valueFormatter?Hi.valueFormatter(t):t.toFixed(this.rounding)} ${this._units}`}set color(e){const t=`#${e.getHexString()}`;this.label.three.element.style.backgroundColor=t;for(const i of this._endpoints)i.three.element.style.borderColor=t;this._material.color.set(e)}},uc=class up{constructor(e){T(this,"id",st.create()),T(this,"points",new je),T(this,"tolerance",.005),T(this,"_plane",null),T(this,"_rounding",2),T(this,"_units","m2"),this.points.guard=t=>{const i=[...this.points].some(r=>r.equals(t)),n=this.isPointInPlane(t);return!i&&n},this.points.onItemAdded.add(t=>{if(this.plane){const i=new D;this.plane.projectPoint(t,i),t.copy(i)}this.points.size<3||this.points.size===3&&this.computePlane()}),this.points.onItemDeleted.add(()=>{this.points.size>=3||(this._plane=null)}),this.points.onCleared.add(()=>{this._plane=null}),e&&this.points.add(...e)}get plane(){return this._plane}get _coordinateSystem(){if(!this.plane)return null;const e=this.plane.normal,t=new D,i=new D;return Math.abs(e.x)>Math.abs(e.z)?t.set(-e.y,e.x,0).normalize():t.set(0,-e.z,e.y).normalize(),i.crossVectors(e,t).normalize(),{normal:e.clone(),x:t.clone(),y:i.clone()}}get points2D(){if(!this.plane)if(this.points.size>=3)this.computePlane();else return null;return[...this.points].map(e=>this.convertPointTo2D(e)).filter(e=>e!==null)}get center(){if(!this.plane||this.points.size<3)return null;const e=this.points2D;if(!e||e.length===0)return null;const t=e.reduce((i,n)=>i.add(n),new Ne).divideScalar(e.length);return this.convertPointTo3D(t)}get value(){return Zs.convertUnits(this.rawValue,"m2",this.units,this.rounding)}get rawValue(){const e=this.points2D;return e?Math.abs(Gm.area(e)):0}get boundingBox(){if(this.points.size===0)return null;const e=new Ve;for(const t of this.points)e.expandByPoint(t);return e}get perimeter(){const e=this.points2D;if(!e||e.length<2)return 0;let t=0;for(let i=0;i<e.length;i++){const n=e[i],r=e[(i+1)%e.length];t+=n.distanceTo(r)}return t}set rounding(e){this._rounding=e}get rounding(){return this._rounding}set units(e){this._units=e}get units(){return this._units}isPointInPlane(e){if(!this.plane)return!0;const t=this.plane.distanceToPoint(e);return Math.abs(t)<this.tolerance}clone(){const e=new up([...this.points]);return e.units=this.units,e.rounding=this.rounding,e.tolerance=this.tolerance,e}computePlane(){const[e,t,i]=this.points;if(!(e&&t&&i))return null;const n=new D().subVectors(t,e),r=new D().subVectors(i,e),o=new D().crossVectors(n,r).normalize();return this._plane=new Ot().setFromNormalAndCoplanarPoint(o,e),this.plane}convertPointTo2D(e){if(!this.isPointInPlane(e)||!this.plane)return null;const t=this._coordinateSystem;if(!t)return null;const i=new D;this.plane.projectPoint(e,i);const n=i.dot(t.x),r=i.dot(t.y);return new Ne(n,r)}convertPointTo3D(e){if(!this.plane)return null;const t=this._coordinateSystem;if(!t)return null;const{x:i,y:n,normal:r}=t;return new D().addScaledVector(i,e.x).addScaledVector(n,e.y).addScaledVector(r,-this.plane.constant)}},pp=class fp{constructor(e){T(this,"_components"),T(this,"id",st.create()),T(this,"onItemsChanged",new J),T(this,"_items",{}),T(this,"_units","m3"),T(this,"_rounding",2),this._components=e}set items(e){this._items=e,this.onItemsChanged.trigger()}get items(){return this._items}set units(e){this._units=e}get units(){return this._units}set rounding(e){this._rounding=e}get rounding(){return this._rounding}async getRawValue(){return await this._components.get(Zs).getItemsVolume(this.items)}async getValue(){const e=await this.getRawValue();return Zs.convertUnits(e,"m3",this.units,this.rounding)}async getCenter(){return await this._components.get(xo).getCenter(this.items)}async getBox(){const e=this._components.get(xo);e.list.clear(),await e.addFromModelIdMap(this.items);const t=e.get();return e.list.clear(),t}clone(){const e=new fp(this._components);return e.items=ke.clone(this.items),e}};function Qv(s,e,t=2){const i=s.length;let n=Kv(s,0,i,t,!0);const r=[];if(!n||n.next===n.prev)return r;let o,a,l;if(s.length>80*t){o=1/0,a=1/0;let c=-1/0,h=-1/0;for(let d=t;d<i;d+=t){const p=s[d],u=s[d+1];p<o&&(o=p),u<a&&(a=u),p>c&&(c=p),u>h&&(h=u)}l=Math.max(c-o,h-a),l=l!==0?32767/l:0}return sr(n,r,t,o,a,l,0),r}function Kv(s,e,t,i,n){let r;if(n===h_(s,e,t,i)>0)for(let o=e;o<t;o+=i)r=Vh(o/i|0,s[o],s[o+1],r);else for(let o=t-i;o>=e;o-=i)r=Vh(o/i|0,s[o],s[o+1],r);return r&&ea(r,r.next)&&(nr(r),r=r.next),r}function ir(s,e){if(!s)return s;e||(e=s);let t=s,i;do if(i=!1,!t.steiner&&(ea(t,t.next)||He(t.prev,t,t.next)===0)){if(nr(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function sr(s,e,t,i,n,r,o){if(!s)return;!o&&r&&s_(s,i,n,r);let a=s;for(;s.prev!==s.next;){const l=s.prev,c=s.next;if(r?e_(s,i,n,r):Jv(s)){e.push(l.i,s.i,c.i),nr(s),s=c.next,a=c.next;continue}if(s=c,s===a){o?o===1?(s=t_(ir(s),e),sr(s,e,t,i,n,r,2)):o===2&&i_(s,e,t,i,n,r):sr(ir(s),e,t,i,n,r,1);break}}}function Jv(s){const e=s.prev,t=s,i=s.next;if(He(e,t,i)>=0)return!1;const n=e.x,r=t.x,o=i.x,a=e.y,l=t.y,c=i.y,h=Math.min(n,r,o),d=Math.min(a,l,c),p=Math.max(n,r,o),u=Math.max(a,l,c);let g=i.next;for(;g!==e;){if(g.x>=h&&g.x<=p&&g.y>=d&&g.y<=u&&Vn(n,a,r,l,o,c,g.x,g.y)&&He(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function e_(s,e,t,i){const n=s.prev,r=s,o=s.next;if(He(n,r,o)>=0)return!1;const a=n.x,l=r.x,c=o.x,h=n.y,d=r.y,p=o.y,u=Math.min(a,l,c),g=Math.min(h,d,p),m=Math.max(a,l,c),b=Math.max(h,d,p),f=Al(u,g,e,t,i),y=Al(m,b,e,t,i);let v=s.prevZ,w=s.nextZ;for(;v&&v.z>=f&&w&&w.z<=y;){if(v.x>=u&&v.x<=m&&v.y>=g&&v.y<=b&&v!==n&&v!==o&&Vn(a,h,l,d,c,p,v.x,v.y)&&He(v.prev,v,v.next)>=0||(v=v.prevZ,w.x>=u&&w.x<=m&&w.y>=g&&w.y<=b&&w!==n&&w!==o&&Vn(a,h,l,d,c,p,w.x,w.y)&&He(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;v&&v.z>=f;){if(v.x>=u&&v.x<=m&&v.y>=g&&v.y<=b&&v!==n&&v!==o&&Vn(a,h,l,d,c,p,v.x,v.y)&&He(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;w&&w.z<=y;){if(w.x>=u&&w.x<=m&&w.y>=g&&w.y<=b&&w!==n&&w!==o&&Vn(a,h,l,d,c,p,w.x,w.y)&&He(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function t_(s,e){let t=s;do{const i=t.prev,n=t.next.next;!ea(i,n)&&mp(i,t,t.next,n)&&So(i,n)&&So(n,i)&&(e.push(i.i,t.i,n.i),nr(t),nr(t.next),t=s=n),t=t.next}while(t!==s);return ir(t)}function i_(s,e,t,i,n,r){let o=s;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&o_(o,a)){let l=c_(o,a);o=ir(o,o.next),l=ir(l,l.next),sr(o,e,t,i,n,r,0),sr(l,e,t,i,n,r,0);return}a=a.next}o=o.next}while(o!==s)}function s_(s,e,t,i){let n=s;do n.z===0&&(n.z=Al(n.x,n.y,e,t,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==s);n.prevZ.nextZ=null,n.prevZ=null,n_(n)}function n_(s){let e,t=1;do{let i=s,n;s=null;let r=null;for(e=0;i;){e++;let o=i,a=0;for(let c=0;c<t&&(a++,o=o.nextZ,!!o);c++);let l=t;for(;a>0||l>0&&o;)a!==0&&(l===0||!o||i.z<=o.z)?(n=i,i=i.nextZ,a--):(n=o,o=o.nextZ,l--),r?r.nextZ=n:s=n,n.prevZ=r,r=n;i=o}r.nextZ=null,t*=2}while(e>1);return s}function Al(s,e,t,i,n){return s=(s-t)*n|0,e=(e-i)*n|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,s|e<<1}function r_(s,e,t,i,n,r,o,a){return(n-o)*(e-a)>=(s-o)*(r-a)&&(s-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(r-a)>=(n-o)*(i-a)}function Vn(s,e,t,i,n,r,o,a){return!(s===o&&e===a)&&r_(s,e,t,i,n,r,o,a)}function o_(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!a_(s,e)&&(So(s,e)&&So(e,s)&&l_(s,e)&&(He(s.prev,s,e.prev)||He(s,e.prev,e))||ea(s,e)&&He(s.prev,s,s.next)>0&&He(e.prev,e,e.next)>0)}function He(s,e,t){return(e.y-s.y)*(t.x-e.x)-(e.x-s.x)*(t.y-e.y)}function ea(s,e){return s.x===e.x&&s.y===e.y}function mp(s,e,t,i){const n=oo(He(s,e,t)),r=oo(He(s,e,i)),o=oo(He(t,i,s)),a=oo(He(t,i,e));return!!(n!==r&&o!==a||n===0&&ro(s,t,e)||r===0&&ro(s,i,e)||o===0&&ro(t,s,i)||a===0&&ro(t,e,i))}function ro(s,e,t){return e.x<=Math.max(s.x,t.x)&&e.x>=Math.min(s.x,t.x)&&e.y<=Math.max(s.y,t.y)&&e.y>=Math.min(s.y,t.y)}function oo(s){return s>0?1:s<0?-1:0}function a_(s,e){let t=s;do{if(t.i!==s.i&&t.next.i!==s.i&&t.i!==e.i&&t.next.i!==e.i&&mp(t,t.next,s,e))return!0;t=t.next}while(t!==s);return!1}function So(s,e){return He(s.prev,s,s.next)<0?He(s,e,s.next)>=0&&He(s,s.prev,e)>=0:He(s,e,s.prev)<0||He(s,s.next,e)<0}function l_(s,e){let t=s,i=!1;const n=(s.x+e.x)/2,r=(s.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&n<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==s);return i}function c_(s,e){const t=$l(s.i,s.x,s.y),i=$l(e.i,e.x,e.y),n=s.next,r=e.prev;return s.next=e,e.prev=s,t.next=n,n.prev=t,i.next=t,t.prev=i,r.next=i,i.prev=r,i}function Vh(s,e,t,i){const n=$l(s,e,t);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function nr(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function $l(s,e,t){return{i:s,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function h_(s,e,t,i){let n=0;for(let r=e,o=t-i;r<t;r+=i)n+=(s[o]-s[r])*(s[r+1]+s[o+1]),o=r;return n}let gp=class extends Li{constructor(e){const t=document.createElement("div");t.style.backgroundColor="blue",t.style.color="white",t.style.padding="6px",t.style.borderRadius="6px",t.style.boxShadow="0px 4px 6px rgba(0, 0, 0, 0.6)",t.style.zIndex="-10",super(e,t),T(this,"_value",0),T(this,"_units","m2"),T(this,"_worldUnits","m2"),T(this,"_color",new be),T(this,"_textColor",new be),T(this,"_rounding",2),this.three.renderOrder=1,t.textContent=this.formattedValue}set value(e){this._value=e,this.three.element.textContent=this.formattedValue}get value(){return this._value}set units(e){this._units=e,this.three.element.textContent=this.formattedValue}get units(){return this._units}set worldUnits(e){this._worldUnits=e,this.three.element.textContent=this.formattedValue}get worldUnits(){return this._worldUnits}set color(e){this._color=e;const t=`#${e.getHexString()}`;this.three.element.style.backgroundColor=t}get color(){return this._color}set textColor(e){this._textColor=e;const t=`#${e.getHexString()}`;this.three.element.style.color=t}get textColor(){return this._textColor}set rounding(e){this._rounding=e,this.three.element.textContent=this.formattedValue}get rounding(){return this._rounding}get formattedValue(){const e=Zs.convertUnits(this.value,this.worldUnits,this.units,this.rounding);return`${Hi.valueFormatter?Hi.valueFormatter(e):e.toFixed(this.rounding)} ${this.units}`}},d_=class{constructor(e,t,i=new uc){T(this,"_root",new Ni),T(this,"_components"),T(this,"_material",new _o({color:"red",transparent:!0,opacity:.5,side:Ui,depthTest:!1})),T(this,"_visible",!0),T(this,"_color",new be),T(this,"label"),T(this,"three",new re),T(this,"world"),T(this,"area"),T(this,"_triggerUpdate",()=>this.update()),this._components=e,this.world=t,this.area=i,this.world.scene.three.add(this.three),this.label=new gp(t),this._root.renderOrder=2,this.visible=!0,this.update(),i.points.onItemAdded.add(this._triggerUpdate),i.points.onItemDeleted.add(this._triggerUpdate),i.points.onCleared.add(this._triggerUpdate)}set material(e){this._material.dispose(),this._material=e,this.three.material=e}get material(){return this._material}set visible(e){this._visible=e,this.label.visible=e;const t=this.label.three;e?(this._root.add(t,this.three),this.world.scene.three.add(this._root)):(t.removeFromParent(),this._root.removeFromParent())}get visible(){return this._visible}set rounding(e){this.label.rounding=e}get rounding(){return this.label.rounding}set units(e){this.label.units=e}get units(){return this.label.units}set color(e){this._color=e,this.label.color=e,this._material.color.set(e)}get color(){return this._color}applyPlanesVisibility(e){if(!this.label.wasVisible)return;let t=!1;const i=this.area.center;if(i){for(const n of e)if(n.distanceToPoint(i)<0){t=!0;break}}this.label.three.visible=!t}updateMesh(){if(this.area.points.size<3)return;const e=this.area.points2D;if(!e||e.length<3)return;const t=e.flatMap(o=>[o.x,o.y]),i=Qv(t),n=[];for(const o of e){const a=this.area.convertPointTo3D(o);a&&n.push(a.x,a.y,a.z)}this.three.geometry&&this.three.geometry.dispose();const r=new nt;r.setAttribute("position",new Fi(n,3)),r.setIndex(i),this.three.geometry=r,this.three.material=this.material}update(){if(this.updateMesh(),this.area.rawValue===0)this.label.visible=!1;else{this.label.value=this.area.rawValue,this.label.visible=!0;const e=this.area.center;e&&this.label.three.position.copy(e)}}dispose(){this.label.dispose(),this._components.get(oi).destroy(this._root,!0,!0),this.area.points.clear()}};const u_={length:"m",area:"m2",volume:"m3"};let bp=class{constructor(e,t,i=new pp(e)){T(this,"_root",new Ni),T(this,"_components"),T(this,"_material",new _o({color:"red",transparent:!0,opacity:.75,side:Ui,depthTest:!1})),T(this,"_visible",!0),T(this,"_color",new be),T(this,"label"),T(this,"world"),T(this,"volume"),T(this,"meshes",[]),this._components=e,this.world=t,this.volume=i,this.label=new gp(t),this._root.renderOrder=2,this.visible=!0,this.update(),this.volume.onItemsChanged.add(()=>this.update())}set material(e){this._material.dispose(),this._material=e;for(const t of this.meshes)t.material=e}get material(){return this._material}set visible(e){this._visible=e,this.label.visible=e;for(const t of this.meshes)e?this.world.scene.three.add(t):t.removeFromParent()}get visible(){return this._visible}set rounding(e){this.label.rounding=e}get rounding(){return this.label.rounding}set units(e){this.label.units=e}get units(){return this.label.units}set color(e){this._color=e,this.label.color=e,this._material.color.set(e)}get color(){return this._color}applyPlanesVisibility(e){if(!this.label.wasVisible)return;let t=!1;for(const i of this.meshes){for(const n of e)if(n.distanceToPoint(i.position)<0){t=!0;break}this.label.three.visible=!t}}async updateMesh(){this.cleanMeshes();const e=this._components.get(Eo),t=await e.get(this.volume.items,{material:this.material});this.meshes=e.getMeshesFromResult(t);for(const i of this.meshes)this.world.scene.three.add(i)}async update(){this.updateMesh();const e=await this.volume.getRawValue();this.label.visible=e!==0,this.label.value=e;const t=await this.volume.getCenter();t&&this.label.three.position.copy(t)}cleanMeshes(){const e=this._components.get(oi);for(const t of this.meshes)e.destroy(t,!0,!0);this._components.get(Eo).remove(),this.meshes=[]}dispose(){this.label.dispose(),this.cleanMeshes(),this.volume.items={}}},Hi=class extends Ae{constructor(e,t){super(e),T(this,"list",new je),T(this,"onDisposed",new J),T(this,"snappings",[gt.LINE,gt.POINT,gt.FACE]),T(this,"lines",new je),T(this,"fills",new je),T(this,"labels",new je),T(this,"volumes",new je),T(this,"delay",300),T(this,"_world",null),T(this,"measureType"),T(this,"onPointerStop",new J),T(this,"onPointerMove",new J),T(this,"onStateChanged",new J),T(this,"pointerStopTimeout",null),T(this,"onMove",()=>{this.enabled&&(this._vertexPicker.updatePointer(),this.pointerStopTimeout!==null&&clearTimeout(this.pointerStopTimeout),this.pointerStopTimeout=window.setTimeout(()=>{this.onPointerStop.trigger()},this.delay),this.onPointerMove.trigger())}),T(this,"onKeydown",i=>{this.enabled&&i.key==="Escape"&&this.cancelCreation()}),T(this,"onEnabledChange",new J),T(this,"_enabled",!1),T(this,"onVisibilityChange",new J),T(this,"_visible",!0),T(this,"_units"),T(this,"_rounding",2),T(this,"_linesEndpointElement",dp()),T(this,"_linesMaterial",new Gl({color:"#0000FF",depthTest:!1})),T(this,"_fillsMaterial",new _o({color:2392594,side:Ui,transparent:!0,opacity:.3,depthTest:!1})),T(this,"_volumesMaterial",new _o({color:2392594,side:Ui,transparent:!0,opacity:.3,depthTest:!1})),T(this,"_color",new be),T(this,"_vertexPicker",new Zv(this.components)),T(this,"create",i=>{}),T(this,"endCreation",i=>{}),T(this,"cancelCreation",()=>{}),T(this,"delete",i=>{}),this.measureType=t,this._units=u_[this.measureType],this.lines.onBeforeDelete.add(i=>i.dispose()),this.fills.onBeforeDelete.add(i=>i.dispose()),this.labels.onBeforeDelete.add(i=>i.dispose()),this.volumes.onBeforeDelete.add(i=>i.dispose()),this.list.onCleared.add(()=>{this.lines.clear(),this.fills.clear(),this.labels.clear(),this.volumes.clear()})}set world(e){this._world=e,this._vertexPicker.world=e}get world(){return this._world}get unitsList(){let e=[];return this.measureType==="length"?e=["mm","cm","m","km"]:this.measureType==="area"?e=["mm2","cm2","m2","km2"]:e=["mm3","cm3","m3","km3"],e}setEvents(e){if(!this.world)throw new Error("Measurement: you must specify a world first!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("Measurement: the world needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;t&&(t.removeEventListener("pointermove",this.onMove),window.removeEventListener("keydown",this.onKeydown),e&&(t.addEventListener("pointermove",this.onMove),window.addEventListener("keydown",this.onKeydown)))}set enabled(e){this._enabled=e,this._vertexPicker.enabled=e,this.setEvents(e),this.cancelCreation(),this.onEnabledChange.trigger(e),this.onStateChanged.trigger(["enabled"])}get enabled(){return this._enabled}set visible(e){this._visible=e;for(const t of this.lines)t.visible=e;for(const t of this.fills)t.visible=e;for(const t of this.volumes)t.visible=e;this.onVisibilityChange.trigger(e),this.onStateChanged.trigger(["visibility"])}get visible(){return this._visible}set units(e){this._units=e;let t;e.endsWith("2")?t="area":e.endsWith("3")?t="volume":t="length";for(const i of this.list)(i instanceof Bi||i instanceof uc||i instanceof pp)&&(i.units=e);if(t==="length")for(const i of this.lines)i.units=e;else if(t==="area")for(const i of this.fills)i.units=e;else if(t==="volume")for(const i of this.volumes)i.units=e;this.onStateChanged.trigger(["units"])}get units(){return this._units}set rounding(e){this._rounding=e;for(const t of this.list)"rounding"in t&&typeof t.rounding=="number"&&(t.rounding=e);for(const t of this.lines)t.rounding=e;for(const t of this.fills)t.rounding=e;for(const t of this.volumes)t.rounding=e;this.onStateChanged.trigger(["rounding"])}get rounding(){return this._rounding}set linesEndpointElement(e){this._linesEndpointElement=e;for(const t of this.lines)t.endpointElement=e}get linesEndpointElement(){return this._linesEndpointElement}set linesMaterial(e){this._linesMaterial.dispose(),this._linesMaterial=e;for(const t of this.lines)t.material=e}get linesMaterial(){return this._linesMaterial}set fillsMaterial(e){this._fillsMaterial.dispose(),this._fillsMaterial=e;for(const t of this.fills)t.material=e}get fillsMaterial(){return this._fillsMaterial}set volumesMaterial(e){this._volumesMaterial.dispose(),this._volumesMaterial=e;for(const t of this.volumes)t.material=e}get volumesMaterial(){return this._volumesMaterial}set color(e){this._color=e,this._linesMaterial.color.set(e),this._fillsMaterial.color.set(e),this._volumesMaterial.color.set(e);for(const t of this.lines)t.color=e;for(const t of this.fills)t.color=e;for(const t of this.volumes)t.color=e;this.onStateChanged.trigger(["color"])}get color(){return this._color}get pickerMode(){return this._vertexPicker.mode}set pickerMode(e){this._vertexPicker.mode=e}get snapDistance(){return this._vertexPicker.maxDistance}set snapDistance(e){this._vertexPicker.maxDistance=e}dispose(){this._vertexPicker.dispose(),this.list.clear(),this.linesMaterial.dispose(),this.fillsMaterial.dispose(),this.volumesMaterial.dispose(),this.onDisposed.trigger()}applyPlanesVisibility(e){for(const t of this.lines)t.applyPlanesVisibility(e);for(const t of this.fills)t.applyPlanesVisibility(e);for(const t of this.volumes)t.applyPlanesVisibility(e)}createLineElement(e,t=null){if(!this.world)throw new Error("Measurement: world is need!");return new Xv(this.components,this.world,{line:e,startNormal:t??void 0,lineMaterial:this.linesMaterial,endpointElement:this.linesEndpointElement},this.rounding,this.units)}createFillElement(e){if(!this.world)throw new Error("Measurement: world is need!");const t=new d_(this.components,this.world,e);return t.rounding=this.rounding,(this.units.endsWith("2")?"area":void 0)==="area"&&(t.units=this.units),t}createVolumeElement(e){if(!this.world)throw new Error("Measurement: world is need!");const t=new bp(this.components,this.world,e);return t.rounding=this.rounding,(this.units.endsWith("3")?"volume":void 0)==="volume"&&(t.units=this.units),t}addLineElementsFromPoints(e){for(let t=0;t<e.length;t++){const i=e[t],n=e[(t+1)%e.length],r=new Bi(i,n),o=this.createLineElement(r);o.label.visible=!1,this.lines.add(o)}}getLineBoxes(){const e=[];for(const t of this.lines)e.push(t.boundingBox);return e}getFillBoxes(){const e=[];for(const t of this.fills)e.push(t.three);return e}async getVolumeBoxes(){const e=[];for(const t of this.volumes)e.push(t.meshes);return e}};T(Hi,"valueFormatter",null);const p_=class yp extends Hi{constructor(e){super(e,"area"),T(this,"pickTolerance",.1),T(this,"tolerance",.005),T(this,"modes",["free","square","face"]),T(this,"_mode","free"),T(this,"_temp",{isDragging:!1,area:new uc,lines:new je,point:new D}),T(this,"_lineToAreaMap",new WeakMap),T(this,"computeLineElements",()=>{this._temp.lines.clear();const t=[...this._temp.area.points];if(this._temp.area.isPointInPlane(this._temp.point)&&t.push(this._temp.point),!(t.length<2||!this.world))for(let i=0;i<t.length;i++){const n=t[i],r=t[(i+1)%t.length],o=new Bi(n,r),a=this.createLineElement(o);this._temp.lines.add(a)}}),T(this,"create",async()=>{if(!this.enabled)return;if(!this.world)throw new Error("Area Measurement: world is not defined!");const t=await this._vertexPicker.get({snappingClasses:this.snappings});if(!(t&&t.point))return;if(this.mode==="face"){const r=t.facePoints;if(!r)return;const o=[];for(let a=0;a<r.length-2;a+=3){const l=r[a],c=r[a+1],h=r[a+2];o.push(new D(l,c,h))}this._temp.area.points.add(...o),this.endCreation();return}const{area:i,point:n}=this._temp;if(this._temp.isDragging||(i.tolerance=this.tolerance,i.points.clear(),this._temp.isDragging=!0),i.points.size===0&&n.copy(t.point),i.points.add(n.clone()),this.mode==="square"&&i.points.size===2&&t.normal){const[r,o]=i.points,a=new D().subVectors(o,r),l=a.clone(),c=a.clone().negate();Math.abs(a.y)>=.1?(l.y=0,c.y=0):(l.x=0,c.x=0);const h=r.clone().add(l),d=o.clone().add(c);i.points.clear(),i.points.add(r,h,o,d),this.endCreation()}}),T(this,"endCreation",()=>{this.enabled&&(this._temp.isDragging=!1,this._temp.area.points.size>=3&&this.list.add(this._temp.area.clone()),this._temp.area.points.clear(),this._temp.lines.clear())}),T(this,"cancelCreation",()=>{this.enabled&&(this._temp.isDragging=!1,this._temp.area.points.clear(),this._temp.lines.clear())}),T(this,"delete",()=>{if(!this.enabled||this.list.size===0||!this.world)return;const t=this.getFillBoxes(),i=this.components.get(pt).get(this.world).castRayToObjects(t);if(!i)return;const n=[...this.fills].find(o=>o.three===i.object);if(!n)return;const r=n.area;this.fills.delete(n),this.list.delete(r),this.components.get(oi).destroy(i.object)}),e.add(yp.uuid,this),this.initHandlers(),this.color=new be("#6528d7")}get mode(){return this._mode}set mode(e){this._mode=e,this.cancelCreation(),this.onStateChanged.trigger(["mode"])}initHandlers(){this.onVisibilityChange.add(()=>{for(const e of this.lines)e.label.visible=!1}),this.list.onItemAdded.add(e=>{if(!this.world)return;const t=this.createFillElement(e);t.color=this.color,this.fills.add(t),this.addLineElementsFromPointsForArea([...e.points],e)}),this.list.onBeforeDelete.add(e=>{const t=[...this.fills].find(n=>n.area===e);t&&this.fills.delete(t);const i=[];for(const n of this.lines)this._lineToAreaMap.get(n)===e&&i.push(n);for(const n of i)this.lines.delete(n),this._lineToAreaMap.delete(n)}),this.onPointerStop.add(()=>this.updatePreview()),this._temp.lines.onItemAdded.add(e=>e.label.visible=!1),this._temp.lines.onBeforeDelete.add(e=>e.dispose()),this._temp.area.points.onItemAdded.add(()=>{this.computeLineElements()}),this._temp.area.points.onItemDeleted.add(()=>{this._temp.lines.clear()}),this.onStateChanged.add(e=>{e.includes("rounding")&&(this._temp.area.rounding=this.rounding),e.includes("units")&&(this._temp.area.units=this.units)})}async updatePreview(){if(!this.enabled||!this.world)throw new Error("Measurement is not enabled or world is not defined!");const e=await this._vertexPicker.get({snappingClasses:this.snappings});if(!(e&&e.point&&this._temp.isDragging))return;const t=e.point.clone(),{plane:i}=this._temp.area;if(i){const n=i.distanceToPoint(t);if(Math.abs(n)<.1){const r=new D;i.projectPoint(t,r),t.copy(r)}}this._temp.point.copy(t),this.computeLineElements()}addLineElementsFromPointsForArea(e,t){for(let i=0;i<e.length;i++){const n=e[i],r=e[(i+1)%e.length],o=new Bi(n,r),a=this.createLineElement(o);a.label.visible=!1,this.lines.add(a),this._lineToAreaMap.set(a,t)}}};T(p_,"uuid","09b78c1f-0ff1-4630-a818-ceda3d878c75");const f_=class vp extends Hi{constructor(e){super(e,"length"),T(this,"_temp",{isDragging:!1,line:new Bi}),T(this,"modes",["free","edge"]),T(this,"_mode","free"),T(this,"create",async()=>{if(this.enabled){if(!this._temp.isDragging){await this.initPreview();return}this.endCreation()}}),T(this,"endCreation",()=>{this.enabled&&this._temp.dimension&&(this.list.add(this._temp.line.clone()),this.mode==="free"&&(this._temp.dimension.dispose(),this._temp.dimension=void 0,this._temp.isDragging=!1,this._temp.startNormal=void 0))}),T(this,"cancelCreation",()=>{var t;this.enabled&&(this._temp.isDragging=!1,this._temp.dimension&&((t=this._temp.dimension)==null||t.dispose(),this._temp.dimension=void 0))}),T(this,"delete",()=>{if(!this.enabled||this.list.size===0||!this.world)return;const t=this.getLineBoxes(),i=this.components.get(pt).get(this.world).castRayToObjects(t);if(!i)return;const n=[...this.lines].find(r=>r.boundingBox===i.object);n&&this.list.delete(n.line)}),e.add(vp.uuid,this),this.initHandlers()}get mode(){return this._mode}set mode(e){this._mode=e,this.cancelCreation(),e==="edge"&&this.initPreview(),this.onStateChanged.trigger(["mode"])}get isDragging(){return this._temp.isDragging}initHandlers(){this.list.onItemAdded.add(e=>{const t=this.createLineElement(e,this._temp.startNormal);t.createBoundingBox(),this.lines.add(t)}),this.list.onBeforeDelete.add(e=>{const t=[...this.lines].find(i=>i.line===e);t&&this.lines.delete(t)}),this.onPointerStop.add(()=>this.updatePreviewLine()),this.onEnabledChange.add(e=>{e&&this.mode==="edge"&&this.initPreview()})}async initPreview(){if(!this.world)throw new Error("Measurement: world is need!");const e=await this._vertexPicker.get({snappingClasses:this.snappings});if(this.mode==="free"){if(!(e!=null&&e.point))return;const t=e.point;this._temp.line.set(t,t.clone()),this._temp.isDragging=!0,this._temp.dimension=this.createLineElement(this._temp.line),this._temp.startNormal=e.normal??void 0}else if(this.mode==="edge"){const t=e==null?void 0:e.snappedEdgeP1,i=e==null?void 0:e.snappedEdgeP2,n=t||new D,r=n||i;this._temp.line.set(n,r),this._temp.isDragging=!0,this._temp.dimension=this.createLineElement(this._temp.line),this._temp.dimension.visible=!!(t&&i)}}async updatePreviewLine(){if(!this.world)throw new Error("Measurement: world is need!");const e=await this._vertexPicker.get({snappingClasses:this.snappings});if(this.mode==="free"){if(!(e!=null&&e.point)||(this._temp.line.end.copy(e.point),!this._temp.dimension))return;this._temp.dimension.end=this._temp.line.end}else if(this.mode==="edge"){const t=e==null?void 0:e.snappedEdgeP1,i=e==null?void 0:e.snappedEdgeP2;if(this._temp.dimension&&(this._temp.dimension.visible=!!(t&&i)),!(t&&i)||(this._temp.line.start.copy(t),this._temp.line.end.copy(i),!this._temp.dimension))return;this._temp.dimension.start=this._temp.line.start,this._temp.dimension.end=this._temp.line.end}}};T(f_,"uuid","2f9bcacf-18a9-4be6-a293-e898eae64ea1");const m_=class _p extends Hi{constructor(e){super(e,"volume"),T(this,"_temp",{}),T(this,"onPreviewInitialized",new J),T(this,"modes",["free"]),T(this,"_mode","free"),T(this,"_previousHovererState",!1),T(this,"create",async()=>{if(!this.enabled)return;const t=await this._vertexPicker.get();t&&(this._temp.preview||await this.initPreview(),this._temp.preview.volume.items=ke.join([this._temp.preview.volume.items,{[t.fragments.modelId]:new Set([t.localId])}]))}),T(this,"endCreation",()=>{if(!this._temp.preview||ke.isEmpty(this._temp.preview.volume.items))return;const t=this._temp.preview.volume.clone();this.list.add(t),this._temp.preview.dispose(),delete this._temp.preview}),T(this,"cancelCreation",()=>{var t;(t=this._temp.preview)==null||t.dispose(),delete this._temp.preview}),T(this,"delete",async()=>{if(this.list.size===0||!this.world)return;const t=await this.getVolumeBoxes(),i=this.components.get(pt).get(this.world);for(const n of t){const r=i.castRayToObjects(n);if(!r)continue;const o=[...this.volumes].find(a=>a.meshes.some(l=>l===r.object));if(!o)return;this.list.delete(o.volume)}}),e.add(_p.uuid,this),this.initHandlers()}get mode(){return this._mode}set mode(e){this._mode=e,this.cancelCreation(),this.onStateChanged.trigger(["mode"])}initHandlers(){this.list.onItemAdded.add(e=>{const t=this.createVolumeElement(e);t.color=this.color,t.rounding=this.rounding,t.units=this.units,this.volumes.add(t)}),this.list.onBeforeDelete.add(e=>{const t=[...this.volumes].find(i=>i.volume===e);t&&this.volumes.delete(t)}),this.onStateChanged.add(e=>{if(e.includes("color")){if(!this._temp.preview)return;this._temp.preview.color=this.color}if(e.includes("units")){if(!this._temp.preview)return;this._temp.preview.units=this.units}if(e.includes("rounding")){if(!this._temp.preview)return;this._temp.preview.rounding=this.rounding}if(e.includes("enabled")){const t=this.components.get(Hv);t.world=this.world,this.enabled?(this._previousHovererState=t.enabled,t.enabled=!0):(t.clear(),t.enabled=this._previousHovererState),t.hover()}})}async initPreview(){if(this.enabled){if(!this.world)throw new Error("Measurement: world is need!");this._temp.preview=new bp(this.components,this.world),this._temp.preview.color=this.color,this._temp.preview.rounding=this.rounding,this._temp.preview.units=this.units,this.onPreviewInitialized.trigger(this._temp.preview)}}};T(m_,"uuid","01f885ab-ec4e-4e6c-a853-9dfc0d6766ed");/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const go=globalThis,pc=go.ShadowRoot&&(go.ShadyCSS===void 0||go.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,fc=Symbol(),qh=new WeakMap;let wp=class{constructor(s,e,t){if(this._$cssResult$=!0,t!==fc)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=s,this.t=e}get styleSheet(){let s=this.o;const e=this.t;if(pc&&s===void 0){const t=e!==void 0&&e.length===1;t&&(s=qh.get(e)),s===void 0&&((this.o=s=new CSSStyleSheet).replaceSync(this.cssText),t&&qh.set(e,s))}return s}toString(){return this.cssText}};const g_=s=>new wp(typeof s=="string"?s:s+"",void 0,fc),mc=(s,...e)=>{const t=s.length===1?s[0]:e.reduce((i,n,r)=>i+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+s[r+1],s[0]);return new wp(t,s,fc)},b_=(s,e)=>{if(pc)s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const t of e){const i=document.createElement("style"),n=go.litNonce;n!==void 0&&i.setAttribute("nonce",n),i.textContent=t.cssText,s.appendChild(i)}},Wh=pc?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(const i of e.cssRules)t+=i.cssText;return g_(t)})(s):s;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:y_,defineProperty:v_,getOwnPropertyDescriptor:__,getOwnPropertyNames:w_,getOwnPropertySymbols:x_,getPrototypeOf:C_}=Object,Gs=globalThis,Yh=Gs.trustedTypes,E_=Yh?Yh.emptyScript:"",Zh=Gs.reactiveElementPolyfillSupport,Zn=(s,e)=>s,Ao={toAttribute(s,e){switch(e){case Boolean:s=s?E_:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch{t=null}}return t}},gc=(s,e)=>!y_(s,e),Gh={attribute:!0,type:String,converter:Ao,reflect:!1,useDefault:!1,hasChanged:gc};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Gs.litPropertyMetadata??(Gs.litPropertyMetadata=new WeakMap);let Ns=class extends HTMLElement{static addInitializer(s){this._$Ei(),(this.l??(this.l=[])).push(s)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(s,e=Gh){if(e.state&&(e.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(s)&&((e=Object.create(e)).wrapped=!0),this.elementProperties.set(s,e),!e.noAccessor){const t=Symbol(),i=this.getPropertyDescriptor(s,t,e);i!==void 0&&v_(this.prototype,s,i)}}static getPropertyDescriptor(s,e,t){const{get:i,set:n}=__(this.prototype,s)??{get(){return this[e]},set(r){this[e]=r}};return{get:i,set(r){const o=i==null?void 0:i.call(this);n==null||n.call(this,r),this.requestUpdate(s,o,t)},configurable:!0,enumerable:!0}}static getPropertyOptions(s){return this.elementProperties.get(s)??Gh}static _$Ei(){if(this.hasOwnProperty(Zn("elementProperties")))return;const s=C_(this);s.finalize(),s.l!==void 0&&(this.l=[...s.l]),this.elementProperties=new Map(s.elementProperties)}static finalize(){if(this.hasOwnProperty(Zn("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Zn("properties"))){const e=this.properties,t=[...w_(e),...x_(e)];for(const i of t)this.createProperty(i,e[i])}const s=this[Symbol.metadata];if(s!==null){const e=litPropertyMetadata.get(s);if(e!==void 0)for(const[t,i]of e)this.elementProperties.set(t,i)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const i=this._$Eu(e,t);i!==void 0&&this._$Eh.set(i,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(s){const e=[];if(Array.isArray(s)){const t=new Set(s.flat(1/0).reverse());for(const i of t)e.unshift(Wh(i))}else s!==void 0&&e.push(Wh(s));return e}static _$Eu(s,e){const t=e.attribute;return t===!1?void 0:typeof t=="string"?t:typeof s=="string"?s.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var s;this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),(s=this.constructor.l)==null||s.forEach(e=>e(this))}addController(s){var e;(this._$EO??(this._$EO=new Set)).add(s),this.renderRoot!==void 0&&this.isConnected&&((e=s.hostConnected)==null||e.call(s))}removeController(s){var e;(e=this._$EO)==null||e.delete(s)}_$E_(){const s=new Map,e=this.constructor.elementProperties;for(const t of e.keys())this.hasOwnProperty(t)&&(s.set(t,this[t]),delete this[t]);s.size>0&&(this._$Ep=s)}createRenderRoot(){const s=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return b_(s,this.constructor.elementStyles),s}connectedCallback(){var s;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(s=this._$EO)==null||s.forEach(e=>{var t;return(t=e.hostConnected)==null?void 0:t.call(e)})}enableUpdating(s){}disconnectedCallback(){var s;(s=this._$EO)==null||s.forEach(e=>{var t;return(t=e.hostDisconnected)==null?void 0:t.call(e)})}attributeChangedCallback(s,e,t){this._$AK(s,t)}_$ET(s,e){var t;const i=this.constructor.elementProperties.get(s),n=this.constructor._$Eu(s,i);if(n!==void 0&&i.reflect===!0){const r=(((t=i.converter)==null?void 0:t.toAttribute)!==void 0?i.converter:Ao).toAttribute(e,i.type);this._$Em=s,r==null?this.removeAttribute(n):this.setAttribute(n,r),this._$Em=null}}_$AK(s,e){var t,i;const n=this.constructor,r=n._$Eh.get(s);if(r!==void 0&&this._$Em!==r){const o=n.getPropertyOptions(r),a=typeof o.converter=="function"?{fromAttribute:o.converter}:((t=o.converter)==null?void 0:t.fromAttribute)!==void 0?o.converter:Ao;this._$Em=r,this[r]=a.fromAttribute(e,o.type)??((i=this._$Ej)==null?void 0:i.get(r))??null,this._$Em=null}}requestUpdate(s,e,t){var i;if(s!==void 0){const n=this.constructor,r=this[s];if(t??(t=n.getPropertyOptions(s)),!((t.hasChanged??gc)(r,e)||t.useDefault&&t.reflect&&r===((i=this._$Ej)==null?void 0:i.get(s))&&!this.hasAttribute(n._$Eu(s,t))))return;this.C(s,e,t)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(s,e,{useDefault:t,reflect:i,wrapped:n},r){t&&!(this._$Ej??(this._$Ej=new Map)).has(s)&&(this._$Ej.set(s,r??e??this[s]),n!==!0||r!==void 0)||(this._$AL.has(s)||(this.hasUpdated||t||(e=void 0),this._$AL.set(s,e)),i===!0&&this._$Em!==s&&(this._$Eq??(this._$Eq=new Set)).add(s))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const s=this.scheduleUpdate();return s!=null&&await s,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var s;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[n,r]of this._$Ep)this[n]=r;this._$Ep=void 0}const i=this.constructor.elementProperties;if(i.size>0)for(const[n,r]of i){const{wrapped:o}=r,a=this[n];o!==!0||this._$AL.has(n)||a===void 0||this.C(n,void 0,r,a)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),(s=this._$EO)==null||s.forEach(i=>{var n;return(n=i.hostUpdate)==null?void 0:n.call(i)}),this.update(t)):this._$EM()}catch(i){throw e=!1,this._$EM(),i}e&&this._$AE(t)}willUpdate(s){}_$AE(s){var e;(e=this._$EO)==null||e.forEach(t=>{var i;return(i=t.hostUpdated)==null?void 0:i.call(t)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(s)),this.updated(s)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(s){return!0}update(s){this._$Eq&&(this._$Eq=this._$Eq.forEach(e=>this._$ET(e,this[e]))),this._$EM()}updated(s){}firstUpdated(s){}};Ns.elementStyles=[],Ns.shadowRootOptions={mode:"open"},Ns[Zn("elementProperties")]=new Map,Ns[Zn("finalized")]=new Map,Zh==null||Zh({ReactiveElement:Ns}),(Gs.reactiveElementVersions??(Gs.reactiveElementVersions=[])).push("2.1.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const $o=globalThis,To=$o.trustedTypes,Xh=To?To.createPolicy("lit-html",{createHTML:s=>s}):void 0,xp="$lit$",Oi=`lit$${Math.random().toFixed(9).slice(2)}$`,Cp="?"+Oi,S_=`<${Cp}>`,ps=document,rr=()=>ps.createComment(""),or=s=>s===null||typeof s!="object"&&typeof s!="function",bc=Array.isArray,A_=s=>bc(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",Va=`[ 	
\f\r]`,Bn=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Qh=/-->/g,Kh=/>/g,is=RegExp(`>|${Va}(?:([^\\s"'>=/]+)(${Va}*=${Va}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Jh=/'/g,ed=/"/g,Ep=/^(?:script|style|textarea|title)$/i,$_=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),yc=$_(1),Xs=Symbol.for("lit-noChange"),qe=Symbol.for("lit-nothing"),td=new WeakMap,as=ps.createTreeWalker(ps,129);function Sp(s,e){if(!bc(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return Xh!==void 0?Xh.createHTML(e):e}const T_=(s,e)=>{const t=s.length-1,i=[];let n,r=e===2?"<svg>":e===3?"<math>":"",o=Bn;for(let a=0;a<t;a++){const l=s[a];let c,h,d=-1,p=0;for(;p<l.length&&(o.lastIndex=p,h=o.exec(l),h!==null);)p=o.lastIndex,o===Bn?h[1]==="!--"?o=Qh:h[1]!==void 0?o=Kh:h[2]!==void 0?(Ep.test(h[2])&&(n=RegExp("</"+h[2],"g")),o=is):h[3]!==void 0&&(o=is):o===is?h[0]===">"?(o=n??Bn,d=-1):h[1]===void 0?d=-2:(d=o.lastIndex-h[2].length,c=h[1],o=h[3]===void 0?is:h[3]==='"'?ed:Jh):o===ed||o===Jh?o=is:o===Qh||o===Kh?o=Bn:(o=is,n=void 0);const u=o===is&&s[a+1].startsWith("/>")?" ":"";r+=o===Bn?l+S_:d>=0?(i.push(c),l.slice(0,d)+xp+l.slice(d)+Oi+u):l+Oi+(d===-2?a:u)}return[Sp(s,r+(s[t]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),i]};let Tl=class Ap{constructor({strings:e,_$litType$:t},i){let n;this.parts=[];let r=0,o=0;const a=e.length-1,l=this.parts,[c,h]=T_(e,t);if(this.el=Ap.createElement(c,i),as.currentNode=this.el.content,t===2||t===3){const d=this.el.content.firstChild;d.replaceWith(...d.childNodes)}for(;(n=as.nextNode())!==null&&l.length<a;){if(n.nodeType===1){if(n.hasAttributes())for(const d of n.getAttributeNames())if(d.endsWith(xp)){const p=h[o++],u=n.getAttribute(d).split(Oi),g=/([.?@])?(.*)/.exec(p);l.push({type:1,index:r,name:g[2],strings:u,ctor:g[1]==="."?P_:g[1]==="?"?O_:g[1]==="@"?M_:ta}),n.removeAttribute(d)}else d.startsWith(Oi)&&(l.push({type:6,index:r}),n.removeAttribute(d));if(Ep.test(n.tagName)){const d=n.textContent.split(Oi),p=d.length-1;if(p>0){n.textContent=To?To.emptyScript:"";for(let u=0;u<p;u++)n.append(d[u],rr()),as.nextNode(),l.push({type:2,index:++r});n.append(d[p],rr())}}}else if(n.nodeType===8)if(n.data===Cp)l.push({type:2,index:r});else{let d=-1;for(;(d=n.data.indexOf(Oi,d+1))!==-1;)l.push({type:7,index:r}),d+=Oi.length-1}r++}}static createElement(e,t){const i=ps.createElement("template");return i.innerHTML=e,i}};function Qs(s,e,t=s,i){var n,r;if(e===Xs)return e;let o=i!==void 0?(n=t._$Co)==null?void 0:n[i]:t._$Cl;const a=or(e)?void 0:e._$litDirective$;return(o==null?void 0:o.constructor)!==a&&((r=o==null?void 0:o._$AO)==null||r.call(o,!1),a===void 0?o=void 0:(o=new a(s),o._$AT(s,t,i)),i!==void 0?(t._$Co??(t._$Co=[]))[i]=o:t._$Cl=o),o!==void 0&&(e=Qs(s,o._$AS(s,e.values),o,i)),e}class k_{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:i}=this._$AD,n=((e==null?void 0:e.creationScope)??ps).importNode(t,!0);as.currentNode=n;let r=as.nextNode(),o=0,a=0,l=i[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new vc(r,r.nextSibling,this,e):l.type===1?c=new l.ctor(r,l.name,l.strings,this,e):l.type===6&&(c=new I_(r,this,e)),this._$AV.push(c),l=i[++a]}o!==(l==null?void 0:l.index)&&(r=as.nextNode(),o++)}return as.currentNode=ps,n}p(e){let t=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}}let vc=class $p{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this._$Cv}constructor(e,t,i,n){this.type=2,this._$AH=qe,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=n,this._$Cv=(n==null?void 0:n.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Qs(this,e,t),or(e)?e===qe||e==null||e===""?(this._$AH!==qe&&this._$AR(),this._$AH=qe):e!==this._$AH&&e!==Xs&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):A_(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==qe&&or(this._$AH)?this._$AA.nextSibling.data=e:this.T(ps.createTextNode(e)),this._$AH=e}$(e){var t;const{values:i,_$litType$:n}=e,r=typeof n=="number"?this._$AC(e):(n.el===void 0&&(n.el=Tl.createElement(Sp(n.h,n.h[0]),this.options)),n);if(((t=this._$AH)==null?void 0:t._$AD)===r)this._$AH.p(i);else{const o=new k_(r,this),a=o.u(this.options);o.p(i),this.T(a),this._$AH=o}}_$AC(e){let t=td.get(e.strings);return t===void 0&&td.set(e.strings,t=new Tl(e)),t}k(e){bc(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let i,n=0;for(const r of e)n===t.length?t.push(i=new $p(this.O(rr()),this.O(rr()),this,this.options)):i=t[n],i._$AI(r),n++;n<t.length&&(this._$AR(i&&i._$AB.nextSibling,n),t.length=n)}_$AR(e=this._$AA.nextSibling,t){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,t);e&&e!==this._$AB;){const n=e.nextSibling;e.remove(),e=n}}setConnected(e){var t;this._$AM===void 0&&(this._$Cv=e,(t=this._$AP)==null||t.call(this,e))}};class ta{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,i,n,r){this.type=1,this._$AH=qe,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=r,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=qe}_$AI(e,t=this,i,n){const r=this.strings;let o=!1;if(r===void 0)e=Qs(this,e,t,0),o=!or(e)||e!==this._$AH&&e!==Xs,o&&(this._$AH=e);else{const a=e;let l,c;for(e=r[0],l=0;l<r.length-1;l++)c=Qs(this,a[i+l],t,l),c===Xs&&(c=this._$AH[l]),o||(o=!or(c)||c!==this._$AH[l]),c===qe?e=qe:e!==qe&&(e+=(c??"")+r[l+1]),this._$AH[l]=c}o&&!n&&this.j(e)}j(e){e===qe?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}let P_=class extends ta{constructor(){super(...arguments),this.type=3}j(s){this.element[this.name]=s===qe?void 0:s}};class O_ extends ta{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==qe)}}let M_=class extends ta{constructor(s,e,t,i,n){super(s,e,t,i,n),this.type=5}_$AI(s,e=this){if((s=Qs(this,s,e,0)??qe)===Xs)return;const t=this._$AH,i=s===qe&&t!==qe||s.capture!==t.capture||s.once!==t.once||s.passive!==t.passive,n=s!==qe&&(t===qe||i);i&&this.element.removeEventListener(this.name,this,t),n&&this.element.addEventListener(this.name,this,s),this._$AH=s}handleEvent(s){var e;typeof this._$AH=="function"?this._$AH.call(((e=this.options)==null?void 0:e.host)??this.element,s):this._$AH.handleEvent(s)}},I_=class{constructor(s,e,t){this.element=s,this.type=6,this._$AN=void 0,this._$AM=e,this.options=t}get _$AU(){return this._$AM._$AU}_$AI(s){Qs(this,s)}};const id=$o.litHtmlPolyfillSupport;id==null||id(Tl,vc),($o.litHtmlVersions??($o.litHtmlVersions=[])).push("3.3.0");const z_=(s,e,t)=>{const i=(t==null?void 0:t.renderBefore)??e;let n=i._$litPart$;if(n===void 0){const r=(t==null?void 0:t.renderBefore)??null;i._$litPart$=n=new vc(e.insertBefore(rr(),r),r,void 0,t??{})}return n._$AI(s),n};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ar=globalThis;let ds=class extends Ns{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var s;const e=super.createRenderRoot();return(s=this.renderOptions).renderBefore??(s.renderBefore=e.firstChild),e}update(s){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(s),this._$Do=z_(e,this.renderRoot,this.renderOptions)}connectedCallback(){var s;super.connectedCallback(),(s=this._$Do)==null||s.setConnected(!0)}disconnectedCallback(){var s;super.disconnectedCallback(),(s=this._$Do)==null||s.setConnected(!1)}render(){return Xs}};var sd;ds._$litElement$=!0,ds.finalized=!0,(sd=ar.litElementHydrateSupport)==null||sd.call(ar,{LitElement:ds});const nd=ar.litElementPolyfillSupport;nd==null||nd({LitElement:ds});(ar.litElementVersions??(ar.litElementVersions=[])).push("4.2.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const D_={attribute:!0,type:String,converter:Ao,reflect:!1,hasChanged:gc},L_=(s=D_,e,t)=>{const{kind:i,metadata:n}=t;let r=globalThis.litPropertyMetadata.get(n);if(r===void 0&&globalThis.litPropertyMetadata.set(n,r=new Map),i==="setter"&&((s=Object.create(s)).wrapped=!0),r.set(t.name,s),i==="accessor"){const{name:o}=t;return{set(a){const l=e.get.call(this);e.set.call(this,a),this.requestUpdate(o,l,s)},init(a){return a!==void 0&&this.C(o,void 0,s,a),a}}}if(i==="setter"){const{name:o}=t;return function(a){const l=this[o];e.call(this,a),this.requestUpdate(o,l,s)}}throw Error("Unsupported decorator location: "+i)};function bt(s){return(e,t)=>typeof t=="object"?L_(s,e,t):((i,n,r)=>{const o=n.hasOwnProperty(r);return n.constructor.createProperty(r,i),o?Object.getOwnPropertyDescriptor(n,r):void 0})(s,e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function B_(s){return bt({...s,state:!0,attribute:!1})}class N_ extends Ys{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Ne(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof t.element.ownerDocument.defaultView.Element&&t.element.parentNode!==null&&t.element.remove()})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}new D;new xe;new xe;new D;new D;class R_{constructor(e,t){this._group=new Ni,this._frustum=new Yl,this._frustumMat=new xe,this._regenerateDelay=200,this._regenerateCounter=0,this.material=new Gl({color:"#2e3338"}),this.numbers=new Ni,this.maxRegenerateRetrys=4,this.gridsFactor=5,this._scaleX=1,this._scaleY=1,this._offsetX=0,this._offsetY=0,this._camera=e,this._container=t;const i=this.newGrid(-1),n=this.newGrid(-2);this.grids={main:i,secondary:n},this._group.add(n,i,this.numbers)}set scaleX(e){this._scaleX=e,this.regenerate()}get scaleX(){return this._scaleX}set scaleY(e){this._scaleY=e,this.regenerate()}get scaleY(){return this._scaleY}set offsetX(e){this._offsetX=e,this.regenerate()}get offsetX(){return this._offsetX}set offsetY(e){this._offsetY=e,this.regenerate()}get offsetY(){return this._offsetY}get(){return this._group}dispose(){const{main:e,secondary:t}=this.grids;e.removeFromParent(),t.removeFromParent(),e.geometry.dispose(),e.material.dispose(),t.geometry.dispose(),t.material.dispose()}regenerate(){if(!this.isGridReady()){if(this._regenerateCounter++,this._regenerateCounter>this.maxRegenerateRetrys)throw new Error("Grid could not be regenerated");setTimeout(()=>this.regenerate,this._regenerateDelay);return}this._regenerateCounter=0,this._camera.updateMatrix(),this._camera.updateMatrixWorld();const e=this._frustumMat.multiplyMatrices(this._camera.projectionMatrix,this._camera.matrixWorldInverse);this._frustum.setFromProjectionMatrix(e);const{planes:t}=this._frustum,i=t[0].constant*-t[0].normal.x,n=t[1].constant*-t[1].normal.x,r=t[2].constant*-t[2].normal.y,o=t[3].constant*-t[3].normal.y,a=Math.abs(i-n),l=Math.abs(o-r),{clientWidth:c,clientHeight:h}=this._container,d=Math.max(c,h),p=Math.max(a,l)/d,u=Math.ceil(Math.log10(a/this.scaleX)),g=Math.ceil(Math.log10(l/this.scaleY)),m=10**(u-2)*this.scaleX,b=10**(g-2)*this.scaleY,f=m*this.gridsFactor,y=b*this.gridsFactor,v=Math.ceil(l/y),w=Math.ceil(a/f),E=Math.ceil(l/b),S=Math.ceil(a/m),$=m*Math.ceil(n/m),M=b*Math.ceil(r/b),k=f*Math.ceil(n/f),z=y*Math.ceil(r/y),j=[...this.numbers.children];for(const pe of j)pe.removeFromParent();this.numbers.children=[];const A=[],P=9*p,_=1e4,L=k+this._offsetX,G=Math.round(Math.abs(L/this.scaleX)*_)/_,V=(w-1)*f,K=Math.round(Math.abs((L+V)/this.scaleX)*_)/_,Y=Math.max(G,K).toString().length*P;let ne=Math.ceil(Y/f)*f;for(let pe=0;pe<w;pe++){let fe=k+pe*f;A.push(fe,o,0,fe,r,0),fe=Math.round(fe*_)/_,ne=Math.round(ne*_)/_;const de=fe%ne;if(!(f<1||y<1)&&Math.abs(de)>.01)continue;const me=this.newNumber((fe+this._offsetX)/this.scaleX),Ee=12*p;me.position.set(fe,r+Ee,0)}for(let pe=0;pe<v;pe++){const fe=z+pe*y;A.push(n,fe,0,i,fe,0);const de=this.newNumber(fe/this.scaleY);let me=12;de.element.textContent&&(me+=4*de.element.textContent.length);const Ee=me*p;de.position.set(n+Ee,fe,0)}const R=[];for(let pe=0;pe<S;pe++){const fe=$+pe*m;R.push(fe,o,0,fe,r,0)}for(let pe=0;pe<E;pe++){const fe=M+pe*b;R.push(n,fe,0,i,fe,0)}const N=new Et(new Float32Array(A),3),oe=new Et(new Float32Array(R),3),{main:ie,secondary:te}=this.grids;ie.geometry.setAttribute("position",N),te.geometry.setAttribute("position",oe)}newNumber(e){const t=document.createElement("bim-label");t.textContent=String(Math.round(e*100)/100);const i=new N_(t);return this.numbers.add(i),i}newGrid(e){const t=new nt,i=new Ho(t,this.material);return i.frustumCulled=!1,i.renderOrder=e,i}isGridReady(){const e=this._camera.projectionMatrix.elements;for(let t=0;t<e.length;t++){const i=e[t];if(Number.isNaN(i))return!1}return!0}}var U_=Object.defineProperty,F_=Object.getOwnPropertyDescriptor,br=(s,e,t,i)=>{for(var n=F_(e,t),r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&U_(e,t,n),n};const Tp=class extends ds{constructor(){super(...arguments),this._grid=null,this._world=null,this.resize=()=>{this._world&&this._grid&&this._grid.regenerate()}}set gridColor(e){if(this._gridColor=e,!(e&&this._grid))return;const t=Number(e.replace("#","0x"));Number.isNaN(t)||this._grid.material.color.setHex(t)}get gridColor(){return this._gridColor}set gridScaleX(e){this._gridScaleX=e,e&&this._grid&&(this._grid.scaleX=e)}get gridScaleX(){return this._gridScaleX}set gridScaleY(e){this._gridScaleY=e,e&&this._grid&&(this._grid.scaleY=e)}get gridScaleY(){return this._gridScaleY}get gridOffsetX(){var e;return((e=this._grid)==null?void 0:e.offsetX)||0}set gridOffsetX(e){this._grid&&(this._grid.offsetX=e)}get gridOffsetY(){var e;return((e=this._grid)==null?void 0:e.offsetY)||0}set gridOffsetY(e){this._grid&&(this._grid.offsetY=e)}set components(e){this.dispose();const t=e.get(qo).create();this._world=t,t.scene=new Kl(e),t.scene.setup(),t.renderer=new Dv(e,this);const i=new su(e);t.camera=i;const n=new R_(i.threeOrtho,this);this._grid=n,t.scene.three.add(n.get()),i.controls.addEventListener("update",()=>n.regenerate()),setTimeout(async()=>{t.camera.updateAspect(),i.set("Plan"),await i.controls.setLookAt(0,0,100,0,0,0),await i.projection.set("Orthographic"),i.controls.dollySpeed=3,i.controls.draggingSmoothTime=.085,i.controls.maxZoom=1e3,i.controls.zoom(4)})}get world(){return this._world}dispose(){var e;(e=this.world)==null||e.dispose(),this._world=null,this._grid=null}connectedCallback(){super.connectedCallback(),new ResizeObserver(this.resize).observe(this)}disconnectedCallback(){super.disconnectedCallback(),this.dispose()}render(){return yc`<slot></slot>`}};Tp.styles=mc`
    :host {
      position: relative;
      display: flex;
      min-width: 0px;
      height: 100%;
      background-color: var(--bim-ui_bg-base);
    }
  `;let cn=Tp;br([bt({type:String,attribute:"grid-color",reflect:!0})],cn.prototype,"gridColor");br([bt({type:Number,attribute:"grid-scale-x",reflect:!0})],cn.prototype,"gridScaleX");br([bt({type:Number,attribute:"grid-scale-y",reflect:!0})],cn.prototype,"gridScaleY");br([bt({type:Number,attribute:"grid-offset-x",reflect:!0})],cn.prototype,"gridOffsetX");br([bt({type:Number,attribute:"grid-offset-y",reflect:!0})],cn.prototype,"gridOffsetY");var j_=Object.defineProperty,Zi=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&j_(e,t,n),n};const kp=class extends ds{constructor(){super(...arguments),this._defaults={size:60},this._cssMatrix3D="",this._matrix=new xe,this._onRightClick=new Event("rightclick"),this._onLeftClick=new Event("leftclick"),this._onTopClick=new Event("topclick"),this._onBottomClick=new Event("bottomclick"),this._onFrontClick=new Event("frontclick"),this._onBackClick=new Event("backclick"),this._camera=null,this._epsilon=e=>Math.abs(e)<1e-10?0:e}set camera(e){this._camera=e,this.updateOrientation()}get camera(){return this._camera}updateOrientation(){if(!this.camera)return;this._matrix.extractRotation(this.camera.matrixWorldInverse);const{elements:e}=this._matrix;this._cssMatrix3D=`matrix3d(
      ${this._epsilon(e[0])},
      ${this._epsilon(-e[1])},
      ${this._epsilon(e[2])},
      ${this._epsilon(e[3])},
      ${this._epsilon(e[4])},
      ${this._epsilon(-e[5])},
      ${this._epsilon(e[6])},
      ${this._epsilon(e[7])},
      ${this._epsilon(e[8])},
      ${this._epsilon(-e[9])},
      ${this._epsilon(e[10])},
      ${this._epsilon(e[11])},
      ${this._epsilon(e[12])},
      ${this._epsilon(-e[13])},
      ${this._epsilon(e[14])},
      ${this._epsilon(e[15])})
    `}render(){const e=this.size??this._defaults.size;return yc`
      <style>
        .face,
        .cube {
          width: ${e}px;
          height: ${e}px;
          transform: translateZ(-300px) ${this._cssMatrix3D};
        }

        .face-right {
          translate: ${e/2}px 0 0;
        }

        .face-left {
          translate: ${-e/2}px 0 0;
        }

        .face-top {
          translate: 0 ${e/2}px 0;
        }

        .face-bottom {
          translate: 0 ${-e/2}px 0;
        }

        .face-front {
          translate: 0 0 ${e/2}px;
        }

        .face-back {
          translate: 0 0 ${-e/2}px;
        }
      </style>
      <div class="parent">
        <div class="cube">
          <div
            class="face x-direction face-right"
            @click=${()=>this.dispatchEvent(this._onRightClick)}
          >
            ${this.rightText}
          </div>
          <div
            class="face x-direction face-left"
            @click=${()=>this.dispatchEvent(this._onLeftClick)}
          >
            ${this.leftText}
          </div>
          <div
            class="face y-direction face-top"
            @click=${()=>this.dispatchEvent(this._onTopClick)}
          >
            ${this.topText}
          </div>
          <div
            class="face y-direction face-bottom"
            @click=${()=>this.dispatchEvent(this._onBottomClick)}
          >
            ${this.bottomText}
          </div>
          <div
            class="face z-direction face-front"
            @click=${()=>this.dispatchEvent(this._onFrontClick)}
          >
            ${this.frontText}
          </div>
          <div
            class="face z-direction face-back"
            @click=${()=>this.dispatchEvent(this._onBackClick)}
          >
            ${this.backText}
          </div>
        </div>
      </div>
    `}};kp.styles=mc`
    :host {
      position: absolute;
      z-index: 999;
      bottom: 1rem;
      right: 1rem;
    }

    .parent {
      perspective: 400px;
    }

    .cube {
      position: relative;
      transform-style: preserve-3d;
    }

    .face {
      position: absolute;
      display: flex;
      justify-content: center;
      user-select: none;
      align-items: center;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
      color: var(--bim-view-cube--c, white);
      font-size: var(--bim-view-cube--fz, --bim-ui_size-2xl);
    }

    .x-direction {
      // background-color: var(--bim-view-cube_x--bgc, #c93830DD);
      background-color: var(--bim-view-cube_x--bgc, #01a6bcde);
    }

    .x-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .y-direction {
      // background-color: var(--bim-view-cube_y--bgc, #54ff19DD);
      background-color: var(--bim-view-cube_y--bgc, #8d0ec8de);
    }

    .y-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .z-direction {
      // background-color: var(--bim-view-cube_z--bgc, #3041c9DD);
      background-color: var(--bim-view-cube_z--bgc, #2718afde);
    }

    .z-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .face-front {
      transform: rotateX(180deg);
    }

    .face-back {
      transform: rotateZ(180deg);
    }

    .face-top {
      transform: rotateX(90deg);
    }

    .face-bottom {
      transform: rotateX(270deg);
    }

    .face-right {
      transform: rotateY(-270deg) rotateX(180deg);
    }

    .face-left {
      transform: rotateY(-90deg) rotateX(180deg);
    }
  `;let xi=kp;Zi([bt({type:Number,reflect:!0})],xi.prototype,"size");Zi([bt({type:String,attribute:"right-text",reflect:!0})],xi.prototype,"rightText");Zi([bt({type:String,attribute:"left-text",reflect:!0})],xi.prototype,"leftText");Zi([bt({type:String,attribute:"top-text",reflect:!0})],xi.prototype,"topText");Zi([bt({type:String,attribute:"bottom-text",reflect:!0})],xi.prototype,"bottomText");Zi([bt({type:String,attribute:"front-text",reflect:!0})],xi.prototype,"frontText");Zi([bt({type:String,attribute:"back-text",reflect:!0})],xi.prototype,"backText");Zi([B_()],xi.prototype,"_cssMatrix3D");/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const H_=s=>s.strings===void 0;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const V_={CHILD:2},q_=s=>(...e)=>({_$litDirective$:s,values:e});class W_{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,i){this._$Ct=e,this._$AM=t,this._$Ci=i}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Gn=(s,e)=>{var t;const i=s._$AN;if(i===void 0)return!1;for(const n of i)(t=n._$AO)==null||t.call(n,e,!1),Gn(n,e);return!0},ko=s=>{let e,t;do{if((e=s._$AM)===void 0)break;t=e._$AN,t.delete(s),s=e}while((t==null?void 0:t.size)===0)},Pp=s=>{for(let e;e=s._$AM;s=e){let t=e._$AN;if(t===void 0)e._$AN=t=new Set;else if(t.has(s))break;t.add(s),G_(e)}};function Y_(s){this._$AN!==void 0?(ko(this),this._$AM=s,Pp(this)):this._$AM=s}function Z_(s,e=!1,t=0){const i=this._$AH,n=this._$AN;if(n!==void 0&&n.size!==0)if(e)if(Array.isArray(i))for(let r=t;r<i.length;r++)Gn(i[r],!1),ko(i[r]);else i!=null&&(Gn(i,!1),ko(i));else Gn(this,s)}const G_=s=>{s.type==V_.CHILD&&(s._$AP??(s._$AP=Z_),s._$AQ??(s._$AQ=Y_))};let X_=class extends W_{constructor(){super(...arguments),this._$AN=void 0}_$AT(s,e,t){super._$AT(s,e,t),Pp(this),this.isConnected=s._$AU}_$AO(s,e=!0){var t,i;s!==this.isConnected&&(this.isConnected=s,s?(t=this.reconnected)==null||t.call(this):(i=this.disconnected)==null||i.call(this)),e&&(Gn(this,s),ko(this))}setValue(s){if(H_(this._$Ct))this._$Ct._$AI(s,this);else{const e=[...this._$Ct._$AH];e[this._$Ci]=s,this._$Ct._$AI(e,this,0)}}disconnected(){}reconnected(){}};/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const kl=()=>new Q_;class Q_{}const qa=new WeakMap,K_=q_(class extends X_{render(s){return qe}update(s,[e]){var t;const i=e!==this.G;return i&&this.G!==void 0&&this.rt(void 0),(i||this.lt!==this.ct)&&(this.G=e,this.ht=(t=s.options)==null?void 0:t.host,this.rt(this.ct=s.element)),qe}rt(s){if(this.isConnected||(s=void 0),typeof this.G=="function"){const e=this.ht??globalThis;let t=qa.get(e);t===void 0&&(t=new WeakMap,qa.set(e,t)),t.get(this.G)!==void 0&&this.G.call(this.ht,void 0),t.set(this.G,s),s!==void 0&&this.G.call(this.ht,s)}else this.G.value=s}get lt(){var s,e;return typeof this.G=="function"?(s=qa.get(this.ht??globalThis))==null?void 0:s.get(this.G):(e=this.G)==null?void 0:e.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});var J_=Object.defineProperty,e0=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&J_(e,t,n),n};const Op=class extends ds{constructor(){super(...arguments),this.world=null,this._components=null,this._viewport=kl()}set components(e){var t;if(this._components=e,this.components){const i=this.components.get(qo);this.world=i.create(),this.world.name=this.name}else(t=this.world)==null||t.dispose(),this.world=null}get components(){return this._components}connectedCallback(){super.connectedCallback(),this.world&&(this.world.enabled=!0)}disconnectedCallback(){super.disconnectedCallback(),this.world&&(this.world.enabled=!1)}dispose(){this.components=null,this.remove()}firstUpdated(){const{value:e}=this._viewport;if(!(this.components&&e&&this.world))return;const t=new Kl(this.components);this.world.scene=t,t.setup(),t.three.background=null;const i=new lg(this.components,e);this.world.renderer=i;const n=new su(this.components);this.world.camera=n;const r=this.components.get(nu).create(this.world);r.material.uniforms.uColor.value=new be(4342338),r.material.uniforms.uSize1.value=2,r.material.uniforms.uSize2.value=8}onSlotChange(){const e=new Event("slotchange");this.dispatchEvent(e)}render(){return yc` <bim-viewport ${K_(this._viewport)}>
      <slot @slotchange=${this.onSlotChange}></slot>
    </bim-viewport>`}};Op.styles=mc``;let Mp=Op;e0([bt({type:String,reflect:!0})],Mp.prototype,"name");var t0=Object.defineProperty,i0=(s,e,t)=>e in s?t0(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ss=(s,e,t)=>(i0(s,typeof e!="symbol"?e+"":e,t),t);const Ks=Math.min,fi=Math.max,Po=Math.round,Vi=s=>({x:s,y:s}),s0={left:"right",right:"left",bottom:"top",top:"bottom"},n0={start:"end",end:"start"};function rd(s,e,t){return fi(s,Ks(e,t))}function yr(s,e){return typeof s=="function"?s(e):s}function yi(s){return s.split("-")[0]}function ia(s){return s.split("-")[1]}function Ip(s){return s==="x"?"y":"x"}function zp(s){return s==="y"?"height":"width"}const r0=new Set(["top","bottom"]);function pi(s){return r0.has(yi(s))?"y":"x"}function Dp(s){return Ip(pi(s))}function o0(s,e,t){t===void 0&&(t=!1);const i=ia(s),n=Dp(s),r=zp(n);let o=n==="x"?i===(t?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[r]>e.floating[r]&&(o=Oo(o)),[o,Oo(o)]}function a0(s){const e=Oo(s);return[Pl(s),e,Pl(e)]}function Pl(s){return s.replace(/start|end/g,e=>n0[e])}const od=["left","right"],ad=["right","left"],l0=["top","bottom"],c0=["bottom","top"];function h0(s,e,t){switch(s){case"top":case"bottom":return t?e?ad:od:e?od:ad;case"left":case"right":return e?l0:c0;default:return[]}}function d0(s,e,t,i){const n=ia(s);let r=h0(yi(s),t==="start",i);return n&&(r=r.map(o=>o+"-"+n),e&&(r=r.concat(r.map(Pl)))),r}function Oo(s){return s.replace(/left|right|bottom|top/g,e=>s0[e])}function u0(s){return{top:0,right:0,bottom:0,left:0,...s}}function Lp(s){return typeof s!="number"?u0(s):{top:s,right:s,bottom:s,left:s}}function Js(s){const{x:e,y:t,width:i,height:n}=s;return{width:i,height:n,top:t,left:e,right:e+i,bottom:t+n,x:e,y:t}}function ld(s,e,t){let{reference:i,floating:n}=s;const r=pi(e),o=Dp(e),a=zp(o),l=yi(e),c=r==="y",h=i.x+i.width/2-n.width/2,d=i.y+i.height/2-n.height/2,p=i[a]/2-n[a]/2;let u;switch(l){case"top":u={x:h,y:i.y-n.height};break;case"bottom":u={x:h,y:i.y+i.height};break;case"right":u={x:i.x+i.width,y:d};break;case"left":u={x:i.x-n.width,y:d};break;default:u={x:i.x,y:i.y}}switch(ia(e)){case"start":u[o]-=p*(t&&c?-1:1);break;case"end":u[o]+=p*(t&&c?-1:1);break}return u}const p0=async(s,e,t)=>{const{placement:i="bottom",strategy:n="absolute",middleware:r=[],platform:o}=t,a=r.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:s,floating:e,strategy:n}),{x:h,y:d}=ld(c,i,l),p=i,u={},g=0;for(let m=0;m<a.length;m++){const{name:b,fn:f}=a[m],{x:y,y:v,data:w,reset:E}=await f({x:h,y:d,initialPlacement:i,placement:p,strategy:n,middlewareData:u,rects:c,platform:o,elements:{reference:s,floating:e}});h=y??h,d=v??d,u={...u,[b]:{...u[b],...w}},E&&g<=50&&(g++,typeof E=="object"&&(E.placement&&(p=E.placement),E.rects&&(c=E.rects===!0?await o.getElementRects({reference:s,floating:e,strategy:n}):E.rects),{x:h,y:d}=ld(c,p,l)),m=-1)}return{x:h,y:d,placement:p,strategy:n,middlewareData:u}};async function Bp(s,e){var t;e===void 0&&(e={});const{x:i,y:n,platform:r,rects:o,elements:a,strategy:l}=s,{boundary:c="clippingAncestors",rootBoundary:h="viewport",elementContext:d="floating",altBoundary:p=!1,padding:u=0}=yr(e,s),g=Lp(u),m=a[p?d==="floating"?"reference":"floating":d],b=Js(await r.getClippingRect({element:(t=await(r.isElement==null?void 0:r.isElement(m)))==null||t?m:m.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(a.floating)),boundary:c,rootBoundary:h,strategy:l})),f=d==="floating"?{x:i,y:n,width:o.floating.width,height:o.floating.height}:o.reference,y=await(r.getOffsetParent==null?void 0:r.getOffsetParent(a.floating)),v=await(r.isElement==null?void 0:r.isElement(y))?await(r.getScale==null?void 0:r.getScale(y))||{x:1,y:1}:{x:1,y:1},w=Js(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:f,offsetParent:y,strategy:l}):f);return{top:(b.top-w.top+g.top)/v.y,bottom:(w.bottom-b.bottom+g.bottom)/v.y,left:(b.left-w.left+g.left)/v.x,right:(w.right-b.right+g.right)/v.x}}const f0=function(s){return s===void 0&&(s={}),{name:"flip",options:s,async fn(e){var t,i;const{placement:n,middlewareData:r,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:h=!0,crossAxis:d=!0,fallbackPlacements:p,fallbackStrategy:u="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:m=!0,...b}=yr(s,e);if((t=r.arrow)!=null&&t.alignmentOffset)return{};const f=yi(n),y=pi(a),v=yi(a)===a,w=await(l.isRTL==null?void 0:l.isRTL(c.floating)),E=p||(v||!m?[Oo(a)]:a0(a)),S=g!=="none";!p&&S&&E.push(...d0(a,m,g,w));const $=[a,...E],M=await Bp(e,b),k=[];let z=((i=r.flip)==null?void 0:i.overflows)||[];if(h&&k.push(M[f]),d){const _=o0(n,o,w);k.push(M[_[0]],M[_[1]])}if(z=[...z,{placement:n,overflows:k}],!k.every(_=>_<=0)){var j,A;const _=(((j=r.flip)==null?void 0:j.index)||0)+1,L=$[_];if(L&&(!(d==="alignment"&&y!==pi(L))||z.every(V=>V.overflows[0]>0&&pi(V.placement)===y)))return{data:{index:_,overflows:z},reset:{placement:L}};let G=(A=z.filter(V=>V.overflows[0]<=0).sort((V,K)=>V.overflows[1]-K.overflows[1])[0])==null?void 0:A.placement;if(!G)switch(u){case"bestFit":{var P;const V=(P=z.filter(K=>{if(S){const Y=pi(K.placement);return Y===y||Y==="y"}return!0}).map(K=>[K.placement,K.overflows.filter(Y=>Y>0).reduce((Y,ne)=>Y+ne,0)]).sort((K,Y)=>K[1]-Y[1])[0])==null?void 0:P[0];V&&(G=V);break}case"initialPlacement":G=a;break}if(n!==G)return{reset:{placement:G}}}return{}}}};function Np(s){const e=Ks(...s.map(r=>r.left)),t=Ks(...s.map(r=>r.top)),i=fi(...s.map(r=>r.right)),n=fi(...s.map(r=>r.bottom));return{x:e,y:t,width:i-e,height:n-t}}function m0(s){const e=s.slice().sort((n,r)=>n.y-r.y),t=[];let i=null;for(let n=0;n<e.length;n++){const r=e[n];!i||r.y-i.y>i.height/2?t.push([r]):t[t.length-1].push(r),i=r}return t.map(n=>Js(Np(n)))}const g0=function(s){return s===void 0&&(s={}),{name:"inline",options:s,async fn(e){const{placement:t,elements:i,rects:n,platform:r,strategy:o}=e,{padding:a=2,x:l,y:c}=yr(s,e),h=Array.from(await(r.getClientRects==null?void 0:r.getClientRects(i.reference))||[]),d=m0(h),p=Js(Np(h)),u=Lp(a);function g(){if(d.length===2&&d[0].left>d[1].right&&l!=null&&c!=null)return d.find(b=>l>b.left-u.left&&l<b.right+u.right&&c>b.top-u.top&&c<b.bottom+u.bottom)||p;if(d.length>=2){if(pi(t)==="y"){const z=d[0],j=d[d.length-1],A=yi(t)==="top",P=z.top,_=j.bottom,L=A?z.left:j.left,G=A?z.right:j.right,V=G-L,K=_-P;return{top:P,bottom:_,left:L,right:G,width:V,height:K,x:L,y:P}}const b=yi(t)==="left",f=fi(...d.map(z=>z.right)),y=Ks(...d.map(z=>z.left)),v=d.filter(z=>b?z.left===y:z.right===f),w=v[0].top,E=v[v.length-1].bottom,S=y,$=f,M=$-S,k=E-w;return{top:w,bottom:E,left:S,right:$,width:M,height:k,x:S,y:w}}return p}const m=await r.getElementRects({reference:{getBoundingClientRect:g},floating:i.floating,strategy:o});return n.reference.x!==m.reference.x||n.reference.y!==m.reference.y||n.reference.width!==m.reference.width||n.reference.height!==m.reference.height?{reset:{rects:m}}:{}}}},b0=new Set(["left","top"]);async function y0(s,e){const{placement:t,platform:i,elements:n}=s,r=await(i.isRTL==null?void 0:i.isRTL(n.floating)),o=yi(t),a=ia(t),l=pi(t)==="y",c=b0.has(o)?-1:1,h=r&&l?-1:1,d=yr(e,s);let{mainAxis:p,crossAxis:u,alignmentAxis:g}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof g=="number"&&(u=a==="end"?g*-1:g),l?{x:u*h,y:p*c}:{x:p*c,y:u*h}}const Rp=function(s){return{name:"offset",options:s,async fn(e){var t,i;const{x:n,y:r,placement:o,middlewareData:a}=e,l=await y0(e,s);return o===((t=a.offset)==null?void 0:t.placement)&&(i=a.arrow)!=null&&i.alignmentOffset?{}:{x:n+l.x,y:r+l.y,data:{...l,placement:o}}}}},v0=function(s){return s===void 0&&(s={}),{name:"shift",options:s,async fn(e){const{x:t,y:i,placement:n}=e,{mainAxis:r=!0,crossAxis:o=!1,limiter:a={fn:b=>{let{x:f,y}=b;return{x:f,y}}},...l}=yr(s,e),c={x:t,y:i},h=await Bp(e,l),d=pi(yi(n)),p=Ip(d);let u=c[p],g=c[d];if(r){const b=p==="y"?"top":"left",f=p==="y"?"bottom":"right",y=u+h[b],v=u-h[f];u=rd(y,u,v)}if(o){const b=d==="y"?"top":"left",f=d==="y"?"bottom":"right",y=g+h[b],v=g-h[f];g=rd(y,g,v)}const m=a.fn({...e,[p]:u,[d]:g});return{...m,data:{x:m.x-t,y:m.y-i,enabled:{[p]:r,[d]:o}}}}}};function sa(){return typeof window<"u"}function qi(s){return Up(s)?(s.nodeName||"").toLowerCase():"#document"}function At(s){var e;return(s==null||(e=s.ownerDocument)==null?void 0:e.defaultView)||window}function Gi(s){var e;return(e=(Up(s)?s.ownerDocument:s.document)||window.document)==null?void 0:e.documentElement}function Up(s){return sa()?s instanceof Node||s instanceof At(s).Node:!1}function ai(s){return sa()?s instanceof Element||s instanceof At(s).Element:!1}function li(s){return sa()?s instanceof HTMLElement||s instanceof At(s).HTMLElement:!1}function cd(s){return!sa()||typeof ShadowRoot>"u"?!1:s instanceof ShadowRoot||s instanceof At(s).ShadowRoot}const _0=new Set(["inline","contents"]);function vr(s){const{overflow:e,overflowX:t,overflowY:i,display:n}=Bt(s);return/auto|scroll|overlay|hidden|clip/.test(e+i+t)&&!_0.has(n)}const w0=new Set(["table","td","th"]);function x0(s){return w0.has(qi(s))}const C0=[":popover-open",":modal"];function E0(s){return C0.some(e=>{try{return s.matches(e)}catch{return!1}})}const S0=["transform","translate","scale","rotate","perspective"],A0=["transform","translate","scale","rotate","perspective","filter"],$0=["paint","layout","strict","content"];function _c(s){const e=wc(),t=ai(s)?Bt(s):s;return S0.some(i=>t[i]?t[i]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||A0.some(i=>(t.willChange||"").includes(i))||$0.some(i=>(t.contain||"").includes(i))}function T0(s){let e=en(s);for(;li(e)&&!na(e);){if(_c(e))return e;if(E0(e))return null;e=en(e)}return null}function wc(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const k0=new Set(["html","body","#document"]);function na(s){return k0.has(qi(s))}function Bt(s){return At(s).getComputedStyle(s)}function ra(s){return ai(s)?{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}:{scrollLeft:s.scrollX,scrollTop:s.scrollY}}function en(s){if(qi(s)==="html")return s;const e=s.assignedSlot||s.parentNode||cd(s)&&s.host||Gi(s);return cd(e)?e.host:e}function Fp(s){const e=en(s);return na(e)?s.ownerDocument?s.ownerDocument.body:s.body:li(e)&&vr(e)?e:Fp(e)}function jp(s,e,t){var i;e===void 0&&(e=[]);const n=Fp(s),r=n===((i=s.ownerDocument)==null?void 0:i.body),o=At(n);return r?(P0(o),e.concat(o,o.visualViewport||[],vr(n)?n:[],[])):e.concat(n,jp(n,[]))}function P0(s){return s.parent&&Object.getPrototypeOf(s.parent)?s.frameElement:null}function Hp(s){const e=Bt(s);let t=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const n=li(s),r=n?s.offsetWidth:t,o=n?s.offsetHeight:i,a=Po(t)!==r||Po(i)!==o;return a&&(t=r,i=o),{width:t,height:i,$:a}}function Vp(s){return ai(s)?s:s.contextElement}function Hs(s){const e=Vp(s);if(!li(e))return Vi(1);const t=e.getBoundingClientRect(),{width:i,height:n,$:r}=Hp(e);let o=(r?Po(t.width):t.width)/i,a=(r?Po(t.height):t.height)/n;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const O0=Vi(0);function qp(s){const e=At(s);return!wc()||!e.visualViewport?O0:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function M0(s,e,t){return e===void 0&&(e=!1),!t||e&&t!==At(s)?!1:e}function lr(s,e,t,i){e===void 0&&(e=!1),t===void 0&&(t=!1);const n=s.getBoundingClientRect(),r=Vp(s);let o=Vi(1);e&&(i?ai(i)&&(o=Hs(i)):o=Hs(s));const a=M0(r,t,i)?qp(r):Vi(0);let l=(n.left+a.x)/o.x,c=(n.top+a.y)/o.y,h=n.width/o.x,d=n.height/o.y;if(r){const p=At(r),u=i&&ai(i)?At(i):i;let g=p,m=g.frameElement;for(;m&&i&&u!==g;){const b=Hs(m),f=m.getBoundingClientRect(),y=Bt(m),v=f.left+(m.clientLeft+parseFloat(y.paddingLeft))*b.x,w=f.top+(m.clientTop+parseFloat(y.paddingTop))*b.y;l*=b.x,c*=b.y,h*=b.x,d*=b.y,l+=v,c+=w,g=At(m),m=g.frameElement}}return Js({width:h,height:d,x:l,y:c})}const I0=[":popover-open",":modal"];function Wp(s){return I0.some(e=>{try{return s.matches(e)}catch{return!1}})}function z0(s){let{elements:e,rect:t,offsetParent:i,strategy:n}=s;const r=n==="fixed",o=Gi(i),a=e?Wp(e.floating):!1;if(i===o||a&&r)return t;let l={scrollLeft:0,scrollTop:0},c=Vi(1);const h=Vi(0),d=li(i);if((d||!d&&!r)&&((qi(i)!=="body"||vr(o))&&(l=ra(i)),li(i))){const p=lr(i);c=Hs(i),h.x=p.x+i.clientLeft,h.y=p.y+i.clientTop}return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+h.x,y:t.y*c.y-l.scrollTop*c.y+h.y}}function D0(s){return Array.from(s.getClientRects())}function Yp(s){return lr(Gi(s)).left+ra(s).scrollLeft}function L0(s){const e=Gi(s),t=ra(s),i=s.ownerDocument.body,n=fi(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),r=fi(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let o=-t.scrollLeft+Yp(s);const a=-t.scrollTop;return Bt(i).direction==="rtl"&&(o+=fi(e.clientWidth,i.clientWidth)-n),{width:n,height:r,x:o,y:a}}function B0(s,e){const t=At(s),i=Gi(s),n=t.visualViewport;let r=i.clientWidth,o=i.clientHeight,a=0,l=0;if(n){r=n.width,o=n.height;const c=wc();(!c||c&&e==="fixed")&&(a=n.offsetLeft,l=n.offsetTop)}return{width:r,height:o,x:a,y:l}}function N0(s,e){const t=lr(s,!0,e==="fixed"),i=t.top+s.clientTop,n=t.left+s.clientLeft,r=li(s)?Hs(s):Vi(1),o=s.clientWidth*r.x,a=s.clientHeight*r.y,l=n*r.x,c=i*r.y;return{width:o,height:a,x:l,y:c}}function hd(s,e,t){let i;if(e==="viewport")i=B0(s,t);else if(e==="document")i=L0(Gi(s));else if(ai(e))i=N0(e,t);else{const n=qp(s);i={...e,x:e.x-n.x,y:e.y-n.y}}return Js(i)}function Zp(s,e){const t=en(s);return t===e||!ai(t)||na(t)?!1:Bt(t).position==="fixed"||Zp(t,e)}function R0(s,e){const t=e.get(s);if(t)return t;let i=jp(s,[]).filter(a=>ai(a)&&qi(a)!=="body"),n=null;const r=Bt(s).position==="fixed";let o=r?en(s):s;for(;ai(o)&&!na(o);){const a=Bt(o),l=_c(o);!l&&a.position==="fixed"&&(n=null),(r?!l&&!n:!l&&a.position==="static"&&n&&["absolute","fixed"].includes(n.position)||vr(o)&&!l&&Zp(s,o))?i=i.filter(c=>c!==o):n=a,o=en(o)}return e.set(s,i),i}function U0(s){let{element:e,boundary:t,rootBoundary:i,strategy:n}=s;const r=[...t==="clippingAncestors"?R0(e,this._c):[].concat(t),i],o=r[0],a=r.reduce((l,c)=>{const h=hd(e,c,n);return l.top=fi(h.top,l.top),l.right=Ks(h.right,l.right),l.bottom=Ks(h.bottom,l.bottom),l.left=fi(h.left,l.left),l},hd(e,o,n));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function F0(s){const{width:e,height:t}=Hp(s);return{width:e,height:t}}function j0(s,e,t){const i=li(e),n=Gi(e),r=t==="fixed",o=lr(s,!0,r,e);let a={scrollLeft:0,scrollTop:0};const l=Vi(0);if(i||!i&&!r)if((qi(e)!=="body"||vr(n))&&(a=ra(e)),i){const d=lr(e,!0,r,e);l.x=d.x+e.clientLeft,l.y=d.y+e.clientTop}else n&&(l.x=Yp(n));const c=o.left+a.scrollLeft-l.x,h=o.top+a.scrollTop-l.y;return{x:c,y:h,width:o.width,height:o.height}}function dd(s,e){return!li(s)||Bt(s).position==="fixed"?null:e?e(s):s.offsetParent}function Gp(s,e){const t=At(s);if(!li(s)||Wp(s))return t;let i=dd(s,e);for(;i&&x0(i)&&Bt(i).position==="static";)i=dd(i,e);return i&&(qi(i)==="html"||qi(i)==="body"&&Bt(i).position==="static"&&!_c(i))?t:i||T0(s)||t}const H0=async function(s){const e=this.getOffsetParent||Gp,t=this.getDimensions;return{reference:j0(s.reference,await e(s.floating),s.strategy),floating:{x:0,y:0,...await t(s.floating)}}};function V0(s){return Bt(s).direction==="rtl"}const q0={convertOffsetParentRelativeRectToViewportRelativeRect:z0,getDocumentElement:Gi,getClippingRect:U0,getOffsetParent:Gp,getElementRects:H0,getClientRects:D0,getDimensions:F0,getScale:Hs,isElement:ai,isRTL:V0},Xp=v0,Qp=f0,Kp=g0,Jp=(s,e,t)=>{const i=new Map,n={platform:q0,...t},r={...n.platform,_c:i};return p0(s,e,{...n,platform:r})};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const bo=globalThis,xc=bo.ShadowRoot&&(bo.ShadyCSS===void 0||bo.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Cc=Symbol(),ud=new WeakMap;let ef=class{constructor(s,e,t){if(this._$cssResult$=!0,t!==Cc)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=s,this.t=e}get styleSheet(){let s=this.o;const e=this.t;if(xc&&s===void 0){const t=e!==void 0&&e.length===1;t&&(s=ud.get(e)),s===void 0&&((this.o=s=new CSSStyleSheet).replaceSync(this.cssText),t&&ud.set(e,s))}return s}toString(){return this.cssText}};const W0=s=>new ef(typeof s=="string"?s:s+"",void 0,Cc),$e=(s,...e)=>{const t=s.length===1?s[0]:e.reduce((i,n,r)=>i+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+s[r+1],s[0]);return new ef(t,s,Cc)},Y0=(s,e)=>{if(xc)s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const t of e){const i=document.createElement("style"),n=bo.litNonce;n!==void 0&&i.setAttribute("nonce",n),i.textContent=t.cssText,s.appendChild(i)}},pd=xc?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(const i of e.cssRules)t+=i.cssText;return W0(t)})(s):s;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:Z0,defineProperty:G0,getOwnPropertyDescriptor:X0,getOwnPropertyNames:Q0,getOwnPropertySymbols:K0,getPrototypeOf:J0}=Object,tn=globalThis,fd=tn.trustedTypes,ew=fd?fd.emptyScript:"",md=tn.reactiveElementPolyfillSupport,Xn=(s,e)=>s,Mo={toAttribute(s,e){switch(e){case Boolean:s=s?ew:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch{t=null}}return t}},Ec=(s,e)=>!Z0(s,e),gd={attribute:!0,type:String,converter:Mo,reflect:!1,useDefault:!1,hasChanged:Ec};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),tn.litPropertyMetadata??(tn.litPropertyMetadata=new WeakMap);let Rs=class extends HTMLElement{static addInitializer(s){this._$Ei(),(this.l??(this.l=[])).push(s)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(s,e=gd){if(e.state&&(e.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(s)&&((e=Object.create(e)).wrapped=!0),this.elementProperties.set(s,e),!e.noAccessor){const t=Symbol(),i=this.getPropertyDescriptor(s,t,e);i!==void 0&&G0(this.prototype,s,i)}}static getPropertyDescriptor(s,e,t){const{get:i,set:n}=X0(this.prototype,s)??{get(){return this[e]},set(r){this[e]=r}};return{get:i,set(r){const o=i==null?void 0:i.call(this);n==null||n.call(this,r),this.requestUpdate(s,o,t)},configurable:!0,enumerable:!0}}static getPropertyOptions(s){return this.elementProperties.get(s)??gd}static _$Ei(){if(this.hasOwnProperty(Xn("elementProperties")))return;const s=J0(this);s.finalize(),s.l!==void 0&&(this.l=[...s.l]),this.elementProperties=new Map(s.elementProperties)}static finalize(){if(this.hasOwnProperty(Xn("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Xn("properties"))){const e=this.properties,t=[...Q0(e),...K0(e)];for(const i of t)this.createProperty(i,e[i])}const s=this[Symbol.metadata];if(s!==null){const e=litPropertyMetadata.get(s);if(e!==void 0)for(const[t,i]of e)this.elementProperties.set(t,i)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const i=this._$Eu(e,t);i!==void 0&&this._$Eh.set(i,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(s){const e=[];if(Array.isArray(s)){const t=new Set(s.flat(1/0).reverse());for(const i of t)e.unshift(pd(i))}else s!==void 0&&e.push(pd(s));return e}static _$Eu(s,e){const t=e.attribute;return t===!1?void 0:typeof t=="string"?t:typeof s=="string"?s.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var s;this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),(s=this.constructor.l)==null||s.forEach(e=>e(this))}addController(s){var e;(this._$EO??(this._$EO=new Set)).add(s),this.renderRoot!==void 0&&this.isConnected&&((e=s.hostConnected)==null||e.call(s))}removeController(s){var e;(e=this._$EO)==null||e.delete(s)}_$E_(){const s=new Map,e=this.constructor.elementProperties;for(const t of e.keys())this.hasOwnProperty(t)&&(s.set(t,this[t]),delete this[t]);s.size>0&&(this._$Ep=s)}createRenderRoot(){const s=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return Y0(s,this.constructor.elementStyles),s}connectedCallback(){var s;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(s=this._$EO)==null||s.forEach(e=>{var t;return(t=e.hostConnected)==null?void 0:t.call(e)})}enableUpdating(s){}disconnectedCallback(){var s;(s=this._$EO)==null||s.forEach(e=>{var t;return(t=e.hostDisconnected)==null?void 0:t.call(e)})}attributeChangedCallback(s,e,t){this._$AK(s,t)}_$ET(s,e){var t;const i=this.constructor.elementProperties.get(s),n=this.constructor._$Eu(s,i);if(n!==void 0&&i.reflect===!0){const r=(((t=i.converter)==null?void 0:t.toAttribute)!==void 0?i.converter:Mo).toAttribute(e,i.type);this._$Em=s,r==null?this.removeAttribute(n):this.setAttribute(n,r),this._$Em=null}}_$AK(s,e){var t,i;const n=this.constructor,r=n._$Eh.get(s);if(r!==void 0&&this._$Em!==r){const o=n.getPropertyOptions(r),a=typeof o.converter=="function"?{fromAttribute:o.converter}:((t=o.converter)==null?void 0:t.fromAttribute)!==void 0?o.converter:Mo;this._$Em=r,this[r]=a.fromAttribute(e,o.type)??((i=this._$Ej)==null?void 0:i.get(r))??null,this._$Em=null}}requestUpdate(s,e,t){var i;if(s!==void 0){const n=this.constructor,r=this[s];if(t??(t=n.getPropertyOptions(s)),!((t.hasChanged??Ec)(r,e)||t.useDefault&&t.reflect&&r===((i=this._$Ej)==null?void 0:i.get(s))&&!this.hasAttribute(n._$Eu(s,t))))return;this.C(s,e,t)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(s,e,{useDefault:t,reflect:i,wrapped:n},r){t&&!(this._$Ej??(this._$Ej=new Map)).has(s)&&(this._$Ej.set(s,r??e??this[s]),n!==!0||r!==void 0)||(this._$AL.has(s)||(this.hasUpdated||t||(e=void 0),this._$AL.set(s,e)),i===!0&&this._$Em!==s&&(this._$Eq??(this._$Eq=new Set)).add(s))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const s=this.scheduleUpdate();return s!=null&&await s,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var s;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[n,r]of this._$Ep)this[n]=r;this._$Ep=void 0}const i=this.constructor.elementProperties;if(i.size>0)for(const[n,r]of i){const{wrapped:o}=r,a=this[n];o!==!0||this._$AL.has(n)||a===void 0||this.C(n,void 0,r,a)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),(s=this._$EO)==null||s.forEach(i=>{var n;return(n=i.hostUpdate)==null?void 0:n.call(i)}),this.update(t)):this._$EM()}catch(i){throw e=!1,this._$EM(),i}e&&this._$AE(t)}willUpdate(s){}_$AE(s){var e;(e=this._$EO)==null||e.forEach(t=>{var i;return(i=t.hostUpdated)==null?void 0:i.call(t)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(s)),this.updated(s)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(s){return!0}update(s){this._$Eq&&(this._$Eq=this._$Eq.forEach(e=>this._$ET(e,this[e]))),this._$EM()}updated(s){}firstUpdated(s){}};Rs.elementStyles=[],Rs.shadowRootOptions={mode:"open"},Rs[Xn("elementProperties")]=new Map,Rs[Xn("finalized")]=new Map,md==null||md({ReactiveElement:Rs}),(tn.reactiveElementVersions??(tn.reactiveElementVersions=[])).push("2.1.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Io=globalThis,zo=Io.trustedTypes,bd=zo?zo.createPolicy("lit-html",{createHTML:s=>s}):void 0,tf="$lit$",Mi=`lit$${Math.random().toFixed(9).slice(2)}$`,sf="?"+Mi,tw=`<${sf}>`,fs=document,cr=()=>fs.createComment(""),hr=s=>s===null||typeof s!="object"&&typeof s!="function",Sc=Array.isArray,iw=s=>Sc(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",Wa=`[ 	
\f\r]`,Nn=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,yd=/-->/g,vd=/>/g,ns=RegExp(`>|${Wa}(?:([^\\s"'>=/]+)(${Wa}*=${Wa}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),_d=/'/g,wd=/"/g,nf=/^(?:script|style|textarea|title)$/i,sw=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),H=sw(1),ms=Symbol.for("lit-noChange"),Ie=Symbol.for("lit-nothing"),xd=new WeakMap,ls=fs.createTreeWalker(fs,129);function rf(s,e){if(!Sc(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return bd!==void 0?bd.createHTML(e):e}const nw=(s,e)=>{const t=s.length-1,i=[];let n,r=e===2?"<svg>":e===3?"<math>":"",o=Nn;for(let a=0;a<t;a++){const l=s[a];let c,h,d=-1,p=0;for(;p<l.length&&(o.lastIndex=p,h=o.exec(l),h!==null);)p=o.lastIndex,o===Nn?h[1]==="!--"?o=yd:h[1]!==void 0?o=vd:h[2]!==void 0?(nf.test(h[2])&&(n=RegExp("</"+h[2],"g")),o=ns):h[3]!==void 0&&(o=ns):o===ns?h[0]===">"?(o=n??Nn,d=-1):h[1]===void 0?d=-2:(d=o.lastIndex-h[2].length,c=h[1],o=h[3]===void 0?ns:h[3]==='"'?wd:_d):o===wd||o===_d?o=ns:o===yd||o===vd?o=Nn:(o=ns,n=void 0);const u=o===ns&&s[a+1].startsWith("/>")?" ":"";r+=o===Nn?l+tw:d>=0?(i.push(c),l.slice(0,d)+tf+l.slice(d)+Mi+u):l+Mi+(d===-2?a:u)}return[rf(s,r+(s[t]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),i]};class dr{constructor({strings:e,_$litType$:t},i){let n;this.parts=[];let r=0,o=0;const a=e.length-1,l=this.parts,[c,h]=nw(e,t);if(this.el=dr.createElement(c,i),ls.currentNode=this.el.content,t===2||t===3){const d=this.el.content.firstChild;d.replaceWith(...d.childNodes)}for(;(n=ls.nextNode())!==null&&l.length<a;){if(n.nodeType===1){if(n.hasAttributes())for(const d of n.getAttributeNames())if(d.endsWith(tf)){const p=h[o++],u=n.getAttribute(d).split(Mi),g=/([.?@])?(.*)/.exec(p);l.push({type:1,index:r,name:g[2],strings:u,ctor:g[1]==="."?ow:g[1]==="?"?aw:g[1]==="@"?lw:oa}),n.removeAttribute(d)}else d.startsWith(Mi)&&(l.push({type:6,index:r}),n.removeAttribute(d));if(nf.test(n.tagName)){const d=n.textContent.split(Mi),p=d.length-1;if(p>0){n.textContent=zo?zo.emptyScript:"";for(let u=0;u<p;u++)n.append(d[u],cr()),ls.nextNode(),l.push({type:2,index:++r});n.append(d[p],cr())}}}else if(n.nodeType===8)if(n.data===sf)l.push({type:2,index:r});else{let d=-1;for(;(d=n.data.indexOf(Mi,d+1))!==-1;)l.push({type:7,index:r}),d+=Mi.length-1}r++}}static createElement(e,t){const i=fs.createElement("template");return i.innerHTML=e,i}}function sn(s,e,t=s,i){var n,r;if(e===ms)return e;let o=i!==void 0?(n=t._$Co)==null?void 0:n[i]:t._$Cl;const a=hr(e)?void 0:e._$litDirective$;return(o==null?void 0:o.constructor)!==a&&((r=o==null?void 0:o._$AO)==null||r.call(o,!1),a===void 0?o=void 0:(o=new a(s),o._$AT(s,t,i)),i!==void 0?(t._$Co??(t._$Co=[]))[i]=o:t._$Cl=o),o!==void 0&&(e=sn(s,o._$AS(s,e.values),o,i)),e}class rw{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:i}=this._$AD,n=((e==null?void 0:e.creationScope)??fs).importNode(t,!0);ls.currentNode=n;let r=ls.nextNode(),o=0,a=0,l=i[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new _r(r,r.nextSibling,this,e):l.type===1?c=new l.ctor(r,l.name,l.strings,this,e):l.type===6&&(c=new cw(r,this,e)),this._$AV.push(c),l=i[++a]}o!==(l==null?void 0:l.index)&&(r=ls.nextNode(),o++)}return ls.currentNode=fs,n}p(e){let t=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}}class _r{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this._$Cv}constructor(e,t,i,n){this.type=2,this._$AH=Ie,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=n,this._$Cv=(n==null?void 0:n.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=sn(this,e,t),hr(e)?e===Ie||e==null||e===""?(this._$AH!==Ie&&this._$AR(),this._$AH=Ie):e!==this._$AH&&e!==ms&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):iw(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Ie&&hr(this._$AH)?this._$AA.nextSibling.data=e:this.T(fs.createTextNode(e)),this._$AH=e}$(e){var t;const{values:i,_$litType$:n}=e,r=typeof n=="number"?this._$AC(e):(n.el===void 0&&(n.el=dr.createElement(rf(n.h,n.h[0]),this.options)),n);if(((t=this._$AH)==null?void 0:t._$AD)===r)this._$AH.p(i);else{const o=new rw(r,this),a=o.u(this.options);o.p(i),this.T(a),this._$AH=o}}_$AC(e){let t=xd.get(e.strings);return t===void 0&&xd.set(e.strings,t=new dr(e)),t}k(e){Sc(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let i,n=0;for(const r of e)n===t.length?t.push(i=new _r(this.O(cr()),this.O(cr()),this,this.options)):i=t[n],i._$AI(r),n++;n<t.length&&(this._$AR(i&&i._$AB.nextSibling,n),t.length=n)}_$AR(e=this._$AA.nextSibling,t){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,t);e&&e!==this._$AB;){const n=e.nextSibling;e.remove(),e=n}}setConnected(e){var t;this._$AM===void 0&&(this._$Cv=e,(t=this._$AP)==null||t.call(this,e))}}class oa{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,i,n,r){this.type=1,this._$AH=Ie,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=r,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=Ie}_$AI(e,t=this,i,n){const r=this.strings;let o=!1;if(r===void 0)e=sn(this,e,t,0),o=!hr(e)||e!==this._$AH&&e!==ms,o&&(this._$AH=e);else{const a=e;let l,c;for(e=r[0],l=0;l<r.length-1;l++)c=sn(this,a[i+l],t,l),c===ms&&(c=this._$AH[l]),o||(o=!hr(c)||c!==this._$AH[l]),c===Ie?e=Ie:e!==Ie&&(e+=(c??"")+r[l+1]),this._$AH[l]=c}o&&!n&&this.j(e)}j(e){e===Ie?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class ow extends oa{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Ie?void 0:e}}class aw extends oa{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Ie)}}class lw extends oa{constructor(e,t,i,n,r){super(e,t,i,n,r),this.type=5}_$AI(e,t=this){if((e=sn(this,e,t,0)??Ie)===ms)return;const i=this._$AH,n=e===Ie&&i!==Ie||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,r=e!==Ie&&(i===Ie||n);n&&this.element.removeEventListener(this.name,this,i),r&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t;typeof this._$AH=="function"?this._$AH.call(((t=this.options)==null?void 0:t.host)??this.element,e):this._$AH.handleEvent(e)}}class cw{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){sn(this,e)}}const Cd=Io.litHtmlPolyfillSupport;Cd==null||Cd(dr,_r),(Io.litHtmlVersions??(Io.litHtmlVersions=[])).push("3.3.0");const Ol=(s,e,t)=>{const i=(t==null?void 0:t.renderBefore)??e;let n=i._$litPart$;if(n===void 0){const r=(t==null?void 0:t.renderBefore)??null;i._$litPart$=n=new _r(e.insertBefore(cr(),r),r,void 0,t??{})}return n._$AI(s),n};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ur=globalThis;let Ce=class extends Rs{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var s;const e=super.createRenderRoot();return(s=this.renderOptions).renderBefore??(s.renderBefore=e.firstChild),e}update(s){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(s),this._$Do=Ol(e,this.renderRoot,this.renderOptions)}connectedCallback(){var s;super.connectedCallback(),(s=this._$Do)==null||s.setConnected(!0)}disconnectedCallback(){var s;super.disconnectedCallback(),(s=this._$Do)==null||s.setConnected(!1)}render(){return ms}};var Ed;Ce._$litElement$=!0,Ce.finalized=!0,(Ed=ur.litElementHydrateSupport)==null||Ed.call(ur,{LitElement:Ce});const Sd=ur.litElementPolyfillSupport;Sd==null||Sd({LitElement:Ce});(ur.litElementVersions??(ur.litElementVersions=[])).push("4.2.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const hw={attribute:!0,type:String,converter:Mo,reflect:!1,hasChanged:Ec},dw=(s=hw,e,t)=>{const{kind:i,metadata:n}=t;let r=globalThis.litPropertyMetadata.get(n);if(r===void 0&&globalThis.litPropertyMetadata.set(n,r=new Map),i==="setter"&&((s=Object.create(s)).wrapped=!0),r.set(t.name,s),i==="accessor"){const{name:o}=t;return{set(a){const l=e.get.call(this);e.set.call(this,a),this.requestUpdate(o,l,s)},init(a){return a!==void 0&&this.C(o,void 0,s,a),a}}}if(i==="setter"){const{name:o}=t;return function(a){const l=this[o];e.call(this,a),this.requestUpdate(o,l,s)}}throw Error("Unsupported decorator location: "+i)};function W(s){return(e,t)=>typeof t=="object"?dw(s,e,t):((i,n,r)=>{const o=n.hasOwnProperty(r);return n.constructor.createProperty(r,i),o?Object.getOwnPropertyDescriptor(n,r):void 0})(s,e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function gs(s){return W({...s,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const uw=s=>s.strings===void 0;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const of={ATTRIBUTE:1,CHILD:2},af=s=>(...e)=>({_$litDirective$:s,values:e});let lf=class{constructor(s){}get _$AU(){return this._$AM._$AU}_$AT(s,e,t){this._$Ct=s,this._$AM=e,this._$Ci=t}_$AS(s,e){return this.update(s,e)}update(s,e){return this.render(...e)}};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Qn=(s,e)=>{var t;const i=s._$AN;if(i===void 0)return!1;for(const n of i)(t=n._$AO)==null||t.call(n,e,!1),Qn(n,e);return!0},Do=s=>{let e,t;do{if((e=s._$AM)===void 0)break;t=e._$AN,t.delete(s),s=e}while((t==null?void 0:t.size)===0)},cf=s=>{for(let e;e=s._$AM;s=e){let t=e._$AN;if(t===void 0)e._$AN=t=new Set;else if(t.has(s))break;t.add(s),mw(e)}};function pw(s){this._$AN!==void 0?(Do(this),this._$AM=s,cf(this)):this._$AM=s}function fw(s,e=!1,t=0){const i=this._$AH,n=this._$AN;if(n!==void 0&&n.size!==0)if(e)if(Array.isArray(i))for(let r=t;r<i.length;r++)Qn(i[r],!1),Do(i[r]);else i!=null&&(Qn(i,!1),Do(i));else Qn(this,s)}const mw=s=>{s.type==of.CHILD&&(s._$AP??(s._$AP=fw),s._$AQ??(s._$AQ=pw))};class gw extends lf{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,t,i){super._$AT(e,t,i),cf(this),this.isConnected=e._$AU}_$AO(e,t=!0){var i,n;e!==this.isConnected&&(this.isConnected=e,e?(i=this.reconnected)==null||i.call(this):(n=this.disconnected)==null||n.call(this)),t&&(Qn(this,e),Do(this))}setValue(e){if(uw(this._$Ct))this._$Ct._$AI(e,this);else{const t=[...this._$Ct._$AH];t[this._$Ci]=e,this._$Ct._$AI(t,this,0)}}disconnected(){}reconnected(){}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const nn=()=>new bw;class bw{}const Ya=new WeakMap,Ke=af(class extends gw{render(s){return Ie}update(s,[e]){var t;const i=e!==this.G;return i&&this.G!==void 0&&this.rt(void 0),(i||this.lt!==this.ct)&&(this.G=e,this.ht=(t=s.options)==null?void 0:t.host,this.rt(this.ct=s.element)),Ie}rt(s){if(this.isConnected||(s=void 0),typeof this.G=="function"){const e=this.ht??globalThis;let t=Ya.get(e);t===void 0&&(t=new WeakMap,Ya.set(e,t)),t.get(this.G)!==void 0&&this.G.call(this.ht,void 0),t.set(this.G,s),s!==void 0&&this.G.call(this.ht,s)}else this.G.value=s}get lt(){var s,e;return typeof this.G=="function"?(s=Ya.get(this.ht??globalThis))==null?void 0:s.get(this.G):(e=this.G)==null?void 0:e.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});/**
* (c) Iconify
*
* For the full copyright and license information, please view the license.txt
* files at https://github.com/iconify/iconify
*
* Licensed under MIT.
*
* @license MIT
* @version 2.0.0
*/const hf=Object.freeze({left:0,top:0,width:16,height:16}),Lo=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),wr=Object.freeze({...hf,...Lo}),Ml=Object.freeze({...wr,body:"",hidden:!1}),yw=Object.freeze({width:null,height:null}),df=Object.freeze({...yw,...Lo});function vw(s,e=0){const t=s.replace(/^-?[0-9.]*/,"");function i(n){for(;n<0;)n+=4;return n%4}if(t===""){const n=parseInt(s);return isNaN(n)?0:i(n)}else if(t!==s){let n=0;switch(t){case"%":n=25;break;case"deg":n=90}if(n){let r=parseFloat(s.slice(0,s.length-t.length));return isNaN(r)?0:(r=r/n,r%1===0?i(r):0)}}return e}const _w=/[\s,]+/;function ww(s,e){e.split(_w).forEach(t=>{switch(t.trim()){case"horizontal":s.hFlip=!0;break;case"vertical":s.vFlip=!0;break}})}const uf={...df,preserveAspectRatio:""};function Ad(s){const e={...uf},t=(i,n)=>s.getAttribute(i)||n;return e.width=t("width",null),e.height=t("height",null),e.rotate=vw(t("rotate","")),ww(e,t("flip","")),e.preserveAspectRatio=t("preserveAspectRatio",t("preserveaspectratio","")),e}function xw(s,e){for(const t in uf)if(s[t]!==e[t])return!0;return!1}const Kn=/^[a-z0-9]+(-[a-z0-9]+)*$/,xr=(s,e,t,i="")=>{const n=s.split(":");if(s.slice(0,1)==="@"){if(n.length<2||n.length>3)return null;i=n.shift().slice(1)}if(n.length>3||!n.length)return null;if(n.length>1){const a=n.pop(),l=n.pop(),c={provider:n.length>0?n[0]:i,prefix:l,name:a};return e&&!yo(c)?null:c}const r=n[0],o=r.split("-");if(o.length>1){const a={provider:i,prefix:o.shift(),name:o.join("-")};return e&&!yo(a)?null:a}if(t&&i===""){const a={provider:i,prefix:"",name:r};return e&&!yo(a,t)?null:a}return null},yo=(s,e)=>s?!!((s.provider===""||s.provider.match(Kn))&&(e&&s.prefix===""||s.prefix.match(Kn))&&s.name.match(Kn)):!1;function Cw(s,e){const t={};!s.hFlip!=!e.hFlip&&(t.hFlip=!0),!s.vFlip!=!e.vFlip&&(t.vFlip=!0);const i=((s.rotate||0)+(e.rotate||0))%4;return i&&(t.rotate=i),t}function $d(s,e){const t=Cw(s,e);for(const i in Ml)i in Lo?i in s&&!(i in t)&&(t[i]=Lo[i]):i in e?t[i]=e[i]:i in s&&(t[i]=s[i]);return t}function Ew(s,e){const t=s.icons,i=s.aliases||Object.create(null),n=Object.create(null);function r(o){if(t[o])return n[o]=[];if(!(o in n)){n[o]=null;const a=i[o]&&i[o].parent,l=a&&r(a);l&&(n[o]=[a].concat(l))}return n[o]}return Object.keys(t).concat(Object.keys(i)).forEach(r),n}function Sw(s,e,t){const i=s.icons,n=s.aliases||Object.create(null);let r={};function o(a){r=$d(i[a]||n[a],r)}return o(e),t.forEach(o),$d(s,r)}function pf(s,e){const t=[];if(typeof s!="object"||typeof s.icons!="object")return t;s.not_found instanceof Array&&s.not_found.forEach(n=>{e(n,null),t.push(n)});const i=Ew(s);for(const n in i){const r=i[n];r&&(e(n,Sw(s,n,r)),t.push(n))}return t}const Aw={provider:"",aliases:{},not_found:{},...hf};function Za(s,e){for(const t in e)if(t in s&&typeof s[t]!=typeof e[t])return!1;return!0}function ff(s){if(typeof s!="object"||s===null)return null;const e=s;if(typeof e.prefix!="string"||!s.icons||typeof s.icons!="object"||!Za(s,Aw))return null;const t=e.icons;for(const n in t){const r=t[n];if(!n.match(Kn)||typeof r.body!="string"||!Za(r,Ml))return null}const i=e.aliases||Object.create(null);for(const n in i){const r=i[n],o=r.parent;if(!n.match(Kn)||typeof o!="string"||!t[o]&&!i[o]||!Za(r,Ml))return null}return e}const Bo=Object.create(null);function $w(s,e){return{provider:s,prefix:e,icons:Object.create(null),missing:new Set}}function Wi(s,e){const t=Bo[s]||(Bo[s]=Object.create(null));return t[e]||(t[e]=$w(s,e))}function Ac(s,e){return ff(e)?pf(e,(t,i)=>{i?s.icons[t]=i:s.missing.add(t)}):[]}function Tw(s,e,t){try{if(typeof t.body=="string")return s.icons[e]={...t},!0}catch{}return!1}function kw(s,e){let t=[];return(typeof s=="string"?[s]:Object.keys(Bo)).forEach(i=>{(typeof i=="string"&&typeof e=="string"?[e]:Object.keys(Bo[i]||{})).forEach(n=>{const r=Wi(i,n);t=t.concat(Object.keys(r.icons).map(o=>(i!==""?"@"+i+":":"")+n+":"+o))})}),t}let pr=!1;function mf(s){return typeof s=="boolean"&&(pr=s),pr}function fr(s){const e=typeof s=="string"?xr(s,!0,pr):s;if(e){const t=Wi(e.provider,e.prefix),i=e.name;return t.icons[i]||(t.missing.has(i)?null:void 0)}}function gf(s,e){const t=xr(s,!0,pr);if(!t)return!1;const i=Wi(t.provider,t.prefix);return Tw(i,t.name,e)}function Td(s,e){if(typeof s!="object")return!1;if(typeof e!="string"&&(e=s.provider||""),pr&&!e&&!s.prefix){let n=!1;return ff(s)&&(s.prefix="",pf(s,(r,o)=>{o&&gf(r,o)&&(n=!0)})),n}const t=s.prefix;if(!yo({provider:e,prefix:t,name:"a"}))return!1;const i=Wi(e,t);return!!Ac(i,s)}function kd(s){return!!fr(s)}function Pw(s){const e=fr(s);return e?{...wr,...e}:null}function Ow(s){const e={loaded:[],missing:[],pending:[]},t=Object.create(null);s.sort((n,r)=>n.provider!==r.provider?n.provider.localeCompare(r.provider):n.prefix!==r.prefix?n.prefix.localeCompare(r.prefix):n.name.localeCompare(r.name));let i={provider:"",prefix:"",name:""};return s.forEach(n=>{if(i.name===n.name&&i.prefix===n.prefix&&i.provider===n.provider)return;i=n;const r=n.provider,o=n.prefix,a=n.name,l=t[r]||(t[r]=Object.create(null)),c=l[o]||(l[o]=Wi(r,o));let h;a in c.icons?h=e.loaded:o===""||c.missing.has(a)?h=e.missing:h=e.pending;const d={provider:r,prefix:o,name:a};h.push(d)}),e}function bf(s,e){s.forEach(t=>{const i=t.loaderCallbacks;i&&(t.loaderCallbacks=i.filter(n=>n.id!==e))})}function Mw(s){s.pendingCallbacksFlag||(s.pendingCallbacksFlag=!0,setTimeout(()=>{s.pendingCallbacksFlag=!1;const e=s.loaderCallbacks?s.loaderCallbacks.slice(0):[];if(!e.length)return;let t=!1;const i=s.provider,n=s.prefix;e.forEach(r=>{const o=r.icons,a=o.pending.length;o.pending=o.pending.filter(l=>{if(l.prefix!==n)return!0;const c=l.name;if(s.icons[c])o.loaded.push({provider:i,prefix:n,name:c});else if(s.missing.has(c))o.missing.push({provider:i,prefix:n,name:c});else return t=!0,!0;return!1}),o.pending.length!==a&&(t||bf([s],r.id),r.callback(o.loaded.slice(0),o.missing.slice(0),o.pending.slice(0),r.abort))})}))}let Iw=0;function zw(s,e,t){const i=Iw++,n=bf.bind(null,t,i);if(!e.pending.length)return n;const r={id:i,icons:e,callback:s,abort:n};return t.forEach(o=>{(o.loaderCallbacks||(o.loaderCallbacks=[])).push(r)}),n}const Il=Object.create(null);function Pd(s,e){Il[s]=e}function zl(s){return Il[s]||Il[""]}function Dw(s,e=!0,t=!1){const i=[];return s.forEach(n=>{const r=typeof n=="string"?xr(n,e,t):n;r&&i.push(r)}),i}var Lw={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function Bw(s,e,t,i){const n=s.resources.length,r=s.random?Math.floor(Math.random()*n):s.index;let o;if(s.random){let S=s.resources.slice(0);for(o=[];S.length>1;){const $=Math.floor(Math.random()*S.length);o.push(S[$]),S=S.slice(0,$).concat(S.slice($+1))}o=o.concat(S)}else o=s.resources.slice(r).concat(s.resources.slice(0,r));const a=Date.now();let l="pending",c=0,h,d=null,p=[],u=[];typeof i=="function"&&u.push(i);function g(){d&&(clearTimeout(d),d=null)}function m(){l==="pending"&&(l="aborted"),g(),p.forEach(S=>{S.status==="pending"&&(S.status="aborted")}),p=[]}function b(S,$){$&&(u=[]),typeof S=="function"&&u.push(S)}function f(){return{startTime:a,payload:e,status:l,queriesSent:c,queriesPending:p.length,subscribe:b,abort:m}}function y(){l="failed",u.forEach(S=>{S(void 0,h)})}function v(){p.forEach(S=>{S.status==="pending"&&(S.status="aborted")}),p=[]}function w(S,$,M){const k=$!=="success";switch(p=p.filter(z=>z!==S),l){case"pending":break;case"failed":if(k||!s.dataAfterTimeout)return;break;default:return}if($==="abort"){h=M,y();return}if(k){h=M,p.length||(o.length?E():y());return}if(g(),v(),!s.random){const z=s.resources.indexOf(S.resource);z!==-1&&z!==s.index&&(s.index=z)}l="completed",u.forEach(z=>{z(M)})}function E(){if(l!=="pending")return;g();const S=o.shift();if(S===void 0){if(p.length){d=setTimeout(()=>{g(),l==="pending"&&(v(),y())},s.timeout);return}y();return}const $={status:"pending",resource:S,callback:(M,k)=>{w($,M,k)}};p.push($),c++,d=setTimeout(E,s.rotate),t(S,e,$.callback)}return setTimeout(E),f}function yf(s){const e={...Lw,...s};let t=[];function i(){t=t.filter(o=>o().status==="pending")}function n(o,a,l){const c=Bw(e,o,a,(h,d)=>{i(),l&&l(h,d)});return t.push(c),c}function r(o){return t.find(a=>o(a))||null}return{query:n,find:r,setIndex:o=>{e.index=o},getIndex:()=>e.index,cleanup:i}}function $c(s){let e;if(typeof s.resources=="string")e=[s.resources];else if(e=s.resources,!(e instanceof Array)||!e.length)return null;return{resources:e,path:s.path||"/",maxURL:s.maxURL||500,rotate:s.rotate||750,timeout:s.timeout||5e3,random:s.random===!0,index:s.index||0,dataAfterTimeout:s.dataAfterTimeout!==!1}}const aa=Object.create(null),ao=["https://api.simplesvg.com","https://api.unisvg.com"],Dl=[];for(;ao.length>0;)ao.length===1||Math.random()>.5?Dl.push(ao.shift()):Dl.push(ao.pop());aa[""]=$c({resources:["https://api.iconify.design"].concat(Dl)});function Od(s,e){const t=$c(e);return t===null?!1:(aa[s]=t,!0)}function la(s){return aa[s]}function Nw(){return Object.keys(aa)}function Md(){}const Ga=Object.create(null);function Rw(s){if(!Ga[s]){const e=la(s);if(!e)return;const t=yf(e),i={config:e,redundancy:t};Ga[s]=i}return Ga[s]}function vf(s,e,t){let i,n;if(typeof s=="string"){const r=zl(s);if(!r)return t(void 0,424),Md;n=r.send;const o=Rw(s);o&&(i=o.redundancy)}else{const r=$c(s);if(r){i=yf(r);const o=s.resources?s.resources[0]:"",a=zl(o);a&&(n=a.send)}}return!i||!n?(t(void 0,424),Md):i.query(e,n,t)().abort}const Id="iconify2",mr="iconify",_f=mr+"-count",zd=mr+"-version",wf=36e5,Uw=168,Fw=50;function Ll(s,e){try{return s.getItem(e)}catch{}}function Tc(s,e,t){try{return s.setItem(e,t),!0}catch{}}function Dd(s,e){try{s.removeItem(e)}catch{}}function Bl(s,e){return Tc(s,_f,e.toString())}function Nl(s){return parseInt(Ll(s,_f))||0}const us={local:!0,session:!0},xf={local:new Set,session:new Set};let kc=!1;function jw(s){kc=s}let lo=typeof window>"u"?{}:window;function Cf(s){const e=s+"Storage";try{if(lo&&lo[e]&&typeof lo[e].length=="number")return lo[e]}catch{}us[s]=!1}function Ef(s,e){const t=Cf(s);if(!t)return;const i=Ll(t,zd);if(i!==Id){if(i){const a=Nl(t);for(let l=0;l<a;l++)Dd(t,mr+l.toString())}Tc(t,zd,Id),Bl(t,0);return}const n=Math.floor(Date.now()/wf)-Uw,r=a=>{const l=mr+a.toString(),c=Ll(t,l);if(typeof c=="string"){try{const h=JSON.parse(c);if(typeof h=="object"&&typeof h.cached=="number"&&h.cached>n&&typeof h.provider=="string"&&typeof h.data=="object"&&typeof h.data.prefix=="string"&&e(h,a))return!0}catch{}Dd(t,l)}};let o=Nl(t);for(let a=o-1;a>=0;a--)r(a)||(a===o-1?(o--,Bl(t,o)):xf[s].add(a))}function Sf(){if(!kc){jw(!0);for(const s in us)Ef(s,e=>{const t=e.data,i=e.provider,n=t.prefix,r=Wi(i,n);if(!Ac(r,t).length)return!1;const o=t.lastModified||-1;return r.lastModifiedCached=r.lastModifiedCached?Math.min(r.lastModifiedCached,o):o,!0})}}function Hw(s,e){const t=s.lastModifiedCached;if(t&&t>=e)return t===e;if(s.lastModifiedCached=e,t)for(const i in us)Ef(i,n=>{const r=n.data;return n.provider!==s.provider||r.prefix!==s.prefix||r.lastModified===e});return!0}function Vw(s,e){kc||Sf();function t(i){let n;if(!us[i]||!(n=Cf(i)))return;const r=xf[i];let o;if(r.size)r.delete(o=Array.from(r).shift());else if(o=Nl(n),o>=Fw||!Bl(n,o+1))return;const a={cached:Math.floor(Date.now()/wf),provider:s.provider,data:e};return Tc(n,mr+o.toString(),JSON.stringify(a))}e.lastModified&&!Hw(s,e.lastModified)||Object.keys(e.icons).length&&(e.not_found&&(e=Object.assign({},e),delete e.not_found),t("local")||t("session"))}function Ld(){}function qw(s){s.iconsLoaderFlag||(s.iconsLoaderFlag=!0,setTimeout(()=>{s.iconsLoaderFlag=!1,Mw(s)}))}function Ww(s,e){s.iconsToLoad?s.iconsToLoad=s.iconsToLoad.concat(e).sort():s.iconsToLoad=e,s.iconsQueueFlag||(s.iconsQueueFlag=!0,setTimeout(()=>{s.iconsQueueFlag=!1;const{provider:t,prefix:i}=s,n=s.iconsToLoad;delete s.iconsToLoad;let r;!n||!(r=zl(t))||r.prepare(t,i,n).forEach(o=>{vf(t,o,a=>{if(typeof a!="object")o.icons.forEach(l=>{s.missing.add(l)});else try{const l=Ac(s,a);if(!l.length)return;const c=s.pendingIcons;c&&l.forEach(h=>{c.delete(h)}),Vw(s,a)}catch(l){console.error(l)}qw(s)})})}))}const Pc=(s,e)=>{const t=Dw(s,!0,mf()),i=Ow(t);if(!i.pending.length){let l=!0;return e&&setTimeout(()=>{l&&e(i.loaded,i.missing,i.pending,Ld)}),()=>{l=!1}}const n=Object.create(null),r=[];let o,a;return i.pending.forEach(l=>{const{provider:c,prefix:h}=l;if(h===a&&c===o)return;o=c,a=h,r.push(Wi(c,h));const d=n[c]||(n[c]=Object.create(null));d[h]||(d[h]=[])}),i.pending.forEach(l=>{const{provider:c,prefix:h,name:d}=l,p=Wi(c,h),u=p.pendingIcons||(p.pendingIcons=new Set);u.has(d)||(u.add(d),n[c][h].push(d))}),r.forEach(l=>{const{provider:c,prefix:h}=l;n[c][h].length&&Ww(l,n[c][h])}),e?zw(e,i,r):Ld},Yw=s=>new Promise((e,t)=>{const i=typeof s=="string"?xr(s,!0):s;if(!i){t(s);return}Pc([i||s],n=>{if(n.length&&i){const r=fr(i);if(r){e({...wr,...r});return}}t(s)})});function Zw(s){try{const e=typeof s=="string"?JSON.parse(s):s;if(typeof e.body=="string")return{...e}}catch{}}function Gw(s,e){const t=typeof s=="string"?xr(s,!0,!0):null;if(!t){const r=Zw(s);return{value:s,data:r}}const i=fr(t);if(i!==void 0||!t.prefix)return{value:s,name:t,data:i};const n=Pc([t],()=>e(s,t,fr(t)));return{value:s,name:t,loading:n}}function Xa(s){return s.hasAttribute("inline")}let Af=!1;try{Af=navigator.vendor.indexOf("Apple")===0}catch{}function Xw(s,e){switch(e){case"svg":case"bg":case"mask":return e}return e!=="style"&&(Af||s.indexOf("<a")===-1)?"svg":s.indexOf("currentColor")===-1?"bg":"mask"}const Qw=/(-?[0-9.]*[0-9]+[0-9.]*)/g,Kw=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function Rl(s,e,t){if(e===1)return s;if(t=t||100,typeof s=="number")return Math.ceil(s*e*t)/t;if(typeof s!="string")return s;const i=s.split(Qw);if(i===null||!i.length)return s;const n=[];let r=i.shift(),o=Kw.test(r);for(;;){if(o){const a=parseFloat(r);isNaN(a)?n.push(r):n.push(Math.ceil(a*e*t)/t)}else n.push(r);if(r=i.shift(),r===void 0)return n.join("");o=!o}}function Jw(s,e="defs"){let t="";const i=s.indexOf("<"+e);for(;i>=0;){const n=s.indexOf(">",i),r=s.indexOf("</"+e);if(n===-1||r===-1)break;const o=s.indexOf(">",r);if(o===-1)break;t+=s.slice(n+1,r).trim(),s=s.slice(0,i).trim()+s.slice(o+1)}return{defs:t,content:s}}function e1(s,e){return s?"<defs>"+s+"</defs>"+e:e}function t1(s,e,t){const i=Jw(s);return e1(i.defs,e+i.content+t)}const i1=s=>s==="unset"||s==="undefined"||s==="none";function $f(s,e){const t={...wr,...s},i={...df,...e},n={left:t.left,top:t.top,width:t.width,height:t.height};let r=t.body;[t,i].forEach(m=>{const b=[],f=m.hFlip,y=m.vFlip;let v=m.rotate;f?y?v+=2:(b.push("translate("+(n.width+n.left).toString()+" "+(0-n.top).toString()+")"),b.push("scale(-1 1)"),n.top=n.left=0):y&&(b.push("translate("+(0-n.left).toString()+" "+(n.height+n.top).toString()+")"),b.push("scale(1 -1)"),n.top=n.left=0);let w;switch(v<0&&(v-=Math.floor(v/4)*4),v=v%4,v){case 1:w=n.height/2+n.top,b.unshift("rotate(90 "+w.toString()+" "+w.toString()+")");break;case 2:b.unshift("rotate(180 "+(n.width/2+n.left).toString()+" "+(n.height/2+n.top).toString()+")");break;case 3:w=n.width/2+n.left,b.unshift("rotate(-90 "+w.toString()+" "+w.toString()+")");break}v%2===1&&(n.left!==n.top&&(w=n.left,n.left=n.top,n.top=w),n.width!==n.height&&(w=n.width,n.width=n.height,n.height=w)),b.length&&(r=t1(r,'<g transform="'+b.join(" ")+'">',"</g>"))});const o=i.width,a=i.height,l=n.width,c=n.height;let h,d;o===null?(d=a===null?"1em":a==="auto"?c:a,h=Rl(d,l/c)):(h=o==="auto"?l:o,d=a===null?Rl(h,c/l):a==="auto"?c:a);const p={},u=(m,b)=>{i1(b)||(p[m]=b.toString())};u("width",h),u("height",d);const g=[n.left,n.top,l,c];return p.viewBox=g.join(" "),{attributes:p,viewBox:g,body:r}}function Oc(s,e){let t=s.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const i in e)t+=" "+i+'="'+e[i]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+t+">"+s+"</svg>"}function s1(s){return s.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function n1(s){return"data:image/svg+xml,"+s1(s)}function Tf(s){return'url("'+n1(s)+'")'}const r1=()=>{let s;try{if(s=fetch,typeof s=="function")return s}catch{}};let No=r1();function o1(s){No=s}function a1(){return No}function l1(s,e){const t=la(s);if(!t)return 0;let i;if(!t.maxURL)i=0;else{let n=0;t.resources.forEach(o=>{n=Math.max(n,o.length)});const r=e+".json?icons=";i=t.maxURL-n-t.path.length-r.length}return i}function c1(s){return s===404}const h1=(s,e,t)=>{const i=[],n=l1(s,e),r="icons";let o={type:r,provider:s,prefix:e,icons:[]},a=0;return t.forEach((l,c)=>{a+=l.length+1,a>=n&&c>0&&(i.push(o),o={type:r,provider:s,prefix:e,icons:[]},a=l.length),o.icons.push(l)}),i.push(o),i};function d1(s){if(typeof s=="string"){const e=la(s);if(e)return e.path}return"/"}const u1=(s,e,t)=>{if(!No){t("abort",424);return}let i=d1(e.provider);switch(e.type){case"icons":{const r=e.prefix,o=e.icons.join(","),a=new URLSearchParams({icons:o});i+=r+".json?"+a.toString();break}case"custom":{const r=e.uri;i+=r.slice(0,1)==="/"?r.slice(1):r;break}default:t("abort",400);return}let n=503;No(s+i).then(r=>{const o=r.status;if(o!==200){setTimeout(()=>{t(c1(o)?"abort":"next",o)});return}return n=501,r.json()}).then(r=>{if(typeof r!="object"||r===null){setTimeout(()=>{r===404?t("abort",r):t("next",n)});return}setTimeout(()=>{t("success",r)})}).catch(()=>{t("next",n)})},p1={prepare:h1,send:u1};function Bd(s,e){switch(s){case"local":case"session":us[s]=e;break;case"all":for(const t in us)us[t]=e;break}}const Qa="data-style";let kf="";function f1(s){kf=s}function Nd(s,e){let t=Array.from(s.childNodes).find(i=>i.hasAttribute&&i.hasAttribute(Qa));t||(t=document.createElement("style"),t.setAttribute(Qa,Qa),s.appendChild(t)),t.textContent=":host{display:inline-block;vertical-align:"+(e?"-0.125em":"0")+"}span,svg{display:block}"+kf}function Pf(){Pd("",p1),mf(!0);let s;try{s=window}catch{}if(s){if(Sf(),s.IconifyPreload!==void 0){const e=s.IconifyPreload,t="Invalid IconifyPreload syntax.";typeof e=="object"&&e!==null&&(e instanceof Array?e:[e]).forEach(i=>{try{(typeof i!="object"||i===null||i instanceof Array||typeof i.icons!="object"||typeof i.prefix!="string"||!Td(i))&&console.error(t)}catch{console.error(t)}})}if(s.IconifyProviders!==void 0){const e=s.IconifyProviders;if(typeof e=="object"&&e!==null)for(const t in e){const i="IconifyProviders["+t+"] is invalid.";try{const n=e[t];if(typeof n!="object"||!n||n.resources===void 0)continue;Od(t,n)||console.error(i)}catch{console.error(i)}}}}return{enableCache:e=>Bd(e,!0),disableCache:e=>Bd(e,!1),iconLoaded:kd,iconExists:kd,getIcon:Pw,listIcons:kw,addIcon:gf,addCollection:Td,calculateSize:Rl,buildIcon:$f,iconToHTML:Oc,svgToURL:Tf,loadIcons:Pc,loadIcon:Yw,addAPIProvider:Od,appendCustomStyle:f1,_api:{getAPIConfig:la,setAPIModule:Pd,sendAPIQuery:vf,setFetch:o1,getFetch:a1,listAPIProviders:Nw}}}const Ul={"background-color":"currentColor"},Of={"background-color":"transparent"},Rd={image:"var(--svg)",repeat:"no-repeat",size:"100% 100%"},Ud={"-webkit-mask":Ul,mask:Ul,background:Of};for(const s in Ud){const e=Ud[s];for(const t in Rd)e[s+"-"+t]=Rd[t]}function Fd(s){return s?s+(s.match(/^[-0-9.]+$/)?"px":""):"inherit"}function m1(s,e,t){const i=document.createElement("span");let n=s.body;n.indexOf("<a")!==-1&&(n+="<!-- "+Date.now()+" -->");const r=s.attributes,o=Oc(n,{...r,width:e.width+"",height:e.height+""}),a=Tf(o),l=i.style,c={"--svg":a,width:Fd(r.width),height:Fd(r.height),...t?Ul:Of};for(const h in c)l.setProperty(h,c[h]);return i}let Jn;function g1(){try{Jn=window.trustedTypes.createPolicy("iconify",{createHTML:s=>s})}catch{Jn=null}}function b1(s){return Jn===void 0&&g1(),Jn?Jn.createHTML(s):s}function y1(s){const e=document.createElement("span"),t=s.attributes;let i="";t.width||(i="width: inherit;"),t.height||(i+="height: inherit;"),i&&(t.style=i);const n=Oc(s.body,t);return e.innerHTML=b1(n),e.firstChild}function Fl(s){return Array.from(s.childNodes).find(e=>{const t=e.tagName&&e.tagName.toUpperCase();return t==="SPAN"||t==="SVG"})}function jd(s,e){const t=e.icon.data,i=e.customisations,n=$f(t,i);i.preserveAspectRatio&&(n.attributes.preserveAspectRatio=i.preserveAspectRatio);const r=e.renderedMode;let o;switch(r){case"svg":o=y1(n);break;default:o=m1(n,{...wr,...t},r==="mask")}const a=Fl(s);a?o.tagName==="SPAN"&&a.tagName===o.tagName?a.setAttribute("style",o.getAttribute("style")):s.replaceChild(o,a):s.appendChild(o)}function Hd(s,e,t){const i=t&&(t.rendered?t:t.lastRender);return{rendered:!1,inline:e,icon:s,lastRender:i}}function v1(s="iconify-icon"){let e,t;try{e=window.customElements,t=window.HTMLElement}catch{return}if(!e||!t)return;const i=e.get(s);if(i)return i;const n=["icon","mode","inline","observe","width","height","rotate","flip"],r=class extends t{constructor(){super(),ss(this,"_shadowRoot"),ss(this,"_initialised",!1),ss(this,"_state"),ss(this,"_checkQueued",!1),ss(this,"_connected",!1),ss(this,"_observer",null),ss(this,"_visible",!0);const a=this._shadowRoot=this.attachShadow({mode:"open"}),l=Xa(this);Nd(a,l),this._state=Hd({value:""},l),this._queueCheck()}connectedCallback(){this._connected=!0,this.startObserver()}disconnectedCallback(){this._connected=!1,this.stopObserver()}static get observedAttributes(){return n.slice(0)}attributeChangedCallback(a){switch(a){case"inline":{const l=Xa(this),c=this._state;l!==c.inline&&(c.inline=l,Nd(this._shadowRoot,l));break}case"observer":{this.observer?this.startObserver():this.stopObserver();break}default:this._queueCheck()}}get icon(){const a=this.getAttribute("icon");if(a&&a.slice(0,1)==="{")try{return JSON.parse(a)}catch{}return a}set icon(a){typeof a=="object"&&(a=JSON.stringify(a)),this.setAttribute("icon",a)}get inline(){return Xa(this)}set inline(a){a?this.setAttribute("inline","true"):this.removeAttribute("inline")}get observer(){return this.hasAttribute("observer")}set observer(a){a?this.setAttribute("observer","true"):this.removeAttribute("observer")}restartAnimation(){const a=this._state;if(a.rendered){const l=this._shadowRoot;if(a.renderedMode==="svg")try{l.lastChild.setCurrentTime(0);return}catch{}jd(l,a)}}get status(){const a=this._state;return a.rendered?"rendered":a.icon.data===null?"failed":"loading"}_queueCheck(){this._checkQueued||(this._checkQueued=!0,setTimeout(()=>{this._check()}))}_check(){if(!this._checkQueued)return;this._checkQueued=!1;const a=this._state,l=this.getAttribute("icon");if(l!==a.icon.value){this._iconChanged(l);return}if(!a.rendered||!this._visible)return;const c=this.getAttribute("mode"),h=Ad(this);(a.attrMode!==c||xw(a.customisations,h)||!Fl(this._shadowRoot))&&this._renderIcon(a.icon,h,c)}_iconChanged(a){const l=Gw(a,(c,h,d)=>{const p=this._state;if(p.rendered||this.getAttribute("icon")!==c)return;const u={value:c,name:h,data:d};u.data?this._gotIconData(u):p.icon=u});l.data?this._gotIconData(l):this._state=Hd(l,this._state.inline,this._state)}_forceRender(){if(!this._visible){const a=Fl(this._shadowRoot);a&&this._shadowRoot.removeChild(a);return}this._queueCheck()}_gotIconData(a){this._checkQueued=!1,this._renderIcon(a,Ad(this),this.getAttribute("mode"))}_renderIcon(a,l,c){const h=Xw(a.data.body,c),d=this._state.inline;jd(this._shadowRoot,this._state={rendered:!0,icon:a,inline:d,customisations:l,attrMode:c,renderedMode:h})}startObserver(){if(!this._observer)try{this._observer=new IntersectionObserver(a=>{const l=a.some(c=>c.isIntersecting);l!==this._visible&&(this._visible=l,this._forceRender())}),this._observer.observe(this)}catch{if(this._observer){try{this._observer.disconnect()}catch{}this._observer=null}}}stopObserver(){this._observer&&(this._observer.disconnect(),this._observer=null,this._visible=!0,this._connected&&this._forceRender())}};n.forEach(a=>{a in r.prototype||Object.defineProperty(r.prototype,a,{get:function(){return this.getAttribute(a)},set:function(l){l!==null?this.setAttribute(a,l):this.removeAttribute(a)}})});const o=Pf();for(const a in o)r[a]=r.prototype[a]=o[a];return e.define(s,r),r}const _1=v1()||Pf(),{enableCache:fE,disableCache:mE,iconLoaded:gE,iconExists:bE,getIcon:yE,listIcons:vE,addIcon:_E,addCollection:wE,calculateSize:xE,buildIcon:CE,iconToHTML:EE,svgToURL:SE,loadIcons:w1,loadIcon:AE,addAPIProvider:$E,_api:TE}=_1,x1=$e`
  ::-webkit-scrollbar {
    width: 0.4rem;
    height: 0.4rem;
    overflow: hidden;
  }

  ::-webkit-scrollbar-thumb {
    border-radius: 0.25rem;
    background-color: var(
      --bim-scrollbar--c,
      color-mix(in lab, var(--bim-ui_main-base), white 15%)
    );
  }

  ::-webkit-scrollbar-track {
    background-color: var(--bim-scrollbar--bgc, var(--bim-ui_bg-base));
  }
`,C1=$e`
  :root {
    /* Grayscale Colors */
    --bim-ui_gray-0: hsl(210 10% 5%);
    --bim-ui_gray-1: hsl(210 10% 10%);
    --bim-ui_gray-2: hsl(210 10% 20%);
    --bim-ui_gray-3: hsl(210 10% 30%);
    --bim-ui_gray-4: hsl(210 10% 40%);
    --bim-ui_gray-6: hsl(210 10% 60%);
    --bim-ui_gray-7: hsl(210 10% 70%);
    --bim-ui_gray-8: hsl(210 10% 80%);
    --bim-ui_gray-9: hsl(210 10% 90%);
    --bim-ui_gray-10: hsl(210 10% 95%);

    /* Brand Colors */
    --bim-ui_main-base: #6528d7;
    --bim-ui_accent-base: #bcf124;

    /* Brand Colors Contrasts */
    --bim-ui_main-contrast: var(--bim-ui_gray-10);
    --bim-ui_accent-contrast: var(--bim-ui_gray-0);

    /* Sizes */
    --bim-ui_size-4xs: 0.375rem;
    --bim-ui_size-3xs: 0.5rem;
    --bim-ui_size-2xs: 0.625rem;
    --bim-ui_size-xs: 0.75rem;
    --bim-ui_size-sm: 0.875rem;
    --bim-ui_size-base: 1rem;
    --bim-ui_size-lg: 1.125rem;
    --bim-ui_size-xl: 1.25rem;
    --bim-ui_size-2xl: 1.375rem;
    --bim-ui_size-3xl: 1.5rem;
    --bim-ui_size-4xl: 1.625rem;
    --bim-ui_size-5xl: 1.75rem;
    --bim-ui_size-6xl: 1.875rem;
    --bim-ui_size-7xl: 2rem;
    --bim-ui_size-8xl: 2.125rem;
    --bim-ui_size-9xl: 2.25rem;
  }

  /* Background Colors */
  @media (prefers-color-scheme: dark) {
    :root {
      --bim-ui_bg-base: var(--bim-ui_gray-0);
      --bim-ui_bg-contrast-10: var(--bim-ui_gray-1);
      --bim-ui_bg-contrast-20: var(--bim-ui_gray-2);
      --bim-ui_bg-contrast-30: var(--bim-ui_gray-3);
      --bim-ui_bg-contrast-40: var(--bim-ui_gray-4);
      --bim-ui_bg-contrast-60: var(--bim-ui_gray-6);
      --bim-ui_bg-contrast-80: var(--bim-ui_gray-8);
      --bim-ui_bg-contrast-100: var(--bim-ui_gray-10);
    }
  }

  @media (prefers-color-scheme: light) {
    :root {
      --bim-ui_bg-base: var(--bim-ui_gray-10);
      --bim-ui_bg-contrast-10: var(--bim-ui_gray-9);
      --bim-ui_bg-contrast-20: var(--bim-ui_gray-8);
      --bim-ui_bg-contrast-30: var(--bim-ui_gray-7);
      --bim-ui_bg-contrast-40: var(--bim-ui_gray-6);
      --bim-ui_bg-contrast-60: var(--bim-ui_gray-4);
      --bim-ui_bg-contrast-80: var(--bim-ui_gray-2);
      --bim-ui_bg-contrast-100: var(--bim-ui_gray-0);
      --bim-ui_accent-base: #6528d7;
    }
  }

  .theme-transition-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    filter: drop-shadow(0 0 10px var(--bim-ui_bg-base));
    z-index: 9999;
  }

  .theme-transition-overlay > div {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--bim-ui_bg-base);
  }

  html.bim-ui-dark {
    --bim-ui_bg-base: var(--bim-ui_gray-0);
    --bim-ui_bg-contrast-10: var(--bim-ui_gray-1);
    --bim-ui_bg-contrast-20: var(--bim-ui_gray-2);
    --bim-ui_bg-contrast-30: var(--bim-ui_gray-3);
    --bim-ui_bg-contrast-40: var(--bim-ui_gray-4);
    --bim-ui_bg-contrast-60: var(--bim-ui_gray-6);
    --bim-ui_bg-contrast-80: var(--bim-ui_gray-8);
    --bim-ui_bg-contrast-100: var(--bim-ui_gray-10);
  }

  html.bim-ui-light {
    --bim-ui_bg-base: var(--bim-ui_gray-10);
    --bim-ui_bg-contrast-10: var(--bim-ui_gray-9);
    --bim-ui_bg-contrast-20: var(--bim-ui_gray-8);
    --bim-ui_bg-contrast-30: var(--bim-ui_gray-7);
    --bim-ui_bg-contrast-40: var(--bim-ui_gray-6);
    --bim-ui_bg-contrast-60: var(--bim-ui_gray-4);
    --bim-ui_bg-contrast-80: var(--bim-ui_gray-2);
    --bim-ui_bg-contrast-100: var(--bim-ui_gray-0);
    --bim-ui_accent-base: #6528d7;
  }

  @keyframes toggleOverlay {
    0%,
    99% {
      display: block;
    }

    100% {
      display: none;
    }
  }

  @keyframes toggleThemeAnimation {
    0% {
      clip-path: circle(0% at center top);
    }
    45%,
    55% {
      clip-path: circle(150% at center center);
    }
    100% {
      clip-path: circle(0% at center bottom);
    }
  }

  [data-context-dialog]::backdrop {
    background-color: transparent;
  }
`,Xi={scrollbar:x1,globalStyles:C1},Mf=class _e{static set config(e){this._config={..._e._config,...e}}static get config(){return _e._config}static addGlobalStyles(){let e=document.querySelector("style[id='bim-ui']");if(e)return;e=document.createElement("style"),e.id="bim-ui",e.textContent=Xi.globalStyles.cssText;const t=document.head.firstChild;t?document.head.insertBefore(e,t):document.head.append(e)}static preloadIcons(e,t=!1){w1(e,(i,n,r)=>{t&&(console.log("Icons loaded:",i),n.length&&console.warn("Icons missing:",n),r.length&&console.info("Icons pending:",r))})}static defineCustomElement(e,t){customElements.get(e)||customElements.define(e,t)}static registerComponents(){_e.init()}static init(e="",t=!0){_e.addGlobalStyles(),_e.defineCustomElement("bim-button",k1),_e.defineCustomElement("bim-checkbox",hn),_e.defineCustomElement("bim-color-input",Qi),_e.defineCustomElement("bim-context-menu",er),_e.defineCustomElement("bim-dropdown",ci),_e.defineCustomElement("bim-grid",Ic),_e.defineCustomElement("bim-icon",B1),_e.defineCustomElement("bim-input",Er),_e.defineCustomElement("bim-label",dn),_e.defineCustomElement("bim-number-input",$t),_e.defineCustomElement("bim-option",Xe),_e.defineCustomElement("bim-panel",ys),_e.defineCustomElement("bim-panel-section",un),_e.defineCustomElement("bim-selector",pn),_e.defineCustomElement("bim-table",Tt),_e.defineCustomElement("bim-tabs",vi),_e.defineCustomElement("bim-tab",vt),_e.defineCustomElement("bim-table-cell",Yf),_e.defineCustomElement("bim-table-children",X1),_e.defineCustomElement("bim-table-group",Qf),_e.defineCustomElement("bim-table-row",vs),_e.defineCustomElement("bim-text-input",yt),_e.defineCustomElement("bim-toolbar",fa),_e.defineCustomElement("bim-toolbar-group",ua),_e.defineCustomElement("bim-toolbar-section",gn),_e.defineCustomElement("bim-viewport",lm),t&&this.animateOnLoad(e)}static newRandomId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="";for(let i=0;i<10;i++){const n=Math.floor(Math.random()*e.length);t+=e.charAt(n)}return t}static animateOnLoad(e=""){const t=`
      bim-input,
      bim-button,
      bim-checkbox,
      bim-selector,
      bim-label,
      bim-table-row,
      bim-panel-section,
      bim-table-children .branch-vertical,
      .switchers
    `,i=[];function n(r,o=document,a=new Set){const l=[];return Array.from(o.querySelectorAll(r)).forEach(c=>{a.has(c)||(a.add(c),l.push(c))}),Array.from(o.querySelectorAll("*")).filter(c=>c.shadowRoot).forEach(c=>{a.has(c)||(a.add(c),l.push(...n(r,c.shadowRoot,a)))}),l}requestAnimationFrame(()=>{n(e||t).forEach(o=>{const a=o;let l="auto";l=window.getComputedStyle(a).getPropertyValue("transition"),a.style.setProperty("opacity","0"),a.style.setProperty("transition","none"),requestAnimationFrame(()=>{a.style.setProperty("transition",l)}),i.push(a)});const r=()=>{i.forEach(o=>{const a=o,l=(a.getBoundingClientRect().x+a.getBoundingClientRect().y)/(window.innerWidth+window.innerHeight),c=window.getComputedStyle(a).getPropertyValue("transform"),h=400,d=200+l*1e3;a.animate([{transform:"translateY(-20px)",opacity:"0"},{transform:"translateY(0)",opacity:"1"}],{duration:h,easing:"ease-in-out",delay:d}),setTimeout(()=>{a.style.removeProperty("opacity"),c!=="none"?a.style.setProperty("transform",c):a.style.removeProperty("transform")},d+h)})};document.readyState==="complete"?r():window.addEventListener("load",r)})}static toggleTheme(e=!0){const t=document.querySelector("html");if(!t)return;const i=()=>{t.classList.contains("bim-ui-dark")?t.classList.replace("bim-ui-dark","bim-ui-light"):t.classList.contains("bim-ui-light")?t.classList.replace("bim-ui-light","bim-ui-dark"):t.classList.add("bim-ui-light")};if(e){const n=document.createElement("div");n.classList.add("theme-transition-overlay");const r=document.createElement("div");n.appendChild(r),r.style.setProperty("transition",`background-color ${1e3/3200}s`),document.body.appendChild(n),n.style.setProperty("animation",`toggleOverlay ${1e3/1e3}s ease-in forwards`),r.style.setProperty("animation",`toggleThemeAnimation ${1e3/1e3}s ease forwards`),setTimeout(()=>{i()},1e3/4),setTimeout(()=>{document.body.querySelectorAll(".theme-transition-overlay").forEach(o=>{document.body.removeChild(o)})},1e3)}else i()}};Mf._config={sectionLabelOnVerticalToolbar:!1};let lt=Mf;class Ye extends Ce{constructor(){super(...arguments),this._lazyLoadObserver=null,this._visibleElements=[],this.ELEMENTS_BEFORE_OBSERVER=20,this.useObserver=!1,this.elements=new Set,this.observe=e=>{if(!this.useObserver)return;for(const i of e)this.elements.add(i);const t=e.slice(this.ELEMENTS_BEFORE_OBSERVER);for(const i of t)i.remove();this.observeLastElement()}}set visibleElements(e){this._visibleElements=this.useObserver?e:[],this.requestUpdate()}get visibleElements(){return this._visibleElements}getLazyObserver(){if(!this.useObserver)return null;if(this._lazyLoadObserver)return this._lazyLoadObserver;const e=new IntersectionObserver(t=>{const i=t[0];if(!i.isIntersecting)return;const n=i.target;e.unobserve(n);const r=this.ELEMENTS_BEFORE_OBSERVER+this.visibleElements.length,o=[...this.elements][r];o&&(this.visibleElements=[...this.visibleElements,o],e.observe(o))},{threshold:.5});return e}observeLastElement(){const e=this.getLazyObserver();if(!e)return;const t=this.ELEMENTS_BEFORE_OBSERVER+this.visibleElements.length-1,i=[...this.elements][t];i&&e.observe(i)}resetVisibleElements(){const e=this.getLazyObserver();if(e){for(const t of this.elements)e.unobserve(t);this.visibleElements=[],this.observeLastElement()}}static create(e,t){const i=document.createDocumentFragment();if(e.length===0)return Ol(e(),i),i.firstElementChild;if(!t)throw new Error("UIComponent: Initial state is required for statefull components.");let n=t;const r=e,o=l=>(n={...n,...l},Ol(r(n,o),i),n);o(t);const a=()=>n;return[i.firstElementChild,o,a]}}const gr=(s,e={},t=!0)=>{let i={};for(const n of s.children){const r=n,o=r.getAttribute("name")||r.getAttribute("label"),a=o?e[o]:void 0;if(o){if("value"in r&&typeof r.value<"u"&&r.value!==null){const l=r.value;if(typeof l=="object"&&!Array.isArray(l)&&Object.keys(l).length===0)continue;i[o]=a?a(r.value):r.value}else if(t){const l=gr(r,e);if(Object.keys(l).length===0)continue;i[o]=a?a(l):l}}else t&&(i={...i,...gr(r,e)})}return i},ca=s=>s==="true"||s==="false"?s==="true":s&&!isNaN(Number(s))&&s.trim()!==""?Number(s):s,E1=[">=","<=","=",">","<","?","/","#"];function Vd(s){const e=E1.find(o=>s.split(o).length===2),t=s.split(e).map(o=>o.trim()),[i,n]=t,r=n.startsWith("'")&&n.endsWith("'")?n.replace(/'/g,""):ca(n);return{key:i,condition:e,value:r}}const jl=s=>{try{const e=[],t=s.split(/&(?![^()]*\))/).map(i=>i.trim());for(const i of t){const n=!i.startsWith("(")&&!i.endsWith(")"),r=i.startsWith("(")&&i.endsWith(")");if(n){const o=Vd(i);e.push(o)}if(r){const o={operator:"&",queries:i.replace(/^(\()|(\))$/g,"").split("&").map(a=>a.trim()).map((a,l)=>{const c=Vd(a);return l>0&&(c.operator="&"),c})};e.push(o)}}return e}catch{return null}},qd=(s,e,t)=>{let i=!1;switch(e){case"=":i=s===t;break;case"?":i=String(s).includes(String(t));break;case"<":(typeof s=="number"||typeof t=="number")&&(i=s<t);break;case"<=":(typeof s=="number"||typeof t=="number")&&(i=s<=t);break;case">":(typeof s=="number"||typeof t=="number")&&(i=s>t);break;case">=":(typeof s=="number"||typeof t=="number")&&(i=s>=t);break;case"/":i=String(s).startsWith(String(t));break}return i};var S1=Object.defineProperty,A1=Object.getOwnPropertyDescriptor,If=(s,e,t,i)=>{for(var n=A1(e,t),r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&S1(e,t,n),n},rt;const Mc=(rt=class extends Ce{constructor(){super(...arguments),this._previousContainer=null,this._visible=!1}get placement(){return this._placement}set placement(s){this._placement=s,this.updatePosition()}static removeMenus(){for(const s of[...rt.dialog.children])s instanceof rt&&(s.remove(),s.visible=!1);setTimeout(()=>{rt.dialog.close(),rt.dialog.remove()},310)}get visible(){return this._visible}set visible(s){this._visible=s,s?(rt.dialog.parentElement||document.body.append(rt.dialog),this._previousContainer=this.parentElement,rt.dialog.style.top=`${window.scrollY||document.documentElement.scrollTop}px`,this.style.setProperty("display","flex"),rt.dialog.append(this),rt.dialog.showModal(),this.updatePosition(),this.dispatchEvent(new Event("visible"))):setTimeout(()=>{var e;(e=this._previousContainer)==null||e.append(this),this._previousContainer=null,this.style.setProperty("display","none"),this.dispatchEvent(new Event("hidden"))},310)}async updatePosition(){if(!(this.visible&&this._previousContainer))return;const s=this.placement??"right",e=await Jp(this._previousContainer,this,{placement:s,middleware:[Rp(10),Kp(),Qp(),Xp({padding:5})]}),{x:t,y:i}=e;this.style.left=`${t}px`,this.style.top=`${i}px`}connectedCallback(){super.connectedCallback(),this.visible?(this.style.setProperty("width","auto"),this.style.setProperty("height","auto")):(this.style.setProperty("display","none"),this.style.setProperty("width","0"),this.style.setProperty("height","0"))}render(){return H` <slot></slot> `}},rt.styles=[Xi.scrollbar,$e`
      :host {
        pointer-events: auto;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 999;
        overflow: auto;
        max-height: 20rem;
        min-width: 3rem;
        flex-direction: column;
        box-shadow: 1px 2px 8px 2px rgba(0, 0, 0, 0.15);
        padding: 0.5rem;
        border-radius: var(--bim-ui_size-4xs);
        display: flex;
        transform-origin: top left;
        transform: scale(1);
        clip-path: circle(150% at top left);
        background-color: var(--bim-ui_bg-contrast-20);
        transition:
          clip-path 0.2s cubic-bezier(0.72, 0.1, 0.43, 0.93),
          transform 0.3s cubic-bezier(0.72, 0.1, 0.45, 2.35);
      }

      :host(:not([visible])) {
        transform: scale(0.8);
        clip-path: circle(0 at top left);
      }
    `],rt.dialog=Ye.create(()=>H` <dialog
      @click=${s=>{s.target===rt.dialog&&rt.removeMenus()}}
      @cancel=${()=>rt.removeMenus()}
      data-context-dialog
      style="
      width: 0;
      height: 0;
      position: relative;
      padding: 0;
      border: none;
      outline: none;
      margin: none;
      overflow: visible;
      background-color: transparent;
    "
    ></dialog>`),rt);If([W({type:String,reflect:!0})],Mc.prototype,"placement");If([W({type:Boolean,reflect:!0})],Mc.prototype,"visible");let er=Mc;var $1=Object.defineProperty,T1=Object.getOwnPropertyDescriptor,Zt=(s,e,t,i)=>{for(var n=i>1?void 0:i?T1(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&$1(e,t,n),n},Rn;const Nt=(Rn=class extends Ce{constructor(){super(),this.labelHidden=!1,this.active=!1,this.disabled=!1,this.vertical=!1,this.tooltipVisible=!1,this._stateBeforeLoading={disabled:!1,icon:""},this._loading=!1,this._parent=nn(),this._tooltip=nn(),this._mouseLeave=!1,this.onClick=s=>{s.stopPropagation(),this.disabled||this.dispatchEvent(new Event("click"))},this.showContextMenu=()=>{let s=this._contextMenu;if(this.contextMenuTemplate&&(s=Ye.create(()=>{const e=Ye.create(this.contextMenuTemplate);return e instanceof er?H`${e}`:H`
          <bim-context-menu>${e}</bim-context-menu>
        `}),this.append(s),s.addEventListener("hidden",()=>{s==null||s.remove()})),s){const e=this.getAttribute("data-context-group");e&&s.setAttribute("data-context-group",e),this.closeNestedContexts();const t=lt.newRandomId();for(const i of s.children)i instanceof Rn&&i.setAttribute("data-context-group",t);s.visible=!0}},this.mouseLeave=!0}set loading(s){if(this._loading=s,s)this._stateBeforeLoading={disabled:this.disabled,icon:this.icon},this.disabled=s,this.icon="eos-icons:loading";else{const{disabled:e,icon:t}=this._stateBeforeLoading;this.disabled=e,this.icon=t}}get loading(){return this._loading}set mouseLeave(s){this._mouseLeave=s,s&&(this.tooltipVisible=!1,clearTimeout(this.timeoutID))}get mouseLeave(){return this._mouseLeave}computeTooltipPosition(){const{value:s}=this._parent,{value:e}=this._tooltip;s&&e&&Jp(s,e,{placement:"bottom",middleware:[Rp(10),Kp(),Qp(),Xp({padding:5})]}).then(t=>{const{x:i,y:n}=t;Object.assign(e.style,{left:`${i}px`,top:`${n}px`})})}onMouseEnter(){if(!(this.tooltipTitle||this.tooltipText))return;this.mouseLeave=!1;const s=this.tooltipTime??700;this.timeoutID=setTimeout(()=>{this.mouseLeave||(this.computeTooltipPosition(),this.tooltipVisible=!0)},s)}closeNestedContexts(){const s=this.getAttribute("data-context-group");if(s)for(const e of er.dialog.children){const t=e.getAttribute("data-context-group");if(e instanceof er&&t===s){e.visible=!1,e.removeAttribute("data-context-group");for(const i of e.children)i instanceof Rn&&(i.closeNestedContexts(),i.removeAttribute("data-context-group"))}}}click(){this.disabled||super.click()}get _contextMenu(){return this.querySelector("bim-context-menu")}connectedCallback(){super.connectedCallback(),this.addEventListener("click",this.showContextMenu)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("click",this.showContextMenu)}render(){const s=H`
      <div ${Ke(this._tooltip)} class="tooltip">
        ${this.tooltipTitle?H`<p style="text-wrap: nowrap;">
              <strong>${this.tooltipTitle}</strong>
            </p>`:null}
        ${this.tooltipText?H`<p style="width: 9rem;">${this.tooltipText}</p>`:null}
      </div>
    `;let e=H`${this.label}`;if((this._contextMenu||this.contextMenuTemplate)&&this.label){const t=H`<svg
        xmlns="http://www.w3.org/2000/svg"
        height="1.125rem"
        viewBox="0 0 24 24"
        width="1.125rem"
        style="fill: var(--bim-label--c)"
      >
        <path d="M0 0h24v24H0V0z" fill="none" />
        <path d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
      </svg>`;e=H`
        <div style="display: flex; align-items: center;">
          ${this.label}
          ${t}
        </div>
      `}return H`
      <div ${Ke(this._parent)} class="parent" @click=${this.onClick}>
        ${this.label||this.icon?H`
              <div
                class="button"
                @mouseenter=${this.onMouseEnter}
                @mouseleave=${()=>this.mouseLeave=!0}
              >
                <bim-label
                  .icon=${this.icon}
                  .vertical=${this.vertical}
                  .labelHidden=${this.labelHidden}
                  >${e}</bim-label
                >
              </div>
            `:null}
        ${this.tooltipTitle||this.tooltipText?s:null}
      </div>
      <slot></slot>
    `}},Rn.styles=$e`
    :host {
      --bim-label--c: var(--bim-ui_bg-contrast-100, white);
      position: relative;
      display: block;
      flex: 1;
      pointer-events: none;
      background-color: var(--bim-button--bgc, var(--bim-ui_bg-contrast-20));
      border-radius: var(--bim-ui_size-4xs);
      transition: all 0.15s;
    }

    :host(:not([disabled]))::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: inherit;
      background-color: var(--bim-ui_main-base);
      clip-path: circle(0 at center center);
      box-sizing: border-box;
      transition:
        clip-path 0.3s cubic-bezier(0.65, 0.05, 0.36, 1),
        transform 0.15s;
    }

    :host(:not([disabled]):hover) {
      cursor: pointer;
    }

    bim-label {
      pointer-events: none;
    }

    .parent {
      --bim-icon--c: var(--bim-label--c);
      position: relative;
      display: flex;
      height: 100%;
      user-select: none;
      row-gap: 0.125rem;
      min-height: var(--bim-ui_size-5xl);
      min-width: var(--bim-ui_size-5xl);
    }

    .button,
    .children {
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
    }

    .children {
      padding: 0 0.375rem;
      position: absolute;
      height: 100%;
      right: 0;
    }

    :host(:not([label-hidden])[icon][vertical]) .parent {
      min-height: 2.5rem;
    }

    .button {
      flex-grow: 1;
      transition: transform 0.15s;
    }

    :host(:not([label-hidden])[label]) .button {
      justify-content: var(--bim-button--jc, center);
    }

    :host(:hover)::before {
      clip-path: circle(120% at center center);
    }

    :host(:hover) {
      --bim-label--c: var(--bim-ui_main-contrast);
      z-index: 2;
    }

    :host([active]) {
      background-color: var(--bim-ui_main-base);
    }

    :host(:not([disabled]):active) {
      background: transparent;
    }

    :host(:not([disabled]):active) .button,
    :host(:not([disabled]):active)::before {
      transform: scale(0.98);
    }

    :host(:not([label]):not([icon])) .children {
      flex: 1;
    }

    :host([vertical]) .parent {
      justify-content: center;
    }

    :host(:not([label-hidden])[label]) .button {
      padding: 0 0.5rem;
    }

    :host([disabled]) {
      --bim-label--c: var(--bim-ui_bg-contrast-80) !important;
      background-color: gray !important;
    }

    ::slotted(bim-button) {
      --bim-icon--fz: var(--bim-ui_size-base);
      --bim-button--bdrs: var(--bim-ui_size-4xs);
      --bim-button--olw: 0;
      --bim-button--olc: transparent;
    }

    .tooltip {
      position: absolute;
      padding: 0.75rem;
      z-index: 99;
      display: flex;
      flex-flow: column;
      row-gap: 0.375rem;
      box-shadow: 0 0 10px 3px rgba(0 0 0 / 20%);
      outline: 1px solid var(--bim-ui_bg-contrast-40);
      font-size: var(--bim-ui_size-xs);
      border-radius: var(--bim-ui_size-4xs);
      background-color: var(--bim-ui_bg-contrast-20);
      color: var(--bim-ui_bg-contrast-100);
      animation: openTooltips 0.15s ease-out forwards;
      transition: visibility 0.2s;
    }

    .tooltip p {
      margin: 0;
      padding: 0;
    }

    :host(:not([tooltip-visible])) .tooltip {
      animation: closeTooltips 0.15s ease-in forwards;
      visibility: hidden;
      display: none;
    }

    @keyframes closeTooltips {
      0% {
        display: flex;
        padding: 0.75rem;
        transform: translateY(0);
        opacity: 1;
      }
      90% {
        padding: 0.75rem;
      }
      100% {
        display: none;
        padding: 0;
        transform: translateY(-10px);
        opacity: 0;
      }
    }

    @keyframes openTooltips {
      0% {
        display: flex;
        transform: translateY(-10px);
        opacity: 0;
      }
      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }
  `,Rn);Zt([W({type:String,reflect:!0})],Nt.prototype,"label",2);Zt([W({type:Boolean,attribute:"label-hidden",reflect:!0})],Nt.prototype,"labelHidden",2);Zt([W({type:Boolean,reflect:!0})],Nt.prototype,"active",2);Zt([W({type:Boolean,reflect:!0,attribute:"disabled"})],Nt.prototype,"disabled",2);Zt([W({type:String,reflect:!0})],Nt.prototype,"icon",2);Zt([W({type:Boolean,reflect:!0})],Nt.prototype,"vertical",2);Zt([W({type:Number,attribute:"tooltip-time",reflect:!0})],Nt.prototype,"tooltipTime",2);Zt([W({type:Boolean,attribute:"tooltip-visible",reflect:!0})],Nt.prototype,"tooltipVisible",2);Zt([W({type:String,attribute:"tooltip-title",reflect:!0})],Nt.prototype,"tooltipTitle",2);Zt([W({type:String,attribute:"tooltip-text",reflect:!0})],Nt.prototype,"tooltipText",2);Zt([W({type:Boolean,reflect:!0})],Nt.prototype,"loading",1);let k1=Nt;var P1=Object.defineProperty,Cr=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&P1(e,t,n),n};const zf=class extends Ce{constructor(){super(...arguments),this.checked=!1,this.inverted=!1,this.onValueChange=new Event("change")}get value(){return this.checked}onChange(s){s.stopPropagation(),this.checked=s.target.checked,this.dispatchEvent(this.onValueChange)}render(){const s=H`
      <svg viewBox="0 0 21 21">
        <polyline points="5 10.75 8.5 14.25 16 6"></polyline>
      </svg>
    `;return H`
      <div class="parent">
        <label class="parent-label">
          ${this.label?H`<bim-label .icon="${this.icon}">${this.label}</bim-label> `:null}
          <div class="input-container">
            <input
              type="checkbox"
              aria-label=${this.label||this.name||"Checkbox Input"}
              @change="${this.onChange}"
              .checked="${this.checked}"
            />
            ${s}
          </div>
        </label>
      </div>
    `}};zf.styles=$e`
    :host {
      display: block;
    }

    .parent-label {
      --background: #fff;
      --border: #dfdfe6;
      --stroke: #fff;
      --border-hover: var(--bim-ui_main-base);
      --border-active: var(--bim-ui_main-base);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      width: 100%;
      height: 1.75rem;
      column-gap: 0.25rem;
      position: relative;
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }

    :host([inverted]) .parent-label {
      flex-direction: row-reverse;
      justify-content: start;
    }

    input,
    svg {
      width: 1rem;
      height: 1rem;
      display: block;
    }

    input {
      -webkit-appearance: none;
      -moz-appearance: none;
      position: relative;
      outline: none;
      background: var(--background);
      border: none;
      margin: 0;
      padding: 0;
      cursor: pointer;
      border-radius: 4px;
      transition: box-shadow 0.3s;
      box-shadow: inset 0 0 0 var(--s, 1px) var(--b, var(--border));
    }

    svg {
      pointer-events: none;
      fill: none;
      stroke-width: 2.2px;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke: var(--stroke, var(--border-active));
      transform: translateY(-100%) scale(0);
      position: absolute;
      width: 1rem;
      height: 1rem;
    }

    input:hover {
      --s: 2px;
      --b: var(--border-hover);
    }

    input:checked {
      --b: var(--border-active);
      --s: 11px;
    }

    input:checked + svg {
      -webkit-animation: bounce 0.4s linear forwards 0.2s;
      animation: bounce 0.4s linear forwards 0.2s;
    }

    @keyframes bounce {
      0% {
        transform: translateY(-100%) scale(0);
      }
      50% {
        transform: translateY(-100%) scale(1.2);
      }
      75% {
        transform: translateY(-100%) scale(0.9);
      }
      100% {
        transform: translateY(-100%) scale(1);
      }
    }
  `;let hn=zf;Cr([W({type:String,reflect:!0})],hn.prototype,"icon");Cr([W({type:String,reflect:!0})],hn.prototype,"name");Cr([W({type:String,reflect:!0})],hn.prototype,"label");Cr([W({type:Boolean,reflect:!0})],hn.prototype,"checked");Cr([W({type:Boolean,reflect:!0})],hn.prototype,"inverted");var O1=Object.defineProperty,bs=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&O1(e,t,n),n};const Df=class extends Ce{constructor(){super(...arguments),this.vertical=!1,this.color="#bcf124",this.disabled=!1,this._colorInput=nn(),this._textInput=nn(),this.onValueChange=new Event("input"),this.onOpacityInput=s=>{const e=s.target;this.opacity=e.value,this.dispatchEvent(this.onValueChange)}}set value(s){const{color:e,opacity:t}=s;this.color=e,t&&(this.opacity=t)}get value(){const s={color:this.color};return this.opacity&&(s.opacity=this.opacity),s}onColorInput(s){s.stopPropagation();const{value:e}=this._colorInput;e&&(this.color=e.value,this.dispatchEvent(this.onValueChange))}onTextInput(s){s.stopPropagation();const{value:e}=this._textInput;if(!e)return;const{value:t}=e;let i=t.replace(/[^a-fA-F0-9]/g,"");i.startsWith("#")||(i=`#${i}`),e.value=i.slice(0,7),e.value.length===7&&(this.color=e.value,this.dispatchEvent(this.onValueChange))}focus(){const{value:s}=this._colorInput;s&&s.click()}render(){return H`
      <div class="parent">
        <bim-input
          .label=${this.label}
          .icon=${this.icon}
          .vertical="${this.vertical}"
        >
          <div class="color-container">
            <div
              style="display: flex; align-items: center; gap: .375rem; height: 100%; flex: 1; padding: 0 0.5rem;"
            >
              <input
                ${Ke(this._colorInput)}
                @input="${this.onColorInput}"
                type="color"
                aria-label=${this.label||this.name||"Color Input"}
                value="${this.color}"
                ?disabled=${this.disabled}
              />
              <div
                @click=${this.focus}
                class="sample"
                style="background-color: ${this.color}"
              ></div>
              <input
                ${Ke(this._textInput)}
                @input="${this.onTextInput}"
                value="${this.color}"
                type="text"
                aria-label=${this.label||this.name||"Text Color Input"}
                ?disabled=${this.disabled}
              />
            </div>
            ${this.opacity!==void 0?H`<bim-number-input
                  @change=${this.onOpacityInput}
                  slider
                  suffix="%"
                  min="0"
                  value=${this.opacity}
                  max="100"
                ></bim-number-input>`:null}
          </div>
        </bim-input>
      </div>
    `}};Df.styles=$e`
    :host {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
      flex: 1;
      display: block;
    }

    :host(:focus) {
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(--bim-ui_accent-base);
    }

    .parent {
      display: flex;
      gap: 0.375rem;
    }

    .color-container {
      position: relative;
      outline: none;
      display: flex;
      height: 100%;
      gap: 0.5rem;
      justify-content: flex-start;
      align-items: center;
      flex: 1;
      border-radius: var(--bim-color-input--bdrs, var(--bim-ui_size-4xs));
    }

    .color-container input[type="color"] {
      position: absolute;
      bottom: -0.25rem;
      visibility: hidden;
      width: 0;
      height: 0;
    }

    .color-container .sample {
      width: 1rem;
      height: 1rem;
      border-radius: 0.125rem;
      background-color: #fff;
    }

    .color-container input[type="text"] {
      height: 100%;
      flex: 1;
      width: 3.25rem;
      text-transform: uppercase;
      font-size: 0.75rem;
      background-color: transparent;
      padding: 0%;
      outline: none;
      border: none;
      color: var(--bim-color-input--c, var(--bim-ui_bg-contrast-100));
    }

    :host([disabled]) .color-container input[type="text"] {
      color: var(--bim-ui_bg-contrast-60);
    }

    bim-number-input {
      flex-grow: 0;
    }
  `;let Qi=Df;bs([W({type:String,reflect:!0})],Qi.prototype,"name");bs([W({type:String,reflect:!0})],Qi.prototype,"label");bs([W({type:String,reflect:!0})],Qi.prototype,"icon");bs([W({type:Boolean,reflect:!0})],Qi.prototype,"vertical");bs([W({type:Number,reflect:!0})],Qi.prototype,"opacity");bs([W({type:String,reflect:!0})],Qi.prototype,"color");bs([W({type:Boolean,reflect:!0})],Qi.prototype,"disabled");var M1=Object.defineProperty,I1=Object.getOwnPropertyDescriptor,Ki=(s,e,t,i)=>{for(var n=i>1?void 0:i?I1(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&M1(e,t,n),n};const Lf=class extends Ce{constructor(){super(...arguments),this.checked=!1,this.checkbox=!1,this.noMark=!1,this.vertical=!1}get value(){return this._value!==void 0?this._value:this.label?ca(this.label):this.label}set value(s){this._value=s}render(){return H`
      <div class="parent" .title=${this.label??""}>
        ${this.img||this.icon||this.label?H` <div style="display: flex; column-gap: 0.375rem">
              ${this.checkbox&&!this.noMark?H`<bim-checkbox
                    style="pointer-events: none"
                    .checked=${this.checked}
                  ></bim-checkbox>`:null}
              <bim-label
                .vertical=${this.vertical}
                .icon=${this.icon}
                .img=${this.img}
                >${this.label}</bim-label
              >
            </div>`:null}
        ${!this.checkbox&&!this.noMark&&this.checked?H`<svg
              xmlns="http://www.w3.org/2000/svg"
              height="1.125rem"
              viewBox="0 0 24 24"
              width="1.125rem"
              fill="#FFFFFF"
            >
              <path d="M0 0h24v24H0z" fill="none" />
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
            </svg>`:null}
        <slot></slot>
      </div>
    `}};Lf.styles=$e`
    :host {
      --bim-label--c: var(--bim-ui_bg-contrast-100);
      display: block;
      box-sizing: border-box;
      flex: 1;
      padding: 0rem 0.5rem;
      border-radius: var(--bim-ui_size-4xs);
      transition: all 0.15s;
    }

    :host(:hover) {
      cursor: pointer;
    }

    :host([checked]) {
      --bim-label--c: color-mix(in lab, var(--bim-ui_main-base), white 30%);
    }

    :host([checked]) svg {
      fill: color-mix(in lab, var(--bim-ui_main-base), white 30%);
    }

    .parent {
      box-sizing: border-box;
      display: flex;
      justify-content: var(--bim-option--jc, space-between);
      column-gap: 0.5rem;
      align-items: center;
      min-height: 1.75rem;
      height: 100%;
    }

    input {
      height: 1rem;
      width: 1rem;
      cursor: pointer;
      border: none;
      outline: none;
      accent-color: var(--bim-checkbox--c, var(--bim-ui_main-base));
    }

    input:focus {
      outline: var(--bim-checkbox--olw, 2px) solid
        var(--bim-checkbox--olc, var(--bim-ui_accent-base));
    }

    bim-label {
      pointer-events: none;
      z-index: 1;
    }
  `;let Xe=Lf;Ki([W({type:String,reflect:!0})],Xe.prototype,"img",2);Ki([W({type:String,reflect:!0})],Xe.prototype,"label",2);Ki([W({type:String,reflect:!0})],Xe.prototype,"icon",2);Ki([W({type:Boolean,reflect:!0})],Xe.prototype,"checked",2);Ki([W({type:Boolean,reflect:!0})],Xe.prototype,"checkbox",2);Ki([W({type:Boolean,attribute:"no-mark",reflect:!0})],Xe.prototype,"noMark",2);Ki([W({converter:{fromAttribute(s){return s&&ca(s)}}})],Xe.prototype,"value",1);Ki([W({type:Boolean,reflect:!0})],Xe.prototype,"vertical",2);var z1=Object.defineProperty,D1=Object.getOwnPropertyDescriptor,Ci=(s,e,t,i)=>{for(var n=i>1?void 0:i?D1(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&z1(e,t,n),n};const Bf=class extends Ye{constructor(){super(),this.multiple=!1,this.required=!1,this.vertical=!1,this._visible=!1,this._value=new Set,this.onValueChange=new Event("change"),this._contextMenu=nn(),this.onOptionClick=s=>{const e=s.target,t=this._value.has(e);if(!this.multiple&&!this.required&&!t)this._value=new Set([e]);else if(!this.multiple&&!this.required&&t)this._value=new Set([]);else if(!this.multiple&&this.required&&!t)this._value=new Set([e]);else if(this.multiple&&!this.required&&!t)this._value=new Set([...this._value,e]);else if(this.multiple&&!this.required&&t){const i=[...this._value].filter(n=>n!==e);this._value=new Set(i)}else if(this.multiple&&this.required&&!t)this._value=new Set([...this._value,e]);else if(this.multiple&&this.required&&t){const i=[...this._value].filter(r=>r!==e),n=new Set(i);n.size!==0&&(this._value=n)}this.updateOptionsState(),this.dispatchEvent(this.onValueChange)},this.useObserver=!0}set visible(s){if(s){const{value:e}=this._contextMenu;if(!e)return;for(const t of this.elements)e.append(t);this._visible=!0}else{for(const e of this.elements)this.append(e);this._visible=!1,this.resetVisibleElements()}}get visible(){return this._visible}set value(s){if(this.required&&Object.keys(s).length===0)return;const e=new Set;for(const t of s){const i=this.findOption(t);if(i&&(e.add(i),!this.multiple&&Object.keys(s).length===1))break}this._value=e,this.updateOptionsState(),this.dispatchEvent(this.onValueChange)}get value(){return[...this._value].filter(s=>s instanceof Xe&&s.checked).map(s=>s.value)}get _options(){const s=new Set([...this.elements]);for(const e of this.children)e instanceof Xe&&s.add(e);return[...s]}onSlotChange(s){const e=s.target.assignedElements();this.observe(e);const t=new Set;for(const i of this.elements){if(!(i instanceof Xe)){i.remove();continue}i.checked&&t.add(i),i.removeEventListener("click",this.onOptionClick),i.addEventListener("click",this.onOptionClick)}this._value=t}updateOptionsState(){for(const s of this._options)s instanceof Xe&&(s.checked=this._value.has(s))}findOption(s){return this._options.find(e=>e instanceof Xe?e.label===s||e.value===s:!1)}render(){let s,e,t;if(this._value.size===0)s=this.placeholder??"Select an option...";else if(this._value.size===1){const i=[...this._value][0];s=(i==null?void 0:i.label)||(i==null?void 0:i.value),e=i==null?void 0:i.img,t=i==null?void 0:i.icon}else s=`Multiple (${this._value.size})`;return H`
      <bim-input
        title=${this.label??""}
        .label=${this.label}
        .icon=${this.icon}
        .vertical=${this.vertical}
      >
        <div class="input" @click=${()=>this.visible=!this.visible}>
          <bim-label
            .img=${e}
            .icon=${t}
            style="overflow: hidden;"
            >${s}</bim-label
          >
          <svg
            style="flex-shrink: 0; fill: var(--bim-dropdown--c, var(--bim-ui_bg-contrast-100))"
            xmlns="http://www.w3.org/2000/svg"
            height="1.125rem"
            viewBox="0 0 24 24"
            width="1.125rem"
            fill="#9ca3af"
          >
            <path d="M0 0h24v24H0V0z" fill="none" />
            <path d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
          </svg>
          <bim-context-menu
            ${Ke(this._contextMenu)}
            .visible=${this.visible}
            @hidden=${()=>{this.visible&&(this.visible=!1)}}
          >
            <slot @slotchange=${this.onSlotChange}></slot>
          </bim-context-menu>
        </div>
      </bim-input>
    `}};Bf.styles=[Xi.scrollbar,$e`
      :host {
        --bim-input--bgc: var(
          --bim-dropdown--bgc,
          var(--bim-ui_bg-contrast-20)
        );
        --bim-input--olw: 2px;
        --bim-input--olc: transparent;
        --bim-input--bdrs: var(--bim-ui_size-4xs);
        flex: 1;
        display: block;
      }

      :host([visible]) {
        --bim-input--olc: var(--bim-ui_accent-base);
      }

      .input {
        --bim-label--fz: var(--bim-drodown--fz, var(--bim-ui_size-xs));
        --bim-label--c: var(--bim-dropdown--c, var(--bim-ui_bg-contrast-100));
        height: 100%;
        display: flex;
        flex: 1;
        overflow: hidden;
        column-gap: 0.25rem;
        outline: none;
        cursor: pointer;
        align-items: center;
        justify-content: space-between;
        padding: 0 0.5rem;
      }

      bim-label {
        pointer-events: none;
      }
    `];let ci=Bf;Ci([W({type:String,reflect:!0})],ci.prototype,"name",2);Ci([W({type:String,reflect:!0})],ci.prototype,"icon",2);Ci([W({type:String,reflect:!0})],ci.prototype,"label",2);Ci([W({type:Boolean,reflect:!0})],ci.prototype,"multiple",2);Ci([W({type:Boolean,reflect:!0})],ci.prototype,"required",2);Ci([W({type:Boolean,reflect:!0})],ci.prototype,"vertical",2);Ci([W({type:String,reflect:!0})],ci.prototype,"placeholder",2);Ci([W({type:Boolean,reflect:!0})],ci.prototype,"visible",1);Ci([gs()],ci.prototype,"_value",2);var L1=Object.defineProperty,Nf=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&L1(e,t,n),n};const Rf=class extends Ce{constructor(){super(...arguments),this.floating=!1,this._layouts={},this._elements={},this._templateIds=new Map,this._updateFunctions={},this._slotNames={notAllowed:"not-allowed",notFound:"not-found",emptyLayout:"empty-layout"},this.updateComponent={},this.emitLayoutChange=()=>{this.dispatchEvent(new Event("layoutchange"))}}set layouts(s){this._layouts=s,this._templateIds.clear()}get layouts(){return this._layouts}set elements(s){this._elements=s,this.setUpdateFunctions()}get elements(){return this._elements}getLayoutAreas(s){const{template:e}=s,t=e.split(`
`).map(i=>i.trim()).map(i=>i.split('"')[1]).filter(i=>i!==void 0).flatMap(i=>i.split(/\s+/));return[...new Set(t)].filter(i=>i!=="")}setUpdateFunctions(){const s={};for(const[e,t]of Object.entries(this.elements))"template"in t&&(s[e]=i=>{var n,r;(r=(n=this._updateFunctions)[e])==null||r.call(n,i)});this.updateComponent=s}disconnectedCallback(){super.disconnectedCallback(),this._templateIds.clear(),this._updateFunctions={},this.updateComponent={}}getTemplateId(s){let e=this._templateIds.get(s);return e||(e=lt.newRandomId(),this._templateIds.set(s,e)),e}cleanUpdateFunctions(){if(!this.layout){this._updateFunctions={};return}const s=this.layouts[this.layout],e=this.getLayoutAreas(s);for(const t in this.elements)e.includes(t)||delete this._updateFunctions[t]}clean(){this.style.gridTemplate="";for(const s of[...this.children])Object.values(this._slotNames).some(e=>s.getAttribute("slot")===e)||s.remove();this.cleanUpdateFunctions()}emitElementCreation(s){this.dispatchEvent(new CustomEvent("elementcreated",{detail:s}))}render(){if(this.layout){const s=this.layouts[this.layout];if(s){if(!(s.guard??(()=>!0))())return this.clean(),H`<slot name=${this._slotNames.notAllowed}></slot>`;const e=this.getLayoutAreas(s).map(t=>{var i;const n=((i=s.elements)==null?void 0:i[t])||this.elements[t];if(!n)return null;if(n instanceof HTMLElement)return n.style.gridArea=t,n;if("template"in n){const{template:l,initialState:c}=n,h=this.getTemplateId(l),d=this.querySelector(`[data-grid-template-id="${h}"]`);if(d)return d;const[p,u]=Ye.create(l,c);return this.emitElementCreation({name:t,element:p}),p.setAttribute("data-grid-template-id",h),p.style.gridArea=t,this._updateFunctions[t]=u,p}const r=this.getTemplateId(n),o=this.querySelector(`[data-grid-template-id="${r}"]`);if(o)return o;const a=Ye.create(n);return this.emitElementCreation({name:t,element:a}),a.setAttribute("data-grid-template-id",this.getTemplateId(n)),a.style.gridArea=t,a}).filter(t=>t!==null);this.clean(),this.style.gridTemplate=s.template,this.append(...e),this.emitLayoutChange()}else return this.clean(),H`<slot name=${this._slotNames.notFound}></slot>`}else return this.clean(),this.emitLayoutChange(),H`<slot name=${this._slotNames.emptyLayout}></slot>`;return H`${H`<slot></slot>`}`}};Rf.styles=$e`
    :host {
      display: grid;
      height: 100%;
      width: 100%;
      overflow: hidden;
      box-sizing: border-box;
    }

    /* :host(:not([layout])) {
      display: none;
    } */

    :host([floating]) {
      --bim-panel--bdrs: var(--bim-ui_size-4xs);
      background-color: transparent;
      padding: 1rem;
      gap: 1rem;
      position: absolute;
      pointer-events: none;
      top: 0px;
      left: 0px;
    }

    :host(:not([floating])) {
      --bim-panel--bdrs: 0;
      background-color: var(--bim-ui_bg-contrast-20);
      gap: 1px;
    }
  `;let Ic=Rf;Nf([W({type:Boolean,reflect:!0})],Ic.prototype,"floating");Nf([W({type:String,reflect:!0})],Ic.prototype,"layout");const Hl=class extends Ce{render(){return H`
      <iconify-icon .icon=${this.icon} height="none"></iconify-icon>
    `}};Hl.styles=$e`
    :host {
      height: var(--bim-icon--fz, var(--bim-ui_size-sm));
      width: var(--bim-icon--fz, var(--bim-ui_size-sm));
    }

    iconify-icon {
      height: var(--bim-icon--fz, var(--bim-ui_size-sm));
      width: var(--bim-icon--fz, var(--bim-ui_size-sm));
      color: var(--bim-icon--c);
      transition: all 0.15s;
      display: flex;
    }
  `,Hl.properties={icon:{type:String}};let B1=Hl;var N1=Object.defineProperty,ha=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&N1(e,t,n),n};const Uf=class extends Ce{constructor(){super(...arguments),this.vertical=!1,this.onValueChange=new Event("change")}get value(){const s={};for(const e of this.children){const t=e;"value"in t?s[t.name||t.label]=t.value:"checked"in t&&(s[t.name||t.label]=t.checked)}return s}set value(s){const e=[...this.children];for(const t in s){const i=e.find(o=>{const a=o;return a.name===t||a.label===t});if(!i)continue;const n=i,r=s[t];typeof r=="boolean"?n.checked=r:n.value=r}}render(){return H`
      <div class="parent">
        ${this.label||this.icon?H`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        <div class="input">
          <slot></slot>
        </div>
      </div>
    `}};Uf.styles=$e`
    :host {
      flex: 1;
      display: block;
    }

    .parent {
      display: flex;
      flex-wrap: wrap;
      column-gap: 1rem;
      row-gap: 0.375rem;
      user-select: none;
      flex: 1;
    }

    :host(:not([vertical])) .parent {
      justify-content: space-between;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    .input {
      position: relative;
      overflow: hidden;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      min-height: 1.75rem;
      min-width: 3rem;
      gap: var(--bim-input--g, var(--bim-ui_size-4xs));
      padding: var(--bim-input--p, 0);
      background-color: var(--bim-input--bgc, transparent);
      border: var(--bim-input--olw, 2px) solid
        var(--bim-input--olc, transparent);
      border-radius: var(--bim-input--bdrs, var(--bim-ui_size-4xs));
      transition: all 0.15s;
    }

    :host(:not([vertical])) .input {
      flex: 1;
      justify-content: flex-end;
    }

    :host(:not([vertical])[label]) .input {
      max-width: fit-content;
    }
  `;let Er=Uf;ha([W({type:String,reflect:!0})],Er.prototype,"name");ha([W({type:String,reflect:!0})],Er.prototype,"label");ha([W({type:String,reflect:!0})],Er.prototype,"icon");ha([W({type:Boolean,reflect:!0})],Er.prototype,"vertical");/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Vs(s,e,t){return s?e(s):t==null?void 0:t(s)}/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Vl=s=>s??Ie;var R1=Object.defineProperty,Sr=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&R1(e,t,n),n};const Ff=class extends Ce{constructor(){super(...arguments),this.labelHidden=!1,this.iconHidden=!1,this.vertical=!1,this._imgTemplate=()=>H`<img src=${Vl(this.img)} .alt=${this.textContent||""} />`,this._iconTemplate=()=>H`<bim-icon .icon=${this.icon}></bim-icon>`}get value(){return this.textContent?ca(this.textContent):this.textContent}render(){return H`
      <div class="parent" title=${this.textContent}>
        ${Vs(this.img,this._imgTemplate,()=>Ie)}
        ${Vs(!this.iconHidden&&this.icon,this._iconTemplate,()=>Ie)}
        <p><slot></slot></p>
      </div>
    `}};Ff.styles=$e`
    :host {
      --bim-icon--c: var(--bim-label--ic);
      overflow: auto;
      color: var(--bim-label--c, var(--bim-ui_bg-contrast-60));
      font-size: var(--bim-label--fz, var(--bim-ui_size-xs));
      display: block;
      white-space: nowrap;
      transition: all 0.15s;
    }

    :host([icon]) {
      line-height: 1.1rem;
    }

    .parent {
      display: flex;
      align-items: center;
      column-gap: 0.25rem;
      row-gap: 0.125rem;
      user-select: none;
      height: 100%;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    .parent p {
      margin: 0;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    :host([label-hidden]) .parent p,
    :host(:empty) .parent p {
      display: none;
    }

    img {
      height: 100%;
      aspect-ratio: 1;
      border-radius: 100%;
      margin-right: 0.125rem;
    }

    :host(:not([vertical])) img {
      max-height: var(
        --bim-label_icon--sz,
        calc(var(--bim-label--fz, var(--bim-ui_size-xs)) * 1.8)
      );
    }

    :host([vertical]) img {
      max-height: var(
        --bim-label_icon--sz,
        calc(var(--bim-label--fz, var(--bim-ui_size-xs)) * 4)
      );
    }
  `;let dn=Ff;Sr([W({type:String,reflect:!0})],dn.prototype,"img");Sr([W({type:Boolean,attribute:"label-hidden",reflect:!0})],dn.prototype,"labelHidden");Sr([W({type:String,reflect:!0})],dn.prototype,"icon");Sr([W({type:Boolean,attribute:"icon-hidden",reflect:!0})],dn.prototype,"iconHidden");Sr([W({type:Boolean,reflect:!0})],dn.prototype,"vertical");var U1=Object.defineProperty,F1=Object.getOwnPropertyDescriptor,Rt=(s,e,t,i)=>{for(var n=i>1?void 0:i?F1(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&U1(e,t,n),n};const jf=class extends Ce{constructor(){super(...arguments),this._value=0,this.vertical=!1,this.slider=!1,this._input=nn(),this.onValueChange=new Event("change")}set value(s){this.setValue(s.toString())}get value(){return this._value}onChange(s){s.stopPropagation();const{value:e}=this._input;e&&this.setValue(e.value)}setValue(s){const{value:e}=this._input;let t=s;if(t=t.replace(/[^0-9.-]/g,""),t=t.replace(/(\..*)\./g,"$1"),t.endsWith(".")||(t.lastIndexOf("-")>0&&(t=t[0]+t.substring(1).replace(/-/g,"")),t==="-"||t==="-0"))return;let i=Number(t);Number.isNaN(i)||(i=this.min!==void 0?Math.max(i,this.min):i,i=this.max!==void 0?Math.min(i,this.max):i,this.value!==i&&(this._value=i,e&&(e.value=this.value.toString()),this.requestUpdate(),this.dispatchEvent(this.onValueChange)))}onBlur(){const{value:s}=this._input;s&&Number.isNaN(Number(s.value))&&(s.value=this.value.toString())}onSliderMouseDown(s){document.body.style.cursor="w-resize";const{clientX:e}=s,t=this.value;let i=!1;const n=a=>{var l;i=!0;const{clientX:c}=a,h=this.step??1,d=((l=h.toString().split(".")[1])==null?void 0:l.length)||0,p=1/(this.sensitivity??1),u=(c-e)/p;if(Math.floor(Math.abs(u))!==Math.abs(u))return;const g=t+u*h;this.setValue(g.toFixed(d))},r=()=>{this.slider=!0,this.removeEventListener("blur",r)},o=()=>{document.removeEventListener("mousemove",n),document.body.style.cursor="default",i?i=!1:(this.addEventListener("blur",r),this.slider=!1,requestAnimationFrame(()=>this.focus())),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)}onFocus(s){s.stopPropagation();const e=t=>{t.key==="Escape"&&(this.blur(),window.removeEventListener("keydown",e))};window.addEventListener("keydown",e)}connectedCallback(){super.connectedCallback(),this.min&&this.min>this.value&&(this._value=this.min),this.max&&this.max<this.value&&(this._value=this.max)}focus(){const{value:s}=this._input;s&&s.focus()}render(){const s=H`
      ${this.pref||this.icon?H`<bim-label
            style="pointer-events: auto"
            @mousedown=${this.onSliderMouseDown}
            .icon=${this.icon}
            >${this.pref}</bim-label
          >`:null}
      <input
        ${Ke(this._input)}
        type="text"
        aria-label=${this.label||this.name||"Number Input"}
        size="1"
        @input=${o=>o.stopPropagation()}
        @change=${this.onChange}
        @blur=${this.onBlur}
        @focus=${this.onFocus}
        .value=${this.value.toString()}
      />
      ${this.suffix?H`<bim-label
            style="pointer-events: auto"
            @mousedown=${this.onSliderMouseDown}
            >${this.suffix}</bim-label
          >`:null}
    `,e=this.min??-1/0,t=this.max??1/0,i=100*(this.value-e)/(t-e),n=H`
      <style>
        .slider-indicator {
          width: ${`${i}%`};
        }
      </style>
      <div class="slider" @mousedown=${this.onSliderMouseDown}>
        <div class="slider-indicator"></div>
        ${this.pref||this.icon?H`<bim-label
              style="z-index: 1; margin-right: 0.125rem"
              .icon=${this.icon}
              >${`${this.pref}: `}</bim-label
            >`:null}
        <bim-label style="z-index: 1;">${this.value}</bim-label>
        ${this.suffix?H`<bim-label style="z-index: 1;">${this.suffix}</bim-label>`:null}
      </div>
    `,r=`${this.label||this.name||this.pref?`${this.label||this.name||this.pref}: `:""}${this.value}${this.suffix??""}`;return H`
      <bim-input
        title=${r}
        .label=${this.label}
        .icon=${this.icon}
        .vertical=${this.vertical}
      >
        ${this.slider?n:s}
      </bim-input>
    `}};jf.styles=$e`
    :host {
      --bim-input--bgc: var(
        --bim-number-input--bgc,
        var(--bim-ui_bg-contrast-20)
      );
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(--bim-number-input--olc, transparent);
      --bim-input--bdrs: var(--bim-number-input--bdrs, var(--bim-ui_size-4xs));
      --bim-input--p: 0 0.375rem;
      flex: 1;
      display: block;
    }

    :host(:focus) {
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(
        --bim-number-input¡focus--c,
        var(--bim-ui_accent-base)
      );
    }

    :host(:not([slider])) bim-label {
      --bim-label--c: var(
        --bim-number-input_affixes--c,
        var(--bim-ui_bg-contrast-60)
      );
      --bim-label--fz: var(
        --bim-number-input_affixes--fz,
        var(--bim-ui_size-xs)
      );
    }

    p {
      margin: 0;
      padding: 0;
    }

    input {
      background-color: transparent;
      outline: none;
      border: none;
      padding: 0;
      flex-grow: 1;
      text-align: right;
      font-family: inherit;
      font-feature-settings: inherit;
      font-variation-settings: inherit;
      font-size: var(--bim-number-input--fz, var(--bim-ui_size-xs));
      color: var(--bim-number-input--c, var(--bim-ui_bg-contrast-100));
    }

    :host([suffix]:not([pref])) input {
      text-align: left;
    }

    :host([slider]) {
      --bim-input--p: 0;
    }

    :host([slider]) .slider {
      --bim-label--c: var(--bim-ui_bg-contrast-100);
    }

    .slider {
      position: relative;
      display: flex;
      justify-content: center;
      width: 100%;
      height: 100%;
      padding: 0 0.5rem;
    }

    .slider-indicator {
      height: 100%;
      background-color: var(--bim-ui_main-base);
      position: absolute;
      top: 0;
      left: 0;
      border-radius: var(--bim-input--bdrs, var(--bim-ui_size-4xs));
    }

    bim-input {
      display: flex;
    }

    bim-label {
      pointer-events: none;
    }
  `;let $t=jf;Rt([W({type:String,reflect:!0})],$t.prototype,"name",2);Rt([W({type:String,reflect:!0})],$t.prototype,"icon",2);Rt([W({type:String,reflect:!0})],$t.prototype,"label",2);Rt([W({type:String,reflect:!0})],$t.prototype,"pref",2);Rt([W({type:Number,reflect:!0})],$t.prototype,"min",2);Rt([W({type:Number,reflect:!0})],$t.prototype,"value",1);Rt([W({type:Number,reflect:!0})],$t.prototype,"step",2);Rt([W({type:Number,reflect:!0})],$t.prototype,"sensitivity",2);Rt([W({type:Number,reflect:!0})],$t.prototype,"max",2);Rt([W({type:String,reflect:!0})],$t.prototype,"suffix",2);Rt([W({type:Boolean,reflect:!0})],$t.prototype,"vertical",2);Rt([W({type:Boolean,reflect:!0})],$t.prototype,"slider",2);var j1=Object.defineProperty,H1=Object.getOwnPropertyDescriptor,Ar=(s,e,t,i)=>{for(var n=i>1?void 0:i?H1(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&j1(e,t,n),n};const Hf=class extends Ce{constructor(){super(...arguments),this.onValueChange=new Event("change"),this._hidden=!1,this.headerHidden=!1,this.valueTransform={},this.activationButton=document.createElement("bim-button")}set hidden(s){this._hidden=s,this.activationButton.active=!s,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}get value(){return gr(this,this.valueTransform)}set value(s){const e=[...this.children];for(const t in s){const i=e.find(r=>{const o=r;return o.name===t||o.label===t});if(!i)continue;const n=i;n.value=s[t]}}animatePanles(){const s=[{maxHeight:"100vh",maxWidth:"100vw",opacity:1},{maxHeight:"100vh",maxWidth:"100vw",opacity:0},{maxHeight:0,maxWidth:0,opacity:0}];this.animate(s,{duration:300,easing:"cubic-bezier(0.65, 0.05, 0.36, 1)",direction:this.hidden?"normal":"reverse",fill:"forwards"})}connectedCallback(){super.connectedCallback(),this.activationButton.active=!this.hidden,this.activationButton.onclick=()=>{this.hidden=!this.hidden,this.animatePanles()}}disconnectedCallback(){super.disconnectedCallback(),this.activationButton.remove()}collapseSections(){const s=this.querySelectorAll("bim-panel-section");for(const e of s)e.collapsed=!0}expandSections(){const s=this.querySelectorAll("bim-panel-section");for(const e of s)e.collapsed=!1}render(){return this.activationButton.icon=this.icon,this.activationButton.label=this.label||this.name,this.activationButton.tooltipTitle=this.label||this.name,H`
      <div class="parent">
        ${this.label||this.name||this.icon?H`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        <div class="sections">
          <slot></slot>
        </div>
      </div>
    `}};Hf.styles=[Xi.scrollbar,$e`
      :host {
        display: flex;
        border-radius: var(--bim-ui_size-base);
        background-color: var(--bim-ui_bg-base);
        overflow: auto;
      }

      :host([hidden]) {
        max-height: 0;
        max-width: 0;
        opacity: 0;
      }

      .parent {
        display: flex;
        flex: 1;
        flex-direction: column;
        pointer-events: auto;
        overflow: auto;
      }

      .parent bim-label {
        --bim-label--c: var(--bim-panel--c, var(--bim-ui_bg-contrast-80));
        --bim-label--fz: var(--bim-panel--fz, var(--bim-ui_size-sm));
        font-weight: 600;
        padding: 1rem;
        flex-shrink: 0;
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([header-hidden]) .parent bim-label {
        display: none;
      }

      .sections {
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow: auto;
        flex: 1;
      }

      ::slotted(bim-panel-section:not(:last-child)) {
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }
    `];let ys=Hf;Ar([W({type:String,reflect:!0})],ys.prototype,"icon",2);Ar([W({type:String,reflect:!0})],ys.prototype,"name",2);Ar([W({type:String,reflect:!0})],ys.prototype,"label",2);Ar([W({type:Boolean,reflect:!0})],ys.prototype,"hidden",1);Ar([W({type:Boolean,attribute:"header-hidden",reflect:!0})],ys.prototype,"headerHidden",2);var V1=Object.defineProperty,$r=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&V1(e,t,n),n};const Vf=class extends Ce{constructor(){super(...arguments),this.onValueChange=new Event("change"),this.valueTransform={},this.componentHeight=-1}get value(){const s=this.parentElement;let e;return s instanceof ys&&(e=s.valueTransform),Object.values(this.valueTransform).length!==0&&(e=this.valueTransform),gr(this,e)}set value(s){const e=[...this.children];for(const t in s){const i=e.find(r=>{const o=r;return o.name===t||o.label===t});if(!i)continue;const n=i;n.value=s[t]}}setFlexAfterTransition(){var s;const e=(s=this.shadowRoot)==null?void 0:s.querySelector(".components");e&&setTimeout(()=>{this.collapsed?e.style.removeProperty("flex"):e.style.setProperty("flex","1")},150)}animateHeader(){var s;const e=(s=this.shadowRoot)==null?void 0:s.querySelector(".components");this.componentHeight<0&&(this.collapsed?this.componentHeight=e.clientHeight:(e.style.setProperty("transition","none"),e.style.setProperty("height","auto"),e.style.setProperty("padding","0.125rem 1rem 1rem"),this.componentHeight=e.clientHeight,requestAnimationFrame(()=>{e.style.setProperty("height","0px"),e.style.setProperty("padding","0 1rem 0"),e.style.setProperty("transition","height 0.25s cubic-bezier(0.65, 0.05, 0.36, 1), padding 0.25s cubic-bezier(0.65, 0.05, 0.36, 1)")}))),this.collapsed?(e.style.setProperty("height",`${this.componentHeight}px`),requestAnimationFrame(()=>{e.style.setProperty("height","0px"),e.style.setProperty("padding","0 1rem 0")})):(e.style.setProperty("height","0px"),e.style.setProperty("padding","0 1rem 0"),requestAnimationFrame(()=>{e.style.setProperty("height",`${this.componentHeight}px`),e.style.setProperty("padding","0.125rem 1rem 1rem")})),this.setFlexAfterTransition()}onHeaderClick(){this.fixed||(this.collapsed=!this.collapsed,this.animateHeader())}handelSlotChange(s){s.target.assignedElements({flatten:!0}).forEach((e,t)=>{const i=t*.05;e.style.setProperty("transition-delay",`${i}s`)})}handlePointerEnter(){const s=this.renderRoot.querySelector(".expand-icon");this.collapsed?s==null||s.style.setProperty("animation","collapseAnim 0.5s"):s==null||s.style.setProperty("animation","expandAnim 0.5s")}handlePointerLeave(){const s=this.renderRoot.querySelector(".expand-icon");s==null||s.style.setProperty("animation","none")}render(){const s=this.label||this.icon||this.name||this.fixed,e=H`<svg
      xmlns="http://www.w3.org/2000/svg"
      height="1.125rem"
      viewBox="0 0 24 24"
      width="1.125rem"
      class="expand-icon"
    >
      <path d="M0 0h24v24H0z" fill="none" />
      <path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z" />
    </svg>`,t=H`
      <div
        class="header"
        title=${this.label??""}
        @pointerenter=${this.handlePointerEnter}
        @pointerleave=${this.handlePointerLeave}
        @click=${this.onHeaderClick}
      >
        ${this.label||this.icon||this.name?H`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        ${this.fixed?null:e}
      </div>
    `;return H`
      <div class="parent">
        ${s?t:null}
        <div class="components" style="flex: 1;">
          <div>
            <slot @slotchange=${this.handelSlotChange}></slot>
          </div>
        </div>
      </div>
    `}};Vf.styles=[Xi.scrollbar,$e`
      :host {
        display: block;
        pointer-events: auto;
      }

      :host .parent {
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      :host(:not([fixed])) .header:hover {
        --bim-label--c: var(--bim-ui_accent-base);
        color: var(--bim-ui_accent-base);
        cursor: pointer;
      }

      :host(:not([fixed])) .header:hover .expand-icon {
        fill: var(--bim-ui_accent-base);
      }

      .header {
        --bim-label--fz: var(--bim-ui_size-sm);
        --bim-label--c: var(
          --bim-panel-section_hc,
          var(--bim-ui_bg-contrast-80)
        );
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        height: 1.5rem;
        padding: 0.75rem 1rem;
      }

      .expand-icon {
        fill: var(--bim-ui_bg-contrast-80);
        transition: transform 0.2s;
      }

      :host([collapsed]) .expand-icon {
        transform: rotateZ(-180deg);
      }

      .title {
        display: flex;
        align-items: center;
        column-gap: 0.5rem;
      }

      .title p {
        font-size: var(--bim-ui_size-sm);
      }

      .components {
        display: flex;
        flex-direction: column;
        overflow: hidden;
        row-gap: 0.75rem;
        padding: 0 1rem 1rem;
        box-sizing: border-box;
        transition:
          height 0.25s cubic-bezier(0.65, 0.05, 0.36, 1),
          padding 0.25s cubic-bezier(0.65, 0.05, 0.36, 1);
      }

      .components > div {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        flex: 1;
        overflow: auto;
      }

      :host(:not([icon]):not([label])) .components {
        padding: 1rem;
      }

      :host(:not([fixed])[collapsed]) .components {
        padding: 0 1rem 0;
        height: 0px;
      }

      bim-label {
        pointer-events: none;
      }

      ::slotted(*) {
        transition:
          transform 0.25s cubic-bezier(0.65, 0.05, 0.36, 1),
          opacity 0.25s cubic-bezier(0.65, 0.05, 0.36, 1);
      }

      :host(:not([fixed])[collapsed]) ::slotted(*) {
        transform: translateX(-20%);
        opacity: 0;
      }

      @keyframes expandAnim {
        0%,
        100% {
          transform: translateY(0%);
        }
        25% {
          transform: translateY(-30%);
        }
        50% {
          transform: translateY(10%);
        }
        75% {
          transform: translateY(-30%);
        }
      }

      @keyframes collapseAnim {
        0%,
        100% {
          transform: translateY(0%) rotateZ(-180deg);
        }
        25% {
          transform: translateY(30%) rotateZ(-180deg);
        }
        50% {
          transform: translateY(-10%) rotateZ(-180deg);
        }
        75% {
          transform: translateY(30%) rotateZ(-180deg);
        }
      }
    `];let un=Vf;$r([W({type:String,reflect:!0})],un.prototype,"icon");$r([W({type:String,reflect:!0})],un.prototype,"label");$r([W({type:String,reflect:!0})],un.prototype,"name");$r([W({type:Boolean,reflect:!0})],un.prototype,"fixed");$r([W({type:Boolean,reflect:!0})],un.prototype,"collapsed");var q1=Object.defineProperty,Tr=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&q1(e,t,n),n};const qf=class extends Ce{constructor(){super(...arguments),this.vertical=!1,this.onValueChange=new Event("change"),this._canEmitEvents=!1,this._value=document.createElement("bim-option"),this.onOptionClick=s=>{this._value=s.target,this.setAnimatedBackgound(),this.dispatchEvent(this.onValueChange);for(const e of this.children)e instanceof Xe&&(e.checked=e===s.target)}}get _options(){return[...this.querySelectorAll("bim-option")]}set value(s){const e=this.findOption(s);if(e){for(const t of this._options)t.checked=t===e;this._value=e,this.setAnimatedBackgound(),this._canEmitEvents&&this.dispatchEvent(this.onValueChange)}}get value(){return this._value.value}onSlotChange(s){const e=s.target.assignedElements();for(const t of e)t instanceof Xe&&(t.noMark=!0,t.removeEventListener("click",this.onOptionClick),t.addEventListener("click",this.onOptionClick))}findOption(s){return this._options.find(e=>e instanceof Xe?e.label===s||e.value===s:!1)}doubleRequestAnimationFrames(s){requestAnimationFrame(()=>requestAnimationFrame(s))}setAnimatedBackgound(s=!1){const e=this.renderRoot.querySelector(".animated-background"),t=this._value;requestAnimationFrame(()=>{var i,n,r,o;const a=(o=(r=(n=(i=t==null?void 0:t.parentElement)==null?void 0:i.shadowRoot)==null?void 0:n.querySelector("bim-input"))==null?void 0:r.shadowRoot)==null?void 0:o.querySelector(".input"),l={width:t==null?void 0:t.clientWidth,height:t==null?void 0:t.clientHeight,top:((t==null?void 0:t.offsetTop)??0)-((a==null?void 0:a.offsetTop)??0),left:((t==null?void 0:t.offsetLeft)??0)-((a==null?void 0:a.offsetLeft)??0)};e==null||e.style.setProperty("width",`${l.width}px`),e==null||e.style.setProperty("height",`${l.height}px`),e==null||e.style.setProperty("top",`${l.top}px`),e==null||e.style.setProperty("left",`${l.left}px`)}),s&&this.doubleRequestAnimationFrames(()=>{const i="ease";e==null||e.style.setProperty("transition",`width ${.3}s ${i}, height ${.3}s ${i}, top ${.3}s ${i}, left ${.3}s ${i}`)})}firstUpdated(){const s=[...this.children].find(e=>e instanceof Xe&&e.checked);s&&(this._value=s),window.addEventListener("load",()=>{this.setAnimatedBackgound(!0)}),new ResizeObserver(()=>{this.setAnimatedBackgound()}).observe(this)}render(){return H`
      <bim-input
        .vertical=${this.vertical}
        .label=${this.label}
        .icon=${this.icon}
      >
        <div class="animated-background"></div>
        <slot @slotchange=${this.onSlotChange}></slot>
      </bim-input>
    `}};qf.styles=$e`
    :host {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
      --bim-input--g: 0;
      --bim-option--jc: center;
      flex: 1;
      display: block;
    }

    ::slotted(bim-option) {
      position: relative;
      border-radius: 0;
      overflow: hidden;
      min-width: min-content;
      min-height: min-content;
      transition: background-color 0.2s;
    }

    .animated-background {
      position: absolute;
      background: var(--bim-ui_main-base);
      width: 0;
      height: 0;
      top: 0;
      left: 0;
    }

    ::slotted(bim-option[checked]) {
      --bim-label--c: var(--bim-ui_main-contrast);
    }

    ::slotted(bim-option:not([checked]):hover) {
      background-color: #0003;
    }
  `;let pn=qf;Tr([W({type:String,reflect:!0})],pn.prototype,"name");Tr([W({type:String,reflect:!0})],pn.prototype,"icon");Tr([W({type:String,reflect:!0})],pn.prototype,"label");Tr([W({type:Boolean,reflect:!0})],pn.prototype,"vertical");Tr([gs()],pn.prototype,"_value");const W1=()=>H`
    <style>
      div {
        display: flex;
        gap: 0.375rem;
        border-radius: 0.25rem;
        min-height: 1.25rem;
      }

      [data-type="row"] {
        background-color: var(--bim-ui_bg-contrast-10);
        animation: row-loading 1s linear infinite alternate;
        padding: 0.5rem;
      }

      [data-type="cell"] {
        background-color: var(--bim-ui_bg-contrast-20);
        flex: 0.25;
      }

      @keyframes row-loading {
        0% {
          background-color: var(--bim-ui_bg-contrast-10);
        }
        100% {
          background-color: var(--bim-ui_bg-contrast-20);
        }
      }
    </style>
    <div style="display: flex; flex-direction: column;">
      <div data-type="row" style="gap: 2rem">
        <div data-type="cell" style="flex: 1"></div>
        <div data-type="cell" style="flex: 2"></div>
        <div data-type="cell" style="flex: 1"></div>
        <div data-type="cell" style="flex: 0.5"></div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.7s5"></div>
        </div>
      </div>
    </div>
  `,Y1=()=>H`
    <style>
      .loader {
        grid-area: Processing;
        position: relative;
        padding: 0.125rem;
      }
      .loader:before {
        content: "";
        position: absolute;
      }
      .loader .loaderBar {
        position: absolute;
        top: 0;
        right: 100%;
        bottom: 0;
        left: 0;
        background: var(--bim-ui_main-base);
        /* width: 25%; */
        width: 0;
        animation: borealisBar 2s linear infinite;
      }

      @keyframes borealisBar {
        0% {
          left: 0%;
          right: 100%;
          width: 0%;
        }
        10% {
          left: 0%;
          right: 75%;
          width: 25%;
        }
        90% {
          right: 0%;
          left: 75%;
          width: 25%;
        }
        100% {
          left: 100%;
          right: 0%;
          width: 0%;
        }
      }
    </style>
    <div class="loader">
      <div class="loaderBar"></div>
    </div>
  `;var Z1=Object.defineProperty,G1=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&Z1(e,t,n),n};const Wf=class extends Ce{constructor(){super(...arguments),this.column="",this.columnIndex=0,this.table=null,this.group=null,this.row=null,this.rowData={}}get data(){return this.column?this.rowData[this.column]:null}get dataTransform(){var s,e,t,i;const n=(e=(s=this.row)==null?void 0:s.dataTransform)==null?void 0:e[this.column],r=(t=this.table)==null?void 0:t.dataTransform[this.column],o=(i=this.table)==null?void 0:i.defaultContentTemplate;return n||r||o}get templateValue(){const{data:s,rowData:e,group:t}=this,i=this.dataTransform;if(i&&s!=null&&t){const n=i(s,e,t);return typeof n=="string"||typeof n=="boolean"||typeof n=="number"?H`<bim-label>${n}</bim-label>`:n}return s!=null?H`<bim-label>${s}</bim-label>`:Ie}connectedCallback(){super.connectedCallback(),this.style.gridArea=this.column.toString()}render(){return H`${this.templateValue}`}};Wf.styles=$e`
    :host {
      padding: 0.375rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    :host([data-column-index="0"]) {
      justify-content: normal;
    }

    :host([data-column-index="0"]:not([data-cell-header]))
      ::slotted(bim-label) {
      text-align: left;
    }

    ::slotted(*) {
      --bim-input--bgc: transparent;
      --bim-input--olc: var(--bim-ui_bg-contrast-20);
      --bim-input--olw: 1px;
    }

    ::slotted(bim-input) {
      --bim-input--olw: 0;
    }
  `;let Yf=Wf;G1([W({type:String,reflect:!0})],Yf.prototype,"column");const Zf=class extends Ce{constructor(){super(...arguments),this._groups=[],this.group=this.closest("bim-table-group"),this._data=[],this.table=this.closest("bim-table")}get data(){var s;return((s=this.group)==null?void 0:s.data.children)??this._data}set data(s){this._data=s}clean(){for(const s of this._groups)s.remove();this._groups=[]}render(){return this.clean(),H`
      <slot></slot>
      ${this.data.map(s=>{const e=document.createElement("bim-table-group");return this._groups.push(e),e.table=this.table,e.data=s,e})}
    `}};Zf.styles=$e`
    :host {
      --bim-button--bgc: transparent;
      position: relative;
      display: block;
      overflow: hidden;
      grid-area: Children;
    }

    :host([hidden]) {
      height: 0;
      opacity: 0;
    }

    ::slotted(.branch.branch-vertical) {
      top: 0;
      bottom: 1.125rem;
    }
  `;let X1=Zf;/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Gf="important",Q1=" !"+Gf,mi=af(class extends lf{constructor(s){var e;if(super(s),s.type!==of.ATTRIBUTE||s.name!=="style"||((e=s.strings)==null?void 0:e.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(s){return Object.keys(s).reduce((e,t)=>{const i=s[t];return i==null?e:e+`${t=t.includes("-")?t:t.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${i};`},"")}update(s,[e]){const{style:t}=s.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(e)),this.render(e);for(const i of this.ft)e[i]==null&&(this.ft.delete(i),i.includes("-")?t.removeProperty(i):t[i]=null);for(const i in e){const n=e[i];if(n!=null){this.ft.add(i);const r=typeof n=="string"&&n.endsWith(Q1);i.includes("-")||r?t.setProperty(i,r?n.slice(0,-11):n,r?Gf:""):t[i]=n}}return ms}});var K1=Object.defineProperty,J1=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&K1(e,t,n),n};const Xf=class extends Ce{constructor(){super(...arguments),this.childrenHidden=!0,this.table=null,this.data={data:{}}}get rowElement(){const s=this.shadowRoot;return s?s.querySelector("bim-table-row"):null}get childrenElement(){const s=this.shadowRoot;return s?s.querySelector("bim-table-children"):null}get _isChildrenEmpty(){return!(this.data.children&&this.data.children.length!==0)}connectedCallback(){super.connectedCallback(),this.table&&this.table.expanded?this.childrenHidden=!1:this.childrenHidden=!0}disconnectedCallback(){super.disconnectedCallback(),this.data={data:{}}}toggleChildren(s){this.childrenHidden=typeof s>"u"?!this.childrenHidden:!s,this.animateTableChildren(!0)}animateTableChildren(s=!0){if(!s){requestAnimationFrame(()=>{var r;const o=this.renderRoot.querySelector(".caret"),a=this.renderRoot.querySelector(".branch-vertical"),l=(r=this.renderRoot.querySelector("bim-table-children"))==null?void 0:r.querySelector(".branch-vertical");o.style.setProperty("transform",`translateY(-50%) rotate(${this.childrenHidden?"0":"90"}deg)`),a.style.setProperty("transform",`scaleY(${this.childrenHidden?"0":"1"})`),l==null||l.style.setProperty("transform",`scaleY(${this.childrenHidden?"0":"1"})`)});return}const e=500,t=0,i=200,n=350;requestAnimationFrame(()=>{var r;const o=this.renderRoot.querySelector("bim-table-children"),a=this.renderRoot.querySelector(".caret"),l=this.renderRoot.querySelector(".branch-vertical"),c=(r=this.renderRoot.querySelector("bim-table-children"))==null?void 0:r.querySelector(".branch-vertical"),h=()=>{var m;const b=(m=o==null?void 0:o.renderRoot)==null?void 0:m.querySelectorAll("bim-table-group");b==null||b.forEach((f,y)=>{f.style.setProperty("opacity","0"),f.style.setProperty("left","-30px");const v=[{opacity:"0",left:"-30px"},{opacity:"1",left:"0"}];f.animate(v,{duration:e/2,delay:50+y*t,easing:"cubic-bezier(0.65, 0.05, 0.36, 1)",fill:"forwards"})})},d=()=>{const m=[{transform:"translateY(-50%) rotate(90deg)"},{transform:"translateY(-50%) rotate(0deg)"}];a==null||a.animate(m,{duration:n,easing:"cubic-bezier(0.68, -0.55, 0.27, 1.55)",fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})},p=()=>{const m=[{transform:"scaleY(1)"},{transform:"scaleY(0)"}];l==null||l.animate(m,{duration:i,easing:"cubic-bezier(0.4, 0, 0.2, 1)",delay:t,fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})},u=()=>{var m;const b=(m=this.renderRoot.querySelector("bim-table-row"))==null?void 0:m.querySelector(".branch-horizontal");if(b){b.style.setProperty("transform-origin","center right");const f=[{transform:"scaleX(0)"},{transform:"scaleX(1)"}];b.animate(f,{duration:i,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})}},g=()=>{const m=[{transform:"scaleY(0)"},{transform:"scaleY(1)"}];c==null||c.animate(m,{duration:i*1.2,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"forwards",delay:(t+i)*.7})};h(),d(),p(),u(),g()})}firstUpdated(){this.renderRoot.querySelectorAll(".caret").forEach(s=>{var e,t,i;if(!this.childrenHidden){s.style.setProperty("transform","translateY(-50%) rotate(90deg)");const n=(e=s.parentElement)==null?void 0:e.querySelector(".branch-horizontal");n&&n.style.setProperty("transform","scaleX(0)");const r=(i=(t=s.parentElement)==null?void 0:t.parentElement)==null?void 0:i.querySelectorAll(".branch-vertical");r==null||r.forEach(o=>{o.style.setProperty("transform","scaleY(1)")})}})}render(){if(!this.table)return H`${Ie}`;const s=this.table.getGroupIndentation(this.data)??0;let e;if(!this.table.noIndentation){const r={left:`${s-1+(this.table.selectableRows?2.05:.5625)}rem`};e=H`<div style=${mi(r)} class="branch branch-horizontal"></div>`}const t=H`
      ${this.table.noIndentation?null:H`
            <style>
              .branch-vertical {
                left: ${s+(this.table.selectableRows?1.9375:.5625)}rem;
              }
            </style>
            <div class="branch branch-vertical"></div>
          `}
    `;let i;if(!this.table.noIndentation){const r=document.createElementNS("http://www.w3.org/2000/svg","svg");if(r.setAttribute("height","9.9"),r.setAttribute("width","7.5"),r.setAttribute("viewBox","0 0 4.6666672 7.7"),this.table.noCarets){const a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx","2.3333336"),a.setAttribute("cy","3.85"),a.setAttribute("r","2.5"),r.append(a)}else{const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d","m 1.7470835,6.9583848 2.5899999,-2.59 c 0.39,-0.39 0.39,-1.02 0,-1.41 L 1.7470835,0.36838483 c -0.63,-0.62000003 -1.71000005,-0.18 -1.71000005,0.70999997 v 5.17 c 0,0.9 1.08000005,1.34 1.71000005,0.71 z"),r.append(a)}const o={left:`${(this.table.selectableRows?1.5:.125)+s}rem`,cursor:`${this.table.noCarets?"unset":"pointer"}`};i=H`<div @click=${a=>{var l;(l=this.table)!=null&&l.noCarets||(a.stopPropagation(),this.toggleChildren())}} style=${mi(o)} class="caret">${r}</div>`}let n;return!this._isChildrenEmpty&&!this.childrenHidden&&(n=H`
        <bim-table-children ${Ke(r=>{if(!r)return;const o=r;o.table=this.table,o.group=this})}>${t}</bim-table-children>
      `),H`
      <div class="parent">
        <bim-table-row ${Ke(r=>{var o;if(!r)return;const a=r;a.table=this.table,a.group=this,(o=this.table)==null||o.dispatchEvent(new CustomEvent("rowcreated",{detail:{row:a}}))})}>
          ${Vs(!this._isChildrenEmpty,()=>t)}
          ${Vs(s!==0,()=>e)}
          ${Vs(!this.table.noIndentation&&!this._isChildrenEmpty,()=>i)}
        </bim-table-row>
        ${n}
      </div>
    `}};Xf.styles=$e`
    :host {
      position: relative;
    }

    .parent {
      display: grid;
      grid-template-areas: "Data" "Children";
    }

    .branch {
      position: absolute;
      z-index: 1;
    }

    .branch-vertical {
      border-left: 1px dotted var(--bim-ui_bg-contrast-40);
      transform-origin: top center;
      transform: scaleY(0);
    }

    .branch-horizontal {
      top: 50%;
      width: 1rem;
      border-bottom: 1px dotted var(--bim-ui_bg-contrast-40);
    }

    .branch-horizontal {
      transform-origin: center left;
    }

    .caret {
      position: absolute;
      z-index: 2;
      transform: translateY(-50%) rotate(0deg);
      top: 50%;
      display: flex;
      width: 0.95rem;
      height: 0.95rem;
      justify-content: center;
      align-items: center;
    }

    .caret svg {
      fill: var(--bim-ui_bg-contrast-60);
    }
  `;let Qf=Xf;J1([W({type:Boolean,attribute:"children-hidden",reflect:!0})],Qf.prototype,"childrenHidden");var ex=Object.defineProperty,fn=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&ex(e,t,n),n};const Kf=class extends Ce{constructor(){super(...arguments),this.selected=!1,this.columns=[],this.hiddenColumns=[],this.group=null,this._data={},this.isHeader=!1,this.table=null,this.onTableColumnsChange=()=>{this.table&&(this.columns=this.table.columns)},this.onTableColumnsHidden=()=>{this.table&&(this.hiddenColumns=this.table.hiddenColumns)},this._intersecting=!1,this._timeOutDelay=250,this._observer=new IntersectionObserver(s=>{window.clearTimeout(this._intersectTimeout),this._intersectTimeout=void 0,s[0].isIntersecting?this._intersectTimeout=window.setTimeout(()=>{this._intersecting=!0},this._timeOutDelay):this._intersecting=!1},{rootMargin:"36px"}),this.dataTransform=null,this._interval=null,this.clearDataTransform=()=>{this.dataTransform=null,this._interval!==null&&(clearInterval(this._interval),this._interval=null)},this._cache={}}get groupData(){var s;return(s=this.group)==null?void 0:s.data}get data(){var s;return((s=this.group)==null?void 0:s.data.data)??this._data}set data(s){this._data=s}get _columnNames(){return this.columns.filter(s=>!this.hiddenColumns.includes(s.name)).map(s=>s.name)}get _columnWidths(){return this.columns.filter(s=>!this.hiddenColumns.includes(s.name)).map(s=>s.width)}get _isSelected(){var s;return(s=this.table)==null?void 0:s.selection.has(this.data)}onSelectionChange(s){if(!this.table)return;const e=s.target;this.selected=e.value,e.value?(this.table.selection.add(this.data),this.table.dispatchEvent(new CustomEvent("rowselected",{detail:{data:this.data}}))):(this.table.selection.delete(this.data),this.table.dispatchEvent(new CustomEvent("rowdeselected",{detail:{data:this.data}})))}firstUpdated(s){super.firstUpdated(s),this._observer.observe(this)}connectedCallback(){super.connectedCallback(),this.toggleAttribute("selected",this._isSelected),this.table&&(this.columns=this.table.columns,this.hiddenColumns=this.table.hiddenColumns,this.table.addEventListener("columnschange",this.onTableColumnsChange),this.table.addEventListener("columnshidden",this.onTableColumnsHidden),this.style.gridTemplateAreas=`"${this.table.selectableRows?"Selection":""} ${this._columnNames.join(" ")}"`,this.style.gridTemplateColumns=`${this.table.selectableRows?"1.6rem":""} ${this._columnWidths.join(" ")}`)}disconnectedCallback(){super.disconnectedCallback(),this._observer.unobserve(this),this.columns=[],this.hiddenColumns=[],this.toggleAttribute("selected",!1),this.data={},this.table&&(this.table.removeEventListener("columnschange",this.onTableColumnsChange),this.table.removeEventListener("columnshidden",this.onTableColumnsHidden),this.table=null),this.clean()}applyAdaptativeDataTransform(s){this.addEventListener("pointerenter",()=>{this.dataTransform=s,this._interval=window.setInterval(()=>{this.matches(":hover")||this.clearDataTransform()},50)})}clean(){clearTimeout(this._intersectTimeout),this._intersectTimeout=void 0,this._timeOutDelay=250;for(const[,s]of Object.entries(this._cache))s.remove();this._cache={}}render(){if(!(this.table&&this._intersecting))return H`${Ie}`;const s=this.table.getRowIndentation(this.data)??0,e=[];for(const t in this.data){if(this.hiddenColumns.includes(t))continue;const i=document.createElement("bim-table-cell");i.group=this.group,i.table=this.table,i.row=this,i.column=t,this._columnNames.indexOf(t)===0&&(i.style.marginLeft=`${this.table.noIndentation?0:s+.75}rem`);const n=this._columnNames.indexOf(t);i.setAttribute("data-column-index",String(n)),i.toggleAttribute("data-no-indentation",n===0&&this.table.noIndentation),i.toggleAttribute("data-cell-header",this.isHeader),i.rowData=this.data,this.table.dispatchEvent(new CustomEvent("cellcreated",{detail:{cell:i}})),e.push(i)}return this._timeOutDelay=0,H`
      ${!this.isHeader&&this.table.selectableRows?H`<bim-checkbox
            @change=${this.onSelectionChange}
            .checked=${this._isSelected??!1}
            style="align-self: center; justify-self: center"
          ></bim-checkbox>`:null}
      ${e}
      <slot></slot>
    `}};Kf.styles=$e`
    :host {
      position: relative;
      grid-area: Data;
      display: grid;
      min-height: 2.25rem;
      transition: all 0.15s;
    }

    ::slotted(.branch.branch-vertical) {
      top: 50%;
      bottom: 0;
    }

    :host([selected]) {
      background-color: color-mix(
        in lab,
        var(--bim-ui_bg-contrast-20) 30%,
        var(--bim-ui_accent-base) 10%
      );
    }
  `;let vs=Kf;fn([W({type:Boolean,reflect:!0})],vs.prototype,"selected");fn([W({attribute:!1})],vs.prototype,"columns");fn([W({attribute:!1})],vs.prototype,"hiddenColumns");fn([W({type:Boolean,attribute:"is-header",reflect:!0})],vs.prototype,"isHeader");fn([gs()],vs.prototype,"_intersecting");fn([gs()],vs.prototype,"dataTransform");var tx=Object.defineProperty,ix=Object.getOwnPropertyDescriptor,Ut=(s,e,t,i)=>{for(var n=i>1?void 0:i?ix(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&tx(e,t,n),n};const Jf=class extends Ce{constructor(){super(...arguments),this._filteredData=[],this.headersHidden=!1,this.minColWidth="4rem",this._columns=[],this._textDelimiters={comma:",",tab:"	"},this._queryString=null,this._data=[],this.expanded=!1,this.preserveStructureOnFilter=!1,this.indentationInText=!1,this.dataTransform={},this.selectableRows=!1,this.selection=new Set,this.noIndentation=!1,this.noCarets=!1,this.loading=!1,this._errorLoading=!1,this._onColumnsHidden=new Event("columnshidden"),this._hiddenColumns=[],this.defaultContentTemplate=s=>H`<bim-label style="white-space: normal;">${s}</bim-label>`,this._stringFilterFunction=(s,e)=>Object.values(e.data).some(t=>String(t).toLowerCase().includes(s.toLowerCase())),this._queryFilterFunction=(s,e)=>{let t=!1;const i=jl(s)??[];for(const n of i){if("queries"in n){t=!1;break}const{condition:r,value:o}=n;let{key:a}=n;if(a.startsWith("[")&&a.endsWith("]")){const l=a.replace("[","").replace("]","");a=l,t=Object.keys(e.data).filter(c=>c.includes(l)).map(c=>qd(e.data[c],r,o)).some(c=>c)}else t=qd(e.data[a],r,o);if(!t)break}return t}}set columns(s){const e=[];for(const t of s){const i=typeof t=="string"?{name:t,width:`minmax(${this.minColWidth}, 1fr)`}:t;e.push(i)}this._columns=e,this.computeMissingColumns(this.data),this.dispatchEvent(new Event("columnschange"))}get columns(){return this._columns}get _headerRowData(){const s={};for(const e of this.columns){const{name:t}=e;s[t]=String(t)}return s}get value(){return this._filteredData}set queryString(s){this.toggleAttribute("data-processing",!0),this._queryString=s&&s.trim()!==""?s.trim():null,this.updateFilteredData(),this.toggleAttribute("data-processing",!1)}get queryString(){return this._queryString}set data(s){this._data=s,this.updateFilteredData(),this.computeMissingColumns(s)&&(this.columns=this._columns)}get data(){return this._data}get dataAsync(){return new Promise(s=>{setTimeout(()=>{s(this.data)})})}set hiddenColumns(s){this._hiddenColumns=s,setTimeout(()=>{this.dispatchEvent(this._onColumnsHidden)})}get hiddenColumns(){return this._hiddenColumns}updateFilteredData(){this.queryString?(jl(this.queryString)?(this.filterFunction=this._queryFilterFunction,this._filteredData=this.filter(this.queryString)):(this.filterFunction=this._stringFilterFunction,this._filteredData=this.filter(this.queryString)),this.preserveStructureOnFilter&&(this._expandedBeforeFilter===void 0&&(this._expandedBeforeFilter=this.expanded),this.expanded=!0)):(this.preserveStructureOnFilter&&this._expandedBeforeFilter!==void 0&&(this.expanded=this._expandedBeforeFilter,this._expandedBeforeFilter=void 0),this._filteredData=this.data)}computeMissingColumns(s){let e=!1;for(const t of s){const{children:i,data:n}=t;for(const r in n)this._columns.map(o=>typeof o=="string"?o:o.name).includes(r)||(this._columns.push({name:r,width:`minmax(${this.minColWidth}, 1fr)`}),e=!0);if(i){const r=this.computeMissingColumns(i);r&&!e&&(e=r)}}return e}generateText(s="comma",e=this.value,t="",i=!0){const n=this._textDelimiters[s];let r="";const o=this.columns.map(a=>a.name);if(i){this.indentationInText&&(r+=`Indentation${n}`);const a=`${o.join(n)}
`;r+=a}for(const[a,l]of e.entries()){const{data:c,children:h}=l,d=this.indentationInText?`${t}${a+1}${n}`:"",p=o.map(g=>c[g]??""),u=`${d}${p.join(n)}
`;r+=u,h&&(r+=this.generateText(s,l.children,`${t}${a+1}.`,!1))}return r}get csv(){return this.generateText("comma")}get tsv(){return this.generateText("tab")}applyDataTransform(s){const e={};if(!s)return e;const{data:t}=s.data;for(const n of Object.keys(this.dataTransform)){const r=this.columns.find(o=>o.name===n);r&&r.forceDataTransform&&(n in t||(t[n]=""))}const i=t;for(const n in i){const r=this.dataTransform[n];r?e[n]=r(i[n],t,s):e[n]=t[n]}return e}downloadData(s="BIM Table Data",e="json"){let t=null;if(e==="json"&&(t=new File([JSON.stringify(this.value,void 0,2)],`${s}.json`)),e==="csv"&&(t=new File([this.csv],`${s}.csv`)),e==="tsv"&&(t=new File([this.tsv],`${s}.tsv`)),!t)return;const i=document.createElement("a");i.href=URL.createObjectURL(t),i.download=t.name,i.click(),URL.revokeObjectURL(i.href)}getRowIndentation(s,e=this.value,t=0){for(const i of e){if(i.data===s)return t;if(i.children){const n=this.getRowIndentation(s,i.children,t+1);if(n!==null)return n}}return null}getGroupIndentation(s,e=this.value,t=0){for(const i of e){if(i===s)return t;if(i.children){const n=this.getGroupIndentation(s,i.children,t+1);if(n!==null)return n}}return null}connectedCallback(){super.connectedCallback(),this.dispatchEvent(new Event("connected"))}disconnectedCallback(){super.disconnectedCallback(),this.dispatchEvent(new Event("disconnected"))}async loadData(s=!1){if(this._filteredData.length!==0&&!s||!this.loadFunction)return!1;this.loading=!0;try{const e=await this.loadFunction();return this.data=e,this.loading=!1,this._errorLoading=!1,!0}catch(e){if(this.loading=!1,this._filteredData.length!==0)return!1;const t=this.querySelector("[slot='error-loading']"),i=t==null?void 0:t.querySelector("[data-table-element='error-message']");return e instanceof Error&&i&&e.message.trim()!==""&&(i.textContent=e.message),this._errorLoading=!0,!1}}filter(s,e=this.filterFunction??this._stringFilterFunction,t=this.data){const i=[];for(const n of t)if(e(s,n)){if(this.preserveStructureOnFilter){const r={data:n.data};if(n.children){const o=this.filter(s,e,n.children);o.length&&(r.children=o)}i.push(r)}else if(i.push({data:n.data}),n.children){const r=this.filter(s,e,n.children);i.push(...r)}}else if(n.children){const r=this.filter(s,e,n.children);this.preserveStructureOnFilter&&r.length?i.push({data:n.data,children:r}):i.push(...r)}return i}get _missingDataElement(){return this.querySelector("[slot='missing-data']")}render(){if(this.loading)return W1();if(this._errorLoading)return H`<slot name="error-loading"></slot>`;if(this._filteredData.length===0&&this._missingDataElement)return H`<slot name="missing-data"></slot>`;const s=t=>{if(!t)return;const i=t;i.table=this,i.data=this._headerRowData},e=t=>{if(!t)return;const i=t;i.table=this,i.data=this.value,i.requestUpdate()};return H`
      <div class="parent">
        ${Y1()}
        ${Vs(!this.headersHidden,()=>H`<bim-table-row is-header style="grid-area: Header; position: sticky; top: 0; z-index: 5" ${Ke(s)}></bim-table-row>`)} 
        <div style="overflow-x: hidden; grid-area: Body">
          <bim-table-children ${Ke(e)} style="grid-area: Body; background-color: transparent"></bim-table-children>
        </div>
      </div>
    `}};Jf.styles=[Xi.scrollbar,$e`
      :host {
        position: relative;
        overflow: auto;
        display: block;
        pointer-events: auto;
      }

      :host(:not([data-processing])) .loader {
        display: none;
      }

      .parent {
        display: grid;
        grid-template:
          "Header" auto
          "Processing" auto
          "Body" 1fr
          "Footer" auto;
        overflow: auto;
        height: 100%;
      }

      .parent > bim-table-row[is-header] {
        color: var(--bim-table_header--c, var(--bim-ui_bg-contrast-100));
        background-color: var(
          --bim-table_header--bgc,
          var(--bim-ui_bg-contrast-20)
        );
      }

      .controls {
        display: flex;
        gap: 0.375rem;
        flex-wrap: wrap;
        margin-bottom: 0.5rem;
      }
    `];let Tt=Jf;Ut([gs()],Tt.prototype,"_filteredData",2);Ut([W({type:Boolean,attribute:"headers-hidden",reflect:!0})],Tt.prototype,"headersHidden",2);Ut([W({type:String,attribute:"min-col-width",reflect:!0})],Tt.prototype,"minColWidth",2);Ut([W({type:Array,attribute:!1})],Tt.prototype,"columns",1);Ut([W({type:Array,attribute:!1})],Tt.prototype,"data",1);Ut([W({type:Boolean,reflect:!0})],Tt.prototype,"expanded",2);Ut([W({type:Boolean,reflect:!0,attribute:"selectable-rows"})],Tt.prototype,"selectableRows",2);Ut([W({attribute:!1})],Tt.prototype,"selection",2);Ut([W({type:Boolean,attribute:"no-indentation",reflect:!0})],Tt.prototype,"noIndentation",2);Ut([W({type:Boolean,attribute:"no-carets",reflect:!0})],Tt.prototype,"noCarets",2);Ut([W({type:Boolean,reflect:!0})],Tt.prototype,"loading",2);Ut([gs()],Tt.prototype,"_errorLoading",2);var sx=Object.defineProperty,nx=Object.getOwnPropertyDescriptor,mn=(s,e,t,i)=>{for(var n=i>1?void 0:i?nx(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&sx(e,t,n),n};const em=class extends Ce{constructor(){super(...arguments),this._switchers=[],this.bottom=!1,this.switchersHidden=!1,this.floating=!1,this.switchersFull=!1,this.onTabHiddenChange=s=>{const e=s.target;e instanceof vt&&!e.hidden&&(e.removeEventListener("hiddenchange",this.onTabHiddenChange),this.tab=e.name,e.addEventListener("hiddenchange",this.onTabHiddenChange))}}set tab(s){this._tab=s;const e=[...this.children],t=e.find(i=>i instanceof vt&&i.name===s);for(const i of e){if(!(i instanceof vt))continue;i.hidden=t!==i;const n=this.getTabSwitcher(i.name);n&&n.toggleAttribute("data-active",!i.hidden)}t||(this._tab="hidden",this.setAttribute("tab","hidden"))}get tab(){return this._tab}getTabSwitcher(s){return this._switchers.find(e=>e.getAttribute("data-name")===s)}createSwitchers(){this._switchers=[];for(const s of this.children){if(!(s instanceof vt))continue;const e=document.createElement("div");e.addEventListener("click",()=>{this.tab===s.name?this.toggleAttribute("tab",!1):this.tab=s.name,this.setAnimatedBackgound()}),e.setAttribute("data-name",s.name),e.className="switcher";const t=document.createElement("bim-label");t.textContent=s.label??null,t.icon=s.icon,e.append(t),this._switchers.push(e)}}updateSwitchers(){for(const s of this.children){if(!(s instanceof vt))continue;const e=this._switchers.find(i=>i.getAttribute("data-name")===s.name);if(!e)continue;const t=e.querySelector("bim-label");t&&(t.textContent=s.label??null,t.icon=s.icon)}}onSlotChange(s){this.createSwitchers();const e=s.target.assignedElements(),t=e.find(i=>i instanceof vt?this.tab?i.name===this.tab:!i.hidden:!1);t&&t instanceof vt&&(this.tab=t.name);for(const i of e){if(!(i instanceof vt)){i.remove();continue}i.removeEventListener("hiddenchange",this.onTabHiddenChange),t!==i&&(i.hidden=!0),i.addEventListener("hiddenchange",this.onTabHiddenChange)}}doubleRequestAnimationFrames(s){requestAnimationFrame(()=>requestAnimationFrame(s))}setAnimatedBackgound(s=!1){var e;const t=this.renderRoot.querySelector(".animated-background"),i=[...((e=this.renderRoot.querySelector(".switchers"))==null?void 0:e.querySelectorAll(".switcher"))||[]].filter(n=>n.hasAttribute("data-active"))[0];requestAnimationFrame(()=>{var n,r,o,a;const l=(a=(o=(r=(n=i==null?void 0:i.parentElement)==null?void 0:n.shadowRoot)==null?void 0:r.querySelector("bim-input"))==null?void 0:o.shadowRoot)==null?void 0:a.querySelector(".input"),c={width:i==null?void 0:i.clientWidth,height:i==null?void 0:i.clientHeight,top:((i==null?void 0:i.offsetTop)??0)-((l==null?void 0:l.offsetTop)??0),left:((i==null?void 0:i.offsetLeft)??0)-((l==null?void 0:l.offsetLeft)??0)};i?(t==null||t.style.setProperty("width",`${c.width}px`),t==null||t.style.setProperty("height",`${c.height}px`),t==null||t.style.setProperty("left",`${c.left}px`)):t==null||t.style.setProperty("width","0"),this.bottom?(t==null||t.style.setProperty("top","100%"),t==null||t.style.setProperty("transform","translateY(-100%)")):t==null||t.style.setProperty("top",`${c.top}px`)}),s&&this.doubleRequestAnimationFrames(()=>{const n="ease";t==null||t.style.setProperty("transition",`width ${.3}s ${n}, height ${.3}s ${n}, top ${.3}s ${n}, left ${.3}s ${n}`)})}firstUpdated(){requestAnimationFrame(()=>{this.setAnimatedBackgound(!0)}),new ResizeObserver(()=>{this.setAnimatedBackgound()}).observe(this)}render(){return H`
      <div class="parent">
        <div class="switchers">
          <div class="animated-background"></div>
          ${this._switchers}
        </div>
        <div class="content">
          <slot @slotchange=${this.onSlotChange}></slot>
        </div>
      </div>
    `}};em.styles=[Xi.scrollbar,$e`
      * {
        box-sizing: border-box;
      }

      :host {
        background-color: var(--bim-ui_bg-base);
        display: block;
        overflow: auto;
      }

      .parent {
        display: grid;
        overflow: hidden;
        position: relative;
        grid-template: "switchers" auto "content" 1fr;
        height: 100%;
      }

      :host([bottom]) .parent {
        grid-template: "content" 1fr "switchers" auto;
      }

      .switchers {
        position: relative;
        display: flex;
        height: 2.25rem;
        font-weight: 600;
        grid-area: switchers;
      }

      .switcher {
        --bim-label--c: var(--bim-ui_bg-contrast-80);
        background-color: transparent;
        position: relative;
        cursor: pointer;
        pointer-events: auto;
        padding: 0rem 0.75rem;
        display: flex;
        justify-content: center;
        z-index: 2;
        transition: all 0.15s;
      }

      .switcher:not([data-active]):hover {
        filter: brightness(150%);
      }

      :host([switchers-full]) .switcher {
        flex: 1;
      }

      .switcher[data-active] {
        --bim-label--c: var(--bim-ui_main-contrast);
      }

      .switchers bim-label {
        pointer-events: none;
      }

      :host([switchers-hidden]) .switchers {
        display: none;
      }

      .content {
        position: relative;
        display: grid;
        grid-template-columns: 1fr;
        grid-area: content;
        max-height: 100vh;
        overflow: auto;
        transition: max-height 0.2s;
      }

      :host([tab="hidden"]) .content {
        max-height: 0;
      }

      .animated-background {
        position: absolute;
        background: var(--bim-ui_main-base);
        width: 0;
        height: 0;
        top: 0;
        left: 0;
      }

      :host(:not([bottom])) .content {
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([bottom]) .content {
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating]) {
        background-color: transparent;
      }

      :host([floating]) .switchers {
        justify-self: center;
        overflow: hidden;
        background-color: var(--bim-ui_bg-base);
      }

      :host([floating]:not([bottom])) .switchers {
        border-radius: var(--bim-ui_size-2xs) var(--bim-ui_size-2xs) 0 0;
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
        border-left: 1px solid var(--bim-ui_bg-contrast-20);
        border-right: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][bottom]) .switchers {
        border-radius: 0 0 var(--bim-ui_size-2xs) var(--bim-ui_size-2xs);
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
        border-left: 1px solid var(--bim-ui_bg-contrast-20);
        border-right: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][tab="hidden"]) .switchers {
        border-radius: var(--bim-ui_size-2xs);
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][bottom][tab="hidden"]) .switchers {
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating]) .content {
        border: 1px solid var(--bim-ui_bg-contrast-20);
        border-radius: var(--bim-ui_size-2xs);
        background-color: var(--bim-ui_bg-base);
      }
    `];let vi=em;mn([gs()],vi.prototype,"_switchers",2);mn([W({type:Boolean,reflect:!0})],vi.prototype,"bottom",2);mn([W({type:Boolean,attribute:"switchers-hidden",reflect:!0})],vi.prototype,"switchersHidden",2);mn([W({type:Boolean,reflect:!0})],vi.prototype,"floating",2);mn([W({type:String,reflect:!0})],vi.prototype,"tab",1);mn([W({type:Boolean,attribute:"switchers-full",reflect:!0})],vi.prototype,"switchersFull",2);var rx=Object.defineProperty,ox=Object.getOwnPropertyDescriptor,da=(s,e,t,i)=>{for(var n=i>1?void 0:i?ox(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&rx(e,t,n),n};const tm=class extends Ce{constructor(){super(...arguments),this._defaultName="__unnamed__",this.name=this._defaultName,this._hidden=!1}set label(s){this._label=s;const e=this.parentElement;e instanceof vi&&e.updateSwitchers()}get label(){return this._label}set icon(s){this._icon=s;const e=this.parentElement;e instanceof vi&&e.updateSwitchers()}get icon(){return this._icon}set hidden(s){this._hidden=s,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}connectedCallback(){super.connectedCallback();const{parentElement:s}=this;if(s&&this.name===this._defaultName){const e=[...s.children].indexOf(this);this.name=`${this._defaultName}${e}`}}render(){return H` <slot></slot> `}};tm.styles=$e`
    :host {
      display: block;
      height: 100%;
      grid-row-start: 1;
      grid-column-start: 1;
      animation: openAnim 3s forwards;
      transform: translateY(0);
      max-height: 100vh;
      transition:
        opacity 0.3s ease,
        max-height 0.6s ease,
        transform 0.3s ease;
    }

    :host([hidden]) {
      transform: translateY(-20px);
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      visibility: hidden;
    }
  `;let vt=tm;da([W({type:String,reflect:!0})],vt.prototype,"name",2);da([W({type:String,reflect:!0})],vt.prototype,"label",1);da([W({type:String,reflect:!0})],vt.prototype,"icon",1);da([W({type:Boolean,reflect:!0})],vt.prototype,"hidden",1);var ax=Object.defineProperty,lx=Object.getOwnPropertyDescriptor,Gt=(s,e,t,i)=>{for(var n=i>1?void 0:i?lx(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&ax(e,t,n),n};const im=class extends Ce{constructor(){super(...arguments),this._inputTypes=["date","datetime-local","email","month","password","search","tel","text","time","url","week","area"],this.value="",this.vertical=!1,this.disabled=!1,this.resize="vertical",this._type="text",this.onValueChange=new Event("input")}set type(s){this._inputTypes.includes(s)&&(this._type=s)}get type(){return this._type}get query(){return jl(this.value)}onInputChange(s){s.stopPropagation();const e=s.target;clearTimeout(this._debounceTimeoutID),this._debounceTimeoutID=setTimeout(()=>{this.value=e.value,this.dispatchEvent(this.onValueChange)},this.debounce)}focus(){setTimeout(()=>{var s;const e=(s=this.shadowRoot)==null?void 0:s.querySelector("input");e==null||e.focus()})}render(){return H`
      <bim-input
        .name=${this.name}
        .icon=${this.icon}
        .label=${this.label}
        .vertical=${this.vertical}
      >
        ${this.type==="area"?H` <textarea
              aria-label=${this.label||this.name||"Text Input"}
              .value=${this.value}
              .rows=${this.rows??5}
              ?disabled=${this.disabled}
              placeholder=${Vl(this.placeholder)}
              @input=${this.onInputChange}
              style="resize: ${this.resize};"
            ></textarea>`:H` <input
              aria-label=${this.label||this.name||"Text Input"}
              .type=${this.type}
              .value=${this.value}
              ?disabled=${this.disabled}
              placeholder=${Vl(this.placeholder)}
              @input=${this.onInputChange}
            />`}
      </bim-input>
    `}};im.styles=[Xi.scrollbar,$e`
      :host {
        --bim-input--bgc: var(--bim-ui_bg-contrast-20);
        flex: 1;
        display: block;
      }

      input,
      textarea {
        font-family: inherit;
        background-color: transparent;
        border: none;
        width: 100%;
        padding: var(--bim-ui_size-3xs);
        color: var(--bim-text-input--c, var(--bim-ui_bg-contrast-100));
      }

      input {
        outline: none;
        height: 100%;
        padding: 0 var(--bim-ui_size-3xs); /* Override padding */
        border-radius: var(--bim-text-input--bdrs, var(--bim-ui_size-4xs));
      }

      :host([disabled]) input,
      :host([disabled]) textarea {
        color: var(--bim-ui_bg-contrast-60);
      }

      textarea {
        line-height: 1.1rem;
        outline: none;
      }

      :host(:focus) {
        --bim-input--olc: var(--bim-ui_accent-base);
      }

      /* :host([disabled]) {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
    } */
    `];let yt=im;Gt([W({type:String,reflect:!0})],yt.prototype,"icon",2);Gt([W({type:String,reflect:!0})],yt.prototype,"label",2);Gt([W({type:String,reflect:!0})],yt.prototype,"name",2);Gt([W({type:String,reflect:!0})],yt.prototype,"placeholder",2);Gt([W({type:String,reflect:!0})],yt.prototype,"value",2);Gt([W({type:Boolean,reflect:!0})],yt.prototype,"vertical",2);Gt([W({type:Number,reflect:!0})],yt.prototype,"debounce",2);Gt([W({type:Number,reflect:!0})],yt.prototype,"rows",2);Gt([W({type:Boolean,reflect:!0})],yt.prototype,"disabled",2);Gt([W({type:String,reflect:!0})],yt.prototype,"resize",2);Gt([W({type:String,reflect:!0})],yt.prototype,"type",1);var cx=Object.defineProperty,hx=Object.getOwnPropertyDescriptor,sm=(s,e,t,i)=>{for(var n=i>1?void 0:i?hx(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&cx(e,t,n),n};const nm=class extends Ce{constructor(){super(...arguments),this.rows=2,this._vertical=!1}set vertical(s){this._vertical=s,this.updateChildren()}get vertical(){return this._vertical}updateChildren(){const s=this.children;for(const e of s)this.vertical?e.setAttribute("label-hidden",""):e.removeAttribute("label-hidden")}render(){return H`
      <style>
        .parent {
          grid-auto-flow: ${this.vertical?"row":"column"};
          grid-template-rows: repeat(${this.rows}, 1fr);
        }
      </style>
      <div class="parent">
        <slot @slotchange=${this.updateChildren}></slot>
      </div>
    `}};nm.styles=$e`
    .parent {
      display: grid;
      gap: 0.25rem;
    }

    ::slotted(bim-button[label]:not([vertical])) {
      --bim-button--jc: flex-start;
    }

    ::slotted(bim-button) {
      --bim-label--c: var(--bim-ui_bg-contrast-80);
    }
  `;let ua=nm;sm([W({type:Number,reflect:!0})],ua.prototype,"rows",2);sm([W({type:Boolean,reflect:!0})],ua.prototype,"vertical",1);var dx=Object.defineProperty,ux=Object.getOwnPropertyDescriptor,pa=(s,e,t,i)=>{for(var n=i>1?void 0:i?ux(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&dx(e,t,n),n};const rm=class extends Ce{constructor(){super(...arguments),this._vertical=!1,this._labelHidden=!1}set vertical(s){this._vertical=s,this.updateChildren()}get vertical(){return this._vertical}set labelHidden(s){this._labelHidden=s,this.updateChildren()}get labelHidden(){return this._labelHidden}updateChildren(){const s=this.children;for(const e of s)e instanceof ua&&(e.vertical=this.vertical),e.toggleAttribute("label-hidden",this.vertical)}render(){return H`
      <div class="parent">
        <div class="children">
          <slot @slotchange=${this.updateChildren}></slot>
        </div>
        ${!this.labelHidden&&(this.label||this.icon)?H`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
      </div>
    `}};rm.styles=$e`
    :host {
      --bim-label--fz: var(--bim-ui_size-xs);
      --bim-label--c: var(--bim-ui_bg-contrast-60);
      display: block;
      flex: 1;
    }

    :host(:not([vertical])) ::slotted(bim-button[vertical]) {
      --bim-icon--fz: var(--bim-ui_size-5xl);
      min-height: 3.75rem;
    }

    .parent {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      align-items: center;
      padding: 0.5rem;
      height: 100%;
      box-sizing: border-box;
      justify-content: space-between;
    }

    :host([vertical]) .parent {
      flex-direction: row-reverse;
    }

    :host([vertical]) .parent > bim-label {
      writing-mode: tb;
    }

    .children {
      display: flex;
      gap: 0.25rem;
    }

    :host([vertical]) .children {
      flex-direction: column;
    }
  `;let gn=rm;pa([W({type:String,reflect:!0})],gn.prototype,"label",2);pa([W({type:String,reflect:!0})],gn.prototype,"icon",2);pa([W({type:Boolean,reflect:!0})],gn.prototype,"vertical",1);pa([W({type:Boolean,attribute:"label-hidden",reflect:!0})],gn.prototype,"labelHidden",1);var px=Object.defineProperty,fx=Object.getOwnPropertyDescriptor,zc=(s,e,t,i)=>{for(var n=i>1?void 0:i?fx(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&px(e,t,n),n};const om=class extends Ce{constructor(){super(...arguments),this.labelsHidden=!1,this._vertical=!1,this._hidden=!1}set vertical(s){this._vertical=s,this.updateSections()}get vertical(){return this._vertical}set hidden(s){this._hidden=s,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}updateSections(){const s=this.children;for(const e of s)e instanceof gn&&(e.labelHidden=this.vertical&&!lt.config.sectionLabelOnVerticalToolbar,e.vertical=this.vertical)}render(){return H`
      <div class="parent">
        <slot @slotchange=${this.updateSections}></slot>
      </div>
    `}};om.styles=$e`
    :host {
      --bim-button--bgc: transparent;
      background-color: var(--bim-ui_bg-base);
      border-radius: var(--bim-ui_size-2xs);
      display: block;
    }

    :host([hidden]) {
      display: none;
    }

    .parent {
      display: flex;
      width: max-content;
      pointer-events: auto;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    :host([vertical]) {
      width: min-content;
      border-radius: var(--bim-ui_size-2xs);
      border: 1px solid var(--bim-ui_bg-contrast-20);
    }

    ::slotted(bim-toolbar-section:not(:last-child)) {
      border-right: 1px solid var(--bim-ui_bg-contrast-20);
      border-bottom: none;
    }

    :host([vertical]) ::slotted(bim-toolbar-section:not(:last-child)) {
      border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      border-right: none;
    }
  `;let fa=om;zc([W({type:String,reflect:!0})],fa.prototype,"icon",2);zc([W({type:Boolean,attribute:"labels-hidden",reflect:!0})],fa.prototype,"labelsHidden",2);zc([W({type:Boolean,reflect:!0})],fa.prototype,"vertical",1);var mx=Object.defineProperty,gx=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&mx(e,t,n),n};const am=class extends Ce{constructor(){super(),this._onResize=new Event("resize"),new ResizeObserver(()=>{setTimeout(()=>{this.dispatchEvent(this._onResize)})}).observe(this)}render(){return H`
      <div class="parent">
        <slot></slot>
      </div>
    `}};am.styles=$e`
    :host {
      display: grid;
      min-width: 0;
      min-height: 0;
      height: 100%;
    }

    .parent {
      overflow: hidden;
      position: relative;
    }
  `;let lm=am;gx([W({type:String,reflect:!0})],lm.prototype,"name");class bx{static init(){lt.defineCustomElement("bim-view-cube",xi),lt.defineCustomElement("bim-world-2d",cn),lt.defineCustomElement("bim-world",Mp)}}const qs=(s,e)=>{const t=e[s],i=(t==null?void 0:t.name)??s,n=i.trim().split(/\s+/);let r,o;return n[0]&&n[0][0]&&(r=n[0][0].toUpperCase(),n[0][1]&&(o=n[0][1].toUpperCase())),n[1]&&n[1][0]&&(o=n[1][0].toUpperCase()),H`
    <div style="display: flex; gap: 0.25rem; overflow: hidden;">
      ${!(t!=null&&t.picture)&&(r||o)?H`
        <bim-label
          style=${mi({borderRadius:"999px",padding:"0.375rem",backgroundColor:"var(--bim-ui_bg-contrast-20)",aspectRatio:"1",fontSize:"0.7rem"})}>${r}${o}</bim-label>
        `:null}
      <bim-label .img=${t==null?void 0:t.picture}>${i}</bim-label>
    </div>
  `},_t={users:{"jhon.doe@example.com":{name:"Jhon Doe"}},priorities:{"On hold":{icon:"flowbite:circle-pause-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#767676"}},Minor:{icon:"mingcute:arrows-down-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#4CAF50"}},Normal:{icon:"fa6-solid:grip-lines",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Major:{icon:"mingcute:arrows-up-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Critical:{icon:"ph:warning",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}}},statuses:{Active:{icon:"prime:circle-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)"}},"In Progress":{icon:"prime:circle-fill",style:{backgroundColor:"#fa89004d","--bim-label--c":"#FB8C00","--bim-icon--c":"#FB8C00"}},"In Review":{icon:"prime:circle-fill",style:{backgroundColor:"#9c6bff4d","--bim-label--c":"#9D6BFF","--bim-icon--c":"#9D6BFF"}},Done:{icon:"prime:circle-fill",style:{backgroundColor:"#4CAF504D","--bim-label--c":"#4CAF50","--bim-icon--c":"#4CAF50"}},Closed:{icon:"prime:circle-fill",style:{backgroundColor:"#414141","--bim-label--c":"#727272","--bim-icon--c":"#727272"}}},types:{Clash:{icon:"gg:close-r",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Issue:{icon:"mdi:bug-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Failure:{icon:"mdi:bug-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Inquiry:{icon:"majesticons:comment-line",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Fault:{icon:"ph:warning",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Remark:{icon:"ph:note-blank-bold",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Request:{icon:"mynaui:edit-one",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#9D6BFF"}}}},Ws={padding:"0.25rem 0.5rem",borderRadius:"999px","--bim-label--c":"var(--bim-ui_bg-contrast-100)"},yx={dueDate:s=>{if(typeof s=="string"&&s.trim()!=="")return new Date(s)},status:s=>{if(Array.isArray(s)&&s.length!==0)return s[0]},type:s=>{if(Array.isArray(s)&&s.length!==0)return s[0]},priority:s=>{if(Array.isArray(s)&&s.length!==0)return s[0]},stage:s=>{if(Array.isArray(s)&&s.length!==0)return s[0]},assignedTo:s=>{if(Array.isArray(s)&&s.length!==0)return s[0]},labels:s=>{if(Array.isArray(s))return new Set(s)}},cm=s=>{const{components:e,topic:t,value:i,onCancel:n,onSubmit:r,styles:o}=s,a=r??(()=>{}),l=e.get(Wo),c=(i==null?void 0:i.title)??(t==null?void 0:t.title)??Ei.default.title,h=(i==null?void 0:i.status)??(t==null?void 0:t.status)??Ei.default.status,d=(i==null?void 0:i.type)??(t==null?void 0:t.type)??Ei.default.type,p=(i==null?void 0:i.priority)??(t==null?void 0:t.priority)??Ei.default.priority,u=(i==null?void 0:i.assignedTo)??(t==null?void 0:t.assignedTo)??Ei.default.assignedTo,g=(i==null?void 0:i.labels)??(t==null?void 0:t.labels)??Ei.default.labels,m=(i==null?void 0:i.stage)??(t==null?void 0:t.stage)??Ei.default.stage,b=(i==null?void 0:i.description)??(t==null?void 0:t.description)??Ei.default.description,f=t!=null&&t.dueDate?t.dueDate.toISOString().split("T")[0]:null,y=new Set([...l.config.statuses]);h&&y.add(h);const v=new Set([...l.config.types]);d&&v.add(d);const w=new Set([...l.config.priorities]);p&&w.add(p);const E=new Set([...l.config.users]);u&&E.add(u);const S=new Set([...l.config.labels]);if(g)for(const _ of g)S.add(_);const $=new Set([...l.config.stages]);m&&$.add(m);const M=kl(),k=async()=>{const{value:_}=M;if(!_)return;const L=gr(_,yx);if(t)t.set(L),await a(t);else{const G=l.create(L);await a(G)}},z=kl(),j=_=>{const{value:L}=z;if(!L)return;const G=_.target;L.disabled=G.value.trim()===""},A=`btn-${lt.newRandomId()}`,P=`btn-${lt.newRandomId()}`;return H`
    <div ${Ke(M)} style="display: flex; flex-direction: column; gap: 0.75rem;">
      <div style="display: flex; gap: 0.375rem">
        <bim-text-input @input=${j} vertical label="Title" name="title" .value=${c}></bim-text-input>
        ${t?H`
            <bim-dropdown vertical label="Status" name="status" required>
              ${[...y].map(_=>H`<bim-option label=${_} .checked=${h===_}></bim-option>`)}
            </bim-dropdown>`:H``}
      </div>
      <div style="display: flex; gap: 0.375rem">
        <bim-dropdown vertical label="Type" name="type" required>
          ${[...v].map(_=>H`<bim-option label=${_} .checked=${d===_}></bim-option>`)}
        </bim-dropdown>
        <bim-dropdown vertical label="Priority" name="priority">
          ${[...w].map(_=>H`<bim-option label=${_} .checked=${p===_}></bim-option>`)}
        </bim-dropdown>
      </div>
      <div style="display: flex; gap: 0.375rem">
        <bim-dropdown vertical label="Labels" name="labels" multiple>
          ${[...S].map(_=>H`<bim-option label=${_} .checked=${g?[...g].includes(_):!1}></bim-option>`)}
        </bim-dropdown>
        <bim-dropdown vertical label="Assignee" name="assignedTo">
          ${[...E].map(_=>{const L=o!=null&&o.users?o.users[_]:null,G=L?L.name:_,V=L==null?void 0:L.picture;return H`<bim-option label=${G} value=${_} .img=${V} .checked=${u===_}></bim-option>`})}
        </bim-dropdown>
      </div>
      <div style="display: flex; gap: 0.375rem">
        <bim-text-input vertical type="date" label="Due Date" name="dueDate" .value=${f}></bim-text-input> 
        <bim-dropdown vertical label="Stage" name="stage">
          ${[...$].map(_=>H`<bim-option label=${_} .checked=${m===_}></bim-option>`)}
        </bim-dropdown>
      </div>
      <bim-text-input vertical label="Description" name="description" type="area" .value=${b??null}></bim-text-input>
      <div style="justify-content: right; display: flex; gap: 0.375rem">
        <style>
          #${P} {
            background-color: transparent;
          }

          #${P}:hover {
            --bim-label--c: #FF5252;
          }

          #${A}:hover {
            background-color: #329936;
          }
        </style>
        <bim-button id=${P} style="flex: 0" @click=${n} label="Cancel"></bim-button>
        <bim-button id=${A} style="flex: 0" @click=${k} ${Ke(z)} label=${t?"Update Topic":"Add Topic"} icon=${t?"tabler:refresh":"mi:add"}></bim-button>
      </div>
    </div>
  `},vx=s=>{const{components:e,modelUserData:t,worldName:i}=s;return H`
    <bim-button
      data-ui-id="import-ifc"
      label="Load IFC"
      icon="mage:box-3d-fill"
      @click=${()=>{if(!(e&&i))return;const n=[...e.get(qo).list.values()].find(o=>"name"in o&&o.name===i);if(!n)return;const r=document.createElement("input");r.type="file",r.accept=".ifc",r.onchange=async()=>{if(r.files===null||r.files.length===0)return;const o=r.files[0],a=await o.arrayBuffer(),l=new Uint8Array(a),c=o.name.replace(".ifc",""),h=e.get(Yt),d=e.get(cg);d.settings.autoSetWasm=!1,d.settings.wasm={path:"https://unpkg.com/web-ifc@0.0.72/",absolute:!1};const p=await d.load(l,!0,c,{userData:t});n.scene.three.add(p.object),p.useCamera(n.camera.three),h.core.update(!0)},r.click()}}
    ></bim-button>
  `},_x=s=>Ye.create(vx,s),wx=Object.freeze(Object.defineProperty({__proto__:null,loadIfc:_x},Symbol.toStringTag,{value:"Module"})),xx=s=>{const{components:e,world:t}=s;return H`
    <bim-button @click=${()=>{const i=document.createElement("input");i.type="file",i.accept=".frag",i.onchange=async()=>{if(i.files===null||i.files.length===0)return;const n=i.files[0],r=await n.arrayBuffer(),o=new Uint8Array(r),a=n.name.replace(".frag",""),l=e.get(Yt),c=await l.core.load(o,{modelId:a});t&&(t.scene.three.add(c.object),c.useCamera(t.camera.three),l.core.update(!0))},i.click()}}></bim-button>
  `},Cx=s=>{const e=Ye.create(xx,s),[t]=e;return t.label="Load FRAG",t.icon="mage:box-3d-fill",e},Ex=Object.freeze(Object.defineProperty({__proto__:null,loadFrag:Cx},Symbol.toStringTag,{value:"Module"}));({...wx,...Ex});const ql=async(s,e)=>{const{localId:t,category:i,children:n}=e;if(i&&n){const r={data:{Name:i,modelId:s.modelId,children:JSON.stringify(n.map(o=>o.localId))}};for(const o of n){const a=await ql(s,o);a&&(r.children||(r.children=[]),r.children.push(a))}return r}if(t!==null){const r=await s.getItem(t).getAttributes();if(!r)return null;const o={data:{Name:String(r.getValue("Name")),modelId:s.modelId,localId:t}};for(const a of n??[]){const l=await ql(s,a);l&&(o.children||(o.children=[]),o.children.push(l))}return o}return null},Sx=async s=>{const e=[];for(const t of s){const i=await t.getSpatialStructure(),n=await ql(t,i);if(!n)continue;const r={data:{Name:t.modelId,modelId:t.modelId},children:[n]};e.push(r)}return e},hm=s=>{const{components:e,models:t}=s,i=s.selectHighlighterName??"select";return H`
    <bim-table @rowcreated=${n=>{n.stopImmediatePropagation();const{row:r}=n.detail,o=e.get(Yn),a=e.get(Yt);r.onclick=async()=>{if(!i)return;const{data:{modelId:l,localId:c,children:h}}=r;if(!(l&&(c!==void 0||h)))return;const d=a.list.get(l);if(d){if(c!==void 0){const p=await d.getItemsChildren([c]),u={[l]:p.length!==0?new Set(p):new Set([c])};o.highlightByID(i,u,!0,!0)}else if(h){const p=JSON.parse(h),u=await d.getItemsChildren(p),g={[l]:u.length!==0?u:p};o.highlightByID(i,g,!0,!0)}}}}} @cellcreated=${({detail:n})=>{const{cell:r}=n;r.column==="Name"&&!r.rowData.Name&&(r.style.gridColumn="1 / -1")}} ${Ke(async n=>{if(!n)return;const r=n;r.loadFunction=async()=>new Promise(o=>{setTimeout(()=>{o(Sx(t))})}),r.loadData(!0)})} headers-hidden>
      <bim-label slot="missing-data" style="--bim-icon--c: gold" icon="ic:round-warning">
        No models available to display the spatial structure!
      </bim-label>
    </bim-table>
  `},Ax=(s,e=!0)=>{const t=Ye.create(hm,s),[i,n]=t;if(i.hiddenColumns=["modelId","localId","children"],i.columns=["Name"],i.headersHidden=!0,e){const{components:r}=s,o=r.get(Yt);o.list.onItemSet.add(()=>n({models:o.list.values()})),o.list.onItemDeleted.add(()=>n())}return t},$x=Object.freeze(Object.defineProperty({__proto__:null,spatialTree:Ax,spatialTreeTemplate:hm},Symbol.toStringTag,{value:"Module"}));let cs={};const Wd={_category:"Category",_localId:"LocalId",_guid:"Guid"},Tx=(s,e,t)=>{const i={data:{Name:e in Wd?Wd[e]:e,Value:t}};s.children||(s.children=[]),s.children.push(i)},dm=(s,e,t)=>{var i;s in cs||(cs[s]=new Map);const n=cs[s],r=e._localId.value;if(n.has(r))return n.get(r);const o=(i=e[t.defaultItemNameKey])==null?void 0:i.value,a=e._category.value,l={data:{Name:(o==null?void 0:o.toString().length)>0?o.toString():a??String(r)}};n.set(r,l);for(const c in e){const h=e[c];if(!Array.isArray(h))Tx(l,c,h.value);else{const d={data:{Name:c}};l.children||(l.children=[]),l.children.push(d);for(const p of h){const u=dm(s,p,t);d.children||(d.children=[]),d.children.push(u)}}}return l},kx=async(s,e,t)=>{const i=s.get(Yt);Object.keys(e).length===0&&(cs={});const n=[];for(const r in e){const o=i.list.get(r);if(!o)continue;r in cs||(cs[r]=new Map);const a=cs[r],l=e[r];for(const c of l){let h=a.get(c);if(h){n.push(h);continue}const[d]=await o.getItemsData([c],t.itemsDataConfig);h=dm(r,d,t),n.push(h)}}return n},um=s=>{const e={defaultItemNameKey:"Name",itemsDataConfig:{attributesDefault:!0,relationsDefault:{attributes:!1,relations:!1},relations:{IsDefinedBy:{attributes:!0,relations:!0},DefinesOcurrence:{attributes:!1,relations:!1},ContainedInStructure:{attributes:!0,relations:!0},ContainsElements:{attributes:!1,relations:!1},Decomposes:{attributes:!1,relations:!1}}},...s},{components:t,modelIdMap:i,emptySelectionWarning:n}=s;return H`
    <bim-table @cellcreated=${({detail:r})=>{const{cell:o}=r;o.column==="Name"&&!("Value"in o.rowData)&&(o.style.gridColumn="1 / -1")}} ${Ke(async r=>{if(!r)return;const o=r;o.loadFunction=async()=>kx(t,i,e),await o.loadData(!0)&&o.dispatchEvent(new Event("datacomputed"))})}>
      ${n?H`
            <bim-label slot="missing-data" style="--bim-icon--c: gold" icon="ic:round-warning">
              Select some elements to display its properties
            </bim-label>
            `:null}
      <bim-label slot="error-loading" style="--bim-icon--c: #e72e2e" icon="bxs:error-alt">
        Something went wrong with the properties
      </bim-label>
    </bim-table>
  `},Px=(s,e)=>{e.columns=[{name:"Name",width:"12rem"}],e.headersHidden=!0},Ox=s=>{const e=Ye.create(um,s),[t]=e;return Px(s,t),e},Mx=Object.freeze(Object.defineProperty({__proto__:null,itemsData:Ox,itemsDataTemplate:um},Symbol.toStringTag,{value:"Module"})),pm=s=>{const{components:e}=s,t=s.missingDataMessage??"No models has been loaded yet",i=e.get(Yt),n=({detail:r})=>{const{cell:o}=r;o.style.padding="0.25rem 0"};return H`
    <bim-table ${Ke(async r=>{if(!r)return;const o=r,a=[];if(i.initialized)for(const[,l]of i.list){if(!l)continue;const c=await l.getMetadata(),h={data:{Name:l.modelId,modelId:l.modelId,metadata:JSON.stringify(c)}};a.push(h)}o.data=a})} @cellcreated=${n}>
      <bim-label slot="missing-data" style="--bim-icon--c: gold" icon="ic:round-warning">
        ${t}
      </bim-label>
    </bim-table>
  `},Ix=(s,e)=>{const{components:t,actions:i,metaDataTags:n}=s,r=t.get(Yt),o=(i==null?void 0:i.dispose)??!0,a=(i==null?void 0:i.download)??!0,l=(i==null?void 0:i.visibility)??!0,c=n??[];e.hiddenColumns=["modelId","metadata"],e.headersHidden=!0,e.noIndentation=!0,e.dataTransform={Name:(h,d)=>{if(!r.initialized)return h;const{modelId:p,metadata:u}=d;if(!p)return h;const g=r.list.get(p);if(!g)return p;const m=[];if(u){const v=JSON.parse(u);for(const w of c){const E=v[w];if(!(typeof E=="string"||typeof E=="boolean"||typeof E=="number"))continue;const S=H`
            <bim-label style="background-color: var(--bim-ui_main-base); padding: 0 0.25rem; color: var(--bim-ui_main-contrast); border-radius: 0.25rem;">${E}</bim-label>
            `;m.push(S)}}let b;o&&(b=H`<bim-button @click=${()=>r.core.disposeModel(g.modelId)} icon="mdi:delete"></bim-button>`);let f;l&&(f=H`<bim-button @click=${async({target:v})=>{v.loading=!0,await g.setVisible(void 0,v.hasAttribute("data-model-hidden")),await r.core.update(!0),v.toggleAttribute("data-model-hidden"),v.icon=v.hasAttribute("data-model-hidden")?"mdi:eye-off":"mdi:eye",v.loading=!1}} icon="mdi:eye"></bim-button>`);let y;return a&&(y=H`<bim-button @click=${async()=>{const v=await g.getBuffer(!1),w=new File([v],`${g.modelId}.frag`),E=document.createElement("a");E.href=URL.createObjectURL(w),E.download=w.name,E.click(),URL.revokeObjectURL(E.href)}} icon="flowbite:download-solid"></bim-button>`),H`
       <div style="display: flex; flex: 1; gap: var(--bim-ui_size-4xs); justify-content: space-between; overflow: auto;">
        <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 0 var(--bim-ui_size-4xs); flex-grow: 1; overflow: auto;">
          <div style="min-height: 1.75rem; overflow: auto; display: flex;">
            <bim-label style="white-space: normal;">${h}</bim-label>
          </div>
          <div style="display: flex; flex-wrap: wrap; gap: var(--bim-ui_size-4xs); overflow: auto;">
            ${m}
          </div>
        </div>
        <div style="display: flex; align-self: flex-start; flex-shrink: 0;">
          ${y}
          ${f}
          ${b}
        </div>
       </div>
      `}}},zx=(s,e=!0)=>{const t=Ye.create(pm,s),[i,n]=t;if(Ix(s,i),e){const{components:r}=s,o=r.get(Yt),a=()=>setTimeout(()=>n());o.list.onItemSet.add(a),o.list.onItemDeleted.add(a)}return t},Dx=Object.freeze(Object.defineProperty({__proto__:null,modelsList:zx,modelsListTemplate:pm},Symbol.toStringTag,{value:"Module"})),fm=s=>{var e;const{components:t}=s,i=s.missingDataMessage??"No viewpoints to display",n=t.get(Yo),r=((e=s.topic)==null?void 0:e.viewpoints)??n.list.keys(),o=[];for(const c of r){const h=n.list.get(c);h&&o.push(h)}const a=c=>{if(!c)return;const h=c;h.data=o.map((d,p)=>({data:{Guid:d.guid,Title:d.title??`Viewpoint ${s.topic?p+1:""}`,Actions:""}}))},l=({detail:c})=>{const{cell:h}=c;h.style.padding="0.25rem"};return H`
    <bim-table ${Ke(a)} @cellcreated=${l}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${i}</bim-label>
    </bim-table>
  `},Lx=(s,e)=>{const{components:t,topic:i}=s;e.noIndentation=!0,e.headersHidden=!0,e.hiddenColumns=["Guid"],e.columns=["Title",{name:"Actions",width:"auto"}];const n={selectComponents:!0,colorizeComponent:!0,resetColors:!0,updateCamera:!0,delete:!0,unlink:!!i,...s.actions},r=t.get(Yo);e.dataTransform={Actions:(o,a)=>{const{Guid:l}=a;if(!(l&&typeof l=="string"))return o;const c=r.list.get(l);if(!c)return o;const h=async({target:y})=>{y.loading=!0,await c.go(),y.loading=!1};let d;n.selectComponents&&(d=H`
          <bim-button label="Select Components" @click=${async({target:y})=>{const v=t.get(Yt),w=t.get(Yn);if(!w.isSetup)return;y.loading=!0;const E=await v.guidsToModelIdMap([...c.selectionComponents]);await w.highlightByID("select",E),y.loading=!1}}></bim-button>
        `);let p;n.colorizeComponent&&(p=H`
          <bim-button label="Colorize Components" @click=${async({target:y})=>{y.loading=!0,await c.setColorizationState(!0),y.loading=!1}}></bim-button>
        `);let u;n.resetColors&&(u=H`
          <bim-button label="Reset Colors" @click=${async({target:y})=>{y.loading=!0,await c.setColorizationState(!1),y.loading=!1}}></bim-button>
        `);let g;n.updateCamera&&(g=H`
          <bim-button label="Update Camera" @click=${()=>c.updateCamera()}></bim-button>
        `);let m;n.unlink&&(m=H`
          <bim-button label="Unlink" @click=${()=>i==null?void 0:i.viewpoints.delete(c.guid)}></bim-button>
        `);let b;n.delete&&(b=H`
          <bim-button label="Delete" @click=${()=>{r.list.delete(c.guid),er.removeMenus()}}></bim-button>
        `);let f;return Object.values(n).includes(!0)&&(f=H`
          <bim-button icon="prime:ellipsis-v">
            <bim-context-menu>
              ${d}
              ${p}
              ${u}
              ${g}
              ${m}
              ${b}
            </bim-context-menu>
          </bim-button>
        `),H`
        <bim-button icon="ph:eye-fill" @click=${h}></bim-button>
        ${f}
      `}}},mm=(s,e=!0)=>{const t=Ye.create(fm,s),[i,n]=t;if(Lx(s,i),e){const{components:r,topic:o}=s,a=r.get(Yo);a.list.onItemUpdated.add(()=>n()),a.list.onItemDeleted.add(()=>n()),a.list.onCleared.add(()=>n()),o?(o.viewpoints.onItemAdded.add(()=>n()),o.viewpoints.onItemDeleted.add(()=>n()),o.viewpoints.onCleared.add(()=>n())):a.list.onItemSet.add(()=>n())}return t},Bx=Object.freeze(Object.defineProperty({__proto__:null,viewpointsList:mm,viewpointsListTemplate:fm},Symbol.toStringTag,{value:"Module"})),gm=s=>{const{components:e}=s,t=s.missingDataMessage??"No topics to display",i=e.get(Wo),n=s.topics??i.list.values();return H`
    <bim-table no-indentation ${Ke(r=>{if(!r)return;const o=r;o.data=[...n].map(a=>{var l;return{data:{Guid:a.guid,Title:a.title,Status:a.status,Description:a.description??"",Author:a.creationAuthor,Assignee:a.assignedTo??"",Date:a.creationDate.toDateString(),DueDate:((l=a.dueDate)==null?void 0:l.toDateString())??"",Type:a.type,Priority:a.priority??"",Actions:""}}})})}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${t}</bim-label>
    </bim-table>
  `},Nx=(s,e)=>{const{dataStyles:t}=s;e.hiddenColumns.length===0&&(e.hiddenColumns=["Guid","Actions"]),e.columns=["Title"],e.dataTransform={Priority:i=>{if(typeof i!="string")return i;const n=((t==null?void 0:t.priorities)??_t.priorities)[i];return H`
            <bim-label
              .icon=${n==null?void 0:n.icon}
              style=${mi({...Ws,...n==null?void 0:n.style})}
            >${i}
            </bim-label>
          `},Status:i=>{if(typeof i!="string")return i;const n=((t==null?void 0:t.statuses)??_t.statuses)[i];return H`
            <bim-label
              .icon=${n==null?void 0:n.icon}
              style=${mi({...Ws,...n==null?void 0:n.style})}
            >${i}
            </bim-label>
          `},Type:i=>{if(typeof i!="string")return i;const n=((t==null?void 0:t.types)??_t.types)[i];return H`
            <bim-label
              .icon=${n==null?void 0:n.icon}
              style=${mi({...Ws,...n==null?void 0:n.style})}
            >${i}
            </bim-label>
          `},Author:i=>typeof i!="string"?i:qs(i,(t==null?void 0:t.users)??_t.users),Assignee:i=>typeof i!="string"?i:qs(i,(t==null?void 0:t.users)??_t.users)}},bm=(s,e=!0)=>{const t=Ye.create(gm,s),[i,n]=t;if(Nx(s,i),e){const{components:r,topics:o}=s,a=r.get(Wo),l=()=>n();if(a.list.onItemUpdated.add(l),a.list.onItemDeleted.add(l),o)for(const c of o)c.relatedTopics.onItemAdded.add(l),c.relatedTopics.onItemDeleted.add(l),c.relatedTopics.onCleared.add(l);else a.list.onItemSet.add(l)}return t},Rx=Object.freeze(Object.defineProperty({__proto__:null,topicsList:bm,topicsListTemplate:gm},Symbol.toStringTag,{value:"Module"})),ym=s=>{const{topic:e,styles:t,viewpoint:i}=s,n=s.missingDataMessage??"The topic has no comments";return H`
    <bim-table no-indentation ${Ke(r=>{if(!r)return;const o=r;let a=e.comments.values();i&&(a=[...e.comments.values()].filter(l=>l.viewpoint===i.guid)),o.data=[...a].map(l=>({data:{guid:l.guid,Comment:l.comment,author:(()=>{const c=t;if(!c)return l.author;const h=c[l.author];return(h==null?void 0:h.name)??l.author})()}}))})}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${n}</bim-label>
    </bim-table>
  `},Ux=(s,e)=>{const{topic:t,styles:i}=s,n={delete:!0,...s.actions};e.headersHidden=!0,e.hiddenColumns=["guid","author"],e.dataTransform={Comment:(r,o)=>{const{guid:a}=o;if(typeof a!="string")return r;const l=t.comments.get(a);if(!l)return r;const c=()=>{t.comments.delete(a)};let h;if(n.delete){const d=`btn-${lt.newRandomId()}`;h=H`
          <div>
            <style>
              #${d} {
                background-color: transparent;
                --bim-label--c: var(--bim-ui_bg-contrast-60)
              }
  
              #${d}:hover {
                --bim-label--c: #FF5252;
              }
            </style>
            <bim-button @click=${c} id=${d} icon="majesticons:delete-bin"></bim-button>
          </div>
        `}return H`
        <div style="display: flex; flex-direction: column; gap: 0.25rem; flex: 1">
          <div style="display: flex; justify-content: space-between;">
            <div style="display: flex; gap: 0.375rem;">
              ${qs(l.author,i??_t.users)}
              <bim-label style="color: var(--bim-ui_bg-contrast-40)">@ ${l.date.toDateString()}</bim-label>
            </div>
            ${h}
          </div>
          <bim-label style="margin-left: 1.7rem; white-space: normal">${l.comment}</bim-label>
        </div>
      `}}},vm=(s,e=!0)=>{const t=Ye.create(ym,s),[i,n]=t;if(Ux(s,i),e){const{topic:r}=s,o=()=>n();r.comments.onItemSet.add(o),r.comments.onItemUpdated.add(o),r.comments.onItemDeleted.add(o),r.comments.onCleared.add(o)}return t},Fx=Object.freeze(Object.defineProperty({__proto__:null,commentsList:vm,commentsListTemplate:ym},Symbol.toStringTag,{value:"Module"}));({...$x,...Mx,...Dx,...Bx,...Rx,...Fx});const _m=(s,e)=>{const{showInput:t,topic:i,styles:n}=s,r={add:!0,delete:!0,...s.actions},o=`input-${lt.newRandomId()}`,a=`btn-${lt.newRandomId()}`,l=`btn-${lt.newRandomId()}`,c=()=>document.getElementById(a),h=()=>document.getElementById(o),d=()=>{const v=h();return v?v.value.trim().length>0:!1},p=()=>{e({showInput:!0})},u=()=>{const v=h(),w=d();v&&w&&(i.createComment(v.value),e({showInput:!1}))},g=()=>{e({showInput:!1})},m=()=>{const v=c();if(v){if(!h()){v.disabled=!0;return}v.disabled=!d()}},b=H`
    ${r.add?H`<bim-button @click=${p} label="Add Comment" icon="majesticons:comment-line"></bim-button>`:null}
  `,f=H`
    <bim-text-input id=${o} @input=${m} @keypress=${v=>{v.code==="Enter"&&v.ctrlKey&&u()}} type="area"></bim-text-input>

    <div style="justify-content: right; display: flex; gap: 0.375rem">
      <style>
        #${a} {
          background-color: #329936;
        }  

        #${l} {
          background-color: transparent;
        }

        #${l}:hover {
          --bim-label--c: #FF5252;
        }
      </style>

      <bim-button style="flex: 0" id=${l} @click=${g} label="Cancel"></bim-button>
      <bim-button style="flex: 0" id=${a} @click=${u} label="Accept" icon="material-symbols:check" disabled></bim-button>
    </div>
  `,[y]=vm({topic:i,actions:r,styles:n??_t.users});return H`
    <div style="display: flex; flex-direction: column; gap: 0.5rem">
      ${y}
      ${t?f:b}
    </div>
  `},jx=s=>Ye.create(_m,s),Hx=Object.freeze(Object.defineProperty({__proto__:null,topicComments:jx,topicCommentsSectionTemplate:_m},Symbol.toStringTag,{value:"Module"})),wm=(s,e)=>{const{components:t,editing:i,topic:n,styles:r}=s,o={update:!0,...s.actions},a=(r==null?void 0:r.priorities)??_t.priorities,l=(r==null?void 0:r.statuses)??_t.statuses,c=(r==null?void 0:r.types)??_t.types;let h;n!=null&&n.priority&&(h=a[n.priority]);let d;n!=null&&n.type&&(d=c[n.type]);let p;n!=null&&n.type&&(p=l[n.status]);let u,g;return i?u=cm({components:t,topic:n,styles:r,onSubmit:()=>{e({editing:!1})},onCancel:()=>{e({editing:!1})}}):g=H`
      <div>
        <bim-label>Title</bim-label>
        <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${n.title}</bim-label>
      </div>

      ${n.description?H`
            <div>
              <bim-label>Description</bim-label>
              <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100); white-space: normal">${n.description}</bim-label>
            </div>
          `:null}

      <div style="display: flex; gap: 0.375rem">
        <bim-label>Status</bim-label>
        <bim-label .icon=${p==null?void 0:p.icon} style=${mi({...Ws,...p==null?void 0:p.style})}
        >${n.status}
        </bim-label>
      </div>

      <div style="display: flex; gap: 0.375rem">
        <bim-label>Type</bim-label>
        <bim-label .icon=${d==null?void 0:d.icon} style=${mi({...Ws,...d==null?void 0:d.style})}
        >${n.type}
        </bim-label>
      </div>

      ${n.priority?H`
            <div style="display: flex; gap: 0.375rem">
              <bim-label>Priority</bim-label>
              <bim-label .icon=${h==null?void 0:h.icon} style=${mi({...Ws,...h==null?void 0:h.style})}
              >${n.priority}
              </bim-label>
            </div>`:null}

      <div style="display: flex; gap: 0.375rem">
        <bim-label>Author</bim-label>
        ${qs(n.creationAuthor,(r==null?void 0:r.users)??_t.users)}
      </div>

      ${n.assignedTo?H`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Assignee</bim-label>
            ${qs(n.assignedTo,(r==null?void 0:r.users)??_t.users)}
          </div>`:null}

      ${n.dueDate?H`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Due Date</bim-label>
            <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${n.dueDate.toDateString()}</bim-label>
          </div>`:null}

      ${n.modifiedAuthor?H`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Modified By</bim-label>
            ${qs(n.modifiedAuthor,(r==null?void 0:r.users)??_t.users)}
          </div>`:null}

      ${n.modifiedDate?H`
            <div style="display: flex; gap: 0.375rem">
              <bim-label>Modified Date</bim-label>
              <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${n.modifiedDate.toDateString()}</bim-label>
            </div>`:null}

      ${n.labels.size!==0?H`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Labels</bim-label>
            <bim-label style="white-space: normal; --bim-label--c: var(--bim-ui_bg-contrast-100)">${[...n.labels].join(", ")}</bim-label>
          </div>`:null}

      ${o.update?H`
              <bim-button @click=${()=>e({editing:!0})} label="Update Information" icon="tabler:refresh"></bim-button> 
            `:null}
    `,H`
    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
      ${i?u:g}
    </div>
  `},Vx=s=>Ye.create(wm,s),qx=Object.freeze(Object.defineProperty({__proto__:null,topicInformation:Vx,topicInformationSectionTemplate:wm},Symbol.toStringTag,{value:"Module"})),xm=(s,e)=>{const{components:t,topic:i,linking:n}=s,r=t.get(Wo),o={link:!0,...s.actions},[a,l]=bm({components:t,topics:[...i.relatedTopics].map(p=>r.list.get(p)).map(p=>p)});a.headersHidden=!0,a.hiddenColumns=["Guid","Status","Description","Author","Assignee","Date","DueDate","Type","Priority"];const c=()=>H`
      <bim-text-input placeholder="Search..." debounce="100" @input=${p=>{const u=p.target;u instanceof yt&&(a.queryString=u.value)}}></bim-text-input> 
    `;let h,d;if(n){a.selectableRows=!0,l({topics:void 0});const p=a.data.filter(f=>{const{Guid:y}=f.data;return typeof y!="string"?!1:i.relatedTopics.has(y)}).map(f=>f.data);a.selection=new Set(p);const u=()=>{const f=[...a.selection].map(({Guid:y})=>typeof y!="string"?null:r.list.has(y)?y:null).map(y=>y);i.relatedTopics.clear(),i.relatedTopics.add(...f),e({linking:!1})},g=()=>{e({linking:!1})},m=`btn-${lt.newRandomId()}`,b=`btn-${lt.newRandomId()}`;h=H`
      <div style="display: flex; gap: 0.25rem">
        <style>
          #${m}:hover {
            background-color: #329936;
          }  

          #${b} {
            background-color: transparent;
          }

          #${b}:hover {
            --bim-label--c: #FF5252;
          }
        </style>
        ${c()}
        <div style="display: flex; justify-content: right; gap: 0.25rem">
          <bim-button id=${b} @click=${g} style="flex: 0" label="Cancel" icon="material-symbols:close"></bim-button>
          <bim-button id=${m} @click=${u} style="flex: 0" label="Accept" icon="material-symbols:check"></bim-button>
        </div>
      </div> 
    `}else{a.selectableRows=!1;const p=()=>{e({linking:!0})};d=H`
      <div style="display: flex; justify-content: right; gap: 0.25rem">
        ${c()}
        ${o.link?H`<bim-button style="flex: 0" @click=${p} icon="tabler:link"></bim-button>`:null}
      </div> 
    `}return H`
    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
      ${d}
      ${h}
      ${a}
    </div> 
  `},Wx=s=>Ye.create(xm,s),Yx=Object.freeze(Object.defineProperty({__proto__:null,topicRelations:Wx,topicRelationsSectionTemplate:xm},Symbol.toStringTag,{value:"Module"})),Cm=(s,e)=>{const{components:t,topic:i,world:n,linking:r}=s,o={add:!0,link:!0,selectComponents:!0,colorizeComponent:!0,resetColors:!0,updateCamera:!0,delete:!0,unlink:!0,...s.actions},a=t.get(Yo),[l,c]=mm({components:t,topic:i,actions:o}),h=()=>H`
      <bim-text-input placeholder="Search..." debounce="100" @input=${u=>{const g=u.target;g instanceof yt&&(l.queryString=g.value)}}></bim-text-input> 
    `;let d,p;if(r){l.selectableRows=!0,c({topic:void 0,actions:{delete:!1,updateCamera:!1,colorizeComponent:!1,resetColors:!1}});const u=l.data.filter(y=>{const{Guid:v}=y.data;return typeof v!="string"?!1:i.viewpoints.has(v)}).map(y=>y.data);l.selection=new Set(u);const g=()=>{const y=[...l.selection].map(({Guid:v})=>typeof v!="string"?null:a.list.has(v)?v:null).map(v=>v);i.viewpoints.clear(),i.viewpoints.add(...y),e({linking:!1})},m=()=>{e({linking:!1})},b=`btn-${lt.newRandomId()}`,f=`btn-${lt.newRandomId()}`;d=H`
      <div style="display: flex; gap: 0.25rem">
        <style>
          #${b}:hover {
            background-color: #329936;
          }  

          #${f} {
            background-color: transparent;
          }

          #${f}:hover {
            --bim-label--c: #FF5252;
          }
        </style>
        ${h()}
        <div style="display: flex; justify-content: right; gap: 0.25rem">
          <bim-button id=${f} @click=${m} style="flex: 0" label="Cancel" icon="material-symbols:close"></bim-button>
          <bim-button id=${b} @click=${g} style="flex: 0" label="Accept" icon="material-symbols:check"></bim-button>
        </div>
      </div> 
    `}else{l.selectableRows=!1,c({topic:i,actions:o});const u=()=>{if(!(i&&o.add&&!r))return;const f=a.create();n&&(f.world=n),i.viewpoints.add(f.guid)},g=()=>{e({linking:!0})},m=H`<bim-button style="flex: 0" @click=${u} .disabled=${!n} icon="mi:add"></bim-button>`,b=H`<bim-button style="flex: 0" @click=${g} icon="tabler:link"></bim-button>`;p=H`
      <div style="display: flex; justify-content: right; gap: 0.25rem">
        ${h()}
        <div style="display: flex; justify-content: right; gap: 0.25rem">
          ${o.add?m:null}
          ${o.link?b:null}
        </div>
      </div> 
    `}return H`
    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
      ${p}
      ${d}
      ${l}
    </div> 
  `},Zx=s=>Ye.create(Cm,s),Gx=Object.freeze(Object.defineProperty({__proto__:null,topicViewpoints:Zx,topicViewpointsSectionTemplate:Cm},Symbol.toStringTag,{value:"Module"}));({...Hx,...qx,...Yx,...Gx});const Xx=s=>H`
    <bim-panel-section fixed label="New Topic" name="topic">
      ${cm(s)}
    </bim-panel-section>
  `,Qx=s=>Ye.create(Xx,s),Kx=Object.freeze(Object.defineProperty({__proto__:null,topic:Qx},Symbol.toStringTag,{value:"Module"}));({...Kx});const Em=document.getElementById("container"),Xt=new hg,Jx=Xt.get(qo),Re=Jx.create();Re.scene=new Kl(Xt);Re.renderer=new dg(Xt,Em);Re.camera=new ug(Xt);Xt.init();ng.init();bx.init();Re.scene.setup();Re.camera.controls.setLookAt(5,5,5,0,0,0);Em.appendChild(Re.renderer.three2D.domElement);const eC=Xt.get(nu);eC.create(Re);Re.camera.three.far=1e4;Re.camera.three.updateProjectionMatrix();Re.scene.three.background=null;const ma=Xt.get(Yt);ma.init("https://thatopen.github.io/engine_fragment/resources/worker.mjs");const Sm="https://thatopen.github.io/engine_components/resources/frags/small_road.frag",tC=await fetch(Sm),iC=await tC.arrayBuffer(),sC=new Uint8Array(iC),ga=await ma.core.load(sC,{modelId:Sm,camera:Re.camera.three});Re.scene.three.add(ga.object);await ma.core.update(!0);Re.camera.controls.addEventListener("control",()=>ma.core.update());ga.getClippingPlanesEvent=()=>Array.from(Re.renderer.three.clippingPlanes)||[];const _i=await ga.getAlignments();Re.scene.three.add(_i);const ut=Xt.get(tl),Qe=ut.create("absolute");Qe.world=Re;for(const s of _i.children)s.userData.initialStation=1925;Qe.alignments.push(_i);Qe.updateAlignments();console.log(_i);const Ro=new Ri(void 0,20);Qe.onMarkerChange.add(({point:s})=>{Ro.center.copy(s),Re.camera.controls.fitToSphere(Ro,!0)});const qt=Xt.get(il);qt.world=Re;const nC=document.getElementById("horizontal-menu"),_s=document.createElement("bim-world-2d");_s.components=Xt;if(!_s.world)throw new Error("World not found!");nC.appendChild(_s);const wi=ut.create("horizontal");wi.world=_s.world;const ws=await ga.getHorizontalAlignments();for(const s of ws.children)s.rotation.x=Math.PI/2,s.rotation.y=Math.PI/2;wi.alignments.push(ws);wi.updateAlignments();const Am=_s.world.scene.three;Am.background=null;Am.add(ws);for(const s of ws.children)s.userData.initialStation=1925;Qe.onMarkerChange.add(s=>{console.log(s);const e=Di.curvePointToAlignmentPercentage(s.alignment,s.point,s.curve);if(e===null)return;const t=Di.alignmentPercentageToPoint(ws.children[0],e);t!==null&&(wi.setMarkerAtPoint(t,"select"),wi.setCursorValue(Qe.getCursorValue(),"select"))});const rC=Xt.get(Ql),oC=rC.get(_s.world);oC.three.params.Line.threshold=10;await _s.world.camera.controls.setLookAt(0,0,1e4,0,0,0,!1);const bn=new rg;bn.showPanel(2);document.body.append(bn.dom);bn.dom.style.left="0px";bn.dom.style.zIndex="unset";Re.renderer.onBeforeUpdate.add(()=>bn.begin());Re.renderer.onAfterUpdate.add(()=>bn.end());let gi=0,Ka=null,Yd=0,vo=!0,js=!1;function Wl(){const s=_i.children[gi],e=ws.children[gi];vo?(Qe.highlight(s),wi.highlight(e)):(Qe.clearHighlight(),wi.clearHighlight())}Wl();let Zd=-1;function Ii(){Zd!==gi&&Qe.clearStations(),Zd=gi;const s=_i.children[gi];js?(Qe.createStations(s),Qe.updateStations()):Qe.clearStations()}function Gd(s){const e=Di.alignmentPercentageToPoint(_i.children[gi],s);e&&(Ro.center.copy(e.point),Re.camera.controls.fitToSphere(Ro,!0),Qe.setMarkerAtPoint(e,"select"),qt.set(e.point,e.normal),Ka&&clearTimeout(Ka),qt.sectionVisible=!1,Ka=setTimeout(()=>{qt.plane.enabled&&qt.update()},1e3),js&&qt.plane.enabled&&Ii());const t=Di.alignmentPercentageToPoint(ws.children[gi],s);t&&(wi.setMarkerAtPoint(t,"select"),wi.setCursorValue(Qe.getCursorValue(),"select"))}const $m=1e3;let Uo=0;Re.camera.controls.addEventListener("update",()=>{const s=Date.now();s-Uo>$m&&(Ii(),Uo=s)});Re.camera.controls.addEventListener("update",()=>{const s=Date.now();s-Uo>$m&&(Ii(),Uo=s)});const tr=tu.create(()=>el`
  <bim-panel active label="Civil 3D Navigator Tutorial" class="options-menu">

      <bim-panel-section label="Alignments">

         <bim-dropdown required label="Selected alignment"
             @change="${({target:s})=>{gi=s.value[0],vo&&Wl(),js&&Ii()}}">

          ${_i.children.map(()=>el`
              <bim-option ?checked=${Yd===0} label="${Yd++}"></bim-option>
            `)}
        </bim-dropdown>
        
        <bim-number-input
          slider step="1" label="Highlight width" value="${Qe.highlightMaterial.linewidth}" min="1" max="10"
          @change="${({target:s})=>{ut.highlightMaterial.linewidth=s.value}}">
        </bim-number-input>

        <bim-color-input 
          label="Highlight Color" color="#${ut.highlightMaterial.color.getHexString()}" 
          @input="${({target:s})=>{ut.highlightMaterial.color=new be(s.color)}}">
        </bim-color-input>

        
        <bim-color-input 
          label="Station Label Color" color="#${ut.stationLabelColor.getHexString()}" 
          @input="${({target:s})=>{ut.stationLabelColor=new be(s.color)}}">
        </bim-color-input>

        
        <bim-color-input 
          label="Station Label Background Color" color="#${ut.stationLabelBackgroundColor.getHexString()}" 
          @input="${({target:s})=>{ut.stationLabelBackgroundColor=new be(s.color)}}">
        </bim-color-input>

        <bim-color-input 
          label="Station Pointer Color" color="#${ut.stationPointerColor.getHexString()}" 
          @input="${({target:s})=>{ut.stationPointerColor=new be(s.color)}}">
        </bim-color-input>

        <bim-color-input 
          label="Station Pointer Background Color" color="#${ut.stationPointerBackgroundColor.getHexString()}" 
          @input="${({target:s})=>{ut.stationPointerBackgroundColor=new be(s.color)}}">
        </bim-color-input>

        <bim-number-input
          slider step="0.05" label="Screen distance limit" value="${ut.screenDistanceLimit}" min="0" max="1"
          @change="${({target:s})=>{ut.screenDistanceLimit=s.value,Qe.updateStations()}}">
        </bim-number-input>

        <bim-checkbox
          label="Highlight selected" checked="${vo}"
          @change="${({target:s})=>{vo=s.checked,Wl()}}">
        </bim-checkbox>

        <bim-checkbox
          label="Show kps"
          @change="${({target:s})=>{js=s.checked,Ii()}}">
        </bim-checkbox>

        
        <bim-checkbox
          label="Clip"
          @change="${({target:s})=>{qt.plane.enabled=s.checked,qt.sectionVisible=s.checked,s.checked&&(qt.update(),qt.plane.update()),js&&Ii()}}">
        </bim-checkbox>

        
      <bim-checkbox
        label="Flip"
        @change="${({target:s})=>{qt.flip=s.checked,js&&Ii()}}">
      </bim-checkbox>

      <bim-number-input
      slider step="10" label="Increments" value="${Qe.increments}" min="10" max="100"
      @change="${({target:s})=>{Qe.increments=s.value,Ii()}}">
    </bim-number-input>

    <bim-number-input
      slider step="0.01" label="Alignment navigation" value="0.5" min="0" max="1"
      @change="${({target:s})=>{Gd(s.value)}}">
    </bim-number-input>

    <bim-number-input
      slider step="10" label="Move to KP" value="2000" min="1925" max="3000"
      @change="${({target:s})=>{const e=_i.children[gi],t=Di.alignmentLength(e),n=(s.value-e.userData.initialStation)/t,r=Math.min(Math.max(n,0),1);Gd(r)}}">
    </bim-number-input>

    </bim-panel-section>

    </bim-panel>
    `);tr.style.zIndex="9999";document.body.append(tr);const aC=tu.create(()=>el`
      <bim-button class="phone-menu-toggler" icon="solar:settings-bold"
        @click="${()=>{tr.classList.contains("options-menu-visible")?tr.classList.remove("options-menu-visible"):tr.classList.add("options-menu-visible")}}">
      </bim-button>
    `);document.body.append(aC);
