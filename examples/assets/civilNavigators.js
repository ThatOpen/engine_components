var Nx=Object.defineProperty;var Mx=(s,t,e)=>t in s?Nx(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var At=(s,t,e)=>(Mx(s,typeof t!="symbol"?t+"":t,e),e);import{c as ye,d as Ze,k as Ve,V as F,C as xt,G as on,ab as cr,t as vt,o as Lp,L as Gt,g as Tt,e as Bt,ac as nr,q as Bc,ad as Gr,ae as $i,S as ws,F as Us,af as Dx,P as Ht,ag as Jr,ah as Ie,ai as oa,O as aa,aj as Xo,ak as Js,al as kx,am as ks,an as Qo,s as uw,M as lt,j as br,D as Wn,ao as dw,ap as pw,l as fw,m as Wm,U as zx,aq as Np,ar as Ux,as as Bx,at as Vx,au as $x,av as Vc,aw as Rl,p as $c,ax as Hc,ay as se,az as yi,aA as mw,aB as Jd,n as Hx,aC as C_,aD as gw,i as Mp,h as I_,f as jx,aa as _w,aE as Yx,aF as Wx,aG as tp,aH as Gm,aI as Ib,aJ as xb,aK as qm,aL as Gx,aM as qx,aN as Zx,aO as Xx,aP as Qx,aQ as Kx,aR as Jx,aS as t2,aT as e2,aU as s2,aV as i2,aW as n2,aX as r2,aY as o2,aZ as a2,a_ as l2,a$ as h2,b0 as c2,b1 as u2,b2 as d2,b3 as p2,b4 as f2,b5 as m2,b6 as g2,b7 as _2,b8 as b2,b9 as y2,ba as v2,bb as w2,bc as E2,bd as C2,be as I2,bf as x2,bg as T2,bh as A2,bi as bw,bj as S2,bk as O2,bl as P2,bm as F2,bn as R2,bo as L2,bp as N2,bq as M2,br as D2,bs as k2,bt as z2,bu as U2,bv as B2,bw as V2,bx as $2,by as H2,bz as j2,bA as Y2,bB as W2,bC as G2,bD as q2,bE as Z2,bF as X2,bG as Q2,bH as K2,bI as J2,bJ as tT,bK as eT,bL as sT,bM as iT,bN as nT,bO as rT,bP as oT,bQ as aT,bR as lT,bS as hT,bT as cT,bU as uT,bV as dT,bW as pT,bX as fT,bY as mT,bZ as gT,b_ as _T,b$ as bT,c0 as yT,c1 as vT,c2 as wT,c3 as ET,c4 as CT,c5 as IT,c6 as xT,c7 as TT,c8 as AT,c9 as ST,ca as OT,cb as PT,cc as FT,cd as RT,ce as LT,cf as NT,cg as MT,ch as DT,ci as kT,cj as zT,ck as UT,cl as BT,cm as VT,cn as $T,co as HT,cp as jT,cq as YT,cr as WT,cs as GT,ct as qT,cu as ZT,cv as XT,cw as QT,cx as KT,cy as JT,cz as tA,cA as eA,cB as sA,cC as iA,cD as nA,cE as rA,cF as oA,cG as aA,cH as lA,cI as hA,cJ as cA,cK as uA,cL as dA,cM as pA,cN as fA,cO as mA,cP as gA,cQ as _A,cR as yw,cS as vw,cT as bA,cU as yA,cV as vA,cW as wA,cX as EA,cY as CA,cZ as IA,c_ as xA,c$ as TA,d0 as AA,d1 as SA,d2 as OA,d3 as PA,d4 as FA,d5 as RA,d6 as LA,d7 as NA,d8 as MA,d9 as DA,da as kA,db as zA,dc as UA,dd as BA,de as VA,df as $A,dg as HA,dh as ww,di as Ew,dj as ep,dk as Cw,b as jA,B as Jt,dl as Hr,dm as Dn,dn as Iw,dp as xw,dq as Tw,a as YA}from"./index-D7EC26VF.js";import{R as x_,E as sp,i as WA,b as Aw,g as GA,F as Sw,C as qA,W as ZA,S as XA,h as QA,j as KA,d as JA}from"./graphic-vertex-picker-C_xseSgk.js";import{a as tS,R as Ow,m as Zm}from"./index-bERBRksd.js";import{b as Pw,a as eS,L as sS}from"./LineSegments2-S_fMtMi1.js";class iS{constructor(t){At(this,"alignments",[]);At(this,"enabled",!0);At(this,"world",null);At(this,"_raycastable",[]);At(this,"_components");this._components=t}update(){this.dispose();for(const t of this.alignments)for(const e of t.children){const i=e;i.updateWorldMatrix(!0,!0);for(const n of i.children){const r=n;if(r.isLine2&&r.userData.points){const o=new ye,a=new Ze;a.geometry.setIndex(r.geometry.index);const l=new Float32Array(r.userData.points),h=new Ve(l,3);o.setAttribute("position",h),a.geometry=o,a.userData.curve=r,a.applyMatrix4(r.matrixWorld),a.updateMatrixWorld(),this._raycastable.push(a)}}}}dispose(){for(const t of this._raycastable)t.geometry.dispose(),t.geometry=void 0;this._raycastable=[]}castRay(){if(!this.enabled||!this.world)return null;const i=this._components.get(x_).get(this.world).castRayToObjects(this._raycastable);if(!i)return null;const n=i.object,r=n.geometry,o=i.index,a=r.attributes.position.array[o*3],l=r.attributes.position.array[o*3+1],h=r.attributes.position.array[o*3+2],c=r.attributes.position.array[o*3+3],u=r.attributes.position.array[o*3+4],p=r.attributes.position.array[o*3+5],d=new F(c-a,u-l,p-h).normalize();return{point:i.point,normal:d,curve:n.userData.curve,alignment:n.userData.curve.parent}}}class qr{static alignmentPercentageToPoint(t,e){const i=new F,n=new F,r=this.alignmentLength(t),o=e*r;let a=0;if(t.updateWorldMatrix(!0,!0),e===1)for(let l=t.children.length-1;l>=0;l--){const h=t.children[l],c=h.userData.points;if(!c)continue;const u=new F(c[c.length-3],c[c.length-2],c[c.length-1]);return u.applyMatrix4(h.matrixWorld),{normal:new F,point:u,curve:h,alignment:t}}for(const l of t.children){const h=l.userData.points;if(h)for(let c=0;c<h.length-3;c+=3){const u=i.set(h[c],h[c+1],h[c+2]),p=n.set(h[c+3],h[c+4],h[c+5]),d=u.distanceTo(p);if(a+d>=o){const _=o-a,m=p.clone().sub(u).normalize(),g=m.clone().multiplyScalar(_);return u.add(g),u.applyMatrix4(l.matrixWorld),{normal:m,point:u,curve:l,alignment:t}}a+=d}}return null}static curvePercentageToPoint(t,e,i){const n=new F,r=new F,o=this.curveLength(e),a=i*o;let l=0;const h=e.userData.points;if(!h)throw new Error("No points found in curve");for(let c=0;c<h.length-3;c+=3){const u=n.set(h[c],h[c+1],h[c+2]),p=r.set(h[c+3],h[c+4],h[c+5]),d=u.distanceTo(p);if(l+d>=a){const _=a-l,m=p.clone().sub(u).normalize(),g=m.clone().multiplyScalar(_);return u.add(g),{normal:m,point:u,curve:e,alignment:t}}l+=d}return null}static alignmentLength(t){let e=0;if(t.userData.length!==void 0)return t.userData.length;for(const i of t.children)"isLine2"in i&&(e+=this.curveLength(i));return t.userData.length=e,e}static curveLength(t){let e=0;if(t.userData.length!==void 0)return t.userData.length;const i=new F,n=new F,r=t.userData.points;if(!r)throw new Error("No points found in curve");for(let o=0;o<r.length-2-3;o+=3){const a=i.set(r[o],r[o+1],r[o+2]),l=n.set(r[o+3],r[o+4],r[o+5]);e+=a.distanceTo(l)}return t.userData.length=e,e}static curvePointToAlignmentPercentage(t,e,i){const n=new F,r=new F,o=this.alignmentLength(t);let a=0;t.updateWorldMatrix(!0,!0);for(const l of t.children){const h=l.userData.points;if(h)for(let c=0;c<h.length-3;c+=3){const u=n.set(h[c],h[c+1],h[c+2]),p=r.set(h[c+3],h[c+4],h[c+5]);u.applyMatrix4(l.matrixWorld),p.applyMatrix4(l.matrixWorld);const d=u.distanceTo(p),_=u.distanceTo(e)<.001,m=p.distanceTo(e)<.001,g=this.isPointbetweenTwoOthers(u,p,e);if(l===i&&(_||m||g)){const f=u.distanceTo(e);return(a+f)/o}a+=d}}return null}static isPointbetweenTwoOthers(t,e,i){const n=new F;n.subVectors(e,t).normalize();const r=new F;r.subVectors(i,t).normalize();const o=new F;o.subVectors(i,e).normalize();const l=1-.0016;return n.dot(r)>l&&n.dot(o)<-l}}class nS{constructor(t,e){At(this,"onDisposed",new sp);At(this,"alignments",[]);At(this,"components");At(this,"onMarkerChange",new sp);At(this,"enabled",!0);At(this,"highlightMaterial");At(this,"increments",20);At(this,"screenDistanceLimit",.1);At(this,"fadeInTime",500);At(this,"_mouseMarkers");At(this,"_highlighted",new Set);At(this,"_stationPoints",new Map);At(this,"_originalHighlightMaterialId","originalHighlightMaterial");At(this,"_world",null);At(this,"_raycaster");At(this,"_stationLabelColor",new xt(16777215));At(this,"_stationLabelBackgroundColor",new xt(8014801));At(this,"_stationPointerColor",new xt(16777215));At(this,"_stationPointerBackgroundColor",new xt(4803766));At(this,"_pointerDown",performance.now());At(this,"_pointerDownTime",150);At(this,"onPointerDown",()=>{this._pointerDown=performance.now()});At(this,"onPointerUp",()=>{if(performance.now()-this._pointerDown>this._pointerDownTime)return;const t=this.setMarkerToMouse("select");t&&this.onMarkerChange.trigger(t)});At(this,"onMouseMove",()=>{this.setMarkerToMouse("hover")});this.components=t,this.highlightMaterial=e,this._raycaster=new iS(t),this._raycaster.alignments=this.alignments}get world(){return this._world}set world(t){var n,r,o,a;if(t===this._world||(this._world&&this.setupEvents(!1),this._world=t,(n=this._mouseMarkers)==null||n.hover.removeFromParent(),(r=this._mouseMarkers)==null||r.select.removeFromParent(),(o=this._mouseMarkers)==null||o.hover.element.remove(),(a=this._mouseMarkers)==null||a.select.element.remove(),!t))return;this._raycaster.world=t;const e=this.newCivilLabel(0,"stationPointer");t.scene.three.add(e),e.visible=!1,e.element.style.transition="";const i=this.newCivilLabel(0,"stationPointer");i.element.style.transition="",i.element.style.opacity="0.5",t.scene.three.add(i),i.visible=!1,this._mouseMarkers={select:e,hover:i},this.setupEvents(!0)}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(t){this._stationLabelColor=t;const e=`#${t.getHexString()}`;for(const[,{labels:i}]of this._stationPoints){const n=[...i.children];for(const r of n){const o=this.getLabel(r);o.style.color=e;const a=this.getPoint(r);a.style.backgroundColor=e}}}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(t){this._stationLabelBackgroundColor=t;const e=`#${t.getHexString()}`;for(const[,{labels:i}]of this._stationPoints){const n=[...i.children];for(const r of n){const o=this.getLabel(r);o.style.backgroundColor=e;const a=this.getPoint(r);a.style.border=`2px solid ${e}`}}}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(t){this._stationPointerColor=t;const e=`#${t.getHexString()}`;if(this._mouseMarkers){const i=this._mouseMarkers.select,n=this.getLabel(i);n.style.color=e;const r=this.getPoint(i);r.style.backgroundColor=e}}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(t){this._stationPointerBackgroundColor=t;const e=`#${t.getHexString()}`;if(this._mouseMarkers){const i=this._mouseMarkers.select,n=this.getLabel(i);n.style.backgroundColor=e;const r=this.getPoint(i);r.style.border=`2px solid ${e}`}}dispose(){var t,e,i,n;this.clearHighlight(),this.clearStations(),this.alignments=[],(t=this._mouseMarkers)==null||t.hover.removeFromParent(),(e=this._mouseMarkers)==null||e.select.removeFromParent(),(i=this._mouseMarkers)==null||i.hover.element.remove(),(n=this._mouseMarkers)==null||n.select.element.remove(),this._raycaster.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){this._raycaster.update()}setMarkerAtPoint(t,e){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");this.updateMarkerValue(t,e),this._mouseMarkers[e].visible=!0,this._mouseMarkers[e].position.copy(t.point)}highlight(t,e=!0){e&&this.clearHighlight(this._highlighted);for(const i of t.children)"isLineSegments2"in i&&"material"in i&&(i.userData[this._originalHighlightMaterialId]=i.material,i.material=this.highlightMaterial);this._highlighted.add(t)}clearHighlight(t=this._highlighted){for(const e of t)for(const i of e.children)"isLineSegments2"in i&&"material"in i&&(i.material=i.userData[this._originalHighlightMaterialId],delete i.userData[this._originalHighlightMaterialId]);this._highlighted.clear()}createStations(t){if(!this.world||this._stationPoints.has(t.uuid))return;const e=new on;this.world.scene.three.add(e),this._stationPoints.set(t.uuid,{alignment:t,labels:e})}clearStations(t=this._stationPoints.keys()){for(const e of t){const i=this._stationPoints.get(e);i&&(this.clearLabels(i.labels),this._stationPoints.delete(e))}}updateStations(){if(!this.world)throw new Error("No world found!");if(!this.world.renderer)throw new Error("No renderer found!");const t=this.world.camera.three,e=this.world.renderer.three,i=new cr,n=e.clippingPlanes,r=new F,o=new F;let a=!0;const l=new F;for(const[,{alignment:h,labels:c}]of this._stationPoints){this.clearLabels(c),h.updateWorldMatrix(!0,!0);const u=h.userData.initialStation;let p=u||0;const d=p%this.increments;let _=u+this.increments-d;for(const m of h.children){if(!("isLine2"in m))continue;const g=m;if(g.geometry.boundingBox||g.geometry.computeBoundingBox(),i.setFromProjectionMatrix(new vt().multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse)),!i.intersectsBox(g.geometry.boundingBox)){const N=qr.curveLength(m);p+=N;const v=p%this.increments;_=p+this.increments-v;continue}const f=m.userData.points,b=f[0],y=f[1],E=f[2];if(l.set(b,y,E),l.applyMatrix4(m.matrixWorld),!this.isLabelClipped(n,l)){if(a){a=!1,r.set(l.x,l.y,l.z),r.project(t),r.z=0;const N=this.newCivilLabel(p,"stationLabel");N.position.set(l.x,l.y,l.z),c.children.push(N)}else if(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit){const v=this.newCivilLabel(p,"stationLabel");v.position.set(l.x,l.y,l.z),c.children.push(v),r.copy(o)}}const I=new F,x=new F;for(let N=0;N<f.length-3;N+=3){I.set(f[N],f[N+1],f[N+2]),x.set(f[N+3],f[N+4],f[N+5]);const v=I.distanceTo(x),M=p+v,Q=x.clone().sub(I).normalize();for(;M>_;){const j=_-p,it=Q.clone();it.multiplyScalar(j);const{x:G,y:nt,z:$}=I.clone().add(it);if(l.set(G,nt,$),l.applyMatrix4(m.matrixWorld),!this.isLabelClipped(n,l)&&i.containsPoint(l)&&(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit)){const J=this.newCivilLabel(_,"stationLabel");J.position.set(l.x,l.y,l.z),c.children.push(J),r.copy(o)}_+=this.increments}p+=v}const A=f[f.length-3],O=f[f.length-2],L=f[f.length-1];if(l.set(A,O,L),l.applyMatrix4(m.matrixWorld),this.isLabelClipped(n,l)||!i.containsPoint(l))continue;if(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit){const N=this.newCivilLabel(p,"stationLabel");N.position.set(l.x,l.y,l.z),c.children.push(N),r.copy(o)}}}}getCursorValue(){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");return this._mouseMarkers.select.element.children[0].children[0].innerText}setCursorValue(t,e){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const n=this._mouseMarkers[e].element.children[0].children[0];n.innerText=t}isLabelClipped(t,e){for(const i of t)if(!(i.distanceToPoint(e)>0))return!0;return!1}clearLabels(t){const e=[...t.children];for(const i of e)i.element.style.opacity="0";setTimeout(()=>{for(const i of e)i.removeFromParent(),i.element.remove(),i.visible=!1},this.fadeInTime)}newCivilLabel(t,e){const i=document.createElement("div"),n=e==="stationLabel"?this.stationLabelColor:this.stationPointerColor,r=e==="stationLabel"?this.stationLabelBackgroundColor:this.stationPointerBackgroundColor,o=document.createElement("div");o.style.width="4px",o.style.height="4px",o.style.borderRadius="50%",o.style.backgroundColor=`#${n.getHexString()}`,o.style.border=`2px solid #${r.getHexString()}`,o.style.display="flex",o.style.justifyContent="center";const a=this.getFormattedStation(t),l=document.createElement("div");l.innerText=a,l.style.backgroundColor=`#${r.getHexString()}`,l.style.color=`#${n.getHexString()}`,l.style.padding="0.3rem",l.style.position="absolute",l.style.bottom="1rem",l.style.borderRadius="6px",l.style.boxShadow="rgba(0, 0, 0, 0.6) 0px 4px 6px",o.appendChild(l);const h=new WA(i);return i.appendChild(o),e==="stationLabel"&&(i.style.transition=`opacity ${this.fadeInTime}ms ease-in-out`,i.style.opacity="0",setTimeout(()=>{i.style.opacity="1"})),h}setupEvents(t){if(!this.world)throw new Error("No world found!");if(this.world.isDisposing||!this.world.renderer)return;const e=this.world.renderer.three.domElement,n=this.components.get(x_).get(this.world);n.three.params.Line||(n.three.params.Line={threshold:10}),e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointerup",this.onPointerUp),e.removeEventListener("pointermove",this.onMouseMove),t&&(e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointerup",this.onPointerUp),e.addEventListener("pointermove",this.onMouseMove))}setMarkerToMouse(t){if(!this.enabled||!this._mouseMarkers)return null;if(!this.world)throw new Error("No world found!");const e=this._raycaster.castRay();if(!e)return this._mouseMarkers[t].visible=!1,null;this._mouseMarkers[t].visible=!0;const i=e.point;return this._mouseMarkers[t].position.copy(i),this.updateMarkerValue(e,t),e}updateMarkerValue(t,e){if(!this._mouseMarkers)return;const{alignment:i,curve:n,point:r}=t,o=qr.curvePointToAlignmentPercentage(i,r,n);if(o===null)throw new Error("Point is not on the curve");const l=o*qr.alignmentLength(i)+i.userData.initialStation,h=this.getFormattedStation(l);this.setCursorValue(h,e)}getFormattedStation(t){const e=Math.floor(t/1e3),i=Math.round(t-e*1e3);return`${e}+${i}`}getLabel(t){return t.element.children[0].children[0]}getPoint(t){return t.element.children[0]}}const Fp=class Fp extends Aw{constructor(e){super(e);At(this,"onDisposed",new sp);At(this,"list",new Map);At(this,"enabled",!0);At(this,"highlightMaterial",new Pw({color:8014801,linewidth:5,depthTest:!1}));At(this,"_increments",20);At(this,"_screenDistanceLimit",.1);At(this,"_fadeInTime",500);At(this,"_stationLabelColor",new xt(16777215));At(this,"_stationLabelBackgroundColor",new xt(8014801));At(this,"_stationPointerColor",new xt(16777215));At(this,"_stationPointerBackgroundColor",new xt(4803766));this.components.add(Fp.uuid,this)}get increments(){return this._increments}set increments(e){this._increments=e;for(const[,i]of this.list)i.increments=e}get screenDistanceLimit(){return this._screenDistanceLimit}set screenDistanceLimit(e){this._screenDistanceLimit=e;for(const[,i]of this.list)i.screenDistanceLimit=e}get fadeInTime(){return this._fadeInTime}set fadeInTime(e){this._fadeInTime=e;for(const[,i]of this.list)i.fadeInTime=e}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(e){this._stationLabelColor=e;for(const[,i]of this.list)i.stationLabelColor=e}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(e){this._stationLabelBackgroundColor=e;for(const[,i]of this.list)i.stationLabelBackgroundColor=e}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(e){this._stationPointerColor=e;for(const[,i]of this.list)i.stationPointerColor=e}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(e){this._stationPointerBackgroundColor=e;for(const[,i]of this.list)i.stationPointerBackgroundColor=e}create(e){const i=new nS(this.components,this.highlightMaterial);return this.list.set(e,i),i}delete(e){const i=this.list.get(e);i&&(i.dispose(),this.list.delete(e))}dispose(){for(const[,e]of this.list)e.dispose();this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){for(const[,e]of this.list)e.updateAlignments()}};At(Fp,"uuid","0a59c09e-2b49-474a-9320-99f51f40f182");let Xm=Fp;const Rp=class Rp extends Aw{constructor(e){super(e);At(this,"enabled",!0);At(this,"onDisposed",new sp);At(this,"_world",null);At(this,"_flip",!1);At(this,"_plane");At(this,"_point",new F);At(this,"_edgeMeshes",[]);At(this,"_sectionVisible",!1);At(this,"_sectionOffset",.1);At(this,"edgeMaterial",new Pw({color:0,linewidth:5,depthTest:!1}));this.components.add(Rp.uuid,this)}get plane(){if(!this._plane)throw new Error("Plane is not set. You must give a world.");return this._plane}set plane(e){this._plane=e}get sectionVisible(){return this._sectionVisible}set sectionVisible(e){this._sectionVisible=e;for(const i of this._edgeMeshes)i.visible=e}get world(){return this._world}set world(e){var r;if(this._world=e,(r=this._plane)==null||r.dispose(),!e)return;const i=this.components.get(GA),n=i.createFromNormalAndCoplanarPoint(e,new F(1,0,0),new F);this.plane=i.list.get(n),this.plane.visible=!1,this.plane.enabled=!1}get flip(){return this._flip}set flip(e){var n;if(e===this._flip)return;this._flip=e;const i=(n=this.plane)==null?void 0:n.normal.clone().multiplyScalar(-1);for(const r of this._edgeMeshes)r.position.add(i.clone().multiplyScalar(this._sectionOffset));this.plane.setFromNormalAndCoplanarPoint(i,this._point),this.plane.update()}dispose(){var e;this.clearMeshes(),(e=this.plane)==null||e.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}async set(e,i){this.flip&&i.multiplyScalar(-1),this.plane.setFromNormalAndCoplanarPoint(i,e),this._point.copy(e)}async update(){this.clearMeshes();const e=this.components.get(Sw);this.plane.update();const i=[];for(const[,n]of e.list)i.push(this.generateModelSection(n));await Promise.all(i)}async generateModelSection(e){if(!this.world)return;const i=this.plane.three.clone();i.constant-=.01;const{buffer:n}=await e.getSection(i),r=new ye,o=new Ve(n,3,!1);r.setAttribute("position",o);const a=new Lp(r),l=new eS;l.fromLineSegments(a);const h=new sS(l,this.edgeMaterial);h.frustumCulled=!1,this.world.scene.three.add(h),this._edgeMeshes.push(h),h.renderOrder=3,a.geometry.dispose()}clearMeshes(){for(const e of this._edgeMeshes)e.removeFromParent(),e.geometry.dispose(),e.material=void 0;this._edgeMeshes=[]}};At(Rp,"uuid","96b2c87e-d90b-4639-8257-8f01136fe324");let Qm=Rp;var Tb,Gh,Fn,Ii,Rn,$a,On,qh,Sh,ss,xi,qe,Ce,Mt,Zs,Ti,Ns,_s,kn,bs,Ln,Nn,Ai,Mn,No,Xs,Oh,Id,Km,sl,Rr,ip,Si,Jm,Fw,il,Zh,np,Zn,xr,er,Lr,xd,vf,Rw,Xh,rp,Ph,Td,pe,me,Ad,wf,Ha,Fh,ir,jr,op,tg,rS=Object.defineProperty,S=(s,t,e)=>(((i,n,r)=>{n in i?rS(i,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[n]=r})(s,typeof t!="symbol"?t+"":t,e),e),T_=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)},W=(s,t,e)=>(T_(s,t,"read from private field"),e?e.call(s):t.get(s)),Nt=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},St=(s,t,e,i)=>(T_(s,t,"write to private field"),t.set(s,e),e),eg=(s,t,e,i)=>({set _(n){St(s,t,n)},get _(){return W(s,t,i)}}),Ct=(s,t,e)=>(T_(s,t,"access private method"),e);const Qh={950732822:"IFCURIREFERENCE",4075327185:"IFCTIME",1209108979:"IFCTEMPERATURERATEOFCHANGEMEASURE",3457685358:"IFCSOUNDPRESSURELEVELMEASURE",4157543285:"IFCSOUNDPOWERLEVELMEASURE",2798247006:"IFCPROPERTYSETDEFINITIONSET",1790229001:"IFCPOSITIVEINTEGER",525895558:"IFCNONNEGATIVELENGTHMEASURE",1774176899:"IFCLINEINDEX",1275358634:"IFCLANGUAGEID",2541165894:"IFCDURATION",3701338814:"IFCDAYINWEEKNUMBER",2195413836:"IFCDATETIME",937566702:"IFCDATE",1683019596:"IFCCARDINALPOINTREFERENCE",2314439260:"IFCBINARY",1500781891:"IFCAREADENSITYMEASURE",3683503648:"IFCARCINDEX",4065007721:"IFCYEARNUMBER",1718600412:"IFCWARPINGMOMENTMEASURE",51269191:"IFCWARPINGCONSTANTMEASURE",2593997549:"IFCVOLUMETRICFLOWRATEMEASURE",3458127941:"IFCVOLUMEMEASURE",3345633955:"IFCVAPORPERMEABILITYMEASURE",1278329552:"IFCTORQUEMEASURE",2591213694:"IFCTIMESTAMP",2726807636:"IFCTIMEMEASURE",743184107:"IFCTHERMODYNAMICTEMPERATUREMEASURE",2016195849:"IFCTHERMALTRANSMITTANCEMEASURE",857959152:"IFCTHERMALRESISTANCEMEASURE",2281867870:"IFCTHERMALEXPANSIONCOEFFICIENTMEASURE",2645777649:"IFCTHERMALCONDUCTIVITYMEASURE",232962298:"IFCTHERMALADMITTANCEMEASURE",296282323:"IFCTEXTTRANSFORMATION",603696268:"IFCTEXTFONTNAME",3490877962:"IFCTEXTDECORATION",1460886941:"IFCTEXTALIGNMENT",2801250643:"IFCTEXT",58845555:"IFCTEMPERATUREGRADIENTMEASURE",361837227:"IFCSPECULARROUGHNESS",2757832317:"IFCSPECULAREXPONENT",3477203348:"IFCSPECIFICHEATCAPACITYMEASURE",993287707:"IFCSOUNDPRESSUREMEASURE",846465480:"IFCSOUNDPOWERMEASURE",3471399674:"IFCSOLIDANGLEMEASURE",408310005:"IFCSHEARMODULUSMEASURE",2190458107:"IFCSECTIONALAREAINTEGRALMEASURE",3467162246:"IFCSECTIONMODULUSMEASURE",2766185779:"IFCSECONDINMINUTE",3211557302:"IFCROTATIONALSTIFFNESSMEASURE",1755127002:"IFCROTATIONALMASSMEASURE",2133746277:"IFCROTATIONALFREQUENCYMEASURE",200335297:"IFCREAL",96294661:"IFCRATIOMEASURE",3972513137:"IFCRADIOACTIVITYMEASURE",3665567075:"IFCPRESSUREMEASURE",2169031380:"IFCPRESENTABLETEXT",1364037233:"IFCPOWERMEASURE",1245737093:"IFCPOSITIVERATIOMEASURE",3054510233:"IFCPOSITIVEPLANEANGLEMEASURE",2815919920:"IFCPOSITIVELENGTHMEASURE",4042175685:"IFCPLANEANGLEMEASURE",2642773653:"IFCPLANARFORCEMEASURE",2260317790:"IFCPARAMETERVALUE",929793134:"IFCPHMEASURE",2395907400:"IFCNUMERICMEASURE",2095195183:"IFCNORMALISEDRATIOMEASURE",765770214:"IFCMONTHINYEARNUMBER",2615040989:"IFCMONETARYMEASURE",3114022597:"IFCMOMENTOFINERTIAMEASURE",1648970520:"IFCMOLECULARWEIGHTMEASURE",3177669450:"IFCMOISTUREDIFFUSIVITYMEASURE",1753493141:"IFCMODULUSOFSUBGRADEREACTIONMEASURE",1052454078:"IFCMODULUSOFROTATIONALSUBGRADEREACTIONMEASURE",2173214787:"IFCMODULUSOFLINEARSUBGRADEREACTIONMEASURE",3341486342:"IFCMODULUSOFELASTICITYMEASURE",102610177:"IFCMINUTEINHOUR",3531705166:"IFCMASSPERLENGTHMEASURE",3124614049:"IFCMASSMEASURE",4017473158:"IFCMASSFLOWRATEMEASURE",1477762836:"IFCMASSDENSITYMEASURE",2486716878:"IFCMAGNETICFLUXMEASURE",286949696:"IFCMAGNETICFLUXDENSITYMEASURE",151039812:"IFCLUMINOUSINTENSITYMEASURE",2755797622:"IFCLUMINOUSINTENSITYDISTRIBUTIONMEASURE",2095003142:"IFCLUMINOUSFLUXMEASURE",503418787:"IFCLOGICAL",3086160713:"IFCLINEARVELOCITYMEASURE",1307019551:"IFCLINEARSTIFFNESSMEASURE",2128979029:"IFCLINEARMOMENTMEASURE",191860431:"IFCLINEARFORCEMEASURE",1243674935:"IFCLENGTHMEASURE",3258342251:"IFCLABEL",2054016361:"IFCKINEMATICVISCOSITYMEASURE",3192672207:"IFCISOTHERMALMOISTURECAPACITYMEASURE",3686016028:"IFCIONCONCENTRATIONMEASURE",3809634241:"IFCINTEGERCOUNTRATEMEASURE",1939436016:"IFCINTEGER",2679005408:"IFCINDUCTANCEMEASURE",3358199106:"IFCILLUMINANCEMEASURE",983778844:"IFCIDENTIFIER",2589826445:"IFCHOURINDAY",1158859006:"IFCHEATINGVALUEMEASURE",3113092358:"IFCHEATFLUXDENSITYMEASURE",3064340077:"IFCGLOBALLYUNIQUEID",3044325142:"IFCFREQUENCYMEASURE",1361398929:"IFCFORCEMEASURE",2590844177:"IFCFONTWEIGHT",2715512545:"IFCFONTVARIANT",1102727119:"IFCFONTSTYLE",2078135608:"IFCENERGYMEASURE",2506197118:"IFCELECTRICVOLTAGEMEASURE",2951915441:"IFCELECTRICRESISTANCEMEASURE",3790457270:"IFCELECTRICCURRENTMEASURE",2093906313:"IFCELECTRICCONDUCTANCEMEASURE",3818826038:"IFCELECTRICCHARGEMEASURE",1827137117:"IFCELECTRICCAPACITANCEMEASURE",69416015:"IFCDYNAMICVISCOSITYMEASURE",524656162:"IFCDOSEEQUIVALENTMEASURE",4134073009:"IFCDIMENSIONCOUNT",1514641115:"IFCDESCRIPTIVEMEASURE",300323983:"IFCDAYLIGHTSAVINGHOUR",86635668:"IFCDAYINMONTHNUMBER",94842927:"IFCCURVATUREMEASURE",1778710042:"IFCCOUNTMEASURE",3238673880:"IFCCONTEXTDEPENDENTMEASURE",3812528620:"IFCCOMPOUNDPLANEANGLEMEASURE",2991860651:"IFCCOMPLEXNUMBER",1867003952:"IFCBOXALIGNMENT",2735952531:"IFCBOOLEAN",2650437152:"IFCAREAMEASURE",632304761:"IFCANGULARVELOCITYMEASURE",360377573:"IFCAMOUNTOFSUBSTANCEMEASURE",4182062534:"IFCACCELERATIONMEASURE",3699917729:"IFCABSORBEDDOSEMEASURE",1971632696:"IFCGEOSLICE",2680139844:"IFCGEOMODEL",24726584:"IFCELECTRICFLOWTREATMENTDEVICE",3693000487:"IFCDISTRIBUTIONBOARD",3460952963:"IFCCONVEYORSEGMENT",3999819293:"IFCCAISSONFOUNDATION",3314249567:"IFCBOREHOLE",4196446775:"IFCBEARING",325726236:"IFCALIGNMENT",3425753595:"IFCTRACKELEMENT",991950508:"IFCSIGNAL",3798194928:"IFCREINFORCEDSOIL",3290496277:"IFCRAIL",1383356374:"IFCPAVEMENT",2182337498:"IFCNAVIGATIONELEMENT",234836483:"IFCMOORINGDEVICE",2078563270:"IFCMOBILETELECOMMUNICATIONSAPPLIANCE",1638804497:"IFCLIQUIDTERMINAL",1154579445:"IFCLINEARPOSITIONINGELEMENT",2696325953:"IFCKERB",2713699986:"IFCGEOTECHNICALASSEMBLY",2142170206:"IFCELECTRICFLOWTREATMENTDEVICETYPE",3376911765:"IFCEARTHWORKSFILL",1077100507:"IFCEARTHWORKSELEMENT",3071239417:"IFCEARTHWORKSCUT",479945903:"IFCDISTRIBUTIONBOARDTYPE",3426335179:"IFCDEEPFOUNDATION",1502416096:"IFCCOURSE",2940368186:"IFCCONVEYORSEGMENTTYPE",3203706013:"IFCCAISSONFOUNDATIONTYPE",3862327254:"IFCBUILTSYSTEM",1876633798:"IFCBUILTELEMENT",963979645:"IFCBRIDGEPART",644574406:"IFCBRIDGE",3649138523:"IFCBEARINGTYPE",1662888072:"IFCALIGNMENTVERTICAL",317615605:"IFCALIGNMENTSEGMENT",1545765605:"IFCALIGNMENTHORIZONTAL",4266260250:"IFCALIGNMENTCANT",3956297820:"IFCVIBRATIONDAMPERTYPE",1530820697:"IFCVIBRATIONDAMPER",840318589:"IFCVEHICLE",1953115116:"IFCTRANSPORTATIONDEVICE",618700268:"IFCTRACKELEMENTTYPE",2281632017:"IFCTENDONCONDUITTYPE",3663046924:"IFCTENDONCONDUIT",42703149:"IFCSINESPIRAL",1894708472:"IFCSIGNALTYPE",3599934289:"IFCSIGNTYPE",33720170:"IFCSIGN",1027922057:"IFCSEVENTHORDERPOLYNOMIALSPIRAL",544395925:"IFCSEGMENTEDREFERENCECURVE",3649235739:"IFCSECONDORDERPOLYNOMIALSPIRAL",550521510:"IFCROADPART",146592293:"IFCROAD",3818125796:"IFCRELADHERESTOELEMENT",4021432810:"IFCREFERENT",1891881377:"IFCRAILWAYPART",3992365140:"IFCRAILWAY",1763565496:"IFCRAILTYPE",1946335990:"IFCPOSITIONINGELEMENT",514975943:"IFCPAVEMENTTYPE",506776471:"IFCNAVIGATIONELEMENTTYPE",710110818:"IFCMOORINGDEVICETYPE",1950438474:"IFCMOBILETELECOMMUNICATIONSAPPLIANCETYPE",976884017:"IFCMARINEPART",525669439:"IFCMARINEFACILITY",1770583370:"IFCLIQUIDTERMINALTYPE",2176059722:"IFCLINEARELEMENT",679976338:"IFCKERBTYPE",3948183225:"IFCIMPACTPROTECTIONDEVICETYPE",2568555532:"IFCIMPACTPROTECTIONDEVICE",2898700619:"IFCGRADIENTCURVE",1594536857:"IFCGEOTECHNICALSTRATUM",4230923436:"IFCGEOTECHNICALELEMENT",4228831410:"IFCFACILITYPARTCOMMON",1310830890:"IFCFACILITYPART",24185140:"IFCFACILITY",4234616927:"IFCDIRECTRIXDERIVEDREFERENCESWEPTAREASOLID",1306400036:"IFCDEEPFOUNDATIONTYPE",4189326743:"IFCCOURSETYPE",2000195564:"IFCCOSINESPIRAL",3497074424:"IFCCLOTHOID",1626504194:"IFCBUILTELEMENTTYPE",3651464721:"IFCVEHICLETYPE",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3665877780:"IFCTRANSPORTATIONDEVICETYPE",782932809:"IFCTHIRDORDERPOLYNOMIALSPIRAL",2735484536:"IFCSPIRAL",1356537516:"IFCSECTIONEDSURFACE",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1862484736:"IFCSECTIONEDSOLID",1441486842:"IFCRELPOSITIONS",1033248425:"IFCRELASSOCIATESPROFILEDEF",3381221214:"IFCPOLYNOMIALCURVE",2485787929:"IFCOFFSETCURVEBYDISTANCES",590820931:"IFCOFFSETCURVE",3465909080:"IFCINDEXEDPOLYGONALTEXTUREMAP",593015953:"IFCDIRECTRIXCURVESWEPTAREASOLID",4212018352:"IFCCURVESEGMENT",3425423356:"IFCAXIS2PLACEMENTLINEAR",823603102:"IFCSEGMENT",2165702409:"IFCPOINTBYDISTANCEEXPRESSION",182550632:"IFCOPENCROSSPROFILEDEF",388784114:"IFCLINEARPLACEMENT",536804194:"IFCALIGNMENTHORIZONTALSEGMENT",3752311538:"IFCALIGNMENTCANTSEGMENT",1010789467:"IFCTEXTURECOORDINATEINDICESWITHVOIDS",222769930:"IFCTEXTURECOORDINATEINDICES",2691318326:"IFCQUANTITYNUMBER",3633395639:"IFCALIGNMENTVERTICALSEGMENT",2879124712:"IFCALIGNMENTPARAMETERSEGMENT",25142252:"IFCCONTROLLER",3087945054:"IFCALARM",4288193352:"IFCACTUATOR",630975310:"IFCUNITARYCONTROLELEMENT",4086658281:"IFCSENSOR",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",182646315:"IFCFLOWINSTRUMENT",1426591983:"IFCFIRESUPPRESSIONTERMINAL",819412036:"IFCFILTER",3415622556:"IFCFAN",1003880860:"IFCELECTRICTIMECONTROL",402227799:"IFCELECTRICMOTOR",264262732:"IFCELECTRICGENERATOR",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",1904799276:"IFCELECTRICAPPLIANCE",1360408905:"IFCDUCTSILENCER",3518393246:"IFCDUCTSEGMENT",342316401:"IFCDUCTFITTING",562808652:"IFCDISTRIBUTIONCIRCUIT",4074379575:"IFCDAMPER",3640358203:"IFCCOOLINGTOWER",4136498852:"IFCCOOLEDBEAM",2272882330:"IFCCONDENSER",3571504051:"IFCCOMPRESSOR",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",639361253:"IFCCOIL",3902619387:"IFCCHILLER",4217484030:"IFCCABLESEGMENT",1051757585:"IFCCABLEFITTING",3758799889:"IFCCABLECARRIERSEGMENT",635142910:"IFCCABLECARRIERFITTING",2938176219:"IFCBURNER",32344328:"IFCBOILER",2906023776:"IFCBEAMSTANDARDCASE",277319702:"IFCAUDIOVISUALAPPLIANCE",2056796094:"IFCAIRTOAIRHEATRECOVERY",177149247:"IFCAIRTERMINALBOX",1634111441:"IFCAIRTERMINAL",486154966:"IFCWINDOWSTANDARDCASE",4237592921:"IFCWASTETERMINAL",4156078855:"IFCWALLELEMENTEDCASE",4207607924:"IFCVALVE",4292641817:"IFCUNITARYEQUIPMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",3026737570:"IFCTUBEBUNDLE",3825984169:"IFCTRANSFORMER",812556717:"IFCTANK",1162798199:"IFCSWITCHINGDEVICE",385403989:"IFCSTRUCTURALLOADCASE",1404847402:"IFCSTACKTERMINAL",1999602285:"IFCSPACEHEATER",3420628829:"IFCSOLARDEVICE",3027962421:"IFCSLABSTANDARDCASE",3127900445:"IFCSLABELEMENTEDCASE",1329646415:"IFCSHADINGDEVICE",3053780830:"IFCSANITARYTERMINAL",2572171363:"IFCREINFORCINGBARTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",90941305:"IFCPUMP",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",738039164:"IFCPROTECTIVEDEVICE",1156407060:"IFCPLATESTANDARDCASE",3612865200:"IFCPIPESEGMENT",310824031:"IFCPIPEFITTING",3694346114:"IFCOUTLET",144952367:"IFCOUTERBOUNDARYCURVE",2474470126:"IFCMOTORCONNECTION",1911478936:"IFCMEMBERSTANDARDCASE",1437502449:"IFCMEDICALDEVICE",629592764:"IFCLIGHTFIXTURE",76236018:"IFCLAMP",2176052936:"IFCJUNCTIONBOX",4175244083:"IFCINTERCEPTOR",2068733104:"IFCHUMIDIFIER",3319311131:"IFCHEATEXCHANGER",2188021234:"IFCFLOWMETER",1209101575:"IFCEXTERNALSPATIALELEMENT",484807127:"IFCEVAPORATOR",3747195512:"IFCEVAPORATIVECOOLER",2814081492:"IFCENGINE",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3242481149:"IFCDOORSTANDARDCASE",3205830791:"IFCDISTRIBUTIONSYSTEM",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",905975707:"IFCCOLUMNSTANDARDCASE",1677625105:"IFCCIVILELEMENT",3296154744:"IFCCHIMNEY",2674252688:"IFCCABLEFITTINGTYPE",2188180465:"IFCBURNERTYPE",1177604601:"IFCBUILDINGSYSTEM",39481116:"IFCBUILDINGELEMENTPARTTYPE",1136057603:"IFCBOUNDARYCURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4088093105:"IFCWORKCALENDAR",4009809668:"IFCWINDOWTYPE",926996030:"IFCVOIDINGFEATURE",2391383451:"IFCVIBRATIONISOLATOR",2415094496:"IFCTENDONTYPE",3081323446:"IFCTENDONANCHORTYPE",413509423:"IFCSYSTEMFURNITUREELEMENT",3101698114:"IFCSURFACEFEATURE",3657597509:"IFCSTRUCTURALSURFACEACTION",2757150158:"IFCSTRUCTURALCURVEREACTION",1004757350:"IFCSTRUCTURALCURVEACTION",338393293:"IFCSTAIRTYPE",1072016465:"IFCSOLARDEVICETYPE",4074543187:"IFCSHADINGDEVICETYPE",2157484638:"IFCSEAMCURVE",2781568857:"IFCROOFTYPE",2310774935:"IFCREINFORCINGMESHTYPE",964333572:"IFCREINFORCINGELEMENTTYPE",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",1469900589:"IFCRAMPTYPE",2839578677:"IFCPOLYGONALFACESET",1158309216:"IFCPILETYPE",3079942009:"IFCOPENINGSTANDARDCASE",1114901282:"IFCMEDICALDEVICETYPE",3113134337:"IFCINTERSECTIONCURVE",3946677679:"IFCINTERCEPTORTYPE",2571569899:"IFCINDEXEDPOLYCURVE",3493046030:"IFCGEOGRAPHICELEMENT",1509553395:"IFCFURNITURE",1893162501:"IFCFOOTINGTYPE",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",4148101412:"IFCEVENT",132023988:"IFCENGINETYPE",2397081782:"IFCELEMENTASSEMBLYTYPE",2323601079:"IFCDOORTYPE",1213902940:"IFCCYLINDRICALSURFACE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",15328376:"IFCCOMPOSITECURVEONSURFACE",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3893394355:"IFCCIVILELEMENTTYPE",2197970202:"IFCCHIMNEYTYPE",167062518:"IFCBSPLINESURFACEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",2603310189:"IFCADVANCEDBREPWITHVOIDS",1635779807:"IFCADVANCEDBREP",2916149573:"IFCTRIANGULATEDFACESET",1935646853:"IFCTOROIDALSURFACE",2387106220:"IFCTESSELLATEDFACESET",3206491090:"IFCTASKTYPE",699246055:"IFCSURFACECURVE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",603775116:"IFCSTRUCTURALSURFACEREACTION",4015995234:"IFCSPHERICALSURFACE",2481509218:"IFCSPATIALZONETYPE",463610769:"IFCSPATIALZONE",710998568:"IFCSPATIALELEMENTTYPE",1412071761:"IFCSPATIALELEMENT",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",427948657:"IFCRELINTERFERESELEMENTS",307848117:"IFCRELDEFINESBYTEMPLATE",1462361463:"IFCRELDEFINESBYOBJECT",2565941209:"IFCRELDECLARES",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",3521284610:"IFCPROPERTYTEMPLATE",492091185:"IFCPROPERTYSETTEMPLATE",653396225:"IFCPROJECTLIBRARY",569719735:"IFCPROCEDURETYPE",3967405729:"IFCPREDEFINEDPROPERTYSET",1682466193:"IFCPCURVE",428585644:"IFCLABORRESOURCETYPE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",178912537:"IFCINDEXEDPOLYGONALFACE",4095422895:"IFCGEOGRAPHICELEMENTTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",4024345920:"IFCEVENTTYPE",2629017746:"IFCCURVEBOUNDEDSURFACE",1815067380:"IFCCREWRESOURCETYPE",3419103109:"IFCCONTEXT",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",2059837836:"IFCCARTESIANPOINTLIST3D",1675464909:"IFCCARTESIANPOINTLIST2D",574549367:"IFCCARTESIANPOINTLIST",3406155212:"IFCADVANCEDFACE",3698973494:"IFCTYPERESOURCE",3736923433:"IFCTYPEPROCESS",901063453:"IFCTESSELLATEDITEM",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",1042787934:"IFCRESOURCETIME",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",2090586900:"IFCQUANTITYSET",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",3778827333:"IFCPREDEFINEDPROPERTIES",2998442950:"IFCMIRROREDPROFILEDEF",853536259:"IFCMATERIALRELATIONSHIP",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",3079605661:"IFCMATERIALPROFILESETUSAGE",2852063980:"IFCMATERIALCONSTITUENTSET",3708119e3:"IFCMATERIALCONSTITUENT",1585845231:"IFCLAGTIME",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",1437953363:"IFCINDEXEDTEXTUREMAP",3570813810:"IFCINDEXEDCOLOURMAP",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",297599258:"IFCEXTENDEDPROPERTIES",211053100:"IFCEVENTTIME",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",3285139300:"IFCCOLOURRGBLIST",1236880293:"IFCWORKTIME",1199560280:"IFCTIMEPERIOD",3611470254:"IFCTEXTUREVERTEXLIST",2771591690:"IFCTASKTIMERECURRING",1549132990:"IFCTASKTIME",2043862942:"IFCTABLECOLUMN",2934153892:"IFCSURFACEREINFORCEMENTAREA",609421318:"IFCSTRUCTURALLOADORRESULT",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1054537805:"IFCSCHEDULINGTIME",2439245199:"IFCRESOURCELEVELRELATIONSHIP",2433181523:"IFCREFERENCE",3915482550:"IFCRECURRENCEPATTERN",986844984:"IFCPROPERTYABSTRACTION",3843373140:"IFCPROJECTEDCRS",677532197:"IFCPRESENTATIONITEM",1507914824:"IFCMATERIALUSAGEDEFINITION",552965576:"IFCMATERIALPROFILEWITHOFFSETS",164193824:"IFCMATERIALPROFILESET",2235152071:"IFCMATERIALPROFILE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",760658860:"IFCMATERIALDEFINITION",3057273783:"IFCMAPCONVERSION",4294318154:"IFCEXTERNALINFORMATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",1785450214:"IFCCOORDINATEOPERATION",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",979691226:"IFCREINFORCINGBAR",3700593921:"IFCELECTRICDISTRIBUTIONPOINT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",578613899:"IFCCONTROLLERTYPE",2454782716:"IFCCHAMFEREDGEFEATURE",753842376:"IFCBEAM",3001207471:"IFCALARMTYPE",2874132201:"IFCACTUATORTYPE",3304561284:"IFCWINDOW",3512223829:"IFCWALLSTANDARDCASE",2391406946:"IFCWALL",3313531582:"IFCVIBRATIONISOLATORTYPE",2347447852:"IFCTENDONANCHOR",3824725483:"IFCTENDON",2515109513:"IFCSTRUCTURALANALYSISMODEL",4252922144:"IFCSTAIRFLIGHT",331165859:"IFCSTAIR",1529196076:"IFCSLAB",1783015770:"IFCSENSORTYPE",1376911519:"IFCROUNDEDEDGEFEATURE",2016517767:"IFCROOF",2320036040:"IFCREINFORCINGMESH",3027567501:"IFCREINFORCINGELEMENT",3055160366:"IFCRATIONALBEZIERCURVE",3283111854:"IFCRAMPFLIGHT",3024970846:"IFCRAMP",2262370178:"IFCRAILING",3171933400:"IFCPLATE",1687234759:"IFCPILE",1073191201:"IFCMEMBER",900683007:"IFCFOOTING",3508470533:"IFCFLOWTREATMENTDEVICE",2223149337:"IFCFLOWTERMINAL",707683696:"IFCFLOWSTORAGEDEVICE",987401354:"IFCFLOWSEGMENT",3132237377:"IFCFLOWMOVINGDEVICE",4037862832:"IFCFLOWINSTRUMENTTYPE",4278956645:"IFCFLOWFITTING",2058353004:"IFCFLOWCONTROLLER",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",1810631287:"IFCFILTERTYPE",346874300:"IFCFANTYPE",1658829314:"IFCENERGYCONVERSIONDEVICE",857184966:"IFCELECTRICALELEMENT",1634875225:"IFCELECTRICALCIRCUIT",712377611:"IFCELECTRICTIMECONTROLTYPE",1217240411:"IFCELECTRICMOTORTYPE",1365060375:"IFCELECTRICHEATERTYPE",1534661035:"IFCELECTRICGENERATORTYPE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",663422040:"IFCELECTRICAPPLIANCETYPE",855621170:"IFCEDGEFEATURE",2030761528:"IFCDUCTSILENCERTYPE",3760055223:"IFCDUCTSEGMENTTYPE",869906466:"IFCDUCTFITTINGTYPE",395920057:"IFCDOOR",3041715199:"IFCDISTRIBUTIONPORT",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",1945004755:"IFCDISTRIBUTIONELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",2635815018:"IFCDISCRETEACCESSORYTYPE",1335981549:"IFCDISCRETEACCESSORY",4147604152:"IFCDIAMETERDIMENSION",3961806047:"IFCDAMPERTYPE",3495092785:"IFCCURTAINWALL",1973544240:"IFCCOVERING",2954562838:"IFCCOOLINGTOWERTYPE",335055490:"IFCCOOLEDBEAMTYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",1163958913:"IFCCONDITIONCRITERION",2188551683:"IFCCONDITION",2816379211:"IFCCONDENSERTYPE",3850581409:"IFCCOMPRESSORTYPE",843113511:"IFCCOLUMN",2301859152:"IFCCOILTYPE",2611217952:"IFCCIRCLE",2951183804:"IFCCHILLERTYPE",1285652485:"IFCCABLESEGMENTTYPE",3293546465:"IFCCABLECARRIERSEGMENTTYPE",395041908:"IFCCABLECARRIERFITTINGTYPE",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",2979338954:"IFCBUILDINGELEMENTPART",52481810:"IFCBUILDINGELEMENTCOMPONENT",3299480353:"IFCBUILDINGELEMENT",231477066:"IFCBOILERTYPE",1916977116:"IFCBEZIERCURVE",819618141:"IFCBEAMTYPE",1967976161:"IFCBSPLINECURVE",3460190687:"IFCASSET",2470393545:"IFCANGULARDIMENSION",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3352864051:"IFCAIRTERMINALTYPE",1411407467:"IFCAIRTERMINALBOXTYPE",3821786052:"IFCACTIONREQUEST",1213861670:"IFC2DCOMPOSITECURVE",1033361043:"IFCZONE",3342526732:"IFCWORKSCHEDULE",4218914973:"IFCWORKPLAN",1028945134:"IFCWORKCONTROL",1133259667:"IFCWASTETERMINALTYPE",1898987631:"IFCWALLTYPE",2769231204:"IFCVIRTUALELEMENT",728799441:"IFCVALVETYPE",1911125066:"IFCUNITARYEQUIPMENTTYPE",1600972822:"IFCTUBEBUNDLETYPE",3593883385:"IFCTRIMMEDCURVE",1620046519:"IFCTRANSPORTELEMENT",1692211062:"IFCTRANSFORMERTYPE",1637806684:"IFCTIMESERIESSCHEDULE",5716631:"IFCTANKTYPE",2254336722:"IFCSYSTEM",2315554128:"IFCSWITCHINGDEVICETYPE",148013059:"IFCSUBCONTRACTRESOURCE",1975003073:"IFCSTRUCTURALSURFACECONNECTION",2986769608:"IFCSTRUCTURALRESULTGROUP",1235345126:"IFCSTRUCTURALPOINTREACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",2082059205:"IFCSTRUCTURALPOINTACTION",3987759626:"IFCSTRUCTURALPLANARACTIONVARYING",1621171031:"IFCSTRUCTURALPLANARACTION",1252848954:"IFCSTRUCTURALLOADGROUP",1721250024:"IFCSTRUCTURALLINEARACTIONVARYING",1807405624:"IFCSTRUCTURALLINEARACTION",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",214636428:"IFCSTRUCTURALCURVEMEMBER",4243806635:"IFCSTRUCTURALCURVECONNECTION",1179482911:"IFCSTRUCTURALCONNECTION",682877961:"IFCSTRUCTURALACTION",1039846685:"IFCSTAIRFLIGHTTYPE",3112655638:"IFCSTACKTERMINALTYPE",3812236995:"IFCSPACETYPE",652456506:"IFCSPACEPROGRAM",1305183839:"IFCSPACEHEATERTYPE",3856911033:"IFCSPACE",2533589738:"IFCSLABTYPE",4097777520:"IFCSITE",4105383287:"IFCSERVICELIFE",3517283431:"IFCSCHEDULETIMECONTROL",1768891740:"IFCSANITARYTERMINALTYPE",2863920197:"IFCRELASSIGNSTASKS",160246688:"IFCRELAGGREGATES",2324767716:"IFCRAMPFLIGHTTYPE",2893384427:"IFCRAILINGTYPE",3248260540:"IFCRADIUSDIMENSION",2250791053:"IFCPUMPTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3651124850:"IFCPROJECTIONELEMENT",3642467123:"IFCPROJECTORDERRECORD",2904328755:"IFCPROJECTORDER",2744685151:"IFCPROCEDURE",3740093272:"IFCPORT",3724593414:"IFCPOLYLINE",4017108033:"IFCPLATETYPE",4231323485:"IFCPIPESEGMENTTYPE",804291784:"IFCPIPEFITTINGTYPE",3327091369:"IFCPERMIT",2382730787:"IFCPERFORMANCEHISTORY",2837617999:"IFCOUTLETTYPE",3425660407:"IFCORDERACTION",3588315303:"IFCOPENINGELEMENT",4143007308:"IFCOCCUPANT",1916936684:"IFCMOVE",977012517:"IFCMOTORCONNECTIONTYPE",3181161470:"IFCMEMBERTYPE",2108223431:"IFCMECHANICALFASTENERTYPE",377706215:"IFCMECHANICALFASTENER",2506943328:"IFCLINEARDIMENSION",1161773419:"IFCLIGHTFIXTURETYPE",1051575348:"IFCLAMPTYPE",3827777499:"IFCLABORRESOURCE",4288270099:"IFCJUNCTIONBOXTYPE",2391368822:"IFCINVENTORY",1806887404:"IFCHUMIDIFIERTYPE",1251058090:"IFCHEATEXCHANGERTYPE",2706460486:"IFCGROUP",3009204131:"IFCGRID",200128114:"IFCGASTERMINALTYPE",814719939:"IFCFURNITURESTANDARD",263784265:"IFCFURNISHINGELEMENT",3009222698:"IFCFLOWTREATMENTDEVICETYPE",2297155007:"IFCFLOWTERMINALTYPE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",1834744321:"IFCFLOWSEGMENTTYPE",1482959167:"IFCFLOWMOVINGDEVICETYPE",3815607619:"IFCFLOWMETERTYPE",3198132628:"IFCFLOWFITTINGTYPE",3907093117:"IFCFLOWCONTROLLERTYPE",1287392070:"IFCFEATUREELEMENTSUBTRACTION",2143335405:"IFCFEATUREELEMENTADDITION",2827207264:"IFCFEATUREELEMENT",2489546625:"IFCFASTENERTYPE",647756555:"IFCFASTENER",3737207727:"IFCFACETEDBREPWITHVOIDS",807026263:"IFCFACETEDBREP",3390157468:"IFCEVAPORATORTYPE",3174744832:"IFCEVAPORATIVECOOLERTYPE",3272907226:"IFCEQUIPMENTSTANDARD",1962604670:"IFCEQUIPMENTELEMENT",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",1704287377:"IFCELLIPSE",2590856083:"IFCELEMENTCOMPONENTTYPE",1623761950:"IFCELEMENTCOMPONENT",4123344466:"IFCELEMENTASSEMBLY",1758889154:"IFCELEMENT",360485395:"IFCELECTRICALBASEPROPERTIES",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",681481545:"IFCDIMENSIONCURVEDIRECTEDCALLOUT",1457835157:"IFCCURTAINWALLTYPE",3295246426:"IFCCREWRESOURCE",1916426348:"IFCCOVERINGTYPE",1419761937:"IFCCOSTSCHEDULE",3895139033:"IFCCOSTITEM",3293443760:"IFCCONTROL",2559216714:"IFCCONSTRUCTIONRESOURCE",2510884976:"IFCCONIC",3732776249:"IFCCOMPOSITECURVE",300633059:"IFCCOLUMNTYPE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",3124254112:"IFCBUILDINGSTOREY",1950629157:"IFCBUILDINGELEMENTTYPE",4031249490:"IFCBUILDING",1260505505:"IFCBOUNDEDCURVE",3649129432:"IFCBOOLEANCLIPPINGRESULT",1334484129:"IFCBLOCK",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",1674181508:"IFCANNOTATION",2296667514:"IFCACTOR",2097647324:"IFCTRANSPORTELEMENTTYPE",3473067441:"IFCTASK",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",4124788165:"IFCSURFACEOFREVOLUTION",2809605785:"IFCSURFACEOFLINEAREXTRUSION",2028607225:"IFCSURFACECURVESWEPTAREASOLID",4070609034:"IFCSTRUCTUREDDIMENSIONCALLOUT",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",3979015343:"IFCSTRUCTURALSURFACEMEMBER",3689010777:"IFCSTRUCTURALREACTION",530289379:"IFCSTRUCTURALMEMBER",3136571912:"IFCSTRUCTURALITEM",3544373492:"IFCSTRUCTURALACTIVITY",451544542:"IFCSPHERE",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3626867408:"IFCRIGHTCIRCULARCYLINDER",4158566097:"IFCRIGHTCIRCULARCONE",1856042241:"IFCREVOLVEDAREASOLID",2914609552:"IFCRESOURCE",1401173127:"IFCRELVOIDSELEMENT",3451746338:"IFCRELSPACEBOUNDARY",366585022:"IFCRELSERVICESBUILDINGS",4122056220:"IFCRELSEQUENCE",1058617721:"IFCRELSCHEDULESCOSTITEMS",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",750771296:"IFCRELPROJECTSELEMENT",202636808:"IFCRELOVERRIDESPROPERTIES",2051452291:"IFCRELOCCUPIESSPACES",3268803585:"IFCRELNESTS",4189434867:"IFCRELINTERACTIONREQUIREMENTS",279856033:"IFCRELFLOWCONTROLELEMENTS",3940055652:"IFCRELFILLSELEMENT",781010003:"IFCRELDEFINESBYTYPE",4186316022:"IFCRELDEFINESBYPROPERTIES",693640335:"IFCRELDEFINES",2551354335:"IFCRELDECOMPOSES",2802773753:"IFCRELCOVERSSPACES",886880790:"IFCRELCOVERSBLDGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",504942748:"IFCRELCONNECTSWITHECCENTRICITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",3912681535:"IFCRELCONNECTSSTRUCTURALELEMENT",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",3190031847:"IFCRELCONNECTSPORTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3945020480:"IFCRELCONNECTSPATHELEMENTS",1204542856:"IFCRELCONNECTSELEMENTS",826625072:"IFCRELCONNECTS",2851387026:"IFCRELASSOCIATESPROFILEPROPERTIES",2655215786:"IFCRELASSOCIATESMATERIAL",3840914261:"IFCRELASSOCIATESLIBRARY",982818633:"IFCRELASSOCIATESDOCUMENT",2728634034:"IFCRELASSOCIATESCONSTRAINT",919958153:"IFCRELASSOCIATESCLASSIFICATION",4095574036:"IFCRELASSOCIATESAPPROVAL",1327628568:"IFCRELASSOCIATESAPPLIEDVALUE",1865459582:"IFCRELASSOCIATES",205026976:"IFCRELASSIGNSTORESOURCE",3372526763:"IFCRELASSIGNSTOPROJECTORDER",2857406711:"IFCRELASSIGNSTOPRODUCT",4278684876:"IFCRELASSIGNSTOPROCESS",1307041759:"IFCRELASSIGNSTOGROUP",2495723537:"IFCRELASSIGNSTOCONTROL",1683148259:"IFCRELASSIGNSTOACTOR",3939117080:"IFCRELASSIGNS",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",2798486643:"IFCRECTANGULARPYRAMID",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3219374653:"IFCPROXY",1451395588:"IFCPROPERTYSET",4194566429:"IFCPROJECTIONCURVE",103090709:"IFCPROJECT",4208778838:"IFCPRODUCT",2945172077:"IFCPROCESS",220341763:"IFCPLANE",603570806:"IFCPLANARBOX",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3505215534:"IFCOFFSETCURVE3D",3388369263:"IFCOFFSETCURVE2D",3888040117:"IFCOBJECT",1425443689:"IFCMANIFOLDSOLIDBREP",1281925730:"IFCLINE",572779678:"IFCLSHAPEPROFILEDEF",1484403080:"IFCISHAPEPROFILEDEF",987898635:"IFCGEOMETRICCURVESET",1268542332:"IFCFURNITURETYPE",4238390223:"IFCFURNISHINGELEMENTTYPE",3455213021:"IFCFLUIDFLOWPROPERTIES",315944413:"IFCFILLAREASTYLETILES",4203026998:"IFCFILLAREASTYLETILESYMBOLWITHSTYLE",374418227:"IFCFILLAREASTYLEHATCHING",2047409740:"IFCFACEBASEDSURFACEMODEL",477187591:"IFCEXTRUDEDAREASOLID",80994333:"IFCENERGYPROPERTIES",2835456948:"IFCELLIPSEPROFILEDEF",2777663545:"IFCELEMENTARYSURFACE",339256511:"IFCELEMENTTYPE",1883228015:"IFCELEMENTQUANTITY",1472233963:"IFCEDGELOOP",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",3073041342:"IFCDRAUGHTINGCALLOUT",526551008:"IFCDOORSTYLE",1714330368:"IFCDOORPANELPROPERTIES",2963535650:"IFCDOORLININGPROPERTIES",32440307:"IFCDIRECTION",4054601972:"IFCDIMENSIONCURVETERMINATOR",606661476:"IFCDIMENSIONCURVE",693772133:"IFCDEFINEDSYMBOL",2827736869:"IFCCURVEBOUNDEDPLANE",2601014836:"IFCCURVE",2147822146:"IFCCSGSOLID",2506170314:"IFCCSGPRIMITIVE3D",194851669:"IFCCRANERAILFSHAPEPROFILEDEF",4133800736:"IFCCRANERAILASHAPEPROFILEDEF",2485617015:"IFCCOMPOSITECURVESEGMENT",2205249479:"IFCCLOSEDSHELL",1383045692:"IFCCIRCLEPROFILEDEF",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",1123145078:"IFCCARTESIANPOINT",2898889636:"IFCCSHAPEPROFILEDEF",2713105998:"IFCBOXEDHALFSPACE",2581212453:"IFCBOUNDINGBOX",4182860854:"IFCBOUNDEDSURFACE",2736907675:"IFCBOOLEANRESULT",2740243338:"IFCAXIS2PLACEMENT3D",3125803723:"IFCAXIS2PLACEMENT2D",4261334040:"IFCAXIS1PLACEMENT",1302238472:"IFCANNOTATIONSURFACE",2265737646:"IFCANNOTATIONFILLAREAOCCURRENCE",669184980:"IFCANNOTATIONFILLAREA",3288037868:"IFCANNOTATIONCURVEOCCURRENCE",2543172580:"IFCZSHAPEPROFILEDEF",1299126871:"IFCWINDOWSTYLE",512836454:"IFCWINDOWPANELPROPERTIES",336235671:"IFCWINDOWLININGPROPERTIES",2759199220:"IFCVERTEXLOOP",1417489154:"IFCVECTOR",427810014:"IFCUSHAPEPROFILEDEF",2347495698:"IFCTYPEPRODUCT",1628702193:"IFCTYPEOBJECT",1345879162:"IFCTWODIRECTIONREPEATFACTOR",2715220739:"IFCTRAPEZIUMPROFILEDEF",3124975700:"IFCTEXTLITERALWITHEXTENT",4282788508:"IFCTEXTLITERAL",3028897424:"IFCTERMINATORSYMBOL",3071757647:"IFCTSHAPEPROFILEDEF",230924584:"IFCSWEPTSURFACE",1260650574:"IFCSWEPTDISKSOLID",2247615214:"IFCSWEPTAREASOLID",1878645084:"IFCSURFACESTYLERENDERING",2513912981:"IFCSURFACE",2233826070:"IFCSUBEDGE",3653947884:"IFCSTRUCTURALSTEELPROFILEPROPERTIES",3843319758:"IFCSTRUCTURALPROFILEPROPERTIES",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",390701378:"IFCSPACETHERMALLOADPROPERTIES",1202362311:"IFCSOUNDVALUE",2485662743:"IFCSOUNDPROPERTIES",723233188:"IFCSOLIDMODEL",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",4124623270:"IFCSHELLBASEDSURFACEMODEL",2411513650:"IFCSERVICELIFEFACTOR",1509187699:"IFCSECTIONEDSPINE",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",478536968:"IFCRELATIONSHIP",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",3413951693:"IFCREGULARTIMESERIES",3615266464:"IFCRECTANGLEPROFILEDEF",110355661:"IFCPROPERTYTABLEVALUE",3650150729:"IFCPROPERTYSINGLEVALUE",3357820518:"IFCPROPERTYSETDEFINITION",941946838:"IFCPROPERTYREFERENCEVALUE",2752243245:"IFCPROPERTYLISTVALUE",4166981789:"IFCPROPERTYENUMERATEDVALUE",1680319473:"IFCPROPERTYDEFINITION",871118103:"IFCPROPERTYBOUNDEDVALUE",673634403:"IFCPRODUCTDEFINITIONSHAPE",179317114:"IFCPREDEFINEDPOINTMARKERSYMBOL",433424934:"IFCPREDEFINEDDIMENSIONSYMBOL",2559016684:"IFCPREDEFINEDCURVEFONT",759155922:"IFCPREDEFINEDCOLOUR",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2924175390:"IFCPOLYLOOP",1423911732:"IFCPOINTONSURFACE",4022376103:"IFCPOINTONCURVE",2067069095:"IFCPOINT",1663979128:"IFCPLANAREXTENT",2004835150:"IFCPLACEMENT",597895409:"IFCPIXELTEXTURE",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2519244187:"IFCPATH",2529465313:"IFCPARAMETERIZEDPROFILEDEF",1029017970:"IFCORIENTEDEDGE",2665983363:"IFCOPENSHELL",2833995503:"IFCONEDIRECTIONREPEATFACTOR",219451334:"IFCOBJECTDEFINITION",1430189142:"IFCMECHANICALCONCRETEMATERIALPROPERTIES",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",2347385850:"IFCMAPPEDITEM",1008929658:"IFCLOOP",2624227202:"IFCLOCALPLACEMENT",3422422726:"IFCLIGHTSOURCESPOT",1520743889:"IFCLIGHTSOURCEPOSITIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",125510826:"IFCLIGHTSOURCEAMBIENT",1402838566:"IFCLIGHTSOURCE",3741457305:"IFCIRREGULARTIMESERIES",3905492369:"IFCIMAGETEXTURE",2445078500:"IFCHYGROSCOPICMATERIALPROPERTIES",812098782:"IFCHALFSPACESOLID",178086475:"IFCGRIDPLACEMENT",3590301190:"IFCGEOMETRICSET",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",1446786286:"IFCGENERALPROFILEPROPERTIES",803998398:"IFCGENERALMATERIALPROPERTIES",3857492461:"IFCFUELPROPERTIES",738692330:"IFCFILLAREASTYLE",4219587988:"IFCFAILURECONNECTIONCONDITION",3008276851:"IFCFACESURFACE",803316827:"IFCFACEOUTERBOUND",1809719519:"IFCFACEBOUND",2556980723:"IFCFACE",1860660968:"IFCEXTENDEDMATERIALPROPERTIES",476780140:"IFCEDGECURVE",3900360178:"IFCEDGE",4170525392:"IFCDRAUGHTINGPREDEFINEDTEXTFONT",3732053477:"IFCDOCUMENTREFERENCE",1694125774:"IFCDIMENSIONPAIR",2273265877:"IFCDIMENSIONCALLOUTRELATIONSHIP",3632507154:"IFCDERIVEDPROFILEDEF",3800577675:"IFCCURVESTYLE",2889183280:"IFCCONVERSIONBASEDUNIT",3050246964:"IFCCONTEXTDEPENDENTUNIT",45288368:"IFCCONNECTIONPOINTECCENTRICITY",1981873012:"IFCCONNECTIONCURVEGEOMETRY",370225590:"IFCCONNECTEDFACESET",1485152156:"IFCCOMPOSITEPROFILEDEF",2542286263:"IFCCOMPLEXPROPERTY",776857604:"IFCCOLOURRGB",647927063:"IFCCLASSIFICATIONREFERENCE",3150382593:"IFCCENTERLINEPROFILEDEF",616511568:"IFCBLOBTEXTURE",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",1310608509:"IFCARBITRARYOPENPROFILEDEF",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",2297822566:"IFCANNOTATIONTEXTOCCURRENCE",3612888222:"IFCANNOTATIONSYMBOLOCCURRENCE",962685235:"IFCANNOTATIONSURFACEOCCURRENCE",2442683028:"IFCANNOTATIONOCCURRENCE",1065908215:"IFCWATERPROPERTIES",891718957:"IFCVIRTUALGRIDINTERSECTION",1907098498:"IFCVERTEXPOINT",3304826586:"IFCVERTEXBASEDTEXTUREMAP",2799835756:"IFCVERTEX",180925521:"IFCUNITASSIGNMENT",1735638870:"IFCTOPOLOGYREPRESENTATION",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",581633288:"IFCTIMESERIESVALUE",1718945513:"IFCTIMESERIESREFERENCERELATIONSHIP",3101149627:"IFCTIMESERIES",3317419933:"IFCTHERMALMATERIALPROPERTIES",1210645708:"IFCTEXTUREVERTEX",2552916305:"IFCTEXTUREMAP",1742049831:"IFCTEXTURECOORDINATEGENERATOR",280115917:"IFCTEXTURECOORDINATE",1484833681:"IFCTEXTSTYLEWITHBOXCHARACTERISTICS",1640371178:"IFCTEXTSTYLETEXTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1983826977:"IFCTEXTSTYLEFONTMODEL",1447204868:"IFCTEXTSTYLE",912023232:"IFCTELECOMADDRESS",531007025:"IFCTABLEROW",985171141:"IFCTABLE",1290481447:"IFCSYMBOLSTYLE",626085974:"IFCSURFACETEXTURE",1351298697:"IFCSURFACESTYLEWITHTEXTURES",846575682:"IFCSURFACESTYLESHADING",1607154358:"IFCSURFACESTYLEREFRACTION",3303107099:"IFCSURFACESTYLELIGHTING",1300840506:"IFCSURFACESTYLE",3049322572:"IFCSTYLEDREPRESENTATION",3958052878:"IFCSTYLEDITEM",2830218821:"IFCSTYLEMODEL",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",2525727697:"IFCSTRUCTURALLOADSTATIC",2162789131:"IFCSTRUCTURALLOAD",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",3692461612:"IFCSIMPLEPROPERTY",4240577450:"IFCSHAPEREPRESENTATION",3982875396:"IFCSHAPEMODEL",867548509:"IFCSHAPEASPECT",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",2042790032:"IFCSECTIONPROPERTIES",448429030:"IFCSIUNIT",2341007311:"IFCROOT",3679540991:"IFCRIBPLATEPROFILEPROPERTIES",1660063152:"IFCREPRESENTATIONMAP",3008791417:"IFCREPRESENTATIONITEM",3377609919:"IFCREPRESENTATIONCONTEXT",1076942058:"IFCREPRESENTATION",1222501353:"IFCRELAXATION",1580146022:"IFCREINFORCEMENTBARPROPERTIES",2692823254:"IFCREFERENCESVALUEDOCUMENT",825690147:"IFCQUANTITYWEIGHT",2405470396:"IFCQUANTITYVOLUME",3252649465:"IFCQUANTITYTIME",931644368:"IFCQUANTITYLENGTH",2093928680:"IFCQUANTITYCOUNT",2044713172:"IFCQUANTITYAREA",3710013099:"IFCPROPERTYENUMERATION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",3896028662:"IFCPROPERTYCONSTRAINTRELATIONSHIP",2598011224:"IFCPROPERTY",2802850158:"IFCPROFILEPROPERTIES",3958567839:"IFCPROFILEDEF",2267347899:"IFCPRODUCTSOFCOMBUSTIONPROPERTIES",2095639259:"IFCPRODUCTREPRESENTATION",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",3119450353:"IFCPRESENTATIONSTYLE",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1775413392:"IFCPREDEFINEDTEXTFONT",3213052703:"IFCPREDEFINEDTERMINATORSYMBOL",990879717:"IFCPREDEFINEDSYMBOL",3727388367:"IFCPREDEFINEDITEM",3355820592:"IFCPOSTALADDRESS",2226359599:"IFCPHYSICALSIMPLEQUANTITY",2483315170:"IFCPHYSICALQUANTITY",101040310:"IFCPERSONANDORGANIZATION",2077209135:"IFCPERSON",1207048766:"IFCOWNERHISTORY",1411181986:"IFCORGANIZATIONRELATIONSHIP",4251960020:"IFCORGANIZATION",1227763645:"IFCOPTICALMATERIALPROPERTIES",2251480897:"IFCOBJECTIVE",3701648758:"IFCOBJECTPLACEMENT",1918398963:"IFCNAMEDUNIT",2706619895:"IFCMONETARYUNIT",3368373690:"IFCMETRIC",677618848:"IFCMECHANICALSTEELMATERIALPROPERTIES",4256014907:"IFCMECHANICALMATERIALPROPERTIES",2597039031:"IFCMEASUREWITHUNIT",3265635763:"IFCMATERIALPROPERTIES",2199411900:"IFCMATERIALLIST",1303795690:"IFCMATERIALLAYERSETUSAGE",3303938423:"IFCMATERIALLAYERSET",248100487:"IFCMATERIALLAYER",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",1838606355:"IFCMATERIAL",30780891:"IFCLOCALTIME",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",4162380809:"IFCLIGHTDISTRIBUTIONDATA",3452421091:"IFCLIBRARYREFERENCE",2655187982:"IFCLIBRARYINFORMATION",3020489413:"IFCIRREGULARTIMESERIESVALUE",852622518:"IFCGRIDAXIS",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",3207319532:"IFCEXTERNALLYDEFINEDSYMBOL",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",3200245327:"IFCEXTERNALREFERENCE",1648886627:"IFCENVIRONMENTALIMPACTVALUE",3796139169:"IFCDRAUGHTINGCALLOUTRELATIONSHIP",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",1154170062:"IFCDOCUMENTINFORMATION",1376555844:"IFCDOCUMENTELECTRONICFORMAT",2949456006:"IFCDIMENSIONALEXPONENTS",1045800335:"IFCDERIVEDUNITELEMENT",1765591967:"IFCDERIVEDUNIT",1072939445:"IFCDATEANDTIME",3510044353:"IFCCURVESTYLEFONTPATTERN",2367409068:"IFCCURVESTYLEFONTANDSCALING",1105321065:"IFCCURVESTYLEFONT",539742890:"IFCCURRENCYRELATIONSHIP",602808272:"IFCCOSTVALUE",1065062679:"IFCCOORDINATEDUNIVERSALTIMEOFFSET",347226245:"IFCCONSTRAINTRELATIONSHIP",613356794:"IFCCONSTRAINTCLASSIFICATIONRELATIONSHIP",1658513725:"IFCCONSTRAINTAGGREGATIONRELATIONSHIP",1959218052:"IFCCONSTRAINT",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",4257277454:"IFCCONNECTIONPORTGEOMETRY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",3264961684:"IFCCOLOURSPECIFICATION",3639012971:"IFCCLASSIFICATIONNOTATIONFACET",938368621:"IFCCLASSIFICATIONNOTATION",1098599126:"IFCCLASSIFICATIONITEMRELATIONSHIP",1767535486:"IFCCLASSIFICATIONITEM",747523909:"IFCCLASSIFICATION",622194075:"IFCCALENDARDATE",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1387855156:"IFCBOUNDARYNODECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1560379544:"IFCBOUNDARYEDGECONDITION",4037036970:"IFCBOUNDARYCONDITION",3869604511:"IFCAPPROVALRELATIONSHIP",390851274:"IFCAPPROVALPROPERTYRELATIONSHIP",2080292479:"IFCAPPROVALACTORRELATIONSHIP",130549933:"IFCAPPROVAL",1110488051:"IFCAPPLIEDVALUERELATIONSHIP",411424972:"IFCAPPLIEDVALUE",639542469:"IFCAPPLICATION",618182010:"IFCADDRESS",3630933823:"IFCACTORROLE",599546466:"FILE_DESCRIPTION",1390159747:"FILE_NAME",1109904537:"FILE_SCHEMA"};let Ms=class{constructor(){S(this,"enabled",!0),S(this,"trigger",s=>{if(!this.enabled)return;const t=this.handlers.slice(0);for(const e of t)e(s)}),S(this,"handlers",[])}add(s){this.handlers.push(s)}remove(s){this.handlers=this.handlers.filter(t=>t!==s)}reset(){this.handlers.length=0}};class Wt extends Map{constructor(t){super(t),S(this,"onItemSet",new Ms),S(this,"onItemUpdated",new Ms),S(this,"onItemDeleted",new Ms),S(this,"onBeforeDelete",new Ms),S(this,"onCleared",new Ms),S(this,"guard",()=>!0)}set eventsEnabled(t){this.onItemSet.enabled=t,this.onItemUpdated.enabled=t,this.onItemDeleted.enabled=t,this.onBeforeDelete.enabled=t,this.onCleared.enabled=t}clear(){for(const[t,e]of this)this.onBeforeDelete.trigger({key:t,value:e});super.clear(),this.onCleared.trigger()}set(t,e){const i=this.has(t);if(!(this.guard??(()=>!0))(t,e))return this;const n=super.set(t,e);return i?(this.onItemUpdated||(this.onItemUpdated=new Ms),this.onItemUpdated.trigger({key:t,value:e})):(this.onItemSet||(this.onItemSet=new Ms),this.onItemSet.trigger({key:t,value:e})),n}delete(t){const e=this.get(t);if(!e)return!1;this.onBeforeDelete.trigger({key:t,value:e});const i=super.delete(t);return i&&this.onItemDeleted.trigger(t),i}getKey(t){for(const[e,i]of this)if(i===t)return e}update(t){const e=this.getKey(t);e&&this.set(e,t)}deleteIf(t){for(const[e,i]of this)t(i,e)&&this.delete(e)}replaceKey(t,e,i=!1){const n=this.get(t);return n?!(this.get(e)&&!i)&&(this.eventsEnabled=!1,this.delete(t),this.eventsEnabled=!0,this.set(e,n),!0):!1}dispose(){this.clear(),this.onItemSet.reset(),this.onItemDeleted.reset(),this.onItemUpdated.reset(),this.onCleared.reset(),this.onBeforeDelete.reset()}}let ge=class extends Set{constructor(s){super(s),S(this,"onUpdated",new Ms),S(this,"onItemAdded",new Ms),S(this,"onBeforeDelete",new Ms),S(this,"onItemDeleted",new Ms),S(this,"onCleared",new Ms),S(this,"guard",()=>!0)}set eventsEnabled(s){this.onUpdated.enabled=s,this.onItemAdded.enabled=s,this.onItemDeleted.enabled=s,this.onBeforeDelete.enabled=s,this.onCleared.enabled=s}clear(){for(const s of this)this.onBeforeDelete.trigger(s);super.clear(),this.onCleared.trigger(),this.onUpdated.trigger()}add(...s){for(const t of s)this.has(t)||(this.guard??(()=>!0))(t)&&(super.add(t),this.onItemAdded||(this.onItemAdded=new Ms),this.onItemAdded.trigger(t));return this.onUpdated||(this.onUpdated=new Ms),this.onUpdated.trigger(),this}delete(s){if(!this.has(s))return!1;this.onBeforeDelete.trigger(s);const t=super.delete(s);return t&&(this.onItemDeleted.trigger(),this.onUpdated.trigger()),t}deleteIf(s){for(const t of this)s(t)&&this.delete(t)}getIndex(s){let t=0;for(const e of this){if(e===s)return t;t++}return-1}dispose(){this.clear(),this.onItemAdded.reset(),this.onItemDeleted.reset(),this.onCleared.reset(),this.onBeforeDelete.reset(),this.onUpdated.reset()}};const Nr=new Int32Array(2),Ab=new Float32Array(Nr.buffer),Sb=new Float64Array(Nr.buffer),lu=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var sg,hu;(hu=sg||(sg={}))[hu.UTF8_BYTES=1]="UTF8_BYTES",hu[hu.UTF16_STRING=2]="UTF16_STRING";let Ob=class Lw{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new Lw(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return Nr[0]=this.readInt32(t),Ab[0]}readFloat64(t){return Nr[lu?0:1]=this.readInt32(t),Nr[lu?1:0]=this.readInt32(t+4),Sb[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){Ab[0]=e,this.writeInt32(t,Nr[0])}writeFloat64(t,e){Sb[0]=e,this.writeInt32(t,Nr[lu?0:1]),this.writeInt32(t+4,Nr[lu?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<4;e++)t+=String.fromCharCode(this.readInt8(this.position_+4+e));return t}__offset(t,e){const i=t-this.readInt32(t);return e<this.readInt16(i)?this.readInt16(i+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const i=this.readInt32(t);t+=4;const n=this.bytes_.subarray(t,t+i);return e===sg.UTF8_BYTES?n:this.text_decoder_.decode(n)}__union_with_string(t,e){return typeof t=="string"?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+4}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=4)throw new Error("FlatBuffers: file identifier must be length 4");for(let e=0;e<4;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+4+e))return!1;return!0}createScalarList(t,e){const i=[];for(let n=0;n<e;++n){const r=t(n);r!==null&&i.push(r)}return i}createObjList(t,e){const i=[];for(let n=0;n<e;++n){const r=t(n);r!==null&&i.push(r.unpack())}return i}},oS=class Nw{constructor(t){let e;this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder,e=t||1024,this.bb=Ob.allocate(e),this.space=e}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,e){t>this.minalign&&(this.minalign=t);const i=1+~(this.bb.capacity()-this.space+e)&t-1;for(;this.space<i+t+e;){const n=this.bb.capacity();this.bb=Nw.growByteBuffer(this.bb),this.space+=this.bb.capacity()-n}this.pad(i)}pad(t){for(let e=0;e<t;e++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,e,i){(this.force_defaults||e!=i)&&(this.addInt8(e),this.slot(t))}addFieldInt16(t,e,i){(this.force_defaults||e!=i)&&(this.addInt16(e),this.slot(t))}addFieldInt32(t,e,i){(this.force_defaults||e!=i)&&(this.addInt32(e),this.slot(t))}addFieldInt64(t,e,i){(this.force_defaults||e!==i)&&(this.addInt64(e),this.slot(t))}addFieldFloat32(t,e,i){(this.force_defaults||e!=i)&&(this.addFloat32(e),this.slot(t))}addFieldFloat64(t,e,i){(this.force_defaults||e!=i)&&(this.addFloat64(e),this.slot(t))}addFieldOffset(t,e,i){(this.force_defaults||e!=i)&&(this.addOffset(e),this.slot(t))}addFieldStruct(t,e,i){e!=i&&(this.nested(e),this.slot(t))}nested(t){if(t!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(t){this.vtable!==null&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){const e=t.capacity();if(3221225472&e)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const i=e<<1,n=Ob.allocate(i);return n.setPosition(i-e),n.bytes().set(t.bytes(),i-e),n}addOffset(t){this.prep(4,0),this.writeInt32(this.offset()-t+4)}startObject(t){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=t;for(let e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const t=this.offset();let e=this.vtable_in_use-1;for(;e>=0&&this.vtable[e]==0;e--);const i=e+1;for(;e>=0;e--)this.addInt16(this.vtable[e]!=0?t-this.vtable[e]:0);this.addInt16(t-this.object_start);const n=2*(i+2);this.addInt16(n);let r=0;const o=this.space;t:for(e=0;e<this.vtables.length;e++){const a=this.bb.capacity()-this.vtables[e];if(n==this.bb.readInt16(a)){for(let l=2;l<n;l+=2)if(this.bb.readInt16(o+l)!=this.bb.readInt16(a+l))continue t;r=this.vtables[e];break}}return r?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,r-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,e,i){const n=i?4:0;if(e){const r=e;if(this.prep(this.minalign,8+n),r.length!=4)throw new TypeError("FlatBuffers: file identifier must be length 4");for(let o=3;o>=0;o--)this.writeInt8(r.charCodeAt(o))}this.prep(this.minalign,4+n),this.addOffset(t),n&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,e){this.finish(t,e,!0)}requiredField(t,e){const i=this.bb.capacity()-t,n=i-this.bb.readInt32(i);if(!(e<this.bb.readInt16(n)&&this.bb.readInt16(n+e)!=0))throw new TypeError("FlatBuffers: field "+e+" must be set")}startVector(t,e,i){this.notNested(),this.vector_num_elems=e,this.prep(4,t*e),this.prep(i,t*e)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);const e=this.createString(t);return this.string_maps.set(t,e),e}createString(t){if(t==null)return 0;let e;return e=t instanceof Uint8Array?t:this.text_encoder.encode(t),this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length),this.bb.bytes().set(e,this.space),this.endVector()}createByteVector(t){return t==null?0:(this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length),this.bb.bytes().set(t,this.space),this.endVector())}createObjectOffset(t){return t===null?0:typeof t=="string"?this.createString(t):t.pack(this)}createObjectOffsetList(t){const e=[];for(let i=0;i<t.length;++i){const n=t[i];if(n===null)throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.");e.push(this.createObjectOffset(n))}return e}createStructOffsetList(t,e){return e(this,t.length),this.createObjectOffsetList(t.slice().reverse()),this.endVector()}},Rh=class Tr{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsAlignment(t,e){return(e||new Tr).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsAlignment(t,e){return t.setPosition(t.position()+4),(e||new Tr).__init(t.readInt32(t.position())+t.position(),t)}absolute(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}absoluteLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}absoluteArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}horizontal(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}horizontalLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}horizontalArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}vertical(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}verticalLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}verticalArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startAlignment(t){t.startObject(3)}static addAbsolute(t,e){t.addFieldOffset(0,e,0)}static createAbsoluteVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addInt32(e[i]);return t.endVector()}static startAbsoluteVector(t,e){t.startVector(4,e,4)}static addHorizontal(t,e){t.addFieldOffset(1,e,0)}static createHorizontalVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addInt32(e[i]);return t.endVector()}static startHorizontalVector(t,e){t.startVector(4,e,4)}static addVertical(t,e){t.addFieldOffset(2,e,0)}static createVerticalVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addInt32(e[i]);return t.endVector()}static startVerticalVector(t,e){t.startVector(4,e,4)}static endAlignment(t){return t.endObject()}static createAlignment(t,e,i,n){return Tr.startAlignment(t),Tr.addAbsolute(t,e),Tr.addHorizontal(t,i),Tr.addVertical(t,n),Tr.endAlignment(t)}},ig=class ja{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsAttribute(t,e){return(e||new ja).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsAttribute(t,e){return t.setPosition(t.position()+4),(e||new ja).__init(t.readInt32(t.position())+t.position(),t)}data(t,e){const i=this.bb.__offset(this.bb_pos,4);return i?this.bb.__string(this.bb.__vector(this.bb_pos+i)+4*t,e):null}dataLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}static startAttribute(t){t.startObject(1)}static addData(t,e){t.addFieldOffset(0,e,0)}static createDataVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startDataVector(t,e){t.startVector(4,e,4)}static endAttribute(t){const e=t.endObject();return t.requiredField(e,4),e}static createAttribute(t,e){return ja.startAttribute(t),ja.addData(t,e),ja.endAttribute(t)}},os=class{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(s,t){return this.bb_pos=s,this.bb=t,this}x(){return this.bb.readFloat32(this.bb_pos)}mutate_x(s){return this.bb.writeFloat32(this.bb_pos+0,s),!0}y(){return this.bb.readFloat32(this.bb_pos+4)}mutate_y(s){return this.bb.writeFloat32(this.bb_pos+4,s),!0}z(){return this.bb.readFloat32(this.bb_pos+8)}mutate_z(s){return this.bb.writeFloat32(this.bb_pos+8,s),!0}static sizeOf(){return 12}static createFloatVector(s,t,e,i){return s.prep(4,12),s.writeFloat32(i),s.writeFloat32(e),s.writeFloat32(t),s.offset()}},Dp=class{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(s,t){return this.bb_pos=s,this.bb=t,this}aperture(){return this.bb.readFloat32(this.bb_pos)}mutate_aperture(s){return this.bb.writeFloat32(this.bb_pos+0,s),!0}position(s){return(s||new os).__init(this.bb_pos+4,this.bb)}radius(){return this.bb.readFloat32(this.bb_pos+16)}mutate_radius(s){return this.bb.writeFloat32(this.bb_pos+16,s),!0}xDirection(s){return(s||new os).__init(this.bb_pos+20,this.bb)}yDirection(s){return(s||new os).__init(this.bb_pos+32,this.bb)}static sizeOf(){return 44}static createCircleCurve(s,t,e,i,n,r,o,a,l,h,c,u){return s.prep(4,44),s.prep(4,12),s.writeFloat32(u),s.writeFloat32(c),s.writeFloat32(h),s.prep(4,12),s.writeFloat32(l),s.writeFloat32(a),s.writeFloat32(o),s.writeFloat32(r),s.prep(4,12),s.writeFloat32(n),s.writeFloat32(i),s.writeFloat32(e),s.writeFloat32(t),s.offset()}},A_=class{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(s,t){return this.bb_pos=s,this.bb=t,this}p1(s){return(s||new os).__init(this.bb_pos,this.bb)}p2(s){return(s||new os).__init(this.bb_pos+12,this.bb)}static sizeOf(){return 24}static createWire(s,t,e,i,n,r,o){return s.prep(4,24),s.prep(4,12),s.writeFloat32(o),s.writeFloat32(r),s.writeFloat32(n),s.prep(4,12),s.writeFloat32(i),s.writeFloat32(e),s.writeFloat32(t),s.offset()}},S_=class Ya{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsWireSet(t,e){return(e||new Ya).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsWireSet(t,e){return t.setPosition(t.position()+4),(e||new Ya).__init(t.readInt32(t.position())+t.position(),t)}ps(t,e){const i=this.bb.__offset(this.bb_pos,4);return i?(e||new os).__init(this.bb.__vector(this.bb_pos+i)+12*t,this.bb):null}psLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}static startWireSet(t){t.startObject(1)}static addPs(t,e){t.addFieldOffset(0,e,0)}static startPsVector(t,e){t.startVector(12,e,4)}static endWireSet(t){return t.endObject()}static createWireSet(t,e){return Ya.startWireSet(t),Ya.addPs(t,e),Ya.endWireSet(t)}},ms=class Tn{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsAxis(t,e){return(e||new Tn).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsAxis(t,e){return t.setPosition(t.position()+4),(e||new Tn).__init(t.readInt32(t.position())+t.position(),t)}wires(t,e){const i=this.bb.__offset(this.bb_pos,4);return i?(e||new A_).__init(this.bb.__vector(this.bb_pos+i)+24*t,this.bb):null}wiresLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}order(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}orderLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}orderArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}parts(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readInt8(this.bb.__vector(this.bb_pos+e)+t):0}partsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}partsArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Int8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}wireSets(t,e){const i=this.bb.__offset(this.bb_pos,10);return i?(e||new S_).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}wireSetsLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}circleCurves(t,e){const i=this.bb.__offset(this.bb_pos,12);return i?(e||new Dp).__init(this.bb.__vector(this.bb_pos+i)+44*t,this.bb):null}circleCurvesLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startAxis(t){t.startObject(5)}static addWires(t,e){t.addFieldOffset(0,e,0)}static startWiresVector(t,e){t.startVector(24,e,4)}static addOrder(t,e){t.addFieldOffset(1,e,0)}static createOrderVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addInt32(e[i]);return t.endVector()}static startOrderVector(t,e){t.startVector(4,e,4)}static addParts(t,e){t.addFieldOffset(2,e,0)}static createPartsVector(t,e){t.startVector(1,e.length,1);for(let i=e.length-1;i>=0;i--)t.addInt8(e[i]);return t.endVector()}static startPartsVector(t,e){t.startVector(1,e,1)}static addWireSets(t,e){t.addFieldOffset(3,e,0)}static createWireSetsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startWireSetsVector(t,e){t.startVector(4,e,4)}static addCircleCurves(t,e){t.addFieldOffset(4,e,0)}static startCircleCurvesVector(t,e){t.startVector(44,e,4)}static endAxis(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),t.requiredField(e,8),t.requiredField(e,10),t.requiredField(e,12),e}static createAxis(t,e,i,n,r,o){return Tn.startAxis(t),Tn.addWires(t,e),Tn.addOrder(t,i),Tn.addParts(t,n),Tn.addWireSets(t,r),Tn.addCircleCurves(t,o),Tn.endAxis(t)}};var Me=(s=>(s[s.NONE=0]="NONE",s[s.WIRE=1]="WIRE",s[s.WIRE_SET=2]="WIRE_SET",s[s.CIRCLE_CURVE=3]="CIRCLE_CURVE",s))(Me||{});let gl=class Io{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBigShellHole(t,e){return(e||new Io).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBigShellHole(t,e){return t.setPosition(t.position()+4),(e||new Io).__init(t.readInt32(t.position())+t.position(),t)}indices(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}indicesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}indicesArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}profileId(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint16(this.bb_pos+t):0}mutate_profile_id(t){const e=this.bb.__offset(this.bb_pos,6);return e!==0&&(this.bb.writeUint16(this.bb_pos+e,t),!0)}static startBigShellHole(t){t.startObject(2)}static addIndices(t,e){t.addFieldOffset(0,e,0)}static createIndicesVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addInt32(e[i]);return t.endVector()}static startIndicesVector(t,e){t.startVector(4,e,4)}static addProfileId(t,e){t.addFieldInt16(1,e,0)}static endBigShellHole(t){const e=t.endObject();return t.requiredField(e,4),e}static createBigShellHole(t,e,i){return Io.startBigShellHole(t),Io.addIndices(t,e),Io.addProfileId(t,i),Io.endBigShellHole(t)}},Ko=class Wa{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBigShellProfile(t,e){return(e||new Wa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBigShellProfile(t,e){return t.setPosition(t.position()+4),(e||new Wa).__init(t.readInt32(t.position())+t.position(),t)}indices(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}indicesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}indicesArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startBigShellProfile(t){t.startObject(1)}static addIndices(t,e){t.addFieldOffset(0,e,0)}static createIndicesVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addInt32(e[i]);return t.endVector()}static startIndicesVector(t,e){t.startVector(4,e,4)}static endBigShellProfile(t){const e=t.endObject();return t.requiredField(e,4),e}static createBigShellProfile(t,e){return Wa.startBigShellProfile(t),Wa.addIndices(t,e),Wa.endBigShellProfile(t)}},Mw=class{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(s,t){return this.bb_pos=s,this.bb=t,this}min(s){return(s||new os).__init(this.bb_pos,this.bb)}max(s){return(s||new os).__init(this.bb_pos+12,this.bb)}static sizeOf(){return 24}static createBoundingBox(s,t,e,i,n,r,o){return s.prep(4,24),s.prep(4,12),s.writeFloat32(o),s.writeFloat32(r),s.writeFloat32(n),s.prep(4,12),s.writeFloat32(i),s.writeFloat32(e),s.writeFloat32(t),s.offset()}},Ji=class xo{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsCircleExtrusion(t,e){return(e||new xo).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsCircleExtrusion(t,e){return t.setPosition(t.position()+4),(e||new xo).__init(t.readInt32(t.position())+t.position(),t)}radius(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}radiusLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}radiusArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}axes(t,e){const i=this.bb.__offset(this.bb_pos,6);return i?(e||new ms).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}axesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}static startCircleExtrusion(t){t.startObject(2)}static addRadius(t,e){t.addFieldOffset(0,e,0)}static createRadiusVector(t,e){t.startVector(8,e.length,8);for(let i=e.length-1;i>=0;i--)t.addFloat64(e[i]);return t.endVector()}static startRadiusVector(t,e){t.startVector(8,e,8)}static addAxes(t,e){t.addFieldOffset(1,e,0)}static createAxesVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startAxesVector(t,e){t.startVector(4,e,4)}static endCircleExtrusion(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),e}static createCircleExtrusion(t,e,i){return xo.startCircleExtrusion(t),xo.addRadius(t,e),xo.addAxes(t,i),xo.endCircleExtrusion(t)}},Dw=class{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(s,t){return this.bb_pos=s,this.bb=t,this}x(){return this.bb.readFloat64(this.bb_pos)}mutate_x(s){return this.bb.writeFloat64(this.bb_pos+0,s),!0}y(){return this.bb.readFloat64(this.bb_pos+8)}mutate_y(s){return this.bb.writeFloat64(this.bb_pos+8,s),!0}z(){return this.bb.readFloat64(this.bb_pos+16)}mutate_z(s){return this.bb.writeFloat64(this.bb_pos+16,s),!0}static sizeOf(){return 24}static createDoubleVector(s,t,e,i){return s.prep(8,24),s.writeFloat64(i),s.writeFloat64(e),s.writeFloat64(t),s.offset()}},oi=class Ga{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsGeometryLines(t,e){return(e||new Ga).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometryLines(t,e){return t.setPosition(t.position()+4),(e||new Ga).__init(t.readInt32(t.position())+t.position(),t)}points(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readFloat32(this.bb.__vector(this.bb_pos+e)+4*t):0}pointsLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}pointsArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startGeometryLines(t){t.startObject(1)}static addPoints(t,e){t.addFieldOffset(0,e,0)}static createPointsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addFloat32(e[i]);return t.endVector()}static startPointsVector(t,e){t.startVector(4,e,4)}static endGeometryLines(t){const e=t.endObject();return t.requiredField(e,4),e}static createGeometryLines(t,e){return Ga.startGeometryLines(t),Ga.addPoints(t,e),Ga.endGeometryLines(t)}},Sd=class{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(s,t){return this.bb_pos=s,this.bb=t,this}id(){return this.bb.readUint32(this.bb_pos)}mutate_id(s){return this.bb.writeUint32(this.bb_pos+0,s),!0}geometryClass(){return this.bb.readInt8(this.bb_pos+4)}mutate_geometry_class(s){return this.bb.writeInt8(this.bb_pos+4,s),!0}static sizeOf(){return 8}static createGeometryRepresentation(s,t,e){return s.prep(4,8),s.pad(3),s.writeInt8(e),s.writeInt32(t),s.offset()}},Od=class{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(s,t){return this.bb_pos=s,this.bb=t,this}id(){return this.bb.readUint32(this.bb_pos)}mutate_id(s){return this.bb.writeUint32(this.bb_pos+0,s),!0}transform(){return this.bb.readUint32(this.bb_pos+4)}mutate_transform(s){return this.bb.writeUint32(this.bb_pos+4,s),!0}static sizeOf(){return 8}static createGeometrySample(s,t,e){return s.prep(4,8),s.writeInt32(e),s.writeInt32(t),s.offset()}},aS=class{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(s,t){return this.bb_pos=s,this.bb=t,this}start(s){return(s||new os).__init(this.bb_pos,this.bb)}end(s){return(s||new os).__init(this.bb_pos+12,this.bb)}height(){return this.bb.readFloat32(this.bb_pos+24)}mutate_height(s){return this.bb.writeFloat32(this.bb_pos+24,s),!0}width(){return this.bb.readFloat32(this.bb_pos+28)}mutate_width(s){return this.bb.writeFloat32(this.bb_pos+28,s),!0}offset(){return this.bb.readFloat32(this.bb_pos+32)}mutate_offset(s){return this.bb.writeFloat32(this.bb_pos+32,s),!0}static sizeOf(){return 36}static createGeometryWall(s,t,e,i,n,r,o,a,l,h){return s.prep(4,36),s.writeFloat32(h),s.writeFloat32(l),s.writeFloat32(a),s.prep(4,12),s.writeFloat32(o),s.writeFloat32(r),s.writeFloat32(n),s.prep(4,12),s.writeFloat32(i),s.writeFloat32(e),s.writeFloat32(t),s.offset()}},rr=class{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(s,t){return this.bb_pos=s,this.bb=t,this}position(s){return(s||new Dw).__init(this.bb_pos,this.bb)}xDirection(s){return(s||new os).__init(this.bb_pos+24,this.bb)}yDirection(s){return(s||new os).__init(this.bb_pos+36,this.bb)}static sizeOf(){return 48}static createTransform(s,t,e,i,n,r,o,a,l,h){return s.prep(8,48),s.prep(4,12),s.writeFloat32(h),s.writeFloat32(l),s.writeFloat32(a),s.prep(4,12),s.writeFloat32(o),s.writeFloat32(r),s.writeFloat32(n),s.prep(8,24),s.writeFloat64(i),s.writeFloat64(e),s.writeFloat64(t),s.offset()}},ke=class Ys{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsGeometries(t,e){return(e||new Ys).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometries(t,e){return t.setPosition(t.position()+4),(e||new Ys).__init(t.readInt32(t.position())+t.position(),t)}samples(t,e){const i=this.bb.__offset(this.bb_pos,4);return i?(e||new Od).__init(this.bb.__vector(this.bb_pos+i)+8*t,this.bb):null}samplesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}sampleIds(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}sampleIdsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}sampleIdsArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}representations(t,e){const i=this.bb.__offset(this.bb_pos,8);return i?(e||new Sd).__init(this.bb.__vector(this.bb_pos+i)+8*t,this.bb):null}representationsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}representationIds(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}representationIdsLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}representationIdsArray(){const t=this.bb.__offset(this.bb_pos,10);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}transforms(t,e){const i=this.bb.__offset(this.bb_pos,12);return i?(e||new rr).__init(this.bb.__vector(this.bb_pos+i)+48*t,this.bb):null}transformsLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}transformIds(t){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}transformIdsLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}transformIdsArray(){const t=this.bb.__offset(this.bb_pos,14);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}representationsSamples(t){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}representationsSamplesLength(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}representationsSamplesArray(){const t=this.bb.__offset(this.bb_pos,16);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}lines(t,e){const i=this.bb.__offset(this.bb_pos,18);return i?(e||new oi).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}linesLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}walls(t,e){const i=this.bb.__offset(this.bb_pos,20);return i?(e||new aS).__init(this.bb.__vector(this.bb_pos+i)+36*t,this.bb):null}wallsLength(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__vector_len(this.bb_pos+t):0}static startGeometries(t){t.startObject(9)}static addSamples(t,e){t.addFieldOffset(0,e,0)}static startSamplesVector(t,e){t.startVector(8,e,4)}static addSampleIds(t,e){t.addFieldOffset(1,e,0)}static createSampleIdsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addInt32(e[i]);return t.endVector()}static startSampleIdsVector(t,e){t.startVector(4,e,4)}static addRepresentations(t,e){t.addFieldOffset(2,e,0)}static startRepresentationsVector(t,e){t.startVector(8,e,4)}static addRepresentationIds(t,e){t.addFieldOffset(3,e,0)}static createRepresentationIdsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addInt32(e[i]);return t.endVector()}static startRepresentationIdsVector(t,e){t.startVector(4,e,4)}static addTransforms(t,e){t.addFieldOffset(4,e,0)}static startTransformsVector(t,e){t.startVector(48,e,8)}static addTransformIds(t,e){t.addFieldOffset(5,e,0)}static createTransformIdsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addInt32(e[i]);return t.endVector()}static startTransformIdsVector(t,e){t.startVector(4,e,4)}static addRepresentationsSamples(t,e){t.addFieldOffset(6,e,0)}static createRepresentationsSamplesVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addInt32(e[i]);return t.endVector()}static startRepresentationsSamplesVector(t,e){t.startVector(4,e,4)}static addLines(t,e){t.addFieldOffset(7,e,0)}static createLinesVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startLinesVector(t,e){t.startVector(4,e,4)}static addWalls(t,e){t.addFieldOffset(8,e,0)}static startWallsVector(t,e){t.startVector(36,e,4)}static endGeometries(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,8),t.requiredField(e,12),t.requiredField(e,18),e}static createGeometries(t,e,i,n,r,o,a,l,h,c){return Ys.startGeometries(t),Ys.addSamples(t,e),Ys.addSampleIds(t,i),Ys.addRepresentations(t,n),Ys.addRepresentationIds(t,r),Ys.addTransforms(t,o),Ys.addTransformIds(t,a),Ys.addRepresentationsSamples(t,l),Ys.addLines(t,h),Ys.addWalls(t,c),Ys.endGeometries(t)}};var zn=(s=>(s[s.NONE=0]="NONE",s[s.LINES=1]="LINES",s[s.ELLIPSE_ARC=2]="ELLIPSE_ARC",s[s.CLOTHOID=3]="CLOTHOID",s[s.PARABOLA=4]="PARABOLA",s[s.WALLS=5]="WALLS",s))(zn||{});let kw=class{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(s,t){return this.bb_pos=s,this.bb=t,this}r(){return this.bb.readUint8(this.bb_pos)}mutate_r(s){return this.bb.writeUint8(this.bb_pos+0,s),!0}g(){return this.bb.readUint8(this.bb_pos+1)}mutate_g(s){return this.bb.writeUint8(this.bb_pos+1,s),!0}b(){return this.bb.readUint8(this.bb_pos+2)}mutate_b(s){return this.bb.writeUint8(this.bb_pos+2,s),!0}a(){return this.bb.readUint8(this.bb_pos+3)}mutate_a(s){return this.bb.writeUint8(this.bb_pos+3,s),!0}renderedFaces(){return this.bb.readInt8(this.bb_pos+4)}mutate_rendered_faces(s){return this.bb.writeInt8(this.bb_pos+4,s),!0}stroke(){return this.bb.readInt8(this.bb_pos+5)}mutate_stroke(s){return this.bb.writeInt8(this.bb_pos+5,s),!0}static sizeOf(){return 6}static createMaterial(s,t,e,i,n,r,o){return s.prep(1,6),s.writeInt8(o),s.writeInt8(r),s.writeInt8(n),s.writeInt8(i),s.writeInt8(e),s.writeInt8(t),s.offset()}},kp=class{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(s,t){return this.bb_pos=s,this.bb=t,this}id(){return this.bb.readUint32(this.bb_pos)}mutate_id(s){return this.bb.writeUint32(this.bb_pos+0,s),!0}bbox(s){return(s||new Mw).__init(this.bb_pos+4,this.bb)}representationClass(){return this.bb.readInt8(this.bb_pos+28)}mutate_representation_class(s){return this.bb.writeInt8(this.bb_pos+28,s),!0}static sizeOf(){return 32}static createRepresentation(s,t,e,i,n,r,o,a,l){return s.prep(4,32),s.pad(3),s.writeInt8(l),s.prep(4,24),s.prep(4,12),s.writeFloat32(a),s.writeFloat32(o),s.writeFloat32(r),s.prep(4,12),s.writeFloat32(n),s.writeFloat32(i),s.writeFloat32(e),s.writeInt32(t),s.offset()}},zp=class{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(s,t){return this.bb_pos=s,this.bb=t,this}item(){return this.bb.readUint32(this.bb_pos)}mutate_item(s){return this.bb.writeUint32(this.bb_pos+0,s),!0}material(){return this.bb.readUint32(this.bb_pos+4)}mutate_material(s){return this.bb.writeUint32(this.bb_pos+4,s),!0}representation(){return this.bb.readUint32(this.bb_pos+8)}mutate_representation(s){return this.bb.writeUint32(this.bb_pos+8,s),!0}localTransform(){return this.bb.readUint32(this.bb_pos+12)}mutate_local_transform(s){return this.bb.writeUint32(this.bb_pos+12,s),!0}static sizeOf(){return 16}static createSample(s,t,e,i,n){return s.prep(4,16),s.writeInt32(n),s.writeInt32(i),s.writeInt32(e),s.writeInt32(t),s.offset()}},_l=class To{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsShellHole(t,e){return(e||new To).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsShellHole(t,e){return t.setPosition(t.position()+4),(e||new To).__init(t.readInt32(t.position())+t.position(),t)}indices(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint16(this.bb.__vector(this.bb_pos+e)+2*t):0}indicesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}indicesArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}profileId(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint16(this.bb_pos+t):0}mutate_profile_id(t){const e=this.bb.__offset(this.bb_pos,6);return e!==0&&(this.bb.writeUint16(this.bb_pos+e,t),!0)}static startShellHole(t){t.startObject(2)}static addIndices(t,e){t.addFieldOffset(0,e,0)}static createIndicesVector(t,e){t.startVector(2,e.length,2);for(let i=e.length-1;i>=0;i--)t.addInt16(e[i]);return t.endVector()}static startIndicesVector(t,e){t.startVector(2,e,2)}static addProfileId(t,e){t.addFieldInt16(1,e,0)}static endShellHole(t){const e=t.endObject();return t.requiredField(e,4),e}static createShellHole(t,e,i){return To.startShellHole(t),To.addIndices(t,e),To.addProfileId(t,i),To.endShellHole(t)}},Jo=class qa{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsShellProfile(t,e){return(e||new qa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsShellProfile(t,e){return t.setPosition(t.position()+4),(e||new qa).__init(t.readInt32(t.position())+t.position(),t)}indices(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint16(this.bb.__vector(this.bb_pos+e)+2*t):0}indicesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}indicesArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startShellProfile(t){t.startObject(1)}static addIndices(t,e){t.addFieldOffset(0,e,0)}static createIndicesVector(t,e){t.startVector(2,e.length,2);for(let i=e.length-1;i>=0;i--)t.addInt16(e[i]);return t.endVector()}static startIndicesVector(t,e){t.startVector(2,e,2)}static endShellProfile(t){const e=t.endObject();return t.requiredField(e,4),e}static createShellProfile(t,e){return qa.startShellProfile(t),qa.addIndices(t,e),qa.endShellProfile(t)}};var ys=(s=>(s[s.NONE=0]="NONE",s[s.BIG=1]="BIG",s))(ys||{});let tn=class Wi{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsShell(t,e){return(e||new Wi).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsShell(t,e){return t.setPosition(t.position()+4),(e||new Wi).__init(t.readInt32(t.position())+t.position(),t)}profiles(t,e){const i=this.bb.__offset(this.bb_pos,4);return i?(e||new Jo).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}profilesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}holes(t,e){const i=this.bb.__offset(this.bb_pos,6);return i?(e||new _l).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}holesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}points(t,e){const i=this.bb.__offset(this.bb_pos,8);return i?(e||new os).__init(this.bb.__vector(this.bb_pos+i)+12*t,this.bb):null}pointsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}bigProfiles(t,e){const i=this.bb.__offset(this.bb_pos,10);return i?(e||new Ko).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}bigProfilesLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}bigHoles(t,e){const i=this.bb.__offset(this.bb_pos,12);return i?(e||new gl).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}bigHolesLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}type(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt8(this.bb_pos+t):ys.NONE}mutate_type(t){const e=this.bb.__offset(this.bb_pos,14);return e!==0&&(this.bb.writeInt8(this.bb_pos+e,t),!0)}static startShell(t){t.startObject(6)}static addProfiles(t,e){t.addFieldOffset(0,e,0)}static createProfilesVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startProfilesVector(t,e){t.startVector(4,e,4)}static addHoles(t,e){t.addFieldOffset(1,e,0)}static createHolesVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startHolesVector(t,e){t.startVector(4,e,4)}static addPoints(t,e){t.addFieldOffset(2,e,0)}static startPointsVector(t,e){t.startVector(12,e,4)}static addBigProfiles(t,e){t.addFieldOffset(3,e,0)}static createBigProfilesVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startBigProfilesVector(t,e){t.startVector(4,e,4)}static addBigHoles(t,e){t.addFieldOffset(4,e,0)}static createBigHolesVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startBigHolesVector(t,e){t.startVector(4,e,4)}static addType(t,e){t.addFieldInt8(5,e,ys.NONE)}static endShell(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),t.requiredField(e,8),t.requiredField(e,10),t.requiredField(e,12),e}static createShell(t,e,i,n,r,o,a){return Wi.startShell(t),Wi.addProfiles(t,e),Wi.addHoles(t,i),Wi.addPoints(t,n),Wi.addBigProfiles(t,r),Wi.addBigHoles(t,o),Wi.addType(t,a),Wi.endShell(t)}},$e=class Ws{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMeshes(t,e){return(e||new Ws).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMeshes(t,e){return t.setPosition(t.position()+4),(e||new Ws).__init(t.readInt32(t.position())+t.position(),t)}coordinates(t){const e=this.bb.__offset(this.bb_pos,4);return e?(t||new rr).__init(this.bb_pos+e,this.bb):null}meshesItems(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}meshesItemsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}meshesItemsArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}samples(t,e){const i=this.bb.__offset(this.bb_pos,8);return i?(e||new zp).__init(this.bb.__vector(this.bb_pos+i)+16*t,this.bb):null}samplesLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}representations(t,e){const i=this.bb.__offset(this.bb_pos,10);return i?(e||new kp).__init(this.bb.__vector(this.bb_pos+i)+32*t,this.bb):null}representationsLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}materials(t,e){const i=this.bb.__offset(this.bb_pos,12);return i?(e||new kw).__init(this.bb.__vector(this.bb_pos+i)+6*t,this.bb):null}materialsLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}circleExtrusions(t,e){const i=this.bb.__offset(this.bb_pos,14);return i?(e||new Ji).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}circleExtrusionsLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}shells(t,e){const i=this.bb.__offset(this.bb_pos,16);return i?(e||new tn).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}shellsLength(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}localTransforms(t,e){const i=this.bb.__offset(this.bb_pos,18);return i?(e||new rr).__init(this.bb.__vector(this.bb_pos+i)+48*t,this.bb):null}localTransformsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}globalTransforms(t,e){const i=this.bb.__offset(this.bb_pos,20);return i?(e||new rr).__init(this.bb.__vector(this.bb_pos+i)+48*t,this.bb):null}globalTransformsLength(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__vector_len(this.bb_pos+t):0}static startMeshes(t){t.startObject(9)}static addCoordinates(t,e){t.addFieldStruct(0,e,0)}static addMeshesItems(t,e){t.addFieldOffset(1,e,0)}static createMeshesItemsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addInt32(e[i]);return t.endVector()}static startMeshesItemsVector(t,e){t.startVector(4,e,4)}static addSamples(t,e){t.addFieldOffset(2,e,0)}static startSamplesVector(t,e){t.startVector(16,e,4)}static addRepresentations(t,e){t.addFieldOffset(3,e,0)}static startRepresentationsVector(t,e){t.startVector(32,e,4)}static addMaterials(t,e){t.addFieldOffset(4,e,0)}static startMaterialsVector(t,e){t.startVector(6,e,1)}static addCircleExtrusions(t,e){t.addFieldOffset(5,e,0)}static createCircleExtrusionsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startCircleExtrusionsVector(t,e){t.startVector(4,e,4)}static addShells(t,e){t.addFieldOffset(6,e,0)}static createShellsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startShellsVector(t,e){t.startVector(4,e,4)}static addLocalTransforms(t,e){t.addFieldOffset(7,e,0)}static startLocalTransformsVector(t,e){t.startVector(48,e,8)}static addGlobalTransforms(t,e){t.addFieldOffset(8,e,0)}static startGlobalTransformsVector(t,e){t.startVector(48,e,8)}static endMeshes(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),t.requiredField(e,8),t.requiredField(e,10),t.requiredField(e,12),t.requiredField(e,14),t.requiredField(e,16),t.requiredField(e,18),t.requiredField(e,20),e}static createMeshes(t,e,i,n,r,o,a,l,h,c){return Ws.startMeshes(t),Ws.addCoordinates(t,e),Ws.addMeshesItems(t,i),Ws.addSamples(t,n),Ws.addRepresentations(t,r),Ws.addMaterials(t,o),Ws.addCircleExtrusions(t,a),Ws.addShells(t,l),Ws.addLocalTransforms(t,h),Ws.addGlobalTransforms(t,c),Ws.endMeshes(t)}},ng=class Za{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsRelation(t,e){return(e||new Za).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRelation(t,e){return t.setPosition(t.position()+4),(e||new Za).__init(t.readInt32(t.position())+t.position(),t)}data(t,e){const i=this.bb.__offset(this.bb_pos,4);return i?this.bb.__string(this.bb.__vector(this.bb_pos+i)+4*t,e):null}dataLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}static startRelation(t){t.startObject(1)}static addData(t,e){t.addFieldOffset(0,e,0)}static createDataVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startDataVector(t,e){t.startVector(4,e,4)}static endRelation(t){const e=t.endObject();return t.requiredField(e,4),e}static createRelation(t,e){return Za.startRelation(t),Za.addData(t,e),Za.endRelation(t)}},Is=class Xn{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSpatialStructure(t,e){return(e||new Xn).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSpatialStructure(t,e){return t.setPosition(t.position()+4),(e||new Xn).__init(t.readInt32(t.position())+t.position(),t)}localId(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb_pos+t):null}mutate_local_id(t){const e=this.bb.__offset(this.bb_pos,4);return e!==0&&(this.bb.writeUint32(this.bb_pos+e,t),!0)}category(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}children(t,e){const i=this.bb.__offset(this.bb_pos,8);return i?(e||new Xn).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}childrenLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSpatialStructure(t){t.startObject(3)}static addLocalId(t,e){t.addFieldInt32(0,e,null)}static addCategory(t,e){t.addFieldOffset(1,e,0)}static addChildren(t,e){t.addFieldOffset(2,e,0)}static createChildrenVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startChildrenVector(t,e){t.startVector(4,e,4)}static endSpatialStructure(t){return t.endObject()}static createSpatialStructure(t,e,i,n){return Xn.startSpatialStructure(t),e!==null&&Xn.addLocalId(t,e),Xn.addCategory(t,i),Xn.addChildren(t,n),Xn.endSpatialStructure(t)}},re=class rg{constructor(){S(this,"bb",null),S(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsModel(t,e){return(e||new rg).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsModel(t,e){return t.setPosition(t.position()+4),(e||new rg).__init(t.readInt32(t.position())+t.position(),t)}static bufferHasIdentifier(t){return t.__has_identifier("0001")}metadata(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}guids(t,e){const i=this.bb.__offset(this.bb_pos,6);return i?this.bb.__string(this.bb.__vector(this.bb_pos+i)+4*t,e):null}guidsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}guidsItems(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}guidsItemsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}guidsItemsArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}maxLocalId(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readUint32(this.bb_pos+t):0}mutate_max_local_id(t){const e=this.bb.__offset(this.bb_pos,10);return e!==0&&(this.bb.writeUint32(this.bb_pos+e,t),!0)}localIds(t){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}localIdsLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}localIdsArray(){const t=this.bb.__offset(this.bb_pos,12);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}categories(t,e){const i=this.bb.__offset(this.bb_pos,14);return i?this.bb.__string(this.bb.__vector(this.bb_pos+i)+4*t,e):null}categoriesLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}meshes(t){const e=this.bb.__offset(this.bb_pos,16);return e?(t||new $e).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}attributes(t,e){const i=this.bb.__offset(this.bb_pos,18);return i?(e||new ig).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}attributesLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}relations(t,e){const i=this.bb.__offset(this.bb_pos,20);return i?(e||new ng).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}relationsLength(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__vector_len(this.bb_pos+t):0}relationsItems(t){const e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+4*t):0}relationsItemsLength(){const t=this.bb.__offset(this.bb_pos,22);return t?this.bb.__vector_len(this.bb_pos+t):0}relationsItemsArray(){const t=this.bb.__offset(this.bb_pos,22);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}guid(t){const e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null}spatialStructure(t){const e=this.bb.__offset(this.bb_pos,26);return e?(t||new Is).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}alignments(t,e){const i=this.bb.__offset(this.bb_pos,28);return i?(e||new Rh).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+4*t),this.bb):null}alignmentsLength(){const t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__vector_len(this.bb_pos+t):0}geometries(t){const e=this.bb.__offset(this.bb_pos,30);return e?(t||new ke).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}uniqueAttributes(t,e){const i=this.bb.__offset(this.bb_pos,32);return i?this.bb.__string(this.bb.__vector(this.bb_pos+i)+4*t,e):null}uniqueAttributesLength(){const t=this.bb.__offset(this.bb_pos,32);return t?this.bb.__vector_len(this.bb_pos+t):0}relationNames(t,e){const i=this.bb.__offset(this.bb_pos,34);return i?this.bb.__string(this.bb.__vector(this.bb_pos+i)+4*t,e):null}relationNamesLength(){const t=this.bb.__offset(this.bb_pos,34);return t?this.bb.__vector_len(this.bb_pos+t):0}static startModel(t){t.startObject(16)}static addMetadata(t,e){t.addFieldOffset(0,e,0)}static addGuids(t,e){t.addFieldOffset(1,e,0)}static createGuidsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startGuidsVector(t,e){t.startVector(4,e,4)}static addGuidsItems(t,e){t.addFieldOffset(2,e,0)}static createGuidsItemsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addInt32(e[i]);return t.endVector()}static startGuidsItemsVector(t,e){t.startVector(4,e,4)}static addMaxLocalId(t,e){t.addFieldInt32(3,e,0)}static addLocalIds(t,e){t.addFieldOffset(4,e,0)}static createLocalIdsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addInt32(e[i]);return t.endVector()}static startLocalIdsVector(t,e){t.startVector(4,e,4)}static addCategories(t,e){t.addFieldOffset(5,e,0)}static createCategoriesVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startCategoriesVector(t,e){t.startVector(4,e,4)}static addMeshes(t,e){t.addFieldOffset(6,e,0)}static addAttributes(t,e){t.addFieldOffset(7,e,0)}static createAttributesVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startAttributesVector(t,e){t.startVector(4,e,4)}static addRelations(t,e){t.addFieldOffset(8,e,0)}static createRelationsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startRelationsVector(t,e){t.startVector(4,e,4)}static addRelationsItems(t,e){t.addFieldOffset(9,e,0)}static createRelationsItemsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addInt32(e[i]);return t.endVector()}static startRelationsItemsVector(t,e){t.startVector(4,e,4)}static addGuid(t,e){t.addFieldOffset(10,e,0)}static addSpatialStructure(t,e){t.addFieldOffset(11,e,0)}static addAlignments(t,e){t.addFieldOffset(12,e,0)}static createAlignmentsVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startAlignmentsVector(t,e){t.startVector(4,e,4)}static addGeometries(t,e){t.addFieldOffset(13,e,0)}static addUniqueAttributes(t,e){t.addFieldOffset(14,e,0)}static createUniqueAttributesVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startUniqueAttributesVector(t,e){t.startVector(4,e,4)}static addRelationNames(t,e){t.addFieldOffset(15,e,0)}static createRelationNamesVector(t,e){t.startVector(4,e.length,4);for(let i=e.length-1;i>=0;i--)t.addOffset(e[i]);return t.endVector()}static startRelationNamesVector(t,e){t.startVector(4,e,4)}static endModel(t){const e=t.endObject();return t.requiredField(e,6),t.requiredField(e,8),t.requiredField(e,12),t.requiredField(e,14),t.requiredField(e,16),t.requiredField(e,24),e}static finishModelBuffer(t,e){t.finish(e,"0001")}static finishSizePrefixedModelBuffer(t,e){t.finish(e,"0001",!0)}};var jc=(s=>(s[s.ONE=0]="ONE",s[s.TWO=1]="TWO",s))(jc||{}),to=(s=>(s[s.NONE=0]="NONE",s[s.SHELL=1]="SHELL",s[s.CIRCLE_EXTRUSION=2]="CIRCLE_EXTRUSION",s))(to||{}),lS=(s=>(s[s.DEFAULT=0]="DEFAULT",s))(lS||{});const bl=65536;var zs=(s=>(s[s.LINE=0]="LINE",s[s.SHELL=1]="SHELL",s))(zs||{}),De=(s=>(s[s.UPDATE=0]="UPDATE",s[s.CREATE=1]="CREATE",s[s.DELETE=2]="DELETE",s[s.FINISH=3]="FINISH",s))(De||{}),Yt=(s=>(s[s.GEOMETRY=0]="GEOMETRY",s[s.WIRES=1]="WIRES",s[s.INVISIBLE=2]="INVISIBLE",s))(Yt||{}),an=(s=>(s[s.CREATE_MODEL=0]="CREATE_MODEL",s[s.DELETE_MODEL=1]="DELETE_MODEL",s[s.EXECUTE=2]="EXECUTE",s[s.RAYCAST=3]="RAYCAST",s[s.FETCH_BOXES=4]="FETCH_BOXES",s[s.REFRESH_VIEW=5]="REFRESH_VIEW",s[s.RECOMPUTE_MESHES=6]="RECOMPUTE_MESHES",s[s.CREATE_MATERIAL=7]="CREATE_MATERIAL",s[s.THROW_ERROR=8]="THROW_ERROR",s))(an||{}),og=(s=>(s[s.VISIBLE=0]="VISIBLE",s))(og||{}),Qs=(s=>(s[s.POINT=0]="POINT",s[s.LINE=1]="LINE",s[s.FACE=2]="FACE",s))(Qs||{});let yc=class{static containedInParallelPlanes(s,t){let e=!0;for(const i of s){const n=i.distanceToPoint(t);e=e&&n>=0}return e}static collides(s,t,e){for(const i of t)if(this.getPointDistance(i,e,s)<0)return!1;return!0}static getPointDistance(s,t,e){const i=s.normal;for(const n of this.dimensions){const r=i[n]>=0!==t;this.tempPoint[n]=r?e.max[n]:e.min[n]}return s.distanceToPoint(this.tempPoint)}};S(yc,"tempPoint",new F),S(yc,"dimensions",["x","y","z"]);let Ho=class{static transform(s,t,e=new cr){for(let i=0;i<e.planes.length;i++){const n=e.planes[i],r=s.planes[i];n.copy(r),n.applyMatrix4(t)}return e}static isIncluded(s,t){return yc.collides(s,t,!0)}static collides(s,t){return yc.collides(s,t,!1)}};function hS(s,t,e=2){const i=t&&t.length,n=i?t[0]*e:s.length;let r=Pb(s,0,n,e,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,h;if(i&&(r=function(c,u,p,d){const _=[];for(let m=0,g=u.length;m<g;m++){const f=Pb(c,u[m]*d,m<g-1?u[m+1]*d:c.length,d,!1);f===f.next&&(f.steiner=!0),_.push(_S(f))}_.sort(fS);for(let m=0;m<_.length;m++)p=mS(_[m],p);return p}(s,t,r,e)),s.length>80*e){a=1/0,l=1/0;let c=-1/0,u=-1/0;for(let p=e;p<n;p+=e){const d=s[p],_=s[p+1];d<a&&(a=d),_<l&&(l=_),d>c&&(c=d),_>u&&(u=_)}h=Math.max(c-a,u-l),h=h!==0?32767/h:0}return vc(r,o,e,a,l,h,0),o}function Pb(s,t,e,i,n){let r;if(n===function(o,a,l,h){let c=0;for(let u=a,p=l-h;u<l;u+=h)c+=(o[p]-o[u])*(o[u+1]+o[p+1]),p=u;return c}(s,t,e,i)>0)for(let o=t;o<e;o+=i)r=Fb(o/i|0,s[o],s[o+1],r);else for(let o=e-i;o>=t;o-=i)r=Fb(o/i|0,s[o],s[o+1],r);return r&&yl(r,r.next)&&(Ec(r),r=r.next),r}function ta(s,t){if(!s)return s;t||(t=s);let e,i=s;do if(e=!1,i.steiner||!yl(i,i.next)&&Pe(i.prev,i,i.next)!==0)i=i.next;else{if(Ec(i),i=t=i.prev,i===i.next)break;e=!0}while(e||i!==t);return t}function vc(s,t,e,i,n,r,o){if(!s)return;!o&&r&&function(l,h,c,u){let p=l;do p.z===0&&(p.z=ag(p.x,p.y,h,c,u)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next;while(p!==l);p.prevZ.nextZ=null,p.prevZ=null,function(d){let _,m=1;do{let g,f=d;d=null;let b=null;for(_=0;f;){_++;let y=f,E=0;for(let I=0;I<m&&(E++,y=y.nextZ,y);I++);let C=m;for(;E>0||C>0&&y;)E!==0&&(C===0||!y||f.z<=y.z)?(g=f,f=f.nextZ,E--):(g=y,y=y.nextZ,C--),b?b.nextZ=g:d=g,g.prevZ=b,b=g;f=y}b.nextZ=null,m*=2}while(_>1)}(p)}(s,i,n,r);let a=s;for(;s.prev!==s.next;){const l=s.prev,h=s.next;if(r?uS(s,i,n,r):cS(s))t.push(l.i,s.i,h.i),Ec(s),s=h.next,a=h.next;else if((s=h)===a){o?o===1?vc(s=dS(ta(s),t),t,e,i,n,r,2):o===2&&pS(s,t,e,i,n,r):vc(ta(s),t,e,i,n,r,1);break}}}function cS(s){const t=s.prev,e=s,i=s.next;if(Pe(t,e,i)>=0)return!1;const n=t.x,r=e.x,o=i.x,a=t.y,l=e.y,h=i.y,c=Math.min(n,r,o),u=Math.min(a,l,h),p=Math.max(n,r,o),d=Math.max(a,l,h);let _=i.next;for(;_!==t;){if(_.x>=c&&_.x<=p&&_.y>=u&&_.y<=d&&Lh(n,a,r,l,o,h,_.x,_.y)&&Pe(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function uS(s,t,e,i){const n=s.prev,r=s,o=s.next;if(Pe(n,r,o)>=0)return!1;const a=n.x,l=r.x,h=o.x,c=n.y,u=r.y,p=o.y,d=Math.min(a,l,h),_=Math.min(c,u,p),m=Math.max(a,l,h),g=Math.max(c,u,p),f=ag(d,_,t,e,i),b=ag(m,g,t,e,i);let y=s.prevZ,E=s.nextZ;for(;y&&y.z>=f&&E&&E.z<=b;){if(y.x>=d&&y.x<=m&&y.y>=_&&y.y<=g&&y!==n&&y!==o&&Lh(a,c,l,u,h,p,y.x,y.y)&&Pe(y.prev,y,y.next)>=0||(y=y.prevZ,E.x>=d&&E.x<=m&&E.y>=_&&E.y<=g&&E!==n&&E!==o&&Lh(a,c,l,u,h,p,E.x,E.y)&&Pe(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;y&&y.z>=f;){if(y.x>=d&&y.x<=m&&y.y>=_&&y.y<=g&&y!==n&&y!==o&&Lh(a,c,l,u,h,p,y.x,y.y)&&Pe(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;E&&E.z<=b;){if(E.x>=d&&E.x<=m&&E.y>=_&&E.y<=g&&E!==n&&E!==o&&Lh(a,c,l,u,h,p,E.x,E.y)&&Pe(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function dS(s,t){let e=s;do{const i=e.prev,n=e.next.next;!yl(i,n)&&Uw(i,e,e.next,n)&&wc(i,n)&&wc(n,i)&&(t.push(i.i,e.i,n.i),Ec(e),Ec(e.next),e=s=n),e=e.next}while(e!==s);return ta(e)}function pS(s,t,e,i,n,r){let o=s;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&bS(o,a)){let l=Bw(o,a);return o=ta(o,o.next),l=ta(l,l.next),vc(o,t,e,i,n,r,0),void vc(l,t,e,i,n,r,0)}a=a.next}o=o.next}while(o!==s)}function fS(s,t){let e=s.x-t.x;return e===0&&(e=s.y-t.y,e===0)&&(e=(s.next.y-s.y)/(s.next.x-s.x)-(t.next.y-t.y)/(t.next.x-t.x)),e}function mS(s,t){const e=function(n,r){let o=r;const a=n.x,l=n.y;let h,c=-1/0;if(yl(n,o))return o;do{if(yl(n,o.next))return o.next;if(l<=o.y&&l>=o.next.y&&o.next.y!==o.y){const m=o.x+(l-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(m<=a&&m>c&&(c=m,h=o.x<o.next.x?o:o.next,m===a))return h}o=o.next}while(o!==r);if(!h)return null;const u=h,p=h.x,d=h.y;let _=1/0;o=h;do{if(a>=o.x&&o.x>=p&&a!==o.x&&zw(l<d?a:c,l,p,d,l<d?c:a,l,o.x,o.y)){const m=Math.abs(l-o.y)/(a-o.x);wc(o,n)&&(m<_||m===_&&(o.x>h.x||o.x===h.x&&gS(h,o)))&&(h=o,_=m)}o=o.next}while(o!==u);return h}(s,t);if(!e)return t;const i=Bw(e,s);return ta(i,i.next),ta(e,e.next)}function gS(s,t){return Pe(s.prev,s,t.prev)<0&&Pe(t.next,s,s.next)<0}function ag(s,t,e,i,n){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-e)*n|0)|s<<8))|s<<4))|s<<2))|s<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function _S(s){let t=s,e=s;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==s);return e}function zw(s,t,e,i,n,r,o,a){return(n-o)*(t-a)>=(s-o)*(r-a)&&(s-o)*(i-a)>=(e-o)*(t-a)&&(e-o)*(r-a)>=(n-o)*(i-a)}function Lh(s,t,e,i,n,r,o,a){return!(s===o&&t===a)&&zw(s,t,e,i,n,r,o,a)}function bS(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!function(e,i){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==i.i&&n.next.i!==i.i&&Uw(n,n.next,e,i))return!0;n=n.next}while(n!==e);return!1}(s,t)&&(wc(s,t)&&wc(t,s)&&function(e,i){let n=e,r=!1;const o=(e.x+i.x)/2,a=(e.y+i.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&o<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r}(s,t)&&(Pe(s.prev,s,t.prev)||Pe(s,t.prev,t))||yl(s,t)&&Pe(s.prev,s,s.next)>0&&Pe(t.prev,t,t.next)>0)}function Pe(s,t,e){return(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y)}function yl(s,t){return s.x===t.x&&s.y===t.y}function Uw(s,t,e,i){const n=uu(Pe(s,t,e)),r=uu(Pe(s,t,i)),o=uu(Pe(e,i,s)),a=uu(Pe(e,i,t));return n!==r&&o!==a||!(n!==0||!cu(s,e,t))||!(r!==0||!cu(s,i,t))||!(o!==0||!cu(e,s,i))||!(a!==0||!cu(e,t,i))}function cu(s,t,e){return t.x<=Math.max(s.x,e.x)&&t.x>=Math.min(s.x,e.x)&&t.y<=Math.max(s.y,e.y)&&t.y>=Math.min(s.y,e.y)}function uu(s){return s>0?1:s<0?-1:0}function wc(s,t){return Pe(s.prev,s,s.next)<0?Pe(s,t,s.next)>=0&&Pe(s,s.prev,t)>=0:Pe(s,t,s.prev)<0||Pe(s,s.next,t)<0}function Bw(s,t){const e=lg(s.i,s.x,s.y),i=lg(t.i,t.x,t.y),n=s.next,r=t.prev;return s.next=t,t.prev=s,e.next=n,n.prev=e,i.next=e,e.prev=i,r.next=i,i.prev=r,i}function Fb(s,t,e,i){const n=lg(s,t,e);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Ec(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function lg(s,t,e){return{i:s,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}let yS=class{constructor(){S(this,"int"),S(this,"float"),S(this,"buffer"),S(this,"s1",4),S(this,"s2",8);const{intBuffer:s,floatBuffer:t,buffer:e}=this.newBuffers();this.int=s,this.float=t,this.buffer=e}newBuffers(){const s=new Int32Array(1),t=s.buffer;return{intBuffer:s,floatBuffer:new Float32Array(t),buffer:new Uint8Array(t)}}},hg=class{static check(s){const t=Number.isInteger(s),e=s<this._max,i=s>this._min;return t&&e&&i}};S(hg,"_max",2147483647),S(hg,"_min",-2147483648);const Vw=class $w{constructor(){S(this,"_core",new yS),S(this,"_handlers"),S(this,"_result",-1),S(this,"handleObject",t=>{const e=Object.keys(t);for(const i of e)t.hasOwnProperty(i)&&this.compute(t[i])}),S(this,"handleString",t=>{const e=t.length;for(let i=0;i<e;++i){const n=t.codePointAt(i);this._core.int[0]=n,this.update()}}),S(this,"handleBoolean",t=>{this._core.int[0]=t?1:0,this.update()}),S(this,"handleNumber",t=>{(hg.check(t)?this._core.int:this._core.float)[0]=t,this.update()}),this._handlers=this.newHandlers()}get value(){return~this._result}fromMaterialData(t){const{modelId:e,objectClass:i,currentLod:n,templateId:r,...o}=t;this.reset(),this.compute(e),this.compute(i),this.compute(o),this.compute(n),this.compute(r!==void 0)}generate(t){this.reset();for(const e of t)this.compute(e);return this.value}compute(t){return this.getHandler(t)(t),this}reset(){return this._result=-1,this}getHandler(t){const e=typeof t,i=this._handlers[e];if(!i)throw new Error("Fragments: Unsupported input type");return i}newHandlers(){return{number:this.handleNumber,boolean:this.handleBoolean,string:this.handleString,object:this.handleObject}}update(){for(let t=0;t<this._core.s1;++t){this._result^=this._core.buffer[t];for(let e=0;e<this._core.s2;++e)1&this._result?this._result=this._result>>1^$w._polynomial:this._result>>=1}}};S(Vw,"_polynomial",2197175160);let O_=Vw;const Pd=class Fd{constructor(t,e){S(this,"_first"),this._first=this.newData(t,e)}static getComplementary(t,e){let i=0;const n=t.position.length;i=this.makeBufferComplementary(n,t,i,e),i!==1/0&&e(i,1/0)}static get(t,e,i,n){const{filtered:r,position:o,size:a}=this.getData(t,i);return this.setAllBufferData(r,e,o,a,n),{position:o,size:a}}fullOf(t){const e=this._first.following,i=this._first.data;return e===null&&i===t}update(t,e){const i=this.getBufferData(t);if(i.data!==e){const{a:n,c:r,b:o}=this.newBuffers(t,i,e);this.setupInputData(i,n,r),this.setupUpdateBuffers(n,o,r)}}size(t){let e=0,i=this._first;for(;i!==null;)this.doesFilterPass(t,i)&&e++,i=i.following;return e}static setAllBufferData(t,e,i,n,r){for(let o=0;o<t.length;++o){const a=t[o];this.transform(a,e),this.setBuffers(i,n,o),r&&r(o,a.data)}}static makeBufferComplementary(t,e,i,n){for(let r=0;r<t;++r){const o=this.getBuffers(e,r),{position:a,size:l}=o;a>i&&n(i,a-i),i=a+l}return i}static setBuffers(t,e,i){t[i]=this._tempData.position;const n=this._tempData.size===1/0;e[i]=n?this._inf:this._tempData.size}add(t,e,i){if(!Fd._stash.length)return this.newData(e,i,t);const n=Fd._stash.pop();if(!n)throw new Error("Fragments: No stash found");return n.position=t,n.size=e,n.data=i,n}remove(t){t&&(t.following=null,t.past=null,Fd._stash.push(t))}static getData(t,e){const i=t.filter(e),n=i.length;return{filtered:i,position:new Uint32Array(n),size:new Uint32Array(n)}}filter(t){const e=[];let i=this._first;for(;i!==null;)this.doesFilterPass(t,i)&&e.push(i),i=i.following;return e}static transform(t,e){const i=this.getTempData(),n=t.position+t.size,r=n===e.length;if(i.position=e[t.position],r)i.size=1/0;else{const o=e[n];i.size=o-i.position}return i}static getBuffers(t,e){const i=t.position[e];let n;return n=t.size[e]===this._inf?1/0:t.size[e],{position:i,size:n}}static getTempData(){return this._tempData?this._tempData:{position:0,size:0}}doesFilterPass(t,e){return!t||t(e.data)}setupUpdateBuffers(t,e,i){this.chainBuffers(t,e,i),this.setupFirstBuffer(t,e),this.setupLastBuffer(i,e),this.setupMiddleBufferStart(e),this.setupMiddleBufferEnd(e)}setupMiddleBufferEnd(t){var e;if(((e=t.following)==null?void 0:e.data)===t.data){if(!t.following)return;const i=t.following.size+t.size,n=t.following.following;t.size=i,this.remove(t.following),t.following=n,t.following&&(t.following.past=t)}}setupFirstBuffer(t,e){t.size||(t.past?t.past.following=e:this._first=e,e.past=t.past,this.remove(t))}setupMiddleBufferStart(t){var e;if(((e=t.past)==null?void 0:e.data)===t.data){if(!t.past)return;t.size=t.past.size+t.size,t.position=t.past.position;const i=t.past.past;this.remove(t.past),t.past=i,t.past?t.past.following=t:this._first=t}}chainBuffers(t,e,i){t.following=e,e.past=t,e.following=i,i.past=e}setupLastBuffer(t,e){t.size||(t.following&&(t.following.past=e),e.following=t.following,this.remove(t))}newBuffers(t,e,i){const n=t-e.position,r=this.add(e.position,n,e.data),o=this.add(t,1,i),a=e.size-r.size-1;return{a:r,c:this.add(t+1,a,e.data),b:o}}setupInputData(t,e,i){t.past?(t.past.following=e,e.past=t.past):this._first=e,t.following&&(t.following.past=i,i.following=t.following),this.remove(t)}newData(t,e,i=0){return{position:i,size:t,past:null,following:null,data:e}}getBufferData(t){let e=this._first;for(;;){const i=e===null,n=e.position<=t,r=t<e.position+e.size;if(i||n&&r)return e;e=e.following}}};S(Pd,"_stash",[]),S(Pd,"_tempData",{position:0,size:0}),S(Pd,"_inf",4294967295);let Nh=Pd,en=class{static fixNumber(s){return Number.isNaN(s)?0:Number.isFinite(s)?s:0}static forEach(s,t){if(Array.isArray(s)){let e=0;for(const i of s)t(i,e++)}else t(s,0)}},Hw=class{static estimateCapacity(){const s=this.capacityFactor,t=window.screen.width,e=window.screen.height,i=window.devicePixelRatio;return Math.trunc(t*e*i*i*s)}};S(Hw,"capacityFactor",200);let Ef=class{static check(s,t,e){const i=this.get(e);return!!(s[t]&i)}static apply(s,t,e,i){const n=this.get(e);i?s[t]|=n:s[t]&=~n}static checkMemory(s){if(s>bl)throw new Error("Fragments: Memory overflow!")}static get(s){return 1<<s}},cl=class{static parseMaterial(s){const t=s.r()/255,e=s.g()/255,i=s.b()/255,n=s.a()/255,r=s.a()<255;return{color:new xt(t,e,i),renderedFaces:s.renderedFaces(),opacity:n,transparent:r}}static parseBox(s,t){this.getBox(s,t,"min"),this.getBox(s,t,"max")}static parseTransform(s,t){return this.getVector(s,"position",this._doubleVector),this.getVector(s,"xDirection",this._floatVector),this.getVector(s,"yDirection",this._floatVector),this.computeZVector(),this.setTransform(t),t}static setTransform(s){const{x:t,y:e,z:i}=this._temp.xDirection,{x:n,y:r,z:o}=this._temp.yDirection,{x:a,y:l,z:h}=this._temp.zDirection,{x:c,y:u,z:p}=this._temp.position;s.set(t,n,a,c,e,r,l,u,i,o,h,p,0,0,0,1)}static getBox(s,t,e){s[e](this._floatVector);const i=this._floatVector.x(),n=this._floatVector.y(),r=this._floatVector.z();t[e].x=en.fixNumber(i),t[e].y=en.fixNumber(n),t[e].z=en.fixNumber(r)}static getVector(s,t,e){s[t](e);const i=this._temp[t],n=e.x(),r=e.y(),o=e.z();i.x=en.fixNumber(n),i.y=en.fixNumber(r),i.z=en.fixNumber(o)}static computeZVector(){this._temp.zDirection.crossVectors(this._temp.xDirection,this._temp.yDirection)}};S(cl,"_temp",{position:new F,xDirection:new F,yDirection:new F,zDirection:new F}),S(cl,"_doubleVector",new Dw),S(cl,"_floatVector",new os);const Gs=class{static get(s,t,e){this.fetchSampleTransform(s,t),this.fetchItemTransform(s,t),e.multiplyMatrices(this._item,this._sample)}static getBox(s,t){s.bbox(this._box),cl.parseBox(this._box,t)}static getBoxData(s){this._min.copy(s.min),this._max.copy(s.max),this._center.addVectors(this._min,this._max),this._center.divideScalar(2),s.getSize(this._distance)}static boxSize(s){return this.getBoxData(s),this.applyTransformer(),this._edge.start=this._min.clone(),this._edge.end=this._max.clone(),this._edge}static applyTransformer(){const{x:s,y:t,z:e}=this._distance,i=Math.max(s,t,e);s===i?this._transformers.x():t===i?this._transformers.y():this._transformers.z()}static fetchItemTransform(s,t){const e=s.item();t.globalTransforms(e,this._transform),cl.parseTransform(this._transform,this._item)}static fetchSampleTransform(s,t){const e=s.localTransform();t.localTransforms(e,this._transform),cl.parseTransform(this._transform,this._sample)}static setBoxZ(){this._min.set(this._center.x,this._center.y,this._min.z),this._max.set(this._center.x,this._center.y,this._max.z)}static setBoxY(){this._min.set(this._center.x,this._min.y,this._center.z),this._max.set(this._center.x,this._max.y,this._center.z)}static setBoxX(){this._min.set(this._min.x,this._center.y,this._center.z),this._max.set(this._max.x,this._center.y,this._center.z)}};S(Gs,"_transform",new rr),S(Gs,"_min",new F),S(Gs,"_max",new F),S(Gs,"_center",new F),S(Gs,"_distance",new F),S(Gs,"_edge",new Gt),S(Gs,"_item",new vt),S(Gs,"_sample",new vt),S(Gs,"_box",new Mw),S(Gs,"_transformers",{x:()=>Gs.setBoxX(),y:()=>Gs.setBoxY(),z:()=>Gs.setBoxZ()});let nl=Gs,jw=class{static getWidth(s){return s.getSize(this._temp.vector),this._temp.vector.x>this._temp.vector.y&&this._temp.vector.set(this._temp.vector.y,this._temp.vector.x,this._temp.vector.z),this._temp.vector.y>this._temp.vector.z&&this._temp.vector.set(this._temp.vector.x,this._temp.vector.z,this._temp.vector.y),this._temp.vector.x>this._temp.vector.y&&this._temp.vector.set(this._temp.vector.y,this._temp.vector.x,this._temp.vector.z),this._temp.vector.y}};S(jw,"_temp",{vector:new F});let Yw=class{static getEarcutDimensions(s){const t=Math.abs(s.x),e=Math.abs(s.y),i=Math.abs(s.z);return i>t&&i>e?s.z>0?[0,1]:[1,0]:e>t&&e>i?s.y>0?[2,0]:[0,2]:s.x>0?[1,2]:[2,1]}};const Rb=new Tt,du=new F;let Ww=class extends C_{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new Us([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new Us([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(s){const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(s),e.applyMatrix4(s),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(s){let t;s instanceof Float32Array?t=s:Array.isArray(s)&&(t=new Float32Array(s));const e=new Xo(t,6,1);return this.setAttribute("instanceStart",new Js(e,3,0)),this.setAttribute("instanceEnd",new Js(e,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(s){let t;s instanceof Float32Array?t=s:Array.isArray(s)&&(t=new Float32Array(s));const e=new Xo(t,6,1);return this.setAttribute("instanceColorStart",new Js(e,3,0)),this.setAttribute("instanceColorEnd",new Js(e,3,3)),this}fromWireframeGeometry(s){return this.setPositions(s.attributes.position.array),this}fromEdgesGeometry(s){return this.setPositions(s.attributes.position.array),this}fromMesh(s){return this.fromWireframeGeometry(new gw(s.geometry)),this}fromLineSegments(s){const t=s.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Tt);const s=this.attributes.instanceStart,t=this.attributes.instanceEnd;s!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(s),Rb.setFromBufferAttribute(t),this.boundingBox.union(Rb))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ws),this.boundingBox===null&&this.computeBoundingBox();const s=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(s!==void 0&&t!==void 0){const e=this.boundingSphere.center;this.boundingBox.getCenter(e);let i=0;for(let n=0,r=s.count;n<r;n++)du.fromBufferAttribute(s,n),i=Math.max(i,e.distanceToSquared(du)),du.fromBufferAttribute(t,n),i=Math.max(i,e.distanceToSquared(du));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}};nr.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Bt(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},Gr.line={uniforms:Bc.merge([nr.common,nr.fog,nr.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};let Oo=class extends $c{constructor(s){super({type:"LineMaterial",uniforms:Bc.clone(Gr.line.uniforms),vertexShader:Gr.line.vertexShader,fragmentShader:Gr.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(s)}get color(){return this.uniforms.diffuse.value}set color(s){this.uniforms.diffuse.value=s}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(s){s===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(s){this.uniforms.linewidth&&(this.uniforms.linewidth.value=s)}get dashed(){return"USE_DASH"in this.defines}set dashed(s){s===!0!==this.dashed&&(this.needsUpdate=!0),s===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(s){this.uniforms.dashScale.value=s}get dashSize(){return this.uniforms.dashSize.value}set dashSize(s){this.uniforms.dashSize.value=s}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(s){this.uniforms.dashOffset.value=s}get gapSize(){return this.uniforms.gapSize.value}set gapSize(s){this.uniforms.gapSize.value=s}get opacity(){return this.uniforms.opacity.value}set opacity(s){this.uniforms&&(this.uniforms.opacity.value=s)}get resolution(){return this.uniforms.resolution.value}set resolution(s){this.uniforms.resolution.value.copy(s)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(s){this.defines&&(s===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),s===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}};const Cf=new $i,Lb=new F,Nb=new F,hs=new $i,cs=new $i,fn=new $i,If=new F,xf=new vt,us=new Gt,Mb=new F,pu=new Tt,fu=new ws,mn=new $i;let gn,Po;function Db(s,t,e){return mn.set(0,0,-t,1).applyMatrix4(s.projectionMatrix),mn.multiplyScalar(1/mn.w),mn.x=Po/e.width,mn.y=Po/e.height,mn.applyMatrix4(s.projectionMatrixInverse),mn.multiplyScalar(1/mn.w),Math.abs(Math.max(mn.x,mn.y))}let vS=class extends lt{constructor(s=new Ww,t=new Oo({color:16777215*Math.random()})){super(s,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const s=this.geometry,t=s.attributes.instanceStart,e=s.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let r=0,o=0,a=t.count;r<a;r++,o+=2)Lb.fromBufferAttribute(t,r),Nb.fromBufferAttribute(e,r),i[o]=o===0?0:i[o-1],i[o+1]=i[o]+Lb.distanceTo(Nb);const n=new Xo(i,2,1);return s.setAttribute("instanceDistanceStart",new Js(n,1,0)),s.setAttribute("instanceDistanceEnd",new Js(n,1,1)),this}raycast(s,t){const e=this.material.worldUnits,i=s.camera;i!==null||e||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const n=s.params.Line2!==void 0&&s.params.Line2.threshold||0;gn=s.ray;const r=this.matrixWorld,o=this.geometry,a=this.material;let l,h;Po=a.linewidth+n,o.boundingSphere===null&&o.computeBoundingSphere(),fu.copy(o.boundingSphere).applyMatrix4(r),e?l=.5*Po:l=Db(i,Math.max(i.near,fu.distanceToPoint(gn.origin)),a.resolution),fu.radius+=l,gn.intersectsSphere(fu)!==!1&&(o.boundingBox===null&&o.computeBoundingBox(),pu.copy(o.boundingBox).applyMatrix4(r),e?h=.5*Po:h=Db(i,Math.max(i.near,pu.distanceToPoint(gn.origin)),a.resolution),pu.expandByScalar(h),gn.intersectsBox(pu)!==!1&&(e?function(c,u){const p=c.matrixWorld,d=c.geometry,_=d.attributes.instanceStart,m=d.attributes.instanceEnd;for(let g=0,f=Math.min(d.instanceCount,_.count);g<f;g++){us.start.fromBufferAttribute(_,g),us.end.fromBufferAttribute(m,g),us.applyMatrix4(p);const b=new F,y=new F;gn.distanceSqToSegment(us.start,us.end,y,b),y.distanceTo(b)<.5*Po&&u.push({point:y,pointOnLine:b,distance:gn.origin.distanceTo(y),object:c,face:null,faceIndex:g,uv:null,uv1:null})}}(this,t):function(c,u,p){const d=u.projectionMatrix,_=c.material.resolution,m=c.matrixWorld,g=c.geometry,f=g.attributes.instanceStart,b=g.attributes.instanceEnd,y=Math.min(g.instanceCount,f.count),E=-u.near;gn.at(1,fn),fn.w=1,fn.applyMatrix4(u.matrixWorldInverse),fn.applyMatrix4(d),fn.multiplyScalar(1/fn.w),fn.x*=_.x/2,fn.y*=_.y/2,fn.z=0,If.copy(fn),xf.multiplyMatrices(u.matrixWorldInverse,m);for(let C=0,I=y;C<I;C++){if(hs.fromBufferAttribute(f,C),cs.fromBufferAttribute(b,C),hs.w=1,cs.w=1,hs.applyMatrix4(xf),cs.applyMatrix4(xf),hs.z>E&&cs.z>E)continue;if(hs.z>E){const V=hs.z-cs.z,T=(hs.z-E)/V;hs.lerp(cs,T)}else if(cs.z>E){const V=cs.z-hs.z,T=(cs.z-E)/V;cs.lerp(hs,T)}hs.applyMatrix4(d),cs.applyMatrix4(d),hs.multiplyScalar(1/hs.w),cs.multiplyScalar(1/cs.w),hs.x*=_.x/2,hs.y*=_.y/2,cs.x*=_.x/2,cs.y*=_.y/2,us.start.copy(hs),us.start.z=0,us.end.copy(cs),us.end.z=0;const x=us.closestPointToPointParameter(If,!0);us.at(x,Mb);const A=Vc.lerp(hs.z,cs.z,x),O=A>=-1&&A<=1,L=If.distanceTo(Mb)<.5*Po;if(O&&L){us.start.fromBufferAttribute(f,C),us.end.fromBufferAttribute(b,C),us.start.applyMatrix4(m),us.end.applyMatrix4(m);const V=new F,T=new F;gn.distanceSqToSegment(us.start,us.end,T,V),p.push({point:T,pointOnLine:V,distance:gn.origin.distanceTo(T),object:c,face:null,faceIndex:C,uv:null,uv1:null})}}}(this,i,t)))}onBeforeRender(s){const t=this.material.uniforms;t&&t.resolution&&(s.getViewport(Cf),this.material.uniforms.resolution.value.set(Cf.z,Cf.w))}},Gw=class extends Ww{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(s){const t=s.length-3,e=new Float32Array(2*t);for(let i=0;i<t;i+=3)e[2*i]=s[i],e[2*i+1]=s[i+1],e[2*i+2]=s[i+2],e[2*i+3]=s[i+3],e[2*i+4]=s[i+4],e[2*i+5]=s[i+5];return super.setPositions(e),this}setColors(s){const t=s.length-3,e=new Float32Array(2*t);for(let i=0;i<t;i+=3)e[2*i]=s[i],e[2*i+1]=s[i+1],e[2*i+2]=s[i+2],e[2*i+3]=s[i+3],e[2*i+4]=s[i+4],e[2*i+5]=s[i+5];return super.setColors(e),this}setFromPoints(s){const t=s.length-1,e=new Float32Array(6*t);for(let i=0;i<t;i++)e[6*i]=s[i].x,e[6*i+1]=s[i].y,e[6*i+2]=s[i].z||0,e[6*i+3]=s[i+1].x,e[6*i+4]=s[i+1].y,e[6*i+5]=s[i+1].z||0;return super.setPositions(e),this}fromLine(s){const t=s.geometry;return this.setPositions(t.attributes.position.array),this}},wS=class extends vS{constructor(s=new Gw,t=new Oo({color:16777215*Math.random()})){super(s,t),this.isLine2=!0,this.type="Line2"}},ES=class{constructor(s){S(this,"model"),S(this,"_endpointsMaterials",{interior:new Wm({color:15658734,size:8,sizeAttenuation:!1,depthTest:!1}),exterior:new Wm({color:16777215,size:16,sizeAttenuation:!1,depthTest:!1})}),S(this,"_absoluteAlignments",new on),S(this,"_horizontalAlignments",new on),S(this,"_verticalAlignments",new on),S(this,"_alignmentMaterials",new Map([[zn.NONE,new Oo({color:16777215,linewidth:5,depthTest:!1})],[zn.LINES,new Oo({color:16711935,linewidth:5,depthTest:!1})],[zn.CLOTHOID,new Oo({color:16711680,linewidth:5,depthTest:!1})],[zn.ELLIPSE_ARC,new Oo({color:65535,linewidth:5,depthTest:!1})],[zn.PARABOLA,new Oo({color:255,linewidth:5,depthTest:!1})]])),this.model=s}async getAlignments(){return this._absoluteAlignments.children.length||await this.constructAlignments(),this._absoluteAlignments}async getHorizontalAlignments(){return this._horizontalAlignments.children.length||await this.constructAlignments(),this._horizontalAlignments}async getVerticalAlignments(){return this._verticalAlignments.children.length||await this.constructAlignments(),this._verticalAlignments}async getAlignmentStyles(){return{...this._alignmentMaterials,...this._endpointsMaterials}}async constructAlignments(){const s=await this.model.threads.invoke(this.model.modelId,"getAlignments");for(const t of s)this.constructLine(t.absolute,this._absoluteAlignments),this.constructLine(t.horizontal,this._horizontalAlignments),this.constructLine(t.vertical,this._verticalAlignments)}constructLine(s,t){if(!s.length)return;const e=[],i=[],n=new on;t.add(n);const r=s[0].points,o=s[s.length-1].points;i.push(o[0],o[1],o[2]),i.push(r[r.length-3],r[r.length-2],r[r.length-1]);for(const h of s){const c=h.points;e.push(c[0],c[1],c[2]),e.push(c[c.length-3],c[c.length-2],c[c.length-1]);const u=new Gw;u.setPositions(c);const p=this._alignmentMaterials.get(h.type),d=new wS(u,p);n.add(d),d.renderOrder=1,d.userData.points=c}const{interior:a,exterior:l}=this._endpointsMaterials;this.constructPoints(e,a,n),this.constructPoints(i,l,n)}constructPoints(s,t,e){const i=new fw,n=new ye,r=new Float32Array(s),o=new Ve(r,3);n.setAttribute("position",o),i.geometry=n,i.material=t,e.add(i),i.renderOrder=2}dispose(){this._absoluteAlignments.removeFromParent();for(const s of this._absoluteAlignments.children){const t=s;t.geometry.dispose(),t.geometry=void 0,t.material=void 0}for(const s of Object.values(this._alignmentMaterials))s.dispose();this._alignmentMaterials={}}},CS=class{async setup(s,t,e,i,n){const r=this.getCreateModelMessage(s,e,i,n),o=this.formatModelData(e),a=await s.threads.fetch(r,o);this.updateBox(t,a)}formatModelData(s){if(s instanceof ArrayBuffer)return[s]}updateBox(s,t){s.min.copy(t.boundingBox.min),s.max.copy(t.boundingBox.max)}getCreateModelMessage(s,t,e,i){return{class:an.CREATE_MODEL,modelId:s.modelId,modelData:t,raw:e,config:i}}},IS=class{async getBoxes(s,t){const e=this.getIndividualBoxesIds(t),i=this.getBoxRequest(s,e),n=await s.threads.fetch(i);return this.getAllBoxes(n,s)}async getMergedBox(s,t){const e=this.getBoxRequest(s,[t]),{boxes:i}=await s.threads.fetch(e),[n]=i;return this.getAbsoluteBox(n,s)}getAbsoluteBox(s,t){const e=new Tt;return e.copy(s),e.applyMatrix4(t.object.matrixWorld),e}getIndividualBoxesIds(s){if(!s)return;const t=[];for(const e of s)t.push([e]);return t}getAllBoxes(s,t){const e=s.boxes,i=[];for(const n of e){const r=new Tt;r.copy(n),r.applyMatrix4(t.object.matrixWorld),i.push(r)}return i}getBoxRequest(s,t){return{class:an.FETCH_BOXES,modelId:s.modelId,localIds:t}}},xS=class{constructor(){S(this,"_coordinationMatrices",new Map)}async getCoordinationMatrix(s){let t=this._coordinationMatrices.get(s.modelId);if(t)return t;t=new vt,this._coordinationMatrices.set(s.modelId,t);const[e,i,n,r,o,a,l,h,c]=await this.getCoordinates(s),u=new F(r,o,a),p=new F(l,h,c),d=new F().crossVectors(u,p);return t.set(r,l,d.x,e,o,h,d.y,i,a,c,d.z,n,0,0,0,1),t}async getCoordinates(s){const t=s.modelId;return s.threads.invoke(t,"getCoordinates")}async getPositions(s,t){const e=[t],i=await s.threads.invoke(s.modelId,"getPositions",e);return this.getAbsolutePositions(i,s)}getAbsolutePositions(s,t){const e=[];for(const i of s){const{x:n,y:r,z:o}=i,a=new F(n,r,o);a.applyMatrix4(t.object.matrixWorld),e.push(a)}return e}},TS=class extends Map{constructor(s,t){super(t),S(this,"tracker",null),S(this,"localId"),S(this,"guard",()=>!0),this.localId=s}get object(){const s={};for(const[t,e]of this.entries())s[t]=e.value;return s}set(s,t){if(!(this.guard??(()=>!0))(s,t))return this;const e=t.type!==void 0?t:{value:t.value,type:this.getType(s)};if(!this.tracker)return super.set(s,e);if(this.localId===null)return console.warn("Item attributes are missing a valid localId. Changes can't be tracked."),super.set(s,e);let i=this.tracker.get(this.localId);return i||(i={type:"modified",added:{},deleted:[],modified:{}},this.tracker.set(this.localId,i)),i.type==="added"?i.data[s]=e:i.type==="modified"&&(this.has(s)?i.modified[s]=e:i.deleted.includes(s)?(i.deleted=i.deleted.filter(n=>n!==s),i.modified[s]=e):i.added[s]=e),super.set(s,e)}setValue(s,t){return this.set(s,{value:t,type:this.getType(s)})}setType(s,t){const e=this.getValue(s);return e?this.set(s,{value:e,type:t}):this}delete(s){if(!this.tracker)return super.delete(s);const t=this.get("localId");if(t===void 0||typeof t!="number")return console.warn("Item attributes are missing a valid localId. Changes can't be tracked."),s!=="localId"&&super.delete(s);if(s==="localId"||!this.has(s))return!1;let e=this.tracker.get(t);return e||(e={type:"modified",added:{},deleted:[],modified:{}},this.tracker.set(t,e)),e.type==="added"?delete e.data[s]:e.type==="modified"&&(s in e.added?delete e.added[s]:(s in e.modified&&delete e.modified[s],e.deleted.push(s))),super.delete(s)}getValue(s){const t=this.get(s);return t?t.value:null}getType(s){var t;return(t=this.get(s))==null?void 0:t.type}},AS=class extends Map{constructor(s,t){super(t),S(this,"tracker",null),S(this,"localId"),S(this,"guard",()=>!0),S(this,"onItemsRequested",null),this.localId=s}get itemChanges(){if(!this.tracker)return null;if(!this.localId)return console.warn("Item relations can't be tracked."),null;let s=this.tracker.get(this.localId);return s||(s={type:"modified",added:{},deleted:new Set,removed:{},modified:{}},this.tracker.set(this.localId,s)),s}set(s,t){const e=this.has(s);if(!(this.guard??(()=>!0))(s,t))return this;const i=this.itemChanges;return i?(e?i.modified[s]=t:i.added[s]=t,super.set(s,t)):super.set(s,t)}add(s,t){var e;const i=this.has(s);let n=this.get(s);if(!n)return n=new Set([t]),this.set(s,n),!0;if(!n||n.has(t))return!1;const r=this.itemChanges;if(!r)return n.add(t),!0;if(i)if((e=r.removed[s])!=null&&e.has(t))r.removed[s].delete(t),r.removed[s].size===0&&delete r.removed[s];else{let o=r.modified[s];o||(o=new Set,r.modified[s]=o),o.add(t)}else{let o=r.added[s];o||(o=new Set,r.added[s]=o),o.add(t)}return n.add(t),!0}remove(s,t){var e;const i=this.get(s);if(!i||!i.has(t))return!1;const n=this.itemChanges;if(!n)return i.delete(t);if((e=n.modified[s])!=null&&e.has(t))n.modified[s].delete(t),n.modified[s].size===0&&delete n.modified[s];else{let r=n.removed[s];r||(r=new Set,n.removed[s]=r),r.add(t)}return i.delete(t)}delete(s){if(!this.has(s))return!1;const t=this.itemChanges;return t?(t.deleted.add(s),super.delete(s)):super.delete(s)}async getItems(s){if(!this.onItemsRequested)return null;const t=this.get(s);return t?await this.onItemsRequested([...t]):null}},SS=class{constructor(s,t){S(this,"model"),S(this,"localId"),S(this,"_indices",null),S(this,"_transform",null),S(this,"_normals",null),S(this,"_positions",null),S(this,"_vertices",null),S(this,"_triangles",null),S(this,"_position",null),S(this,"_box",null),this.model=s,this.localId=t}async get(){const[s]=await this.model.threads.invoke(this.model.modelId,"getItemsGeometry",[[this.localId]]);for(const t of s){t.transform=new vt().fromArray(t.transform.elements);const{indices:e,normals:i,positions:n,transform:r}=t;this._indices||(this._indices=[]),this._normals||(this._normals=[]),this._positions||(this._positions=[]),this._transform||(this._transform=[]),this._indices.push(e),this._normals.push(i),this._positions.push(n),this._transform.push(r)}return s}async getIndices(){return this._indices!==null||await this.get(),this._indices}async getTransform(){return this._transform!==null||await this.get(),this._transform}async getNormals(){return this._normals!==null||await this.get(),this._normals}async getPositions(){return this._positions!==null||await this.get(),this._positions}async getVertices(){if(this._vertices)return this._vertices;const s=await this.getPositions(),t=await this.getTransform();if(!s||!t)return this._vertices;this._vertices=[];for(let e=0;e<s.length;e++){const i=s[e],n=t[e];if(!i||!n)continue;const r=[];this._vertices.push(r);const o=Object.keys(i).length/3,a=[];for(let l=0;l<o;l++){const h=i[3*l],c=i[3*l+1],u=i[3*l+2];if(typeof h!="number"||typeof c!="number"||typeof u!="number")continue;const p=`${h},${c},${u}`;if(a.includes(p))continue;a.push(p);const d=new F(h,c,u);d.applyMatrix4(n),r.push(d)}}return this._vertices}async getTriangles(){if(this._triangles)return this._triangles;const s=await this.getIndices(),t=await this.getPositions(),e=await this.getTransform();if(!s||!t||!e)return this._triangles;this._triangles=[];for(let i=0;i<s.length;i++){const n=s[i],r=t[i],o=e[i];if(!n||!r||!o)continue;const a=[];this._triangles.push(a);for(let l=0;l<n.length;l+=3){const h=n[l],c=n[l+1],u=n[l+2],p=new F(r[3*h],r[3*h+1],r[3*h+2]),d=new F(r[3*c],r[3*c+1],r[3*c+2]),_=new F(r[3*u],r[3*u+1],r[3*u+2]);p.applyMatrix4(o),d.applyMatrix4(o),_.applyMatrix4(o),a.push(new ks(p,d,_))}}return this._triangles}async getPosition(){if(!this._position){if(this.localId===null)return null;this._position=await this.model.getPositions([this.localId])}return this._position}async getBox(){if(!this._box){if(this.localId===null)return null;this._box=await this.model.getBoxes([this.localId])}return this._box}async setVisibility(s){await this.model.setVisible([this.localId],s)}async getVisibility(){const[s]=await this.model.getVisible([this.localId]);return s}},OS=class{constructor(s,t){S(this,"model"),S(this,"_localId",null),S(this,"_attributes",null),S(this,"_relations",null),S(this,"_guid",null),S(this,"_category",null),S(this,"_geometry",null),this.model=s,typeof t=="number"&&(this._localId=t),typeof t=="string"&&(this._guid=t)}async getLocalId(){if(!this._localId){if(!this._guid)throw new Error("Fragments: Item localId couldn't be get.");[this._localId]=await this.model.threads.invoke(this.model.modelId,"getLocalIdsByGuids",[[this._guid]])}return this._localId}async getAttributes(){if(this._attributes)return this._attributes;const s=await this.getLocalId();if(s===null)return null;const t=await this.model.threads.invoke(this.model.modelId,"getItemAttributes",[s]);if(this._attributes=new TS(s),!t){const i=this.model.attrsChanges.get(s);if(!i||i.type!=="added")return null;this._attributes.localId=s;for(const[n,r]of Object.entries(i.data))this._attributes.set(n,r);return this._attributes}const e=this.model.attrsChanges.get(s);if(e&&e.type==="modified")for(const[i,n]of Object.entries(e.added))this._attributes.set(i,n);for(const i in t){const{value:n,type:r}=t[i];(e==null?void 0:e.type)==="modified"&&e.deleted.includes(i)||((e==null?void 0:e.type)==="modified"&&i in e.modified?this._attributes.set(i,e.modified[i]):this._attributes.set(i,{value:n,type:r}))}return this._attributes.tracker=this.model.attrsChanges,this._attributes}async getRelations(){if(this._relations)return this._relations;const s=await this.getLocalId();if(s===null)return null;const t=await this.model.threads.invoke(this.model.modelId,"getItemRelations",[s]);if(!t)return null;this._relations=new AS(s),this._relations.onItemsRequested=async i=>{const n=[];for(const r of i){const o=this.model.getItem(r);o&&n.push(o)}return n};const e=this.model.relsChanges.get(s);if(e&&e.type==="modified")for(const[i,n]of Object.entries(e.added))this._relations.set(i,n);for(const[i,n]of Object.entries(t))if((e==null?void 0:e.type)!=="modified"||!e.deleted.has(i))if((e==null?void 0:e.type)==="modified"&&i in e.modified){const r=new Set([...e.modified[i],...n]);this._relations.set(i,new Set(r))}else this._relations.set(i,new Set(n));return this._relations.tracker=this.model.relsChanges,this._relations}async getGuid(){if(!this._guid){const s=await this.getLocalId();if(s===null)return null;[this._guid]=await this.model.threads.invoke(this.model.modelId,"getGuidsByLocalIds",[[s]])}return this._guid}async getCategory(){if(!this._category){const s=await this.getLocalId();if(s===null)return null;this._category=await this.model.threads.invoke(this.model.modelId,"getItemCategory",[s])}return this._category}async getGeometry(){if(this._geometry)return this._geometry;const s=await this.getLocalId();return s===null?null:new SS(this.model,s)}async getData(s=[]){var t;const e=await this.getLocalId();if(e==null)return{};s.push(e);const i=(t=await this.getAttributes())==null?void 0:t.object,n=await this.getRelations(),r={};if(n)for(const o of n.keys()){const a=[];r[o]=a;const l=await n.getItems(o);if(l)for(const h of l){const c=await h.getLocalId();if(!c||s.find(p=>p===c)!==void 0)continue;s.push(c);const u=await h.getData(s);u&&a.push(u)}}return{...i,...r}}},PS=class{getItem(s,t){return new OS(s,t)}async getItemsData(s,t,e){return s.threads.invoke(s.modelId,"getItemsData",[t,e])}async getItemsChildren(s,t){return s.threads.invoke(s.modelId,"getItemsChildren",[t])}},FS=class{constructor(){S(this,"getClippingPlanesEvent",()=>[]),S(this,"_tempMatrix",new vt),S(this,"_tempVec",new F),S(this,"_tempFrustum",new cr),S(this,"_updateCameraPositionEvent",()=>{}),S(this,"_updateCameraFrustumEvent",()=>{}),S(this,"_updateFOVEvent",()=>{}),S(this,"_updateOrthoSizeEvent",()=>{})}async refreshView(s,t){const e=this.setup(t,s),i=Ho.transform(this._tempFrustum,this._tempMatrix),n=this.newViewRequest(i,e,s);await s.threads.fetch(n)}useCamera(s){const t=new vt;this.setCameraPosition(s),this.setCameraFrustum(s,t),this.setFov(s),this.setOrtho()}getOrthoSize(){let s=this._updateOrthoSizeEvent();return s&&(s*=this._tempMatrix.getMaxScaleOnAxis()),s}setup(s,t){return s.requests.clean(t.modelId),this._tempMatrix.copy(t.object.matrixWorld).invert(),this._updateCameraPositionEvent(this._tempVec),this._updateCameraFrustumEvent(this._tempFrustum),this._updateFOVEvent()}newViewRequest(s,t,e){const i=this.newView(s,t,e),n={};return n.class=an.REFRESH_VIEW,n.modelId=e.modelId,n.cameraFrustum=s,n.view=i,n}newView(s,t,e){const i={};return i.cameraFrustum=s,i.cameraPosition=this._tempVec.applyMatrix4(this._tempMatrix),i.fov=t,i.orthogonalDimension=this.getOrthoSize(),i.viewSize=Math.max(window.innerWidth,window.innerHeight),i.graphicThreshold=Hw.estimateCapacity(),i.graphicQuality=-1.5*e.graphicsQuality+2,i.clippingPlanes=this.getPlanes(),i.modelPlacement=e.object.matrixWorld,i}setOrtho(){this._updateOrthoSizeEvent=()=>{}}setFov(s){this._updateFOVEvent=()=>{if(s instanceof Hc)return s.fov}}getPlanes(){const s=[],t=this.getClippingPlanesEvent();for(const e of t){const i=e.clone();i.applyMatrix4(this._tempMatrix),s.push(i)}return s}setCameraPosition(s){this._updateCameraPositionEvent=t=>{t.copy(s.position)}}setCameraFrustum(s,t){this._updateCameraFrustumEvent=e=>{s.updateProjectionMatrix(),s.updateWorldMatrix(!0,!0);const{projectionMatrix:i,matrixWorldInverse:n}=s;t.multiplyMatrices(i,n),e.setFromProjectionMatrix(t)}}},RS=class{constructor(){S(this,"_caster",new oa),S(this,"_ray",new Jr),S(this,"_frustum",new cr),S(this,"_inverseTransform",new vt),S(this,"_t",new Ht),S(this,"_r",new Ht),S(this,"_b",new Ht),S(this,"_l",new Ht),S(this,"_n",new Ht),S(this,"_f",new Ht),S(this,"_tl",new F),S(this,"_tr",new F),S(this,"_bl",new F),S(this,"_br",new F),S(this,"_tln",new F),S(this,"_brn",new F),S(this,"_tlp",new Bt),S(this,"_brp",new Bt),S(this,"distance",10)}async raycast(s,t){const{frustum:e,ray:i}=this.getRayAndFrustum(t),n=this.getRequest(s,e,i);if(!n)return null;const r=await s.threads.fetch(n);if(r.results&&r.results.length){const[o]=r.results;return this.getResult({hit:o,frustum:e,ray:i,model:s})}return null}async rectangleRaycast(s,t,e){const i=this.getFrustum(e),n=this.getRequest(s,i);if(!n)return null;n.fullyIncluded=e.fullyIncluded;const r=await s.threads.fetch(n);return r.localIds&&r.localIds.length?this.newRectangleCastResponse(r,t):null}async raycastWithSnapping(s,t){const{frustum:e,ray:i}=this.getRayAndFrustum(t),n=this.getRequest(s,e,i);if(!n)return null;n.snappingClass=t.snappingClasses;const r=await s.threads.fetch(n);return r.results?this.newRaycastSnapResult(r,e,i,s):null}screenRectToFrustum(s,t,e,i){return this.screenToCast(s,e,this._tlp),this.screenToCast(t,e,this._brp),this.setVectors(i),this.setPlanes(i),this.newFrustum()}screenToCasterPoint(s,t,e){const i=this.screenToCast(s,t);return this._caster.setFromCamera(i,e),this._caster.ray.clone()}setPlanes(s){this.setBasePoints(),s.getWorldDirection(this._n.normal),this.setEnds(s)}setVectors(s){this.setVector(this._tl,this._tlp,this._tlp,1,s),this.setVector(this._tr,this._brp,this._tlp,1,s),this.setVector(this._bl,this._tlp,this._brp,1,s),this.setVector(this._br,this._brp,this._brp,1,s),this.setVector(this._tln,this._tlp,this._tlp,0,s),this.setVector(this._brn,this._brp,this._brp,0,s)}newFrustum(){return new cr(this._t,this._b,this._l,this._r,this._f,this._n)}setEnds(s){this._n.constant=s.position.length(),this._f.normal=this._n.normal,this._f.constant=1/0}screenToCast(s,t,e=new Bt){const i=t.getBoundingClientRect(),n=i.width/t.clientWidth,r=i.height/t.clientHeight,o=(s.x-i.left)/n,a=(s.y-i.top)/r;return e.x=o/t.clientWidth*2-1,e.y=-a/t.clientHeight*2+1,e}setVector(s,t,e,i,n){s.set(t.x,e.y,i),s.unproject(n)}setPlane(s,t,e,i){s.setFromCoplanarPoints(t,e,i)}setBasePoints(){this.setPlane(this._t,this._tln,this._tl,this._tr),this.setPlane(this._r,this._brn,this._tr,this._br),this.setPlane(this._b,this._brn,this._br,this._bl),this.setPlane(this._l,this._tln,this._bl,this._tl)}setupRay(s,t){s&&(this._ray.copy(s),this._ray.applyMatrix4(this._inverseTransform),t.ray=this._ray)}setupMatrix(s){this._inverseTransform.copy(s.matrixWorld),this._inverseTransform.invert()}getRequest(s,t,e){const{object:i,box:n,modelId:r}=s;return t.intersectsBox(n)?this.newCastRequest(i,r,e,t):null}getRayAndFrustum(s){this.updateCamera(s.camera);const{bottomLeft:t,topRight:e}=this.getCorners(s.mouse);return{ray:this.screenToCasterPoint(s.mouse,s.dom,s.camera),frustum:this.screenRectToFrustum(t,e,s.dom,s.camera)}}getFrustum(s){return this.updateCamera(s.camera),this.screenRectToFrustum(s.topLeft,s.bottomRight,s.dom,s.camera)}getCorners(s){return{bottomLeft:s.clone().subScalar(this.distance),topRight:s.clone().addScalar(this.distance)}}getResult(s){const{hit:t,frustum:e,ray:i,model:n}=s,r={};return this.setPoint(n,t,r),this.setNormal(n,t,r),this.setDistance(n,t,r),this.setRayDistance(n,t,r),this.setBasicHitData(n,t,r,i,e),this.setSnapEdge(n,t,r,"snappedEdgeP1"),this.setSnapEdge(n,t,r,"snappedEdgeP2"),r.facePoints=t.facePoints,r.faceIndices=t.faceIndices,r}updateCamera(s){s.updateProjectionMatrix(),s.updateWorldMatrix(!0,!0)}newCastRequest(s,t,e,i){this.setupMatrix(s);const n={};return n.class=an.RAYCAST,n.modelId=t,this.setupRay(e,n),Ho.transform(i,this._inverseTransform,this._frustum),n.frustum=this._frustum,n}setSnapEdge(s,t,e,i){if(t[i]){const n=new F;n.copy(t[i]),n.applyMatrix4(s.object.matrixWorld),e[i]=n}else e[i]=void 0}setNormal(s,t,e){if(t.normal){const i=new F;return i.copy(t.normal),i.transformDirection(s.object.matrixWorld),i.normalize(),void(e.normal=i)}e.normal=void 0}setDistance(s,t,e){const i=Math.sqrt(t.cameraSquaredDistance),n=s.object.matrixWorld.getMaxScaleOnAxis();e.distance=i*n}setPoint(s,t,e){const i=new F;i.copy(t.point),i.applyMatrix4(s.object.matrixWorld),e.point=i}newRaycastSnapResult(s,t,e,i){const n=[];for(const r of s.results){const o=this.getResult({hit:r,frustum:t,ray:e,model:i});n.push(o)}return n}newRectangleCastResponse(s,t){return{localIds:s.localIds,fragments:t.list.get(s.modelId)}}setRayDistance(s,t,e){if(t.raySquaredDistance===void 0)e.rayDistance=void 0;else{const i=s.object.matrixWorld.getMaxScaleOnAxis(),n=Math.sqrt(t.raySquaredDistance);e.rayDistance=n*i}}setBasicHitData(s,t,e,i,n){e.itemId=t.itemId,e.localId=t.localId,e.object=s.object,e.fragments=s,e.ray=i,e.frustum=n,e.representationClass=t.representationClass,e.snappingClass=t.snappingClass}},LS=class{async resetVisible(s){await s.threads.invoke(s.modelId,"resetVisible")}async getItemsByVisibility(s,t){return s.threads.invoke(s.modelId,"getItemsByVisibility",[t])}async getVisible(s,t){return s.threads.invoke(s.modelId,"getVisible",[t])}},ap=class{};S(ap,"vertex",`
            #include <common>
            #include <clipping_planes_pars_vertex>

            attribute float itemFilter;
            uniform vec2 lodSize;
            attribute vec3 itemFirst;
            attribute vec3 itemLast;

            float lodWidth = 2.0;
            
            void cutLodLine(const in vec4 first, inout vec4 second ) {
                float projValue1 = projectionMatrix[2][2];
                float projValue2 = projectionMatrix[3][2];
                float approxResult = -(projValue2 / projValue1) / 2.0;
                float diff1 = approxResult - first.z;
                float diff2 = second.z - first.z;
                float cutFilter = diff1 / diff2;
                second.xyz = mix(first.xyz, second.xyz, cutFilter);
            }
                
            void main() {
                if (itemFilter == 0.0) {
                    gl_Position = vec4(0,0,0,0);
                    return;
                }

                vec4 rawFirst = vec4(itemFirst, 1.0);
                vec4 rawLast = vec4(itemLast, 1.0);
                vec4 first = modelViewMatrix * rawFirst;
                vec4 last = modelViewMatrix * rawLast;
                
                bool lodPerspective = projectionMatrix[2][3] == -1.0;
                if (lodPerspective) {
                    bool firstCut = first.z < 0.0 && last.z >= 0.0;
                    bool lastCut = last.z < 0.0 && first.z >= 0.0;
                    if (firstCut) {
                        cutLodLine( first, last );
                    } else if (lastCut) {
                        cutLodLine( last, first );
                    }
                }

                vec4 firstCut = projectionMatrix * first;
                vec4 lastCut = projectionMatrix * last;
                vec3 firstNdc = firstCut.xyz / firstCut.w;
                vec3 lastNdc = lastCut.xyz / lastCut.w;

                vec2 lodOrientation = lastNdc.xy - firstNdc.xy;

                float lodRatio = lodSize.x / lodSize.y;
                lodOrientation.x *= lodRatio;
                lodOrientation = normalize(lodOrientation);
                
                vec2 lodDistance = vec2(lodOrientation.y, - lodOrientation.x);
                lodOrientation.x /= lodRatio;
                lodDistance.x /= lodRatio;

                if (position.x < 0.0) { 
                    lodDistance *= - 1.0;
                }

                if (position.y < 0.0) {
                    lodDistance += -lodOrientation;
                } else if (position.y > 1.0) {
                    lodDistance += lodOrientation;
                }

                lodDistance *= lodWidth;
                lodDistance /= lodSize.y;

                bool isFirst = position.y < 0.5;
                vec4 lodPosition = isFirst ? firstCut : lastCut;
                lodDistance *= lodPosition.w;
                lodPosition.xy += lodDistance;
                gl_Position = lodPosition;

                vec4 mvPosition = isFirst ? first : last;
                #include <clipping_planes_vertex>
            }
    `),S(ap,"fragment",`
            #include <common>
            #include <clipping_planes_pars_fragment>

            uniform vec3 lodColor;
            uniform float lodOpacity;

            void main() {
                #include <clipping_planes_fragment>
                gl_FragColor = vec4(lodColor, lodOpacity);
                #include <colorspace_fragment>
            }
    `);const Mh=class Ar{static setupLodMeshResize(t){t.onBeforeRender=e=>{e.getSize(t.material[0].lodSize)}}static setupLodAttributes(t){t.setIndex(Ar.indices),t.setAttribute("position",Ar.vertices)}static setLodBuffer(t,e,i){let n=t.getItemFirst(),r=t.getItemLast(),o=this.setItemFirst(t,n,e,r);({itemFirst:n,dataBuffer:o,itemLast:r}=this.resetAttributes(n,o,e,r)),this.setupFinish(i,o),t.setAttribute("itemFirst",n),t.setAttribute("itemLast",r)}static setLodVisibility(t,e){const i=this.setupItemFilter(t);this.applyVisibilityState(t,e,i),i.needsUpdate=!0}static getInterAttribute(t,e){return t.getAttribute(e)}static computeLodSphere(t){if(!t.boundingSphere)return;const e=t.getItemFirst();if(e){const i=Ar.getLodMidPoint(t,e),n=Ar.getLodRadius(i,e);t.boundingSphere.radius=n}}static newLodMaterialParams(t){const e={lodColor:{value:new xt(t.color)},lodSize:{value:new Bt(1,1)},lodOpacity:{value:t.opacity??1}};return{uniforms:Bc.merge([nr.common,e]),transparent:t.transparent??!1,vertexShader:ap.vertex,fragmentShader:ap.fragment}}static setLodFilter(t,e){const i=t.getItemFilter(),n=i.array;for(let r=0;r<e.position.length;++r){const o=e.position[r]/2,a=e.size[r]/2;a===4294967295?n.fill(1,o):n.fill(1,o,o+a)}i.needsUpdate=!0}static getInstancedAttribute(t,e){return t.getAttribute(e)}static computeLodBox(t){if(!t.boundingBox)return;const e=t.getItemFirst();if(e){const i=e.data.array;t.boundingBox.setFromArray(i)}else t.boundingBox.makeEmpty()}static setDataBuffer(t,e,i){return(t=e.data).array=i,t.needsUpdate=!0,t}static disposeAllData(t){delete t.attributes.itemFilter,delete t.attributes.position,t.index=null,t.dispose(),Ar.setupLodAttributes(t)}static setItemFirst(t,e,i,n){let r=null;return e&&(i.length===e.data.array.length?r=this.setDataBuffer(r,e,i):(e=void 0,this.disposeAllData(t))),r}static setupFinish(t,e){t&&(e.onUploadCallback=t)}static resetAttributes(t,e,i,n){return t||(e=new Xo(i,6,1),t=new Js(e,3,0),n=new Js(e,3,3)),{itemFirst:t,dataBuffer:e,itemLast:n}}static setupItemFilter(t){const e=t.getItemFirst().count;let i=t.getItemFilter();return i?i.array.fill(0):(i=new kx(new Uint8Array(e),1),t.setAttribute("itemFilter",i)),i}static applyVisibilityState(t,e,i){e!==!0?e&&this.setLodFilter(t,e):i.array.fill(1)}static getLodMidPoint(t,e){const i=t.boundingSphere.center;return this.tempBox.setFromArray(e.data.array),this.tempBox.getCenter(i),i}static getLodRadius(t,e){let i=0;const n=e.data.array.length;for(let r=0;r<n;r+=3){const o=e.data.array;Ar.tempVec.fromArray(o,r);const a=t.distanceToSquared(Ar.tempVec);i=Math.max(i,a)}return Math.sqrt(i)}};S(Mh,"tempVec",new F),S(Mh,"tempBox",new Tt),S(Mh,"vertices",new Us([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),S(Mh,"indices",new Dx([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5],1));let sn=Mh,kb=class extends lt{constructor(s,t){super(s,t),S(this,"geometry"),S(this,"material"),this.geometry=s,this.material=t,sn.setupLodMeshResize(this)}},NS=class extends C_{constructor(){super(),S(this,"isLODGeometry",!0),sn.setupLodAttributes(this)}isFiltered(){return!!this.getItemFilter()}computeBoundingBox(){this.boundingBox||(this.boundingBox=new Tt),sn.computeLodBox(this)}applyMatrix4(s){return this.applyTransformToBuffers(s),this.updateBounds(),this}computeBoundingSphere(){this.boundingSphere||(this.boundingSphere=new ws),sn.computeLodSphere(this)}getItemFilter(){return sn.getInstancedAttribute(this,"itemFilter")}getItemLast(){return sn.getInterAttribute(this,"itemLast")}getItemFirst(){return sn.getInterAttribute(this,"itemFirst")}applyTransformToBuffers(s){this.getItemFirst().applyMatrix4(s),this.getItemLast().applyMatrix4(s)}updateBounds(){this.boundingBox&&this.computeBoundingBox(),this.boundingSphere&&this.computeBoundingSphere()}},MS=class extends $c{constructor(s){super(sn.newLodMaterialParams(s)),S(this,"isLodMaterial",!0),S(this,"isLineMaterial",!0),this.clipping=!0,this.lights=!1,this.needsUpdate=!0}get lodSize(){return this.uniforms.lodSize.value}set lodColor(s){this.uniforms.lodColor.value=s}set lodSize(s){this.uniforms.lodSize.value.copy(s)}get lodColor(){return this.uniforms.lodColor.value}},P_=class{constructor(){S(this,"list",new Wt),S(this,"_modelMaterialMapping",new Map),S(this,"_definitions",new Map),S(this,"_idGenerator",new O_),S(this,"white",4294967295)}static resetColors(s){for(const t of s){if(!t||!t.color)continue;const{color:e}=t;if(e.isColor)continue;const{r:i,g:n,b:r}=e;t.color=new xt(i,n,r)}}dispose(s){this._definitions.delete(s);const t=this._modelMaterialMapping.get(s);if(t){for(const e of t){const i=this.list.get(e);i&&(i.dispose(),this.list.delete(e))}this._modelMaterialMapping.delete(s)}}get(s,t){const{modelId:e,objectClass:i,currentLod:n,templateId:r}=t;if(!e||i===void 0||n===void 0)throw new Error("Fragments: material definition information is missing to create the material.");this._idGenerator.fromMaterialData({modelId:e,objectClass:i,currentLod:n,templateId:r,...s});const{value:o}=this._idGenerator;return this.getUniqueMaterial(o,s,t)}addDefinitions(s,t){const e=this._definitions.get(s);e?e.push(...t):this._definitions.set(s,t)}createHighlights(s,t){const{tileData:{highlightData:e,highlightIds:i},modelId:n,material:r}=t,{geometry:o}=s,a=s.material.slice(0,2),l=new Map,h=this._definitions.get(n);if(!h)return a;for(let c=0;c<e.position.length;c++){const u=i[c];this.processHighlight(l,u,h,r,t,a);const p=e.position[c],d=e.size[c],_=d===this.white?1/0:d;o.addGroup(p,_,l.get(i[c]))}return a}getFromRequest(s){const{material:t,modelId:e}=s,i=this._definitions.get(e),n=i==null?void 0:i[t];if(!n)throw new Error(`Fragments: Missing mesh material for index ${t}`);return this.get(n,s)}newLODMaterial(s,t){const{data:e}=s,i=new xt(e.color);t.currentLod===Yt.WIRES&&i.multiplyScalar(.85);const n={color:i,...this.getParameters(e)},r=new MS(n);return r.userData={customId:e.customId},r}getParameters(s){const{opacity:t,transparent:e}=s;return{opacity:t,transparent:e||t<1,clipIntersection:!1}}new(s,t){const{objectClass:e,templateId:i}=t;let n;if(e===zs.SHELL)n=new I_({color:s.color,transparent:s.opacity<1,opacity:s.opacity,userData:{customId:s.customId},depthTest:s.depthTest??!0});else{if(e!==zs.LINE)throw new Error("Fragments: Unsupported object class");n=this.newLODMaterial({data:s,instancing:i!==void 0},t)}return n}addMaterialToModel(s,t){let e=this._modelMaterialMapping.get(s);e||(e=new Set,this._modelMaterialMapping.set(s,e)),e.add(t)}processHighlight(s,t,e,i,n,r){if(!s.has(t)){const o={...e[i],...e[t]},a=this.get(o,n);r.push(a),s.set(t,r.length-1)}}getUniqueMaterial(s,t,e){const i=e.modelId;let n=this.list.get(s);return n||(n=this.new(t,e),this.list.set(s,n),this.addMaterialToModel(i,s),n)}},DS=class{async getHighlight(s,t){const e=await s.threads.invoke(s.modelId,"getHighlight",[t]);return P_.resetColors(e),e}async highlight(s,t,e){await s.threads.invoke(s.modelId,"highlight",[t,e])}async getHighlightItemIds(s){return s.threads.invoke(s.modelId,"getHighlightItemIds")}async resetHighlight(s,t){await s.threads.invoke(s.modelId,"resetHighlight",[t])}},kS=class{async getSection(s,t,e){const i=[t,e];return await s.threads.invoke(s.modelId,"getSection",i)}},zS=class{async dispose(s,t,e){t.list.delete(s.modelId),await this.requestModelDelete(s),s.threads.delete(s.modelId),this.deleteAllTiles(s),t.materials.dispose(s.modelId),e.dispose()}async getBuffer(s,t){return s.threads.invoke(s.modelId,"getBuffer",[t])}async getCategories(s){return s.threads.invoke(s.modelId,"getCategories")}async getMaxLocalId(s){return s.threads.invoke(s.modelId,"getMaxLocalId")}async getLocalIdsByGuids(s,t){return s.threads.invoke(s.modelId,"getLocalIdsByGuids",[t])}async getSpatialStructure(s){return s.threads.invoke(s.modelId,"getSpatialStructure")}async getItemsWithGeometry(s){return(await s.threads.invoke(s.modelId,"getItemsWithGeometry",[])).map(t=>s.getItem(t))}async getItemsWithGeometryCategories(s){return s.threads.invoke(s.modelId,"getItemsWithGeometryCategories",[])}async getItemsIdsWithGeometry(s){return s.threads.invoke(s.modelId,"getItemsWithGeometry",[])}async getItemsOfCategories(s,t){const e=[t];return await s.threads.invoke(s.modelId,"getItemsOfCategories",e)}async getItemsByQuery(s,t){const e=[t];return await s.threads.invoke(s.modelId,"getItemsByQuery",e)}async getMetadata(s){return s.threads.invoke(s.modelId,"getMetadata",[])}async getGuidsByLocalIds(s,t){return s.threads.invoke(s.modelId,"getGuidsByLocalIds",[t])}async requestModelDelete(s){await s.threads.fetch({class:an.DELETE_MODEL,modelId:s.modelId})}deleteAllTiles(s){for(const[t]of s.tiles)s.tiles.delete(t)}},US=class{async getSequenced(s,t,e,i){const n=[t,e,i];return await s.threads.invoke(s.modelId,"getSequenced",n)}},BS=class{constructor(s,t,e){S(this,"attrsChanges",new Map),S(this,"relsChanges",new Map),S(this,"threads"),S(this,"tiles",new Wt),S(this,"object",new yi),S(this,"graphicsQuality",0),S(this,"_boxManager",new IS),S(this,"_itemsManager",new PS),S(this,"_coordinatesManager",new xS),S(this,"_setupManager",new CS),S(this,"_viewManager",new FS),S(this,"_raycastManager",new RS),S(this,"_visibilityManager",new LS),S(this,"_highlightManager",new DS),S(this,"_sectionManager",new kS),S(this,"_dataManager",new zS),S(this,"_sequenceManager",new US),S(this,"_bbox",new Tt),S(this,"_alignmentsManager"),S(this,"_meshManager"),S(this,"_isProcessing",!1),S(this,"_isLoaded",!1),S(this,"_frozen",!1),S(this,"_isSetup",!1),this.object.name=s,this.object.up.set(0,0,1),this._meshManager=t,this.threads=e,this._alignmentsManager=new ES(this),this.tiles.onItemSet.add(({value:i})=>this.object.add(i)),this.tiles.onBeforeDelete.add(({value:i})=>{this.object.remove(i),i.geometry.dispose(),en.forEach(i.material,n=>n.dispose())})}get modelId(){return this.object.name}get box(){return this._bbox.clone().applyMatrix4(this.object.matrixWorld)}get isBusy(){const s=this._meshManager.requests.arePending;return!this._isLoaded||this._isProcessing||s}get frozen(){return!!this._frozen}set frozen(s){s!==this._frozen&&(this._frozen=s,s||this._refreshView())}get getClippingPlanesEvent(){return this._viewManager.getClippingPlanesEvent}set getClippingPlanesEvent(s){this._viewManager.getClippingPlanesEvent=s}async dispose(){this._isLoaded=!1,await this._dataManager.dispose(this,this._meshManager,this._alignmentsManager)}async getSpatialStructure(){return this._dataManager.getSpatialStructure(this)}async getLocalIdsByGuids(s){return this._dataManager.getLocalIdsByGuids(this,s)}async getCategories(){return this._dataManager.getCategories(this)}async getItemsWithGeometryCategories(){return this._dataManager.getItemsWithGeometryCategories(this)}async getItemsWithGeometry(){return this._dataManager.getItemsWithGeometry(this)}async getItemsIdsWithGeometry(){return this._dataManager.getItemsIdsWithGeometry(this)}async getMetadata(){return this._dataManager.getMetadata(this)}async getGuidsByLocalIds(s){return this._dataManager.getGuidsByLocalIds(this,s)}async getBuffer(s=!1){return this._dataManager.getBuffer(this,s)}async getItemsOfCategories(s){return this._dataManager.getItemsOfCategories(this,s)}async getGuids(){return await this.threads.invoke(this.modelId,"getGuids",[])}async getLocalIds(){return await this.threads.invoke(this.modelId,"getLocalIds",[])}async getItemsByQuery(s){return this._dataManager.getItemsByQuery(this,s)}async getItemsMaterialDefinition(s){return await this.threads.invoke(this.modelId,"getItemsMaterialDefinition",[s])}async getItemsGeometry(s){return await this.threads.invoke(this.modelId,"getItemsGeometry",[s])}async getItemsVolume(s){return await this.threads.invoke(this.modelId,"getItemsVolume",[s])}async getAttributeNames(){return await this.threads.invoke(this.modelId,"getAttributeNames",[])}async getAttributeValues(){return await this.threads.invoke(this.modelId,"getAttributeValues",[])}async getAttributesUniqueValues(s){return await this.threads.invoke(this.modelId,"getAttributesUniqueValues",[s])}async getAttributeTypes(){return await this.threads.invoke(this.modelId,"getAttributeTypes",[])}async getRelationNames(){return await this.threads.invoke(this.modelId,"getRelationNames",[])}async getMaxLocalId(){return this._dataManager.getMaxLocalId(this)}getItem(s){return this._itemsManager.getItem(this,s)}async getItemsChildren(s){return this._itemsManager.getItemsChildren(this,s)}async getItemsData(s,t){return this._itemsManager.getItemsData(this,s,t)}async getPositions(s){return this._coordinatesManager.getPositions(this,s)}async getCoordinates(){return this._coordinatesManager.getCoordinates(this)}async getCoordinationMatrix(){return this._coordinatesManager.getCoordinationMatrix(this)}async getMergedBox(s){return this._boxManager.getMergedBox(this,s)}async getBoxes(s){return this._boxManager.getBoxes(this,s)}async getAlignments(){return this._alignmentsManager.getAlignments()}async getHorizontalAlignments(){return this._alignmentsManager.getHorizontalAlignments()}async getVerticalAlignments(){return this._alignmentsManager.getVerticalAlignments()}getAlignmentStyles(){return this._alignmentsManager.getAlignmentStyles()}useCamera(s){this._viewManager.useCamera(s)}async rectangleRaycast(s){return this._raycastManager.rectangleRaycast(this,this._meshManager,s)}async raycast(s){return this._raycastManager.raycast(this,s)}async raycastWithSnapping(s){return this._raycastManager.raycastWithSnapping(this,s)}async setVisible(s,t){const e=[s,t];await this.threads.invoke(this.modelId,"setVisible",e)}async toggleVisible(s){const t=[s];await this.threads.invoke(this.modelId,"toggleVisible",t)}async getItemsByVisibility(s){return this._visibilityManager.getItemsByVisibility(this,s)}async getVisible(s){return this._visibilityManager.getVisible(this,s)}async resetVisible(){return this._visibilityManager.resetVisible(this)}async highlight(s,t){return this._highlightManager.highlight(this,s,t)}async getHighlight(s){return this._highlightManager.getHighlight(this,s)}async resetHighlight(s){return this._highlightManager.resetHighlight(this,s)}async getHighlightItemIds(){return this._highlightManager.getHighlightItemIds(this)}async getSection(s,t){return this._sectionManager.getSection(this,s,t)}async getSequenced(s,t,e){return this._sequenceManager.getSequenced(this,s,t,e)}async handleRequest(s){await this._meshManager.requests.handleRequest(this._meshManager,s)}_finishProcessing(){this._isProcessing=!1}async _refreshView(){this.frozen||(this._isProcessing=!0,await this._viewManager.refreshView(this,this._meshManager))}async _setup(s,t,e){this._isSetup||(this._setupManager.setup(this,this._bbox,s,t,e),this._isLoaded=!0,this._isProcessing=!0,this._isSetup=!0)}},VS=class{constructor(){S(this,"list",[]),S(this,"onFinish",()=>{})}get arePending(){return this.list.length>0}async handleRequest(s,t){if(t.class===an.RECOMPUTE_MESHES)this.add(t.list),t.list=void 0;else if(t.class===an.CREATE_MATERIAL){const{materialDefinitions:e,modelId:i}=t;P_.resetColors(e),s.materials.addDefinitions(i,e),t.materialDefinitions=void 0}else t.class===an.THROW_ERROR&&console.error(t)}add(s){for(const t of s)this.insert(t)||this.list.push(t),t.tileRequestClass===De.FINISH&&this.onFinish()}clean(s){const t=this.list.filter(e=>e.modelId!==s||e.tileRequestClass!==De.FINISH);this.list=t}insert(s){const{modelId:t,tileId:e,tileRequestClass:i,tileData:n}=s;if(e===void 0)return!1;if(i===De.DELETE){const r=this.list.filter(o=>!((o.tileRequestClass===De.CREATE||o.tileRequestClass===De.DELETE)&&o.modelId===t&&o.tileId===e));this.list=r}if(i===De.CREATE){const r=this.list.filter(o=>!(o.tileRequestClass===De.CREATE&&o.modelId===t&&o.tileId===e));this.list=r}if(i===De.UPDATE){const r=this.list.find(o=>o.modelId===t&&o.tileId===e);if(r)return r.tileRequestClass!==De.CREATE&&r.tileRequestClass!==De.UPDATE||(r.tileData=n),!0}return!1}},$S=class{constructor(s){S(this,"_materials"),S(this,"white",4294967295),this._materials=s}createMesh(s,t){const e=this._materials.getFromRequest(t);if(!("isLodMaterial"in e)||!e.isLodMaterial)throw new Error("Fragments: material is not an instance of LodMaterial.");const{positions:i}=t;if(!i)throw new Error("Fragments: no positions provided to create the LOD mesh.");const n=new NS,r=this.deleteAttributeEvent(s);return sn.setLodBuffer(n,i,r),new kb(n,[e])}updateVisibility(s,t){const{geometry:e}=s,{visibilityData:i,highlightData:n}=t;sn.setLodVisibility(e,i),n?(sn.setLodFilter(e,n),Nh.getComplementary(n,(r,o)=>{e.addGroup(r,o,0)})):e.addGroup(0,1/0,0)}processMesh(s,t){const{geometry:e}=s,{tileData:{visibilityData:i},currentLod:n}=t;if(n===Yt.WIRES&&s instanceof kb)this.updateVisibility(s,t.tileData);else if(i&&i.position.length>0)for(let r=0;r<i.position.length;++r){const o=i.size[r]===this.white,a=i.position[r],l=o?1/0:i.size[r];e.addGroup(a,l,0)}}deleteAttributeEvent(s){return function(){delete this.array}}},HS=class{constructor(s){S(this,"list",new Wt),S(this,"materials",new P_),S(this,"lod",new $S(this.materials)),S(this,"requests",new VS),S(this,"updateThreshold",4),S(this,"_updateFinished",!0),S(this,"_onUpdate"),this._onUpdate=s,this.requests.onFinish=()=>this._updateFinished=!0}forceUpdateFinish(s=200){return new Promise(t=>{this._updateFinished=!1;const e=setInterval(()=>{this.update(),this._updateFinished&&(clearInterval(e),t())},s)})}update(){const s=performance.now();for(;this.requests.arePending;){const t=this.requests.list.shift();if(t&&(this.processTileRequest(t),this._onUpdate(),performance.now()-s>this.updateThreshold))return}}setTileData(s,t){const{tileId:e,itemId:i,matrix:n,aabb:r}=t;this.setMeshData(s,e,i,n),this.setupBoundings(s,r),this.updateStatus(s,t)}processTileRequest(s){const{tileRequestClass:t,tileId:e,modelId:i}=s,n=this.list.get(i);if(n)if(t===De.CREATE){const r=this.create(s);this.setTileData(r,s),n.tiles.set(r.userData.tileId,r)}else if(t===De.DELETE)n.tiles.delete(e);else if(t===De.UPDATE){const r=n.tiles.get(e);r&&this.updateStatus(r,s)}else t===De.FINISH&&n._finishProcessing()}createMesh(s){const{indices:t,positions:e,normals:i,itemIds:n,faceIds:r}=s,o=new ye;this.setIndex(o,t),this.setPositions(e,o),this.setNormals(i,o),this.setItemIds(n,o),this.setFaceIds(r,o);const a=this.materials.getFromRequest(s);return new lt(o,[a])}setupBoundings(s,t){const{geometry:e}=s,i=new Tt().copy(t),n=new ws;i.getBoundingSphere(n),e.boundingBox=i,e.boundingSphere=n}create(s){if(s.objectClass===zs.SHELL)return this.createMesh(s);if(s.objectClass===zs.LINE){const t=new ye;return this.lod.createMesh(t,s)}throw new Error(`Fragments: object class ${s.objectClass} is not supported.`)}updateStatus(s,t){const{tileData:{highlightData:e},currentLod:i}=t,{geometry:n}=s;if(n.clearGroups(),this.lod.processMesh(s,t),!e||i===Yt.WIRES)return;const r=this.materials.createHighlights(s,t);s.material=r}cleanAttributeMemory(s,t){s.attributes[t].onUpload(this.deleteAttribute(s))}setPositions(s,t){if(!s)throw new Error("Fragments: no positions provided to create the mesh.");t.setAttribute("position",new Ve(s,3)),this.cleanAttributeMemory(t,"position")}setFaceIds(s,t){s&&(t.setAttribute("color",new Ve(s,3)),this.cleanAttributeMemory(t,"color"))}setIndex(s,t){if(!t)throw new Error("Fragments: no indices provided to create the mesh.");s.setIndex(new Ve(t,1)),s.index.onUpload(this.deleteAttribute(s))}setNormals(s,t){s&&t.setAttribute("normal",new Ve(s,3,!0)),this.cleanAttributeMemory(t,"normal")}setItemIds(s,t){s&&(t.setAttribute("id",new Ve(s,1,!1)),this.cleanAttributeMemory(t,"id"))}deleteAttribute(s){return function(){delete this.array}}setMeshData(s,t,e,i){s.userData={tileId:t,itemId:e},s.matrixAutoUpdate=!1,s.applyMatrix4(i),s.matrix.copy(i)}},jS=class{constructor(){S(this,"_list",new Map),S(this,"_communicationKey",0)}setupInput(s){s.requestId=this._communicationKey++}set(s,t,e){const i=this.newHandler(t,e);this._list.set(s,i)}run(s){const t=this._list.get(s.requestId);this._list.delete(s.requestId),t(s)}newHandler(s,t){return e=>{e.errorInfo?s(e.errorInfo):t(e)}}},jo=class Gi{static newThread(t){return new Worker(t,{type:"module"})}static newUpdater(t,e){return setInterval(t,e)}static getMeshComputeRequest(t,e){return{class:an.RECOMPUTE_MESHES,modelId:t,list:e}}static planeSet(t){const e=[];for(const i of t){const n=this.array(i.normal),r=i.constant,o=new Ht(n,r);e.push(o)}return e}static data(t){var e,i;if((t==null?void 0:t.elements)!==void 0)return Gi.transform(t);if((t==null?void 0:t.origin)!==void 0&&(t==null?void 0:t.direction)!==void 0)return Gi.beam(t);if((t==null?void 0:t.planes)!==void 0)return Gi.frustum(t);const n=(t==null?void 0:t.normal)!==void 0,r=(t==null?void 0:t.constant)!==void 0;if(n&&r)return Gi.plane(t);const o=((e=t[0])==null?void 0:e.normal)!==void 0,a=((i=t[0])==null?void 0:i.constant)!==void 0;if(o&&a)return Gi.planeSet(t);const l=(t==null?void 0:t.x)!==void 0,h=(t==null?void 0:t.y)!==void 0,c=(t==null?void 0:t.z)!==void 0;return l&&h&&c?Gi.array(t):t}static getExecuteRequest(t,e,i){const n=Array.from(i);return{class:an.EXECUTE,modelId:t,function:e,parameters:n}}static plane(t){const e=this.array(t.normal),i=t.constant;return new Ht(e,i)}static getRequestContent(t){const e=[];for(const i of t.list)Gi.setupCreateRequest(i,e),Gi.setupUpdateRequest(i,e);return e}static array(t){const e=new F;return e.set(t.x,t.y,t.z),e}static cleanRequests(t){const e=[],i=Gi;for(const n of t)i.isFinishRequest(n)||e.push(n);return e}static frustum(t){const e=this.planeSet(t.planes),[i,n,r,o,a,l]=e;return new cr(i,n,r,o,a,l)}static beam(t){const e=this.array(t.origin),i=this.array(t.direction);return new Jr(e,i)}static transform(t){const e=new vt;return e.copy(t),e}static deleteUpdater(t){clearInterval(t)}static areCoresAvailable(t){const e=Gi.getCpuCapacity();return t<Math.max(e,2)}static isFinishRequest(t){return t.tileRequestClass===De.FINISH}static setupUpdateRequest(t,e){t.tileRequestClass===De.UPDATE&&this.addAllTileData(t,e)}static getCpuCapacity(){var t;return(t=globalThis.navigator)!=null&&t.hardwareConcurrency?navigator.hardwareConcurrency-3:0}static addAllTileData(t,e){this.addRequestTileData(t,e,"visibilityData"),this.addRequestTileData(t,e,"highlightData",["highlightIds"])}static addRequestContent(t,e,i){if(!e[t])return;const n=e[t].buffer;i.push(n)}static addRequestTileData(t,e,i,n=[]){const r=t.tileData[i];if(r){e.push(r.position.buffer),e.push(r.size.buffer);for(const o of n)e.push(t.tileData[o].buffer)}}static setupCreateRequest(t,e){if(t.tileRequestClass!==De.CREATE)return;const i=this.getCreateRequestIds();for(const n of i)this.addRequestContent(n,t,e);this.addAllTileData(t,e)}static getCreateRequestIds(){return["positions","indices","normals","itemIds"]}},YS=class{constructor(s){S(this,"_handlers",new jS),S(this,"_handleInput"),S(this,"_port"),S(this,"onInput",t=>{t.data.toMainThread?this._handlers.run(t.data):this.manageInput(t.data)}),this._handleInput=s}fetchMeshCompute(s,t){const e=jo,i=e.getMeshComputeRequest(s,t),n=e.getRequestContent(i);this.fetch(i,n)}fetch(s,t){return this._handlers.setupInput(s),new Promise((e,i)=>{this._handlers.set(s.requestId,i,e),this.executeConnection(s,t)})}init(s){this._port=s,this.initConnection(s)}initConnection(s){s.onmessage=this.onInput}async fetchConnection(s){if(!this._port)throw new Error("Fragments: Connection not initialized");return this._port}async executeConnection(s,t){(await this.fetchConnection(s)).postMessage(s,t)}async manageOutput(s){const t=await this.fetchConnection(s);s.toMainThread=!0,t.postMessage(s)}async manageConnection(s){try{await this._handleInput(s)}catch(t){s.errorInfo=t.toString(),console.error(t)}}async manageInput(s){await this.manageConnection(s),await this.manageOutput(s)}},WS=class{constructor(s){S(this,"_modelThread",new Map),S(this,"_threadsModelAmount",new Map),S(this,"_threadPort",new Map),S(this,"_threadPath"),S(this,"_placeholder"),this._placeholder={},this._threadPath=s}get path(){return this._threadPath}usePlaceholder(s){this._modelThread.set(s,this._placeholder)}getAmount(s){return this._threadsModelAmount.get(s)}getThread(s){return this._modelThread.get(s)}getAndCheckThread(s){const t=this._modelThread.get(s);if(t===this._placeholder)throw new Error("Fragments: Error fetching thread!");return t}set(s,t){this._modelThread.set(s,t)}deleteModel(s){const t=this.getThreadSafe(s),e=this.getAmountSafe(t)-1;this.setAmount(t,e),this._modelThread.delete(s)}getThreadSafe(s){const t=this.getThread(s);if(!t)throw new Error(`Fragments: Thread for model ${s} not found`);return t}deleteThread(s){this._threadsModelAmount.delete(s),this._threadPort.delete(s),s.terminate()}getThreadAmount(){return this._threadsModelAmount.size}balanceThreadLoad(s){const{lessBusyThread:t,modelAmount:e}=this.getLessBusyThread();return this._threadsModelAmount.set(t,e+1),this._modelThread.set(s.modelId,t),this._threadPort.get(t)}getAmountSafe(s){const t=this.getAmount(s);if(!t)throw new Error(`Fragments: Amount for thread ${s} not found`);return t}setPort(s,t){this._threadPort.set(s,t)}setAmount(s,t){this._threadsModelAmount.set(s,t)}getPort(s){return this._threadPort.get(s)}getLessBusyThread(){let s=Number.MAX_VALUE,t=this._threadsModelAmount.keys().next().value;for(const[e,i]of this._threadsModelAmount)i<s&&(s=i,t=e);return{lessBusyThread:t,modelAmount:s}}},GS=class extends YS{constructor(s,t){super(s),S(this,"_data"),this._data=new WS(t)}delete(s){const t=this._data.getThreadSafe(s),e=this._data.getAmountSafe(t)-1;this._data.deleteModel(s),e===0&&this._data.deleteThread(t)}async invoke(s,t,e=[]){const i=jo.getExecuteRequest(s,t,e);return(await this.fetch(i)).result}async fetchConnection(s){const t=this._data.getAndCheckThread(s.modelId);return t?this._data.getPort(t):this.setupNewThread(s)}setupNewThread(s){const t=jo;this._data.usePlaceholder(s.modelId);const e=this._data.getThreadAmount();return t.areCoresAvailable(e)?this.newThread(s,this._data.path):this._data.balanceThreadLoad(s)}setupThread(s){const t=new MessageChannel,e=t.port1,i=t.port2;this.initConnection(e),this._data.setPort(s,e),s.postMessage(i,[i])}newThread(s,t){const e=jo.newThread(t);return this.setupThread(e),this._data.setAmount(e,1),this._data.set(s.modelId,e),this._data.getPort(e)}};/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function Ll(s){let t=s.length;for(;--t>=0;)s[t]=0}const cg=256,qw=286,Kh=30,Jh=15,ug=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Rd=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),qS=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),zb=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Qn=new Array(576);Ll(Qn);const Dh=new Array(60);Ll(Dh);const Cc=new Array(512);Ll(Cc);const tc=new Array(256);Ll(tc);const F_=new Array(29);Ll(F_);const lp=new Array(Kh);function Tf(s,t,e,i,n){this.static_tree=s,this.extra_bits=t,this.extra_base=e,this.elems=i,this.max_length=n,this.has_stree=s&&s.length}let Ub,Bb,Vb;function Af(s,t){this.dyn_tree=s,this.max_code=0,this.stat_desc=t}Ll(lp);const Zw=s=>s<256?Cc[s]:Cc[256+(s>>>7)],Ic=(s,t)=>{s.pending_buf[s.pending++]=255&t,s.pending_buf[s.pending++]=t>>>8&255},Ks=(s,t,e)=>{s.bi_valid>16-e?(s.bi_buf|=t<<s.bi_valid&65535,Ic(s,s.bi_buf),s.bi_buf=t>>16-s.bi_valid,s.bi_valid+=e-16):(s.bi_buf|=t<<s.bi_valid&65535,s.bi_valid+=e)},Un=(s,t,e)=>{Ks(s,e[2*t],e[2*t+1])},Xw=(s,t)=>{let e=0;do e|=1&s,s>>>=1,e<<=1;while(--t>0);return e>>>1},Qw=(s,t,e)=>{const i=new Array(16);let n,r,o=0;for(n=1;n<=Jh;n++)o=o+e[n-1]<<1,i[n]=o;for(r=0;r<=t;r++){let a=s[2*r+1];a!==0&&(s[2*r]=Xw(i[a]++,a))}},$b=s=>{let t;for(t=0;t<qw;t++)s.dyn_ltree[2*t]=0;for(t=0;t<Kh;t++)s.dyn_dtree[2*t]=0;for(t=0;t<19;t++)s.bl_tree[2*t]=0;s.dyn_ltree[512]=1,s.opt_len=s.static_len=0,s.sym_next=s.matches=0},Kw=s=>{s.bi_valid>8?Ic(s,s.bi_buf):s.bi_valid>0&&(s.pending_buf[s.pending++]=s.bi_buf),s.bi_buf=0,s.bi_valid=0},Hb=(s,t,e,i)=>{const n=2*t,r=2*e;return s[n]<s[r]||s[n]===s[r]&&i[t]<=i[e]},Sf=(s,t,e)=>{const i=s.heap[e];let n=e<<1;for(;n<=s.heap_len&&(n<s.heap_len&&Hb(t,s.heap[n+1],s.heap[n],s.depth)&&n++,!Hb(t,i,s.heap[n],s.depth));)s.heap[e]=s.heap[n],e=n,n<<=1;s.heap[e]=i},jb=(s,t,e)=>{let i,n,r,o,a=0;if(s.sym_next!==0)do i=255&s.pending_buf[s.sym_buf+a++],i+=(255&s.pending_buf[s.sym_buf+a++])<<8,n=s.pending_buf[s.sym_buf+a++],i===0?Un(s,n,t):(r=tc[n],Un(s,r+cg+1,t),o=ug[r],o!==0&&(n-=F_[r],Ks(s,n,o)),i--,r=Zw(i),Un(s,r,e),o=Rd[r],o!==0&&(i-=lp[r],Ks(s,i,o)));while(a<s.sym_next);Un(s,256,t)},Of=(s,t)=>{const e=t.dyn_tree,i=t.stat_desc.static_tree,n=t.stat_desc.has_stree,r=t.stat_desc.elems;let o,a,l,h=-1;for(s.heap_len=0,s.heap_max=573,o=0;o<r;o++)e[2*o]!==0?(s.heap[++s.heap_len]=h=o,s.depth[o]=0):e[2*o+1]=0;for(;s.heap_len<2;)l=s.heap[++s.heap_len]=h<2?++h:0,e[2*l]=1,s.depth[l]=0,s.opt_len--,n&&(s.static_len-=i[2*l+1]);for(t.max_code=h,o=s.heap_len>>1;o>=1;o--)Sf(s,e,o);l=r;do o=s.heap[1],s.heap[1]=s.heap[s.heap_len--],Sf(s,e,1),a=s.heap[1],s.heap[--s.heap_max]=o,s.heap[--s.heap_max]=a,e[2*l]=e[2*o]+e[2*a],s.depth[l]=(s.depth[o]>=s.depth[a]?s.depth[o]:s.depth[a])+1,e[2*o+1]=e[2*a+1]=l,s.heap[1]=l++,Sf(s,e,1);while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1],((c,u)=>{const p=u.dyn_tree,d=u.max_code,_=u.stat_desc.static_tree,m=u.stat_desc.has_stree,g=u.stat_desc.extra_bits,f=u.stat_desc.extra_base,b=u.stat_desc.max_length;let y,E,C,I,x,A,O=0;for(I=0;I<=Jh;I++)c.bl_count[I]=0;for(p[2*c.heap[c.heap_max]+1]=0,y=c.heap_max+1;y<573;y++)E=c.heap[y],I=p[2*p[2*E+1]+1]+1,I>b&&(I=b,O++),p[2*E+1]=I,E>d||(c.bl_count[I]++,x=0,E>=f&&(x=g[E-f]),A=p[2*E],c.opt_len+=A*(I+x),m&&(c.static_len+=A*(_[2*E+1]+x)));if(O!==0){do{for(I=b-1;c.bl_count[I]===0;)I--;c.bl_count[I]--,c.bl_count[I+1]+=2,c.bl_count[b]--,O-=2}while(O>0);for(I=b;I!==0;I--)for(E=c.bl_count[I];E!==0;)C=c.heap[--y],C>d||(p[2*C+1]!==I&&(c.opt_len+=(I-p[2*C+1])*p[2*C],p[2*C+1]=I),E--)}})(s,t),Qw(e,h,s.bl_count)},Yb=(s,t,e)=>{let i,n,r=-1,o=t[1],a=0,l=7,h=4;for(o===0&&(l=138,h=3),t[2*(e+1)+1]=65535,i=0;i<=e;i++)n=o,o=t[2*(i+1)+1],++a<l&&n===o||(a<h?s.bl_tree[2*n]+=a:n!==0?(n!==r&&s.bl_tree[2*n]++,s.bl_tree[32]++):a<=10?s.bl_tree[34]++:s.bl_tree[36]++,a=0,r=n,o===0?(l=138,h=3):n===o?(l=6,h=3):(l=7,h=4))},Wb=(s,t,e)=>{let i,n,r=-1,o=t[1],a=0,l=7,h=4;for(o===0&&(l=138,h=3),i=0;i<=e;i++)if(n=o,o=t[2*(i+1)+1],!(++a<l&&n===o)){if(a<h)do Un(s,n,s.bl_tree);while(--a!=0);else n!==0?(n!==r&&(Un(s,n,s.bl_tree),a--),Un(s,16,s.bl_tree),Ks(s,a-3,2)):a<=10?(Un(s,17,s.bl_tree),Ks(s,a-3,3)):(Un(s,18,s.bl_tree),Ks(s,a-11,7));a=0,r=n,o===0?(l=138,h=3):n===o?(l=6,h=3):(l=7,h=4)}};let Gb=!1;const qb=(s,t,e,i)=>{Ks(s,0+(i?1:0),3),Kw(s),Ic(s,e),Ic(s,~e),e&&s.pending_buf.set(s.window.subarray(t,t+e),s.pending),s.pending+=e};var ZS={_tr_init:s=>{Gb||((()=>{let t,e,i,n,r;const o=new Array(16);for(i=0,n=0;n<28;n++)for(F_[n]=i,t=0;t<1<<ug[n];t++)tc[i++]=n;for(tc[i-1]=n,r=0,n=0;n<16;n++)for(lp[n]=r,t=0;t<1<<Rd[n];t++)Cc[r++]=n;for(r>>=7;n<Kh;n++)for(lp[n]=r<<7,t=0;t<1<<Rd[n]-7;t++)Cc[256+r++]=n;for(e=0;e<=Jh;e++)o[e]=0;for(t=0;t<=143;)Qn[2*t+1]=8,t++,o[8]++;for(;t<=255;)Qn[2*t+1]=9,t++,o[9]++;for(;t<=279;)Qn[2*t+1]=7,t++,o[7]++;for(;t<=287;)Qn[2*t+1]=8,t++,o[8]++;for(Qw(Qn,287,o),t=0;t<Kh;t++)Dh[2*t+1]=5,Dh[2*t]=Xw(t,5);Ub=new Tf(Qn,ug,257,qw,Jh),Bb=new Tf(Dh,Rd,0,Kh,Jh),Vb=new Tf(new Array(0),qS,0,19,7)})(),Gb=!0),s.l_desc=new Af(s.dyn_ltree,Ub),s.d_desc=new Af(s.dyn_dtree,Bb),s.bl_desc=new Af(s.bl_tree,Vb),s.bi_buf=0,s.bi_valid=0,$b(s)},_tr_stored_block:qb,_tr_flush_block:(s,t,e,i)=>{let n,r,o=0;s.level>0?(s.strm.data_type===2&&(s.strm.data_type=(a=>{let l,h=4093624447;for(l=0;l<=31;l++,h>>>=1)if(1&h&&a.dyn_ltree[2*l]!==0)return 0;if(a.dyn_ltree[18]!==0||a.dyn_ltree[20]!==0||a.dyn_ltree[26]!==0)return 1;for(l=32;l<cg;l++)if(a.dyn_ltree[2*l]!==0)return 1;return 0})(s)),Of(s,s.l_desc),Of(s,s.d_desc),o=(a=>{let l;for(Yb(a,a.dyn_ltree,a.l_desc.max_code),Yb(a,a.dyn_dtree,a.d_desc.max_code),Of(a,a.bl_desc),l=18;l>=3&&a.bl_tree[2*zb[l]+1]===0;l--);return a.opt_len+=3*(l+1)+5+5+4,l})(s),n=s.opt_len+3+7>>>3,r=s.static_len+3+7>>>3,r<=n&&(n=r)):n=r=e+5,e+4<=n&&t!==-1?qb(s,t,e,i):s.strategy===4||r===n?(Ks(s,2+(i?1:0),3),jb(s,Qn,Dh)):(Ks(s,4+(i?1:0),3),((a,l,h,c)=>{let u;for(Ks(a,l-257,5),Ks(a,h-1,5),Ks(a,c-4,4),u=0;u<c;u++)Ks(a,a.bl_tree[2*zb[u]+1],3);Wb(a,a.dyn_ltree,l-1),Wb(a,a.dyn_dtree,h-1)})(s,s.l_desc.max_code+1,s.d_desc.max_code+1,o+1),jb(s,s.dyn_ltree,s.dyn_dtree)),$b(s),i&&Kw(s)},_tr_tally:(s,t,e)=>(s.pending_buf[s.sym_buf+s.sym_next++]=t,s.pending_buf[s.sym_buf+s.sym_next++]=t>>8,s.pending_buf[s.sym_buf+s.sym_next++]=e,t===0?s.dyn_ltree[2*e]++:(s.matches++,t--,s.dyn_ltree[2*(tc[e]+cg+1)]++,s.dyn_dtree[2*Zw(t)]++),s.sym_next===s.sym_end),_tr_align:s=>{Ks(s,2,3),Un(s,256,Qn),(t=>{t.bi_valid===16?(Ic(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(s)}},ec=(s,t,e,i)=>{let n=65535&s,r=s>>>16&65535,o=0;for(;e!==0;){o=e>2e3?2e3:e,e-=o;do n=n+t[i++]|0,r=r+n|0;while(--o);n%=65521,r%=65521}return n|r<<16};const XS=new Uint32Array((()=>{let s,t=[];for(var e=0;e<256;e++){s=e;for(var i=0;i<8;i++)s=1&s?3988292384^s>>>1:s>>>1;t[e]=s}return t})());var es=(s,t,e,i)=>{const n=XS,r=i+e;s^=-1;for(let o=i;o<r;o++)s=s>>>8^n[255&(s^t[o])];return~s},ea={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Yc={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:QS,_tr_stored_block:dg,_tr_flush_block:KS,_tr_tally:Zr,_tr_align:JS}=ZS,{Z_NO_FLUSH:Xr,Z_PARTIAL_FLUSH:tO,Z_FULL_FLUSH:eO,Z_FINISH:Pi,Z_BLOCK:Zb,Z_OK:fs,Z_STREAM_END:Xb,Z_STREAM_ERROR:Pn,Z_DATA_ERROR:sO,Z_BUF_ERROR:Pf,Z_DEFAULT_COMPRESSION:iO,Z_FILTERED:nO,Z_HUFFMAN_ONLY:mu,Z_RLE:rO,Z_FIXED:oO,Z_DEFAULT_STRATEGY:aO,Z_UNKNOWN:lO,Z_DEFLATED:hp}=Yc,Mo=258,Vn=262,ul=42,Fo=113,kh=666,Ro=(s,t)=>(s.msg=ea[t],t),Qb=s=>2*s-(s>4?9:0),kr=s=>{let t=s.length;for(;--t>=0;)s[t]=0},hO=s=>{let t,e,i,n=s.w_size;t=s.hash_size,i=t;do e=s.head[--i],s.head[i]=e>=n?e-n:0;while(--t);t=n,i=t;do e=s.prev[--i],s.prev[i]=e>=n?e-n:0;while(--t)};let Qr=(s,t,e)=>(t<<s.hash_shift^e)&s.hash_mask;const ai=s=>{const t=s.state;let e=t.pending;e>s.avail_out&&(e=s.avail_out),e!==0&&(s.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+e),s.next_out),s.next_out+=e,t.pending_out+=e,s.total_out+=e,s.avail_out-=e,t.pending-=e,t.pending===0&&(t.pending_out=0))},hi=(s,t)=>{KS(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,t),s.block_start=s.strstart,ai(s.strm)},Qt=(s,t)=>{s.pending_buf[s.pending++]=t},ql=(s,t)=>{s.pending_buf[s.pending++]=t>>>8&255,s.pending_buf[s.pending++]=255&t},pg=(s,t,e,i)=>{let n=s.avail_in;return n>i&&(n=i),n===0?0:(s.avail_in-=n,t.set(s.input.subarray(s.next_in,s.next_in+n),e),s.state.wrap===1?s.adler=ec(s.adler,t,n,e):s.state.wrap===2&&(s.adler=es(s.adler,t,n,e)),s.next_in+=n,s.total_in+=n,n)},Jw=(s,t)=>{let e,i,n=s.max_chain_length,r=s.strstart,o=s.prev_length,a=s.nice_match;const l=s.strstart>s.w_size-Vn?s.strstart-(s.w_size-Vn):0,h=s.window,c=s.w_mask,u=s.prev,p=s.strstart+Mo;let d=h[r+o-1],_=h[r+o];s.prev_length>=s.good_match&&(n>>=2),a>s.lookahead&&(a=s.lookahead);do if(e=t,h[e+o]===_&&h[e+o-1]===d&&h[e]===h[r]&&h[++e]===h[r+1]){r+=2,e++;do;while(h[++r]===h[++e]&&h[++r]===h[++e]&&h[++r]===h[++e]&&h[++r]===h[++e]&&h[++r]===h[++e]&&h[++r]===h[++e]&&h[++r]===h[++e]&&h[++r]===h[++e]&&r<p);if(i=Mo-(p-r),r=p-Mo,i>o){if(s.match_start=t,o=i,i>=a)break;d=h[r+o-1],_=h[r+o]}}while((t=u[t&c])>l&&--n!=0);return o<=s.lookahead?o:s.lookahead},rl=s=>{const t=s.w_size;let e,i,n;do{if(i=s.window_size-s.lookahead-s.strstart,s.strstart>=t+(t-Vn)&&(s.window.set(s.window.subarray(t,t+t-i),0),s.match_start-=t,s.strstart-=t,s.block_start-=t,s.insert>s.strstart&&(s.insert=s.strstart),hO(s),i+=t),s.strm.avail_in===0)break;if(e=pg(s.strm,s.window,s.strstart+s.lookahead,i),s.lookahead+=e,s.lookahead+s.insert>=3)for(n=s.strstart-s.insert,s.ins_h=s.window[n],s.ins_h=Qr(s,s.ins_h,s.window[n+1]);s.insert&&(s.ins_h=Qr(s,s.ins_h,s.window[n+3-1]),s.prev[n&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=n,n++,s.insert--,!(s.lookahead+s.insert<3)););}while(s.lookahead<Vn&&s.strm.avail_in!==0)},t1=(s,t)=>{let e,i,n,r=s.pending_buf_size-5>s.w_size?s.w_size:s.pending_buf_size-5,o=0,a=s.strm.avail_in;do{if(e=65535,n=s.bi_valid+42>>3,s.strm.avail_out<n||(n=s.strm.avail_out-n,i=s.strstart-s.block_start,e>i+s.strm.avail_in&&(e=i+s.strm.avail_in),e>n&&(e=n),e<r&&(e===0&&t!==Pi||t===Xr||e!==i+s.strm.avail_in)))break;o=t===Pi&&e===i+s.strm.avail_in?1:0,dg(s,0,0,o),s.pending_buf[s.pending-4]=e,s.pending_buf[s.pending-3]=e>>8,s.pending_buf[s.pending-2]=~e,s.pending_buf[s.pending-1]=~e>>8,ai(s.strm),i&&(i>e&&(i=e),s.strm.output.set(s.window.subarray(s.block_start,s.block_start+i),s.strm.next_out),s.strm.next_out+=i,s.strm.avail_out-=i,s.strm.total_out+=i,s.block_start+=i,e-=i),e&&(pg(s.strm,s.strm.output,s.strm.next_out,e),s.strm.next_out+=e,s.strm.avail_out-=e,s.strm.total_out+=e)}while(o===0);return a-=s.strm.avail_in,a&&(a>=s.w_size?(s.matches=2,s.window.set(s.strm.input.subarray(s.strm.next_in-s.w_size,s.strm.next_in),0),s.strstart=s.w_size,s.insert=s.strstart):(s.window_size-s.strstart<=a&&(s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,s.insert>s.strstart&&(s.insert=s.strstart)),s.window.set(s.strm.input.subarray(s.strm.next_in-a,s.strm.next_in),s.strstart),s.strstart+=a,s.insert+=a>s.w_size-s.insert?s.w_size-s.insert:a),s.block_start=s.strstart),s.high_water<s.strstart&&(s.high_water=s.strstart),o?4:t!==Xr&&t!==Pi&&s.strm.avail_in===0&&s.strstart===s.block_start?2:(n=s.window_size-s.strstart,s.strm.avail_in>n&&s.block_start>=s.w_size&&(s.block_start-=s.w_size,s.strstart-=s.w_size,s.window.set(s.window.subarray(s.w_size,s.w_size+s.strstart),0),s.matches<2&&s.matches++,n+=s.w_size,s.insert>s.strstart&&(s.insert=s.strstart)),n>s.strm.avail_in&&(n=s.strm.avail_in),n&&(pg(s.strm,s.window,s.strstart,n),s.strstart+=n,s.insert+=n>s.w_size-s.insert?s.w_size-s.insert:n),s.high_water<s.strstart&&(s.high_water=s.strstart),n=s.bi_valid+42>>3,n=s.pending_buf_size-n>65535?65535:s.pending_buf_size-n,r=n>s.w_size?s.w_size:n,i=s.strstart-s.block_start,(i>=r||(i||t===Pi)&&t!==Xr&&s.strm.avail_in===0&&i<=n)&&(e=i>n?n:i,o=t===Pi&&s.strm.avail_in===0&&e===i?1:0,dg(s,s.block_start,e,o),s.block_start+=e,ai(s.strm)),o?3:1)},Ff=(s,t)=>{let e,i;for(;;){if(s.lookahead<Vn){if(rl(s),s.lookahead<Vn&&t===Xr)return 1;if(s.lookahead===0)break}if(e=0,s.lookahead>=3&&(s.ins_h=Qr(s,s.ins_h,s.window[s.strstart+3-1]),e=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),e!==0&&s.strstart-e<=s.w_size-Vn&&(s.match_length=Jw(s,e)),s.match_length>=3)if(i=Zr(s,s.strstart-s.match_start,s.match_length-3),s.lookahead-=s.match_length,s.match_length<=s.max_lazy_match&&s.lookahead>=3){s.match_length--;do s.strstart++,s.ins_h=Qr(s,s.ins_h,s.window[s.strstart+3-1]),e=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart;while(--s.match_length!=0);s.strstart++}else s.strstart+=s.match_length,s.match_length=0,s.ins_h=s.window[s.strstart],s.ins_h=Qr(s,s.ins_h,s.window[s.strstart+1]);else i=Zr(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++;if(i&&(hi(s,!1),s.strm.avail_out===0))return 1}return s.insert=s.strstart<2?s.strstart:2,t===Pi?(hi(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(hi(s,!1),s.strm.avail_out===0)?1:2},da=(s,t)=>{let e,i,n;for(;;){if(s.lookahead<Vn){if(rl(s),s.lookahead<Vn&&t===Xr)return 1;if(s.lookahead===0)break}if(e=0,s.lookahead>=3&&(s.ins_h=Qr(s,s.ins_h,s.window[s.strstart+3-1]),e=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),s.prev_length=s.match_length,s.prev_match=s.match_start,s.match_length=2,e!==0&&s.prev_length<s.max_lazy_match&&s.strstart-e<=s.w_size-Vn&&(s.match_length=Jw(s,e),s.match_length<=5&&(s.strategy===nO||s.match_length===3&&s.strstart-s.match_start>4096)&&(s.match_length=2)),s.prev_length>=3&&s.match_length<=s.prev_length){n=s.strstart+s.lookahead-3,i=Zr(s,s.strstart-1-s.prev_match,s.prev_length-3),s.lookahead-=s.prev_length-1,s.prev_length-=2;do++s.strstart<=n&&(s.ins_h=Qr(s,s.ins_h,s.window[s.strstart+3-1]),e=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart);while(--s.prev_length!=0);if(s.match_available=0,s.match_length=2,s.strstart++,i&&(hi(s,!1),s.strm.avail_out===0))return 1}else if(s.match_available){if(i=Zr(s,0,s.window[s.strstart-1]),i&&hi(s,!1),s.strstart++,s.lookahead--,s.strm.avail_out===0)return 1}else s.match_available=1,s.strstart++,s.lookahead--}return s.match_available&&(i=Zr(s,0,s.window[s.strstart-1]),s.match_available=0),s.insert=s.strstart<2?s.strstart:2,t===Pi?(hi(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(hi(s,!1),s.strm.avail_out===0)?1:2};function _n(s,t,e,i,n){this.good_length=s,this.max_lazy=t,this.nice_length=e,this.max_chain=i,this.func=n}const zh=[new _n(0,0,0,0,t1),new _n(4,4,8,4,Ff),new _n(4,5,16,8,Ff),new _n(4,6,32,32,Ff),new _n(4,4,16,16,da),new _n(8,16,32,32,da),new _n(8,16,128,128,da),new _n(8,32,128,256,da),new _n(32,128,258,1024,da),new _n(32,258,258,4096,da)];function cO(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=hp,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),kr(this.dyn_ltree),kr(this.dyn_dtree),kr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),kr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),kr(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Uh=s=>{if(!s)return 1;const t=s.state;return!t||t.strm!==s||t.status!==ul&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Fo&&t.status!==kh?1:0},e1=s=>{if(Uh(s))return Ro(s,Pn);s.total_in=s.total_out=0,s.data_type=lO;const t=s.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?ul:Fo,s.adler=t.wrap===2?0:1,t.last_flush=-2,QS(t),fs},s1=s=>{const t=e1(s);var e;return t===fs&&((e=s.state).window_size=2*e.w_size,kr(e.head),e.max_lazy_match=zh[e.level].max_lazy,e.good_match=zh[e.level].good_length,e.nice_match=zh[e.level].nice_length,e.max_chain_length=zh[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),t},Kb=(s,t,e,i,n,r)=>{if(!s)return Pn;let o=1;if(t===iO&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),n<1||n>9||e!==hp||i<8||i>15||t<0||t>9||r<0||r>oO||i===8&&o!==1)return Ro(s,Pn);i===8&&(i=9);const a=new cO;return s.state=a,a.strm=s,a.status=ul,a.wrap=o,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=n+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<n+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=r,a.method=e,s1(s)};var sc={deflateInit:(s,t)=>Kb(s,t,hp,15,8,aO),deflateInit2:Kb,deflateReset:s1,deflateResetKeep:e1,deflateSetHeader:(s,t)=>Uh(s)||s.state.wrap!==2?Pn:(s.state.gzhead=t,fs),deflate:(s,t)=>{if(Uh(s)||t>Zb||t<0)return s?Ro(s,Pn):Pn;const e=s.state;if(!s.output||s.avail_in!==0&&!s.input||e.status===kh&&t!==Pi)return Ro(s,s.avail_out===0?Pf:Pn);const i=e.last_flush;if(e.last_flush=t,e.pending!==0){if(ai(s),s.avail_out===0)return e.last_flush=-1,fs}else if(s.avail_in===0&&Qb(t)<=Qb(i)&&t!==Pi)return Ro(s,Pf);if(e.status===kh&&s.avail_in!==0)return Ro(s,Pf);if(e.status===ul&&e.wrap===0&&(e.status=Fo),e.status===ul){let n=hp+(e.w_bits-8<<4)<<8,r=-1;if(r=e.strategy>=mu||e.level<2?0:e.level<6?1:e.level===6?2:3,n|=r<<6,e.strstart!==0&&(n|=32),n+=31-n%31,ql(e,n),e.strstart!==0&&(ql(e,s.adler>>>16),ql(e,65535&s.adler)),s.adler=1,e.status=Fo,ai(s),e.pending!==0)return e.last_flush=-1,fs}if(e.status===57){if(s.adler=0,Qt(e,31),Qt(e,139),Qt(e,8),e.gzhead)Qt(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),Qt(e,255&e.gzhead.time),Qt(e,e.gzhead.time>>8&255),Qt(e,e.gzhead.time>>16&255),Qt(e,e.gzhead.time>>24&255),Qt(e,e.level===9?2:e.strategy>=mu||e.level<2?4:0),Qt(e,255&e.gzhead.os),e.gzhead.extra&&e.gzhead.extra.length&&(Qt(e,255&e.gzhead.extra.length),Qt(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(s.adler=es(s.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=69;else if(Qt(e,0),Qt(e,0),Qt(e,0),Qt(e,0),Qt(e,0),Qt(e,e.level===9?2:e.strategy>=mu||e.level<2?4:0),Qt(e,3),e.status=Fo,ai(s),e.pending!==0)return e.last_flush=-1,fs}if(e.status===69){if(e.gzhead.extra){let n=e.pending,r=(65535&e.gzhead.extra.length)-e.gzindex;for(;e.pending+r>e.pending_buf_size;){let a=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+a),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>n&&(s.adler=es(s.adler,e.pending_buf,e.pending-n,n)),e.gzindex+=a,ai(s),e.pending!==0)return e.last_flush=-1,fs;n=0,r-=a}let o=new Uint8Array(e.gzhead.extra);e.pending_buf.set(o.subarray(e.gzindex,e.gzindex+r),e.pending),e.pending+=r,e.gzhead.hcrc&&e.pending>n&&(s.adler=es(s.adler,e.pending_buf,e.pending-n,n)),e.gzindex=0}e.status=73}if(e.status===73){if(e.gzhead.name){let n,r=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>r&&(s.adler=es(s.adler,e.pending_buf,e.pending-r,r)),ai(s),e.pending!==0)return e.last_flush=-1,fs;r=0}n=e.gzindex<e.gzhead.name.length?255&e.gzhead.name.charCodeAt(e.gzindex++):0,Qt(e,n)}while(n!==0);e.gzhead.hcrc&&e.pending>r&&(s.adler=es(s.adler,e.pending_buf,e.pending-r,r)),e.gzindex=0}e.status=91}if(e.status===91){if(e.gzhead.comment){let n,r=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>r&&(s.adler=es(s.adler,e.pending_buf,e.pending-r,r)),ai(s),e.pending!==0)return e.last_flush=-1,fs;r=0}n=e.gzindex<e.gzhead.comment.length?255&e.gzhead.comment.charCodeAt(e.gzindex++):0,Qt(e,n)}while(n!==0);e.gzhead.hcrc&&e.pending>r&&(s.adler=es(s.adler,e.pending_buf,e.pending-r,r))}e.status=103}if(e.status===103){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(ai(s),e.pending!==0))return e.last_flush=-1,fs;Qt(e,255&s.adler),Qt(e,s.adler>>8&255),s.adler=0}if(e.status=Fo,ai(s),e.pending!==0)return e.last_flush=-1,fs}if(s.avail_in!==0||e.lookahead!==0||t!==Xr&&e.status!==kh){let n=e.level===0?t1(e,t):e.strategy===mu?((r,o)=>{let a;for(;;){if(r.lookahead===0&&(rl(r),r.lookahead===0)){if(o===Xr)return 1;break}if(r.match_length=0,a=Zr(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,a&&(hi(r,!1),r.strm.avail_out===0))return 1}return r.insert=0,o===Pi?(hi(r,!0),r.strm.avail_out===0?3:4):r.sym_next&&(hi(r,!1),r.strm.avail_out===0)?1:2})(e,t):e.strategy===rO?((r,o)=>{let a,l,h,c;const u=r.window;for(;;){if(r.lookahead<=Mo){if(rl(r),r.lookahead<=Mo&&o===Xr)return 1;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=3&&r.strstart>0&&(h=r.strstart-1,l=u[h],l===u[++h]&&l===u[++h]&&l===u[++h])){c=r.strstart+Mo;do;while(l===u[++h]&&l===u[++h]&&l===u[++h]&&l===u[++h]&&l===u[++h]&&l===u[++h]&&l===u[++h]&&l===u[++h]&&h<c);r.match_length=Mo-(c-h),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=3?(a=Zr(r,1,r.match_length-3),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(a=Zr(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),a&&(hi(r,!1),r.strm.avail_out===0))return 1}return r.insert=0,o===Pi?(hi(r,!0),r.strm.avail_out===0?3:4):r.sym_next&&(hi(r,!1),r.strm.avail_out===0)?1:2})(e,t):zh[e.level].func(e,t);if(n!==3&&n!==4||(e.status=kh),n===1||n===3)return s.avail_out===0&&(e.last_flush=-1),fs;if(n===2&&(t===tO?JS(e):t!==Zb&&(dg(e,0,0,!1),t===eO&&(kr(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),ai(s),s.avail_out===0))return e.last_flush=-1,fs}return t!==Pi?fs:e.wrap<=0?Xb:(e.wrap===2?(Qt(e,255&s.adler),Qt(e,s.adler>>8&255),Qt(e,s.adler>>16&255),Qt(e,s.adler>>24&255),Qt(e,255&s.total_in),Qt(e,s.total_in>>8&255),Qt(e,s.total_in>>16&255),Qt(e,s.total_in>>24&255)):(ql(e,s.adler>>>16),ql(e,65535&s.adler)),ai(s),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?fs:Xb)},deflateEnd:s=>{if(Uh(s))return Pn;const t=s.state.status;return s.state=null,t===Fo?Ro(s,sO):fs},deflateSetDictionary:(s,t)=>{let e=t.length;if(Uh(s))return Pn;const i=s.state,n=i.wrap;if(n===2||n===1&&i.status!==ul||i.lookahead)return Pn;if(n===1&&(s.adler=ec(s.adler,t,e,0)),i.wrap=0,e>=i.w_size){n===0&&(kr(i.head),i.strstart=0,i.block_start=0,i.insert=0);let l=new Uint8Array(i.w_size);l.set(t.subarray(e-i.w_size,e),0),t=l,e=i.w_size}const r=s.avail_in,o=s.next_in,a=s.input;for(s.avail_in=e,s.next_in=0,s.input=t,rl(i);i.lookahead>=3;){let l=i.strstart,h=i.lookahead-2;do i.ins_h=Qr(i,i.ins_h,i.window[l+3-1]),i.prev[l&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=l,l++;while(--h);i.strstart=l,i.lookahead=2,rl(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,s.next_in=o,s.input=a,s.avail_in=r,i.wrap=n,fs},deflateInfo:"pako deflate (from Nodeca project)"};const uO=(s,t)=>Object.prototype.hasOwnProperty.call(s,t);var i1=function(s){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const i in e)uO(e,i)&&(s[i]=e[i])}}return s},n1=s=>{let t=0;for(let i=0,n=s.length;i<n;i++)t+=s[i].length;const e=new Uint8Array(t);for(let i=0,n=0,r=s.length;i<r;i++){let o=s[i];e.set(o,n),n+=o.length}return e};let r1=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r1=!1}const xc=new Uint8Array(256);for(let s=0;s<256;s++)xc[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;xc[254]=xc[254]=1;var R_=s=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(s);let t,e,i,n,r,o=s.length,a=0;for(n=0;n<o;n++)e=s.charCodeAt(n),(64512&e)==55296&&n+1<o&&(i=s.charCodeAt(n+1),(64512&i)==56320&&(e=65536+(e-55296<<10)+(i-56320),n++)),a+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(a),r=0,n=0;r<a;n++)e=s.charCodeAt(n),(64512&e)==55296&&n+1<o&&(i=s.charCodeAt(n+1),(64512&i)==56320&&(e=65536+(e-55296<<10)+(i-56320),n++)),e<128?t[r++]=e:e<2048?(t[r++]=192|e>>>6,t[r++]=128|63&e):e<65536?(t[r++]=224|e>>>12,t[r++]=128|e>>>6&63,t[r++]=128|63&e):(t[r++]=240|e>>>18,t[r++]=128|e>>>12&63,t[r++]=128|e>>>6&63,t[r++]=128|63&e);return t},dO=(s,t)=>{const e=t||s.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(s.subarray(0,t));let i,n;const r=new Array(2*e);for(n=0,i=0;i<e;){let o=s[i++];if(o<128){r[n++]=o;continue}let a=xc[o];if(a>4)r[n++]=65533,i+=a-1;else{for(o&=a===2?31:a===3?15:7;a>1&&i<e;)o=o<<6|63&s[i++],a--;a>1?r[n++]=65533:o<65536?r[n++]=o:(o-=65536,r[n++]=55296|o>>10&1023,r[n++]=56320|1023&o)}}return((o,a)=>{if(a<65534&&o.subarray&&r1)return String.fromCharCode.apply(null,o.length===a?o:o.subarray(0,a));let l="";for(let h=0;h<a;h++)l+=String.fromCharCode(o[h]);return l})(r,n)},pO=(s,t)=>{(t=t||s.length)>s.length&&(t=s.length);let e=t-1;for(;e>=0&&(192&s[e])==128;)e--;return e<0||e===0?t:e+xc[s[e]]>t?e:t},o1=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const a1=Object.prototype.toString,{Z_NO_FLUSH:fO,Z_SYNC_FLUSH:mO,Z_FULL_FLUSH:gO,Z_FINISH:_O,Z_OK:cp,Z_STREAM_END:bO,Z_DEFAULT_COMPRESSION:yO,Z_DEFAULT_STRATEGY:vO,Z_DEFLATED:wO}=Yc;function ic(s){this.options=i1({level:yO,method:wO,chunkSize:16384,windowBits:15,memLevel:8,strategy:vO},s||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o1,this.strm.avail_out=0;let e=sc.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==cp)throw new Error(ea[e]);if(t.header&&sc.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(i=typeof t.dictionary=="string"?R_(t.dictionary):a1.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,e=sc.deflateSetDictionary(this.strm,i),e!==cp)throw new Error(ea[e]);this._dict_set=!0}}function Rf(s,t){const e=new ic(t);if(e.push(s,!0),e.err)throw e.msg||ea[e.err];return e.result}ic.prototype.push=function(s,t){const e=this.strm,i=this.options.chunkSize;let n,r;if(this.ended)return!1;for(r=t===~~t?t:t===!0?_O:fO,typeof s=="string"?e.input=R_(s):a1.call(s)==="[object ArrayBuffer]"?e.input=new Uint8Array(s):e.input=s,e.next_in=0,e.avail_in=e.input.length;;)if(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),(r===mO||r===gO)&&e.avail_out<=6)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else{if(n=sc.deflate(e,r),n===bO)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),n=sc.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===cp;if(e.avail_out!==0){if(r>0&&e.next_out>0)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else if(e.avail_in===0)break}else this.onData(e.output)}return!0},ic.prototype.onData=function(s){this.chunks.push(s)},ic.prototype.onEnd=function(s){s===cp&&(this.result=n1(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};var EO={Deflate:ic,deflate:Rf,deflateRaw:function(s,t){return(t=t||{}).raw=!0,Rf(s,t)},gzip:function(s,t){return(t=t||{}).gzip=!0,Rf(s,t)}};const gu=16209;var CO=function(s,t){let e,i,n,r,o,a,l,h,c,u,p,d,_,m,g,f,b,y,E,C,I,x,A,O;const L=s.state;e=s.next_in,A=s.input,i=e+(s.avail_in-5),n=s.next_out,O=s.output,r=n-(t-s.avail_out),o=n+(s.avail_out-257),a=L.dmax,l=L.wsize,h=L.whave,c=L.wnext,u=L.window,p=L.hold,d=L.bits,_=L.lencode,m=L.distcode,g=(1<<L.lenbits)-1,f=(1<<L.distbits)-1;t:do{d<15&&(p+=A[e++]<<d,d+=8,p+=A[e++]<<d,d+=8),b=_[p&g];e:for(;;){if(y=b>>>24,p>>>=y,d-=y,y=b>>>16&255,y===0)O[n++]=65535&b;else{if(!(16&y)){if(64&y){if(32&y){L.mode=16191;break t}s.msg="invalid literal/length code",L.mode=gu;break t}b=_[(65535&b)+(p&(1<<y)-1)];continue e}for(E=65535&b,y&=15,y&&(d<y&&(p+=A[e++]<<d,d+=8),E+=p&(1<<y)-1,p>>>=y,d-=y),d<15&&(p+=A[e++]<<d,d+=8,p+=A[e++]<<d,d+=8),b=m[p&f];;){if(y=b>>>24,p>>>=y,d-=y,y=b>>>16&255,16&y){if(C=65535&b,y&=15,d<y&&(p+=A[e++]<<d,d+=8,d<y&&(p+=A[e++]<<d,d+=8)),C+=p&(1<<y)-1,C>a){s.msg="invalid distance too far back",L.mode=gu;break t}if(p>>>=y,d-=y,y=n-r,C>y){if(y=C-y,y>h&&L.sane){s.msg="invalid distance too far back",L.mode=gu;break t}if(I=0,x=u,c===0){if(I+=l-y,y<E){E-=y;do O[n++]=u[I++];while(--y);I=n-C,x=O}}else if(c<y){if(I+=l+c-y,y-=c,y<E){E-=y;do O[n++]=u[I++];while(--y);if(I=0,c<E){y=c,E-=y;do O[n++]=u[I++];while(--y);I=n-C,x=O}}}else if(I+=c-y,y<E){E-=y;do O[n++]=u[I++];while(--y);I=n-C,x=O}for(;E>2;)O[n++]=x[I++],O[n++]=x[I++],O[n++]=x[I++],E-=3;E&&(O[n++]=x[I++],E>1&&(O[n++]=x[I++]))}else{I=n-C;do O[n++]=O[I++],O[n++]=O[I++],O[n++]=O[I++],E-=3;while(E>2);E&&(O[n++]=O[I++],E>1&&(O[n++]=O[I++]))}break}if(64&y){s.msg="invalid distance code",L.mode=gu;break t}b=m[(65535&b)+(p&(1<<y)-1)]}}break}}while(e<i&&n<o);E=d>>3,e-=E,d-=E<<3,p&=(1<<d)-1,s.next_in=e,s.next_out=n,s.avail_in=e<i?i-e+5:5-(e-i),s.avail_out=n<o?o-n+257:257-(n-o),L.hold=p,L.bits=d};const _u=15,IO=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),xO=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),TO=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),AO=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var nc=(s,t,e,i,n,r,o,a)=>{const l=a.bits;let h,c,u,p,d,_,m=0,g=0,f=0,b=0,y=0,E=0,C=0,I=0,x=0,A=0,O=null;const L=new Uint16Array(16),V=new Uint16Array(16);let T,N,v,M=null;for(m=0;m<=_u;m++)L[m]=0;for(g=0;g<i;g++)L[t[e+g]]++;for(y=l,b=_u;b>=1&&L[b]===0;b--);if(y>b&&(y=b),b===0)return n[r++]=20971520,n[r++]=20971520,a.bits=1,0;for(f=1;f<b&&L[f]===0;f++);for(y<f&&(y=f),I=1,m=1;m<=_u;m++)if(I<<=1,I-=L[m],I<0)return-1;if(I>0&&(s===0||b!==1))return-1;for(V[1]=0,m=1;m<_u;m++)V[m+1]=V[m]+L[m];for(g=0;g<i;g++)t[e+g]!==0&&(o[V[t[e+g]]++]=g);if(s===0?(O=M=o,_=20):s===1?(O=IO,M=xO,_=257):(O=TO,M=AO,_=0),A=0,g=0,m=f,d=r,E=y,C=0,u=-1,x=1<<y,p=x-1,s===1&&x>852||s===2&&x>592)return 1;for(;;){T=m-C,o[g]+1<_?(N=0,v=o[g]):o[g]>=_?(N=M[o[g]-_],v=O[o[g]-_]):(N=96,v=0),h=1<<m-C,c=1<<E,f=c;do c-=h,n[d+(A>>C)+c]=T<<24|N<<16|v;while(c!==0);for(h=1<<m-1;A&h;)h>>=1;if(h!==0?(A&=h-1,A+=h):A=0,g++,--L[m]==0){if(m===b)break;m=t[e+o[g]]}if(m>y&&(A&p)!==u){for(C===0&&(C=y),d+=f,E=m-C,I=1<<E;E+C<b&&(I-=L[E+C],!(I<=0));)E++,I<<=1;if(x+=1<<E,s===1&&x>852||s===2&&x>592)return 1;u=A&p,n[u]=y<<24|E<<16|d-r}}return A!==0&&(n[d+A]=m-C<<24|64<<16),a.bits=y,0};const{Z_FINISH:Jb,Z_BLOCK:SO,Z_TREES:bu,Z_OK:Lo,Z_STREAM_END:OO,Z_NEED_DICT:PO,Z_STREAM_ERROR:Oi,Z_DATA_ERROR:t0,Z_MEM_ERROR:e0,Z_BUF_ERROR:FO,Z_DEFLATED:s0}=Yc,Up=16180,yu=16190,qn=16191,Lf=16192,Nf=16194,vu=16199,wu=16200,Mf=16206,ve=16209,i0=s=>(s>>>24&255)+(s>>>8&65280)+((65280&s)<<8)+((255&s)<<24);function RO(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Do=s=>{if(!s)return 1;const t=s.state;return!t||t.strm!==s||t.mode<Up||t.mode>16211?1:0},l1=s=>{if(Do(s))return Oi;const t=s.state;return s.total_in=s.total_out=t.total=0,s.msg="",t.wrap&&(s.adler=1&t.wrap),t.mode=Up,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Lo},h1=s=>{if(Do(s))return Oi;const t=s.state;return t.wsize=0,t.whave=0,t.wnext=0,l1(s)},c1=(s,t)=>{let e;if(Do(s))return Oi;const i=s.state;return t<0?(e=0,t=-t):(e=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Oi:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=e,i.wbits=t,h1(s))},n0=(s,t)=>{if(!s)return Oi;const e=new RO;s.state=e,e.strm=s,e.window=null,e.mode=Up;const i=c1(s,t);return i!==Lo&&(s.state=null),i};let Df,kf,r0=!0;const LO=s=>{if(r0){Df=new Int32Array(512),kf=new Int32Array(32);let t=0;for(;t<144;)s.lens[t++]=8;for(;t<256;)s.lens[t++]=9;for(;t<280;)s.lens[t++]=7;for(;t<288;)s.lens[t++]=8;for(nc(1,s.lens,0,288,Df,0,s.work,{bits:9}),t=0;t<32;)s.lens[t++]=5;nc(2,s.lens,0,32,kf,0,s.work,{bits:5}),r0=!1}s.lencode=Df,s.lenbits=9,s.distcode=kf,s.distbits=5},o0=(s,t,e,i)=>{let n;const r=s.state;return r.window===null&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),i>=r.wsize?(r.window.set(t.subarray(e-r.wsize,e),0),r.wnext=0,r.whave=r.wsize):(n=r.wsize-r.wnext,n>i&&(n=i),r.window.set(t.subarray(e-i,e-i+n),r.wnext),(i-=n)?(r.window.set(t.subarray(e-i,e),0),r.wnext=i,r.whave=r.wsize):(r.wnext+=n,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=n))),0};var sr={inflateReset:h1,inflateReset2:c1,inflateResetKeep:l1,inflateInit:s=>n0(s,15),inflateInit2:n0,inflate:(s,t)=>{let e,i,n,r,o,a,l,h,c,u,p,d,_,m,g,f,b,y,E,C,I,x,A=0;const O=new Uint8Array(4);let L,V;const T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Do(s)||!s.output||!s.input&&s.avail_in!==0)return Oi;e=s.state,e.mode===qn&&(e.mode=Lf),o=s.next_out,n=s.output,l=s.avail_out,r=s.next_in,i=s.input,a=s.avail_in,h=e.hold,c=e.bits,u=a,p=l,x=Lo;t:for(;;)switch(e.mode){case Up:if(e.wrap===0){e.mode=Lf;break}for(;c<16;){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}if(2&e.wrap&&h===35615){e.wbits===0&&(e.wbits=15),e.check=0,O[0]=255&h,O[1]=h>>>8&255,e.check=es(e.check,O,2,0),h=0,c=0,e.mode=16181;break}if(e.head&&(e.head.done=!1),!(1&e.wrap)||(((255&h)<<8)+(h>>8))%31){s.msg="incorrect header check",e.mode=ve;break}if((15&h)!==s0){s.msg="unknown compression method",e.mode=ve;break}if(h>>>=4,c-=4,I=8+(15&h),e.wbits===0&&(e.wbits=I),I>15||I>e.wbits){s.msg="invalid window size",e.mode=ve;break}e.dmax=1<<e.wbits,e.flags=0,s.adler=e.check=1,e.mode=512&h?16189:qn,h=0,c=0;break;case 16181:for(;c<16;){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}if(e.flags=h,(255&e.flags)!==s0){s.msg="unknown compression method",e.mode=ve;break}if(57344&e.flags){s.msg="unknown header flags set",e.mode=ve;break}e.head&&(e.head.text=h>>8&1),512&e.flags&&4&e.wrap&&(O[0]=255&h,O[1]=h>>>8&255,e.check=es(e.check,O,2,0)),h=0,c=0,e.mode=16182;case 16182:for(;c<32;){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}e.head&&(e.head.time=h),512&e.flags&&4&e.wrap&&(O[0]=255&h,O[1]=h>>>8&255,O[2]=h>>>16&255,O[3]=h>>>24&255,e.check=es(e.check,O,4,0)),h=0,c=0,e.mode=16183;case 16183:for(;c<16;){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}e.head&&(e.head.xflags=255&h,e.head.os=h>>8),512&e.flags&&4&e.wrap&&(O[0]=255&h,O[1]=h>>>8&255,e.check=es(e.check,O,2,0)),h=0,c=0,e.mode=16184;case 16184:if(1024&e.flags){for(;c<16;){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}e.length=h,e.head&&(e.head.extra_len=h),512&e.flags&&4&e.wrap&&(O[0]=255&h,O[1]=h>>>8&255,e.check=es(e.check,O,2,0)),h=0,c=0}else e.head&&(e.head.extra=null);e.mode=16185;case 16185:if(1024&e.flags&&(d=e.length,d>a&&(d=a),d&&(e.head&&(I=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(i.subarray(r,r+d),I)),512&e.flags&&4&e.wrap&&(e.check=es(e.check,i,d,r)),a-=d,r+=d,e.length-=d),e.length))break t;e.length=0,e.mode=16186;case 16186:if(2048&e.flags){if(a===0)break t;d=0;do I=i[r+d++],e.head&&I&&e.length<65536&&(e.head.name+=String.fromCharCode(I));while(I&&d<a);if(512&e.flags&&4&e.wrap&&(e.check=es(e.check,i,d,r)),a-=d,r+=d,I)break t}else e.head&&(e.head.name=null);e.length=0,e.mode=16187;case 16187:if(4096&e.flags){if(a===0)break t;d=0;do I=i[r+d++],e.head&&I&&e.length<65536&&(e.head.comment+=String.fromCharCode(I));while(I&&d<a);if(512&e.flags&&4&e.wrap&&(e.check=es(e.check,i,d,r)),a-=d,r+=d,I)break t}else e.head&&(e.head.comment=null);e.mode=16188;case 16188:if(512&e.flags){for(;c<16;){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}if(4&e.wrap&&h!==(65535&e.check)){s.msg="header crc mismatch",e.mode=ve;break}h=0,c=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),s.adler=e.check=0,e.mode=qn;break;case 16189:for(;c<32;){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}s.adler=e.check=i0(h),h=0,c=0,e.mode=yu;case yu:if(e.havedict===0)return s.next_out=o,s.avail_out=l,s.next_in=r,s.avail_in=a,e.hold=h,e.bits=c,PO;s.adler=e.check=1,e.mode=qn;case qn:if(t===SO||t===bu)break t;case Lf:if(e.last){h>>>=7&c,c-=7&c,e.mode=Mf;break}for(;c<3;){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}switch(e.last=1&h,h>>>=1,c-=1,3&h){case 0:e.mode=16193;break;case 1:if(LO(e),e.mode=vu,t===bu){h>>>=2,c-=2;break t}break;case 2:e.mode=16196;break;case 3:s.msg="invalid block type",e.mode=ve}h>>>=2,c-=2;break;case 16193:for(h>>>=7&c,c-=7&c;c<32;){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}if((65535&h)!=(h>>>16^65535)){s.msg="invalid stored block lengths",e.mode=ve;break}if(e.length=65535&h,h=0,c=0,e.mode=Nf,t===bu)break t;case Nf:e.mode=16195;case 16195:if(d=e.length,d){if(d>a&&(d=a),d>l&&(d=l),d===0)break t;n.set(i.subarray(r,r+d),o),a-=d,r+=d,l-=d,o+=d,e.length-=d;break}e.mode=qn;break;case 16196:for(;c<14;){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}if(e.nlen=257+(31&h),h>>>=5,c-=5,e.ndist=1+(31&h),h>>>=5,c-=5,e.ncode=4+(15&h),h>>>=4,c-=4,e.nlen>286||e.ndist>30){s.msg="too many length or distance symbols",e.mode=ve;break}e.have=0,e.mode=16197;case 16197:for(;e.have<e.ncode;){for(;c<3;){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}e.lens[T[e.have++]]=7&h,h>>>=3,c-=3}for(;e.have<19;)e.lens[T[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,L={bits:e.lenbits},x=nc(0,e.lens,0,19,e.lencode,0,e.work,L),e.lenbits=L.bits,x){s.msg="invalid code lengths set",e.mode=ve;break}e.have=0,e.mode=16198;case 16198:for(;e.have<e.nlen+e.ndist;){for(;A=e.lencode[h&(1<<e.lenbits)-1],g=A>>>24,f=A>>>16&255,b=65535&A,!(g<=c);){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}if(b<16)h>>>=g,c-=g,e.lens[e.have++]=b;else{if(b===16){for(V=g+2;c<V;){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}if(h>>>=g,c-=g,e.have===0){s.msg="invalid bit length repeat",e.mode=ve;break}I=e.lens[e.have-1],d=3+(3&h),h>>>=2,c-=2}else if(b===17){for(V=g+3;c<V;){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}h>>>=g,c-=g,I=0,d=3+(7&h),h>>>=3,c-=3}else{for(V=g+7;c<V;){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}h>>>=g,c-=g,I=0,d=11+(127&h),h>>>=7,c-=7}if(e.have+d>e.nlen+e.ndist){s.msg="invalid bit length repeat",e.mode=ve;break}for(;d--;)e.lens[e.have++]=I}}if(e.mode===ve)break;if(e.lens[256]===0){s.msg="invalid code -- missing end-of-block",e.mode=ve;break}if(e.lenbits=9,L={bits:e.lenbits},x=nc(1,e.lens,0,e.nlen,e.lencode,0,e.work,L),e.lenbits=L.bits,x){s.msg="invalid literal/lengths set",e.mode=ve;break}if(e.distbits=6,e.distcode=e.distdyn,L={bits:e.distbits},x=nc(2,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,L),e.distbits=L.bits,x){s.msg="invalid distances set",e.mode=ve;break}if(e.mode=vu,t===bu)break t;case vu:e.mode=wu;case wu:if(a>=6&&l>=258){s.next_out=o,s.avail_out=l,s.next_in=r,s.avail_in=a,e.hold=h,e.bits=c,CO(s,p),o=s.next_out,n=s.output,l=s.avail_out,r=s.next_in,i=s.input,a=s.avail_in,h=e.hold,c=e.bits,e.mode===qn&&(e.back=-1);break}for(e.back=0;A=e.lencode[h&(1<<e.lenbits)-1],g=A>>>24,f=A>>>16&255,b=65535&A,!(g<=c);){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}if(f&&!(240&f)){for(y=g,E=f,C=b;A=e.lencode[C+((h&(1<<y+E)-1)>>y)],g=A>>>24,f=A>>>16&255,b=65535&A,!(y+g<=c);){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}h>>>=y,c-=y,e.back+=y}if(h>>>=g,c-=g,e.back+=g,e.length=b,f===0){e.mode=16205;break}if(32&f){e.back=-1,e.mode=qn;break}if(64&f){s.msg="invalid literal/length code",e.mode=ve;break}e.extra=15&f,e.mode=16201;case 16201:if(e.extra){for(V=e.extra;c<V;){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}e.length+=h&(1<<e.extra)-1,h>>>=e.extra,c-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=16202;case 16202:for(;A=e.distcode[h&(1<<e.distbits)-1],g=A>>>24,f=A>>>16&255,b=65535&A,!(g<=c);){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}if(!(240&f)){for(y=g,E=f,C=b;A=e.distcode[C+((h&(1<<y+E)-1)>>y)],g=A>>>24,f=A>>>16&255,b=65535&A,!(y+g<=c);){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}h>>>=y,c-=y,e.back+=y}if(h>>>=g,c-=g,e.back+=g,64&f){s.msg="invalid distance code",e.mode=ve;break}e.offset=b,e.extra=15&f,e.mode=16203;case 16203:if(e.extra){for(V=e.extra;c<V;){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}e.offset+=h&(1<<e.extra)-1,h>>>=e.extra,c-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){s.msg="invalid distance too far back",e.mode=ve;break}e.mode=16204;case 16204:if(l===0)break t;if(d=p-l,e.offset>d){if(d=e.offset-d,d>e.whave&&e.sane){s.msg="invalid distance too far back",e.mode=ve;break}d>e.wnext?(d-=e.wnext,_=e.wsize-d):_=e.wnext-d,d>e.length&&(d=e.length),m=e.window}else m=n,_=o-e.offset,d=e.length;d>l&&(d=l),l-=d,e.length-=d;do n[o++]=m[_++];while(--d);e.length===0&&(e.mode=wu);break;case 16205:if(l===0)break t;n[o++]=e.length,l--,e.mode=wu;break;case Mf:if(e.wrap){for(;c<32;){if(a===0)break t;a--,h|=i[r++]<<c,c+=8}if(p-=l,s.total_out+=p,e.total+=p,4&e.wrap&&p&&(s.adler=e.check=e.flags?es(e.check,n,p,o-p):ec(e.check,n,p,o-p)),p=l,4&e.wrap&&(e.flags?h:i0(h))!==e.check){s.msg="incorrect data check",e.mode=ve;break}h=0,c=0}e.mode=16207;case 16207:if(e.wrap&&e.flags){for(;c<32;){if(a===0)break t;a--,h+=i[r++]<<c,c+=8}if(4&e.wrap&&h!==(4294967295&e.total)){s.msg="incorrect length check",e.mode=ve;break}h=0,c=0}e.mode=16208;case 16208:x=OO;break t;case ve:x=t0;break t;case 16210:return e0;default:return Oi}return s.next_out=o,s.avail_out=l,s.next_in=r,s.avail_in=a,e.hold=h,e.bits=c,(e.wsize||p!==s.avail_out&&e.mode<ve&&(e.mode<Mf||t!==Jb))&&o0(s,s.output,s.next_out,p-s.avail_out),u-=s.avail_in,p-=s.avail_out,s.total_in+=u,s.total_out+=p,e.total+=p,4&e.wrap&&p&&(s.adler=e.check=e.flags?es(e.check,n,p,s.next_out-p):ec(e.check,n,p,s.next_out-p)),s.data_type=e.bits+(e.last?64:0)+(e.mode===qn?128:0)+(e.mode===vu||e.mode===Nf?256:0),(u===0&&p===0||t===Jb)&&x===Lo&&(x=FO),x},inflateEnd:s=>{if(Do(s))return Oi;let t=s.state;return t.window&&(t.window=null),s.state=null,Lo},inflateGetHeader:(s,t)=>{if(Do(s))return Oi;const e=s.state;return 2&e.wrap?(e.head=t,t.done=!1,Lo):Oi},inflateSetDictionary:(s,t)=>{const e=t.length;let i,n,r;return Do(s)?Oi:(i=s.state,i.wrap!==0&&i.mode!==yu?Oi:i.mode===yu&&(n=1,n=ec(n,t,e,0),n!==i.check)?t0:(r=o0(s,t,e,e),r?(i.mode=16210,e0):(i.havedict=1,Lo)))},inflateInfo:"pako inflate (from Nodeca project)"},NO=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const u1=Object.prototype.toString,{Z_NO_FLUSH:MO,Z_FINISH:DO,Z_OK:rc,Z_STREAM_END:zf,Z_NEED_DICT:Uf,Z_STREAM_ERROR:kO,Z_DATA_ERROR:a0,Z_MEM_ERROR:zO}=Yc;function oc(s){this.options=i1({chunkSize:65536,windowBits:15,to:""},s||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||s&&s.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o1,this.strm.avail_out=0;let e=sr.inflateInit2(this.strm,t.windowBits);if(e!==rc)throw new Error(ea[e]);if(this.header=new NO,sr.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=R_(t.dictionary):u1.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=sr.inflateSetDictionary(this.strm,t.dictionary),e!==rc)))throw new Error(ea[e])}function Bf(s,t){const e=new oc(t);if(e.push(s),e.err)throw e.msg||ea[e.err];return e.result}oc.prototype.push=function(s,t){const e=this.strm,i=this.options.chunkSize,n=this.options.dictionary;let r,o,a;if(this.ended)return!1;for(o=t===~~t?t:t===!0?DO:MO,u1.call(s)==="[object ArrayBuffer]"?e.input=new Uint8Array(s):e.input=s,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),r=sr.inflate(e,o),r===Uf&&n&&(r=sr.inflateSetDictionary(e,n),r===rc?r=sr.inflate(e,o):r===a0&&(r=Uf));e.avail_in>0&&r===zf&&e.state.wrap>0&&s[e.next_in]!==0;)sr.inflateReset(e),r=sr.inflate(e,o);switch(r){case kO:case a0:case Uf:case zO:return this.onEnd(r),this.ended=!0,!1}if(a=e.avail_out,e.next_out&&(e.avail_out===0||r===zf))if(this.options.to==="string"){let l=pO(e.output,e.next_out),h=e.next_out-l,c=dO(e.output,l);e.next_out=h,e.avail_out=i-h,h&&e.output.set(e.output.subarray(l,l+h),0),this.onData(c)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(r!==rc||a!==0){if(r===zf)return r=sr.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(e.avail_in===0)break}}return!0},oc.prototype.onData=function(s){this.chunks.push(s)},oc.prototype.onEnd=function(s){s===rc&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=n1(this.chunks)),this.chunks=[],this.err=s,this.msg=this.strm.msg};var UO={Inflate:oc,inflate:Bf,inflateRaw:function(s,t){return(t=t||{}).raw=!0,Bf(s,t)},ungzip:Bf};const{Deflate:BO,deflate:VO,deflateRaw:$O,gzip:HO}=EO,{Inflate:jO,inflate:YO,inflateRaw:WO,ungzip:GO}=UO;var qO={Deflate:BO,deflate:VO,deflateRaw:$O,gzip:HO,Inflate:jO,inflate:YO,inflateRaw:WO,ungzip:GO,constants:Yc};const ZO=32;new Array(ZO).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}));let ar=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(s,t){let e=1/0,i=-1/0;for(let n=0,r=s.length;n<r;n++){const o=s[n][t];e=o<e?o:e,i=o>i?o:i}this.min=e,this.max=i}setFromPoints(s,t){let e=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const o=t[n],a=s.dot(o);e=a<e?a:e,i=a>i?a:i}this.min=e,this.max=i}isSeparated(s){return this.min>s.max||s.min>this.max}};ar.prototype.setFromBox=function(){const s=new F;return function(t,e){const i=e.min,n=e.max;let r=1/0,o=-1/0;for(let a=0;a<=1;a++)for(let l=0;l<=1;l++)for(let h=0;h<=1;h++){s.x=i.x*a+n.x*(1-a),s.y=i.y*l+n.y*(1-l),s.z=i.z*h+n.z*(1-h);const c=t.dot(s);r=Math.min(c,r),o=Math.max(c,o)}this.min=r,this.max=o}}();const XO=function(){const s=new F,t=new F,e=new F;return function(i,n,r){const o=i.start,a=s,l=n.start,h=t;e.subVectors(o,l),s.subVectors(i.end,i.start),t.subVectors(n.end,n.start);const c=e.dot(h),u=h.dot(a),p=h.dot(h),d=e.dot(a),_=a.dot(a)*p-u*u;let m,g;m=_!==0?(c*u-d*p)/_:0,g=(c+m*u)/p,r.x=m,r.y=g}}(),fg=function(){const s=new Bt,t=new F,e=new F;return function(i,n,r,o){XO(i,n,s);let a=s.x,l=s.y;if(a>=0&&a<=1&&l>=0&&l<=1)return i.at(a,r),void n.at(l,o);if(a>=0&&a<=1)return l<0?n.at(0,o):n.at(1,o),void i.closestPointToPoint(o,!0,r);if(l>=0&&l<=1)return a<0?i.at(0,r):i.at(1,r),void n.closestPointToPoint(r,!0,o);{let h,c;h=a<0?i.start:i.end,c=l<0?n.start:n.end;const u=t,p=e;return i.closestPointToPoint(c,!0,t),n.closestPointToPoint(h,!0,e),u.distanceToSquared(c)<=p.distanceToSquared(h)?(r.copy(u),void o.copy(c)):(r.copy(h),void o.copy(p))}}}(),QO=function(){const s=new F,t=new F,e=new Ht,i=new Gt;return function(n,r){const{radius:o,center:a}=n,{a:l,b:h,c}=r;if(i.start=l,i.end=h,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o||(i.start=l,i.end=c,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o)||(i.start=h,i.end=c,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o))return!0;const u=r.getPlane(e);if(Math.abs(u.distanceToPoint(a))<=o){const p=u.projectPoint(a,t);if(r.containsPoint(p))return!0}return!1}}();function Vf(s){return Math.abs(s)<1e-15}let nn=class extends ks{constructor(...s){super(...s),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new F),this.satBounds=new Array(4).fill().map(()=>new ar),this.points=[this.a,this.b,this.c],this.sphere=new ws,this.plane=new Ht,this.needsUpdate=!0}intersectsSphere(s){return QO(s,this)}update(){const s=this.a,t=this.b,e=this.c,i=this.points,n=this.satAxes,r=this.satBounds,o=n[0],a=r[0];this.getNormal(o),a.setFromPoints(o,i);const l=n[1],h=r[1];l.subVectors(s,t),h.setFromPoints(l,i);const c=n[2],u=r[2];c.subVectors(t,e),u.setFromPoints(c,i);const p=n[3],d=r[3];p.subVectors(e,s),d.setFromPoints(p,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,s),this.needsUpdate=!1}};nn.prototype.closestPointToSegment=function(){const s=new F,t=new F,e=new Gt;return function(i,n=null,r=null){const{start:o,end:a}=i,l=this.points;let h,c=1/0;for(let u=0;u<3;u++){const p=(u+1)%3;e.start.copy(l[u]),e.end.copy(l[p]),fg(e,i,s,t),h=s.distanceToSquared(t),h<c&&(c=h,n&&n.copy(s),r&&r.copy(t))}return this.closestPointToPoint(o,s),h=o.distanceToSquared(s),h<c&&(c=h,n&&n.copy(s),r&&r.copy(o)),this.closestPointToPoint(a,s),h=a.distanceToSquared(s),h<c&&(c=h,n&&n.copy(s),r&&r.copy(a)),Math.sqrt(c)}}(),nn.prototype.intersectsTriangle=function(){const s=new nn,t=new Array(3),e=new Array(3),i=new ar,n=new ar,r=new F,o=new F,a=new F,l=new F,h=new F,c=new Gt,u=new Gt,p=new Gt,d=new F;function _(m,g,f){const b=m.points;let y=0,E=-1;for(let C=0;C<3;C++){const{start:I,end:x}=c;I.copy(b[C]),x.copy(b[(C+1)%3]),c.delta(o);const A=Vf(g.distanceToPoint(I));if(Vf(g.normal.dot(o))&&A){f.copy(c),y=2;break}const O=g.intersectLine(c,d);if(!O&&A&&d.copy(I),(O||A)&&!Vf(d.distanceTo(x))){if(y<=1)(y===1?f.start:f.end).copy(d),A&&(E=y);else if(y>=2){(E===1?f.start:f.end).copy(d),y=2;break}if(y++,y===2&&E===-1)break}}return y}return function(m,g=null,f=!1){this.needsUpdate&&this.update(),m.isExtendedTriangle?m.needsUpdate&&m.update():(s.copy(m),s.update(),m=s);const b=this.plane,y=m.plane;if(Math.abs(b.normal.dot(y.normal))>1-1e-10){const E=this.satBounds,C=this.satAxes;e[0]=m.a,e[1]=m.b,e[2]=m.c;for(let A=0;A<4;A++){const O=E[A],L=C[A];if(i.setFromPoints(L,e),O.isSeparated(i))return!1}const I=m.satBounds,x=m.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let A=0;A<4;A++){const O=I[A],L=x[A];if(i.setFromPoints(L,t),O.isSeparated(i))return!1}for(let A=0;A<4;A++){const O=C[A];for(let L=0;L<4;L++){const V=x[L];if(r.crossVectors(O,V),i.setFromPoints(r,t),n.setFromPoints(r,e),i.isSeparated(n))return!1}}return g&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),g.start.set(0,0,0),g.end.set(0,0,0)),!0}{const E=_(this,y,u);if(E===1&&m.containsPoint(u.end))return g&&(g.start.copy(u.end),g.end.copy(u.end)),!0;if(E!==2)return!1;const C=_(m,b,p);if(C===1&&this.containsPoint(p.end))return g&&(g.start.copy(p.end),g.end.copy(p.end)),!0;if(C!==2)return!1;if(u.delta(a),p.delta(l),a.dot(l)<0){let L=p.start;p.start=p.end,p.end=L}const I=u.start.dot(a),x=u.end.dot(a),A=p.start.dot(a),O=p.end.dot(a);return(I===O||A===x||x<A!=I<O)&&(g&&(h.subVectors(u.start,p.start),h.dot(a)>0?g.start.copy(u.start):g.start.copy(p.start),h.subVectors(u.end,p.end),h.dot(a)<0?g.end.copy(u.end):g.end.copy(p.end)),!0)}}}(),nn.prototype.distanceToPoint=function(){const s=new F;return function(t){return this.closestPointToPoint(t,s),t.distanceTo(s)}}(),nn.prototype.distanceToTriangle=function(){const s=new F,t=new F,e=["a","b","c"],i=new Gt,n=new Gt;return function(r,o=null,a=null){const l=o||a?i:null;if(this.intersectsTriangle(r,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let h=1/0;for(let c=0;c<3;c++){let u;const p=e[c],d=r[p];this.closestPointToPoint(d,s),u=d.distanceToSquared(s),u<h&&(h=u,o&&o.copy(s),a&&a.copy(d));const _=this[p];r.closestPointToPoint(_,s),u=_.distanceToSquared(s),u<h&&(h=u,o&&o.copy(_),a&&a.copy(s))}for(let c=0;c<3;c++){const u=e[c],p=e[(c+1)%3];i.set(this[u],this[p]);for(let d=0;d<3;d++){const _=e[d],m=e[(d+1)%3];n.set(r[_],r[m]),fg(i,n,s,t);const g=s.distanceToSquared(t);g<h&&(h=g,o&&o.copy(s),a&&a.copy(t))}}return Math.sqrt(h)}}();let Ds=class{constructor(s,t,e){this.isOrientedBox=!0,this.min=new F,this.max=new F,this.matrix=new vt,this.invMatrix=new vt,this.points=new Array(8).fill().map(()=>new F),this.satAxes=new Array(3).fill().map(()=>new F),this.satBounds=new Array(3).fill().map(()=>new ar),this.alignedSatBounds=new Array(3).fill().map(()=>new ar),this.needsUpdate=!1,s&&this.min.copy(s),t&&this.max.copy(t),e&&this.matrix.copy(e)}set(s,t,e){this.min.copy(s),this.max.copy(t),this.matrix.copy(e),this.needsUpdate=!0}copy(s){this.min.copy(s.min),this.max.copy(s.max),this.matrix.copy(s.matrix),this.needsUpdate=!0}};Ds.prototype.update=function(){return function(){const s=this.matrix,t=this.min,e=this.max,i=this.points;for(let l=0;l<=1;l++)for(let h=0;h<=1;h++)for(let c=0;c<=1;c++){const u=i[1*l|2*h|4*c];u.x=l?e.x:t.x,u.y=h?e.y:t.y,u.z=c?e.z:t.z,u.applyMatrix4(s)}const n=this.satBounds,r=this.satAxes,o=i[0];for(let l=0;l<3;l++){const h=r[l],c=n[l],u=i[1<<l];h.subVectors(o,u),c.setFromPoints(h,i)}const a=this.alignedSatBounds;a[0].setFromPointsField(i,"x"),a[1].setFromPointsField(i,"y"),a[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}(),Ds.prototype.intersectsBox=function(){const s=new ar;return function(t){this.needsUpdate&&this.update();const e=t.min,i=t.max,n=this.satBounds,r=this.satAxes,o=this.alignedSatBounds;if(s.min=e.x,s.max=i.x,o[0].isSeparated(s)||(s.min=e.y,s.max=i.y,o[1].isSeparated(s))||(s.min=e.z,s.max=i.z,o[2].isSeparated(s)))return!1;for(let a=0;a<3;a++){const l=r[a],h=n[a];if(s.setFromBox(l,t),h.isSeparated(s))return!1}return!0}}(),Ds.prototype.intersectsTriangle=function(){const s=new nn,t=new Array(3),e=new ar,i=new ar,n=new F;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(s.copy(r),s.update(),r=s);const o=this.satBounds,a=this.satAxes;t[0]=r.a,t[1]=r.b,t[2]=r.c;for(let u=0;u<3;u++){const p=o[u],d=a[u];if(e.setFromPoints(d,t),p.isSeparated(e))return!1}const l=r.satBounds,h=r.satAxes,c=this.points;for(let u=0;u<3;u++){const p=l[u],d=h[u];if(e.setFromPoints(d,c),p.isSeparated(e))return!1}for(let u=0;u<3;u++){const p=a[u];for(let d=0;d<4;d++){const _=h[d];if(n.crossVectors(p,_),e.setFromPoints(n,t),i.setFromPoints(n,c),e.isSeparated(i))return!1}}return!0}}(),Ds.prototype.closestPointToPoint=function(){return function(s,t){return this.needsUpdate&&this.update(),t.copy(s).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}(),Ds.prototype.distanceToPoint=function(){const s=new F;return function(t){return this.closestPointToPoint(t,s),t.distanceTo(s)}}(),Ds.prototype.distanceToBox=function(){const s=["x","y","z"],t=new Array(12).fill().map(()=>new Gt),e=new Array(12).fill().map(()=>new Gt),i=new F,n=new F;return function(r,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(a||l)&&(r.getCenter(n),this.closestPointToPoint(n,i),r.closestPointToPoint(i,n),a&&a.copy(i),l&&l.copy(n)),0;const h=o*o,c=r.min,u=r.max,p=this.points;let d=1/0;for(let m=0;m<8;m++){const g=p[m];n.copy(g).clamp(c,u);const f=g.distanceToSquared(n);if(f<d&&(d=f,a&&a.copy(g),l&&l.copy(n),f<h))return Math.sqrt(f)}let _=0;for(let m=0;m<3;m++)for(let g=0;g<=1;g++)for(let f=0;f<=1;f++){const b=(m+1)%3,y=(m+2)%3,E=1<<m|g<<b|f<<y,C=p[g<<b|f<<y],I=p[E];t[_].set(C,I);const x=s[m],A=s[b],O=s[y],L=e[_],V=L.start,T=L.end;V[x]=c[x],V[A]=g?c[A]:u[A],V[O]=f?c[O]:u[A],T[x]=u[x],T[A]=g?c[A]:u[A],T[O]=f?c[O]:u[A],_++}for(let m=0;m<=1;m++)for(let g=0;g<=1;g++)for(let f=0;f<=1;f++){n.x=m?u.x:c.x,n.y=g?u.y:c.y,n.z=f?u.z:c.z,this.closestPointToPoint(n,i);const b=n.distanceToSquared(i);if(b<d&&(d=b,a&&a.copy(i),l&&l.copy(n),b<h))return Math.sqrt(b)}for(let m=0;m<12;m++){const g=t[m];for(let f=0;f<12;f++){const b=e[f];fg(g,b,i,n);const y=i.distanceToSquared(n);if(y<d&&(d=y,a&&a.copy(i),l&&l.copy(n),y<h))return Math.sqrt(y)}}return Math.sqrt(d)}}();let KO=class{constructor(s){this._getNewPrimitive=s,this._primitives=[]}getPrimitive(){const s=this._primitives;return s.length===0?this._getNewPrimitive():s.pop()}releasePrimitive(s){this._primitives.push(s)}},JO=class extends KO{constructor(){super(()=>new nn)}};new JO;const d1=new class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const s=[];let t=null;this.setBuffer=e=>{t&&s.push(t),t=e,this.float32Array=new Float32Array(e),this.uint16Array=new Uint16Array(e),this.uint32Array=new Uint32Array(e)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,s.length!==0&&this.setBuffer(s.pop())}}};new F;new F;new F;new F;new F;new Bt;new Bt;new Bt;new F;new F;new F;new F;new Tt;new F;new F;new Tt;new nn;new nn;new vt;new Ds;new Ds;new vt;new Ds;new Ds;new F;new F;new F;new F;new F;new F;new Tt;new nn;new nn;new vt;new Ds;new Ds;new vt;new Ds;new Ds;new F;new F;new F;new F;new d1.constructor;new d1.constructor;new Tt;new Tt;new Tt;new Tt;new Ds;new Tt;new Jr;new vt;let p1=class{constructor(s,t){S(this,"meshes"),S(this,"_templateController",new FP),S(this,"_meshIds",new Set),S(this,"_idGenerator",new O_),S(this,"_modelCode"),this.meshes=t,this._modelCode=this.getModelCode(s)}dispose(){Qa.delete(this._meshIds)}useMesh(s,t,e){const i=this.meshCode(s,e);Qa.lockIn(t),this._templateController.add(i,t)}getMesh(s,t){const e=this.meshCode(s,t);return Qa.get(e)??this._templateController.get(e)}saveMesh(s,t,e){en.forEach(t,Qa.updateMeshMemory);const i=this.meshCode(s,e);Qa.add(i,t),this._meshIds.add(i)}meshCode(s,t){const e=[this._modelCode,this.getRepresentation(),t,s];return this._idGenerator.generate(e)}getModelCode(s){return this._idGenerator.generate([s])}};const ac=32767;var ko=(s=>(s[s.NONE=0]="NONE",s[s.AABB=1]="AABB",s[s.CUSTOM=2]="CUSTOM",s))(ko||{});const qs=class qi{static getProfile(t,e,i){return t.type()===ys.BIG?t.bigProfiles(e,i):t.profiles(e,i)}static getPoints(t){const e=new Float32Array(3*t.pointsLength());for(let i=0;i<t.pointsLength();i++)t.points(i,this._tempPoint),e[3*i]=this._tempPoint.x(),e[3*i+1]=this._tempPoint.y(),e[3*i+2]=this._tempPoint.z();return e}static getProfileIndices(t,e){const i=t.type()===ys.BIG,n={outer:[],inners:[]},r=i?t.bigHolesLength():t.holesLength(),o=i?"bigHoles":"holes",a=qi.getProfile(t,e);n.outer=Array.from(a.indicesArray());for(let l=0;l<r;l++){const h=t[o](l);if(h.profileId()===e){const c=Array.from(h.indicesArray());n.inners.push(c)}}return n}static getHole(t,e,i){return t.type()===ys.BIG?t.bigHoles(e,i):t.holes(e,i)}static getProfilesLength(t){return t.type()===ys.BIG?t.bigProfilesLength():t.profilesLength()}static getHolesLength(t){return t.type()===ys.BIG?t.bigHolesLength():t.holesLength()}static getShell(t,e){return t.shells(e,this._shell)}static point(t,e,i){t instanceof tn&&t.points(e,this._tempPoint);const n=this._tempPoint.x(),r=this._tempPoint.y(),o=this._tempPoint.z();i.set(n,r,o)}static getNormalsOfShellProfile(t,e){const i=qi.getProfilesLength(t);for(let n=0;n<i;n++){const r=qi.getProfile(t,n),o=this.fetchNormalsOfProfile(t,r);e.push(o)}return e}static computeNormalsAvg(t,e,i,n){this.setupNormalBuffer(t);const r=i[e];for(let o=0;o<t.length;o++){const a=t[o],l=n.get(a);this.aggregateNormals(l,i,r),this.computeAvgNormal(o)}return this._normalBuffer}static getBuffer(t){const e=t.bb,i=e.__offset(t.bb_pos,8),n=3*t.pointsLength(),r=e.__vector(t.bb_pos+i),o=e.bytes().buffer;return new Float32Array(o,r,n)}static getPointsShell(t){return this._pointsByProfile.clear(),this.fetchAllPointsByProfile(t),qi.fetchAllPointsByHole(t),this._pointsByProfile}static addNormals(t,e,i){for(const n of t){const r=e[n];i.dot(r)>this._faceThreshold&&this._tempNormal.add(r)}}static setupNormalBuffer(t){const e=3*t.length;this._normalBuffer.length<e&&(this._normalBuffer=new Int16Array(e))}static fetchNormalsOfProfile(t,e){const i=e.indicesLength();return this.isTooSmall(t,i)?new F(1,0,0):this.computeProfileNormal(i,e,t)}static fetchAllPointsByHole(t){const e=qi.getHolesLength(t),i=this.getTempHole(t);for(let n=0;n<e;n++){qi.getHole(t,n,i);const r=i.profileId(),o=i.indicesLength();for(let a=0;a<o;a++){const l=i.indices(a);qi.savePointByProfile(l,r)}}}static computeProfileNormal(t,e,i){this._v3.set(0,0,0);for(let r=0;r<t;r++)this.fetchPointsForNormal(r,t,e,i),this.computeProfilePointNormal();const n=this._v3.clone();return n.normalize(),n}static computeProfilePointNormal(){const t=this._v1.x-this._v2.x,e=this._v1.y-this._v2.y,i=this._v1.z-this._v2.z,n=this._v1.x+this._v2.x,r=this._v1.y+this._v2.y,o=this._v1.z+this._v2.z;this._v3.x+=e*o,this._v3.y+=i*n,this._v3.z+=t*r}static aggregateNormals(t,e,i){if(this._tempNormal.set(0,0,0),!t||!t.length)return void this._tempNormal.set(1,0,0);if(t.length===1){const n=t[0];this._tempNormal=e[n].clone()}else qi.addNormals(t,e,i)}static fetchPointsForNormal(t,e,i,n){const r=(t+1)%e,o=i.indices(t),a=i.indices(r);this.point(n,o,this._v1),this.point(n,a,this._v2)}static savePointByProfile(t,e){this._pointsByProfile.has(t)||this._pointsByProfile.set(t,[]),this._pointsByProfile.get(t).push(e)}static isTooSmall(t,e){return t.pointsLength()<=2||e<=2}static fetchAllPointsByProfile(t){const e=this.getProfilesLength(t),i=this.getTempProfile(t);for(let n=0;n<e;n++){qi.getProfile(t,n,i);const r=i.indicesLength();for(let o=0;o<r;o++){const a=i.indices(o);qi.savePointByProfile(a,n)}}}static computeAvgNormal(t){this._tempNormal.normalize(),this._tempNormal.multiplyScalar(ac),this._tempNormal.toArray(this._normalBuffer,3*t)}static getTempProfile(t){return t.type()===ys.BIG?this._bigShellProfile:this._shellProfile}static getTempHole(t){return t.type()===ys.BIG?this._bigShellHole:this._shellHole}};S(qs,"_faceThreshold",Math.cos(Math.PI/8)),S(qs,"_shell",new tn),S(qs,"_normalBuffer",new Int16Array),S(qs,"_tempNormal",new F),S(qs,"_tempPoint",new os),S(qs,"_shellProfile",new Jo),S(qs,"_bigShellProfile",new Ko),S(qs,"_shellHole",new _l),S(qs,"_bigShellHole",new gl),S(qs,"_pointsByProfile",new Map),S(qs,"_v1",new F),S(qs,"_v2",new F),S(qs,"_v3",new F);let qt=qs,tP=class{constructor(){S(this,"_shellHole",new _l),S(this,"_bigShellHole",new gl),S(this,"holePoints",0),S(this,"profilePoints",0),S(this,"triangleAmount",0),S(this,"indexCount",0),S(this,"meshes",[]),S(this,"_shellProfile",new Jo),S(this,"_bigShellProfile",new Ko)}newMeshTemplate(s){return this.getIsEmpty(s)?{objectClass:zs.SHELL}:(this.reset(!0),this.processShell(s),this.getResult())}manageDataLeft(){this.getIsDataLeft()&&this.setMesh()}getIsEmpty(s){return qt.getProfilesLength(s)===0}processShellHoles(s,t){let e=!1;const i=qt.getHolesLength(s),n=this.getTempHole(s);for(let r=0;r<i;r++)qt.getHole(s,r,n),n.profileId()===t&&(this.updateBuffers(s,e),e=!0);this.manageFoundHoles(s,e)}newMesh(){return{objectClass:zs.SHELL,indexCount:3*this.triangleAmount,positionCount:3*(this.holePoints+this.profilePoints),normalCount:3*(this.holePoints+this.profilePoints)}}reset(s){this.holePoints=0,this.profilePoints=0,this.triangleAmount=0,s&&(this.meshes=void 0)}getIsDataLeft(){const s=this.triangleAmount>0,t=this.holePoints>0,e=this.profilePoints>0;return s||t||e}processShell(s){const t=qt.getProfilesLength(s),e=this.getTempProfile(s);for(let i=0;i<t;i++)qt.getProfile(s,i,e),this.indexCount=e.indicesLength(),this.profilePoints+=this.indexCount,this.processShellHoles(s,i),this.manageMemory();this.manageDataLeft()}manageFoundHoles(s,t){const e=this.getTempProfile(s).indicesLength();t?this.triangleAmount+=e:e>2&&(this.triangleAmount+=e-2)}getResult(){const s=this.meshes;return this.meshes=void 0,s}manageMemory(){this.holePoints+this.profilePoints+this.indexCount>bl&&this.setMesh()}updateBuffers(s,t){const e=this.getTempHole(s);this.holePoints+=e.indicesLength(),this.triangleAmount+=e.indicesLength(),t&&(this.triangleAmount+=2)}setMesh(){const s=this.newMesh();this.meshes?Array.isArray(this.meshes)?this.meshes.push(s):this.meshes=[this.meshes,s]:this.meshes=s,this.reset(!1)}getTempProfile(s){return s.type()===ys.BIG?this._bigShellProfile:this._shellProfile}getTempHole(s){return s.type()===ys.BIG?this._bigShellHole:this._shellHole}};var mg=(s=>(s[s.four=4]="four",s[s.three=3]="three",s))(mg||{});function eP(s,t,e,i,n,r){const o=t&&t.length,a=o?t[0]*e:s.length;let l,h,c,u=l0(s,0,a,e,!0,i,n);if(u&&u.next!==u.prev){if(o&&(u=function(p,d,_,m,g,f){const b=[];for(let y=0,E=d.length;y<E;y++){const C=l0(p,d[y]*m,y<E-1?d[y+1]*m:p.length,m,!1,g,f);C===C.next&&(C.steiner=!0),b.push(hP(C))}b.sort(oP);for(let y=0;y<b.length;y++)_=eo(_=aP(b[y],_),_.next);return _}(s,t,u,e,i,n)),s.length>80*e){let p=s[i],d=s[n];l=p,h=d;for(let _=e;_<a;_+=e){const m=s[_+i],g=s[_+n];m<l&&(l=m),g<h&&(h=g),m>p&&(p=m),g>d&&(d=g)}c=Math.max(p-l,d-h),c=c!==0?1/c:0}Tc(u,r,e,l,h,c)}}function l0(s,t,e,i,n,r,o){let a,l,h;if(n===function(c,u,p,d,_,m){let g=0;for(let f=u,b=p-d;f<p;f+=d)g+=(c[b+_]-c[f+_])*(c[f+m]+c[b+m]),b=f;return g}(s,t,e,i,r,o)>0)for(h=t;h<e;h+=i)a=h0(h,s[h+r],s[h+o],a);else for(h=e-i;h>=t;h-=i)a=h0(h,s[h+r],s[h+o],a);return a&&Bp(a,a.next)&&(l=a.next,Sc(a),a=l),a}function eo(s,t){if(!s)return s;t||(t=s);let e,i,n=s;do if(e=!1,n.steiner||!Bp(n,n.next)&&Fe(n.prev,n,n.next)!==0)n=n.next;else{if(i=n.prev,Sc(n),n=t=i,n===n.next)break;e=!0}while(e||n!==t);return t}function Tc(s,t,e,i,n,r,o){!o&&r&&function(l,h,c,u){let p=l;do p.z===null&&(p.z=gg(p.x,p.y,h,c,u)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next;while(p!==l);p.prevZ.nextZ=null,p.prevZ=null,function(d){let _,m=1;do{let g,f=d;d=null;let b=null;for(_=0;f;){_++;let y=f,E=0;for(let I=0;I<m&&(E++,y=y.nextZ,y);I++);let C=m;for(;E>0||C>0&&y;)E!==0&&(C===0||!y||f.z<=y.z)?(g=f,f=f.nextZ,E--):(g=y,y=y.nextZ,C--),b?b.nextZ=g:d=g,g.prevZ=b,b=g;f=y}b.nextZ=null,m*=2}while(_>1)}(p)}(s,i,n,r);let a=s;for(;s.prev!==s.next;){const l=s.prev,h=s.next;if(r?iP(s,i,n,r):sP(s))t(l.i/e,s.i/e,h.i/e),Sc(s),s=h.next,a=h.next;else if((s=h)===a){o?o===1?Tc(s=nP(eo(s),t,e),t,e,i,n,r,2):o===2&&rP(s,t,e,i,n,r):Tc(eo(s),t,e,i,n,r,1);break}}}function sP(s){const t=s.prev,e=s,i=s.next;if(Fe(t,e,i)>=0)return!1;let n=s.next.next;for(;n!==s.prev;){if(ol(t.x,t.y,e.x,e.y,i.x,i.y,n.x,n.y)&&Fe(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function iP(s,t,e,i){const n=s.prev,r=s,o=s.next;if(Fe(n,r,o)>=0)return!1;const a=Math.min(n.x,r.x,o.x),l=Math.min(n.y,r.y,o.y),h=Math.max(n.x,r.x,o.x),c=Math.max(n.y,r.y,o.y),u=gg(a,l,t,e,i),p=gg(h,c,t,e,i);let d=s.prevZ,_=s.nextZ;for(;d&&d.z>=u&&_&&_.z<=p;){if(d!==s.prev&&d!==s.next&&ol(n.x,n.y,r.x,r.y,o.x,o.y,d.x,d.y)&&Fe(d.prev,d,d.next)>=0||(d=d.prevZ,_!==s.prev&&_!==s.next&&ol(n.x,n.y,r.x,r.y,o.x,o.y,_.x,_.y)&&Fe(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;d&&d.z>=u;){if(d!==s.prev&&d!==s.next&&ol(n.x,n.y,r.x,r.y,o.x,o.y,d.x,d.y)&&Fe(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;_&&_.z<=p;){if(_!==s.prev&&_!==s.next&&ol(n.x,n.y,r.x,r.y,o.x,o.y,_.x,_.y)&&Fe(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function nP(s,t,e){let i=s;do{const n=i.prev,r=i.next.next;!Bp(n,r)&&f1(n,i,i.next,r)&&Ac(n,r)&&Ac(r,n)&&(t(n.i/e,i.i/e,r.i/e),Sc(i.next),Sc(i),i=s=r),i=i.next}while(i!==s);return eo(i)}function rP(s,t,e,i,n,r){let o=s;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&cP(o,a)){let l=m1(o,a);return o=eo(o,o.next),l=eo(l,l.next),Tc(o,t,e,i,n,r),void Tc(l,t,e,i,n,r)}a=a.next}o=o.next}while(o!==s)}function oP(s,t){return s.x-t.x}function aP(s,t){const e=function(r,o){let a=o;const l=r.x,h=r.y;let c,u=-1/0;do{if(h<=a.y&&h>=a.next.y&&a.next.y!==a.y){const g=a.x+(h-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(g<=l&&g>u){if(u=g,g===l){if(h===a.y)return a;if(h===a.next.y)return a.next}c=a.x<a.next.x?a:a.next}}a=a.next}while(a!==o);if(!c)return null;if(l===u)return c;const p=c,d=c.x,_=c.y;let m=1/0;a=c;do{if(l>=a.x&&a.x>=d&&l!==a.x&&ol(h<_?l:u,h,d,_,h<_?u:l,h,a.x,a.y)){const g=Math.abs(h-a.y)/(l-a.x);Ac(a,r)&&(g<m||g===m&&(a.x>c.x||a.x===c.x&&lP(c,a)))&&(c=a,m=g)}a=a.next}while(a!==p);return c}(s,t);if(!e)return t;const i=m1(e,s),n=eo(e,e.next);return eo(i,i.next),t===t.next||e===t?n:t}function lP(s,t){return Fe(s.prev,s,t.prev)<0&&Fe(t.next,s,s.next)<0}function gg(s,t,e,i,n){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-e)*n)|s<<8))|s<<4))|s<<2))|s<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function hP(s){let t=s,e=s;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==s);return e}function ol(s,t,e,i,n,r,o,a){return(n-o)*(t-a)-(s-o)*(r-a)>=0&&(s-o)*(i-a)-(e-o)*(t-a)>=0&&(e-o)*(r-a)-(n-o)*(i-a)>=0}function cP(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!function(e,i){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==i.i&&n.next.i!==i.i&&f1(n,n.next,e,i))return!0;n=n.next}while(n!==e);return!1}(s,t)&&(Ac(s,t)&&Ac(t,s)&&function(e,i){let n=e,r=!1;const o=(e.x+i.x)/2,a=(e.y+i.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&o<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r}(s,t)&&(Fe(s.prev,s,t.prev)||Fe(s,t.prev,t))||Bp(s,t)&&Fe(s.prev,s,s.next)>0&&Fe(t.prev,t,t.next)>0)}function Fe(s,t,e){return(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y)}function Bp(s,t){return s.x===t.x&&s.y===t.y}function f1(s,t,e,i){const n=Cu(Fe(s,t,e)),r=Cu(Fe(s,t,i)),o=Cu(Fe(e,i,s)),a=Cu(Fe(e,i,t));return n!==r&&o!==a||!(n!==0||!Eu(s,e,t))||!(r!==0||!Eu(s,i,t))||!(o!==0||!Eu(e,s,i))||!(a!==0||!Eu(e,t,i))}function Eu(s,t,e){return t.x<=Math.max(s.x,e.x)&&t.x>=Math.min(s.x,e.x)&&t.y<=Math.max(s.y,e.y)&&t.y>=Math.min(s.y,e.y)}function Cu(s){return s>0?1:s<0?-1:0}function Ac(s,t){return Fe(s.prev,s,s.next)<0?Fe(s,t,s.next)>=0&&Fe(s,s.prev,t)>=0:Fe(s,t,s.prev)<0||Fe(s,s.next,t)<0}function m1(s,t){const e=_g(s.i,s.x,s.y),i=_g(t.i,t.x,t.y),n=s.next,r=t.prev;return s.next=t,t.prev=s,e.next=n,n.prev=e,i.next=e,e.prev=i,r.next=i,i.prev=r,i}function h0(s,t,e,i){const n=_g(s,t,e);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Sc(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ),s.next=s,s.prev=s}function _g(s,t,e){return{i:s,x:t,y:e,prev:null,next:null,z:null,prevZ:null,nextZ:null,steiner:!1}}const g1=class bg{static create(t,e,i,n,r,o,a,l){const h=t.length,c=a.verticesAmount;bg.processBuffers(h,t,r,a,e,i);const u=r.positionBuffer,p=(a.verticesAmount-c)/3;this.processNormals(u,this._tempVec,p,c),this.triangulate(o,n,h,r,a,c),this.setFaceId(c,a,r,l)}static setFaceId(t,e,i,n){const r=t/3,o=e.verticesAmount/3;for(let a=r;a<o;a++)i.faceIdBuffer[a]=n}static getVertices(t,e,i){const n=t.positionBuffer.buffer,r=4*e,o=i.verticesAmount-e;return new Float32Array(n,r,o)}static getEvent(t,e,i){return(n,r,o)=>{const a=t.indexBuffer;a[e.indices++]=n+i/3,a[e.indices++]=r+i/3,a[e.indices++]=o+i/3}}static processBuffers(t,e,i,n,r,o){for(let a=0;a<t;a++)this.processPositionBuffer(i,e,a,n,r),this.processNormalbuffer(i,o,a,n),this.updateBufferData(n)}static getHoles(t,e,i,n,r){if(t&&t.has(e)){const o=t.get(e),a=[];for(const l of o.indices)a.push(l+i);return this.setHolesBuffers(n,o,r),a}}static setHolesBuffers(t,e,i){const n=t.positionBuffer,r=t.normalBuffer;n.set(e.points,i.verticesAmount);const o=e.points.length;i.verticesAmount+=o,i.vertices+=o/3,r.set(e.normals,i.normalsAmount),i.normalsAmount+=o}static updateBufferData(t){t.vertices+=1,t.verticesAmount+=3,t.normalsAmount+=3}static processPositionBuffer(t,e,i,n,r){const o=t.positionBuffer;for(let a=0;a<3;a++){const l=3*e[i];o[n.verticesAmount+a]=r[l+a]}}static triangulate(t,e,i,n,r,o){const a=this.getHoles(t,e,i,n,r),l=bg.getVertices(n,o,r),h=Yw.getEarcutDimensions(this._tempVec),c=this.getEvent(n,r,o);eP(l,a,3,h[0],h[1],c)}static processNormals(t,e,i,n=0){e.set(0,0,0);for(let r=0;r<i;r++){const o=n+3*r,a=n+3*((r+1)%i),l=t[o+0],h=t[a+0],c=t[o+1],u=t[a+1],p=t[o+2],d=t[a+2];e.x+=(c-u)*(p+d),e.y+=(p-d)*(l+h),e.z+=(l-h)*(c+u)}e.normalize()}static processNormalbuffer(t,e,i,n){const r=t.normalBuffer,o=3*i,a=e[o],l=e[o+1],h=e[o+2];r.set([a,l,h],n.normalsAmount)}};S(g1,"_tempVec",new F);let _1=g1;const Ge=class{static create(s,t,e,i,n,r,o){this.setAllVectors(s,t),this.getIsConvex()?this.processConvexFace4(n,r,e,o):_1.create(s,t,e,i,n,void 0,r,o)}static setAllVectors(s,t){this.setVector(s,t,this.a,0),this.setVector(s,t,this.b,1),this.setVector(s,t,this.c,2),this.setVector(s,t,this.d,3),this.getCrossVectors()}static processConvexFace4(s,t,e,i){this.processIndices(s,t),this.processPoints(s,t),this.processNormal(s,t,e),this.setFaceId(s,t,i),this.updateData(t)}static setFaceId(s,t,e){const i=s.faceIdBuffer;for(let n=t.vertices;n<t.vertices+4;n++)i[n]=e}static getIsConvex(){return this.h.dot(this.i)>0}static getCrossVectors(){this.e.copy(this.b),this.f.copy(this.c),this.g.copy(this.d),this.e.sub(this.a),this.f.sub(this.a),this.g.sub(this.a),this.h.crossVectors(this.e,this.f),this.i.crossVectors(this.f,this.g)}static updateData(s){s.normalsAmount+=this.totalIncrease,s.vertices+=this.vertexIncrease,s.verticesAmount+=this.totalIncrease}static processPoints(s,t){let e=0;const i=s.positionBuffer,n=t.verticesAmount;for(let r=0;r<this.vertexIncrease;r++){const o=this._vecs[r];i[n+e++]=o.x,i[n+e++]=o.y,i[n+e++]=o.z}}static setVector(s,t,e,i){const n=3*s[i],r=t[n],o=t[n+1],a=t[n+2];e.set(r,o,a)}static processNormal(s,t,e){const i=s.normalBuffer,n=t.normalsAmount;for(let r=0;r<this.totalIncrease;r++)i[n+r]=e[r]}static processIndices(s,t){const e=s.indexBuffer;for(let i=0;i<this.indexIncrease;i++){const n=this._convexIndices[i];e[t.indices+i]=t.vertices+n}t.indices+=this.indexIncrease}};S(Ge,"a",new F),S(Ge,"b",new F),S(Ge,"c",new F),S(Ge,"d",new F),S(Ge,"e",new F),S(Ge,"f",new F),S(Ge,"g",new F),S(Ge,"h",new F),S(Ge,"i",new F),S(Ge,"_vecs",[Ge.a,Ge.b,Ge.c,Ge.d]),S(Ge,"_convexIndices",[0,1,3,3,1,2]),S(Ge,"totalIncrease",12),S(Ge,"indexIncrease",6),S(Ge,"vertexIncrease",4);let uP=Ge;const yg=class Ld{static create(t,e,i,n,r,o){this.setFaceIds(r,n,o),this.setIndices(n,r),this.setPoints(t,n,r,e),this.setNormals(n,r,i),this.updateData(r)}static setFaceIds(t,e,i){const n=t.verticesAmount/3,r=n+3;for(let o=n;o<r;o++)e.faceIdBuffer[o]=i}static setNormals(t,e,i){const n=t.normalBuffer;for(let r=0;r<this.totalIncrease;r++)n[e.normalsAmount+r]=i[r]}static setPoints(t,e,i,n){let r=0;const o=e.positionBuffer;for(let a=0;a<this.vertexIncrease;a++){const l=t[a]*this.vertexIncrease;for(let h=0;h<this.vertexIncrease;h++)o[i.verticesAmount+r]=n[l+h],r++}}static setIndices(t,e){const i=t.indexBuffer;for(let n=0;n<this.vertexIncrease;n++)i[e.indices+n]=e.vertices+n;e.indices+=this.vertexIncrease}static updateData(t){t.normalsAmount+=Ld.totalIncrease,t.vertices+=Ld.vertexIncrease,t.verticesAmount+=Ld.totalIncrease}};S(yg,"vertexIncrease",3),S(yg,"totalIncrease",9);let dP=yg,pP=class{constructor(){S(this,"point",new os),S(this,"_shellHole",new _l),S(this,"_bigShellHole",new gl),S(this,"interiorProfiles",new Map),S(this,"normalsAvgInterior",new Int16Array),S(this,"_pointsPerProfile",new Map),S(this,"_shellProfile",new Jo),S(this,"_bigShellProfile",new Ko),S(this,"_normalsAvg",new Int16Array),S(this,"_normals",[]),S(this,"_indices",0),S(this,"_sizes",{vertices:0,indices:0,verticesAmount:0,normalsAmount:0,normals:0}),S(this,"_tileData"),S(this,"_nextFaceId",1),S(this,"nextBuffer",s=>{this.setTileData(s),this.initializeIndices(),this.initializePositions(),this.initializeNormals(),this.initializeFaceIds(),this.initializeSizes(),this._indices++})}construct(s,t){this.resetConstructData(t),this.getPointsPerWire(s);const e=qt.getBuffer(s);this.newShellInteriorProfiles(s),this.constructShell(s,e,t),this._tileData=void 0}getIntProfileNormalsAvg(s,t){const e=this.getTempHole(s).indicesArray();this.normalsAvgInterior=qt.computeNormalsAvg(e,t,this._normals,this._pointsPerProfile)}saveInteriorProfile(s){const t=this.getTempHole(s).profileId();if(this.interiorProfiles.has(t))return this.saveExistingInteriorProfile(t),t;const e=this.getNewIntProfileData();return this.interiorProfiles.set(t,e),t}computeNormalsAvg(s,t,e){if(!this.isShell(s))return;const i=this._normals,n=this._pointsPerProfile;this._normalsAvg=qt.computeNormalsAvg(t,e,i,n)}isShell(s){return s instanceof tn}getPointsPerWire(s){this.isShell(s)&&(qt.getNormalsOfShellProfile(s,this._normals),this._pointsPerProfile=qt.getPointsShell(s))}getIndices(s,t){const e=this.getTempProfile(s);return qt.getProfile(s,t,e),e.indicesArray()}resetConstructData(s){this._indices=0,this._tileData=void 0,this.nextBuffer(s),this._normals.length=0}initializeIndices(){const s=this._tileData.indexCount;this._tileData.indexBuffer=new Uint16Array(s)}constructFace4(s,t,e){const i=this.getNextFaceId();uP.create(s,t,this._normalsAvg,e,this._tileData,this._sizes,i)}initializeSizes(){this._sizes.vertices=0,this._sizes.indices=0,this._sizes.verticesAmount=0,this._sizes.normalsAmount=0,this._sizes.normals=0}getInteriorProfileBuffer(s,t){const e=this.getTempHole(s).indicesLength();if(this.isShell(s))for(let i=0;i<e;i++)this.getIntProfilePoints(i,s,t),this.getIntProfileNormals(t,i)}constructProfile(s,t,e,i){const n=this.getTempProfile(t).indicesLength(),r=!this.interiorProfiles.has(s);if(n===mg.three&&r)return void this.constructFace3(e,i);n===mg.four&&r?this.constructFace4(e,i,s):this.constructFaceX(e,i,s)}getIntProfileNormals(s,t){const e=3*t,i=this.normalsAvgInterior[e],n=this.normalsAvgInterior[e+1],r=this.normalsAvgInterior[e+2];s.normals.push(i,n,r)}saveExistingInteriorProfile(s){const t=this.interiorProfiles.get(s),e=t.points.length/3;t.indices.push(e),this.interiorProfiles.set(s,t)}getNewIntProfileData(){return{indices:[0],points:[],normals:[]}}constructFace3(s,t){const e=this.getNextFaceId();dP.create(s,t,this._normalsAvg,this._tileData,this._sizes,e)}getIntProfilePoints(s,t,e){const i=this.getTempHole(t).indices(s);t.points(i,this.point);const n=this.point.x(),r=this.point.y(),o=this.point.z();e.points.push(n,r,o)}manageMemory(s,t){const e=this.getTempProfile(s).indicesLength();this._sizes.verticesAmount/3+e>bl&&this.nextBuffer(t)}initializeFaceIds(){const s=this._tileData.positionCount;this._tileData.faceIdBuffer=new Uint32Array(s/3)}getNextFaceId(){return this._nextFaceId++}newShellInteriorProfiles(s){this.interiorProfiles.clear();const t=qt.getHolesLength(s),e=this.getTempHole(s);for(let i=0;i<t;i++){qt.getHole(s,i,e);const n=this.saveInteriorProfile(s),r=this.interiorProfiles.get(n);this.getIntProfileNormalsAvg(s,n),this.getInteriorProfileBuffer(s,r)}return this.interiorProfiles}initializePositions(){const s=this._tileData.positionCount;this._tileData.positionBuffer=new Float32Array(s)}initializeNormals(){const s=this._tileData.normalCount;this._tileData.normalBuffer=new Int16Array(s)}setTileData(s){Array.isArray(s)?this._tileData=s[this._indices]:this._tileData=s}constructShell(s,t,e){const i=qt.getProfilesLength(s);for(let n=0;n<i;n++){const r=this.getIndices(s,n);this.computeNormalsAvg(s,r,n),this.constructProfile(n,s,r,t),this.manageMemory(s,e)}}constructFaceX(s,t,e){const i=this.getNextFaceId();_1.create(s,t,this._normalsAvg,e,this._tileData,this.interiorProfiles,this._sizes,i)}getTempProfile(s){return s.type()===ys.BIG?this._bigShellProfile:this._shellProfile}getTempHole(s){return s.type()===ys.BIG?this._bigShellHole:this._shellHole}},fP=class{constructor(s){S(this,"a",new F),S(this,"b",new F),S(this,"c",new F),S(this,"d",new F),S(this,"e",new F),S(this,"f",new F),S(this,"g",new F),S(this,"h",new F),S(this,"i",new F),S(this,"j",new F),S(this,"k",new F),S(this,"tempTriangle",new ks),S(this,"tempPlane",new Ht),S(this,"includedVertices",[]),S(this,"interiorProfiles",new Map),S(this,"_meshes"),this._meshes=s}faceRaycast(s,t){const e=qt.getShell(this._meshes,s);this.resetData(),this.getInteriorProfiles(e);const i=qt.getBuffer(e);return this.processAllCollisions(e,i,t),this.includedVertices}resetVectors(){this.a.set(0,0,0),this.b.set(0,0,0),this.c.set(0,0,0),this.d.set(0,0,0)}resetData(){this.includedVertices.length=0,this.interiorProfiles.clear()}getInteriorProfiles(s){const t=qt.getHolesLength(s);for(let e=0;e<t;e++){const i=qt.getHole(s,e).profileId();this.interiorProfiles.has(i)||this.interiorProfiles.set(i,[]),this.interiorProfiles.get(i).push(e)}}processTriangle(s,t,e){const i=3*s[0],n=3*s[1],r=3*s[2];this.saveTriPoint(this.e,t,i),this.saveTriPoint(this.f,t,n),this.saveTriPoint(this.g,t,r);const o=this.triangleHit(e);if(o){const a=this.getTriangleBuffer(t,s);o.facePoints=a.points,o.faceIndices=a.indices,this.includedVertices.push(o)}}processAllCollisions(s,t,e){const i=qt.getProfilesLength(s);for(let n=0;n<i;n++){this.resetVectors();const r=this.getIndices(s,n);this.getValidCollision(r,t,e,n,s)&&this.processCollision(s,n,t,r)}}saveTriPoint(s,t,e){const i=t[e],n=t[e+1],r=t[e+2];s.set(i,n,r)}getIndices(s,t){return qt.getProfile(s,t).indicesArray()}getIsTriangle(s){return s.length===3}getNormal(){this.tempTriangle.a=this.e,this.tempTriangle.b=this.f,this.tempTriangle.c=this.g;const s=new F;return this.tempTriangle.getNormal(s),s}isHole(s,t,e){if(this.interiorProfiles.has(s)){const i=this.interiorProfiles.get(s);return this.holeContains(i,t,e)}return!1}computeNormal(s,t){this.d.set(0,0,0);const e=t.length;for(let i=0;i<e;i++){const n=(i+1)%e,r=3*t[i],o=3*t[n];this.processNormal(s,r,o)}this.d.normalize()}holeContains(s,t,e){const i=s.length;for(let n=0;n<i;n++){const r=qt.getHole(t,s[n]).indicesArray();if(this.polygonContains(e,r))return!0}return!1}triangleHit(s){const t=this.e,e=this.f,i=this.g;if(!s.intersectTriangle(t,e,i,!1,this.h))return;const n=this.getNormal();return{point:this.h.clone(),normal:n}}getValidCollision(s,t,e,i,n){return this.getIsTriangle(s)?(this.processTriangle(s,t,e),!1):this.getCollidesPlane(s,t,e)?!this.isHole(i,n,t):!1}processCollision(s,t,e,i){if(!this.polygonContains(e,i))return;const n=this.b.clone(),r=this.tempPlane.normal.clone(),o=this.getFaceBuffer(s,t,e);this.includedVertices.push({point:n,normal:r,facePoints:o.points,faceIndices:o.indices})}newOrthoNormalBasis(){const s=this.tempPlane.normal,t=this.j,e=this.i;if(Math.abs(s.x)>=Math.abs(s.y)){const i=1/Math.sqrt(s.x*s.x+s.z*s.z),n=-s.z*i,r=0,o=s.x*i;t.set(n,r,o);const a=s.y*t.z,l=s.z*t.x-s.x*t.z,h=-s.y*t.x;e.set(a,l,h)}else{const i=1/Math.sqrt(s.y*s.y+s.z*s.z),n=0,r=s.z*i,o=-s.y*i;t.set(n,r,o);const a=s.y*t.z-s.z*t.y,l=-s.x*t.z,h=s.x*t.y;e.set(a,l,h)}t.normalize(),e.normalize()}polygonContains(s,t){let e=!1;this.newOrthoNormalBasis(),this.setPolyContainVec(t,s);let i=this.k.dot(this.i),n=this.k.dot(this.j);for(let r=0;r<t.length;r++){const o=3*t[r],a=s[o],l=s[o+1],h=s[o+2];this.k.set(a,l,h),this.k.sub(this.b);const c=this.k.dot(this.i),u=this.k.dot(this.j);u>0!=n>0&&(i-c)*-u/(n-u)+c>0&&(e=!e),i=c,n=u}return e}processNormal(s,t,e){const i=s[t+0],n=s[e+0],r=s[t+1],o=s[e+1],a=s[t+2],l=s[e+2];this.d.x+=(r-o)*(a+l),this.d.y+=(a-l)*(i+n),this.d.z+=(i-n)*(r+o)}getCollidesPlane(s,t,e){const i=3*s[0],n=t[i],r=t[i+1],o=t[i+2];return this.a.set(n,r,o),this.computeNormal(t,s),this.tempPlane.setFromNormalAndCoplanarPoint(this.d,this.a),e.intersectPlane(this.tempPlane,this.b)}setPolyContainVec(s,t){const e=3*s[s.length-1],i=t[e],n=t[e+1],r=t[e+2];this.k.set(i,n,r),this.k.sub(this.b)}getTriangleBuffer(s,t){const e=[],i=[];for(let n=0;n<t.length;n++){const r=3*t[n];e.push(s[r],s[r+1],s[r+2]),i.push(n)}return{points:new Float32Array(e),indices:i}}getFaceBuffer(s,t,e){const i=qt.getProfileIndices(s,t),{outer:n,inners:r}=i,o=[];for(let f=0;f<n.length;f++){const b=3*n[f];o.push(e[b],e[b+1],e[b+2])}const a=[];for(let f=0;f<r.length;f++){const b=r[f];a.push(o.length/3);for(let y=0;y<b.length;y++){const E=3*b[y];o.push(e[E],e[E+1],e[E+2])}}const l=new F,h=new F,c=new F;l.set(o[0],o[1],o[2]),h.set(o[3],o[4],o[5]),c.set(o[6],o[7],o[8]);const u=new ks;u.set(l,h,c);const p=new F;u.getNormal(p);const[d,_]=Yw.getEarcutDimensions(p),m=[];for(let f=0;f<o.length;f+=3){const b=[o[f],o[f+1],o[f+2]];m.push(b[d],b[_])}const g=hS(m,a);return{points:new Float32Array(o),indices:g}}},mP=class{constructor(s){S(this,"_meshes"),S(this,"_minAngle",Math.PI/32),S(this,"_shellProfile",new Jo),S(this,"_bigShellProfile",new Ko),S(this,"_tempV1",new F),S(this,"_tempV2",new F),S(this,"_tempPoint",new F),S(this,"_normals",[]),S(this,"_pointsByProfile",new Map),S(this,"_shell",new tn),S(this,"_result",[]),this._meshes=s}lineRaycast(s,t,e){return this.resetData(s),this.lineRaycastItems(t,e),this._result}lineRaycastItems(s,t){const e=qt.getProfilesLength(this._shell);for(let i=0;i<e;i++){const n=this.getTempProfile(this._shell);qt.getProfile(this._shell,i,n),this.lineRaycastProfile(s,t,i)}}resetData(s){this._shell=qt.getShell(this._meshes,s),this._normals.length=0,qt.getNormalsOfShellProfile(this._shell,this._normals),this._pointsByProfile=qt.getPointsShell(this._shell),this._result=[]}lineRaycastProfile(s,t,e){const i=this.getTempProfile(this._shell),n=i.indicesLength();for(let r=0;r<n;r++){const o=i.indices(r),a=this.getSecondIndex(r,n);this.cast(o,a,s,t,e)&&this.saveResult(e)}}isInvalidAngle(s,t,e){const i=this.getProfile(s,t,e);if(!i.length)return!0;const n=this._normals[i[0]],r=this._normals[e];return n.dot(r)>Math.cos(this._minAngle)}getProfile(s,t,e){const i=this._pointsByProfile.get(s),n=this._pointsByProfile.get(t),r=[];for(const o of i)n.indexOf(o)!==-1&&o!==e&&r.push(o);return r}cast(s,t,e,i,n){return qt.point(this._shell,s,this._tempV1),qt.point(this._shell,t,this._tempV2),this.raycastSegment(e),i.containsPoint(this._tempPoint)?!this.isInvalidAngle(s,t,n):!1}saveResult(s){const t=this._tempV1.clone(),e=this._tempV2.clone(),i=this._normals[s],n=this._tempPoint.clone();this._result.push({point:n,normal:i,snappedEdgeP1:t,snappedEdgeP2:e})}getSecondIndex(s,t){const e=s===t-1,i=this.getTempProfile(this._shell);return e?i.indices(0):i.indices(s+1)}raycastSegment(s){s.distanceSqToSegment(this._tempV1,this._tempV2,void 0,this._tempPoint)}getTempProfile(s){return s.type()===ys.BIG?this._bigShellProfile:this._shellProfile}},gP=class{constructor(s){S(this,"_meshes"),S(this,"_tempVec",new F),this._meshes=s}pointRaycast(s,t){const e=qt.getShell(this._meshes,s),i=[];return this.cast(e,t,i),i}cast(s,t,e){const i=s.pointsLength();for(let n=0;n<i;n++){if(qt.point(s,n,this._tempVec),!t.containsPoint(this._tempVec))continue;const r=this._tempVec.clone();e.push({point:r})}}},_P=class extends p1{constructor(){super(...arguments),S(this,"_lodClass",ko.AABB),S(this,"_objectClass",zs.SHELL),S(this,"_representationClass",to.SHELL),S(this,"_templates",new tP),S(this,"_constructor",new pP),S(this,"_faceRaycaster",new fP(this.meshes)),S(this,"_lineRaycaster",new mP(this.meshes)),S(this,"_pointRaycaster",new gP(this.meshes))}fetchMeshes(s,t){const e=this.getMesh(s,Yt.GEOMETRY);return this.constructMesh(e,t,s),e}newMeshTemplate(s){return this._templates.newMeshTemplate(s)}lineRaycast(s,t,e){return this._lineRaycaster.lineRaycast(s,t,e)}faceRaycast(s,t){return this._faceRaycaster.faceRaycast(s,t)}raycast(s,t){return this._faceRaycaster.faceRaycast(s,t)}pointRaycast(s,t,e){return this._pointRaycaster.pointRaycast(s,e)}setupTemplates(){for(let s=0,t=this.meshes.shellsLength();s<t;s++){const e=qt.getShell(this.meshes,s);this.useMesh(s,this.newMeshTemplate(e),Yt.GEOMETRY)}}getRepresentation(){return this._representationClass}getObjectClass(){return this._objectClass}getLodClass(){return this._lodClass}isVoidMesh(s){return Array.isArray(s)?s[0].positionBuffer===void 0:s.positionBuffer===void 0}constructMesh(s,t,e){if(!this.isVoidMesh(s)||!t)return;const i=qt.getShell(this.meshes,e);this._constructor.construct(i,s),this.saveMesh(e,s,Yt.GEOMETRY)}},Dt=class{static circleCurve3Divisions(s){const t=s.aperture()*s.radius()*4,e=Math.round(t);return Math.min(Math.max(e,4),32)}static traverseCircleCurve(s,t,e){const i=s.circleCurvesLength();for(let n=0;n<i;n++){this.getAllCircleCurveData(s,n);const r=e(this._circleCurve);this._circlePoints.length=r-2,this.getCircleCurveMids(r),this.getNewCircleCurveData(),t(this._circleP1,this._circlePoints,this._circleP2)}}static traverseWireSets(s,t){const e=s.wireSetsLength();for(let i=0;i<e;i++)s.wireSets(i,this._wireSet),this.traverseWireSetWires(t)}static raycastCircleExtr(s,t,e,i){const n=t.distanceTo(s);return this.setupCircleExtrusionAxes(t,s),this.setupCircleExtrusionTransform(s,i),this.setupCircleExtrusionRay(e),this.computeCircleExtrusionRaycast(n,i)}static traverseWires(s,t){const e=s.wiresLength();for(let i=0;i<e;i++)s.wires(i,this._wire),this.setWire(),t(this._wireP1,this._wireP2)}static getNewCircleCurveData(){this._circleP2.copy(this._circleP1);const s=this._circleCurve.aperture(),t=this._circleCurve.radius();this._circleP2.applyAxisAngle(this._circleOrientation,s),this._circleP2.multiplyScalar(t),this._circleP2.add(this._circleOrigin),this._circleP1.multiplyScalar(t),this._circleP1.add(this._circleOrigin)}static setWire(){this.setWirePoint("p1",this._wireP1),this.setWirePoint("p2",this._wireP2)}static getCircleCurveMids(s){const t=this._circlePoints.length;for(let e=0;e<t;e++)this._circlePoints[e]=this.newCirclePoint(e,s)}static newCirclePoint(s,t){const e=t-1,i=s+1,n=new F;n.copy(this._circleP1);const r=this._circleCurve.radius(),o=this._circleCurve.aperture()*i/e;return n.applyAxisAngle(this._circleOrientation,o),n.multiplyScalar(r),n.add(this._circleOrigin),n}static getAllCircleCurveData(s,t){s.circleCurves(t,this._circleCurve),this.getCircleCurveData(this._circleOrigin,"position"),this.getCircleCurveData(this._circleOrientation,"xDirection"),this.getCircleCurveData(this._circleP1,"yDirection")}static setWirePoint(s,t){this._wire[s](this._floats);const e=this._floats.x(),i=this._floats.y(),n=this._floats.z();t.set(e,i,n)}static getCircleCurveData(s,t){const e=this._circleCurve[t]();this.getVectorData(e,s)}static getVectorData(s,t){const e=s.x(),i=s.y(),n=s.z();t.set(e,i,n)}static traverseWireSetWires(s){const t=this._wireSet.psLength()-1;for(let e=0;e<t;e++)this.getWiresetPoint(this._currentWireSetPoint,e),this.getWiresetPoint(this._nextWireSetPoint,e+1),s(this._currentWireSetPoint,this._nextWireSetPoint)}static getWiresetPoint(s,t){const e=this._wireSet.ps(t);this.getVectorData(e,s)}static setupCircleExtrusionTransform(s,t){this._ceTransform.identity(),this._ceTransform.makeBasis(this._ceAxisX,this._ceAxisY,this._ceAxisZ),this._ceTransform.setPosition(s),this._ceSize.set(t,t,t),this._ceTransform.scale(this._ceSize)}static computeCircleExtrusionRaycastFactors(){const s=this._ceRay.direction,t=this._ceRay.origin,e=s.x*s.x+s.y*s.y,i=2*t.x*s.x+2*t.y*s.y,n=4*e*(t.x*t.x+t.y*t.y-1),r=i*i;if(n>r)return null;const o=2*e,a=Math.sqrt(r-n);return{factorA:(-i+a)/o,factorB:(-i-a)/o}}static computeCircleExtrusionRaycast(s,t){const e=this.computeCircleExtrusionRaycastFactors();if(e===null)return[];const{factorA:i,factorB:n}=e;return this._ceInverseTransform.transpose(),this._ceRaycastPoints=[],this.computeCircleExtrusionRaycastPoints(i,s,t),this.computeCircleExtrusionRaycastPoints(n,s,t),this._ceRaycastPoints}static setupCircleExtrusionRay(s){this._ceInverseTransform.copy(this._ceTransform),this._ceInverseTransform.invert(),this._ceRay.copy(s),this._ceRay.applyMatrix4(this._ceInverseTransform)}static computeCircleExtrusionRaycastPoints(s,t,e){if(!this.checkIfCircleExtrusionClashes(s,t,e))return;this._ceRaycastPoint.applyMatrix4(this._ceTransform);const i=this._ceRaycastPoint.clone();this._ceRaycastPoints.push({point:i})}static setupCircleExtrusionAxes(s,t){this._ceAxisZ.copy(s),this._ceAxisZ.sub(t),this._ceAxisZ.normalize(),this.computeNormal(this._ceAxisZ,this._ceAxisX),this._ceAxisY.crossVectors(this._ceAxisZ,this._ceAxisX)}static computeNormal(s,t){const e=s.dot(this._ceAbsoluteX),i=Math.abs(e)>.9?this._ceAbsoluteZ:this._ceAbsoluteX;t.crossVectors(s,i),t.normalize()}static setupCircleExtrusionRaycastPoint(s){this._ceRaycastPoint.copy(this._ceRay.direction),this._ceRaycastPoint.normalize(),this._ceRaycastPoint.multiplyScalar(s),this._ceRaycastPoint.add(this._ceRay.origin)}static checkIfCircleExtrusionClashes(s,t,e){this.setupCircleExtrusionRaycastPoint(s);const i=t/e,n=this._ceRaycastPoint.z;return n>=0&&n<=i}};S(Dt,"_floats",new os),S(Dt,"_wire",new A_),S(Dt,"_wireSet",new S_),S(Dt,"_circleCurve",new Dp),S(Dt,"_wireP1",new F),S(Dt,"_wireP2",new F),S(Dt,"_circleP1",new F),S(Dt,"_circleP2",new F),S(Dt,"_circleOrigin",new F),S(Dt,"_circleOrientation",new F),S(Dt,"_currentWireSetPoint",new F),S(Dt,"_nextWireSetPoint",new F),S(Dt,"_ceAxisZ",new F),S(Dt,"_ceAxisY",new F),S(Dt,"_ceAxisX",new F),S(Dt,"_ceRaycastPoint",new F),S(Dt,"_ceSize",new F),S(Dt,"_ceAbsoluteX",new F(0,0,1)),S(Dt,"_ceAbsoluteZ",new F(1,0,0)),S(Dt,"_circlePoints",[]),S(Dt,"_ceTransform",new vt),S(Dt,"_ceInverseTransform",new vt),S(Dt,"_ceRay",new Jr),S(Dt,"_ceRaycastPoints",[]);const Le=class Xa{static newPaths(t,e){const i=Xa.newPathData();return this.fetchCircleCurveData(t,i),this.fetchCircleCurveMids(e,i,t),this.fetchCircleCurveEnds(i,t),this.fetchCircleCurveCuts(i),i.cuts}static getAxisPartSize(t,e,i){const n=t.parts(e),r=t.order(e),o=Xa.getAxisPartData(n,i,t,r);return Xa.fetchAxisPartSize(i,o),this._axisPartSize}static vertexLength(t,e=200){const i=Math.round(t*e),n=Math.max(i,Xa._minSize);return Math.min(n,Xa._maxSize)}static setPathVertices(t){const e=this.circleCurvePoints,i=!e,n=e&&e.length!==t;if(i||n){this.circleCurvePoints=[];for(let r=0;r<t;r++){const o=2*Math.PI*r/t,a=Math.sin(o),l=Math.cos(o),h=new F(a,l,0);this.circleCurvePoints.push(h)}}}static fetchCircleCurveEnds(t,e){t.last.copy(t.first),t.last.applyAxisAngle(t.axis,e.aperture()),t.last.multiplyScalar(e.radius()),t.last.add(t.center),t.first.multiplyScalar(e.radius()),t.first.add(t.center)}static getAxisPartData(t,e,i,n){return{[Me.WIRE]:this.getAxisPartWireData,[Me.WIRE_SET]:this.getAxisPartWireSetData,[Me.CIRCLE_CURVE]:this.getAxisPartCircleCurveData}[t](i,n,e)}static newEmptyAxisPartData(){return{indices:0,points:0,faces:0,links:0}}static fetchCircleCurveMids(t,e,i){const n=t-2;for(let r=0;r<n;r++){const o=new F;o.copy(e.first);const a=i.aperture()*(r+1)/(t-1);o.applyAxisAngle(e.axis,a),o.multiplyScalar(i.radius()),o.add(e.center),e.mids[r]=o}}static validSize(t,e,i){return bl>=t+e+i}static fetchCircleCurveCuts(t){t.cuts.push(t.first),t.cuts.push(...t.mids),t.cuts.push(t.last)}static fetchCircleCurveData(t,e){const i=t.position();e.center.set(i.x(),i.y(),i.z());const n=t.xDirection();e.axis.set(n.x(),n.y(),n.z());const r=t.yDirection();e.first.set(r.x(),r.y(),r.z())}static newPathData(){return{axis:new F,cuts:[],center:new F,last:new F,first:new F,mids:[]}}static fetchAxisPartSize(t,e){const i=t-2,n=e.faces*i*3,r=e.links*t*this._wireSize;this._axisPartSize.verticesLength=e.points,this._axisPartSize.indicesLength=e.indices+n+r}};S(Le,"up",new F(0,0,1)),S(Le,"circleCurves",[]),S(Le,"circleCurvePoints"),S(Le,"temp",{circleExtrusion:new Ji,circleCurve:new Dp,wireSet:new S_,axis:new ms,rotation:new Ie,vector:new F}),S(Le,"_wireSize",6),S(Le,"_minSize",6),S(Le,"_maxSize",30),S(Le,"_axisPartSize",{verticesLength:0,indicesLength:0}),S(Le,"getAxisPartWireSetData",(s,t,e)=>{const i=Le.newEmptyAxisPartData();s.wireSets(t,Le.temp.wireSet);const n=Le.temp.wireSet.psLength()-1;return i.points=2*n*e,i.indices=Le._wireSize*n*e,i.faces=2*n,i}),S(Le,"getAxisPartWireData",(s,t,e)=>{const i=Le.newEmptyAxisPartData();return i.points=2*e,i.indices=Le._wireSize*e,i.faces=2,i}),S(Le,"getAxisPartCircleCurveData",(s,t,e)=>{const i=Le.newEmptyAxisPartData();s.circleCurves(t,Le.temp.circleCurve);const n=Dt.circleCurve3Divisions(Le.temp.circleCurve),r=e*n;i.points=r;const o=e*(n-1),a=Le._wireSize*o;return i.indices=a,i.faces=2,i.links=2,i});let bt=Le,bP=class{constructor(){S(this,"_minLinkDistance",1e-8),S(this,"_first",new F),S(this,"_last",new F),S(this,"_currentPoint"),S(this,"_currentIndex"),S(this,"_v1",new F),S(this,"_v2",new F),S(this,"_v3",new F),S(this,"_v4",new F),S(this,"_tempLine",new Gt),S(this,"_total",0),S(this,"_closest",0),S(this,"_result",0)}newTemplate(s,t,e){const i=s.radius(t),n=s.axes(t,bt.temp.axis),r=bt.vertexLength(i);let o=e[e.length-1];const a=n.orderLength();for(let l=0;l<a;l++)o=this.generateTemplate(n,l,r,o,e)}construct(s,t){const e={};let i=0;for(let n=0,r=s.axesLength();n<r;n++){const o=s.radius(n);s.axes(n,bt.temp.axis);const a=bt.vertexLength(o);i=this.constructVce(a,e,void 0,i,0,t,o)}}getTemplateCreationData(s,t,e){const i=!s;let n=!1;if(!i){const r=s.positionCount/3,o=t.verticesLength;n=bt.validSize(r,o,e)}return{isStart:i,fits:n}}generateTemplate(s,t,e,i,n){const r=bt.getAxisPartSize(s,t,e),{isStart:o,fits:a}=this.getTemplateCreationData(i,r,e);return(o||!a)&&(i=this.newTemplateData(),n.push(i),this.savePrevious(o,t,e,i)),i.positionCount+=3*r.verticesLength,i.normalCount+=3*r.verticesLength,i.indexCount+=r.indicesLength,i}savePrevious(s,t,e,i){if(!s&&t!==0){const n=3*(e-2);i.positionCount+=3*e,i.normalCount+=3*e,i.indexCount+=n}}constructNewVce(s,t,e,i,n,r,o){const a=!s;let l=!1;if(!a){const h=t.verticesLength;l=bt.validSize(e,h,i)}if(a||!l){s=n[r++],this.setupNewVceBuffers(s);const h=this._currentPoint;if(e=this.clearOffset(e),!a&&o!==0){const c=n[r-2];this.getClone(c,s,h,i),e+=i}}return{data:s,pointAmount:e,position:r}}constructVce(s,t,e,i,n,r,o){const a=bt.temp.axis.orderLength();for(let l=0;l<a;l++){const h=bt.temp.axis,c=bt.getAxisPartSize(h,l,s);this.setupLink(l,t),{data:e,pointAmount:i,position:n}=this.constructNewVce(e,c,i,s,r,n,l),this.newAxisPart(bt.temp.axis,l,e,o,s,t),i+=c.verticesLength}return i}newTemplateData(){return{objectClass:zs.SHELL,indexCount:0,positionCount:0,normalCount:0}}setupNewVceBuffers(s){s.positionBuffer=new Float32Array(s.positionCount),s.normalBuffer=new Int16Array(s.normalCount),s.indexBuffer=new Uint16Array(s.indexCount)}clearOffset(s){return this._currentPoint=0,this._currentIndex=0,0}getClone(s,t,e,i){for(let n=-3*i;n<0;n++){const r=t.positionBuffer,o=s.positionBuffer,a=t.normalBuffer,l=s.normalBuffer;r[this._currentPoint]=o[e+n],a[this._currentPoint]=l[e+n],this._currentPoint++}}manageAxisPartCreation(s,t,e,i,n,r,o){if(s!==Me.CIRCLE_CURVE)if(s!==Me.WIRE_SET){if(s===Me.WIRE){const a=t.wires(e);this.newWire(a,i,n,r,o)}}else{const a=t.wireSets(e);this.newWireSet(a,i,n,r,o)}else{const a=t.circleCurves(e);this.newCircleCurve(a,i,n,r,o)}}newWireSetStart(s,t,e,i){s===1?this.linkStart(t,e,i,this._first,Me.WIRE_SET):this.newPathOrderData(t,e)}newWireSet(s,t,e,i,n){for(let r=1,o=s.psLength();r<o;r++){const a=bt.temp.rotation;this.getWireSetPoints(s,r),this.setWireSetVector(),this.newPath(this._first,t,a,e,i),this.newWireSetStart(r,e,i,n),this.newPath(this._last,t,a,e,i),this.fillWireSetData(r,o,n,e,i),this.linkPaths(e,i)}}fillWireSetData(s,t,e,i,n){s!==t-1||e.last?this.newPathOrderData(i,n,!0):(e.placement=this._last,e.axisClass=Me.WIRE_SET)}setWireSetVector(){bt.temp.vector.copy(this._last),bt.temp.vector.sub(this._first),bt.temp.vector.normalize(),bt.temp.rotation.setFromUnitVectors(bt.up,bt.temp.vector)}newCircleCurveBody(s,t,e,i){const n=s-2;for(let r=0;r<n;r++){const o=bt.circleCurves[r],a=bt.circleCurves[r+1],l=bt.circleCurves[r+2],h=bt.temp.vector;h.copy(l),h.sub(o),h.normalize(),bt.temp.rotation.setFromUnitVectors(bt.up,h),this.newPath(a,t,bt.temp.rotation,e,i),this.linkPaths(e,i,!0)}}newCircleCurveFinish(s,t,e,i,n){const r=s-2,o=s-1,a=bt.circleCurves[r],l=bt.circleCurves[o],h=bt.temp.vector;h.copy(l),h.sub(a),h.normalize(),bt.temp.rotation.setFromUnitVectors(bt.up,h),this.newPath(l,t,bt.temp.rotation,e,i),n.last?this.newPathOrderData(e,i,!0):(n.placement=bt.circleCurves[o],n.axisClass=Me.CIRCLE_CURVE)}setupLink(s,t){s===0&&(t.first=!0),s===bt.temp.axis.orderLength()-1&&(t.last=!0)}newCircleCurveStart(s,t,e,i){const n=bt.circleCurves[0],r=bt.circleCurves[1],o=bt.temp.vector;o.copy(r),o.sub(n),o.normalize(),bt.temp.rotation.setFromUnitVectors(bt.up,o),this.newPath(n,s,bt.temp.rotation,t,e);const a=Me.CIRCLE_CURVE;this.linkStart(t,e,i,n,a)}getWireSetPoints(s,t){const e=s.ps(t-1);this._first.set(e.x(),e.y(),e.z());const i=s.ps(t);this._last.set(i.x(),i.y(),i.z())}finishWire(s,t,e,i){this.newPath(this._last,s,bt.temp.rotation,t,e),i.last?this.newPathOrderData(t,e,!0):(i.placement=this._last,i.axisClass=Me.WIRE),this.linkPaths(t,e)}linkPaths(s,t,e=!1){const i=t,{p1:n,p2:r,p3:o}=this.getPathPositions(i,e,s),a=s.indexBuffer;for(let l=0;l<i;l++){const h=(l+1)%i,{i3:c,i4:u,i1:p,i2:d}=this.getLinkPathIndices(o,l,n,i,h,r);a[this._currentIndex++]=c,a[this._currentIndex++]=u,a[this._currentIndex++]=p,a[this._currentIndex++]=p,a[this._currentIndex++]=u,a[this._currentIndex++]=d}}startWire(s,t,e,i){this.newPath(this._first,s,bt.temp.rotation,t,e);const n=Me.WIRE;this.linkStart(t,e,i,this._first,n)}setupWireVectors(){const s=bt.temp.vector;s.copy(this._last),s.sub(this._first),s.normalize(),bt.temp.rotation.setFromUnitVectors(bt.up,s)}getLinkPathIndices(s,t,e,i,n,r){let o=0,a=0,l=0,h=0;return o=s+t>=e?s+t-i:s+t,a=s+n>=e?s+n-i:s+n,l=r+t>=e+i?r+t-i:r+t,h=r+n>=e+i?r+n-i:r+n,{i3:l,i4:h,i1:o,i2:a}}fetchWirePoints(s){const t=s.p1(),e=s.p2();this._first.set(t.x(),t.y(),t.z()),this._last.set(e.x(),e.y(),e.z())}findLinkedVertex(s,t,e,i,n){for(let r=s;r<t;r++){this.point(r,e,this._v1);const o=r-i+n,a=o>=s?o-i:o;this.point(a,e,this._v2);const l=o+1>=s?o+1-i:o+1;this.point(l,e,this._v3),this._tempLine.set(this._v2,this._v3),this._tempLine.closestPointToPoint(this._v1,!0,this._v4),this._total+=this._v4.distanceTo(this._v1)}}newPath(s,t,e,i,n){bt.setPathVertices(n);for(let r=0;r<n;r++)this.setPathPosition(r,t,e,s,i),this.setPathNormal(r,e,i),this._currentPoint+=3}linkStart(s,t,e,i,n){if(e.first)return void this.newPathOrderData(s,t);const r=Me.CIRCLE_CURVE,o=e.axisClass===r||n===r,a=e.placement.distanceToSquared(i)<this._minLinkDistance;if(!o||!a)return this.newPathOrderData(s,t,!0,!0),void this.newPathOrderData(s,t);this.linkPaths(s,t,!0)}setPathPosition(s,t,e,i,n){const r=bt.temp.vector;r.copy(bt.circleCurvePoints[s]),r.multiplyScalar(t),r.applyQuaternion(e),r.add(i);const o=n.positionBuffer,a=this._currentPoint,l=this._currentPoint+1,h=this._currentPoint+2;o[a]=r.x,o[l]=r.y,o[h]=r.z}newWire(s,t,e,i,n){this.fetchWirePoints(s),this.setupWireVectors(),this.startWire(t,e,i,n),this.finishWire(t,e,i,n)}newCircleCurve(s,t,e,i,n){const r=Dt.circleCurve3Divisions(s);bt.circleCurves=bt.newPaths(s,r),this.newCircleCurveStart(t,e,i,n),this.newCircleCurveBody(r,t,e,i),this.newCircleCurveFinish(r,t,e,i,n),this.linkPaths(e,i,!0)}newPathOrderData(s,t,e=!1,i=!1){const n=t-2,r=s.indexBuffer;for(let o=0;o<n;o++){const a=this._currentPoint/3,l=t*(i?2:1),h=a-l;r[this._currentIndex]=h,this._currentIndex++;const c=a+o+(e?2:1)-l;r[this._currentIndex]=c,this._currentIndex++;const u=a+o+(e?1:2)-l;r[this._currentIndex]=u,this._currentIndex++}}getPathPositions(s,t,e){const i=this._currentPoint/3-s,n=i;let r=i-s;return t&&(r=this.fetchLinkedVertex(i,e,s)),{p3:r,p1:i,p2:n}}newAxisPart(s,t,e,i,n,r){const o=s.parts(t),a=s.order(t);this.manageAxisPartCreation(o,s,a,i,e,n,r),r.first=!1,r.last=!1}fetchLinkedVertex(s,t,e){this._closest=Number.MAX_VALUE;for(let i=0;i<e;i++){this._total=0;const n=s+e;this.findLinkedVertex(s,n,t,e,i),this._total<this._closest&&(this._closest=this._total,this._result=s-e+i+1)}return this._result}setPathNormal(s,t,e){const i=bt.temp.vector,n=bt.circleCurvePoints[s];i.copy(n),i.applyQuaternion(t);const r=e.normalBuffer,o=this._currentPoint,a=this._currentPoint+1,l=this._currentPoint+2;r[o]=i.x*ac,r[a]=i.y*ac,r[l]=i.z*ac}point(s,t,e){const i=t.positionBuffer,n=3*s+1,r=3*s+2,o=i[3*s],a=i[n],l=i[r];return e.set(o,a,l),e}},yP=class{constructor(s){S(this,"_meshes"),S(this,"_results",[]),S(this,"_circleExtrusion",new Ji),S(this,"_axis",new ms),this._meshes=s}raycast(s,t){this._results.length=0,this._meshes.circleExtrusions(s,this._circleExtrusion);for(let e=0,i=this._circleExtrusion.axesLength();e<i;e++){this._circleExtrusion.axes(e,this._axis);const n=this._circleExtrusion.radius(e);this.traverseAllCurves(t,n)}return this._results}getTraverseWiresEvent(s,t){return(e,i)=>{this.castCurveExtrusion(e,i,s,t)}}castCurveExtrusion(s,t,e,i){const n=Dt.raycastCircleExtr(s,t,e,i);for(const r of n)this._results.push(r)}getTraverseCircleCurveEvent(s,t){return(e,i,n)=>{const r=i[0];this.castCurveExtrusion(e,r,s,t);for(let a=0;a<i.length;a++){if(a===0)continue;const l=i[a-1],h=i[a];this.castCurveExtrusion(l,h,s,t)}const o=i[i.length-1];this.castCurveExtrusion(o,n,s,t)}}traverseAllCurves(s,t){const e=this.getTraverseWiresEvent(s,t);Dt.traverseWires(this._axis,e);const i=this.getTraverseCircleCurveEvent(s,t),n=Dt.circleCurve3Divisions;Dt.traverseCircleCurve(this._axis,i,n);const r=this.getTraverseWiresEvent(s,t);Dt.traverseWireSets(this._axis,r)}},vP=class{constructor(s){S(this,"_meshes"),S(this,"_found",[]),S(this,"_circleExtrusion",new Ji),S(this,"_axis",new ms),S(this,"_wirePoint",new F),this._meshes=s}lineRaycast(s,t){this._found.length=0,this._meshes.circleExtrusions(s,this._circleExtrusion);const e=this._circleExtrusion.axesLength();for(let i=0;i<e;i++)this._circleExtrusion.axes(i,this._axis),this.processLineRaycast(i,t);return this._found}wireSetRaycast(s,t){const e=this._axis;Dt.traverseWireSets(e,(i,n)=>{this.cylinderRaycast(i,n,s,t)})}exclusiveCylinderRaycast(s,t){const e=this._axis,i=this.getCylinderRaycastEvent(s,t);Dt.traverseWires(e,i)}processLineRaycast(s,t){const e=this._circleExtrusion.radius(s);this.exclusiveCylinderRaycast(t,e),this.circleCurveRaycast(t,e),this.wireSetRaycast(t,e)}getCylinderRaycastEvent(s,t){return(e,i)=>{this.cylinderRaycast(e,i,s,t)}}processCircleCurveBody(s,t,e){for(let i=0;i<s.length;i++){if(i===0)continue;const n=s[i],r=s[i-1];this.cylinderRaycast(r,n,t,e)}}getCircleCurveRaycastEvent(s,t){return(e,i,n)=>{this.cylinderRaycast(e,i[0],s,t),this.processCircleCurveBody(i,s,t);const r=i[i.length-1];this.cylinderRaycast(r,n,s,t)}}fetchCylinderRaycastResult(s,t,e){s.distanceSqToSegment(t,e,void 0,this._wirePoint);const i=this.newResult(t,e);this._found.push(i)}circleCurveRaycast(s,t){const e=Dt.circleCurve3Divisions,i=this.getCircleCurveRaycastEvent(s,t);Dt.traverseCircleCurve(this._axis,i,e)}newResult(s,t){return{point:this._wirePoint.clone(),raySquaredDistance:void 0,snappedEdgeP1:s.clone(),snappedEdgeP2:t.clone()}}cylinderRaycast(s,t,e,i){const n=Dt.raycastCircleExtr(s,t,e,i);for(const r of n)r.point&&this.fetchCylinderRaycastResult(e,s,t)}},wP=class{constructor(s){S(this,"_meshes"),S(this,"_results",[]),S(this,"_circleExtrusion",new Ji),S(this,"_axis",new ms),S(this,"_normal",new F),S(this,"_point",new F),S(this,"_plane",new Ht),this._meshes=s}pointRaycast(s,t){return this._results.length=0,this._meshes.circleExtrusions(s,this._circleExtrusion),this.traverseAllCircleExtrusions(t),this.getCleanResults()}fetchOrientation(s,t){bt.temp.vector.copy(s),bt.temp.vector.sub(t),bt.temp.vector.normalize(),bt.temp.rotation.setFromUnitVectors(bt.up,bt.temp.vector)}getTraverseWiresEvent(s,t){return(e,i)=>{this.fetchOrientation(e,i);const n=this.raycastCutCircleExtrusion(e,s,t),r=this.raycastCutCircleExtrusion(i,s,t);this._results.push(n,r)}}traverseAllCircleExtrusions(s){const t=this._circleExtrusion.axesLength();for(let e=0;e<t;e++){this._circleExtrusion.axes(e,this._axis);const i=this._circleExtrusion.radius(e),n=bt.vertexLength(i);bt.setPathVertices(n),this.traverseAllCurves(s,i)}}setupCuttedCircleExtrusion(s){this._normal.set(0,0,1),this._normal.applyQuaternion(bt.temp.rotation),this._plane.setFromNormalAndCoplanarPoint(this._normal,s)}getTraverseCircleCurveEvent(s,t){return(e,i,n)=>{this.fetchOrientation(e,i[0]);const r=this.raycastCutCircleExtrusion(e,s,t),o=i[i.length-1];this.fetchOrientation(o,n);const a=this.raycastCutCircleExtrusion(n,s,t);this._results.push(r,a)}}computeCutCircleExtrCast(s,t,e){if(e.intersectPlane(this._plane,this._point),this._point.distanceTo(s)<=t)return{point:s.clone()}}raycastCutCircleExtrusion(s,t,e){if(this.setupCuttedCircleExtrusion(s),t.intersectsPlane(this._plane))return this.computeCutCircleExtrCast(s,e,t)}getCleanResults(){const s=[];for(const t of this._results)t&&s.push(t);return s}traverseAllCurves(s,t){const e=this.getTraverseWiresEvent(s,t);Dt.traverseWires(this._axis,e);const i=this.getTraverseCircleCurveEvent(s,t),n=Dt.circleCurve3Divisions;Dt.traverseCircleCurve(this._axis,i,n);const r=this.getTraverseWiresEvent(s,t);Dt.traverseWireSets(this._axis,r)}},EP=class{constructor(){S(this,"_currentElement",0),S(this,"_wireSize",6),S(this,"newCircleCurveLod",(s,t,e)=>{const i=this.newCircleCurveLodPath(s,t),n=e.positionBuffer;for(let r=1;r<i;r++){const o=bt.circleCurves[r-1],a=bt.circleCurves[r];this.newWire(n,o,a)}}),S(this,"newWireSetLod",(s,t,e)=>{const i=s.wireSets(t),n=i.psLength(),r=e.positionBuffer;for(let o=1;o<n;o++){const a=i.ps(o-1),l=i.ps(o);this.newWire(r,a,l)}}),S(this,"newWireTemplate",(s,t)=>{t.positionCount+=this._wireSize}),S(this,"newWireSetTemplate",(s,t)=>{const e=bt.temp.axis.wireSets(s,bt.temp.wireSet).psLength()-1;t.positionCount+=this._wireSize*e}),S(this,"newWireLod",(s,t,e)=>{const i=s.wires(t),n=i.p1(),r=i.p2(),o=e.positionBuffer;this.newWire(o,n,r)}),S(this,"newCircleCurveTemplate",(s,t)=>{const e=bt.temp.axis.circleCurves(s,bt.temp.circleCurve),i=Dt.circleCurve3Divisions(e);t.positionCount+=this._wireSize*(i-1)})}construct(s,t){this._currentElement=0,t.positionBuffer=new Float32Array(t.positionCount);for(let e=0,i=s.axesLength();e<i;e++)s.axes(e,bt.temp.axis),this.constructLod(t);return t}constructCircleExtrusionLod(s,t){const e=bt.temp.axis,i=e.parts(s),n=e.order(s);this.getLodConstructor(i)(e,n,t)}newCircleCurveLodPath(s,t){const e=s.circleCurves(t),i=Dt.circleCurve3Divisions(e);return bt.circleCurves=bt.newPaths(e,i),i}selectNextWire(){this._currentElement+=this._wireSize}getAxisPartVertexSize(s,t){const e=bt.temp.axis,i=e.parts(s),n=e.order(s);this.getTemplateConstructor(i)(n,t)}getIndices(){return{i1:this._currentElement,i2:this._currentElement+1,i3:this._currentElement+2,i4:this._currentElement+3,i5:this._currentElement+4,i6:this._currentElement+5}}setAxisTemplate(s,t){bt.temp.circleExtrusion.axes(s,bt.temp.axis);const e=bt.temp.axis.partsLength();for(let i=0;i<e;i++)this.getAxisPartVertexSize(i,t);this.setAxisThickness(t,s)}constructLod(s){const t=bt.temp.axis.orderLength();for(let e=0;e<t;e++)this.constructCircleExtrusionLod(e,s)}getLodConstructor(s){return{[Me.WIRE]:this.newWireLod,[Me.WIRE_SET]:this.newWireSetLod,[Me.CIRCLE_CURVE]:this.newCircleCurveLod}[s]}newTemplate(){const s=bt.temp.circleExtrusion,t=this.newTemplateData(),e=s.axesLength();for(let i=0;i<e;i++)this.setAxisTemplate(i,t);return t}setAxisThickness(s,t){const e=s.lodThickness,i=bt.temp.circleExtrusion.radius(t);s.lodThickness=Math.max(e,i)}newTemplateData(){return{objectClass:zs.LINE,lod:Yt.WIRES,lodThickness:0,positionCount:0}}getTemplateConstructor(s){return{[Me.WIRE]:this.newWireTemplate,[Me.WIRE_SET]:this.newWireSetTemplate,[Me.CIRCLE_CURVE]:this.newCircleCurveTemplate}[s]}newWire(s,t,e){const i=t instanceof F?t.x:t.x(),n=t instanceof F?t.y:t.y(),r=t instanceof F?t.z:t.z(),o=e instanceof F?e.x:e.x(),a=e instanceof F?e.y:e.y(),l=e instanceof F?e.z:e.z(),{i1:h,i2:c,i3:u,i4:p,i5:d,i6:_}=this.getIndices();s[h]=i,s[c]=n,s[u]=r,s[p]=o,s[d]=a,s[_]=l,this.selectNextWire()}},CP=class extends p1{constructor(){super(...arguments),S(this,"_vceConstructor",new bP),S(this,"_lodConstructor",new EP),S(this,"_vceRaycaster",new yP(this.meshes)),S(this,"_vceLineRaycaster",new vP(this.meshes)),S(this,"_vcePointRaycaster",new wP(this.meshes)),S(this,"_representationClass",to.CIRCLE_EXTRUSION),S(this,"_objectClass",zs.LINE),S(this,"lodClass",ko.CUSTOM)}setupTemplates(){const s=this.meshes.circleExtrusionsLength();for(let t=0;t<s;t++)this.newCircleExtrusionTemplate(t)}fetchLod(s,t){const e=this.getMesh(s,Yt.WIRES);return this.generateLodIfNeeded(s,t,e),e}fetchMeshes(s,t){const e=this.getMesh(s,Yt.GEOMETRY);return this.generateMeshesIfNeeded(s,t,e),e}raycast(s,t){return this._vceRaycaster.raycast(s,t)}faceRaycast(){return[]}pointRaycast(s,t){return this._vcePointRaycaster.pointRaycast(s,t)}lineRaycast(s,t){return this._vceLineRaycaster.lineRaycast(s,t)}getObjectClass(){return this._objectClass}getRepresentation(){return this._representationClass}getLodClass(){return this.lodClass}newMeshes(s,t){this.meshes.circleExtrusions(s,bt.temp.circleExtrusion);const e=bt.temp.circleExtrusion;this._vceConstructor.construct(e,t),this.saveMesh(s,t,Yt.GEOMETRY)}generateMeshesIfNeeded(s,t,e){if(e.length===0)return;const i=!!e.length,n=!e[0].positionBuffer;t&&n&&i&&this.newMeshes(s,e)}newCircleExtrusionTemplate(s){const t=[];this.meshes.circleExtrusions(s,bt.temp.circleExtrusion);const e=bt.temp.circleExtrusion,i=e.axesLength();for(let r=0;r<i;r++)this._vceConstructor.newTemplate(e,r,t);const n=this._lodConstructor.newTemplate();this.useMesh(s,t,Yt.GEOMETRY),this.useMesh(s,n,Yt.WIRES)}generateLodIfNeeded(s,t,e){!e.positionBuffer&&t&&(this.meshes.circleExtrusions(s,bt.temp.circleExtrusion),this._lodConstructor.construct(bt.temp.circleExtrusion,e),this.saveMesh(s,e,Yt.WIRES))}},IP=class{constructor(s){S(this,"size"),S(this,"_data"),S(this,"_highlightData"),this.size=s,this._data=new Uint8Array(s),this._highlightData=new Uint16Array(s),this._data.fill(1)}getHighlight(s){return this._highlightData[s]}setHighlight(s,t){Ef.checkMemory(t),this._highlightData[s]=t}clearHighlight(){this._highlightData.fill(0)}visible(s){return Ef.check(this._data,s,og.VISIBLE)}setVisible(s,t){Ef.apply(this._data,s,og.VISIBLE,t)}clearVisible(){this._data.fill(1)}},xP=class{constructor(s,t){S(this,"_rate",64),S(this,"_updater"),S(this,"_modelId"),S(this,"_threshold",16),S(this,"_connection"),S(this,"_list",[]),S(this,"refresh",()=>{if(this._list.length){const e=this._list;this._connection.fetchMeshCompute(this._modelId,e),this._list=[]}}),this._modelId=s,this._connection=t,this._updater=jo.newUpdater(this.refresh,this._rate)}get needsRefresh(){return this._list.length>this._threshold}dispose(){jo.deleteUpdater(this._updater)}clean(){this._list=jo.cleanRequests(this._list)}process(s){this._list.push(s),this.needsRefresh&&this.refresh()}},TP=class{constructor(s,t,e,i){S(this,"_meshes"),S(this,"_model"),S(this,"_boxes"),S(this,"_tiles"),S(this,"_items"),S(this,"_edgeThreshold",8),S(this,"_raycastMultiplier",32),S(this,"_maxDuration",512),S(this,"_precission",.001),S(this,"_temp",{sample:new zp,representation:new kp,tempPlane:new Ht,ray:new Jr,frustum:new cr,m1:new vt,m2:new vt,m3:new vt,v1:new F,planes:[]}),this._model=s,this._boxes=t,this._tiles=e,this._items=i,this._meshes=s.meshes()}static cast(s,t,e,i,n){const r=t.id();return n===Qs.FACE?s.faceRaycast(r,e,i):n===Qs.LINE?s.lineRaycast(r,e,i):n===Qs.POINT?s.pointRaycast(r,e,i):n===void 0?s.raycast(r,e,i):void 0}raycast(s,t,e){const i={ray:s,frustum:t,planes:e},n=this.castBox(t,e);return n.length?this.computeRaycastList(n,i):null}snapRaycast(s,t,e,i){const n=[],r={ray:s,frustum:t,planes:i},o=this.raycast(s,t,i);return o?(this.getSnaps(o,r,e,n),o.normal?this.filterOnFront(n):n):this.snapCastEdges(r,e)}rectangleRaycast(s,t,e){const i=this._boxes.lookup.collideFrustum(t,s,e),n=this.filterVisible(i);return this.localIdsFromItemIds(n)}snapCastEdges(s,t){const e=[],i=t.includes(Qs.POINT),n=t.includes(Qs.LINE);return(i||n)&&this.computeEdgesCast(s,t,e),this.addDistanceToEdgeResult(e,s.ray),e}filterVisible(s){const t=[];for(const e of s){this._meshes.samples(e,this._temp.sample);const i=this._temp.sample.item();this._items.visible(i)&&t.push(e)}return t}computeSnaps(s,t,e,i){for(const n of s)if(this.isValidSnap(n)){const r={snap:n,...t},o=this.castSample(e,r);for(const a of o)i.push(a)}}computeEdgesCast(s,t,e){const i=this.getRawEdges(s),n=performance.now();for(const r of i)if(this.fetchSampleData(r),this.computeSnaps(t,s,r,e),this.isTimeExceeded(n))break}addDistanceToEdgeResult(s,t){for(const e of s){const i=e.point;e.raySquaredDistance=t.distanceSqToPoint(i)}}getRawEdges(s){const t=this.castBox(s.frustum,s.planes);return t.length<=this._edgeThreshold?t:this.sortBoxes(s.ray,t,this._edgeThreshold)}sortBoxes(s,t,e){const i=[],n=new F,r=s.origin;for(let a=0;a<t.length;a++){const l=t[a],h=this._boxes.get(l);s.intersectBox(h,n);const c=n.distanceToSquared(r);i.push(c)}const o=this.dataSort(t,i);return e&&o.length>e&&o.splice(e),o}castBox(s,t){const e=this._boxes.lookup;if(s instanceof Jr){const n=e.collideRay(t,s);return this.filterVisible(n)}const i=e.collideFrustum(t,s);return this.filterVisible(i)}dataSort(s,t){const e=Array.from(s.keys()).sort((n,r)=>t[n]-t[r]),i=[];for(const n of e){const r=s[n];i.push(r)}return i}localIdsFromItemIds(s){const t=new Set;for(const e of s){this._meshes.samples(e,this._temp.sample);const i=this._temp.sample.item(),n=this._meshes.meshesItems(i);if(n===null)continue;const r=this._model.localIds(n);r!==null&&t.add(r)}return Array.from(t)}getNearest(s){let t=s[0];for(let e=1;e<s.length;e++){const i=s[e];if(t.raySquaredDistance&&i.raySquaredDistance){const n=this.getNearScore(t);this.getNearScore(i)<n&&(t=i)}else i.cameraSquaredDistance<t.cameraSquaredDistance&&(t=i)}return t}getEdges(s,t,e){const i=this.snapCastEdges(s,t);if(i)for(const n of i)e.push(n)}getNearScore(s){const t=this._raycastMultiplier;return s.raySquaredDistance*t+s.cameraSquaredDistance}setupSampleCastData(s){nl.get(this._temp.sample,this._meshes,this._temp.m1),this._temp.m2.copy(this._temp.m1).invert(),this._temp.ray.copy(s.ray).applyMatrix4(this._temp.m2),Ho.transform(s.frustum,this._temp.m2,this._temp.frustum)}addLocalId(s){if(!s)return;const t=this._meshes.meshesItems(s.itemId);t!==null&&(s.localId=this._model.localIds(t))}fetchSampleData(s){this._meshes.samples(s,this._temp.sample);const t=this._temp.sample.representation();this._meshes.representations(t,this._temp.representation)}computeRaycastList(s,t){const e=Array.from(new Set(s)),i=this.sortBoxes(t.ray,e),n=this.castBox(t.ray,t.planes),r=this.findAll(i,n,t);if(r.length){const o=this.getNearest(r);return this.addLocalId(o),o}return null}formatRaycastResult(s,t,e){for(const i of s){if(i.point.applyMatrix4(this._temp.m1),i.normal&&i.normal.transformDirection(this._temp.m1),"facePoints"in i){const r=this._meshes.samples(t,this._temp.sample);nl.get(r,this._meshes,this._temp.m3);for(let o=0;o<i.facePoints.length;o+=3){const a=i.facePoints[o],l=i.facePoints[o+1],h=i.facePoints[o+2];this._temp.v1.set(a,l,h),this._temp.v1.applyMatrix4(this._temp.m3),i.facePoints[o]=this._temp.v1.x,i.facePoints[o+1]=this._temp.v1.y,i.facePoints[o+2]=this._temp.v1.z}}i.sampleId=t,i.itemId=this._temp.sample.item();const n=e.ray.origin.distanceToSquared(i.point);i.cameraSquaredDistance=n,i.snappingClass||(i.snappingClass=e.snap),i.snappedEdgeP1&&i.snappedEdgeP1.applyMatrix4(this._temp.m1),i.snappedEdgeP2&&i.snappedEdgeP2.applyMatrix4(this._temp.m1)}}findAll(s,t,e){const i=[],n=performance.now();for(const r of s){if(this.fetchSampleData(r),!t.includes(r))continue;const o=this.castSample(r,e);for(const a of o)i.push(a);if(this.isTimeExceeded(n))break}return i}isTimeExceeded(s){return performance.now()-s>this._maxDuration}getFilteredSampleCast(s){const t=this._tiles.raycast(this._temp.representation,this._temp.ray,this._temp.frustum,s.snap);if(this._temp.planes.length===0)return t;const e=[];if(t)for(const i of t){const n=this._temp.planes,r=i.point;yc.containedInParallelPlanes(n,r)&&e.push(i)}return e}getSnaps(s,t,e,i){this.fetchSampleData(s.sampleId),s.normal&&(this.setCastSide(s,t.ray),this.setCastPlane(s)),this.getFaces(e,t,s,i),this.getEdges(t,e,i);for(const n of i)this.addLocalId(n)}filterOnFront(s){const t=[];for(const e of s)this._temp.tempPlane.distanceToPoint(e.point)>=0&&t.push(e);return t}setCastSide(s,t){const e=s.point.clone().sub(t.origin);s.normal.dot(e)>0&&s.normal.negate()}getFaces(s,t,e,i){for(const n of s){const r={snap:n,...t},o=this.castSample(e.sampleId,r);for(const a of o)i.push(a)}}setCastPlane(s){const t=this._temp.tempPlane,e=s.point.clone(),i=s.normal.clone();i.multiplyScalar(this._precission),e.sub(i),t.setFromNormalAndCoplanarPoint(s.normal,e)}castSample(s,t){this.setupSampleCastData(t),this.setupPlanesForSampleCast(t);const e=this.getFilteredSampleCast(t);return e&&this.formatRaycastResult(e,s,t),e}isValidSnap(s){const t=s===Qs.LINE,e=s===Qs.POINT;return t||e}transform(s,t){const e=[];if(s)for(const i of s){const n=new Ht().copy(i);n.applyMatrix4(t),e.push(n)}return e}setupPlanesForSampleCast(s){if(this._temp.planes.length=0,s.planes&&s.planes.length>0){const t=this.transform(s.planes,this._temp.m2);for(const e of t)this._temp.planes.push(e)}}};const dl=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,c0=new Set,vg=typeof process=="object"&&process?process:{},b1=(s,t,e,i)=>{typeof vg.emitWarning=="function"?vg.emitWarning(s,t,e,i):console.error(`[${e}] ${t}: ${s}`)};let up=globalThis.AbortController,u0=globalThis.AbortSignal;if(up===void 0){u0=class{constructor(){S(this,"onabort"),S(this,"_onabort",[]),S(this,"reason"),S(this,"aborted",!1)}addEventListener(e,i){this._onabort.push(i)}},up=class{constructor(){S(this,"signal",new u0),t()}abort(e){var i,n;if(!this.signal.aborted){this.signal.reason=e,this.signal.aborted=!0;for(const r of this.signal._onabort)r(e);(n=(i=this.signal).onabort)==null||n.call(i,e)}}};let s=((Tb=vg.env)==null?void 0:Tb.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const t=()=>{s&&(s=!1,b1("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}const zr=s=>s&&s===Math.floor(s)&&s>0&&isFinite(s),y1=s=>zr(s)?s<=Math.pow(2,8)?Uint8Array:s<=Math.pow(2,16)?Uint16Array:s<=Math.pow(2,32)?Uint32Array:s<=Number.MAX_SAFE_INTEGER?Nd:null:null;let Nd=class extends Array{constructor(s){super(s),this.fill(0)}};const v1=class Bh{constructor(t,e){if(S(this,"heap"),S(this,"length"),!W(Bh,Gh))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new e(t),this.length=0}static create(t){const e=y1(t);if(!e)return[];St(Bh,Gh,!0);const i=new Bh(t,e);return St(Bh,Gh,!1),i}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}};Gh=new WeakMap,Nt(v1,Gh,!1);let AP=v1;const SP=class w1{constructor(t){Nt(this,Id),Nt(this,Jm),Nt(this,Zn),Nt(this,er),Nt(this,xd),Nt(this,Xh),Nt(this,Ph),Nt(this,pe),Nt(this,Ad),Nt(this,Ha),Nt(this,ir),Nt(this,op),Nt(this,Fn,void 0),Nt(this,Ii,void 0),Nt(this,Rn,void 0),Nt(this,$a,void 0),Nt(this,On,void 0),Nt(this,qh,void 0),Nt(this,Sh,void 0),S(this,"ttl"),S(this,"ttlResolution"),S(this,"ttlAutopurge"),S(this,"updateAgeOnGet"),S(this,"updateAgeOnHas"),S(this,"allowStale"),S(this,"noDisposeOnSet"),S(this,"noUpdateTTL"),S(this,"maxEntrySize"),S(this,"sizeCalculation"),S(this,"noDeleteOnFetchRejection"),S(this,"noDeleteOnStaleGet"),S(this,"allowStaleOnFetchAbort"),S(this,"allowStaleOnFetchRejection"),S(this,"ignoreFetchAbort"),Nt(this,ss,void 0),Nt(this,xi,void 0),Nt(this,qe,void 0),Nt(this,Ce,void 0),Nt(this,Mt,void 0),Nt(this,Zs,void 0),Nt(this,Ti,void 0),Nt(this,Ns,void 0),Nt(this,_s,void 0),Nt(this,kn,void 0),Nt(this,bs,void 0),Nt(this,Ln,void 0),Nt(this,Nn,void 0),Nt(this,Ai,void 0),Nt(this,Mn,void 0),Nt(this,No,void 0),Nt(this,Xs,void 0),Nt(this,Oh,void 0),Nt(this,sl,()=>{}),Nt(this,Rr,()=>{}),Nt(this,ip,()=>{}),Nt(this,Si,()=>!1),Nt(this,il,O=>{}),Nt(this,Zh,(O,L,V)=>{}),Nt(this,np,(O,L,V,T)=>{if(V||T)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0}),S(this,Rw,"LRUCache");const{max:e=0,ttl:i,ttlResolution:n=1,ttlAutopurge:r,updateAgeOnGet:o,updateAgeOnHas:a,allowStale:l,dispose:h,onInsert:c,disposeAfter:u,noDisposeOnSet:p,noUpdateTTL:d,maxSize:_=0,maxEntrySize:m=0,sizeCalculation:g,fetchMethod:f,memoMethod:b,noDeleteOnFetchRejection:y,noDeleteOnStaleGet:E,allowStaleOnFetchRejection:C,allowStaleOnFetchAbort:I,ignoreFetchAbort:x}=t;if(e!==0&&!zr(e))throw new TypeError("max option must be a nonnegative integer");const A=e?y1(e):Array;if(!A)throw new Error("invalid max value: "+e);if(St(this,Fn,e),St(this,Ii,_),this.maxEntrySize=m||W(this,Ii),this.sizeCalculation=g,this.sizeCalculation){if(!W(this,Ii)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(b!==void 0&&typeof b!="function")throw new TypeError("memoMethod must be a function if defined");if(St(this,Sh,b),f!==void 0&&typeof f!="function")throw new TypeError("fetchMethod must be a function if specified");if(St(this,qh,f),St(this,No,!!f),St(this,qe,new Map),St(this,Ce,new Array(e).fill(void 0)),St(this,Mt,new Array(e).fill(void 0)),St(this,Zs,new A(e)),St(this,Ti,new A(e)),St(this,Ns,0),St(this,_s,0),St(this,kn,AP.create(e)),St(this,ss,0),St(this,xi,0),typeof h=="function"&&St(this,Rn,h),typeof c=="function"&&St(this,$a,c),typeof u=="function"?(St(this,On,u),St(this,bs,[])):(St(this,On,void 0),St(this,bs,void 0)),St(this,Mn,!!W(this,Rn)),St(this,Oh,!!W(this,$a)),St(this,Xs,!!W(this,On)),this.noDisposeOnSet=!!p,this.noUpdateTTL=!!d,this.noDeleteOnFetchRejection=!!y,this.allowStaleOnFetchRejection=!!C,this.allowStaleOnFetchAbort=!!I,this.ignoreFetchAbort=!!x,this.maxEntrySize!==0){if(W(this,Ii)!==0&&!zr(W(this,Ii)))throw new TypeError("maxSize must be a positive integer if specified");if(!zr(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");Ct(this,Jm,Fw).call(this)}if(this.allowStale=!!l,this.noDeleteOnStaleGet=!!E,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!a,this.ttlResolution=zr(n)||n===0?n:1,this.ttlAutopurge=!!r,this.ttl=i||0,this.ttl){if(!zr(this.ttl))throw new TypeError("ttl must be a positive integer if specified");Ct(this,Id,Km).call(this)}if(W(this,Fn)===0&&this.ttl===0&&W(this,Ii)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!W(this,Fn)&&!W(this,Ii)){const O="LRU_CACHE_UNBOUNDED";(L=>!c0.has(L))(O)&&(c0.add(O),b1("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",O,w1))}}static unsafeExposeInternals(t){return{starts:W(t,Nn),ttls:W(t,Ai),sizes:W(t,Ln),keyMap:W(t,qe),keyList:W(t,Ce),valList:W(t,Mt),next:W(t,Zs),prev:W(t,Ti),get head(){return W(t,Ns)},get tail(){return W(t,_s)},free:W(t,kn),isBackgroundFetch:e=>{var i;return Ct(i=t,pe,me).call(i,e)},backgroundFetch:(e,i,n,r)=>{var o;return Ct(o=t,Ph,Td).call(o,e,i,n,r)},moveToTail:e=>{var i;return Ct(i=t,Ha,Fh).call(i,e)},indexes:e=>{var i;return Ct(i=t,Zn,xr).call(i,e)},rindexes:e=>{var i;return Ct(i=t,er,Lr).call(i,e)},isStale:e=>{var i;return W(i=t,Si).call(i,e)}}}get max(){return W(this,Fn)}get maxSize(){return W(this,Ii)}get calculatedSize(){return W(this,xi)}get size(){return W(this,ss)}get fetchMethod(){return W(this,qh)}get memoMethod(){return W(this,Sh)}get dispose(){return W(this,Rn)}get onInsert(){return W(this,$a)}get disposeAfter(){return W(this,On)}getRemainingTTL(t){return W(this,qe).has(t)?1/0:0}*entries(){for(const t of Ct(this,Zn,xr).call(this))W(this,Mt)[t]===void 0||W(this,Ce)[t]===void 0||Ct(this,pe,me).call(this,W(this,Mt)[t])||(yield[W(this,Ce)[t],W(this,Mt)[t]])}*rentries(){for(const t of Ct(this,er,Lr).call(this))W(this,Mt)[t]===void 0||W(this,Ce)[t]===void 0||Ct(this,pe,me).call(this,W(this,Mt)[t])||(yield[W(this,Ce)[t],W(this,Mt)[t]])}*keys(){for(const t of Ct(this,Zn,xr).call(this)){const e=W(this,Ce)[t];e===void 0||Ct(this,pe,me).call(this,W(this,Mt)[t])||(yield e)}}*rkeys(){for(const t of Ct(this,er,Lr).call(this)){const e=W(this,Ce)[t];e===void 0||Ct(this,pe,me).call(this,W(this,Mt)[t])||(yield e)}}*values(){for(const t of Ct(this,Zn,xr).call(this))W(this,Mt)[t]===void 0||Ct(this,pe,me).call(this,W(this,Mt)[t])||(yield W(this,Mt)[t])}*rvalues(){for(const t of Ct(this,er,Lr).call(this))W(this,Mt)[t]===void 0||Ct(this,pe,me).call(this,W(this,Mt)[t])||(yield W(this,Mt)[t])}[Symbol.iterator](){return this.entries()}find(t,e={}){for(const i of Ct(this,Zn,xr).call(this)){const n=W(this,Mt)[i],r=Ct(this,pe,me).call(this,n)?n.__staleWhileFetching:n;if(r!==void 0&&t(r,W(this,Ce)[i],this))return this.get(W(this,Ce)[i],e)}}forEach(t,e=this){for(const i of Ct(this,Zn,xr).call(this)){const n=W(this,Mt)[i],r=Ct(this,pe,me).call(this,n)?n.__staleWhileFetching:n;r!==void 0&&t.call(e,r,W(this,Ce)[i],this)}}rforEach(t,e=this){for(const i of Ct(this,er,Lr).call(this)){const n=W(this,Mt)[i],r=Ct(this,pe,me).call(this,n)?n.__staleWhileFetching:n;r!==void 0&&t.call(e,r,W(this,Ce)[i],this)}}purgeStale(){let t=!1;for(const e of Ct(this,er,Lr).call(this,{allowStale:!0}))W(this,Si).call(this,e)&&(Ct(this,ir,jr).call(this,W(this,Ce)[e],"expire"),t=!0);return t}info(t){const e=W(this,qe).get(t);if(e===void 0)return;const i=W(this,Mt)[e],n=Ct(this,pe,me).call(this,i)?i.__staleWhileFetching:i;if(n===void 0)return;const r={value:n};if(W(this,Ai)&&W(this,Nn)){const o=W(this,Ai)[e],a=W(this,Nn)[e];if(o&&a){const l=o-(dl.now()-a);r.ttl=l,r.start=Date.now()}}return W(this,Ln)&&(r.size=W(this,Ln)[e]),r}dump(){const t=[];for(const e of Ct(this,Zn,xr).call(this,{allowStale:!0})){const i=W(this,Ce)[e],n=W(this,Mt)[e],r=Ct(this,pe,me).call(this,n)?n.__staleWhileFetching:n;if(r===void 0||i===void 0)continue;const o={value:r};if(W(this,Ai)&&W(this,Nn)){o.ttl=W(this,Ai)[e];const a=dl.now()-W(this,Nn)[e];o.start=Math.floor(Date.now()-a)}W(this,Ln)&&(o.size=W(this,Ln)[e]),t.unshift([i,o])}return t}load(t){this.clear();for(const[e,i]of t){if(i.start){const n=Date.now()-i.start;i.start=dl.now()-n}this.set(e,i.value,i)}}set(t,e,i={}){var n,r,o,a,l,h,c;if(e===void 0)return this.delete(t),this;const{ttl:u=this.ttl,start:p,noDisposeOnSet:d=this.noDisposeOnSet,sizeCalculation:_=this.sizeCalculation,status:m}=i;let{noUpdateTTL:g=this.noUpdateTTL}=i;const f=W(this,np).call(this,t,e,i.size||0,_);if(this.maxEntrySize&&f>this.maxEntrySize)return m&&(m.set="miss",m.maxEntrySizeExceeded=!0),Ct(this,ir,jr).call(this,t,"set"),this;let b=W(this,ss)===0?void 0:W(this,qe).get(t);if(b===void 0)b=W(this,ss)===0?W(this,_s):W(this,kn).length!==0?W(this,kn).pop():W(this,ss)===W(this,Fn)?Ct(this,Xh,rp).call(this,!1):W(this,ss),W(this,Ce)[b]=t,W(this,Mt)[b]=e,W(this,qe).set(t,b),W(this,Zs)[W(this,_s)]=b,W(this,Ti)[b]=W(this,_s),St(this,_s,b),eg(this,ss)._++,W(this,Zh).call(this,b,f,m),m&&(m.set="add"),g=!1,W(this,Oh)&&((n=W(this,$a))==null||n.call(this,e,t,"add"));else{Ct(this,Ha,Fh).call(this,b);const y=W(this,Mt)[b];if(e!==y){if(W(this,No)&&Ct(this,pe,me).call(this,y)){y.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:E}=y;E===void 0||d||(W(this,Mn)&&((r=W(this,Rn))==null||r.call(this,E,t,"set")),W(this,Xs)&&((o=W(this,bs))==null||o.push([E,t,"set"])))}else d||(W(this,Mn)&&((a=W(this,Rn))==null||a.call(this,y,t,"set")),W(this,Xs)&&((l=W(this,bs))==null||l.push([y,t,"set"])));if(W(this,il).call(this,b),W(this,Zh).call(this,b,f,m),W(this,Mt)[b]=e,m){m.set="replace";const E=y&&Ct(this,pe,me).call(this,y)?y.__staleWhileFetching:y;E!==void 0&&(m.oldValue=E)}}else m&&(m.set="update");W(this,Oh)&&((h=this.onInsert)==null||h.call(this,e,t,e===y?"update":"replace"))}if(u===0||W(this,Ai)||Ct(this,Id,Km).call(this),W(this,Ai)&&(g||W(this,ip).call(this,b,u,p),m&&W(this,Rr).call(this,m,b)),!d&&W(this,Xs)&&W(this,bs)){const y=W(this,bs);let E;for(;E=y==null?void 0:y.shift();)(c=W(this,On))==null||c.call(this,...E)}return this}pop(){var t;try{for(;W(this,ss);){const e=W(this,Mt)[W(this,Ns)];if(Ct(this,Xh,rp).call(this,!0),Ct(this,pe,me).call(this,e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(W(this,Xs)&&W(this,bs)){const e=W(this,bs);let i;for(;i=e==null?void 0:e.shift();)(t=W(this,On))==null||t.call(this,...i)}}}has(t,e={}){const{updateAgeOnHas:i=this.updateAgeOnHas,status:n}=e,r=W(this,qe).get(t);if(r!==void 0){const o=W(this,Mt)[r];if(Ct(this,pe,me).call(this,o)&&o.__staleWhileFetching===void 0)return!1;if(!W(this,Si).call(this,r))return i&&W(this,sl).call(this,r),n&&(n.has="hit",W(this,Rr).call(this,n,r)),!0;n&&(n.has="stale",W(this,Rr).call(this,n,r))}else n&&(n.has="miss");return!1}peek(t,e={}){const{allowStale:i=this.allowStale}=e,n=W(this,qe).get(t);if(n===void 0||!i&&W(this,Si).call(this,n))return;const r=W(this,Mt)[n];return Ct(this,pe,me).call(this,r)?r.__staleWhileFetching:r}async fetch(t,e={}){const{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,ttl:o=this.ttl,noDisposeOnSet:a=this.noDisposeOnSet,size:l=0,sizeCalculation:h=this.sizeCalculation,noUpdateTTL:c=this.noUpdateTTL,noDeleteOnFetchRejection:u=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:p=this.allowStaleOnFetchRejection,ignoreFetchAbort:d=this.ignoreFetchAbort,allowStaleOnFetchAbort:_=this.allowStaleOnFetchAbort,context:m,forceRefresh:g=!1,status:f,signal:b}=e;if(!W(this,No))return f&&(f.fetch="get"),this.get(t,{allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:r,status:f});const y={allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:r,ttl:o,noDisposeOnSet:a,size:l,sizeCalculation:h,noUpdateTTL:c,noDeleteOnFetchRejection:u,allowStaleOnFetchRejection:p,allowStaleOnFetchAbort:_,ignoreFetchAbort:d,status:f,signal:b};let E=W(this,qe).get(t);if(E===void 0){f&&(f.fetch="miss");const C=Ct(this,Ph,Td).call(this,t,E,y,m);return C.__returned=C}{const C=W(this,Mt)[E];if(Ct(this,pe,me).call(this,C)){const O=i&&C.__staleWhileFetching!==void 0;return f&&(f.fetch="inflight",O&&(f.returnedStale=!0)),O?C.__staleWhileFetching:C.__returned=C}const I=W(this,Si).call(this,E);if(!g&&!I)return f&&(f.fetch="hit"),Ct(this,Ha,Fh).call(this,E),n&&W(this,sl).call(this,E),f&&W(this,Rr).call(this,f,E),C;const x=Ct(this,Ph,Td).call(this,t,E,y,m),A=x.__staleWhileFetching!==void 0&&i;return f&&(f.fetch=I?"stale":"refresh",A&&I&&(f.returnedStale=!0)),A?x.__staleWhileFetching:x.__returned=x}}async forceFetch(t,e={}){const i=await this.fetch(t,e);if(i===void 0)throw new Error("fetch() returned undefined");return i}memo(t,e={}){const i=W(this,Sh);if(!i)throw new Error("no memoMethod provided to constructor");const{context:n,forceRefresh:r,...o}=e,a=this.get(t,o);if(!r&&a!==void 0)return a;const l=i(t,a,{options:o,context:n});return this.set(t,l,o),l}get(t,e={}){const{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,status:o}=e,a=W(this,qe).get(t);if(a!==void 0){const l=W(this,Mt)[a],h=Ct(this,pe,me).call(this,l);return o&&W(this,Rr).call(this,o,a),W(this,Si).call(this,a)?(o&&(o.get="stale"),h?(o&&i&&l.__staleWhileFetching!==void 0&&(o.returnedStale=!0),i?l.__staleWhileFetching:void 0):(r||Ct(this,ir,jr).call(this,t,"expire"),o&&i&&(o.returnedStale=!0),i?l:void 0)):(o&&(o.get="hit"),h?l.__staleWhileFetching:(Ct(this,Ha,Fh).call(this,a),n&&W(this,sl).call(this,a),l))}o&&(o.get="miss")}delete(t){return Ct(this,ir,jr).call(this,t,"delete")}clear(){return Ct(this,op,tg).call(this,"delete")}};Rw=Symbol.toStringTag,Fn=new WeakMap,Ii=new WeakMap,Rn=new WeakMap,$a=new WeakMap,On=new WeakMap,qh=new WeakMap,Sh=new WeakMap,ss=new WeakMap,xi=new WeakMap,qe=new WeakMap,Ce=new WeakMap,Mt=new WeakMap,Zs=new WeakMap,Ti=new WeakMap,Ns=new WeakMap,_s=new WeakMap,kn=new WeakMap,bs=new WeakMap,Ln=new WeakMap,Nn=new WeakMap,Ai=new WeakMap,Mn=new WeakMap,No=new WeakMap,Xs=new WeakMap,Oh=new WeakMap,Id=new WeakSet,Km=function(){const s=new Nd(W(this,Fn)),t=new Nd(W(this,Fn));St(this,Ai,s),St(this,Nn,t),St(this,ip,(n,r,o=dl.now())=>{if(t[n]=r!==0?o:0,s[n]=r,r!==0&&this.ttlAutopurge){const a=setTimeout(()=>{W(this,Si).call(this,n)&&Ct(this,ir,jr).call(this,W(this,Ce)[n],"expire")},r+1);a.unref&&a.unref()}}),St(this,sl,n=>{t[n]=s[n]!==0?dl.now():0}),St(this,Rr,(n,r)=>{if(s[r]){const o=s[r],a=t[r];if(!o||!a)return;n.ttl=o,n.start=a,n.now=e||i();const l=n.now-a;n.remainingTTL=o-l}});let e=0;const i=()=>{const n=dl.now();if(this.ttlResolution>0){e=n;const r=setTimeout(()=>e=0,this.ttlResolution);r.unref&&r.unref()}return n};this.getRemainingTTL=n=>{const r=W(this,qe).get(n);if(r===void 0)return 0;const o=s[r],a=t[r];return!o||!a?1/0:o-((e||i())-a)},St(this,Si,n=>{const r=t[n],o=s[n];return!!o&&!!r&&(e||i())-r>o})},sl=new WeakMap,Rr=new WeakMap,ip=new WeakMap,Si=new WeakMap,Jm=new WeakSet,Fw=function(){const s=new Nd(W(this,Fn));St(this,xi,0),St(this,Ln,s),St(this,il,t=>{St(this,xi,W(this,xi)-s[t]),s[t]=0}),St(this,np,(t,e,i,n)=>{if(Ct(this,pe,me).call(this,e))return 0;if(!zr(i)){if(!n)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if(typeof n!="function")throw new TypeError("sizeCalculation must be a function");if(i=n(e,t),!zr(i))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return i}),St(this,Zh,(t,e,i)=>{if(s[t]=e,W(this,Ii)){const n=W(this,Ii)-s[t];for(;W(this,xi)>n;)Ct(this,Xh,rp).call(this,!0)}St(this,xi,W(this,xi)+s[t]),i&&(i.entrySize=e,i.totalCalculatedSize=W(this,xi))})},il=new WeakMap,Zh=new WeakMap,np=new WeakMap,Zn=new WeakSet,xr=function*({allowStale:s=this.allowStale}={}){if(W(this,ss))for(let t=W(this,_s);Ct(this,xd,vf).call(this,t)&&(!s&&W(this,Si).call(this,t)||(yield t),t!==W(this,Ns));)t=W(this,Ti)[t]},er=new WeakSet,Lr=function*({allowStale:s=this.allowStale}={}){if(W(this,ss))for(let t=W(this,Ns);Ct(this,xd,vf).call(this,t)&&(!s&&W(this,Si).call(this,t)||(yield t),t!==W(this,_s));)t=W(this,Zs)[t]},xd=new WeakSet,vf=function(s){return s!==void 0&&W(this,qe).get(W(this,Ce)[s])===s},Xh=new WeakSet,rp=function(s){var t,e;const i=W(this,Ns),n=W(this,Ce)[i],r=W(this,Mt)[i];return W(this,No)&&Ct(this,pe,me).call(this,r)?r.__abortController.abort(new Error("evicted")):(W(this,Mn)||W(this,Xs))&&(W(this,Mn)&&((t=W(this,Rn))==null||t.call(this,r,n,"evict")),W(this,Xs)&&((e=W(this,bs))==null||e.push([r,n,"evict"]))),W(this,il).call(this,i),s&&(W(this,Ce)[i]=void 0,W(this,Mt)[i]=void 0,W(this,kn).push(i)),W(this,ss)===1?(St(this,Ns,St(this,_s,0)),W(this,kn).length=0):St(this,Ns,W(this,Zs)[i]),W(this,qe).delete(n),eg(this,ss)._--,i},Ph=new WeakSet,Td=function(s,t,e,i){const n=t===void 0?void 0:W(this,Mt)[t];if(Ct(this,pe,me).call(this,n))return n;const r=new up,{signal:o}=e;o==null||o.addEventListener("abort",()=>r.abort(o.reason),{signal:r.signal});const a={signal:r.signal,options:e,context:i},l=(p,d=!1)=>{const{aborted:_}=r.signal,m=e.ignoreFetchAbort&&p!==void 0;if(e.status&&(_&&!d?(e.status.fetchAborted=!0,e.status.fetchError=r.signal.reason,m&&(e.status.fetchAbortIgnored=!0)):e.status.fetchResolved=!0),_&&!m&&!d)return h(r.signal.reason);const g=c;return W(this,Mt)[t]===c&&(p===void 0?g.__staleWhileFetching?W(this,Mt)[t]=g.__staleWhileFetching:Ct(this,ir,jr).call(this,s,"fetch"):(e.status&&(e.status.fetchUpdated=!0),this.set(s,p,a.options))),p},h=p=>{const{aborted:d}=r.signal,_=d&&e.allowStaleOnFetchAbort,m=_||e.allowStaleOnFetchRejection,g=m||e.noDeleteOnFetchRejection,f=c;if(W(this,Mt)[t]===c&&(!g||f.__staleWhileFetching===void 0?Ct(this,ir,jr).call(this,s,"fetch"):_||(W(this,Mt)[t]=f.__staleWhileFetching)),m)return e.status&&f.__staleWhileFetching!==void 0&&(e.status.returnedStale=!0),f.__staleWhileFetching;if(f.__returned===f)throw p};e.status&&(e.status.fetchDispatched=!0);const c=new Promise((p,d)=>{var _;const m=(_=W(this,qh))==null?void 0:_.call(this,s,n,a);m&&m instanceof Promise&&m.then(g=>p(g===void 0?void 0:g),d),r.signal.addEventListener("abort",()=>{e.ignoreFetchAbort&&!e.allowStaleOnFetchAbort||(p(void 0),e.allowStaleOnFetchAbort&&(p=g=>l(g,!0)))})}).then(l,p=>(e.status&&(e.status.fetchRejected=!0,e.status.fetchError=p),h(p))),u=Object.assign(c,{__abortController:r,__staleWhileFetching:n,__returned:void 0});return t===void 0?(this.set(s,u,{...a.options,status:void 0}),t=W(this,qe).get(s)):W(this,Mt)[t]=u,u},pe=new WeakSet,me=function(s){if(!W(this,No))return!1;const t=s;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof up},Ad=new WeakSet,wf=function(s,t){W(this,Ti)[t]=s,W(this,Zs)[s]=t},Ha=new WeakSet,Fh=function(s){s!==W(this,_s)&&(s===W(this,Ns)?St(this,Ns,W(this,Zs)[s]):Ct(this,Ad,wf).call(this,W(this,Ti)[s],W(this,Zs)[s]),Ct(this,Ad,wf).call(this,W(this,_s),s),St(this,_s,s))},ir=new WeakSet,jr=function(s,t){var e,i,n,r;let o=!1;if(W(this,ss)!==0){const a=W(this,qe).get(s);if(a!==void 0)if(o=!0,W(this,ss)===1)Ct(this,op,tg).call(this,t);else{W(this,il).call(this,a);const l=W(this,Mt)[a];if(Ct(this,pe,me).call(this,l)?l.__abortController.abort(new Error("deleted")):(W(this,Mn)||W(this,Xs))&&(W(this,Mn)&&((e=W(this,Rn))==null||e.call(this,l,s,t)),W(this,Xs)&&((i=W(this,bs))==null||i.push([l,s,t]))),W(this,qe).delete(s),W(this,Ce)[a]=void 0,W(this,Mt)[a]=void 0,a===W(this,_s))St(this,_s,W(this,Ti)[a]);else if(a===W(this,Ns))St(this,Ns,W(this,Zs)[a]);else{const h=W(this,Ti)[a];W(this,Zs)[h]=W(this,Zs)[a];const c=W(this,Zs)[a];W(this,Ti)[c]=W(this,Ti)[a]}eg(this,ss)._--,W(this,kn).push(a)}}if(W(this,Xs)&&(n=W(this,bs))!=null&&n.length){const a=W(this,bs);let l;for(;l=a==null?void 0:a.shift();)(r=W(this,On))==null||r.call(this,...l)}return o},op=new WeakSet,tg=function(s){var t,e,i;for(const n of Ct(this,er,Lr).call(this,{allowStale:!0})){const r=W(this,Mt)[n];if(Ct(this,pe,me).call(this,r))r.__abortController.abort(new Error("deleted"));else{const o=W(this,Ce)[n];W(this,Mn)&&((t=W(this,Rn))==null||t.call(this,r,o,s)),W(this,Xs)&&((e=W(this,bs))==null||e.push([r,o,s]))}}if(W(this,qe).clear(),W(this,Mt).fill(void 0),W(this,Ce).fill(void 0),W(this,Ai)&&W(this,Nn)&&(W(this,Ai).fill(0),W(this,Nn).fill(0)),W(this,Ln)&&W(this,Ln).fill(0),St(this,Ns,0),St(this,_s,0),W(this,kn).length=0,St(this,xi,0),St(this,ss,0),W(this,Xs)&&W(this,bs)){const n=W(this,bs);let r;for(;r=n==null?void 0:n.shift();)(i=W(this,On))==null||i.call(this,...r)}};let OP=SP;const Kn=class{static get(s){return this._meshes.get(s)}static lockIn(s){Object.seal(s)}static add(s,t){this._meshes.set(s,t)}static delete(s){for(const t of s)this._meshes.delete(t)}static setCapacity(s){s!==this._capacity&&(this._meshes.clear(),this._meshes=this.setupMeshes(s),this._capacity=s)}static setupMeshes(s){const t=Math.max(s??this.computeCapacity(),1),e=this.getSizeCalculationEvent();return new OP({maxSize:t,sizeCalculation:e})}static computeCapacity(){const s=globalThis.navigator&&"deviceMemory"in globalThis.navigator?globalThis.navigator.deviceMemory:null,t=s!==null?s:2,e=this.oneHundredMb*t;return Math.trunc(e)}static getDataSetMemory(s){let t=0;for(const e of s)t+=e.usedMemory;return Math.max(t,1)}static getSizeCalculationEvent(){return s=>Array.isArray(s)?this.getDataSetMemory(s):Math.max(s.usedMemory,1)}};S(Kn,"oneHundredMb",1e8),S(Kn,"_meshes",Kn.setupMeshes()),S(Kn,"_capacity"),S(Kn,"_memoryAttributes",["positionBuffer","indexBuffer","normalBuffer"]),S(Kn,"updateMeshMemory",s=>{s.usedMemory=0;for(const t of Kn._memoryAttributes)s.usedMemory!==void 0&&s[t]&&(s.usedMemory+=s[t].byteLength);Kn.lockIn(s)});let Qa=Kn;const PP=class Md{constructor(t){S(this,"meshes"),S(this,"tilesUpdated",!1),S(this,"_sampleAmount"),S(this,"_tileDimension"),S(this,"_tileBySample"),S(this,"_lodBySample"),S(this,"_virtualMeshes",new Map),S(this,"_meshConnection"),S(this,"_samples"),S(this,"_tileIdGenerator",new O_),S(this,"_tiles",new Map),S(this,"_tilesChanged",new Set),S(this,"_sizeByTile",new Map),S(this,"_samplesDimensions"),S(this,"_sampleLodClass"),S(this,"_sampleLodState"),S(this,"_sampleLodSize"),S(this,"_boxes"),S(this,"_items"),S(this,"_materials"),S(this,"_modelId"),S(this,"_lastView",{rotation:new F,location:new F}),S(this,"_params",{updateTime:16,updateSamples:64,updateviewOrientation:8*Math.PI/180,updateViewPosition:256,smallTileSize:.32,mediumTileSize:4,smallObjectSize:2,smallScreenSize:2,mediumScreenSize:4,largeScreenSize:16,tempTileDataSize:6,tileIdIncrement:1,tileSizeMultiplier:10,minTileDimension:32,tileDimensionFactor:8}),S(this,"_temp",{sample:new zp,representation:new kp,vector:new F,matrix:new vt,transform:new vt,boundingBox:new Tt,sampleGeometry:{},box:new Tt,raycastPoints:[],tileData:{positionCount:this._params.tempTileDataSize,objectClass:zs.LINE,positionBuffer:new Float32Array(this._params.tempTileDataSize)},tileCenter:new F,tile:{objectClass:zs.LINE,positionCount:6},viewDimension:0,pastFieldOfview:0}),S(this,"_currentSample",0),S(this,"_virtualPlanes",[]),S(this,"_changedSamples",0),S(this,"_virtualView"),this._modelId=t.modelId,this._boxes=t.boxes,this._items=t.items,this._materials=t.materials,this._meshConnection=new xP(t.modelId,t.connection),this.meshes=t.model.meshes(),this._sampleAmount=this.meshes.samplesLength(),this._samples=new IP(this._sampleAmount),this._samplesDimensions=new Int32Array(this._sampleAmount),this._sampleLodClass=new Uint8Array(this._sampleAmount),this._sampleLodState=new Uint8Array(this._sampleAmount),this._sampleLodSize=new Float32Array(this._sampleAmount),this._tileDimension=this.computeTileSize(),this._tileBySample=new Array(this._sampleAmount),this._lodBySample=new Array(this._sampleAmount),this.init()}restart(){this.resetUpdateProcess(),this._meshConnection.clean()}fetchSample(t,e){this.fetchSampleAndRepresentation(t);const i=this.fetchCurrentMesh(),n=this.sampleTemplate(t);return n.geometries=this.sampleGeoms(n,e,i),n}dispose(){this._meshConnection.dispose();for(const[,t]of this._virtualMeshes)t.dispose()}generate(){for(const[,t]of this._virtualMeshes)t.setupTemplates();for(let t=0;t<this._sampleAmount;t++)this.generateSampleInTiles(t);this.setupTileVisibilityAndHighlight()}setupView(t){this._virtualView=t,Qa.setCapacity(t.meshThreshold),this.restart(),this.updateOrientationIfNeeded(),this.updatePositionIfNeeded(),this.setupViewPlanes()}updateVirtualMeshes(t){if(t&&this._virtualView){for(const e of t)this.updateItem(e);this.restart()}}getSampleTransform(t){return this.fetchSampleAndRepresentation(t),this.sampleTemplate(t).transform}async update(t){this.updateTiles(t),this.notifyUpdateFinished();for(const e of this._tilesChanged){const i=this._tiles.get(e);this._meshConnection.process({tileRequestClass:De.UPDATE,modelId:this._modelId,tileId:e,objectClass:i.objectClass,material:i.materialId,tileData:this.getTileData(i),currentLod:i.lod})}this._tilesChanged.clear()}raycast(t,e,i,n){this._temp.raycastPoints=[];const r=t.representationClass(),o=this._virtualMeshes.get(r);return this.manageRaycast(o,t,e,i,n),this._temp.raycastPoints}init(){const t=new _P(this._modelId,this.meshes),e=t.getRepresentation();this._virtualMeshes.set(e,t);const i=new CP(this._modelId,this.meshes),n=i.getRepresentation();this._virtualMeshes.set(n,i),this.processSamplesDimension(),this.fetchSampleLodSize()}initSampleLod(t){this.fetchSampleAndRepresentation(t);const e=this.fetchCurrentMesh();this._sampleLodClass[t]=e.getLodClass(),this._sampleLodState[t]=Yt.INVISIBLE}fetchSampleAndRepresentation(t){this.meshes.samples(t,this._temp.sample),this.meshes.representations(this._temp.sample.representation(),this._temp.representation)}fetchCurrentMesh(){const t=this._temp.representation.representationClass();return this._virtualMeshes.get(t)}fetchCurrentMaterial(){const t=this._temp.sample.material();return this._materials[t]}fetchSampleLodSize(){for(let t=0;t<this._sampleAmount;t++)this.initSampleLod(t),nl.getBox(this._temp.representation,this._temp.box),this._sampleLodSize[t]=jw.getWidth(this._temp.box)}setupTileVisibilityAndHighlight(){for(const[,t]of this._tiles)t.visibilities=new Nh(t.size,!1),t.highlights=new Nh(t.size,0)}addLodToTile(t,e,i){t.getLodClass()!==ko.AABB?t.getLodClass()===ko.CUSTOM&&this.addCustomLodToTile(t,e,i):this.addBoxLodToTile(e,i)}addBoxLodToTile(t,e){this._lodBySample[t]=this.lodTileAppendSample(t,e)}notifyUpdateFinished(){const t=!this.tilesUpdated;this._changedSamples>=this._sampleAmount&&t&&(this._meshConnection.process({tileRequestClass:De.FINISH,modelId:this._modelId}),this.tilesUpdated=!0)}updatePositionIfNeeded(){const t=this._params.updateViewPosition,e=this._virtualView.cameraPosition;e.distanceToSquared(this._lastView.location)>t&&(this._currentSample=0,this._lastView.location.copy(e))}updateCurrentSample(){this._currentSample++,this._currentSample>=this._sampleAmount&&(this._currentSample=0),this._changedSamples++}processSamplesDimension(){for(let t=0;t<this._sampleAmount;t++)this._samplesDimensions[t]=t;this._samplesDimensions.sort((t,e)=>this._boxes.dimensionOf(e)-this._boxes.dimensionOf(t))}setupViewPlanes(){this._virtualPlanes=[];for(const t of this._virtualView.cameraFrustum.planes)this._virtualPlanes.push(t);if(this._virtualView.clippingPlanes)for(const t of this._virtualView.clippingPlanes)this._virtualPlanes.push(t)}updateOrientationIfNeeded(){const t=this.getCurrentViewOrientation(),e=this._params.updateviewOrientation;t.angleTo(this._lastView.rotation)>e&&(this._currentSample=0,this._lastView.rotation.copy(t))}getCurrentViewOrientation(){return this._virtualView.cameraFrustum.planes[4].normal}resetUpdateProcess(){this._changedSamples=0,this.tilesUpdated=!1}manageRaycast(t,e,i,n,r){const o=TP.cast(t,e,i,n,r);if(o)for(const a of o)a.representationClass=t.getObjectClass(),this._temp.raycastPoints.push(a)}setTileShellBuffer(t){t.usedMemory!==void 0&&t.objectClass===zs.SHELL&&(t.ids=new Float32Array(t.positionCount/3),t.usedMemory+=t.ids.byteLength)}getTileWhenSamplePut(t,e,i){let n=this._tiles.get(t);if(n===void 0){const r=e.lod||Yt.GEOMETRY;n=this.newTile(e.objectClass,i,r),this._tiles.set(t,n)}return n}getPerspTrueDim(t,e){const i=Math.PI/180;return e*Math.tan(.5*t*i)}getTileHighlight(t,e){let i,n;const r=t.highlights;if(!r)return{highlightData:void 0,highlightIds:void 0};const o=r.size(a=>a!==0);if(o>0){n=new Uint16Array(o);const a=h=>h!==0,l=(h,c)=>n[h]=c;i=Nh.get(r,e,a,l)}return{highlightData:i,highlightIds:n}}setupTileSampleAttributes(t,e,i,n){const r=3*t.vertexLocation[e];for(let o=0;o<i.positionBuffer.length;o+=3)this._temp.vector.fromArray(i.positionBuffer,o),this._temp.vector.applyMatrix4(this._temp.matrix),this._temp.vector.toArray(t.positionBuffer,r+o);if(t.normalBuffer){const o=3*t.vertexLocation[e];for(let a=0;a<i.normalBuffer.length;a+=3)this._temp.vector.fromArray(i.normalBuffer,a),this._temp.vector.transformDirection(this._temp.matrix),this._temp.vector.multiplyScalar(ac),this._temp.vector.toArray(t.normalBuffer,o+a)}if(t.indexBuffer){const o=t.indexLocation[e],a=t.vertexLocation[e];for(let l=0;l<i.indexCount;l++){const h=i.indexBuffer[l]+a;t.indexBuffer[l+o]=h}}if(t.faceIdBuffer&&i.faceIdBuffer){const o=100*n.sample,a=t.vertexLocation[e],l=a+i.positionCount/3;for(let h=a;h<l;h++)t.faceIdBuffer[h]=i.faceIdBuffer[h-a]+o}if(i.objectClass===zs.SHELL){const o=t.vertexLocation[e],a=o+i.positionCount/3;t.ids.fill(this.itemId(n.sample),o,a)}}getTileVisibility(t,e){if(!t.visibilities)throw new Error("Fragments: Malformed tile!");if(!t.visibilities.fullOf(!1))return Nh.get(t.visibilities,e,i=>i)}memoryOverflow(){return Md._graphicMemoryConsumed>this._virtualView.graphicThreshold}updateMesh(t){let e=this.fetchLodLevel(t);const i=this._sampleLodState[t];e=this.hideHighlightedLods(e,t),e!==i?this.updateVisible(i,e,t):this.updateSampleIfSeen(e,t)}tileLoadSample(t,e,i){const n=t.sampleLocation.get(e.sample),r=this.getSampleGeometries(e,i);this.setupTileLocation(t,r,e),this.fetchSampleTransform(t,e),this.setupTileSampleAttributes(t,n,r,e)}updateSampleIfSeen(t,e){t!==Yt.INVISIBLE&&this.updateSample(e,t)}hideHighlightedLods(t,e){return t===Yt.WIRES&&this._samples.getHighlight(e)&&(t=Yt.INVISIBLE),t}updateVisible(t,e,i){t!==Yt.INVISIBLE&&this.makeSampleInvisible(i,t);const n=e!==Yt.INVISIBLE;n&&this.updateSample(i,e),this._samples.setVisible(i,n),this._sampleLodState[i]=e}makeInvisibleFromTile(t,e){const i=this._tiles.get(t);this.updateTileData(i,e,!1,0),this.deleteTileIfNeeded(i,t)}updateSample(t,e){const i=this.itemId(t),n=this._items.visible(i),r=this._items.getHighlight(i);this.hasChanged(t,e,n,r)&&this.setSample(t,n,r,e)}hasHighlightChanged(t,e){return e!==this._samples.getHighlight(t)}hasVisibleChanged(t,e){return e!==this._samples.visible(t)}newTile(t,e,i){const n={notVirtual:!1};return n.materialId=e,n.indexLocation=[],n.box=new Tt,n.objectClass=t,n.lod=i,n.normalCount=0,n.indexCount=0,n.vertexLocation=[],n.size=0,n.geometriesLocation=[],n.positionCount=0,n.sampleLocation=new Map,n.faceIdBuffer=new Uint32Array(0),n}createLod(t){const e=nl.boxSize(t),i=this._temp.tileData.positionBuffer;if(!i)throw new Error("Fragments: Malformed tiles!");return i[0]=e.start.x,i[1]=e.start.y,i[2]=e.start.z,i[3]=e.end.x,i[4]=e.end.y,i[5]=e.end.z,this._temp.tileData}sampleTemplate(t){const e=this._temp.sample,i=this._temp.representation;nl.get(e,this.meshes,this._temp.transform),nl.getBox(i,this._temp.boundingBox),this._temp.sampleGeometry.sample=t;const n=e.material();return this._temp.sampleGeometry.material=this._materials[n],this._temp.sampleGeometry.transform=this._temp.transform,this._temp.sampleGeometry.aabb=this._temp.boundingBox,delete this._temp.sampleGeometry.geometries,this._temp.sampleGeometry}makeSampleInvisible(t,e){const i=this.getTileIds(t,e);i&&en.forEach(i,n=>this.makeInvisibleFromTile(n,t))}setSample(t,e,i,n){this._samples.setVisible(t,e),this._samples.setHighlight(t,i);const r=this.getTileIds(t,n);r!==void 0&&en.forEach(r,o=>{this.updateTile(o,t,i,i===0)})}getTileIds(t,e){return e===Yt.GEOMETRY?this._tileBySample[t]:this._lodBySample[t]}addBasicTileData(t,e,i){t.sampleLocation.set(e,t.size),t.size++,t.geometriesLocation.push(i),t.indexLocation.push(t.indexCount||0),t.vertexLocation.push((t.positionCount||0)/3)}buildNewVirtualTile(t,e){this.constructTile(t),this.loadTile(e,t),t.notVirtual=!0,delete t.indexBuffer,delete t.positionBuffer,delete t.normalBuffer,delete t.faceIdBuffer,delete t.ids}deleteTileIfNeeded(t,e){if(this.getShouldDeleteTile(t))return this.deleteGeometry(e),t.notVirtual=!1,void(Md._graphicMemoryConsumed-=t.usedMemory);this._tilesChanged.add(e)}getShouldDeleteTile(t){if(!t.visibilities||!t.highlights)throw new Error("Fragments: Malformed tile!");const e=t.visibilities.fullOf(!1),i=t.highlights.fullOf(0),n=this.memoryOverflow();return e&&i&&n}checkTileMemoryOverflow(t,e){const i=this._tiles.get(t);return(i?i.positionCount:0)+e.positionCount>bl}updateTileData(t,e,i,n){if(!t.visibilities||!t.highlights)throw new Error("Fragments: Malformed tile!");const r=t.sampleLocation.get(e);t.visibilities.update(r,i),t.highlights.update(r,n)}getKeepUpdating(t,e){const i=this._params.updateTime,n=this._params.updateSamples,r=t<this._sampleAmount,o=performance.now()-e;return r&&(o<i||t<n)}computeTileSize(){const t=this._boxes.fullBox.getSize(this._temp.vector),e=Math.max(t.x,t.y,t.z)/this._params.tileDimensionFactor,i=Math.ceil(e);return Math.max(this._params.minTileDimension,i)}newTileId(t,e,i){this.logBufferOverflowIfNeeded(i);const n=i.lod||Yt.GEOMETRY,r=this.generateTileCode(t,e,i,n),o=this._sizeByTile.get(r)||1;let a=r+o-1;return this.checkTileMemoryOverflow(a,i)&&(a+=this._params.tileIdIncrement,this._sizeByTile.set(r,o+1)),a}logBufferOverflowIfNeeded(t){t.positionCount/3>bl&&console.log("Fragments: Buffer overflow")}fetchLodLevel(t){const e=this._boxes.get(t);if(!Ho.collides(e,this._virtualPlanes))return Yt.INVISIBLE;this.meshes.samples(t,this._temp.sample);const i=this._temp.sample.item();if(!this._items.visible(i))return Yt.INVISIBLE;const n=this._virtualView.graphicQuality,r=this._boxes.dimensionOf(t),o=e.distanceToPoint(this._virtualView.cameraPosition),a=this.screenSize(r,o),l=r<this._params.smallObjectSize,h=!l,c=this._params.smallScreenSize*n,u=this._params.mediumScreenSize*n,p=this._params.largeScreenSize*n,d=a<u,_=l&&a<p,m=h&&d;if(l&&d||h&&a<c)return Yt.INVISIBLE;if(_||m)return Yt.WIRES;const g=this._sampleLodSize[t];return this.screenSize(g,o)<Math.max(u,this._params.mediumScreenSize)?Yt.WIRES:Yt.GEOMETRY}generateTileCode(t,e,i,n){this._tileIdGenerator.reset(),this.processTileDataId(i,e,n);const r=this.processTileSpatialId(t,n);return this.processTileDimensionId(r),this._tileIdGenerator.value}processTileDataId(t,e,i){this._tileIdGenerator.compute(t.objectClass!==void 0?t.objectClass:0),this._tileIdGenerator.compute(e),this._tileIdGenerator.compute(i)}deleteGeometry(t){this._meshConnection.process({tileRequestClass:De.DELETE,modelId:this._modelId,tileId:t})}processTileSpatialId(t,e){const i=this._temp.tileCenter.x,n=this._temp.tileCenter.y,r=this._temp.tileCenter.z,o=this._boxes.get(t);o.getCenter(this._temp.tileCenter);const a=this.getTileDimension(e),l=i-i%a,h=n-n%a,c=r-r%a;return this._tileIdGenerator.compute(l),this._tileIdGenerator.compute(h),this._tileIdGenerator.compute(c),o}addCustomLodToTile(t,e,i){const n=this.meshData(t,!1,Yt.WIRES);this._sampleLodSize[e]=n.lodThickness||0,this._lodBySample[e]=this.putSampleInTiles(e,i,n)}getTileLocations(t){return t.indexCount?t.indexLocation:t.vertexLocation}getTileDimension(t){let e=this._tileDimension;return t===Yt.GEOMETRY&&(e*=this._params.tileSizeMultiplier),e}processTileDimensionId(t){const e=this.getTileDimensionClass(t);this._tileIdGenerator.compute(e)}tileAppend(t,e,i,n){this.addBasicTileData(t,i,n),this.tileAppendAttribute(t,e,"indexCount",!1),this.tileAppendAttribute(t,e,"positionCount",!1),this.tileAppendAttribute(t,e,"normalCount",!1),this.tileAppendAttribute(t,e,"materialId",!0)}putSampleInTiles(t,e,i){let n;return en.forEach(i,(r,o)=>{const a=this.newTileId(t,e,r);n=this.getTileIdsWhenSamplePut(n,a);const l=this.getTileWhenSamplePut(a,r,e);this.tileAppend(l,r,t,o)}),n}hasLodChanged(t,e){return e!==this._sampleLodState[t]}getTileIdsWhenSamplePut(t,e){return t===void 0?t=e:typeof t=="number"?t!==e&&(t=[t,e]):t.includes(e)||t.push(e),t}updateTile(t,e,i,n){const r=this._tiles.get(t);this.updateTileData(r,e,n,i),r.notVirtual?this._tilesChanged.add(t):this.buildNewVirtualTile(r,t)}getLodTileWhenPutSample(t,e){let i=this._tiles.get(t);if(!i){const n=this._temp.tile.objectClass;i=this.newTile(n,e,Yt.WIRES),this._tiles.set(t,i)}return i}lodTileAppendSample(t,e){const i=Yt.WIRES,n=this._temp.tile,r=this.generateTileCode(t,e,n,i),o=this.getLodTileWhenPutSample(r,e);return this.tileAppend(o,n,t,0),r}addSampleToTile(t,e,i){const n=this.meshData(t,!1,Yt.GEOMETRY);this._tileBySample[e]=this.putSampleInTiles(e,i,n)}setTileBuffer(t,e,i){if(t.usedMemory===void 0)return;const n=t[`${e}Count`];if(n>0){const r=i?new Uint16Array(n):new Int16Array(n);t[`${e}Buffer`]=r,t.usedMemory+=r.byteLength}}updateTiles(t){const e=this._changedSamples<this._sampleAmount;if(this._virtualView===void 0||!e)return;let i=!0,n=0;for(;i;){const r=this._samplesDimensions[this._currentSample];this.updateMesh(r),this.updateCurrentSample(),n++,i=this.getKeepUpdating(n,t)}}sampleGeoms(t,e,i){return i.getLodClass()===ko.AABB&&e===Yt.WIRES?this.createLod(t.aabb):this.meshData(i,!0,e)}generateSampleInTiles(t){this.fetchSampleAndRepresentation(t);const e=this.fetchCurrentMaterial(),i=this.fetchCurrentMesh();this.addSampleToTile(i,t,e),this.addLodToTile(i,t,e)}buildSampleInTile(t,e,i,n,r){const o=t.geometriesLocation[e];if(this.tileLoadSample(t,i,o),n){const a=this._boxes.get(r);this._temp.vector.copy(t.location),this._temp.vector.negate(),a.translate(this._temp.vector),t.box.union(a)}}getSampleGeometries(t,e){return Array.isArray(t.geometries)?t.geometries[e]:t.geometries}constructTile(t){t.positionBuffer===void 0&&(t.positionBuffer=new Float32Array(t.positionCount),t.usedMemory=t.positionBuffer.byteLength,this.setTileBuffer(t,"index",!0),this.setTileBuffer(t,"normal",!1),this.setTileShellBuffer(t),t.faceIdBuffer=new Uint32Array(t.positionCount/3),t.usedMemory+=t.faceIdBuffer.byteLength);const e=!t.location;for(const[i,n]of t.sampleLocation){const r=this.fetchSample(i,t.lod);r&&r.geometries&&this.buildSampleInTile(t,n,r,e,i)}}fetchSampleTransform(t,e){this._temp.vector.copy(t.location),this._temp.vector.negate(),this._temp.matrix.identity(),this._temp.matrix.setPosition(this._temp.vector),this._temp.matrix.multiply(e.transform)}hasChanged(t,e,i,n){const r=this.hasLodChanged(t,e),o=this.hasVisibleChanged(t,i),a=this.hasHighlightChanged(t,n);return r||o||a}setupTileLocation(t,e,i){if(t.location)return;const n=new F;n.fromArray(e.positionBuffer),n.applyMatrix4(i.transform),t.location=n}getTileData(t){const e=this.getTileLocations(t),i=this.getTileVisibility(t,e),n=this.getTileHighlight(t,e),{highlightData:r,highlightIds:o}=n;return{visibilityData:i,highlightData:r,highlightIds:o}}updateMemoryOnTileLoad(t){Md._graphicMemoryConsumed+=t.usedMemory}fetchTileMatrixOnLoad(t){t.location&&(this._temp.matrix.identity(),this._temp.matrix.setPosition(t.location))}updateItem(t){const e=this._boxes.sampleOf(t);if(e)for(const i of e)this.updateMesh(i)}screenSize(t,e){return t/this.getViewDimension(e)*this._virtualView.viewSize}getTileDimensionClass(t){const e=t.min.distanceToSquared(t.max),i=this._params.smallTileSize;return e>this._params.mediumTileSize?2:e>i?1:0}getViewDimension(t){if(this._virtualView.orthogonalDimension)return this._virtualView.orthogonalDimension;const e=this._virtualView.fov;return e!==this._temp.pastFieldOfview&&(this._temp.viewDimension=this.getPerspTrueDim(e,1),this._temp.pastFieldOfview=e),t*this._temp.viewDimension}loadTile(t,e){const i=this.getTileData(e);this.fetchTileMatrixOnLoad(e);const n=this.getFaceIds(e);this._meshConnection.process({tileRequestClass:De.CREATE,modelId:this._modelId,objectClass:e.objectClass,tileId:t,itemId:void 0,tileData:i,indices:e.indexBuffer,positions:e.positionBuffer,normals:e.normalBuffer,faceIds:n,itemIds:e.ids,material:e.materialId,matrix:this._temp.matrix.clone(),aabb:e.box.clone(),currentLod:e.lod}),this.updateMemoryOnTileLoad(e)}getFaceIds(t){const e=new xt,i=t.faceIdBuffer,n=new Float32Array(3*i.length);for(let r=0;r<i.length;r++){const o=i[r];e.set(0+o),n[3*r]=e.r,n[3*r+1]=e.g,n[3*r+2]=e.b}return n}meshData(t,e,i){const n=this._temp.representation.id(),r=t.getLodClass()===ko.CUSTOM,o=i===Yt.WIRES;return r&&o?t.fetchLod(n,e):t.fetchMeshes(n,e)}tileAppendAttribute(t,e,i,n){e[i]!==void 0&&(n?t[i]=e[i]:t[i]+=e[i])}itemId(t){return this.meshes.samples(t,this._temp.sample),this._temp.sample.item()}};S(PP,"_graphicMemoryConsumed",0);let FP=class{constructor(){S(this,"_templates",new Map)}add(s,t){this._templates.set(s,t)}get(s){const t=this._templates.get(s);return Array.isArray(t)?this.getTemplateSet(t):{...t}}getTemplateSet(s){const t=[];for(const e of s){const i={...e};t.push(i)}return t}};const E1=class An{constructor(t,e){S(this,"_dataBuffer"),S(this,"_dataPosition"),this._dataBuffer=e||this.getDefaultData(),this._dataPosition=t||An._data.defaultPosition}set(t){let e=0;for(const i of An._data.points)for(const n of An._data.coords){const r=this.getPosition(n,i),o=t[e++];this.setValue(r,o)}}get(t,e){const i=this.getPosition(t,e);return this._dataBuffer[i]}clone(t){for(const e of An._data.points)for(const i of An._data.coords){const n=this.getPosition(i,e),r=t.get(i,e);this.setValue(n,r)}}combine(t,e){for(const i of An._data.points)for(const n of An._data.coords)this.save(n,i,t,e)}setValue(t,e){this._dataBuffer[t]=e}getDefaultData(){return new Float64Array(An._data.size)}getPosition(t,e){return An._data[e][t]+this._dataPosition}save(t,e,i,n){const r=this.getPosition(t,e),o=i.get(t,e),a=n.get(t,e),l=Math[e](o,a);this.setValue(r,l)}};S(E1,"_data",{size:6,defaultPosition:0,min:{x:0,y:2,z:4},max:{x:1,y:3,z:5},coords:["x","y","z"],points:["min","max"]});let Dd=E1;const C1=class kd{constructor(t,e){S(this,"box"),S(this,"data",0),this.box=new Dd(t,e)}get size(){return this.data*kd._data.factor}get isPoint(){return this.data>=kd._data.threshold}transform(t,e,i){i||(t*=kd._data.factor),this.data=t,this.box.clone(e)}};S(C1,"_data",{threshold:0,factor:-1});let RP=C1,LP=class{constructor(s){S(this,"_boxes"),S(this,"_min",new F),S(this,"_max",new F),this._boxes=s}inflate(s){const t=this._boxes.fullBox.min,e=this.getVector(s,t,"min"),i=this.getVector(s,t,"max");return new Tt(e,i)}deflate(s,t){this.read(s);const e=[];e.push(this._min.x,this._min.y,this._min.z),e.push(this._max.x,this._max.y,this._max.z),t.set(e)}getVector(s,t,e){const i=s.get("x",e)+t.x,n=s.get("y",e)+t.y,r=s.get("z",e)+t.z;return new F(i,n,r)}read(s){const{min:t}=this._boxes.fullBox;this._min.subVectors(s.min,t),this._max.subVectors(s.max,t)}},NP=class{constructor(s,t){S(this,"_data"),S(this,"_compressor"),this._data=t,this._compressor=s}frustumCollide(s,t,e=!1){const i=this.getFrustumPlanes(t,s),n=this.getFrustumOnCollide(i),r=this.getFrustumOnIncludes(i),o=this.newDefaultCallback(!0);return this.collide(n,r,o,e)}rayCollide(s,t){const e=this.getRayOnCollide(t),i=this.newDefaultCallback(!1),n=this.getRayOnSeen(s);return this.collide(e,i,n)}addPoint(s,t,e,i){s?i&&t.push(this.getPointData(e)):t.push(this.getPointData(e))}getPointData(s){return this.getPoint(s).data}getBounds(s){const t=this.getPoint(s);return this._compressor.inflate(t.box)}isPoint(s){return this.getPoint(s).isPoint}newDefaultCallback(s){return t=>s}groupSize(s){return this.getPoint(s).size}getPoint(s){return this._data.points[s]}getRayOnSeen(s){let t=this.newDefaultCallback(!0);return(s==null?void 0:s.length)>0&&(t=e=>Ho.collides(e,s)),t}getRayOnCollide(s){return t=>s.intersectsBox(t)}collide(s,t,e,i=!1){const n=this._data.points.length,r=[];let o=0;const a=(h,c)=>{const u=o+this.groupSize(o);for(;o<u;o++)this.isPoint(o)&&e(h)&&(i?c&&this.savePoint(o,r):this.savePoint(o,r))},l=()=>{const h=this.getBounds(o),c=t(h),u=this.isPoint(o),p=c||s(h);u&&p&&e(h)&&this.addPoint(i,r,o,c),p||u?(o++,c&&!u&&a(h,c)):o+=this.groupSize(o)};for(;o<n;)l();return r}getFrustumOnIncludes(s){return t=>Ho.isIncluded(t,s)}getFrustumOnCollide(s){return t=>Ho.collides(t,s)}getFrustumPlanes(s,t){const e=[];for(const i of s.planes)e.push(i);if(t)for(const i of t)e.push(i);return e}savePoint(s,t){const e=this.getPoint(s);t.push(e.data)}},MP=class{constructor(s){S(this,"_boxes"),S(this,"_total",new F),S(this,"_change",new F),S(this,"_average",new F),S(this,"_tempCenterVector",new F),S(this,"_tempVectors",{x:new F,y:new F,z:new F}),this._boxes=s}sort(s,t,e){this.average(this._average,s,t,e),this.getDataToTotal(t,e,s);let i=this.anySort(t,e,s);return i=this.adjust(e,t,i),Math.round(i)}anySort(s,t,e){return this._total.x>this._total.y?this._total.x>this._total.z?this.sortDim("x",this._average.x,s,t,e):this.sortDim("z",this._average.z,s,t,e):this._total.y>this._total.z?this.sortDim("y",this._average.y,s,t,e):this.sortDim("z",this._average.z,s,t,e)}getDataToTotal(s,t,e){this._total.set(0,0,0);for(let i=s;i<t;i++){this._boxes.get(e[i]).getCenter(this._change).sub(this._average);const n=this._change.multiply(this._change);this._total.add(n)}}sortDim(s,t,e,i,n){let r=e;for(let o=e;o<i;o++)this.getValue(n,o,s)>t&&(this.exchange(o,r,n),r++);return r}exchange(s,t,e){const i=e[s];e[s]=e[t],e[t]=i}getValue(s,t,e){const i=this.getBox(s,t),n=this._tempVectors[e];return i.getCenter(n)[e]}average(s,t,e,i){const n=this.getBox(t,e);return n.getCenter(s),this.aggregate(e,i,t,n,s),s.divideScalar(i-e)}aggregate(s,t,e,i,n){for(let r=s+1;r<t;r++){const o=e[r],a=this._boxes.get(o).getCenter(this._tempCenterVector);n.add(a)}}adjust(s,t,e){const i=(t+s)/2,n=(s-t)/3;return(e<=t+n||e>=s-1-n)&&(e=i),e}getBox(s,t){const e=s[t];return this._boxes.get(e)}},DP=class{constructor(s,t,e){S(this,"_data"),S(this,"_compressor"),S(this,"_boxes"),S(this,"_sorter"),this._data=e,this._compressor=t,this._boxes=s,this._sorter=new MP(s)}make(s,t,e=0,i=0,n=0,r=0){const o=e-i;return o===1?this.makePoint(s,i,t,r):o===2?this.makeGroup3(r,s,i,t):this.makeGroup(n,s,i,e,r,t)}makeGroup3(s,t,e,i){const n=this.makeBox(s+1,t,e),r=this.makeBox(s+2,t,e+1);return i.combine(n,r),this.newGroup(s,3,i),3}makeGroup(s,t,e,i,n,r){const o=this._data.limits.primary[s],a=this._data.limits.secondary[s],l=this._sorter.sort(t,e,i),h=this.make(t,o,l,e,s+1,n+1),c=n+h+1,u=this.make(t,a,i,l,s+1,c);r.combine(o,a);const p=h+u+1;return this.newGroup(n,p,r),p}makeBox(s,t,e){const i=this._data.points[s].box,n=t[e],r=this._boxes.get(n);return this._compressor.deflate(r,i),this.set(s,n),i}makePoint(s,t,e,i){const n=this._boxes.get(s[t]);return this._compressor.deflate(n,e),this.newPoint(i,s[t],e),1}newGroup(s,t,e){this.get(s).transform(t,e,!1)}get(s){return this._data.points[s]}newPoint(s,t,e){this.get(s).transform(t,e,!0)}set(s,t){this.get(s).data=t}};const d0=class zd{constructor(t){S(this,"_compressor"),S(this,"_collider"),S(this,"_maker"),S(this,"_data"),S(this,"_boxes"),this._boxes=t,this._compressor=new LP(t),this._data=this.getData(),this._collider=new NP(this._compressor,this._data),this._maker=new DP(this._boxes,this._compressor,this._data),this.initData()}collideFrustum(t,e,i=!1){return this._collider.frustumCollide(t,e,i)}collideRay(t,e){return this._collider.rayCollide(t,e)}setupLimits(){for(let t=0;t<zd._limitThreshold;t++)this._data.limits.primary.push(new Dd),this._data.limits.secondary.push(new Dd)}getPointBuffer(){const t=this._boxes.getCount(),e=new Uint32Array(t);for(let i=0;i<e.length;i++)e[i]=i;return e}getPointsAmount(t){return 2*t.length-1}initData(){const t=this.getPointBuffer(),e=this.getPointsAmount(t),i=e*zd._boxSize,n=new Float64Array(i);for(let o=0;o<e;o++){const a=o*zd._boxSize,l=new RP(a,n);this._data.points.push(l)}this.setupLimits();const r=new Dd;this._maker.make(t,r,t.length)}getData(){return{points:[],limits:{primary:[],secondary:[]}}}};S(d0,"_boxSize",6),S(d0,"_limitThreshold",32);let I1=class{constructor(s){S(this,"onModelLoaded",new Ms),S(this,"models"),S(this,"settings",{autoCoordinate:!0,maxUpdateRate:100,graphicsQuality:0}),S(this,"baseCoordinates",null),S(this,"_connection"),S(this,"_isDisposed",!1),S(this,"_autoRedrawInterval",null),S(this,"_lastUpdate",0);const t=this.newRequestEvent(),e=this.newUpdateEvent();this._connection=new GS(t,s),this.models=new HS(e),this.models.list.onItemDeleted.add(()=>{this.models.list.size===0&&(this.baseCoordinates=null)})}async load(s,t){const e=new BS(t.modelId,this.models,this._connection);t.userData&&(e.object.userData=t.userData),e.frozen=!0,e.graphicsQuality=this.settings.graphicsQuality;try{if(this.models.list.set(e.modelId,e),await e._setup(s,t.raw,t.virtualModelConfig),this.settings.autoCoordinate){const n=await e.getCoordinates();if(this.baseCoordinates===null)this.baseCoordinates=n;else{const[r,o,a]=n,[l,h,c]=this.baseCoordinates,u=new F(l-r,h-o,c-a);e.object.position.add(u)}}}catch(n){throw this.models.list.delete(e.modelId),n}const{camera:i}=t;return i&&e.useCamera(i),e.frozen=!1,this.onModelLoaded.trigger(e),e}async dispose(){this._isDisposed=!0;const s=Array.from(this.models.list.values()),t=[];for(const e of s)t.push(e.dispose());await Promise.all(t),this.onModelLoaded.reset()}async disposeModel(s){const t=this.models.list.get(s);t&&await t.dispose()}async update(s=!1){if(this._isDisposed)return;const t=performance.now();if(t-this._lastUpdate<this.settings.maxUpdateRate)return;this._lastUpdate=t;const e=[];for(const i of this.models.list.values())e.push(i._refreshView());await Promise.all(e),s?await this.models.forceUpdateFinish():this.models.update()}async manageRequest(s){const t=this.models.list.get(s.modelId);t&&await t.handleRequest(s)}newUpdateEvent(){return()=>{this._autoRedrawInterval&&clearTimeout(this._autoRedrawInterval);const s=this.settings.maxUpdateRate+1;this._autoRedrawInterval=setTimeout(()=>{this.update()},s)}}newRequestEvent(){return s=>{this.manageRequest(s)}}},kP=class{constructor(s,t){S(this,"_lengthUnitsFactor",1),S(this,"_attributesOffsets",[]),S(this,"_relationsMap",{}),S(this,"_guids",[]),S(this,"_guidsItems",[]),S(this,"_uniqueAttributes",new Set),S(this,"_uniqueRelNames",new Set),S(this,"_ifcApi",null),S(this,"wasm",{path:"/node_modules/web-ifc/",absolute:!1}),S(this,"expressIDs",[]),S(this,"classes",[]),this._serializer=s,this._builder=t}async getIfcApi(){if(!this._ifcApi){const s=new Qo;s.SetWasmPath(this.wasm.path,this.wasm.absolute),await s.Init(),s.SetLogLevel(Np.LOG_LEVEL_OFF),this._ifcApi=s}return this._ifcApi}async getSchema(s=0){const t=(await this.getIfcApi()).GetModelSchema(s);if(!t)throw new Error("Fragments: IFC Schema not found");return t.startsWith("IFC2X3")?"IFC2X3":t.startsWith("IFC4")&&t.replace("IFC4","")===""?"IFC4":t.startsWith("IFC4X")?"IFC4X3":t}async process(s){var t,e,i;const n=await this.getIfcApi();if(s.readFromCallback)n.OpenModelFromCallback(s.readCallback,{COORDINATE_TO_ORIGIN:!0});else{if(!s.bytes)throw new Error("Fragments: No data provided");await n.OpenModel(s.bytes,{COORDINATE_TO_ORIGIN:!0})}this._serializer.replaceStoreyElevation&&await this.setLengthUnitsFactor();const r=n.GetAllTypesOfModel(0).map(L=>L.typeID),o=await this.getSchema();if(!$A[o])throw new Error("Fragments: Model schema not recognized.");const a=s.geometryProcessedLocalIDs;await this.processItems(a);const l=new Set(a);(t=s.progressCallback)==null||t.call(s,.6,{process:"attributes",state:"start",entitiesProcessed:a.length});const h=new Set([...this._serializer.classes.abstract,...this._serializer.classes.elements]),c=r.filter(L=>h.has(L)),u=.15/c.length;for(const[L,V]of c.entries()){const T=n.GetLineIDsWithType(0,V);if(T.size()===0)continue;const N=[];for(let v=0;v<T.size();v++){const M=T.get(v);l.has(M)||N.push(M)}N.length!==0&&(await this.processItems(N),(e=s.progressCallback)==null||e.call(s,u*(L+1)+.6,{process:"attributes",state:L+1===c.length?"finish":"inProgress",class:Qh[V],entitiesProcessed:N.length}))}const p=new Set([...this._serializer.relations.keys()]),d=r.filter(L=>p.has(L)),_=.15/d.length;for(const[L,V]of d.entries()){const T=L===0?"start":L+1===d.length?"finish":"inProgress";await this.processRelations([V]),(i=s.progressCallback)==null||i.call(s,_*(L+1)+.75,{process:"relations",state:T,class:Qh[V]})}const{relIndicesVector:m,relsVector:g}=this.getRelationsVector(),{guidsVector:f,guidsItemsVector:b}=this.getGuidsVector(),y=await this.getMetadataOffset(),E=this.getAttributesVector(),C=this.getUniqueAttributesVector(),I=this.getRelNamesVector(),x=re.createLocalIdsVector(this._builder,this.expressIDs),A=this.getCategoriesVector(),O=await this.getSpatialStructureOffset();return this.clean(),{relIndicesVector:m,relsVector:g,guidsVector:f,guidsItemsVector:b,metadataOffset:y,attributesVector:E,localIdsVector:x,categoriesVector:A,spatialStrutureOffset:O,uniqueAttributesVector:C,relNamesVector:I}}async processItems(s){const t=await this.getIfcApi();for(let e=0;e<s.length;e++){const i=s[e];try{const n=await t.properties.getItemProperties(0,i);if(!n)continue;const r=Qh[n.type];this.classes.push(r),this.expressIDs.push(i),await this.serializeAttributes(i,n)}catch(n){console.log(`Problem reading properties for ${i}`),console.log(n),await new Promise(r=>{setTimeout(r,100)});continue}}}addRelation(s,t,e){this._relationsMap[s]||(this._relationsMap[s]={}),this._relationsMap[s][t]||(this._relationsMap[s][t]=[]);for(const i of e)this._relationsMap[s][t].push(i);this._serializer.includeRelationNames&&this._uniqueRelNames.add(t)}async getStoreyElevation(s,t){const e=await this.getIfcApi(),i=await e.properties.getItemProperties(0,s);let n,r;i!=null&&i.RelativePlacement&&"value"in i.RelativePlacement&&typeof i.RelativePlacement.value=="number"&&(n=await e.properties.getItemProperties(0,i.RelativePlacement.value)),n!=null&&n.Location&&"value"in n.Location&&typeof n.Location.value=="number"&&(r=await e.properties.getItemProperties(0,n.Location.value)),r!=null&&r.Coordinates&&Array.isArray(r.Coordinates)&&"value"in r.Coordinates[2]&&typeof r.Coordinates[2].value=="number"&&(t.value+=r.Coordinates[2].value),i!=null&&i.PlacementRelTo&&"value"in i.PlacementRelTo&&typeof i.PlacementRelTo.value=="number"&&await this.getStoreyElevation(i.PlacementRelTo.value,t)}async setLengthUnitsFactor(){var s,t,e;const i=await this.getIfcApi(),n=i.GetLineIDsWithType(0,HA);if(n.size()!==0)for(let r=0;r<n.size();r++){const o=n.get(r),a=await i.properties.getItemProperties(0,o);for(const l of a.Units){const h=await i.properties.getItemProperties(0,l.value);if(h.UnitType.value!=="LENGTHUNIT")continue;let c=1,u=1;h.Name.value==="METRE"&&(u=1),h.Name.value==="FOOT"&&(u=.3048),((s=h.Prefix)==null?void 0:s.value)==="MILLI"?c=.001:((t=h.Prefix)==null?void 0:t.value)==="CENTI"?c=.01:((e=h.Prefix)==null?void 0:e.value)==="DECI"&&(c=.1),this._lengthUnitsFactor=u*c}}}async serializeAttributes(s,t){const e=[];let i=null;if(this._serializer.replaceStoreyElevation&&t.type&&typeof t.type=="number"&&t.type===qm&&t.Elevation&&"value"in t.Elevation){const o={value:0};t.ObjectPlacement&&"value"in t.ObjectPlacement&&typeof t.ObjectPlacement.value=="number"&&await this.getStoreyElevation(t.ObjectPlacement.value,o),t.Elevation.value=o.value*this._lengthUnitsFactor}for(const[o,a]of Object.entries(t)){if(typeof a=="number"||this._serializer.attributesToExclude.has(o)||a==null)continue;if(Array.isArray(a)){const c=a.filter(p=>p.type!==5);if(c.length>0){const p=[o,c.map(g=>g.value)],d="name"in c[0]&&c[0].name?c[0].name:c[0].constructor.name.toUpperCase();p.push(d!=="OBJECT"?d:"UNDEFINED");const _=JSON.stringify(p),m=this._builder.createSharedString(_);e.push(m)}const u=a.filter(p=>p.type===5).map(p=>p.value);this.addRelation(s,o,u);continue}const{value:l,type:h}=a;if(h===5){if(typeof l!="number")continue;this.addRelation(s,o,[l])}else{if(o==="GlobalId"&&typeof l=="string"){i=l;continue}const c=[o,l],u="name"in a&&a.name?a.name:a.constructor.name.toUpperCase();c.push(u!=="OBJECT"?u:"UNDEFINED");const p=JSON.stringify(c),d=this._builder.createSharedString(p);e.push(d),this._serializer.includeUniqueAttributes&&this._uniqueAttributes.add(p)}}const n=ig.createDataVector(this._builder,e),r=ig.createAttribute(this._builder,n);this._attributesOffsets.push(r),i&&(this._guids.push(i),this._guidsItems.push(s))}getAttributesVector(){return re.createAttributesVector(this._builder,this._attributesOffsets)}getUniqueAttributesVector(){const s=[];for(const t of this._uniqueAttributes){const e=this._builder.createSharedString(t);s.push(e)}return re.createUniqueAttributesVector(this._builder,s)}getRelNamesVector(){const s=[];for(const t of this._uniqueRelNames){const e=this._builder.createSharedString(t);s.push(e)}return re.createRelationNamesVector(this._builder,s)}getGuidsVector(){const s=[];for(const t of this._guids){const e=this._builder.createString(t);s.push(e)}return{guidsVector:re.createGuidsVector(this._builder,s),guidsItemsVector:re.createGuidsItemsVector(this._builder,this._guidsItems)}}async processRelations(s){const t=await this.getIfcApi();for(const e of s){const i=this._serializer.relations.get(e);if(!i)continue;const{forRelating:n,forRelated:r}=i,o=t.GetLineIDsWithType(0,e);if(o.size()!==0)for(let a=0;a<o.size();a++){const l=o.get(a),h=await t.properties.getItemProperties(0,l);if(!h)continue;const c=Object.keys(h),u=c.find(m=>m.startsWith("Relating")),p=c.find(m=>m.startsWith("Related"));if(!u||!p)continue;const d=h[u].value,_=h[p].map(({value:m})=>m);this.addRelation(d,n,_);for(const m of _)this.addRelation(m,r,[d])}}}getRelationsVector(s=!1){const t=[],e=[];for(const[n,r]of Object.entries(this._relationsMap)){if(s&&!this.expressIDs.includes(Number(n)))continue;const o=[];for(const[h,c]of Object.entries(r)){let u=c;if(s&&(u=c.filter(_=>this.expressIDs.includes(_)),u.length===0))continue;const p=JSON.stringify([h,...u]),d=this._builder.createSharedString(p);o.push(d)}if(s&&o.length===0)continue;e.push(Number(n));const a=ng.createDataVector(this._builder,o),l=ng.createRelation(this._builder,a);t.push(l)}const i=re.createRelationsVector(this._builder,t);return{relIndicesVector:re.createRelationsItemsVector(this._builder,e),relsVector:i}}getCategoriesVector(){const s=this.classes.map(t=>this._builder.createSharedString(t));return re.createCategoriesVector(this._builder,s)}async getMetadataOffset(){const s={schema:(await this.getIfcApi()).GetModelSchema(0)};return this._builder.createString(JSON.stringify(s))}getEntityDecomposition(s,t){var e;const i=[];for(const r of t){const o=(e=this._relationsMap[s])==null?void 0:e[r];if(!o)continue;const a={};for(const l of o){const h=this.expressIDs.indexOf(l);if(h===-1)continue;const c=this.classes[h];c&&(a[c]||(a[c]=[]),a[c].push(l))}for(const l in a){const h=a[l].map(d=>this.getEntityDecomposition(d,t)),c=Is.createChildrenVector(this._builder,h),u=this._builder.createSharedString(l);Is.startSpatialStructure(this._builder),Is.addCategory(this._builder,u),Is.addChildren(this._builder,c);const p=Is.endSpatialStructure(this._builder);i.push(p)}}const n=Is.createChildrenVector(this._builder,i);return Is.startSpatialStructure(this._builder),Is.addLocalId(this._builder,s),Is.addChildren(this._builder,n),Is.endSpatialStructure(this._builder)}async getSpatialStructureOffset(){const s=await this.getIfcApi(),t=Gm,e=[...s.GetLineIDsWithType(0,t)].map(r=>this.getEntityDecomposition(r,["IsDecomposedBy","ContainsElements"])),i=this._builder.createSharedString("IFCPROJECT"),n=Is.createChildrenVector(this._builder,e);return Is.startSpatialStructure(this._builder),Is.addCategory(this._builder,i),Is.addChildren(this._builder,n),Is.endSpatialStructure(this._builder)}clean(){var s;(s=this._ifcApi)==null||s.Dispose(),this._ifcApi=null,this._guids=[],this._guidsItems=[],this._attributesOffsets=[],this._relationsMap={},this._uniqueAttributes.clear(),this._uniqueRelNames.clear(),this.expressIDs=[],this.classes=[]}};function ne(s,t){return Math.round(s*t)/t}let zP=class{constructor(s,t,e,i){S(this,"x"),S(this,"y"),S(this,"z"),S(this,"hash"),S(this,"id"),this.x=ne(s[3*t],i),this.y=ne(s[3*t+1],i),this.z=ne(s[3*t+2],i),this.hash=`${this.x}/${this.y}/${this.z}`,this.id=e}},UP=class{constructor(s){S(this,"list",new Map),S(this,"tempV1",new F),S(this,"tempV2",new F),S(this,"tempV3",new F),S(this,"precission"),this.precission=s}create(s,t){const e=new zP(s,t,this.list.size,this.precission);return this.list.has(e.hash)||this.list.set(e.hash,e),this.list.get(e.hash)}get(){return Array.from(this.list.values()).map(s=>[s.x,s.y,s.z])}isValidTriangle(s,t,e,i){this.tempV1.set(s[3*t],s[3*t+1],s[3*t+2]),this.tempV2.set(s[3*e],s[3*e+1],s[3*e+2]),this.tempV3.set(s[3*i],s[3*i+1],s[3*i+2]);const n=1/this.precission*10,r=this.tempV1.distanceTo(this.tempV2)>n,o=this.tempV1.distanceTo(this.tempV3)>n,a=this.tempV2.distanceTo(this.tempV3)>n;return r&&o&&a}},lc=class{constructor(s,t){S(this,"p1"),S(this,"p2"),S(this,"hash"),this.p1=s,this.p2=t;const e=[this.p1,this.p2];e.sort((i,n)=>i.x-n.x||i.y-n.y||i.z-n.z),this.hash=`${e[0].hash}_${e[1].hash}`}},BP=class{constructor(s,t){S(this,"edges",new Map),S(this,"openEdges",new Set),S(this,"id"),S(this,"plane"),this.id=s,this.plane=t}add(s){if(this.edges.size!==0)for(const t of s)this.openEdges.has(t.hash)?this.openEdges.delete(t.hash):this.openEdges.add(t.hash),this.edges.set(t.hash,t);else for(const t of s)this.openEdges.add(t.hash),this.edges.set(t.hash,t)}match(s,t){if(t.id!==this.plane.id)return!1;for(const e of s)if(this.openEdges.has(e.hash))return!0;return!1}getOpenEdges(){const s=[];for(const t of this.openEdges)s.push(this.edges.get(t));return s}merge(s){for(const[t,e]of s.edges)this.edges.set(t,e);for(const t of s.openEdges)this.openEdges.has(t)?this.openEdges.delete(t):this.openEdges.add(t)}},VP=class{constructor(){S(this,"list",new Map),S(this,"nextFaceID",0)}add(s,t){const e=this.match(s,t);if(e.length===0){const i=this.nextFaceID++,n=new BP(i,t);return n.add(s),void this.list.set(n.id,n)}if(e.length!==1){if(e.length>1){const i=this.list.get(e[0]);i.add(s);for(let n=1;n<e.length;n++){const r=e[n],o=this.list.get(r);i.merge(o),this.list.delete(r)}}}else this.list.get(e[0]).add(s)}match(s,t){let e=[];for(const i of this.list.values())i.match(s,t)&&e.push(i.id);return e}},$P=class{constructor(s){S(this,"closed",!1),S(this,"openStartPoint",null),S(this,"openEndPoint",null),S(this,"plane"),S(this,"orderedPoints",[]),this.plane=s}getEdges(s=!1){const t=[];if(s)for(let e=this.orderedPoints.length-1;e>0;e--)t.push(new lc(this.orderedPoints[e],this.orderedPoints[e-1]));else for(let e=0;e<this.orderedPoints.length-1;e++)t.push(new lc(this.orderedPoints[e],this.orderedPoints[e+1]));return t}getIndices(){return this.orderedPoints.map(s=>s.id)}add(s){if(this.orderedPoints.length===0)return this.openStartPoint=s.p1.hash,this.openEndPoint=s.p2.hash,void this.orderedPoints.push(s.p1,s.p2);const t=this.match(s);if(t===0)throw new Error("Fragments: Edge doesn't match with any open point");if(t>2)throw new Error("Fragments: Edge matches with more than 2 open points");if(t===2)return this.closed=!0,this.openEndPoint=null,void(this.openStartPoint=null);this.openStartPoint===s.p1.hash?(this.orderedPoints.unshift(s.p2),this.openStartPoint=s.p2.hash):this.openEndPoint===s.p1.hash?(this.orderedPoints.push(s.p2),this.openEndPoint=s.p2.hash):this.openStartPoint===s.p2.hash?(this.orderedPoints.unshift(s.p1),this.openStartPoint=s.p1.hash):this.openEndPoint===s.p2.hash&&(this.orderedPoints.push(s.p1),this.openEndPoint=s.p1.hash)}match(s){if(this.closed)return 0;let t=0;return this.openStartPoint===s.p1.hash&&t++,this.openStartPoint===s.p2.hash&&t++,this.openEndPoint===s.p1.hash&&t++,this.openEndPoint===s.p2.hash&&t++,t}merge(s){if(s.closed||this.closed)throw new Error("Fragments: Cannot merge closed profiles");if(s.openStartPoint===this.openEndPoint&&s.openEndPoint===this.openStartPoint)throw new Error("Fragments: Cannot merge profiles that close each other");if(s.openEndPoint===this.openEndPoint&&s.openStartPoint===this.openStartPoint)throw new Error("Fragments: Cannot merge profiles that close each other");let t=!1;s.openEndPoint!==this.openStartPoint&&s.openEndPoint!==this.openEndPoint||(t=!0);const e=s.getEdges(t);for(const i of e)this.add(i)}getArea(){const s=this.orderedPoints.map(l=>[l.x,l.y,l.z]);let t=0,e=1;const i=Math.abs(this.plane.normal.x),n=Math.abs(this.plane.normal.y),r=Math.abs(this.plane.normal.z);i>=n&&i>=r?(t=1,e=2):n>=i&&n>=r?(t=0,e=2):(t=0,e=1);const o=[];for(const l of s)o.push(new Bt(l[t],l[e]));let a=0;for(let l=0,h=o.length;l<h;l++)a+=o[l].x*o[l===o.length-1?0:l+1].y*.5,a-=o[l===o.length-1?0:l+1].x*o[l].y*.5;return Math.abs(a)}},HP=class{constructor(s){S(this,"list",new Map),S(this,"plane"),S(this,"nextProfileID",0),this.plane=s}add(s){const t=this.match(s);if(t.length===0){const e=this.nextProfileID++,i=new $P(this.plane);return i.add(s),void this.list.set(e,i)}if(t.length!==1){if(t.length>1){const e=this.list.get(t[0]);e.add(s);const i=this.list.get(t[1]);e.merge(i),this.list.delete(t[1])}}else this.list.get(t[0]).add(s)}getProfiles(){let s=null,t=0;for(const[n,r]of this.list){const o=r.getArea();o>t&&(t=o,s=n)}if(s===null)return null;const e=this.list.get(s).getIndices(),i=[];for(const[n,r]of this.list)n!==s&&i.push(r.getIndices());return{profile:e,holes:i}}match(s){const t=[];for(const[e,i]of this.list)i.match(s)>0&&t.push(e);return t}};function x1(s){let t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let a=0;a<s.length;a+=3){const l=s[a],h=s[a+1],c=s[a+2];l<t&&(t=l),h<e&&(e=h),c<i&&(i=c),l>n&&(n=l),h>r&&(r=h),c>o&&(o=c)}return{min:{x:t,y:e,z:i},max:{x:n,y:r,z:o}}}let jP=class{constructor(s,t,e){S(this,"normal"),S(this,"constant"),S(this,"id"),S(this,"faces",[]);const i=ne(s.normal.x,e),n=ne(s.normal.y,e),r=ne(s.normal.z,e),o=ne(s.constant,t);this.normal=new F(i,n,r),this.constant=o;const a="||";this.id=`${i}${a}${n}${a}${r}${a}${o}`}};function YP(s){const{position:t,normals:e,index:i,raw:n}=s,r=t.length/3>3e3,o=x1(t);if(n||r)return function(g,f,b){const y=new Map,E=new Map,C=(x,A,O)=>{const L=`${x},${A},${O}`;if(y.has(L))return y.get(L)[0];const V=y.size;return y.set(L,[V,x,A,O]),V};for(let x=0;x<g.length-2;x+=3){const A=g[x],O=g[x+1],L=g[x+2],V=f[3*A],T=f[3*A+1],N=f[3*A+2],v=f[3*O],M=f[3*O+1],Q=f[3*O+2],j=f[3*L],it=f[3*L+1],G=f[3*L+2],nt=C(V,T,N),$=C(v,M,Q),B=C(j,it,G);E.set(E.size,[nt,$,B])}const I=[];for(const[,[,x,A,O]]of y)I.push([x,A,O]);return{bbox:b,type:to.SHELL,profiles:E,holes:new Map,points:I}}(i,t,o);const a=new Ht,l=new F,h=new F,c=new Map;for(let g=0;g<i.length-2;g+=3){const f=i[g];l.set(e[3*f],e[3*f+1],e[3*f+2]),h.set(t[3*f],t[3*f+1],t[3*f+2]),a.setFromNormalAndCoplanarPoint(l,h);const b=new jP(a,1e3,1e7);c.has(b.id)||c.set(b.id,b),c.get(b.id).faces.push(g)}const u=new UP(1e6),p=new VP;for(const[,g]of c)for(const f of g.faces){const b=i[f],y=i[f+1],E=i[f+2];if(!u.isValidTriangle(t,b,y,E))continue;const C=u.create(t,b),I=u.create(t,y),x=u.create(t,E),A=[new lc(C,I),new lc(I,x),new lc(x,C)];p.add(A,g)}const d=new Map,_=new Map;let m=0;for(const[,g]of p.list){const f=new HP(g.plane),b=g.getOpenEdges();for(const E of b)f.add(E);const y=f.getProfiles();d.set(m,(y==null?void 0:y.profile)||[]),_.set(m,(y==null?void 0:y.holes)||[]),m++}return{bbox:o,type:to.SHELL,profiles:d,holes:_,points:u.get()}}let WP=class{read(s){try{const t=s.GetAllAlignments(0),e=[];for(const i of t){const n={absolute:[],horizontal:[],vertical:[]};e.push(n);let r=0;for(let o=0;o<i.horizontal.length;o++){const a=i.curve3D[0].points,l=i.horizontal[o],h=[],c=[],u=this.getCurveType(l.data[1]),p=[],d=[];for(const g of l.points){const{x:f,y:b,z:y}=a[r++];p.push([f,b,y]),d.push([g.x,g.y])}p.reverse(),d.reverse();for(const[g,f,b]of p)h.push(g,f,b);for(const[g,f]of d)c.push(g,0,-f);const _=new Float32Array(h),m=new Float32Array(c);n.absolute.push({points:_,type:u}),n.horizontal.push({points:m,type:u})}for(let o=0;o<i.vertical.length;o++){const a=i.vertical[o],l=[],h=this.getCurveType(a.data[1]),c=[];for(const p of a.points)c.push([p.x,p.y]);c.reverse();for(const[p,d]of c)l.push(p,d,0);const u=new Float32Array(l);n.vertical.push({points:u,type:h})}}return e}catch(t){return console.error(t),[]}}getCurveType(s){if(s.includes("CIRCULARARC"))return zn.ELLIPSE_ARC;if(s.includes("LINE")||s.includes("GRADIENT"))return zn.LINES;if(s.includes("CLOTHOID"))return zn.CLOTHOID;if(s.includes("PARABOLICARC"))return zn.PARABOLA;throw new Error(`Fragments: Unknown curve type: ${s}`)}};class GP{constructor(t){S(this,"_ifcAPI",null),S(this,"wasm",{path:"../../../../node_modules/web-ifc/",absolute:!1}),S(this,"_tempObject1",new yi),S(this,"_tempObject2",new yi),S(this,"_tempMatrix1",new vt),S(this,"_previousGeometries",new Map),S(this,"_previousGeometriesIDs",new Map),S(this,"_previousGeometriesScales",new Map),S(this,"_previousLocalTransforms",new Map),S(this,"_problematicGeometries",new Set),S(this,"_problematicGeometriesHashes",new Set),S(this,"_coordinatesInitialized",!1),S(this,"_civilReader",new WP),S(this,"_maxId",0),S(this,"_rawCategories",new Set([vw,yw])),S(this,"distanceThreshold",1e5),S(this,"scene",null),S(this,"isolatedMeshes",null),S(this,"onElementLoaded",()=>{}),S(this,"onGeometryLoaded",()=>{}),S(this,"onLocalTransformLoaded",()=>{}),S(this,"onMaxIdFound",()=>{}),S(this,"onCoordinatesLoaded",()=>{}),S(this,"onAlignmentsLoaded",()=>{}),this._serializer=t}async load(t){var e,i,n;(e=t.progressCallback)==null||e.call(t,0,{process:"conversion",state:"start"}),this._previousGeometriesIDs.clear(),this._ifcAPI=new Qo,this._ifcAPI.SetWasmPath(this.wasm.path,this.wasm.absolute),await this._ifcAPI.Init();let r=0;if(t.readFromCallback&&t.readCallback)r=this._ifcAPI.OpenModelFromCallback(t.readCallback,{COORDINATE_TO_ORIGIN:!0});else{if(!t.bytes)throw new Error("Fragments: No data provided");r=await this._ifcAPI.OpenModel(t.bytes,{COORDINATE_TO_ORIGIN:!0})}this._ifcAPI.SetLogLevel(Np.LOG_LEVEL_OFF),this._maxId=this._ifcAPI.GetMaxExpressID(r),this.onLocalTransformLoaded({id:0,data:[0,0,0,1,0,0,0,1,0]});const o=new F,a=h=>{if(this._ifcAPI===null)throw new Error("Fragments: IfcAPI not initialized");if(!this._coordinatesInitialized){const A=this._ifcAPI.GetCoordinationMatrix(r);this._tempMatrix1.fromArray(A);const O=this.decompose(this._tempMatrix1);this.onCoordinatesLoaded(O),this._coordinatesInitialized=!0}const c=this._ifcAPI.GetLine(0,h.expressID),u={id:h.expressID,type:c.type,guid:c.GlobalId.value,geometries:[]},p=h.geometries.size(),d=h.geometries.get(0).flatTransformation,{transformWithoutScale:_}=this.removeScale(d);if(o.set(0,0,0),o.applyMatrix4(_),o.x>this.distanceThreshold||o.y>this.distanceThreshold||o.z>this.distanceThreshold)return void console.log(`Object ${u.id} is more than ${this.distanceThreshold} meters away from the origin and will be skipped.`);for(let A=0;A<p;A++)u.type===bw?this.loadCircleExtrusionGeometry(r,u,h,A,_.elements):this.loadShellGeometry(r,u,h,A,_.elements);const{dxx:m,dxy:g,dxz:f,dyx:b,dyy:y,dyz:E,px:C,py:I,pz:x}=this.decompose(_);u.geometries.length>0&&this.onElementLoaded({element:u,position:[C,I,x],xDirection:[m,g,f],yDirection:[b,y,E]})};if((i=this.isolatedMeshes)!=null&&i.size)this._ifcAPI.StreamMeshes(r,Array.from(this.isolatedMeshes),a);else{const h=this._ifcAPI.GetAllTypesOfModel(r).map(u=>u.typeID).filter(u=>this._serializer.classes.elements.has(u)),c=.5/h.length;for(const[u,p]of h.entries()){const d=u===0?"start":u+1===h.length?"finish":"inProgress",_=this._ifcAPI.GetLineIDsWithType(r,p),m=[];for(let g=0;g<_.size();g++)m.push(_.get(g));m.length>0&&(this._ifcAPI.StreamMeshes(r,m,a),(n=t.progressCallback)==null||n.call(t,c*(u+1),{process:"geometries",state:d,class:Qh[p],entitiesProcessed:m.length}))}}const l=this._civilReader.read(this._ifcAPI);this.onAlignmentsLoaded(l),this.onMaxIdFound(this._maxId),this._ifcAPI.Dispose(),this._ifcAPI=null,this._ifcAPI=new Qo,this._ifcAPI.SetWasmPath(this.wasm.path,this.wasm.absolute),await this._ifcAPI.Init(),this._previousGeometries.clear(),this._previousGeometriesIDs.clear(),this._previousGeometriesScales.clear(),this._maxId=0,this._previousLocalTransforms.clear(),this._problematicGeometries.clear(),this._problematicGeometriesHashes.clear()}loadCircleExtrusionGeometry(t,e,i,n,r){if(this._ifcAPI===null)throw new Error("Fragments: IfcAPI not initialized");const o=i.geometries.get(n),a=o.flatTransformation,{units:l}=this.removeScale(a),{x:h,y:c,z:u,w:p}=o.color,d={id:o.geometryExpressID,color:[h,c,u,p],localTransformID:null};e.geometries.push(d);const{transformWithoutScale:_}=this.removeScale(o.flatTransformation);if(this._previousGeometriesIDs.has(d.id))return this.getLocalTransform(r,_,d),void(d.id=this._previousGeometriesIDs.get(d.id));this.getLocalTransform(r,_,d);const m=this._ifcAPI.GetGeometry(t,d.id),g=m.GetSweptDiskSolid(),f=[],b=[],y=g.axis.size();for(let T=0;T<y;T++){const N=g.axis.get(T),v=[];for(let Q=0;Q<N.arcSegments.size();Q++)v.push(N.arcSegments.get(Q));f.push(v);const M=[];for(let Q=0;Q<N.points.size();Q++){const j=N.points.get(Q);M.push({x:j.x*l.x,y:j.y*l.y,z:j.z*l.z})}b.push(M)}const E=[],C=[],I=[],x=[];for(let T=0;T<b.length;T++){const N=b[T],v=f[T],M=N.length;for(let Q=0;Q<M-1;Q++){let j=-1,it=-1;for(let G=0;G<v.length;G+=2)if(v[G]===Q){j=Q,it=v[G+1];break}if(j===-1){const G=[],nt=N[Q],$=N[Q+1],B=nt.x,at=nt.y,J=nt.z,st=$.x,dt=$.y,wt=$.z;E.push(I.length),G.push(B,at,J,st,dt,wt),I.push(G),C.push(Me.WIRE)}else{const G=[],nt=j,$=Math.round((j+it)/2),B=it,at=N[nt],J=N[$],st=N[B],dt=this.computeCircleCurveProperties(at,J,st),wt=at.x-dt.center.x,pt=at.y-dt.center.y,_t=at.z-dt.center.z;let yt=Math.sqrt(wt*wt+pt*pt+_t*_t);yt===0&&(yt=1);const It=wt/yt,Vt=pt/yt,$t=_t/yt,w=J.x-dt.center.x,Z=J.y-dt.center.y,Y=J.z-dt.center.z;let R=Math.sqrt(w*w+Z*Z+Y*Y);R===0&&(R=1);const P=w/R,z=Z/R,K=Y/R;let H=this.crossProduct({x:It,y:Vt,z:$t},{x:P,y:z,z:K});yt=Math.sqrt(H.x*H.x+H.y*H.y+H.z*H.z),yt===0&&(yt=1),H={x:H.x/yt,y:H.y/yt,z:H.z/yt},E.push(x.length),G.push(dt.center.x,dt.center.y,dt.center.z,dt.radius,dt.angle,It,Vt,$t,H.x,H.y,H.z),x.push(G),C.push(Me.CIRCLE_CURVE),Q=B-1}}}const A=this.getGeometryBuffers(t,o);if(A===null)return console.log(`Zero length geometry: ${d.id}`),e.geometries.pop(),void this._problematicGeometries.add(d.id);const{position:O}=A;for(let T=0;T<O.length-2;T+=3)O[T]*=l.x,O[T+1]*=l.y,O[T+2]*=l.z;const L=x1(O),V=g.profileRadius*l.x;this._previousGeometriesIDs.set(d.id,d.id),this.onGeometryLoaded({id:d.id,geometry:{type:to.CIRCLE_EXTRUSION,indicesArray:E,typesArray:C,segments:I,circleCurveData:x,radius:V,bbox:L}}),m.delete()}loadShellGeometry(t,e,i,n,r){if(this._ifcAPI===null)throw new Error("Fragments: IfcAPI not initialized");const o=i.geometries.get(n),a=o.flatTransformation,{units:l}=this.removeScale(a);if(this._problematicGeometries.has(o.geometryExpressID))return void console.log(` Problematic geometry: ${o.geometryExpressID}`);const{x:h,y:c,z:u,w:p}=o.color,d={id:o.geometryExpressID,color:[h,c,u,p],localTransformID:null};e.geometries.push(d);const{transformWithoutScale:_}=this.removeScale(o.flatTransformation);if(this._previousGeometriesIDs.has(d.id)){const J=this.getScaleHash(l);if(this._previousGeometriesScales.get(d.id)===J)return this.getLocalTransform(r,_,d),void(d.id=this._previousGeometriesIDs.get(d.id));const st=++this._maxId;this._previousGeometriesScales.set(st,J),d.id=st}const m=this.getGeometryBuffers(t,o);if(m===null)return console.log(`Zero length geometry: ${d.id}`),e.geometries.pop(),void this._problematicGeometries.add(d.id);const{position:g,normals:f,index:b}=m;for(let J=0;J<g.length-2;J+=3)g[J]*=l.x,g[J+1]*=l.y,g[J+2]*=l.z;const y=g.length/3,E=b.length/3;let C=0,I=0;const x=new ks,A=new F,O=new F,L=new F,V=this.getVolume(b,g),T=new F;for(let J=0;J<b.length-2;J+=3){const st=b[J],dt=b[J+1],wt=b[J+2];A.set(g[3*st],g[3*st+1],g[3*st+2]),O.set(g[3*dt],g[3*dt+1],g[3*dt+2]),L.set(g[3*wt],g[3*wt+1],g[3*wt+2]),T.add(A),T.add(O),T.add(L),x.set(A,O,L);const pt=x.getArea();pt>C&&(C=pt),I+=pt}T.divideScalar(b.length),A.set(g[0],g[1],g[2]),O.set(g[3],g[4],g[5]),L.set(g[6],g[7],g[8]);const N=1e4,v=ne(I,N),M=ne(C,N),Q=ne(V,N),j=ne(A.x,N),it=ne(A.y,N),G=ne(A.z,N),nt=`${y}-${E}-${v}-${M}-${Q}-${ne(T.x,N)}-${ne(T.x,N)}-${ne(T.x,N)}-${j}-${it}-${G}`;if(this._problematicGeometriesHashes.has(nt))return console.log(`Problematic geometry: ${d.id}`),e.geometries.pop(),this._problematicGeometries.add(d.id),void this._problematicGeometriesHashes.add(nt);const $=!this._previousGeometries.has(nt),B=d.id;if($)this._previousGeometries.set(nt,B),this._previousGeometriesIDs.set(B,B);else{const J=this._previousGeometries.get(nt);if(J===void 0)throw new Error("Fragments: Previous geometry not found");this._previousGeometriesIDs.set(B,J),d.id=J}this.getLocalTransform(r,_,d);const at=this._rawCategories.has(e.type);if($)try{const J=YP({position:g,normals:f,index:b,raw:at});this.onGeometryLoaded({id:d.id,geometry:J})}catch{console.error(`Fragments: Problematic geometry: ${d.id}`),e.geometries.pop(),this._problematicGeometries.add(d.id),this._problematicGeometriesHashes.add(nt)}}getScaleHash(t){return`${t.x}-${t.y}-${t.z}`}getLocalTransform(t,e,i){this._tempObject1.position.set(0,0,0),this._tempObject1.rotation.set(0,0,0),this._tempObject1.scale.set(1,1,1),this._tempObject1.updateMatrix(),this._tempMatrix1.fromArray(t),this._tempObject1.applyMatrix4(this._tempMatrix1),this._tempObject2.position.set(0,0,0),this._tempObject2.rotation.set(0,0,0),this._tempObject2.scale.set(1,1,1),this._tempObject2.updateMatrix(),this._tempObject2.applyMatrix4(e),this._tempObject1.attach(this._tempObject2);const{px:n,py:r,pz:o,dxx:a,dxy:l,dxz:h,dyx:c,dyy:u,dyz:p}=this.decompose(this._tempObject2.matrix);if(this._tempObject2.removeFromParent(),!(n===0&&r===0&&o===0&&a===1&&l===0&&h===0&&c===0&&u===1&&p===0)){const d=`${n}-${r}-${o}-${a}-${l}-${h}-${c}-${u}-${p}`,_=this._previousLocalTransforms.get(d);if(_)i.localTransformID=_.id;else{const m={id:this._previousLocalTransforms.size+1,data:[n,r,o,a,l,h,c,u,p]};this._previousLocalTransforms.set(d,m),i.localTransformID=m.id,this.onLocalTransformLoaded(m)}}}removeScale(t){const e=new vt().fromArray(t),i=new F,n=new Ie,r=new F;e.decompose(i,n,r);const o=r,a=new vt;return a.compose(i,n,new F(1,1,1)),{units:o,transformWithoutScale:a}}decompose(t){return{dxx:ne(t.elements[0],1e3),dxy:ne(t.elements[1],1e3),dxz:ne(t.elements[2],1e3),dyx:ne(t.elements[4],1e5),dyy:ne(t.elements[5],1e5),dyz:ne(t.elements[6],1e5),dzx:ne(t.elements[8],1e5),dzy:ne(t.elements[9],1e5),dzz:ne(t.elements[10],1e5),px:ne(t.elements[12],1e5),py:ne(t.elements[13],1e5),pz:ne(t.elements[14],1e5)}}getVolume(t,e){let i=0;const n=new F,r=new F,o=new F;for(let a=0;a<t.length-2;a+=3){const l=3*t[a],h=3*t[a+1],c=3*t[a+2];n.set(e[l],e[l+1],e[l+2]),r.set(e[h],e[h+1],e[h+2]),o.set(e[c],e[c+1],e[c+2]),i+=this.getSignedVolumeOfTriangle(n,r,o)}return Math.abs(i)}getSignedVolumeOfTriangle(t,e,i){return 1/6*(-(i.x*e.y*t.z)+e.x*i.y*t.z+i.x*t.y*e.z-t.x*i.y*e.z-e.x*t.y*i.z+t.x*e.y*i.z)}getGeometryBuffers(t,e){if(!this._ifcAPI)throw new Error("Fragments: IfcAPI not initialized");const i=this._ifcAPI.GetGeometry(t,e.geometryExpressID),n=this._ifcAPI.GetIndexArray(i.GetIndexData(),i.GetIndexDataSize()),r=this._ifcAPI.GetVertexArray(i.GetVertexData(),i.GetVertexDataSize());if(n.length===0||r.length===0)return i.delete(),null;const o=new Float32Array(r.length/2),a=new Float32Array(r.length/2);for(let l=0;l<r.length;l+=6)o[l/2]=r[l],o[l/2+1]=r[l+1],o[l/2+2]=r[l+2],a[l/2]=r[l+3],a[l/2+1]=r[l+4],a[l/2+2]=r[l+5];return i.delete(),{position:o,normals:a,index:n}}crossProduct(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}}computeCircleCurveProperties(t,e,i){function n(m,g){return{x:m.x-g.x,y:m.y-g.y,z:m.z-g.z}}function r(m){return Math.sqrt(m.x*m.x+m.y*m.y+m.z*m.z)}const o=n(e,t),a=n(i,e),l=this.crossProduct(o,a),h=function(m,g,f){const b=g.x-m.x,y=g.y-m.y,E=g.z-m.z,C=f.x-m.x,I=f.y-m.y,x=f.z-m.z,A=.5*(b**2+y**2+E**2),O=.5*(C**2+I**2+x**2),L=b*I-y*C,V=y*x-E*I,T=E*C-b*x,N=A*C-O*b,v=A*I-O*y,M=A*x-O*E,Q=L**2+V**2+T**2;if(Q===0)throw new Error("Fragments: Points are collinear, no unique circle exists.");return{x:m.x+(L*v-T*M)/Q,y:m.y+(V*M-L*N)/Q,z:m.z+(T*N-V*v)/Q}}(t,e,i),c=n(t,h),u=n(i,h),p=r(n(h,t)),d=n(t,h),_=r(d);return d.x/=_,d.y/=_,d.z/=_,{center:h,radius:p,normal:l,initialTangent:d,angle:180*Math.acos((c.x*u.x+c.y*u.y+c.z*u.z)/(r(c)*r(u)))/Math.PI}}}let qP=class{constructor(s){S(this,"wasm",{path:"../../../../node_modules/web-ifc/",absolute:!1}),this._serializer=s}async process(s){const{builder:t}=s;let e=0;const i=[];let n={dxx:1,dxy:0,dxz:0,dyx:0,dyy:1,dyz:0,px:0,py:0,pz:0};const r=[],o=[],a=[],l=[],h=new Map,c=new Map,u=new Map,p=new GP(this._serializer);p.wasm=this.wasm,p.onGeometryLoaded=H=>{r.push(H)},p.onElementLoaded=H=>{a.push(H)},p.onLocalTransformLoaded=H=>{l.push(H)},p.onCoordinatesLoaded=H=>{n=H},p.onMaxIdFound=H=>{e=H},p.onAlignmentsLoaded=H=>{for(const U of H)o.push(U)},await p.load(s);const d=[];let _=0;$e.startGlobalTransformsVector(t,a.length);const m=new Map,g=[];for(let H=0;H<a.length;H++){const U=a[a.length-1-H];d.push(_++);const{position:X,xDirection:et,yDirection:tt}=U,[ht,mt,gt]=X,[kt,ce,jt]=et,[Xe,Ot,Ps]=tt;i.push(a[H].element.id);const ii=a.length-1-H,fe=U.element.type,ni=Qh[fe];m.has(ni)||m.set(ni,m.size),rr.createTransform(t,ht,mt,gt,kt,ce,jt,Xe,Ot,Ps),m.get(ni),g.unshift(U.element.id),h.set(U.element.id,ii)}const f=t.endVector(),b=[];for(let H=0;H<r.length;H++){const U=r[H];if(U.geometry.type!==to.SHELL)continue;const{points:X,profiles:et,holes:tt}=U.geometry,ht=65e3,mt=X.length>ht,gt=mt?ys.BIG:ys.NONE;tn.startPointsVector(t,X.length);for(let as=0;as<X.length;as++){const[$s,ls,xe]=X[X.length-1-as];os.createFloatVector(t,$s,ls,xe)}const kt=t.endVector(),ce=[],jt=[],Xe=[],Ot=[];for(const[,as]of et){if(mt){const xe=Ko.createIndicesVector(t,as),We=Ko.createBigShellProfile(t,xe);Xe.push(We);continue}const $s=Jo.createIndicesVector(t,as),ls=Jo.createShellProfile(t,$s);ce.push(ls)}const Ps=tn.createBigProfilesVector(t,Xe),ii=tn.createProfilesVector(t,ce);for(const[as,$s]of tt)if(mt)for(const ls of $s){const xe=gl.createIndicesVector(t,ls),We=gl.createBigShellHole(t,xe,as);Ot.push(We)}else for(const ls of $s){const xe=_l.createIndicesVector(t,ls),We=_l.createShellHole(t,xe,as);jt.push(We)}const fe=tn.createBigHolesVector(t,Ot),ni=tn.createHolesVector(t,jt),ri=tn.createShell(t,ii,ni,kt,Ps,fe,gt);b.push(ri)}const y=$e.createShellsVector(t,b),E=[];for(let H=0;H<r.length;H++){const U=r[H];if(U.geometry.type!==to.CIRCLE_EXTRUSION)continue;const X=[],{radius:et,indicesArray:tt,typesArray:ht,segments:mt,circleCurveData:gt}=U.geometry;ms.startCircleCurvesVector(t,gt.length);for(let ri=0;ri<gt.length;ri++){const[as,$s,ls,xe,We,yf,Ox,Px,Fx,Rx,Lx]=gt[ri];Dp.createCircleCurve(t,We/360*2*Math.PI,as,$s,ls,xe,Fx,Rx,Lx,yf,Ox,Px)}const kt=t.endVector();ms.startWiresVector(t,mt.length);for(let ri=0;ri<mt.length;ri++){const[as,$s,ls,xe,We,yf]=mt[ri];A_.createWire(t,as,$s,ls,xe,We,yf)}const ce=t.endVector(),jt=ms.createOrderVector(t,tt),Xe=ms.createPartsVector(t,ht);ms.startWireSetsVector(t,0);const Ot=t.endVector();ms.startAxis(t),ms.addCircleCurves(t,kt),ms.addOrder(t,jt),ms.addWires(t,ce),ms.addWireSets(t,Ot),ms.addParts(t,Xe);const Ps=ms.endAxis(t);X.push(Ps);const ii=Ji.createAxesVector(t,X),fe=Ji.createRadiusVector(t,[et]);Ji.startCircleExtrusion(t),Ji.addAxes(t,ii),Ji.addRadius(t,fe);const ni=Ji.endCircleExtrusion(t);E.push(ni)}const C=$e.createCircleExtrusionsVector(t,E);$e.startRepresentationsVector(t,r.length);const I=new Map;for(let H=0;H<r.length;H++){const U=r.length-1-H,X=r[U].geometry.type;let et=I.get(X);et===void 0&&(et=-1),I.set(X,et+1)}const x=new F,A=new F;for(let H=0;H<r.length;H++){const U=r.length-1-H,X=r[U],{bbox:et}=X.geometry;c.set(X.id,U);const tt=X.geometry.type,ht=I.get(tt);if(ht===void 0)throw new Error("Fragments: Malformed geometry definition");I.set(tt,ht-1),x.set(et.min.x,et.min.y,et.min.z),A.set(et.max.x,et.max.y,et.max.z),x.distanceTo(A)>999999&&(console.log(`Infinity bounding box: ${X.id}`),et.min.x=0,et.min.y=0,et.min.z=0,et.max.x=.1,et.max.y=.1,et.max.z=.1),kp.createRepresentation(t,ht,et.min.x,et.min.y,et.min.z,et.max.x,et.max.y,et.max.z,X.geometry.type)}const O=t.endVector();let L=0;for(const H of a)for(const U of H.element.geometries){const X=U.color.toString();if(!u.has(X)){const et=U.color.map(tt=>255*tt);u.set(X,{id:L++,color:et})}}$e.startMaterialsVector(t,u.size);const V=Array.from(u.keys());for(let H=0;H<V.length;H++){const U=V[V.length-1-H],{color:X}=u.get(U),[et,tt,ht,mt]=X;kw.createMaterial(t,et,tt,ht,mt,jc.ONE,0)}const T=t.endVector();let N=0;for(const H of a)N+=H.element.geometries.length;$e.startSamplesVector(t,N);for(let H=0;H<a.length;H++){const U=a[a.length-1-H],X=h.get(U.element.id),et=U.element.geometries;for(let tt=0;tt<et.length;tt++){const ht=et[et.length-tt-1],mt=c.get(ht.id),gt=u.get(ht.color.toString()).id,kt=ht.localTransformID||0;zp.createSample(t,X,gt,mt,kt)}}const v=t.endVector();$e.startLocalTransformsVector(t,l.length);for(let H=0;H<l.length;H++){const U=l[l.length-1-H],[X,et,tt,ht,mt,gt,kt,ce,jt]=U.data;rr.createTransform(t,X,et,tt,ht,mt,gt,kt,ce,jt)}const M=t.endVector(),Q=$e.createMeshesItemsVector(t,d),j=rr.createTransform(t,n.px,n.py,n.pz,n.dxx,n.dxy,n.dxz,n.dyx,n.dyy,n.dyz);$e.startMeshes(t),$e.addCoordinates(t,j),$e.addGlobalTransforms(t,f),$e.addShells(t,y),$e.addRepresentations(t,O),$e.addSamples(t,v),$e.addLocalTransforms(t,M),$e.addMaterials(t,T),$e.addCircleExtrusions(t,C),$e.addMeshesItems(t,Q);const it=$e.endMeshes(t),G=[],nt=new Map,$=new Map,B=new Map;let at=0;for(let H=0;H<o.length;H++){const U=H,X=o[U],et=[];nt.set(U,et);const tt=[];$.set(U,tt);const ht=[];B.set(U,ht);for(let mt=0;mt<X.absolute.length;mt++){const gt=X.absolute[X.absolute.length-1-mt],{points:kt}=gt,ce=oi.createPointsVector(t,kt);oi.startGeometryLines(t),oi.addPoints(t,ce);const jt=oi.endGeometryLines(t);G.push(jt),et.push(at++)}for(let mt=0;mt<X.horizontal.length;mt++){const gt=X.horizontal[X.horizontal.length-1-mt],{points:kt}=gt,ce=oi.createPointsVector(t,kt);oi.startGeometryLines(t),oi.addPoints(t,ce);const jt=oi.endGeometryLines(t);G.push(jt),tt.push(at++)}for(let mt=0;mt<X.vertical.length;mt++){const gt=X.vertical[X.vertical.length-1-mt],{points:kt}=gt,ce=oi.createPointsVector(t,kt);oi.startGeometryLines(t),oi.addPoints(t,ce);const jt=oi.endGeometryLines(t);G.push(jt),ht.push(at++)}}const J=ke.createLinesVector(t,G);let st=at;ke.startRepresentationsVector(t,st);const dt=[];st--;for(let H=0;H<o.length;H++){const U=o.length-1-H,X=o[U];for(let et=0;et<X.absolute.length;et++){const tt=X.absolute[X.absolute.length-1-et],{type:ht}=tt;dt.unshift(e++);const mt=st--;Sd.createGeometryRepresentation(t,mt,ht)}for(let et=0;et<X.horizontal.length;et++){const tt=X.horizontal[X.horizontal.length-1-et],{type:ht}=tt;dt.unshift(e++);const mt=st--;Sd.createGeometryRepresentation(t,mt,ht)}for(let et=0;et<X.vertical.length;et++){const tt=X.vertical[X.vertical.length-1-et],{type:ht}=tt;dt.unshift(e++);const mt=st--;Sd.createGeometryRepresentation(t,mt,ht)}}const wt=t.endVector();let pt=at;const _t=[];ke.startSamplesVector(t,pt),pt--;for(let H=0;H<o.length;H++){const U=o.length-1-H,X=o[U];for(let et=0;et<X.absolute.length;et++){const tt=pt--;_t.unshift(e++),Od.createGeometrySample(t,tt,0)}for(let et=0;et<X.horizontal.length;et++){const tt=pt--;_t.unshift(e++),Od.createGeometrySample(t,tt,0)}for(let et=0;et<X.vertical.length;et++){const tt=pt--;_t.unshift(e++),Od.createGeometrySample(t,tt,0)}}const yt=t.endVector();ke.startTransformsVector(t,1),rr.createTransform(t,0,0,0,1,0,0,0,1,0);const It=t.endVector(),Vt=[e++];ke.startWallsVector(t,0);const $t=t.endVector();ke.startRepresentationsSamplesVector(t,0);const w=t.endVector(),Z=ke.createRepresentationIdsVector(t,dt),Y=ke.createSampleIdsVector(t,_t),R=ke.createRepresentationsSamplesVector(t,Vt);ke.startGeometries(t),ke.addSamples(t,yt),ke.addSampleIds(t,Y),ke.addRepresentations(t,wt),ke.addRepresentationIds(t,Z),ke.addTransforms(t,It),ke.addTransformIds(t,R),ke.addRepresentationsSamples(t,w),ke.addLines(t,J),ke.addWalls(t,$t);const P=ke.endGeometries(t),z=[];for(let H=0;H<o.length;H++){const U=nt.get(H),X=$.get(H),et=B.get(H);if(U===void 0||X===void 0||et===void 0)throw new Error("Fragments: Malformed alignment definition");const tt=Rh.createAbsoluteVector(t,U),ht=Rh.createHorizontalVector(t,X),mt=Rh.createVerticalVector(t,et),gt=Rh.createAlignment(t,tt,ht,mt);z.push(gt)}const K=re.createAlignmentsVector(t,z);return{modelMesh:it,localIDs:i,maxLocalID:e,modelGeometries:P,modelAlignments:K}}};const Iu={base:new Set([Gm,Ib,xb,qm]),materials:new Set([RA,LA,NA,MA,DA,kA,zA,UA,BA,VA]),properties:new Set([EA,CA,IA,xA,TA,AA,SA,OA,PA,FA]),elements:new Set([Gm,Ib,xb,qm,Gx,qx,Zx,Xx,Qx,Kx,Jx,t2,e2,s2,i2,n2,r2,o2,a2,l2,h2,c2,u2,d2,p2,f2,m2,g2,_2,b2,y2,v2,w2,E2,C2,I2,x2,T2,A2,bw,S2,O2,P2,F2,R2,L2,N2,M2,D2,k2,z2,U2,B2,V2,$2,H2,j2,Y2,W2,G2,q2,Z2,X2,Q2,K2,J2,tT,eT,sT,iT,nT,rT,oT,aT,lT,hT,cT,uT,dT,pT,fT,mT,gT,_T,bT,yT,vT,wT,ET,CT,IT,xT,TT,AT,ST,OT,PT,FT,RT,LT,NT,MT,DT,kT,zT,UT,BT,VT,$T,HT,jT,YT,WT,GT,qT,ZT,XT,QT,KT,JT,tA,eA,sA,iA,nA,rA,oA,aA,lA,hA,cA,uA,dA,pA,fA,mA,gA,_A,yw,vw,bA,yA,vA,wA])};let T1=class{constructor(){S(this,"_builder",null),S(this,"wasm",{path:"/node_modules/web-ifc/",absolute:!1}),S(this,"attributesToExclude",new Set(["Representation","ObjectPlacement","CompositionType","OwnerHistory"])),S(this,"relations",new Map([[Ux,{forRelating:"DefinesOcurrence",forRelated:"IsDefinedBy"}],[Bx,{forRelated:"HasAssociations",forRelating:"AssociatedTo"}],[Vx,{forRelated:"Decomposes",forRelating:"IsDecomposedBy"}],[$x,{forRelated:"ContainedInStructure",forRelating:"ContainsElements"}]])),S(this,"classes",{elements:new ge([...Iu.elements]),abstract:new ge([...Iu.base,...Iu.materials,...Iu.properties])}),S(this,"includeUniqueAttributes",!1),S(this,"includeRelationNames",!1),S(this,"replaceStoreyElevation",!0)}get builder(){if(!this._builder)throw new Error("Fragments: Builder not initialized");return this._builder}async process(s){var t;this._builder=new oS(1024);const e=new qP(this);e.wasm=this.wasm;const i={...s,builder:this.builder},n=await e.process(i),{modelMesh:r,maxLocalID:o,localIDs:a,modelGeometries:l,modelAlignments:h}=n,c=new kP(this,this.builder);c.wasm=this.wasm;const u={...s,geometryProcessedLocalIDs:a},p=await c.process(u),{relIndicesVector:d,relsVector:_,guidsVector:m,guidsItemsVector:g,metadataOffset:f,localIdsVector:b,spatialStrutureOffset:y,attributesVector:E,categoriesVector:C,uniqueAttributesVector:I,relNamesVector:x}=p,A=s.id??Vc.generateUUID(),O=this.builder.createString(A);re.startModel(this.builder),re.addMeshes(this.builder,r),re.addMetadata(this.builder,f),re.addAttributes(this.builder,E),re.addUniqueAttributes(this.builder,I),re.addRelationNames(this.builder,x),re.addLocalIds(this.builder,b),re.addCategories(this.builder,C),re.addRelationsItems(this.builder,d),re.addRelations(this.builder,_),re.addGuidsItems(this.builder,g),re.addGuids(this.builder,m),re.addSpatialStructure(this.builder,y),re.addGuid(this.builder,O),re.addMaxLocalId(this.builder,o),re.addGeometries(this.builder,l),re.addAlignments(this.builder,h);const L=re.endModel(this.builder);this.builder.finish(L);const V=this.builder.asUint8Array();this.clean();const T=s.raw?V:qO.deflate(V);return(t=s.progressCallback)==null||t.call(s,1,{process:"conversion",state:"finish"}),T}clean(){var s;(s=this._builder)==null||s.clear(),this._builder=null}};var ZP=Object.defineProperty,XP=(s,t,e)=>t in s?ZP(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,D=(s,t,e)=>(XP(s,typeof t!="symbol"?t+"":t,e),e);let Et=class{constructor(){D(this,"enabled",!0),D(this,"trigger",s=>{if(!this.enabled)return;const t=this.handlers.slice(0);for(const e of t)e(s)}),D(this,"handlers",[])}add(s){this.handlers.push(s)}remove(s){this.handlers=this.handlers.filter(t=>t!==s)}reset(){this.handlers.length=0}};class L_{constructor(t){D(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),D(this,"isResizeable",()=>"resize"in this&&"getSize"in this),D(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),D(this,"isHideable",()=>"visible"in this),D(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),this.components=t}}class Cs extends L_{}class N_ extends L_{constructor(t){super(t),D(this,"worlds",new Wt),D(this,"onWorldChanged",new Et),D(this,"_currentWorld",null),this.onWorldChanged.add(({world:e,action:i})=>{i==="removed"&&this.worlds.delete(e.uuid)})}set currentWorld(t){this._currentWorld=t}get currentWorld(){return this._currentWorld}}class QP extends N_{constructor(){super(...arguments),D(this,"hasCameraControls",()=>"controls"in this)}}class KP extends N_{constructor(){super(...arguments),D(this,"onAfterUpdate",new Et),D(this,"onBeforeUpdate",new Et),D(this,"onDisposed",new Et),D(this,"onResize",new Et),D(this,"onClippingPlanesUpdated",new Et),D(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(t,e,i){e.isLocal=i;const n=this.clippingPlanes.indexOf(e);t&&n===-1?this.clippingPlanes.push(e):!t&&n>-1&&this.clippingPlanes.splice(n,1),this.three.clippingPlanes=this.clippingPlanes.filter(r=>!r.isLocal)}}const A1=class wg extends Cs{constructor(t){super(t),D(this,"_disposedComponents",new Set),D(this,"enabled",!0),t.add(wg.uuid,this)}get(){return this._disposedComponents}destroy(t,e=!0,i=!0){t.removeFromParent();const n=t;n.dispose&&n.dispose(),this.disposeGeometryAndMaterials(t,e),i&&n.children&&n.children.length&&this.disposeChildren(n),t.children.length=0}disposeGeometry(t){t.boundsTree&&t.disposeBoundsTree&&t.disposeBoundsTree(),t.dispose()}disposeGeometryAndMaterials(t,e){const i=t;i.geometry&&this.disposeGeometry(i.geometry),e&&i.material&&wg.disposeMaterial(i),i.material=[],i.geometry=null}disposeChildren(t){for(const e of t.children)this.destroy(e)}static disposeMaterial(t){if(t.material)if(Array.isArray(t.material))for(const e of t.material)e.dispose();else t.material.dispose()}};D(A1,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let Vp=A1;class JP extends N_{constructor(t){super(t),D(this,"onDisposed",new Et),D(this,"directionalLights",new Map),D(this,"ambientLights",new Map)}dispose(){const t=this.components.get(Vp);for(const e of this.three.children){const i=e;i.geometry&&t.destroy(i)}this.deleteAllLights(),this.three.children=[],this.onDisposed.trigger(),this.onDisposed.reset()}deleteAllLights(){for(const[,t]of this.directionalLights)t.removeFromParent(),t.target.removeFromParent(),t.dispose();this.directionalLights.clear();for(const[,t]of this.ambientLights)t.removeFromParent(),t.dispose();this.ambientLights.clear()}}class $f extends Set{constructor(t){super(t),D(this,"onItemAdded",new Et),D(this,"onItemDeleted",new Et),D(this,"onCleared",new Et),D(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}add(...t){for(const e of t)this.has(e)||!this.guard(e)||(super.add(e),this.onItemAdded||(this.onItemAdded=new Et),this.onItemAdded.trigger(e));return this}delete(t){const e=super.delete(t);return e&&this.onItemDeleted.trigger(),e}dispose(){this.clear(),this.onItemAdded.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}const M_=class Ke{static create(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return`${Ke._lut[t&255]+Ke._lut[t>>8&255]+Ke._lut[t>>16&255]+Ke._lut[t>>24&255]}-${Ke._lut[e&255]}${Ke._lut[e>>8&255]}-${Ke._lut[e>>16&15|64]}${Ke._lut[e>>24&255]}-${Ke._lut[i&63|128]}${Ke._lut[i>>8&255]}-${Ke._lut[i>>16&255]}${Ke._lut[i>>24&255]}${Ke._lut[n&255]}${Ke._lut[n>>8&255]}${Ke._lut[n>>16&255]}${Ke._lut[n>>24&255]}`.toLowerCase()}static validate(t){if(!Ke._pattern.test(t))throw new Error(`${t} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};D(M_,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/);D(M_,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let fi=M_;var xu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function t3(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var S1={},$p={};(function(s){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",e=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",i="["+t+"]["+e+"]*",n=new RegExp("^"+i+"$"),r=function(a,l){const h=[];let c=l.exec(a);for(;c;){const u=[];u.startIndex=l.lastIndex-c[0].length;const p=c.length;for(let d=0;d<p;d++)u.push(c[d]);h.push(u),c=l.exec(a)}return h},o=function(a){const l=n.exec(a);return!(l===null||typeof l>"u")};s.isExist=function(a){return typeof a<"u"},s.isEmptyObject=function(a){return Object.keys(a).length===0},s.merge=function(a,l,h){if(l){const c=Object.keys(l),u=c.length;for(let p=0;p<u;p++)h==="strict"?a[c[p]]=[l[c[p]]]:a[c[p]]=l[c[p]]}},s.getValue=function(a){return s.isExist(a)?a:""},s.isName=o,s.getAllMatches=r,s.nameRegexp=i})($p);const D_=$p,e3={allowBooleanAttributes:!1,unpairedTags:[]};S1.validate=function(s,t){t=Object.assign({},e3,t);const e=[];let i=!1,n=!1;s[0]==="\uFEFF"&&(s=s.substr(1));for(let r=0;r<s.length;r++)if(s[r]==="<"&&s[r+1]==="?"){if(r+=2,r=f0(s,r),r.err)return r}else if(s[r]==="<"){let o=r;if(r++,s[r]==="!"){r=m0(s,r);continue}else{let a=!1;s[r]==="/"&&(a=!0,r++);let l="";for(;r<s.length&&s[r]!==">"&&s[r]!==" "&&s[r]!=="	"&&s[r]!==`
`&&s[r]!=="\r";r++)l+=s[r];if(l=l.trim(),l[l.length-1]==="/"&&(l=l.substring(0,l.length-1),r--),!h3(l)){let u;return l.trim().length===0?u="Invalid space after '<'.":u="Tag '"+l+"' is an invalid name.",ze("InvalidTag",u,Fs(s,r))}const h=n3(s,r);if(h===!1)return ze("InvalidAttr","Attributes for '"+l+"' have open quote.",Fs(s,r));let c=h.value;if(r=h.index,c[c.length-1]==="/"){const u=r-c.length;c=c.substring(0,c.length-1);const p=g0(c,t);if(p===!0)i=!0;else return ze(p.err.code,p.err.msg,Fs(s,u+p.err.line))}else if(a)if(h.tagClosed){if(c.trim().length>0)return ze("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",Fs(s,o));if(e.length===0)return ze("InvalidTag","Closing tag '"+l+"' has not been opened.",Fs(s,o));{const u=e.pop();if(l!==u.tagName){let p=Fs(s,u.tagStartPos);return ze("InvalidTag","Expected closing tag '"+u.tagName+"' (opened in line "+p.line+", col "+p.col+") instead of closing tag '"+l+"'.",Fs(s,o))}e.length==0&&(n=!0)}}else return ze("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",Fs(s,r));else{const u=g0(c,t);if(u!==!0)return ze(u.err.code,u.err.msg,Fs(s,r-c.length+u.err.line));if(n===!0)return ze("InvalidXml","Multiple possible root nodes found.",Fs(s,r));t.unpairedTags.indexOf(l)!==-1||e.push({tagName:l,tagStartPos:o}),i=!0}for(r++;r<s.length;r++)if(s[r]==="<")if(s[r+1]==="!"){r++,r=m0(s,r);continue}else if(s[r+1]==="?"){if(r=f0(s,++r),r.err)return r}else break;else if(s[r]==="&"){const u=a3(s,r);if(u==-1)return ze("InvalidChar","char '&' is not expected.",Fs(s,r));r=u}else if(n===!0&&!p0(s[r]))return ze("InvalidXml","Extra text at the end",Fs(s,r));s[r]==="<"&&r--}}else{if(p0(s[r]))continue;return ze("InvalidChar","char '"+s[r]+"' is not expected.",Fs(s,r))}if(i){if(e.length==1)return ze("InvalidTag","Unclosed tag '"+e[0].tagName+"'.",Fs(s,e[0].tagStartPos));if(e.length>0)return ze("InvalidXml","Invalid '"+JSON.stringify(e.map(r=>r.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return ze("InvalidXml","Start tag expected.",1);return!0};function p0(s){return s===" "||s==="	"||s===`
`||s==="\r"}function f0(s,t){const e=t;for(;t<s.length;t++)if(s[t]=="?"||s[t]==" "){const i=s.substr(e,t-e);if(t>5&&i==="xml")return ze("InvalidXml","XML declaration allowed only at the start of the document.",Fs(s,t));if(s[t]=="?"&&s[t+1]==">"){t++;break}else continue}return t}function m0(s,t){if(s.length>t+5&&s[t+1]==="-"&&s[t+2]==="-"){for(t+=3;t<s.length;t++)if(s[t]==="-"&&s[t+1]==="-"&&s[t+2]===">"){t+=2;break}}else if(s.length>t+8&&s[t+1]==="D"&&s[t+2]==="O"&&s[t+3]==="C"&&s[t+4]==="T"&&s[t+5]==="Y"&&s[t+6]==="P"&&s[t+7]==="E"){let e=1;for(t+=8;t<s.length;t++)if(s[t]==="<")e++;else if(s[t]===">"&&(e--,e===0))break}else if(s.length>t+9&&s[t+1]==="["&&s[t+2]==="C"&&s[t+3]==="D"&&s[t+4]==="A"&&s[t+5]==="T"&&s[t+6]==="A"&&s[t+7]==="["){for(t+=8;t<s.length;t++)if(s[t]==="]"&&s[t+1]==="]"&&s[t+2]===">"){t+=2;break}}return t}const s3='"',i3="'";function n3(s,t){let e="",i="",n=!1;for(;t<s.length;t++){if(s[t]===s3||s[t]===i3)i===""?i=s[t]:i!==s[t]||(i="");else if(s[t]===">"&&i===""){n=!0;break}e+=s[t]}return i!==""?!1:{value:e,index:t,tagClosed:n}}const r3=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function g0(s,t){const e=D_.getAllMatches(s,r3),i={};for(let n=0;n<e.length;n++){if(e[n][1].length===0)return ze("InvalidAttr","Attribute '"+e[n][2]+"' has no space in starting.",Zl(e[n]));if(e[n][3]!==void 0&&e[n][4]===void 0)return ze("InvalidAttr","Attribute '"+e[n][2]+"' is without value.",Zl(e[n]));if(e[n][3]===void 0&&!t.allowBooleanAttributes)return ze("InvalidAttr","boolean attribute '"+e[n][2]+"' is not allowed.",Zl(e[n]));const r=e[n][2];if(!l3(r))return ze("InvalidAttr","Attribute '"+r+"' is an invalid name.",Zl(e[n]));if(!i.hasOwnProperty(r))i[r]=1;else return ze("InvalidAttr","Attribute '"+r+"' is repeated.",Zl(e[n]))}return!0}function o3(s,t){let e=/\d/;for(s[t]==="x"&&(t++,e=/[\da-fA-F]/);t<s.length;t++){if(s[t]===";")return t;if(!s[t].match(e))break}return-1}function a3(s,t){if(t++,s[t]===";")return-1;if(s[t]==="#")return t++,o3(s,t);let e=0;for(;t<s.length;t++,e++)if(!(s[t].match(/\w/)&&e<20)){if(s[t]===";")break;return-1}return t}function ze(s,t,e){return{err:{code:s,msg:t,line:e.line||e,col:e.col}}}function l3(s){return D_.isName(s)}function h3(s){return D_.isName(s)}function Fs(s,t){const e=s.substring(0,t).split(/\r?\n/);return{line:e.length,col:e[e.length-1].length+1}}function Zl(s){return s.startIndex+s[1].length}var k_={};const O1={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(s,t){return t},attributeValueProcessor:function(s,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(s,t,e){return s}},c3=function(s){return Object.assign({},O1,s)};k_.buildOptions=c3;k_.defaultOptions=O1;class u3{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}var d3=u3;const p3=$p;function f3(s,t){const e={};if(s[t+3]==="O"&&s[t+4]==="C"&&s[t+5]==="T"&&s[t+6]==="Y"&&s[t+7]==="P"&&s[t+8]==="E"){t=t+9;let i=1,n=!1,r=!1,o="";for(;t<s.length;t++)if(s[t]==="<"&&!r){if(n&&_3(s,t))t+=7,[entityName,val,t]=m3(s,t+1),val.indexOf("&")===-1&&(e[w3(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(n&&b3(s,t))t+=8;else if(n&&y3(s,t))t+=8;else if(n&&v3(s,t))t+=9;else if(g3)r=!0;else throw new Error("Invalid DOCTYPE");i++,o=""}else if(s[t]===">"){if(r?s[t-1]==="-"&&s[t-2]==="-"&&(r=!1,i--):i--,i===0)break}else s[t]==="["?n=!0:o+=s[t];if(i!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:e,i:t}}function m3(s,t){let e="";for(;t<s.length&&s[t]!=="'"&&s[t]!=='"';t++)e+=s[t];if(e=e.trim(),e.indexOf(" ")!==-1)throw new Error("External entites are not supported");const i=s[t++];let n="";for(;t<s.length&&s[t]!==i;t++)n+=s[t];return[e,n,t]}function g3(s,t){return s[t+1]==="!"&&s[t+2]==="-"&&s[t+3]==="-"}function _3(s,t){return s[t+1]==="!"&&s[t+2]==="E"&&s[t+3]==="N"&&s[t+4]==="T"&&s[t+5]==="I"&&s[t+6]==="T"&&s[t+7]==="Y"}function b3(s,t){return s[t+1]==="!"&&s[t+2]==="E"&&s[t+3]==="L"&&s[t+4]==="E"&&s[t+5]==="M"&&s[t+6]==="E"&&s[t+7]==="N"&&s[t+8]==="T"}function y3(s,t){return s[t+1]==="!"&&s[t+2]==="A"&&s[t+3]==="T"&&s[t+4]==="T"&&s[t+5]==="L"&&s[t+6]==="I"&&s[t+7]==="S"&&s[t+8]==="T"}function v3(s,t){return s[t+1]==="!"&&s[t+2]==="N"&&s[t+3]==="O"&&s[t+4]==="T"&&s[t+5]==="A"&&s[t+6]==="T"&&s[t+7]==="I"&&s[t+8]==="O"&&s[t+9]==="N"}function w3(s){if(p3.isName(s))return s;throw new Error(`Invalid entity name ${s}`)}var E3=f3;const C3=/^[-+]?0x[a-fA-F0-9]+$/,I3=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,x3={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function T3(s,t={}){if(t=Object.assign({},x3,t),!s||typeof s!="string")return s;let e=s.trim();if(t.skipLike!==void 0&&t.skipLike.test(e))return s;if(s==="0")return 0;if(t.hex&&C3.test(e))return S3(e,16);if(e.search(/[eE]/)!==-1){const i=e.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(i){if(t.leadingZeros)e=(i[1]||"")+i[3];else if(!(i[2]==="0"&&i[3][0]==="."))return s;return t.eNotation?Number(e):s}else return s}else{const i=I3.exec(e);if(i){const n=i[1],r=i[2];let o=A3(i[3]);if(!t.leadingZeros&&r.length>0&&n&&e[2]!=="."||!t.leadingZeros&&r.length>0&&!n&&e[1]!==".")return s;if(t.leadingZeros&&r===s)return 0;{const a=Number(e),l=""+a;return l.search(/[eE]/)!==-1?t.eNotation?a:s:e.indexOf(".")!==-1?l==="0"&&o===""||l===o||n&&l==="-"+o?a:s:r?o===l||n+o===l?a:s:e===l||e===n+l?a:s}}else return s}}function A3(s){return s&&s.indexOf(".")!==-1&&(s=s.replace(/0+$/,""),s==="."?s="0":s[0]==="."?s="0"+s:s[s.length-1]==="."&&(s=s.substr(0,s.length-1))),s}function S3(s,t){if(parseInt)return parseInt(s,t);if(Number.parseInt)return Number.parseInt(s,t);if(window&&window.parseInt)return window.parseInt(s,t);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}var O3=T3;const P1=$p,Xl=d3,P3=E3,F3=O3;let R3=class{constructor(s){this.options=s,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(t,e)=>String.fromCharCode(Number.parseInt(e,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(t,e)=>String.fromCharCode(Number.parseInt(e,16))}},this.addExternalEntities=L3,this.parseXml=z3,this.parseTextData=N3,this.resolveNameSpace=M3,this.buildAttributesMap=k3,this.isItStopNode=$3,this.replaceEntitiesValue=B3,this.readStopNodeData=j3,this.saveTextToParentTag=V3,this.addChild=U3}};function L3(s){const t=Object.keys(s);for(let e=0;e<t.length;e++){const i=t[e];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:s[i]}}}function N3(s,t,e,i,n,r,o){if(s!==void 0&&(this.options.trimValues&&!i&&(s=s.trim()),s.length>0)){o||(s=this.replaceEntitiesValue(s));const a=this.options.tagValueProcessor(t,s,e,n,r);return a==null?s:typeof a!=typeof s||a!==s?a:this.options.trimValues?Cg(s,this.options.parseTagValue,this.options.numberParseOptions):s.trim()===s?Cg(s,this.options.parseTagValue,this.options.numberParseOptions):s}}function M3(s){if(this.options.removeNSPrefix){const t=s.split(":"),e=s.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(s=e+t[1])}return s}const D3=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function k3(s,t,e){if(!this.options.ignoreAttributes&&typeof s=="string"){const i=P1.getAllMatches(s,D3),n=i.length,r={};for(let o=0;o<n;o++){const a=this.resolveNameSpace(i[o][1]);let l=i[o][4],h=this.options.attributeNamePrefix+a;if(a.length)if(this.options.transformAttributeName&&(h=this.options.transformAttributeName(h)),h==="__proto__"&&(h="#__proto__"),l!==void 0){this.options.trimValues&&(l=l.trim()),l=this.replaceEntitiesValue(l);const c=this.options.attributeValueProcessor(a,l,t);c==null?r[h]=l:typeof c!=typeof l||c!==l?r[h]=c:r[h]=Cg(l,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(r[h]=!0)}if(!Object.keys(r).length)return;if(this.options.attributesGroupName){const o={};return o[this.options.attributesGroupName]=r,o}return r}}const z3=function(s){s=s.replace(/\r\n?/g,`
`);const t=new Xl("!xml");let e=t,i="",n="";for(let r=0;r<s.length;r++)if(s[r]==="<")if(s[r+1]==="/"){const o=zo(s,">",r,"Closing Tag is not closed.");let a=s.substring(r+2,o).trim();if(this.options.removeNSPrefix){const c=a.indexOf(":");c!==-1&&(a=a.substr(c+1))}this.options.transformTagName&&(a=this.options.transformTagName(a)),e&&(i=this.saveTextToParentTag(i,e,n));const l=n.substring(n.lastIndexOf(".")+1);if(a&&this.options.unpairedTags.indexOf(a)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${a}>`);let h=0;l&&this.options.unpairedTags.indexOf(l)!==-1?(h=n.lastIndexOf(".",n.lastIndexOf(".")-1),this.tagsNodeStack.pop()):h=n.lastIndexOf("."),n=n.substring(0,h),e=this.tagsNodeStack.pop(),i="",r=o}else if(s[r+1]==="?"){let o=Eg(s,r,!1,"?>");if(!o)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,e,n),!(this.options.ignoreDeclaration&&o.tagName==="?xml"||this.options.ignorePiTags)){const a=new Xl(o.tagName);a.add(this.options.textNodeName,""),o.tagName!==o.tagExp&&o.attrExpPresent&&(a[":@"]=this.buildAttributesMap(o.tagExp,n,o.tagName)),this.addChild(e,a,n)}r=o.closeIndex+1}else if(s.substr(r+1,3)==="!--"){const o=zo(s,"-->",r+4,"Comment is not closed.");if(this.options.commentPropName){const a=s.substring(r+4,o-2);i=this.saveTextToParentTag(i,e,n),e.add(this.options.commentPropName,[{[this.options.textNodeName]:a}])}r=o}else if(s.substr(r+1,2)==="!D"){const o=P3(s,r);this.docTypeEntities=o.entities,r=o.i}else if(s.substr(r+1,2)==="!["){const o=zo(s,"]]>",r,"CDATA is not closed.")-2,a=s.substring(r+9,o);i=this.saveTextToParentTag(i,e,n);let l=this.parseTextData(a,e.tagname,n,!0,!1,!0,!0);l==null&&(l=""),this.options.cdataPropName?e.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]):e.add(this.options.textNodeName,l),r=o+2}else{let o=Eg(s,r,this.options.removeNSPrefix),a=o.tagName;const l=o.rawTagName;let h=o.tagExp,c=o.attrExpPresent,u=o.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),e&&i&&e.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,e,n,!1));const p=e;if(p&&this.options.unpairedTags.indexOf(p.tagname)!==-1&&(e=this.tagsNodeStack.pop(),n=n.substring(0,n.lastIndexOf("."))),a!==t.tagname&&(n+=n?"."+a:a),this.isItStopNode(this.options.stopNodes,n,a)){let d="";if(h.length>0&&h.lastIndexOf("/")===h.length-1)a[a.length-1]==="/"?(a=a.substr(0,a.length-1),n=n.substr(0,n.length-1),h=a):h=h.substr(0,h.length-1),r=o.closeIndex;else if(this.options.unpairedTags.indexOf(a)!==-1)r=o.closeIndex;else{const m=this.readStopNodeData(s,l,u+1);if(!m)throw new Error(`Unexpected end of ${l}`);r=m.i,d=m.tagContent}const _=new Xl(a);a!==h&&c&&(_[":@"]=this.buildAttributesMap(h,n,a)),d&&(d=this.parseTextData(d,a,n,!0,c,!0,!0)),n=n.substr(0,n.lastIndexOf(".")),_.add(this.options.textNodeName,d),this.addChild(e,_,n)}else{if(h.length>0&&h.lastIndexOf("/")===h.length-1){a[a.length-1]==="/"?(a=a.substr(0,a.length-1),n=n.substr(0,n.length-1),h=a):h=h.substr(0,h.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));const d=new Xl(a);a!==h&&c&&(d[":@"]=this.buildAttributesMap(h,n,a)),this.addChild(e,d,n),n=n.substr(0,n.lastIndexOf("."))}else{const d=new Xl(a);this.tagsNodeStack.push(e),a!==h&&c&&(d[":@"]=this.buildAttributesMap(h,n,a)),this.addChild(e,d,n),e=d}i="",r=u}}else i+=s[r];return t.child};function U3(s,t,e){const i=this.options.updateTag(t.tagname,e,t[":@"]);i===!1||(typeof i=="string"&&(t.tagname=i),s.addChild(t))}const B3=function(s){if(this.options.processEntities){for(let t in this.docTypeEntities){const e=this.docTypeEntities[t];s=s.replace(e.regx,e.val)}for(let t in this.lastEntities){const e=this.lastEntities[t];s=s.replace(e.regex,e.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const e=this.htmlEntities[t];s=s.replace(e.regex,e.val)}s=s.replace(this.ampEntity.regex,this.ampEntity.val)}return s};function V3(s,t,e,i){return s&&(i===void 0&&(i=Object.keys(t.child).length===0),s=this.parseTextData(s,t.tagname,e,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,i),s!==void 0&&s!==""&&t.add(this.options.textNodeName,s),s=""),s}function $3(s,t,e){const i="*."+e;for(const n in s){const r=s[n];if(i===r||t===r)return!0}return!1}function H3(s,t,e=">"){let i,n="";for(let r=t;r<s.length;r++){let o=s[r];if(i)o===i&&(i="");else if(o==='"'||o==="'")i=o;else if(o===e[0])if(e[1]){if(s[r+1]===e[1])return{data:n,index:r}}else return{data:n,index:r};else o==="	"&&(o=" ");n+=o}}function zo(s,t,e,i){const n=s.indexOf(t,e);if(n===-1)throw new Error(i);return n+t.length-1}function Eg(s,t,e,i=">"){const n=H3(s,t+1,i);if(!n)return;let r=n.data;const o=n.index,a=r.search(/\s/);let l=r,h=!0;a!==-1&&(l=r.substring(0,a),r=r.substring(a+1).trimStart());const c=l;if(e){const u=l.indexOf(":");u!==-1&&(l=l.substr(u+1),h=l!==n.data.substr(u+1))}return{tagName:l,tagExp:r,closeIndex:o,attrExpPresent:h,rawTagName:c}}function j3(s,t,e){const i=e;let n=1;for(;e<s.length;e++)if(s[e]==="<")if(s[e+1]==="/"){const r=zo(s,">",e,`${t} is not closed`);if(s.substring(e+2,r).trim()===t&&(n--,n===0))return{tagContent:s.substring(i,e),i:r};e=r}else if(s[e+1]==="?")e=zo(s,"?>",e+1,"StopNode is not closed.");else if(s.substr(e+1,3)==="!--")e=zo(s,"-->",e+3,"StopNode is not closed.");else if(s.substr(e+1,2)==="![")e=zo(s,"]]>",e,"StopNode is not closed.")-2;else{const r=Eg(s,e,">");r&&((r&&r.tagName)===t&&r.tagExp[r.tagExp.length-1]!=="/"&&n++,e=r.closeIndex)}}function Cg(s,t,e){if(t&&typeof s=="string"){const i=s.trim();return i==="true"?!0:i==="false"?!1:F3(s,e)}else return P1.isExist(s)?s:""}var Y3=R3,F1={};function W3(s,t){return R1(s,t)}function R1(s,t,e){let i;const n={};for(let r=0;r<s.length;r++){const o=s[r],a=G3(o);let l="";if(e===void 0?l=a:l=e+"."+a,a===t.textNodeName)i===void 0?i=o[a]:i+=""+o[a];else{if(a===void 0)continue;if(o[a]){let h=R1(o[a],t,l);const c=Z3(h,t);o[":@"]?q3(h,o[":@"],l,t):Object.keys(h).length===1&&h[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?h=h[t.textNodeName]:Object.keys(h).length===0&&(t.alwaysCreateTextNode?h[t.textNodeName]="":h=""),n[a]!==void 0&&n.hasOwnProperty(a)?(Array.isArray(n[a])||(n[a]=[n[a]]),n[a].push(h)):t.isArray(a,l,c)?n[a]=[h]:n[a]=h}}}return typeof i=="string"?i.length>0&&(n[t.textNodeName]=i):i!==void 0&&(n[t.textNodeName]=i),n}function G3(s){const t=Object.keys(s);for(let e=0;e<t.length;e++){const i=t[e];if(i!==":@")return i}}function q3(s,t,e,i){if(t){const n=Object.keys(t),r=n.length;for(let o=0;o<r;o++){const a=n[o];i.isArray(a,e+"."+a,!0,!0)?s[a]=[t[a]]:s[a]=t[a]}}}function Z3(s,t){const{textNodeName:e}=t,i=Object.keys(s).length;return!!(i===0||i===1&&(s[e]||typeof s[e]=="boolean"||s[e]===0))}F1.prettify=W3;const{buildOptions:X3}=k_,Q3=Y3,{prettify:K3}=F1,J3=S1;let tF=class{constructor(s){this.externalEntities={},this.options=X3(s)}parse(s,t){if(typeof s!="string")if(s.toString)s=s.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(t){t===!0&&(t={});const n=J3.validate(s,t);if(n!==!0)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const e=new Q3(this.options);e.addExternalEntities(this.externalEntities);const i=e.parseXml(s);return this.options.preserveOrder||i===void 0?i:K3(i,this.options)}addEntity(s,t){if(t.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(s.indexOf("&")!==-1||s.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(t==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[s]=t}};var eF=tF;const sF=`
`;function iF(s,t){let e="";return t.format&&t.indentBy.length>0&&(e=sF),L1(s,t,"",e)}function L1(s,t,e,i){let n="",r=!1;for(let o=0;o<s.length;o++){const a=s[o],l=nF(a);if(l===void 0)continue;let h="";if(e.length===0?h=l:h=`${e}.${l}`,l===t.textNodeName){let _=a[l];rF(h,t)||(_=t.tagValueProcessor(l,_),_=N1(_,t)),r&&(n+=i),n+=_,r=!1;continue}else if(l===t.cdataPropName){r&&(n+=i),n+=`<![CDATA[${a[l][0][t.textNodeName]}]]>`,r=!1;continue}else if(l===t.commentPropName){n+=i+`<!--${a[l][0][t.textNodeName]}-->`,r=!0;continue}else if(l[0]==="?"){const _=_0(a[":@"],t),m=l==="?xml"?"":i;let g=a[l][0][t.textNodeName];g=g.length!==0?" "+g:"",n+=m+`<${l}${g}${_}?>`,r=!0;continue}let c=i;c!==""&&(c+=t.indentBy);const u=_0(a[":@"],t),p=i+`<${l}${u}`,d=L1(a[l],t,h,c);t.unpairedTags.indexOf(l)!==-1?t.suppressUnpairedNode?n+=p+">":n+=p+"/>":(!d||d.length===0)&&t.suppressEmptyNode?n+=p+"/>":d&&d.endsWith(">")?n+=p+`>${d}${i}</${l}>`:(n+=p+">",d&&i!==""&&(d.includes("/>")||d.includes("</"))?n+=i+t.indentBy+d+i:n+=d,n+=`</${l}>`),r=!0}return n}function nF(s){const t=Object.keys(s);for(let e=0;e<t.length;e++){const i=t[e];if(s.hasOwnProperty(i)&&i!==":@")return i}}function _0(s,t){let e="";if(s&&!t.ignoreAttributes)for(let i in s){if(!s.hasOwnProperty(i))continue;let n=t.attributeValueProcessor(i,s[i]);n=N1(n,t),n===!0&&t.suppressBooleanAttributes?e+=` ${i.substr(t.attributeNamePrefix.length)}`:e+=` ${i.substr(t.attributeNamePrefix.length)}="${n}"`}return e}function rF(s,t){s=s.substr(0,s.length-t.textNodeName.length-1);let e=s.substr(s.lastIndexOf(".")+1);for(let i in t.stopNodes)if(t.stopNodes[i]===s||t.stopNodes[i]==="*."+e)return!0;return!1}function N1(s,t){if(s&&s.length>0&&t.processEntities)for(let e=0;e<t.entities.length;e++){const i=t.entities[e];s=s.replace(i.regex,i.val)}return s}var oF=iF;const aF=oF,lF={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(s,t){return t},attributeValueProcessor:function(s,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function ao(s){this.options=Object.assign({},lF,s),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=uF),this.processTextOrObjNode=hF,this.options.format?(this.indentate=cF,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}ao.prototype.build=function(s){return this.options.preserveOrder?aF(s,this.options):(Array.isArray(s)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(s={[this.options.arrayNodeName]:s}),this.j2x(s,0).val)};ao.prototype.j2x=function(s,t){let e="",i="";for(let n in s)if(Object.prototype.hasOwnProperty.call(s,n))if(typeof s[n]>"u")this.isAttribute(n)&&(i+="");else if(s[n]===null)this.isAttribute(n)?i+="":n[0]==="?"?i+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+n+"/"+this.tagEndChar;else if(s[n]instanceof Date)i+=this.buildTextValNode(s[n],n,"",t);else if(typeof s[n]!="object"){const r=this.isAttribute(n);if(r)e+=this.buildAttrPairStr(r,""+s[n]);else if(n===this.options.textNodeName){let o=this.options.tagValueProcessor(n,""+s[n]);i+=this.replaceEntitiesValue(o)}else i+=this.buildTextValNode(s[n],n,"",t)}else if(Array.isArray(s[n])){const r=s[n].length;let o="",a="";for(let l=0;l<r;l++){const h=s[n][l];if(!(typeof h>"u"))if(h===null)n[0]==="?"?i+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+n+"/"+this.tagEndChar;else if(typeof h=="object")if(this.options.oneListGroup){const c=this.j2x(h,t+1);o+=c.val,this.options.attributesGroupName&&h.hasOwnProperty(this.options.attributesGroupName)&&(a+=c.attrStr)}else o+=this.processTextOrObjNode(h,n,t);else if(this.options.oneListGroup){let c=this.options.tagValueProcessor(n,h);c=this.replaceEntitiesValue(c),o+=c}else o+=this.buildTextValNode(h,n,"",t)}this.options.oneListGroup&&(o=this.buildObjectNode(o,n,a,t)),i+=o}else if(this.options.attributesGroupName&&n===this.options.attributesGroupName){const r=Object.keys(s[n]),o=r.length;for(let a=0;a<o;a++)e+=this.buildAttrPairStr(r[a],""+s[n][r[a]])}else i+=this.processTextOrObjNode(s[n],n,t);return{attrStr:e,val:i}};ao.prototype.buildAttrPairStr=function(s,t){return t=this.options.attributeValueProcessor(s,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&t==="true"?" "+s:" "+s+'="'+t+'"'};function hF(s,t,e){const i=this.j2x(s,e+1);return s[this.options.textNodeName]!==void 0&&Object.keys(s).length===1?this.buildTextValNode(s[this.options.textNodeName],t,i.attrStr,e):this.buildObjectNode(i.val,t,i.attrStr,e)}ao.prototype.buildObjectNode=function(s,t,e,i){if(s==="")return t[0]==="?"?this.indentate(i)+"<"+t+e+"?"+this.tagEndChar:this.indentate(i)+"<"+t+e+this.closeTag(t)+this.tagEndChar;{let n="</"+t+this.tagEndChar,r="";return t[0]==="?"&&(r="?",n=""),(e||e==="")&&s.indexOf("<")===-1?this.indentate(i)+"<"+t+e+r+">"+s+n:this.options.commentPropName!==!1&&t===this.options.commentPropName&&r.length===0?this.indentate(i)+`<!--${s}-->`+this.newLine:this.indentate(i)+"<"+t+e+r+this.tagEndChar+s+this.indentate(i)+n}};ao.prototype.closeTag=function(s){let t="";return this.options.unpairedTags.indexOf(s)!==-1?this.options.suppressUnpairedNode||(t="/"):this.options.suppressEmptyNode?t="/":t=`></${s}`,t};ao.prototype.buildTextValNode=function(s,t,e,i){if(this.options.cdataPropName!==!1&&t===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${s}]]>`+this.newLine;if(this.options.commentPropName!==!1&&t===this.options.commentPropName)return this.indentate(i)+`<!--${s}-->`+this.newLine;if(t[0]==="?")return this.indentate(i)+"<"+t+e+"?"+this.tagEndChar;{let n=this.options.tagValueProcessor(t,s);return n=this.replaceEntitiesValue(n),n===""?this.indentate(i)+"<"+t+e+this.closeTag(t)+this.tagEndChar:this.indentate(i)+"<"+t+e+">"+n+"</"+t+this.tagEndChar}};ao.prototype.replaceEntitiesValue=function(s){if(s&&s.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const e=this.options.entities[t];s=s.replace(e.regex,e.val)}return s};function cF(s){return this.options.indentBy.repeat(s)}function uF(s){return s.startsWith(this.options.attributeNamePrefix)&&s!==this.options.textNodeName?s.substr(this.attrPrefixLen):!1}var dF=ao;const pF=eF,fF=dF;var Hp={XMLParser:pF,XMLBuilder:fF};class jp{}D(jp,"parser",new Hp.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));D(jp,"builder",new Hp.XMLBuilder({attributeNamePrefix:"$",ignoreAttributes:!1,suppressBooleanAttributes:!1}));class is{static join(t){const e={};for(const i of t)for(const n in i)if(!e[n])e[n]=new Set(i[n]);else for(const r of i[n])e[n].add(r);return e}static intersect(t){if(t.length===0)return{};let e=is.clone(t[0]);for(let i=1;i<t.length;i++){const n=t[i],r={};for(const o in e)if(n[o]){const a=new Set;for(const l of e[o])n[o].has(l)&&a.add(l);a.size>0&&(r[o]=a)}e=r}return e}static clone(t){const e={};for(const i in t)e[i]=new Set(t[i]);return e}static remove(t,e,i=!1){i&&(t=is.clone(t));for(const n in e)if(t[n]){for(const r of e[n])t[n].delete(r);t[n].size===0&&delete t[n]}}static add(t,e,i=!1){i&&(t=is.clone(t));for(const n in e)if(!t[n])t[n]=new Set(e[n]);else for(const r of e[n])t[n].add(r)}static append(t,e,...i){let n=t[e];n||(n=new Set,t[e]=n);for(const r of i)n.add(r)}static isEqual(t,e){const i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(const r of i){if(!e[r]||t[r].size!==e[r].size)return!1;for(const o of t[r])if(!e[r].has(o))return!1}return!0}static isEmpty(t){return Object.values(t).reduce((e,i)=>e+i.size,0)===0}static toRaw(t){const e={};for(const i in t)e[i]=Array.from(t[i]);return e}static fromRaw(t){const e={};for(const i in t)e[i]=new Set(t[i]);return e}}class vl extends Map{constructor(t){super(t),D(this,"onItemSet",new Et),D(this,"onItemUpdated",new Et),D(this,"onItemDeleted",new Et),D(this,"onCleared",new Et),D(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}set(t,e){const i=this.has(t);if(!(this.guard??(()=>!0))(t,e))return this;const n=super.set(t,e);return i?(this.onItemUpdated||(this.onItemUpdated=new Et),this.onItemUpdated.trigger({key:t,value:e})):(this.onItemSet||(this.onItemSet=new Et),this.onItemSet.trigger({key:t,value:e})),n}add(t){const e=fi.create();return this.set(e,t),e}delete(t){const e=super.delete(t);return e&&this.onItemDeleted.trigger(t),e}dispose(){this.clear(),this.onItemSet.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}class Hf{static isEntry(t){return new Set(["Boolean","Color","Text","Number","Select","Vector3","TextSet","None"]).has(t.type)}static copySchema(t,e={}){for(const i in t){const n=t[i];this.isEntry(n)?e[i]=this.copyEntry(n):(e[i]={},this.copySchema(n,e[i]))}return e}static copyEntry(t){if(t.type==="Boolean"){const e=t;return{type:e.type,value:e.value}}if(t.type==="Color"){const e=t;return{type:e.type,value:e.value.clone()}}if(t.type==="Text"){const e=t;return{type:e.type,value:e.value}}if(t.type==="Number"){const e=t;return{type:e.type,value:e.value,min:e.min,max:e.max,interpolable:e.interpolable}}if(t.type==="Select"){const e=t;return{type:e.type,value:e.value,multiple:e.multiple,options:new Set(e.options)}}if(t.type==="Vector3"){const e=t;return{type:e.type,value:e.value.clone()}}if(t.type==="TextSet"){const e=t;return{type:e.type,value:new Set(e.value)}}if(t.type==="None"){const e=t;return{type:e.type,value:e.value}}throw new Error("Invalid entry!")}}class Wc{constructor(t,e,i,n){D(this,"_component"),D(this,"name"),D(this,"uuid"),this._component=t,this.name=i,this.uuid=n??fi.create(),e.get(Yp).list.set(this.uuid,this)}get controls(){return Hf.copySchema(this._config)}set(t){for(const e in t)if(e in this){const i=e;this[i]=t[e].value}}export(t=this._config,e={}){for(const i in t){const n=t[i];if(Hf.isEntry(n))if(n.type==="Color"){const{r,g:o,b:a}=n.value;e[i]={...n,value:{r,g:o,b:a}}}else if(n.type==="Vector3"){const{x:r,y:o,z:a}=n.value;e[i]={...n,value:{x:r,y:o,z:a}}}else if(n.type==="TextSet"){const r=Array.from(n.value);e[i]={...n,value:r}}else if(n.type==="Select"){const r=Array.from(n.options);e[i]={...n,options:r}}else e[i]={...n};else e[i]={},this.export(n,e[i])}return e}import(t,e={},i=!0){for(const n in t){const r=t[n];if(Hf.isEntry(r))if(r.type==="Color"){const{r:o,g:a,b:l}=r.value;e[n]={...r,value:new xt(o,a,l)}}else if(r.type==="Vector3"){const{x:o,y:a,z:l}=r.value;e[n]={...r,value:new F(o,a,l)}}else r.type==="TextSet"?e[n]={...r,value:new Set(r.value)}:r.type==="Select"?e[n]={...r,options:new Set(r.options)}:e[n]={...r};else e[n]={},this.import(r,e[n],!1)}i&&this.set(e)}}const M1=class D1 extends Cs{constructor(t){super(t),D(this,"list",new vl),D(this,"enabled",!0),t.add(D1.uuid,this)}};D(M1,"uuid","b8c764e0-6b24-4e77-9a32-35fa728ee5b4");let Yp=M1;class mF{constructor(t){D(this,"_event"),D(this,"_position",new Bt),D(this,"onDisposed",new Et),D(this,"updateMouseInfo",e=>{this._event=e}),this.dom=t,this.setupEvents(!0)}get position(){return this.updatePosition(!1),this._position.clone()}get rawPosition(){return this.updatePosition(!0),this._position.clone()}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}updatePosition(t){if(this._event){const e=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(e,this._event,t),this._position.y=this.getPositionY(e,this._event,t)}}getPositionY(t,e,i){const n=this.getDataObject(e);return i?n.clientY:-((n.clientY-t.top)/(t.bottom-t.top))*2+1}getPositionX(t,e,i){const n=this.getDataObject(e);return i?n.clientX:(n.clientX-t.left)/(t.right-t.left)*2-1}getDataObject(t){return t instanceof MouseEvent?t:t.touches[0]}setupEvents(t){t?(this.dom.addEventListener("pointermove",this.updateMouseInfo),this.dom.addEventListener("touchstart",this.updateMouseInfo)):(this.dom.removeEventListener("pointermove",this.updateMouseInfo),this.dom.removeEventListener("touchstart",this.updateMouseInfo))}}const k1=class z1 extends Cs{constructor(t){super(t),D(this,"onDisposed",new Et),D(this,"onFragmentsLoaded",new Et),D(this,"baseCoordinationModel",""),D(this,"baseCoordinationMatrix",new vt),D(this,"enabled",!0),D(this,"initialized",!1),D(this,"_core"),this.components.add(z1.uuid,this)}get list(){return this.core.models.list}get core(){if(!this._core)throw new Error("FragmentsManager not initialized. Call init() first.");return this._core}dispose(){this._core&&(this.core.dispose(),this._core=void 0),this.baseCoordinationModel="",this.onFragmentsLoaded.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}init(t){this._core=new I1(t),this.initialized=!0,this.core.onModelLoaded.add(async e=>{this.list.size===1&&(this.baseCoordinationModel=e.modelId,this.baseCoordinationMatrix=await e.getCoordinationMatrix())}),this.list.onItemDeleted.add(()=>{this.list.size>0||(this.baseCoordinationModel="",this.baseCoordinationMatrix=new vt)})}async raycast(t){const e=[];for(const r of this.core.models.list.values())if(t.snappingClasses&&t.snappingClasses.length>0){const o=await r.raycastWithSnapping(t);if(o&&o.length>0)e.push(o[0]);else{const a=await r.raycast(t);a&&e.push(a)}}else{const o=await r.raycast(t);o&&e.push(o)}if(await Promise.all(e),e.length===0)return;let i=e[0],n=i.distance;for(let r=1;r<e.length;r++)e[r].distance<n&&(n=e[r].distance,i=e[r]);return i}async getPositions(t){const e=[],i=async(r,o)=>{const a=await r.getPositions(o);for(const l of a)e.push(l)},n=[];for(const r in t){const o=this.core.models.list.get(r);o&&n.push(i(o,Array.from(t[r])))}return await Promise.all(n),e}async getBBoxes(t){const e=[],i=async(r,o)=>{const a=await r.getBoxes(o);if(a)for(const l of a)e.push(l)},n=[];for(const r in t){const o=this.core.models.list.get(r);o&&n.push(i(o,Array.from(t[r])))}return await Promise.all(n),e}async highlight(t,e){await this.forEachModel(e,"highlight",t)}async getData(t,e){const i={};for(const[n,r]of Object.entries(t)){const o=this.list.get(n);if(!o)continue;const a=await o.getItemsData([...r],e);i[n]=a}return i}async resetHighlight(t){await this.forEachModel(t,"resetHighlight")}async forEachModel(t,e,...i){const n={};if(t)for(const o in t){const a=t[o];n[o]=Array.from(a)}else for(const o of this.core.models.list.keys())n[o]=void 0;const r=[];for(const o in n){const a=this.core.models.list.get(o);if(a){const l=n[o],h=a[e](l,...i);r.push(h)}}await Promise.all(r)}async guidsToModelIdMap(t){const e={};for(const[i,n]of this.list){const r=(await n.getLocalIdsByGuids([...t])).filter(o=>o!==null);e[i]=new Set(r)}return e}async modelIdMapToGuids(t){const e=[];for(const[i,n]of Object.entries(t)){const r=this.list.get(i);if(!r)continue;const o=(await r.getGuidsByLocalIds([...n])).filter(a=>a!==null);e.push(...o)}return e}applyBaseCoordinateSystem(t,e){const i=new vt;return e&&i.copy(e.clone()).invert(),i.multiply(this.baseCoordinationMatrix),t.applyMatrix4(i),i}};D(k1,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let Rt=k1;class gF{constructor(){D(this,"wasm",{path:"",absolute:!1,logLevel:Np.LOG_LEVEL_OFF}),D(this,"webIfc",{COORDINATE_TO_ORIGIN:!0}),D(this,"autoSetWasm",!0),D(this,"customLocateFileHandler",null)}}const U1=class Ig extends Cs{constructor(t){super(t),D(this,"onDisposed",new Et),D(this,"onIfcStartedLoading",new Et),D(this,"onSetup",new Et),D(this,"settings",new gF),D(this,"webIfc",new Qo),D(this,"enabled",!0),this.components.add(Ig.uuid,this)}dispose(){this.webIfc=null,this.onDisposed.trigger(Ig.uuid),this.onDisposed.reset()}async setup(t){this.settings={...this.settings,...t},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(t,e,i,n){const r=this.components.get(Rt);if(!r.initialized)throw new Error("You need to initialize fragments first.");this.settings.autoSetWasm&&await this.autoSetWasm(),r.core.settings.autoCoordinate=e;const o=new T1;o.wasm.path=this.settings.wasm.path,o.wasm.absolute=this.settings.wasm.absolute,n!=null&&n.instanceCallback&&n.instanceCallback(o);const a=await o.process({...n==null?void 0:n.processData,bytes:t});return await r.core.load(a,{modelId:i,userData:n==null?void 0:n.userData})}async readIfcFile(t){const{path:e,absolute:i,logLevel:n}=this.settings.wasm;return this.webIfc.SetWasmPath(e,i),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModel(t,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new Qo}async autoSetWasm(){const t=await fetch(`https://unpkg.com/@thatopen/components@${aE.release}/package.json`);if(!t.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const e=await t.json();if(!("web-ifc"in e.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const i=e.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${i}/`,this.settings.wasm.absolute=!0}}};D(U1,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");let _F=U1;const B1=class V1 extends Cs{constructor(t){super(t),D(this,"enabled",!0),this.components.add(V1.uuid,this)}async set(t,e){const i=this.components.get(Rt),n=[];if(e)for(const[r,o]of Object.entries(e)){const a=i.list.get(r);a&&n.push(a.setVisible([...o],t))}else for(const r of i.list.values())n.push(r.setVisible(void 0,t));await Promise.all(n),await i.core.update(!0)}async isolate(t){await Promise.all([this.set(!1),this.set(!0,t)])}async toggle(t){const e=[],i=this.components.get(Rt);for(const[n,r]of Object.entries(t)){const o=i.list.get(n);o&&e.push(o.toggleVisible([...r]))}await Promise.all(e),await i.core.update(!0)}async getVisibilityMap(t,e){const i=[],n=[],r=this.components.get(Rt);if(e)for(const l of e){const h=r.list.get(l);h&&(i.push(h.modelId),n.push(h.getItemsByVisibility(t)))}else for(const l of r.list.values())i.push(l.modelId),n.push(l.getItemsByVisibility(t));const o=await Promise.all(n),a={};for(const[l,h]of i.entries())a[h]=o[l];return a}};D(B1,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");let bF=B1;const $1=class xg extends Cs{constructor(t){super(t),D(this,"enabled",!0),D(this,"onDisposed",new Et),D(this,"list",new ge),this.components.add(xg.uuid,this)}dispose(t=!0){this.list.clear(),this.onDisposed.trigger(xg.uuid),t&&(this.onDisposed.reset(),this.list.eventsEnabled=!1,this.list.dispose())}get(){const t=new Tt;for(const e of this.list)t.union(e);return t}async addFromModelIdMap(t){const e=this.components.get(Rt),i=new Tt;for(const[n,r]of Object.entries(t)){const o=e.list.get(n);if(!o)continue;const a=await o.getMergedBox([...r]);i.union(a)}this.list.add(i)}addFromModels(t){const e=this.components.get(Rt);for(const[i,n]of e.list)t&&!t.some(r=>r.test(i))||this.list.add(n.box)}async getCenter(t){this.list.clear(),await this.addFromModelIdMap(t);const e=this.get();this.list.clear();const i=new F;return e.getCenter(i),i}async getCameraOrientation(t,e=1){const i=this.components.get(Rt);this.list.clear();for(const[h,c]of i.list)this.list.add(c.box);const n=this.get();this.list.clear();const r=new F;n.getCenter(r);const o=new F;n.getSize(o);const a=Math.max(o.x,o.y,o.z)*e,l=new F;switch(t){case"front":l.set(r.x,r.y,r.z+a);break;case"back":l.set(r.x,r.y,r.z-a);break;case"left":l.set(r.x-a,r.y,r.z);break;case"right":l.set(r.x+a,r.y,r.z);break;case"top":l.set(r.x,r.y+a,r.z);break;case"bottom":l.set(r.x,r.y-a,r.z);break;default:l.set(r.x,r.y,r.z+a)}return{position:l,target:r}}};D($1,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");let H1=$1;class yF{constructor(t,e){D(this,"description"),D(this,"_components"),D(this,"_queries",[]),D(this,"_aggregation","exclusive"),D(this,"result",null),D(this,"cache",!0),D(this,"serializeQueryParameters",i=>{var n;return{categories:(n=i.categories)==null?void 0:n.map(r=>r.source),attributes:i.attributes?{aggregation:i.attributes.aggregation,queries:i.attributes.queries.map(this.serializeAttributeQuery)}:void 0,relation:i.relation?{name:i.relation.name,query:i.relation.query?this.serializeQueryParameters(i.relation.query):void 0}:void 0}}),D(this,"deserializeQueryParameters",i=>{var n;return{categories:(n=i.categories)==null?void 0:n.map(r=>new RegExp(r)),attributes:i.attributes?{aggregation:i.attributes.aggregation,queries:i.attributes.queries.map(this.deserializeAttributeQuery)}:void 0,relation:i.relation?{name:i.relation.name,query:i.relation.query?this.deserializeQueryParameters(i.relation.query):void 0}:void 0}}),this._components=t,this.queries=e}set queries(t){this._queries=t,this.clearCache()}get queries(){return this._queries}set aggregation(t){t!==this._aggregation&&this.clearCache(),this._aggregation=t}get aggregation(){return this._aggregation}async test(t){const{modelIds:e,force:i}={force:!1,...t};if(this.result&&!i)return this.result;const n=await this._components.get(Ud).getItems(this.queries,{modelIds:e,aggregation:this.aggregation});return this.cache&&(this.result=n),n}clearCache(){this.result=null}serializeAttributeQuery(t){let e;return Array.isArray(t.value)?e=t.value.map(i=>i.source):t.value instanceof RegExp?e=t.value.source:e=t.value,{name:t.name.source,value:e,type:t.type instanceof RegExp?t.type.source:t.type,negate:t.negate,itemIds:t.itemIds}}toJSON(){return{name:"Finder Query",description:this.description,queries:this.queries.map(this.serializeQueryParameters),aggregation:this.aggregation,cache:this.cache}}deserializeAttributeQuery(t){let e;return Array.isArray(t.value)?e=t.value.map(i=>new RegExp(i)):typeof t.value=="string"?e=new RegExp(t.value):e=t.value,{name:new RegExp(t.name),value:e,type:t.type?new RegExp(t.type):void 0,negate:t.negate,itemIds:t.itemIds}}fromJSON(t){return this.description=t.description,this.aggregation=t.aggregation,this.cache=t.cache,this.queries=t.queries.map(this.deserializeQueryParameters),this}}const j1=class Y1 extends Cs{constructor(t){super(t),D(this,"enabled",!0),D(this,"list",new Wt),t.add(Y1.uuid,this)}async getItems(t,e){const{modelIds:i}=e??{},n=(e==null?void 0:e.aggregation)??"exclusive",r=this.components.get(Rt),o=await Promise.all(t.map(async a=>{const l={};return await Promise.all(Array.from(r.list).map(async([h,c])=>{if(i&&!i.some(p=>p.test(h)))return;const u=await c.getItemsByQuery(a);l[h]=new Set(u)})),l}));return n==="inclusive"?is.join(o):is.intersect(o)}create(t,e){const i=new yF(this.components,e);return this.list.set(t,i),i}async addFromCategories(t){const e=new Set,i=this.components.get(Rt);for(const[n,r]of i.list){if(t&&!t.some(l=>l.test(n)))continue;const o=(await r.getItemsWithGeometryCategories()).filter(l=>l!==null),a=new Set(o);for(const l of a)this.list.has(l)||(this.create(l,[{categories:[new RegExp(`^${l}$`)]}]),e.add(l))}return[...e]}import(t){const{data:e}=t,i=[];if(!e)return i;for(const n of e){const{name:r,description:o,queries:a,aggregation:l,cache:h}=n,c=this.create(r,[]);c.fromJSON({description:o,queries:a,aggregation:l,cache:h}),i.push(c)}return i}export(){const t=[];for(const[e,i]of this.list.entries()){const n={...i.toJSON(),name:e};t.push(n)}return{data:t}}};D(j1,"uuid","0da7ad77-f734-42ca-942f-a074adfd1e3a");let Ud=j1;const vF=class W1 extends Cs{constructor(t){super(t),D(this,"enabled",!0),D(this,"onDisposed",new Et),D(this,"list",new Wt),D(this,"defaultSaveFunction",e=>"value"in e.Name?e.Name.value:null),D(this,"onBeforeFragmentsDispose",async e=>{const{key:i,value:n}=e,r=await n.getLocalIds(),o={[i]:new Set(r)};this.removeItems(o)}),t.add(W1.uuid,this),this.setupEvents(),t.get(Rt).list.onBeforeDelete.add(this.onBeforeFragmentsDispose)}setupEvents(){this.list.onBeforeDelete.add(({value:t})=>t.dispose())}getClassificationGroups(t){let e=this.list.get(t);return e||(e=new Wt,this.list.set(t,e)),e}getModelItems(t,e,i){const{map:n}=this.getGroupData(t,e);let r=n[i];return r||(r=new Set,n[i]=r),r}getGroupData(t,e){const i=this.components.get(Ud),n=this.getClassificationGroups(t);let r=n.get(e);return r||(r={map:{},get(){return new Promise(o=>{if(!r){o({});return}if(r.query){const{name:a,config:l}=r.query,h=i.list.get(a);if(!h)throw new Error("Classifier: the query name associated with the group doesn't exist in the ItemsFinder component");h.test(l).then(c=>{if(!r){o({});return}const u=is.join([c,r.map]);o(u)})}else o(r.map)})}},n.set(e,r)),r}async aggregateItems(t,e,i){const n=(i==null?void 0:i.data)??void 0,r=(i==null?void 0:i.aggregationCallback)??this.defaultSaveFunction,o=this.components.get(Rt),a=await this.components.get(Ud).getItems([e],{modelIds:i==null?void 0:i.modelIds});for(const[l,h]of Object.entries(a)){const c=o.list.get(l);if(!c)continue;const u=(d,..._)=>{const m=this.getModelItems(t,d,l);for(const g of _)m.add(g)},p=await c.getItemsData([...h],n);for(const d of p)r(d,u)}}addGroupItems(t,e,i){const{map:n}=this.getGroupData(t,e);is.add(n,i)}setGroupQuery(t,e,i){const n=this.getGroupData(t,e);n.query=i}async find(t){const e=[];for(const[i,n]of Object.entries(t)){const r=[],o=this.list.get(i);if(!o)continue;for(const l of n){const h=o.get(l);if(!h)continue;const c=await h.get();r.push(c)}const a=is.join(r);e.push(a)}return is.intersect(e)}async aggregateItemRelations(t,e,i,n){const r=(n==null?void 0:n.attribute)??"Name",o={relations:{[i]:{attributes:!0,relations:!1}}};await this.aggregateItems(t,e,{modelIds:n==null?void 0:n.modelIds,data:o,aggregationCallback:(a,l)=>{if(!(a!=null&&a[r]))return;const h=a[r];if(!("value"in h))return;const c=a[i];if(Array.isArray(c))for(const u of c)"value"in u._localId&&l(h.value,u._localId.value)}})}async byIfcBuildingStorey(t){await this.aggregateItemRelations((t==null?void 0:t.classificationName)??"Storeys",{categories:[/BUILDINGSTOREY/]},"ContainsElements",{modelIds:t==null?void 0:t.modelIds})}async byCategory(t){const e=await this.components.get(Ud).addFromCategories(t==null?void 0:t.modelIds);for(const i of e)this.setGroupQuery((t==null?void 0:t.classificationName)??"Categories",i,{name:i})}dispose(){this.list.clear(),this.components.get(Rt).list.onBeforeDelete.remove(this.onBeforeFragmentsDispose),this.onDisposed.trigger()}removeItems(t,e){if(e&&e.classificationName){const i=this.list.get(e.classificationName);if(!i||e.groupName&&!i.get(e.groupName))return;for(const[,n]of i)is.remove(n.map,t);return}for(const[,i]of this.list.entries())for(const[,n]of i)is.remove(n.map,t)}async byModel(t){const e=this.components.get(Rt),i=(t==null?void 0:t.classificationName)??"Models";for(const[n,r]of e.list){if(t&&t.modelIds&&!t.modelIds.some(l=>l.test(n)))continue;const o=await r.getItemsIdsWithGeometry(),a={[n]:new Set(o)};this.getGroupData(i,n),this.addGroupItems(i,n,a)}}};D(vF,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");class wF{constructor(t,e){D(this,"enabled",!0),D(this,"components"),D(this,"onDisposed",new Et),D(this,"mouse"),D(this,"three",new oa),D(this,"world");const i=e.renderer;if(!i)throw new Error("A renderer is needed for the raycaster to work!");this.world=e,this.mouse=new mF(i.three.domElement),this.components=t}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRayToObjects(t=Array.from(this.world.meshes),e=this.mouse.position){if(!this.world)throw new Error("A world is needed to cast rays!");const i=this.world.camera.three;return this.three.setFromCamera(e,i),this.intersect(t)}async castRay(t){const e=t==null?void 0:t.snappingClasses,i=(t==null?void 0:t.items)??Array.from(this.world.meshes),n=(t==null?void 0:t.position)??this.mouse.position;if(!this.world)throw new Error("A world is needed to cast rays!");const r=this.world.camera.three,o=this.components.get(Rt),a=this.world.renderer.three.domElement,l=this.mouse.rawPosition;let h=null;if(o.initialized&&(h=await o.raycast({camera:r,dom:a,mouse:l,snappingClasses:e}),i.length===0))return h;this.three.setFromCamera(n,r);const c=this.intersect(i);return h?c&&c.distance<h.distance?c:h:c}intersect(t=Array.from(this.world.meshes)){const e=this.three.intersectObjects(t),i=this.filterClippingPlanes(e);return i.length>0?i[0]:null}filterClippingPlanes(t){if(!this.world.renderer)throw new Error("Renderer not found!");const e=this.world.renderer.three;if(!e.clippingPlanes)return t;const i=e.clippingPlanes;return t.length<=0||!i||(i==null?void 0:i.length)<=0?t:t.filter(n=>i.every(r=>r.distanceToPoint(n.point)>0))}}const G1=class q1 extends Cs{constructor(t){super(t),D(this,"enabled",!0),D(this,"list",new Map),D(this,"onDisposed",new Et),t.add(q1.uuid,this)}get(t){if(this.list.has(t.uuid))return this.list.get(t.uuid);const e=new wF(this.components,t);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}};D(G1,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let Tg=G1;class EF extends L_{constructor(){super(...arguments),D(this,"onCameraChanged",new Et),D(this,"meshes",new Set),D(this,"onAfterUpdate",new Et),D(this,"onBeforeUpdate",new Et),D(this,"onDisposed",new Et),D(this,"isDisposing",!1),D(this,"enabled",!0),D(this,"_dynamicAnchor",!1),D(this,"uuid",fi.create()),D(this,"name"),D(this,"_scene"),D(this,"_camera"),D(this,"_renderer",null),D(this,"onPointerDown",async t=>{if(!this.camera.hasCameraControls())throw new Error("World: can't set dynamic anchor if the camera doesn't have controls.");const e=await this.components.get(Tg).get(this).castRay();e&&e.point&&t.button===0&&this.camera.controls.setOrbitPoint(e.point.x,e.point.y,e.point.z)}),D(this,"_defaultCamera")}set dynamicAnchor(t){var e;const i=(e=this.renderer)==null?void 0:e.three.domElement.parentElement;if(!i)throw new Error("World: the renderer must have a parentElement to set dynamic anchoring.");t?(this.camera.controls&&(this.camera.controls.minDistance=.01),i.addEventListener("pointerdown",this.onPointerDown)):i.removeEventListener("pointerdown",this.onPointerDown)}get dynamicAnchor(){return this._dynamicAnchor}get defaultCamera(){if(!this._defaultCamera)throw new Error("World: there is no default camera defined.");return this._defaultCamera}set defaultCamera(t){this._defaultCamera=t}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(t){this._scene=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(t){this._camera||(this.defaultCamera=t),this._camera=t,t.currentWorld=this,this.onCameraChanged.trigger(t)}get renderer(){return this._renderer}set renderer(t){this._renderer=t,t&&(t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"}))}useDefaultCamera(){this.camera=this.defaultCamera}update(t){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(t),this.camera.isUpdateable()&&this.camera.update(t),this.renderer&&this.renderer.update(t),this.onAfterUpdate.trigger()))}dispose(t=!0){if(this.enabled=!1,this.isDisposing=!0,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),t){const e=this.components.get(Vp);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const i of this.meshes)e.destroy(i);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.components.get(Gc).list.delete(this.uuid),this.onDisposed.trigger(),this.onDisposed.reset()}}class CF{constructor(t,e){D(this,"_list"),D(this,"_scene"),this._list=t,this._scene=e}get color(){return this._list.directionalLight.color.value}set color(t){this._list.directionalLight.color.value=t;for(const[,e]of this._scene.directionalLights)e.color.copy(t)}get intensity(){return this._list.directionalLight.intensity.value}set intensity(t){this._list.directionalLight.intensity.value=t;for(const[,e]of this._scene.directionalLights)e.intensity=t}get position(){return this._list.directionalLight.position.value.clone()}set position(t){this._list.directionalLight.position.value=t;for(const[,e]of this._scene.directionalLights)e.position.copy(t)}}class IF{constructor(t,e){D(this,"_list"),D(this,"_scene"),this._list=t,this._scene=e}get color(){return this._list.ambientLight.color.value}set color(t){this._list.ambientLight.color.value=t;for(const[,e]of this._scene.ambientLights)e.color.copy(t)}get intensity(){return this._list.ambientLight.intensity.value}set intensity(t){this._list.ambientLight.intensity.value=t;for(const[,e]of this._scene.ambientLights)e.intensity=t}}class xF extends Wc{constructor(){super(...arguments),D(this,"_config",{backgroundColor:{value:new xt,type:"Color"},ambientLight:{color:{type:"Color",value:new xt},intensity:{type:"Number",interpolable:!0,min:0,max:10,value:2}},directionalLight:{color:{type:"Color",value:new xt},intensity:{type:"Number",interpolable:!0,min:0,max:10,value:2},position:{type:"Vector3",value:new F}}}),D(this,"ambientLight",new IF(this._config,this._component)),D(this,"directionalLight",new CF(this._config,this._component))}get backgroundColor(){return this._config.backgroundColor.value}set backgroundColor(t){this._config.backgroundColor.value=t,this._component.three.background=t}}class Z1 extends JP{constructor(t){super(t),D(this,"onSetup",new Et),D(this,"isSetup",!1),D(this,"three"),D(this,"config",new xF(this,this.components,"Scene")),D(this,"_defaultConfig",{backgroundColor:new xt(2107698),directionalLight:{color:new xt("white"),intensity:1.5,position:new F(5,10,3)},ambientLight:{color:new xt("white"),intensity:1}}),this.three=new _w,this.three.background=new xt(2107698)}setup(t){const e={...this._defaultConfig,...t};this.config.backgroundColor=e.backgroundColor;const i=e.ambientLight;this.config.ambientLight.color=i.color,this.config.ambientLight.intensity=i.intensity;const n=e.directionalLight;this.config.directionalLight.color=n.color,this.config.directionalLight.intensity=n.intensity,this.config.directionalLight.position=n.position,this.deleteAllLights();const{color:r,intensity:o}=this.config.directionalLight,a=new Yx(r,o);a.position.copy(n.position);const{color:l,intensity:h}=this.config.directionalLight,c=new Wx(l,h);this.three.add(a,c),this.directionalLights.set(a.uuid,a),this.ambientLights.set(c.uuid,c),this.isSetup=!0,this.onSetup.trigger()}dispose(){super.dispose(),this.components.get(Yp).list.delete(this.config.uuid)}}class TF extends KP{constructor(t,e,i){super(t),D(this,"enabled",!0),D(this,"container"),D(this,"three"),D(this,"_canvas"),D(this,"_parameters"),D(this,"_resizeObserver",null),D(this,"onContainerUpdated",new Et),D(this,"_resizing",!1),D(this,"resize",o=>{if(this._resizing)return;this._resizing=!0,this.onContainerUpdated.trigger();const a=o?o.x:this.container.clientWidth,l=o?o.y:this.container.clientHeight;this.three.setSize(a,l),this.onResize.trigger(new Bt(a,l)),this._resizing=!1}),D(this,"resizeEvent",()=>{this.resize()}),D(this,"onContextLost",o=>{o.preventDefault(),this.enabled=!1}),D(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new tp({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0}),this.container=e,this._parameters=i,this.three=new tp({antialias:!0,alpha:!0,...i}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const n=this.three.getContext(),{canvas:r}=n;r.addEventListener("webglcontextlost",this.onContextLost,!1),r.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const t=this.currentWorld.scene.three,e=this.currentWorld.camera.three;this.three.render(t,e),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.forceContextLoss(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new Bt(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(t){const e=this.three.domElement.parentElement;if(!e)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),t&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(e),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Te={LEFT:1,RIGHT:2,MIDDLE:4},rt=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),pa={NONE:0,IN:1,OUT:-1};function mo(s){return s.isPerspectiveCamera}function Sr(s){return s.isOrthographicCamera}const fa=Math.PI*2,b0=Math.PI/2,X1=1e-5,Ql=Math.PI/180;function Zi(s,t,e){return Math.max(t,Math.min(e,s))}function ue(s,t=X1){return Math.abs(s)<t}function te(s,t,e=X1){return ue(s-t,e)}function y0(s,t){return Math.round(s/t)*t}function Kl(s){return isFinite(s)?s:s<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Jl(s){return Math.abs(s)<Number.MAX_VALUE?s:s*(1/0)}function Tu(s,t,e,i,n=1/0,r){i=Math.max(1e-4,i);const o=2/i,a=o*r,l=1/(1+a+.48*a*a+.235*a*a*a);let h=s-t;const c=t,u=n*i;h=Zi(h,-u,u),t=s-h;const p=(e.value+o*h)*r;e.value=(e.value-o*p)*l;let d=t+(h+p)*l;return c-s>0==d>c&&(d=c,e.value=(d-c)/r),d}function v0(s,t,e,i,n=1/0,r,o){i=Math.max(1e-4,i);const a=2/i,l=a*r,h=1/(1+l+.48*l*l+.235*l*l*l);let c=t.x,u=t.y,p=t.z,d=s.x-c,_=s.y-u,m=s.z-p;const g=c,f=u,b=p,y=n*i,E=y*y,C=d*d+_*_+m*m;if(C>E){const M=Math.sqrt(C);d=d/M*y,_=_/M*y,m=m/M*y}c=s.x-d,u=s.y-_,p=s.z-m;const I=(e.x+a*d)*r,x=(e.y+a*_)*r,A=(e.z+a*m)*r;e.x=(e.x-a*I)*h,e.y=(e.y-a*x)*h,e.z=(e.z-a*A)*h,o.x=c+(d+I)*h,o.y=u+(_+x)*h,o.z=p+(m+A)*h;const O=g-s.x,L=f-s.y,V=b-s.z,T=o.x-g,N=o.y-f,v=o.z-b;return O*T+L*N+V*v>0&&(o.x=g,o.y=f,o.z=b,e.x=(o.x-g)/r,e.y=(o.y-f)/r,e.z=(o.z-b)/r),o}function jf(s,t){t.set(0,0),s.forEach(e=>{t.x+=e.clientX,t.y+=e.clientY}),t.x/=s.length,t.y/=s.length}function Yf(s,t){return Sr(s)?(console.warn(`${t} is not supported in OrthographicCamera`),!0):!1}class AF{constructor(){this._listeners={}}addEventListener(t,e){const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){const i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){const i=this._listeners[t];if(i!==void 0){const n=i.indexOf(e);n!==-1&&i.splice(n,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){const e=this._listeners[t.type];if(e!==void 0){t.target=this;const i=e.slice(0);for(let n=0,r=i.length;n<r;n++)i[n].call(this,t)}}}var Wf;const SF="2.10.1",Au=1/8,OF=/Mac/.test((Wf=globalThis==null?void 0:globalThis.navigator)===null||Wf===void 0?void 0:Wf.platform);let Pt,w0,Su,Gf,Hs,zt,Zt,ma,th,bn,yn,go,E0,C0,Ei,eh,ga,I0,qf,x0,Zf,Xf,Ou;class As extends AF{static install(t){Pt=t.THREE,w0=Object.freeze(new Pt.Vector3(0,0,0)),Su=Object.freeze(new Pt.Vector3(0,1,0)),Gf=Object.freeze(new Pt.Vector3(0,0,1)),Hs=new Pt.Vector2,zt=new Pt.Vector3,Zt=new Pt.Vector3,ma=new Pt.Vector3,th=new Pt.Vector3,bn=new Pt.Vector3,yn=new Pt.Vector3,go=new Pt.Vector3,E0=new Pt.Vector3,C0=new Pt.Vector3,Ei=new Pt.Spherical,eh=new Pt.Spherical,ga=new Pt.Box3,I0=new Pt.Box3,qf=new Pt.Sphere,x0=new Pt.Quaternion,Zf=new Pt.Quaternion,Xf=new Pt.Matrix4,Ou=new Pt.Raycaster}static get ACTION(){return rt}set verticalDragToForward(t){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(t,e){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=rt.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=pa.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new Pt.Vector3,this._focalOffsetVelocity=new Pt.Vector3,this._zoomVelocity={value:0},this._truckInternal=(f,b,y,E)=>{let C,I;if(mo(this._camera)){const x=zt.copy(this._camera.position).sub(this._target),A=this._camera.getEffectiveFOV()*Ql,O=x.length()*Math.tan(A*.5);C=this.truckSpeed*f*O/this._elementRect.height,I=this.truckSpeed*b*O/this._elementRect.height}else if(Sr(this._camera)){const x=this._camera;C=this.truckSpeed*f*(x.right-x.left)/x.zoom/this._elementRect.width,I=this.truckSpeed*b*(x.top-x.bottom)/x.zoom/this._elementRect.height}else return;E?(y?this.setFocalOffset(this._focalOffsetEnd.x+C,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(C,0,!0),this.forward(-I,!0)):y?this.setFocalOffset(this._focalOffsetEnd.x+C,this._focalOffsetEnd.y+I,this._focalOffsetEnd.z,!0):this.truck(C,I,!0)},this._rotateInternal=(f,b)=>{const y=fa*this.azimuthRotateSpeed*f/this._elementRect.height,E=fa*this.polarRotateSpeed*b/this._elementRect.height;this.rotate(y,E,!0)},this._dollyInternal=(f,b,y)=>{const E=Math.pow(.95,-f*this.dollySpeed),C=this._sphericalEnd.radius,I=this._sphericalEnd.radius*E,x=Zi(I,this.minDistance,this.maxDistance),A=x-I;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(I,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(A,!0),this._dollyToNoClamp(x,!0)):this._dollyToNoClamp(x,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?I:x)-C,this._dollyControlCoord.set(b,y)),this._lastDollyDirection=Math.sign(-f)},this._zoomInternal=(f,b,y)=>{const E=Math.pow(.95,f*this.dollySpeed),C=this._zoom,I=this._zoom*E;this.zoomTo(I,!0),this.dollyToCursor&&(this._changedZoom+=I-C,this._dollyControlCoord.set(b,y))},typeof Pt>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new Pt.Quaternion().setFromUnitVectors(this._camera.up,Su),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=rt.NONE,this._target=new Pt.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new Pt.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new Pt.Spherical().setFromVector3(zt.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new Pt.Vector3,new Pt.Vector3,new Pt.Vector3,new Pt.Vector3],this._updateNearPlaneCorners(),this._boundary=new Pt.Box3(new Pt.Vector3(-1/0,-1/0,-1/0),new Pt.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new Pt.Vector2,this.mouseButtons={left:rt.ROTATE,middle:rt.DOLLY,right:rt.TRUCK,wheel:mo(this._camera)?rt.DOLLY:Sr(this._camera)?rt.ZOOM:rt.NONE},this.touches={one:rt.TOUCH_ROTATE,two:mo(this._camera)?rt.TOUCH_DOLLY_TRUCK:Sr(this._camera)?rt.TOUCH_ZOOM_TRUCK:rt.NONE,three:rt.TOUCH_TRUCK};const i=new Pt.Vector2,n=new Pt.Vector2,r=new Pt.Vector2,o=f=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const E=this._domElement.getBoundingClientRect(),C=f.clientX/E.width,I=f.clientY/E.height;if(C<this._interactiveArea.left||C>this._interactiveArea.right||I<this._interactiveArea.top||I>this._interactiveArea.bottom)return}const b=f.pointerType!=="mouse"?null:(f.buttons&Te.LEFT)===Te.LEFT?Te.LEFT:(f.buttons&Te.MIDDLE)===Te.MIDDLE?Te.MIDDLE:(f.buttons&Te.RIGHT)===Te.RIGHT?Te.RIGHT:null;if(b!==null){const E=this._findPointerByMouseButton(b);E&&this._disposePointer(E)}if((f.buttons&Te.LEFT)===Te.LEFT&&this._lockedPointer)return;const y={pointerId:f.pointerId,clientX:f.clientX,clientY:f.clientY,deltaX:0,deltaY:0,mouseButton:b};this._activePointers.push(y),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,p(f)},a=f=>{f.cancelable&&f.preventDefault();const b=f.pointerId,y=this._lockedPointer||this._findPointerById(b);if(y){if(y.clientX=f.clientX,y.clientY=f.clientY,y.deltaX=f.movementX,y.deltaY=f.movementY,this._state=0,f.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(f.buttons&Te.LEFT)===Te.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(f.buttons&Te.MIDDLE)===Te.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(f.buttons&Te.RIGHT)===Te.RIGHT&&(this._state=this._state|this.mouseButtons.right);d()}},l=f=>{const b=this._findPointerById(f.pointerId);if(!(b&&b===this._lockedPointer)){if(b&&this._disposePointer(b),f.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=rt.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=rt.NONE;_()}};let h=-1;const c=f=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===rt.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const I=this._domElement.getBoundingClientRect(),x=f.clientX/I.width,A=f.clientY/I.height;if(x<this._interactiveArea.left||x>this._interactiveArea.right||A<this._interactiveArea.top||A>this._interactiveArea.bottom)return}if(f.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===rt.ROTATE||this.mouseButtons.wheel===rt.TRUCK){const I=performance.now();h-I<1e3&&this._getClientRect(this._elementRect),h=I}const b=OF?-1:-3,y=f.deltaMode===1||f.ctrlKey?f.deltaY/b:f.deltaY/(b*10),E=this.dollyToCursor?(f.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,C=this.dollyToCursor?(f.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case rt.ROTATE:{this._rotateInternal(f.deltaX,f.deltaY),this._isUserControllingRotate=!0;break}case rt.TRUCK:{this._truckInternal(f.deltaX,f.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case rt.SCREEN_PAN:{this._truckInternal(f.deltaX,f.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case rt.OFFSET:{this._truckInternal(f.deltaX,f.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case rt.DOLLY:{this._dollyInternal(-y,E,C),this._isUserControllingDolly=!0;break}case rt.ZOOM:{this._zoomInternal(-y,E,C),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},u=f=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===As.ACTION.NONE){const b=f instanceof PointerEvent?f.pointerId:0,y=this._findPointerById(b);y&&this._disposePointer(y),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l);return}f.preventDefault()}},p=f=>{if(this._enabled){if(jf(this._activePointers,Hs),this._getClientRect(this._elementRect),i.copy(Hs),n.copy(Hs),this._activePointers.length>=2){const b=Hs.x-this._activePointers[1].clientX,y=Hs.y-this._activePointers[1].clientY,E=Math.sqrt(b*b+y*y);r.set(0,E);const C=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,I=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;n.set(C,I)}if(this._state=0,!f)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in f&&f.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(f.buttons&Te.LEFT)===Te.LEFT&&(this._state=this._state|this.mouseButtons.left),(f.buttons&Te.MIDDLE)===Te.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(f.buttons&Te.RIGHT)===Te.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&rt.ROTATE)===rt.ROTATE||(this._state&rt.TOUCH_ROTATE)===rt.TOUCH_ROTATE||(this._state&rt.TOUCH_DOLLY_ROTATE)===rt.TOUCH_DOLLY_ROTATE||(this._state&rt.TOUCH_ZOOM_ROTATE)===rt.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&rt.TRUCK)===rt.TRUCK||(this._state&rt.SCREEN_PAN)===rt.SCREEN_PAN||(this._state&rt.TOUCH_TRUCK)===rt.TOUCH_TRUCK||(this._state&rt.TOUCH_SCREEN_PAN)===rt.TOUCH_SCREEN_PAN||(this._state&rt.TOUCH_DOLLY_TRUCK)===rt.TOUCH_DOLLY_TRUCK||(this._state&rt.TOUCH_DOLLY_SCREEN_PAN)===rt.TOUCH_DOLLY_SCREEN_PAN||(this._state&rt.TOUCH_ZOOM_TRUCK)===rt.TOUCH_ZOOM_TRUCK||(this._state&rt.TOUCH_ZOOM_SCREEN_PAN)===rt.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&rt.DOLLY)===rt.DOLLY||(this._state&rt.TOUCH_DOLLY)===rt.TOUCH_DOLLY||(this._state&rt.TOUCH_DOLLY_TRUCK)===rt.TOUCH_DOLLY_TRUCK||(this._state&rt.TOUCH_DOLLY_SCREEN_PAN)===rt.TOUCH_DOLLY_SCREEN_PAN||(this._state&rt.TOUCH_DOLLY_OFFSET)===rt.TOUCH_DOLLY_OFFSET||(this._state&rt.TOUCH_DOLLY_ROTATE)===rt.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&rt.ZOOM)===rt.ZOOM||(this._state&rt.TOUCH_ZOOM)===rt.TOUCH_ZOOM||(this._state&rt.TOUCH_ZOOM_TRUCK)===rt.TOUCH_ZOOM_TRUCK||(this._state&rt.TOUCH_ZOOM_SCREEN_PAN)===rt.TOUCH_ZOOM_SCREEN_PAN||(this._state&rt.TOUCH_ZOOM_OFFSET)===rt.TOUCH_ZOOM_OFFSET||(this._state&rt.TOUCH_ZOOM_ROTATE)===rt.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&rt.OFFSET)===rt.OFFSET||(this._state&rt.TOUCH_OFFSET)===rt.TOUCH_OFFSET||(this._state&rt.TOUCH_DOLLY_OFFSET)===rt.TOUCH_DOLLY_OFFSET||(this._state&rt.TOUCH_ZOOM_OFFSET)===rt.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},d=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,jf(this._activePointers,Hs);const f=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,b=f?-f.deltaX:n.x-Hs.x,y=f?-f.deltaY:n.y-Hs.y;if(n.copy(Hs),((this._state&rt.ROTATE)===rt.ROTATE||(this._state&rt.TOUCH_ROTATE)===rt.TOUCH_ROTATE||(this._state&rt.TOUCH_DOLLY_ROTATE)===rt.TOUCH_DOLLY_ROTATE||(this._state&rt.TOUCH_ZOOM_ROTATE)===rt.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(b,y),this._isUserControllingRotate=!0),(this._state&rt.DOLLY)===rt.DOLLY||(this._state&rt.ZOOM)===rt.ZOOM){const E=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,C=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0,I=this.dollyDragInverted?-1:1;(this._state&rt.DOLLY)===rt.DOLLY?(this._dollyInternal(I*y*Au,E,C),this._isUserControllingDolly=!0):(this._zoomInternal(I*y*Au,E,C),this._isUserControllingZoom=!0)}if((this._state&rt.TOUCH_DOLLY)===rt.TOUCH_DOLLY||(this._state&rt.TOUCH_ZOOM)===rt.TOUCH_ZOOM||(this._state&rt.TOUCH_DOLLY_TRUCK)===rt.TOUCH_DOLLY_TRUCK||(this._state&rt.TOUCH_ZOOM_TRUCK)===rt.TOUCH_ZOOM_TRUCK||(this._state&rt.TOUCH_DOLLY_SCREEN_PAN)===rt.TOUCH_DOLLY_SCREEN_PAN||(this._state&rt.TOUCH_ZOOM_SCREEN_PAN)===rt.TOUCH_ZOOM_SCREEN_PAN||(this._state&rt.TOUCH_DOLLY_OFFSET)===rt.TOUCH_DOLLY_OFFSET||(this._state&rt.TOUCH_ZOOM_OFFSET)===rt.TOUCH_ZOOM_OFFSET||(this._state&rt.TOUCH_DOLLY_ROTATE)===rt.TOUCH_DOLLY_ROTATE||(this._state&rt.TOUCH_ZOOM_ROTATE)===rt.TOUCH_ZOOM_ROTATE){const E=Hs.x-this._activePointers[1].clientX,C=Hs.y-this._activePointers[1].clientY,I=Math.sqrt(E*E+C*C),x=r.y-I;r.set(0,I);const A=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,O=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&rt.TOUCH_DOLLY)===rt.TOUCH_DOLLY||(this._state&rt.TOUCH_DOLLY_ROTATE)===rt.TOUCH_DOLLY_ROTATE||(this._state&rt.TOUCH_DOLLY_TRUCK)===rt.TOUCH_DOLLY_TRUCK||(this._state&rt.TOUCH_DOLLY_SCREEN_PAN)===rt.TOUCH_DOLLY_SCREEN_PAN||(this._state&rt.TOUCH_DOLLY_OFFSET)===rt.TOUCH_DOLLY_OFFSET?(this._dollyInternal(x*Au,A,O),this._isUserControllingDolly=!0):(this._zoomInternal(x*Au,A,O),this._isUserControllingZoom=!0)}((this._state&rt.TRUCK)===rt.TRUCK||(this._state&rt.TOUCH_TRUCK)===rt.TOUCH_TRUCK||(this._state&rt.TOUCH_DOLLY_TRUCK)===rt.TOUCH_DOLLY_TRUCK||(this._state&rt.TOUCH_ZOOM_TRUCK)===rt.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(b,y,!1,!1),this._isUserControllingTruck=!0),((this._state&rt.SCREEN_PAN)===rt.SCREEN_PAN||(this._state&rt.TOUCH_SCREEN_PAN)===rt.TOUCH_SCREEN_PAN||(this._state&rt.TOUCH_DOLLY_SCREEN_PAN)===rt.TOUCH_DOLLY_SCREEN_PAN||(this._state&rt.TOUCH_ZOOM_SCREEN_PAN)===rt.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(b,y,!1,!0),this._isUserControllingTruck=!0),((this._state&rt.OFFSET)===rt.OFFSET||(this._state&rt.TOUCH_OFFSET)===rt.TOUCH_OFFSET||(this._state&rt.TOUCH_DOLLY_OFFSET)===rt.TOUCH_DOLLY_OFFSET||(this._state&rt.TOUCH_ZOOM_OFFSET)===rt.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(b,y,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},_=()=>{jf(this._activePointers,Hs),n.copy(Hs),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",m),this._domElement.ownerDocument.addEventListener("pointerlockerror",g),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),p())},this.unlockPointer=()=>{var f,b,y;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(f=this._domElement)===null||f===void 0||f.ownerDocument.exitPointerLock(),(b=this._domElement)===null||b===void 0||b.ownerDocument.removeEventListener("pointerlockchange",m),(y=this._domElement)===null||y===void 0||y.ownerDocument.removeEventListener("pointerlockerror",g),this.cancel()};const m=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},g=()=>{this.unlockPointer()};this._addAllEventListeners=f=>{this._domElement=f,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",c,{passive:!1}),this._domElement.addEventListener("contextmenu",u)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",c,{passive:!1}),this._domElement.removeEventListener("contextmenu",u),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",m),this._domElement.ownerDocument.removeEventListener("pointerlockerror",g))},this.cancel=()=>{this._state!==rt.NONE&&(this._state=rt.NONE,this._activePointers.length=0,_())},e&&this.connect(e),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=Zi(t.width,0,1),this._interactiveArea.height=Zi(t.height,0,1),this._interactiveArea.x=Zi(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Zi(t.y,0,1-this._interactiveArea.height)}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,i=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,i=!1){this._isUserControllingRotate=!1;const n=Zi(t,this.minAzimuthAngle,this.maxAzimuthAngle),r=Zi(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=n,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!i||te(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&te(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=pa.NONE,this._changedDolly=0,this._dollyToNoClamp(Zi(t,this.minDistance,this.maxDistance),e)}_dollyToNoClamp(t,e=!1){const i=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const r=this._collisionTest(),o=te(r,this._spherical.radius);if(!(i>t)&&o)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,r)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);const n=!e||te(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(n)}dollyInFixed(t,e=!1){this._targetEnd.add(this._getCameraDirection(th).multiplyScalar(t)),e||this._target.copy(this._targetEnd);const i=!e||te(this._target.x,this._targetEnd.x,this.restThreshold)&&te(this._target.y,this._targetEnd.y,this.restThreshold)&&te(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._isUserControllingZoom=!1,this._zoomEnd=Zi(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);const i=!e||te(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(i)}pan(t,e,i=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,i)}truck(t,e,i=!1){this._camera.updateMatrix(),bn.setFromMatrixColumn(this._camera.matrix,0),yn.setFromMatrixColumn(this._camera.matrix,1),bn.multiplyScalar(t),yn.multiplyScalar(-e);const n=zt.copy(bn).add(yn),r=Zt.copy(this._targetEnd).add(n);return this.moveTo(r.x,r.y,r.z,i)}forward(t,e=!1){zt.setFromMatrixColumn(this._camera.matrix,0),zt.crossVectors(this._camera.up,zt),zt.multiplyScalar(t);const i=Zt.copy(this._targetEnd).add(zt);return this.moveTo(i.x,i.y,i.z,e)}elevate(t,e=!1){return zt.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+zt.x,this._targetEnd.y+zt.y,this._targetEnd.z+zt.z,e)}moveTo(t,e,i,n=!1){this._isUserControllingTruck=!1;const r=zt.set(t,e,i).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,n||this._target.copy(this._targetEnd);const o=!n||te(this._target.x,this._targetEnd.x,this.restThreshold)&&te(this._target.y,this._targetEnd.y,this.restThreshold)&&te(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(t,e,i,n=!1){const r=zt.set(t,e,i).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(r.x,r.y,r.z,n)}fitToBox(t,e,{cover:i=!1,paddingLeft:n=0,paddingRight:r=0,paddingBottom:o=0,paddingTop:a=0}={}){const l=[],h=t.isBox3?ga.copy(t):ga.setFromObject(t);h.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const c=y0(this._sphericalEnd.theta,b0),u=y0(this._sphericalEnd.phi,b0);l.push(this.rotateTo(c,u,e));const p=zt.setFromSpherical(this._sphericalEnd).normalize(),d=x0.setFromUnitVectors(p,Gf),_=te(Math.abs(p.y),1);_&&d.multiply(Zf.setFromAxisAngle(Su,c)),d.multiply(this._yAxisUpSpaceInverse);const m=I0.makeEmpty();Zt.copy(h.min).applyQuaternion(d),m.expandByPoint(Zt),Zt.copy(h.min).setX(h.max.x).applyQuaternion(d),m.expandByPoint(Zt),Zt.copy(h.min).setY(h.max.y).applyQuaternion(d),m.expandByPoint(Zt),Zt.copy(h.max).setZ(h.min.z).applyQuaternion(d),m.expandByPoint(Zt),Zt.copy(h.min).setZ(h.max.z).applyQuaternion(d),m.expandByPoint(Zt),Zt.copy(h.max).setY(h.min.y).applyQuaternion(d),m.expandByPoint(Zt),Zt.copy(h.max).setX(h.min.x).applyQuaternion(d),m.expandByPoint(Zt),Zt.copy(h.max).applyQuaternion(d),m.expandByPoint(Zt),m.min.x-=n,m.min.y-=o,m.max.x+=r,m.max.y+=a,d.setFromUnitVectors(Gf,p),_&&d.premultiply(Zf.invert()),d.premultiply(this._yAxisUpSpace);const g=m.getSize(zt),f=m.getCenter(Zt).applyQuaternion(d);if(mo(this._camera)){const b=this.getDistanceToFitBox(g.x,g.y,g.z,i);l.push(this.moveTo(f.x,f.y,f.z,e)),l.push(this.dollyTo(b,e)),l.push(this.setFocalOffset(0,0,0,e))}else if(Sr(this._camera)){const b=this._camera,y=b.right-b.left,E=b.top-b.bottom,C=i?Math.max(y/g.x,E/g.y):Math.min(y/g.x,E/g.y);l.push(this.moveTo(f.x,f.y,f.z,e)),l.push(this.zoomTo(C,e)),l.push(this.setFocalOffset(0,0,0,e))}return Promise.all(l)}fitToSphere(t,e){const i=[],n="isObject3D"in t?As.createBoundingSphere(t,qf):qf.copy(t);if(i.push(this.moveTo(n.center.x,n.center.y,n.center.z,e)),mo(this._camera)){const r=this.getDistanceToFitSphere(n.radius);i.push(this.dollyTo(r,e))}else if(Sr(this._camera)){const r=this._camera.right-this._camera.left,o=this._camera.top-this._camera.bottom,a=2*n.radius,l=Math.min(r/a,o/a);i.push(this.zoomTo(l,e))}return i.push(this.setFocalOffset(0,0,0,e)),Promise.all(i)}setLookAt(t,e,i,n,r,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=pa.NONE,this._changedDolly=0;const l=Zt.set(n,r,o),h=zt.set(t,e,i);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(h.sub(l).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const c=!a||te(this._target.x,this._targetEnd.x,this.restThreshold)&&te(this._target.y,this._targetEnd.y,this.restThreshold)&&te(this._target.z,this._targetEnd.z,this.restThreshold)&&te(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&te(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&te(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}lerpLookAt(t,e,i,n,r,o,a,l,h,c,u,p,d,_=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=pa.NONE,this._changedDolly=0;const m=zt.set(n,r,o),g=Zt.set(t,e,i);Ei.setFromVector3(g.sub(m).applyQuaternion(this._yAxisUpSpace));const f=ma.set(c,u,p),b=Zt.set(a,l,h);eh.setFromVector3(b.sub(f).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(m.lerp(f,d));const y=eh.theta-Ei.theta,E=eh.phi-Ei.phi,C=eh.radius-Ei.radius;this._sphericalEnd.set(Ei.radius+C*d,Ei.phi+E*d,Ei.theta+y*d),this.normalizeRotations(),this._needsUpdate=!0,_||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const I=!_||te(this._target.x,this._targetEnd.x,this.restThreshold)&&te(this._target.y,this._targetEnd.y,this.restThreshold)&&te(this._target.z,this._targetEnd.z,this.restThreshold)&&te(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&te(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&te(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(I)}setPosition(t,e,i,n=!1){return this.setLookAt(t,e,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,n)}setTarget(t,e,i,n=!1){const r=this.getPosition(zt),o=this.setLookAt(r.x,r.y,r.z,t,e,i,n);return this._sphericalEnd.phi=Zi(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(t,e,i,n=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,e,i),this._needsUpdate=!0,n||this._focalOffset.copy(this._focalOffsetEnd);const r=!n||te(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&te(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&te(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(t,e,i){this._camera.updateMatrixWorld(),bn.setFromMatrixColumn(this._camera.matrixWorldInverse,0),yn.setFromMatrixColumn(this._camera.matrixWorldInverse,1),go.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const n=zt.set(t,e,i),r=n.distanceTo(this._camera.position),o=n.sub(this._camera.position);bn.multiplyScalar(o.x),yn.multiplyScalar(o.y),go.multiplyScalar(o.z),zt.copy(bn).add(yn).add(go),zt.z=zt.z+r,this.dollyTo(r,!1),this.setFocalOffset(-zt.x,zt.y,-zt.z,!1),this.moveTo(t,e,i,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,i,n){if(t===null){this._viewport=null;return}this._viewport=this._viewport||new Pt.Vector4,typeof t=="number"?this._viewport.set(t,e,i,n):this._viewport.copy(t)}getDistanceToFitBox(t,e,i,n=!1){if(Yf(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const r=t/e,o=this._camera.getEffectiveFOV()*Ql,a=this._camera.aspect;return((n?r>a:r<a)?e:t/a)*.5/Math.tan(o*.5)+i*.5}getDistanceToFitSphere(t){if(Yf(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const e=this._camera.getEffectiveFOV()*Ql,i=Math.atan(Math.tan(e*.5)*this._camera.aspect)*2,n=1<this._camera.aspect?e:i;return t/Math.sin(n*.5)}getTarget(t,e=!0){return(t&&t.isVector3?t:new Pt.Vector3).copy(e?this._targetEnd:this._target)}getPosition(t,e=!0){return(t&&t.isVector3?t:new Pt.Vector3).setFromSpherical(e?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(e?this._targetEnd:this._target)}getSpherical(t,e=!0){return(t||new Pt.Spherical).copy(e?this._sphericalEnd:this._spherical)}getFocalOffset(t,e=!0){return(t&&t.isVector3?t:new Pt.Vector3).copy(e?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%fa,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=fa),this._spherical.theta+=fa*Math.round((this._sphericalEnd.theta-this._spherical.theta)/fa)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(t=!1){if(!te(this._camera.up.x,this._cameraUp0.x)||!te(this._camera.up.y,this._cameraUp0.y)||!te(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const i=this.getPosition(zt);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}const e=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(e)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Su),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const t=zt.subVectors(this._target,this._camera.position).normalize(),e=Zt.crossVectors(t,this._camera.up);this._camera.up.crossVectors(e,t).normalize(),this._camera.updateMatrixWorld();const i=this.getPosition(zt);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}update(t){const e=this._sphericalEnd.theta-this._spherical.theta,i=this._sphericalEnd.phi-this._spherical.phi,n=this._sphericalEnd.radius-this._spherical.radius,r=E0.subVectors(this._targetEnd,this._target),o=C0.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(ue(e))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const c=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Tu(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,c,1/0,t),this._needsUpdate=!0}if(ue(i))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const c=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Tu(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,c,1/0,t),this._needsUpdate=!0}if(ue(n))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const c=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Tu(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,c,this.maxSpeed,t),this._needsUpdate=!0}if(ue(r.x)&&ue(r.y)&&ue(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const c=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;v0(this._target,this._targetEnd,this._targetVelocity,c,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(ue(o.x)&&ue(o.y)&&ue(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const c=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;v0(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,c,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(ue(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const c=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Tu(this._zoom,this._zoomEnd,this._zoomVelocity,c,1/0,t)}if(this.dollyToCursor){if(mo(this._camera)&&this._changedDolly!==0){const c=this._spherical.radius-this._lastDistance,u=this._camera,p=this._getCameraDirection(th),d=zt.copy(p).cross(u.up).normalize();d.lengthSq()===0&&(d.x=1);const _=Zt.crossVectors(d,p),m=this._sphericalEnd.radius*Math.tan(u.getEffectiveFOV()*Ql*.5),g=(this._sphericalEnd.radius-c-this._sphericalEnd.radius)/this._sphericalEnd.radius,f=ma.copy(this._targetEnd).add(d.multiplyScalar(this._dollyControlCoord.x*m*u.aspect)).add(_.multiplyScalar(this._dollyControlCoord.y*m)),b=zt.copy(this._targetEnd).lerp(f,g),y=this._lastDollyDirection===pa.IN&&this._spherical.radius<=this.minDistance,E=this._lastDollyDirection===pa.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(y||E)){this._sphericalEnd.radius-=c,this._spherical.radius-=c;const I=Zt.copy(p).multiplyScalar(-c);b.add(I)}this._boundary.clampPoint(b,b);const C=Zt.subVectors(b,this._targetEnd);this._targetEnd.copy(b),this._target.add(C),this._changedDolly-=c,ue(this._changedDolly)&&(this._changedDolly=0)}else if(Sr(this._camera)&&this._changedZoom!==0){const c=this._zoom-this._lastZoom,u=this._camera,p=zt.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(u.near+u.far)/(u.near-u.far)).unproject(u),d=Zt.set(0,0,-1).applyQuaternion(u.quaternion),_=ma.copy(p).add(d.multiplyScalar(-p.dot(u.up))),m=-(this._zoom-c-this._zoom)/this._zoom,g=this._getCameraDirection(th),f=this._targetEnd.dot(g),b=zt.copy(this._targetEnd).lerp(_,m),y=b.dot(g),E=g.multiplyScalar(y-f);b.sub(E),this._boundary.clampPoint(b,b);const C=Zt.subVectors(b,this._targetEnd);this._targetEnd.copy(b),this._target.add(C),this._changedZoom-=c,ue(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!ue(this._focalOffset.x)||!ue(this._focalOffset.y)||!ue(this._focalOffset.z))&&(bn.setFromMatrixColumn(this._camera.matrix,0),yn.setFromMatrixColumn(this._camera.matrix,1),go.setFromMatrixColumn(this._camera.matrix,2),bn.multiplyScalar(this._focalOffset.x),yn.multiplyScalar(-this._focalOffset.y),go.multiplyScalar(this._focalOffset.z),zt.copy(bn).add(yn).add(go),this._camera.position.add(zt),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),zt.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const h=this._needsUpdate;return h&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):h?(this.dispatchEvent({type:"update"}),ue(e,this.restThreshold)&&ue(i,this.restThreshold)&&ue(n,this.restThreshold)&&ue(r.x,this.restThreshold)&&ue(r.y,this.restThreshold)&&ue(r.z,this.restThreshold)&&ue(o.x,this.restThreshold)&&ue(o.y,this.restThreshold)&&ue(o.z,this.restThreshold)&&ue(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!h&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=h,this._needsUpdate=!1,h}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Kl(this.maxDistance),minZoom:this.minZoom,maxZoom:Kl(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Kl(this.maxPolarAngle),minAzimuthAngle:Kl(this.minAzimuthAngle),maxAzimuthAngle:Kl(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:zt.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){const i=JSON.parse(t);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=Jl(i.maxDistance),this.minZoom=i.minZoom,this.maxZoom=Jl(i.maxZoom),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=Jl(i.maxPolarAngle),this.minAzimuthAngle=Jl(i.minAzimuthAngle),this.maxAzimuthAngle=Jl(i.maxAzimuthAngle),this.smoothTime=i.smoothTime,this.draggingSmoothTime=i.draggingSmoothTime,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._zoom0=i.zoom0,this._focalOffset0.fromArray(i.focalOffset0),this.moveTo(i.target[0],i.target[1],i.target[2],e),Ei.setFromVector3(zt.fromArray(i.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Ei.theta,Ei.phi,e),this.dollyTo(Ei.radius,e),this.zoomTo(i.zoom,e),this.setFocalOffset(i.focalOffset[0],i.focalOffset[1],i.focalOffset[2],e),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version",SF),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(e=>e.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(e=>e.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,e,i){const n=e.lengthSq();if(n===0)return t;const r=Zt.copy(e).add(t),o=this._boundary.clampPoint(r,ma).sub(r),a=o.lengthSq();if(a===0)return t.add(e);if(a===n)return t;if(i===0)return t.add(e).add(o);{const l=1+i*a/e.dot(o);return t.add(Zt.copy(e).multiplyScalar(l)).add(o.multiplyScalar(1-i))}}_updateNearPlaneCorners(){if(mo(this._camera)){const t=this._camera,e=t.near,i=t.getEffectiveFOV()*Ql,n=Math.tan(i*.5)*e,r=n*t.aspect;this._nearPlaneCorners[0].set(-r,-n,0),this._nearPlaneCorners[1].set(r,-n,0),this._nearPlaneCorners[2].set(r,n,0),this._nearPlaneCorners[3].set(-r,n,0)}else if(Sr(this._camera)){const t=this._camera,e=1/t.zoom,i=t.left*e,n=t.right*e,r=t.top*e,o=t.bottom*e;this._nearPlaneCorners[0].set(i,r,0),this._nearPlaneCorners[1].set(n,r,0),this._nearPlaneCorners[2].set(n,o,0),this._nearPlaneCorners[3].set(i,o,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||Yf(this._camera,"_collisionTest"))return t;const e=this._getTargetDirection(th);Xf.lookAt(w0,e,this._camera.up);for(let i=0;i<4;i++){const n=Zt.copy(this._nearPlaneCorners[i]);n.applyMatrix4(Xf);const r=ma.addVectors(this._target,n);Ou.set(r,e),Ou.far=this._spherical.radius+1;const o=Ou.intersectObjects(this.colliderMeshes);o.length!==0&&o[0].distance<t&&(t=o[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;const e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{const i=()=>{this.removeEventListener("rest",i),e()};this.addEventListener("rest",i)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,e=new Pt.Sphere){const i=e,n=i.center;ga.makeEmpty(),t.traverseVisible(o=>{o.isMesh&&ga.expandByObject(o)}),ga.getCenter(n);let r=0;return t.traverseVisible(o=>{if(!o.isMesh)return;const a=o;if(!a.geometry)return;const l=a.geometry.clone();l.applyMatrix4(a.matrixWorld);const h=l.attributes.position;for(let c=0,u=h.count;c<u;c++)zt.fromBufferAttribute(h,c),r=Math.max(r,n.distanceToSquared(zt))}),i.radius=Math.sqrt(r),i}}class Oc extends QP{constructor(t){super(t),D(this,"onBeforeUpdate",new Et),D(this,"onAfterUpdate",new Et),D(this,"onAspectUpdated",new Et),D(this,"onDisposed",new Et),D(this,"three"),D(this,"_allControls",new Map),D(this,"updateAspect",()=>{var e;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof aa){this.onAspectUpdated.trigger();return}if((e=this.currentWorld.renderer)!=null&&e.isResizeable()){const i=this.currentWorld.renderer.getSize();this.three.aspect=i.width/i.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.worlds.onItemSet.add(({value:e})=>{const i=this.newCameraControls();this._allControls.set(e.uuid,i)}),this.worlds.onBeforeDelete.add(({value:e})=>{const i=this._allControls.get(e.uuid);i&&(i.dispose(),this._allControls.delete(e.uuid))})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const t=this._allControls.get(this.currentWorld.uuid);if(!t)throw new Error("Controls not found!");return t}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(t){this.currentWorld!==null&&(this.controls.enabled=t)}set currentWorld(t){super.currentWorld=t,t&&(this.worlds.get(t.uuid)||this.worlds.set(t.uuid,t))}get currentWorld(){return this._currentWorld}dispose(){this.setupEvents(!1),this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[t,e]of this._allControls)e.dispose();this.worlds.clear()}async fitToItems(t){const e=await this.getItemsBounding(t);await this.controls.fitToSphere(e,!0)}async setOrbitToItems(t){const e=await this.getItemsBounding(t);this.controls.setOrbitPoint(e.center.x,e.center.y,e.center.z)}update(t){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(t),this.onAfterUpdate.trigger(this))}async getItemsBounding(t){const e=this.components.get(Rt),i=this.components.get(H1);i.list.clear();const n=new ws;if(t)await i.addFromModelIdMap(t);else for(const[,r]of e.list)i.list.add(r.box);return i.get().getBoundingSphere(n),i.list.clear(),n}setupCamera(){const t=window.innerWidth/window.innerHeight,e=new Hc(60,t,1,1e3);return e.position.set(50,50,50),e.lookAt(new F(0,0,0)),e}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");As.install({THREE:Oc.getSubsetOfThree()});const{domElement:t}=this.currentWorld.renderer.three,e=new As(this.three,t);return e.smoothTime=.2,e.dollyToCursor=!0,e.infinityDolly=!0,e.minDistance=6,e}setupEvents(t){t?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:Ew,Vector2:Bt,Vector3:F,Vector4:$i,Quaternion:Ie,Matrix4:vt,Spherical:ww,Box3:Tt,Sphere:ws,Raycaster:oa,MathUtils:Vc}}}const Q1=class K1 extends Cs{constructor(t){super(t),D(this,"onAfterUpdate",new Et),D(this,"onBeforeUpdate",new Et),D(this,"onDisposed",new Et),D(this,"list",new vl),D(this,"enabled",!0),t.add(K1.uuid,this)}create(){const t=new EF(this.components),e=t.uuid;if(this.list.has(e))throw new Error("There is already a world with this name!");return this.list.set(e,t),t}delete(t){if(!this.list.has(t.uuid))throw new Error("The provided world is not found in the list!");this.list.delete(t.uuid),t.dispose()}dispose(){this.enabled=!1;for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}update(t){if(this.enabled)for(const[e,i]of this.list)i.update(t)}};D(Q1,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let Gc=Q1;class PF extends Wc{constructor(){super(...arguments),D(this,"_config",{visible:{value:!0,type:"Boolean"},color:{value:new xt,type:"Color"},primarySize:{type:"Number",interpolable:!0,value:1,min:0,max:1e3},secondarySize:{type:"Number",interpolable:!0,value:10,min:0,max:1e3},distance:{type:"Number",interpolable:!0,value:500,min:0,max:500}})}get visible(){return this._config.visible.value}set visible(t){this._config.visible.value=t,this._component.visible=t}get color(){return this._config.color.value}set color(t){this._config.color.value=t,this._component.material.uniforms.uColor.value=t,this._component.material.uniformsNeedUpdate=!0}get primarySize(){return this._config.primarySize.value}set primarySize(t){this._config.primarySize.value=t,this._component.material.uniforms.uSize1.value=t,this._component.material.uniformsNeedUpdate=!0}get secondarySize(){return this._config.secondarySize.value}set secondarySize(t){this._config.secondarySize.value=t,this._component.material.uniforms.uSize2.value=t,this._component.material.uniformsNeedUpdate=!0}get distance(){return this._config.distance.value}set distance(t){this._config.distance.value=t,this._component.material.uniforms.uDistance.value=t,this._component.material.uniformsNeedUpdate=!0}}class FF{constructor(t,e){D(this,"onDisposed",new Et),D(this,"onSetup",new Et),D(this,"isSetup",!1),D(this,"world"),D(this,"components"),D(this,"config"),D(this,"_defaultConfig",{visible:!0,color:new xt(12303291),primarySize:1,secondarySize:10,distance:500}),D(this,"three"),D(this,"_fade",3),D(this,"updateZoom",()=>{this.world.camera instanceof Oc&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=e;const{color:i,primarySize:n,secondarySize:r,distance:o}=this._defaultConfig;this.components=t,this.config=new PF(this,this.components,"Grid");const a=new Rl(2,2,1,1),l=new $c({side:Wn,uniforms:{uSize1:{value:n},uSize2:{value:r},uColor:{value:i},uDistance:{value:o},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new lt(a,l),this.three.frustumCulled=!1,e.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(t){this.three.visible=t,t?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(t){this._fade=t?3:0,this.material.uniforms.uFade.value=this._fade}setup(t){const e={...this._defaultConfig,...t};this.config.visible=!0,this.config.color=e.color,this.config.primarySize=e.primarySize,this.config.secondarySize=e.secondarySize,this.config.distance=e.distance,this.isSetup=!0,this.onSetup.trigger()}dispose(){this.setupEvents(!1),this.components.get(Yp).list.delete(this.config.uuid),this.components.get(Vp).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(t){if(this.world.isDisposing||!(this.world.camera instanceof Oc))return;const e=this.world.camera.controls;t?e.addEventListener("update",this.updateZoom):e.removeEventListener("update",this.updateZoom)}}const J1=class tE extends Cs{constructor(t){super(t),D(this,"list",new Map),D(this,"onDisposed",new Et),D(this,"enabled",!0),t.add(tE.uuid,this)}create(t){if(this.list.has(t.uuid))throw new Error("This world already has a grid!");const e=new FF(this.components,t);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}};D(J1,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");let RF=J1;const eE=0,LF=1,NF=2,T0=2,Qf=1.25,A0=1,Bd=6*4+4+4,Wp=65535,MF=Math.pow(2,-24),Kf=Symbol("SKIP_GENERATION");function DF(s){return s.index?s.index.count:s.attributes.position.count}function Nl(s){return DF(s)/3}function kF(s,t=ArrayBuffer){return s>65535?new Uint32Array(new t(4*s)):new Uint16Array(new t(2*s))}function zF(s,t){if(!s.index){const e=s.attributes.position.count,i=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=kF(e,i);s.setIndex(new Ve(n,1));for(let r=0;r<e;r++)n[r]=r}}function sE(s){const t=Nl(s),e=s.drawRange,i=e.start/3,n=(e.start+e.count)/3,r=Math.max(0,i),o=Math.min(t,n)-r;return[{offset:Math.floor(r),count:Math.floor(o)}]}function iE(s){if(!s.groups||!s.groups.length)return sE(s);const t=[],e=new Set,i=s.drawRange,n=i.start/3,r=(i.start+i.count)/3;for(const a of s.groups){const l=a.start/3,h=(a.start+a.count)/3;e.add(Math.max(n,l)),e.add(Math.min(r,h))}const o=Array.from(e.values()).sort((a,l)=>a-l);for(let a=0;a<o.length-1;a++){const l=o[a],h=o[a+1];t.push({offset:Math.floor(l),count:Math.floor(h-l)})}return t}function UF(s){if(s.groups.length===0)return!1;const t=Nl(s),e=iE(s).sort((r,o)=>r.offset-o.offset),i=e[e.length-1];i.count=Math.min(t-i.offset,i.count);let n=0;return e.forEach(({count:r})=>n+=r),t!==n}function Se(s,t,e){return e.min.x=t[s],e.min.y=t[s+1],e.min.z=t[s+2],e.max.x=t[s+3],e.max.y=t[s+4],e.max.z=t[s+5],e}function BF(s){s[0]=s[1]=s[2]=1/0,s[3]=s[4]=s[5]=-1/0}function S0(s){let t=-1,e=-1/0;for(let i=0;i<3;i++){const n=s[i+3]-s[i];n>e&&(e=n,t=i)}return t}function O0(s,t){t.set(s)}function P0(s,t,e){let i,n;for(let r=0;r<3;r++){const o=r+3;i=s[r],n=t[r],e[r]=i<n?i:n,i=s[o],n=t[o],e[o]=i>n?i:n}}function Pu(s,t,e){for(let i=0;i<3;i++){const n=t[s+2*i],r=t[s+2*i+1],o=n-r,a=n+r;o<e[i]&&(e[i]=o),a>e[i+3]&&(e[i+3]=a)}}function sh(s){const t=s[3]-s[0],e=s[4]-s[1],i=s[5]-s[2];return 2*(t*e+e*i+i*t)}function Jf(s,t,e,i,n=null){let r=1/0,o=1/0,a=1/0,l=-1/0,h=-1/0,c=-1/0,u=1/0,p=1/0,d=1/0,_=-1/0,m=-1/0,g=-1/0;const f=n!==null;for(let b=t*6,y=(t+e)*6;b<y;b+=6){const E=s[b+0],C=s[b+1],I=E-C,x=E+C;I<r&&(r=I),x>l&&(l=x),f&&E<u&&(u=E),f&&E>_&&(_=E);const A=s[b+2],O=s[b+3],L=A-O,V=A+O;L<o&&(o=L),V>h&&(h=V),f&&A<p&&(p=A),f&&A>m&&(m=A);const T=s[b+4],N=s[b+5],v=T-N,M=T+N;v<a&&(a=v),M>c&&(c=M),f&&T<d&&(d=T),f&&T>g&&(g=T)}i[0]=r,i[1]=o,i[2]=a,i[3]=l,i[4]=h,i[5]=c,f&&(n[0]=u,n[1]=p,n[2]=d,n[3]=_,n[4]=m,n[5]=g)}function VF(s,t,e,i){let n=1/0,r=1/0,o=1/0,a=-1/0,l=-1/0,h=-1/0;for(let c=t*6,u=(t+e)*6;c<u;c+=6){const p=s[c+0];p<n&&(n=p),p>a&&(a=p);const d=s[c+2];d<r&&(r=d),d>l&&(l=d);const _=s[c+4];_<o&&(o=_),_>h&&(h=_)}i[0]=n,i[1]=r,i[2]=o,i[3]=a,i[4]=l,i[5]=h}function $F(s,t){BF(t);const e=s.attributes.position,i=s.index?s.index.array:null,n=Nl(s),r=new Float32Array(n*6),o=e.normalized,a=e.array,l=e.offset||0;let h=3;e.isInterleavedBufferAttribute&&(h=e.data.stride);const c=["getX","getY","getZ"];for(let u=0;u<n;u++){const p=u*3,d=u*6;let _=p+0,m=p+1,g=p+2;i&&(_=i[_],m=i[m],g=i[g]),o||(_=_*h+l,m=m*h+l,g=g*h+l);for(let f=0;f<3;f++){let b,y,E;o?(b=e[c[f]](_),y=e[c[f]](m),E=e[c[f]](g)):(b=a[_+f],y=a[m+f],E=a[g+f]);let C=b;y<C&&(C=y),E<C&&(C=E);let I=b;y>I&&(I=y),E>I&&(I=E);const x=(I-C)/2,A=f*2;r[d+A+0]=C+x,r[d+A+1]=x+(Math.abs(C)+x)*MF,C<t[f]&&(t[f]=C),I>t[f+3]&&(t[f+3]=I)}}return r}const Jn=32,HF=(s,t)=>s.candidate-t.candidate,wr=new Array(Jn).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Fu=new Float32Array(6);function jF(s,t,e,i,n,r){let o=-1,a=0;if(r===eE)o=S0(t),o!==-1&&(a=(t[o]+t[o+3])/2);else if(r===LF)o=S0(s),o!==-1&&(a=YF(e,i,n,o));else if(r===NF){const l=sh(s);let h=Qf*n;const c=i*6,u=(i+n)*6;for(let p=0;p<3;p++){const d=t[p],_=(t[p+3]-d)/Jn;if(n<Jn/4){const m=[...wr];m.length=n;let g=0;for(let b=c;b<u;b+=6,g++){const y=m[g];y.candidate=e[b+2*p],y.count=0;const{bounds:E,leftCacheBounds:C,rightCacheBounds:I}=y;for(let x=0;x<3;x++)I[x]=1/0,I[x+3]=-1/0,C[x]=1/0,C[x+3]=-1/0,E[x]=1/0,E[x+3]=-1/0;Pu(b,e,E)}m.sort(HF);let f=n;for(let b=0;b<f;b++){const y=m[b];for(;b+1<f&&m[b+1].candidate===y.candidate;)m.splice(b+1,1),f--}for(let b=c;b<u;b+=6){const y=e[b+2*p];for(let E=0;E<f;E++){const C=m[E];y>=C.candidate?Pu(b,e,C.rightCacheBounds):(Pu(b,e,C.leftCacheBounds),C.count++)}}for(let b=0;b<f;b++){const y=m[b],E=y.count,C=n-y.count,I=y.leftCacheBounds,x=y.rightCacheBounds;let A=0;E!==0&&(A=sh(I)/l);let O=0;C!==0&&(O=sh(x)/l);const L=A0+Qf*(A*E+O*C);L<h&&(o=p,h=L,a=y.candidate)}}else{for(let f=0;f<Jn;f++){const b=wr[f];b.count=0,b.candidate=d+_+f*_;const y=b.bounds;for(let E=0;E<3;E++)y[E]=1/0,y[E+3]=-1/0}for(let f=c;f<u;f+=6){let b=~~((e[f+2*p]-d)/_);b>=Jn&&(b=Jn-1);const y=wr[b];y.count++,Pu(f,e,y.bounds)}const m=wr[Jn-1];O0(m.bounds,m.rightCacheBounds);for(let f=Jn-2;f>=0;f--){const b=wr[f],y=wr[f+1];P0(b.bounds,y.rightCacheBounds,b.rightCacheBounds)}let g=0;for(let f=0;f<Jn-1;f++){const b=wr[f],y=b.count,E=b.bounds,C=wr[f+1].rightCacheBounds;y!==0&&(g===0?O0(E,Fu):P0(E,Fu,Fu)),g+=y;let I=0,x=0;g!==0&&(I=sh(Fu)/l);const A=n-g;A!==0&&(x=sh(C)/l);const O=A0+Qf*(I*g+x*A);O<h&&(o=p,h=O,a=b.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:o,pos:a}}function YF(s,t,e,i){let n=0;for(let r=t,o=t+e;r<o;r++)n+=s[r*6+i*2];return n/e}class Ru{constructor(){}}function WF(s,t,e,i,n,r){let o=i,a=i+n-1;const l=r.pos,h=r.axis*2;for(;;){for(;o<=a&&e[o*6+h]<l;)o++;for(;o<=a&&e[a*6+h]>=l;)a--;if(o<a){for(let c=0;c<3;c++){let u=t[o*3+c];t[o*3+c]=t[a*3+c],t[a*3+c]=u}for(let c=0;c<6;c++){let u=e[o*6+c];e[o*6+c]=e[a*6+c],e[a*6+c]=u}o++,a--}else return o}}function GF(s,t,e,i,n,r){let o=i,a=i+n-1;const l=r.pos,h=r.axis*2;for(;;){for(;o<=a&&e[o*6+h]<l;)o++;for(;o<=a&&e[a*6+h]>=l;)a--;if(o<a){let c=s[o];s[o]=s[a],s[a]=c;for(let u=0;u<6;u++){let p=e[o*6+u];e[o*6+u]=e[a*6+u],e[a*6+u]=p}o++,a--}else return o}}function qF(s,t){const e=(s.index?s.index.count:s.attributes.position.count)/3,i=e>2**16,n=i?4:2,r=t?new SharedArrayBuffer(e*n):new ArrayBuffer(e*n),o=i?new Uint32Array(r):new Uint16Array(r);for(let a=0,l=o.length;a<l;a++)o[a]=a;return o}function ZF(s,t){const e=s.geometry,i=e.index?e.index.array:null,n=t.maxDepth,r=t.verbose,o=t.maxLeafTris,a=t.strategy,l=t.onProgress,h=Nl(e),c=s._indirectBuffer;let u=!1;const p=new Float32Array(6),d=new Float32Array(6),_=$F(e,p),m=t.indirect?GF:WF,g=[],f=t.indirect?sE(e):iE(e);if(f.length===1){const E=f[0],C=new Ru;C.boundingData=p,VF(_,E.offset,E.count,d),y(C,E.offset,E.count,d),g.push(C)}else for(let E of f){const C=new Ru;C.boundingData=new Float32Array(6),Jf(_,E.offset,E.count,C.boundingData,d),y(C,E.offset,E.count,d),g.push(C)}return g;function b(E){l&&l(E/h)}function y(E,C,I,x=null,A=0){if(!u&&A>=n&&(u=!0,r&&(console.warn(`MeshBVH: Max depth of ${n} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),I<=o||A>=n)return b(C+I),E.offset=C,E.count=I,E;const O=jF(E.boundingData,x,_,C,I,a);if(O.axis===-1)return b(C+I),E.offset=C,E.count=I,E;const L=m(c,i,_,C,I,O);if(L===C||L===C+I)b(C+I),E.offset=C,E.count=I;else{E.splitAxis=O.axis;const V=new Ru,T=C,N=L-C;E.left=V,V.boundingData=new Float32Array(6),Jf(_,T,N,V.boundingData,d),y(V,T,N,d,A+1);const v=new Ru,M=L,Q=I-N;E.right=v,v.boundingData=new Float32Array(6),Jf(_,M,Q,v.boundingData,d),y(v,M,Q,d,A+1)}return E}}function XF(s,t){const e=s.geometry;t.indirect&&(s._indirectBuffer=qF(e,t.useSharedArrayBuffer),UF(e)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),s._indirectBuffer||zF(e,t);const i=ZF(s,t);let n,r,o;const a=[],l=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<i.length;u++){const p=i[u];let d=h(p);const _=new l(Bd*d);n=new Float32Array(_),r=new Uint32Array(_),o=new Uint16Array(_),c(0,p),a.push(_)}s._roots=a;return;function h(u){return u.count?1:1+h(u.left)+h(u.right)}function c(u,p){const d=u/4,_=u/2,m=!!p.count,g=p.boundingData;for(let f=0;f<6;f++)n[d+f]=g[f];if(m){const f=p.offset,b=p.count;return r[d+6]=f,o[_+14]=b,o[_+15]=Wp,u+Bd}else{const f=p.left,b=p.right,y=p.splitAxis;let E;if(E=c(u+Bd,f),E/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[d+6]=E/4,E=c(E,b),r[d+7]=y,E}}}class ur{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let i=1/0,n=-1/0;for(let r=0,o=t.length;r<o;r++){const a=t[r][e];i=a<i?a:i,n=a>n?a:n}this.min=i,this.max=n}setFromPoints(t,e){let i=1/0,n=-1/0;for(let r=0,o=e.length;r<o;r++){const a=e[r],l=t.dot(a);i=l<i?l:i,n=l>n?l:n}this.min=i,this.max=n}isSeparated(t){return this.min>t.max||t.min>this.max}}ur.prototype.setFromBox=function(){const s=new F;return function(t,e){const i=e.min,n=e.max;let r=1/0,o=-1/0;for(let a=0;a<=1;a++)for(let l=0;l<=1;l++)for(let h=0;h<=1;h++){s.x=i.x*a+n.x*(1-a),s.y=i.y*l+n.y*(1-l),s.z=i.z*h+n.z*(1-h);const c=t.dot(s);r=Math.min(c,r),o=Math.max(c,o)}this.min=r,this.max=o}}();const QF=function(){const s=new F,t=new F,e=new F;return function(i,n,r){const o=i.start,a=s,l=n.start,h=t;e.subVectors(o,l),s.subVectors(i.end,i.start),t.subVectors(n.end,n.start);const c=e.dot(h),u=h.dot(a),p=h.dot(h),d=e.dot(a),_=a.dot(a)*p-u*u;let m,g;_!==0?m=(c*u-d*p)/_:m=0,g=(c+m*u)/p,r.x=m,r.y=g}}(),z_=function(){const s=new Bt,t=new F,e=new F;return function(i,n,r,o){QF(i,n,s);let a=s.x,l=s.y;if(a>=0&&a<=1&&l>=0&&l<=1){i.at(a,r),n.at(l,o);return}else if(a>=0&&a<=1){l<0?n.at(0,o):n.at(1,o),i.closestPointToPoint(o,!0,r);return}else if(l>=0&&l<=1){a<0?i.at(0,r):i.at(1,r),n.closestPointToPoint(r,!0,o);return}else{let h;a<0?h=i.start:h=i.end;let c;l<0?c=n.start:c=n.end;const u=t,p=e;if(i.closestPointToPoint(c,!0,t),n.closestPointToPoint(h,!0,e),u.distanceToSquared(c)<=p.distanceToSquared(h)){r.copy(u),o.copy(c);return}else{r.copy(h),o.copy(p);return}}}}(),KF=function(){const s=new F,t=new F,e=new Ht,i=new Gt;return function(n,r){const{radius:o,center:a}=n,{a:l,b:h,c}=r;if(i.start=l,i.end=h,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o||(i.start=l,i.end=c,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o)||(i.start=h,i.end=c,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o))return!0;const u=r.getPlane(e);if(Math.abs(u.distanceToPoint(a))<=o){const p=u.projectPoint(a,t);if(r.containsPoint(p))return!0}return!1}}(),JF=1e-15;function tm(s){return Math.abs(s)<JF}class ln extends ks{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new F),this.satBounds=new Array(4).fill().map(()=>new ur),this.points=[this.a,this.b,this.c],this.sphere=new ws,this.plane=new Ht,this.needsUpdate=!0}intersectsSphere(t){return KF(t,this)}update(){const t=this.a,e=this.b,i=this.c,n=this.points,r=this.satAxes,o=this.satBounds,a=r[0],l=o[0];this.getNormal(a),l.setFromPoints(a,n);const h=r[1],c=o[1];h.subVectors(t,e),c.setFromPoints(h,n);const u=r[2],p=o[2];u.subVectors(e,i),p.setFromPoints(u,n);const d=r[3],_=o[3];d.subVectors(i,t),_.setFromPoints(d,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,t),this.needsUpdate=!1}}ln.prototype.closestPointToSegment=function(){const s=new F,t=new F,e=new Gt;return function(i,n=null,r=null){const{start:o,end:a}=i,l=this.points;let h,c=1/0;for(let u=0;u<3;u++){const p=(u+1)%3;e.start.copy(l[u]),e.end.copy(l[p]),z_(e,i,s,t),h=s.distanceToSquared(t),h<c&&(c=h,n&&n.copy(s),r&&r.copy(t))}return this.closestPointToPoint(o,s),h=o.distanceToSquared(s),h<c&&(c=h,n&&n.copy(s),r&&r.copy(o)),this.closestPointToPoint(a,s),h=a.distanceToSquared(s),h<c&&(c=h,n&&n.copy(s),r&&r.copy(a)),Math.sqrt(c)}}();ln.prototype.intersectsTriangle=function(){const s=new ln,t=new Array(3),e=new Array(3),i=new ur,n=new ur,r=new F,o=new F,a=new F,l=new F,h=new F,c=new Gt,u=new Gt,p=new Gt,d=new F;function _(m,g,f){const b=m.points;let y=0,E=-1;for(let C=0;C<3;C++){const{start:I,end:x}=c;I.copy(b[C]),x.copy(b[(C+1)%3]),c.delta(o);const A=tm(g.distanceToPoint(I));if(tm(g.normal.dot(o))&&A){f.copy(c),y=2;break}const O=g.intersectLine(c,d);if(!O&&A&&d.copy(I),(O||A)&&!tm(d.distanceTo(x))){if(y<=1)(y===1?f.start:f.end).copy(d),A&&(E=y);else if(y>=2){(E===1?f.start:f.end).copy(d),y=2;break}if(y++,y===2&&E===-1)break}}return y}return function(m,g=null,f=!1){this.needsUpdate&&this.update(),m.isExtendedTriangle?m.needsUpdate&&m.update():(s.copy(m),s.update(),m=s);const b=this.plane,y=m.plane;if(Math.abs(b.normal.dot(y.normal))>1-1e-10){const E=this.satBounds,C=this.satAxes;e[0]=m.a,e[1]=m.b,e[2]=m.c;for(let A=0;A<4;A++){const O=E[A],L=C[A];if(i.setFromPoints(L,e),O.isSeparated(i))return!1}const I=m.satBounds,x=m.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let A=0;A<4;A++){const O=I[A],L=x[A];if(i.setFromPoints(L,t),O.isSeparated(i))return!1}for(let A=0;A<4;A++){const O=C[A];for(let L=0;L<4;L++){const V=x[L];if(r.crossVectors(O,V),i.setFromPoints(r,t),n.setFromPoints(r,e),i.isSeparated(n))return!1}}return g&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),g.start.set(0,0,0),g.end.set(0,0,0)),!0}else{const E=_(this,y,u);if(E===1&&m.containsPoint(u.end))return g&&(g.start.copy(u.end),g.end.copy(u.end)),!0;if(E!==2)return!1;const C=_(m,b,p);if(C===1&&this.containsPoint(p.end))return g&&(g.start.copy(p.end),g.end.copy(p.end)),!0;if(C!==2)return!1;if(u.delta(a),p.delta(l),a.dot(l)<0){let T=p.start;p.start=p.end,p.end=T}const I=u.start.dot(a),x=u.end.dot(a),A=p.start.dot(a),O=p.end.dot(a),L=x<A,V=I<O;return I!==O&&A!==x&&L===V?!1:(g&&(h.subVectors(u.start,p.start),h.dot(a)>0?g.start.copy(u.start):g.start.copy(p.start),h.subVectors(u.end,p.end),h.dot(a)<0?g.end.copy(u.end):g.end.copy(p.end)),!0)}}}();ln.prototype.distanceToPoint=function(){const s=new F;return function(t){return this.closestPointToPoint(t,s),t.distanceTo(s)}}();ln.prototype.distanceToTriangle=function(){const s=new F,t=new F,e=["a","b","c"],i=new Gt,n=new Gt;return function(r,o=null,a=null){const l=o||a?i:null;if(this.intersectsTriangle(r,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let h=1/0;for(let c=0;c<3;c++){let u;const p=e[c],d=r[p];this.closestPointToPoint(d,s),u=d.distanceToSquared(s),u<h&&(h=u,o&&o.copy(s),a&&a.copy(d));const _=this[p];r.closestPointToPoint(_,s),u=_.distanceToSquared(s),u<h&&(h=u,o&&o.copy(_),a&&a.copy(s))}for(let c=0;c<3;c++){const u=e[c],p=e[(c+1)%3];i.set(this[u],this[p]);for(let d=0;d<3;d++){const _=e[d],m=e[(d+1)%3];n.set(r[_],r[m]),z_(i,n,s,t);const g=s.distanceToSquared(t);g<h&&(h=g,o&&o.copy(s),a&&a.copy(t))}}return Math.sqrt(h)}}();class Bs{constructor(t,e,i){this.isOrientedBox=!0,this.min=new F,this.max=new F,this.matrix=new vt,this.invMatrix=new vt,this.points=new Array(8).fill().map(()=>new F),this.satAxes=new Array(3).fill().map(()=>new F),this.satBounds=new Array(3).fill().map(()=>new ur),this.alignedSatBounds=new Array(3).fill().map(()=>new ur),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),i&&this.matrix.copy(i)}set(t,e,i){this.min.copy(t),this.max.copy(e),this.matrix.copy(i),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}Bs.prototype.update=function(){return function(){const s=this.matrix,t=this.min,e=this.max,i=this.points;for(let l=0;l<=1;l++)for(let h=0;h<=1;h++)for(let c=0;c<=1;c++){const u=1*l|2*h|4*c,p=i[u];p.x=l?e.x:t.x,p.y=h?e.y:t.y,p.z=c?e.z:t.z,p.applyMatrix4(s)}const n=this.satBounds,r=this.satAxes,o=i[0];for(let l=0;l<3;l++){const h=r[l],c=n[l],u=1<<l,p=i[u];h.subVectors(o,p),c.setFromPoints(h,i)}const a=this.alignedSatBounds;a[0].setFromPointsField(i,"x"),a[1].setFromPointsField(i,"y"),a[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Bs.prototype.intersectsBox=function(){const s=new ur;return function(t){this.needsUpdate&&this.update();const e=t.min,i=t.max,n=this.satBounds,r=this.satAxes,o=this.alignedSatBounds;if(s.min=e.x,s.max=i.x,o[0].isSeparated(s)||(s.min=e.y,s.max=i.y,o[1].isSeparated(s))||(s.min=e.z,s.max=i.z,o[2].isSeparated(s)))return!1;for(let a=0;a<3;a++){const l=r[a],h=n[a];if(s.setFromBox(l,t),h.isSeparated(s))return!1}return!0}}();Bs.prototype.intersectsTriangle=function(){const s=new ln,t=new Array(3),e=new ur,i=new ur,n=new F;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(s.copy(r),s.update(),r=s);const o=this.satBounds,a=this.satAxes;t[0]=r.a,t[1]=r.b,t[2]=r.c;for(let u=0;u<3;u++){const p=o[u],d=a[u];if(e.setFromPoints(d,t),p.isSeparated(e))return!1}const l=r.satBounds,h=r.satAxes,c=this.points;for(let u=0;u<3;u++){const p=l[u],d=h[u];if(e.setFromPoints(d,c),p.isSeparated(e))return!1}for(let u=0;u<3;u++){const p=a[u];for(let d=0;d<4;d++){const _=h[d];if(n.crossVectors(p,_),e.setFromPoints(n,t),i.setFromPoints(n,c),e.isSeparated(i))return!1}}return!0}}();Bs.prototype.closestPointToPoint=function(){return function(s,t){return this.needsUpdate&&this.update(),t.copy(s).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();Bs.prototype.distanceToPoint=function(){const s=new F;return function(t){return this.closestPointToPoint(t,s),t.distanceTo(s)}}();Bs.prototype.distanceToBox=function(){const s=["x","y","z"],t=new Array(12).fill().map(()=>new Gt),e=new Array(12).fill().map(()=>new Gt),i=new F,n=new F;return function(r,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(a||l)&&(r.getCenter(n),this.closestPointToPoint(n,i),r.closestPointToPoint(i,n),a&&a.copy(i),l&&l.copy(n)),0;const h=o*o,c=r.min,u=r.max,p=this.points;let d=1/0;for(let m=0;m<8;m++){const g=p[m];n.copy(g).clamp(c,u);const f=g.distanceToSquared(n);if(f<d&&(d=f,a&&a.copy(g),l&&l.copy(n),f<h))return Math.sqrt(f)}let _=0;for(let m=0;m<3;m++)for(let g=0;g<=1;g++)for(let f=0;f<=1;f++){const b=(m+1)%3,y=(m+2)%3,E=g<<b|f<<y,C=1<<m|g<<b|f<<y,I=p[E],x=p[C];t[_].set(I,x);const A=s[m],O=s[b],L=s[y],V=e[_],T=V.start,N=V.end;T[A]=c[A],T[O]=g?c[O]:u[O],T[L]=f?c[L]:u[O],N[A]=u[A],N[O]=g?c[O]:u[O],N[L]=f?c[L]:u[O],_++}for(let m=0;m<=1;m++)for(let g=0;g<=1;g++)for(let f=0;f<=1;f++){n.x=m?u.x:c.x,n.y=g?u.y:c.y,n.z=f?u.z:c.z,this.closestPointToPoint(n,i);const b=n.distanceToSquared(i);if(b<d&&(d=b,a&&a.copy(i),l&&l.copy(n),b<h))return Math.sqrt(b)}for(let m=0;m<12;m++){const g=t[m];for(let f=0;f<12;f++){const b=e[f];z_(g,b,i,n);const y=i.distanceToSquared(n);if(y<d&&(d=y,a&&a.copy(i),l&&l.copy(n),y<h))return Math.sqrt(y)}}return Math.sqrt(d)}}();class U_{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}class tR extends U_{constructor(){super(()=>new ln)}}const Fi=new tR;function ui(s,t){return t[s+15]===65535}function mi(s,t){return t[s+6]}function Ri(s,t){return t[s+14]}function Li(s){return s+8}function Ni(s,t){return t[s+6]}function nE(s,t){return t[s+7]}class eR{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=i=>{e&&t.push(e),e=i,this.float32Array=new Float32Array(i),this.uint16Array=new Uint16Array(i),this.uint32Array=new Uint32Array(i)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,t.length!==0&&this.setBuffer(t.pop())}}}const _e=new eR;let Yr,al;const _a=[],Lu=new U_(()=>new Tt);function sR(s,t,e,i,n,r){Yr=Lu.getPrimitive(),al=Lu.getPrimitive(),_a.push(Yr,al),_e.setBuffer(s._roots[t]);const o=Ag(0,s.geometry,e,i,n,r);_e.clearBuffer(),Lu.releasePrimitive(Yr),Lu.releasePrimitive(al),_a.pop(),_a.pop();const a=_a.length;return a>0&&(al=_a[a-1],Yr=_a[a-2]),o}function Ag(s,t,e,i,n=null,r=0,o=0){const{float32Array:a,uint16Array:l,uint32Array:h}=_e;let c=s*2;if(ui(c,l)){const u=mi(s,h),p=Ri(c,l);return Se(s,a,Yr),i(u,p,!1,o,r+s,Yr)}else{let u=function(V){const{uint16Array:T,uint32Array:N}=_e;let v=V*2;for(;!ui(v,T);)V=Li(V),v=V*2;return mi(V,N)},p=function(V){const{uint16Array:T,uint32Array:N}=_e;let v=V*2;for(;!ui(v,T);)V=Ni(V,N),v=V*2;return mi(V,N)+Ri(v,T)};const d=Li(s),_=Ni(s,h);let m=d,g=_,f,b,y,E;if(n&&(y=Yr,E=al,Se(m,a,y),Se(g,a,E),f=n(y),b=n(E),b<f)){m=_,g=d;const V=f;f=b,b=V,y=E}y||(y=Yr,Se(m,a,y));const C=ui(m*2,l),I=e(y,C,f,o+1,r+m);let x;if(I===T0){const V=u(m),T=p(m)-V;x=i(V,T,!0,o+1,r+m,y)}else x=I&&Ag(m,t,e,i,n,r,o+1);if(x)return!0;E=al,Se(g,a,E);const A=ui(g*2,l),O=e(E,A,b,o+1,r+g);let L;if(O===T0){const V=u(g),T=p(g)-V;L=i(V,T,!0,o+1,r+g,E)}else L=O&&Ag(g,t,e,i,n,r,o+1);return!!L}}const ih=new F,em=new F;function iR(s,t,e={},i=0,n=1/0){const r=i*i,o=n*n;let a=1/0,l=null;if(s.shapecast({boundsTraverseOrder:c=>(ih.copy(t).clamp(c.min,c.max),ih.distanceToSquared(t)),intersectsBounds:(c,u,p)=>p<a&&p<o,intersectsTriangle:(c,u)=>{c.closestPointToPoint(t,ih);const p=t.distanceToSquared(ih);return p<a&&(em.copy(ih),a=p,l=u),p<r}}),a===1/0)return null;const h=Math.sqrt(a);return e.point?e.point.copy(em):e.point=em.clone(),e.distance=h,e.faceIndex=l,e}const ba=new F,ya=new F,va=new F,Nu=new Bt,Mu=new Bt,Du=new Bt,F0=new F,R0=new F,L0=new F,ku=new F;function nR(s,t,e,i,n,r){let o;return r===Tw?o=s.intersectTriangle(i,e,t,!0,n):o=s.intersectTriangle(t,e,i,r!==Wn,n),o===null?null:{distance:s.origin.distanceTo(n),point:n.clone()}}function rR(s,t,e,i,n,r,o,a,l){ba.fromBufferAttribute(t,r),ya.fromBufferAttribute(t,o),va.fromBufferAttribute(t,a);const h=nR(s,ba,ya,va,ku,l);if(h){i&&(Nu.fromBufferAttribute(i,r),Mu.fromBufferAttribute(i,o),Du.fromBufferAttribute(i,a),h.uv=ks.getInterpolation(ku,ba,ya,va,Nu,Mu,Du,new Bt)),n&&(Nu.fromBufferAttribute(n,r),Mu.fromBufferAttribute(n,o),Du.fromBufferAttribute(n,a),h.uv1=ks.getInterpolation(ku,ba,ya,va,Nu,Mu,Du,new Bt)),e&&(F0.fromBufferAttribute(e,r),R0.fromBufferAttribute(e,o),L0.fromBufferAttribute(e,a),h.normal=ks.getInterpolation(ku,ba,ya,va,F0,R0,L0,new F),h.normal.dot(s.direction)>0&&h.normal.multiplyScalar(-1));const c={a:r,b:o,c:a,normal:new F,materialIndex:0};ks.getNormal(ba,ya,va,c.normal),h.face=c,h.faceIndex=r}return h}function Gp(s,t,e,i,n){const r=i*3;let o=r+0,a=r+1,l=r+2;const h=s.index;s.index&&(o=h.getX(o),a=h.getX(a),l=h.getX(l));const{position:c,normal:u,uv:p,uv1:d}=s.attributes,_=rR(e,c,u,p,d,o,a,l,t);return _?(_.faceIndex=i,n&&n.push(_),_):null}function je(s,t,e,i){const n=s.a,r=s.b,o=s.c;let a=t,l=t+1,h=t+2;e&&(a=e.getX(a),l=e.getX(l),h=e.getX(h)),n.x=i.getX(a),n.y=i.getY(a),n.z=i.getZ(a),r.x=i.getX(l),r.y=i.getY(l),r.z=i.getZ(l),o.x=i.getX(h),o.y=i.getY(h),o.z=i.getZ(h)}function oR(s,t,e,i,n,r){const{geometry:o,_indirectBuffer:a}=s;for(let l=i,h=i+n;l<h;l++)Gp(o,t,e,l,r)}function aR(s,t,e,i,n){const{geometry:r,_indirectBuffer:o}=s;let a=1/0,l=null;for(let h=i,c=i+n;h<c;h++){let u;u=Gp(r,t,e,h),u&&u.distance<a&&(l=u,a=u.distance)}return l}function lR(s,t,e,i,n,r,o){const{geometry:a}=e,{index:l}=a,h=a.attributes.position;for(let c=s,u=t+s;c<u;c++){let p;if(p=c,je(o,p*3,l,h),o.needsUpdate=!0,i(o,p,n,r))return!0}return!1}function hR(s,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=s.geometry,i=e.index?e.index.array:null,n=e.attributes.position;let r,o,a,l,h=0;const c=s._roots;for(let p=0,d=c.length;p<d;p++)r=c[p],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),u(0,h),h+=r.byteLength;function u(p,d,_=!1){const m=p*2;if(a[m+15]===Wp){const g=o[p+6],f=a[m+14];let b=1/0,y=1/0,E=1/0,C=-1/0,I=-1/0,x=-1/0;for(let A=3*g,O=3*(g+f);A<O;A++){let L=i[A];const V=n.getX(L),T=n.getY(L),N=n.getZ(L);V<b&&(b=V),V>C&&(C=V),T<y&&(y=T),T>I&&(I=T),N<E&&(E=N),N>x&&(x=N)}return l[p+0]!==b||l[p+1]!==y||l[p+2]!==E||l[p+3]!==C||l[p+4]!==I||l[p+5]!==x?(l[p+0]=b,l[p+1]=y,l[p+2]=E,l[p+3]=C,l[p+4]=I,l[p+5]=x,!0):!1}else{const g=p+8,f=o[p+6],b=g+d,y=f+d;let E=_,C=!1,I=!1;t?E||(C=t.has(b),I=t.has(y),E=!C&&!I):(C=!0,I=!0);const x=E||C,A=E||I;let O=!1;x&&(O=u(g,d,E));let L=!1;A&&(L=u(f,d,E));const V=O||L;if(V)for(let T=0;T<3;T++){const N=g+T,v=f+T,M=l[N],Q=l[N+3],j=l[v],it=l[v+3];l[p+T]=M<j?M:j,l[p+T+3]=Q>it?Q:it}return V}}}const N0=new Tt;function so(s,t,e,i){return Se(s,t,N0),e.intersectBox(N0,i)}function cR(s,t,e,i,n,r){const{geometry:o,_indirectBuffer:a}=s;for(let l=i,h=i+n;l<h;l++){let c=a?a[l]:l;Gp(o,t,e,c,r)}}function uR(s,t,e,i,n){const{geometry:r,_indirectBuffer:o}=s;let a=1/0,l=null;for(let h=i,c=i+n;h<c;h++){let u;u=Gp(r,t,e,o?o[h]:h),u&&u.distance<a&&(l=u,a=u.distance)}return l}function dR(s,t,e,i,n,r,o){const{geometry:a}=e,{index:l}=a,h=a.attributes.position;for(let c=s,u=t+s;c<u;c++){let p;if(p=e.resolveTriangleIndex(c),je(o,p*3,l,h),o.needsUpdate=!0,i(o,p,n,r))return!0}return!1}const M0=new F;function pR(s,t,e,i,n){_e.setBuffer(s._roots[t]),Sg(0,s,e,i,n),_e.clearBuffer()}function Sg(s,t,e,i,n){const{float32Array:r,uint16Array:o,uint32Array:a}=_e,l=s*2;if(ui(l,o)){const h=mi(s,a),c=Ri(l,o);oR(t,e,i,h,c,n)}else{const h=Li(s);so(h,r,i,M0)&&Sg(h,t,e,i,n);const c=Ni(s,a);so(c,r,i,M0)&&Sg(c,t,e,i,n)}}const D0=new F,fR=["x","y","z"];function mR(s,t,e,i){_e.setBuffer(s._roots[t]);const n=Og(0,s,e,i);return _e.clearBuffer(),n}function Og(s,t,e,i){const{float32Array:n,uint16Array:r,uint32Array:o}=_e;let a=s*2;if(ui(a,r)){const l=mi(s,o),h=Ri(a,r);return aR(t,e,i,l,h)}else{const l=nE(s,o),h=fR[l],c=i.direction[h]>=0;let u,p;c?(u=Li(s),p=Ni(s,o)):(u=Ni(s,o),p=Li(s));const d=so(u,n,i,D0)?Og(u,t,e,i):null;if(d){const m=d.point[h];if(c?m<=n[p+l]:m>=n[p+l+3])return d}const _=so(p,n,i,D0)?Og(p,t,e,i):null;return d&&_?d.distance<=_.distance?d:_:d||_||null}}const zu=new Tt,wa=new ln,Ea=new ln,nh=new vt,k0=new Bs,Uu=new Bs;function gR(s,t,e,i){_e.setBuffer(s._roots[t]);const n=Pg(0,s,e,i);return _e.clearBuffer(),n}function Pg(s,t,e,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=_e;let l=s*2;if(n===null&&(e.boundingBox||e.computeBoundingBox(),k0.set(e.boundingBox.min,e.boundingBox.max,i),n=k0),ui(l,o)){const h=t.geometry,c=h.index,u=h.attributes.position,p=e.index,d=e.attributes.position,_=mi(s,a),m=Ri(l,o);if(nh.copy(i).invert(),e.boundsTree)return Se(s,r,Uu),Uu.matrix.copy(nh),Uu.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:g=>Uu.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(i),g.b.applyMatrix4(i),g.c.applyMatrix4(i),g.needsUpdate=!0;for(let f=_*3,b=(m+_)*3;f<b;f+=3)if(je(Ea,f,c,u),Ea.needsUpdate=!0,g.intersectsTriangle(Ea))return!0;return!1}});for(let g=_*3,f=(m+_)*3;g<f;g+=3){je(wa,g,c,u),wa.a.applyMatrix4(nh),wa.b.applyMatrix4(nh),wa.c.applyMatrix4(nh),wa.needsUpdate=!0;for(let b=0,y=p.count;b<y;b+=3)if(je(Ea,b,p,d),Ea.needsUpdate=!0,wa.intersectsTriangle(Ea))return!0}}else{const h=s+8,c=a[s+6];return Se(h,r,zu),!!(n.intersectsBox(zu)&&Pg(h,t,e,i,n)||(Se(c,r,zu),n.intersectsBox(zu)&&Pg(c,t,e,i,n)))}}const Bu=new vt,sm=new Bs,rh=new Bs,_R=new F,bR=new F,yR=new F,vR=new F;function wR(s,t,e,i={},n={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),sm.set(t.boundingBox.min,t.boundingBox.max,e),sm.needsUpdate=!0;const a=s.geometry,l=a.attributes.position,h=a.index,c=t.attributes.position,u=t.index,p=Fi.getPrimitive(),d=Fi.getPrimitive();let _=_R,m=bR,g=null,f=null;n&&(g=yR,f=vR);let b=1/0,y=null,E=null;return Bu.copy(e).invert(),rh.matrix.copy(Bu),s.shapecast({boundsTraverseOrder:C=>sm.distanceToBox(C),intersectsBounds:(C,I,x)=>x<b&&x<o?(I&&(rh.min.copy(C.min),rh.max.copy(C.max),rh.needsUpdate=!0),!0):!1,intersectsRange:(C,I)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:x=>rh.distanceToBox(x),intersectsBounds:(x,A,O)=>O<b&&O<o,intersectsRange:(x,A)=>{for(let O=x,L=x+A;O<L;O++){je(d,3*O,u,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let V=C,T=C+I;V<T;V++){je(p,3*V,h,l),p.needsUpdate=!0;const N=p.distanceToTriangle(d,_,g);if(N<b&&(m.copy(_),f&&f.copy(g),b=N,y=V,E=O),N<r)return!0}}}});{const x=Nl(t);for(let A=0,O=x;A<O;A++){je(d,3*A,u,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let L=C,V=C+I;L<V;L++){je(p,3*L,h,l),p.needsUpdate=!0;const T=p.distanceToTriangle(d,_,g);if(T<b&&(m.copy(_),f&&f.copy(g),b=T,y=L,E=A),T<r)return!0}}}}}),Fi.releasePrimitive(p),Fi.releasePrimitive(d),b===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=b,i.faceIndex=y,n&&(n.point?n.point.copy(f):n.point=f.clone(),n.point.applyMatrix4(Bu),m.applyMatrix4(Bu),n.distance=m.sub(n.point).length(),n.faceIndex=E),i)}function ER(s,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=s.geometry,i=e.index?e.index.array:null,n=e.attributes.position;let r,o,a,l,h=0;const c=s._roots;for(let p=0,d=c.length;p<d;p++)r=c[p],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),u(0,h),h+=r.byteLength;function u(p,d,_=!1){const m=p*2;if(a[m+15]===Wp){const g=o[p+6],f=a[m+14];let b=1/0,y=1/0,E=1/0,C=-1/0,I=-1/0,x=-1/0;for(let A=g,O=g+f;A<O;A++){const L=3*s.resolveTriangleIndex(A);for(let V=0;V<3;V++){let T=L+V;T=i?i[T]:T;const N=n.getX(T),v=n.getY(T),M=n.getZ(T);N<b&&(b=N),N>C&&(C=N),v<y&&(y=v),v>I&&(I=v),M<E&&(E=M),M>x&&(x=M)}}return l[p+0]!==b||l[p+1]!==y||l[p+2]!==E||l[p+3]!==C||l[p+4]!==I||l[p+5]!==x?(l[p+0]=b,l[p+1]=y,l[p+2]=E,l[p+3]=C,l[p+4]=I,l[p+5]=x,!0):!1}else{const g=p+8,f=o[p+6],b=g+d,y=f+d;let E=_,C=!1,I=!1;t?E||(C=t.has(b),I=t.has(y),E=!C&&!I):(C=!0,I=!0);const x=E||C,A=E||I;let O=!1;x&&(O=u(g,d,E));let L=!1;A&&(L=u(f,d,E));const V=O||L;if(V)for(let T=0;T<3;T++){const N=g+T,v=f+T,M=l[N],Q=l[N+3],j=l[v],it=l[v+3];l[p+T]=M<j?M:j,l[p+T+3]=Q>it?Q:it}return V}}}const z0=new F;function CR(s,t,e,i,n){_e.setBuffer(s._roots[t]),Fg(0,s,e,i,n),_e.clearBuffer()}function Fg(s,t,e,i,n){const{float32Array:r,uint16Array:o,uint32Array:a}=_e,l=s*2;if(ui(l,o)){const h=mi(s,a),c=Ri(l,o);cR(t,e,i,h,c,n)}else{const h=Li(s);so(h,r,i,z0)&&Fg(h,t,e,i,n);const c=Ni(s,a);so(c,r,i,z0)&&Fg(c,t,e,i,n)}}const U0=new F,IR=["x","y","z"];function xR(s,t,e,i){_e.setBuffer(s._roots[t]);const n=Rg(0,s,e,i);return _e.clearBuffer(),n}function Rg(s,t,e,i){const{float32Array:n,uint16Array:r,uint32Array:o}=_e;let a=s*2;if(ui(a,r)){const l=mi(s,o),h=Ri(a,r);return uR(t,e,i,l,h)}else{const l=nE(s,o),h=IR[l],c=i.direction[h]>=0;let u,p;c?(u=Li(s),p=Ni(s,o)):(u=Ni(s,o),p=Li(s));const d=so(u,n,i,U0)?Rg(u,t,e,i):null;if(d){const m=d.point[h];if(c?m<=n[p+l]:m>=n[p+l+3])return d}const _=so(p,n,i,U0)?Rg(p,t,e,i):null;return d&&_?d.distance<=_.distance?d:_:d||_||null}}const Vu=new Tt,Ca=new ln,Ia=new ln,oh=new vt,B0=new Bs,$u=new Bs;function TR(s,t,e,i){_e.setBuffer(s._roots[t]);const n=Lg(0,s,e,i);return _e.clearBuffer(),n}function Lg(s,t,e,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=_e;let l=s*2;if(n===null&&(e.boundingBox||e.computeBoundingBox(),B0.set(e.boundingBox.min,e.boundingBox.max,i),n=B0),ui(l,o)){const h=t.geometry,c=h.index,u=h.attributes.position,p=e.index,d=e.attributes.position,_=mi(s,a),m=Ri(l,o);if(oh.copy(i).invert(),e.boundsTree)return Se(s,r,$u),$u.matrix.copy(oh),$u.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:g=>$u.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(i),g.b.applyMatrix4(i),g.c.applyMatrix4(i),g.needsUpdate=!0;for(let f=_,b=m+_;f<b;f++)if(je(Ia,3*t.resolveTriangleIndex(f),c,u),Ia.needsUpdate=!0,g.intersectsTriangle(Ia))return!0;return!1}});for(let g=_,f=m+_;g<f;g++){const b=t.resolveTriangleIndex(g);je(Ca,3*b,c,u),Ca.a.applyMatrix4(oh),Ca.b.applyMatrix4(oh),Ca.c.applyMatrix4(oh),Ca.needsUpdate=!0;for(let y=0,E=p.count;y<E;y+=3)if(je(Ia,y,p,d),Ia.needsUpdate=!0,Ca.intersectsTriangle(Ia))return!0}}else{const h=s+8,c=a[s+6];return Se(h,r,Vu),!!(n.intersectsBox(Vu)&&Lg(h,t,e,i,n)||(Se(c,r,Vu),n.intersectsBox(Vu)&&Lg(c,t,e,i,n)))}}const Hu=new vt,im=new Bs,ah=new Bs,AR=new F,SR=new F,OR=new F,PR=new F;function FR(s,t,e,i={},n={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),im.set(t.boundingBox.min,t.boundingBox.max,e),im.needsUpdate=!0;const a=s.geometry,l=a.attributes.position,h=a.index,c=t.attributes.position,u=t.index,p=Fi.getPrimitive(),d=Fi.getPrimitive();let _=AR,m=SR,g=null,f=null;n&&(g=OR,f=PR);let b=1/0,y=null,E=null;return Hu.copy(e).invert(),ah.matrix.copy(Hu),s.shapecast({boundsTraverseOrder:C=>im.distanceToBox(C),intersectsBounds:(C,I,x)=>x<b&&x<o?(I&&(ah.min.copy(C.min),ah.max.copy(C.max),ah.needsUpdate=!0),!0):!1,intersectsRange:(C,I)=>{if(t.boundsTree){const x=t.boundsTree;return x.shapecast({boundsTraverseOrder:A=>ah.distanceToBox(A),intersectsBounds:(A,O,L)=>L<b&&L<o,intersectsRange:(A,O)=>{for(let L=A,V=A+O;L<V;L++){const T=x.resolveTriangleIndex(L);je(d,3*T,u,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let N=C,v=C+I;N<v;N++){const M=s.resolveTriangleIndex(N);je(p,3*M,h,l),p.needsUpdate=!0;const Q=p.distanceToTriangle(d,_,g);if(Q<b&&(m.copy(_),f&&f.copy(g),b=Q,y=N,E=L),Q<r)return!0}}}})}else{const x=Nl(t);for(let A=0,O=x;A<O;A++){je(d,3*A,u,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let L=C,V=C+I;L<V;L++){const T=s.resolveTriangleIndex(L);je(p,3*T,h,l),p.needsUpdate=!0;const N=p.distanceToTriangle(d,_,g);if(N<b&&(m.copy(_),f&&f.copy(g),b=N,y=L,E=A),N<r)return!0}}}}}),Fi.releasePrimitive(p),Fi.releasePrimitive(d),b===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=b,i.faceIndex=y,n&&(n.point?n.point.copy(f):n.point=f.clone(),n.point.applyMatrix4(Hu),m.applyMatrix4(Hu),n.distance=m.sub(n.point).length(),n.faceIndex=E),i)}function RR(){return typeof SharedArrayBuffer<"u"}const hc=new _e.constructor,dp=new _e.constructor,Mr=new U_(()=>new Tt),xa=new Tt,Ta=new Tt,nm=new Tt,rm=new Tt;let om=!1;function LR(s,t,e,i){if(om)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");om=!0;const n=s._roots,r=t._roots;let o,a=0,l=0;const h=new vt().copy(e).invert();for(let c=0,u=n.length;c<u;c++){hc.setBuffer(n[c]),l=0;const p=Mr.getPrimitive();Se(0,hc.float32Array,p),p.applyMatrix4(h);for(let d=0,_=r.length;d<_&&(dp.setBuffer(r[c]),o=Xi(0,0,e,h,i,a,l,0,0,p),dp.clearBuffer(),l+=r[d].length,!o);d++);if(Mr.releasePrimitive(p),hc.clearBuffer(),a+=n[c].length,o)break}return om=!1,o}function Xi(s,t,e,i,n,r=0,o=0,a=0,l=0,h=null,c=!1){let u,p;c?(u=dp,p=hc):(u=hc,p=dp);const d=u.float32Array,_=u.uint32Array,m=u.uint16Array,g=p.float32Array,f=p.uint32Array,b=p.uint16Array,y=s*2,E=t*2,C=ui(y,m),I=ui(E,b);let x=!1;if(I&&C)c?x=n(mi(t,f),Ri(t*2,b),mi(s,_),Ri(s*2,m),l,o+t,a,r+s):x=n(mi(s,_),Ri(s*2,m),mi(t,f),Ri(t*2,b),a,r+s,l,o+t);else if(I){const A=Mr.getPrimitive();Se(t,g,A),A.applyMatrix4(e);const O=Li(s),L=Ni(s,_);Se(O,d,xa),Se(L,d,Ta);const V=A.intersectsBox(xa),T=A.intersectsBox(Ta);x=V&&Xi(t,O,i,e,n,o,r,l,a+1,A,!c)||T&&Xi(t,L,i,e,n,o,r,l,a+1,A,!c),Mr.releasePrimitive(A)}else{const A=Li(t),O=Ni(t,f);Se(A,g,nm),Se(O,g,rm);const L=h.intersectsBox(nm),V=h.intersectsBox(rm);if(L&&V)x=Xi(s,A,e,i,n,r,o,a,l+1,h,c)||Xi(s,O,e,i,n,r,o,a,l+1,h,c);else if(L)if(C)x=Xi(s,A,e,i,n,r,o,a,l+1,h,c);else{const T=Mr.getPrimitive();T.copy(nm).applyMatrix4(e);const N=Li(s),v=Ni(s,_);Se(N,d,xa),Se(v,d,Ta);const M=T.intersectsBox(xa),Q=T.intersectsBox(Ta);x=M&&Xi(A,N,i,e,n,o,r,l,a+1,T,!c)||Q&&Xi(A,v,i,e,n,o,r,l,a+1,T,!c),Mr.releasePrimitive(T)}else if(V)if(C)x=Xi(s,O,e,i,n,r,o,a,l+1,h,c);else{const T=Mr.getPrimitive();T.copy(rm).applyMatrix4(e);const N=Li(s),v=Ni(s,_);Se(N,d,xa),Se(v,d,Ta);const M=T.intersectsBox(xa),Q=T.intersectsBox(Ta);x=M&&Xi(O,N,i,e,n,o,r,l,a+1,T,!c)||Q&&Xi(O,v,i,e,n,o,r,l,a+1,T,!c),Mr.releasePrimitive(T)}}return x}const ju=new Bs,V0=new Tt;class B_{static serialize(t,e={}){e={cloneBuffers:!0,...e};const i=t.geometry,n=t._roots,r=t._indirectBuffer,o=i.getIndex();let a;return e.cloneBuffers?a={roots:n.map(l=>l.slice()),index:o.array.slice(),indirectBuffer:r?r.slice():null}:a={roots:n,index:o.array,indirectBuffer:r},a}static deserialize(t,e,i={}){i={setIndex:!0,indirect:!!t.indirectBuffer,...i};const{index:n,roots:r,indirectBuffer:o}=t,a=new B_(e,{...i,[Kf]:!0});if(a._roots=r,a._indirectBuffer=o||null,i.setIndex){const l=e.getIndex();if(l===null){const h=new Ve(t.index,1,!1);e.setIndex(h)}else l.array!==n&&(l.array.set(n),l.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({strategy:eE,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[Kf]:!1},e),e.useSharedArrayBuffer&&!RR())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[Kf]||(XF(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new Tt)));const{_indirectBuffer:i}=this;this.resolveTriangleIndex=e.indirect?n=>i[n]:n=>n}refit(t=null){return(this.indirect?ER:hR)(this,t)}traverse(t,e=0){const i=this._roots[e],n=new Uint32Array(i),r=new Uint16Array(i);o(0);function o(a,l=0){const h=a*2,c=r[h+15]===Wp;if(c){const u=n[a+6],p=r[h+14];t(l,c,new Float32Array(i,a*4,6),u,p)}else{const u=a+Bd/4,p=n[a+6],d=n[a+7];t(l,c,new Float32Array(i,a*4,6),d)||(o(u,l+1),o(p,l+1))}}}raycast(t,e=ep){const i=this._roots,n=this.geometry,r=[],o=e.isMaterial,a=Array.isArray(e),l=n.groups,h=o?e.side:e,c=this.indirect?CR:pR;for(let u=0,p=i.length;u<p;u++){const d=a?e[l[u].materialIndex].side:h,_=r.length;if(c(this,u,d,t,r),a){const m=l[u].materialIndex;for(let g=_,f=r.length;g<f;g++)r[g].face.materialIndex=m}}return r}raycastFirst(t,e=ep){const i=this._roots,n=this.geometry,r=e.isMaterial,o=Array.isArray(e);let a=null;const l=n.groups,h=r?e.side:e,c=this.indirect?xR:mR;for(let u=0,p=i.length;u<p;u++){const d=o?e[l[u].materialIndex].side:h,_=c(this,u,d,t);_!=null&&(a==null||_.distance<a.distance)&&(a=_,o&&(_.face.materialIndex=l[u].materialIndex))}return a}intersectsGeometry(t,e){let i=!1;const n=this._roots,r=this.indirect?TR:gR;for(let o=0,a=n.length;o<a&&(i=r(this,o,t,e),!i);o++);return i}shapecast(t){const e=Fi.getPrimitive(),i=this.indirect?dR:lR;let{boundsTraverseOrder:n,intersectsBounds:r,intersectsRange:o,intersectsTriangle:a}=t;if(o&&a){const u=o;o=(p,d,_,m,g)=>u(p,d,_,m,g)?!0:i(p,d,this,a,_,m,e)}else o||(a?o=(u,p,d,_)=>i(u,p,this,a,d,_,e):o=(u,p,d)=>d);let l=!1,h=0;const c=this._roots;for(let u=0,p=c.length;u<p;u++){const d=c[u];if(l=sR(this,u,r,o,n,h),l)break;h+=d.byteLength}return Fi.releasePrimitive(e),l}bvhcast(t,e,i){let{intersectsRanges:n,intersectsTriangles:r}=i;const o=Fi.getPrimitive(),a=this.geometry.index,l=this.geometry.attributes.position,h=this.indirect?_=>{const m=this.resolveTriangleIndex(_);je(o,m*3,a,l)}:_=>{je(o,_*3,a,l)},c=Fi.getPrimitive(),u=t.geometry.index,p=t.geometry.attributes.position,d=t.indirect?_=>{const m=t.resolveTriangleIndex(_);je(c,m*3,u,p)}:_=>{je(c,_*3,u,p)};if(r){const _=(m,g,f,b,y,E,C,I)=>{for(let x=f,A=f+b;x<A;x++){d(x),c.a.applyMatrix4(e),c.b.applyMatrix4(e),c.c.applyMatrix4(e),c.needsUpdate=!0;for(let O=m,L=m+g;O<L;O++)if(h(O),o.needsUpdate=!0,r(o,c,O,x,y,E,C,I))return!0}return!1};if(n){const m=n;n=function(g,f,b,y,E,C,I,x){return m(g,f,b,y,E,C,I,x)?!0:_(g,f,b,y,E,C,I,x)}}else n=_}return LR(this,t,e,n)}intersectsBox(t,e){return ju.set(t.min,t.max,e),ju.needsUpdate=!0,this.shapecast({intersectsBounds:i=>ju.intersectsBox(i),intersectsTriangle:i=>ju.intersectsTriangle(i)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,i={},n={},r=0,o=1/0){return(this.indirect?FR:wR)(this,t,e,i,n,r,o)}closestPointToPoint(t,e={},i=0,n=1/0){return iR(this,t,e,i,n)}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(e=>{Se(0,new Float32Array(e),V0),t.union(V0)}),t}}function $0(s,t,e){return s===null||(s.point.applyMatrix4(t.matrixWorld),s.distance=s.point.distanceTo(e.ray.origin),s.object=t,s.distance<e.near||s.distance>e.far)?null:s}const am=new Jr,H0=new vt,NR=lt.prototype.raycast;function MR(s,t){if(this.geometry.boundsTree){if(this.material===void 0)return;H0.copy(this.matrixWorld).invert(),am.copy(s.ray).applyMatrix4(H0);const e=this.geometry.boundsTree;if(s.firstHitOnly===!0){const i=$0(e.raycastFirst(am,this.material),this,s);i&&t.push(i)}else{const i=e.raycast(am,this.material);for(let n=0,r=i.length;n<r;n++){const o=$0(i[n],this,s);o&&t.push(o)}}}else NR.call(this,s,t)}function DR(s){return this.boundsTree=new B_(this,s),this.boundsTree}function kR(){this.boundsTree=null}const rE=class oE{constructor(){D(this,"onDisposed",new Et),D(this,"list",new Map),D(this,"enabled",!1),D(this,"_clock"),D(this,"onInit",new Et),D(this,"update",()=>{if(!this.enabled)return;const t=this._clock.getDelta();for(const[e,i]of this.list)i.enabled&&i.isUpdateable()&&i.update(t);requestAnimationFrame(this.update)}),this._clock=new uw,oE.setupBVH()}add(t,e){if(this.list.has(t))throw new Error("You're trying to add a component that already exists in the components instance. Use Components.get() instead.");fi.validate(t),this.list.set(t,e)}get(t){const e=t.uuid;if(!this.list.has(e)){const i=new t(this);return i.isDisposeable()&&i.onDisposed.add(()=>this.list.delete(e)),this.list.has(e)||this.add(e,i),i}return this.list.get(e)}init(){this.enabled=!0;for(const[t,e]of this.list.entries())e.enabled=!0;this._clock.start(),this.update(),this.onInit.trigger()}dispose(){this.enabled=!1;let t;for(const[e,i]of this.list){if(i.enabled=!1,e===Rt.uuid){t=i;continue}i.isDisposeable()&&i.dispose()}t==null||t.dispose(),this._clock.stop(),this.onDisposed.trigger()}static setupBVH(){ye.prototype.computeBoundsTree=DR,ye.prototype.disposeBoundsTree=kR,lt.prototype.raycast=MR}};D(rE,"release","2.4.3");let aE=rE;class zR{constructor(t){D(this,"enabled",!1),D(this,"id","FirstPerson"),this.camera=t}set(t){if(this.enabled=t,t){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const t=this.camera.controls,e=new F;t.distance--,t.getPosition(e),t.minDistance=1,t.maxDistance=1,t.distance=1,t.moveTo(e.x,e.y,e.z),t.truckSpeed=50,t.mouseButtons.wheel=As.ACTION.DOLLY,t.touches.two=As.ACTION.TOUCH_ZOOM_TRUCK}}class UR{constructor(t){D(this,"enabled",!0),D(this,"id","Orbit"),this.camera=t,this.activateOrbitControls()}set(t){this.enabled=t,t&&this.activateOrbitControls()}activateOrbitControls(){const t=this.camera.controls;t.minDistance=1,t.maxDistance=300;const e=new F;t.getPosition(e);const i=e.length();t.distance=i,t.truckSpeed=2;const{rotation:n}=this.camera.three,r=new F(0,0,-1).applyEuler(n),o=e.addScaledVector(r,i);t.moveTo(o.x,o.y,o.z)}}class BR{constructor(t){D(this,"enabled",!1),D(this,"id","Plan"),D(this,"mouseAction1"),D(this,"mouseAction2"),D(this,"mouseInitialized",!1),D(this,"defaultAzimuthSpeed"),D(this,"defaultPolarSpeed"),this.camera=t,this.defaultAzimuthSpeed=t.controls.azimuthRotateSpeed,this.defaultPolarSpeed=t.controls.polarRotateSpeed}set(t){this.enabled=t;const e=this.camera.controls;e.azimuthRotateSpeed=t?0:this.defaultAzimuthSpeed,e.polarRotateSpeed=t?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=e.touches.one,this.mouseAction2=e.touches.two,this.mouseInitialized=!0),t?(e.mouseButtons.left=As.ACTION.TRUCK,e.touches.one=As.ACTION.TOUCH_TRUCK,e.touches.two=As.ACTION.TOUCH_ZOOM):(e.mouseButtons.left=As.ACTION.ROTATE,e.touches.one=this.mouseAction1,e.touches.two=this.mouseAction2)}}class VR{constructor(t){D(this,"onChanged",new Et),D(this,"current","Perspective"),D(this,"camera"),D(this,"matchOrthoDistanceEnabled",!1),D(this,"_component"),D(this,"_previousDistance",-1),this._component=t,this.camera=t.three}async set(t){this.current!==t&&(t==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const t=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(t)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const t=this.getPerspectiveDims();if(!t)return;const{width:e,height:i}=t;this.setupOrthoCamera(i,e),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const t=this._component.currentWorld;if(!t||!t.renderer)return null;const e=new F;this._component.threePersp.getWorldDirection(e);const i=new F;this._component.controls.getTarget(i);const n=i.clone().sub(this._component.threePersp.position).dot(e),r=t.renderer.getSize(),o=r.x/r.y,a=this._component.threePersp,l=n*2*Math.atan(a.fov*(Math.PI/180)/2);return{width:l*o,height:l}}setupOrthoCamera(t,e){this._component.controls.mouseButtons.wheel=As.ACTION.ZOOM,this._component.controls.mouseButtons.middle=As.ACTION.ZOOM;const i=this._component.threePersp,n=this._component.threeOrtho;n.zoom=1,n.left=e/-2,n.right=e/2,n.top=t/2,n.bottom=t/-2,n.updateProjectionMatrix(),n.position.copy(i.position),n.quaternion.copy(i.quaternion),this._component.controls.camera=n}getDistance(){const t=this._component.threePersp,e=this._component.threeOrtho;return(e.top-e.bottom)/e.zoom/(2*Math.atan(t.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=As.ACTION.DOLLY,this._component.controls.mouseButtons.middle=As.ACTION.DOLLY;const t=this._component.threePersp,e=this._component.threeOrtho;t.position.copy(e.position),t.quaternion.copy(e.quaternion),this._component.controls.mouseButtons.wheel=As.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),t.updateProjectionMatrix(),this._component.controls.camera=t,this.camera=t,this.current="Perspective"}}class qp extends Oc{constructor(t){super(t),D(this,"projection"),D(this,"threeOrtho"),D(this,"threePersp"),D(this,"_userInputButtons",{}),D(this,"_frustumSize",50),D(this,"_navigationModes",new Map),D(this,"_mode",null),D(this,"previousSize",null),this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new VR(this),this.onAspectUpdated.add(()=>{this.setOrthoPerspCameraAspect()}),this.projection.onChanged.add(e=>{this.three=e,this.updateAspect()}),this.worlds.onItemSet.add(()=>{this._navigationModes.clear(),this._navigationModes.set("Orbit",new UR(this)),this._navigationModes.set("FirstPerson",new zR(this)),this._navigationModes.set("Plan",new BR(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0}),this.currentWorld&&this.currentWorld.renderer&&(this.previousSize=this.currentWorld.renderer.getSize().clone())}),this.worlds.onItemDeleted.add(()=>{this._navigationModes.clear()})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(t){if(this.mode!==null&&this.mode.id!==t){if(this.mode.set(!1),!this._navigationModes.has(t))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(t),this.mode.set(!0)}}async fit(t,e=1.5){if(!this.enabled)return;const i=Number.MAX_VALUE,n=Number.MIN_VALUE,r=new F(i,i,i),o=new F(n,n,n);for(const d of t){const _=new Tt().setFromObject(d);_.min.x<r.x&&(r.x=_.min.x),_.min.y<r.y&&(r.y=_.min.y),_.min.z<r.z&&(r.z=_.min.z),_.max.x>o.x&&(o.x=_.max.x),_.max.y>o.y&&(o.y=_.max.y),_.max.z>o.z&&(o.z=_.max.z)}const a=new Tt(r,o),l=this.components.get(Rt);if(l.initialized)for(const[,d]of l.list){const _=d.box;_.min.x<r.x&&(r.x=_.min.x),_.min.y<r.y&&(r.y=_.min.y),_.min.z<r.z&&(r.z=_.min.z),_.max.x>o.x&&(o.x=_.max.x),_.max.y>o.y&&(o.y=_.max.y),_.max.z>o.z&&(o.z=_.max.z)}const h=new F;a.getSize(h);const c=new F;a.getCenter(c);const u=Math.max(h.x,h.y,h.z)*e,p=new ws(c,u);await this.controls.fitToSphere(p,!0)}setUserInput(t){t?this.enableUserInput():this.disableUserInput()}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const t=window.innerWidth/window.innerHeight;return new aa(this._frustumSize*t/-2,this._frustumSize*t/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoPerspCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer||!this.previousSize)return;const t=this.currentWorld.renderer.getSize(),e=this.threeOrtho.top,i=this.threeOrtho.right,n=t.y/this.previousSize.y,r=t.x/this.previousSize.x,o=e*n,a=i*r;this.threeOrtho.left=-a,this.threeOrtho.right=a,this.threeOrtho.top=o,this.threeOrtho.bottom=-o,this.threeOrtho.updateProjectionMatrix(),this.previousSize.copy(t)}}function Yu(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var lE={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(s,t){(function(e){s.exports=e()})(function(){return function e(i,n,r){function o(h,c){if(!n[h]){if(!i[h]){var u=typeof Yu=="function"&&Yu;if(!c&&u)return u(h,!0);if(a)return a(h,!0);var p=new Error("Cannot find module '"+h+"'");throw p.code="MODULE_NOT_FOUND",p}var d=n[h]={exports:{}};i[h][0].call(d.exports,function(_){var m=i[h][1][_];return o(m||_)},d,d.exports,e,i,n,r)}return n[h].exports}for(var a=typeof Yu=="function"&&Yu,l=0;l<r.length;l++)o(r[l]);return o}({1:[function(e,i,n){var r=e("./utils"),o=e("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(l){for(var h,c,u,p,d,_,m,g=[],f=0,b=l.length,y=b,E=r.getTypeOf(l)!=="string";f<l.length;)y=b-f,u=E?(h=l[f++],c=f<b?l[f++]:0,f<b?l[f++]:0):(h=l.charCodeAt(f++),c=f<b?l.charCodeAt(f++):0,f<b?l.charCodeAt(f++):0),p=h>>2,d=(3&h)<<4|c>>4,_=1<y?(15&c)<<2|u>>6:64,m=2<y?63&u:64,g.push(a.charAt(p)+a.charAt(d)+a.charAt(_)+a.charAt(m));return g.join("")},n.decode=function(l){var h,c,u,p,d,_,m=0,g=0,f="data:";if(l.substr(0,f.length)===f)throw new Error("Invalid base64 input, it looks like a data url.");var b,y=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&y--,l.charAt(l.length-2)===a.charAt(64)&&y--,y%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=o.uint8array?new Uint8Array(0|y):new Array(0|y);m<l.length;)h=a.indexOf(l.charAt(m++))<<2|(p=a.indexOf(l.charAt(m++)))>>4,c=(15&p)<<4|(d=a.indexOf(l.charAt(m++)))>>2,u=(3&d)<<6|(_=a.indexOf(l.charAt(m++))),b[g++]=h,d!==64&&(b[g++]=c),_!==64&&(b[g++]=u);return b}},{"./support":30,"./utils":32}],2:[function(e,i,n){var r=e("./external"),o=e("./stream/DataWorker"),a=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function h(c,u,p,d,_){this.compressedSize=c,this.uncompressedSize=u,this.crc32=p,this.compression=d,this.compressedContent=_}h.prototype={getContentWorker:function(){var c=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),u=this;return c.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(c,u,p){return c.pipe(new a).pipe(new l("uncompressedSize")).pipe(u.compressWorker(p)).pipe(new l("compressedSize")).withStreamInfo("compression",u)},i.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,i,n){var r=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,i,n){var r=e("./utils"),o=function(){for(var a,l=[],h=0;h<256;h++){a=h;for(var c=0;c<8;c++)a=1&a?3988292384^a>>>1:a>>>1;l[h]=a}return l}();i.exports=function(a,l){return a!==void 0&&a.length?r.getTypeOf(a)!=="string"?function(h,c,u,p){var d=o,_=p+u;h^=-1;for(var m=p;m<_;m++)h=h>>>8^d[255&(h^c[m])];return-1^h}(0|l,a,a.length,0):function(h,c,u,p){var d=o,_=p+u;h^=-1;for(var m=p;m<_;m++)h=h>>>8^d[255&(h^c.charCodeAt(m))];return-1^h}(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(e,i,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,i,n){var r=null;r=typeof Promise<"u"?Promise:e("lie"),i.exports={Promise:r}},{lie:37}],7:[function(e,i,n){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=e("pako"),a=e("./utils"),l=e("./stream/GenericWorker"),h=r?"uint8array":"array";function c(u,p){l.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=p,this.meta={}}n.magic="\b\0",a.inherits(c,l),c.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(h,u.data),!1)},c.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(p){u.push({data:p,meta:u.meta})}},n.compressWorker=function(u){return new c("Deflate",u)},n.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,i,n){function r(d,_){var m,g="";for(m=0;m<_;m++)g+=String.fromCharCode(255&d),d>>>=8;return g}function o(d,_,m,g,f,b){var y,E,C=d.file,I=d.compression,x=b!==h.utf8encode,A=a.transformTo("string",b(C.name)),O=a.transformTo("string",h.utf8encode(C.name)),L=C.comment,V=a.transformTo("string",b(L)),T=a.transformTo("string",h.utf8encode(L)),N=O.length!==C.name.length,v=T.length!==L.length,M="",Q="",j="",it=C.dir,G=C.date,nt={crc32:0,compressedSize:0,uncompressedSize:0};_&&!m||(nt.crc32=d.crc32,nt.compressedSize=d.compressedSize,nt.uncompressedSize=d.uncompressedSize);var $=0;_&&($|=8),x||!N&&!v||($|=2048);var B=0,at=0;it&&(B|=16),f==="UNIX"?(at=798,B|=function(st,dt){var wt=st;return st||(wt=dt?16893:33204),(65535&wt)<<16}(C.unixPermissions,it)):(at=20,B|=function(st){return 63&(st||0)}(C.dosPermissions)),y=G.getUTCHours(),y<<=6,y|=G.getUTCMinutes(),y<<=5,y|=G.getUTCSeconds()/2,E=G.getUTCFullYear()-1980,E<<=4,E|=G.getUTCMonth()+1,E<<=5,E|=G.getUTCDate(),N&&(Q=r(1,1)+r(c(A),4)+O,M+="up"+r(Q.length,2)+Q),v&&(j=r(1,1)+r(c(V),4)+T,M+="uc"+r(j.length,2)+j);var J="";return J+=`
\0`,J+=r($,2),J+=I.magic,J+=r(y,2),J+=r(E,2),J+=r(nt.crc32,4),J+=r(nt.compressedSize,4),J+=r(nt.uncompressedSize,4),J+=r(A.length,2),J+=r(M.length,2),{fileRecord:u.LOCAL_FILE_HEADER+J+A+M,dirRecord:u.CENTRAL_FILE_HEADER+r(at,2)+J+r(V.length,2)+"\0\0\0\0"+r(B,4)+r(g,4)+A+M+V}}var a=e("../utils"),l=e("../stream/GenericWorker"),h=e("../utf8"),c=e("../crc32"),u=e("../signature");function p(d,_,m,g){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=_,this.zipPlatform=m,this.encodeFileName=g,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(p,l),p.prototype.push=function(d){var _=d.meta.percent||0,m=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,l.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:m?(_+100*(m-g-1))/m:100}}))},p.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var _=this.streamFiles&&!d.file.dir;if(_){var m=o(d,_,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},p.prototype.closedSource=function(d){this.accumulate=!1;var _=this.streamFiles&&!d.file.dir,m=o(d,_,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),_)this.push({data:function(g){return u.DATA_DESCRIPTOR+r(g.crc32,4)+r(g.compressedSize,4)+r(g.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},p.prototype.flush=function(){for(var d=this.bytesWritten,_=0;_<this.dirRecords.length;_++)this.push({data:this.dirRecords[_],meta:{percent:100}});var m=this.bytesWritten-d,g=function(f,b,y,E,C){var I=a.transformTo("string",C(E));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(f,2)+r(f,2)+r(b,4)+r(y,4)+r(I.length,2)+I}(this.dirRecords.length,m,d,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},p.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},p.prototype.registerPrevious=function(d){this._sources.push(d);var _=this;return d.on("data",function(m){_.processChunk(m)}),d.on("end",function(){_.closedSource(_.previous.streamInfo),_._sources.length?_.prepareNextSource():_.end()}),d.on("error",function(m){_.error(m)}),this},p.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},p.prototype.error=function(d){var _=this._sources;if(!l.prototype.error.call(this,d))return!1;for(var m=0;m<_.length;m++)try{_[m].error(d)}catch{}return!0},p.prototype.lock=function(){l.prototype.lock.call(this);for(var d=this._sources,_=0;_<d.length;_++)d[_].lock()},i.exports=p},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,i,n){var r=e("../compressions"),o=e("./ZipFileWorker");n.generateWorker=function(a,l,h){var c=new o(l.streamFiles,h,l.platform,l.encodeFileName),u=0;try{a.forEach(function(p,d){u++;var _=function(b,y){var E=b||y,C=r[E];if(!C)throw new Error(E+" is not a valid compression method !");return C}(d.options.compression,l.compression),m=d.options.compressionOptions||l.compressionOptions||{},g=d.dir,f=d.date;d._compressWorker(_,m).withStreamInfo("file",{name:p,dir:g,date:f,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(c)}),c.entriesCount=u}catch(p){c.error(p)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,i,n){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new r;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(r.prototype=e("./object")).loadAsync=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.version="3.10.1",r.loadAsync=function(o,a){return new r().loadAsync(o,a)},r.external=e("./external"),i.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,i,n){var r=e("./utils"),o=e("./external"),a=e("./utf8"),l=e("./zipEntries"),h=e("./stream/Crc32Probe"),c=e("./nodejsUtils");function u(p){return new o.Promise(function(d,_){var m=p.decompressed.getContentWorker().pipe(new h);m.on("error",function(g){_(g)}).on("end",function(){m.streamInfo.crc32!==p.decompressed.crc32?_(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}i.exports=function(p,d){var _=this;return d=r.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),c.isNode&&c.isStream(p)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",p,!0,d.optimizedBinaryString,d.base64).then(function(m){var g=new l(d);return g.load(m),g}).then(function(m){var g=[o.Promise.resolve(m)],f=m.files;if(d.checkCRC32)for(var b=0;b<f.length;b++)g.push(u(f[b]));return o.Promise.all(g)}).then(function(m){for(var g=m.shift(),f=g.files,b=0;b<f.length;b++){var y=f[b],E=y.fileNameStr,C=r.resolve(y.fileNameStr);_.file(C,y.decompressed,{binary:!0,optimizedBinaryString:!0,date:y.date,dir:y.dir,comment:y.fileCommentStr.length?y.fileCommentStr:null,unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions,createFolders:d.createFolders}),y.dir||(_.file(C).unsafeOriginalName=E)}return g.zipComment.length&&(_.comment=g.zipComment),_})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,i,n){var r=e("../utils"),o=e("../stream/GenericWorker");function a(l,h){o.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(h)}r.inherits(a,o),a.prototype._bindStream=function(l){var h=this;(this._stream=l).pause(),l.on("data",function(c){h.push({data:c,meta:{percent:0}})}).on("error",function(c){h.isPaused?this.generatedError=c:h.error(c)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,i,n){var r=e("readable-stream").Readable;function o(a,l,h){r.call(this,l),this._helper=a;var c=this;a.on("data",function(u,p){c.push(u)||c._helper.pause(),h&&h(p)}).on("error",function(u){c.emit("error",u)}).on("end",function(){c.push(null)})}e("../utils").inherits(o,r),o.prototype._read=function(){this._helper.resume()},i.exports=o},{"../utils":32,"readable-stream":16}],14:[function(e,i,n){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,o);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,o)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var o=new Buffer(r);return o.fill(0),o},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(e,i,n){function r(C,I,x){var A,O=a.getTypeOf(I),L=a.extend(x||{},c);L.date=L.date||new Date,L.compression!==null&&(L.compression=L.compression.toUpperCase()),typeof L.unixPermissions=="string"&&(L.unixPermissions=parseInt(L.unixPermissions,8)),L.unixPermissions&&16384&L.unixPermissions&&(L.dir=!0),L.dosPermissions&&16&L.dosPermissions&&(L.dir=!0),L.dir&&(C=f(C)),L.createFolders&&(A=g(C))&&b.call(this,A,!0);var V=O==="string"&&L.binary===!1&&L.base64===!1;x&&x.binary!==void 0||(L.binary=!V),(I instanceof u&&I.uncompressedSize===0||L.dir||!I||I.length===0)&&(L.base64=!1,L.binary=!0,I="",L.compression="STORE",O="string");var T=null;T=I instanceof u||I instanceof l?I:_.isNode&&_.isStream(I)?new m(C,I):a.prepareContent(C,I,L.binary,L.optimizedBinaryString,L.base64);var N=new p(C,T,L);this.files[C]=N}var o=e("./utf8"),a=e("./utils"),l=e("./stream/GenericWorker"),h=e("./stream/StreamHelper"),c=e("./defaults"),u=e("./compressedObject"),p=e("./zipObject"),d=e("./generate"),_=e("./nodejsUtils"),m=e("./nodejs/NodejsStreamInputAdapter"),g=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var I=C.lastIndexOf("/");return 0<I?C.substring(0,I):""},f=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},b=function(C,I){return I=I!==void 0?I:c.createFolders,C=f(C),this.files[C]||r.call(this,C,null,{dir:!0,createFolders:I}),this.files[C]};function y(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var E={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var I,x,A;for(I in this.files)A=this.files[I],(x=I.slice(this.root.length,I.length))&&I.slice(0,this.root.length)===this.root&&C(x,A)},filter:function(C){var I=[];return this.forEach(function(x,A){C(x,A)&&I.push(A)}),I},file:function(C,I,x){if(arguments.length!==1)return C=this.root+C,r.call(this,C,I,x),this;if(y(C)){var A=C;return this.filter(function(L,V){return!V.dir&&A.test(L)})}var O=this.files[this.root+C];return O&&!O.dir?O:null},folder:function(C){if(!C)return this;if(y(C))return this.filter(function(O,L){return L.dir&&C.test(O)});var I=this.root+C,x=b.call(this,I),A=this.clone();return A.root=x.name,A},remove:function(C){C=this.root+C;var I=this.files[C];if(I||(C.slice(-1)!=="/"&&(C+="/"),I=this.files[C]),I&&!I.dir)delete this.files[C];else for(var x=this.filter(function(O,L){return L.name.slice(0,C.length)===C}),A=0;A<x.length;A++)delete this.files[x[A].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var I,x={};try{if((x=a.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=x.type.toLowerCase(),x.compression=x.compression.toUpperCase(),x.type==="binarystring"&&(x.type="string"),!x.type)throw new Error("No output type specified.");a.checkSupport(x.type),x.platform!=="darwin"&&x.platform!=="freebsd"&&x.platform!=="linux"&&x.platform!=="sunos"||(x.platform="UNIX"),x.platform==="win32"&&(x.platform="DOS");var A=x.comment||this.comment||"";I=d.generateWorker(this,x,A)}catch(O){(I=new l("error")).error(O)}return new h(I,x.type||"string",x.mimeType)},generateAsync:function(C,I){return this.generateInternalStream(C).accumulate(I)},generateNodeStream:function(C,I){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(I)}};i.exports=E},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,i,n){i.exports=e("stream")},{stream:void 0}],17:[function(e,i,n){var r=e("./DataReader");function o(a){r.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}e("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),h=a.charCodeAt(1),c=a.charCodeAt(2),u=a.charCodeAt(3),p=this.length-4;0<=p;--p)if(this.data[p]===l&&this.data[p+1]===h&&this.data[p+2]===c&&this.data[p+3]===u)return p-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),h=a.charCodeAt(1),c=a.charCodeAt(2),u=a.charCodeAt(3),p=this.readData(4);return l===p[0]&&h===p[1]&&c===p[2]&&u===p[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./DataReader":18}],18:[function(e,i,n){var r=e("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,h=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)h=(h<<8)+this.byteAt(l);return this.index+=a,h},readString:function(a){return r.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},i.exports=o},{"../utils":32}],19:[function(e,i,n){var r=e("./Uint8ArrayReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,i,n){var r=e("./DataReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./DataReader":18}],21:[function(e,i,n){var r=e("./ArrayReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(e,i,n){var r=e("../utils"),o=e("../support"),a=e("./ArrayReader"),l=e("./StringReader"),h=e("./NodeBufferReader"),c=e("./Uint8ArrayReader");i.exports=function(u){var p=r.getTypeOf(u);return r.checkSupport(p),p!=="string"||o.uint8array?p==="nodebuffer"?new h(u):o.uint8array?new c(r.transformTo("uint8array",u)):new a(r.transformTo("array",u)):new l(u)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,i,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,i,n){var r=e("./GenericWorker"),o=e("../utils");function a(l){r.call(this,"ConvertWorker to "+l),this.destType=l}o.inherits(a,r),a.prototype.processChunk=function(l){this.push({data:o.transformTo(this.destType,l.data),meta:l.meta})},i.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,i,n){var r=e("./GenericWorker"),o=e("../crc32");function a(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(a,r),a.prototype.processChunk=function(l){this.streamInfo.crc32=o(l.data,this.streamInfo.crc32||0),this.push(l)},i.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,i,n){var r=e("../utils"),o=e("./GenericWorker");function a(l){o.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}r.inherits(a,o),a.prototype.processChunk=function(l){if(l){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+l.data.length}o.prototype.processChunk.call(this,l)},i.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,i,n){var r=e("../utils"),o=e("./GenericWorker");function a(l){o.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(c){h.dataIsReady=!0,h.data=c,h.max=c&&c.length||0,h.type=r.getTypeOf(c),h.isPaused||h._tickAndRepeat()},function(c){h.error(c)})}r.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,h);break;case"uint8array":l=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":l=this.data.slice(this.index,h)}return this.index=h,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(e,i,n){function r(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var l=0;l<this._listeners[o].length;l++)this._listeners[o][l].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(l){a.processChunk(l)}),o.on("end",function(){a.end()}),o.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},i.exports=r},{}],29:[function(e,i,n){var r=e("../utils"),o=e("./ConvertWorker"),a=e("./GenericWorker"),l=e("../base64"),h=e("../support"),c=e("../external"),u=null;if(h.nodestream)try{u=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function p(_,m){return new c.Promise(function(g,f){var b=[],y=_._internalType,E=_._outputType,C=_._mimeType;_.on("data",function(I,x){b.push(I),m&&m(x)}).on("error",function(I){b=[],f(I)}).on("end",function(){try{var I=function(x,A,O){switch(x){case"blob":return r.newBlob(r.transformTo("arraybuffer",A),O);case"base64":return l.encode(A);default:return r.transformTo(x,A)}}(E,function(x,A){var O,L=0,V=null,T=0;for(O=0;O<A.length;O++)T+=A[O].length;switch(x){case"string":return A.join("");case"array":return Array.prototype.concat.apply([],A);case"uint8array":for(V=new Uint8Array(T),O=0;O<A.length;O++)V.set(A[O],L),L+=A[O].length;return V;case"nodebuffer":return Buffer.concat(A);default:throw new Error("concat : unsupported type '"+x+"'")}}(y,b),C);g(I)}catch(x){f(x)}b=[]}).resume()})}function d(_,m,g){var f=m;switch(m){case"blob":case"arraybuffer":f="uint8array";break;case"base64":f="string"}try{this._internalType=f,this._outputType=m,this._mimeType=g,r.checkSupport(f),this._worker=_.pipe(new o(f)),_.lock()}catch(b){this._worker=new a("error"),this._worker.error(b)}}d.prototype={accumulate:function(_){return p(this,_)},on:function(_,m){var g=this;return _==="data"?this._worker.on(_,function(f){m.call(g,f.data,f.meta)}):this._worker.on(_,function(){r.delay(m,arguments,g)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(_){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},_)}},i.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,i,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var r=new ArrayBuffer(0);try{n.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(r),n.blob=o.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(e,i,n){for(var r=e("./utils"),o=e("./support"),a=e("./nodejsUtils"),l=e("./stream/GenericWorker"),h=new Array(256),c=0;c<256;c++)h[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;h[254]=h[254]=1;function u(){l.call(this,"utf-8 decode"),this.leftOver=null}function p(){l.call(this,"utf-8 encode")}n.utf8encode=function(d){return o.nodebuffer?a.newBufferFrom(d,"utf-8"):function(_){var m,g,f,b,y,E=_.length,C=0;for(b=0;b<E;b++)(64512&(g=_.charCodeAt(b)))==55296&&b+1<E&&(64512&(f=_.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(f-56320),b++),C+=g<128?1:g<2048?2:g<65536?3:4;for(m=o.uint8array?new Uint8Array(C):new Array(C),b=y=0;y<C;b++)(64512&(g=_.charCodeAt(b)))==55296&&b+1<E&&(64512&(f=_.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(f-56320),b++),g<128?m[y++]=g:(g<2048?m[y++]=192|g>>>6:(g<65536?m[y++]=224|g>>>12:(m[y++]=240|g>>>18,m[y++]=128|g>>>12&63),m[y++]=128|g>>>6&63),m[y++]=128|63&g);return m}(d)},n.utf8decode=function(d){return o.nodebuffer?r.transformTo("nodebuffer",d).toString("utf-8"):function(_){var m,g,f,b,y=_.length,E=new Array(2*y);for(m=g=0;m<y;)if((f=_[m++])<128)E[g++]=f;else if(4<(b=h[f]))E[g++]=65533,m+=b-1;else{for(f&=b===2?31:b===3?15:7;1<b&&m<y;)f=f<<6|63&_[m++],b--;1<b?E[g++]=65533:f<65536?E[g++]=f:(f-=65536,E[g++]=55296|f>>10&1023,E[g++]=56320|1023&f)}return E.length!==g&&(E.subarray?E=E.subarray(0,g):E.length=g),r.applyFromCharCode(E)}(d=r.transformTo(o.uint8array?"uint8array":"array",d))},r.inherits(u,l),u.prototype.processChunk=function(d){var _=r.transformTo(o.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=_;(_=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),_.set(m,this.leftOver.length)}else _=this.leftOver.concat(_);this.leftOver=null}var g=function(b,y){var E;for((y=y||b.length)>b.length&&(y=b.length),E=y-1;0<=E&&(192&b[E])==128;)E--;return E<0||E===0?y:E+h[b[E]]>y?E:y}(_),f=_;g!==_.length&&(o.uint8array?(f=_.subarray(0,g),this.leftOver=_.subarray(g,_.length)):(f=_.slice(0,g),this.leftOver=_.slice(g,_.length))),this.push({data:n.utf8decode(f),meta:d.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=u,r.inherits(p,l),p.prototype.processChunk=function(d){this.push({data:n.utf8encode(d.data),meta:d.meta})},n.Utf8EncodeWorker=p},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,i,n){var r=e("./support"),o=e("./base64"),a=e("./nodejsUtils"),l=e("./external");function h(m){return m}function c(m,g){for(var f=0;f<m.length;++f)g[f]=255&m.charCodeAt(f);return g}e("setimmediate"),n.newBlob=function(m,g){n.checkSupport("blob");try{return new Blob([m],{type:g})}catch{try{var f=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return f.append(m),f.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(m,g,f){var b=[],y=0,E=m.length;if(E<=f)return String.fromCharCode.apply(null,m);for(;y<E;)g==="array"||g==="nodebuffer"?b.push(String.fromCharCode.apply(null,m.slice(y,Math.min(y+f,E)))):b.push(String.fromCharCode.apply(null,m.subarray(y,Math.min(y+f,E)))),y+=f;return b.join("")},stringifyByChar:function(m){for(var g="",f=0;f<m.length;f++)g+=String.fromCharCode(m[f]);return g},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function p(m){var g=65536,f=n.getTypeOf(m),b=!0;if(f==="uint8array"?b=u.applyCanBeUsed.uint8array:f==="nodebuffer"&&(b=u.applyCanBeUsed.nodebuffer),b)for(;1<g;)try{return u.stringifyByChunk(m,f,g)}catch{g=Math.floor(g/2)}return u.stringifyByChar(m)}function d(m,g){for(var f=0;f<m.length;f++)g[f]=m[f];return g}n.applyFromCharCode=p;var _={};_.string={string:h,array:function(m){return c(m,new Array(m.length))},arraybuffer:function(m){return _.string.uint8array(m).buffer},uint8array:function(m){return c(m,new Uint8Array(m.length))},nodebuffer:function(m){return c(m,a.allocBuffer(m.length))}},_.array={string:p,array:h,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},_.arraybuffer={string:function(m){return p(new Uint8Array(m))},array:function(m){return d(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:h,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},_.uint8array={string:p,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:h,nodebuffer:function(m){return a.newBufferFrom(m)}},_.nodebuffer={string:p,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return _.nodebuffer.uint8array(m).buffer},uint8array:function(m){return d(m,new Uint8Array(m.length))},nodebuffer:h},n.transformTo=function(m,g){if(g=g||"",!m)return g;n.checkSupport(m);var f=n.getTypeOf(g);return _[f][m](g)},n.resolve=function(m){for(var g=m.split("/"),f=[],b=0;b<g.length;b++){var y=g[b];y==="."||y===""&&b!==0&&b!==g.length-1||(y===".."?f.pop():f.push(y))}return f.join("/")},n.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":r.nodebuffer&&a.isBuffer(m)?"nodebuffer":r.uint8array&&m instanceof Uint8Array?"uint8array":r.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(m){if(!r[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(m){var g,f,b="";for(f=0;f<(m||"").length;f++)b+="\\x"+((g=m.charCodeAt(f))<16?"0":"")+g.toString(16).toUpperCase();return b},n.delay=function(m,g,f){setImmediate(function(){m.apply(f||null,g||[])})},n.inherits=function(m,g){function f(){}f.prototype=g.prototype,m.prototype=new f},n.extend=function(){var m,g,f={};for(m=0;m<arguments.length;m++)for(g in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],g)&&f[g]===void 0&&(f[g]=arguments[m][g]);return f},n.prepareContent=function(m,g,f,b,y){return l.Promise.resolve(g).then(function(E){return r.blob&&(E instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(E))!==-1)&&typeof FileReader<"u"?new l.Promise(function(C,I){var x=new FileReader;x.onload=function(A){C(A.target.result)},x.onerror=function(A){I(A.target.error)},x.readAsArrayBuffer(E)}):E}).then(function(E){var C=n.getTypeOf(E);return C?(C==="arraybuffer"?E=n.transformTo("uint8array",E):C==="string"&&(y?E=o.decode(E):f&&b!==!0&&(E=function(I){return c(I,r.uint8array?new Uint8Array(I.length):new Array(I.length))}(E))),E):l.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,i,n){var r=e("./reader/readerFor"),o=e("./utils"),a=e("./signature"),l=e("./zipEntry"),h=e("./support");function c(u){this.files=[],this.loadOptions=u}c.prototype={checkSignature:function(u){if(!this.reader.readAndCheckSignature(u)){this.reader.index-=4;var p=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(p)+", expected "+o.pretty(u)+")")}},isSignature:function(u,p){var d=this.reader.index;this.reader.setIndex(u);var _=this.reader.readString(4)===p;return this.reader.setIndex(d),_},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),p=h.uint8array?"uint8array":"array",d=o.transformTo(p,u);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,p,d,_=this.zip64EndOfCentralSize-44;0<_;)u=this.reader.readInt(2),p=this.reader.readInt(4),d=this.reader.readData(p),this.zip64ExtensibleData[u]={id:u,length:p,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var u,p;for(u=0;u<this.files.length;u++)p=this.files[u],this.reader.setIndex(p.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),p.readLocalPart(this.reader),p.handleUTF8(),p.processAttributes()},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(u=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var p=u;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var _=p-d;if(0<_)this.isSignature(p,a.CENTRAL_FILE_HEADER)||(this.reader.zero=_);else if(_<0)throw new Error("Corrupted zip: missing "+Math.abs(_)+" bytes.")},prepareReader:function(u){this.reader=r(u)},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,i,n){var r=e("./reader/readerFor"),o=e("./utils"),a=e("./compressedObject"),l=e("./crc32"),h=e("./utf8"),c=e("./compressions"),u=e("./support");function p(d,_){this.options=d,this.loadOptions=_}p.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var _,m;if(d.skip(22),this.fileNameLength=d.readInt(2),m=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((_=function(g){for(var f in c)if(Object.prototype.hasOwnProperty.call(c,f)&&c[f].magic===g)return c[f];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,_,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var _=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(_),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var _,m,g,f=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<f;)_=d.readInt(2),m=d.readInt(2),g=d.readData(m),this.extraFields[_]={id:_,length:m,value:g};d.setIndex(f)},handleUTF8:function(){var d=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var _=this.findExtraFieldUnicodePath();if(_!==null)this.fileNameStr=_;else{var m=o.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var f=o.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(f)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var _=r(d.value);return _.readInt(1)!==1||l(this.fileName)!==_.readInt(4)?null:h.utf8decode(_.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var _=r(d.value);return _.readInt(1)!==1||l(this.fileComment)!==_.readInt(4)?null:h.utf8decode(_.readData(d.length-5))}return null}},i.exports=p},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,i,n){function r(_,m,g){this.name=_,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=m,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var o=e("./stream/StreamHelper"),a=e("./stream/DataWorker"),l=e("./utf8"),h=e("./compressedObject"),c=e("./stream/GenericWorker");r.prototype={internalStream:function(_){var m=null,g="string";try{if(!_)throw new Error("No output type specified.");var f=(g=_.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),m=this._decompressWorker();var b=!this._dataBinary;b&&!f&&(m=m.pipe(new l.Utf8EncodeWorker)),!b&&f&&(m=m.pipe(new l.Utf8DecodeWorker))}catch(y){(m=new c("error")).error(y)}return new o(m,g,"")},async:function(_,m){return this.internalStream(_).accumulate(m)},nodeStream:function(_,m){return this.internalStream(_||"nodebuffer").toNodejsStream(m)},_compressWorker:function(_,m){if(this._data instanceof h&&this._data.compression.magic===_.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new l.Utf8EncodeWorker)),h.createWorkerFrom(g,_,m)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof c?this._data:new a(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],p=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<u.length;d++)r.prototype[u[d]]=p;i.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,i,n){(function(r){var o,a,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var h=0,c=new l(_),u=r.document.createTextNode("");c.observe(u,{characterData:!0}),o=function(){u.data=h=++h%2}}else if(r.setImmediate||r.MessageChannel===void 0)o="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var m=r.document.createElement("script");m.onreadystatechange=function(){_(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},r.document.documentElement.appendChild(m)}:function(){setTimeout(_,0)};else{var p=new r.MessageChannel;p.port1.onmessage=_,o=function(){p.port2.postMessage(0)}}var d=[];function _(){var m,g;a=!0;for(var f=d.length;f;){for(g=d,d=[],m=-1;++m<f;)g[m]();f=d.length}a=!1}i.exports=function(m){d.push(m)!==1||a||o()}}).call(this,typeof xu<"u"?xu:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,i,n){var r=e("immediate");function o(){}var a={},l=["REJECTED"],h=["FULFILLED"],c=["PENDING"];function u(f){if(typeof f!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,f!==o&&m(this,f)}function p(f,b,y){this.promise=f,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}function d(f,b,y){r(function(){var E;try{E=b(y)}catch(C){return a.reject(f,C)}E===f?a.reject(f,new TypeError("Cannot resolve promise with itself")):a.resolve(f,E)})}function _(f){var b=f&&f.then;if(f&&(typeof f=="object"||typeof f=="function")&&typeof b=="function")return function(){b.apply(f,arguments)}}function m(f,b){var y=!1;function E(x){y||(y=!0,a.reject(f,x))}function C(x){y||(y=!0,a.resolve(f,x))}var I=g(function(){b(C,E)});I.status==="error"&&E(I.value)}function g(f,b){var y={};try{y.value=f(b),y.status="success"}catch(E){y.status="error",y.value=E}return y}(i.exports=u).prototype.finally=function(f){if(typeof f!="function")return this;var b=this.constructor;return this.then(function(y){return b.resolve(f()).then(function(){return y})},function(y){return b.resolve(f()).then(function(){throw y})})},u.prototype.catch=function(f){return this.then(null,f)},u.prototype.then=function(f,b){if(typeof f!="function"&&this.state===h||typeof b!="function"&&this.state===l)return this;var y=new this.constructor(o);return this.state!==c?d(y,this.state===h?f:b,this.outcome):this.queue.push(new p(y,f,b)),y},p.prototype.callFulfilled=function(f){a.resolve(this.promise,f)},p.prototype.otherCallFulfilled=function(f){d(this.promise,this.onFulfilled,f)},p.prototype.callRejected=function(f){a.reject(this.promise,f)},p.prototype.otherCallRejected=function(f){d(this.promise,this.onRejected,f)},a.resolve=function(f,b){var y=g(_,b);if(y.status==="error")return a.reject(f,y.value);var E=y.value;if(E)m(f,E);else{f.state=h,f.outcome=b;for(var C=-1,I=f.queue.length;++C<I;)f.queue[C].callFulfilled(b)}return f},a.reject=function(f,b){f.state=l,f.outcome=b;for(var y=-1,E=f.queue.length;++y<E;)f.queue[y].callRejected(b);return f},u.resolve=function(f){return f instanceof this?f:a.resolve(new this(o),f)},u.reject=function(f){var b=new this(o);return a.reject(b,f)},u.all=function(f){var b=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=f.length,E=!1;if(!y)return this.resolve([]);for(var C=new Array(y),I=0,x=-1,A=new this(o);++x<y;)O(f[x],x);return A;function O(L,V){b.resolve(L).then(function(T){C[V]=T,++I!==y||E||(E=!0,a.resolve(A,C))},function(T){E||(E=!0,a.reject(A,T))})}},u.race=function(f){var b=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=f.length,E=!1;if(!y)return this.resolve([]);for(var C=-1,I=new this(o);++C<y;)x=f[C],b.resolve(x).then(function(A){E||(E=!0,a.resolve(I,A))},function(A){E||(E=!0,a.reject(I,A))});var x;return I}},{immediate:36}],38:[function(e,i,n){var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),i.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,i,n){var r=e("./zlib/deflate"),o=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/messages"),h=e("./zlib/zstream"),c=Object.prototype.toString,u=0,p=-1,d=0,_=8;function m(f){if(!(this instanceof m))return new m(f);this.options=o.assign({level:p,method:_,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},f||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var y=r.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(y!==u)throw new Error(l[y]);if(b.header&&r.deflateSetHeader(this.strm,b.header),b.dictionary){var E;if(E=typeof b.dictionary=="string"?a.string2buf(b.dictionary):c.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(y=r.deflateSetDictionary(this.strm,E))!==u)throw new Error(l[y]);this._dict_set=!0}}function g(f,b){var y=new m(b);if(y.push(f,!0),y.err)throw y.msg||l[y.err];return y.result}m.prototype.push=function(f,b){var y,E,C=this.strm,I=this.options.chunkSize;if(this.ended)return!1;E=b===~~b?b:b===!0?4:0,typeof f=="string"?C.input=a.string2buf(f):c.call(f)==="[object ArrayBuffer]"?C.input=new Uint8Array(f):C.input=f,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(I),C.next_out=0,C.avail_out=I),(y=r.deflate(C,E))!==1&&y!==u)return this.onEnd(y),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||E!==4&&E!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(C.output,C.next_out))):this.onData(o.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&y!==1);return E===4?(y=r.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===u):E!==2||(this.onEnd(u),!(C.avail_out=0))},m.prototype.onData=function(f){this.chunks.push(f)},m.prototype.onEnd=function(f){f===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},n.Deflate=m,n.deflate=g,n.deflateRaw=function(f,b){return(b=b||{}).raw=!0,g(f,b)},n.gzip=function(f,b){return(b=b||{}).gzip=!0,g(f,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,i,n){var r=e("./zlib/inflate"),o=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/constants"),h=e("./zlib/messages"),c=e("./zlib/zstream"),u=e("./zlib/gzheader"),p=Object.prototype.toString;function d(m){if(!(this instanceof d))return new d(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||m&&m.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&!(15&g.windowBits)&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var f=r.inflateInit2(this.strm,g.windowBits);if(f!==l.Z_OK)throw new Error(h[f]);this.header=new u,r.inflateGetHeader(this.strm,this.header)}function _(m,g){var f=new d(g);if(f.push(m,!0),f.err)throw f.msg||h[f.err];return f.result}d.prototype.push=function(m,g){var f,b,y,E,C,I,x=this.strm,A=this.options.chunkSize,O=this.options.dictionary,L=!1;if(this.ended)return!1;b=g===~~g?g:g===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof m=="string"?x.input=a.binstring2buf(m):p.call(m)==="[object ArrayBuffer]"?x.input=new Uint8Array(m):x.input=m,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new o.Buf8(A),x.next_out=0,x.avail_out=A),(f=r.inflate(x,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&O&&(I=typeof O=="string"?a.string2buf(O):p.call(O)==="[object ArrayBuffer]"?new Uint8Array(O):O,f=r.inflateSetDictionary(this.strm,I)),f===l.Z_BUF_ERROR&&L===!0&&(f=l.Z_OK,L=!1),f!==l.Z_STREAM_END&&f!==l.Z_OK)return this.onEnd(f),!(this.ended=!0);x.next_out&&(x.avail_out!==0&&f!==l.Z_STREAM_END&&(x.avail_in!==0||b!==l.Z_FINISH&&b!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=a.utf8border(x.output,x.next_out),E=x.next_out-y,C=a.buf2string(x.output,y),x.next_out=E,x.avail_out=A-E,E&&o.arraySet(x.output,x.output,y,E,0),this.onData(C)):this.onData(o.shrinkBuf(x.output,x.next_out)))),x.avail_in===0&&x.avail_out===0&&(L=!0)}while((0<x.avail_in||x.avail_out===0)&&f!==l.Z_STREAM_END);return f===l.Z_STREAM_END&&(b=l.Z_FINISH),b===l.Z_FINISH?(f=r.inflateEnd(this.strm),this.onEnd(f),this.ended=!0,f===l.Z_OK):b!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(x.avail_out=0))},d.prototype.onData=function(m){this.chunks.push(m)},d.prototype.onEnd=function(m){m===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},n.Inflate=d,n.inflate=_,n.inflateRaw=function(m,g){return(g=g||{}).raw=!0,_(m,g)},n.ungzip=_},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,i,n){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(l){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var c=h.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var u in c)c.hasOwnProperty(u)&&(l[u]=c[u])}}return l},n.shrinkBuf=function(l,h){return l.length===h?l:l.subarray?l.subarray(0,h):(l.length=h,l)};var o={arraySet:function(l,h,c,u,p){if(h.subarray&&l.subarray)l.set(h.subarray(c,c+u),p);else for(var d=0;d<u;d++)l[p+d]=h[c+d]},flattenChunks:function(l){var h,c,u,p,d,_;for(h=u=0,c=l.length;h<c;h++)u+=l[h].length;for(_=new Uint8Array(u),h=p=0,c=l.length;h<c;h++)d=l[h],_.set(d,p),p+=d.length;return _}},a={arraySet:function(l,h,c,u,p){for(var d=0;d<u;d++)l[p+d]=h[c+d]},flattenChunks:function(l){return[].concat.apply([],l)}};n.setTyped=function(l){l?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(r)},{}],42:[function(e,i,n){var r=e("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new r.Buf8(256),h=0;h<256;h++)l[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function c(u,p){if(p<65537&&(u.subarray&&a||!u.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(u,p));for(var d="",_=0;_<p;_++)d+=String.fromCharCode(u[_]);return d}l[254]=l[254]=1,n.string2buf=function(u){var p,d,_,m,g,f=u.length,b=0;for(m=0;m<f;m++)(64512&(d=u.charCodeAt(m)))==55296&&m+1<f&&(64512&(_=u.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(_-56320),m++),b+=d<128?1:d<2048?2:d<65536?3:4;for(p=new r.Buf8(b),m=g=0;g<b;m++)(64512&(d=u.charCodeAt(m)))==55296&&m+1<f&&(64512&(_=u.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(_-56320),m++),d<128?p[g++]=d:(d<2048?p[g++]=192|d>>>6:(d<65536?p[g++]=224|d>>>12:(p[g++]=240|d>>>18,p[g++]=128|d>>>12&63),p[g++]=128|d>>>6&63),p[g++]=128|63&d);return p},n.buf2binstring=function(u){return c(u,u.length)},n.binstring2buf=function(u){for(var p=new r.Buf8(u.length),d=0,_=p.length;d<_;d++)p[d]=u.charCodeAt(d);return p},n.buf2string=function(u,p){var d,_,m,g,f=p||u.length,b=new Array(2*f);for(d=_=0;d<f;)if((m=u[d++])<128)b[_++]=m;else if(4<(g=l[m]))b[_++]=65533,d+=g-1;else{for(m&=g===2?31:g===3?15:7;1<g&&d<f;)m=m<<6|63&u[d++],g--;1<g?b[_++]=65533:m<65536?b[_++]=m:(m-=65536,b[_++]=55296|m>>10&1023,b[_++]=56320|1023&m)}return c(b,_)},n.utf8border=function(u,p){var d;for((p=p||u.length)>u.length&&(p=u.length),d=p-1;0<=d&&(192&u[d])==128;)d--;return d<0||d===0?p:d+l[u[d]]>p?d:p}},{"./common":41}],43:[function(e,i,n){i.exports=function(r,o,a,l){for(var h=65535&r|0,c=r>>>16&65535|0,u=0;a!==0;){for(a-=u=2e3<a?2e3:a;c=c+(h=h+o[l++]|0)|0,--u;);h%=65521,c%=65521}return h|c<<16|0}},{}],44:[function(e,i,n){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,i,n){var r=function(){for(var o,a=[],l=0;l<256;l++){o=l;for(var h=0;h<8;h++)o=1&o?3988292384^o>>>1:o>>>1;a[l]=o}return a}();i.exports=function(o,a,l,h){var c=r,u=h+l;o^=-1;for(var p=h;p<u;p++)o=o>>>8^c[255&(o^a[p])];return-1^o}},{}],46:[function(e,i,n){var r,o=e("../utils/common"),a=e("./trees"),l=e("./adler32"),h=e("./crc32"),c=e("./messages"),u=0,p=4,d=0,_=-2,m=-1,g=4,f=2,b=8,y=9,E=286,C=30,I=19,x=2*E+1,A=15,O=3,L=258,V=L+O+1,T=42,N=113,v=1,M=2,Q=3,j=4;function it(w,Z){return w.msg=c[Z],Z}function G(w){return(w<<1)-(4<w?9:0)}function nt(w){for(var Z=w.length;0<=--Z;)w[Z]=0}function $(w){var Z=w.state,Y=Z.pending;Y>w.avail_out&&(Y=w.avail_out),Y!==0&&(o.arraySet(w.output,Z.pending_buf,Z.pending_out,Y,w.next_out),w.next_out+=Y,Z.pending_out+=Y,w.total_out+=Y,w.avail_out-=Y,Z.pending-=Y,Z.pending===0&&(Z.pending_out=0))}function B(w,Z){a._tr_flush_block(w,0<=w.block_start?w.block_start:-1,w.strstart-w.block_start,Z),w.block_start=w.strstart,$(w.strm)}function at(w,Z){w.pending_buf[w.pending++]=Z}function J(w,Z){w.pending_buf[w.pending++]=Z>>>8&255,w.pending_buf[w.pending++]=255&Z}function st(w,Z){var Y,R,P=w.max_chain_length,z=w.strstart,K=w.prev_length,H=w.nice_match,U=w.strstart>w.w_size-V?w.strstart-(w.w_size-V):0,X=w.window,et=w.w_mask,tt=w.prev,ht=w.strstart+L,mt=X[z+K-1],gt=X[z+K];w.prev_length>=w.good_match&&(P>>=2),H>w.lookahead&&(H=w.lookahead);do if(X[(Y=Z)+K]===gt&&X[Y+K-1]===mt&&X[Y]===X[z]&&X[++Y]===X[z+1]){z+=2,Y++;do;while(X[++z]===X[++Y]&&X[++z]===X[++Y]&&X[++z]===X[++Y]&&X[++z]===X[++Y]&&X[++z]===X[++Y]&&X[++z]===X[++Y]&&X[++z]===X[++Y]&&X[++z]===X[++Y]&&z<ht);if(R=L-(ht-z),z=ht-L,K<R){if(w.match_start=Z,H<=(K=R))break;mt=X[z+K-1],gt=X[z+K]}}while((Z=tt[Z&et])>U&&--P!=0);return K<=w.lookahead?K:w.lookahead}function dt(w){var Z,Y,R,P,z,K,H,U,X,et,tt=w.w_size;do{if(P=w.window_size-w.lookahead-w.strstart,w.strstart>=tt+(tt-V)){for(o.arraySet(w.window,w.window,tt,tt,0),w.match_start-=tt,w.strstart-=tt,w.block_start-=tt,Z=Y=w.hash_size;R=w.head[--Z],w.head[Z]=tt<=R?R-tt:0,--Y;);for(Z=Y=tt;R=w.prev[--Z],w.prev[Z]=tt<=R?R-tt:0,--Y;);P+=tt}if(w.strm.avail_in===0)break;if(K=w.strm,H=w.window,U=w.strstart+w.lookahead,X=P,et=void 0,et=K.avail_in,X<et&&(et=X),Y=et===0?0:(K.avail_in-=et,o.arraySet(H,K.input,K.next_in,et,U),K.state.wrap===1?K.adler=l(K.adler,H,et,U):K.state.wrap===2&&(K.adler=h(K.adler,H,et,U)),K.next_in+=et,K.total_in+=et,et),w.lookahead+=Y,w.lookahead+w.insert>=O)for(z=w.strstart-w.insert,w.ins_h=w.window[z],w.ins_h=(w.ins_h<<w.hash_shift^w.window[z+1])&w.hash_mask;w.insert&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[z+O-1])&w.hash_mask,w.prev[z&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=z,z++,w.insert--,!(w.lookahead+w.insert<O)););}while(w.lookahead<V&&w.strm.avail_in!==0)}function wt(w,Z){for(var Y,R;;){if(w.lookahead<V){if(dt(w),w.lookahead<V&&Z===u)return v;if(w.lookahead===0)break}if(Y=0,w.lookahead>=O&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+O-1])&w.hash_mask,Y=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),Y!==0&&w.strstart-Y<=w.w_size-V&&(w.match_length=st(w,Y)),w.match_length>=O)if(R=a._tr_tally(w,w.strstart-w.match_start,w.match_length-O),w.lookahead-=w.match_length,w.match_length<=w.max_lazy_match&&w.lookahead>=O){for(w.match_length--;w.strstart++,w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+O-1])&w.hash_mask,Y=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart,--w.match_length!=0;);w.strstart++}else w.strstart+=w.match_length,w.match_length=0,w.ins_h=w.window[w.strstart],w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+1])&w.hash_mask;else R=a._tr_tally(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++;if(R&&(B(w,!1),w.strm.avail_out===0))return v}return w.insert=w.strstart<O-1?w.strstart:O-1,Z===p?(B(w,!0),w.strm.avail_out===0?Q:j):w.last_lit&&(B(w,!1),w.strm.avail_out===0)?v:M}function pt(w,Z){for(var Y,R,P;;){if(w.lookahead<V){if(dt(w),w.lookahead<V&&Z===u)return v;if(w.lookahead===0)break}if(Y=0,w.lookahead>=O&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+O-1])&w.hash_mask,Y=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),w.prev_length=w.match_length,w.prev_match=w.match_start,w.match_length=O-1,Y!==0&&w.prev_length<w.max_lazy_match&&w.strstart-Y<=w.w_size-V&&(w.match_length=st(w,Y),w.match_length<=5&&(w.strategy===1||w.match_length===O&&4096<w.strstart-w.match_start)&&(w.match_length=O-1)),w.prev_length>=O&&w.match_length<=w.prev_length){for(P=w.strstart+w.lookahead-O,R=a._tr_tally(w,w.strstart-1-w.prev_match,w.prev_length-O),w.lookahead-=w.prev_length-1,w.prev_length-=2;++w.strstart<=P&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+O-1])&w.hash_mask,Y=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),--w.prev_length!=0;);if(w.match_available=0,w.match_length=O-1,w.strstart++,R&&(B(w,!1),w.strm.avail_out===0))return v}else if(w.match_available){if((R=a._tr_tally(w,0,w.window[w.strstart-1]))&&B(w,!1),w.strstart++,w.lookahead--,w.strm.avail_out===0)return v}else w.match_available=1,w.strstart++,w.lookahead--}return w.match_available&&(R=a._tr_tally(w,0,w.window[w.strstart-1]),w.match_available=0),w.insert=w.strstart<O-1?w.strstart:O-1,Z===p?(B(w,!0),w.strm.avail_out===0?Q:j):w.last_lit&&(B(w,!1),w.strm.avail_out===0)?v:M}function _t(w,Z,Y,R,P){this.good_length=w,this.max_lazy=Z,this.nice_length=Y,this.max_chain=R,this.func=P}function yt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*x),this.dyn_dtree=new o.Buf16(2*(2*C+1)),this.bl_tree=new o.Buf16(2*(2*I+1)),nt(this.dyn_ltree),nt(this.dyn_dtree),nt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(A+1),this.heap=new o.Buf16(2*E+1),nt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*E+1),nt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function It(w){var Z;return w&&w.state?(w.total_in=w.total_out=0,w.data_type=f,(Z=w.state).pending=0,Z.pending_out=0,Z.wrap<0&&(Z.wrap=-Z.wrap),Z.status=Z.wrap?T:N,w.adler=Z.wrap===2?0:1,Z.last_flush=u,a._tr_init(Z),d):it(w,_)}function Vt(w){var Z=It(w);return Z===d&&function(Y){Y.window_size=2*Y.w_size,nt(Y.head),Y.max_lazy_match=r[Y.level].max_lazy,Y.good_match=r[Y.level].good_length,Y.nice_match=r[Y.level].nice_length,Y.max_chain_length=r[Y.level].max_chain,Y.strstart=0,Y.block_start=0,Y.lookahead=0,Y.insert=0,Y.match_length=Y.prev_length=O-1,Y.match_available=0,Y.ins_h=0}(w.state),Z}function $t(w,Z,Y,R,P,z){if(!w)return _;var K=1;if(Z===m&&(Z=6),R<0?(K=0,R=-R):15<R&&(K=2,R-=16),P<1||y<P||Y!==b||R<8||15<R||Z<0||9<Z||z<0||g<z)return it(w,_);R===8&&(R=9);var H=new yt;return(w.state=H).strm=w,H.wrap=K,H.gzhead=null,H.w_bits=R,H.w_size=1<<H.w_bits,H.w_mask=H.w_size-1,H.hash_bits=P+7,H.hash_size=1<<H.hash_bits,H.hash_mask=H.hash_size-1,H.hash_shift=~~((H.hash_bits+O-1)/O),H.window=new o.Buf8(2*H.w_size),H.head=new o.Buf16(H.hash_size),H.prev=new o.Buf16(H.w_size),H.lit_bufsize=1<<P+6,H.pending_buf_size=4*H.lit_bufsize,H.pending_buf=new o.Buf8(H.pending_buf_size),H.d_buf=1*H.lit_bufsize,H.l_buf=3*H.lit_bufsize,H.level=Z,H.strategy=z,H.method=Y,Vt(w)}r=[new _t(0,0,0,0,function(w,Z){var Y=65535;for(Y>w.pending_buf_size-5&&(Y=w.pending_buf_size-5);;){if(w.lookahead<=1){if(dt(w),w.lookahead===0&&Z===u)return v;if(w.lookahead===0)break}w.strstart+=w.lookahead,w.lookahead=0;var R=w.block_start+Y;if((w.strstart===0||w.strstart>=R)&&(w.lookahead=w.strstart-R,w.strstart=R,B(w,!1),w.strm.avail_out===0)||w.strstart-w.block_start>=w.w_size-V&&(B(w,!1),w.strm.avail_out===0))return v}return w.insert=0,Z===p?(B(w,!0),w.strm.avail_out===0?Q:j):(w.strstart>w.block_start&&(B(w,!1),w.strm.avail_out),v)}),new _t(4,4,8,4,wt),new _t(4,5,16,8,wt),new _t(4,6,32,32,wt),new _t(4,4,16,16,pt),new _t(8,16,32,32,pt),new _t(8,16,128,128,pt),new _t(8,32,128,256,pt),new _t(32,128,258,1024,pt),new _t(32,258,258,4096,pt)],n.deflateInit=function(w,Z){return $t(w,Z,b,15,8,0)},n.deflateInit2=$t,n.deflateReset=Vt,n.deflateResetKeep=It,n.deflateSetHeader=function(w,Z){return w&&w.state?w.state.wrap!==2?_:(w.state.gzhead=Z,d):_},n.deflate=function(w,Z){var Y,R,P,z;if(!w||!w.state||5<Z||Z<0)return w?it(w,_):_;if(R=w.state,!w.output||!w.input&&w.avail_in!==0||R.status===666&&Z!==p)return it(w,w.avail_out===0?-5:_);if(R.strm=w,Y=R.last_flush,R.last_flush=Z,R.status===T)if(R.wrap===2)w.adler=0,at(R,31),at(R,139),at(R,8),R.gzhead?(at(R,(R.gzhead.text?1:0)+(R.gzhead.hcrc?2:0)+(R.gzhead.extra?4:0)+(R.gzhead.name?8:0)+(R.gzhead.comment?16:0)),at(R,255&R.gzhead.time),at(R,R.gzhead.time>>8&255),at(R,R.gzhead.time>>16&255),at(R,R.gzhead.time>>24&255),at(R,R.level===9?2:2<=R.strategy||R.level<2?4:0),at(R,255&R.gzhead.os),R.gzhead.extra&&R.gzhead.extra.length&&(at(R,255&R.gzhead.extra.length),at(R,R.gzhead.extra.length>>8&255)),R.gzhead.hcrc&&(w.adler=h(w.adler,R.pending_buf,R.pending,0)),R.gzindex=0,R.status=69):(at(R,0),at(R,0),at(R,0),at(R,0),at(R,0),at(R,R.level===9?2:2<=R.strategy||R.level<2?4:0),at(R,3),R.status=N);else{var K=b+(R.w_bits-8<<4)<<8;K|=(2<=R.strategy||R.level<2?0:R.level<6?1:R.level===6?2:3)<<6,R.strstart!==0&&(K|=32),K+=31-K%31,R.status=N,J(R,K),R.strstart!==0&&(J(R,w.adler>>>16),J(R,65535&w.adler)),w.adler=1}if(R.status===69)if(R.gzhead.extra){for(P=R.pending;R.gzindex<(65535&R.gzhead.extra.length)&&(R.pending!==R.pending_buf_size||(R.gzhead.hcrc&&R.pending>P&&(w.adler=h(w.adler,R.pending_buf,R.pending-P,P)),$(w),P=R.pending,R.pending!==R.pending_buf_size));)at(R,255&R.gzhead.extra[R.gzindex]),R.gzindex++;R.gzhead.hcrc&&R.pending>P&&(w.adler=h(w.adler,R.pending_buf,R.pending-P,P)),R.gzindex===R.gzhead.extra.length&&(R.gzindex=0,R.status=73)}else R.status=73;if(R.status===73)if(R.gzhead.name){P=R.pending;do{if(R.pending===R.pending_buf_size&&(R.gzhead.hcrc&&R.pending>P&&(w.adler=h(w.adler,R.pending_buf,R.pending-P,P)),$(w),P=R.pending,R.pending===R.pending_buf_size)){z=1;break}z=R.gzindex<R.gzhead.name.length?255&R.gzhead.name.charCodeAt(R.gzindex++):0,at(R,z)}while(z!==0);R.gzhead.hcrc&&R.pending>P&&(w.adler=h(w.adler,R.pending_buf,R.pending-P,P)),z===0&&(R.gzindex=0,R.status=91)}else R.status=91;if(R.status===91)if(R.gzhead.comment){P=R.pending;do{if(R.pending===R.pending_buf_size&&(R.gzhead.hcrc&&R.pending>P&&(w.adler=h(w.adler,R.pending_buf,R.pending-P,P)),$(w),P=R.pending,R.pending===R.pending_buf_size)){z=1;break}z=R.gzindex<R.gzhead.comment.length?255&R.gzhead.comment.charCodeAt(R.gzindex++):0,at(R,z)}while(z!==0);R.gzhead.hcrc&&R.pending>P&&(w.adler=h(w.adler,R.pending_buf,R.pending-P,P)),z===0&&(R.status=103)}else R.status=103;if(R.status===103&&(R.gzhead.hcrc?(R.pending+2>R.pending_buf_size&&$(w),R.pending+2<=R.pending_buf_size&&(at(R,255&w.adler),at(R,w.adler>>8&255),w.adler=0,R.status=N)):R.status=N),R.pending!==0){if($(w),w.avail_out===0)return R.last_flush=-1,d}else if(w.avail_in===0&&G(Z)<=G(Y)&&Z!==p)return it(w,-5);if(R.status===666&&w.avail_in!==0)return it(w,-5);if(w.avail_in!==0||R.lookahead!==0||Z!==u&&R.status!==666){var H=R.strategy===2?function(U,X){for(var et;;){if(U.lookahead===0&&(dt(U),U.lookahead===0)){if(X===u)return v;break}if(U.match_length=0,et=a._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++,et&&(B(U,!1),U.strm.avail_out===0))return v}return U.insert=0,X===p?(B(U,!0),U.strm.avail_out===0?Q:j):U.last_lit&&(B(U,!1),U.strm.avail_out===0)?v:M}(R,Z):R.strategy===3?function(U,X){for(var et,tt,ht,mt,gt=U.window;;){if(U.lookahead<=L){if(dt(U),U.lookahead<=L&&X===u)return v;if(U.lookahead===0)break}if(U.match_length=0,U.lookahead>=O&&0<U.strstart&&(tt=gt[ht=U.strstart-1])===gt[++ht]&&tt===gt[++ht]&&tt===gt[++ht]){mt=U.strstart+L;do;while(tt===gt[++ht]&&tt===gt[++ht]&&tt===gt[++ht]&&tt===gt[++ht]&&tt===gt[++ht]&&tt===gt[++ht]&&tt===gt[++ht]&&tt===gt[++ht]&&ht<mt);U.match_length=L-(mt-ht),U.match_length>U.lookahead&&(U.match_length=U.lookahead)}if(U.match_length>=O?(et=a._tr_tally(U,1,U.match_length-O),U.lookahead-=U.match_length,U.strstart+=U.match_length,U.match_length=0):(et=a._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++),et&&(B(U,!1),U.strm.avail_out===0))return v}return U.insert=0,X===p?(B(U,!0),U.strm.avail_out===0?Q:j):U.last_lit&&(B(U,!1),U.strm.avail_out===0)?v:M}(R,Z):r[R.level].func(R,Z);if(H!==Q&&H!==j||(R.status=666),H===v||H===Q)return w.avail_out===0&&(R.last_flush=-1),d;if(H===M&&(Z===1?a._tr_align(R):Z!==5&&(a._tr_stored_block(R,0,0,!1),Z===3&&(nt(R.head),R.lookahead===0&&(R.strstart=0,R.block_start=0,R.insert=0))),$(w),w.avail_out===0))return R.last_flush=-1,d}return Z!==p?d:R.wrap<=0?1:(R.wrap===2?(at(R,255&w.adler),at(R,w.adler>>8&255),at(R,w.adler>>16&255),at(R,w.adler>>24&255),at(R,255&w.total_in),at(R,w.total_in>>8&255),at(R,w.total_in>>16&255),at(R,w.total_in>>24&255)):(J(R,w.adler>>>16),J(R,65535&w.adler)),$(w),0<R.wrap&&(R.wrap=-R.wrap),R.pending!==0?d:1)},n.deflateEnd=function(w){var Z;return w&&w.state?(Z=w.state.status)!==T&&Z!==69&&Z!==73&&Z!==91&&Z!==103&&Z!==N&&Z!==666?it(w,_):(w.state=null,Z===N?it(w,-3):d):_},n.deflateSetDictionary=function(w,Z){var Y,R,P,z,K,H,U,X,et=Z.length;if(!w||!w.state||(z=(Y=w.state).wrap)===2||z===1&&Y.status!==T||Y.lookahead)return _;for(z===1&&(w.adler=l(w.adler,Z,et,0)),Y.wrap=0,et>=Y.w_size&&(z===0&&(nt(Y.head),Y.strstart=0,Y.block_start=0,Y.insert=0),X=new o.Buf8(Y.w_size),o.arraySet(X,Z,et-Y.w_size,Y.w_size,0),Z=X,et=Y.w_size),K=w.avail_in,H=w.next_in,U=w.input,w.avail_in=et,w.next_in=0,w.input=Z,dt(Y);Y.lookahead>=O;){for(R=Y.strstart,P=Y.lookahead-(O-1);Y.ins_h=(Y.ins_h<<Y.hash_shift^Y.window[R+O-1])&Y.hash_mask,Y.prev[R&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=R,R++,--P;);Y.strstart=R,Y.lookahead=O-1,dt(Y)}return Y.strstart+=Y.lookahead,Y.block_start=Y.strstart,Y.insert=Y.lookahead,Y.lookahead=0,Y.match_length=Y.prev_length=O-1,Y.match_available=0,w.next_in=H,w.input=U,w.avail_in=K,Y.wrap=z,d},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,i,n){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,i,n){i.exports=function(r,o){var a,l,h,c,u,p,d,_,m,g,f,b,y,E,C,I,x,A,O,L,V,T,N,v,M;a=r.state,l=r.next_in,v=r.input,h=l+(r.avail_in-5),c=r.next_out,M=r.output,u=c-(o-r.avail_out),p=c+(r.avail_out-257),d=a.dmax,_=a.wsize,m=a.whave,g=a.wnext,f=a.window,b=a.hold,y=a.bits,E=a.lencode,C=a.distcode,I=(1<<a.lenbits)-1,x=(1<<a.distbits)-1;t:do{y<15&&(b+=v[l++]<<y,y+=8,b+=v[l++]<<y,y+=8),A=E[b&I];e:for(;;){if(b>>>=O=A>>>24,y-=O,(O=A>>>16&255)===0)M[c++]=65535&A;else{if(!(16&O)){if(!(64&O)){A=E[(65535&A)+(b&(1<<O)-1)];continue e}if(32&O){a.mode=12;break t}r.msg="invalid literal/length code",a.mode=30;break t}L=65535&A,(O&=15)&&(y<O&&(b+=v[l++]<<y,y+=8),L+=b&(1<<O)-1,b>>>=O,y-=O),y<15&&(b+=v[l++]<<y,y+=8,b+=v[l++]<<y,y+=8),A=C[b&x];s:for(;;){if(b>>>=O=A>>>24,y-=O,!(16&(O=A>>>16&255))){if(!(64&O)){A=C[(65535&A)+(b&(1<<O)-1)];continue s}r.msg="invalid distance code",a.mode=30;break t}if(V=65535&A,y<(O&=15)&&(b+=v[l++]<<y,(y+=8)<O&&(b+=v[l++]<<y,y+=8)),d<(V+=b&(1<<O)-1)){r.msg="invalid distance too far back",a.mode=30;break t}if(b>>>=O,y-=O,(O=c-u)<V){if(m<(O=V-O)&&a.sane){r.msg="invalid distance too far back",a.mode=30;break t}if(N=f,(T=0)===g){if(T+=_-O,O<L){for(L-=O;M[c++]=f[T++],--O;);T=c-V,N=M}}else if(g<O){if(T+=_+g-O,(O-=g)<L){for(L-=O;M[c++]=f[T++],--O;);if(T=0,g<L){for(L-=O=g;M[c++]=f[T++],--O;);T=c-V,N=M}}}else if(T+=g-O,O<L){for(L-=O;M[c++]=f[T++],--O;);T=c-V,N=M}for(;2<L;)M[c++]=N[T++],M[c++]=N[T++],M[c++]=N[T++],L-=3;L&&(M[c++]=N[T++],1<L&&(M[c++]=N[T++]))}else{for(T=c-V;M[c++]=M[T++],M[c++]=M[T++],M[c++]=M[T++],2<(L-=3););L&&(M[c++]=M[T++],1<L&&(M[c++]=M[T++]))}break}}break}}while(l<h&&c<p);l-=L=y>>3,b&=(1<<(y-=L<<3))-1,r.next_in=l,r.next_out=c,r.avail_in=l<h?h-l+5:5-(l-h),r.avail_out=c<p?p-c+257:257-(c-p),a.hold=b,a.bits=y}},{}],49:[function(e,i,n){var r=e("../utils/common"),o=e("./adler32"),a=e("./crc32"),l=e("./inffast"),h=e("./inftrees"),c=1,u=2,p=0,d=-2,_=1,m=852,g=592;function f(T){return(T>>>24&255)+(T>>>8&65280)+((65280&T)<<8)+((255&T)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(T){var N;return T&&T.state?(N=T.state,T.total_in=T.total_out=N.total=0,T.msg="",N.wrap&&(T.adler=1&N.wrap),N.mode=_,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new r.Buf32(m),N.distcode=N.distdyn=new r.Buf32(g),N.sane=1,N.back=-1,p):d}function E(T){var N;return T&&T.state?((N=T.state).wsize=0,N.whave=0,N.wnext=0,y(T)):d}function C(T,N){var v,M;return T&&T.state?(M=T.state,N<0?(v=0,N=-N):(v=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?d:(M.window!==null&&M.wbits!==N&&(M.window=null),M.wrap=v,M.wbits=N,E(T))):d}function I(T,N){var v,M;return T?(M=new b,(T.state=M).window=null,(v=C(T,N))!==p&&(T.state=null),v):d}var x,A,O=!0;function L(T){if(O){var N;for(x=new r.Buf32(512),A=new r.Buf32(32),N=0;N<144;)T.lens[N++]=8;for(;N<256;)T.lens[N++]=9;for(;N<280;)T.lens[N++]=7;for(;N<288;)T.lens[N++]=8;for(h(c,T.lens,0,288,x,0,T.work,{bits:9}),N=0;N<32;)T.lens[N++]=5;h(u,T.lens,0,32,A,0,T.work,{bits:5}),O=!1}T.lencode=x,T.lenbits=9,T.distcode=A,T.distbits=5}function V(T,N,v,M){var Q,j=T.state;return j.window===null&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new r.Buf8(j.wsize)),M>=j.wsize?(r.arraySet(j.window,N,v-j.wsize,j.wsize,0),j.wnext=0,j.whave=j.wsize):(M<(Q=j.wsize-j.wnext)&&(Q=M),r.arraySet(j.window,N,v-M,Q,j.wnext),(M-=Q)?(r.arraySet(j.window,N,v-M,M,0),j.wnext=M,j.whave=j.wsize):(j.wnext+=Q,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=Q))),0}n.inflateReset=E,n.inflateReset2=C,n.inflateResetKeep=y,n.inflateInit=function(T){return I(T,15)},n.inflateInit2=I,n.inflate=function(T,N){var v,M,Q,j,it,G,nt,$,B,at,J,st,dt,wt,pt,_t,yt,It,Vt,$t,w,Z,Y,R,P=0,z=new r.Buf8(4),K=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!T||!T.state||!T.output||!T.input&&T.avail_in!==0)return d;(v=T.state).mode===12&&(v.mode=13),it=T.next_out,Q=T.output,nt=T.avail_out,j=T.next_in,M=T.input,G=T.avail_in,$=v.hold,B=v.bits,at=G,J=nt,Z=p;t:for(;;)switch(v.mode){case _:if(v.wrap===0){v.mode=13;break}for(;B<16;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if(2&v.wrap&&$===35615){z[v.check=0]=255&$,z[1]=$>>>8&255,v.check=a(v.check,z,2,0),B=$=0,v.mode=2;break}if(v.flags=0,v.head&&(v.head.done=!1),!(1&v.wrap)||(((255&$)<<8)+($>>8))%31){T.msg="incorrect header check",v.mode=30;break}if((15&$)!=8){T.msg="unknown compression method",v.mode=30;break}if(B-=4,w=8+(15&($>>>=4)),v.wbits===0)v.wbits=w;else if(w>v.wbits){T.msg="invalid window size",v.mode=30;break}v.dmax=1<<w,T.adler=v.check=1,v.mode=512&$?10:12,B=$=0;break;case 2:for(;B<16;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if(v.flags=$,(255&v.flags)!=8){T.msg="unknown compression method",v.mode=30;break}if(57344&v.flags){T.msg="unknown header flags set",v.mode=30;break}v.head&&(v.head.text=$>>8&1),512&v.flags&&(z[0]=255&$,z[1]=$>>>8&255,v.check=a(v.check,z,2,0)),B=$=0,v.mode=3;case 3:for(;B<32;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}v.head&&(v.head.time=$),512&v.flags&&(z[0]=255&$,z[1]=$>>>8&255,z[2]=$>>>16&255,z[3]=$>>>24&255,v.check=a(v.check,z,4,0)),B=$=0,v.mode=4;case 4:for(;B<16;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}v.head&&(v.head.xflags=255&$,v.head.os=$>>8),512&v.flags&&(z[0]=255&$,z[1]=$>>>8&255,v.check=a(v.check,z,2,0)),B=$=0,v.mode=5;case 5:if(1024&v.flags){for(;B<16;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}v.length=$,v.head&&(v.head.extra_len=$),512&v.flags&&(z[0]=255&$,z[1]=$>>>8&255,v.check=a(v.check,z,2,0)),B=$=0}else v.head&&(v.head.extra=null);v.mode=6;case 6:if(1024&v.flags&&(G<(st=v.length)&&(st=G),st&&(v.head&&(w=v.head.extra_len-v.length,v.head.extra||(v.head.extra=new Array(v.head.extra_len)),r.arraySet(v.head.extra,M,j,st,w)),512&v.flags&&(v.check=a(v.check,M,st,j)),G-=st,j+=st,v.length-=st),v.length))break t;v.length=0,v.mode=7;case 7:if(2048&v.flags){if(G===0)break t;for(st=0;w=M[j+st++],v.head&&w&&v.length<65536&&(v.head.name+=String.fromCharCode(w)),w&&st<G;);if(512&v.flags&&(v.check=a(v.check,M,st,j)),G-=st,j+=st,w)break t}else v.head&&(v.head.name=null);v.length=0,v.mode=8;case 8:if(4096&v.flags){if(G===0)break t;for(st=0;w=M[j+st++],v.head&&w&&v.length<65536&&(v.head.comment+=String.fromCharCode(w)),w&&st<G;);if(512&v.flags&&(v.check=a(v.check,M,st,j)),G-=st,j+=st,w)break t}else v.head&&(v.head.comment=null);v.mode=9;case 9:if(512&v.flags){for(;B<16;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if($!==(65535&v.check)){T.msg="header crc mismatch",v.mode=30;break}B=$=0}v.head&&(v.head.hcrc=v.flags>>9&1,v.head.done=!0),T.adler=v.check=0,v.mode=12;break;case 10:for(;B<32;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}T.adler=v.check=f($),B=$=0,v.mode=11;case 11:if(v.havedict===0)return T.next_out=it,T.avail_out=nt,T.next_in=j,T.avail_in=G,v.hold=$,v.bits=B,2;T.adler=v.check=1,v.mode=12;case 12:if(N===5||N===6)break t;case 13:if(v.last){$>>>=7&B,B-=7&B,v.mode=27;break}for(;B<3;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}switch(v.last=1&$,B-=1,3&($>>>=1)){case 0:v.mode=14;break;case 1:if(L(v),v.mode=20,N!==6)break;$>>>=2,B-=2;break t;case 2:v.mode=17;break;case 3:T.msg="invalid block type",v.mode=30}$>>>=2,B-=2;break;case 14:for($>>>=7&B,B-=7&B;B<32;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if((65535&$)!=($>>>16^65535)){T.msg="invalid stored block lengths",v.mode=30;break}if(v.length=65535&$,B=$=0,v.mode=15,N===6)break t;case 15:v.mode=16;case 16:if(st=v.length){if(G<st&&(st=G),nt<st&&(st=nt),st===0)break t;r.arraySet(Q,M,j,st,it),G-=st,j+=st,nt-=st,it+=st,v.length-=st;break}v.mode=12;break;case 17:for(;B<14;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if(v.nlen=257+(31&$),$>>>=5,B-=5,v.ndist=1+(31&$),$>>>=5,B-=5,v.ncode=4+(15&$),$>>>=4,B-=4,286<v.nlen||30<v.ndist){T.msg="too many length or distance symbols",v.mode=30;break}v.have=0,v.mode=18;case 18:for(;v.have<v.ncode;){for(;B<3;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}v.lens[K[v.have++]]=7&$,$>>>=3,B-=3}for(;v.have<19;)v.lens[K[v.have++]]=0;if(v.lencode=v.lendyn,v.lenbits=7,Y={bits:v.lenbits},Z=h(0,v.lens,0,19,v.lencode,0,v.work,Y),v.lenbits=Y.bits,Z){T.msg="invalid code lengths set",v.mode=30;break}v.have=0,v.mode=19;case 19:for(;v.have<v.nlen+v.ndist;){for(;_t=(P=v.lencode[$&(1<<v.lenbits)-1])>>>16&255,yt=65535&P,!((pt=P>>>24)<=B);){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if(yt<16)$>>>=pt,B-=pt,v.lens[v.have++]=yt;else{if(yt===16){for(R=pt+2;B<R;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if($>>>=pt,B-=pt,v.have===0){T.msg="invalid bit length repeat",v.mode=30;break}w=v.lens[v.have-1],st=3+(3&$),$>>>=2,B-=2}else if(yt===17){for(R=pt+3;B<R;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}B-=pt,w=0,st=3+(7&($>>>=pt)),$>>>=3,B-=3}else{for(R=pt+7;B<R;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}B-=pt,w=0,st=11+(127&($>>>=pt)),$>>>=7,B-=7}if(v.have+st>v.nlen+v.ndist){T.msg="invalid bit length repeat",v.mode=30;break}for(;st--;)v.lens[v.have++]=w}}if(v.mode===30)break;if(v.lens[256]===0){T.msg="invalid code -- missing end-of-block",v.mode=30;break}if(v.lenbits=9,Y={bits:v.lenbits},Z=h(c,v.lens,0,v.nlen,v.lencode,0,v.work,Y),v.lenbits=Y.bits,Z){T.msg="invalid literal/lengths set",v.mode=30;break}if(v.distbits=6,v.distcode=v.distdyn,Y={bits:v.distbits},Z=h(u,v.lens,v.nlen,v.ndist,v.distcode,0,v.work,Y),v.distbits=Y.bits,Z){T.msg="invalid distances set",v.mode=30;break}if(v.mode=20,N===6)break t;case 20:v.mode=21;case 21:if(6<=G&&258<=nt){T.next_out=it,T.avail_out=nt,T.next_in=j,T.avail_in=G,v.hold=$,v.bits=B,l(T,J),it=T.next_out,Q=T.output,nt=T.avail_out,j=T.next_in,M=T.input,G=T.avail_in,$=v.hold,B=v.bits,v.mode===12&&(v.back=-1);break}for(v.back=0;_t=(P=v.lencode[$&(1<<v.lenbits)-1])>>>16&255,yt=65535&P,!((pt=P>>>24)<=B);){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if(_t&&!(240&_t)){for(It=pt,Vt=_t,$t=yt;_t=(P=v.lencode[$t+(($&(1<<It+Vt)-1)>>It)])>>>16&255,yt=65535&P,!(It+(pt=P>>>24)<=B);){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}$>>>=It,B-=It,v.back+=It}if($>>>=pt,B-=pt,v.back+=pt,v.length=yt,_t===0){v.mode=26;break}if(32&_t){v.back=-1,v.mode=12;break}if(64&_t){T.msg="invalid literal/length code",v.mode=30;break}v.extra=15&_t,v.mode=22;case 22:if(v.extra){for(R=v.extra;B<R;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}v.length+=$&(1<<v.extra)-1,$>>>=v.extra,B-=v.extra,v.back+=v.extra}v.was=v.length,v.mode=23;case 23:for(;_t=(P=v.distcode[$&(1<<v.distbits)-1])>>>16&255,yt=65535&P,!((pt=P>>>24)<=B);){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if(!(240&_t)){for(It=pt,Vt=_t,$t=yt;_t=(P=v.distcode[$t+(($&(1<<It+Vt)-1)>>It)])>>>16&255,yt=65535&P,!(It+(pt=P>>>24)<=B);){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}$>>>=It,B-=It,v.back+=It}if($>>>=pt,B-=pt,v.back+=pt,64&_t){T.msg="invalid distance code",v.mode=30;break}v.offset=yt,v.extra=15&_t,v.mode=24;case 24:if(v.extra){for(R=v.extra;B<R;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}v.offset+=$&(1<<v.extra)-1,$>>>=v.extra,B-=v.extra,v.back+=v.extra}if(v.offset>v.dmax){T.msg="invalid distance too far back",v.mode=30;break}v.mode=25;case 25:if(nt===0)break t;if(st=J-nt,v.offset>st){if((st=v.offset-st)>v.whave&&v.sane){T.msg="invalid distance too far back",v.mode=30;break}dt=st>v.wnext?(st-=v.wnext,v.wsize-st):v.wnext-st,st>v.length&&(st=v.length),wt=v.window}else wt=Q,dt=it-v.offset,st=v.length;for(nt<st&&(st=nt),nt-=st,v.length-=st;Q[it++]=wt[dt++],--st;);v.length===0&&(v.mode=21);break;case 26:if(nt===0)break t;Q[it++]=v.length,nt--,v.mode=21;break;case 27:if(v.wrap){for(;B<32;){if(G===0)break t;G--,$|=M[j++]<<B,B+=8}if(J-=nt,T.total_out+=J,v.total+=J,J&&(T.adler=v.check=v.flags?a(v.check,Q,J,it-J):o(v.check,Q,J,it-J)),J=nt,(v.flags?$:f($))!==v.check){T.msg="incorrect data check",v.mode=30;break}B=$=0}v.mode=28;case 28:if(v.wrap&&v.flags){for(;B<32;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if($!==(4294967295&v.total)){T.msg="incorrect length check",v.mode=30;break}B=$=0}v.mode=29;case 29:Z=1;break t;case 30:Z=-3;break t;case 31:return-4;case 32:default:return d}return T.next_out=it,T.avail_out=nt,T.next_in=j,T.avail_in=G,v.hold=$,v.bits=B,(v.wsize||J!==T.avail_out&&v.mode<30&&(v.mode<27||N!==4))&&V(T,T.output,T.next_out,J-T.avail_out)?(v.mode=31,-4):(at-=T.avail_in,J-=T.avail_out,T.total_in+=at,T.total_out+=J,v.total+=J,v.wrap&&J&&(T.adler=v.check=v.flags?a(v.check,Q,J,T.next_out-J):o(v.check,Q,J,T.next_out-J)),T.data_type=v.bits+(v.last?64:0)+(v.mode===12?128:0)+(v.mode===20||v.mode===15?256:0),(at==0&&J===0||N===4)&&Z===p&&(Z=-5),Z)},n.inflateEnd=function(T){if(!T||!T.state)return d;var N=T.state;return N.window&&(N.window=null),T.state=null,p},n.inflateGetHeader=function(T,N){var v;return T&&T.state&&2&(v=T.state).wrap?((v.head=N).done=!1,p):d},n.inflateSetDictionary=function(T,N){var v,M=N.length;return T&&T.state?(v=T.state).wrap!==0&&v.mode!==11?d:v.mode===11&&o(1,N,M,0)!==v.check?-3:V(T,N,M,M)?(v.mode=31,-4):(v.havedict=1,p):d},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,i,n){var r=e("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(c,u,p,d,_,m,g,f){var b,y,E,C,I,x,A,O,L,V=f.bits,T=0,N=0,v=0,M=0,Q=0,j=0,it=0,G=0,nt=0,$=0,B=null,at=0,J=new r.Buf16(16),st=new r.Buf16(16),dt=null,wt=0;for(T=0;T<=15;T++)J[T]=0;for(N=0;N<d;N++)J[u[p+N]]++;for(Q=V,M=15;1<=M&&J[M]===0;M--);if(M<Q&&(Q=M),M===0)return _[m++]=20971520,_[m++]=20971520,f.bits=1,0;for(v=1;v<M&&J[v]===0;v++);for(Q<v&&(Q=v),T=G=1;T<=15;T++)if(G<<=1,(G-=J[T])<0)return-1;if(0<G&&(c===0||M!==1))return-1;for(st[1]=0,T=1;T<15;T++)st[T+1]=st[T]+J[T];for(N=0;N<d;N++)u[p+N]!==0&&(g[st[u[p+N]]++]=N);if(x=c===0?(B=dt=g,19):c===1?(B=o,at-=257,dt=a,wt-=257,256):(B=l,dt=h,-1),T=v,I=m,it=N=$=0,E=-1,C=(nt=1<<(j=Q))-1,c===1&&852<nt||c===2&&592<nt)return 1;for(;;){for(A=T-it,L=g[N]<x?(O=0,g[N]):g[N]>x?(O=dt[wt+g[N]],B[at+g[N]]):(O=96,0),b=1<<T-it,v=y=1<<j;_[I+($>>it)+(y-=b)]=A<<24|O<<16|L|0,y!==0;);for(b=1<<T-1;$&b;)b>>=1;if(b!==0?($&=b-1,$+=b):$=0,N++,--J[T]==0){if(T===M)break;T=u[p+g[N]]}if(Q<T&&($&C)!==E){for(it===0&&(it=Q),I+=v,G=1<<(j=T-it);j+it<M&&!((G-=J[j+it])<=0);)j++,G<<=1;if(nt+=1<<j,c===1&&852<nt||c===2&&592<nt)return 1;_[E=$&C]=Q<<24|j<<16|I-m|0}}return $!==0&&(_[I+$]=T-it<<24|64<<16|0),f.bits=Q,0}},{"../utils/common":41}],51:[function(e,i,n){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,i,n){var r=e("../utils/common"),o=0,a=1;function l(P){for(var z=P.length;0<=--z;)P[z]=0}var h=0,c=29,u=256,p=u+1+c,d=30,_=19,m=2*p+1,g=15,f=16,b=7,y=256,E=16,C=17,I=18,x=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],V=new Array(2*(p+2));l(V);var T=new Array(2*d);l(T);var N=new Array(512);l(N);var v=new Array(256);l(v);var M=new Array(c);l(M);var Q,j,it,G=new Array(d);function nt(P,z,K,H,U){this.static_tree=P,this.extra_bits=z,this.extra_base=K,this.elems=H,this.max_length=U,this.has_stree=P&&P.length}function $(P,z){this.dyn_tree=P,this.max_code=0,this.stat_desc=z}function B(P){return P<256?N[P]:N[256+(P>>>7)]}function at(P,z){P.pending_buf[P.pending++]=255&z,P.pending_buf[P.pending++]=z>>>8&255}function J(P,z,K){P.bi_valid>f-K?(P.bi_buf|=z<<P.bi_valid&65535,at(P,P.bi_buf),P.bi_buf=z>>f-P.bi_valid,P.bi_valid+=K-f):(P.bi_buf|=z<<P.bi_valid&65535,P.bi_valid+=K)}function st(P,z,K){J(P,K[2*z],K[2*z+1])}function dt(P,z){for(var K=0;K|=1&P,P>>>=1,K<<=1,0<--z;);return K>>>1}function wt(P,z,K){var H,U,X=new Array(g+1),et=0;for(H=1;H<=g;H++)X[H]=et=et+K[H-1]<<1;for(U=0;U<=z;U++){var tt=P[2*U+1];tt!==0&&(P[2*U]=dt(X[tt]++,tt))}}function pt(P){var z;for(z=0;z<p;z++)P.dyn_ltree[2*z]=0;for(z=0;z<d;z++)P.dyn_dtree[2*z]=0;for(z=0;z<_;z++)P.bl_tree[2*z]=0;P.dyn_ltree[2*y]=1,P.opt_len=P.static_len=0,P.last_lit=P.matches=0}function _t(P){8<P.bi_valid?at(P,P.bi_buf):0<P.bi_valid&&(P.pending_buf[P.pending++]=P.bi_buf),P.bi_buf=0,P.bi_valid=0}function yt(P,z,K,H){var U=2*z,X=2*K;return P[U]<P[X]||P[U]===P[X]&&H[z]<=H[K]}function It(P,z,K){for(var H=P.heap[K],U=K<<1;U<=P.heap_len&&(U<P.heap_len&&yt(z,P.heap[U+1],P.heap[U],P.depth)&&U++,!yt(z,H,P.heap[U],P.depth));)P.heap[K]=P.heap[U],K=U,U<<=1;P.heap[K]=H}function Vt(P,z,K){var H,U,X,et,tt=0;if(P.last_lit!==0)for(;H=P.pending_buf[P.d_buf+2*tt]<<8|P.pending_buf[P.d_buf+2*tt+1],U=P.pending_buf[P.l_buf+tt],tt++,H===0?st(P,U,z):(st(P,(X=v[U])+u+1,z),(et=x[X])!==0&&J(P,U-=M[X],et),st(P,X=B(--H),K),(et=A[X])!==0&&J(P,H-=G[X],et)),tt<P.last_lit;);st(P,y,z)}function $t(P,z){var K,H,U,X=z.dyn_tree,et=z.stat_desc.static_tree,tt=z.stat_desc.has_stree,ht=z.stat_desc.elems,mt=-1;for(P.heap_len=0,P.heap_max=m,K=0;K<ht;K++)X[2*K]!==0?(P.heap[++P.heap_len]=mt=K,P.depth[K]=0):X[2*K+1]=0;for(;P.heap_len<2;)X[2*(U=P.heap[++P.heap_len]=mt<2?++mt:0)]=1,P.depth[U]=0,P.opt_len--,tt&&(P.static_len-=et[2*U+1]);for(z.max_code=mt,K=P.heap_len>>1;1<=K;K--)It(P,X,K);for(U=ht;K=P.heap[1],P.heap[1]=P.heap[P.heap_len--],It(P,X,1),H=P.heap[1],P.heap[--P.heap_max]=K,P.heap[--P.heap_max]=H,X[2*U]=X[2*K]+X[2*H],P.depth[U]=(P.depth[K]>=P.depth[H]?P.depth[K]:P.depth[H])+1,X[2*K+1]=X[2*H+1]=U,P.heap[1]=U++,It(P,X,1),2<=P.heap_len;);P.heap[--P.heap_max]=P.heap[1],function(gt,kt){var ce,jt,Xe,Ot,Ps,ii,fe=kt.dyn_tree,ni=kt.max_code,ri=kt.stat_desc.static_tree,as=kt.stat_desc.has_stree,$s=kt.stat_desc.extra_bits,ls=kt.stat_desc.extra_base,xe=kt.stat_desc.max_length,We=0;for(Ot=0;Ot<=g;Ot++)gt.bl_count[Ot]=0;for(fe[2*gt.heap[gt.heap_max]+1]=0,ce=gt.heap_max+1;ce<m;ce++)xe<(Ot=fe[2*fe[2*(jt=gt.heap[ce])+1]+1]+1)&&(Ot=xe,We++),fe[2*jt+1]=Ot,ni<jt||(gt.bl_count[Ot]++,Ps=0,ls<=jt&&(Ps=$s[jt-ls]),ii=fe[2*jt],gt.opt_len+=ii*(Ot+Ps),as&&(gt.static_len+=ii*(ri[2*jt+1]+Ps)));if(We!==0){do{for(Ot=xe-1;gt.bl_count[Ot]===0;)Ot--;gt.bl_count[Ot]--,gt.bl_count[Ot+1]+=2,gt.bl_count[xe]--,We-=2}while(0<We);for(Ot=xe;Ot!==0;Ot--)for(jt=gt.bl_count[Ot];jt!==0;)ni<(Xe=gt.heap[--ce])||(fe[2*Xe+1]!==Ot&&(gt.opt_len+=(Ot-fe[2*Xe+1])*fe[2*Xe],fe[2*Xe+1]=Ot),jt--)}}(P,z),wt(X,mt,P.bl_count)}function w(P,z,K){var H,U,X=-1,et=z[1],tt=0,ht=7,mt=4;for(et===0&&(ht=138,mt=3),z[2*(K+1)+1]=65535,H=0;H<=K;H++)U=et,et=z[2*(H+1)+1],++tt<ht&&U===et||(tt<mt?P.bl_tree[2*U]+=tt:U!==0?(U!==X&&P.bl_tree[2*U]++,P.bl_tree[2*E]++):tt<=10?P.bl_tree[2*C]++:P.bl_tree[2*I]++,X=U,mt=(tt=0)===et?(ht=138,3):U===et?(ht=6,3):(ht=7,4))}function Z(P,z,K){var H,U,X=-1,et=z[1],tt=0,ht=7,mt=4;for(et===0&&(ht=138,mt=3),H=0;H<=K;H++)if(U=et,et=z[2*(H+1)+1],!(++tt<ht&&U===et)){if(tt<mt)for(;st(P,U,P.bl_tree),--tt!=0;);else U!==0?(U!==X&&(st(P,U,P.bl_tree),tt--),st(P,E,P.bl_tree),J(P,tt-3,2)):tt<=10?(st(P,C,P.bl_tree),J(P,tt-3,3)):(st(P,I,P.bl_tree),J(P,tt-11,7));X=U,mt=(tt=0)===et?(ht=138,3):U===et?(ht=6,3):(ht=7,4)}}l(G);var Y=!1;function R(P,z,K,H){J(P,(h<<1)+(H?1:0),3),function(U,X,et,tt){_t(U),at(U,et),at(U,~et),r.arraySet(U.pending_buf,U.window,X,et,U.pending),U.pending+=et}(P,z,K)}n._tr_init=function(P){Y||(function(){var z,K,H,U,X,et=new Array(g+1);for(U=H=0;U<c-1;U++)for(M[U]=H,z=0;z<1<<x[U];z++)v[H++]=U;for(v[H-1]=U,U=X=0;U<16;U++)for(G[U]=X,z=0;z<1<<A[U];z++)N[X++]=U;for(X>>=7;U<d;U++)for(G[U]=X<<7,z=0;z<1<<A[U]-7;z++)N[256+X++]=U;for(K=0;K<=g;K++)et[K]=0;for(z=0;z<=143;)V[2*z+1]=8,z++,et[8]++;for(;z<=255;)V[2*z+1]=9,z++,et[9]++;for(;z<=279;)V[2*z+1]=7,z++,et[7]++;for(;z<=287;)V[2*z+1]=8,z++,et[8]++;for(wt(V,p+1,et),z=0;z<d;z++)T[2*z+1]=5,T[2*z]=dt(z,5);Q=new nt(V,x,u+1,p,g),j=new nt(T,A,0,d,g),it=new nt(new Array(0),O,0,_,b)}(),Y=!0),P.l_desc=new $(P.dyn_ltree,Q),P.d_desc=new $(P.dyn_dtree,j),P.bl_desc=new $(P.bl_tree,it),P.bi_buf=0,P.bi_valid=0,pt(P)},n._tr_stored_block=R,n._tr_flush_block=function(P,z,K,H){var U,X,et=0;0<P.level?(P.strm.data_type===2&&(P.strm.data_type=function(tt){var ht,mt=4093624447;for(ht=0;ht<=31;ht++,mt>>>=1)if(1&mt&&tt.dyn_ltree[2*ht]!==0)return o;if(tt.dyn_ltree[18]!==0||tt.dyn_ltree[20]!==0||tt.dyn_ltree[26]!==0)return a;for(ht=32;ht<u;ht++)if(tt.dyn_ltree[2*ht]!==0)return a;return o}(P)),$t(P,P.l_desc),$t(P,P.d_desc),et=function(tt){var ht;for(w(tt,tt.dyn_ltree,tt.l_desc.max_code),w(tt,tt.dyn_dtree,tt.d_desc.max_code),$t(tt,tt.bl_desc),ht=_-1;3<=ht&&tt.bl_tree[2*L[ht]+1]===0;ht--);return tt.opt_len+=3*(ht+1)+5+5+4,ht}(P),U=P.opt_len+3+7>>>3,(X=P.static_len+3+7>>>3)<=U&&(U=X)):U=X=K+5,K+4<=U&&z!==-1?R(P,z,K,H):P.strategy===4||X===U?(J(P,2+(H?1:0),3),Vt(P,V,T)):(J(P,4+(H?1:0),3),function(tt,ht,mt,gt){var kt;for(J(tt,ht-257,5),J(tt,mt-1,5),J(tt,gt-4,4),kt=0;kt<gt;kt++)J(tt,tt.bl_tree[2*L[kt]+1],3);Z(tt,tt.dyn_ltree,ht-1),Z(tt,tt.dyn_dtree,mt-1)}(P,P.l_desc.max_code+1,P.d_desc.max_code+1,et+1),Vt(P,P.dyn_ltree,P.dyn_dtree)),pt(P),H&&_t(P)},n._tr_tally=function(P,z,K){return P.pending_buf[P.d_buf+2*P.last_lit]=z>>>8&255,P.pending_buf[P.d_buf+2*P.last_lit+1]=255&z,P.pending_buf[P.l_buf+P.last_lit]=255&K,P.last_lit++,z===0?P.dyn_ltree[2*K]++:(P.matches++,z--,P.dyn_ltree[2*(v[K]+u+1)]++,P.dyn_dtree[2*B(z)]++),P.last_lit===P.lit_bufsize-1},n._tr_align=function(P){J(P,2,3),st(P,y,V),function(z){z.bi_valid===16?(at(z,z.bi_buf),z.bi_buf=0,z.bi_valid=0):8<=z.bi_valid&&(z.pending_buf[z.pending++]=255&z.bi_buf,z.bi_buf>>=8,z.bi_valid-=8)}(P)}},{"../utils/common":41}],53:[function(e,i,n){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,i,n){(function(r){(function(o,a){if(!o.setImmediate){var l,h,c,u,p=1,d={},_=!1,m=o.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(o);g=g&&g.setTimeout?g:o,l={}.toString.call(o.process)==="[object process]"?function(E){process.nextTick(function(){b(E)})}:function(){if(o.postMessage&&!o.importScripts){var E=!0,C=o.onmessage;return o.onmessage=function(){E=!1},o.postMessage("","*"),o.onmessage=C,E}}()?(u="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",y,!1):o.attachEvent("onmessage",y),function(E){o.postMessage(u+E,"*")}):o.MessageChannel?((c=new MessageChannel).port1.onmessage=function(E){b(E.data)},function(E){c.port2.postMessage(E)}):m&&"onreadystatechange"in m.createElement("script")?(h=m.documentElement,function(E){var C=m.createElement("script");C.onreadystatechange=function(){b(E),C.onreadystatechange=null,h.removeChild(C),C=null},h.appendChild(C)}):function(E){setTimeout(b,0,E)},g.setImmediate=function(E){typeof E!="function"&&(E=new Function(""+E));for(var C=new Array(arguments.length-1),I=0;I<C.length;I++)C[I]=arguments[I+1];var x={callback:E,args:C};return d[p]=x,l(p),p++},g.clearImmediate=f}function f(E){delete d[E]}function b(E){if(_)setTimeout(b,0,E);else{var C=d[E];if(C){_=!0;try{(function(I){var x=I.callback,A=I.args;switch(A.length){case 0:x();break;case 1:x(A[0]);break;case 2:x(A[0],A[1]);break;case 3:x(A[0],A[1],A[2]);break;default:x.apply(a,A)}})(C)}finally{f(E),_=!1}}}}function y(E){E.source===o&&typeof E.data=="string"&&E.data.indexOf(u)===0&&b(+E.data.slice(u.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof xu<"u"?xu:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(lE);var $R=lE.exports;const j0=t3($R);class Ng{constructor(t,e){D(this,"date",new Date),D(this,"author"),D(this,"guid",fi.create()),D(this,"viewpoint"),D(this,"modifiedAuthor"),D(this,"modifiedDate"),D(this,"topic"),D(this,"_components"),D(this,"_comment",""),this._components=t,this._comment=e;const i=this._components.get(Ne);this.author=i.config.author}set comment(t){var e;const i=this._components.get(Ne);this._comment=t,this.modifiedDate=new Date,this.modifiedAuthor=i.config.author,(e=this.topic)==null||e.comments.set(this.guid,this)}get comment(){return this._comment}toJSON(){var t,e;const i={guid:this.guid,date:this.date.toISOString(),author:this.author,comment:this.comment,topic_guid:(t=this.topic)==null?void 0:t.guid,viewpoint_guid:this.viewpoint,modified_date:(e=this.modifiedDate)==null?void 0:e.toISOString(),modified_author:this.modifiedAuthor};for(const[n,r]of Object.entries(i))r===void 0&&delete i[n];return i}}const hE=class Or{constructor(t){D(this,"guid",fi.create()),D(this,"title",Or.default.title),D(this,"creationDate",new Date),D(this,"creationAuthor",""),D(this,"viewpoints",new $f),D(this,"relatedTopics",new $f),D(this,"comments",new vl),D(this,"documentReferences",new $f),D(this,"customData",{}),D(this,"description"),D(this,"serverAssignedId"),D(this,"dueDate"),D(this,"modifiedAuthor"),D(this,"modifiedDate"),D(this,"index"),D(this,"_type",Or.default.type),D(this,"_status",Or.default.status),D(this,"_priority",Or.default.priority),D(this,"_stage",Or.default.stage),D(this,"_assignedTo",Or.default.assignedTo),D(this,"_labels",Or.default.labels??new Set),D(this,"_components"),this._components=t;const e=t.get(Ne);this.creationAuthor=e.config.author,this.relatedTopics.guard=i=>i!==this.guid}set type(t){const e=this._components.get(Ne),{strict:i,types:n}=e.config;(!i||n.has(t))&&(this._type=t)}get type(){return this._type}set status(t){const e=this._components.get(Ne),{strict:i,statuses:n}=e.config;(!i||n.has(t))&&(this._status=t)}get status(){return this._status}set priority(t){const e=this._components.get(Ne);if(t){const{strict:i,priorities:n}=e.config;if(!(!i||n.has(t)))return;this._priority=t}else this._priority=t}get priority(){return this._priority}set stage(t){const e=this._components.get(Ne);if(t){const{strict:i,stages:n}=e.config;if(!(!i||n.has(t)))return;this._stage=t}else this._stage=t}get stage(){return this._stage}set assignedTo(t){const e=this._components.get(Ne);if(t){const{strict:i,users:n}=e.config;if(!(!i||n.has(t)))return;this._assignedTo=t}else this._assignedTo=t}get assignedTo(){return this._assignedTo}set labels(t){const e=this._components.get(Ne),{strict:i,labels:n}=e.config;if(i){const r=new Set;for(const o of t)(!i||n.has(o))&&r.add(o);this._labels=r}else this._labels=t}get labels(){return this._labels}get _managerVersion(){return this._components.get(Ne).config.version}set(t){const e=t,i=this;for(const n in t){if(n==="guid")continue;const r=e[n];n in this&&(i[n]=r)}return this._components.get(Ne).list.set(this.guid,this),this}createComment(t,e){const i=new Ng(this._components,t);return i.viewpoint=e,i.topic=this,this.comments.set(i.guid,i),i}createLabelTags(){const t=[...this.labels];if(this._components.get(Ne).config.exportCustomDataAsLabels)for(const e in this.customData){const i=this.customData[e];typeof i=="string"&&t.push(i)}return t}createCommentTags(){return[...this.comments.values()].map(t=>{var e;return{$Guid:t.guid,Date:t.date.toISOString(),Author:t.author,Comment:t.comment,ModifiedAuthor:t.modifiedAuthor,ModifiedDate:(e=t.modifiedDate)==null?void 0:e.toISOString(),Viewpoint:t.viewpoint?{$Guid:t.viewpoint}:void 0}})}createViewpointTags(){const t=this._components.get(gi);return[...this.viewpoints].map(e=>t.list.get(e)).filter(e=>e).map(e=>{const i={$Guid:e.guid,Viewpoint:`${e.title??e.guid}.bcfv`};if(t.snapshots.get(e.snapshot)){const n=t.getSnapshotExtension(e.snapshot);i.Snapshot=`${e.snapshot}.${n}`}return i})}createRelatedTopicTags(){return[...this.relatedTopics].map(t=>({$Guid:t}))}createDocumentReferencesTag(t=this._managerVersion){const e=[];if(!(t==="3"||t==="2.1"))return e;const i=this._components.get(Ne);for(const n of this.documentReferences){const r=i.documents.get(n);if(!r)continue;let o={$Guid:fi.create(),Description:r.description};t==="2.1"&&(o={...o,$isExternal:r.type==="external"?!0:void 0,ReferencedDocument:r.type==="external"?r.url:`../${r.fileName}`}),t==="3"&&(o={...o,DocumentGuid:r.type==="internal"?n:void 0,Url:r.type==="external"?r.url:void 0}),Object.keys(o).length>0&&e.push(o)}return e}toJSON(){var t,e;const i={guid:this.guid,server_assigned_id:this.serverAssignedId,topic_type:this.type,topic_status:this.status,title:this.title,priority:this.priority,index:this.index,labels:[...this.labels],creation_date:this.creationDate.toISOString(),creation_author:this.creationAuthor,modified_date:(t=this.modifiedDate)==null?void 0:t.toISOString(),modified_author:this.modifiedAuthor,assigned_to:this.assignedTo,stage:this.stage,description:this.description,due_date:(e=this.dueDate)==null?void 0:e.toISOString(),comments:[...this.comments].map(([o,a])=>a.toJSON()),relatedTopics:[...this.relatedTopics].map(o=>({related_topic_guid:o}))},n=this._components.get(gi);for(const o of this.viewpoints){const a=n.list.get(o);a&&(i.viewpoints||(i.viewpoints=[]),i.viewpoints.push(a.toJSON()))}const r=this._components.get(Ne);for(const o of this.documentReferences){const a=r.documents.get(o);a&&(i.document_references||(i.document_references=[]),a.type==="external"?i.document_references.push({guid:fi.create(),description:a.description,url:a.url}):i.document_references.push({guid:fi.create(),description:a.description,document_guid:o}))}for(const[o,a]of Object.entries(i))(a===void 0||Array.isArray(a)&&a.length===0)&&delete i[o];return i}serialize(){var t,e;const i=this._managerVersion,n={$Guid:this.guid,$TopicType:this.type,$TopicStatus:this.status,$ServerAssignedId:this.serverAssignedId,Title:this.title,CreationAuthor:this.creationAuthor,CreationDate:this.creationDate.toISOString(),Priority:this.priority,Index:i==="2.1"?this.index:void 0,ModifiedDate:(t=this.modifiedDate)==null?void 0:t.toISOString(),ModifiedAuthor:this.modifiedAuthor,DueDate:(e=this.dueDate)==null?void 0:e.toISOString(),AssignedTo:this.assignedTo,Description:this.description,Stage:this.stage,DocumentReferences:i==="3"?{DocumentReference:this.createDocumentReferencesTag(i)}:void 0,RelatedTopics:i==="3"?{RelatedTopic:this.createRelatedTopicTags()}:void 0,RelatedTopic:i==="2.1"?this.createRelatedTopicTags():void 0,Labels:i==="3"?{Label:this.createLabelTags()}:void 0,Viewpoints:i==="3"?{ViewPoint:this.createViewpointTags()}:void 0,Comments:i==="3"?{Comment:this.createCommentTags()}:void 0};i==="2.1"&&(n.Labels=this.createLabelTags(),n.DocumentReference=this.createDocumentReferencesTag(i));const r={Markup:{Topic:n}};return i==="2.1"&&(r.Markup.Viewpoints=this.createViewpointTags(),r.Markup.Comment=this.createCommentTags()),`<?xml version="1.0" encoding="UTF-8"?>
    ${jp.builder.build(r)}`}};D(hE,"default",{title:"BCF Topic",type:"Issue",status:"Active"});let Sn=hE;const HR=(s,t)=>{if(t.trim()==="")return;const e=Ne.xmlParser.parse(t).Extensions;if(!e)return;const{Priorities:i,TopicStatuses:n,TopicTypes:r,Users:o}=e;if(i&&i.Priority){const a=Array.isArray(i.Priority)?i.Priority:[i.Priority];for(const l of a)s.config.priorities.add(l)}if(n&&n.TopicStatus){const a=Array.isArray(n.TopicStatus)?n.TopicStatus:[n.TopicStatus];for(const l of a)s.config.statuses.add(l)}if(r&&r.TopicType){const a=Array.isArray(r.TopicType)?r.TopicType:[r.TopicType];for(const l of a)s.config.types.add(l)}if(o&&o.User){const a=Array.isArray(o.User)?o.User:[o.User];for(const l of a)s.config.users.add(l)}};class jR extends Wc{constructor(){super(...arguments),D(this,"_config",{version:{type:"Select",options:new Set(["2.1","3"]),multiple:!1,value:""},author:{type:"Text",value:""},types:{type:"TextSet",value:new Set},statuses:{type:"TextSet",value:new Set},priorities:{type:"TextSet",value:new Set},labels:{type:"TextSet",value:new Set},stages:{type:"TextSet",value:new Set},users:{type:"TextSet",value:new Set},includeSelectionTag:{type:"Boolean",value:!1},updateExtensionsOnImport:{type:"Boolean",value:!1},strict:{type:"Boolean",value:!1},includeAllExtensionsOnExport:{type:"Boolean",value:!1},fallbackVersionOnImport:{type:"Select",multiple:!1,options:new Set(["2.1","3"]),value:""},ignoreIncompleteTopicsOnImport:{type:"Boolean",value:!1},exportCustomDataAsLabels:{type:"Boolean",value:!1}})}get version(){return this._config.version.value}set version(t){this._config.version.value=t}get author(){return this._config.author.value}set author(t){this._config.author.value=t}get types(){return this._config.types.value}set types(t){this._config.types.value=t}get statuses(){return this._config.statuses.value}set statuses(t){this._config.statuses.value=t}get priorities(){return this._config.priorities.value}set priorities(t){this._config.priorities.value=t}get labels(){return this._config.labels.value}set labels(t){this._config.labels.value=t}get stages(){return this._config.stages.value}set stages(t){this._config.stages.value=t}get users(){return this._config.users.value}set users(t){this._config.users.value=t}get includeSelectionTag(){return this._config.includeSelectionTag.value}set includeSelectionTag(t){this._config.includeSelectionTag.value=t}get updateExtensionsOnImport(){return this._config.updateExtensionsOnImport.value}set updateExtensionsOnImport(t){this._config.updateExtensionsOnImport.value=t}get strict(){return this._config.strict.value}set strict(t){this._config.strict.value=t}get includeAllExtensionsOnExport(){return this._config.includeAllExtensionsOnExport.value}set includeAllExtensionsOnExport(t){this._config.includeAllExtensionsOnExport.value=t}get fallbackVersionOnImport(){return this._config.fallbackVersionOnImport.value}set fallbackVersionOnImport(t){this._config.fallbackVersionOnImport.value=t}get ignoreIncompleteTopicsOnImport(){return this._config.ignoreIncompleteTopicsOnImport.value}set ignoreIncompleteTopicsOnImport(t){this._config.ignoreIncompleteTopicsOnImport.value=t}get exportCustomDataAsLabels(){return this._config.exportCustomDataAsLabels.value}set exportCustomDataAsLabels(t){this._config.exportCustomDataAsLabels.value=t}}const V_=class Vh extends Cs{constructor(){super(...arguments),D(this,"enabled",!1),D(this,"_defaultConfig",{author:"jhon.doe@example.com",version:"2.1",types:new Set(["Clash","Failure","Fault","Inquiry","Issue","Remark","Request"]),statuses:new Set(["Active","In Progress","Done","In Review","Closed"]),priorities:new Set(["On hold","Minor","Normal","Major","Critical"]),labels:new Set,stages:new Set,users:new Set,includeSelectionTag:!1,updateExtensionsOnImport:!0,strict:!1,includeAllExtensionsOnExport:!0,fallbackVersionOnImport:"2.1",ignoreIncompleteTopicsOnImport:!1,exportCustomDataAsLabels:!1}),D(this,"config",new jR(this,this.components,"BCF Topics",Vh.uuid)),D(this,"list",new vl),D(this,"documents",new vl),D(this,"onSetup",new Et),D(this,"isSetup",!1),D(this,"onBCFImported",new Et),D(this,"onDisposed",new Et)}setup(t){if(this.isSetup)return;const e={...this._defaultConfig,...t};this.config.version=e.version,this.config.author=e.author,this.config.types=e.types,this.config.statuses=e.statuses,this.config.priorities=e.priorities,this.config.labels=e.labels,this.config.stages=e.stages,this.config.users=e.users,this.config.includeSelectionTag=e.includeSelectionTag,this.config.updateExtensionsOnImport=e.updateExtensionsOnImport,this.config.strict=e.strict,this.config.includeAllExtensionsOnExport=e.includeAllExtensionsOnExport,this.config.fallbackVersionOnImport=e.fallbackVersionOnImport||"",this.config.ignoreIncompleteTopicsOnImport=e.ignoreIncompleteTopicsOnImport,this.isSetup=!0,this.enabled=!0,this.onSetup.trigger()}create(t){const e=new Sn(this.components);return t?(e.guid=t.guid??e.guid,e.set(t)):this.list.set(e.guid,e),e}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get usedTypes(){const t=[...this.list].map(([e,i])=>i.type);return new Set(t)}get usedStatuses(){const t=[...this.list].map(([e,i])=>i.status);return new Set(t)}get usedPriorities(){const t=[...this.list].map(([e,i])=>i.priority).filter(e=>e);return new Set(t)}get usedStages(){const t=[...this.list].map(([e,i])=>i.stage).filter(e=>e);return new Set(t)}get usedUsers(){const t=[];for(const[e,i]of this.list){t.push(i.creationAuthor),i.assignedTo&&t.push(i.assignedTo),i.modifiedAuthor&&t.push(i.modifiedAuthor);for(const[n,r]of i.comments)t.push(r.author),r.modifiedAuthor&&t.push(r.modifiedAuthor)}return new Set(t)}get usedLabels(){const t=[];for(const[e,i]of this.list)t.push(...i.labels);return new Set(t)}updateExtensions(){for(const[t,e]of this.list){for(const i of e.labels)this.config.labels.add(i);this.config.types.add(e.type),e.priority&&this.config.priorities.add(e.priority),e.stage&&this.config.stages.add(e.stage),this.config.statuses.add(e.status),this.config.users.add(e.creationAuthor),e.assignedTo&&this.config.users.add(e.assignedTo),e.modifiedAuthor&&this.config.users.add(e.modifiedAuthor);for(const[i,n]of e.comments)this.config.users.add(n.author),n.modifiedAuthor&&this.config.users.add(n.modifiedAuthor)}}updateViewpointReferences(){const t=this.components.get(gi);for(const[e,i]of this.list)for(const n of i.viewpoints)t.list.has(n)||i.viewpoints.delete(n)}async export(t=this.list.values()){const e=new j0;e.file("bcf.version",`<?xml version="1.0" encoding="UTF-8"?>
    <Version VersionId="${this.config.version}" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/buildingSMART/BCF-XML/release_3_0/Schemas/version.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    </Version>`);for(const[n,r]of this.documents.entries())r.type!=="external"&&e.file(this.config.version==="2.1"?r.fileName:`documents/${n}`,r.data);if(this.config.version==="3"){const n=[];for(const[r,o]of this.documents.entries()){const{type:a,description:l}=o;a!=="external"&&n.push(`<Document Guid="${r}">
        <Filename>${o.fileName}</Filename>
        ${l?`<Description>${l}</Description>`:""}
      </Document>`)}n.length>0&&e.file("documents.xml",`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
  <DocumentInfo xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="documents.xsd">
    <Documents>
      ${n.join(`
`)}
    </Documents>
  </DocumentInfo>`)}e.file("bcf.extensions",this.serializeExtensions());const i=this.components.get(gi);for(const n of t){const r=e.folder(n.guid);r.file("markup.bcf",n.serialize());for(const o of n.viewpoints){const a=i.list.get(o);if(!a)continue;const l=a.title??a.guid;r.file(`${l}.bcfv`,await a.serialize());const h=i.snapshots.get(a.snapshot);if(!h)continue;const c=h?a.snapshot:a.guid,u=i.getSnapshotExtension(a.snapshot);r.file(`${c}.${u}`,h,{binary:!0})}}return await e.generateAsync({type:"blob"})}serializeExtensions(){const t=[...this.config.types].map(a=>`<TopicType>${a}</TopicType>`).join(`
`),e=[...this.config.statuses].map(a=>`<TopicStatus>${a}</TopicStatus>`).join(`
`),i=[...this.config.priorities].map(a=>`<Priority>${a}</Priority>`).join(`
`),n=[...this.config.labels].map(a=>`<TopicLabel>${a}</TopicLabel>`).join(`
`),r=[...this.config.stages].map(a=>`<Stage>${a}</Stage>`).join(`
`),o=[...this.config.users].map(a=>`<User>${a}</User>`).join(`
`);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Extensions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="your-schema-location.xsd">
        ${t.length!==0?`<TopicTypes>
${t}
</TopicTypes>`:""}
        ${e.length!==0?`<TopicStatuses>
${e}
</TopicStatuses>`:""}
        ${i.length!==0?`<Priorities>
${i}
</Priorities>`:""}
        ${n.length!==0?`<TopicLabels>
${n}
</TopicLabels>`:""}
        ${r.length!==0?`<Stages>
${r}
</Stages>`:""}
        ${o.length!==0?`<Users>
${o}
</Users>`:""}
      </Extensions>
    `}processMarkupComment(t){const{Guid:e,Date:i,Author:n,Comment:r,Viewpoint:o}=t;if(!(e&&i&&n&&(Ng||o)))return null;const a=new Ng(this.components,r??"");return a.guid=e,a.date=new Date(i),a.author=n,a.viewpoint=o==null?void 0:o.Guid,a.modifiedAuthor=t.ModifiedAuthor,a.modifiedDate=t.ModifiedDate?new Date(t.ModifiedDate):void 0,a}getMarkupComments(t,e){var i;let n;if(e==="2.1"&&(n=t.Comment),e==="3"&&(n=(i=t.Topic.Comments)==null?void 0:i.Comment),!n)return[];n=Array.isArray(n)?n:[n];const r=n.map(o=>this.processMarkupComment(o)).filter(o=>o);return Array.isArray(r)?r:[r]}getMarkupLabels(t,e){var i;let n;return e==="2.1"&&(n=t.Topic.Labels),e==="3"&&(n=(i=t.Topic.Labels)==null?void 0:i.Label),n?Array.isArray(n)?n:[n]:[]}getMarkupViewpoints(t,e){var i;let n;return e==="2.1"&&(n=t.Viewpoints),e==="3"&&(n=(i=t.Topic.Viewpoints)==null?void 0:i.ViewPoint),n?(n=Array.isArray(n)?n:[n],n):[]}getMarkupRelatedTopics(t,e){var i;let n;return e==="2.1"&&(n=t.Topic.RelatedTopic),e==="3"&&(n=(i=t.Topic.RelatedTopics)==null?void 0:i.RelatedTopic),n?(Array.isArray(n)?n:[n]).map(r=>r.Guid):[]}getMarkupDocumentReferences(t,e){var i;let n;return e==="2.1"&&(n=t.Topic.DocumentReference),e==="3"&&(n=(i=t.Topic.DocumentReferences)==null?void 0:i.DocumentReference),n?Array.isArray(n)?n:[n]:[]}async load(t){var e,i,n;const{fallbackVersionOnImport:r,ignoreIncompleteTopicsOnImport:o,updateExtensionsOnImport:a}=this.config,l=new j0;await l.loadAsync(t);const h=Object.values(l.files);let c=r;const u=h.find(C=>C.name.endsWith(".version"));if(u){const C=await u.async("string"),I=Vh.xmlParser.parse(C).Version.VersionId;c=String(I)}if(!(c&&(c==="2.1"||c==="3")))throw new Error(`BCFTopics: ${c} is not supported.`);const p=h.find(C=>C.name.endsWith(".extensions"));if(a&&p){const C=await p.async("string");HR(this,C)}const d=[],_=this.components.get(gi),m=h.filter(C=>C.name.endsWith(".bcfv"));for(const C of m){const I=await C.async("string"),x=Vh.xmlParser.parse(I).VisualizationInfo;if(!x){console.warn("Missing VisualizationInfo in Viewpoint");continue}const A={},{Guid:O,ClippingPlanes:L,Components:V,OrthogonalCamera:T,PerspectiveCamera:N}=x;if(O&&(A.guid=O),V){const M={selection:[],coloring:[],visibility:{default_visibility:!1,exceptions:[],view_setup_hints:{spaces_visible:!1,space_boundaries_visible:!1,openings_visible:!1}}};A.components=M;const{Selection:Q,Visibility:j}=V;if(Q&&Q.Component){const nt=Array.isArray(Q.Component)?Q.Component:[Q.Component];M.selection=nt.map($=>$.IfcGuid?{ifc_guid:$.IfcGuid}:null).filter($=>$!==null)}if(j&&"DefaultVisibility"in j&&(M.visibility.default_visibility=j.DefaultVisibility),j&&j.Exceptions&&"Component"in j.Exceptions){const{Component:nt}=j.Exceptions,$=Array.isArray(nt)?nt:[nt];M.visibility.exceptions=$.map(B=>B.IfcGuid?{ifc_guid:B.IfcGuid}:null).filter(B=>B!==null)}let it;c==="2.1"&&(it=V.ViewSetupHints),c==="3"&&(it=(e=V.Visibility)==null?void 0:e.ViewSetupHints),it&&("OpeningsVisible"in it&&(M.visibility.view_setup_hints.openings_visible=it.OpeningsVisible),"SpacesVisible"in it&&(M.visibility.view_setup_hints.spaces_visible=it.SpacesVisible),"SpaceBoundariesVisible"in it&&(M.visibility.view_setup_hints.space_boundaries_visible=it.SpaceBoundariesVisible));const{Coloring:G}=V;if(G&&G.Color){const nt=Array.isArray(G.Color)?G.Color:[G.Color];for(const $ of nt){const{Color:B,Component:at}=$;if(!(B.length===6||B.length===8))continue;const J=B.length===6?B:B.slice(2),st=(Array.isArray(at)?at:[at]).map(dt=>dt.IfcGuid?{ifc_guid:dt.IfcGuid}:null).filter(dt=>dt!==null);M.coloring.push({color:J,components:st})}}}if(T||N){const M=x.PerspectiveCamera??x.OrthogonalCamera,{CameraViewPoint:Q,CameraDirection:j}=M,it=new F(Number(Q.X),Number(Q.Z),Number(-Q.Y)),G=new F(Number(j.X),Number(j.Z),Number(-j.Y)),nt={camera_view_point:{x:it.x,y:it.y,z:it.z},camera_direction:{x:G.x,y:G.y,z:G.z},aspect_ratio:"AspectRatio"in M?M.AspectRatio:1,camera_up_vector:{x:0,y:0,z:0}};"ViewToWorldScale"in M&&(A.orthogonal_camera={...nt,view_to_world_scale:M.ViewToWorldScale}),"FieldOfView"in M&&(A.perspective_camera={...nt,field_of_view:M.FieldOfView})}if(L){const M=(Array.isArray(L.ClippingPlane)?L.ClippingPlane:[L.ClippingPlane]).map(({Location:Q,Direction:j})=>({location:{x:Q.x,y:Q.y,z:Q.z},direction:{x:j.x,y:j.y,z:j.z}}));A.clipping_planes=M}const v=new uE(this.components,A);d.push(v)}const g=C=>{const I=C.split("/"),x=I[I.length-1].split(".");return x.pop(),x.join(".")},f=h.filter(C=>C.name.endsWith(".png")||C.name.endsWith(".jpeg"));for(const C of f){const I=g(C.name),x=await C.async("arraybuffer"),A=new Uint8Array(x);_.snapshots.set(I,A)}const b={},y=[],E=h.filter(C=>C.name.endsWith(".bcf"));for(const C of E){const I=await C.async("string"),x=Vh.xmlParser.parse(I).Markup,A=x.Topic,{Guid:O,TopicType:L,TopicStatus:V,Title:T,CreationDate:N,CreationAuthor:v}=A;if(o&&!(O&&L&&V&&T&&N&&v))continue;const M=new Sn(this.components);M.guid=O??M.guid;const Q=this.getMarkupRelatedTopics(x,c);b[M.guid]=new Set(Q),M.type=L??M.type,M.status=V??M.status,M.title=T??M.title,M.creationDate=N?new Date(N):M.creationDate,M.creationAuthor=v??M.creationAuthor,M.serverAssignedId=A.ServerAssignedId,M.priority=A.Priority,M.index=A.Index,M.modifiedDate=A.ModifiedDate?new Date(A.ModifiedDate):void 0,M.modifiedAuthor=A.ModifiedAuthor,M.dueDate=A.DueDate?new Date(A.DueDate):void 0,M.assignedTo=A.AssignedTo,M.description=A.Description,M.stage=A.Stage;const j=this.getMarkupLabels(x,c);for(const J of j)M.labels.add(J);const it=this.getMarkupComments(x,c);for(const J of it)M.comments.set(J.guid,J);const G=this.getMarkupViewpoints(x,c);for(const J of G){if(!(J&&J.Guid))continue;const st=_.list.get(J.Guid);if(st){M.viewpoints.add(st.guid);const dt=g(J.Snapshot);st.snapshot=dt??null}}const nt=this.getMarkupDocumentReferences(x,c),$=h.find(J=>J.name==="documents.xml");let B=[];const at=await($==null?void 0:$.async("string"));if(at){const J=(n=(i=jp.parser.parse(at).DocumentInfo)==null?void 0:i.Documents)==null?void 0:n.Document;B=Array.isArray(J)?J:[J]}for(const J of nt){const{Description:st,DocumentGuid:dt,Url:wt,isExternal:pt,ReferencedDocument:_t}=J;if(dt&&B.length>0){const yt=B.find(({Guid:Z})=>Z===dt),It=h.find(Z=>Z.name.endsWith(dt)),Vt=await(It==null?void 0:It.async("uint8array"));if(!(yt&&Vt))continue;const{Description:$t,Filename:w}=yt;this.documents.set(dt,{type:"internal",fileName:w,description:$t,data:Vt}),M.documentReferences.add(dt)}if(wt){const yt=this.documents.add({type:"external",url:wt,description:st});M.documentReferences.add(yt)}if(_t){let yt=null;if(pt)yt=this.documents.add({type:"external",url:_t,description:st});else{const It=_t.split("/"),Vt=It[It.length-1],$t=h.find(Z=>Z.name.endsWith(Vt)),w=await($t==null?void 0:$t.async("uint8array"));if(!w)continue;yt=this.documents.add({type:"internal",fileName:Vt,data:w,description:st})}M.documentReferences.add(yt)}}this.list.set(M.guid,M),y.push(M)}for(const C in b){const I=this.list.get(C);if(!I)continue;const x=b[C];for(const A of x)I.relatedTopics.add(A)}return this.onBCFImported.trigger(y),{viewpoints:d,topics:y}}};D(V_,"uuid","de977976-e4f6-4e4f-a01a-204727839802");D(V_,"xmlParser",new Hp.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let Ne=V_;const _o=new oa,xs=new F,Er=new F,we=new Ie,Y0={X:new F(1,0,0),Y:new F(0,1,0),Z:new F(0,0,1)},lm={type:"change"},W0={type:"mouseDown",mode:null},G0={type:"mouseUp",mode:null},q0={type:"objectChange"};class YR extends Cw{constructor(t,e=null){super(void 0,e);const i=new QR(this);this._root=i;const n=new KR;this._gizmo=n,i.add(n);const r=new JR;this._plane=r,i.add(r);const o=this;function a(y,E){let C=E;Object.defineProperty(o,y,{get:function(){return C!==void 0?C:E},set:function(I){C!==I&&(C=I,r[y]=I,n[y]=I,o.dispatchEvent({type:y+"-changed",value:I}),o.dispatchEvent(lm))}}),o[y]=E,r[y]=E,n[y]=E}a("camera",t),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0),a("minX",-1/0),a("maxX",1/0),a("minY",-1/0),a("maxY",1/0),a("minZ",-1/0),a("maxZ",1/0);const l=new F,h=new F,c=new Ie,u=new Ie,p=new F,d=new Ie,_=new F,m=new F,g=new F,f=0,b=new F;a("worldPosition",l),a("worldPositionStart",h),a("worldQuaternion",c),a("worldQuaternionStart",u),a("cameraPosition",p),a("cameraQuaternion",d),a("pointStart",_),a("pointEnd",m),a("rotationAxis",g),a("rotationAngle",f),a("eye",b),this._offset=new F,this._startNorm=new F,this._endNorm=new F,this._cameraScale=new F,this._parentPosition=new F,this._parentQuaternion=new Ie,this._parentQuaternionInv=new Ie,this._parentScale=new F,this._worldScaleStart=new F,this._worldQuaternionInv=new Ie,this._worldScale=new F,this._positionStart=new F,this._quaternionStart=new Ie,this._scaleStart=new F,this._getPointer=WR.bind(this),this._onPointerDown=qR.bind(this),this._onPointerHover=GR.bind(this),this._onPointerMove=ZR.bind(this),this._onPointerUp=XR.bind(this),e!==null&&this.connect(e)}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(t){if(this.object===void 0||this.dragging===!0)return;t!==null&&_o.setFromCamera(t,this.camera);const e=hm(this._gizmo.picker[this.mode],_o);e?this.axis=e.object.name:this.axis=null}pointerDown(t){if(!(this.object===void 0||this.dragging===!0||t!=null&&t.button!==0)&&this.axis!==null){t!==null&&_o.setFromCamera(t,this.camera);const e=hm(this._plane,_o,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,W0.mode=this.mode,this.dispatchEvent(W0)}}pointerMove(t){const e=this.axis,i=this.mode,n=this.object;let r=this.space;if(i==="scale"?r="local":(e==="E"||e==="XYZE"||e==="XYZ")&&(r="world"),n===void 0||e===null||this.dragging===!1||t!==null&&t.button!==-1)return;t!==null&&_o.setFromCamera(t,this.camera);const o=hm(this._plane,_o,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&e!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),e.indexOf("X")===-1&&(this._offset.x=0),e.indexOf("Y")===-1&&(this._offset.y=0),e.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&e!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(n.position.applyQuaternion(we.copy(this._quaternionStart).invert()),e.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),r==="world"&&(n.parent&&n.position.add(xs.setFromMatrixPosition(n.parent.matrixWorld)),e.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(xs.setFromMatrixPosition(n.parent.matrixWorld)))),n.position.x=Math.max(this.minX,Math.min(this.maxX,n.position.x)),n.position.y=Math.max(this.minY,Math.min(this.maxY,n.position.y)),n.position.z=Math.max(this.minZ,Math.min(this.maxZ,n.position.z));else if(i==="scale"){if(e.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),Er.set(a,a,a)}else xs.copy(this.pointStart),Er.copy(this.pointEnd),xs.applyQuaternion(this._worldQuaternionInv),Er.applyQuaternion(this._worldQuaternionInv),Er.divide(xs),e.search("X")===-1&&(Er.x=1),e.search("Y")===-1&&(Er.y=1),e.search("Z")===-1&&(Er.z=1);n.scale.copy(this._scaleStart).multiply(Er),this.scaleSnap&&(e.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(xs.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;e==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(xs.copy(this.rotationAxis).cross(this.eye))*a):(e==="X"||e==="Y"||e==="Z")&&(this.rotationAxis.copy(Y0[e]),xs.copy(Y0[e]),r==="local"&&xs.applyQuaternion(this.worldQuaternion),xs.cross(this.eye),xs.length()===0?l=!0:this.rotationAngle=this._offset.dot(xs.normalize())*a),(e==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&e!=="E"&&e!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(we.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(we.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(lm),this.dispatchEvent(q0)}}pointerUp(t){t!==null&&t.button!==0||(this.dragging&&this.axis!==null&&(G0.mode=this.mode,this.dispatchEvent(G0)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(t){return this.object=t,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(lm),this.dispatchEvent(q0),this.pointStart.copy(this.pointEnd))}getRaycaster(){return _o}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}}function WR(s){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:s.button};{const t=this.domElement.getBoundingClientRect();return{x:(s.clientX-t.left)/t.width*2-1,y:-(s.clientY-t.top)/t.height*2+1,button:s.button}}}function GR(s){if(this.enabled)switch(s.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(s));break}}function qR(s){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(s)),this.pointerDown(this._getPointer(s)))}function ZR(s){this.enabled&&this.pointerMove(this._getPointer(s))}function XR(s){this.enabled&&(this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(s)))}function hm(s,t,e){const i=t.intersectObject(s,!0);for(let n=0;n<i.length;n++)if(i[n].object.visible||e)return i[n];return!1}const Wu=new xw,ae=new F(0,1,0),Z0=new F(0,0,0),X0=new vt,Gu=new Ie,Vd=new Ie,vn=new F,Q0=new vt,$h=new F(1,0,0),Ao=new F(0,1,0),Hh=new F(0,0,1),qu=new F,lh=new F,hh=new F;class QR extends yi{constructor(t){super(),this.isTransformControlsRoot=!0,this.controls=t,this.visible=!1}updateMatrixWorld(t){const e=this.controls;e.object!==void 0&&(e.object.updateMatrixWorld(),e.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):e.object.parent.matrixWorld.decompose(e._parentPosition,e._parentQuaternion,e._parentScale),e.object.matrixWorld.decompose(e.worldPosition,e.worldQuaternion,e._worldScale),e._parentQuaternionInv.copy(e._parentQuaternion).invert(),e._worldQuaternionInv.copy(e.worldQuaternion).invert()),e.camera.updateMatrixWorld(),e.camera.matrixWorld.decompose(e.cameraPosition,e.cameraQuaternion,e._cameraScale),e.camera.isOrthographicCamera?e.camera.getWorldDirection(e.eye).negate():e.eye.copy(e.cameraPosition).sub(e.worldPosition).normalize(),super.updateMatrixWorld(t)}dispose(){this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}}class KR extends yi{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const t=new br({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),e=new Mp({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=t.clone();i.opacity=.15;const n=e.clone();n.opacity=.5;const r=t.clone();r.color.setHex(16711680);const o=t.clone();o.color.setHex(65280);const a=t.clone();a.color.setHex(255);const l=t.clone();l.color.setHex(16711680),l.opacity=.5;const h=t.clone();h.color.setHex(65280),h.opacity=.5;const c=t.clone();c.color.setHex(255),c.opacity=.5;const u=t.clone();u.opacity=.25;const p=t.clone();p.color.setHex(16776960),p.opacity=.25,t.clone().color.setHex(16776960);const d=t.clone();d.color.setHex(7895160);const _=new se(0,.04,.1,12);_.translate(0,.05,0);const m=new Jt(.08,.08,.08);m.translate(0,.04,0);const g=new ye;g.setAttribute("position",new Us([0,0,0,1,0,0],3));const f=new se(.0075,.0075,.5,3);f.translate(0,.25,0);function b(v,M){const Q=new Dn(v,.0075,3,64,M*Math.PI*2);return Q.rotateY(Math.PI/2),Q.rotateX(Math.PI/2),Q}function y(){const v=new ye;return v.setAttribute("position",new Us([0,0,0,1,1,1],3)),v}const E={X:[[new lt(_,r),[.5,0,0],[0,0,-Math.PI/2]],[new lt(_,r),[-.5,0,0],[0,0,Math.PI/2]],[new lt(f,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new lt(_,o),[0,.5,0]],[new lt(_,o),[0,-.5,0],[Math.PI,0,0]],[new lt(f,o)]],Z:[[new lt(_,a),[0,0,.5],[Math.PI/2,0,0]],[new lt(_,a),[0,0,-.5],[-Math.PI/2,0,0]],[new lt(f,a),null,[Math.PI/2,0,0]]],XYZ:[[new lt(new Hr(.1,0),u.clone()),[0,0,0]]],XY:[[new lt(new Jt(.15,.15,.01),c.clone()),[.15,.15,0]]],YZ:[[new lt(new Jt(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new lt(new Jt(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},C={X:[[new lt(new se(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new lt(new se(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new lt(new se(.2,0,.6,4),i),[0,.3,0]],[new lt(new se(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new lt(new se(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new lt(new se(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new lt(new Hr(.2,0),i)]],XY:[[new lt(new Jt(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new lt(new Jt(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new lt(new Jt(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},I={START:[[new lt(new Hr(.01,2),n),null,null,null,"helper"]],END:[[new lt(new Hr(.01,2),n),null,null,null,"helper"]],DELTA:[[new Ze(y(),n),null,null,null,"helper"]],X:[[new Ze(g,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ze(g,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ze(g,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},x={XYZE:[[new lt(b(.5,1),d),null,[0,Math.PI/2,0]]],X:[[new lt(b(.5,.5),r)]],Y:[[new lt(b(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new lt(b(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new lt(b(.75,1),p),null,[0,Math.PI/2,0]]]},A={AXIS:[[new Ze(g,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},O={XYZE:[[new lt(new Iw(.25,10,8),i)]],X:[[new lt(new Dn(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new lt(new Dn(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new lt(new Dn(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new lt(new Dn(.75,.1,2,24),i)]]},L={X:[[new lt(m,r),[.5,0,0],[0,0,-Math.PI/2]],[new lt(f,r),[0,0,0],[0,0,-Math.PI/2]],[new lt(m,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new lt(m,o),[0,.5,0]],[new lt(f,o)],[new lt(m,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new lt(m,a),[0,0,.5],[Math.PI/2,0,0]],[new lt(f,a),[0,0,0],[Math.PI/2,0,0]],[new lt(m,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new lt(new Jt(.15,.15,.01),c),[.15,.15,0]]],YZ:[[new lt(new Jt(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new lt(new Jt(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new lt(new Jt(.1,.1,.1),u.clone())]]},V={X:[[new lt(new se(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new lt(new se(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new lt(new se(.2,0,.6,4),i),[0,.3,0]],[new lt(new se(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new lt(new se(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new lt(new se(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new lt(new Jt(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new lt(new Jt(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new lt(new Jt(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new lt(new Jt(.2,.2,.2),i),[0,0,0]]]},T={X:[[new Ze(g,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ze(g,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ze(g,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function N(v){const M=new yi;for(const Q in v)for(let j=v[Q].length;j--;){const it=v[Q][j][0].clone(),G=v[Q][j][1],nt=v[Q][j][2],$=v[Q][j][3],B=v[Q][j][4];it.name=Q,it.tag=B,G&&it.position.set(G[0],G[1],G[2]),nt&&it.rotation.set(nt[0],nt[1],nt[2]),$&&it.scale.set($[0],$[1],$[2]),it.updateMatrix();const at=it.geometry.clone();at.applyMatrix4(it.matrix),it.geometry=at,it.renderOrder=1/0,it.position.set(0,0,0),it.rotation.set(0,0,0),it.scale.set(1,1,1),M.add(it)}return M}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=N(E)),this.add(this.gizmo.rotate=N(x)),this.add(this.gizmo.scale=N(L)),this.add(this.picker.translate=N(C)),this.add(this.picker.rotate=N(O)),this.add(this.picker.scale=N(V)),this.add(this.helper.translate=N(I)),this.add(this.helper.rotate=N(A)),this.add(this.helper.scale=N(T)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const e=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Vd;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let n=0;n<i.length;n++){const r=i[n];r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition);let o;if(this.camera.isOrthographicCamera?o=(this.camera.top-this.camera.bottom)/this.camera.zoom:o=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),r.scale.set(1,1,1).multiplyScalar(o*this.size/4),r.tag==="helper"){r.visible=!1,r.name==="AXIS"?(r.visible=!!this.axis,this.axis==="X"&&(we.setFromEuler(Wu.set(0,0,0)),r.quaternion.copy(e).multiply(we),Math.abs(ae.copy($h).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Y"&&(we.setFromEuler(Wu.set(0,0,Math.PI/2)),r.quaternion.copy(e).multiply(we),Math.abs(ae.copy(Ao).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Z"&&(we.setFromEuler(Wu.set(0,Math.PI/2,0)),r.quaternion.copy(e).multiply(we),Math.abs(ae.copy(Hh).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="XYZE"&&(we.setFromEuler(Wu.set(0,Math.PI/2,0)),ae.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix(X0.lookAt(Z0,ae,Ao)),r.quaternion.multiply(we),r.visible=this.dragging),this.axis==="E"&&(r.visible=!1)):r.name==="START"?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):r.name==="END"?(r.position.copy(this.worldPosition),r.visible=this.dragging):r.name==="DELTA"?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),xs.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),xs.applyQuaternion(this.worldQuaternionStart.clone().invert()),r.scale.copy(xs),r.visible=this.dragging):(r.quaternion.copy(e),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=this.axis.search(r.name)!==-1));continue}r.quaternion.copy(e),this.mode==="translate"||this.mode==="scale"?(r.name==="X"&&Math.abs(ae.copy($h).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Y"&&Math.abs(ae.copy(Ao).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Z"&&Math.abs(ae.copy(Hh).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XY"&&Math.abs(ae.copy(Hh).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="YZ"&&Math.abs(ae.copy($h).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XZ"&&Math.abs(ae.copy(Ao).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1)):this.mode==="rotate"&&(Gu.copy(e),ae.copy(this.eye).applyQuaternion(we.copy(e).invert()),r.name.search("E")!==-1&&r.quaternion.setFromRotationMatrix(X0.lookAt(this.eye,Z0,Ao)),r.name==="X"&&(we.setFromAxisAngle($h,Math.atan2(-ae.y,ae.z)),we.multiplyQuaternions(Gu,we),r.quaternion.copy(we)),r.name==="Y"&&(we.setFromAxisAngle(Ao,Math.atan2(ae.x,ae.z)),we.multiplyQuaternions(Gu,we),r.quaternion.copy(we)),r.name==="Z"&&(we.setFromAxisAngle(Hh,Math.atan2(ae.y,ae.x)),we.multiplyQuaternions(Gu,we),r.quaternion.copy(we))),r.visible=r.visible&&(r.name.indexOf("X")===-1||this.showX),r.visible=r.visible&&(r.name.indexOf("Y")===-1||this.showY),r.visible=r.visible&&(r.name.indexOf("Z")===-1||this.showZ),r.visible=r.visible&&(r.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),r.material._color=r.material._color||r.material.color.clone(),r.material._opacity=r.material._opacity||r.material.opacity,r.material.color.copy(r.material._color),r.material.opacity=r.material._opacity,this.enabled&&this.axis&&(r.name===this.axis||this.axis.split("").some(function(a){return r.name===a}))&&(r.material.color.setHex(16776960),r.material.opacity=1)}super.updateMatrixWorld(t)}}class JR extends lt{constructor(){super(new Rl(1e5,1e5,2,2),new br({visible:!1,wireframe:!0,side:Wn,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(t){let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),qu.copy($h).applyQuaternion(e==="local"?this.worldQuaternion:Vd),lh.copy(Ao).applyQuaternion(e==="local"?this.worldQuaternion:Vd),hh.copy(Hh).applyQuaternion(e==="local"?this.worldQuaternion:Vd),ae.copy(lh),this.mode){case"translate":case"scale":switch(this.axis){case"X":ae.copy(this.eye).cross(qu),vn.copy(qu).cross(ae);break;case"Y":ae.copy(this.eye).cross(lh),vn.copy(lh).cross(ae);break;case"Z":ae.copy(this.eye).cross(hh),vn.copy(hh).cross(ae);break;case"XY":vn.copy(hh);break;case"YZ":vn.copy(qu);break;case"XZ":ae.copy(hh),vn.copy(lh);break;case"XYZ":case"E":vn.set(0,0,0);break}break;case"rotate":default:vn.set(0,0,0)}vn.length()===0?this.quaternion.copy(this.cameraQuaternion):(Q0.lookAt(xs.set(0,0,0),vn,ae),this.quaternion.setFromRotationMatrix(Q0)),super.updateMatrixWorld(t)}}class $_{constructor(t,e,i,n,r,o=5,a=!0){if(D(this,"onDraggingStarted",new Et),D(this,"onDraggingEnded",new Et),D(this,"onDisposed",new Et),D(this,"normal"),D(this,"origin"),D(this,"three",new Ht),D(this,"components"),D(this,"world"),D(this,"type","default"),D(this,"_title","Clipping Plane"),D(this,"_helper"),D(this,"_visible",!0),D(this,"_enabled",!0),D(this,"_controlsActive",!1),D(this,"_arrowBoundBox",new lt),D(this,"_planeMesh"),D(this,"_controls"),D(this,"_hiddenMaterial",new br({visible:!1})),D(this,"_visibilityBeforeDisabled",!0),D(this,"notifyManager",()=>{const l=this.components.get(Ka),h=l.list.getKey(this);h&&l.list.set(h,this)}),D(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),D(this,"changeDrag",l=>{this._visible=!l.value,this.preventCameraMovement(),this.notifyDraggingChanged(l)}),this.components=t,this.world=e,!e.renderer)throw new Error("The given world must have a renderer!");this.normal=n,this.origin=i,e.renderer.setPlane(!0,this.three),this._planeMesh=$_.newPlaneMesh(o,r),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(n,i),a&&this.toggleControls(!0)}set title(t){this._title=t,this.notifyManager()}get title(){return this._title}get enabled(){return this._enabled}set enabled(t){if(!this.world.isDisposing){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=t,t?this.visible=this._visibilityBeforeDisabled:(this._visibilityBeforeDisabled=this.visible,this.visible=!1),this.world.renderer.setPlane(t,this.three),this.notifyManager()}}get visible(){return this._visible}set visible(t){this._visible=t,this._controls.getHelper().visible=t,this._helper.visible=t,this.toggleControls(t),this.notifyManager()}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(t){this._planeMesh.material=t}get size(){return this._planeMesh.scale.x}set size(t){this._planeMesh.scale.set(t,t,t)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(t,e){this.reset(),this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.getHelper().removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const t=new F(1,0,0),e=new F;this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix()}toggleControls(t){if(t){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=t}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const t=this.world.camera.three,e=this.world.renderer.three.domElement,i=new YR(t,e);return this.initializeControls(i),this.world.scene.three.add(i.getHelper()),i}initializeControls(t){t.attach(this._helper),t.showX=!1,t.showY=!1,t.setSpace("local"),this.createArrowBoundingBox(),t.getHelper().children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new se(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(t){t.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const t=new yi;return t.lookAt(this.normal),t.position.copy(this.origin),this._planeMesh.position.z+=.01,t.add(this._planeMesh),this.world.scene.three.add(t),t}static newPlaneMesh(t,e){const i=new Rl(1),n=new lt(i,e);return n.scale.set(t,t,t),n}}class tL extends Wc{constructor(){super(...arguments),D(this,"_config",{enabled:{value:!0,type:"Boolean"},visible:{value:!0,type:"Boolean"},color:{value:new xt,type:"Color"},opacity:{type:"Number",interpolable:!0,value:1,min:0,max:1},size:{type:"Number",interpolable:!0,value:2,min:0,max:100}})}get enabled(){return this._config.enabled.value}set enabled(t){this._config.enabled.value=t,this._component.enabled=t}get visible(){return this._config.visible.value}set visible(t){this._config.visible.value=t,this._component.visible=t}get color(){return this._config.color.value}set color(t){this._config.color.value=t,this._component.material.color.copy(t)}get opacity(){return this._config.opacity.value}set opacity(t){this._config.opacity.value=t,this._component.material.opacity=t}get size(){return this._config.size.value}set size(t){this._config.size.value=t,this._component.size=t}}const cE=class $d extends Cs{constructor(t){super(t),D(this,"onSetup",new Et),D(this,"onBeforeDrag",new Et),D(this,"onAfterDrag",new Et),D(this,"onBeforeCreate",new Et),D(this,"onBeforeCancel",new Et),D(this,"onAfterCancel",new Et),D(this,"onBeforeDelete",new Et),D(this,"onAfterCreate",new Et),D(this,"onAfterDelete",new Et),D(this,"onDisposed",new Et),D(this,"isSetup",!1),D(this,"orthogonalY",!1),D(this,"toleranceOrthogonalY",.7),D(this,"Type",$_),D(this,"list",new Wt),D(this,"config",new tL(this,this.components,"Clipper",$d.uuid)),D(this,"_defaultConfig",{color:new xt(12255487),opacity:.2,size:2}),D(this,"_material",new br({color:12255487,side:Wn,transparent:!0,opacity:.2})),D(this,"_size",5),D(this,"_enabled",!1),D(this,"_visible",!0),D(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),D(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add($d.uuid,this),this.setEvents()}get enabled(){return this._enabled}set enabled(t){this._enabled=t}get visible(){return this._visible}set visible(t){this._visible=t;for(const[e,i]of this.list)i.visible=t}get material(){return this._material}set material(t){this._material=t;for(const[e,i]of this.list)i.planeMaterial=t}get size(){return this._size}set size(t){this._size=t;for(const[e,i]of this.list)i.size=t}setEvents(){this.list.onBeforeDelete.add(({value:t})=>{if(!t.world.renderer)throw new Error("Renderer not found for this plane's world!");t.world.renderer.setPlane(!1,t.three),t.dispose(),this.updateMaterialsAndPlanes()})}dispose(){this._enabled=!1,this.components.get(Yp).list.delete(this.config.uuid),this.list.clear(),this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger($d.uuid),this.onDisposed.reset()}async create(t){const e=await this.components.get(Tg).get(t).castRay();return e?this.createPlaneFromIntersection(t,e):null}createFromNormalAndCoplanarPoint(t,e,i){const n=this.newPlane(t,i,e);return this.updateMaterialsAndPlanes(),n}async delete(t,e){if(!e){const i=await this.pickPlane(t);if(!i)return;e=this.list.getKey(i)}e&&this.list.delete(e)}deleteAll(t){for(const[e,i]of this.list)(!t||t.has(i.type))&&this.list.delete(e)}setup(t){const e={...this._defaultConfig,...t};this.config.color=e.color,this.config.opacity=e.opacity,this.config.size=e.size,this.isSetup=!0,this.onSetup.trigger()}async pickPlane(t){const e=this.components.get(Tg).get(t),i=this.getAllPlaneMeshes(),n=await e.castRay({items:i});if(n){const r=n.object;return[...this.list.values()].find(o=>o.meshes.includes(r))}}getAllPlaneMeshes(){const t=[];for(const[e,i]of this.list)t.push(...i.meshes);return t}createPlaneFromIntersection(t,e){var i;if(!t.renderer)throw new Error("The given world must have a renderer!");const n=e.point.distanceTo(new F(0,0,0)),r=e.normal||((i=e.face)==null?void 0:i.normal);if(!n||!r)return null;const o=this.getWorldNormal(e,r),a=this.newPlane(t,e.point,o.negate()),l=this.list.get(a);return l.visible=this._visible,l.size=this._size,t.renderer.setPlane(!0,l.three),this.updateMaterialsAndPlanes(),l}getWorldNormal(t,e){const i=t.object;let n=t.object.matrixWorld.clone();if(i instanceof dw&&t.instanceId!==void 0){const a=new vt;i.getMatrixAt(t.instanceId,a),n=a.multiply(n)}const r=new pw().getNormalMatrix(n),o=e.clone().applyMatrix3(r).normalize();return this.normalizePlaneDirectionY(o),o}normalizePlaneDirectionY(t){this.orthogonalY&&(t.y>this.toleranceOrthogonalY&&(t.x=0,t.y=1,t.z=0),t.y<-this.toleranceOrthogonalY&&(t.x=0,t.y=-1,t.z=0))}newPlane(t,e,i){const n=new this.Type(this.components,t,e,i,this._material);n.onDraggingStarted.add(this._onStartDragging),n.onDraggingEnded.add(this._onEndDragging);const r=fi.create();return this.list.set(r,n),this.onAfterCreate.trigger(n),r}updateMaterialsAndPlanes(){const t=this.components.get(Gc);for(const[e,i]of t.list){if(!i.renderer)continue;i.renderer.updateClippingPlanes();const{clippingPlanes:n}=i.renderer;for(const r of i.meshes)if(r.material)if(Array.isArray(r.material))for(const o of r.material)o.clippingPlanes=n;else r.material.clippingPlanes=n}}};D(cE,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let Ka=cE;class uE{constructor(t,e){D(this,"title"),D(this,"guid",fi.create()),D(this,"clippingPlanes",new ge),D(this,"camera",{aspect_ratio:1,field_of_view:60,camera_direction:{x:0,y:0,z:0},camera_view_point:{x:0,y:0,z:0},camera_up_vector:{x:0,y:1,z:0}}),D(this,"exceptionComponents",new ge),D(this,"selectionComponents",new ge),D(this,"componentColors",new Wt),D(this,"spacesVisible",!1),D(this,"spaceBoundariesVisible",!1),D(this,"openingsVisible",!1),D(this,"defaultVisibility",!0),D(this,"snapshot",this.guid),D(this,"_components"),D(this,"_world",null),D(this,"notifyUpdate",()=>{this._components.get(gi).list.set(this.guid,this)}),this._components=t,e&&(this.guid=e.guid??this.guid,this.set(e)),this.setEvents()}async getSelectionMap(){return await this._components.get(Rt).guidsToModelIdMap([...this.selectionComponents])}async getExceptionMap(){return await this._components.get(Rt).guidsToModelIdMap([...this.exceptionComponents])}get projection(){return"field_of_view"in this.camera?"Perspective":"Orthographic"}get position(){const t=this._components.get(Rt),{camera_view_point:e}=this.camera,{x:i,y:n,z:r}=e,o=new F(i,n,r);return t.applyBaseCoordinateSystem(o,new vt),o}set position(t){const e=t.clone(),i=this._components.get(Rt);t.clone().applyMatrix4(i.baseCoordinationMatrix.clone().invert()),this.camera.camera_view_point={x:e.x,y:e.y,z:e.z}}get direction(){const{camera_direction:t}=this.camera,{x:e,y:i,z:n}=t;return new F(e,i,n)}set world(t){this._world=t}get world(){return this._world}get _managerVersion(){return this._components.get(Ne).config.version}get topics(){return[...this._components.get(Ne).list.values()].filter(t=>t.viewpoints.has(this.guid))}setEvents(){this.selectionComponents.onUpdated.add(this.notifyUpdate),this.exceptionComponents.onUpdated.add(this.notifyUpdate),this.clippingPlanes.onUpdated.add(this.notifyUpdate),this.componentColors.onItemSet.add(this.notifyUpdate),this.componentColors.onItemDeleted.add(this.notifyUpdate),this.componentColors.onItemUpdated.add(this.notifyUpdate),this.componentColors.onCleared.add(this.notifyUpdate)}set(t){this.title=t.title;const{components:e,perspective_camera:i,orthogonal_camera:n,clipping_planes:r}=t;if(e){const{selection:o,visibility:a,coloring:l}=e;if(o){this.selectionComponents.clear();for(const{ifc_guid:h}of o)h&&this.selectionComponents.add(h)}if(a){const{default_visibility:h,exceptions:c,view_setup_hints:u}=a;if(h!==void 0&&(this.defaultVisibility=h),c){this.exceptionComponents.clear();for(const{ifc_guid:p}of c)p&&this.exceptionComponents.add(p)}if(u){const{spaces_visible:p,space_boundaries_visible:d,openings_visible:_}=u;p!==void 0&&(this.spacesVisible=p),d!==void 0&&(this.spaceBoundariesVisible=d),_!==void 0&&(this.openingsVisible=_)}}if(l){this.componentColors.clear();for(const h of l){const{color:c,components:u}=h,p=u.map(d=>d.ifc_guid).filter(d=>d!==null);this.componentColors.set(c,p)}}}if((i||n)&&(this.camera=i??n),r&&this.world){const o=this._components.get(Ka);for(const a of r){const{location:l,direction:h}=a,c=new F(l.x,l.z,-l.y),u=new F(h.x,h.z,-h.y),p=o.createFromNormalAndCoplanarPoint(this.world,u,c);this.clippingPlanes.add(p),o.list.get(p).enabled=!1,o.list.get(p).visible=!1}}this.notifyUpdate()}async go(t){if(!this.world)return;const{camera:e}=this.world;if(!(e instanceof qp))throw new Error("Viewpoint: the world's camera component must be of type OrthoPerspectiveCamera to switch between perspective and orthographic projections.");const{transition:i,applyClippings:n,applyVisibility:r,clippingsVisibility:o}={transition:!0,applyClippings:!0,applyVisibility:!0,clippingsVisibility:!0,...t};e.projection.set(this.projection);const a=new F(this.camera.camera_view_point.x,this.camera.camera_view_point.y,this.camera.camera_view_point.z),l=new F(this.camera.camera_direction.x,this.camera.camera_direction.y,this.camera.camera_direction.z);if(a.equals(new F)&&l.equals(new F))return;const h=this.position,c=this.direction,u=80,p={x:h.x+c.x*u,y:h.y+c.y*u,z:h.z+c.z*u},d=[];n&&this.setClippingState(!0),r&&d.push(this.applyVisibility()),this.setClippingVisibility(o),d.push(e.controls.setLookAt(h.x,h.y,h.z,p.x,p.y,p.z,i)),await Promise.all(d)}async updateCamera(t=!0){return new Promise(e=>{if(!this.world){e(!1);return}const{camera:i,renderer:n}=this.world;if(!n)throw new Error("Viewpoint: the world needs to have a renderer!");if(!i.hasCameraControls())throw new Error("Viewpoint: world's camera need camera controls!");const r=new F;i.controls.getPosition(r);const o=i.three,a=new F(0,0,-1).applyEuler(o.rotation),{width:l,height:h}=n.getSize();let c=l/h;Number.isNaN(c)&&(c=1);const u=this._components.get(Rt);r.applyMatrix4(u.baseCoordinationMatrix.clone().invert());const p={aspect_ratio:c,camera_view_point:{x:r.x,y:r.y,z:r.z},camera_direction:{x:a.x,y:a.y,z:a.z},camera_up_vector:{x:0,y:1,z:0}};if(o instanceof Hc?this.camera={...p,field_of_view:o.fov}:o instanceof aa&&(this.camera={...p,view_to_world_scale:o.top-o.bottom}),t){const d=this._components.get(gi),_=n.three.domElement;n.three.render(this.world.scene.three,i.three),_.toBlob(async m=>{if(m){const g=await m.arrayBuffer(),f=new Uint8Array(g);d.snapshots.set(this.guid,f)}this.notifyUpdate(),e(!0)})}else this.notifyUpdate(),e(!0)})}takeSnapshot(){return new Promise(t=>{if(!this.world){t(!1);return}const{camera:e,renderer:i}=this.world;if(!i)throw new Error("Viewpoint: the world needs to have a renderer!");const n=this._components.get(gi),r=i.three.domElement;i.three.render(this.world.scene.three,e.three),r.toBlob(async o=>{if(o){const a=await o.arrayBuffer(),l=new Uint8Array(a);n.snapshots.set(this.guid,l)}this.notifyUpdate(),t(!0)})})}updateClippingPlanes(){this.clippingPlanes.clear();const t=this._components.get(Ka);for(const[e,i]of t.list)i.enabled&&this.clippingPlanes.add(e)}async applyVisibility(){const t=this._components.get(bF);t.set(this.defaultVisibility);const e=await this.getExceptionMap();t.set(!this.defaultVisibility,e);const i=await this.getSelectionMap();t.set(!0,i)}async setColorizationState(t){const e=this._components.get(Rt),i=[];if(t)for(const[n,r]of this.componentColors){const o=`#${n}`,a=await e.guidsToModelIdMap(r);for(const[l,h]of Object.entries(a)){const c=e.list.get(l);c&&i.push(c.highlight([...h],{customId:o,color:new xt(o),renderedFaces:jc.ONE,opacity:1,transparent:!1}))}}else for(const[n,r]of this.componentColors){const o=await e.guidsToModelIdMap(r);for(const[a,l]of Object.entries(o)){const h=e.list.get(a);h&&i.push(h.resetHighlight([...l]))}}i.push(e.core.update(!0)),await Promise.all(i)}setClippingState(t){const e=this._components.get(Ka);for(const[i,n]of e.list)n.enabled=t&&this.clippingPlanes.has(i)}setClippingVisibility(t){const e=this._components.get(Ka);for(const i of this.clippingPlanes){const n=e.list.get(i);n&&(n.visible=t)}}async createComponentTags(t){var e;const i=this._components.get(Rt),n=this._components.get(Ne);let r="";if(n.config.includeSelectionTag){const o=t==="selection"?await this.getSelectionMap():await this.getExceptionMap();for(const a in o){const l=i.list.get(a);if(!l)continue;const h=o[a];for(const c of h){const u=l.getItem(c),p=await u.getGuid();if(!p)continue;const d=(e=await u.getAttributes())==null?void 0:e.getValue("Tag");let _=null;d&&(_=`AuthoringToolId="${d}"`),r+=`
<Component IfcGuid="${p}" ${_??""} />`}}}else r=[...this.selectionComponents].map(o=>`<Component IfcGuid="${o}" />`).join(`
`);return r}createColorTags(){let t="";for(const[e,i]of this.componentColors.entries()){const n=i.map(r=>`
<Component IfcGuid="${r}" />`).join(`
`);t+=`<Color Color="${e}">
${n}
</Color>`}return t.length!==0?`<Coloring>
${t}
</Coloring>`:"<Coloring />"}toJSON(){const t=this._components.get(Ka),e={guid:this.guid,components:{selection:[...this.selectionComponents].map(r=>({ifc_guid:r,authoring_tool_id:null})),coloring:[...this.componentColors].map(([r,o])=>({color:r,components:o.map(a=>({ifc_guid:a,authoring_tool_id:null}))})),visibility:{default_visibility:this.defaultVisibility,exceptions:[...this.exceptionComponents].map(r=>({ifc_guid:r,authoring_tool_id:null})),view_setup_hints:{spaces_visible:this.spacesVisible,space_boundaries_visible:this.spaceBoundariesVisible,openings_visible:this.openingsVisible}}},clipping_planes:[...this.clippingPlanes].map(r=>{const o=t.list.get(r);if(!o)return null;const a=o._controls.worldPosition??o.origin,{normal:l}=o;return{location:{x:a.x,y:-a.z,z:a.y},direction:{x:l.x,y:-l.z,z:l.y}}}).filter(r=>r!==null)};"field_of_view"in this.camera?e.perspective_camera=this.camera:e.orthogonal_camera=this.camera;const i=this._components.get(gi),n=i.snapshots.get(this.snapshot);if(n){const r=n.toString(),o=btoa(r),a=i.getSnapshotExtension(this.snapshot);e.snapshot={snapshot_type:a,snapshot_data:o}}return e}async serialize(t=this._managerVersion){const e=this._components.get(Rt),i=this.position;i.applyMatrix4(e.baseCoordinationMatrix.clone().invert());const n=this.direction;n.normalize();const r=new vt().makeRotationX(Math.PI/2),o=n.clone().applyMatrix4(r);o.normalize();const a=`<CameraViewPoint>
      <X>${i.x}</X>
      <Y>${-i.z}</Y>
      <Z>${i.y}</Z>
    </CameraViewPoint>`,l=`<CameraDirection>
      <X>${n.x}</X>
      <Y>${-n.z}</Y>
      <Z>${n.y}</Z>
    </CameraDirection>`,h=`<CameraUpVector>
      <X>${o.x}</X>
      <Y>${-o.z}</Y>
      <Z>${o.y}</Z>
    </CameraUpVector>`,c=`<AspectRatio>${this.camera.aspect_ratio}</AspectRatio>`;let u="";"viewToWorld"in this.camera?u=`<OrthogonalCamera>
        ${a}
        ${l}
        ${h}
        ${c}
        <ViewToWorldScale>${this.camera.viewToWorld}</ViewToWorldScale>
      </OrthogonalCamera>`:"fov"in this.camera&&(u=`<PerspectiveCamera>
        ${a}
        ${l}
        ${h}
        ${c}
        <FieldOfView>${this.camera.fov}</FieldOfView>
      </PerspectiveCamera>`);const p=`<ViewSetupHints SpacesVisible="${this.spacesVisible??!1}" SpaceBoundariesVisible="${this.spaceBoundariesVisible??!1}" OpeningsVisible="${this.openingsVisible??!1}" />`,d=(await this.createComponentTags("selection")).trim(),_=(await this.createComponentTags("exception")).trim(),m=this.createColorTags();return`<?xml version="1.0" encoding="UTF-8"?>
    <VisualizationInfo Guid="${this.guid}">
      <Components>
        ${t==="2.1"?p:""}
        ${d.length!==0?`<Selection>${d}</Selection>`:""}
        <Visibility DefaultVisibility="${this.defaultVisibility}">
          ${t==="3"?p:""}
          ${_.length!==0?`<Exceptions>${_}</Exceptions>`:""}
        </Visibility>
        ${m}
      </Components>
      ${u}
    </VisualizationInfo>`}}class eL extends Wc{constructor(){super(...arguments),D(this,"_config",{overwriteColors:{value:!1,type:"Boolean"}})}get overwriteColors(){return this._config.overwriteColors.value}set overwriteColors(t){this._config.overwriteColors.value=t}}const dE=class Mg extends Cs{constructor(t){super(t),D(this,"enabled",!0),D(this,"world",null),D(this,"list",new Wt),D(this,"snapshots",new Wt),D(this,"isSetup",!1),D(this,"onSetup",new Et),D(this,"config",new eL(this,this.components,"Viewpoints",Mg.uuid)),D(this,"onDisposed",new Et),t.add(Mg.uuid,this)}create(t){const e=new uE(this.components,t);return e.world=this.world,t||this.list.set(e.guid,e),e}getSnapshotExtension(t){let e="jpeg";const i=this.snapshots.get(t);if(!i)return e;const n=i.subarray(0,4);let r="";for(let o=0;o<n.length;o++)r+=n[o].toString(16);return r.startsWith("89504e47")&&(e="png"),r.startsWith("ffd8ffe")&&(e="jpeg"),e}setup(){}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}};D(dE,"uuid","ee867824-a796-408d-8aa0-4e5962a83c66");let gi=dE;class K0{constructor(t,e){D(this,"_components"),D(this,"_cameraOffset",10),D(this,"_planeHelper"),D(this,"_farPlaneHelper"),D(this,"_cameraHelper"),D(this,"onStateChanged",new Et),D(this,"onUpdated",new Et),D(this,"onDisposed",new Et),D(this,"camera"),D(this,"plane",new Ht),D(this,"farPlane",new Ht),D(this,"id",fi.create()),D(this,"_open",!1),D(this,"_range",sL.defaultRange),D(this,"_world",null),D(this,"_helpersVisible",!1),D(this,"_planesEnabled",!1),this._components=t,this.camera=new qp(this._components);const{threeOrtho:i}=this.camera;if(e!=null&&e.id&&(this.id=e.id),e!=null&&e.normal&&e!=null&&e.point){const{normal:n,point:r}=e;this.plane.setFromNormalAndCoplanarPoint(n,r)}this._cameraHelper=new mw(i),this._planeHelper=new Jd(this.plane,50),this._farPlaneHelper=new Jd(this.farPlane,50),this.farPlaneHelperColor=new xt("blue"),this.update()}get _planeNormalOpposite(){return this.plane.normal.clone().negate()}get _planePosition(){return this.plane.normal.clone().multiplyScalar(-this.plane.constant)}get _cameraPosition(){return this._planePosition.addScaledVector(this._planeNormalOpposite,this._cameraOffset)}set open(t){this._open=t,this.onStateChanged.trigger(["open"])}get open(){return this._open}set planeHelperColor(t){!Array.isArray(this._planeHelper.material)&&"color"in this._planeHelper.material&&this._planeHelper.material.color instanceof xt&&(this._planeHelper.material.color=t)}set farPlaneHelperColor(t){!Array.isArray(this._farPlaneHelper.material)&&"color"in this._farPlaneHelper.material&&this._farPlaneHelper.material.color instanceof xt&&(this._farPlaneHelper.material.color=t)}set range(t){this._range=t,this.update()}get range(){return this._range}set distance(t){this.plane.constant=t,this.update()}get distance(){return this.plane.constant}set world(t){this._world=t,this.camera.currentWorld=t,t&&(this.camera.projection.set("Orthographic"),this.camera.set("Plan"),this.camera.controls.dollySpeed=6,this.camera.controls.restThreshold=.005,this.update())}get world(){return this._world}set helpersVisible(t){if(!t){this._helpersVisible=t,this._planeHelper.removeFromParent(),this._farPlaneHelper.removeFromParent(),this._cameraHelper.removeFromParent();return}this.world&&(this._helpersVisible=t,this.world.scene.three.add(this._planeHelper,this._farPlaneHelper))}get helpersVisible(){return this._helpersVisible}set planesEnabled(t){const{world:e}=this;if(!e)return;const{renderer:i}=e;i&&(i.setPlane(t,this.plane),i.setPlane(t,this.farPlane),this._planesEnabled=t)}get planesEnabled(){return this._planesEnabled}dispose(){this.helpersVisible=!1;const t=this._components.get(Vp);t.destroy(this._planeHelper),t.destroy(this._farPlaneHelper),t.destroy(this._cameraHelper),this.camera.dispose(),this.onDisposed.trigger()}update(){if(this.world){const t=this._cameraPosition,e=this._planePosition;this.camera.controls.setLookAt(t.x,t.y,t.z,e.x,e.y,e.z,!1)}this.farPlane.normal.copy(this._planeNormalOpposite),this.farPlane.constant=this.range-this.plane.constant,this.onUpdated.trigger()}flip(){this.plane.normal.negate(),this.update()}}const H_=class pE extends Cs{constructor(t){super(t),D(this,"list",new Wt),D(this,"enabled",!0),D(this,"world",null),D(this,"_fragmentsUpdateEvent",()=>{this.components.get(Rt).core.update(!0)}),t.add(pE.uuid,this),this.setupEvents()}get hasOpenViews(){return[...this.list.values()].some(t=>t.open)}setupEvents(){this.list.onBeforeDelete.add(({key:t,value:e})=>{e.open&&this.close(t),e.dispose()})}create(t,e,i){const n=new K0(this.components,{id:i==null?void 0:i.id,normal:t,point:e});return n.world=(i==null?void 0:i.world)??this.world,this.list.set(n.id,n),n}createFromPlane(t,e){const i=new K0(this.components,{id:e==null?void 0:e.id});return i.plane.copy(t),i.update(),i.world=(e==null?void 0:e.world)??this.world,this.list.set(i.id,i),i}async createFromIfcStoreys(t){const e=[],i=this.components.get(Rt),n=(t==null?void 0:t.offset)===void 0?.25:t.offset;for(const[r,o]of i.list){if(t&&t.modelIds&&!t.modelIds.some(u=>u.test(r)))continue;const a=Object.values(await o.getItemsOfCategories([/BUILDINGSTOREY/])).flat();if(a.length===0)continue;const l=await o.getItemsData(a),[,h]=await o.getCoordinates(),c=new F(0,-1,0);for(const u of l){if(!("value"in u.Name&&"value"in u.Elevation))continue;const{value:p}=u.Name;if(t!=null&&t.storeyNames&&!t.storeyNames.some(g=>g.test(p)))continue;const d=u.Elevation.value+h+n,_=new Ht(c,d),m=this.createFromPlane(_,{id:p,world:t==null?void 0:t.world});e.push(m)}}return e}createElevations(t){const e=[],i=this.components.get(Rt),n=(t==null?void 0:t.combine)===void 0?!1:t.combine,r=(t==null?void 0:t.namingCallback)??(a=>({front:`${n?"Front":`${a}: Front`}`,back:`${n?"Back":`${a}: Back`}`,left:`${n?"Left":`${a}: Left`}`,right:`${n?"Right":`${a}: Right`}`}));let o=[];for(const[a,l]of i.list)t&&t.modelIds&&!t.modelIds.some(h=>h.test(a))||o.push({id:a,box:l.box});if(n){const a=this.components.get(H1);a.list.clear(),a.list.add(...o.map(l=>l.box)),o=[{id:"combined",box:a.get()}]}for(const{id:a,box:l}of o){const{min:h,max:c}=l,u=Math.abs(c.x-h.x),p=Math.abs(c.z-h.z),d=new F;l.getCenter(d);const _=new Ht(new F(0,0,-1),c.z),m=new Ht(new F(0,0,1),-h.z),g=new Ht(new F(-1,0,0),c.x),f=new Ht(new F(1,0,0),-h.x),{front:b,back:y,left:E,right:C}=r(a),I=this.createFromPlane(_,{id:b,world:t==null?void 0:t.world});I.range=p;const x=this.createFromPlane(m,{id:y,world:t==null?void 0:t.world});x.range=p;const A=this.createFromPlane(g,{id:E,world:t==null?void 0:t.world});A.range=u;const O=this.createFromPlane(f,{id:C,world:t==null?void 0:t.world});O.range=u,e.push(I,x,A,O)}return e}open(t){const e=this.list.get(t);if(!e)throw new Error(`Views: the view with id ${t} doesn't exist.`);if(e.open)return;const{world:i}=e;if(!i)throw new Error(`Views: no world found for view with id ${t}.`);const{renderer:n}=i;if(!n)throw new Error(`Views: no renderer found for world with id ${i.uuid}.`);for(const[,r]of this.list)r.world===i&&this.close(r.id);n.setPlane(!0,e.plane),n.setPlane(!0,e.farPlane),e.camera.controls.addEventListener("rest",this._fragmentsUpdateEvent),i.camera=e.camera,e.open=!0}close(t){let e;if(t?e=this.list.get(t):e=[...this.list.values()].find(r=>r.open),t&&!e)throw new Error(`Views: the view with id ${t} doesn't exist.`);if(!e||!e.open)return;const{world:i}=e;if(!i)throw new Error(`Views: no world found for view with id ${t}.`);const{renderer:n}=i;if(!n)throw new Error(`Views: no renderer found for world with id ${i.uuid}.`);n.setPlane(!1,e.plane),n.setPlane(!1,e.farPlane),e.camera.controls.removeEventListener("rest",this._fragmentsUpdateEvent),i.useDefaultCamera(),e.open=!1}};D(H_,"uuid","fb22f1f5-6598-4664-a11d-de8963ae420f");D(H_,"defaultRange",15);let sL=H_;class Ml{constructor(t){D(this,"cardinality","required"),D(this,"instructions"),D(this,"evalRequirement",(e,i,n,r)=>{const o={parameter:n,currentValue:e,requiredValue:i,pass:!1};r&&this.addCheckResult(o,r);let a=!1;if(i.type==="simple"&&(a=e===i.parameter),i.type==="enumeration"&&(a=i.parameter.includes(e)),i.type==="pattern"&&(a=new RegExp(i.parameter).test(String(e))),i.type==="length"){const{min:l,length:h,max:c}=i.parameter;h!==void 0&&(a=String(e).length===h),l!==void 0&&(a=String(e).length>=l),c!==void 0&&(a=String(e).length<=c)}if(i.type==="bounds"&&typeof e=="number"){const{min:l,minInclusive:h,max:c,maxInclusive:u}=i.parameter;let p=!0,d=!0;l!==void 0&&(p=h?e>=l:e>l),c!==void 0&&(d=u?e<=c:e<c),a=p&&d}return this.cardinality==="prohibited"&&(a=!a),this.cardinality==="optional"&&(a=!0),o.pass=a,o.pass}),this._components=t}addCheckResult(t,e){const i=e.findIndex(({parameter:n})=>n===t.parameter);i!==-1?e[i]=t:e.push(t)}getItemChecks(t,e,i){if(!("value"in i._localId&&typeof i._localId.value=="number"))return null;let n=t.get(e);n||(n=new Wt,t.set(e,n));let r=n.get(i._localId.value);if(r){if(!r.pass)return null}else{const l=[];r={guid:Array.isArray(i._guid)?void 0:i._guid.value,pass:!1,checks:l},Object.defineProperty(r,"pass",{get:()=>l.every(({pass:h})=>h)}),n.set(i._localId.value,r)}const o=[],a={facetType:this.facetType,cardinality:this.cardinality,checks:o,pass:!1};return Object.defineProperty(a,"pass",{get:()=>o.every(({pass:l})=>l)}),r.checks.push(a),a.checks}}const $n=(s,t)=>{let e="";if(!t)return e;if(t.type==="simple"&&(e=`<simpleValue>${t.parameter}</simpleValue>`),t.type==="enumeration"&&(e=`<xs:restriction base="xs:string">
    ${t.parameter.map(i=>`<xs:enumeration value="${i}" />`).join(`
`)}
    </xs:restriction>`),t.type==="pattern"&&(e=`<xs:restriction base="xs:string">
      <xs:pattern value="${t.parameter}" />
    </xs:restriction>`),t.type==="bounds"){const{min:i,minInclusive:n,max:r,maxInclusive:o}=t.parameter;let a="";i!==void 0&&(a=`<xs:min${n?"Inclusive":"Exclusive"} value="${i}">`);let l="";r!==void 0&&(l=`<xs:max${o?"Inclusive":"Exclusive"} value="${r}">`),e=`<xs:restriction base="xs:double">
      ${a}
      ${l}
    </xs:restriction>`}if(t.type==="length"){const{length:i,min:n,max:r}=t.parameter;let o="";i!==void 0&&n===void 0&&r===void 0&&(o=`<xs:length value="${i}" />`);let a="";n!==void 0&&i===void 0&&(a=`<xs:minLength value="${n}" />`);let l="";r!==void 0&&i===void 0&&(l=`<xs:maxLength value="${r}" />`),e=`<xs:restriction base="xs:string">
      ${o}
      ${a}
      ${l}
    </xs:restriction>`}return`<${s[0].toLowerCase()+s.slice(1)}>
    ${e}
  </${s[0].toLowerCase()+s.slice(1)}>`};class iL extends Ml{constructor(t,e){super(t),D(this,"facetType","Attribute"),D(this,"name"),D(this,"value"),this.name=e}serialize(t){const e=$n("Name",this.name),i=$n("Value",this.value);let n="";return t==="requirement"&&(n+=`cardinality="${this.cardinality}"`,n+=this.instructions?`instructions="${this.instructions}"`:""),`<attribute ${n}>
  ${e}
  ${i}
</attribute>`}async getEntities(){}async test(t,e){const i=this._components.get(Rt);for(const[n,r]of Object.entries(t)){const o=i.list.get(n);if(!o)continue;const a=await o.getItemsData([...r]);for(const l of a){const h=this.getItemChecks(e,n,l);if(!h)continue;const c=Object.keys(l).filter(p=>{const d=this.evalRequirement(p,this.name,"Name");if(!d)return!1;const _=l[p];return Array.isArray(_)?!0:_===null||_.value===null?this.cardinality==="optional"||this.cardinality==="prohibited":Array.isArray(_.value)&&_.value.length===0||typeof _.value=="string"&&_.value.trim()===""?!1:d}),u=c.length>0;if(h.push({parameter:"Name",currentValue:u?c[0]:null,requiredValue:this.name,pass:this.cardinality==="prohibited"?!u:u}),this.value)if(c[0]){const p=l[c[0]];Array.isArray(p)?h.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"}):Array.isArray(p.value)?h.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"}):this.evalRequirement(p.value,this.value,"Value",h)}else h.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"})}}}}class nL extends Ml{constructor(t,e){super(t),D(this,"facetType","Classification"),D(this,"system"),D(this,"value"),D(this,"uri"),this.system=e}serialize(t){const e=$n("System",this.system),i=$n("Value",this.value);let n="";return t==="requirement"&&(n+=`cardinality="${this.cardinality}"`,n+=this.uri?`uri=${this.uri}`:"",n+=this.instructions?`instructions="${this.instructions}"`:""),`<classification ${n}>
  ${e}
  ${i}
</classification>`}async getEntities(t,e){}async test(t,e){}}class Dg extends Ml{constructor(t,e){super(t),D(this,"facetType","Entity"),D(this,"name"),D(this,"predefinedType"),this.name=e}serialize(t){const e=$n("Name",this.name),i=$n("Name",this.predefinedType);let n="";return t==="requirement"&&(n+=`cardinality="${this.cardinality}"`,n+=this.instructions?`instructions="${this.instructions}"`:""),`<entity ${n}>
  ${e}
  ${i}
</entity>`}async getEntities(t,e){const i=this._components.get(Rt),n=new Map;for(const[o,a]of i.list){if(!t.find(h=>h.test(o)))continue;const l=await a.getCategories();for(const h of l){if(!await this.evalName(h))continue;let c=n.get(o);c||(c=[],n.set(o,c)),c.push(h)}}const r={};if(await Promise.all(Array.from(n.entries()).map(async([o,a])=>{const l=i.list.get(o);if(!l)return;const h=a.map(p=>new RegExp(`^${p}$`)),c=await l.getItemsOfCategories(h),u=Object.values(c).flat();r[o]=new Set(u)})),!this.predefinedType){is.add(e,r);return}for(const[o,a]of Object.entries(r)){const l=i.list.get(o);if(!l)continue;const h=await l.getItemsData([...a]);for(const c of h)"value"in c._localId&&await this.evalPredefinedType(o,c)&&is.append(e,o,c._localId.value)}}async test(t,e){const i=this._components.get(Rt);for(const[n,r]of Object.entries(t)){const o=i.list.get(n);if(!o)continue;const a=await o.getItemsData([...r]);for(const l of a){if(!("value"in l._category))continue;const h=this.getItemChecks(e,n,l);h&&(await this.evalName(l._category.value,h),await this.evalPredefinedType(n,l,h))}}}async evalName(t,e){return this.evalRequirement(t,this.name,"Name",e)}async evalPredefinedType(t,e,i){if(!this.predefinedType||!("value"in e.PredefinedType))return null;const n=typeof this.predefinedType.parameter=="string"&&this.predefinedType.parameter==="USERDEFINED";let r=e.PredefinedType.value;if(r==="USERDEFINED"&&!n){const o=Object.keys(e).find(a=>/^((?!Predefined).)*Type$/.test(a));if(o){const a=e[o];"value"in a&&(r=a.value)}else r="USERDEFINED"}if(!r){const o=this._components.get(Rt).list.get(t);if(o&&"value"in e._localId){const[a]=await o.getItemsData([e._localId.value],{relations:{IsTypedBy:{attributes:!0,relations:!1}}});if(Array.isArray(a.IsTypedBy)){const l=a.IsTypedBy[0];if(l&&"value"in l.PredefinedType&&(r=l.PredefinedType.value,r==="USERDEFINED"&&!n)){const h=Object.keys(l).find(c=>/^((?!Predefined).)*Type$/.test(c));if(h){const c=l[h];"value"in c&&(r=c.value)}else r="USERDEFINED"}}}}return this.evalRequirement(r,this.predefinedType,"PredefinedType",i)}}class rL extends Ml{constructor(t,e,i){super(t),D(this,"facetType","Property"),D(this,"propertySet"),D(this,"baseName"),D(this,"value"),D(this,"dataType"),D(this,"uri"),D(this,"_unsupportedTypes",["IFCCOMPLEXPROPERTY","IFCPHYSICALCOMPLEXQUANTITY"]),this.propertySet=e,this.baseName=i}serialize(t){const e=$n("PropertySet",this.propertySet),i=$n("BaseName",this.baseName),n=$n("Value",this.value),r=this.dataType?`dataType=${this.dataType}`:"";let o="";return t==="requirement"&&(o+=`cardinality="${this.cardinality}"`,o+=this.uri?`uri=${this.uri}`:"",o+=this.instructions?`instructions="${this.instructions}"`:""),`<property ${r} ${o}>
  ${e}
  ${i}
  ${n}
</property>`}async getEntities(t,e){const i=this._components.get(Rt);for(const[n,r]of i.list){if(!t.find(h=>h.test(n)))continue;const o=await r.getItemsOfCategories([/PROPERTYSET/,/ELEMENTQUANTITY/]),a=Object.values(o).flat();if(a.length===0)continue;const l=await r.getItemsData(a,{relations:{HasProperties:{attributes:!0,relations:!1},DefinesOcurrence:{attributes:!0,relations:!1}}});for(const h of l){if(!("value"in h._localId&&"value"in h._category&&"value"in h.Name&&Array.isArray(h.DefinesOcurrence))||!this.evalRequirement(h.Name.value,this.propertySet,"PropertySet"))continue;let c;if(h._category.value==="IFCPROPERTYSET"&&(c="HasProperties"),h._category.value==="IFCELEMENTQUANTITY"&&(c="Quantities"),!c)continue;const u=h[c];if(Array.isArray(u))for(const p of u){const d=Object.keys(p),_=d.find(f=>/Name/.test(f));if(!(_&&"value"in p[_]))continue;const m=p[_];if(!("value"in m)||!this.evalRequirement(m.value,this.baseName,"BaseName"))continue;if(this.value){const f=d.find(y=>/Value/.test(y));if(!f)continue;const b=p[f];if(!("value"in b)||!this.evalRequirement(b.value,this.value,"Value"))continue}const g=h.DefinesOcurrence.map(f=>"value"in f._localId&&typeof f._localId.value=="number"?f._localId.value:null).filter(f=>f!==null);is.append(e,n,...g)}}}}async test(t,e){const i=this._components.get(Rt);for(const[n,r]of Object.entries(t)){const o=i.list.get(n);if(!o)continue;const a=await o.getItemsData([...r],{relations:{IsDefinedBy:{attributes:!0,relations:!0},IsTypedBy:{attributes:!0,relations:!1},HasPropertySets:{attributes:!0,relations:!0},DefinesOcurrence:{attributes:!1,relations:!1}}});for(const l of a){const h=this.getItemChecks(e,n,l);if(!h)continue;const c=(await this.getPsets(l)).filter(u=>!("value"in u.Name)||!this.evalRequirement(u.Name.value,this.propertySet,"PropertySet")?!1:(h.push({currentValue:u.Name.value,parameter:"PropertySet",pass:!0,requiredValue:this.propertySet}),!0));if(c.length===0){h.push({currentValue:null,parameter:"PropertySet",pass:!1,requiredValue:this.propertySet});continue}for(const u of c){const p=this.getPropertyListName(u);if(!p)continue;const d=u[p];if(!Array.isArray(d)){h.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName});continue}const _=d.filter(m=>!("value"in m._category&&"value"in m.Name)||this._unsupportedTypes.includes(m._category.value)||!this.evalRequirement(m.Name.value,this.baseName,"BaseName")?!1:(h.push({currentValue:m.Name.value,parameter:"BaseName",pass:!0,requiredValue:this.baseName}),!0));if(_.length===0){h.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName});continue}for(const m of _)this.evalValue(m,h),this.evalDataType(m,h),this.evalURI()}}}}getPropertyListName(t){let e;return"value"in t._category&&(t._category.value==="IFCPROPERTYSET"&&(e="HasProperties"),t._category.value==="IFCELEMENTQUANTITY"&&(e="Quantities")),e}getValueKey(t){return Object.keys(t).find(e=>/Value/.test(e)||/Values/.test(e))}getTypePsets(t){if(!Array.isArray(t.IsTypedBy))return[];const[e]=t.IsTypedBy;return e&&Array.isArray(e.HasPropertySets)?e.HasPropertySets:[]}async getPsets(t){const e=this.getTypePsets(t);if(!Array.isArray(t.IsDefinedBy))return e;const i=[];for(const n of t.IsDefinedBy){if(!("value"in n.Name))continue;const r=n.Name.value,o=this.getPropertyListName(n);if(!(r&&o))continue;const a=e.find(l=>"value"in l.Name?l.Name.value===r:!1);if(a&&Array.isArray(a.HasProperties)&&Array.isArray(n.HasProperties))for(const l of a.HasProperties){if(!("value"in l.Name))continue;const h=l.Name.value;n.HasProperties.find(c=>"value"in c.Name?c.Name.value===h:!1)||n.HasProperties.push(l)}i.push(n)}return i}evalValue(t,e){const i=this.getValueKey(t),n=t[i];if(!("value"in n))return!1;if(this.value){if(!i)return e==null||e.push({parameter:"Value",currentValue:null,pass:!1,requiredValue:this.value}),!1;const r=structuredClone(this.value);return n.type==="IFCLABEL"&&r.type==="simple"&&(r.parameter=String(r.parameter)),this.evalRequirement(n.value,r,"Value",e)}return i&&typeof n.value=="string"&&n.value.trim()===""?(e==null||e.push({parameter:"Value",currentValue:"",pass:!1,requiredValue:this.value}),!1):!0}evalDataType(t,e){if(!this.dataType)return!0;const i=this.getValueKey(t);if(!(i&&"value"in t[i]))return e==null||e.push({parameter:"DataType",currentValue:null,pass:!1,requiredValue:this.dataType}),!1;const n=t[i];return this.evalRequirement(n.type??null,{type:"simple",parameter:this.dataType},"DataType",e)}evalURI(){return!0}}class oL extends Ml{constructor(){super(...arguments),D(this,"_ifcMaterialEntities",[/^IFCMATERIALLAYERSETUSAGE$/,/^IFCMATERIALCONSTITUENTSET$/,/^IFCMATERIAL$/,/^IFCMATERIALLIST$/]),D(this,"facetType","Material"),D(this,"value"),D(this,"uri")}serialize(t){if(!(this.value&&this.uri))return"<material />";const e=$n("Value",this.value);let i="";return t==="requirement"&&(i+=`cardinality="${this.cardinality}"`,i+=this.uri?`uri=${this.uri}`:"",i+=this.instructions?`instructions="${this.instructions}"`:""),`<material ${i}>
  ${e}
</material>`}async getEntities(t,e){const i=this._components.get(Rt);for(const[n,r]of i.list){if(!t.find(h=>h.test(n)))continue;const o=await r.getItemsOfCategories(this._ifcMaterialEntities),a=Object.values(o).flat();if(a.length===0)continue;const l=await r.getItemsData(a,{relations:{AssociatedTo:{attributes:!0,relations:!1},MaterialConstituents:{attributes:!0,relations:!0},ForLayerSet:{attributes:!0,relations:!0},MaterialLayers:{attributes:!0,relations:!0},Materials:{attributes:!0,relations:!1}}});for(const h of l){if(!("value"in h._localId&&"value"in h._category&&Array.isArray(h.AssociatedTo))||!this.hasValidMaterial(h))continue;const c=h.AssociatedTo.map(u=>"value"in u._localId&&u._localId.value?u._localId.value:null).filter(u=>u!==null);is.append(e,n,...c)}}}async test(t,e){const i=this._components.get(Rt);for(const[n,r]of Object.entries(t)){const o=i.list.get(n);if(!o)continue;const a=await o.getItemsData([[...r][0]],{relations:{AssociatedTo:{attributes:!1,relations:!1},HasAssociations:{attributes:!0,relations:!0},MaterialConstituents:{attributes:!0,relations:!0},ForLayerSet:{attributes:!0,relations:!0},MaterialLayers:{attributes:!0,relations:!0},Materials:{attributes:!0,relations:!1}}});for(const l of a){const h=this.getItemChecks(e,n,l);if(h){if(!Array.isArray(l.HasAssociations)){h.push({parameter:null,currentValue:null,requiredValue:this.value,pass:!1});continue}for(const c of l.HasAssociations)if(this._ifcMaterialEntities.some(u=>"value"in c._category?u.test(c._category.value):!1)&&this.hasValidMaterial(c,h))break}}}}hasValidMaterial(t,e){let i=!1;if("value"in t._category&&t._category.value==="IFCMATERIAL")this.evalValue(t,e)&&(i=!0);else for(const[n,r]of Object.entries(t))if(["ForLayerSet","MaterialLayers","Material","MaterialConstituents","Materials"].includes(n)&&Array.isArray(r)){for(const o of r)if("value"in o._category&&o._category.value==="IFCMATERIAL"){if(this.evalValue(o,e)){i=!0;break}}else if(this.hasValidMaterial(o)){i=!0;break}}return i}evalValue(t,e){if(!this.value)return e==null||e.push({parameter:null,currentValue:t.Name&&"value"in t.Name?t.Name.value:null,pass:!0}),!0;if(!("value"in t._category&&t._category.value==="IFCMATERIAL"))return null;let i=!1;return t.Name&&"value"in t.Name&&(i=this.evalRequirement(t.Name.value,this.value,"Value",e)),i||(t.Category&&"value"in t.Category&&(i=this.evalRequirement(t.Category.value,this.value,"Value",e)),i)}}class aL extends Ml{constructor(t,e){super(t),D(this,"facetType","PartOf"),D(this,"_entityFacet"),D(this,"_entity"),D(this,"relation"),D(this,"cardinality","required"),this._entity=e,this._entityFacet=new Dg(t,e.name),this._entityFacet.predefinedType=e.predefinedType}set entity(t){this._entity=t;const{name:e,predefinedType:i}=t;this._entityFacet=new Dg(this._components,e),this._entityFacet.predefinedType=i}get entity(){return this._entity}serialize(){return""}async getEntities(t,e){}async test(t){}}class lL{constructor(t,e,i){D(this,"name"),D(this,"ifcVersion",new Set),D(this,"identifier",fi.create()),D(this,"description"),D(this,"instructions"),D(this,"requirementsDescription"),D(this,"applicability",new ge),D(this,"requirements",new ge),D(this,"components"),this.components=t,this.name=e;for(const n of i)this.ifcVersion.add(n)}set(t){const e=t,i=this;for(const n in t){if(n==="identifier")continue;const r=e[n];n in this&&(i[n]=r)}return this.components.get(hL).list.set(this.identifier,this),this}async test(t){const e=new Wt;if(this.requirements.size===0)return e;const i={},n=[];for(const o of this.applicability)n.push(o.getEntities(t,i));await Promise.all(n);const r=[];for(const o of this.requirements)r.push(o.test(i,e));return await Promise.all(r),e}serialize(){const t=`name="${this.name}"`,e=this.identifier?`identifier="${this.identifier}"`:"",i=this.description?`description="${this.description}"`:"",n=this.instructions?`instructions="${this.instructions}"`:"";return`<specification ifcVersion="${[...this.ifcVersion].join(" ")}" ${t} ${e} ${i} ${n}>
      <applicability minOccurs="1" maxOccurs="unbounded">
        ${[...this.applicability].map(r=>r.serialize("applicability")).join(`
`)}
      </applicability>
      <requirements>
        ${[...this.requirements].map(r=>r.serialize("requirement")).join(`
`)}
      </requirements>
    </specification>`}}const Ui=s=>{if(!s)return;const t={};if("simpleValue"in s&&(t.type="simple",t.parameter=s.simpleValue),"restriction"in s){const e=s.restriction,i=Object.keys(e);if("pattern"in e&&(t.type="pattern",t.parameter=e.pattern.value),"enumeration"in e){t.type="enumeration";const n=e.enumeration.map(({value:r})=>r);t.parameter=n}if(i.some(n=>["minInclusive","minExclusive","maxInclusive","maxExclusive"].includes(n))){t.type="bounds";const n={},r=i.find(a=>a.includes("min")),o=i.find(a=>a.includes("max"));r&&(n.minInclusive=r==="minInclusive",n.min=e[r].value),o&&(n.maxInclusive=o==="maxInclusive",n.max=e[o].value),t.parameter=n}if(i.some(n=>["minLength","length","maxLength"].includes(n))){t.type="length";const n={};e.length!==void 0&&(n.length=e.length.value),e.minLength!==void 0&&(n.min=e.minLength.value),e.maxLength!==void 0&&(n.max=e.maxLength.value),t.parameter=n}}if(t.parameter!==void 0)return t},J0=(s,t)=>{const e=[];for(const i of t){const n=i.name,r=Ui(n);if(!r)continue;const o=new Dg(s,r);i.cardinality&&(o.cardinality=i.cardinality),o.predefinedType=Ui(i.predefinedType),o.instructions=i.instructions,e.push(o)}return e},ty=(s,t)=>{const e=[];for(const i of t){const n=i.name,r=Ui(n);if(!r)continue;const o=new iL(s,r);i.cardinality&&(o.cardinality=i.cardinality),o.value=Ui(i.value),o.instructions=i.instructions,e.push(o)}return e},ey=(s,t)=>{const e=[];for(const i of t){const n=new oL(s);i.cardinality&&(n.cardinality=i.cardinality);const r=Ui(i.value);(r==null?void 0:r.type)==="enumeration"&&Array.isArray(r.parameter)&&(r.parameter=r.parameter.map(String)),n.value=r,n.uri=i.uri,n.instructions=i.instructions,e.push(n)}return e},sy=(s,t)=>{const e=[];for(const i of t){const n=i.propertySet,r=i.baseName,o=Ui(n),a=Ui(r);if(!(a&&o))continue;const l=new rL(s,o,a);i.cardinality&&(l.cardinality=i.cardinality);const h=Ui(i.value);l.value=h,l.dataType=i.dataType,l.uri=i.uri,l.instructions=i.instructions,e.push(l)}return e},iy=(s,t)=>{const e=[];for(const i of t){const n=i.system,r=Ui(n);if(!r)continue;const o=new nL(s,r);i.cardinality&&(o.cardinality=i.cardinality);const a=Ui(i.value);(a==null?void 0:a.type)==="simple"&&(a.parameter=String(a.parameter)),(a==null?void 0:a.type)==="enumeration"&&Array.isArray(a.parameter)&&(a.parameter=a.parameter.map(String)),o.value=a,o.uri=i.uri,o.instructions=i.instructions,e.push(o)}return e},ny=(s,t)=>{const e=[];for(const i of t){const n=Ui(i.entity.name);if(!n)continue;const r=Ui(i.entity.predefinedType),o=new aL(s,{name:n,predefinedType:r});o.relation=i.relation,i.cardinality&&(o.cardinality=i.cardinality),o.instructions=i.instructions,e.push(o)}return e},j_=class kg extends Cs{constructor(t){super(t),D(this,"enabled",!0),D(this,"list",new vl),t.add(kg.uuid,this)}getModelIdMap(t){const e={},i={};for(const[n,r]of t){const o=[...r].filter(([,l])=>l.pass).map(([l])=>l);is.append(e,n,...o);const a=[...r].filter(([,l])=>!l.pass).map(([l])=>l);is.append(i,n,...a)}return{pass:e,fail:i}}create(t,e,i){const n=new lL(this.components,t,e);return i&&(n.identifier=i),this.list.set(n.identifier,n),n}load(t){const e=[],i=kg.xmlParser.parse(t).ids,{specifications:n}=i;if(n&&n.specification){const r=Array.isArray(n.specification)?n.specification:[n.specification];for(const o of r){const{name:a,ifcVersion:l,description:h,instructions:c,identifier:u}=o;if(!(a&&l))continue;const p=[],d=[],{applicability:_,requirements:m}=o;if(_){const{maxOccurs:b,...y}=_,E=Array.isArray(y)?y:[y];for(const C of E)for(const I in C){const x=Array.isArray(C[I])?C[I]:[C[I]];if(I==="entity"){const A=J0(this.components,x);p.push(...A)}if(I==="attribute"){const A=ty(this.components,x);p.push(...A)}if(I==="material"){const A=ey(this.components,x);p.push(...A)}if(I==="classification"){const A=iy(this.components,x);p.push(...A)}if(I==="property"){const A=sy(this.components,x);p.push(...A)}if(I==="partOf"){const A=ny(this.components,x);p.push(...A)}}}let g;if(m){const{maxOccurs:b,...y}=m;g=m.description;const E=Array.isArray(y)?y:[y];for(const C of E)for(const I in C){const x=Array.isArray(C[I])?C[I]:[C[I]];if(I==="entity"){const A=J0(this.components,x);d.push(...A)}if(I==="attribute"){const A=ty(this.components,x);d.push(...A)}if(I==="material"){const A=ey(this.components,x);d.push(...A)}if(I==="classification"){const A=iy(this.components,x);d.push(...A)}if(I==="property"){const A=sy(this.components,x);d.push(...A)}if(I==="partOf"){const A=ny(this.components,x);d.push(...A)}}}const f=this.create(a,l.split(/\s+/),u);f.description=h,f.instructions=c,f.requirementsDescription=g,f.applicability.add(...p),f.requirements.add(...d),e.push(f)}}return e}export(t,e=this.list.values()){const i=e??this.list;return`<ids xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://standards.buildingsmart.org/IDS http://standards.buildingsmart.org/IDS/1.0/ids.xsd" xmlns:ids="http://standards.buildingsmart.org/IDS">
  <!-- Made with That Open Engine ${aE.release} (https://github.com/thatopen/engine_components) -->
  <info>
    <title>${t.title}</title>
    ${t.copyright?`<copyright>${t.copyright}</copyright>`:""}
    ${t.version?`<version>${t.version}</version>`:""}
    ${t.description?`<description>${t.description}</description>`:""}
    ${t.author?`<author>${t.author}</author>`:""}
    ${t.date?`<date>${t.date.toISOString().split("T")[0]}</date>`:""}
    ${t.purpose?`<purpose>${t.purpose}</purpose>`:""}
    ${t.milestone?`<milestone>${t.milestone}</milestone>`:""}
  </info>
  <specifications>
    ${[...i].map(n=>n.serialize()).join(`
`)}
  </specifications>
</ids>`}};D(j_,"uuid","9f0b9f78-9b2e-481a-b766-2fbfd01f342c");D(j_,"xmlParser",new Hp.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let hL=j_;const cL=class fE extends Cs{constructor(t){super(t),D(this,"enabled",!0),t.add(fE.uuid,this)}static distanceFromPointToLine(t,e,i,n=!1){const r=new Gt,o=new F;return r.set(e,i),r.closestPointToPoint(t,n,o),o.distanceTo(t)}round(t){t.x=Math.trunc(t.x*1e3)/1e3,t.y=Math.trunc(t.y*1e3)/1e3,t.z=Math.trunc(t.z*1e3)/1e3}async getVolumeFromFragments(t){return console.warn("getVolumeFromFragments is deprecated. Use getItemsVolume instead."),this.getItemsVolume(t)}async getItemsVolume(t){let e=0;const i=this.components.get(Rt);for(const[n,r]of Object.entries(t)){const o=i.list.get(n);o&&(e+=await o.getItemsVolume([...r]))}return e}static convertUnits(t,e,i,n=2){const r={m:1,cm:.01,mm:.001,km:1e3,m2:1,cm2:1e-4,mm2:1e-6,km2:1e6,m3:1,cm3:1e-6,mm3:1e-9,km3:1e9};if(!r[e]||!r[i])throw new Error("Invalid units provided for conversion.");if(!Number.isInteger(n)||n<0||n>5)throw new Error("Precision must be an integer between 0 and 5.");let o=r[e]/r[i];e.endsWith("2")&&i.endsWith("2")?o**=2:e.endsWith("3")&&i.endsWith("3")&&(o**=3);const a=t*o,l=10**n;return Math.round(a*l)/l}};D(cL,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");var uL=Object.defineProperty,dL=(s,t,e)=>t in s?uL(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,q=(s,t,e)=>(dL(s,typeof t!="symbol"?t+"":t,e),e),pL=Object.defineProperty,fL=(s,t,e)=>t in s?pL(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,k=(s,t,e)=>(fL(s,typeof t!="symbol"?t+"":t,e),e);let ft=class{constructor(){k(this,"enabled",!0),k(this,"trigger",s=>{if(!this.enabled)return;const t=this.handlers.slice(0);for(const e of t)e(s)}),k(this,"handlers",[])}add(s){this.handlers.push(s)}remove(s){this.handlers=this.handlers.filter(t=>t!==s)}reset(){this.handlers.length=0}},Y_=class{constructor(s){k(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),k(this,"isResizeable",()=>"resize"in this&&"getSize"in this),k(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),k(this,"isHideable",()=>"visible"in this),k(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),this.components=s}},he=class extends Y_{},mE=class extends Y_{constructor(s){super(s),k(this,"worlds",new Wt),k(this,"onWorldChanged",new ft),k(this,"_currentWorld",null),this.onWorldChanged.add(({world:t,action:e})=>{e==="removed"&&this.worlds.delete(t.uuid)})}set currentWorld(s){this._currentWorld=s}get currentWorld(){return this._currentWorld}};class mL extends mE{constructor(){super(...arguments),k(this,"hasCameraControls",()=>"controls"in this)}}class gL extends mE{constructor(){super(...arguments),k(this,"onAfterUpdate",new ft),k(this,"onBeforeUpdate",new ft),k(this,"onDisposed",new ft),k(this,"onResize",new ft),k(this,"onClippingPlanesUpdated",new ft),k(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(t,e,i){e.isLocal=i;const n=this.clippingPlanes.indexOf(e);t&&n===-1?this.clippingPlanes.push(e):!t&&n>-1&&this.clippingPlanes.splice(n,1),this.three.clippingPlanes=this.clippingPlanes.filter(r=>!r.isLocal)}}const gE=class zg extends he{constructor(t){super(t),k(this,"_disposedComponents",new Set),k(this,"enabled",!0),t.add(zg.uuid,this)}get(){return this._disposedComponents}destroy(t,e=!0,i=!0){t.removeFromParent();const n=t;n.dispose&&n.dispose(),this.disposeGeometryAndMaterials(t,e),i&&n.children&&n.children.length&&this.disposeChildren(n),t.children.length=0}disposeGeometry(t){t.boundsTree&&t.disposeBoundsTree&&t.disposeBoundsTree(),t.dispose()}disposeGeometryAndMaterials(t,e){const i=t;i.geometry&&this.disposeGeometry(i.geometry),e&&i.material&&zg.disposeMaterial(i),i.material=[],i.geometry=null}disposeChildren(t){for(const e of t.children)this.destroy(e)}static disposeMaterial(t){if(t.material)if(Array.isArray(t.material))for(const e of t.material)e.dispose();else t.material.dispose()}};k(gE,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let dr=gE,cm=class extends Set{constructor(s){super(s),k(this,"onItemAdded",new ft),k(this,"onItemDeleted",new ft),k(this,"onCleared",new ft),k(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}add(...s){for(const t of s)this.has(t)||!this.guard(t)||(super.add(t),this.onItemAdded||(this.onItemAdded=new ft),this.onItemAdded.trigger(t));return this}delete(s){const t=super.delete(s);return t&&this.onItemDeleted.trigger(),t}dispose(){this.clear(),this.onItemAdded.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}};const W_=class Je{static create(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return`${Je._lut[t&255]+Je._lut[t>>8&255]+Je._lut[t>>16&255]+Je._lut[t>>24&255]}-${Je._lut[e&255]}${Je._lut[e>>8&255]}-${Je._lut[e>>16&15|64]}${Je._lut[e>>24&255]}-${Je._lut[i&63|128]}${Je._lut[i>>8&255]}-${Je._lut[i>>16&255]}${Je._lut[i>>24&255]}${Je._lut[n&255]}${Je._lut[n>>8&255]}${Je._lut[n>>16&255]}${Je._lut[n>>24&255]}`.toLowerCase()}static validate(t){if(!Je._pattern.test(t))throw new Error(`${t} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};k(W_,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/);k(W_,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let Ss=W_;var Zu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _L(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var _E={},Zp={};(function(s){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",e=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",i="["+t+"]["+e+"]*",n=new RegExp("^"+i+"$"),r=function(a,l){const h=[];let c=l.exec(a);for(;c;){const u=[];u.startIndex=l.lastIndex-c[0].length;const p=c.length;for(let d=0;d<p;d++)u.push(c[d]);h.push(u),c=l.exec(a)}return h},o=function(a){const l=n.exec(a);return!(l===null||typeof l>"u")};s.isExist=function(a){return typeof a<"u"},s.isEmptyObject=function(a){return Object.keys(a).length===0},s.merge=function(a,l,h){if(l){const c=Object.keys(l),u=c.length;for(let p=0;p<u;p++)h==="strict"?a[c[p]]=[l[c[p]]]:a[c[p]]=l[c[p]]}},s.getValue=function(a){return s.isExist(a)?a:""},s.isName=o,s.getAllMatches=r,s.nameRegexp=i})(Zp);const G_=Zp,bL={allowBooleanAttributes:!1,unpairedTags:[]};_E.validate=function(s,t){t=Object.assign({},bL,t);const e=[];let i=!1,n=!1;s[0]==="\uFEFF"&&(s=s.substr(1));for(let r=0;r<s.length;r++)if(s[r]==="<"&&s[r+1]==="?"){if(r+=2,r=oy(s,r),r.err)return r}else if(s[r]==="<"){let o=r;if(r++,s[r]==="!"){r=ay(s,r);continue}else{let a=!1;s[r]==="/"&&(a=!0,r++);let l="";for(;r<s.length&&s[r]!==">"&&s[r]!==" "&&s[r]!=="	"&&s[r]!==`
`&&s[r]!=="\r";r++)l+=s[r];if(l=l.trim(),l[l.length-1]==="/"&&(l=l.substring(0,l.length-1),r--),!TL(l)){let u;return l.trim().length===0?u="Invalid space after '<'.":u="Tag '"+l+"' is an invalid name.",Ue("InvalidTag",u,Rs(s,r))}const h=wL(s,r);if(h===!1)return Ue("InvalidAttr","Attributes for '"+l+"' have open quote.",Rs(s,r));let c=h.value;if(r=h.index,c[c.length-1]==="/"){const u=r-c.length;c=c.substring(0,c.length-1);const p=ly(c,t);if(p===!0)i=!0;else return Ue(p.err.code,p.err.msg,Rs(s,u+p.err.line))}else if(a)if(h.tagClosed){if(c.trim().length>0)return Ue("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",Rs(s,o));if(e.length===0)return Ue("InvalidTag","Closing tag '"+l+"' has not been opened.",Rs(s,o));{const u=e.pop();if(l!==u.tagName){let p=Rs(s,u.tagStartPos);return Ue("InvalidTag","Expected closing tag '"+u.tagName+"' (opened in line "+p.line+", col "+p.col+") instead of closing tag '"+l+"'.",Rs(s,o))}e.length==0&&(n=!0)}}else return Ue("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",Rs(s,r));else{const u=ly(c,t);if(u!==!0)return Ue(u.err.code,u.err.msg,Rs(s,r-c.length+u.err.line));if(n===!0)return Ue("InvalidXml","Multiple possible root nodes found.",Rs(s,r));t.unpairedTags.indexOf(l)!==-1||e.push({tagName:l,tagStartPos:o}),i=!0}for(r++;r<s.length;r++)if(s[r]==="<")if(s[r+1]==="!"){r++,r=ay(s,r);continue}else if(s[r+1]==="?"){if(r=oy(s,++r),r.err)return r}else break;else if(s[r]==="&"){const u=IL(s,r);if(u==-1)return Ue("InvalidChar","char '&' is not expected.",Rs(s,r));r=u}else if(n===!0&&!ry(s[r]))return Ue("InvalidXml","Extra text at the end",Rs(s,r));s[r]==="<"&&r--}}else{if(ry(s[r]))continue;return Ue("InvalidChar","char '"+s[r]+"' is not expected.",Rs(s,r))}if(i){if(e.length==1)return Ue("InvalidTag","Unclosed tag '"+e[0].tagName+"'.",Rs(s,e[0].tagStartPos));if(e.length>0)return Ue("InvalidXml","Invalid '"+JSON.stringify(e.map(r=>r.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Ue("InvalidXml","Start tag expected.",1);return!0};function ry(s){return s===" "||s==="	"||s===`
`||s==="\r"}function oy(s,t){const e=t;for(;t<s.length;t++)if(s[t]=="?"||s[t]==" "){const i=s.substr(e,t-e);if(t>5&&i==="xml")return Ue("InvalidXml","XML declaration allowed only at the start of the document.",Rs(s,t));if(s[t]=="?"&&s[t+1]==">"){t++;break}else continue}return t}function ay(s,t){if(s.length>t+5&&s[t+1]==="-"&&s[t+2]==="-"){for(t+=3;t<s.length;t++)if(s[t]==="-"&&s[t+1]==="-"&&s[t+2]===">"){t+=2;break}}else if(s.length>t+8&&s[t+1]==="D"&&s[t+2]==="O"&&s[t+3]==="C"&&s[t+4]==="T"&&s[t+5]==="Y"&&s[t+6]==="P"&&s[t+7]==="E"){let e=1;for(t+=8;t<s.length;t++)if(s[t]==="<")e++;else if(s[t]===">"&&(e--,e===0))break}else if(s.length>t+9&&s[t+1]==="["&&s[t+2]==="C"&&s[t+3]==="D"&&s[t+4]==="A"&&s[t+5]==="T"&&s[t+6]==="A"&&s[t+7]==="["){for(t+=8;t<s.length;t++)if(s[t]==="]"&&s[t+1]==="]"&&s[t+2]===">"){t+=2;break}}return t}const yL='"',vL="'";function wL(s,t){let e="",i="",n=!1;for(;t<s.length;t++){if(s[t]===yL||s[t]===vL)i===""?i=s[t]:i!==s[t]||(i="");else if(s[t]===">"&&i===""){n=!0;break}e+=s[t]}return i!==""?!1:{value:e,index:t,tagClosed:n}}const EL=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function ly(s,t){const e=G_.getAllMatches(s,EL),i={};for(let n=0;n<e.length;n++){if(e[n][1].length===0)return Ue("InvalidAttr","Attribute '"+e[n][2]+"' has no space in starting.",ch(e[n]));if(e[n][3]!==void 0&&e[n][4]===void 0)return Ue("InvalidAttr","Attribute '"+e[n][2]+"' is without value.",ch(e[n]));if(e[n][3]===void 0&&!t.allowBooleanAttributes)return Ue("InvalidAttr","boolean attribute '"+e[n][2]+"' is not allowed.",ch(e[n]));const r=e[n][2];if(!xL(r))return Ue("InvalidAttr","Attribute '"+r+"' is an invalid name.",ch(e[n]));if(!i.hasOwnProperty(r))i[r]=1;else return Ue("InvalidAttr","Attribute '"+r+"' is repeated.",ch(e[n]))}return!0}function CL(s,t){let e=/\d/;for(s[t]==="x"&&(t++,e=/[\da-fA-F]/);t<s.length;t++){if(s[t]===";")return t;if(!s[t].match(e))break}return-1}function IL(s,t){if(t++,s[t]===";")return-1;if(s[t]==="#")return t++,CL(s,t);let e=0;for(;t<s.length;t++,e++)if(!(s[t].match(/\w/)&&e<20)){if(s[t]===";")break;return-1}return t}function Ue(s,t,e){return{err:{code:s,msg:t,line:e.line||e,col:e.col}}}function xL(s){return G_.isName(s)}function TL(s){return G_.isName(s)}function Rs(s,t){const e=s.substring(0,t).split(/\r?\n/);return{line:e.length,col:e[e.length-1].length+1}}function ch(s){return s.startIndex+s[1].length}var q_={};const bE={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(s,t){return t},attributeValueProcessor:function(s,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(s,t,e){return s}},AL=function(s){return Object.assign({},bE,s)};q_.buildOptions=AL;q_.defaultOptions=bE;class SL{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}var OL=SL;const PL=Zp;function FL(s,t){const e={};if(s[t+3]==="O"&&s[t+4]==="C"&&s[t+5]==="T"&&s[t+6]==="Y"&&s[t+7]==="P"&&s[t+8]==="E"){t=t+9;let i=1,n=!1,r=!1,o="";for(;t<s.length;t++)if(s[t]==="<"&&!r){if(n&&NL(s,t))t+=7,[entityName,val,t]=RL(s,t+1),val.indexOf("&")===-1&&(e[zL(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(n&&ML(s,t))t+=8;else if(n&&DL(s,t))t+=8;else if(n&&kL(s,t))t+=9;else if(LL)r=!0;else throw new Error("Invalid DOCTYPE");i++,o=""}else if(s[t]===">"){if(r?s[t-1]==="-"&&s[t-2]==="-"&&(r=!1,i--):i--,i===0)break}else s[t]==="["?n=!0:o+=s[t];if(i!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:e,i:t}}function RL(s,t){let e="";for(;t<s.length&&s[t]!=="'"&&s[t]!=='"';t++)e+=s[t];if(e=e.trim(),e.indexOf(" ")!==-1)throw new Error("External entites are not supported");const i=s[t++];let n="";for(;t<s.length&&s[t]!==i;t++)n+=s[t];return[e,n,t]}function LL(s,t){return s[t+1]==="!"&&s[t+2]==="-"&&s[t+3]==="-"}function NL(s,t){return s[t+1]==="!"&&s[t+2]==="E"&&s[t+3]==="N"&&s[t+4]==="T"&&s[t+5]==="I"&&s[t+6]==="T"&&s[t+7]==="Y"}function ML(s,t){return s[t+1]==="!"&&s[t+2]==="E"&&s[t+3]==="L"&&s[t+4]==="E"&&s[t+5]==="M"&&s[t+6]==="E"&&s[t+7]==="N"&&s[t+8]==="T"}function DL(s,t){return s[t+1]==="!"&&s[t+2]==="A"&&s[t+3]==="T"&&s[t+4]==="T"&&s[t+5]==="L"&&s[t+6]==="I"&&s[t+7]==="S"&&s[t+8]==="T"}function kL(s,t){return s[t+1]==="!"&&s[t+2]==="N"&&s[t+3]==="O"&&s[t+4]==="T"&&s[t+5]==="A"&&s[t+6]==="T"&&s[t+7]==="I"&&s[t+8]==="O"&&s[t+9]==="N"}function zL(s){if(PL.isName(s))return s;throw new Error(`Invalid entity name ${s}`)}var UL=FL;const BL=/^[-+]?0x[a-fA-F0-9]+$/,VL=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,$L={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function HL(s,t={}){if(t=Object.assign({},$L,t),!s||typeof s!="string")return s;let e=s.trim();if(t.skipLike!==void 0&&t.skipLike.test(e))return s;if(s==="0")return 0;if(t.hex&&BL.test(e))return YL(e,16);if(e.search(/[eE]/)!==-1){const i=e.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(i){if(t.leadingZeros)e=(i[1]||"")+i[3];else if(!(i[2]==="0"&&i[3][0]==="."))return s;return t.eNotation?Number(e):s}else return s}else{const i=VL.exec(e);if(i){const n=i[1],r=i[2];let o=jL(i[3]);if(!t.leadingZeros&&r.length>0&&n&&e[2]!=="."||!t.leadingZeros&&r.length>0&&!n&&e[1]!==".")return s;if(t.leadingZeros&&r===s)return 0;{const a=Number(e),l=""+a;return l.search(/[eE]/)!==-1?t.eNotation?a:s:e.indexOf(".")!==-1?l==="0"&&o===""||l===o||n&&l==="-"+o?a:s:r?o===l||n+o===l?a:s:e===l||e===n+l?a:s}}else return s}}function jL(s){return s&&s.indexOf(".")!==-1&&(s=s.replace(/0+$/,""),s==="."?s="0":s[0]==="."?s="0"+s:s[s.length-1]==="."&&(s=s.substr(0,s.length-1))),s}function YL(s,t){if(parseInt)return parseInt(s,t);if(Number.parseInt)return Number.parseInt(s,t);if(window&&window.parseInt)return window.parseInt(s,t);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}var WL=HL;const yE=Zp,uh=OL,GL=UL,qL=WL;let ZL=class{constructor(s){this.options=s,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""},num_dec:{regex:/&#([0-9]{1,7});/g,val:(t,e)=>String.fromCharCode(Number.parseInt(e,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(t,e)=>String.fromCharCode(Number.parseInt(e,16))}},this.addExternalEntities=XL,this.parseXml=e5,this.parseTextData=QL,this.resolveNameSpace=KL,this.buildAttributesMap=t5,this.isItStopNode=r5,this.replaceEntitiesValue=i5,this.readStopNodeData=a5,this.saveTextToParentTag=n5,this.addChild=s5}};function XL(s){const t=Object.keys(s);for(let e=0;e<t.length;e++){const i=t[e];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:s[i]}}}function QL(s,t,e,i,n,r,o){if(s!==void 0&&(this.options.trimValues&&!i&&(s=s.trim()),s.length>0)){o||(s=this.replaceEntitiesValue(s));const a=this.options.tagValueProcessor(t,s,e,n,r);return a==null?s:typeof a!=typeof s||a!==s?a:this.options.trimValues?Bg(s,this.options.parseTagValue,this.options.numberParseOptions):s.trim()===s?Bg(s,this.options.parseTagValue,this.options.numberParseOptions):s}}function KL(s){if(this.options.removeNSPrefix){const t=s.split(":"),e=s.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(s=e+t[1])}return s}const JL=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function t5(s,t,e){if(!this.options.ignoreAttributes&&typeof s=="string"){const i=yE.getAllMatches(s,JL),n=i.length,r={};for(let o=0;o<n;o++){const a=this.resolveNameSpace(i[o][1]);let l=i[o][4],h=this.options.attributeNamePrefix+a;if(a.length)if(this.options.transformAttributeName&&(h=this.options.transformAttributeName(h)),h==="__proto__"&&(h="#__proto__"),l!==void 0){this.options.trimValues&&(l=l.trim()),l=this.replaceEntitiesValue(l);const c=this.options.attributeValueProcessor(a,l,t);c==null?r[h]=l:typeof c!=typeof l||c!==l?r[h]=c:r[h]=Bg(l,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(r[h]=!0)}if(!Object.keys(r).length)return;if(this.options.attributesGroupName){const o={};return o[this.options.attributesGroupName]=r,o}return r}}const e5=function(s){s=s.replace(/\r\n?/g,`
`);const t=new uh("!xml");let e=t,i="",n="";for(let r=0;r<s.length;r++)if(s[r]==="<")if(s[r+1]==="/"){const o=Uo(s,">",r,"Closing Tag is not closed.");let a=s.substring(r+2,o).trim();if(this.options.removeNSPrefix){const c=a.indexOf(":");c!==-1&&(a=a.substr(c+1))}this.options.transformTagName&&(a=this.options.transformTagName(a)),e&&(i=this.saveTextToParentTag(i,e,n));const l=n.substring(n.lastIndexOf(".")+1);if(a&&this.options.unpairedTags.indexOf(a)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${a}>`);let h=0;l&&this.options.unpairedTags.indexOf(l)!==-1?(h=n.lastIndexOf(".",n.lastIndexOf(".")-1),this.tagsNodeStack.pop()):h=n.lastIndexOf("."),n=n.substring(0,h),e=this.tagsNodeStack.pop(),i="",r=o}else if(s[r+1]==="?"){let o=Ug(s,r,!1,"?>");if(!o)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,e,n),!(this.options.ignoreDeclaration&&o.tagName==="?xml"||this.options.ignorePiTags)){const a=new uh(o.tagName);a.add(this.options.textNodeName,""),o.tagName!==o.tagExp&&o.attrExpPresent&&(a[":@"]=this.buildAttributesMap(o.tagExp,n,o.tagName)),this.addChild(e,a,n)}r=o.closeIndex+1}else if(s.substr(r+1,3)==="!--"){const o=Uo(s,"-->",r+4,"Comment is not closed.");if(this.options.commentPropName){const a=s.substring(r+4,o-2);i=this.saveTextToParentTag(i,e,n),e.add(this.options.commentPropName,[{[this.options.textNodeName]:a}])}r=o}else if(s.substr(r+1,2)==="!D"){const o=GL(s,r);this.docTypeEntities=o.entities,r=o.i}else if(s.substr(r+1,2)==="!["){const o=Uo(s,"]]>",r,"CDATA is not closed.")-2,a=s.substring(r+9,o);i=this.saveTextToParentTag(i,e,n);let l=this.parseTextData(a,e.tagname,n,!0,!1,!0,!0);l==null&&(l=""),this.options.cdataPropName?e.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]):e.add(this.options.textNodeName,l),r=o+2}else{let o=Ug(s,r,this.options.removeNSPrefix),a=o.tagName;const l=o.rawTagName;let h=o.tagExp,c=o.attrExpPresent,u=o.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),e&&i&&e.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,e,n,!1));const p=e;if(p&&this.options.unpairedTags.indexOf(p.tagname)!==-1&&(e=this.tagsNodeStack.pop(),n=n.substring(0,n.lastIndexOf("."))),a!==t.tagname&&(n+=n?"."+a:a),this.isItStopNode(this.options.stopNodes,n,a)){let d="";if(h.length>0&&h.lastIndexOf("/")===h.length-1)a[a.length-1]==="/"?(a=a.substr(0,a.length-1),n=n.substr(0,n.length-1),h=a):h=h.substr(0,h.length-1),r=o.closeIndex;else if(this.options.unpairedTags.indexOf(a)!==-1)r=o.closeIndex;else{const m=this.readStopNodeData(s,l,u+1);if(!m)throw new Error(`Unexpected end of ${l}`);r=m.i,d=m.tagContent}const _=new uh(a);a!==h&&c&&(_[":@"]=this.buildAttributesMap(h,n,a)),d&&(d=this.parseTextData(d,a,n,!0,c,!0,!0)),n=n.substr(0,n.lastIndexOf(".")),_.add(this.options.textNodeName,d),this.addChild(e,_,n)}else{if(h.length>0&&h.lastIndexOf("/")===h.length-1){a[a.length-1]==="/"?(a=a.substr(0,a.length-1),n=n.substr(0,n.length-1),h=a):h=h.substr(0,h.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));const d=new uh(a);a!==h&&c&&(d[":@"]=this.buildAttributesMap(h,n,a)),this.addChild(e,d,n),n=n.substr(0,n.lastIndexOf("."))}else{const d=new uh(a);this.tagsNodeStack.push(e),a!==h&&c&&(d[":@"]=this.buildAttributesMap(h,n,a)),this.addChild(e,d,n),e=d}i="",r=u}}else i+=s[r];return t.child};function s5(s,t,e){const i=this.options.updateTag(t.tagname,e,t[":@"]);i===!1||(typeof i=="string"&&(t.tagname=i),s.addChild(t))}const i5=function(s){if(this.options.processEntities){for(let t in this.docTypeEntities){const e=this.docTypeEntities[t];s=s.replace(e.regx,e.val)}for(let t in this.lastEntities){const e=this.lastEntities[t];s=s.replace(e.regex,e.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const e=this.htmlEntities[t];s=s.replace(e.regex,e.val)}s=s.replace(this.ampEntity.regex,this.ampEntity.val)}return s};function n5(s,t,e,i){return s&&(i===void 0&&(i=Object.keys(t.child).length===0),s=this.parseTextData(s,t.tagname,e,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,i),s!==void 0&&s!==""&&t.add(this.options.textNodeName,s),s=""),s}function r5(s,t,e){const i="*."+e;for(const n in s){const r=s[n];if(i===r||t===r)return!0}return!1}function o5(s,t,e=">"){let i,n="";for(let r=t;r<s.length;r++){let o=s[r];if(i)o===i&&(i="");else if(o==='"'||o==="'")i=o;else if(o===e[0])if(e[1]){if(s[r+1]===e[1])return{data:n,index:r}}else return{data:n,index:r};else o==="	"&&(o=" ");n+=o}}function Uo(s,t,e,i){const n=s.indexOf(t,e);if(n===-1)throw new Error(i);return n+t.length-1}function Ug(s,t,e,i=">"){const n=o5(s,t+1,i);if(!n)return;let r=n.data;const o=n.index,a=r.search(/\s/);let l=r,h=!0;a!==-1&&(l=r.substring(0,a),r=r.substring(a+1).trimStart());const c=l;if(e){const u=l.indexOf(":");u!==-1&&(l=l.substr(u+1),h=l!==n.data.substr(u+1))}return{tagName:l,tagExp:r,closeIndex:o,attrExpPresent:h,rawTagName:c}}function a5(s,t,e){const i=e;let n=1;for(;e<s.length;e++)if(s[e]==="<")if(s[e+1]==="/"){const r=Uo(s,">",e,`${t} is not closed`);if(s.substring(e+2,r).trim()===t&&(n--,n===0))return{tagContent:s.substring(i,e),i:r};e=r}else if(s[e+1]==="?")e=Uo(s,"?>",e+1,"StopNode is not closed.");else if(s.substr(e+1,3)==="!--")e=Uo(s,"-->",e+3,"StopNode is not closed.");else if(s.substr(e+1,2)==="![")e=Uo(s,"]]>",e,"StopNode is not closed.")-2;else{const r=Ug(s,e,">");r&&((r&&r.tagName)===t&&r.tagExp[r.tagExp.length-1]!=="/"&&n++,e=r.closeIndex)}}function Bg(s,t,e){if(t&&typeof s=="string"){const i=s.trim();return i==="true"?!0:i==="false"?!1:qL(s,e)}else return yE.isExist(s)?s:""}var l5=ZL,vE={};function h5(s,t){return wE(s,t)}function wE(s,t,e){let i;const n={};for(let r=0;r<s.length;r++){const o=s[r],a=c5(o);let l="";if(e===void 0?l=a:l=e+"."+a,a===t.textNodeName)i===void 0?i=o[a]:i+=""+o[a];else{if(a===void 0)continue;if(o[a]){let h=wE(o[a],t,l);const c=d5(h,t);o[":@"]?u5(h,o[":@"],l,t):Object.keys(h).length===1&&h[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?h=h[t.textNodeName]:Object.keys(h).length===0&&(t.alwaysCreateTextNode?h[t.textNodeName]="":h=""),n[a]!==void 0&&n.hasOwnProperty(a)?(Array.isArray(n[a])||(n[a]=[n[a]]),n[a].push(h)):t.isArray(a,l,c)?n[a]=[h]:n[a]=h}}}return typeof i=="string"?i.length>0&&(n[t.textNodeName]=i):i!==void 0&&(n[t.textNodeName]=i),n}function c5(s){const t=Object.keys(s);for(let e=0;e<t.length;e++){const i=t[e];if(i!==":@")return i}}function u5(s,t,e,i){if(t){const n=Object.keys(t),r=n.length;for(let o=0;o<r;o++){const a=n[o];i.isArray(a,e+"."+a,!0,!0)?s[a]=[t[a]]:s[a]=t[a]}}}function d5(s,t){const{textNodeName:e}=t,i=Object.keys(s).length;return!!(i===0||i===1&&(s[e]||typeof s[e]=="boolean"||s[e]===0))}vE.prettify=h5;const{buildOptions:p5}=q_,f5=l5,{prettify:m5}=vE,g5=_E;let _5=class{constructor(s){this.externalEntities={},this.options=p5(s)}parse(s,t){if(typeof s!="string")if(s.toString)s=s.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(t){t===!0&&(t={});const n=g5.validate(s,t);if(n!==!0)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const e=new f5(this.options);e.addExternalEntities(this.externalEntities);const i=e.parseXml(s);return this.options.preserveOrder||i===void 0?i:m5(i,this.options)}addEntity(s,t){if(t.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(s.indexOf("&")!==-1||s.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(t==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[s]=t}};var b5=_5;const y5=`
`;function v5(s,t){let e="";return t.format&&t.indentBy.length>0&&(e=y5),EE(s,t,"",e)}function EE(s,t,e,i){let n="",r=!1;for(let o=0;o<s.length;o++){const a=s[o],l=w5(a);if(l===void 0)continue;let h="";if(e.length===0?h=l:h=`${e}.${l}`,l===t.textNodeName){let _=a[l];E5(h,t)||(_=t.tagValueProcessor(l,_),_=CE(_,t)),r&&(n+=i),n+=_,r=!1;continue}else if(l===t.cdataPropName){r&&(n+=i),n+=`<![CDATA[${a[l][0][t.textNodeName]}]]>`,r=!1;continue}else if(l===t.commentPropName){n+=i+`<!--${a[l][0][t.textNodeName]}-->`,r=!0;continue}else if(l[0]==="?"){const _=hy(a[":@"],t),m=l==="?xml"?"":i;let g=a[l][0][t.textNodeName];g=g.length!==0?" "+g:"",n+=m+`<${l}${g}${_}?>`,r=!0;continue}let c=i;c!==""&&(c+=t.indentBy);const u=hy(a[":@"],t),p=i+`<${l}${u}`,d=EE(a[l],t,h,c);t.unpairedTags.indexOf(l)!==-1?t.suppressUnpairedNode?n+=p+">":n+=p+"/>":(!d||d.length===0)&&t.suppressEmptyNode?n+=p+"/>":d&&d.endsWith(">")?n+=p+`>${d}${i}</${l}>`:(n+=p+">",d&&i!==""&&(d.includes("/>")||d.includes("</"))?n+=i+t.indentBy+d+i:n+=d,n+=`</${l}>`),r=!0}return n}function w5(s){const t=Object.keys(s);for(let e=0;e<t.length;e++){const i=t[e];if(s.hasOwnProperty(i)&&i!==":@")return i}}function hy(s,t){let e="";if(s&&!t.ignoreAttributes)for(let i in s){if(!s.hasOwnProperty(i))continue;let n=t.attributeValueProcessor(i,s[i]);n=CE(n,t),n===!0&&t.suppressBooleanAttributes?e+=` ${i.substr(t.attributeNamePrefix.length)}`:e+=` ${i.substr(t.attributeNamePrefix.length)}="${n}"`}return e}function E5(s,t){s=s.substr(0,s.length-t.textNodeName.length-1);let e=s.substr(s.lastIndexOf(".")+1);for(let i in t.stopNodes)if(t.stopNodes[i]===s||t.stopNodes[i]==="*."+e)return!0;return!1}function CE(s,t){if(s&&s.length>0&&t.processEntities)for(let e=0;e<t.entities.length;e++){const i=t.entities[e];s=s.replace(i.regex,i.val)}return s}var C5=v5;const I5=C5,x5={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(s,t){return t},attributeValueProcessor:function(s,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function lo(s){this.options=Object.assign({},x5,s),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=S5),this.processTextOrObjNode=T5,this.options.format?(this.indentate=A5,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}lo.prototype.build=function(s){return this.options.preserveOrder?I5(s,this.options):(Array.isArray(s)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(s={[this.options.arrayNodeName]:s}),this.j2x(s,0).val)};lo.prototype.j2x=function(s,t){let e="",i="";for(let n in s)if(Object.prototype.hasOwnProperty.call(s,n))if(typeof s[n]>"u")this.isAttribute(n)&&(i+="");else if(s[n]===null)this.isAttribute(n)?i+="":n[0]==="?"?i+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+n+"/"+this.tagEndChar;else if(s[n]instanceof Date)i+=this.buildTextValNode(s[n],n,"",t);else if(typeof s[n]!="object"){const r=this.isAttribute(n);if(r)e+=this.buildAttrPairStr(r,""+s[n]);else if(n===this.options.textNodeName){let o=this.options.tagValueProcessor(n,""+s[n]);i+=this.replaceEntitiesValue(o)}else i+=this.buildTextValNode(s[n],n,"",t)}else if(Array.isArray(s[n])){const r=s[n].length;let o="",a="";for(let l=0;l<r;l++){const h=s[n][l];if(!(typeof h>"u"))if(h===null)n[0]==="?"?i+=this.indentate(t)+"<"+n+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+n+"/"+this.tagEndChar;else if(typeof h=="object")if(this.options.oneListGroup){const c=this.j2x(h,t+1);o+=c.val,this.options.attributesGroupName&&h.hasOwnProperty(this.options.attributesGroupName)&&(a+=c.attrStr)}else o+=this.processTextOrObjNode(h,n,t);else if(this.options.oneListGroup){let c=this.options.tagValueProcessor(n,h);c=this.replaceEntitiesValue(c),o+=c}else o+=this.buildTextValNode(h,n,"",t)}this.options.oneListGroup&&(o=this.buildObjectNode(o,n,a,t)),i+=o}else if(this.options.attributesGroupName&&n===this.options.attributesGroupName){const r=Object.keys(s[n]),o=r.length;for(let a=0;a<o;a++)e+=this.buildAttrPairStr(r[a],""+s[n][r[a]])}else i+=this.processTextOrObjNode(s[n],n,t);return{attrStr:e,val:i}};lo.prototype.buildAttrPairStr=function(s,t){return t=this.options.attributeValueProcessor(s,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&t==="true"?" "+s:" "+s+'="'+t+'"'};function T5(s,t,e){const i=this.j2x(s,e+1);return s[this.options.textNodeName]!==void 0&&Object.keys(s).length===1?this.buildTextValNode(s[this.options.textNodeName],t,i.attrStr,e):this.buildObjectNode(i.val,t,i.attrStr,e)}lo.prototype.buildObjectNode=function(s,t,e,i){if(s==="")return t[0]==="?"?this.indentate(i)+"<"+t+e+"?"+this.tagEndChar:this.indentate(i)+"<"+t+e+this.closeTag(t)+this.tagEndChar;{let n="</"+t+this.tagEndChar,r="";return t[0]==="?"&&(r="?",n=""),(e||e==="")&&s.indexOf("<")===-1?this.indentate(i)+"<"+t+e+r+">"+s+n:this.options.commentPropName!==!1&&t===this.options.commentPropName&&r.length===0?this.indentate(i)+`<!--${s}-->`+this.newLine:this.indentate(i)+"<"+t+e+r+this.tagEndChar+s+this.indentate(i)+n}};lo.prototype.closeTag=function(s){let t="";return this.options.unpairedTags.indexOf(s)!==-1?this.options.suppressUnpairedNode||(t="/"):this.options.suppressEmptyNode?t="/":t=`></${s}`,t};lo.prototype.buildTextValNode=function(s,t,e,i){if(this.options.cdataPropName!==!1&&t===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${s}]]>`+this.newLine;if(this.options.commentPropName!==!1&&t===this.options.commentPropName)return this.indentate(i)+`<!--${s}-->`+this.newLine;if(t[0]==="?")return this.indentate(i)+"<"+t+e+"?"+this.tagEndChar;{let n=this.options.tagValueProcessor(t,s);return n=this.replaceEntitiesValue(n),n===""?this.indentate(i)+"<"+t+e+this.closeTag(t)+this.tagEndChar:this.indentate(i)+"<"+t+e+">"+n+"</"+t+this.tagEndChar}};lo.prototype.replaceEntitiesValue=function(s){if(s&&s.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const e=this.options.entities[t];s=s.replace(e.regex,e.val)}return s};function A5(s){return this.options.indentBy.repeat(s)}function S5(s){return s.startsWith(this.options.attributeNamePrefix)&&s!==this.options.textNodeName?s.substr(this.attrPrefixLen):!1}var O5=lo;const P5=b5,F5=O5;var Xp={XMLParser:P5,XMLBuilder:F5};let Qp=class{};k(Qp,"parser",new Xp.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));k(Qp,"builder",new Xp.XMLBuilder({attributeNamePrefix:"$",ignoreAttributes:!1,suppressBooleanAttributes:!1}));let vs=class Hd{static join(t){const e={};for(const i of t)for(const n in i)if(!e[n])e[n]=new Set(i[n]);else for(const r of i[n])e[n].add(r);return e}static intersect(t){if(t.length===0)return{};let e=Hd.clone(t[0]);for(let i=1;i<t.length;i++){const n=t[i],r={};for(const o in e)if(n[o]){const a=new Set;for(const l of e[o])n[o].has(l)&&a.add(l);a.size>0&&(r[o]=a)}e=r}return e}static clone(t){const e={};for(const i in t)e[i]=new Set(t[i]);return e}static remove(t,e,i=!1){i&&(t=Hd.clone(t));for(const n in e)if(t[n]){for(const r of e[n])t[n].delete(r);t[n].size===0&&delete t[n]}}static add(t,e,i=!1){i&&(t=Hd.clone(t));for(const n in e)if(!t[n])t[n]=new Set(e[n]);else for(const r of e[n])t[n].add(r)}static append(t,e,...i){let n=t[e];n||(n=new Set,t[e]=n);for(const r of i)n.add(r)}static isEqual(t,e){const i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(const r of i){if(!e[r]||t[r].size!==e[r].size)return!1;for(const o of t[r])if(!e[r].has(o))return!1}return!0}static isEmpty(t){return Object.values(t).reduce((e,i)=>e+i.size,0)===0}static toRaw(t){const e={};for(const i in t)e[i]=Array.from(t[i]);return e}static fromRaw(t){const e={};for(const i in t)e[i]=new Set(t[i]);return e}},wl=class extends Map{constructor(s){super(s),k(this,"onItemSet",new ft),k(this,"onItemUpdated",new ft),k(this,"onItemDeleted",new ft),k(this,"onCleared",new ft),k(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}set(s,t){const e=this.has(s);if(!(this.guard??(()=>!0))(s,t))return this;const i=super.set(s,t);return e?(this.onItemUpdated||(this.onItemUpdated=new ft),this.onItemUpdated.trigger({key:s,value:t})):(this.onItemSet||(this.onItemSet=new ft),this.onItemSet.trigger({key:s,value:t})),i}add(s){const t=Ss.create();return this.set(t,s),t}delete(s){const t=super.delete(s);return t&&this.onItemDeleted.trigger(s),t}dispose(){this.clear(),this.onItemSet.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}},um=class{static isEntry(s){return new Set(["Boolean","Color","Text","Number","Select","Vector3","TextSet","None"]).has(s.type)}static copySchema(s,t={}){for(const e in s){const i=s[e];this.isEntry(i)?t[e]=this.copyEntry(i):(t[e]={},this.copySchema(i,t[e]))}return t}static copyEntry(s){if(s.type==="Boolean"){const t=s;return{type:t.type,value:t.value}}if(s.type==="Color"){const t=s;return{type:t.type,value:t.value.clone()}}if(s.type==="Text"){const t=s;return{type:t.type,value:t.value}}if(s.type==="Number"){const t=s;return{type:t.type,value:t.value,min:t.min,max:t.max,interpolable:t.interpolable}}if(s.type==="Select"){const t=s;return{type:t.type,value:t.value,multiple:t.multiple,options:new Set(t.options)}}if(s.type==="Vector3"){const t=s;return{type:t.type,value:t.value.clone()}}if(s.type==="TextSet"){const t=s;return{type:t.type,value:new Set(t.value)}}if(s.type==="None"){const t=s;return{type:t.type,value:t.value}}throw new Error("Invalid entry!")}};class R5{constructor(){k(this,"list",new Set)}add(t){for(const e of t)this.list.add(e)}remove(t){for(const e of t)this.list.delete(e)}set(t){for(const e of this.list)e.enabled=t}reset(){for(const t of this.list)t.reset()}}let Kp=class{constructor(s,t,e,i){k(this,"_component"),k(this,"name"),k(this,"uuid"),this._component=s,this.name=e,this.uuid=i??Ss.create(),t.get(Z_).list.set(this.uuid,this)}get controls(){return um.copySchema(this._config)}set(s){for(const t in s)if(t in this){const e=t;this[e]=s[t].value}}export(s=this._config,t={}){for(const e in s){const i=s[e];if(um.isEntry(i))if(i.type==="Color"){const{r:n,g:r,b:o}=i.value;t[e]={...i,value:{r:n,g:r,b:o}}}else if(i.type==="Vector3"){const{x:n,y:r,z:o}=i.value;t[e]={...i,value:{x:n,y:r,z:o}}}else if(i.type==="TextSet"){const n=Array.from(i.value);t[e]={...i,value:n}}else if(i.type==="Select"){const n=Array.from(i.options);t[e]={...i,options:n}}else t[e]={...i};else t[e]={},this.export(i,t[e])}return t}import(s,t={},e=!0){for(const i in s){const n=s[i];if(um.isEntry(n))if(n.type==="Color"){const{r,g:o,b:a}=n.value;t[i]={...n,value:new xt(r,o,a)}}else if(n.type==="Vector3"){const{x:r,y:o,z:a}=n.value;t[i]={...n,value:new F(r,o,a)}}else n.type==="TextSet"?t[i]={...n,value:new Set(n.value)}:n.type==="Select"?t[i]={...n,options:new Set(n.options)}:t[i]={...n};else t[i]={},this.import(n,t[i],!1)}e&&this.set(t)}};const IE=class xE extends he{constructor(t){super(t),k(this,"list",new wl),k(this,"enabled",!0),t.add(xE.uuid,this)}};k(IE,"uuid","b8c764e0-6b24-4e77-9a32-35fa728ee5b4");let Z_=IE;class L5{constructor(t){k(this,"_event"),k(this,"_position",new Bt),k(this,"onDisposed",new ft),k(this,"updateMouseInfo",e=>{this._event=e}),this.dom=t,this.setupEvents(!0)}get position(){return this.updatePosition(!1),this._position.clone()}get rawPosition(){return this.updatePosition(!0),this._position.clone()}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}updatePosition(t){if(this._event){const e=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(e,this._event,t),this._position.y=this.getPositionY(e,this._event,t)}}getPositionY(t,e,i){const n=this.getDataObject(e);return i?n.clientY:-((n.clientY-t.top)/(t.bottom-t.top))*2+1}getPositionX(t,e,i){const n=this.getDataObject(e);return i?n.clientX:(n.clientX-t.left)/(t.right-t.left)*2-1}getDataObject(t){return t instanceof MouseEvent?t:t.touches[0]}setupEvents(t){t?(this.dom.addEventListener("pointermove",this.updateMouseInfo),this.dom.addEventListener("touchstart",this.updateMouseInfo)):(this.dom.removeEventListener("pointermove",this.updateMouseInfo),this.dom.removeEventListener("touchstart",this.updateMouseInfo))}}const TE=class AE extends he{constructor(t){super(t),k(this,"onDisposed",new ft),k(this,"onFragmentsLoaded",new ft),k(this,"baseCoordinationModel",""),k(this,"baseCoordinationMatrix",new vt),k(this,"enabled",!0),k(this,"initialized",!1),k(this,"_core"),this.components.add(AE.uuid,this)}get list(){return this.core.models.list}get core(){if(!this._core)throw new Error("FragmentsManager not initialized. Call init() first.");return this._core}dispose(){this._core&&(this.core.dispose(),this._core=void 0),this.baseCoordinationModel="",this.onFragmentsLoaded.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}init(t){this._core=new I1(t),this.initialized=!0,this.core.onModelLoaded.add(async e=>{this.list.size===1&&(this.baseCoordinationModel=e.modelId,this.baseCoordinationMatrix=await e.getCoordinationMatrix())}),this.list.onItemDeleted.add(()=>{this.list.size>0||(this.baseCoordinationModel="",this.baseCoordinationMatrix=new vt)})}async raycast(t){const e=[];for(const r of this.core.models.list.values())if(t.snappingClasses&&t.snappingClasses.length>0){const o=await r.raycastWithSnapping(t);if(o&&o.length>0)e.push(o[0]);else{const a=await r.raycast(t);a&&e.push(a)}}else{const o=await r.raycast(t);o&&e.push(o)}if(await Promise.all(e),e.length===0)return;let i=e[0],n=i.distance;for(let r=1;r<e.length;r++)e[r].distance<n&&(n=e[r].distance,i=e[r]);return i}async getPositions(t){const e=[],i=async(r,o)=>{const a=await r.getPositions(o);for(const l of a)e.push(l)},n=[];for(const r in t){const o=this.core.models.list.get(r);o&&n.push(i(o,Array.from(t[r])))}return await Promise.all(n),e}async getBBoxes(t){const e=[],i=async(r,o)=>{const a=await r.getBoxes(o);if(a)for(const l of a)e.push(l)},n=[];for(const r in t){const o=this.core.models.list.get(r);o&&n.push(i(o,Array.from(t[r])))}return await Promise.all(n),e}async highlight(t,e){await this.forEachModel(e,"highlight",t)}async getData(t,e){const i={};for(const[n,r]of Object.entries(t)){const o=this.list.get(n);if(!o)continue;const a=await o.getItemsData([...r],e);i[n]=a}return i}async resetHighlight(t){await this.forEachModel(t,"resetHighlight")}async forEachModel(t,e,...i){const n={};if(t)for(const o in t){const a=t[o];n[o]=Array.from(a)}else for(const o of this.core.models.list.keys())n[o]=void 0;const r=[];for(const o in n){const a=this.core.models.list.get(o);if(a){const l=n[o],h=a[e](l,...i);r.push(h)}}await Promise.all(r)}async guidsToModelIdMap(t){const e={};for(const[i,n]of this.list){const r=(await n.getLocalIdsByGuids([...t])).filter(o=>o!==null);e[i]=new Set(r)}return e}async modelIdMapToGuids(t){const e=[];for(const[i,n]of Object.entries(t)){const r=this.list.get(i);if(!r)continue;const o=(await r.getGuidsByLocalIds([...n])).filter(a=>a!==null);e.push(...o)}return e}applyBaseCoordinateSystem(t,e){const i=new vt;return e&&i.copy(e.clone()).invert(),i.multiply(this.baseCoordinationMatrix),t.applyMatrix4(i),i}};k(TE,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let Lt=TE;class N5{constructor(){k(this,"wasm",{path:"",absolute:!1,logLevel:Np.LOG_LEVEL_OFF}),k(this,"webIfc",{COORDINATE_TO_ORIGIN:!0}),k(this,"autoSetWasm",!0),k(this,"customLocateFileHandler",null)}}const M5=class Vg extends he{constructor(t){super(t),k(this,"onDisposed",new ft),k(this,"onIfcStartedLoading",new ft),k(this,"onSetup",new ft),k(this,"settings",new N5),k(this,"webIfc",new Qo),k(this,"enabled",!0),this.components.add(Vg.uuid,this)}dispose(){this.webIfc=null,this.onDisposed.trigger(Vg.uuid),this.onDisposed.reset()}async setup(t){this.settings={...this.settings,...t},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(t,e,i,n){const r=this.components.get(Lt);if(!r.initialized)throw new Error("You need to initialize fragments first.");this.settings.autoSetWasm&&await this.autoSetWasm(),r.core.settings.autoCoordinate=e;const o=new T1;o.wasm.path=this.settings.wasm.path,o.wasm.absolute=this.settings.wasm.absolute,n!=null&&n.instanceCallback&&n.instanceCallback(o);const a=await o.process({...n==null?void 0:n.processData,bytes:t});return await r.core.load(a,{modelId:i,userData:n==null?void 0:n.userData})}async readIfcFile(t){const{path:e,absolute:i,logLevel:n}=this.settings.wasm;return this.webIfc.SetWasmPath(e,i),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModel(t,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new Qo}async autoSetWasm(){const t=await fetch(`https://unpkg.com/@thatopen/components@${QE.release}/package.json`);if(!t.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const e=await t.json();if(!("web-ifc"in e.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const i=e.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${i}/`,this.settings.wasm.absolute=!0}}};k(M5,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");const SE=class OE extends he{constructor(t){super(t),k(this,"enabled",!0),this.components.add(OE.uuid,this)}async set(t,e){const i=this.components.get(Lt),n=[];if(e)for(const[r,o]of Object.entries(e)){const a=i.list.get(r);a&&n.push(a.setVisible([...o],t))}else for(const r of i.list.values())n.push(r.setVisible(void 0,t));await Promise.all(n),await i.core.update(!0)}async isolate(t){await Promise.all([this.set(!1),this.set(!0,t)])}async toggle(t){const e=[],i=this.components.get(Lt);for(const[n,r]of Object.entries(t)){const o=i.list.get(n);o&&e.push(o.toggleVisible([...r]))}await Promise.all(e),await i.core.update(!0)}async getVisibilityMap(t,e){const i=[],n=[],r=this.components.get(Lt);if(e)for(const l of e){const h=r.list.get(l);h&&(i.push(h.modelId),n.push(h.getItemsByVisibility(t)))}else for(const l of r.list.values())i.push(l.modelId),n.push(l.getItemsByVisibility(t));const o=await Promise.all(n),a={};for(const[l,h]of i.entries())a[h]=o[l];return a}};k(SE,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");let D5=SE;const PE=class $g extends he{constructor(t){super(t),k(this,"enabled",!0),k(this,"onDisposed",new ft),k(this,"list",new ge),this.components.add($g.uuid,this)}dispose(t=!0){this.list.clear(),this.onDisposed.trigger($g.uuid),t&&(this.onDisposed.reset(),this.list.eventsEnabled=!1,this.list.dispose())}get(){const t=new Tt;for(const e of this.list)t.union(e);return t}async addFromModelIdMap(t){const e=this.components.get(Lt),i=new Tt;for(const[n,r]of Object.entries(t)){const o=e.list.get(n);if(!o)continue;const a=await o.getMergedBox([...r]);i.union(a)}this.list.add(i)}addFromModels(t){const e=this.components.get(Lt);for(const[i,n]of e.list)t&&!t.some(r=>r.test(i))||this.list.add(n.box)}async getCenter(t){this.list.clear(),await this.addFromModelIdMap(t);const e=this.get();this.list.clear();const i=new F;return e.getCenter(i),i}async getCameraOrientation(t,e=1){const i=this.components.get(Lt);this.list.clear();for(const[h,c]of i.list)this.list.add(c.box);const n=this.get();this.list.clear();const r=new F;n.getCenter(r);const o=new F;n.getSize(o);const a=Math.max(o.x,o.y,o.z)*e,l=new F;switch(t){case"front":l.set(r.x,r.y,r.z+a);break;case"back":l.set(r.x,r.y,r.z-a);break;case"left":l.set(r.x-a,r.y,r.z);break;case"right":l.set(r.x+a,r.y,r.z);break;case"top":l.set(r.x,r.y+a,r.z);break;case"bottom":l.set(r.x,r.y-a,r.z);break;default:l.set(r.x,r.y,r.z+a)}return{position:l,target:r}}};k(PE,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");let FE=PE;class k5{constructor(t,e){k(this,"description"),k(this,"_components"),k(this,"_queries",[]),k(this,"_aggregation","exclusive"),k(this,"result",null),k(this,"cache",!0),k(this,"serializeQueryParameters",i=>{var n;return{categories:(n=i.categories)==null?void 0:n.map(r=>r.source),attributes:i.attributes?{aggregation:i.attributes.aggregation,queries:i.attributes.queries.map(this.serializeAttributeQuery)}:void 0,relation:i.relation?{name:i.relation.name,query:i.relation.query?this.serializeQueryParameters(i.relation.query):void 0}:void 0}}),k(this,"deserializeQueryParameters",i=>{var n;return{categories:(n=i.categories)==null?void 0:n.map(r=>new RegExp(r)),attributes:i.attributes?{aggregation:i.attributes.aggregation,queries:i.attributes.queries.map(this.deserializeAttributeQuery)}:void 0,relation:i.relation?{name:i.relation.name,query:i.relation.query?this.deserializeQueryParameters(i.relation.query):void 0}:void 0}}),this._components=t,this.queries=e}set queries(t){this._queries=t,this.clearCache()}get queries(){return this._queries}set aggregation(t){t!==this._aggregation&&this.clearCache(),this._aggregation=t}get aggregation(){return this._aggregation}async test(t){const{modelIds:e,force:i}={force:!1,...t};if(this.result&&!i)return this.result;const n=await this._components.get(jd).getItems(this.queries,{modelIds:e,aggregation:this.aggregation});return this.cache&&(this.result=n),n}clearCache(){this.result=null}serializeAttributeQuery(t){let e;return Array.isArray(t.value)?e=t.value.map(i=>i.source):t.value instanceof RegExp?e=t.value.source:e=t.value,{name:t.name.source,value:e,type:t.type instanceof RegExp?t.type.source:t.type,negate:t.negate,itemIds:t.itemIds}}toJSON(){return{name:"Finder Query",description:this.description,queries:this.queries.map(this.serializeQueryParameters),aggregation:this.aggregation,cache:this.cache}}deserializeAttributeQuery(t){let e;return Array.isArray(t.value)?e=t.value.map(i=>new RegExp(i)):typeof t.value=="string"?e=new RegExp(t.value):e=t.value,{name:new RegExp(t.name),value:e,type:t.type?new RegExp(t.type):void 0,negate:t.negate,itemIds:t.itemIds}}fromJSON(t){return this.description=t.description,this.aggregation=t.aggregation,this.cache=t.cache,this.queries=t.queries.map(this.deserializeQueryParameters),this}}const RE=class LE extends he{constructor(t){super(t),k(this,"enabled",!0),k(this,"list",new Wt),t.add(LE.uuid,this)}async getItems(t,e){const{modelIds:i}=e??{},n=(e==null?void 0:e.aggregation)??"exclusive",r=this.components.get(Lt),o=await Promise.all(t.map(async a=>{const l={};return await Promise.all(Array.from(r.list).map(async([h,c])=>{if(i&&!i.some(p=>p.test(h)))return;const u=await c.getItemsByQuery(a);l[h]=new Set(u)})),l}));return n==="inclusive"?vs.join(o):vs.intersect(o)}create(t,e){const i=new k5(this.components,e);return this.list.set(t,i),i}async addFromCategories(t){const e=new Set,i=this.components.get(Lt);for(const[n,r]of i.list){if(t&&!t.some(l=>l.test(n)))continue;const o=(await r.getItemsWithGeometryCategories()).filter(l=>l!==null),a=new Set(o);for(const l of a)this.list.has(l)||(this.create(l,[{categories:[new RegExp(`^${l}$`)]}]),e.add(l))}return[...e]}import(t){const{data:e}=t,i=[];if(!e)return i;for(const n of e){const{name:r,description:o,queries:a,aggregation:l,cache:h}=n,c=this.create(r,[]);c.fromJSON({description:o,queries:a,aggregation:l,cache:h}),i.push(c)}return i}export(){const t=[];for(const[e,i]of this.list.entries()){const n={...i.toJSON(),name:e};t.push(n)}return{data:t}}};k(RE,"uuid","0da7ad77-f734-42ca-942f-a074adfd1e3a");let jd=RE;const NE=class ME extends he{constructor(t){super(t),k(this,"enabled",!0),k(this,"onDisposed",new ft),k(this,"list",new Wt),k(this,"defaultSaveFunction",e=>"value"in e.Name?e.Name.value:null),k(this,"onBeforeFragmentsDispose",async e=>{const{key:i,value:n}=e,r=await n.getLocalIds(),o={[i]:new Set(r)};this.removeItems(o)}),t.add(ME.uuid,this),this.setupEvents(),t.get(Lt).list.onBeforeDelete.add(this.onBeforeFragmentsDispose)}setupEvents(){this.list.onBeforeDelete.add(({value:t})=>t.dispose())}getClassificationGroups(t){let e=this.list.get(t);return e||(e=new Wt,this.list.set(t,e)),e}getModelItems(t,e,i){const{map:n}=this.getGroupData(t,e);let r=n[i];return r||(r=new Set,n[i]=r),r}getGroupData(t,e){const i=this.components.get(jd),n=this.getClassificationGroups(t);let r=n.get(e);return r||(r={map:{},get(){return new Promise(o=>{if(!r){o({});return}if(r.query){const{name:a,config:l}=r.query,h=i.list.get(a);if(!h)throw new Error("Classifier: the query name associated with the group doesn't exist in the ItemsFinder component");h.test(l).then(c=>{if(!r){o({});return}const u=vs.join([c,r.map]);o(u)})}else o(r.map)})}},n.set(e,r)),r}async aggregateItems(t,e,i){const n=(i==null?void 0:i.data)??void 0,r=(i==null?void 0:i.aggregationCallback)??this.defaultSaveFunction,o=this.components.get(Lt),a=await this.components.get(jd).getItems([e],{modelIds:i==null?void 0:i.modelIds});for(const[l,h]of Object.entries(a)){const c=o.list.get(l);if(!c)continue;const u=(d,..._)=>{const m=this.getModelItems(t,d,l);for(const g of _)m.add(g)},p=await c.getItemsData([...h],n);for(const d of p)r(d,u)}}addGroupItems(t,e,i){const{map:n}=this.getGroupData(t,e);vs.add(n,i)}setGroupQuery(t,e,i){const n=this.getGroupData(t,e);n.query=i}async find(t){const e=[];for(const[i,n]of Object.entries(t)){const r=[],o=this.list.get(i);if(!o)continue;for(const l of n){const h=o.get(l);if(!h)continue;const c=await h.get();r.push(c)}const a=vs.join(r);e.push(a)}return vs.intersect(e)}async aggregateItemRelations(t,e,i,n){const r=(n==null?void 0:n.attribute)??"Name",o={relations:{[i]:{attributes:!0,relations:!1}}};await this.aggregateItems(t,e,{modelIds:n==null?void 0:n.modelIds,data:o,aggregationCallback:(a,l)=>{if(!(a!=null&&a[r]))return;const h=a[r];if(!("value"in h))return;const c=a[i];if(Array.isArray(c))for(const u of c)"value"in u._localId&&l(h.value,u._localId.value)}})}async byIfcBuildingStorey(t){await this.aggregateItemRelations((t==null?void 0:t.classificationName)??"Storeys",{categories:[/BUILDINGSTOREY/]},"ContainsElements",{modelIds:t==null?void 0:t.modelIds})}async byCategory(t){const e=await this.components.get(jd).addFromCategories(t==null?void 0:t.modelIds);for(const i of e)this.setGroupQuery((t==null?void 0:t.classificationName)??"Categories",i,{name:i})}dispose(){this.list.clear(),this.components.get(Lt).list.onBeforeDelete.remove(this.onBeforeFragmentsDispose),this.onDisposed.trigger()}removeItems(t,e){if(e&&e.classificationName){const i=this.list.get(e.classificationName);if(!i||e.groupName&&!i.get(e.groupName))return;for(const[,n]of i)vs.remove(n.map,t);return}for(const[,i]of this.list.entries())for(const[,n]of i)vs.remove(n.map,t)}async byModel(t){const e=this.components.get(Lt),i=(t==null?void 0:t.classificationName)??"Models";for(const[n,r]of e.list){if(t&&t.modelIds&&!t.modelIds.some(l=>l.test(n)))continue;const o=await r.getItemsIdsWithGeometry(),a={[n]:new Set(o)};this.getGroupData(i,n),this.addGroupItems(i,n,a)}}};k(NE,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");let z5=NE;class U5{constructor(t,e){k(this,"enabled",!0),k(this,"components"),k(this,"onDisposed",new ft),k(this,"mouse"),k(this,"three",new oa),k(this,"world");const i=e.renderer;if(!i)throw new Error("A renderer is needed for the raycaster to work!");this.world=e,this.mouse=new L5(i.three.domElement),this.components=t}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRayToObjects(t=Array.from(this.world.meshes),e=this.mouse.position){if(!this.world)throw new Error("A world is needed to cast rays!");const i=this.world.camera.three;return this.three.setFromCamera(e,i),this.intersect(t)}async castRay(t){const e=t==null?void 0:t.snappingClasses,i=(t==null?void 0:t.items)??Array.from(this.world.meshes),n=(t==null?void 0:t.position)??this.mouse.position;if(!this.world)throw new Error("A world is needed to cast rays!");const r=this.world.camera.three,o=this.components.get(Lt),a=this.world.renderer.three.domElement,l=this.mouse.rawPosition;let h=null;if(o.initialized&&(h=await o.raycast({camera:r,dom:a,mouse:l,snappingClasses:e}),i.length===0))return h;this.three.setFromCamera(n,r);const c=this.intersect(i);return h?c&&c.distance<h.distance?c:h:c}intersect(t=Array.from(this.world.meshes)){const e=this.three.intersectObjects(t),i=this.filterClippingPlanes(e);return i.length>0?i[0]:null}filterClippingPlanes(t){if(!this.world.renderer)throw new Error("Renderer not found!");const e=this.world.renderer.three;if(!e.clippingPlanes)return t;const i=e.clippingPlanes;return t.length<=0||!i||(i==null?void 0:i.length)<=0?t:t.filter(n=>i.every(r=>r.distanceToPoint(n.point)>0))}}const DE=class kE extends he{constructor(t){super(t),k(this,"enabled",!0),k(this,"list",new Map),k(this,"onDisposed",new ft),t.add(kE.uuid,this)}get(t){if(this.list.has(t.uuid))return this.list.get(t.uuid);const e=new U5(this.components,t);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}};k(DE,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let hn=DE;class B5 extends Y_{constructor(){super(...arguments),k(this,"onCameraChanged",new ft),k(this,"meshes",new Set),k(this,"onAfterUpdate",new ft),k(this,"onBeforeUpdate",new ft),k(this,"onDisposed",new ft),k(this,"isDisposing",!1),k(this,"enabled",!0),k(this,"_dynamicAnchor",!1),k(this,"uuid",Ss.create()),k(this,"name"),k(this,"_scene"),k(this,"_camera"),k(this,"_renderer",null),k(this,"onPointerDown",async t=>{if(!this.camera.hasCameraControls())throw new Error("World: can't set dynamic anchor if the camera doesn't have controls.");const e=await this.components.get(hn).get(this).castRay();e&&e.point&&t.button===0&&this.camera.controls.setOrbitPoint(e.point.x,e.point.y,e.point.z)}),k(this,"_defaultCamera")}set dynamicAnchor(t){var e;const i=(e=this.renderer)==null?void 0:e.three.domElement.parentElement;if(!i)throw new Error("World: the renderer must have a parentElement to set dynamic anchoring.");t?(this.camera.controls&&(this.camera.controls.minDistance=.01),i.addEventListener("pointerdown",this.onPointerDown)):i.removeEventListener("pointerdown",this.onPointerDown)}get dynamicAnchor(){return this._dynamicAnchor}get defaultCamera(){if(!this._defaultCamera)throw new Error("World: there is no default camera defined.");return this._defaultCamera}set defaultCamera(t){this._defaultCamera=t}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(t){this._scene=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(t){this._camera||(this.defaultCamera=t),this._camera=t,t.currentWorld=this,this.onCameraChanged.trigger(t)}get renderer(){return this._renderer}set renderer(t){this._renderer=t,t&&(t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"}))}useDefaultCamera(){this.camera=this.defaultCamera}update(t){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(t),this.camera.isUpdateable()&&this.camera.update(t),this.renderer&&this.renderer.update(t),this.onAfterUpdate.trigger()))}dispose(t=!0){if(this.enabled=!1,this.isDisposing=!0,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),t){const e=this.components.get(dr);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const i of this.meshes)e.destroy(i);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.components.get($E).list.delete(this.uuid),this.onDisposed.trigger(),this.onDisposed.reset()}}class V5 extends gL{constructor(t,e,i){super(t),k(this,"enabled",!0),k(this,"container"),k(this,"three"),k(this,"_canvas"),k(this,"_parameters"),k(this,"_resizeObserver",null),k(this,"onContainerUpdated",new ft),k(this,"_resizing",!1),k(this,"resize",o=>{if(this._resizing)return;this._resizing=!0,this.onContainerUpdated.trigger();const a=o?o.x:this.container.clientWidth,l=o?o.y:this.container.clientHeight;this.three.setSize(a,l),this.onResize.trigger(new Bt(a,l)),this._resizing=!1}),k(this,"resizeEvent",()=>{this.resize()}),k(this,"onContextLost",o=>{o.preventDefault(),this.enabled=!1}),k(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new tp({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0}),this.container=e,this._parameters=i,this.three=new tp({antialias:!0,alpha:!0,...i}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const n=this.three.getContext(),{canvas:r}=n;r.addEventListener("webglcontextlost",this.onContextLost,!1),r.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const t=this.currentWorld.scene.three,e=this.currentWorld.camera.three;this.three.render(t,e),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.forceContextLoss(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new Bt(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(t){const e=this.three.domElement.parentElement;if(!e)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),t&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(e),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Ae={LEFT:1,RIGHT:2,MIDDLE:4},ot=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),Aa={NONE:0,IN:1,OUT:-1};function bo(s){return s.isPerspectiveCamera}function Pr(s){return s.isOrthographicCamera}const Sa=Math.PI*2,cy=Math.PI/2,zE=1e-5,dh=Math.PI/180;function Qi(s,t,e){return Math.max(t,Math.min(e,s))}function de(s,t=zE){return Math.abs(s)<t}function ee(s,t,e=zE){return de(s-t,e)}function uy(s,t){return Math.round(s/t)*t}function ph(s){return isFinite(s)?s:s<0?-Number.MAX_VALUE:Number.MAX_VALUE}function fh(s){return Math.abs(s)<Number.MAX_VALUE?s:s*(1/0)}function Xu(s,t,e,i,n=1/0,r){i=Math.max(1e-4,i);const o=2/i,a=o*r,l=1/(1+a+.48*a*a+.235*a*a*a);let h=s-t;const c=t,u=n*i;h=Qi(h,-u,u),t=s-h;const p=(e.value+o*h)*r;e.value=(e.value-o*p)*l;let d=t+(h+p)*l;return c-s>0==d>c&&(d=c,e.value=(d-c)/r),d}function dy(s,t,e,i,n=1/0,r,o){i=Math.max(1e-4,i);const a=2/i,l=a*r,h=1/(1+l+.48*l*l+.235*l*l*l);let c=t.x,u=t.y,p=t.z,d=s.x-c,_=s.y-u,m=s.z-p;const g=c,f=u,b=p,y=n*i,E=y*y,C=d*d+_*_+m*m;if(C>E){const M=Math.sqrt(C);d=d/M*y,_=_/M*y,m=m/M*y}c=s.x-d,u=s.y-_,p=s.z-m;const I=(e.x+a*d)*r,x=(e.y+a*_)*r,A=(e.z+a*m)*r;e.x=(e.x-a*I)*h,e.y=(e.y-a*x)*h,e.z=(e.z-a*A)*h,o.x=c+(d+I)*h,o.y=u+(_+x)*h,o.z=p+(m+A)*h;const O=g-s.x,L=f-s.y,V=b-s.z,T=o.x-g,N=o.y-f,v=o.z-b;return O*T+L*N+V*v>0&&(o.x=g,o.y=f,o.z=b,e.x=(o.x-g)/r,e.y=(o.y-f)/r,e.z=(o.z-b)/r),o}function dm(s,t){t.set(0,0),s.forEach(e=>{t.x+=e.clientX,t.y+=e.clientY}),t.x/=s.length,t.y/=s.length}function pm(s,t){return Pr(s)?(console.warn(`${t} is not supported in OrthographicCamera`),!0):!1}class $5{constructor(){this._listeners={}}addEventListener(t,e){const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){const i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){const i=this._listeners[t];if(i!==void 0){const n=i.indexOf(e);n!==-1&&i.splice(n,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){const e=this._listeners[t.type];if(e!==void 0){t.target=this;const i=e.slice(0);for(let n=0,r=i.length;n<r;n++)i[n].call(this,t)}}}var fm;const H5="2.10.1",Qu=1/8,j5=/Mac/.test((fm=globalThis==null?void 0:globalThis.navigator)===null||fm===void 0?void 0:fm.platform);let Ft,py,Ku,mm,js,Ut,Xt,Oa,mh,wn,En,yo,fy,my,Ci,gh,Pa,gy,gm,_y,_m,bm,Ju,di=class Hg extends $5{static install(t){Ft=t.THREE,py=Object.freeze(new Ft.Vector3(0,0,0)),Ku=Object.freeze(new Ft.Vector3(0,1,0)),mm=Object.freeze(new Ft.Vector3(0,0,1)),js=new Ft.Vector2,Ut=new Ft.Vector3,Xt=new Ft.Vector3,Oa=new Ft.Vector3,mh=new Ft.Vector3,wn=new Ft.Vector3,En=new Ft.Vector3,yo=new Ft.Vector3,fy=new Ft.Vector3,my=new Ft.Vector3,Ci=new Ft.Spherical,gh=new Ft.Spherical,Pa=new Ft.Box3,gy=new Ft.Box3,gm=new Ft.Sphere,_y=new Ft.Quaternion,_m=new Ft.Quaternion,bm=new Ft.Matrix4,Ju=new Ft.Raycaster}static get ACTION(){return ot}set verticalDragToForward(t){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(t,e){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=ot.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Aa.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new Ft.Vector3,this._focalOffsetVelocity=new Ft.Vector3,this._zoomVelocity={value:0},this._truckInternal=(f,b,y,E)=>{let C,I;if(bo(this._camera)){const x=Ut.copy(this._camera.position).sub(this._target),A=this._camera.getEffectiveFOV()*dh,O=x.length()*Math.tan(A*.5);C=this.truckSpeed*f*O/this._elementRect.height,I=this.truckSpeed*b*O/this._elementRect.height}else if(Pr(this._camera)){const x=this._camera;C=this.truckSpeed*f*(x.right-x.left)/x.zoom/this._elementRect.width,I=this.truckSpeed*b*(x.top-x.bottom)/x.zoom/this._elementRect.height}else return;E?(y?this.setFocalOffset(this._focalOffsetEnd.x+C,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(C,0,!0),this.forward(-I,!0)):y?this.setFocalOffset(this._focalOffsetEnd.x+C,this._focalOffsetEnd.y+I,this._focalOffsetEnd.z,!0):this.truck(C,I,!0)},this._rotateInternal=(f,b)=>{const y=Sa*this.azimuthRotateSpeed*f/this._elementRect.height,E=Sa*this.polarRotateSpeed*b/this._elementRect.height;this.rotate(y,E,!0)},this._dollyInternal=(f,b,y)=>{const E=Math.pow(.95,-f*this.dollySpeed),C=this._sphericalEnd.radius,I=this._sphericalEnd.radius*E,x=Qi(I,this.minDistance,this.maxDistance),A=x-I;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(I,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(A,!0),this._dollyToNoClamp(x,!0)):this._dollyToNoClamp(x,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?I:x)-C,this._dollyControlCoord.set(b,y)),this._lastDollyDirection=Math.sign(-f)},this._zoomInternal=(f,b,y)=>{const E=Math.pow(.95,f*this.dollySpeed),C=this._zoom,I=this._zoom*E;this.zoomTo(I,!0),this.dollyToCursor&&(this._changedZoom+=I-C,this._dollyControlCoord.set(b,y))},typeof Ft>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new Ft.Quaternion().setFromUnitVectors(this._camera.up,Ku),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=ot.NONE,this._target=new Ft.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new Ft.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new Ft.Spherical().setFromVector3(Ut.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new Ft.Vector3,new Ft.Vector3,new Ft.Vector3,new Ft.Vector3],this._updateNearPlaneCorners(),this._boundary=new Ft.Box3(new Ft.Vector3(-1/0,-1/0,-1/0),new Ft.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new Ft.Vector2,this.mouseButtons={left:ot.ROTATE,middle:ot.DOLLY,right:ot.TRUCK,wheel:bo(this._camera)?ot.DOLLY:Pr(this._camera)?ot.ZOOM:ot.NONE},this.touches={one:ot.TOUCH_ROTATE,two:bo(this._camera)?ot.TOUCH_DOLLY_TRUCK:Pr(this._camera)?ot.TOUCH_ZOOM_TRUCK:ot.NONE,three:ot.TOUCH_TRUCK};const i=new Ft.Vector2,n=new Ft.Vector2,r=new Ft.Vector2,o=f=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const E=this._domElement.getBoundingClientRect(),C=f.clientX/E.width,I=f.clientY/E.height;if(C<this._interactiveArea.left||C>this._interactiveArea.right||I<this._interactiveArea.top||I>this._interactiveArea.bottom)return}const b=f.pointerType!=="mouse"?null:(f.buttons&Ae.LEFT)===Ae.LEFT?Ae.LEFT:(f.buttons&Ae.MIDDLE)===Ae.MIDDLE?Ae.MIDDLE:(f.buttons&Ae.RIGHT)===Ae.RIGHT?Ae.RIGHT:null;if(b!==null){const E=this._findPointerByMouseButton(b);E&&this._disposePointer(E)}if((f.buttons&Ae.LEFT)===Ae.LEFT&&this._lockedPointer)return;const y={pointerId:f.pointerId,clientX:f.clientX,clientY:f.clientY,deltaX:0,deltaY:0,mouseButton:b};this._activePointers.push(y),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,p(f)},a=f=>{f.cancelable&&f.preventDefault();const b=f.pointerId,y=this._lockedPointer||this._findPointerById(b);if(y){if(y.clientX=f.clientX,y.clientY=f.clientY,y.deltaX=f.movementX,y.deltaY=f.movementY,this._state=0,f.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(f.buttons&Ae.LEFT)===Ae.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(f.buttons&Ae.MIDDLE)===Ae.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(f.buttons&Ae.RIGHT)===Ae.RIGHT&&(this._state=this._state|this.mouseButtons.right);d()}},l=f=>{const b=this._findPointerById(f.pointerId);if(!(b&&b===this._lockedPointer)){if(b&&this._disposePointer(b),f.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=ot.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=ot.NONE;_()}};let h=-1;const c=f=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===ot.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const I=this._domElement.getBoundingClientRect(),x=f.clientX/I.width,A=f.clientY/I.height;if(x<this._interactiveArea.left||x>this._interactiveArea.right||A<this._interactiveArea.top||A>this._interactiveArea.bottom)return}if(f.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===ot.ROTATE||this.mouseButtons.wheel===ot.TRUCK){const I=performance.now();h-I<1e3&&this._getClientRect(this._elementRect),h=I}const b=j5?-1:-3,y=f.deltaMode===1||f.ctrlKey?f.deltaY/b:f.deltaY/(b*10),E=this.dollyToCursor?(f.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,C=this.dollyToCursor?(f.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case ot.ROTATE:{this._rotateInternal(f.deltaX,f.deltaY),this._isUserControllingRotate=!0;break}case ot.TRUCK:{this._truckInternal(f.deltaX,f.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case ot.SCREEN_PAN:{this._truckInternal(f.deltaX,f.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case ot.OFFSET:{this._truckInternal(f.deltaX,f.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case ot.DOLLY:{this._dollyInternal(-y,E,C),this._isUserControllingDolly=!0;break}case ot.ZOOM:{this._zoomInternal(-y,E,C),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},u=f=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Hg.ACTION.NONE){const b=f instanceof PointerEvent?f.pointerId:0,y=this._findPointerById(b);y&&this._disposePointer(y),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l);return}f.preventDefault()}},p=f=>{if(this._enabled){if(dm(this._activePointers,js),this._getClientRect(this._elementRect),i.copy(js),n.copy(js),this._activePointers.length>=2){const b=js.x-this._activePointers[1].clientX,y=js.y-this._activePointers[1].clientY,E=Math.sqrt(b*b+y*y);r.set(0,E);const C=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,I=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;n.set(C,I)}if(this._state=0,!f)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in f&&f.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(f.buttons&Ae.LEFT)===Ae.LEFT&&(this._state=this._state|this.mouseButtons.left),(f.buttons&Ae.MIDDLE)===Ae.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(f.buttons&Ae.RIGHT)===Ae.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&ot.ROTATE)===ot.ROTATE||(this._state&ot.TOUCH_ROTATE)===ot.TOUCH_ROTATE||(this._state&ot.TOUCH_DOLLY_ROTATE)===ot.TOUCH_DOLLY_ROTATE||(this._state&ot.TOUCH_ZOOM_ROTATE)===ot.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&ot.TRUCK)===ot.TRUCK||(this._state&ot.SCREEN_PAN)===ot.SCREEN_PAN||(this._state&ot.TOUCH_TRUCK)===ot.TOUCH_TRUCK||(this._state&ot.TOUCH_SCREEN_PAN)===ot.TOUCH_SCREEN_PAN||(this._state&ot.TOUCH_DOLLY_TRUCK)===ot.TOUCH_DOLLY_TRUCK||(this._state&ot.TOUCH_DOLLY_SCREEN_PAN)===ot.TOUCH_DOLLY_SCREEN_PAN||(this._state&ot.TOUCH_ZOOM_TRUCK)===ot.TOUCH_ZOOM_TRUCK||(this._state&ot.TOUCH_ZOOM_SCREEN_PAN)===ot.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&ot.DOLLY)===ot.DOLLY||(this._state&ot.TOUCH_DOLLY)===ot.TOUCH_DOLLY||(this._state&ot.TOUCH_DOLLY_TRUCK)===ot.TOUCH_DOLLY_TRUCK||(this._state&ot.TOUCH_DOLLY_SCREEN_PAN)===ot.TOUCH_DOLLY_SCREEN_PAN||(this._state&ot.TOUCH_DOLLY_OFFSET)===ot.TOUCH_DOLLY_OFFSET||(this._state&ot.TOUCH_DOLLY_ROTATE)===ot.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&ot.ZOOM)===ot.ZOOM||(this._state&ot.TOUCH_ZOOM)===ot.TOUCH_ZOOM||(this._state&ot.TOUCH_ZOOM_TRUCK)===ot.TOUCH_ZOOM_TRUCK||(this._state&ot.TOUCH_ZOOM_SCREEN_PAN)===ot.TOUCH_ZOOM_SCREEN_PAN||(this._state&ot.TOUCH_ZOOM_OFFSET)===ot.TOUCH_ZOOM_OFFSET||(this._state&ot.TOUCH_ZOOM_ROTATE)===ot.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&ot.OFFSET)===ot.OFFSET||(this._state&ot.TOUCH_OFFSET)===ot.TOUCH_OFFSET||(this._state&ot.TOUCH_DOLLY_OFFSET)===ot.TOUCH_DOLLY_OFFSET||(this._state&ot.TOUCH_ZOOM_OFFSET)===ot.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},d=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,dm(this._activePointers,js);const f=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,b=f?-f.deltaX:n.x-js.x,y=f?-f.deltaY:n.y-js.y;if(n.copy(js),((this._state&ot.ROTATE)===ot.ROTATE||(this._state&ot.TOUCH_ROTATE)===ot.TOUCH_ROTATE||(this._state&ot.TOUCH_DOLLY_ROTATE)===ot.TOUCH_DOLLY_ROTATE||(this._state&ot.TOUCH_ZOOM_ROTATE)===ot.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(b,y),this._isUserControllingRotate=!0),(this._state&ot.DOLLY)===ot.DOLLY||(this._state&ot.ZOOM)===ot.ZOOM){const E=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,C=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0,I=this.dollyDragInverted?-1:1;(this._state&ot.DOLLY)===ot.DOLLY?(this._dollyInternal(I*y*Qu,E,C),this._isUserControllingDolly=!0):(this._zoomInternal(I*y*Qu,E,C),this._isUserControllingZoom=!0)}if((this._state&ot.TOUCH_DOLLY)===ot.TOUCH_DOLLY||(this._state&ot.TOUCH_ZOOM)===ot.TOUCH_ZOOM||(this._state&ot.TOUCH_DOLLY_TRUCK)===ot.TOUCH_DOLLY_TRUCK||(this._state&ot.TOUCH_ZOOM_TRUCK)===ot.TOUCH_ZOOM_TRUCK||(this._state&ot.TOUCH_DOLLY_SCREEN_PAN)===ot.TOUCH_DOLLY_SCREEN_PAN||(this._state&ot.TOUCH_ZOOM_SCREEN_PAN)===ot.TOUCH_ZOOM_SCREEN_PAN||(this._state&ot.TOUCH_DOLLY_OFFSET)===ot.TOUCH_DOLLY_OFFSET||(this._state&ot.TOUCH_ZOOM_OFFSET)===ot.TOUCH_ZOOM_OFFSET||(this._state&ot.TOUCH_DOLLY_ROTATE)===ot.TOUCH_DOLLY_ROTATE||(this._state&ot.TOUCH_ZOOM_ROTATE)===ot.TOUCH_ZOOM_ROTATE){const E=js.x-this._activePointers[1].clientX,C=js.y-this._activePointers[1].clientY,I=Math.sqrt(E*E+C*C),x=r.y-I;r.set(0,I);const A=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,O=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&ot.TOUCH_DOLLY)===ot.TOUCH_DOLLY||(this._state&ot.TOUCH_DOLLY_ROTATE)===ot.TOUCH_DOLLY_ROTATE||(this._state&ot.TOUCH_DOLLY_TRUCK)===ot.TOUCH_DOLLY_TRUCK||(this._state&ot.TOUCH_DOLLY_SCREEN_PAN)===ot.TOUCH_DOLLY_SCREEN_PAN||(this._state&ot.TOUCH_DOLLY_OFFSET)===ot.TOUCH_DOLLY_OFFSET?(this._dollyInternal(x*Qu,A,O),this._isUserControllingDolly=!0):(this._zoomInternal(x*Qu,A,O),this._isUserControllingZoom=!0)}((this._state&ot.TRUCK)===ot.TRUCK||(this._state&ot.TOUCH_TRUCK)===ot.TOUCH_TRUCK||(this._state&ot.TOUCH_DOLLY_TRUCK)===ot.TOUCH_DOLLY_TRUCK||(this._state&ot.TOUCH_ZOOM_TRUCK)===ot.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(b,y,!1,!1),this._isUserControllingTruck=!0),((this._state&ot.SCREEN_PAN)===ot.SCREEN_PAN||(this._state&ot.TOUCH_SCREEN_PAN)===ot.TOUCH_SCREEN_PAN||(this._state&ot.TOUCH_DOLLY_SCREEN_PAN)===ot.TOUCH_DOLLY_SCREEN_PAN||(this._state&ot.TOUCH_ZOOM_SCREEN_PAN)===ot.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(b,y,!1,!0),this._isUserControllingTruck=!0),((this._state&ot.OFFSET)===ot.OFFSET||(this._state&ot.TOUCH_OFFSET)===ot.TOUCH_OFFSET||(this._state&ot.TOUCH_DOLLY_OFFSET)===ot.TOUCH_DOLLY_OFFSET||(this._state&ot.TOUCH_ZOOM_OFFSET)===ot.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(b,y,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},_=()=>{dm(this._activePointers,js),n.copy(js),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",m),this._domElement.ownerDocument.addEventListener("pointerlockerror",g),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),p())},this.unlockPointer=()=>{var f,b,y;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(f=this._domElement)===null||f===void 0||f.ownerDocument.exitPointerLock(),(b=this._domElement)===null||b===void 0||b.ownerDocument.removeEventListener("pointerlockchange",m),(y=this._domElement)===null||y===void 0||y.ownerDocument.removeEventListener("pointerlockerror",g),this.cancel()};const m=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},g=()=>{this.unlockPointer()};this._addAllEventListeners=f=>{this._domElement=f,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",c,{passive:!1}),this._domElement.addEventListener("contextmenu",u)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",c,{passive:!1}),this._domElement.removeEventListener("contextmenu",u),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",m),this._domElement.ownerDocument.removeEventListener("pointerlockerror",g))},this.cancel=()=>{this._state!==ot.NONE&&(this._state=ot.NONE,this._activePointers.length=0,_())},e&&this.connect(e),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=Qi(t.width,0,1),this._interactiveArea.height=Qi(t.height,0,1),this._interactiveArea.x=Qi(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Qi(t.y,0,1-this._interactiveArea.height)}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,i=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,i=!1){this._isUserControllingRotate=!1;const n=Qi(t,this.minAzimuthAngle,this.maxAzimuthAngle),r=Qi(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=n,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!i||ee(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ee(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Aa.NONE,this._changedDolly=0,this._dollyToNoClamp(Qi(t,this.minDistance,this.maxDistance),e)}_dollyToNoClamp(t,e=!1){const i=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const r=this._collisionTest(),o=ee(r,this._spherical.radius);if(!(i>t)&&o)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,r)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);const n=!e||ee(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(n)}dollyInFixed(t,e=!1){this._targetEnd.add(this._getCameraDirection(mh).multiplyScalar(t)),e||this._target.copy(this._targetEnd);const i=!e||ee(this._target.x,this._targetEnd.x,this.restThreshold)&&ee(this._target.y,this._targetEnd.y,this.restThreshold)&&ee(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._isUserControllingZoom=!1,this._zoomEnd=Qi(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);const i=!e||ee(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(i)}pan(t,e,i=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,i)}truck(t,e,i=!1){this._camera.updateMatrix(),wn.setFromMatrixColumn(this._camera.matrix,0),En.setFromMatrixColumn(this._camera.matrix,1),wn.multiplyScalar(t),En.multiplyScalar(-e);const n=Ut.copy(wn).add(En),r=Xt.copy(this._targetEnd).add(n);return this.moveTo(r.x,r.y,r.z,i)}forward(t,e=!1){Ut.setFromMatrixColumn(this._camera.matrix,0),Ut.crossVectors(this._camera.up,Ut),Ut.multiplyScalar(t);const i=Xt.copy(this._targetEnd).add(Ut);return this.moveTo(i.x,i.y,i.z,e)}elevate(t,e=!1){return Ut.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+Ut.x,this._targetEnd.y+Ut.y,this._targetEnd.z+Ut.z,e)}moveTo(t,e,i,n=!1){this._isUserControllingTruck=!1;const r=Ut.set(t,e,i).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,n||this._target.copy(this._targetEnd);const o=!n||ee(this._target.x,this._targetEnd.x,this.restThreshold)&&ee(this._target.y,this._targetEnd.y,this.restThreshold)&&ee(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(t,e,i,n=!1){const r=Ut.set(t,e,i).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(r.x,r.y,r.z,n)}fitToBox(t,e,{cover:i=!1,paddingLeft:n=0,paddingRight:r=0,paddingBottom:o=0,paddingTop:a=0}={}){const l=[],h=t.isBox3?Pa.copy(t):Pa.setFromObject(t);h.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const c=uy(this._sphericalEnd.theta,cy),u=uy(this._sphericalEnd.phi,cy);l.push(this.rotateTo(c,u,e));const p=Ut.setFromSpherical(this._sphericalEnd).normalize(),d=_y.setFromUnitVectors(p,mm),_=ee(Math.abs(p.y),1);_&&d.multiply(_m.setFromAxisAngle(Ku,c)),d.multiply(this._yAxisUpSpaceInverse);const m=gy.makeEmpty();Xt.copy(h.min).applyQuaternion(d),m.expandByPoint(Xt),Xt.copy(h.min).setX(h.max.x).applyQuaternion(d),m.expandByPoint(Xt),Xt.copy(h.min).setY(h.max.y).applyQuaternion(d),m.expandByPoint(Xt),Xt.copy(h.max).setZ(h.min.z).applyQuaternion(d),m.expandByPoint(Xt),Xt.copy(h.min).setZ(h.max.z).applyQuaternion(d),m.expandByPoint(Xt),Xt.copy(h.max).setY(h.min.y).applyQuaternion(d),m.expandByPoint(Xt),Xt.copy(h.max).setX(h.min.x).applyQuaternion(d),m.expandByPoint(Xt),Xt.copy(h.max).applyQuaternion(d),m.expandByPoint(Xt),m.min.x-=n,m.min.y-=o,m.max.x+=r,m.max.y+=a,d.setFromUnitVectors(mm,p),_&&d.premultiply(_m.invert()),d.premultiply(this._yAxisUpSpace);const g=m.getSize(Ut),f=m.getCenter(Xt).applyQuaternion(d);if(bo(this._camera)){const b=this.getDistanceToFitBox(g.x,g.y,g.z,i);l.push(this.moveTo(f.x,f.y,f.z,e)),l.push(this.dollyTo(b,e)),l.push(this.setFocalOffset(0,0,0,e))}else if(Pr(this._camera)){const b=this._camera,y=b.right-b.left,E=b.top-b.bottom,C=i?Math.max(y/g.x,E/g.y):Math.min(y/g.x,E/g.y);l.push(this.moveTo(f.x,f.y,f.z,e)),l.push(this.zoomTo(C,e)),l.push(this.setFocalOffset(0,0,0,e))}return Promise.all(l)}fitToSphere(t,e){const i=[],n="isObject3D"in t?Hg.createBoundingSphere(t,gm):gm.copy(t);if(i.push(this.moveTo(n.center.x,n.center.y,n.center.z,e)),bo(this._camera)){const r=this.getDistanceToFitSphere(n.radius);i.push(this.dollyTo(r,e))}else if(Pr(this._camera)){const r=this._camera.right-this._camera.left,o=this._camera.top-this._camera.bottom,a=2*n.radius,l=Math.min(r/a,o/a);i.push(this.zoomTo(l,e))}return i.push(this.setFocalOffset(0,0,0,e)),Promise.all(i)}setLookAt(t,e,i,n,r,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Aa.NONE,this._changedDolly=0;const l=Xt.set(n,r,o),h=Ut.set(t,e,i);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(h.sub(l).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const c=!a||ee(this._target.x,this._targetEnd.x,this.restThreshold)&&ee(this._target.y,this._targetEnd.y,this.restThreshold)&&ee(this._target.z,this._targetEnd.z,this.restThreshold)&&ee(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ee(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&ee(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}lerpLookAt(t,e,i,n,r,o,a,l,h,c,u,p,d,_=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Aa.NONE,this._changedDolly=0;const m=Ut.set(n,r,o),g=Xt.set(t,e,i);Ci.setFromVector3(g.sub(m).applyQuaternion(this._yAxisUpSpace));const f=Oa.set(c,u,p),b=Xt.set(a,l,h);gh.setFromVector3(b.sub(f).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(m.lerp(f,d));const y=gh.theta-Ci.theta,E=gh.phi-Ci.phi,C=gh.radius-Ci.radius;this._sphericalEnd.set(Ci.radius+C*d,Ci.phi+E*d,Ci.theta+y*d),this.normalizeRotations(),this._needsUpdate=!0,_||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const I=!_||ee(this._target.x,this._targetEnd.x,this.restThreshold)&&ee(this._target.y,this._targetEnd.y,this.restThreshold)&&ee(this._target.z,this._targetEnd.z,this.restThreshold)&&ee(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ee(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&ee(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(I)}setPosition(t,e,i,n=!1){return this.setLookAt(t,e,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,n)}setTarget(t,e,i,n=!1){const r=this.getPosition(Ut),o=this.setLookAt(r.x,r.y,r.z,t,e,i,n);return this._sphericalEnd.phi=Qi(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(t,e,i,n=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,e,i),this._needsUpdate=!0,n||this._focalOffset.copy(this._focalOffsetEnd);const r=!n||ee(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&ee(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&ee(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(t,e,i){this._camera.updateMatrixWorld(),wn.setFromMatrixColumn(this._camera.matrixWorldInverse,0),En.setFromMatrixColumn(this._camera.matrixWorldInverse,1),yo.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const n=Ut.set(t,e,i),r=n.distanceTo(this._camera.position),o=n.sub(this._camera.position);wn.multiplyScalar(o.x),En.multiplyScalar(o.y),yo.multiplyScalar(o.z),Ut.copy(wn).add(En).add(yo),Ut.z=Ut.z+r,this.dollyTo(r,!1),this.setFocalOffset(-Ut.x,Ut.y,-Ut.z,!1),this.moveTo(t,e,i,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,i,n){if(t===null){this._viewport=null;return}this._viewport=this._viewport||new Ft.Vector4,typeof t=="number"?this._viewport.set(t,e,i,n):this._viewport.copy(t)}getDistanceToFitBox(t,e,i,n=!1){if(pm(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const r=t/e,o=this._camera.getEffectiveFOV()*dh,a=this._camera.aspect;return((n?r>a:r<a)?e:t/a)*.5/Math.tan(o*.5)+i*.5}getDistanceToFitSphere(t){if(pm(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const e=this._camera.getEffectiveFOV()*dh,i=Math.atan(Math.tan(e*.5)*this._camera.aspect)*2,n=1<this._camera.aspect?e:i;return t/Math.sin(n*.5)}getTarget(t,e=!0){return(t&&t.isVector3?t:new Ft.Vector3).copy(e?this._targetEnd:this._target)}getPosition(t,e=!0){return(t&&t.isVector3?t:new Ft.Vector3).setFromSpherical(e?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(e?this._targetEnd:this._target)}getSpherical(t,e=!0){return(t||new Ft.Spherical).copy(e?this._sphericalEnd:this._spherical)}getFocalOffset(t,e=!0){return(t&&t.isVector3?t:new Ft.Vector3).copy(e?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Sa,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Sa),this._spherical.theta+=Sa*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Sa)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(t=!1){if(!ee(this._camera.up.x,this._cameraUp0.x)||!ee(this._camera.up.y,this._cameraUp0.y)||!ee(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const i=this.getPosition(Ut);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}const e=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(e)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Ku),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const t=Ut.subVectors(this._target,this._camera.position).normalize(),e=Xt.crossVectors(t,this._camera.up);this._camera.up.crossVectors(e,t).normalize(),this._camera.updateMatrixWorld();const i=this.getPosition(Ut);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}update(t){const e=this._sphericalEnd.theta-this._spherical.theta,i=this._sphericalEnd.phi-this._spherical.phi,n=this._sphericalEnd.radius-this._spherical.radius,r=fy.subVectors(this._targetEnd,this._target),o=my.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(de(e))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const c=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Xu(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,c,1/0,t),this._needsUpdate=!0}if(de(i))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const c=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Xu(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,c,1/0,t),this._needsUpdate=!0}if(de(n))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const c=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Xu(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,c,this.maxSpeed,t),this._needsUpdate=!0}if(de(r.x)&&de(r.y)&&de(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const c=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;dy(this._target,this._targetEnd,this._targetVelocity,c,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(de(o.x)&&de(o.y)&&de(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const c=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;dy(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,c,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(de(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const c=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Xu(this._zoom,this._zoomEnd,this._zoomVelocity,c,1/0,t)}if(this.dollyToCursor){if(bo(this._camera)&&this._changedDolly!==0){const c=this._spherical.radius-this._lastDistance,u=this._camera,p=this._getCameraDirection(mh),d=Ut.copy(p).cross(u.up).normalize();d.lengthSq()===0&&(d.x=1);const _=Xt.crossVectors(d,p),m=this._sphericalEnd.radius*Math.tan(u.getEffectiveFOV()*dh*.5),g=(this._sphericalEnd.radius-c-this._sphericalEnd.radius)/this._sphericalEnd.radius,f=Oa.copy(this._targetEnd).add(d.multiplyScalar(this._dollyControlCoord.x*m*u.aspect)).add(_.multiplyScalar(this._dollyControlCoord.y*m)),b=Ut.copy(this._targetEnd).lerp(f,g),y=this._lastDollyDirection===Aa.IN&&this._spherical.radius<=this.minDistance,E=this._lastDollyDirection===Aa.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(y||E)){this._sphericalEnd.radius-=c,this._spherical.radius-=c;const I=Xt.copy(p).multiplyScalar(-c);b.add(I)}this._boundary.clampPoint(b,b);const C=Xt.subVectors(b,this._targetEnd);this._targetEnd.copy(b),this._target.add(C),this._changedDolly-=c,de(this._changedDolly)&&(this._changedDolly=0)}else if(Pr(this._camera)&&this._changedZoom!==0){const c=this._zoom-this._lastZoom,u=this._camera,p=Ut.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(u.near+u.far)/(u.near-u.far)).unproject(u),d=Xt.set(0,0,-1).applyQuaternion(u.quaternion),_=Oa.copy(p).add(d.multiplyScalar(-p.dot(u.up))),m=-(this._zoom-c-this._zoom)/this._zoom,g=this._getCameraDirection(mh),f=this._targetEnd.dot(g),b=Ut.copy(this._targetEnd).lerp(_,m),y=b.dot(g),E=g.multiplyScalar(y-f);b.sub(E),this._boundary.clampPoint(b,b);const C=Xt.subVectors(b,this._targetEnd);this._targetEnd.copy(b),this._target.add(C),this._changedZoom-=c,de(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!de(this._focalOffset.x)||!de(this._focalOffset.y)||!de(this._focalOffset.z))&&(wn.setFromMatrixColumn(this._camera.matrix,0),En.setFromMatrixColumn(this._camera.matrix,1),yo.setFromMatrixColumn(this._camera.matrix,2),wn.multiplyScalar(this._focalOffset.x),En.multiplyScalar(-this._focalOffset.y),yo.multiplyScalar(this._focalOffset.z),Ut.copy(wn).add(En).add(yo),this._camera.position.add(Ut),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),Ut.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const h=this._needsUpdate;return h&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):h?(this.dispatchEvent({type:"update"}),de(e,this.restThreshold)&&de(i,this.restThreshold)&&de(n,this.restThreshold)&&de(r.x,this.restThreshold)&&de(r.y,this.restThreshold)&&de(r.z,this.restThreshold)&&de(o.x,this.restThreshold)&&de(o.y,this.restThreshold)&&de(o.z,this.restThreshold)&&de(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!h&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=h,this._needsUpdate=!1,h}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:ph(this.maxDistance),minZoom:this.minZoom,maxZoom:ph(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:ph(this.maxPolarAngle),minAzimuthAngle:ph(this.minAzimuthAngle),maxAzimuthAngle:ph(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:Ut.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){const i=JSON.parse(t);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=fh(i.maxDistance),this.minZoom=i.minZoom,this.maxZoom=fh(i.maxZoom),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=fh(i.maxPolarAngle),this.minAzimuthAngle=fh(i.minAzimuthAngle),this.maxAzimuthAngle=fh(i.maxAzimuthAngle),this.smoothTime=i.smoothTime,this.draggingSmoothTime=i.draggingSmoothTime,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._zoom0=i.zoom0,this._focalOffset0.fromArray(i.focalOffset0),this.moveTo(i.target[0],i.target[1],i.target[2],e),Ci.setFromVector3(Ut.fromArray(i.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Ci.theta,Ci.phi,e),this.dollyTo(Ci.radius,e),this.zoomTo(i.zoom,e),this.setFocalOffset(i.focalOffset[0],i.focalOffset[1],i.focalOffset[2],e),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version",H5),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(e=>e.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(e=>e.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,e,i){const n=e.lengthSq();if(n===0)return t;const r=Xt.copy(e).add(t),o=this._boundary.clampPoint(r,Oa).sub(r),a=o.lengthSq();if(a===0)return t.add(e);if(a===n)return t;if(i===0)return t.add(e).add(o);{const l=1+i*a/e.dot(o);return t.add(Xt.copy(e).multiplyScalar(l)).add(o.multiplyScalar(1-i))}}_updateNearPlaneCorners(){if(bo(this._camera)){const t=this._camera,e=t.near,i=t.getEffectiveFOV()*dh,n=Math.tan(i*.5)*e,r=n*t.aspect;this._nearPlaneCorners[0].set(-r,-n,0),this._nearPlaneCorners[1].set(r,-n,0),this._nearPlaneCorners[2].set(r,n,0),this._nearPlaneCorners[3].set(-r,n,0)}else if(Pr(this._camera)){const t=this._camera,e=1/t.zoom,i=t.left*e,n=t.right*e,r=t.top*e,o=t.bottom*e;this._nearPlaneCorners[0].set(i,r,0),this._nearPlaneCorners[1].set(n,r,0),this._nearPlaneCorners[2].set(n,o,0),this._nearPlaneCorners[3].set(i,o,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||pm(this._camera,"_collisionTest"))return t;const e=this._getTargetDirection(mh);bm.lookAt(py,e,this._camera.up);for(let i=0;i<4;i++){const n=Xt.copy(this._nearPlaneCorners[i]);n.applyMatrix4(bm);const r=Oa.addVectors(this._target,n);Ju.set(r,e),Ju.far=this._spherical.radius+1;const o=Ju.intersectObjects(this.colliderMeshes);o.length!==0&&o[0].distance<t&&(t=o[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;const e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{const i=()=>{this.removeEventListener("rest",i),e()};this.addEventListener("rest",i)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,e=new Ft.Sphere){const i=e,n=i.center;Pa.makeEmpty(),t.traverseVisible(o=>{o.isMesh&&Pa.expandByObject(o)}),Pa.getCenter(n);let r=0;return t.traverseVisible(o=>{if(!o.isMesh)return;const a=o;if(!a.geometry)return;const l=a.geometry.clone();l.applyMatrix4(a.matrixWorld);const h=l.attributes.position;for(let c=0,u=h.count;c<u;c++)Ut.fromBufferAttribute(h,c),r=Math.max(r,n.distanceToSquared(Ut))}),i.radius=Math.sqrt(r),i}},jg=class UE extends mL{constructor(t){super(t),k(this,"onBeforeUpdate",new ft),k(this,"onAfterUpdate",new ft),k(this,"onAspectUpdated",new ft),k(this,"onDisposed",new ft),k(this,"three"),k(this,"_allControls",new Map),k(this,"updateAspect",()=>{var e;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof aa){this.onAspectUpdated.trigger();return}if((e=this.currentWorld.renderer)!=null&&e.isResizeable()){const i=this.currentWorld.renderer.getSize();this.three.aspect=i.width/i.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.worlds.onItemSet.add(({value:e})=>{const i=this.newCameraControls();this._allControls.set(e.uuid,i)}),this.worlds.onBeforeDelete.add(({value:e})=>{const i=this._allControls.get(e.uuid);i&&(i.dispose(),this._allControls.delete(e.uuid))})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const t=this._allControls.get(this.currentWorld.uuid);if(!t)throw new Error("Controls not found!");return t}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(t){this.currentWorld!==null&&(this.controls.enabled=t)}set currentWorld(t){super.currentWorld=t,t&&(this.worlds.get(t.uuid)||this.worlds.set(t.uuid,t))}get currentWorld(){return this._currentWorld}dispose(){this.setupEvents(!1),this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[t,e]of this._allControls)e.dispose();this.worlds.clear()}async fitToItems(t){const e=await this.getItemsBounding(t);await this.controls.fitToSphere(e,!0)}async setOrbitToItems(t){const e=await this.getItemsBounding(t);this.controls.setOrbitPoint(e.center.x,e.center.y,e.center.z)}update(t){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(t),this.onAfterUpdate.trigger(this))}async getItemsBounding(t){const e=this.components.get(Lt),i=this.components.get(FE);i.list.clear();const n=new ws;if(t)await i.addFromModelIdMap(t);else for(const[,r]of e.list)i.list.add(r.box);return i.get().getBoundingSphere(n),i.list.clear(),n}setupCamera(){const t=window.innerWidth/window.innerHeight,e=new Hc(60,t,1,1e3);return e.position.set(50,50,50),e.lookAt(new F(0,0,0)),e}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");di.install({THREE:UE.getSubsetOfThree()});const{domElement:t}=this.currentWorld.renderer.three,e=new di(this.three,t);return e.smoothTime=.2,e.dollyToCursor=!0,e.infinityDolly=!0,e.minDistance=6,e}setupEvents(t){t?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:Ew,Vector2:Bt,Vector3:F,Vector4:$i,Quaternion:Ie,Matrix4:vt,Spherical:ww,Box3:Tt,Sphere:ws,Raycaster:oa,MathUtils:Vc}}};const BE=class VE extends he{constructor(t){super(t),k(this,"onAfterUpdate",new ft),k(this,"onBeforeUpdate",new ft),k(this,"onDisposed",new ft),k(this,"list",new wl),k(this,"enabled",!0),t.add(VE.uuid,this)}create(){const t=new B5(this.components),e=t.uuid;if(this.list.has(e))throw new Error("There is already a world with this name!");return this.list.set(e,t),t}delete(t){if(!this.list.has(t.uuid))throw new Error("The provided world is not found in the list!");this.list.delete(t.uuid),t.dispose()}dispose(){this.enabled=!1;for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}update(t){if(this.enabled)for(const[e,i]of this.list)i.update(t)}};k(BE,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let $E=BE;class Y5 extends Kp{constructor(){super(...arguments),k(this,"_config",{visible:{value:!0,type:"Boolean"},color:{value:new xt,type:"Color"},primarySize:{type:"Number",interpolable:!0,value:1,min:0,max:1e3},secondarySize:{type:"Number",interpolable:!0,value:10,min:0,max:1e3},distance:{type:"Number",interpolable:!0,value:500,min:0,max:500}})}get visible(){return this._config.visible.value}set visible(t){this._config.visible.value=t,this._component.visible=t}get color(){return this._config.color.value}set color(t){this._config.color.value=t,this._component.material.uniforms.uColor.value=t,this._component.material.uniformsNeedUpdate=!0}get primarySize(){return this._config.primarySize.value}set primarySize(t){this._config.primarySize.value=t,this._component.material.uniforms.uSize1.value=t,this._component.material.uniformsNeedUpdate=!0}get secondarySize(){return this._config.secondarySize.value}set secondarySize(t){this._config.secondarySize.value=t,this._component.material.uniforms.uSize2.value=t,this._component.material.uniformsNeedUpdate=!0}get distance(){return this._config.distance.value}set distance(t){this._config.distance.value=t,this._component.material.uniforms.uDistance.value=t,this._component.material.uniformsNeedUpdate=!0}}class W5{constructor(t,e){k(this,"onDisposed",new ft),k(this,"onSetup",new ft),k(this,"isSetup",!1),k(this,"world"),k(this,"components"),k(this,"config"),k(this,"_defaultConfig",{visible:!0,color:new xt(12303291),primarySize:1,secondarySize:10,distance:500}),k(this,"three"),k(this,"_fade",3),k(this,"updateZoom",()=>{this.world.camera instanceof jg&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=e;const{color:i,primarySize:n,secondarySize:r,distance:o}=this._defaultConfig;this.components=t,this.config=new Y5(this,this.components,"Grid");const a=new Rl(2,2,1,1),l=new $c({side:Wn,uniforms:{uSize1:{value:n},uSize2:{value:r},uColor:{value:i},uDistance:{value:o},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new lt(a,l),this.three.frustumCulled=!1,e.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(t){this.three.visible=t,t?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(t){this._fade=t?3:0,this.material.uniforms.uFade.value=this._fade}setup(t){const e={...this._defaultConfig,...t};this.config.visible=!0,this.config.color=e.color,this.config.primarySize=e.primarySize,this.config.secondarySize=e.secondarySize,this.config.distance=e.distance,this.isSetup=!0,this.onSetup.trigger()}dispose(){this.setupEvents(!1),this.components.get(Z_).list.delete(this.config.uuid),this.components.get(dr).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(t){if(this.world.isDisposing||!(this.world.camera instanceof jg))return;const e=this.world.camera.controls;t?e.addEventListener("update",this.updateZoom):e.removeEventListener("update",this.updateZoom)}}const G5=class HE extends he{constructor(t){super(t),k(this,"list",new Map),k(this,"onDisposed",new ft),k(this,"enabled",!0),t.add(HE.uuid,this)}create(t){if(this.list.has(t.uuid))throw new Error("This world already has a grid!");const e=new W5(this.components,t);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}};k(G5,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");const jE=0,q5=1,Z5=2,by=2,ym=1.25,yy=1,Yd=6*4+4+4,Jp=65535,X5=Math.pow(2,-24),vm=Symbol("SKIP_GENERATION");function Q5(s){return s.index?s.index.count:s.attributes.position.count}function Dl(s){return Q5(s)/3}function K5(s,t=ArrayBuffer){return s>65535?new Uint32Array(new t(4*s)):new Uint16Array(new t(2*s))}function J5(s,t){if(!s.index){const e=s.attributes.position.count,i=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=K5(e,i);s.setIndex(new Ve(n,1));for(let r=0;r<e;r++)n[r]=r}}function YE(s){const t=Dl(s),e=s.drawRange,i=e.start/3,n=(e.start+e.count)/3,r=Math.max(0,i),o=Math.min(t,n)-r;return[{offset:Math.floor(r),count:Math.floor(o)}]}function WE(s){if(!s.groups||!s.groups.length)return YE(s);const t=[],e=new Set,i=s.drawRange,n=i.start/3,r=(i.start+i.count)/3;for(const a of s.groups){const l=a.start/3,h=(a.start+a.count)/3;e.add(Math.max(n,l)),e.add(Math.min(r,h))}const o=Array.from(e.values()).sort((a,l)=>a-l);for(let a=0;a<o.length-1;a++){const l=o[a],h=o[a+1];t.push({offset:Math.floor(l),count:Math.floor(h-l)})}return t}function tN(s){if(s.groups.length===0)return!1;const t=Dl(s),e=WE(s).sort((r,o)=>r.offset-o.offset),i=e[e.length-1];i.count=Math.min(t-i.offset,i.count);let n=0;return e.forEach(({count:r})=>n+=r),t!==n}function Oe(s,t,e){return e.min.x=t[s],e.min.y=t[s+1],e.min.z=t[s+2],e.max.x=t[s+3],e.max.y=t[s+4],e.max.z=t[s+5],e}function eN(s){s[0]=s[1]=s[2]=1/0,s[3]=s[4]=s[5]=-1/0}function vy(s){let t=-1,e=-1/0;for(let i=0;i<3;i++){const n=s[i+3]-s[i];n>e&&(e=n,t=i)}return t}function wy(s,t){t.set(s)}function Ey(s,t,e){let i,n;for(let r=0;r<3;r++){const o=r+3;i=s[r],n=t[r],e[r]=i<n?i:n,i=s[o],n=t[o],e[o]=i>n?i:n}}function td(s,t,e){for(let i=0;i<3;i++){const n=t[s+2*i],r=t[s+2*i+1],o=n-r,a=n+r;o<e[i]&&(e[i]=o),a>e[i+3]&&(e[i+3]=a)}}function _h(s){const t=s[3]-s[0],e=s[4]-s[1],i=s[5]-s[2];return 2*(t*e+e*i+i*t)}function wm(s,t,e,i,n=null){let r=1/0,o=1/0,a=1/0,l=-1/0,h=-1/0,c=-1/0,u=1/0,p=1/0,d=1/0,_=-1/0,m=-1/0,g=-1/0;const f=n!==null;for(let b=t*6,y=(t+e)*6;b<y;b+=6){const E=s[b+0],C=s[b+1],I=E-C,x=E+C;I<r&&(r=I),x>l&&(l=x),f&&E<u&&(u=E),f&&E>_&&(_=E);const A=s[b+2],O=s[b+3],L=A-O,V=A+O;L<o&&(o=L),V>h&&(h=V),f&&A<p&&(p=A),f&&A>m&&(m=A);const T=s[b+4],N=s[b+5],v=T-N,M=T+N;v<a&&(a=v),M>c&&(c=M),f&&T<d&&(d=T),f&&T>g&&(g=T)}i[0]=r,i[1]=o,i[2]=a,i[3]=l,i[4]=h,i[5]=c,f&&(n[0]=u,n[1]=p,n[2]=d,n[3]=_,n[4]=m,n[5]=g)}function sN(s,t,e,i){let n=1/0,r=1/0,o=1/0,a=-1/0,l=-1/0,h=-1/0;for(let c=t*6,u=(t+e)*6;c<u;c+=6){const p=s[c+0];p<n&&(n=p),p>a&&(a=p);const d=s[c+2];d<r&&(r=d),d>l&&(l=d);const _=s[c+4];_<o&&(o=_),_>h&&(h=_)}i[0]=n,i[1]=r,i[2]=o,i[3]=a,i[4]=l,i[5]=h}function iN(s,t){eN(t);const e=s.attributes.position,i=s.index?s.index.array:null,n=Dl(s),r=new Float32Array(n*6),o=e.normalized,a=e.array,l=e.offset||0;let h=3;e.isInterleavedBufferAttribute&&(h=e.data.stride);const c=["getX","getY","getZ"];for(let u=0;u<n;u++){const p=u*3,d=u*6;let _=p+0,m=p+1,g=p+2;i&&(_=i[_],m=i[m],g=i[g]),o||(_=_*h+l,m=m*h+l,g=g*h+l);for(let f=0;f<3;f++){let b,y,E;o?(b=e[c[f]](_),y=e[c[f]](m),E=e[c[f]](g)):(b=a[_+f],y=a[m+f],E=a[g+f]);let C=b;y<C&&(C=y),E<C&&(C=E);let I=b;y>I&&(I=y),E>I&&(I=E);const x=(I-C)/2,A=f*2;r[d+A+0]=C+x,r[d+A+1]=x+(Math.abs(C)+x)*X5,C<t[f]&&(t[f]=C),I>t[f+3]&&(t[f+3]=I)}}return r}const tr=32,nN=(s,t)=>s.candidate-t.candidate,Cr=new Array(tr).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),ed=new Float32Array(6);function rN(s,t,e,i,n,r){let o=-1,a=0;if(r===jE)o=vy(t),o!==-1&&(a=(t[o]+t[o+3])/2);else if(r===q5)o=vy(s),o!==-1&&(a=oN(e,i,n,o));else if(r===Z5){const l=_h(s);let h=ym*n;const c=i*6,u=(i+n)*6;for(let p=0;p<3;p++){const d=t[p],_=(t[p+3]-d)/tr;if(n<tr/4){const m=[...Cr];m.length=n;let g=0;for(let b=c;b<u;b+=6,g++){const y=m[g];y.candidate=e[b+2*p],y.count=0;const{bounds:E,leftCacheBounds:C,rightCacheBounds:I}=y;for(let x=0;x<3;x++)I[x]=1/0,I[x+3]=-1/0,C[x]=1/0,C[x+3]=-1/0,E[x]=1/0,E[x+3]=-1/0;td(b,e,E)}m.sort(nN);let f=n;for(let b=0;b<f;b++){const y=m[b];for(;b+1<f&&m[b+1].candidate===y.candidate;)m.splice(b+1,1),f--}for(let b=c;b<u;b+=6){const y=e[b+2*p];for(let E=0;E<f;E++){const C=m[E];y>=C.candidate?td(b,e,C.rightCacheBounds):(td(b,e,C.leftCacheBounds),C.count++)}}for(let b=0;b<f;b++){const y=m[b],E=y.count,C=n-y.count,I=y.leftCacheBounds,x=y.rightCacheBounds;let A=0;E!==0&&(A=_h(I)/l);let O=0;C!==0&&(O=_h(x)/l);const L=yy+ym*(A*E+O*C);L<h&&(o=p,h=L,a=y.candidate)}}else{for(let f=0;f<tr;f++){const b=Cr[f];b.count=0,b.candidate=d+_+f*_;const y=b.bounds;for(let E=0;E<3;E++)y[E]=1/0,y[E+3]=-1/0}for(let f=c;f<u;f+=6){let b=~~((e[f+2*p]-d)/_);b>=tr&&(b=tr-1);const y=Cr[b];y.count++,td(f,e,y.bounds)}const m=Cr[tr-1];wy(m.bounds,m.rightCacheBounds);for(let f=tr-2;f>=0;f--){const b=Cr[f],y=Cr[f+1];Ey(b.bounds,y.rightCacheBounds,b.rightCacheBounds)}let g=0;for(let f=0;f<tr-1;f++){const b=Cr[f],y=b.count,E=b.bounds,C=Cr[f+1].rightCacheBounds;y!==0&&(g===0?wy(E,ed):Ey(E,ed,ed)),g+=y;let I=0,x=0;g!==0&&(I=_h(ed)/l);const A=n-g;A!==0&&(x=_h(C)/l);const O=yy+ym*(I*g+x*A);O<h&&(o=p,h=O,a=b.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:o,pos:a}}function oN(s,t,e,i){let n=0;for(let r=t,o=t+e;r<o;r++)n+=s[r*6+i*2];return n/e}let sd=class{constructor(){}};function aN(s,t,e,i,n,r){let o=i,a=i+n-1;const l=r.pos,h=r.axis*2;for(;;){for(;o<=a&&e[o*6+h]<l;)o++;for(;o<=a&&e[a*6+h]>=l;)a--;if(o<a){for(let c=0;c<3;c++){let u=t[o*3+c];t[o*3+c]=t[a*3+c],t[a*3+c]=u}for(let c=0;c<6;c++){let u=e[o*6+c];e[o*6+c]=e[a*6+c],e[a*6+c]=u}o++,a--}else return o}}function lN(s,t,e,i,n,r){let o=i,a=i+n-1;const l=r.pos,h=r.axis*2;for(;;){for(;o<=a&&e[o*6+h]<l;)o++;for(;o<=a&&e[a*6+h]>=l;)a--;if(o<a){let c=s[o];s[o]=s[a],s[a]=c;for(let u=0;u<6;u++){let p=e[o*6+u];e[o*6+u]=e[a*6+u],e[a*6+u]=p}o++,a--}else return o}}function hN(s,t){const e=(s.index?s.index.count:s.attributes.position.count)/3,i=e>2**16,n=i?4:2,r=t?new SharedArrayBuffer(e*n):new ArrayBuffer(e*n),o=i?new Uint32Array(r):new Uint16Array(r);for(let a=0,l=o.length;a<l;a++)o[a]=a;return o}function cN(s,t){const e=s.geometry,i=e.index?e.index.array:null,n=t.maxDepth,r=t.verbose,o=t.maxLeafTris,a=t.strategy,l=t.onProgress,h=Dl(e),c=s._indirectBuffer;let u=!1;const p=new Float32Array(6),d=new Float32Array(6),_=iN(e,p),m=t.indirect?lN:aN,g=[],f=t.indirect?YE(e):WE(e);if(f.length===1){const E=f[0],C=new sd;C.boundingData=p,sN(_,E.offset,E.count,d),y(C,E.offset,E.count,d),g.push(C)}else for(let E of f){const C=new sd;C.boundingData=new Float32Array(6),wm(_,E.offset,E.count,C.boundingData,d),y(C,E.offset,E.count,d),g.push(C)}return g;function b(E){l&&l(E/h)}function y(E,C,I,x=null,A=0){if(!u&&A>=n&&(u=!0,r&&(console.warn(`MeshBVH: Max depth of ${n} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),I<=o||A>=n)return b(C+I),E.offset=C,E.count=I,E;const O=rN(E.boundingData,x,_,C,I,a);if(O.axis===-1)return b(C+I),E.offset=C,E.count=I,E;const L=m(c,i,_,C,I,O);if(L===C||L===C+I)b(C+I),E.offset=C,E.count=I;else{E.splitAxis=O.axis;const V=new sd,T=C,N=L-C;E.left=V,V.boundingData=new Float32Array(6),wm(_,T,N,V.boundingData,d),y(V,T,N,d,A+1);const v=new sd,M=L,Q=I-N;E.right=v,v.boundingData=new Float32Array(6),wm(_,M,Q,v.boundingData,d),y(v,M,Q,d,A+1)}return E}}function uN(s,t){const e=s.geometry;t.indirect&&(s._indirectBuffer=hN(e,t.useSharedArrayBuffer),tN(e)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),s._indirectBuffer||J5(e,t);const i=cN(s,t);let n,r,o;const a=[],l=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<i.length;u++){const p=i[u];let d=h(p);const _=new l(Yd*d);n=new Float32Array(_),r=new Uint32Array(_),o=new Uint16Array(_),c(0,p),a.push(_)}s._roots=a;return;function h(u){return u.count?1:1+h(u.left)+h(u.right)}function c(u,p){const d=u/4,_=u/2,m=!!p.count,g=p.boundingData;for(let f=0;f<6;f++)n[d+f]=g[f];if(m){const f=p.offset,b=p.count;return r[d+6]=f,o[_+14]=b,o[_+15]=Jp,u+Yd}else{const f=p.left,b=p.right,y=p.splitAxis;let E;if(E=c(u+Yd,f),E/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[d+6]=E/4,E=c(E,b),r[d+7]=y,E}}}let pr=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(s,t){let e=1/0,i=-1/0;for(let n=0,r=s.length;n<r;n++){const o=s[n][t];e=o<e?o:e,i=o>i?o:i}this.min=e,this.max=i}setFromPoints(s,t){let e=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const o=t[n],a=s.dot(o);e=a<e?a:e,i=a>i?a:i}this.min=e,this.max=i}isSeparated(s){return this.min>s.max||s.min>this.max}};pr.prototype.setFromBox=function(){const s=new F;return function(t,e){const i=e.min,n=e.max;let r=1/0,o=-1/0;for(let a=0;a<=1;a++)for(let l=0;l<=1;l++)for(let h=0;h<=1;h++){s.x=i.x*a+n.x*(1-a),s.y=i.y*l+n.y*(1-l),s.z=i.z*h+n.z*(1-h);const c=t.dot(s);r=Math.min(c,r),o=Math.max(c,o)}this.min=r,this.max=o}}();const dN=function(){const s=new F,t=new F,e=new F;return function(i,n,r){const o=i.start,a=s,l=n.start,h=t;e.subVectors(o,l),s.subVectors(i.end,i.start),t.subVectors(n.end,n.start);const c=e.dot(h),u=h.dot(a),p=h.dot(h),d=e.dot(a),_=a.dot(a)*p-u*u;let m,g;_!==0?m=(c*u-d*p)/_:m=0,g=(c+m*u)/p,r.x=m,r.y=g}}(),X_=function(){const s=new Bt,t=new F,e=new F;return function(i,n,r,o){dN(i,n,s);let a=s.x,l=s.y;if(a>=0&&a<=1&&l>=0&&l<=1){i.at(a,r),n.at(l,o);return}else if(a>=0&&a<=1){l<0?n.at(0,o):n.at(1,o),i.closestPointToPoint(o,!0,r);return}else if(l>=0&&l<=1){a<0?i.at(0,r):i.at(1,r),n.closestPointToPoint(r,!0,o);return}else{let h;a<0?h=i.start:h=i.end;let c;l<0?c=n.start:c=n.end;const u=t,p=e;if(i.closestPointToPoint(c,!0,t),n.closestPointToPoint(h,!0,e),u.distanceToSquared(c)<=p.distanceToSquared(h)){r.copy(u),o.copy(c);return}else{r.copy(h),o.copy(p);return}}}}(),pN=function(){const s=new F,t=new F,e=new Ht,i=new Gt;return function(n,r){const{radius:o,center:a}=n,{a:l,b:h,c}=r;if(i.start=l,i.end=h,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o||(i.start=l,i.end=c,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o)||(i.start=h,i.end=c,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o))return!0;const u=r.getPlane(e);if(Math.abs(u.distanceToPoint(a))<=o){const p=u.projectPoint(a,t);if(r.containsPoint(p))return!0}return!1}}(),fN=1e-15;function Em(s){return Math.abs(s)<fN}let cn=class extends ks{constructor(...s){super(...s),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new F),this.satBounds=new Array(4).fill().map(()=>new pr),this.points=[this.a,this.b,this.c],this.sphere=new ws,this.plane=new Ht,this.needsUpdate=!0}intersectsSphere(s){return pN(s,this)}update(){const s=this.a,t=this.b,e=this.c,i=this.points,n=this.satAxes,r=this.satBounds,o=n[0],a=r[0];this.getNormal(o),a.setFromPoints(o,i);const l=n[1],h=r[1];l.subVectors(s,t),h.setFromPoints(l,i);const c=n[2],u=r[2];c.subVectors(t,e),u.setFromPoints(c,i);const p=n[3],d=r[3];p.subVectors(e,s),d.setFromPoints(p,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,s),this.needsUpdate=!1}};cn.prototype.closestPointToSegment=function(){const s=new F,t=new F,e=new Gt;return function(i,n=null,r=null){const{start:o,end:a}=i,l=this.points;let h,c=1/0;for(let u=0;u<3;u++){const p=(u+1)%3;e.start.copy(l[u]),e.end.copy(l[p]),X_(e,i,s,t),h=s.distanceToSquared(t),h<c&&(c=h,n&&n.copy(s),r&&r.copy(t))}return this.closestPointToPoint(o,s),h=o.distanceToSquared(s),h<c&&(c=h,n&&n.copy(s),r&&r.copy(o)),this.closestPointToPoint(a,s),h=a.distanceToSquared(s),h<c&&(c=h,n&&n.copy(s),r&&r.copy(a)),Math.sqrt(c)}}();cn.prototype.intersectsTriangle=function(){const s=new cn,t=new Array(3),e=new Array(3),i=new pr,n=new pr,r=new F,o=new F,a=new F,l=new F,h=new F,c=new Gt,u=new Gt,p=new Gt,d=new F;function _(m,g,f){const b=m.points;let y=0,E=-1;for(let C=0;C<3;C++){const{start:I,end:x}=c;I.copy(b[C]),x.copy(b[(C+1)%3]),c.delta(o);const A=Em(g.distanceToPoint(I));if(Em(g.normal.dot(o))&&A){f.copy(c),y=2;break}const O=g.intersectLine(c,d);if(!O&&A&&d.copy(I),(O||A)&&!Em(d.distanceTo(x))){if(y<=1)(y===1?f.start:f.end).copy(d),A&&(E=y);else if(y>=2){(E===1?f.start:f.end).copy(d),y=2;break}if(y++,y===2&&E===-1)break}}return y}return function(m,g=null,f=!1){this.needsUpdate&&this.update(),m.isExtendedTriangle?m.needsUpdate&&m.update():(s.copy(m),s.update(),m=s);const b=this.plane,y=m.plane;if(Math.abs(b.normal.dot(y.normal))>1-1e-10){const E=this.satBounds,C=this.satAxes;e[0]=m.a,e[1]=m.b,e[2]=m.c;for(let A=0;A<4;A++){const O=E[A],L=C[A];if(i.setFromPoints(L,e),O.isSeparated(i))return!1}const I=m.satBounds,x=m.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let A=0;A<4;A++){const O=I[A],L=x[A];if(i.setFromPoints(L,t),O.isSeparated(i))return!1}for(let A=0;A<4;A++){const O=C[A];for(let L=0;L<4;L++){const V=x[L];if(r.crossVectors(O,V),i.setFromPoints(r,t),n.setFromPoints(r,e),i.isSeparated(n))return!1}}return g&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),g.start.set(0,0,0),g.end.set(0,0,0)),!0}else{const E=_(this,y,u);if(E===1&&m.containsPoint(u.end))return g&&(g.start.copy(u.end),g.end.copy(u.end)),!0;if(E!==2)return!1;const C=_(m,b,p);if(C===1&&this.containsPoint(p.end))return g&&(g.start.copy(p.end),g.end.copy(p.end)),!0;if(C!==2)return!1;if(u.delta(a),p.delta(l),a.dot(l)<0){let T=p.start;p.start=p.end,p.end=T}const I=u.start.dot(a),x=u.end.dot(a),A=p.start.dot(a),O=p.end.dot(a),L=x<A,V=I<O;return I!==O&&A!==x&&L===V?!1:(g&&(h.subVectors(u.start,p.start),h.dot(a)>0?g.start.copy(u.start):g.start.copy(p.start),h.subVectors(u.end,p.end),h.dot(a)<0?g.end.copy(u.end):g.end.copy(p.end)),!0)}}}();cn.prototype.distanceToPoint=function(){const s=new F;return function(t){return this.closestPointToPoint(t,s),t.distanceTo(s)}}();cn.prototype.distanceToTriangle=function(){const s=new F,t=new F,e=["a","b","c"],i=new Gt,n=new Gt;return function(r,o=null,a=null){const l=o||a?i:null;if(this.intersectsTriangle(r,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let h=1/0;for(let c=0;c<3;c++){let u;const p=e[c],d=r[p];this.closestPointToPoint(d,s),u=d.distanceToSquared(s),u<h&&(h=u,o&&o.copy(s),a&&a.copy(d));const _=this[p];r.closestPointToPoint(_,s),u=_.distanceToSquared(s),u<h&&(h=u,o&&o.copy(_),a&&a.copy(s))}for(let c=0;c<3;c++){const u=e[c],p=e[(c+1)%3];i.set(this[u],this[p]);for(let d=0;d<3;d++){const _=e[d],m=e[(d+1)%3];n.set(r[_],r[m]),X_(i,n,s,t);const g=s.distanceToSquared(t);g<h&&(h=g,o&&o.copy(s),a&&a.copy(t))}}return Math.sqrt(h)}}();let Vs=class{constructor(s,t,e){this.isOrientedBox=!0,this.min=new F,this.max=new F,this.matrix=new vt,this.invMatrix=new vt,this.points=new Array(8).fill().map(()=>new F),this.satAxes=new Array(3).fill().map(()=>new F),this.satBounds=new Array(3).fill().map(()=>new pr),this.alignedSatBounds=new Array(3).fill().map(()=>new pr),this.needsUpdate=!1,s&&this.min.copy(s),t&&this.max.copy(t),e&&this.matrix.copy(e)}set(s,t,e){this.min.copy(s),this.max.copy(t),this.matrix.copy(e),this.needsUpdate=!0}copy(s){this.min.copy(s.min),this.max.copy(s.max),this.matrix.copy(s.matrix),this.needsUpdate=!0}};Vs.prototype.update=function(){return function(){const s=this.matrix,t=this.min,e=this.max,i=this.points;for(let l=0;l<=1;l++)for(let h=0;h<=1;h++)for(let c=0;c<=1;c++){const u=1*l|2*h|4*c,p=i[u];p.x=l?e.x:t.x,p.y=h?e.y:t.y,p.z=c?e.z:t.z,p.applyMatrix4(s)}const n=this.satBounds,r=this.satAxes,o=i[0];for(let l=0;l<3;l++){const h=r[l],c=n[l],u=1<<l,p=i[u];h.subVectors(o,p),c.setFromPoints(h,i)}const a=this.alignedSatBounds;a[0].setFromPointsField(i,"x"),a[1].setFromPointsField(i,"y"),a[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Vs.prototype.intersectsBox=function(){const s=new pr;return function(t){this.needsUpdate&&this.update();const e=t.min,i=t.max,n=this.satBounds,r=this.satAxes,o=this.alignedSatBounds;if(s.min=e.x,s.max=i.x,o[0].isSeparated(s)||(s.min=e.y,s.max=i.y,o[1].isSeparated(s))||(s.min=e.z,s.max=i.z,o[2].isSeparated(s)))return!1;for(let a=0;a<3;a++){const l=r[a],h=n[a];if(s.setFromBox(l,t),h.isSeparated(s))return!1}return!0}}();Vs.prototype.intersectsTriangle=function(){const s=new cn,t=new Array(3),e=new pr,i=new pr,n=new F;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(s.copy(r),s.update(),r=s);const o=this.satBounds,a=this.satAxes;t[0]=r.a,t[1]=r.b,t[2]=r.c;for(let u=0;u<3;u++){const p=o[u],d=a[u];if(e.setFromPoints(d,t),p.isSeparated(e))return!1}const l=r.satBounds,h=r.satAxes,c=this.points;for(let u=0;u<3;u++){const p=l[u],d=h[u];if(e.setFromPoints(d,c),p.isSeparated(e))return!1}for(let u=0;u<3;u++){const p=a[u];for(let d=0;d<4;d++){const _=h[d];if(n.crossVectors(p,_),e.setFromPoints(n,t),i.setFromPoints(n,c),e.isSeparated(i))return!1}}return!0}}();Vs.prototype.closestPointToPoint=function(){return function(s,t){return this.needsUpdate&&this.update(),t.copy(s).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();Vs.prototype.distanceToPoint=function(){const s=new F;return function(t){return this.closestPointToPoint(t,s),t.distanceTo(s)}}();Vs.prototype.distanceToBox=function(){const s=["x","y","z"],t=new Array(12).fill().map(()=>new Gt),e=new Array(12).fill().map(()=>new Gt),i=new F,n=new F;return function(r,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(a||l)&&(r.getCenter(n),this.closestPointToPoint(n,i),r.closestPointToPoint(i,n),a&&a.copy(i),l&&l.copy(n)),0;const h=o*o,c=r.min,u=r.max,p=this.points;let d=1/0;for(let m=0;m<8;m++){const g=p[m];n.copy(g).clamp(c,u);const f=g.distanceToSquared(n);if(f<d&&(d=f,a&&a.copy(g),l&&l.copy(n),f<h))return Math.sqrt(f)}let _=0;for(let m=0;m<3;m++)for(let g=0;g<=1;g++)for(let f=0;f<=1;f++){const b=(m+1)%3,y=(m+2)%3,E=g<<b|f<<y,C=1<<m|g<<b|f<<y,I=p[E],x=p[C];t[_].set(I,x);const A=s[m],O=s[b],L=s[y],V=e[_],T=V.start,N=V.end;T[A]=c[A],T[O]=g?c[O]:u[O],T[L]=f?c[L]:u[O],N[A]=u[A],N[O]=g?c[O]:u[O],N[L]=f?c[L]:u[O],_++}for(let m=0;m<=1;m++)for(let g=0;g<=1;g++)for(let f=0;f<=1;f++){n.x=m?u.x:c.x,n.y=g?u.y:c.y,n.z=f?u.z:c.z,this.closestPointToPoint(n,i);const b=n.distanceToSquared(i);if(b<d&&(d=b,a&&a.copy(i),l&&l.copy(n),b<h))return Math.sqrt(b)}for(let m=0;m<12;m++){const g=t[m];for(let f=0;f<12;f++){const b=e[f];X_(g,b,i,n);const y=i.distanceToSquared(n);if(y<d&&(d=y,a&&a.copy(i),l&&l.copy(n),y<h))return Math.sqrt(y)}}return Math.sqrt(d)}}();let Q_=class{constructor(s){this._getNewPrimitive=s,this._primitives=[]}getPrimitive(){const s=this._primitives;return s.length===0?this._getNewPrimitive():s.pop()}releasePrimitive(s){this._primitives.push(s)}};class mN extends Q_{constructor(){super(()=>new cn)}}const Mi=new mN;function pi(s,t){return t[s+15]===65535}function _i(s,t){return t[s+6]}function Di(s,t){return t[s+14]}function ki(s){return s+8}function zi(s,t){return t[s+6]}function GE(s,t){return t[s+7]}class gN{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=i=>{e&&t.push(e),e=i,this.float32Array=new Float32Array(i),this.uint16Array=new Uint16Array(i),this.uint32Array=new Uint32Array(i)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,t.length!==0&&this.setBuffer(t.pop())}}}const be=new gN;let Wr,ll;const Fa=[],id=new Q_(()=>new Tt);function _N(s,t,e,i,n,r){Wr=id.getPrimitive(),ll=id.getPrimitive(),Fa.push(Wr,ll),be.setBuffer(s._roots[t]);const o=Yg(0,s.geometry,e,i,n,r);be.clearBuffer(),id.releasePrimitive(Wr),id.releasePrimitive(ll),Fa.pop(),Fa.pop();const a=Fa.length;return a>0&&(ll=Fa[a-1],Wr=Fa[a-2]),o}function Yg(s,t,e,i,n=null,r=0,o=0){const{float32Array:a,uint16Array:l,uint32Array:h}=be;let c=s*2;if(pi(c,l)){const u=_i(s,h),p=Di(c,l);return Oe(s,a,Wr),i(u,p,!1,o,r+s,Wr)}else{let u=function(V){const{uint16Array:T,uint32Array:N}=be;let v=V*2;for(;!pi(v,T);)V=ki(V),v=V*2;return _i(V,N)},p=function(V){const{uint16Array:T,uint32Array:N}=be;let v=V*2;for(;!pi(v,T);)V=zi(V,N),v=V*2;return _i(V,N)+Di(v,T)};const d=ki(s),_=zi(s,h);let m=d,g=_,f,b,y,E;if(n&&(y=Wr,E=ll,Oe(m,a,y),Oe(g,a,E),f=n(y),b=n(E),b<f)){m=_,g=d;const V=f;f=b,b=V,y=E}y||(y=Wr,Oe(m,a,y));const C=pi(m*2,l),I=e(y,C,f,o+1,r+m);let x;if(I===by){const V=u(m),T=p(m)-V;x=i(V,T,!0,o+1,r+m,y)}else x=I&&Yg(m,t,e,i,n,r,o+1);if(x)return!0;E=ll,Oe(g,a,E);const A=pi(g*2,l),O=e(E,A,b,o+1,r+g);let L;if(O===by){const V=u(g),T=p(g)-V;L=i(V,T,!0,o+1,r+g,E)}else L=O&&Yg(g,t,e,i,n,r,o+1);return!!L}}const bh=new F,Cm=new F;function bN(s,t,e={},i=0,n=1/0){const r=i*i,o=n*n;let a=1/0,l=null;if(s.shapecast({boundsTraverseOrder:c=>(bh.copy(t).clamp(c.min,c.max),bh.distanceToSquared(t)),intersectsBounds:(c,u,p)=>p<a&&p<o,intersectsTriangle:(c,u)=>{c.closestPointToPoint(t,bh);const p=t.distanceToSquared(bh);return p<a&&(Cm.copy(bh),a=p,l=u),p<r}}),a===1/0)return null;const h=Math.sqrt(a);return e.point?e.point.copy(Cm):e.point=Cm.clone(),e.distance=h,e.faceIndex=l,e}const Ra=new F,La=new F,Na=new F,nd=new Bt,rd=new Bt,od=new Bt,Cy=new F,Iy=new F,xy=new F,ad=new F;function yN(s,t,e,i,n,r){let o;return r===Tw?o=s.intersectTriangle(i,e,t,!0,n):o=s.intersectTriangle(t,e,i,r!==Wn,n),o===null?null:{distance:s.origin.distanceTo(n),point:n.clone()}}function vN(s,t,e,i,n,r,o,a,l){Ra.fromBufferAttribute(t,r),La.fromBufferAttribute(t,o),Na.fromBufferAttribute(t,a);const h=yN(s,Ra,La,Na,ad,l);if(h){i&&(nd.fromBufferAttribute(i,r),rd.fromBufferAttribute(i,o),od.fromBufferAttribute(i,a),h.uv=ks.getInterpolation(ad,Ra,La,Na,nd,rd,od,new Bt)),n&&(nd.fromBufferAttribute(n,r),rd.fromBufferAttribute(n,o),od.fromBufferAttribute(n,a),h.uv1=ks.getInterpolation(ad,Ra,La,Na,nd,rd,od,new Bt)),e&&(Cy.fromBufferAttribute(e,r),Iy.fromBufferAttribute(e,o),xy.fromBufferAttribute(e,a),h.normal=ks.getInterpolation(ad,Ra,La,Na,Cy,Iy,xy,new F),h.normal.dot(s.direction)>0&&h.normal.multiplyScalar(-1));const c={a:r,b:o,c:a,normal:new F,materialIndex:0};ks.getNormal(Ra,La,Na,c.normal),h.face=c,h.faceIndex=r}return h}function tf(s,t,e,i,n){const r=i*3;let o=r+0,a=r+1,l=r+2;const h=s.index;s.index&&(o=h.getX(o),a=h.getX(a),l=h.getX(l));const{position:c,normal:u,uv:p,uv1:d}=s.attributes,_=vN(e,c,u,p,d,o,a,l,t);return _?(_.faceIndex=i,n&&n.push(_),_):null}function Ye(s,t,e,i){const n=s.a,r=s.b,o=s.c;let a=t,l=t+1,h=t+2;e&&(a=e.getX(a),l=e.getX(l),h=e.getX(h)),n.x=i.getX(a),n.y=i.getY(a),n.z=i.getZ(a),r.x=i.getX(l),r.y=i.getY(l),r.z=i.getZ(l),o.x=i.getX(h),o.y=i.getY(h),o.z=i.getZ(h)}function wN(s,t,e,i,n,r){const{geometry:o,_indirectBuffer:a}=s;for(let l=i,h=i+n;l<h;l++)tf(o,t,e,l,r)}function EN(s,t,e,i,n){const{geometry:r,_indirectBuffer:o}=s;let a=1/0,l=null;for(let h=i,c=i+n;h<c;h++){let u;u=tf(r,t,e,h),u&&u.distance<a&&(l=u,a=u.distance)}return l}function CN(s,t,e,i,n,r,o){const{geometry:a}=e,{index:l}=a,h=a.attributes.position;for(let c=s,u=t+s;c<u;c++){let p;if(p=c,Ye(o,p*3,l,h),o.needsUpdate=!0,i(o,p,n,r))return!0}return!1}function IN(s,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=s.geometry,i=e.index?e.index.array:null,n=e.attributes.position;let r,o,a,l,h=0;const c=s._roots;for(let p=0,d=c.length;p<d;p++)r=c[p],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),u(0,h),h+=r.byteLength;function u(p,d,_=!1){const m=p*2;if(a[m+15]===Jp){const g=o[p+6],f=a[m+14];let b=1/0,y=1/0,E=1/0,C=-1/0,I=-1/0,x=-1/0;for(let A=3*g,O=3*(g+f);A<O;A++){let L=i[A];const V=n.getX(L),T=n.getY(L),N=n.getZ(L);V<b&&(b=V),V>C&&(C=V),T<y&&(y=T),T>I&&(I=T),N<E&&(E=N),N>x&&(x=N)}return l[p+0]!==b||l[p+1]!==y||l[p+2]!==E||l[p+3]!==C||l[p+4]!==I||l[p+5]!==x?(l[p+0]=b,l[p+1]=y,l[p+2]=E,l[p+3]=C,l[p+4]=I,l[p+5]=x,!0):!1}else{const g=p+8,f=o[p+6],b=g+d,y=f+d;let E=_,C=!1,I=!1;t?E||(C=t.has(b),I=t.has(y),E=!C&&!I):(C=!0,I=!0);const x=E||C,A=E||I;let O=!1;x&&(O=u(g,d,E));let L=!1;A&&(L=u(f,d,E));const V=O||L;if(V)for(let T=0;T<3;T++){const N=g+T,v=f+T,M=l[N],Q=l[N+3],j=l[v],it=l[v+3];l[p+T]=M<j?M:j,l[p+T+3]=Q>it?Q:it}return V}}}const Ty=new Tt;function io(s,t,e,i){return Oe(s,t,Ty),e.intersectBox(Ty,i)}function xN(s,t,e,i,n,r){const{geometry:o,_indirectBuffer:a}=s;for(let l=i,h=i+n;l<h;l++){let c=a?a[l]:l;tf(o,t,e,c,r)}}function TN(s,t,e,i,n){const{geometry:r,_indirectBuffer:o}=s;let a=1/0,l=null;for(let h=i,c=i+n;h<c;h++){let u;u=tf(r,t,e,o?o[h]:h),u&&u.distance<a&&(l=u,a=u.distance)}return l}function AN(s,t,e,i,n,r,o){const{geometry:a}=e,{index:l}=a,h=a.attributes.position;for(let c=s,u=t+s;c<u;c++){let p;if(p=e.resolveTriangleIndex(c),Ye(o,p*3,l,h),o.needsUpdate=!0,i(o,p,n,r))return!0}return!1}const Ay=new F;function SN(s,t,e,i,n){be.setBuffer(s._roots[t]),Wg(0,s,e,i,n),be.clearBuffer()}function Wg(s,t,e,i,n){const{float32Array:r,uint16Array:o,uint32Array:a}=be,l=s*2;if(pi(l,o)){const h=_i(s,a),c=Di(l,o);wN(t,e,i,h,c,n)}else{const h=ki(s);io(h,r,i,Ay)&&Wg(h,t,e,i,n);const c=zi(s,a);io(c,r,i,Ay)&&Wg(c,t,e,i,n)}}const Sy=new F,ON=["x","y","z"];function PN(s,t,e,i){be.setBuffer(s._roots[t]);const n=Gg(0,s,e,i);return be.clearBuffer(),n}function Gg(s,t,e,i){const{float32Array:n,uint16Array:r,uint32Array:o}=be;let a=s*2;if(pi(a,r)){const l=_i(s,o),h=Di(a,r);return EN(t,e,i,l,h)}else{const l=GE(s,o),h=ON[l],c=i.direction[h]>=0;let u,p;c?(u=ki(s),p=zi(s,o)):(u=zi(s,o),p=ki(s));const d=io(u,n,i,Sy)?Gg(u,t,e,i):null;if(d){const m=d.point[h];if(c?m<=n[p+l]:m>=n[p+l+3])return d}const _=io(p,n,i,Sy)?Gg(p,t,e,i):null;return d&&_?d.distance<=_.distance?d:_:d||_||null}}const ld=new Tt,Ma=new cn,Da=new cn,yh=new vt,Oy=new Vs,hd=new Vs;function FN(s,t,e,i){be.setBuffer(s._roots[t]);const n=qg(0,s,e,i);return be.clearBuffer(),n}function qg(s,t,e,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=be;let l=s*2;if(n===null&&(e.boundingBox||e.computeBoundingBox(),Oy.set(e.boundingBox.min,e.boundingBox.max,i),n=Oy),pi(l,o)){const h=t.geometry,c=h.index,u=h.attributes.position,p=e.index,d=e.attributes.position,_=_i(s,a),m=Di(l,o);if(yh.copy(i).invert(),e.boundsTree)return Oe(s,r,hd),hd.matrix.copy(yh),hd.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:g=>hd.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(i),g.b.applyMatrix4(i),g.c.applyMatrix4(i),g.needsUpdate=!0;for(let f=_*3,b=(m+_)*3;f<b;f+=3)if(Ye(Da,f,c,u),Da.needsUpdate=!0,g.intersectsTriangle(Da))return!0;return!1}});for(let g=_*3,f=(m+_)*3;g<f;g+=3){Ye(Ma,g,c,u),Ma.a.applyMatrix4(yh),Ma.b.applyMatrix4(yh),Ma.c.applyMatrix4(yh),Ma.needsUpdate=!0;for(let b=0,y=p.count;b<y;b+=3)if(Ye(Da,b,p,d),Da.needsUpdate=!0,Ma.intersectsTriangle(Da))return!0}}else{const h=s+8,c=a[s+6];return Oe(h,r,ld),!!(n.intersectsBox(ld)&&qg(h,t,e,i,n)||(Oe(c,r,ld),n.intersectsBox(ld)&&qg(c,t,e,i,n)))}}const cd=new vt,Im=new Vs,vh=new Vs,RN=new F,LN=new F,NN=new F,MN=new F;function DN(s,t,e,i={},n={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),Im.set(t.boundingBox.min,t.boundingBox.max,e),Im.needsUpdate=!0;const a=s.geometry,l=a.attributes.position,h=a.index,c=t.attributes.position,u=t.index,p=Mi.getPrimitive(),d=Mi.getPrimitive();let _=RN,m=LN,g=null,f=null;n&&(g=NN,f=MN);let b=1/0,y=null,E=null;return cd.copy(e).invert(),vh.matrix.copy(cd),s.shapecast({boundsTraverseOrder:C=>Im.distanceToBox(C),intersectsBounds:(C,I,x)=>x<b&&x<o?(I&&(vh.min.copy(C.min),vh.max.copy(C.max),vh.needsUpdate=!0),!0):!1,intersectsRange:(C,I)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:x=>vh.distanceToBox(x),intersectsBounds:(x,A,O)=>O<b&&O<o,intersectsRange:(x,A)=>{for(let O=x,L=x+A;O<L;O++){Ye(d,3*O,u,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let V=C,T=C+I;V<T;V++){Ye(p,3*V,h,l),p.needsUpdate=!0;const N=p.distanceToTriangle(d,_,g);if(N<b&&(m.copy(_),f&&f.copy(g),b=N,y=V,E=O),N<r)return!0}}}});{const x=Dl(t);for(let A=0,O=x;A<O;A++){Ye(d,3*A,u,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let L=C,V=C+I;L<V;L++){Ye(p,3*L,h,l),p.needsUpdate=!0;const T=p.distanceToTriangle(d,_,g);if(T<b&&(m.copy(_),f&&f.copy(g),b=T,y=L,E=A),T<r)return!0}}}}}),Mi.releasePrimitive(p),Mi.releasePrimitive(d),b===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=b,i.faceIndex=y,n&&(n.point?n.point.copy(f):n.point=f.clone(),n.point.applyMatrix4(cd),m.applyMatrix4(cd),n.distance=m.sub(n.point).length(),n.faceIndex=E),i)}function kN(s,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=s.geometry,i=e.index?e.index.array:null,n=e.attributes.position;let r,o,a,l,h=0;const c=s._roots;for(let p=0,d=c.length;p<d;p++)r=c[p],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),u(0,h),h+=r.byteLength;function u(p,d,_=!1){const m=p*2;if(a[m+15]===Jp){const g=o[p+6],f=a[m+14];let b=1/0,y=1/0,E=1/0,C=-1/0,I=-1/0,x=-1/0;for(let A=g,O=g+f;A<O;A++){const L=3*s.resolveTriangleIndex(A);for(let V=0;V<3;V++){let T=L+V;T=i?i[T]:T;const N=n.getX(T),v=n.getY(T),M=n.getZ(T);N<b&&(b=N),N>C&&(C=N),v<y&&(y=v),v>I&&(I=v),M<E&&(E=M),M>x&&(x=M)}}return l[p+0]!==b||l[p+1]!==y||l[p+2]!==E||l[p+3]!==C||l[p+4]!==I||l[p+5]!==x?(l[p+0]=b,l[p+1]=y,l[p+2]=E,l[p+3]=C,l[p+4]=I,l[p+5]=x,!0):!1}else{const g=p+8,f=o[p+6],b=g+d,y=f+d;let E=_,C=!1,I=!1;t?E||(C=t.has(b),I=t.has(y),E=!C&&!I):(C=!0,I=!0);const x=E||C,A=E||I;let O=!1;x&&(O=u(g,d,E));let L=!1;A&&(L=u(f,d,E));const V=O||L;if(V)for(let T=0;T<3;T++){const N=g+T,v=f+T,M=l[N],Q=l[N+3],j=l[v],it=l[v+3];l[p+T]=M<j?M:j,l[p+T+3]=Q>it?Q:it}return V}}}const Py=new F;function zN(s,t,e,i,n){be.setBuffer(s._roots[t]),Zg(0,s,e,i,n),be.clearBuffer()}function Zg(s,t,e,i,n){const{float32Array:r,uint16Array:o,uint32Array:a}=be,l=s*2;if(pi(l,o)){const h=_i(s,a),c=Di(l,o);xN(t,e,i,h,c,n)}else{const h=ki(s);io(h,r,i,Py)&&Zg(h,t,e,i,n);const c=zi(s,a);io(c,r,i,Py)&&Zg(c,t,e,i,n)}}const Fy=new F,UN=["x","y","z"];function BN(s,t,e,i){be.setBuffer(s._roots[t]);const n=Xg(0,s,e,i);return be.clearBuffer(),n}function Xg(s,t,e,i){const{float32Array:n,uint16Array:r,uint32Array:o}=be;let a=s*2;if(pi(a,r)){const l=_i(s,o),h=Di(a,r);return TN(t,e,i,l,h)}else{const l=GE(s,o),h=UN[l],c=i.direction[h]>=0;let u,p;c?(u=ki(s),p=zi(s,o)):(u=zi(s,o),p=ki(s));const d=io(u,n,i,Fy)?Xg(u,t,e,i):null;if(d){const m=d.point[h];if(c?m<=n[p+l]:m>=n[p+l+3])return d}const _=io(p,n,i,Fy)?Xg(p,t,e,i):null;return d&&_?d.distance<=_.distance?d:_:d||_||null}}const ud=new Tt,ka=new cn,za=new cn,wh=new vt,Ry=new Vs,dd=new Vs;function VN(s,t,e,i){be.setBuffer(s._roots[t]);const n=Qg(0,s,e,i);return be.clearBuffer(),n}function Qg(s,t,e,i,n=null){const{float32Array:r,uint16Array:o,uint32Array:a}=be;let l=s*2;if(n===null&&(e.boundingBox||e.computeBoundingBox(),Ry.set(e.boundingBox.min,e.boundingBox.max,i),n=Ry),pi(l,o)){const h=t.geometry,c=h.index,u=h.attributes.position,p=e.index,d=e.attributes.position,_=_i(s,a),m=Di(l,o);if(wh.copy(i).invert(),e.boundsTree)return Oe(s,r,dd),dd.matrix.copy(wh),dd.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:g=>dd.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(i),g.b.applyMatrix4(i),g.c.applyMatrix4(i),g.needsUpdate=!0;for(let f=_,b=m+_;f<b;f++)if(Ye(za,3*t.resolveTriangleIndex(f),c,u),za.needsUpdate=!0,g.intersectsTriangle(za))return!0;return!1}});for(let g=_,f=m+_;g<f;g++){const b=t.resolveTriangleIndex(g);Ye(ka,3*b,c,u),ka.a.applyMatrix4(wh),ka.b.applyMatrix4(wh),ka.c.applyMatrix4(wh),ka.needsUpdate=!0;for(let y=0,E=p.count;y<E;y+=3)if(Ye(za,y,p,d),za.needsUpdate=!0,ka.intersectsTriangle(za))return!0}}else{const h=s+8,c=a[s+6];return Oe(h,r,ud),!!(n.intersectsBox(ud)&&Qg(h,t,e,i,n)||(Oe(c,r,ud),n.intersectsBox(ud)&&Qg(c,t,e,i,n)))}}const pd=new vt,xm=new Vs,Eh=new Vs,$N=new F,HN=new F,jN=new F,YN=new F;function WN(s,t,e,i={},n={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),xm.set(t.boundingBox.min,t.boundingBox.max,e),xm.needsUpdate=!0;const a=s.geometry,l=a.attributes.position,h=a.index,c=t.attributes.position,u=t.index,p=Mi.getPrimitive(),d=Mi.getPrimitive();let _=$N,m=HN,g=null,f=null;n&&(g=jN,f=YN);let b=1/0,y=null,E=null;return pd.copy(e).invert(),Eh.matrix.copy(pd),s.shapecast({boundsTraverseOrder:C=>xm.distanceToBox(C),intersectsBounds:(C,I,x)=>x<b&&x<o?(I&&(Eh.min.copy(C.min),Eh.max.copy(C.max),Eh.needsUpdate=!0),!0):!1,intersectsRange:(C,I)=>{if(t.boundsTree){const x=t.boundsTree;return x.shapecast({boundsTraverseOrder:A=>Eh.distanceToBox(A),intersectsBounds:(A,O,L)=>L<b&&L<o,intersectsRange:(A,O)=>{for(let L=A,V=A+O;L<V;L++){const T=x.resolveTriangleIndex(L);Ye(d,3*T,u,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let N=C,v=C+I;N<v;N++){const M=s.resolveTriangleIndex(N);Ye(p,3*M,h,l),p.needsUpdate=!0;const Q=p.distanceToTriangle(d,_,g);if(Q<b&&(m.copy(_),f&&f.copy(g),b=Q,y=N,E=L),Q<r)return!0}}}})}else{const x=Dl(t);for(let A=0,O=x;A<O;A++){Ye(d,3*A,u,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let L=C,V=C+I;L<V;L++){const T=s.resolveTriangleIndex(L);Ye(p,3*T,h,l),p.needsUpdate=!0;const N=p.distanceToTriangle(d,_,g);if(N<b&&(m.copy(_),f&&f.copy(g),b=N,y=L,E=A),N<r)return!0}}}}}),Mi.releasePrimitive(p),Mi.releasePrimitive(d),b===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=b,i.faceIndex=y,n&&(n.point?n.point.copy(f):n.point=f.clone(),n.point.applyMatrix4(pd),m.applyMatrix4(pd),n.distance=m.sub(n.point).length(),n.faceIndex=E),i)}function GN(){return typeof SharedArrayBuffer<"u"}const cc=new be.constructor,pp=new be.constructor,Dr=new Q_(()=>new Tt),Ua=new Tt,Ba=new Tt,Tm=new Tt,Am=new Tt;let Sm=!1;function qN(s,t,e,i){if(Sm)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Sm=!0;const n=s._roots,r=t._roots;let o,a=0,l=0;const h=new vt().copy(e).invert();for(let c=0,u=n.length;c<u;c++){cc.setBuffer(n[c]),l=0;const p=Dr.getPrimitive();Oe(0,cc.float32Array,p),p.applyMatrix4(h);for(let d=0,_=r.length;d<_&&(pp.setBuffer(r[c]),o=Ki(0,0,e,h,i,a,l,0,0,p),pp.clearBuffer(),l+=r[d].length,!o);d++);if(Dr.releasePrimitive(p),cc.clearBuffer(),a+=n[c].length,o)break}return Sm=!1,o}function Ki(s,t,e,i,n,r=0,o=0,a=0,l=0,h=null,c=!1){let u,p;c?(u=pp,p=cc):(u=cc,p=pp);const d=u.float32Array,_=u.uint32Array,m=u.uint16Array,g=p.float32Array,f=p.uint32Array,b=p.uint16Array,y=s*2,E=t*2,C=pi(y,m),I=pi(E,b);let x=!1;if(I&&C)c?x=n(_i(t,f),Di(t*2,b),_i(s,_),Di(s*2,m),l,o+t,a,r+s):x=n(_i(s,_),Di(s*2,m),_i(t,f),Di(t*2,b),a,r+s,l,o+t);else if(I){const A=Dr.getPrimitive();Oe(t,g,A),A.applyMatrix4(e);const O=ki(s),L=zi(s,_);Oe(O,d,Ua),Oe(L,d,Ba);const V=A.intersectsBox(Ua),T=A.intersectsBox(Ba);x=V&&Ki(t,O,i,e,n,o,r,l,a+1,A,!c)||T&&Ki(t,L,i,e,n,o,r,l,a+1,A,!c),Dr.releasePrimitive(A)}else{const A=ki(t),O=zi(t,f);Oe(A,g,Tm),Oe(O,g,Am);const L=h.intersectsBox(Tm),V=h.intersectsBox(Am);if(L&&V)x=Ki(s,A,e,i,n,r,o,a,l+1,h,c)||Ki(s,O,e,i,n,r,o,a,l+1,h,c);else if(L)if(C)x=Ki(s,A,e,i,n,r,o,a,l+1,h,c);else{const T=Dr.getPrimitive();T.copy(Tm).applyMatrix4(e);const N=ki(s),v=zi(s,_);Oe(N,d,Ua),Oe(v,d,Ba);const M=T.intersectsBox(Ua),Q=T.intersectsBox(Ba);x=M&&Ki(A,N,i,e,n,o,r,l,a+1,T,!c)||Q&&Ki(A,v,i,e,n,o,r,l,a+1,T,!c),Dr.releasePrimitive(T)}else if(V)if(C)x=Ki(s,O,e,i,n,r,o,a,l+1,h,c);else{const T=Dr.getPrimitive();T.copy(Am).applyMatrix4(e);const N=ki(s),v=zi(s,_);Oe(N,d,Ua),Oe(v,d,Ba);const M=T.intersectsBox(Ua),Q=T.intersectsBox(Ba);x=M&&Ki(O,N,i,e,n,o,r,l,a+1,T,!c)||Q&&Ki(O,v,i,e,n,o,r,l,a+1,T,!c),Dr.releasePrimitive(T)}}return x}const fd=new Vs,Ly=new Tt;let ZN=class qE{static serialize(t,e={}){e={cloneBuffers:!0,...e};const i=t.geometry,n=t._roots,r=t._indirectBuffer,o=i.getIndex();let a;return e.cloneBuffers?a={roots:n.map(l=>l.slice()),index:o.array.slice(),indirectBuffer:r?r.slice():null}:a={roots:n,index:o.array,indirectBuffer:r},a}static deserialize(t,e,i={}){i={setIndex:!0,indirect:!!t.indirectBuffer,...i};const{index:n,roots:r,indirectBuffer:o}=t,a=new qE(e,{...i,[vm]:!0});if(a._roots=r,a._indirectBuffer=o||null,i.setIndex){const l=e.getIndex();if(l===null){const h=new Ve(t.index,1,!1);e.setIndex(h)}else l.array!==n&&(l.array.set(n),l.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({strategy:jE,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[vm]:!1},e),e.useSharedArrayBuffer&&!GN())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[vm]||(uN(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new Tt)));const{_indirectBuffer:i}=this;this.resolveTriangleIndex=e.indirect?n=>i[n]:n=>n}refit(t=null){return(this.indirect?kN:IN)(this,t)}traverse(t,e=0){const i=this._roots[e],n=new Uint32Array(i),r=new Uint16Array(i);o(0);function o(a,l=0){const h=a*2,c=r[h+15]===Jp;if(c){const u=n[a+6],p=r[h+14];t(l,c,new Float32Array(i,a*4,6),u,p)}else{const u=a+Yd/4,p=n[a+6],d=n[a+7];t(l,c,new Float32Array(i,a*4,6),d)||(o(u,l+1),o(p,l+1))}}}raycast(t,e=ep){const i=this._roots,n=this.geometry,r=[],o=e.isMaterial,a=Array.isArray(e),l=n.groups,h=o?e.side:e,c=this.indirect?zN:SN;for(let u=0,p=i.length;u<p;u++){const d=a?e[l[u].materialIndex].side:h,_=r.length;if(c(this,u,d,t,r),a){const m=l[u].materialIndex;for(let g=_,f=r.length;g<f;g++)r[g].face.materialIndex=m}}return r}raycastFirst(t,e=ep){const i=this._roots,n=this.geometry,r=e.isMaterial,o=Array.isArray(e);let a=null;const l=n.groups,h=r?e.side:e,c=this.indirect?BN:PN;for(let u=0,p=i.length;u<p;u++){const d=o?e[l[u].materialIndex].side:h,_=c(this,u,d,t);_!=null&&(a==null||_.distance<a.distance)&&(a=_,o&&(_.face.materialIndex=l[u].materialIndex))}return a}intersectsGeometry(t,e){let i=!1;const n=this._roots,r=this.indirect?VN:FN;for(let o=0,a=n.length;o<a&&(i=r(this,o,t,e),!i);o++);return i}shapecast(t){const e=Mi.getPrimitive(),i=this.indirect?AN:CN;let{boundsTraverseOrder:n,intersectsBounds:r,intersectsRange:o,intersectsTriangle:a}=t;if(o&&a){const u=o;o=(p,d,_,m,g)=>u(p,d,_,m,g)?!0:i(p,d,this,a,_,m,e)}else o||(a?o=(u,p,d,_)=>i(u,p,this,a,d,_,e):o=(u,p,d)=>d);let l=!1,h=0;const c=this._roots;for(let u=0,p=c.length;u<p;u++){const d=c[u];if(l=_N(this,u,r,o,n,h),l)break;h+=d.byteLength}return Mi.releasePrimitive(e),l}bvhcast(t,e,i){let{intersectsRanges:n,intersectsTriangles:r}=i;const o=Mi.getPrimitive(),a=this.geometry.index,l=this.geometry.attributes.position,h=this.indirect?_=>{const m=this.resolveTriangleIndex(_);Ye(o,m*3,a,l)}:_=>{Ye(o,_*3,a,l)},c=Mi.getPrimitive(),u=t.geometry.index,p=t.geometry.attributes.position,d=t.indirect?_=>{const m=t.resolveTriangleIndex(_);Ye(c,m*3,u,p)}:_=>{Ye(c,_*3,u,p)};if(r){const _=(m,g,f,b,y,E,C,I)=>{for(let x=f,A=f+b;x<A;x++){d(x),c.a.applyMatrix4(e),c.b.applyMatrix4(e),c.c.applyMatrix4(e),c.needsUpdate=!0;for(let O=m,L=m+g;O<L;O++)if(h(O),o.needsUpdate=!0,r(o,c,O,x,y,E,C,I))return!0}return!1};if(n){const m=n;n=function(g,f,b,y,E,C,I,x){return m(g,f,b,y,E,C,I,x)?!0:_(g,f,b,y,E,C,I,x)}}else n=_}return qN(this,t,e,n)}intersectsBox(t,e){return fd.set(t.min,t.max,e),fd.needsUpdate=!0,this.shapecast({intersectsBounds:i=>fd.intersectsBox(i),intersectsTriangle:i=>fd.intersectsTriangle(i)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,i={},n={},r=0,o=1/0){return(this.indirect?WN:DN)(this,t,e,i,n,r,o)}closestPointToPoint(t,e={},i=0,n=1/0){return bN(this,t,e,i,n)}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(e=>{Oe(0,new Float32Array(e),Ly),t.union(Ly)}),t}};function Ny(s,t,e){return s===null||(s.point.applyMatrix4(t.matrixWorld),s.distance=s.point.distanceTo(e.ray.origin),s.object=t,s.distance<e.near||s.distance>e.far)?null:s}const Om=new Jr,My=new vt,XN=lt.prototype.raycast;function QN(s,t){if(this.geometry.boundsTree){if(this.material===void 0)return;My.copy(this.matrixWorld).invert(),Om.copy(s.ray).applyMatrix4(My);const e=this.geometry.boundsTree;if(s.firstHitOnly===!0){const i=Ny(e.raycastFirst(Om,this.material),this,s);i&&t.push(i)}else{const i=e.raycast(Om,this.material);for(let n=0,r=i.length;n<r;n++){const o=Ny(i[n],this,s);o&&t.push(o)}}}else XN.call(this,s,t)}function KN(s){return this.boundsTree=new ZN(this,s),this.boundsTree}function JN(){this.boundsTree=null}const ZE=class XE{constructor(){k(this,"onDisposed",new ft),k(this,"list",new Map),k(this,"enabled",!1),k(this,"_clock"),k(this,"onInit",new ft),k(this,"update",()=>{if(!this.enabled)return;const t=this._clock.getDelta();for(const[e,i]of this.list)i.enabled&&i.isUpdateable()&&i.update(t);requestAnimationFrame(this.update)}),this._clock=new uw,XE.setupBVH()}add(t,e){if(this.list.has(t))throw new Error("You're trying to add a component that already exists in the components instance. Use Components.get() instead.");Ss.validate(t),this.list.set(t,e)}get(t){const e=t.uuid;if(!this.list.has(e)){const i=new t(this);return i.isDisposeable()&&i.onDisposed.add(()=>this.list.delete(e)),this.list.has(e)||this.add(e,i),i}return this.list.get(e)}init(){this.enabled=!0;for(const[t,e]of this.list.entries())e.enabled=!0;this._clock.start(),this.update(),this.onInit.trigger()}dispose(){this.enabled=!1;let t;for(const[e,i]of this.list){if(i.enabled=!1,e===Lt.uuid){t=i;continue}i.isDisposeable()&&i.dispose()}t==null||t.dispose(),this._clock.stop(),this.onDisposed.trigger()}static setupBVH(){ye.prototype.computeBoundsTree=KN,ye.prototype.disposeBoundsTree=JN,lt.prototype.raycast=QN}};k(ZE,"release","2.4.3");let QE=ZE;class tM{constructor(t){k(this,"enabled",!1),k(this,"id","FirstPerson"),this.camera=t}set(t){if(this.enabled=t,t){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const t=this.camera.controls,e=new F;t.distance--,t.getPosition(e),t.minDistance=1,t.maxDistance=1,t.distance=1,t.moveTo(e.x,e.y,e.z),t.truckSpeed=50,t.mouseButtons.wheel=di.ACTION.DOLLY,t.touches.two=di.ACTION.TOUCH_ZOOM_TRUCK}}class eM{constructor(t){k(this,"enabled",!0),k(this,"id","Orbit"),this.camera=t,this.activateOrbitControls()}set(t){this.enabled=t,t&&this.activateOrbitControls()}activateOrbitControls(){const t=this.camera.controls;t.minDistance=1,t.maxDistance=300;const e=new F;t.getPosition(e);const i=e.length();t.distance=i,t.truckSpeed=2;const{rotation:n}=this.camera.three,r=new F(0,0,-1).applyEuler(n),o=e.addScaledVector(r,i);t.moveTo(o.x,o.y,o.z)}}class sM{constructor(t){k(this,"enabled",!1),k(this,"id","Plan"),k(this,"mouseAction1"),k(this,"mouseAction2"),k(this,"mouseInitialized",!1),k(this,"defaultAzimuthSpeed"),k(this,"defaultPolarSpeed"),this.camera=t,this.defaultAzimuthSpeed=t.controls.azimuthRotateSpeed,this.defaultPolarSpeed=t.controls.polarRotateSpeed}set(t){this.enabled=t;const e=this.camera.controls;e.azimuthRotateSpeed=t?0:this.defaultAzimuthSpeed,e.polarRotateSpeed=t?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=e.touches.one,this.mouseAction2=e.touches.two,this.mouseInitialized=!0),t?(e.mouseButtons.left=di.ACTION.TRUCK,e.touches.one=di.ACTION.TOUCH_TRUCK,e.touches.two=di.ACTION.TOUCH_ZOOM):(e.mouseButtons.left=di.ACTION.ROTATE,e.touches.one=this.mouseAction1,e.touches.two=this.mouseAction2)}}class iM{constructor(t){k(this,"onChanged",new ft),k(this,"current","Perspective"),k(this,"camera"),k(this,"matchOrthoDistanceEnabled",!1),k(this,"_component"),k(this,"_previousDistance",-1),this._component=t,this.camera=t.three}async set(t){this.current!==t&&(t==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const t=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(t)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const t=this.getPerspectiveDims();if(!t)return;const{width:e,height:i}=t;this.setupOrthoCamera(i,e),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const t=this._component.currentWorld;if(!t||!t.renderer)return null;const e=new F;this._component.threePersp.getWorldDirection(e);const i=new F;this._component.controls.getTarget(i);const n=i.clone().sub(this._component.threePersp.position).dot(e),r=t.renderer.getSize(),o=r.x/r.y,a=this._component.threePersp,l=n*2*Math.atan(a.fov*(Math.PI/180)/2);return{width:l*o,height:l}}setupOrthoCamera(t,e){this._component.controls.mouseButtons.wheel=di.ACTION.ZOOM,this._component.controls.mouseButtons.middle=di.ACTION.ZOOM;const i=this._component.threePersp,n=this._component.threeOrtho;n.zoom=1,n.left=e/-2,n.right=e/2,n.top=t/2,n.bottom=t/-2,n.updateProjectionMatrix(),n.position.copy(i.position),n.quaternion.copy(i.quaternion),this._component.controls.camera=n}getDistance(){const t=this._component.threePersp,e=this._component.threeOrtho;return(e.top-e.bottom)/e.zoom/(2*Math.atan(t.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=di.ACTION.DOLLY,this._component.controls.mouseButtons.middle=di.ACTION.DOLLY;const t=this._component.threePersp,e=this._component.threeOrtho;t.position.copy(e.position),t.quaternion.copy(e.quaternion),this._component.controls.mouseButtons.wheel=di.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),t.updateProjectionMatrix(),this._component.controls.camera=t,this.camera=t,this.current="Perspective"}}let KE=class extends jg{constructor(s){super(s),k(this,"projection"),k(this,"threeOrtho"),k(this,"threePersp"),k(this,"_userInputButtons",{}),k(this,"_frustumSize",50),k(this,"_navigationModes",new Map),k(this,"_mode",null),k(this,"previousSize",null),this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new iM(this),this.onAspectUpdated.add(()=>{this.setOrthoPerspCameraAspect()}),this.projection.onChanged.add(t=>{this.three=t,this.updateAspect()}),this.worlds.onItemSet.add(()=>{this._navigationModes.clear(),this._navigationModes.set("Orbit",new eM(this)),this._navigationModes.set("FirstPerson",new tM(this)),this._navigationModes.set("Plan",new sM(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0}),this.currentWorld&&this.currentWorld.renderer&&(this.previousSize=this.currentWorld.renderer.getSize().clone())}),this.worlds.onItemDeleted.add(()=>{this._navigationModes.clear()})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(s){if(this.mode!==null&&this.mode.id!==s){if(this.mode.set(!1),!this._navigationModes.has(s))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(s),this.mode.set(!0)}}async fit(s,t=1.5){if(!this.enabled)return;const e=Number.MAX_VALUE,i=Number.MIN_VALUE,n=new F(e,e,e),r=new F(i,i,i);for(const p of s){const d=new Tt().setFromObject(p);d.min.x<n.x&&(n.x=d.min.x),d.min.y<n.y&&(n.y=d.min.y),d.min.z<n.z&&(n.z=d.min.z),d.max.x>r.x&&(r.x=d.max.x),d.max.y>r.y&&(r.y=d.max.y),d.max.z>r.z&&(r.z=d.max.z)}const o=new Tt(n,r),a=this.components.get(Lt);if(a.initialized)for(const[,p]of a.list){const d=p.box;d.min.x<n.x&&(n.x=d.min.x),d.min.y<n.y&&(n.y=d.min.y),d.min.z<n.z&&(n.z=d.min.z),d.max.x>r.x&&(r.x=d.max.x),d.max.y>r.y&&(r.y=d.max.y),d.max.z>r.z&&(r.z=d.max.z)}const l=new F;o.getSize(l);const h=new F;o.getCenter(h);const c=Math.max(l.x,l.y,l.z)*t,u=new ws(h,c);await this.controls.fitToSphere(u,!0)}setUserInput(s){s?this.enableUserInput():this.disableUserInput()}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const s=window.innerWidth/window.innerHeight;return new aa(this._frustumSize*s/-2,this._frustumSize*s/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoPerspCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer||!this.previousSize)return;const s=this.currentWorld.renderer.getSize(),t=this.threeOrtho.top,e=this.threeOrtho.right,i=s.y/this.previousSize.y,n=s.x/this.previousSize.x,r=t*i,o=e*n;this.threeOrtho.left=-o,this.threeOrtho.right=o,this.threeOrtho.top=r,this.threeOrtho.bottom=-r,this.threeOrtho.updateProjectionMatrix(),this.previousSize.copy(s)}};function md(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var JE={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(s,t){(function(e){s.exports=e()})(function(){return function e(i,n,r){function o(h,c){if(!n[h]){if(!i[h]){var u=typeof md=="function"&&md;if(!c&&u)return u(h,!0);if(a)return a(h,!0);var p=new Error("Cannot find module '"+h+"'");throw p.code="MODULE_NOT_FOUND",p}var d=n[h]={exports:{}};i[h][0].call(d.exports,function(_){var m=i[h][1][_];return o(m||_)},d,d.exports,e,i,n,r)}return n[h].exports}for(var a=typeof md=="function"&&md,l=0;l<r.length;l++)o(r[l]);return o}({1:[function(e,i,n){var r=e("./utils"),o=e("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(l){for(var h,c,u,p,d,_,m,g=[],f=0,b=l.length,y=b,E=r.getTypeOf(l)!=="string";f<l.length;)y=b-f,u=E?(h=l[f++],c=f<b?l[f++]:0,f<b?l[f++]:0):(h=l.charCodeAt(f++),c=f<b?l.charCodeAt(f++):0,f<b?l.charCodeAt(f++):0),p=h>>2,d=(3&h)<<4|c>>4,_=1<y?(15&c)<<2|u>>6:64,m=2<y?63&u:64,g.push(a.charAt(p)+a.charAt(d)+a.charAt(_)+a.charAt(m));return g.join("")},n.decode=function(l){var h,c,u,p,d,_,m=0,g=0,f="data:";if(l.substr(0,f.length)===f)throw new Error("Invalid base64 input, it looks like a data url.");var b,y=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&y--,l.charAt(l.length-2)===a.charAt(64)&&y--,y%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=o.uint8array?new Uint8Array(0|y):new Array(0|y);m<l.length;)h=a.indexOf(l.charAt(m++))<<2|(p=a.indexOf(l.charAt(m++)))>>4,c=(15&p)<<4|(d=a.indexOf(l.charAt(m++)))>>2,u=(3&d)<<6|(_=a.indexOf(l.charAt(m++))),b[g++]=h,d!==64&&(b[g++]=c),_!==64&&(b[g++]=u);return b}},{"./support":30,"./utils":32}],2:[function(e,i,n){var r=e("./external"),o=e("./stream/DataWorker"),a=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function h(c,u,p,d,_){this.compressedSize=c,this.uncompressedSize=u,this.crc32=p,this.compression=d,this.compressedContent=_}h.prototype={getContentWorker:function(){var c=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),u=this;return c.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(c,u,p){return c.pipe(new a).pipe(new l("uncompressedSize")).pipe(u.compressWorker(p)).pipe(new l("compressedSize")).withStreamInfo("compression",u)},i.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,i,n){var r=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,i,n){var r=e("./utils"),o=function(){for(var a,l=[],h=0;h<256;h++){a=h;for(var c=0;c<8;c++)a=1&a?3988292384^a>>>1:a>>>1;l[h]=a}return l}();i.exports=function(a,l){return a!==void 0&&a.length?r.getTypeOf(a)!=="string"?function(h,c,u,p){var d=o,_=p+u;h^=-1;for(var m=p;m<_;m++)h=h>>>8^d[255&(h^c[m])];return-1^h}(0|l,a,a.length,0):function(h,c,u,p){var d=o,_=p+u;h^=-1;for(var m=p;m<_;m++)h=h>>>8^d[255&(h^c.charCodeAt(m))];return-1^h}(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(e,i,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,i,n){var r=null;r=typeof Promise<"u"?Promise:e("lie"),i.exports={Promise:r}},{lie:37}],7:[function(e,i,n){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=e("pako"),a=e("./utils"),l=e("./stream/GenericWorker"),h=r?"uint8array":"array";function c(u,p){l.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=p,this.meta={}}n.magic="\b\0",a.inherits(c,l),c.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(h,u.data),!1)},c.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(p){u.push({data:p,meta:u.meta})}},n.compressWorker=function(u){return new c("Deflate",u)},n.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,i,n){function r(d,_){var m,g="";for(m=0;m<_;m++)g+=String.fromCharCode(255&d),d>>>=8;return g}function o(d,_,m,g,f,b){var y,E,C=d.file,I=d.compression,x=b!==h.utf8encode,A=a.transformTo("string",b(C.name)),O=a.transformTo("string",h.utf8encode(C.name)),L=C.comment,V=a.transformTo("string",b(L)),T=a.transformTo("string",h.utf8encode(L)),N=O.length!==C.name.length,v=T.length!==L.length,M="",Q="",j="",it=C.dir,G=C.date,nt={crc32:0,compressedSize:0,uncompressedSize:0};_&&!m||(nt.crc32=d.crc32,nt.compressedSize=d.compressedSize,nt.uncompressedSize=d.uncompressedSize);var $=0;_&&($|=8),x||!N&&!v||($|=2048);var B=0,at=0;it&&(B|=16),f==="UNIX"?(at=798,B|=function(st,dt){var wt=st;return st||(wt=dt?16893:33204),(65535&wt)<<16}(C.unixPermissions,it)):(at=20,B|=function(st){return 63&(st||0)}(C.dosPermissions)),y=G.getUTCHours(),y<<=6,y|=G.getUTCMinutes(),y<<=5,y|=G.getUTCSeconds()/2,E=G.getUTCFullYear()-1980,E<<=4,E|=G.getUTCMonth()+1,E<<=5,E|=G.getUTCDate(),N&&(Q=r(1,1)+r(c(A),4)+O,M+="up"+r(Q.length,2)+Q),v&&(j=r(1,1)+r(c(V),4)+T,M+="uc"+r(j.length,2)+j);var J="";return J+=`
\0`,J+=r($,2),J+=I.magic,J+=r(y,2),J+=r(E,2),J+=r(nt.crc32,4),J+=r(nt.compressedSize,4),J+=r(nt.uncompressedSize,4),J+=r(A.length,2),J+=r(M.length,2),{fileRecord:u.LOCAL_FILE_HEADER+J+A+M,dirRecord:u.CENTRAL_FILE_HEADER+r(at,2)+J+r(V.length,2)+"\0\0\0\0"+r(B,4)+r(g,4)+A+M+V}}var a=e("../utils"),l=e("../stream/GenericWorker"),h=e("../utf8"),c=e("../crc32"),u=e("../signature");function p(d,_,m,g){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=_,this.zipPlatform=m,this.encodeFileName=g,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(p,l),p.prototype.push=function(d){var _=d.meta.percent||0,m=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,l.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:m?(_+100*(m-g-1))/m:100}}))},p.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var _=this.streamFiles&&!d.file.dir;if(_){var m=o(d,_,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},p.prototype.closedSource=function(d){this.accumulate=!1;var _=this.streamFiles&&!d.file.dir,m=o(d,_,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),_)this.push({data:function(g){return u.DATA_DESCRIPTOR+r(g.crc32,4)+r(g.compressedSize,4)+r(g.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},p.prototype.flush=function(){for(var d=this.bytesWritten,_=0;_<this.dirRecords.length;_++)this.push({data:this.dirRecords[_],meta:{percent:100}});var m=this.bytesWritten-d,g=function(f,b,y,E,C){var I=a.transformTo("string",C(E));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(f,2)+r(f,2)+r(b,4)+r(y,4)+r(I.length,2)+I}(this.dirRecords.length,m,d,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},p.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},p.prototype.registerPrevious=function(d){this._sources.push(d);var _=this;return d.on("data",function(m){_.processChunk(m)}),d.on("end",function(){_.closedSource(_.previous.streamInfo),_._sources.length?_.prepareNextSource():_.end()}),d.on("error",function(m){_.error(m)}),this},p.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},p.prototype.error=function(d){var _=this._sources;if(!l.prototype.error.call(this,d))return!1;for(var m=0;m<_.length;m++)try{_[m].error(d)}catch{}return!0},p.prototype.lock=function(){l.prototype.lock.call(this);for(var d=this._sources,_=0;_<d.length;_++)d[_].lock()},i.exports=p},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,i,n){var r=e("../compressions"),o=e("./ZipFileWorker");n.generateWorker=function(a,l,h){var c=new o(l.streamFiles,h,l.platform,l.encodeFileName),u=0;try{a.forEach(function(p,d){u++;var _=function(b,y){var E=b||y,C=r[E];if(!C)throw new Error(E+" is not a valid compression method !");return C}(d.options.compression,l.compression),m=d.options.compressionOptions||l.compressionOptions||{},g=d.dir,f=d.date;d._compressWorker(_,m).withStreamInfo("file",{name:p,dir:g,date:f,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(c)}),c.entriesCount=u}catch(p){c.error(p)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,i,n){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new r;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(r.prototype=e("./object")).loadAsync=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.version="3.10.1",r.loadAsync=function(o,a){return new r().loadAsync(o,a)},r.external=e("./external"),i.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,i,n){var r=e("./utils"),o=e("./external"),a=e("./utf8"),l=e("./zipEntries"),h=e("./stream/Crc32Probe"),c=e("./nodejsUtils");function u(p){return new o.Promise(function(d,_){var m=p.decompressed.getContentWorker().pipe(new h);m.on("error",function(g){_(g)}).on("end",function(){m.streamInfo.crc32!==p.decompressed.crc32?_(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}i.exports=function(p,d){var _=this;return d=r.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),c.isNode&&c.isStream(p)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",p,!0,d.optimizedBinaryString,d.base64).then(function(m){var g=new l(d);return g.load(m),g}).then(function(m){var g=[o.Promise.resolve(m)],f=m.files;if(d.checkCRC32)for(var b=0;b<f.length;b++)g.push(u(f[b]));return o.Promise.all(g)}).then(function(m){for(var g=m.shift(),f=g.files,b=0;b<f.length;b++){var y=f[b],E=y.fileNameStr,C=r.resolve(y.fileNameStr);_.file(C,y.decompressed,{binary:!0,optimizedBinaryString:!0,date:y.date,dir:y.dir,comment:y.fileCommentStr.length?y.fileCommentStr:null,unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions,createFolders:d.createFolders}),y.dir||(_.file(C).unsafeOriginalName=E)}return g.zipComment.length&&(_.comment=g.zipComment),_})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,i,n){var r=e("../utils"),o=e("../stream/GenericWorker");function a(l,h){o.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(h)}r.inherits(a,o),a.prototype._bindStream=function(l){var h=this;(this._stream=l).pause(),l.on("data",function(c){h.push({data:c,meta:{percent:0}})}).on("error",function(c){h.isPaused?this.generatedError=c:h.error(c)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,i,n){var r=e("readable-stream").Readable;function o(a,l,h){r.call(this,l),this._helper=a;var c=this;a.on("data",function(u,p){c.push(u)||c._helper.pause(),h&&h(p)}).on("error",function(u){c.emit("error",u)}).on("end",function(){c.push(null)})}e("../utils").inherits(o,r),o.prototype._read=function(){this._helper.resume()},i.exports=o},{"../utils":32,"readable-stream":16}],14:[function(e,i,n){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,o);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,o)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var o=new Buffer(r);return o.fill(0),o},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(e,i,n){function r(C,I,x){var A,O=a.getTypeOf(I),L=a.extend(x||{},c);L.date=L.date||new Date,L.compression!==null&&(L.compression=L.compression.toUpperCase()),typeof L.unixPermissions=="string"&&(L.unixPermissions=parseInt(L.unixPermissions,8)),L.unixPermissions&&16384&L.unixPermissions&&(L.dir=!0),L.dosPermissions&&16&L.dosPermissions&&(L.dir=!0),L.dir&&(C=f(C)),L.createFolders&&(A=g(C))&&b.call(this,A,!0);var V=O==="string"&&L.binary===!1&&L.base64===!1;x&&x.binary!==void 0||(L.binary=!V),(I instanceof u&&I.uncompressedSize===0||L.dir||!I||I.length===0)&&(L.base64=!1,L.binary=!0,I="",L.compression="STORE",O="string");var T=null;T=I instanceof u||I instanceof l?I:_.isNode&&_.isStream(I)?new m(C,I):a.prepareContent(C,I,L.binary,L.optimizedBinaryString,L.base64);var N=new p(C,T,L);this.files[C]=N}var o=e("./utf8"),a=e("./utils"),l=e("./stream/GenericWorker"),h=e("./stream/StreamHelper"),c=e("./defaults"),u=e("./compressedObject"),p=e("./zipObject"),d=e("./generate"),_=e("./nodejsUtils"),m=e("./nodejs/NodejsStreamInputAdapter"),g=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var I=C.lastIndexOf("/");return 0<I?C.substring(0,I):""},f=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},b=function(C,I){return I=I!==void 0?I:c.createFolders,C=f(C),this.files[C]||r.call(this,C,null,{dir:!0,createFolders:I}),this.files[C]};function y(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var E={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var I,x,A;for(I in this.files)A=this.files[I],(x=I.slice(this.root.length,I.length))&&I.slice(0,this.root.length)===this.root&&C(x,A)},filter:function(C){var I=[];return this.forEach(function(x,A){C(x,A)&&I.push(A)}),I},file:function(C,I,x){if(arguments.length!==1)return C=this.root+C,r.call(this,C,I,x),this;if(y(C)){var A=C;return this.filter(function(L,V){return!V.dir&&A.test(L)})}var O=this.files[this.root+C];return O&&!O.dir?O:null},folder:function(C){if(!C)return this;if(y(C))return this.filter(function(O,L){return L.dir&&C.test(O)});var I=this.root+C,x=b.call(this,I),A=this.clone();return A.root=x.name,A},remove:function(C){C=this.root+C;var I=this.files[C];if(I||(C.slice(-1)!=="/"&&(C+="/"),I=this.files[C]),I&&!I.dir)delete this.files[C];else for(var x=this.filter(function(O,L){return L.name.slice(0,C.length)===C}),A=0;A<x.length;A++)delete this.files[x[A].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var I,x={};try{if((x=a.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=x.type.toLowerCase(),x.compression=x.compression.toUpperCase(),x.type==="binarystring"&&(x.type="string"),!x.type)throw new Error("No output type specified.");a.checkSupport(x.type),x.platform!=="darwin"&&x.platform!=="freebsd"&&x.platform!=="linux"&&x.platform!=="sunos"||(x.platform="UNIX"),x.platform==="win32"&&(x.platform="DOS");var A=x.comment||this.comment||"";I=d.generateWorker(this,x,A)}catch(O){(I=new l("error")).error(O)}return new h(I,x.type||"string",x.mimeType)},generateAsync:function(C,I){return this.generateInternalStream(C).accumulate(I)},generateNodeStream:function(C,I){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(I)}};i.exports=E},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,i,n){i.exports=e("stream")},{stream:void 0}],17:[function(e,i,n){var r=e("./DataReader");function o(a){r.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}e("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),h=a.charCodeAt(1),c=a.charCodeAt(2),u=a.charCodeAt(3),p=this.length-4;0<=p;--p)if(this.data[p]===l&&this.data[p+1]===h&&this.data[p+2]===c&&this.data[p+3]===u)return p-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),h=a.charCodeAt(1),c=a.charCodeAt(2),u=a.charCodeAt(3),p=this.readData(4);return l===p[0]&&h===p[1]&&c===p[2]&&u===p[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./DataReader":18}],18:[function(e,i,n){var r=e("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,h=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)h=(h<<8)+this.byteAt(l);return this.index+=a,h},readString:function(a){return r.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},i.exports=o},{"../utils":32}],19:[function(e,i,n){var r=e("./Uint8ArrayReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,i,n){var r=e("./DataReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./DataReader":18}],21:[function(e,i,n){var r=e("./ArrayReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(e,i,n){var r=e("../utils"),o=e("../support"),a=e("./ArrayReader"),l=e("./StringReader"),h=e("./NodeBufferReader"),c=e("./Uint8ArrayReader");i.exports=function(u){var p=r.getTypeOf(u);return r.checkSupport(p),p!=="string"||o.uint8array?p==="nodebuffer"?new h(u):o.uint8array?new c(r.transformTo("uint8array",u)):new a(r.transformTo("array",u)):new l(u)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,i,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,i,n){var r=e("./GenericWorker"),o=e("../utils");function a(l){r.call(this,"ConvertWorker to "+l),this.destType=l}o.inherits(a,r),a.prototype.processChunk=function(l){this.push({data:o.transformTo(this.destType,l.data),meta:l.meta})},i.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,i,n){var r=e("./GenericWorker"),o=e("../crc32");function a(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(a,r),a.prototype.processChunk=function(l){this.streamInfo.crc32=o(l.data,this.streamInfo.crc32||0),this.push(l)},i.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,i,n){var r=e("../utils"),o=e("./GenericWorker");function a(l){o.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}r.inherits(a,o),a.prototype.processChunk=function(l){if(l){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+l.data.length}o.prototype.processChunk.call(this,l)},i.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,i,n){var r=e("../utils"),o=e("./GenericWorker");function a(l){o.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(c){h.dataIsReady=!0,h.data=c,h.max=c&&c.length||0,h.type=r.getTypeOf(c),h.isPaused||h._tickAndRepeat()},function(c){h.error(c)})}r.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,h);break;case"uint8array":l=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":l=this.data.slice(this.index,h)}return this.index=h,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(e,i,n){function r(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var l=0;l<this._listeners[o].length;l++)this._listeners[o][l].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(l){a.processChunk(l)}),o.on("end",function(){a.end()}),o.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},i.exports=r},{}],29:[function(e,i,n){var r=e("../utils"),o=e("./ConvertWorker"),a=e("./GenericWorker"),l=e("../base64"),h=e("../support"),c=e("../external"),u=null;if(h.nodestream)try{u=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function p(_,m){return new c.Promise(function(g,f){var b=[],y=_._internalType,E=_._outputType,C=_._mimeType;_.on("data",function(I,x){b.push(I),m&&m(x)}).on("error",function(I){b=[],f(I)}).on("end",function(){try{var I=function(x,A,O){switch(x){case"blob":return r.newBlob(r.transformTo("arraybuffer",A),O);case"base64":return l.encode(A);default:return r.transformTo(x,A)}}(E,function(x,A){var O,L=0,V=null,T=0;for(O=0;O<A.length;O++)T+=A[O].length;switch(x){case"string":return A.join("");case"array":return Array.prototype.concat.apply([],A);case"uint8array":for(V=new Uint8Array(T),O=0;O<A.length;O++)V.set(A[O],L),L+=A[O].length;return V;case"nodebuffer":return Buffer.concat(A);default:throw new Error("concat : unsupported type '"+x+"'")}}(y,b),C);g(I)}catch(x){f(x)}b=[]}).resume()})}function d(_,m,g){var f=m;switch(m){case"blob":case"arraybuffer":f="uint8array";break;case"base64":f="string"}try{this._internalType=f,this._outputType=m,this._mimeType=g,r.checkSupport(f),this._worker=_.pipe(new o(f)),_.lock()}catch(b){this._worker=new a("error"),this._worker.error(b)}}d.prototype={accumulate:function(_){return p(this,_)},on:function(_,m){var g=this;return _==="data"?this._worker.on(_,function(f){m.call(g,f.data,f.meta)}):this._worker.on(_,function(){r.delay(m,arguments,g)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(_){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},_)}},i.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,i,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var r=new ArrayBuffer(0);try{n.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(r),n.blob=o.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(e,i,n){for(var r=e("./utils"),o=e("./support"),a=e("./nodejsUtils"),l=e("./stream/GenericWorker"),h=new Array(256),c=0;c<256;c++)h[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;h[254]=h[254]=1;function u(){l.call(this,"utf-8 decode"),this.leftOver=null}function p(){l.call(this,"utf-8 encode")}n.utf8encode=function(d){return o.nodebuffer?a.newBufferFrom(d,"utf-8"):function(_){var m,g,f,b,y,E=_.length,C=0;for(b=0;b<E;b++)(64512&(g=_.charCodeAt(b)))==55296&&b+1<E&&(64512&(f=_.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(f-56320),b++),C+=g<128?1:g<2048?2:g<65536?3:4;for(m=o.uint8array?new Uint8Array(C):new Array(C),b=y=0;y<C;b++)(64512&(g=_.charCodeAt(b)))==55296&&b+1<E&&(64512&(f=_.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(f-56320),b++),g<128?m[y++]=g:(g<2048?m[y++]=192|g>>>6:(g<65536?m[y++]=224|g>>>12:(m[y++]=240|g>>>18,m[y++]=128|g>>>12&63),m[y++]=128|g>>>6&63),m[y++]=128|63&g);return m}(d)},n.utf8decode=function(d){return o.nodebuffer?r.transformTo("nodebuffer",d).toString("utf-8"):function(_){var m,g,f,b,y=_.length,E=new Array(2*y);for(m=g=0;m<y;)if((f=_[m++])<128)E[g++]=f;else if(4<(b=h[f]))E[g++]=65533,m+=b-1;else{for(f&=b===2?31:b===3?15:7;1<b&&m<y;)f=f<<6|63&_[m++],b--;1<b?E[g++]=65533:f<65536?E[g++]=f:(f-=65536,E[g++]=55296|f>>10&1023,E[g++]=56320|1023&f)}return E.length!==g&&(E.subarray?E=E.subarray(0,g):E.length=g),r.applyFromCharCode(E)}(d=r.transformTo(o.uint8array?"uint8array":"array",d))},r.inherits(u,l),u.prototype.processChunk=function(d){var _=r.transformTo(o.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=_;(_=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),_.set(m,this.leftOver.length)}else _=this.leftOver.concat(_);this.leftOver=null}var g=function(b,y){var E;for((y=y||b.length)>b.length&&(y=b.length),E=y-1;0<=E&&(192&b[E])==128;)E--;return E<0||E===0?y:E+h[b[E]]>y?E:y}(_),f=_;g!==_.length&&(o.uint8array?(f=_.subarray(0,g),this.leftOver=_.subarray(g,_.length)):(f=_.slice(0,g),this.leftOver=_.slice(g,_.length))),this.push({data:n.utf8decode(f),meta:d.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=u,r.inherits(p,l),p.prototype.processChunk=function(d){this.push({data:n.utf8encode(d.data),meta:d.meta})},n.Utf8EncodeWorker=p},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,i,n){var r=e("./support"),o=e("./base64"),a=e("./nodejsUtils"),l=e("./external");function h(m){return m}function c(m,g){for(var f=0;f<m.length;++f)g[f]=255&m.charCodeAt(f);return g}e("setimmediate"),n.newBlob=function(m,g){n.checkSupport("blob");try{return new Blob([m],{type:g})}catch{try{var f=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return f.append(m),f.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(m,g,f){var b=[],y=0,E=m.length;if(E<=f)return String.fromCharCode.apply(null,m);for(;y<E;)g==="array"||g==="nodebuffer"?b.push(String.fromCharCode.apply(null,m.slice(y,Math.min(y+f,E)))):b.push(String.fromCharCode.apply(null,m.subarray(y,Math.min(y+f,E)))),y+=f;return b.join("")},stringifyByChar:function(m){for(var g="",f=0;f<m.length;f++)g+=String.fromCharCode(m[f]);return g},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function p(m){var g=65536,f=n.getTypeOf(m),b=!0;if(f==="uint8array"?b=u.applyCanBeUsed.uint8array:f==="nodebuffer"&&(b=u.applyCanBeUsed.nodebuffer),b)for(;1<g;)try{return u.stringifyByChunk(m,f,g)}catch{g=Math.floor(g/2)}return u.stringifyByChar(m)}function d(m,g){for(var f=0;f<m.length;f++)g[f]=m[f];return g}n.applyFromCharCode=p;var _={};_.string={string:h,array:function(m){return c(m,new Array(m.length))},arraybuffer:function(m){return _.string.uint8array(m).buffer},uint8array:function(m){return c(m,new Uint8Array(m.length))},nodebuffer:function(m){return c(m,a.allocBuffer(m.length))}},_.array={string:p,array:h,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},_.arraybuffer={string:function(m){return p(new Uint8Array(m))},array:function(m){return d(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:h,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},_.uint8array={string:p,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:h,nodebuffer:function(m){return a.newBufferFrom(m)}},_.nodebuffer={string:p,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return _.nodebuffer.uint8array(m).buffer},uint8array:function(m){return d(m,new Uint8Array(m.length))},nodebuffer:h},n.transformTo=function(m,g){if(g=g||"",!m)return g;n.checkSupport(m);var f=n.getTypeOf(g);return _[f][m](g)},n.resolve=function(m){for(var g=m.split("/"),f=[],b=0;b<g.length;b++){var y=g[b];y==="."||y===""&&b!==0&&b!==g.length-1||(y===".."?f.pop():f.push(y))}return f.join("/")},n.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":r.nodebuffer&&a.isBuffer(m)?"nodebuffer":r.uint8array&&m instanceof Uint8Array?"uint8array":r.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(m){if(!r[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(m){var g,f,b="";for(f=0;f<(m||"").length;f++)b+="\\x"+((g=m.charCodeAt(f))<16?"0":"")+g.toString(16).toUpperCase();return b},n.delay=function(m,g,f){setImmediate(function(){m.apply(f||null,g||[])})},n.inherits=function(m,g){function f(){}f.prototype=g.prototype,m.prototype=new f},n.extend=function(){var m,g,f={};for(m=0;m<arguments.length;m++)for(g in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],g)&&f[g]===void 0&&(f[g]=arguments[m][g]);return f},n.prepareContent=function(m,g,f,b,y){return l.Promise.resolve(g).then(function(E){return r.blob&&(E instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(E))!==-1)&&typeof FileReader<"u"?new l.Promise(function(C,I){var x=new FileReader;x.onload=function(A){C(A.target.result)},x.onerror=function(A){I(A.target.error)},x.readAsArrayBuffer(E)}):E}).then(function(E){var C=n.getTypeOf(E);return C?(C==="arraybuffer"?E=n.transformTo("uint8array",E):C==="string"&&(y?E=o.decode(E):f&&b!==!0&&(E=function(I){return c(I,r.uint8array?new Uint8Array(I.length):new Array(I.length))}(E))),E):l.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,i,n){var r=e("./reader/readerFor"),o=e("./utils"),a=e("./signature"),l=e("./zipEntry"),h=e("./support");function c(u){this.files=[],this.loadOptions=u}c.prototype={checkSignature:function(u){if(!this.reader.readAndCheckSignature(u)){this.reader.index-=4;var p=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(p)+", expected "+o.pretty(u)+")")}},isSignature:function(u,p){var d=this.reader.index;this.reader.setIndex(u);var _=this.reader.readString(4)===p;return this.reader.setIndex(d),_},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),p=h.uint8array?"uint8array":"array",d=o.transformTo(p,u);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,p,d,_=this.zip64EndOfCentralSize-44;0<_;)u=this.reader.readInt(2),p=this.reader.readInt(4),d=this.reader.readData(p),this.zip64ExtensibleData[u]={id:u,length:p,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var u,p;for(u=0;u<this.files.length;u++)p=this.files[u],this.reader.setIndex(p.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),p.readLocalPart(this.reader),p.handleUTF8(),p.processAttributes()},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(u=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var p=u;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var _=p-d;if(0<_)this.isSignature(p,a.CENTRAL_FILE_HEADER)||(this.reader.zero=_);else if(_<0)throw new Error("Corrupted zip: missing "+Math.abs(_)+" bytes.")},prepareReader:function(u){this.reader=r(u)},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,i,n){var r=e("./reader/readerFor"),o=e("./utils"),a=e("./compressedObject"),l=e("./crc32"),h=e("./utf8"),c=e("./compressions"),u=e("./support");function p(d,_){this.options=d,this.loadOptions=_}p.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var _,m;if(d.skip(22),this.fileNameLength=d.readInt(2),m=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((_=function(g){for(var f in c)if(Object.prototype.hasOwnProperty.call(c,f)&&c[f].magic===g)return c[f];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,_,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var _=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(_),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var _,m,g,f=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<f;)_=d.readInt(2),m=d.readInt(2),g=d.readData(m),this.extraFields[_]={id:_,length:m,value:g};d.setIndex(f)},handleUTF8:function(){var d=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var _=this.findExtraFieldUnicodePath();if(_!==null)this.fileNameStr=_;else{var m=o.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var f=o.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(f)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var _=r(d.value);return _.readInt(1)!==1||l(this.fileName)!==_.readInt(4)?null:h.utf8decode(_.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var _=r(d.value);return _.readInt(1)!==1||l(this.fileComment)!==_.readInt(4)?null:h.utf8decode(_.readData(d.length-5))}return null}},i.exports=p},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,i,n){function r(_,m,g){this.name=_,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=m,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var o=e("./stream/StreamHelper"),a=e("./stream/DataWorker"),l=e("./utf8"),h=e("./compressedObject"),c=e("./stream/GenericWorker");r.prototype={internalStream:function(_){var m=null,g="string";try{if(!_)throw new Error("No output type specified.");var f=(g=_.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),m=this._decompressWorker();var b=!this._dataBinary;b&&!f&&(m=m.pipe(new l.Utf8EncodeWorker)),!b&&f&&(m=m.pipe(new l.Utf8DecodeWorker))}catch(y){(m=new c("error")).error(y)}return new o(m,g,"")},async:function(_,m){return this.internalStream(_).accumulate(m)},nodeStream:function(_,m){return this.internalStream(_||"nodebuffer").toNodejsStream(m)},_compressWorker:function(_,m){if(this._data instanceof h&&this._data.compression.magic===_.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new l.Utf8EncodeWorker)),h.createWorkerFrom(g,_,m)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof c?this._data:new a(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],p=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<u.length;d++)r.prototype[u[d]]=p;i.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,i,n){(function(r){var o,a,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var h=0,c=new l(_),u=r.document.createTextNode("");c.observe(u,{characterData:!0}),o=function(){u.data=h=++h%2}}else if(r.setImmediate||r.MessageChannel===void 0)o="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var m=r.document.createElement("script");m.onreadystatechange=function(){_(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},r.document.documentElement.appendChild(m)}:function(){setTimeout(_,0)};else{var p=new r.MessageChannel;p.port1.onmessage=_,o=function(){p.port2.postMessage(0)}}var d=[];function _(){var m,g;a=!0;for(var f=d.length;f;){for(g=d,d=[],m=-1;++m<f;)g[m]();f=d.length}a=!1}i.exports=function(m){d.push(m)!==1||a||o()}}).call(this,typeof Zu<"u"?Zu:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,i,n){var r=e("immediate");function o(){}var a={},l=["REJECTED"],h=["FULFILLED"],c=["PENDING"];function u(f){if(typeof f!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,f!==o&&m(this,f)}function p(f,b,y){this.promise=f,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}function d(f,b,y){r(function(){var E;try{E=b(y)}catch(C){return a.reject(f,C)}E===f?a.reject(f,new TypeError("Cannot resolve promise with itself")):a.resolve(f,E)})}function _(f){var b=f&&f.then;if(f&&(typeof f=="object"||typeof f=="function")&&typeof b=="function")return function(){b.apply(f,arguments)}}function m(f,b){var y=!1;function E(x){y||(y=!0,a.reject(f,x))}function C(x){y||(y=!0,a.resolve(f,x))}var I=g(function(){b(C,E)});I.status==="error"&&E(I.value)}function g(f,b){var y={};try{y.value=f(b),y.status="success"}catch(E){y.status="error",y.value=E}return y}(i.exports=u).prototype.finally=function(f){if(typeof f!="function")return this;var b=this.constructor;return this.then(function(y){return b.resolve(f()).then(function(){return y})},function(y){return b.resolve(f()).then(function(){throw y})})},u.prototype.catch=function(f){return this.then(null,f)},u.prototype.then=function(f,b){if(typeof f!="function"&&this.state===h||typeof b!="function"&&this.state===l)return this;var y=new this.constructor(o);return this.state!==c?d(y,this.state===h?f:b,this.outcome):this.queue.push(new p(y,f,b)),y},p.prototype.callFulfilled=function(f){a.resolve(this.promise,f)},p.prototype.otherCallFulfilled=function(f){d(this.promise,this.onFulfilled,f)},p.prototype.callRejected=function(f){a.reject(this.promise,f)},p.prototype.otherCallRejected=function(f){d(this.promise,this.onRejected,f)},a.resolve=function(f,b){var y=g(_,b);if(y.status==="error")return a.reject(f,y.value);var E=y.value;if(E)m(f,E);else{f.state=h,f.outcome=b;for(var C=-1,I=f.queue.length;++C<I;)f.queue[C].callFulfilled(b)}return f},a.reject=function(f,b){f.state=l,f.outcome=b;for(var y=-1,E=f.queue.length;++y<E;)f.queue[y].callRejected(b);return f},u.resolve=function(f){return f instanceof this?f:a.resolve(new this(o),f)},u.reject=function(f){var b=new this(o);return a.reject(b,f)},u.all=function(f){var b=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=f.length,E=!1;if(!y)return this.resolve([]);for(var C=new Array(y),I=0,x=-1,A=new this(o);++x<y;)O(f[x],x);return A;function O(L,V){b.resolve(L).then(function(T){C[V]=T,++I!==y||E||(E=!0,a.resolve(A,C))},function(T){E||(E=!0,a.reject(A,T))})}},u.race=function(f){var b=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=f.length,E=!1;if(!y)return this.resolve([]);for(var C=-1,I=new this(o);++C<y;)x=f[C],b.resolve(x).then(function(A){E||(E=!0,a.resolve(I,A))},function(A){E||(E=!0,a.reject(I,A))});var x;return I}},{immediate:36}],38:[function(e,i,n){var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),i.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,i,n){var r=e("./zlib/deflate"),o=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/messages"),h=e("./zlib/zstream"),c=Object.prototype.toString,u=0,p=-1,d=0,_=8;function m(f){if(!(this instanceof m))return new m(f);this.options=o.assign({level:p,method:_,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},f||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var y=r.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(y!==u)throw new Error(l[y]);if(b.header&&r.deflateSetHeader(this.strm,b.header),b.dictionary){var E;if(E=typeof b.dictionary=="string"?a.string2buf(b.dictionary):c.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(y=r.deflateSetDictionary(this.strm,E))!==u)throw new Error(l[y]);this._dict_set=!0}}function g(f,b){var y=new m(b);if(y.push(f,!0),y.err)throw y.msg||l[y.err];return y.result}m.prototype.push=function(f,b){var y,E,C=this.strm,I=this.options.chunkSize;if(this.ended)return!1;E=b===~~b?b:b===!0?4:0,typeof f=="string"?C.input=a.string2buf(f):c.call(f)==="[object ArrayBuffer]"?C.input=new Uint8Array(f):C.input=f,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(I),C.next_out=0,C.avail_out=I),(y=r.deflate(C,E))!==1&&y!==u)return this.onEnd(y),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||E!==4&&E!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(C.output,C.next_out))):this.onData(o.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&y!==1);return E===4?(y=r.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===u):E!==2||(this.onEnd(u),!(C.avail_out=0))},m.prototype.onData=function(f){this.chunks.push(f)},m.prototype.onEnd=function(f){f===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},n.Deflate=m,n.deflate=g,n.deflateRaw=function(f,b){return(b=b||{}).raw=!0,g(f,b)},n.gzip=function(f,b){return(b=b||{}).gzip=!0,g(f,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,i,n){var r=e("./zlib/inflate"),o=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/constants"),h=e("./zlib/messages"),c=e("./zlib/zstream"),u=e("./zlib/gzheader"),p=Object.prototype.toString;function d(m){if(!(this instanceof d))return new d(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||m&&m.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&!(15&g.windowBits)&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var f=r.inflateInit2(this.strm,g.windowBits);if(f!==l.Z_OK)throw new Error(h[f]);this.header=new u,r.inflateGetHeader(this.strm,this.header)}function _(m,g){var f=new d(g);if(f.push(m,!0),f.err)throw f.msg||h[f.err];return f.result}d.prototype.push=function(m,g){var f,b,y,E,C,I,x=this.strm,A=this.options.chunkSize,O=this.options.dictionary,L=!1;if(this.ended)return!1;b=g===~~g?g:g===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof m=="string"?x.input=a.binstring2buf(m):p.call(m)==="[object ArrayBuffer]"?x.input=new Uint8Array(m):x.input=m,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new o.Buf8(A),x.next_out=0,x.avail_out=A),(f=r.inflate(x,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&O&&(I=typeof O=="string"?a.string2buf(O):p.call(O)==="[object ArrayBuffer]"?new Uint8Array(O):O,f=r.inflateSetDictionary(this.strm,I)),f===l.Z_BUF_ERROR&&L===!0&&(f=l.Z_OK,L=!1),f!==l.Z_STREAM_END&&f!==l.Z_OK)return this.onEnd(f),!(this.ended=!0);x.next_out&&(x.avail_out!==0&&f!==l.Z_STREAM_END&&(x.avail_in!==0||b!==l.Z_FINISH&&b!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=a.utf8border(x.output,x.next_out),E=x.next_out-y,C=a.buf2string(x.output,y),x.next_out=E,x.avail_out=A-E,E&&o.arraySet(x.output,x.output,y,E,0),this.onData(C)):this.onData(o.shrinkBuf(x.output,x.next_out)))),x.avail_in===0&&x.avail_out===0&&(L=!0)}while((0<x.avail_in||x.avail_out===0)&&f!==l.Z_STREAM_END);return f===l.Z_STREAM_END&&(b=l.Z_FINISH),b===l.Z_FINISH?(f=r.inflateEnd(this.strm),this.onEnd(f),this.ended=!0,f===l.Z_OK):b!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(x.avail_out=0))},d.prototype.onData=function(m){this.chunks.push(m)},d.prototype.onEnd=function(m){m===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},n.Inflate=d,n.inflate=_,n.inflateRaw=function(m,g){return(g=g||{}).raw=!0,_(m,g)},n.ungzip=_},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,i,n){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(l){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var c=h.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var u in c)c.hasOwnProperty(u)&&(l[u]=c[u])}}return l},n.shrinkBuf=function(l,h){return l.length===h?l:l.subarray?l.subarray(0,h):(l.length=h,l)};var o={arraySet:function(l,h,c,u,p){if(h.subarray&&l.subarray)l.set(h.subarray(c,c+u),p);else for(var d=0;d<u;d++)l[p+d]=h[c+d]},flattenChunks:function(l){var h,c,u,p,d,_;for(h=u=0,c=l.length;h<c;h++)u+=l[h].length;for(_=new Uint8Array(u),h=p=0,c=l.length;h<c;h++)d=l[h],_.set(d,p),p+=d.length;return _}},a={arraySet:function(l,h,c,u,p){for(var d=0;d<u;d++)l[p+d]=h[c+d]},flattenChunks:function(l){return[].concat.apply([],l)}};n.setTyped=function(l){l?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(r)},{}],42:[function(e,i,n){var r=e("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new r.Buf8(256),h=0;h<256;h++)l[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function c(u,p){if(p<65537&&(u.subarray&&a||!u.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(u,p));for(var d="",_=0;_<p;_++)d+=String.fromCharCode(u[_]);return d}l[254]=l[254]=1,n.string2buf=function(u){var p,d,_,m,g,f=u.length,b=0;for(m=0;m<f;m++)(64512&(d=u.charCodeAt(m)))==55296&&m+1<f&&(64512&(_=u.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(_-56320),m++),b+=d<128?1:d<2048?2:d<65536?3:4;for(p=new r.Buf8(b),m=g=0;g<b;m++)(64512&(d=u.charCodeAt(m)))==55296&&m+1<f&&(64512&(_=u.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(_-56320),m++),d<128?p[g++]=d:(d<2048?p[g++]=192|d>>>6:(d<65536?p[g++]=224|d>>>12:(p[g++]=240|d>>>18,p[g++]=128|d>>>12&63),p[g++]=128|d>>>6&63),p[g++]=128|63&d);return p},n.buf2binstring=function(u){return c(u,u.length)},n.binstring2buf=function(u){for(var p=new r.Buf8(u.length),d=0,_=p.length;d<_;d++)p[d]=u.charCodeAt(d);return p},n.buf2string=function(u,p){var d,_,m,g,f=p||u.length,b=new Array(2*f);for(d=_=0;d<f;)if((m=u[d++])<128)b[_++]=m;else if(4<(g=l[m]))b[_++]=65533,d+=g-1;else{for(m&=g===2?31:g===3?15:7;1<g&&d<f;)m=m<<6|63&u[d++],g--;1<g?b[_++]=65533:m<65536?b[_++]=m:(m-=65536,b[_++]=55296|m>>10&1023,b[_++]=56320|1023&m)}return c(b,_)},n.utf8border=function(u,p){var d;for((p=p||u.length)>u.length&&(p=u.length),d=p-1;0<=d&&(192&u[d])==128;)d--;return d<0||d===0?p:d+l[u[d]]>p?d:p}},{"./common":41}],43:[function(e,i,n){i.exports=function(r,o,a,l){for(var h=65535&r|0,c=r>>>16&65535|0,u=0;a!==0;){for(a-=u=2e3<a?2e3:a;c=c+(h=h+o[l++]|0)|0,--u;);h%=65521,c%=65521}return h|c<<16|0}},{}],44:[function(e,i,n){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,i,n){var r=function(){for(var o,a=[],l=0;l<256;l++){o=l;for(var h=0;h<8;h++)o=1&o?3988292384^o>>>1:o>>>1;a[l]=o}return a}();i.exports=function(o,a,l,h){var c=r,u=h+l;o^=-1;for(var p=h;p<u;p++)o=o>>>8^c[255&(o^a[p])];return-1^o}},{}],46:[function(e,i,n){var r,o=e("../utils/common"),a=e("./trees"),l=e("./adler32"),h=e("./crc32"),c=e("./messages"),u=0,p=4,d=0,_=-2,m=-1,g=4,f=2,b=8,y=9,E=286,C=30,I=19,x=2*E+1,A=15,O=3,L=258,V=L+O+1,T=42,N=113,v=1,M=2,Q=3,j=4;function it(w,Z){return w.msg=c[Z],Z}function G(w){return(w<<1)-(4<w?9:0)}function nt(w){for(var Z=w.length;0<=--Z;)w[Z]=0}function $(w){var Z=w.state,Y=Z.pending;Y>w.avail_out&&(Y=w.avail_out),Y!==0&&(o.arraySet(w.output,Z.pending_buf,Z.pending_out,Y,w.next_out),w.next_out+=Y,Z.pending_out+=Y,w.total_out+=Y,w.avail_out-=Y,Z.pending-=Y,Z.pending===0&&(Z.pending_out=0))}function B(w,Z){a._tr_flush_block(w,0<=w.block_start?w.block_start:-1,w.strstart-w.block_start,Z),w.block_start=w.strstart,$(w.strm)}function at(w,Z){w.pending_buf[w.pending++]=Z}function J(w,Z){w.pending_buf[w.pending++]=Z>>>8&255,w.pending_buf[w.pending++]=255&Z}function st(w,Z){var Y,R,P=w.max_chain_length,z=w.strstart,K=w.prev_length,H=w.nice_match,U=w.strstart>w.w_size-V?w.strstart-(w.w_size-V):0,X=w.window,et=w.w_mask,tt=w.prev,ht=w.strstart+L,mt=X[z+K-1],gt=X[z+K];w.prev_length>=w.good_match&&(P>>=2),H>w.lookahead&&(H=w.lookahead);do if(X[(Y=Z)+K]===gt&&X[Y+K-1]===mt&&X[Y]===X[z]&&X[++Y]===X[z+1]){z+=2,Y++;do;while(X[++z]===X[++Y]&&X[++z]===X[++Y]&&X[++z]===X[++Y]&&X[++z]===X[++Y]&&X[++z]===X[++Y]&&X[++z]===X[++Y]&&X[++z]===X[++Y]&&X[++z]===X[++Y]&&z<ht);if(R=L-(ht-z),z=ht-L,K<R){if(w.match_start=Z,H<=(K=R))break;mt=X[z+K-1],gt=X[z+K]}}while((Z=tt[Z&et])>U&&--P!=0);return K<=w.lookahead?K:w.lookahead}function dt(w){var Z,Y,R,P,z,K,H,U,X,et,tt=w.w_size;do{if(P=w.window_size-w.lookahead-w.strstart,w.strstart>=tt+(tt-V)){for(o.arraySet(w.window,w.window,tt,tt,0),w.match_start-=tt,w.strstart-=tt,w.block_start-=tt,Z=Y=w.hash_size;R=w.head[--Z],w.head[Z]=tt<=R?R-tt:0,--Y;);for(Z=Y=tt;R=w.prev[--Z],w.prev[Z]=tt<=R?R-tt:0,--Y;);P+=tt}if(w.strm.avail_in===0)break;if(K=w.strm,H=w.window,U=w.strstart+w.lookahead,X=P,et=void 0,et=K.avail_in,X<et&&(et=X),Y=et===0?0:(K.avail_in-=et,o.arraySet(H,K.input,K.next_in,et,U),K.state.wrap===1?K.adler=l(K.adler,H,et,U):K.state.wrap===2&&(K.adler=h(K.adler,H,et,U)),K.next_in+=et,K.total_in+=et,et),w.lookahead+=Y,w.lookahead+w.insert>=O)for(z=w.strstart-w.insert,w.ins_h=w.window[z],w.ins_h=(w.ins_h<<w.hash_shift^w.window[z+1])&w.hash_mask;w.insert&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[z+O-1])&w.hash_mask,w.prev[z&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=z,z++,w.insert--,!(w.lookahead+w.insert<O)););}while(w.lookahead<V&&w.strm.avail_in!==0)}function wt(w,Z){for(var Y,R;;){if(w.lookahead<V){if(dt(w),w.lookahead<V&&Z===u)return v;if(w.lookahead===0)break}if(Y=0,w.lookahead>=O&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+O-1])&w.hash_mask,Y=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),Y!==0&&w.strstart-Y<=w.w_size-V&&(w.match_length=st(w,Y)),w.match_length>=O)if(R=a._tr_tally(w,w.strstart-w.match_start,w.match_length-O),w.lookahead-=w.match_length,w.match_length<=w.max_lazy_match&&w.lookahead>=O){for(w.match_length--;w.strstart++,w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+O-1])&w.hash_mask,Y=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart,--w.match_length!=0;);w.strstart++}else w.strstart+=w.match_length,w.match_length=0,w.ins_h=w.window[w.strstart],w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+1])&w.hash_mask;else R=a._tr_tally(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++;if(R&&(B(w,!1),w.strm.avail_out===0))return v}return w.insert=w.strstart<O-1?w.strstart:O-1,Z===p?(B(w,!0),w.strm.avail_out===0?Q:j):w.last_lit&&(B(w,!1),w.strm.avail_out===0)?v:M}function pt(w,Z){for(var Y,R,P;;){if(w.lookahead<V){if(dt(w),w.lookahead<V&&Z===u)return v;if(w.lookahead===0)break}if(Y=0,w.lookahead>=O&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+O-1])&w.hash_mask,Y=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),w.prev_length=w.match_length,w.prev_match=w.match_start,w.match_length=O-1,Y!==0&&w.prev_length<w.max_lazy_match&&w.strstart-Y<=w.w_size-V&&(w.match_length=st(w,Y),w.match_length<=5&&(w.strategy===1||w.match_length===O&&4096<w.strstart-w.match_start)&&(w.match_length=O-1)),w.prev_length>=O&&w.match_length<=w.prev_length){for(P=w.strstart+w.lookahead-O,R=a._tr_tally(w,w.strstart-1-w.prev_match,w.prev_length-O),w.lookahead-=w.prev_length-1,w.prev_length-=2;++w.strstart<=P&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+O-1])&w.hash_mask,Y=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),--w.prev_length!=0;);if(w.match_available=0,w.match_length=O-1,w.strstart++,R&&(B(w,!1),w.strm.avail_out===0))return v}else if(w.match_available){if((R=a._tr_tally(w,0,w.window[w.strstart-1]))&&B(w,!1),w.strstart++,w.lookahead--,w.strm.avail_out===0)return v}else w.match_available=1,w.strstart++,w.lookahead--}return w.match_available&&(R=a._tr_tally(w,0,w.window[w.strstart-1]),w.match_available=0),w.insert=w.strstart<O-1?w.strstart:O-1,Z===p?(B(w,!0),w.strm.avail_out===0?Q:j):w.last_lit&&(B(w,!1),w.strm.avail_out===0)?v:M}function _t(w,Z,Y,R,P){this.good_length=w,this.max_lazy=Z,this.nice_length=Y,this.max_chain=R,this.func=P}function yt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*x),this.dyn_dtree=new o.Buf16(2*(2*C+1)),this.bl_tree=new o.Buf16(2*(2*I+1)),nt(this.dyn_ltree),nt(this.dyn_dtree),nt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(A+1),this.heap=new o.Buf16(2*E+1),nt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*E+1),nt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function It(w){var Z;return w&&w.state?(w.total_in=w.total_out=0,w.data_type=f,(Z=w.state).pending=0,Z.pending_out=0,Z.wrap<0&&(Z.wrap=-Z.wrap),Z.status=Z.wrap?T:N,w.adler=Z.wrap===2?0:1,Z.last_flush=u,a._tr_init(Z),d):it(w,_)}function Vt(w){var Z=It(w);return Z===d&&function(Y){Y.window_size=2*Y.w_size,nt(Y.head),Y.max_lazy_match=r[Y.level].max_lazy,Y.good_match=r[Y.level].good_length,Y.nice_match=r[Y.level].nice_length,Y.max_chain_length=r[Y.level].max_chain,Y.strstart=0,Y.block_start=0,Y.lookahead=0,Y.insert=0,Y.match_length=Y.prev_length=O-1,Y.match_available=0,Y.ins_h=0}(w.state),Z}function $t(w,Z,Y,R,P,z){if(!w)return _;var K=1;if(Z===m&&(Z=6),R<0?(K=0,R=-R):15<R&&(K=2,R-=16),P<1||y<P||Y!==b||R<8||15<R||Z<0||9<Z||z<0||g<z)return it(w,_);R===8&&(R=9);var H=new yt;return(w.state=H).strm=w,H.wrap=K,H.gzhead=null,H.w_bits=R,H.w_size=1<<H.w_bits,H.w_mask=H.w_size-1,H.hash_bits=P+7,H.hash_size=1<<H.hash_bits,H.hash_mask=H.hash_size-1,H.hash_shift=~~((H.hash_bits+O-1)/O),H.window=new o.Buf8(2*H.w_size),H.head=new o.Buf16(H.hash_size),H.prev=new o.Buf16(H.w_size),H.lit_bufsize=1<<P+6,H.pending_buf_size=4*H.lit_bufsize,H.pending_buf=new o.Buf8(H.pending_buf_size),H.d_buf=1*H.lit_bufsize,H.l_buf=3*H.lit_bufsize,H.level=Z,H.strategy=z,H.method=Y,Vt(w)}r=[new _t(0,0,0,0,function(w,Z){var Y=65535;for(Y>w.pending_buf_size-5&&(Y=w.pending_buf_size-5);;){if(w.lookahead<=1){if(dt(w),w.lookahead===0&&Z===u)return v;if(w.lookahead===0)break}w.strstart+=w.lookahead,w.lookahead=0;var R=w.block_start+Y;if((w.strstart===0||w.strstart>=R)&&(w.lookahead=w.strstart-R,w.strstart=R,B(w,!1),w.strm.avail_out===0)||w.strstart-w.block_start>=w.w_size-V&&(B(w,!1),w.strm.avail_out===0))return v}return w.insert=0,Z===p?(B(w,!0),w.strm.avail_out===0?Q:j):(w.strstart>w.block_start&&(B(w,!1),w.strm.avail_out),v)}),new _t(4,4,8,4,wt),new _t(4,5,16,8,wt),new _t(4,6,32,32,wt),new _t(4,4,16,16,pt),new _t(8,16,32,32,pt),new _t(8,16,128,128,pt),new _t(8,32,128,256,pt),new _t(32,128,258,1024,pt),new _t(32,258,258,4096,pt)],n.deflateInit=function(w,Z){return $t(w,Z,b,15,8,0)},n.deflateInit2=$t,n.deflateReset=Vt,n.deflateResetKeep=It,n.deflateSetHeader=function(w,Z){return w&&w.state?w.state.wrap!==2?_:(w.state.gzhead=Z,d):_},n.deflate=function(w,Z){var Y,R,P,z;if(!w||!w.state||5<Z||Z<0)return w?it(w,_):_;if(R=w.state,!w.output||!w.input&&w.avail_in!==0||R.status===666&&Z!==p)return it(w,w.avail_out===0?-5:_);if(R.strm=w,Y=R.last_flush,R.last_flush=Z,R.status===T)if(R.wrap===2)w.adler=0,at(R,31),at(R,139),at(R,8),R.gzhead?(at(R,(R.gzhead.text?1:0)+(R.gzhead.hcrc?2:0)+(R.gzhead.extra?4:0)+(R.gzhead.name?8:0)+(R.gzhead.comment?16:0)),at(R,255&R.gzhead.time),at(R,R.gzhead.time>>8&255),at(R,R.gzhead.time>>16&255),at(R,R.gzhead.time>>24&255),at(R,R.level===9?2:2<=R.strategy||R.level<2?4:0),at(R,255&R.gzhead.os),R.gzhead.extra&&R.gzhead.extra.length&&(at(R,255&R.gzhead.extra.length),at(R,R.gzhead.extra.length>>8&255)),R.gzhead.hcrc&&(w.adler=h(w.adler,R.pending_buf,R.pending,0)),R.gzindex=0,R.status=69):(at(R,0),at(R,0),at(R,0),at(R,0),at(R,0),at(R,R.level===9?2:2<=R.strategy||R.level<2?4:0),at(R,3),R.status=N);else{var K=b+(R.w_bits-8<<4)<<8;K|=(2<=R.strategy||R.level<2?0:R.level<6?1:R.level===6?2:3)<<6,R.strstart!==0&&(K|=32),K+=31-K%31,R.status=N,J(R,K),R.strstart!==0&&(J(R,w.adler>>>16),J(R,65535&w.adler)),w.adler=1}if(R.status===69)if(R.gzhead.extra){for(P=R.pending;R.gzindex<(65535&R.gzhead.extra.length)&&(R.pending!==R.pending_buf_size||(R.gzhead.hcrc&&R.pending>P&&(w.adler=h(w.adler,R.pending_buf,R.pending-P,P)),$(w),P=R.pending,R.pending!==R.pending_buf_size));)at(R,255&R.gzhead.extra[R.gzindex]),R.gzindex++;R.gzhead.hcrc&&R.pending>P&&(w.adler=h(w.adler,R.pending_buf,R.pending-P,P)),R.gzindex===R.gzhead.extra.length&&(R.gzindex=0,R.status=73)}else R.status=73;if(R.status===73)if(R.gzhead.name){P=R.pending;do{if(R.pending===R.pending_buf_size&&(R.gzhead.hcrc&&R.pending>P&&(w.adler=h(w.adler,R.pending_buf,R.pending-P,P)),$(w),P=R.pending,R.pending===R.pending_buf_size)){z=1;break}z=R.gzindex<R.gzhead.name.length?255&R.gzhead.name.charCodeAt(R.gzindex++):0,at(R,z)}while(z!==0);R.gzhead.hcrc&&R.pending>P&&(w.adler=h(w.adler,R.pending_buf,R.pending-P,P)),z===0&&(R.gzindex=0,R.status=91)}else R.status=91;if(R.status===91)if(R.gzhead.comment){P=R.pending;do{if(R.pending===R.pending_buf_size&&(R.gzhead.hcrc&&R.pending>P&&(w.adler=h(w.adler,R.pending_buf,R.pending-P,P)),$(w),P=R.pending,R.pending===R.pending_buf_size)){z=1;break}z=R.gzindex<R.gzhead.comment.length?255&R.gzhead.comment.charCodeAt(R.gzindex++):0,at(R,z)}while(z!==0);R.gzhead.hcrc&&R.pending>P&&(w.adler=h(w.adler,R.pending_buf,R.pending-P,P)),z===0&&(R.status=103)}else R.status=103;if(R.status===103&&(R.gzhead.hcrc?(R.pending+2>R.pending_buf_size&&$(w),R.pending+2<=R.pending_buf_size&&(at(R,255&w.adler),at(R,w.adler>>8&255),w.adler=0,R.status=N)):R.status=N),R.pending!==0){if($(w),w.avail_out===0)return R.last_flush=-1,d}else if(w.avail_in===0&&G(Z)<=G(Y)&&Z!==p)return it(w,-5);if(R.status===666&&w.avail_in!==0)return it(w,-5);if(w.avail_in!==0||R.lookahead!==0||Z!==u&&R.status!==666){var H=R.strategy===2?function(U,X){for(var et;;){if(U.lookahead===0&&(dt(U),U.lookahead===0)){if(X===u)return v;break}if(U.match_length=0,et=a._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++,et&&(B(U,!1),U.strm.avail_out===0))return v}return U.insert=0,X===p?(B(U,!0),U.strm.avail_out===0?Q:j):U.last_lit&&(B(U,!1),U.strm.avail_out===0)?v:M}(R,Z):R.strategy===3?function(U,X){for(var et,tt,ht,mt,gt=U.window;;){if(U.lookahead<=L){if(dt(U),U.lookahead<=L&&X===u)return v;if(U.lookahead===0)break}if(U.match_length=0,U.lookahead>=O&&0<U.strstart&&(tt=gt[ht=U.strstart-1])===gt[++ht]&&tt===gt[++ht]&&tt===gt[++ht]){mt=U.strstart+L;do;while(tt===gt[++ht]&&tt===gt[++ht]&&tt===gt[++ht]&&tt===gt[++ht]&&tt===gt[++ht]&&tt===gt[++ht]&&tt===gt[++ht]&&tt===gt[++ht]&&ht<mt);U.match_length=L-(mt-ht),U.match_length>U.lookahead&&(U.match_length=U.lookahead)}if(U.match_length>=O?(et=a._tr_tally(U,1,U.match_length-O),U.lookahead-=U.match_length,U.strstart+=U.match_length,U.match_length=0):(et=a._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++),et&&(B(U,!1),U.strm.avail_out===0))return v}return U.insert=0,X===p?(B(U,!0),U.strm.avail_out===0?Q:j):U.last_lit&&(B(U,!1),U.strm.avail_out===0)?v:M}(R,Z):r[R.level].func(R,Z);if(H!==Q&&H!==j||(R.status=666),H===v||H===Q)return w.avail_out===0&&(R.last_flush=-1),d;if(H===M&&(Z===1?a._tr_align(R):Z!==5&&(a._tr_stored_block(R,0,0,!1),Z===3&&(nt(R.head),R.lookahead===0&&(R.strstart=0,R.block_start=0,R.insert=0))),$(w),w.avail_out===0))return R.last_flush=-1,d}return Z!==p?d:R.wrap<=0?1:(R.wrap===2?(at(R,255&w.adler),at(R,w.adler>>8&255),at(R,w.adler>>16&255),at(R,w.adler>>24&255),at(R,255&w.total_in),at(R,w.total_in>>8&255),at(R,w.total_in>>16&255),at(R,w.total_in>>24&255)):(J(R,w.adler>>>16),J(R,65535&w.adler)),$(w),0<R.wrap&&(R.wrap=-R.wrap),R.pending!==0?d:1)},n.deflateEnd=function(w){var Z;return w&&w.state?(Z=w.state.status)!==T&&Z!==69&&Z!==73&&Z!==91&&Z!==103&&Z!==N&&Z!==666?it(w,_):(w.state=null,Z===N?it(w,-3):d):_},n.deflateSetDictionary=function(w,Z){var Y,R,P,z,K,H,U,X,et=Z.length;if(!w||!w.state||(z=(Y=w.state).wrap)===2||z===1&&Y.status!==T||Y.lookahead)return _;for(z===1&&(w.adler=l(w.adler,Z,et,0)),Y.wrap=0,et>=Y.w_size&&(z===0&&(nt(Y.head),Y.strstart=0,Y.block_start=0,Y.insert=0),X=new o.Buf8(Y.w_size),o.arraySet(X,Z,et-Y.w_size,Y.w_size,0),Z=X,et=Y.w_size),K=w.avail_in,H=w.next_in,U=w.input,w.avail_in=et,w.next_in=0,w.input=Z,dt(Y);Y.lookahead>=O;){for(R=Y.strstart,P=Y.lookahead-(O-1);Y.ins_h=(Y.ins_h<<Y.hash_shift^Y.window[R+O-1])&Y.hash_mask,Y.prev[R&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=R,R++,--P;);Y.strstart=R,Y.lookahead=O-1,dt(Y)}return Y.strstart+=Y.lookahead,Y.block_start=Y.strstart,Y.insert=Y.lookahead,Y.lookahead=0,Y.match_length=Y.prev_length=O-1,Y.match_available=0,w.next_in=H,w.input=U,w.avail_in=K,Y.wrap=z,d},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,i,n){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,i,n){i.exports=function(r,o){var a,l,h,c,u,p,d,_,m,g,f,b,y,E,C,I,x,A,O,L,V,T,N,v,M;a=r.state,l=r.next_in,v=r.input,h=l+(r.avail_in-5),c=r.next_out,M=r.output,u=c-(o-r.avail_out),p=c+(r.avail_out-257),d=a.dmax,_=a.wsize,m=a.whave,g=a.wnext,f=a.window,b=a.hold,y=a.bits,E=a.lencode,C=a.distcode,I=(1<<a.lenbits)-1,x=(1<<a.distbits)-1;t:do{y<15&&(b+=v[l++]<<y,y+=8,b+=v[l++]<<y,y+=8),A=E[b&I];e:for(;;){if(b>>>=O=A>>>24,y-=O,(O=A>>>16&255)===0)M[c++]=65535&A;else{if(!(16&O)){if(!(64&O)){A=E[(65535&A)+(b&(1<<O)-1)];continue e}if(32&O){a.mode=12;break t}r.msg="invalid literal/length code",a.mode=30;break t}L=65535&A,(O&=15)&&(y<O&&(b+=v[l++]<<y,y+=8),L+=b&(1<<O)-1,b>>>=O,y-=O),y<15&&(b+=v[l++]<<y,y+=8,b+=v[l++]<<y,y+=8),A=C[b&x];s:for(;;){if(b>>>=O=A>>>24,y-=O,!(16&(O=A>>>16&255))){if(!(64&O)){A=C[(65535&A)+(b&(1<<O)-1)];continue s}r.msg="invalid distance code",a.mode=30;break t}if(V=65535&A,y<(O&=15)&&(b+=v[l++]<<y,(y+=8)<O&&(b+=v[l++]<<y,y+=8)),d<(V+=b&(1<<O)-1)){r.msg="invalid distance too far back",a.mode=30;break t}if(b>>>=O,y-=O,(O=c-u)<V){if(m<(O=V-O)&&a.sane){r.msg="invalid distance too far back",a.mode=30;break t}if(N=f,(T=0)===g){if(T+=_-O,O<L){for(L-=O;M[c++]=f[T++],--O;);T=c-V,N=M}}else if(g<O){if(T+=_+g-O,(O-=g)<L){for(L-=O;M[c++]=f[T++],--O;);if(T=0,g<L){for(L-=O=g;M[c++]=f[T++],--O;);T=c-V,N=M}}}else if(T+=g-O,O<L){for(L-=O;M[c++]=f[T++],--O;);T=c-V,N=M}for(;2<L;)M[c++]=N[T++],M[c++]=N[T++],M[c++]=N[T++],L-=3;L&&(M[c++]=N[T++],1<L&&(M[c++]=N[T++]))}else{for(T=c-V;M[c++]=M[T++],M[c++]=M[T++],M[c++]=M[T++],2<(L-=3););L&&(M[c++]=M[T++],1<L&&(M[c++]=M[T++]))}break}}break}}while(l<h&&c<p);l-=L=y>>3,b&=(1<<(y-=L<<3))-1,r.next_in=l,r.next_out=c,r.avail_in=l<h?h-l+5:5-(l-h),r.avail_out=c<p?p-c+257:257-(c-p),a.hold=b,a.bits=y}},{}],49:[function(e,i,n){var r=e("../utils/common"),o=e("./adler32"),a=e("./crc32"),l=e("./inffast"),h=e("./inftrees"),c=1,u=2,p=0,d=-2,_=1,m=852,g=592;function f(T){return(T>>>24&255)+(T>>>8&65280)+((65280&T)<<8)+((255&T)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(T){var N;return T&&T.state?(N=T.state,T.total_in=T.total_out=N.total=0,T.msg="",N.wrap&&(T.adler=1&N.wrap),N.mode=_,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new r.Buf32(m),N.distcode=N.distdyn=new r.Buf32(g),N.sane=1,N.back=-1,p):d}function E(T){var N;return T&&T.state?((N=T.state).wsize=0,N.whave=0,N.wnext=0,y(T)):d}function C(T,N){var v,M;return T&&T.state?(M=T.state,N<0?(v=0,N=-N):(v=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?d:(M.window!==null&&M.wbits!==N&&(M.window=null),M.wrap=v,M.wbits=N,E(T))):d}function I(T,N){var v,M;return T?(M=new b,(T.state=M).window=null,(v=C(T,N))!==p&&(T.state=null),v):d}var x,A,O=!0;function L(T){if(O){var N;for(x=new r.Buf32(512),A=new r.Buf32(32),N=0;N<144;)T.lens[N++]=8;for(;N<256;)T.lens[N++]=9;for(;N<280;)T.lens[N++]=7;for(;N<288;)T.lens[N++]=8;for(h(c,T.lens,0,288,x,0,T.work,{bits:9}),N=0;N<32;)T.lens[N++]=5;h(u,T.lens,0,32,A,0,T.work,{bits:5}),O=!1}T.lencode=x,T.lenbits=9,T.distcode=A,T.distbits=5}function V(T,N,v,M){var Q,j=T.state;return j.window===null&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new r.Buf8(j.wsize)),M>=j.wsize?(r.arraySet(j.window,N,v-j.wsize,j.wsize,0),j.wnext=0,j.whave=j.wsize):(M<(Q=j.wsize-j.wnext)&&(Q=M),r.arraySet(j.window,N,v-M,Q,j.wnext),(M-=Q)?(r.arraySet(j.window,N,v-M,M,0),j.wnext=M,j.whave=j.wsize):(j.wnext+=Q,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=Q))),0}n.inflateReset=E,n.inflateReset2=C,n.inflateResetKeep=y,n.inflateInit=function(T){return I(T,15)},n.inflateInit2=I,n.inflate=function(T,N){var v,M,Q,j,it,G,nt,$,B,at,J,st,dt,wt,pt,_t,yt,It,Vt,$t,w,Z,Y,R,P=0,z=new r.Buf8(4),K=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!T||!T.state||!T.output||!T.input&&T.avail_in!==0)return d;(v=T.state).mode===12&&(v.mode=13),it=T.next_out,Q=T.output,nt=T.avail_out,j=T.next_in,M=T.input,G=T.avail_in,$=v.hold,B=v.bits,at=G,J=nt,Z=p;t:for(;;)switch(v.mode){case _:if(v.wrap===0){v.mode=13;break}for(;B<16;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if(2&v.wrap&&$===35615){z[v.check=0]=255&$,z[1]=$>>>8&255,v.check=a(v.check,z,2,0),B=$=0,v.mode=2;break}if(v.flags=0,v.head&&(v.head.done=!1),!(1&v.wrap)||(((255&$)<<8)+($>>8))%31){T.msg="incorrect header check",v.mode=30;break}if((15&$)!=8){T.msg="unknown compression method",v.mode=30;break}if(B-=4,w=8+(15&($>>>=4)),v.wbits===0)v.wbits=w;else if(w>v.wbits){T.msg="invalid window size",v.mode=30;break}v.dmax=1<<w,T.adler=v.check=1,v.mode=512&$?10:12,B=$=0;break;case 2:for(;B<16;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if(v.flags=$,(255&v.flags)!=8){T.msg="unknown compression method",v.mode=30;break}if(57344&v.flags){T.msg="unknown header flags set",v.mode=30;break}v.head&&(v.head.text=$>>8&1),512&v.flags&&(z[0]=255&$,z[1]=$>>>8&255,v.check=a(v.check,z,2,0)),B=$=0,v.mode=3;case 3:for(;B<32;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}v.head&&(v.head.time=$),512&v.flags&&(z[0]=255&$,z[1]=$>>>8&255,z[2]=$>>>16&255,z[3]=$>>>24&255,v.check=a(v.check,z,4,0)),B=$=0,v.mode=4;case 4:for(;B<16;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}v.head&&(v.head.xflags=255&$,v.head.os=$>>8),512&v.flags&&(z[0]=255&$,z[1]=$>>>8&255,v.check=a(v.check,z,2,0)),B=$=0,v.mode=5;case 5:if(1024&v.flags){for(;B<16;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}v.length=$,v.head&&(v.head.extra_len=$),512&v.flags&&(z[0]=255&$,z[1]=$>>>8&255,v.check=a(v.check,z,2,0)),B=$=0}else v.head&&(v.head.extra=null);v.mode=6;case 6:if(1024&v.flags&&(G<(st=v.length)&&(st=G),st&&(v.head&&(w=v.head.extra_len-v.length,v.head.extra||(v.head.extra=new Array(v.head.extra_len)),r.arraySet(v.head.extra,M,j,st,w)),512&v.flags&&(v.check=a(v.check,M,st,j)),G-=st,j+=st,v.length-=st),v.length))break t;v.length=0,v.mode=7;case 7:if(2048&v.flags){if(G===0)break t;for(st=0;w=M[j+st++],v.head&&w&&v.length<65536&&(v.head.name+=String.fromCharCode(w)),w&&st<G;);if(512&v.flags&&(v.check=a(v.check,M,st,j)),G-=st,j+=st,w)break t}else v.head&&(v.head.name=null);v.length=0,v.mode=8;case 8:if(4096&v.flags){if(G===0)break t;for(st=0;w=M[j+st++],v.head&&w&&v.length<65536&&(v.head.comment+=String.fromCharCode(w)),w&&st<G;);if(512&v.flags&&(v.check=a(v.check,M,st,j)),G-=st,j+=st,w)break t}else v.head&&(v.head.comment=null);v.mode=9;case 9:if(512&v.flags){for(;B<16;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if($!==(65535&v.check)){T.msg="header crc mismatch",v.mode=30;break}B=$=0}v.head&&(v.head.hcrc=v.flags>>9&1,v.head.done=!0),T.adler=v.check=0,v.mode=12;break;case 10:for(;B<32;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}T.adler=v.check=f($),B=$=0,v.mode=11;case 11:if(v.havedict===0)return T.next_out=it,T.avail_out=nt,T.next_in=j,T.avail_in=G,v.hold=$,v.bits=B,2;T.adler=v.check=1,v.mode=12;case 12:if(N===5||N===6)break t;case 13:if(v.last){$>>>=7&B,B-=7&B,v.mode=27;break}for(;B<3;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}switch(v.last=1&$,B-=1,3&($>>>=1)){case 0:v.mode=14;break;case 1:if(L(v),v.mode=20,N!==6)break;$>>>=2,B-=2;break t;case 2:v.mode=17;break;case 3:T.msg="invalid block type",v.mode=30}$>>>=2,B-=2;break;case 14:for($>>>=7&B,B-=7&B;B<32;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if((65535&$)!=($>>>16^65535)){T.msg="invalid stored block lengths",v.mode=30;break}if(v.length=65535&$,B=$=0,v.mode=15,N===6)break t;case 15:v.mode=16;case 16:if(st=v.length){if(G<st&&(st=G),nt<st&&(st=nt),st===0)break t;r.arraySet(Q,M,j,st,it),G-=st,j+=st,nt-=st,it+=st,v.length-=st;break}v.mode=12;break;case 17:for(;B<14;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if(v.nlen=257+(31&$),$>>>=5,B-=5,v.ndist=1+(31&$),$>>>=5,B-=5,v.ncode=4+(15&$),$>>>=4,B-=4,286<v.nlen||30<v.ndist){T.msg="too many length or distance symbols",v.mode=30;break}v.have=0,v.mode=18;case 18:for(;v.have<v.ncode;){for(;B<3;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}v.lens[K[v.have++]]=7&$,$>>>=3,B-=3}for(;v.have<19;)v.lens[K[v.have++]]=0;if(v.lencode=v.lendyn,v.lenbits=7,Y={bits:v.lenbits},Z=h(0,v.lens,0,19,v.lencode,0,v.work,Y),v.lenbits=Y.bits,Z){T.msg="invalid code lengths set",v.mode=30;break}v.have=0,v.mode=19;case 19:for(;v.have<v.nlen+v.ndist;){for(;_t=(P=v.lencode[$&(1<<v.lenbits)-1])>>>16&255,yt=65535&P,!((pt=P>>>24)<=B);){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if(yt<16)$>>>=pt,B-=pt,v.lens[v.have++]=yt;else{if(yt===16){for(R=pt+2;B<R;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if($>>>=pt,B-=pt,v.have===0){T.msg="invalid bit length repeat",v.mode=30;break}w=v.lens[v.have-1],st=3+(3&$),$>>>=2,B-=2}else if(yt===17){for(R=pt+3;B<R;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}B-=pt,w=0,st=3+(7&($>>>=pt)),$>>>=3,B-=3}else{for(R=pt+7;B<R;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}B-=pt,w=0,st=11+(127&($>>>=pt)),$>>>=7,B-=7}if(v.have+st>v.nlen+v.ndist){T.msg="invalid bit length repeat",v.mode=30;break}for(;st--;)v.lens[v.have++]=w}}if(v.mode===30)break;if(v.lens[256]===0){T.msg="invalid code -- missing end-of-block",v.mode=30;break}if(v.lenbits=9,Y={bits:v.lenbits},Z=h(c,v.lens,0,v.nlen,v.lencode,0,v.work,Y),v.lenbits=Y.bits,Z){T.msg="invalid literal/lengths set",v.mode=30;break}if(v.distbits=6,v.distcode=v.distdyn,Y={bits:v.distbits},Z=h(u,v.lens,v.nlen,v.ndist,v.distcode,0,v.work,Y),v.distbits=Y.bits,Z){T.msg="invalid distances set",v.mode=30;break}if(v.mode=20,N===6)break t;case 20:v.mode=21;case 21:if(6<=G&&258<=nt){T.next_out=it,T.avail_out=nt,T.next_in=j,T.avail_in=G,v.hold=$,v.bits=B,l(T,J),it=T.next_out,Q=T.output,nt=T.avail_out,j=T.next_in,M=T.input,G=T.avail_in,$=v.hold,B=v.bits,v.mode===12&&(v.back=-1);break}for(v.back=0;_t=(P=v.lencode[$&(1<<v.lenbits)-1])>>>16&255,yt=65535&P,!((pt=P>>>24)<=B);){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if(_t&&!(240&_t)){for(It=pt,Vt=_t,$t=yt;_t=(P=v.lencode[$t+(($&(1<<It+Vt)-1)>>It)])>>>16&255,yt=65535&P,!(It+(pt=P>>>24)<=B);){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}$>>>=It,B-=It,v.back+=It}if($>>>=pt,B-=pt,v.back+=pt,v.length=yt,_t===0){v.mode=26;break}if(32&_t){v.back=-1,v.mode=12;break}if(64&_t){T.msg="invalid literal/length code",v.mode=30;break}v.extra=15&_t,v.mode=22;case 22:if(v.extra){for(R=v.extra;B<R;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}v.length+=$&(1<<v.extra)-1,$>>>=v.extra,B-=v.extra,v.back+=v.extra}v.was=v.length,v.mode=23;case 23:for(;_t=(P=v.distcode[$&(1<<v.distbits)-1])>>>16&255,yt=65535&P,!((pt=P>>>24)<=B);){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if(!(240&_t)){for(It=pt,Vt=_t,$t=yt;_t=(P=v.distcode[$t+(($&(1<<It+Vt)-1)>>It)])>>>16&255,yt=65535&P,!(It+(pt=P>>>24)<=B);){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}$>>>=It,B-=It,v.back+=It}if($>>>=pt,B-=pt,v.back+=pt,64&_t){T.msg="invalid distance code",v.mode=30;break}v.offset=yt,v.extra=15&_t,v.mode=24;case 24:if(v.extra){for(R=v.extra;B<R;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}v.offset+=$&(1<<v.extra)-1,$>>>=v.extra,B-=v.extra,v.back+=v.extra}if(v.offset>v.dmax){T.msg="invalid distance too far back",v.mode=30;break}v.mode=25;case 25:if(nt===0)break t;if(st=J-nt,v.offset>st){if((st=v.offset-st)>v.whave&&v.sane){T.msg="invalid distance too far back",v.mode=30;break}dt=st>v.wnext?(st-=v.wnext,v.wsize-st):v.wnext-st,st>v.length&&(st=v.length),wt=v.window}else wt=Q,dt=it-v.offset,st=v.length;for(nt<st&&(st=nt),nt-=st,v.length-=st;Q[it++]=wt[dt++],--st;);v.length===0&&(v.mode=21);break;case 26:if(nt===0)break t;Q[it++]=v.length,nt--,v.mode=21;break;case 27:if(v.wrap){for(;B<32;){if(G===0)break t;G--,$|=M[j++]<<B,B+=8}if(J-=nt,T.total_out+=J,v.total+=J,J&&(T.adler=v.check=v.flags?a(v.check,Q,J,it-J):o(v.check,Q,J,it-J)),J=nt,(v.flags?$:f($))!==v.check){T.msg="incorrect data check",v.mode=30;break}B=$=0}v.mode=28;case 28:if(v.wrap&&v.flags){for(;B<32;){if(G===0)break t;G--,$+=M[j++]<<B,B+=8}if($!==(4294967295&v.total)){T.msg="incorrect length check",v.mode=30;break}B=$=0}v.mode=29;case 29:Z=1;break t;case 30:Z=-3;break t;case 31:return-4;case 32:default:return d}return T.next_out=it,T.avail_out=nt,T.next_in=j,T.avail_in=G,v.hold=$,v.bits=B,(v.wsize||J!==T.avail_out&&v.mode<30&&(v.mode<27||N!==4))&&V(T,T.output,T.next_out,J-T.avail_out)?(v.mode=31,-4):(at-=T.avail_in,J-=T.avail_out,T.total_in+=at,T.total_out+=J,v.total+=J,v.wrap&&J&&(T.adler=v.check=v.flags?a(v.check,Q,J,T.next_out-J):o(v.check,Q,J,T.next_out-J)),T.data_type=v.bits+(v.last?64:0)+(v.mode===12?128:0)+(v.mode===20||v.mode===15?256:0),(at==0&&J===0||N===4)&&Z===p&&(Z=-5),Z)},n.inflateEnd=function(T){if(!T||!T.state)return d;var N=T.state;return N.window&&(N.window=null),T.state=null,p},n.inflateGetHeader=function(T,N){var v;return T&&T.state&&2&(v=T.state).wrap?((v.head=N).done=!1,p):d},n.inflateSetDictionary=function(T,N){var v,M=N.length;return T&&T.state?(v=T.state).wrap!==0&&v.mode!==11?d:v.mode===11&&o(1,N,M,0)!==v.check?-3:V(T,N,M,M)?(v.mode=31,-4):(v.havedict=1,p):d},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,i,n){var r=e("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(c,u,p,d,_,m,g,f){var b,y,E,C,I,x,A,O,L,V=f.bits,T=0,N=0,v=0,M=0,Q=0,j=0,it=0,G=0,nt=0,$=0,B=null,at=0,J=new r.Buf16(16),st=new r.Buf16(16),dt=null,wt=0;for(T=0;T<=15;T++)J[T]=0;for(N=0;N<d;N++)J[u[p+N]]++;for(Q=V,M=15;1<=M&&J[M]===0;M--);if(M<Q&&(Q=M),M===0)return _[m++]=20971520,_[m++]=20971520,f.bits=1,0;for(v=1;v<M&&J[v]===0;v++);for(Q<v&&(Q=v),T=G=1;T<=15;T++)if(G<<=1,(G-=J[T])<0)return-1;if(0<G&&(c===0||M!==1))return-1;for(st[1]=0,T=1;T<15;T++)st[T+1]=st[T]+J[T];for(N=0;N<d;N++)u[p+N]!==0&&(g[st[u[p+N]]++]=N);if(x=c===0?(B=dt=g,19):c===1?(B=o,at-=257,dt=a,wt-=257,256):(B=l,dt=h,-1),T=v,I=m,it=N=$=0,E=-1,C=(nt=1<<(j=Q))-1,c===1&&852<nt||c===2&&592<nt)return 1;for(;;){for(A=T-it,L=g[N]<x?(O=0,g[N]):g[N]>x?(O=dt[wt+g[N]],B[at+g[N]]):(O=96,0),b=1<<T-it,v=y=1<<j;_[I+($>>it)+(y-=b)]=A<<24|O<<16|L|0,y!==0;);for(b=1<<T-1;$&b;)b>>=1;if(b!==0?($&=b-1,$+=b):$=0,N++,--J[T]==0){if(T===M)break;T=u[p+g[N]]}if(Q<T&&($&C)!==E){for(it===0&&(it=Q),I+=v,G=1<<(j=T-it);j+it<M&&!((G-=J[j+it])<=0);)j++,G<<=1;if(nt+=1<<j,c===1&&852<nt||c===2&&592<nt)return 1;_[E=$&C]=Q<<24|j<<16|I-m|0}}return $!==0&&(_[I+$]=T-it<<24|64<<16|0),f.bits=Q,0}},{"../utils/common":41}],51:[function(e,i,n){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,i,n){var r=e("../utils/common"),o=0,a=1;function l(P){for(var z=P.length;0<=--z;)P[z]=0}var h=0,c=29,u=256,p=u+1+c,d=30,_=19,m=2*p+1,g=15,f=16,b=7,y=256,E=16,C=17,I=18,x=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],V=new Array(2*(p+2));l(V);var T=new Array(2*d);l(T);var N=new Array(512);l(N);var v=new Array(256);l(v);var M=new Array(c);l(M);var Q,j,it,G=new Array(d);function nt(P,z,K,H,U){this.static_tree=P,this.extra_bits=z,this.extra_base=K,this.elems=H,this.max_length=U,this.has_stree=P&&P.length}function $(P,z){this.dyn_tree=P,this.max_code=0,this.stat_desc=z}function B(P){return P<256?N[P]:N[256+(P>>>7)]}function at(P,z){P.pending_buf[P.pending++]=255&z,P.pending_buf[P.pending++]=z>>>8&255}function J(P,z,K){P.bi_valid>f-K?(P.bi_buf|=z<<P.bi_valid&65535,at(P,P.bi_buf),P.bi_buf=z>>f-P.bi_valid,P.bi_valid+=K-f):(P.bi_buf|=z<<P.bi_valid&65535,P.bi_valid+=K)}function st(P,z,K){J(P,K[2*z],K[2*z+1])}function dt(P,z){for(var K=0;K|=1&P,P>>>=1,K<<=1,0<--z;);return K>>>1}function wt(P,z,K){var H,U,X=new Array(g+1),et=0;for(H=1;H<=g;H++)X[H]=et=et+K[H-1]<<1;for(U=0;U<=z;U++){var tt=P[2*U+1];tt!==0&&(P[2*U]=dt(X[tt]++,tt))}}function pt(P){var z;for(z=0;z<p;z++)P.dyn_ltree[2*z]=0;for(z=0;z<d;z++)P.dyn_dtree[2*z]=0;for(z=0;z<_;z++)P.bl_tree[2*z]=0;P.dyn_ltree[2*y]=1,P.opt_len=P.static_len=0,P.last_lit=P.matches=0}function _t(P){8<P.bi_valid?at(P,P.bi_buf):0<P.bi_valid&&(P.pending_buf[P.pending++]=P.bi_buf),P.bi_buf=0,P.bi_valid=0}function yt(P,z,K,H){var U=2*z,X=2*K;return P[U]<P[X]||P[U]===P[X]&&H[z]<=H[K]}function It(P,z,K){for(var H=P.heap[K],U=K<<1;U<=P.heap_len&&(U<P.heap_len&&yt(z,P.heap[U+1],P.heap[U],P.depth)&&U++,!yt(z,H,P.heap[U],P.depth));)P.heap[K]=P.heap[U],K=U,U<<=1;P.heap[K]=H}function Vt(P,z,K){var H,U,X,et,tt=0;if(P.last_lit!==0)for(;H=P.pending_buf[P.d_buf+2*tt]<<8|P.pending_buf[P.d_buf+2*tt+1],U=P.pending_buf[P.l_buf+tt],tt++,H===0?st(P,U,z):(st(P,(X=v[U])+u+1,z),(et=x[X])!==0&&J(P,U-=M[X],et),st(P,X=B(--H),K),(et=A[X])!==0&&J(P,H-=G[X],et)),tt<P.last_lit;);st(P,y,z)}function $t(P,z){var K,H,U,X=z.dyn_tree,et=z.stat_desc.static_tree,tt=z.stat_desc.has_stree,ht=z.stat_desc.elems,mt=-1;for(P.heap_len=0,P.heap_max=m,K=0;K<ht;K++)X[2*K]!==0?(P.heap[++P.heap_len]=mt=K,P.depth[K]=0):X[2*K+1]=0;for(;P.heap_len<2;)X[2*(U=P.heap[++P.heap_len]=mt<2?++mt:0)]=1,P.depth[U]=0,P.opt_len--,tt&&(P.static_len-=et[2*U+1]);for(z.max_code=mt,K=P.heap_len>>1;1<=K;K--)It(P,X,K);for(U=ht;K=P.heap[1],P.heap[1]=P.heap[P.heap_len--],It(P,X,1),H=P.heap[1],P.heap[--P.heap_max]=K,P.heap[--P.heap_max]=H,X[2*U]=X[2*K]+X[2*H],P.depth[U]=(P.depth[K]>=P.depth[H]?P.depth[K]:P.depth[H])+1,X[2*K+1]=X[2*H+1]=U,P.heap[1]=U++,It(P,X,1),2<=P.heap_len;);P.heap[--P.heap_max]=P.heap[1],function(gt,kt){var ce,jt,Xe,Ot,Ps,ii,fe=kt.dyn_tree,ni=kt.max_code,ri=kt.stat_desc.static_tree,as=kt.stat_desc.has_stree,$s=kt.stat_desc.extra_bits,ls=kt.stat_desc.extra_base,xe=kt.stat_desc.max_length,We=0;for(Ot=0;Ot<=g;Ot++)gt.bl_count[Ot]=0;for(fe[2*gt.heap[gt.heap_max]+1]=0,ce=gt.heap_max+1;ce<m;ce++)xe<(Ot=fe[2*fe[2*(jt=gt.heap[ce])+1]+1]+1)&&(Ot=xe,We++),fe[2*jt+1]=Ot,ni<jt||(gt.bl_count[Ot]++,Ps=0,ls<=jt&&(Ps=$s[jt-ls]),ii=fe[2*jt],gt.opt_len+=ii*(Ot+Ps),as&&(gt.static_len+=ii*(ri[2*jt+1]+Ps)));if(We!==0){do{for(Ot=xe-1;gt.bl_count[Ot]===0;)Ot--;gt.bl_count[Ot]--,gt.bl_count[Ot+1]+=2,gt.bl_count[xe]--,We-=2}while(0<We);for(Ot=xe;Ot!==0;Ot--)for(jt=gt.bl_count[Ot];jt!==0;)ni<(Xe=gt.heap[--ce])||(fe[2*Xe+1]!==Ot&&(gt.opt_len+=(Ot-fe[2*Xe+1])*fe[2*Xe],fe[2*Xe+1]=Ot),jt--)}}(P,z),wt(X,mt,P.bl_count)}function w(P,z,K){var H,U,X=-1,et=z[1],tt=0,ht=7,mt=4;for(et===0&&(ht=138,mt=3),z[2*(K+1)+1]=65535,H=0;H<=K;H++)U=et,et=z[2*(H+1)+1],++tt<ht&&U===et||(tt<mt?P.bl_tree[2*U]+=tt:U!==0?(U!==X&&P.bl_tree[2*U]++,P.bl_tree[2*E]++):tt<=10?P.bl_tree[2*C]++:P.bl_tree[2*I]++,X=U,mt=(tt=0)===et?(ht=138,3):U===et?(ht=6,3):(ht=7,4))}function Z(P,z,K){var H,U,X=-1,et=z[1],tt=0,ht=7,mt=4;for(et===0&&(ht=138,mt=3),H=0;H<=K;H++)if(U=et,et=z[2*(H+1)+1],!(++tt<ht&&U===et)){if(tt<mt)for(;st(P,U,P.bl_tree),--tt!=0;);else U!==0?(U!==X&&(st(P,U,P.bl_tree),tt--),st(P,E,P.bl_tree),J(P,tt-3,2)):tt<=10?(st(P,C,P.bl_tree),J(P,tt-3,3)):(st(P,I,P.bl_tree),J(P,tt-11,7));X=U,mt=(tt=0)===et?(ht=138,3):U===et?(ht=6,3):(ht=7,4)}}l(G);var Y=!1;function R(P,z,K,H){J(P,(h<<1)+(H?1:0),3),function(U,X,et,tt){_t(U),at(U,et),at(U,~et),r.arraySet(U.pending_buf,U.window,X,et,U.pending),U.pending+=et}(P,z,K)}n._tr_init=function(P){Y||(function(){var z,K,H,U,X,et=new Array(g+1);for(U=H=0;U<c-1;U++)for(M[U]=H,z=0;z<1<<x[U];z++)v[H++]=U;for(v[H-1]=U,U=X=0;U<16;U++)for(G[U]=X,z=0;z<1<<A[U];z++)N[X++]=U;for(X>>=7;U<d;U++)for(G[U]=X<<7,z=0;z<1<<A[U]-7;z++)N[256+X++]=U;for(K=0;K<=g;K++)et[K]=0;for(z=0;z<=143;)V[2*z+1]=8,z++,et[8]++;for(;z<=255;)V[2*z+1]=9,z++,et[9]++;for(;z<=279;)V[2*z+1]=7,z++,et[7]++;for(;z<=287;)V[2*z+1]=8,z++,et[8]++;for(wt(V,p+1,et),z=0;z<d;z++)T[2*z+1]=5,T[2*z]=dt(z,5);Q=new nt(V,x,u+1,p,g),j=new nt(T,A,0,d,g),it=new nt(new Array(0),O,0,_,b)}(),Y=!0),P.l_desc=new $(P.dyn_ltree,Q),P.d_desc=new $(P.dyn_dtree,j),P.bl_desc=new $(P.bl_tree,it),P.bi_buf=0,P.bi_valid=0,pt(P)},n._tr_stored_block=R,n._tr_flush_block=function(P,z,K,H){var U,X,et=0;0<P.level?(P.strm.data_type===2&&(P.strm.data_type=function(tt){var ht,mt=4093624447;for(ht=0;ht<=31;ht++,mt>>>=1)if(1&mt&&tt.dyn_ltree[2*ht]!==0)return o;if(tt.dyn_ltree[18]!==0||tt.dyn_ltree[20]!==0||tt.dyn_ltree[26]!==0)return a;for(ht=32;ht<u;ht++)if(tt.dyn_ltree[2*ht]!==0)return a;return o}(P)),$t(P,P.l_desc),$t(P,P.d_desc),et=function(tt){var ht;for(w(tt,tt.dyn_ltree,tt.l_desc.max_code),w(tt,tt.dyn_dtree,tt.d_desc.max_code),$t(tt,tt.bl_desc),ht=_-1;3<=ht&&tt.bl_tree[2*L[ht]+1]===0;ht--);return tt.opt_len+=3*(ht+1)+5+5+4,ht}(P),U=P.opt_len+3+7>>>3,(X=P.static_len+3+7>>>3)<=U&&(U=X)):U=X=K+5,K+4<=U&&z!==-1?R(P,z,K,H):P.strategy===4||X===U?(J(P,2+(H?1:0),3),Vt(P,V,T)):(J(P,4+(H?1:0),3),function(tt,ht,mt,gt){var kt;for(J(tt,ht-257,5),J(tt,mt-1,5),J(tt,gt-4,4),kt=0;kt<gt;kt++)J(tt,tt.bl_tree[2*L[kt]+1],3);Z(tt,tt.dyn_ltree,ht-1),Z(tt,tt.dyn_dtree,mt-1)}(P,P.l_desc.max_code+1,P.d_desc.max_code+1,et+1),Vt(P,P.dyn_ltree,P.dyn_dtree)),pt(P),H&&_t(P)},n._tr_tally=function(P,z,K){return P.pending_buf[P.d_buf+2*P.last_lit]=z>>>8&255,P.pending_buf[P.d_buf+2*P.last_lit+1]=255&z,P.pending_buf[P.l_buf+P.last_lit]=255&K,P.last_lit++,z===0?P.dyn_ltree[2*K]++:(P.matches++,z--,P.dyn_ltree[2*(v[K]+u+1)]++,P.dyn_dtree[2*B(z)]++),P.last_lit===P.lit_bufsize-1},n._tr_align=function(P){J(P,2,3),st(P,y,V),function(z){z.bi_valid===16?(at(z,z.bi_buf),z.bi_buf=0,z.bi_valid=0):8<=z.bi_valid&&(z.pending_buf[z.pending++]=255&z.bi_buf,z.bi_buf>>=8,z.bi_valid-=8)}(P)}},{"../utils/common":41}],53:[function(e,i,n){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,i,n){(function(r){(function(o,a){if(!o.setImmediate){var l,h,c,u,p=1,d={},_=!1,m=o.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(o);g=g&&g.setTimeout?g:o,l={}.toString.call(o.process)==="[object process]"?function(E){process.nextTick(function(){b(E)})}:function(){if(o.postMessage&&!o.importScripts){var E=!0,C=o.onmessage;return o.onmessage=function(){E=!1},o.postMessage("","*"),o.onmessage=C,E}}()?(u="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",y,!1):o.attachEvent("onmessage",y),function(E){o.postMessage(u+E,"*")}):o.MessageChannel?((c=new MessageChannel).port1.onmessage=function(E){b(E.data)},function(E){c.port2.postMessage(E)}):m&&"onreadystatechange"in m.createElement("script")?(h=m.documentElement,function(E){var C=m.createElement("script");C.onreadystatechange=function(){b(E),C.onreadystatechange=null,h.removeChild(C),C=null},h.appendChild(C)}):function(E){setTimeout(b,0,E)},g.setImmediate=function(E){typeof E!="function"&&(E=new Function(""+E));for(var C=new Array(arguments.length-1),I=0;I<C.length;I++)C[I]=arguments[I+1];var x={callback:E,args:C};return d[p]=x,l(p),p++},g.clearImmediate=f}function f(E){delete d[E]}function b(E){if(_)setTimeout(b,0,E);else{var C=d[E];if(C){_=!0;try{(function(I){var x=I.callback,A=I.args;switch(A.length){case 0:x();break;case 1:x(A[0]);break;case 2:x(A[0],A[1]);break;case 3:x(A[0],A[1],A[2]);break;default:x.apply(a,A)}})(C)}finally{f(E),_=!1}}}}function y(E){E.source===o&&typeof E.data=="string"&&E.data.indexOf(u)===0&&b(+E.data.slice(u.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof Zu<"u"?Zu:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(JE);var nM=JE.exports;const Dy=_L(nM);let Kg=class{constructor(s,t){k(this,"date",new Date),k(this,"author"),k(this,"guid",Ss.create()),k(this,"viewpoint"),k(this,"modifiedAuthor"),k(this,"modifiedDate"),k(this,"topic"),k(this,"_components"),k(this,"_comment",""),this._components=s,this._comment=t;const e=this._components.get(ts);this.author=e.config.author}set comment(s){var t;const e=this._components.get(ts);this._comment=s,this.modifiedDate=new Date,this.modifiedAuthor=e.config.author,(t=this.topic)==null||t.comments.set(this.guid,this)}get comment(){return this._comment}toJSON(){var s,t;const e={guid:this.guid,date:this.date.toISOString(),author:this.author,comment:this.comment,topic_guid:(s=this.topic)==null?void 0:s.guid,viewpoint_guid:this.viewpoint,modified_date:(t=this.modifiedDate)==null?void 0:t.toISOString(),modified_author:this.modifiedAuthor};for(const[i,n]of Object.entries(e))n===void 0&&delete e[i];return e}};const tC=class Fr{constructor(t){k(this,"guid",Ss.create()),k(this,"title",Fr.default.title),k(this,"creationDate",new Date),k(this,"creationAuthor",""),k(this,"viewpoints",new cm),k(this,"relatedTopics",new cm),k(this,"comments",new wl),k(this,"documentReferences",new cm),k(this,"customData",{}),k(this,"description"),k(this,"serverAssignedId"),k(this,"dueDate"),k(this,"modifiedAuthor"),k(this,"modifiedDate"),k(this,"index"),k(this,"_type",Fr.default.type),k(this,"_status",Fr.default.status),k(this,"_priority",Fr.default.priority),k(this,"_stage",Fr.default.stage),k(this,"_assignedTo",Fr.default.assignedTo),k(this,"_labels",Fr.default.labels??new Set),k(this,"_components"),this._components=t;const e=t.get(ts);this.creationAuthor=e.config.author,this.relatedTopics.guard=i=>i!==this.guid}set type(t){const e=this._components.get(ts),{strict:i,types:n}=e.config;(!i||n.has(t))&&(this._type=t)}get type(){return this._type}set status(t){const e=this._components.get(ts),{strict:i,statuses:n}=e.config;(!i||n.has(t))&&(this._status=t)}get status(){return this._status}set priority(t){const e=this._components.get(ts);if(t){const{strict:i,priorities:n}=e.config;if(!(!i||n.has(t)))return;this._priority=t}else this._priority=t}get priority(){return this._priority}set stage(t){const e=this._components.get(ts);if(t){const{strict:i,stages:n}=e.config;if(!(!i||n.has(t)))return;this._stage=t}else this._stage=t}get stage(){return this._stage}set assignedTo(t){const e=this._components.get(ts);if(t){const{strict:i,users:n}=e.config;if(!(!i||n.has(t)))return;this._assignedTo=t}else this._assignedTo=t}get assignedTo(){return this._assignedTo}set labels(t){const e=this._components.get(ts),{strict:i,labels:n}=e.config;if(i){const r=new Set;for(const o of t)(!i||n.has(o))&&r.add(o);this._labels=r}else this._labels=t}get labels(){return this._labels}get _managerVersion(){return this._components.get(ts).config.version}set(t){const e=t,i=this;for(const n in t){if(n==="guid")continue;const r=e[n];n in this&&(i[n]=r)}return this._components.get(ts).list.set(this.guid,this),this}createComment(t,e){const i=new Kg(this._components,t);return i.viewpoint=e,i.topic=this,this.comments.set(i.guid,i),i}createLabelTags(){const t=[...this.labels];if(this._components.get(ts).config.exportCustomDataAsLabels)for(const e in this.customData){const i=this.customData[e];typeof i=="string"&&t.push(i)}return t}createCommentTags(){return[...this.comments.values()].map(t=>{var e;return{$Guid:t.guid,Date:t.date.toISOString(),Author:t.author,Comment:t.comment,ModifiedAuthor:t.modifiedAuthor,ModifiedDate:(e=t.modifiedDate)==null?void 0:e.toISOString(),Viewpoint:t.viewpoint?{$Guid:t.viewpoint}:void 0}})}createViewpointTags(){const t=this._components.get(or);return[...this.viewpoints].map(e=>t.list.get(e)).filter(e=>e).map(e=>{const i={$Guid:e.guid,Viewpoint:`${e.title??e.guid}.bcfv`};if(t.snapshots.get(e.snapshot)){const n=t.getSnapshotExtension(e.snapshot);i.Snapshot=`${e.snapshot}.${n}`}return i})}createRelatedTopicTags(){return[...this.relatedTopics].map(t=>({$Guid:t}))}createDocumentReferencesTag(t=this._managerVersion){const e=[];if(!(t==="3"||t==="2.1"))return e;const i=this._components.get(ts);for(const n of this.documentReferences){const r=i.documents.get(n);if(!r)continue;let o={$Guid:Ss.create(),Description:r.description};t==="2.1"&&(o={...o,$isExternal:r.type==="external"?!0:void 0,ReferencedDocument:r.type==="external"?r.url:`../${r.fileName}`}),t==="3"&&(o={...o,DocumentGuid:r.type==="internal"?n:void 0,Url:r.type==="external"?r.url:void 0}),Object.keys(o).length>0&&e.push(o)}return e}toJSON(){var t,e;const i={guid:this.guid,server_assigned_id:this.serverAssignedId,topic_type:this.type,topic_status:this.status,title:this.title,priority:this.priority,index:this.index,labels:[...this.labels],creation_date:this.creationDate.toISOString(),creation_author:this.creationAuthor,modified_date:(t=this.modifiedDate)==null?void 0:t.toISOString(),modified_author:this.modifiedAuthor,assigned_to:this.assignedTo,stage:this.stage,description:this.description,due_date:(e=this.dueDate)==null?void 0:e.toISOString(),comments:[...this.comments].map(([o,a])=>a.toJSON()),relatedTopics:[...this.relatedTopics].map(o=>({related_topic_guid:o}))},n=this._components.get(or);for(const o of this.viewpoints){const a=n.list.get(o);a&&(i.viewpoints||(i.viewpoints=[]),i.viewpoints.push(a.toJSON()))}const r=this._components.get(ts);for(const o of this.documentReferences){const a=r.documents.get(o);a&&(i.document_references||(i.document_references=[]),a.type==="external"?i.document_references.push({guid:Ss.create(),description:a.description,url:a.url}):i.document_references.push({guid:Ss.create(),description:a.description,document_guid:o}))}for(const[o,a]of Object.entries(i))(a===void 0||Array.isArray(a)&&a.length===0)&&delete i[o];return i}serialize(){var t,e;const i=this._managerVersion,n={$Guid:this.guid,$TopicType:this.type,$TopicStatus:this.status,$ServerAssignedId:this.serverAssignedId,Title:this.title,CreationAuthor:this.creationAuthor,CreationDate:this.creationDate.toISOString(),Priority:this.priority,Index:i==="2.1"?this.index:void 0,ModifiedDate:(t=this.modifiedDate)==null?void 0:t.toISOString(),ModifiedAuthor:this.modifiedAuthor,DueDate:(e=this.dueDate)==null?void 0:e.toISOString(),AssignedTo:this.assignedTo,Description:this.description,Stage:this.stage,DocumentReferences:i==="3"?{DocumentReference:this.createDocumentReferencesTag(i)}:void 0,RelatedTopics:i==="3"?{RelatedTopic:this.createRelatedTopicTags()}:void 0,RelatedTopic:i==="2.1"?this.createRelatedTopicTags():void 0,Labels:i==="3"?{Label:this.createLabelTags()}:void 0,Viewpoints:i==="3"?{ViewPoint:this.createViewpointTags()}:void 0,Comments:i==="3"?{Comment:this.createCommentTags()}:void 0};i==="2.1"&&(n.Labels=this.createLabelTags(),n.DocumentReference=this.createDocumentReferencesTag(i));const r={Markup:{Topic:n}};return i==="2.1"&&(r.Markup.Viewpoints=this.createViewpointTags(),r.Markup.Comment=this.createCommentTags()),`<?xml version="1.0" encoding="UTF-8"?>
    ${Qp.builder.build(r)}`}};k(tC,"default",{title:"BCF Topic",type:"Issue",status:"Active"});let ky=tC;const rM=(s,t)=>{if(t.trim()==="")return;const e=ts.xmlParser.parse(t).Extensions;if(!e)return;const{Priorities:i,TopicStatuses:n,TopicTypes:r,Users:o}=e;if(i&&i.Priority){const a=Array.isArray(i.Priority)?i.Priority:[i.Priority];for(const l of a)s.config.priorities.add(l)}if(n&&n.TopicStatus){const a=Array.isArray(n.TopicStatus)?n.TopicStatus:[n.TopicStatus];for(const l of a)s.config.statuses.add(l)}if(r&&r.TopicType){const a=Array.isArray(r.TopicType)?r.TopicType:[r.TopicType];for(const l of a)s.config.types.add(l)}if(o&&o.User){const a=Array.isArray(o.User)?o.User:[o.User];for(const l of a)s.config.users.add(l)}};class oM extends Kp{constructor(){super(...arguments),k(this,"_config",{version:{type:"Select",options:new Set(["2.1","3"]),multiple:!1,value:""},author:{type:"Text",value:""},types:{type:"TextSet",value:new Set},statuses:{type:"TextSet",value:new Set},priorities:{type:"TextSet",value:new Set},labels:{type:"TextSet",value:new Set},stages:{type:"TextSet",value:new Set},users:{type:"TextSet",value:new Set},includeSelectionTag:{type:"Boolean",value:!1},updateExtensionsOnImport:{type:"Boolean",value:!1},strict:{type:"Boolean",value:!1},includeAllExtensionsOnExport:{type:"Boolean",value:!1},fallbackVersionOnImport:{type:"Select",multiple:!1,options:new Set(["2.1","3"]),value:""},ignoreIncompleteTopicsOnImport:{type:"Boolean",value:!1},exportCustomDataAsLabels:{type:"Boolean",value:!1}})}get version(){return this._config.version.value}set version(t){this._config.version.value=t}get author(){return this._config.author.value}set author(t){this._config.author.value=t}get types(){return this._config.types.value}set types(t){this._config.types.value=t}get statuses(){return this._config.statuses.value}set statuses(t){this._config.statuses.value=t}get priorities(){return this._config.priorities.value}set priorities(t){this._config.priorities.value=t}get labels(){return this._config.labels.value}set labels(t){this._config.labels.value=t}get stages(){return this._config.stages.value}set stages(t){this._config.stages.value=t}get users(){return this._config.users.value}set users(t){this._config.users.value=t}get includeSelectionTag(){return this._config.includeSelectionTag.value}set includeSelectionTag(t){this._config.includeSelectionTag.value=t}get updateExtensionsOnImport(){return this._config.updateExtensionsOnImport.value}set updateExtensionsOnImport(t){this._config.updateExtensionsOnImport.value=t}get strict(){return this._config.strict.value}set strict(t){this._config.strict.value=t}get includeAllExtensionsOnExport(){return this._config.includeAllExtensionsOnExport.value}set includeAllExtensionsOnExport(t){this._config.includeAllExtensionsOnExport.value=t}get fallbackVersionOnImport(){return this._config.fallbackVersionOnImport.value}set fallbackVersionOnImport(t){this._config.fallbackVersionOnImport.value=t}get ignoreIncompleteTopicsOnImport(){return this._config.ignoreIncompleteTopicsOnImport.value}set ignoreIncompleteTopicsOnImport(t){this._config.ignoreIncompleteTopicsOnImport.value=t}get exportCustomDataAsLabels(){return this._config.exportCustomDataAsLabels.value}set exportCustomDataAsLabels(t){this._config.exportCustomDataAsLabels.value=t}}const K_=class jh extends he{constructor(){super(...arguments),k(this,"enabled",!1),k(this,"_defaultConfig",{author:"jhon.doe@example.com",version:"2.1",types:new Set(["Clash","Failure","Fault","Inquiry","Issue","Remark","Request"]),statuses:new Set(["Active","In Progress","Done","In Review","Closed"]),priorities:new Set(["On hold","Minor","Normal","Major","Critical"]),labels:new Set,stages:new Set,users:new Set,includeSelectionTag:!1,updateExtensionsOnImport:!0,strict:!1,includeAllExtensionsOnExport:!0,fallbackVersionOnImport:"2.1",ignoreIncompleteTopicsOnImport:!1,exportCustomDataAsLabels:!1}),k(this,"config",new oM(this,this.components,"BCF Topics",jh.uuid)),k(this,"list",new wl),k(this,"documents",new wl),k(this,"onSetup",new ft),k(this,"isSetup",!1),k(this,"onBCFImported",new ft),k(this,"onDisposed",new ft)}setup(t){if(this.isSetup)return;const e={...this._defaultConfig,...t};this.config.version=e.version,this.config.author=e.author,this.config.types=e.types,this.config.statuses=e.statuses,this.config.priorities=e.priorities,this.config.labels=e.labels,this.config.stages=e.stages,this.config.users=e.users,this.config.includeSelectionTag=e.includeSelectionTag,this.config.updateExtensionsOnImport=e.updateExtensionsOnImport,this.config.strict=e.strict,this.config.includeAllExtensionsOnExport=e.includeAllExtensionsOnExport,this.config.fallbackVersionOnImport=e.fallbackVersionOnImport||"",this.config.ignoreIncompleteTopicsOnImport=e.ignoreIncompleteTopicsOnImport,this.isSetup=!0,this.enabled=!0,this.onSetup.trigger()}create(t){const e=new ky(this.components);return t?(e.guid=t.guid??e.guid,e.set(t)):this.list.set(e.guid,e),e}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get usedTypes(){const t=[...this.list].map(([e,i])=>i.type);return new Set(t)}get usedStatuses(){const t=[...this.list].map(([e,i])=>i.status);return new Set(t)}get usedPriorities(){const t=[...this.list].map(([e,i])=>i.priority).filter(e=>e);return new Set(t)}get usedStages(){const t=[...this.list].map(([e,i])=>i.stage).filter(e=>e);return new Set(t)}get usedUsers(){const t=[];for(const[e,i]of this.list){t.push(i.creationAuthor),i.assignedTo&&t.push(i.assignedTo),i.modifiedAuthor&&t.push(i.modifiedAuthor);for(const[n,r]of i.comments)t.push(r.author),r.modifiedAuthor&&t.push(r.modifiedAuthor)}return new Set(t)}get usedLabels(){const t=[];for(const[e,i]of this.list)t.push(...i.labels);return new Set(t)}updateExtensions(){for(const[t,e]of this.list){for(const i of e.labels)this.config.labels.add(i);this.config.types.add(e.type),e.priority&&this.config.priorities.add(e.priority),e.stage&&this.config.stages.add(e.stage),this.config.statuses.add(e.status),this.config.users.add(e.creationAuthor),e.assignedTo&&this.config.users.add(e.assignedTo),e.modifiedAuthor&&this.config.users.add(e.modifiedAuthor);for(const[i,n]of e.comments)this.config.users.add(n.author),n.modifiedAuthor&&this.config.users.add(n.modifiedAuthor)}}updateViewpointReferences(){const t=this.components.get(or);for(const[e,i]of this.list)for(const n of i.viewpoints)t.list.has(n)||i.viewpoints.delete(n)}async export(t=this.list.values()){const e=new Dy;e.file("bcf.version",`<?xml version="1.0" encoding="UTF-8"?>
    <Version VersionId="${this.config.version}" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/buildingSMART/BCF-XML/release_3_0/Schemas/version.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    </Version>`);for(const[n,r]of this.documents.entries())r.type!=="external"&&e.file(this.config.version==="2.1"?r.fileName:`documents/${n}`,r.data);if(this.config.version==="3"){const n=[];for(const[r,o]of this.documents.entries()){const{type:a,description:l}=o;a!=="external"&&n.push(`<Document Guid="${r}">
        <Filename>${o.fileName}</Filename>
        ${l?`<Description>${l}</Description>`:""}
      </Document>`)}n.length>0&&e.file("documents.xml",`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
  <DocumentInfo xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="documents.xsd">
    <Documents>
      ${n.join(`
`)}
    </Documents>
  </DocumentInfo>`)}e.file("bcf.extensions",this.serializeExtensions());const i=this.components.get(or);for(const n of t){const r=e.folder(n.guid);r.file("markup.bcf",n.serialize());for(const o of n.viewpoints){const a=i.list.get(o);if(!a)continue;const l=a.title??a.guid;r.file(`${l}.bcfv`,await a.serialize());const h=i.snapshots.get(a.snapshot);if(!h)continue;const c=h?a.snapshot:a.guid,u=i.getSnapshotExtension(a.snapshot);r.file(`${c}.${u}`,h,{binary:!0})}}return await e.generateAsync({type:"blob"})}serializeExtensions(){const t=[...this.config.types].map(a=>`<TopicType>${a}</TopicType>`).join(`
`),e=[...this.config.statuses].map(a=>`<TopicStatus>${a}</TopicStatus>`).join(`
`),i=[...this.config.priorities].map(a=>`<Priority>${a}</Priority>`).join(`
`),n=[...this.config.labels].map(a=>`<TopicLabel>${a}</TopicLabel>`).join(`
`),r=[...this.config.stages].map(a=>`<Stage>${a}</Stage>`).join(`
`),o=[...this.config.users].map(a=>`<User>${a}</User>`).join(`
`);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Extensions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="your-schema-location.xsd">
        ${t.length!==0?`<TopicTypes>
${t}
</TopicTypes>`:""}
        ${e.length!==0?`<TopicStatuses>
${e}
</TopicStatuses>`:""}
        ${i.length!==0?`<Priorities>
${i}
</Priorities>`:""}
        ${n.length!==0?`<TopicLabels>
${n}
</TopicLabels>`:""}
        ${r.length!==0?`<Stages>
${r}
</Stages>`:""}
        ${o.length!==0?`<Users>
${o}
</Users>`:""}
      </Extensions>
    `}processMarkupComment(t){const{Guid:e,Date:i,Author:n,Comment:r,Viewpoint:o}=t;if(!(e&&i&&n&&(Kg||o)))return null;const a=new Kg(this.components,r??"");return a.guid=e,a.date=new Date(i),a.author=n,a.viewpoint=o==null?void 0:o.Guid,a.modifiedAuthor=t.ModifiedAuthor,a.modifiedDate=t.ModifiedDate?new Date(t.ModifiedDate):void 0,a}getMarkupComments(t,e){var i;let n;if(e==="2.1"&&(n=t.Comment),e==="3"&&(n=(i=t.Topic.Comments)==null?void 0:i.Comment),!n)return[];n=Array.isArray(n)?n:[n];const r=n.map(o=>this.processMarkupComment(o)).filter(o=>o);return Array.isArray(r)?r:[r]}getMarkupLabels(t,e){var i;let n;return e==="2.1"&&(n=t.Topic.Labels),e==="3"&&(n=(i=t.Topic.Labels)==null?void 0:i.Label),n?Array.isArray(n)?n:[n]:[]}getMarkupViewpoints(t,e){var i;let n;return e==="2.1"&&(n=t.Viewpoints),e==="3"&&(n=(i=t.Topic.Viewpoints)==null?void 0:i.ViewPoint),n?(n=Array.isArray(n)?n:[n],n):[]}getMarkupRelatedTopics(t,e){var i;let n;return e==="2.1"&&(n=t.Topic.RelatedTopic),e==="3"&&(n=(i=t.Topic.RelatedTopics)==null?void 0:i.RelatedTopic),n?(Array.isArray(n)?n:[n]).map(r=>r.Guid):[]}getMarkupDocumentReferences(t,e){var i;let n;return e==="2.1"&&(n=t.Topic.DocumentReference),e==="3"&&(n=(i=t.Topic.DocumentReferences)==null?void 0:i.DocumentReference),n?Array.isArray(n)?n:[n]:[]}async load(t){var e,i,n;const{fallbackVersionOnImport:r,ignoreIncompleteTopicsOnImport:o,updateExtensionsOnImport:a}=this.config,l=new Dy;await l.loadAsync(t);const h=Object.values(l.files);let c=r;const u=h.find(C=>C.name.endsWith(".version"));if(u){const C=await u.async("string"),I=jh.xmlParser.parse(C).Version.VersionId;c=String(I)}if(!(c&&(c==="2.1"||c==="3")))throw new Error(`BCFTopics: ${c} is not supported.`);const p=h.find(C=>C.name.endsWith(".extensions"));if(a&&p){const C=await p.async("string");rM(this,C)}const d=[],_=this.components.get(or),m=h.filter(C=>C.name.endsWith(".bcfv"));for(const C of m){const I=await C.async("string"),x=jh.xmlParser.parse(I).VisualizationInfo;if(!x){console.warn("Missing VisualizationInfo in Viewpoint");continue}const A={},{Guid:O,ClippingPlanes:L,Components:V,OrthogonalCamera:T,PerspectiveCamera:N}=x;if(O&&(A.guid=O),V){const M={selection:[],coloring:[],visibility:{default_visibility:!1,exceptions:[],view_setup_hints:{spaces_visible:!1,space_boundaries_visible:!1,openings_visible:!1}}};A.components=M;const{Selection:Q,Visibility:j}=V;if(Q&&Q.Component){const nt=Array.isArray(Q.Component)?Q.Component:[Q.Component];M.selection=nt.map($=>$.IfcGuid?{ifc_guid:$.IfcGuid}:null).filter($=>$!==null)}if(j&&"DefaultVisibility"in j&&(M.visibility.default_visibility=j.DefaultVisibility),j&&j.Exceptions&&"Component"in j.Exceptions){const{Component:nt}=j.Exceptions,$=Array.isArray(nt)?nt:[nt];M.visibility.exceptions=$.map(B=>B.IfcGuid?{ifc_guid:B.IfcGuid}:null).filter(B=>B!==null)}let it;c==="2.1"&&(it=V.ViewSetupHints),c==="3"&&(it=(e=V.Visibility)==null?void 0:e.ViewSetupHints),it&&("OpeningsVisible"in it&&(M.visibility.view_setup_hints.openings_visible=it.OpeningsVisible),"SpacesVisible"in it&&(M.visibility.view_setup_hints.spaces_visible=it.SpacesVisible),"SpaceBoundariesVisible"in it&&(M.visibility.view_setup_hints.space_boundaries_visible=it.SpaceBoundariesVisible));const{Coloring:G}=V;if(G&&G.Color){const nt=Array.isArray(G.Color)?G.Color:[G.Color];for(const $ of nt){const{Color:B,Component:at}=$;if(!(B.length===6||B.length===8))continue;const J=B.length===6?B:B.slice(2),st=(Array.isArray(at)?at:[at]).map(dt=>dt.IfcGuid?{ifc_guid:dt.IfcGuid}:null).filter(dt=>dt!==null);M.coloring.push({color:J,components:st})}}}if(T||N){const M=x.PerspectiveCamera??x.OrthogonalCamera,{CameraViewPoint:Q,CameraDirection:j}=M,it=new F(Number(Q.X),Number(Q.Z),Number(-Q.Y)),G=new F(Number(j.X),Number(j.Z),Number(-j.Y)),nt={camera_view_point:{x:it.x,y:it.y,z:it.z},camera_direction:{x:G.x,y:G.y,z:G.z},aspect_ratio:"AspectRatio"in M?M.AspectRatio:1,camera_up_vector:{x:0,y:0,z:0}};"ViewToWorldScale"in M&&(A.orthogonal_camera={...nt,view_to_world_scale:M.ViewToWorldScale}),"FieldOfView"in M&&(A.perspective_camera={...nt,field_of_view:M.FieldOfView})}if(L){const M=(Array.isArray(L.ClippingPlane)?L.ClippingPlane:[L.ClippingPlane]).map(({Location:Q,Direction:j})=>({location:{x:Q.x,y:Q.y,z:Q.z},direction:{x:j.x,y:j.y,z:j.z}}));A.clipping_planes=M}const v=new iC(this.components,A);d.push(v)}const g=C=>{const I=C.split("/"),x=I[I.length-1].split(".");return x.pop(),x.join(".")},f=h.filter(C=>C.name.endsWith(".png")||C.name.endsWith(".jpeg"));for(const C of f){const I=g(C.name),x=await C.async("arraybuffer"),A=new Uint8Array(x);_.snapshots.set(I,A)}const b={},y=[],E=h.filter(C=>C.name.endsWith(".bcf"));for(const C of E){const I=await C.async("string"),x=jh.xmlParser.parse(I).Markup,A=x.Topic,{Guid:O,TopicType:L,TopicStatus:V,Title:T,CreationDate:N,CreationAuthor:v}=A;if(o&&!(O&&L&&V&&T&&N&&v))continue;const M=new ky(this.components);M.guid=O??M.guid;const Q=this.getMarkupRelatedTopics(x,c);b[M.guid]=new Set(Q),M.type=L??M.type,M.status=V??M.status,M.title=T??M.title,M.creationDate=N?new Date(N):M.creationDate,M.creationAuthor=v??M.creationAuthor,M.serverAssignedId=A.ServerAssignedId,M.priority=A.Priority,M.index=A.Index,M.modifiedDate=A.ModifiedDate?new Date(A.ModifiedDate):void 0,M.modifiedAuthor=A.ModifiedAuthor,M.dueDate=A.DueDate?new Date(A.DueDate):void 0,M.assignedTo=A.AssignedTo,M.description=A.Description,M.stage=A.Stage;const j=this.getMarkupLabels(x,c);for(const J of j)M.labels.add(J);const it=this.getMarkupComments(x,c);for(const J of it)M.comments.set(J.guid,J);const G=this.getMarkupViewpoints(x,c);for(const J of G){if(!(J&&J.Guid))continue;const st=_.list.get(J.Guid);if(st){M.viewpoints.add(st.guid);const dt=g(J.Snapshot);st.snapshot=dt??null}}const nt=this.getMarkupDocumentReferences(x,c),$=h.find(J=>J.name==="documents.xml");let B=[];const at=await($==null?void 0:$.async("string"));if(at){const J=(n=(i=Qp.parser.parse(at).DocumentInfo)==null?void 0:i.Documents)==null?void 0:n.Document;B=Array.isArray(J)?J:[J]}for(const J of nt){const{Description:st,DocumentGuid:dt,Url:wt,isExternal:pt,ReferencedDocument:_t}=J;if(dt&&B.length>0){const yt=B.find(({Guid:Z})=>Z===dt),It=h.find(Z=>Z.name.endsWith(dt)),Vt=await(It==null?void 0:It.async("uint8array"));if(!(yt&&Vt))continue;const{Description:$t,Filename:w}=yt;this.documents.set(dt,{type:"internal",fileName:w,description:$t,data:Vt}),M.documentReferences.add(dt)}if(wt){const yt=this.documents.add({type:"external",url:wt,description:st});M.documentReferences.add(yt)}if(_t){let yt=null;if(pt)yt=this.documents.add({type:"external",url:_t,description:st});else{const It=_t.split("/"),Vt=It[It.length-1],$t=h.find(Z=>Z.name.endsWith(Vt)),w=await($t==null?void 0:$t.async("uint8array"));if(!w)continue;yt=this.documents.add({type:"internal",fileName:Vt,data:w,description:st})}M.documentReferences.add(yt)}}this.list.set(M.guid,M),y.push(M)}for(const C in b){const I=this.list.get(C);if(!I)continue;const x=b[C];for(const A of x)I.relatedTopics.add(A)}return this.onBCFImported.trigger(y),{viewpoints:d,topics:y}}};k(K_,"uuid","de977976-e4f6-4e4f-a01a-204727839802");k(K_,"xmlParser",new Xp.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let ts=K_;const vo=new oa,Ts=new F,Ir=new F,Ee=new Ie,zy={X:new F(1,0,0),Y:new F(0,1,0),Z:new F(0,0,1)},Pm={type:"change"},Uy={type:"mouseDown",mode:null},By={type:"mouseUp",mode:null},Vy={type:"objectChange"};class aM extends Cw{constructor(t,e=null){super(void 0,e);const i=new pM(this);this._root=i;const n=new fM;this._gizmo=n,i.add(n);const r=new mM;this._plane=r,i.add(r);const o=this;function a(y,E){let C=E;Object.defineProperty(o,y,{get:function(){return C!==void 0?C:E},set:function(I){C!==I&&(C=I,r[y]=I,n[y]=I,o.dispatchEvent({type:y+"-changed",value:I}),o.dispatchEvent(Pm))}}),o[y]=E,r[y]=E,n[y]=E}a("camera",t),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0),a("minX",-1/0),a("maxX",1/0),a("minY",-1/0),a("maxY",1/0),a("minZ",-1/0),a("maxZ",1/0);const l=new F,h=new F,c=new Ie,u=new Ie,p=new F,d=new Ie,_=new F,m=new F,g=new F,f=0,b=new F;a("worldPosition",l),a("worldPositionStart",h),a("worldQuaternion",c),a("worldQuaternionStart",u),a("cameraPosition",p),a("cameraQuaternion",d),a("pointStart",_),a("pointEnd",m),a("rotationAxis",g),a("rotationAngle",f),a("eye",b),this._offset=new F,this._startNorm=new F,this._endNorm=new F,this._cameraScale=new F,this._parentPosition=new F,this._parentQuaternion=new Ie,this._parentQuaternionInv=new Ie,this._parentScale=new F,this._worldScaleStart=new F,this._worldQuaternionInv=new Ie,this._worldScale=new F,this._positionStart=new F,this._quaternionStart=new Ie,this._scaleStart=new F,this._getPointer=lM.bind(this),this._onPointerDown=cM.bind(this),this._onPointerHover=hM.bind(this),this._onPointerMove=uM.bind(this),this._onPointerUp=dM.bind(this),e!==null&&this.connect(e)}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(t){if(this.object===void 0||this.dragging===!0)return;t!==null&&vo.setFromCamera(t,this.camera);const e=Fm(this._gizmo.picker[this.mode],vo);e?this.axis=e.object.name:this.axis=null}pointerDown(t){if(!(this.object===void 0||this.dragging===!0||t!=null&&t.button!==0)&&this.axis!==null){t!==null&&vo.setFromCamera(t,this.camera);const e=Fm(this._plane,vo,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,Uy.mode=this.mode,this.dispatchEvent(Uy)}}pointerMove(t){const e=this.axis,i=this.mode,n=this.object;let r=this.space;if(i==="scale"?r="local":(e==="E"||e==="XYZE"||e==="XYZ")&&(r="world"),n===void 0||e===null||this.dragging===!1||t!==null&&t.button!==-1)return;t!==null&&vo.setFromCamera(t,this.camera);const o=Fm(this._plane,vo,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&e!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),e.indexOf("X")===-1&&(this._offset.x=0),e.indexOf("Y")===-1&&(this._offset.y=0),e.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&e!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(n.position.applyQuaternion(Ee.copy(this._quaternionStart).invert()),e.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),r==="world"&&(n.parent&&n.position.add(Ts.setFromMatrixPosition(n.parent.matrixWorld)),e.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(Ts.setFromMatrixPosition(n.parent.matrixWorld)))),n.position.x=Math.max(this.minX,Math.min(this.maxX,n.position.x)),n.position.y=Math.max(this.minY,Math.min(this.maxY,n.position.y)),n.position.z=Math.max(this.minZ,Math.min(this.maxZ,n.position.z));else if(i==="scale"){if(e.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),Ir.set(a,a,a)}else Ts.copy(this.pointStart),Ir.copy(this.pointEnd),Ts.applyQuaternion(this._worldQuaternionInv),Ir.applyQuaternion(this._worldQuaternionInv),Ir.divide(Ts),e.search("X")===-1&&(Ir.x=1),e.search("Y")===-1&&(Ir.y=1),e.search("Z")===-1&&(Ir.z=1);n.scale.copy(this._scaleStart).multiply(Ir),this.scaleSnap&&(e.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(Ts.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;e==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Ts.copy(this.rotationAxis).cross(this.eye))*a):(e==="X"||e==="Y"||e==="Z")&&(this.rotationAxis.copy(zy[e]),Ts.copy(zy[e]),r==="local"&&Ts.applyQuaternion(this.worldQuaternion),Ts.cross(this.eye),Ts.length()===0?l=!0:this.rotationAngle=this._offset.dot(Ts.normalize())*a),(e==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&e!=="E"&&e!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(Ee.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(Ee.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Pm),this.dispatchEvent(Vy)}}pointerUp(t){t!==null&&t.button!==0||(this.dragging&&this.axis!==null&&(By.mode=this.mode,this.dispatchEvent(By)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(t){return this.object=t,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Pm),this.dispatchEvent(Vy),this.pointStart.copy(this.pointEnd))}getRaycaster(){return vo}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}}function lM(s){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:s.button};{const t=this.domElement.getBoundingClientRect();return{x:(s.clientX-t.left)/t.width*2-1,y:-(s.clientY-t.top)/t.height*2+1,button:s.button}}}function hM(s){if(this.enabled)switch(s.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(s));break}}function cM(s){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(s)),this.pointerDown(this._getPointer(s)))}function uM(s){this.enabled&&this.pointerMove(this._getPointer(s))}function dM(s){this.enabled&&(this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(s)))}function Fm(s,t,e){const i=t.intersectObject(s,!0);for(let n=0;n<i.length;n++)if(i[n].object.visible||e)return i[n];return!1}const gd=new xw,le=new F(0,1,0),$y=new F(0,0,0),Hy=new vt,_d=new Ie,Wd=new Ie,Cn=new F,jy=new vt,Yh=new F(1,0,0),So=new F(0,1,0),Wh=new F(0,0,1),bd=new F,Ch=new F,Ih=new F;class pM extends yi{constructor(t){super(),this.isTransformControlsRoot=!0,this.controls=t,this.visible=!1}updateMatrixWorld(t){const e=this.controls;e.object!==void 0&&(e.object.updateMatrixWorld(),e.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):e.object.parent.matrixWorld.decompose(e._parentPosition,e._parentQuaternion,e._parentScale),e.object.matrixWorld.decompose(e.worldPosition,e.worldQuaternion,e._worldScale),e._parentQuaternionInv.copy(e._parentQuaternion).invert(),e._worldQuaternionInv.copy(e.worldQuaternion).invert()),e.camera.updateMatrixWorld(),e.camera.matrixWorld.decompose(e.cameraPosition,e.cameraQuaternion,e._cameraScale),e.camera.isOrthographicCamera?e.camera.getWorldDirection(e.eye).negate():e.eye.copy(e.cameraPosition).sub(e.worldPosition).normalize(),super.updateMatrixWorld(t)}dispose(){this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}}class fM extends yi{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const t=new br({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),e=new Mp({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=t.clone();i.opacity=.15;const n=e.clone();n.opacity=.5;const r=t.clone();r.color.setHex(16711680);const o=t.clone();o.color.setHex(65280);const a=t.clone();a.color.setHex(255);const l=t.clone();l.color.setHex(16711680),l.opacity=.5;const h=t.clone();h.color.setHex(65280),h.opacity=.5;const c=t.clone();c.color.setHex(255),c.opacity=.5;const u=t.clone();u.opacity=.25;const p=t.clone();p.color.setHex(16776960),p.opacity=.25,t.clone().color.setHex(16776960);const d=t.clone();d.color.setHex(7895160);const _=new se(0,.04,.1,12);_.translate(0,.05,0);const m=new Jt(.08,.08,.08);m.translate(0,.04,0);const g=new ye;g.setAttribute("position",new Us([0,0,0,1,0,0],3));const f=new se(.0075,.0075,.5,3);f.translate(0,.25,0);function b(v,M){const Q=new Dn(v,.0075,3,64,M*Math.PI*2);return Q.rotateY(Math.PI/2),Q.rotateX(Math.PI/2),Q}function y(){const v=new ye;return v.setAttribute("position",new Us([0,0,0,1,1,1],3)),v}const E={X:[[new lt(_,r),[.5,0,0],[0,0,-Math.PI/2]],[new lt(_,r),[-.5,0,0],[0,0,Math.PI/2]],[new lt(f,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new lt(_,o),[0,.5,0]],[new lt(_,o),[0,-.5,0],[Math.PI,0,0]],[new lt(f,o)]],Z:[[new lt(_,a),[0,0,.5],[Math.PI/2,0,0]],[new lt(_,a),[0,0,-.5],[-Math.PI/2,0,0]],[new lt(f,a),null,[Math.PI/2,0,0]]],XYZ:[[new lt(new Hr(.1,0),u.clone()),[0,0,0]]],XY:[[new lt(new Jt(.15,.15,.01),c.clone()),[.15,.15,0]]],YZ:[[new lt(new Jt(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new lt(new Jt(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},C={X:[[new lt(new se(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new lt(new se(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new lt(new se(.2,0,.6,4),i),[0,.3,0]],[new lt(new se(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new lt(new se(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new lt(new se(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new lt(new Hr(.2,0),i)]],XY:[[new lt(new Jt(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new lt(new Jt(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new lt(new Jt(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},I={START:[[new lt(new Hr(.01,2),n),null,null,null,"helper"]],END:[[new lt(new Hr(.01,2),n),null,null,null,"helper"]],DELTA:[[new Ze(y(),n),null,null,null,"helper"]],X:[[new Ze(g,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ze(g,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ze(g,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},x={XYZE:[[new lt(b(.5,1),d),null,[0,Math.PI/2,0]]],X:[[new lt(b(.5,.5),r)]],Y:[[new lt(b(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new lt(b(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new lt(b(.75,1),p),null,[0,Math.PI/2,0]]]},A={AXIS:[[new Ze(g,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},O={XYZE:[[new lt(new Iw(.25,10,8),i)]],X:[[new lt(new Dn(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new lt(new Dn(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new lt(new Dn(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new lt(new Dn(.75,.1,2,24),i)]]},L={X:[[new lt(m,r),[.5,0,0],[0,0,-Math.PI/2]],[new lt(f,r),[0,0,0],[0,0,-Math.PI/2]],[new lt(m,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new lt(m,o),[0,.5,0]],[new lt(f,o)],[new lt(m,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new lt(m,a),[0,0,.5],[Math.PI/2,0,0]],[new lt(f,a),[0,0,0],[Math.PI/2,0,0]],[new lt(m,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new lt(new Jt(.15,.15,.01),c),[.15,.15,0]]],YZ:[[new lt(new Jt(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new lt(new Jt(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new lt(new Jt(.1,.1,.1),u.clone())]]},V={X:[[new lt(new se(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new lt(new se(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new lt(new se(.2,0,.6,4),i),[0,.3,0]],[new lt(new se(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new lt(new se(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new lt(new se(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new lt(new Jt(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new lt(new Jt(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new lt(new Jt(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new lt(new Jt(.2,.2,.2),i),[0,0,0]]]},T={X:[[new Ze(g,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ze(g,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ze(g,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function N(v){const M=new yi;for(const Q in v)for(let j=v[Q].length;j--;){const it=v[Q][j][0].clone(),G=v[Q][j][1],nt=v[Q][j][2],$=v[Q][j][3],B=v[Q][j][4];it.name=Q,it.tag=B,G&&it.position.set(G[0],G[1],G[2]),nt&&it.rotation.set(nt[0],nt[1],nt[2]),$&&it.scale.set($[0],$[1],$[2]),it.updateMatrix();const at=it.geometry.clone();at.applyMatrix4(it.matrix),it.geometry=at,it.renderOrder=1/0,it.position.set(0,0,0),it.rotation.set(0,0,0),it.scale.set(1,1,1),M.add(it)}return M}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=N(E)),this.add(this.gizmo.rotate=N(x)),this.add(this.gizmo.scale=N(L)),this.add(this.picker.translate=N(C)),this.add(this.picker.rotate=N(O)),this.add(this.picker.scale=N(V)),this.add(this.helper.translate=N(I)),this.add(this.helper.rotate=N(A)),this.add(this.helper.scale=N(T)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const e=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Wd;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let n=0;n<i.length;n++){const r=i[n];r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition);let o;if(this.camera.isOrthographicCamera?o=(this.camera.top-this.camera.bottom)/this.camera.zoom:o=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),r.scale.set(1,1,1).multiplyScalar(o*this.size/4),r.tag==="helper"){r.visible=!1,r.name==="AXIS"?(r.visible=!!this.axis,this.axis==="X"&&(Ee.setFromEuler(gd.set(0,0,0)),r.quaternion.copy(e).multiply(Ee),Math.abs(le.copy(Yh).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Y"&&(Ee.setFromEuler(gd.set(0,0,Math.PI/2)),r.quaternion.copy(e).multiply(Ee),Math.abs(le.copy(So).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Z"&&(Ee.setFromEuler(gd.set(0,Math.PI/2,0)),r.quaternion.copy(e).multiply(Ee),Math.abs(le.copy(Wh).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="XYZE"&&(Ee.setFromEuler(gd.set(0,Math.PI/2,0)),le.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix(Hy.lookAt($y,le,So)),r.quaternion.multiply(Ee),r.visible=this.dragging),this.axis==="E"&&(r.visible=!1)):r.name==="START"?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):r.name==="END"?(r.position.copy(this.worldPosition),r.visible=this.dragging):r.name==="DELTA"?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),Ts.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Ts.applyQuaternion(this.worldQuaternionStart.clone().invert()),r.scale.copy(Ts),r.visible=this.dragging):(r.quaternion.copy(e),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=this.axis.search(r.name)!==-1));continue}r.quaternion.copy(e),this.mode==="translate"||this.mode==="scale"?(r.name==="X"&&Math.abs(le.copy(Yh).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Y"&&Math.abs(le.copy(So).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Z"&&Math.abs(le.copy(Wh).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XY"&&Math.abs(le.copy(Wh).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="YZ"&&Math.abs(le.copy(Yh).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XZ"&&Math.abs(le.copy(So).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1)):this.mode==="rotate"&&(_d.copy(e),le.copy(this.eye).applyQuaternion(Ee.copy(e).invert()),r.name.search("E")!==-1&&r.quaternion.setFromRotationMatrix(Hy.lookAt(this.eye,$y,So)),r.name==="X"&&(Ee.setFromAxisAngle(Yh,Math.atan2(-le.y,le.z)),Ee.multiplyQuaternions(_d,Ee),r.quaternion.copy(Ee)),r.name==="Y"&&(Ee.setFromAxisAngle(So,Math.atan2(le.x,le.z)),Ee.multiplyQuaternions(_d,Ee),r.quaternion.copy(Ee)),r.name==="Z"&&(Ee.setFromAxisAngle(Wh,Math.atan2(le.y,le.x)),Ee.multiplyQuaternions(_d,Ee),r.quaternion.copy(Ee))),r.visible=r.visible&&(r.name.indexOf("X")===-1||this.showX),r.visible=r.visible&&(r.name.indexOf("Y")===-1||this.showY),r.visible=r.visible&&(r.name.indexOf("Z")===-1||this.showZ),r.visible=r.visible&&(r.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),r.material._color=r.material._color||r.material.color.clone(),r.material._opacity=r.material._opacity||r.material.opacity,r.material.color.copy(r.material._color),r.material.opacity=r.material._opacity,this.enabled&&this.axis&&(r.name===this.axis||this.axis.split("").some(function(a){return r.name===a}))&&(r.material.color.setHex(16776960),r.material.opacity=1)}super.updateMatrixWorld(t)}}class mM extends lt{constructor(){super(new Rl(1e5,1e5,2,2),new br({visible:!1,wireframe:!0,side:Wn,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(t){let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),bd.copy(Yh).applyQuaternion(e==="local"?this.worldQuaternion:Wd),Ch.copy(So).applyQuaternion(e==="local"?this.worldQuaternion:Wd),Ih.copy(Wh).applyQuaternion(e==="local"?this.worldQuaternion:Wd),le.copy(Ch),this.mode){case"translate":case"scale":switch(this.axis){case"X":le.copy(this.eye).cross(bd),Cn.copy(bd).cross(le);break;case"Y":le.copy(this.eye).cross(Ch),Cn.copy(Ch).cross(le);break;case"Z":le.copy(this.eye).cross(Ih),Cn.copy(Ih).cross(le);break;case"XY":Cn.copy(Ih);break;case"YZ":Cn.copy(bd);break;case"XZ":le.copy(Ih),Cn.copy(Ch);break;case"XYZ":case"E":Cn.set(0,0,0);break}break;case"rotate":default:Cn.set(0,0,0)}Cn.length()===0?this.quaternion.copy(this.cameraQuaternion):(jy.lookAt(Ts.set(0,0,0),Cn,le),this.quaternion.setFromRotationMatrix(jy)),super.updateMatrixWorld(t)}}let gM=class eC{constructor(t,e,i,n,r,o=5,a=!0){if(k(this,"onDraggingStarted",new ft),k(this,"onDraggingEnded",new ft),k(this,"onDisposed",new ft),k(this,"normal"),k(this,"origin"),k(this,"three",new Ht),k(this,"components"),k(this,"world"),k(this,"type","default"),k(this,"_title","Clipping Plane"),k(this,"_helper"),k(this,"_visible",!0),k(this,"_enabled",!0),k(this,"_controlsActive",!1),k(this,"_arrowBoundBox",new lt),k(this,"_planeMesh"),k(this,"_controls"),k(this,"_hiddenMaterial",new br({visible:!1})),k(this,"_visibilityBeforeDisabled",!0),k(this,"notifyManager",()=>{const l=this.components.get(Ur),h=l.list.getKey(this);h&&l.list.set(h,this)}),k(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),k(this,"changeDrag",l=>{this._visible=!l.value,this.preventCameraMovement(),this.notifyDraggingChanged(l)}),this.components=t,this.world=e,!e.renderer)throw new Error("The given world must have a renderer!");this.normal=n,this.origin=i,e.renderer.setPlane(!0,this.three),this._planeMesh=eC.newPlaneMesh(o,r),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(n,i),a&&this.toggleControls(!0)}set title(t){this._title=t,this.notifyManager()}get title(){return this._title}get enabled(){return this._enabled}set enabled(t){if(!this.world.isDisposing){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=t,t?this.visible=this._visibilityBeforeDisabled:(this._visibilityBeforeDisabled=this.visible,this.visible=!1),this.world.renderer.setPlane(t,this.three),this.notifyManager()}}get visible(){return this._visible}set visible(t){this._visible=t,this._controls.getHelper().visible=t,this._helper.visible=t,this.toggleControls(t),this.notifyManager()}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(t){this._planeMesh.material=t}get size(){return this._planeMesh.scale.x}set size(t){this._planeMesh.scale.set(t,t,t)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(t,e){this.reset(),this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.getHelper().removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const t=new F(1,0,0),e=new F;this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix()}toggleControls(t){if(t){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=t}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const t=this.world.camera.three,e=this.world.renderer.three.domElement,i=new aM(t,e);return this.initializeControls(i),this.world.scene.three.add(i.getHelper()),i}initializeControls(t){t.attach(this._helper),t.showX=!1,t.showY=!1,t.setSpace("local"),this.createArrowBoundingBox(),t.getHelper().children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new se(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(t){t.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const t=new yi;return t.lookAt(this.normal),t.position.copy(this.origin),this._planeMesh.position.z+=.01,t.add(this._planeMesh),this.world.scene.three.add(t),t}static newPlaneMesh(t,e){const i=new Rl(1),n=new lt(i,e);return n.scale.set(t,t,t),n}};class _M extends Kp{constructor(){super(...arguments),k(this,"_config",{enabled:{value:!0,type:"Boolean"},visible:{value:!0,type:"Boolean"},color:{value:new xt,type:"Color"},opacity:{type:"Number",interpolable:!0,value:1,min:0,max:1},size:{type:"Number",interpolable:!0,value:2,min:0,max:100}})}get enabled(){return this._config.enabled.value}set enabled(t){this._config.enabled.value=t,this._component.enabled=t}get visible(){return this._config.visible.value}set visible(t){this._config.visible.value=t,this._component.visible=t}get color(){return this._config.color.value}set color(t){this._config.color.value=t,this._component.material.color.copy(t)}get opacity(){return this._config.opacity.value}set opacity(t){this._config.opacity.value=t,this._component.material.opacity=t}get size(){return this._config.size.value}set size(t){this._config.size.value=t,this._component.size=t}}const sC=class Gd extends he{constructor(t){super(t),k(this,"onSetup",new ft),k(this,"onBeforeDrag",new ft),k(this,"onAfterDrag",new ft),k(this,"onBeforeCreate",new ft),k(this,"onBeforeCancel",new ft),k(this,"onAfterCancel",new ft),k(this,"onBeforeDelete",new ft),k(this,"onAfterCreate",new ft),k(this,"onAfterDelete",new ft),k(this,"onDisposed",new ft),k(this,"isSetup",!1),k(this,"orthogonalY",!1),k(this,"toleranceOrthogonalY",.7),k(this,"Type",gM),k(this,"list",new Wt),k(this,"config",new _M(this,this.components,"Clipper",Gd.uuid)),k(this,"_defaultConfig",{color:new xt(12255487),opacity:.2,size:2}),k(this,"_material",new br({color:12255487,side:Wn,transparent:!0,opacity:.2})),k(this,"_size",5),k(this,"_enabled",!1),k(this,"_visible",!0),k(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),k(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(Gd.uuid,this),this.setEvents()}get enabled(){return this._enabled}set enabled(t){this._enabled=t}get visible(){return this._visible}set visible(t){this._visible=t;for(const[e,i]of this.list)i.visible=t}get material(){return this._material}set material(t){this._material=t;for(const[e,i]of this.list)i.planeMaterial=t}get size(){return this._size}set size(t){this._size=t;for(const[e,i]of this.list)i.size=t}setEvents(){this.list.onBeforeDelete.add(({value:t})=>{if(!t.world.renderer)throw new Error("Renderer not found for this plane's world!");t.world.renderer.setPlane(!1,t.three),t.dispose(),this.updateMaterialsAndPlanes()})}dispose(){this._enabled=!1,this.components.get(Z_).list.delete(this.config.uuid),this.list.clear(),this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(Gd.uuid),this.onDisposed.reset()}async create(t){const e=await this.components.get(hn).get(t).castRay();return e?this.createPlaneFromIntersection(t,e):null}createFromNormalAndCoplanarPoint(t,e,i){const n=this.newPlane(t,i,e);return this.updateMaterialsAndPlanes(),n}async delete(t,e){if(!e){const i=await this.pickPlane(t);if(!i)return;e=this.list.getKey(i)}e&&this.list.delete(e)}deleteAll(t){for(const[e,i]of this.list)(!t||t.has(i.type))&&this.list.delete(e)}setup(t){const e={...this._defaultConfig,...t};this.config.color=e.color,this.config.opacity=e.opacity,this.config.size=e.size,this.isSetup=!0,this.onSetup.trigger()}async pickPlane(t){const e=this.components.get(hn).get(t),i=this.getAllPlaneMeshes(),n=await e.castRay({items:i});if(n){const r=n.object;return[...this.list.values()].find(o=>o.meshes.includes(r))}}getAllPlaneMeshes(){const t=[];for(const[e,i]of this.list)t.push(...i.meshes);return t}createPlaneFromIntersection(t,e){var i;if(!t.renderer)throw new Error("The given world must have a renderer!");const n=e.point.distanceTo(new F(0,0,0)),r=e.normal||((i=e.face)==null?void 0:i.normal);if(!n||!r)return null;const o=this.getWorldNormal(e,r),a=this.newPlane(t,e.point,o.negate()),l=this.list.get(a);return l.visible=this._visible,l.size=this._size,t.renderer.setPlane(!0,l.three),this.updateMaterialsAndPlanes(),l}getWorldNormal(t,e){const i=t.object;let n=t.object.matrixWorld.clone();if(i instanceof dw&&t.instanceId!==void 0){const a=new vt;i.getMatrixAt(t.instanceId,a),n=a.multiply(n)}const r=new pw().getNormalMatrix(n),o=e.clone().applyMatrix3(r).normalize();return this.normalizePlaneDirectionY(o),o}normalizePlaneDirectionY(t){this.orthogonalY&&(t.y>this.toleranceOrthogonalY&&(t.x=0,t.y=1,t.z=0),t.y<-this.toleranceOrthogonalY&&(t.x=0,t.y=-1,t.z=0))}newPlane(t,e,i){const n=new this.Type(this.components,t,e,i,this._material);n.onDraggingStarted.add(this._onStartDragging),n.onDraggingEnded.add(this._onEndDragging);const r=Ss.create();return this.list.set(r,n),this.onAfterCreate.trigger(n),r}updateMaterialsAndPlanes(){const t=this.components.get($E);for(const[e,i]of t.list){if(!i.renderer)continue;i.renderer.updateClippingPlanes();const{clippingPlanes:n}=i.renderer;for(const r of i.meshes)if(r.material)if(Array.isArray(r.material))for(const o of r.material)o.clippingPlanes=n;else r.material.clippingPlanes=n}}};k(sC,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let Ur=sC,iC=class{constructor(s,t){k(this,"title"),k(this,"guid",Ss.create()),k(this,"clippingPlanes",new ge),k(this,"camera",{aspect_ratio:1,field_of_view:60,camera_direction:{x:0,y:0,z:0},camera_view_point:{x:0,y:0,z:0},camera_up_vector:{x:0,y:1,z:0}}),k(this,"exceptionComponents",new ge),k(this,"selectionComponents",new ge),k(this,"componentColors",new Wt),k(this,"spacesVisible",!1),k(this,"spaceBoundariesVisible",!1),k(this,"openingsVisible",!1),k(this,"defaultVisibility",!0),k(this,"snapshot",this.guid),k(this,"_components"),k(this,"_world",null),k(this,"notifyUpdate",()=>{this._components.get(or).list.set(this.guid,this)}),this._components=s,t&&(this.guid=t.guid??this.guid,this.set(t)),this.setEvents()}async getSelectionMap(){return await this._components.get(Lt).guidsToModelIdMap([...this.selectionComponents])}async getExceptionMap(){return await this._components.get(Lt).guidsToModelIdMap([...this.exceptionComponents])}get projection(){return"field_of_view"in this.camera?"Perspective":"Orthographic"}get position(){const s=this._components.get(Lt),{camera_view_point:t}=this.camera,{x:e,y:i,z:n}=t,r=new F(e,i,n);return s.applyBaseCoordinateSystem(r,new vt),r}set position(s){const t=s.clone(),e=this._components.get(Lt);s.clone().applyMatrix4(e.baseCoordinationMatrix.clone().invert()),this.camera.camera_view_point={x:t.x,y:t.y,z:t.z}}get direction(){const{camera_direction:s}=this.camera,{x:t,y:e,z:i}=s;return new F(t,e,i)}set world(s){this._world=s}get world(){return this._world}get _managerVersion(){return this._components.get(ts).config.version}get topics(){return[...this._components.get(ts).list.values()].filter(s=>s.viewpoints.has(this.guid))}setEvents(){this.selectionComponents.onUpdated.add(this.notifyUpdate),this.exceptionComponents.onUpdated.add(this.notifyUpdate),this.clippingPlanes.onUpdated.add(this.notifyUpdate),this.componentColors.onItemSet.add(this.notifyUpdate),this.componentColors.onItemDeleted.add(this.notifyUpdate),this.componentColors.onItemUpdated.add(this.notifyUpdate),this.componentColors.onCleared.add(this.notifyUpdate)}set(s){this.title=s.title;const{components:t,perspective_camera:e,orthogonal_camera:i,clipping_planes:n}=s;if(t){const{selection:r,visibility:o,coloring:a}=t;if(r){this.selectionComponents.clear();for(const{ifc_guid:l}of r)l&&this.selectionComponents.add(l)}if(o){const{default_visibility:l,exceptions:h,view_setup_hints:c}=o;if(l!==void 0&&(this.defaultVisibility=l),h){this.exceptionComponents.clear();for(const{ifc_guid:u}of h)u&&this.exceptionComponents.add(u)}if(c){const{spaces_visible:u,space_boundaries_visible:p,openings_visible:d}=c;u!==void 0&&(this.spacesVisible=u),p!==void 0&&(this.spaceBoundariesVisible=p),d!==void 0&&(this.openingsVisible=d)}}if(a){this.componentColors.clear();for(const l of a){const{color:h,components:c}=l,u=c.map(p=>p.ifc_guid).filter(p=>p!==null);this.componentColors.set(h,u)}}}if((e||i)&&(this.camera=e??i),n&&this.world){const r=this._components.get(Ur);for(const o of n){const{location:a,direction:l}=o,h=new F(a.x,a.z,-a.y),c=new F(l.x,l.z,-l.y),u=r.createFromNormalAndCoplanarPoint(this.world,c,h);this.clippingPlanes.add(u),r.list.get(u).enabled=!1,r.list.get(u).visible=!1}}this.notifyUpdate()}async go(s){if(!this.world)return;const{camera:t}=this.world;if(!(t instanceof KE))throw new Error("Viewpoint: the world's camera component must be of type OrthoPerspectiveCamera to switch between perspective and orthographic projections.");const{transition:e,applyClippings:i,applyVisibility:n,clippingsVisibility:r}={transition:!0,applyClippings:!0,applyVisibility:!0,clippingsVisibility:!0,...s};t.projection.set(this.projection);const o=new F(this.camera.camera_view_point.x,this.camera.camera_view_point.y,this.camera.camera_view_point.z),a=new F(this.camera.camera_direction.x,this.camera.camera_direction.y,this.camera.camera_direction.z);if(o.equals(new F)&&a.equals(new F))return;const l=this.position,h=this.direction,c=80,u={x:l.x+h.x*c,y:l.y+h.y*c,z:l.z+h.z*c},p=[];i&&this.setClippingState(!0),n&&p.push(this.applyVisibility()),this.setClippingVisibility(r),p.push(t.controls.setLookAt(l.x,l.y,l.z,u.x,u.y,u.z,e)),await Promise.all(p)}async updateCamera(s=!0){return new Promise(t=>{if(!this.world){t(!1);return}const{camera:e,renderer:i}=this.world;if(!i)throw new Error("Viewpoint: the world needs to have a renderer!");if(!e.hasCameraControls())throw new Error("Viewpoint: world's camera need camera controls!");const n=new F;e.controls.getPosition(n);const r=e.three,o=new F(0,0,-1).applyEuler(r.rotation),{width:a,height:l}=i.getSize();let h=a/l;Number.isNaN(h)&&(h=1);const c=this._components.get(Lt);n.applyMatrix4(c.baseCoordinationMatrix.clone().invert());const u={aspect_ratio:h,camera_view_point:{x:n.x,y:n.y,z:n.z},camera_direction:{x:o.x,y:o.y,z:o.z},camera_up_vector:{x:0,y:1,z:0}};if(r instanceof Hc?this.camera={...u,field_of_view:r.fov}:r instanceof aa&&(this.camera={...u,view_to_world_scale:r.top-r.bottom}),s){const p=this._components.get(or),d=i.three.domElement;i.three.render(this.world.scene.three,e.three),d.toBlob(async _=>{if(_){const m=await _.arrayBuffer(),g=new Uint8Array(m);p.snapshots.set(this.guid,g)}this.notifyUpdate(),t(!0)})}else this.notifyUpdate(),t(!0)})}takeSnapshot(){return new Promise(s=>{if(!this.world){s(!1);return}const{camera:t,renderer:e}=this.world;if(!e)throw new Error("Viewpoint: the world needs to have a renderer!");const i=this._components.get(or),n=e.three.domElement;e.three.render(this.world.scene.three,t.three),n.toBlob(async r=>{if(r){const o=await r.arrayBuffer(),a=new Uint8Array(o);i.snapshots.set(this.guid,a)}this.notifyUpdate(),s(!0)})})}updateClippingPlanes(){this.clippingPlanes.clear();const s=this._components.get(Ur);for(const[t,e]of s.list)e.enabled&&this.clippingPlanes.add(t)}async applyVisibility(){const s=this._components.get(D5);s.set(this.defaultVisibility);const t=await this.getExceptionMap();s.set(!this.defaultVisibility,t);const e=await this.getSelectionMap();s.set(!0,e)}async setColorizationState(s){const t=this._components.get(Lt),e=[];if(s)for(const[i,n]of this.componentColors){const r=`#${i}`,o=await t.guidsToModelIdMap(n);for(const[a,l]of Object.entries(o)){const h=t.list.get(a);h&&e.push(h.highlight([...l],{customId:r,color:new xt(r),renderedFaces:jc.ONE,opacity:1,transparent:!1}))}}else for(const[i,n]of this.componentColors){const r=await t.guidsToModelIdMap(n);for(const[o,a]of Object.entries(r)){const l=t.list.get(o);l&&e.push(l.resetHighlight([...a]))}}e.push(t.core.update(!0)),await Promise.all(e)}setClippingState(s){const t=this._components.get(Ur);for(const[e,i]of t.list)i.enabled=s&&this.clippingPlanes.has(e)}setClippingVisibility(s){const t=this._components.get(Ur);for(const e of this.clippingPlanes){const i=t.list.get(e);i&&(i.visible=s)}}async createComponentTags(s){var t;const e=this._components.get(Lt),i=this._components.get(ts);let n="";if(i.config.includeSelectionTag){const r=s==="selection"?await this.getSelectionMap():await this.getExceptionMap();for(const o in r){const a=e.list.get(o);if(!a)continue;const l=r[o];for(const h of l){const c=a.getItem(h),u=await c.getGuid();if(!u)continue;const p=(t=await c.getAttributes())==null?void 0:t.getValue("Tag");let d=null;p&&(d=`AuthoringToolId="${p}"`),n+=`
<Component IfcGuid="${u}" ${d??""} />`}}}else n=[...this.selectionComponents].map(r=>`<Component IfcGuid="${r}" />`).join(`
`);return n}createColorTags(){let s="";for(const[t,e]of this.componentColors.entries()){const i=e.map(n=>`
<Component IfcGuid="${n}" />`).join(`
`);s+=`<Color Color="${t}">
${i}
</Color>`}return s.length!==0?`<Coloring>
${s}
</Coloring>`:"<Coloring />"}toJSON(){const s=this._components.get(Ur),t={guid:this.guid,components:{selection:[...this.selectionComponents].map(n=>({ifc_guid:n,authoring_tool_id:null})),coloring:[...this.componentColors].map(([n,r])=>({color:n,components:r.map(o=>({ifc_guid:o,authoring_tool_id:null}))})),visibility:{default_visibility:this.defaultVisibility,exceptions:[...this.exceptionComponents].map(n=>({ifc_guid:n,authoring_tool_id:null})),view_setup_hints:{spaces_visible:this.spacesVisible,space_boundaries_visible:this.spaceBoundariesVisible,openings_visible:this.openingsVisible}}},clipping_planes:[...this.clippingPlanes].map(n=>{const r=s.list.get(n);if(!r)return null;const o=r._controls.worldPosition??r.origin,{normal:a}=r;return{location:{x:o.x,y:-o.z,z:o.y},direction:{x:a.x,y:-a.z,z:a.y}}}).filter(n=>n!==null)};"field_of_view"in this.camera?t.perspective_camera=this.camera:t.orthogonal_camera=this.camera;const e=this._components.get(or),i=e.snapshots.get(this.snapshot);if(i){const n=i.toString(),r=btoa(n),o=e.getSnapshotExtension(this.snapshot);t.snapshot={snapshot_type:o,snapshot_data:r}}return t}async serialize(s=this._managerVersion){const t=this._components.get(Lt),e=this.position;e.applyMatrix4(t.baseCoordinationMatrix.clone().invert());const i=this.direction;i.normalize();const n=new vt().makeRotationX(Math.PI/2),r=i.clone().applyMatrix4(n);r.normalize();const o=`<CameraViewPoint>
      <X>${e.x}</X>
      <Y>${-e.z}</Y>
      <Z>${e.y}</Z>
    </CameraViewPoint>`,a=`<CameraDirection>
      <X>${i.x}</X>
      <Y>${-i.z}</Y>
      <Z>${i.y}</Z>
    </CameraDirection>`,l=`<CameraUpVector>
      <X>${r.x}</X>
      <Y>${-r.z}</Y>
      <Z>${r.y}</Z>
    </CameraUpVector>`,h=`<AspectRatio>${this.camera.aspect_ratio}</AspectRatio>`;let c="";"viewToWorld"in this.camera?c=`<OrthogonalCamera>
        ${o}
        ${a}
        ${l}
        ${h}
        <ViewToWorldScale>${this.camera.viewToWorld}</ViewToWorldScale>
      </OrthogonalCamera>`:"fov"in this.camera&&(c=`<PerspectiveCamera>
        ${o}
        ${a}
        ${l}
        ${h}
        <FieldOfView>${this.camera.fov}</FieldOfView>
      </PerspectiveCamera>`);const u=`<ViewSetupHints SpacesVisible="${this.spacesVisible??!1}" SpaceBoundariesVisible="${this.spaceBoundariesVisible??!1}" OpeningsVisible="${this.openingsVisible??!1}" />`,p=(await this.createComponentTags("selection")).trim(),d=(await this.createComponentTags("exception")).trim(),_=this.createColorTags();return`<?xml version="1.0" encoding="UTF-8"?>
    <VisualizationInfo Guid="${this.guid}">
      <Components>
        ${s==="2.1"?u:""}
        ${p.length!==0?`<Selection>${p}</Selection>`:""}
        <Visibility DefaultVisibility="${this.defaultVisibility}">
          ${s==="3"?u:""}
          ${d.length!==0?`<Exceptions>${d}</Exceptions>`:""}
        </Visibility>
        ${_}
      </Components>
      ${c}
    </VisualizationInfo>`}};class bM extends Kp{constructor(){super(...arguments),k(this,"_config",{overwriteColors:{value:!1,type:"Boolean"}})}get overwriteColors(){return this._config.overwriteColors.value}set overwriteColors(t){this._config.overwriteColors.value=t}}const nC=class Jg extends he{constructor(t){super(t),k(this,"enabled",!0),k(this,"world",null),k(this,"list",new Wt),k(this,"snapshots",new Wt),k(this,"isSetup",!1),k(this,"onSetup",new ft),k(this,"config",new bM(this,this.components,"Viewpoints",Jg.uuid)),k(this,"onDisposed",new ft),t.add(Jg.uuid,this)}create(t){const e=new iC(this.components,t);return e.world=this.world,t||this.list.set(e.guid,e),e}getSnapshotExtension(t){let e="jpeg";const i=this.snapshots.get(t);if(!i)return e;const n=i.subarray(0,4);let r="";for(let o=0;o<n.length;o++)r+=n[o].toString(16);return r.startsWith("89504e47")&&(e="png"),r.startsWith("ffd8ffe")&&(e="jpeg"),e}setup(){}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}};k(nC,"uuid","ee867824-a796-408d-8aa0-4e5962a83c66");let or=nC,Yy=class{constructor(s,t){k(this,"_components"),k(this,"_cameraOffset",10),k(this,"_planeHelper"),k(this,"_farPlaneHelper"),k(this,"_cameraHelper"),k(this,"onStateChanged",new ft),k(this,"onUpdated",new ft),k(this,"onDisposed",new ft),k(this,"camera"),k(this,"plane",new Ht),k(this,"farPlane",new Ht),k(this,"id",Ss.create()),k(this,"_open",!1),k(this,"_range",yM.defaultRange),k(this,"_world",null),k(this,"_helpersVisible",!1),k(this,"_planesEnabled",!1),this._components=s,this.camera=new KE(this._components);const{threeOrtho:e}=this.camera;if(t!=null&&t.id&&(this.id=t.id),t!=null&&t.normal&&t!=null&&t.point){const{normal:i,point:n}=t;this.plane.setFromNormalAndCoplanarPoint(i,n)}this._cameraHelper=new mw(e),this._planeHelper=new Jd(this.plane,50),this._farPlaneHelper=new Jd(this.farPlane,50),this.farPlaneHelperColor=new xt("blue"),this.update()}get _planeNormalOpposite(){return this.plane.normal.clone().negate()}get _planePosition(){return this.plane.normal.clone().multiplyScalar(-this.plane.constant)}get _cameraPosition(){return this._planePosition.addScaledVector(this._planeNormalOpposite,this._cameraOffset)}set open(s){this._open=s,this.onStateChanged.trigger(["open"])}get open(){return this._open}set planeHelperColor(s){!Array.isArray(this._planeHelper.material)&&"color"in this._planeHelper.material&&this._planeHelper.material.color instanceof xt&&(this._planeHelper.material.color=s)}set farPlaneHelperColor(s){!Array.isArray(this._farPlaneHelper.material)&&"color"in this._farPlaneHelper.material&&this._farPlaneHelper.material.color instanceof xt&&(this._farPlaneHelper.material.color=s)}set range(s){this._range=s,this.update()}get range(){return this._range}set distance(s){this.plane.constant=s,this.update()}get distance(){return this.plane.constant}set world(s){this._world=s,this.camera.currentWorld=s,s&&(this.camera.projection.set("Orthographic"),this.camera.set("Plan"),this.camera.controls.dollySpeed=6,this.camera.controls.restThreshold=.005,this.update())}get world(){return this._world}set helpersVisible(s){if(!s){this._helpersVisible=s,this._planeHelper.removeFromParent(),this._farPlaneHelper.removeFromParent(),this._cameraHelper.removeFromParent();return}this.world&&(this._helpersVisible=s,this.world.scene.three.add(this._planeHelper,this._farPlaneHelper))}get helpersVisible(){return this._helpersVisible}set planesEnabled(s){const{world:t}=this;if(!t)return;const{renderer:e}=t;e&&(e.setPlane(s,this.plane),e.setPlane(s,this.farPlane),this._planesEnabled=s)}get planesEnabled(){return this._planesEnabled}dispose(){this.helpersVisible=!1;const s=this._components.get(dr);s.destroy(this._planeHelper),s.destroy(this._farPlaneHelper),s.destroy(this._cameraHelper),this.camera.dispose(),this.onDisposed.trigger()}update(){if(this.world){const s=this._cameraPosition,t=this._planePosition;this.camera.controls.setLookAt(s.x,s.y,s.z,t.x,t.y,t.z,!1)}this.farPlane.normal.copy(this._planeNormalOpposite),this.farPlane.constant=this.range-this.plane.constant,this.onUpdated.trigger()}flip(){this.plane.normal.negate(),this.update()}};const J_=class rC extends he{constructor(t){super(t),k(this,"list",new Wt),k(this,"enabled",!0),k(this,"world",null),k(this,"_fragmentsUpdateEvent",()=>{this.components.get(Lt).core.update(!0)}),t.add(rC.uuid,this),this.setupEvents()}get hasOpenViews(){return[...this.list.values()].some(t=>t.open)}setupEvents(){this.list.onBeforeDelete.add(({key:t,value:e})=>{e.open&&this.close(t),e.dispose()})}create(t,e,i){const n=new Yy(this.components,{id:i==null?void 0:i.id,normal:t,point:e});return n.world=(i==null?void 0:i.world)??this.world,this.list.set(n.id,n),n}createFromPlane(t,e){const i=new Yy(this.components,{id:e==null?void 0:e.id});return i.plane.copy(t),i.update(),i.world=(e==null?void 0:e.world)??this.world,this.list.set(i.id,i),i}async createFromIfcStoreys(t){const e=[],i=this.components.get(Lt),n=(t==null?void 0:t.offset)===void 0?.25:t.offset;for(const[r,o]of i.list){if(t&&t.modelIds&&!t.modelIds.some(u=>u.test(r)))continue;const a=Object.values(await o.getItemsOfCategories([/BUILDINGSTOREY/])).flat();if(a.length===0)continue;const l=await o.getItemsData(a),[,h]=await o.getCoordinates(),c=new F(0,-1,0);for(const u of l){if(!("value"in u.Name&&"value"in u.Elevation))continue;const{value:p}=u.Name;if(t!=null&&t.storeyNames&&!t.storeyNames.some(g=>g.test(p)))continue;const d=u.Elevation.value+h+n,_=new Ht(c,d),m=this.createFromPlane(_,{id:p,world:t==null?void 0:t.world});e.push(m)}}return e}createElevations(t){const e=[],i=this.components.get(Lt),n=(t==null?void 0:t.combine)===void 0?!1:t.combine,r=(t==null?void 0:t.namingCallback)??(a=>({front:`${n?"Front":`${a}: Front`}`,back:`${n?"Back":`${a}: Back`}`,left:`${n?"Left":`${a}: Left`}`,right:`${n?"Right":`${a}: Right`}`}));let o=[];for(const[a,l]of i.list)t&&t.modelIds&&!t.modelIds.some(h=>h.test(a))||o.push({id:a,box:l.box});if(n){const a=this.components.get(FE);a.list.clear(),a.list.add(...o.map(l=>l.box)),o=[{id:"combined",box:a.get()}]}for(const{id:a,box:l}of o){const{min:h,max:c}=l,u=Math.abs(c.x-h.x),p=Math.abs(c.z-h.z),d=new F;l.getCenter(d);const _=new Ht(new F(0,0,-1),c.z),m=new Ht(new F(0,0,1),-h.z),g=new Ht(new F(-1,0,0),c.x),f=new Ht(new F(1,0,0),-h.x),{front:b,back:y,left:E,right:C}=r(a),I=this.createFromPlane(_,{id:b,world:t==null?void 0:t.world});I.range=p;const x=this.createFromPlane(m,{id:y,world:t==null?void 0:t.world});x.range=p;const A=this.createFromPlane(g,{id:E,world:t==null?void 0:t.world});A.range=u;const O=this.createFromPlane(f,{id:C,world:t==null?void 0:t.world});O.range=u,e.push(I,x,A,O)}return e}open(t){const e=this.list.get(t);if(!e)throw new Error(`Views: the view with id ${t} doesn't exist.`);if(e.open)return;const{world:i}=e;if(!i)throw new Error(`Views: no world found for view with id ${t}.`);const{renderer:n}=i;if(!n)throw new Error(`Views: no renderer found for world with id ${i.uuid}.`);for(const[,r]of this.list)r.world===i&&this.close(r.id);n.setPlane(!0,e.plane),n.setPlane(!0,e.farPlane),e.camera.controls.addEventListener("rest",this._fragmentsUpdateEvent),i.camera=e.camera,e.open=!0}close(t){let e;if(t?e=this.list.get(t):e=[...this.list.values()].find(r=>r.open),t&&!e)throw new Error(`Views: the view with id ${t} doesn't exist.`);if(!e||!e.open)return;const{world:i}=e;if(!i)throw new Error(`Views: no world found for view with id ${t}.`);const{renderer:n}=i;if(!n)throw new Error(`Views: no renderer found for world with id ${i.uuid}.`);n.setPlane(!1,e.plane),n.setPlane(!1,e.farPlane),e.camera.controls.removeEventListener("rest",this._fragmentsUpdateEvent),i.useDefaultCamera(),e.open=!1}};k(J_,"uuid","fb22f1f5-6598-4664-a11d-de8963ae420f");k(J_,"defaultRange",15);let yM=J_,kl=class{constructor(s){k(this,"cardinality","required"),k(this,"instructions"),k(this,"evalRequirement",(t,e,i,n)=>{const r={parameter:i,currentValue:t,requiredValue:e,pass:!1};n&&this.addCheckResult(r,n);let o=!1;if(e.type==="simple"&&(o=t===e.parameter),e.type==="enumeration"&&(o=e.parameter.includes(t)),e.type==="pattern"&&(o=new RegExp(e.parameter).test(String(t))),e.type==="length"){const{min:a,length:l,max:h}=e.parameter;l!==void 0&&(o=String(t).length===l),a!==void 0&&(o=String(t).length>=a),h!==void 0&&(o=String(t).length<=h)}if(e.type==="bounds"&&typeof t=="number"){const{min:a,minInclusive:l,max:h,maxInclusive:c}=e.parameter;let u=!0,p=!0;a!==void 0&&(u=l?t>=a:t>a),h!==void 0&&(p=c?t<=h:t<h),o=u&&p}return this.cardinality==="prohibited"&&(o=!o),this.cardinality==="optional"&&(o=!0),r.pass=o,r.pass}),this._components=s}addCheckResult(s,t){const e=t.findIndex(({parameter:i})=>i===s.parameter);e!==-1?t[e]=s:t.push(s)}getItemChecks(s,t,e){if(!("value"in e._localId&&typeof e._localId.value=="number"))return null;let i=s.get(t);i||(i=new Wt,s.set(t,i));let n=i.get(e._localId.value);if(n){if(!n.pass)return null}else{const a=[];n={guid:Array.isArray(e._guid)?void 0:e._guid.value,pass:!1,checks:a},Object.defineProperty(n,"pass",{get:()=>a.every(({pass:l})=>l)}),i.set(e._localId.value,n)}const r=[],o={facetType:this.facetType,cardinality:this.cardinality,checks:r,pass:!1};return Object.defineProperty(o,"pass",{get:()=>r.every(({pass:a})=>a)}),n.checks.push(o),o.checks}};const Hn=(s,t)=>{let e="";if(!t)return e;if(t.type==="simple"&&(e=`<simpleValue>${t.parameter}</simpleValue>`),t.type==="enumeration"&&(e=`<xs:restriction base="xs:string">
    ${t.parameter.map(i=>`<xs:enumeration value="${i}" />`).join(`
`)}
    </xs:restriction>`),t.type==="pattern"&&(e=`<xs:restriction base="xs:string">
      <xs:pattern value="${t.parameter}" />
    </xs:restriction>`),t.type==="bounds"){const{min:i,minInclusive:n,max:r,maxInclusive:o}=t.parameter;let a="";i!==void 0&&(a=`<xs:min${n?"Inclusive":"Exclusive"} value="${i}">`);let l="";r!==void 0&&(l=`<xs:max${o?"Inclusive":"Exclusive"} value="${r}">`),e=`<xs:restriction base="xs:double">
      ${a}
      ${l}
    </xs:restriction>`}if(t.type==="length"){const{length:i,min:n,max:r}=t.parameter;let o="";i!==void 0&&n===void 0&&r===void 0&&(o=`<xs:length value="${i}" />`);let a="";n!==void 0&&i===void 0&&(a=`<xs:minLength value="${n}" />`);let l="";r!==void 0&&i===void 0&&(l=`<xs:maxLength value="${r}" />`),e=`<xs:restriction base="xs:string">
      ${o}
      ${a}
      ${l}
    </xs:restriction>`}return`<${s[0].toLowerCase()+s.slice(1)}>
    ${e}
  </${s[0].toLowerCase()+s.slice(1)}>`};class vM extends kl{constructor(t,e){super(t),k(this,"facetType","Attribute"),k(this,"name"),k(this,"value"),this.name=e}serialize(t){const e=Hn("Name",this.name),i=Hn("Value",this.value);let n="";return t==="requirement"&&(n+=`cardinality="${this.cardinality}"`,n+=this.instructions?`instructions="${this.instructions}"`:""),`<attribute ${n}>
  ${e}
  ${i}
</attribute>`}async getEntities(){}async test(t,e){const i=this._components.get(Lt);for(const[n,r]of Object.entries(t)){const o=i.list.get(n);if(!o)continue;const a=await o.getItemsData([...r]);for(const l of a){const h=this.getItemChecks(e,n,l);if(!h)continue;const c=Object.keys(l).filter(p=>{const d=this.evalRequirement(p,this.name,"Name");if(!d)return!1;const _=l[p];return Array.isArray(_)?!0:_===null||_.value===null?this.cardinality==="optional"||this.cardinality==="prohibited":Array.isArray(_.value)&&_.value.length===0||typeof _.value=="string"&&_.value.trim()===""?!1:d}),u=c.length>0;if(h.push({parameter:"Name",currentValue:u?c[0]:null,requiredValue:this.name,pass:this.cardinality==="prohibited"?!u:u}),this.value)if(c[0]){const p=l[c[0]];Array.isArray(p)?h.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"}):Array.isArray(p.value)?h.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"}):this.evalRequirement(p.value,this.value,"Value",h)}else h.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"})}}}}class wM extends kl{constructor(t,e){super(t),k(this,"facetType","Classification"),k(this,"system"),k(this,"value"),k(this,"uri"),this.system=e}serialize(t){const e=Hn("System",this.system),i=Hn("Value",this.value);let n="";return t==="requirement"&&(n+=`cardinality="${this.cardinality}"`,n+=this.uri?`uri=${this.uri}`:"",n+=this.instructions?`instructions="${this.instructions}"`:""),`<classification ${n}>
  ${e}
  ${i}
</classification>`}async getEntities(t,e){}async test(t,e){}}let t_=class extends kl{constructor(s,t){super(s),k(this,"facetType","Entity"),k(this,"name"),k(this,"predefinedType"),this.name=t}serialize(s){const t=Hn("Name",this.name),e=Hn("Name",this.predefinedType);let i="";return s==="requirement"&&(i+=`cardinality="${this.cardinality}"`,i+=this.instructions?`instructions="${this.instructions}"`:""),`<entity ${i}>
  ${t}
  ${e}
</entity>`}async getEntities(s,t){const e=this._components.get(Lt),i=new Map;for(const[r,o]of e.list){if(!s.find(l=>l.test(r)))continue;const a=await o.getCategories();for(const l of a){if(!await this.evalName(l))continue;let h=i.get(r);h||(h=[],i.set(r,h)),h.push(l)}}const n={};if(await Promise.all(Array.from(i.entries()).map(async([r,o])=>{const a=e.list.get(r);if(!a)return;const l=o.map(u=>new RegExp(`^${u}$`)),h=await a.getItemsOfCategories(l),c=Object.values(h).flat();n[r]=new Set(c)})),!this.predefinedType){vs.add(t,n);return}for(const[r,o]of Object.entries(n)){const a=e.list.get(r);if(!a)continue;const l=await a.getItemsData([...o]);for(const h of l)"value"in h._localId&&await this.evalPredefinedType(r,h)&&vs.append(t,r,h._localId.value)}}async test(s,t){const e=this._components.get(Lt);for(const[i,n]of Object.entries(s)){const r=e.list.get(i);if(!r)continue;const o=await r.getItemsData([...n]);for(const a of o){if(!("value"in a._category))continue;const l=this.getItemChecks(t,i,a);l&&(await this.evalName(a._category.value,l),await this.evalPredefinedType(i,a,l))}}}async evalName(s,t){return this.evalRequirement(s,this.name,"Name",t)}async evalPredefinedType(s,t,e){if(!this.predefinedType||!("value"in t.PredefinedType))return null;const i=typeof this.predefinedType.parameter=="string"&&this.predefinedType.parameter==="USERDEFINED";let n=t.PredefinedType.value;if(n==="USERDEFINED"&&!i){const r=Object.keys(t).find(o=>/^((?!Predefined).)*Type$/.test(o));if(r){const o=t[r];"value"in o&&(n=o.value)}else n="USERDEFINED"}if(!n){const r=this._components.get(Lt).list.get(s);if(r&&"value"in t._localId){const[o]=await r.getItemsData([t._localId.value],{relations:{IsTypedBy:{attributes:!0,relations:!1}}});if(Array.isArray(o.IsTypedBy)){const a=o.IsTypedBy[0];if(a&&"value"in a.PredefinedType&&(n=a.PredefinedType.value,n==="USERDEFINED"&&!i)){const l=Object.keys(a).find(h=>/^((?!Predefined).)*Type$/.test(h));if(l){const h=a[l];"value"in h&&(n=h.value)}else n="USERDEFINED"}}}}return this.evalRequirement(n,this.predefinedType,"PredefinedType",e)}};class EM extends kl{constructor(t,e,i){super(t),k(this,"facetType","Property"),k(this,"propertySet"),k(this,"baseName"),k(this,"value"),k(this,"dataType"),k(this,"uri"),k(this,"_unsupportedTypes",["IFCCOMPLEXPROPERTY","IFCPHYSICALCOMPLEXQUANTITY"]),this.propertySet=e,this.baseName=i}serialize(t){const e=Hn("PropertySet",this.propertySet),i=Hn("BaseName",this.baseName),n=Hn("Value",this.value),r=this.dataType?`dataType=${this.dataType}`:"";let o="";return t==="requirement"&&(o+=`cardinality="${this.cardinality}"`,o+=this.uri?`uri=${this.uri}`:"",o+=this.instructions?`instructions="${this.instructions}"`:""),`<property ${r} ${o}>
  ${e}
  ${i}
  ${n}
</property>`}async getEntities(t,e){const i=this._components.get(Lt);for(const[n,r]of i.list){if(!t.find(h=>h.test(n)))continue;const o=await r.getItemsOfCategories([/PROPERTYSET/,/ELEMENTQUANTITY/]),a=Object.values(o).flat();if(a.length===0)continue;const l=await r.getItemsData(a,{relations:{HasProperties:{attributes:!0,relations:!1},DefinesOcurrence:{attributes:!0,relations:!1}}});for(const h of l){if(!("value"in h._localId&&"value"in h._category&&"value"in h.Name&&Array.isArray(h.DefinesOcurrence))||!this.evalRequirement(h.Name.value,this.propertySet,"PropertySet"))continue;let c;if(h._category.value==="IFCPROPERTYSET"&&(c="HasProperties"),h._category.value==="IFCELEMENTQUANTITY"&&(c="Quantities"),!c)continue;const u=h[c];if(Array.isArray(u))for(const p of u){const d=Object.keys(p),_=d.find(f=>/Name/.test(f));if(!(_&&"value"in p[_]))continue;const m=p[_];if(!("value"in m)||!this.evalRequirement(m.value,this.baseName,"BaseName"))continue;if(this.value){const f=d.find(y=>/Value/.test(y));if(!f)continue;const b=p[f];if(!("value"in b)||!this.evalRequirement(b.value,this.value,"Value"))continue}const g=h.DefinesOcurrence.map(f=>"value"in f._localId&&typeof f._localId.value=="number"?f._localId.value:null).filter(f=>f!==null);vs.append(e,n,...g)}}}}async test(t,e){const i=this._components.get(Lt);for(const[n,r]of Object.entries(t)){const o=i.list.get(n);if(!o)continue;const a=await o.getItemsData([...r],{relations:{IsDefinedBy:{attributes:!0,relations:!0},IsTypedBy:{attributes:!0,relations:!1},HasPropertySets:{attributes:!0,relations:!0},DefinesOcurrence:{attributes:!1,relations:!1}}});for(const l of a){const h=this.getItemChecks(e,n,l);if(!h)continue;const c=(await this.getPsets(l)).filter(u=>!("value"in u.Name)||!this.evalRequirement(u.Name.value,this.propertySet,"PropertySet")?!1:(h.push({currentValue:u.Name.value,parameter:"PropertySet",pass:!0,requiredValue:this.propertySet}),!0));if(c.length===0){h.push({currentValue:null,parameter:"PropertySet",pass:!1,requiredValue:this.propertySet});continue}for(const u of c){const p=this.getPropertyListName(u);if(!p)continue;const d=u[p];if(!Array.isArray(d)){h.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName});continue}const _=d.filter(m=>!("value"in m._category&&"value"in m.Name)||this._unsupportedTypes.includes(m._category.value)||!this.evalRequirement(m.Name.value,this.baseName,"BaseName")?!1:(h.push({currentValue:m.Name.value,parameter:"BaseName",pass:!0,requiredValue:this.baseName}),!0));if(_.length===0){h.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName});continue}for(const m of _)this.evalValue(m,h),this.evalDataType(m,h),this.evalURI()}}}}getPropertyListName(t){let e;return"value"in t._category&&(t._category.value==="IFCPROPERTYSET"&&(e="HasProperties"),t._category.value==="IFCELEMENTQUANTITY"&&(e="Quantities")),e}getValueKey(t){return Object.keys(t).find(e=>/Value/.test(e)||/Values/.test(e))}getTypePsets(t){if(!Array.isArray(t.IsTypedBy))return[];const[e]=t.IsTypedBy;return e&&Array.isArray(e.HasPropertySets)?e.HasPropertySets:[]}async getPsets(t){const e=this.getTypePsets(t);if(!Array.isArray(t.IsDefinedBy))return e;const i=[];for(const n of t.IsDefinedBy){if(!("value"in n.Name))continue;const r=n.Name.value,o=this.getPropertyListName(n);if(!(r&&o))continue;const a=e.find(l=>"value"in l.Name?l.Name.value===r:!1);if(a&&Array.isArray(a.HasProperties)&&Array.isArray(n.HasProperties))for(const l of a.HasProperties){if(!("value"in l.Name))continue;const h=l.Name.value;n.HasProperties.find(c=>"value"in c.Name?c.Name.value===h:!1)||n.HasProperties.push(l)}i.push(n)}return i}evalValue(t,e){const i=this.getValueKey(t),n=t[i];if(!("value"in n))return!1;if(this.value){if(!i)return e==null||e.push({parameter:"Value",currentValue:null,pass:!1,requiredValue:this.value}),!1;const r=structuredClone(this.value);return n.type==="IFCLABEL"&&r.type==="simple"&&(r.parameter=String(r.parameter)),this.evalRequirement(n.value,r,"Value",e)}return i&&typeof n.value=="string"&&n.value.trim()===""?(e==null||e.push({parameter:"Value",currentValue:"",pass:!1,requiredValue:this.value}),!1):!0}evalDataType(t,e){if(!this.dataType)return!0;const i=this.getValueKey(t);if(!(i&&"value"in t[i]))return e==null||e.push({parameter:"DataType",currentValue:null,pass:!1,requiredValue:this.dataType}),!1;const n=t[i];return this.evalRequirement(n.type??null,{type:"simple",parameter:this.dataType},"DataType",e)}evalURI(){return!0}}class CM extends kl{constructor(){super(...arguments),k(this,"_ifcMaterialEntities",[/^IFCMATERIALLAYERSETUSAGE$/,/^IFCMATERIALCONSTITUENTSET$/,/^IFCMATERIAL$/,/^IFCMATERIALLIST$/]),k(this,"facetType","Material"),k(this,"value"),k(this,"uri")}serialize(t){if(!(this.value&&this.uri))return"<material />";const e=Hn("Value",this.value);let i="";return t==="requirement"&&(i+=`cardinality="${this.cardinality}"`,i+=this.uri?`uri=${this.uri}`:"",i+=this.instructions?`instructions="${this.instructions}"`:""),`<material ${i}>
  ${e}
</material>`}async getEntities(t,e){const i=this._components.get(Lt);for(const[n,r]of i.list){if(!t.find(h=>h.test(n)))continue;const o=await r.getItemsOfCategories(this._ifcMaterialEntities),a=Object.values(o).flat();if(a.length===0)continue;const l=await r.getItemsData(a,{relations:{AssociatedTo:{attributes:!0,relations:!1},MaterialConstituents:{attributes:!0,relations:!0},ForLayerSet:{attributes:!0,relations:!0},MaterialLayers:{attributes:!0,relations:!0},Materials:{attributes:!0,relations:!1}}});for(const h of l){if(!("value"in h._localId&&"value"in h._category&&Array.isArray(h.AssociatedTo))||!this.hasValidMaterial(h))continue;const c=h.AssociatedTo.map(u=>"value"in u._localId&&u._localId.value?u._localId.value:null).filter(u=>u!==null);vs.append(e,n,...c)}}}async test(t,e){const i=this._components.get(Lt);for(const[n,r]of Object.entries(t)){const o=i.list.get(n);if(!o)continue;const a=await o.getItemsData([[...r][0]],{relations:{AssociatedTo:{attributes:!1,relations:!1},HasAssociations:{attributes:!0,relations:!0},MaterialConstituents:{attributes:!0,relations:!0},ForLayerSet:{attributes:!0,relations:!0},MaterialLayers:{attributes:!0,relations:!0},Materials:{attributes:!0,relations:!1}}});for(const l of a){const h=this.getItemChecks(e,n,l);if(h){if(!Array.isArray(l.HasAssociations)){h.push({parameter:null,currentValue:null,requiredValue:this.value,pass:!1});continue}for(const c of l.HasAssociations)if(this._ifcMaterialEntities.some(u=>"value"in c._category?u.test(c._category.value):!1)&&this.hasValidMaterial(c,h))break}}}}hasValidMaterial(t,e){let i=!1;if("value"in t._category&&t._category.value==="IFCMATERIAL")this.evalValue(t,e)&&(i=!0);else for(const[n,r]of Object.entries(t))if(["ForLayerSet","MaterialLayers","Material","MaterialConstituents","Materials"].includes(n)&&Array.isArray(r)){for(const o of r)if("value"in o._category&&o._category.value==="IFCMATERIAL"){if(this.evalValue(o,e)){i=!0;break}}else if(this.hasValidMaterial(o)){i=!0;break}}return i}evalValue(t,e){if(!this.value)return e==null||e.push({parameter:null,currentValue:t.Name&&"value"in t.Name?t.Name.value:null,pass:!0}),!0;if(!("value"in t._category&&t._category.value==="IFCMATERIAL"))return null;let i=!1;return t.Name&&"value"in t.Name&&(i=this.evalRequirement(t.Name.value,this.value,"Value",e)),i||(t.Category&&"value"in t.Category&&(i=this.evalRequirement(t.Category.value,this.value,"Value",e)),i)}}class IM extends kl{constructor(t,e){super(t),k(this,"facetType","PartOf"),k(this,"_entityFacet"),k(this,"_entity"),k(this,"relation"),k(this,"cardinality","required"),this._entity=e,this._entityFacet=new t_(t,e.name),this._entityFacet.predefinedType=e.predefinedType}set entity(t){this._entity=t;const{name:e,predefinedType:i}=t;this._entityFacet=new t_(this._components,e),this._entityFacet.predefinedType=i}get entity(){return this._entity}serialize(){return""}async getEntities(t,e){}async test(t){}}class xM{constructor(t,e,i){k(this,"name"),k(this,"ifcVersion",new Set),k(this,"identifier",Ss.create()),k(this,"description"),k(this,"instructions"),k(this,"requirementsDescription"),k(this,"applicability",new ge),k(this,"requirements",new ge),k(this,"components"),this.components=t,this.name=e;for(const n of i)this.ifcVersion.add(n)}set(t){const e=t,i=this;for(const n in t){if(n==="identifier")continue;const r=e[n];n in this&&(i[n]=r)}return this.components.get(TM).list.set(this.identifier,this),this}async test(t){const e=new Wt;if(this.requirements.size===0)return e;const i={},n=[];for(const o of this.applicability)n.push(o.getEntities(t,i));await Promise.all(n);const r=[];for(const o of this.requirements)r.push(o.test(i,e));return await Promise.all(r),e}serialize(){const t=`name="${this.name}"`,e=this.identifier?`identifier="${this.identifier}"`:"",i=this.description?`description="${this.description}"`:"",n=this.instructions?`instructions="${this.instructions}"`:"";return`<specification ifcVersion="${[...this.ifcVersion].join(" ")}" ${t} ${e} ${i} ${n}>
      <applicability minOccurs="1" maxOccurs="unbounded">
        ${[...this.applicability].map(r=>r.serialize("applicability")).join(`
`)}
      </applicability>
      <requirements>
        ${[...this.requirements].map(r=>r.serialize("requirement")).join(`
`)}
      </requirements>
    </specification>`}}const Bi=s=>{if(!s)return;const t={};if("simpleValue"in s&&(t.type="simple",t.parameter=s.simpleValue),"restriction"in s){const e=s.restriction,i=Object.keys(e);if("pattern"in e&&(t.type="pattern",t.parameter=e.pattern.value),"enumeration"in e){t.type="enumeration";const n=e.enumeration.map(({value:r})=>r);t.parameter=n}if(i.some(n=>["minInclusive","minExclusive","maxInclusive","maxExclusive"].includes(n))){t.type="bounds";const n={},r=i.find(a=>a.includes("min")),o=i.find(a=>a.includes("max"));r&&(n.minInclusive=r==="minInclusive",n.min=e[r].value),o&&(n.maxInclusive=o==="maxInclusive",n.max=e[o].value),t.parameter=n}if(i.some(n=>["minLength","length","maxLength"].includes(n))){t.type="length";const n={};e.length!==void 0&&(n.length=e.length.value),e.minLength!==void 0&&(n.min=e.minLength.value),e.maxLength!==void 0&&(n.max=e.maxLength.value),t.parameter=n}}if(t.parameter!==void 0)return t},Wy=(s,t)=>{const e=[];for(const i of t){const n=i.name,r=Bi(n);if(!r)continue;const o=new t_(s,r);i.cardinality&&(o.cardinality=i.cardinality),o.predefinedType=Bi(i.predefinedType),o.instructions=i.instructions,e.push(o)}return e},Gy=(s,t)=>{const e=[];for(const i of t){const n=i.name,r=Bi(n);if(!r)continue;const o=new vM(s,r);i.cardinality&&(o.cardinality=i.cardinality),o.value=Bi(i.value),o.instructions=i.instructions,e.push(o)}return e},qy=(s,t)=>{const e=[];for(const i of t){const n=new CM(s);i.cardinality&&(n.cardinality=i.cardinality);const r=Bi(i.value);(r==null?void 0:r.type)==="enumeration"&&Array.isArray(r.parameter)&&(r.parameter=r.parameter.map(String)),n.value=r,n.uri=i.uri,n.instructions=i.instructions,e.push(n)}return e},Zy=(s,t)=>{const e=[];for(const i of t){const n=i.propertySet,r=i.baseName,o=Bi(n),a=Bi(r);if(!(a&&o))continue;const l=new EM(s,o,a);i.cardinality&&(l.cardinality=i.cardinality);const h=Bi(i.value);l.value=h,l.dataType=i.dataType,l.uri=i.uri,l.instructions=i.instructions,e.push(l)}return e},Xy=(s,t)=>{const e=[];for(const i of t){const n=i.system,r=Bi(n);if(!r)continue;const o=new wM(s,r);i.cardinality&&(o.cardinality=i.cardinality);const a=Bi(i.value);(a==null?void 0:a.type)==="simple"&&(a.parameter=String(a.parameter)),(a==null?void 0:a.type)==="enumeration"&&Array.isArray(a.parameter)&&(a.parameter=a.parameter.map(String)),o.value=a,o.uri=i.uri,o.instructions=i.instructions,e.push(o)}return e},Qy=(s,t)=>{const e=[];for(const i of t){const n=Bi(i.entity.name);if(!n)continue;const r=Bi(i.entity.predefinedType),o=new IM(s,{name:n,predefinedType:r});o.relation=i.relation,i.cardinality&&(o.cardinality=i.cardinality),o.instructions=i.instructions,e.push(o)}return e},tb=class e_ extends he{constructor(t){super(t),k(this,"enabled",!0),k(this,"list",new wl),t.add(e_.uuid,this)}getModelIdMap(t){const e={},i={};for(const[n,r]of t){const o=[...r].filter(([,l])=>l.pass).map(([l])=>l);vs.append(e,n,...o);const a=[...r].filter(([,l])=>!l.pass).map(([l])=>l);vs.append(i,n,...a)}return{pass:e,fail:i}}create(t,e,i){const n=new xM(this.components,t,e);return i&&(n.identifier=i),this.list.set(n.identifier,n),n}load(t){const e=[],i=e_.xmlParser.parse(t).ids,{specifications:n}=i;if(n&&n.specification){const r=Array.isArray(n.specification)?n.specification:[n.specification];for(const o of r){const{name:a,ifcVersion:l,description:h,instructions:c,identifier:u}=o;if(!(a&&l))continue;const p=[],d=[],{applicability:_,requirements:m}=o;if(_){const{maxOccurs:b,...y}=_,E=Array.isArray(y)?y:[y];for(const C of E)for(const I in C){const x=Array.isArray(C[I])?C[I]:[C[I]];if(I==="entity"){const A=Wy(this.components,x);p.push(...A)}if(I==="attribute"){const A=Gy(this.components,x);p.push(...A)}if(I==="material"){const A=qy(this.components,x);p.push(...A)}if(I==="classification"){const A=Xy(this.components,x);p.push(...A)}if(I==="property"){const A=Zy(this.components,x);p.push(...A)}if(I==="partOf"){const A=Qy(this.components,x);p.push(...A)}}}let g;if(m){const{maxOccurs:b,...y}=m;g=m.description;const E=Array.isArray(y)?y:[y];for(const C of E)for(const I in C){const x=Array.isArray(C[I])?C[I]:[C[I]];if(I==="entity"){const A=Wy(this.components,x);d.push(...A)}if(I==="attribute"){const A=Gy(this.components,x);d.push(...A)}if(I==="material"){const A=qy(this.components,x);d.push(...A)}if(I==="classification"){const A=Xy(this.components,x);d.push(...A)}if(I==="property"){const A=Zy(this.components,x);d.push(...A)}if(I==="partOf"){const A=Qy(this.components,x);d.push(...A)}}}const f=this.create(a,l.split(/\s+/),u);f.description=h,f.instructions=c,f.requirementsDescription=g,f.applicability.add(...p),f.requirements.add(...d),e.push(f)}}return e}export(t,e=this.list.values()){const i=e??this.list;return`<ids xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://standards.buildingsmart.org/IDS http://standards.buildingsmart.org/IDS/1.0/ids.xsd" xmlns:ids="http://standards.buildingsmart.org/IDS">
  <!-- Made with That Open Engine ${QE.release} (https://github.com/thatopen/engine_components) -->
  <info>
    <title>${t.title}</title>
    ${t.copyright?`<copyright>${t.copyright}</copyright>`:""}
    ${t.version?`<version>${t.version}</version>`:""}
    ${t.description?`<description>${t.description}</description>`:""}
    ${t.author?`<author>${t.author}</author>`:""}
    ${t.date?`<date>${t.date.toISOString().split("T")[0]}</date>`:""}
    ${t.purpose?`<purpose>${t.purpose}</purpose>`:""}
    ${t.milestone?`<milestone>${t.milestone}</milestone>`:""}
  </info>
  <specifications>
    ${[...i].map(n=>n.serialize()).join(`
`)}
  </specifications>
</ids>`}};k(tb,"uuid","9f0b9f78-9b2e-481a-b766-2fbfd01f342c");k(tb,"xmlParser",new Xp.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let TM=tb;const oC=class aC extends he{constructor(t){super(t),k(this,"enabled",!0),t.add(aC.uuid,this)}static distanceFromPointToLine(t,e,i,n=!1){const r=new Gt,o=new F;return r.set(e,i),r.closestPointToPoint(t,n,o),o.distanceTo(t)}round(t){t.x=Math.trunc(t.x*1e3)/1e3,t.y=Math.trunc(t.y*1e3)/1e3,t.z=Math.trunc(t.z*1e3)/1e3}async getVolumeFromFragments(t){return console.warn("getVolumeFromFragments is deprecated. Use getItemsVolume instead."),this.getItemsVolume(t)}async getItemsVolume(t){let e=0;const i=this.components.get(Lt);for(const[n,r]of Object.entries(t)){const o=i.list.get(n);o&&(e+=await o.getItemsVolume([...r]))}return e}static convertUnits(t,e,i,n=2){const r={m:1,cm:.01,mm:.001,km:1e3,m2:1,cm2:1e-4,mm2:1e-6,km2:1e6,m3:1,cm3:1e-6,mm3:1e-9,km3:1e9};if(!r[e]||!r[i])throw new Error("Invalid units provided for conversion.");if(!Number.isInteger(n)||n<0||n>5)throw new Error("Precision must be an integer between 0 and 5.");let o=r[e]/r[i];e.endsWith("2")&&i.endsWith("2")?o**=2:e.endsWith("3")&&i.endsWith("3")&&(o**=3);const a=t*o,l=10**n;return Math.round(a*l)/l}};k(oC,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");let ef=oC;const AM=class lC extends he{constructor(t){super(t),q(this,"enabled",!0),q(this,"inputs",["OBC","BUI"]),q(this,"_requestEventID","thatOpenCompanyComponentRequested"),q(this,"_createEventID","thatOpenCompanyComponentCreated"),t.add(lC.uuid,this)}async import(t){return new Promise(e=>{const i=document.createElement("script"),n=`
        function main() {
          const { ${this.inputs} } = window.ThatOpenCompany;
        
          ${t}
        
          const onComponentRequested = () => {
            window.removeEventListener("${this._requestEventID}", onComponentRequested);
            const event = new CustomEvent("${this._createEventID}", { detail: main });
            window.dispatchEvent(event);
          };
          
          window.addEventListener("${this._requestEventID}", onComponentRequested);
        }
        
        main();
      `,r=o=>{window.removeEventListener(this._createEventID,r);const a=o.detail,l=this.components.get(a);i.remove(),e(l)};i.addEventListener("load",()=>{window.addEventListener(this._createEventID,r),window.dispatchEvent(new Event(this._requestEventID))}),i.src=URL.createObjectURL(new File([n],"temp.js")),document.head.appendChild(i)})}};q(AM,"uuid","74c0c370-1af8-4ca9-900a-4a4196c0f2f5");let hC=class extends yi{constructor(s=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=s,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Bt(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof t.element.ownerDocument.defaultView.Element&&t.element.parentNode!==null&&t.element.remove()})})}copy(s,t){return super.copy(s,t),this.element=s.element.cloneNode(!0),this.center=s.center,this}};const Va=new F,Ky=new vt,Jy=new vt,tv=new F,ev=new F;class SM{constructor(t={}){const e=this;let i,n,r,o;const a={objects:new WeakMap},l=t.element!==void 0?t.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:i,height:n}},this.render=function(_,m){_.matrixWorldAutoUpdate===!0&&_.updateMatrixWorld(),m.parent===null&&m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),Ky.copy(m.matrixWorldInverse),Jy.multiplyMatrices(m.projectionMatrix,Ky),c(_,_,m),d(_)},this.setSize=function(_,m){i=_,n=m,r=i/2,o=n/2,l.style.width=_+"px",l.style.height=m+"px"};function h(_){_.isCSS2DObject&&(_.element.style.display="none");for(let m=0,g=_.children.length;m<g;m++)h(_.children[m])}function c(_,m,g){if(_.visible===!1){h(_);return}if(_.isCSS2DObject){Va.setFromMatrixPosition(_.matrixWorld),Va.applyMatrix4(Jy);const f=Va.z>=-1&&Va.z<=1&&_.layers.test(g.layers)===!0,b=_.element;b.style.display=f===!0?"":"none",f===!0&&(_.onBeforeRender(e,m,g),b.style.transform="translate("+-100*_.center.x+"%,"+-100*_.center.y+"%)translate("+(Va.x*r+r)+"px,"+(-Va.y*o+o)+"px)",b.parentNode!==l&&l.appendChild(b),_.onAfterRender(e,m,g));const y={distanceToCameraSquared:u(g,_)};a.objects.set(_,y)}for(let f=0,b=_.children.length;f<b;f++)c(_.children[f],m,g)}function u(_,m){return tv.setFromMatrixPosition(_.matrixWorld),ev.setFromMatrixPosition(m.matrixWorld),tv.distanceToSquared(ev)}function p(_){const m=[];return _.traverseVisible(function(g){g.isCSS2DObject&&m.push(g)}),m}function d(_){const m=p(_).sort(function(f,b){if(f.renderOrder!==b.renderOrder)return b.renderOrder-f.renderOrder;const y=a.objects.get(f).distanceToCameraSquared,E=a.objects.get(b).distanceToCameraSquared;return y-E}),g=m.length;for(let f=0,b=m.length;f<b;f++)m[f].element.style.zIndex=g-f}}}let Yo=class{constructor(s,t,e){q(this,"three"),q(this,"world"),q(this,"onDisposed",new ft),this.world=s;let i;if(t)i=t;else{i=document.createElement("div");const n="6px";i.style.color="white",i.style.height=n,i.style.width=n,i.style.borderRadius="50%",i.style.border="2px solid rgb(122, 75, 209)",i.style.zIndex="-20"}this.three=new hC(i),(e||s.scene.three).add(this.three),this.visible=!0}set visible(s){this.three.visible=s}get visible(){return this.three.visible}toggleVisibility(){this.visible=!this.visible}notDisplay(){this.visible=!1}dispose(){this.three.removeFromParent(),this.three.element.remove(),this.onDisposed.trigger(),this.onDisposed.reset()}};class OM extends V5{constructor(t,e,i){super(t,e,i),q(this,"three2D",new SM),this.onAfterUpdate.add(()=>{if(this.onBeforeUpdate.trigger(this),!this.enabled||!this.currentWorld)return;const n=this.currentWorld.scene.three,r=this.currentWorld.camera.three;n instanceof _w&&this.three2D.render(n,r)}),this.onDisposed.add(()=>{this.three2D.domElement.remove()}),this.onResize.add(({x:n,y:r})=>{this.three2D.setSize(n,r)}),this.setupHtmlRenderer(),this.resize()}setupHtmlRenderer(){this.three2D.domElement.style.position="absolute",this.three2D.domElement.style.top="0px",this.three2D.domElement.style.pointerEvents="none",this.container&&(this.container.appendChild(this.three2D.domElement),this.container.style.position="relative")}}const PM=class cC extends he{constructor(t){super(t),q(this,"onDisposed",new ft),q(this,"enabled",!0),q(this,"threshold",50),q(this,"autoCluster",!0),q(this,"list",new Map),q(this,"clusterLabels",new Set),q(this,"currentKeys",new Set),q(this,"_color","white"),q(this,"_markerKey",0),q(this,"_clusterKey",0),q(this,"_worldEvents",new Map),q(this,"_setupWorlds",new Set),t.add(cC.uuid,this)}get color(){return this._color}set color(t){this._color=t;for(const[e,i]of this.list)for(const[n,r]of i)r.label.three.element.style.color=t}create(t,e,i,n=!1){this.setupEvents(t,!0);const r=this._markerKey.toString(),o=this.getWorldMarkerList(t);if(o.has(r))return null;const a=document.createElement("span");a.append(e);const l=new Yo(t,a);return l.three.position.copy(i),o.set(r,{key:r,label:l,merged:!1,static:n}),this._markerKey++,r}delete(t){for(const[e,i]of this.list){const n=i.get(t);n&&n.label.dispose(),i.delete(t)}}getWorldMarkerList(t){return this.list.has(t.uuid)||this.list.set(t.uuid,new Map),this.list.get(t.uuid)}dispose(t){for(const[e,i]of this.list){const n=[...i.keys()];for(const r of n){const o=i.get(r);t&&o.type!==t||(o.label.dispose(),i.delete(r))}}if(!t){this.list.clear(),this._markerKey=0;for(const e of this.clusterLabels)e.label.dispose();this.clusterLabels.clear(),this._clusterKey=0,this.currentKeys.clear()}this.onDisposed.trigger()}setupEvents(t,e){if(e&&this._setupWorlds.has(t.uuid)||!t.camera.hasCameraControls())return;const i=this.getWorldEvent(t);t.camera.controls.removeEventListener("sleep",i),t.camera.controls.removeEventListener("rest",i),e&&(t.camera.controls.addEventListener("sleep",i),t.camera.controls.addEventListener("rest",i))}cluster(t){if(!this.autoCluster)return;this.resetMarkers();const e=this.list.get(t.uuid);if(e){for(const[i,n]of e)if(!n.merged&&!n.static){this.currentKeys.clear();for(const[r,o]of e)o.static||n.key!==o.key&&!o.merged&&this.distance(n.label,o.label)<this.threshold&&(this.currentKeys.add(o.key),o.merged=!0);if(this.currentKeys.size>0){this.currentKeys.add(n.key),n.merged=!0;const r=Array.from(this.currentKeys),o=this.getAveragePositionFromLabels(r),a=new Yo(n.label.world,this.createClusterElement(this._clusterKey.toString())),{element:l}=a.three;l.textContent=r.length.toString(),a.three.position.copy(o),this.clusterLabels.add({key:this._clusterKey.toString(),markerKeys:r,label:a}),this._clusterKey++}}this.removeMergeMarkers(t)}}getWorldEvent(t){if(!this._worldEvents.has(t.uuid)){const e=()=>{this.cluster(t)};this._worldEvents.set(t.uuid,e)}return this._worldEvents.get(t.uuid)}resetMarkers(){for(const[t,e]of this.list)for(const[i,n]of e)n.merged=!1;for(const t of this.clusterLabels)t.label.dispose();this.clusterLabels.clear(),this._clusterKey=0}removeMergeMarkers(t){const e=this.list.get(t.uuid);if(e){for(const[i,n]of e)n.merged?n.label.dispose():n.label.world.scene.three.add(n.label.three);for(const i of this.clusterLabels)if(i.markerKeys.length===1){for(const[n,r]of this.list){const o=r.get(i.markerKeys[0]);o&&(o.label.world.scene.three.add(o.label.three),o.merged=!1)}i.label.dispose(),this.clusterLabels.delete(i)}}}getAveragePositionFromLabels(t){const e=t.map(i=>{for(const[n,r]of this.list){const o=r.get(i);if(o)return o.label.three.position}return new F});return e.reduce((i,n)=>i.add(n),new F).divideScalar(e.length)}createClusterElement(t){const e=document.createElement("div");return e.textContent=t,e.style.color="#000000",e.style.background="#FFFFFF",e.style.fontSize="1.2rem",e.style.fontWeight="500",e.style.pointerEvents="auto",e.style.borderRadius="50%",e.style.padding="5px 11px",e.style.textAlign="center",e.style.cursor="pointer",e.addEventListener("pointerdown",()=>{this.navigateToCluster(t)}),e.addEventListener("pointerover",()=>{e.style.background="#BCF124"}),e.addEventListener("pointerout",()=>{e.style.background="#FFFFFF"}),e}getScreenPosition(t){const e=new F;if(!t.world.renderer)throw new Error("Renderer not found!");const i=t.three.position.clone();i.project(t.world.camera.three);const n=t.world.renderer.getSize();return e.x=i.x*n.x/2+n.x/2,e.y=-(i.y*n.y/2)+n.y/2,e}distance(t,e){const i=this.getScreenPosition(t),n=this.getScreenPosition(e),r=i.x-n.x,o=i.y-n.y,a=Math.sqrt(r*r+o*o)*.5;return a===0?this.threshold+1:a}navigateToCluster(t){const e=[],i=Array.from(this.clusterLabels).find(h=>h.key===t);if(!i)return;const n=i.label.world.camera;if(!n.hasCameraControls()){console.warn("Zoom to clusters only supported with Camera Controls!");return}for(const h of i.markerKeys)for(const[c,u]of this.list){const p=u.get(h);if(p){const{x:d,y:_,z:m}=p.label.three.position;e.push(d,_,m)}}i.label.dispose(),this.clusterLabels.delete(i);const r=new ye,o=new Float32Array(e),a=new Ve(o,3);r.setAttribute("position",a);const l=new lt(r);l.geometry.computeBoundingSphere(),l.geometry.boundingSphere&&n.controls.fitToSphere(l,!0),r.dispose(),l.clear(),e.length=0}};q(PM,"uuid","4079eb91-79b0-4ede-bcf2-15b837129236");new aa(-1,1,1,-1,0,1);class FM extends ye{constructor(){super(),this.setAttribute("position",new Us([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Us([0,2,0,0,2,0],2))}}new FM;new Bt,new vt,new vt,new vt,new F(-1,-1,-1),new F(1,1,1);RM(16,2,1),new Bt,new vt;function RM(s,t,e){const i=LM(s,t,e);let n="vec3[SAMPLES](";for(let r=0;r<s;r++){const o=i[r];n+=`vec3(${o.x}, ${o.y}, ${o.z})${r<s-1?",":")"}`}return n}function LM(s,t,e){const i=[];for(let n=0;n<s;n++){const r=2*Math.PI*t*n/s,o=Math.pow(n/(s-1),e);i.push(new F(Math.cos(r),Math.sin(r),o))}return i}new Bt(1/1024,1/512);new Bt(1/1024,1/512);new Bt(1/1024,1/512);const sv=new Tt,yd=new F;let eb=class extends C_{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const s=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],e=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(e),this.setAttribute("position",new Us(s,3)),this.setAttribute("uv",new Us(t,2))}applyMatrix4(s){const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(s),e.applyMatrix4(s),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(s){let t;s instanceof Float32Array?t=s:Array.isArray(s)&&(t=new Float32Array(s));const e=new Xo(t,6,1);return this.setAttribute("instanceStart",new Js(e,3,0)),this.setAttribute("instanceEnd",new Js(e,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(s){let t;s instanceof Float32Array?t=s:Array.isArray(s)&&(t=new Float32Array(s));const e=new Xo(t,6,1);return this.setAttribute("instanceColorStart",new Js(e,3,0)),this.setAttribute("instanceColorEnd",new Js(e,3,3)),this}fromWireframeGeometry(s){return this.setPositions(s.attributes.position.array),this}fromEdgesGeometry(s){return this.setPositions(s.attributes.position.array),this}fromMesh(s){return this.fromWireframeGeometry(new gw(s.geometry)),this}fromLineSegments(s){const t=s.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Tt);const s=this.attributes.instanceStart,t=this.attributes.instanceEnd;s!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(s),sv.setFromBufferAttribute(t),this.boundingBox.union(sv))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ws),this.boundingBox===null&&this.computeBoundingBox();const s=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(s!==void 0&&t!==void 0){const e=this.boundingSphere.center;this.boundingBox.getCenter(e);let i=0;for(let n=0,r=s.count;n<r;n++)yd.fromBufferAttribute(s,n),i=Math.max(i,e.distanceToSquared(yd)),yd.fromBufferAttribute(t,n),i=Math.max(i,e.distanceToSquared(yd));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}};nr.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Bt(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};Gr.line={uniforms:Bc.merge([nr.common,nr.fog,nr.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};let sb=class extends $c{constructor(s){super({type:"LineMaterial",uniforms:Bc.clone(Gr.line.uniforms),vertexShader:Gr.line.vertexShader,fragmentShader:Gr.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(s)}get color(){return this.uniforms.diffuse.value}set color(s){this.uniforms.diffuse.value=s}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(s){s===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(s){this.uniforms.linewidth&&(this.uniforms.linewidth.value=s)}get dashed(){return"USE_DASH"in this.defines}set dashed(s){s===!0!==this.dashed&&(this.needsUpdate=!0),s===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(s){this.uniforms.dashScale.value=s}get dashSize(){return this.uniforms.dashSize.value}set dashSize(s){this.uniforms.dashSize.value=s}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(s){this.uniforms.dashOffset.value=s}get gapSize(){return this.uniforms.gapSize.value}set gapSize(s){this.uniforms.gapSize.value=s}get opacity(){return this.uniforms.opacity.value}set opacity(s){this.uniforms&&(this.uniforms.opacity.value=s)}get resolution(){return this.uniforms.resolution.value}set resolution(s){this.uniforms.resolution.value.copy(s)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(s){this.defines&&(s===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),s===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}};const Rm=new $i,iv=new F,nv=new F,ds=new $i,ps=new $i,In=new $i,Lm=new F,Nm=new vt,gs=new Gt,rv=new F,vd=new Tt,wd=new ws,xn=new $i;let Bn,Wo;function ov(s,t,e){return xn.set(0,0,-t,1).applyMatrix4(s.projectionMatrix),xn.multiplyScalar(1/xn.w),xn.x=Wo/e.width,xn.y=Wo/e.height,xn.applyMatrix4(s.projectionMatrixInverse),xn.multiplyScalar(1/xn.w),Math.abs(Math.max(xn.x,xn.y))}function NM(s,t){const e=s.matrixWorld,i=s.geometry,n=i.attributes.instanceStart,r=i.attributes.instanceEnd,o=Math.min(i.instanceCount,n.count);for(let a=0,l=o;a<l;a++){gs.start.fromBufferAttribute(n,a),gs.end.fromBufferAttribute(r,a),gs.applyMatrix4(e);const h=new F,c=new F;Bn.distanceSqToSegment(gs.start,gs.end,c,h),c.distanceTo(h)<Wo*.5&&t.push({point:c,pointOnLine:h,distance:Bn.origin.distanceTo(c),object:s,face:null,faceIndex:a,uv:null,uv1:null})}}function MM(s,t,e){const i=t.projectionMatrix,n=s.material.resolution,r=s.matrixWorld,o=s.geometry,a=o.attributes.instanceStart,l=o.attributes.instanceEnd,h=Math.min(o.instanceCount,a.count),c=-t.near;Bn.at(1,In),In.w=1,In.applyMatrix4(t.matrixWorldInverse),In.applyMatrix4(i),In.multiplyScalar(1/In.w),In.x*=n.x/2,In.y*=n.y/2,In.z=0,Lm.copy(In),Nm.multiplyMatrices(t.matrixWorldInverse,r);for(let u=0,p=h;u<p;u++){if(ds.fromBufferAttribute(a,u),ps.fromBufferAttribute(l,u),ds.w=1,ps.w=1,ds.applyMatrix4(Nm),ps.applyMatrix4(Nm),ds.z>c&&ps.z>c)continue;if(ds.z>c){const f=ds.z-ps.z,b=(ds.z-c)/f;ds.lerp(ps,b)}else if(ps.z>c){const f=ps.z-ds.z,b=(ps.z-c)/f;ps.lerp(ds,b)}ds.applyMatrix4(i),ps.applyMatrix4(i),ds.multiplyScalar(1/ds.w),ps.multiplyScalar(1/ps.w),ds.x*=n.x/2,ds.y*=n.y/2,ps.x*=n.x/2,ps.y*=n.y/2,gs.start.copy(ds),gs.start.z=0,gs.end.copy(ps),gs.end.z=0;const d=gs.closestPointToPointParameter(Lm,!0);gs.at(d,rv);const _=Vc.lerp(ds.z,ps.z,d),m=_>=-1&&_<=1,g=Lm.distanceTo(rv)<Wo*.5;if(m&&g){gs.start.fromBufferAttribute(a,u),gs.end.fromBufferAttribute(l,u),gs.start.applyMatrix4(r),gs.end.applyMatrix4(r);const f=new F,b=new F;Bn.distanceSqToSegment(gs.start,gs.end,b,f),e.push({point:b,pointOnLine:f,distance:Bn.origin.distanceTo(b),object:s,face:null,faceIndex:u,uv:null,uv1:null})}}}let uC=class extends lt{constructor(s=new eb,t=new sb({color:Math.random()*16777215})){super(s,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const s=this.geometry,t=s.attributes.instanceStart,e=s.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let r=0,o=0,a=t.count;r<a;r++,o+=2)iv.fromBufferAttribute(t,r),nv.fromBufferAttribute(e,r),i[o]=o===0?0:i[o-1],i[o+1]=i[o]+iv.distanceTo(nv);const n=new Xo(i,2,1);return s.setAttribute("instanceDistanceStart",new Js(n,1,0)),s.setAttribute("instanceDistanceEnd",new Js(n,1,1)),this}raycast(s,t){const e=this.material.worldUnits,i=s.camera;i===null&&!e&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const n=s.params.Line2!==void 0&&s.params.Line2.threshold||0;Bn=s.ray;const r=this.matrixWorld,o=this.geometry,a=this.material;Wo=a.linewidth+n,o.boundingSphere===null&&o.computeBoundingSphere(),wd.copy(o.boundingSphere).applyMatrix4(r);let l;if(e)l=Wo*.5;else{const c=Math.max(i.near,wd.distanceToPoint(Bn.origin));l=ov(i,c,a.resolution)}if(wd.radius+=l,Bn.intersectsSphere(wd)===!1)return;o.boundingBox===null&&o.computeBoundingBox(),vd.copy(o.boundingBox).applyMatrix4(r);let h;if(e)h=Wo*.5;else{const c=Math.max(i.near,vd.distanceToPoint(Bn.origin));h=ov(i,c,a.resolution)}vd.expandByScalar(h),Bn.intersectsBox(vd)!==!1&&(e?NM(this,t):MM(this,i,t))}onBeforeRender(s){const t=this.material.uniforms;t&&t.resolution&&(s.getViewport(Rm),this.material.uniforms.resolution.value.set(Rm.z,Rm.w))}};class DM{constructor(t,e){q(this,"_components"),q(this,"_modelStyleGeometries",new Wt),q(this,"onDisposed",new ft),q(this,"three",new on),q(this,"plane"),q(this,"items",new Wt),q(this,"world",null),q(this,"_visible",!1),this._components=t,this.plane=e,this.setupEvents()}set visible(t){t?this.world&&(this.world.scene.three.add(this.three),this._visible=!0):(this.three.removeFromParent(),this._visible=!1)}get visible(){return this._visible}setupEvents(){const t=this._components.get(Mm);this.items.guard=(e,{style:i})=>!!t.styles.get(i),this.items.onItemSet.add(({value:e})=>{const{style:i,data:n}=e;this.create(i,n)})}getStyleMeshes(t,e){const i=this._components.get(Mm).styles.get(e);if(!i)throw new Error(`ClipStyler: "${e}" style not found.`);const n=this._components.get(Lt).list.get(t);if(!n)throw new Error(`ClipEdges: model with id "${t}" not found.`);const{linesMaterial:r,fillsMaterial:o}=i;let a=this._modelStyleGeometries.get(t);a||(a=new Wt,this._modelStyleGeometries.set(t,a));let l=a.get(e);if(!l){let h;r&&(h=new uC(new eb,r),h.frustumCulled=!1,n&&h.applyMatrix4(n.object.matrixWorld),this.three.add(h));let c;o&&(c=new lt(new ye,o),n&&c.applyMatrix4(n.object.matrixWorld),this.three.add(c)),l={edges:h,fills:c},a.set(e,l)}return l}async updateMeshes(t,e,i){const n=this._components.get(Lt).list.get(t);if(!n)return;const r=this._components.get(dr),o=this.plane.clone();o.constant-=.01;const a=await n.getSection(o,i),{buffer:l,index:h,fillsIndices:c}=a,u=this.getStyleMeshes(t,e),{edges:p,fills:d}=u,_=new Ve(l,3,!1);if(p){_.setUsage(Hx);const m=new ye;m.setAttribute("position",_),m.setDrawRange(0,h);const g=new Lp(m);p.geometry.fromLineSegments(g),r.destroy(g)}d&&(d.geometry.attributes.position=_,d.geometry.setIndex(c))}async create(t,e){if(!this._components.get(Mm).styles.get(t))throw new Error(`ClipEdges: "${t}" style not found.`);const i=this._components.get(z5);let n=null;e&&(n=await i.find(e));const r=this._components.get(Lt);if(n)for(const[o,a]of Object.entries(n))r.list.get(o)&&this.updateMeshes(o,t,[...a]);else for(const[o]of r.list)this.updateMeshes(o,t)}async update(t){for(const[e,{data:i,style:n}]of this.items)t&&!t.includes(e)||this.create(n,i)}dispose(){this._components.get(dr).destroy(this.three,!0,!0),this._modelStyleGeometries.clear()}}const dC=class s_ extends he{constructor(t){super(t),q(this,"onDisposed",new ft),q(this,"enabled",!0),q(this,"world",null),q(this,"styles",new Wt),q(this,"list",new Wt),q(this,"_visible",!0),this.components.list.set(s_.uuid,this),this.setEvents()}get visible(){return this._visible}set visible(t){this._visible=t;for(const[,e]of this.list)e.visible=t}setEvents(){this.list.onBeforeDelete.add(({value:t})=>t.dispose())}setEdgesConfig(t,e){if(t.world=(e==null?void 0:e.world)??this.world,e!=null&&e.items)for(const[n,r]of Object.entries(e.items))t.items.set(n,r);const i=(e==null?void 0:e.id)??Ss.create();this.list.set(i,t)}create(t,e){const i=new DM(this.components,t);return e&&this.setEdgesConfig(i,e),i}createFromView(t,e){const i=this.create(t.plane,e);return((e==null?void 0:e.link)===void 0||e.link)&&(t.onDisposed.add(()=>i.dispose()),t.onUpdated.add(()=>i.update()),t.onStateChanged.add(()=>i.visible=t.open)),i}createFromClipping(t,e){const i=this.components.get(Ur).list.get(t);if(!i)throw new Error(`ClipStyler: Clipping plane with ID ${t} not found.`);const n=this.create(i.three,e);return n.visible=!0,((e==null?void 0:e.link)===void 0||e.link)&&(i.onDraggingEnded.add(()=>n.update()),i.onDisposed.add(()=>n.dispose())),n}dispose(){this.styles.clear(),this.list.clear(),this.onDisposed.trigger(s_.uuid)}};q(dC,"uuid","24dfc306-a3c4-410f-8071-babc4afa5e4d");let Mm=dC;const pC=class i_ extends he{constructor(t){super(t),q(this,"onDisposed",new ft),q(this,"onBeforeUpdate",new ft),q(this,"onAfterUpdate",new ft),q(this,"onSetup",new ft),q(this,"isSetup",!1),q(this,"enabled",!0),q(this,"events",{}),q(this,"multiple","ctrlKey"),q(this,"zoomFactor",1.5),q(this,"zoomToSelection",!1),q(this,"backupColor",null),q(this,"selection",{}),q(this,"config",{selectName:"select",selectionColor:null,autoHighlightOnClick:!0,world:null,selectEnabled:!0,selectMaterialDefinition:{color:new xt("#BCF124"),renderedFaces:jc.ONE,opacity:1,transparent:!1}}),q(this,"styles",new Wt),q(this,"autoToggle",new Set),q(this,"mouseDownPosition",{x:0,y:0}),q(this,"mouseMoveThreshold",5),q(this,"selectable",{}),q(this,"eventManager",new R5),q(this,"_mouseState",{down:!1,moved:!1}),q(this,"_fromHighlight",!1),q(this,"restorePreviousColors",(e=this.selection.select)=>{for(const[i,n]of Object.entries(this.selection))if(!(i===this.config.selectName||!this.styles.get(i)))for(const[r,o]of Object.entries(e)){const a=n[r];if(!a)continue;const l=[...o].filter(h=>a.has(h));l.length!==0&&new Set(l)}}),q(this,"onMouseDown",e=>{this.enabled&&(this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.mouseDownPosition={x:e.clientX,y:e.clientY},this._mouseState.down=!0)}),q(this,"debounceTimeout",null),q(this,"onMouseUp",async e=>{if(!this.enabled)return;const{world:i,autoHighlightOnClick:n,selectEnabled:r}=this.config;if(!i)throw new Error("No world found!");if(!i.renderer)throw new Error("This world doesn't have a renderer!");if(e.target===i.renderer.three.domElement){if(this._mouseState.down=!1,this._mouseState.moved||e.button!==0){this._mouseState.moved=!1;return}if(this._mouseState.moved=!1,n&&r){const o=this.multiple==="none"?!0:!e[this.multiple];await this.highlight(this.config.selectName,o,this.zoomToSelection)}}}),q(this,"onMouseMove",async e=>{if(!this.enabled)return;const i=e.clientX-this.mouseDownPosition.x,n=e.clientY-this.mouseDownPosition.y,r=Math.sqrt(i*i+n*n);this._mouseState.moved||r>this.mouseMoveThreshold&&(this._mouseState.moved=this._mouseState.down)}),this.components.add(i_.uuid,this),this.eventManager.list.add(this.onSetup),this.eventManager.list.add(this.onDisposed),this.setStyleEvents()}setStyleEvents(){this.styles.onBeforeDelete.add(async({key:t})=>{if(await this.clear(t),delete this.selection[t],!(t in this.events))return;const{onClear:e,onHighlight:i,onBeforeHighlight:n}=this.events[t];this.eventManager.list.delete(e),this.eventManager.list.delete(i),this.eventManager.list.delete(n),delete this.events[t]}),this.styles.onItemSet.add(({key:t})=>{this.selection[t]={};const e=new ft,i=new ft,n=new ft;this.events[t]={onHighlight:e,onClear:n,onBeforeHighlight:i},this.eventManager.add([n,e,i])})}async dispose(){this.setupEvents(!1),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.selection={},this.styles.clear(),this.onDisposed.trigger(i_.uuid),this.eventManager.reset(),this.isSetup=!1}add(t){if(console.warn("highlighter.add() is deprecated, use highlighter.styles.set() instead"),typeof t=="string")this.styles.set(t,null);else{const{customId:e}=t;this.styles.set(e,t)}}async remove(t){console.warn("highlighter.remove() is deprecated, use highlighter.styles.delete() instead"),this.styles.delete(t)}async highlight(t,e=!0,i=this.zoomToSelection,n=null){if(!this.enabled)return;if(!this.config.world)throw new Error("No world found in config!");const r=this.config.world;if(!this.selection[t])throw new Error(`Selection ${t} does not exist.`);const o=await this.components.get(hn).get(r).castRay();if(!o||o.localId===void 0||o.localId===null){e&&this.clear(t);return}const{localId:a,fragments:{modelId:l}}=o,h={[l]:new Set([a])};await this.highlightByID(t,h,e,i,n,!0)}async highlightByID(t,e,i=!0,n=this.zoomToSelection,r=null,o=!1){var a;if(!this.enabled)return;this._fromHighlight=!0,this.events[t].onBeforeHighlight.trigger(this.selection[t]),i&&await this.clear(t);let l={};if(Object.keys(this.selectable).length!==0||r!==null)for(const h in e){const c=new Set(e[h]),u=(a=this.selectable)==null?void 0:a[t],p=u?u[h]:void 0,d=p?new Set(p):void 0,_=r==null?void 0:r[h],m=_?new Set(_):void 0;if(m||d)for(const g of c){if(m&&m.has(g)||d&&!d.has(g))continue;let f=l[h];f||(f=new Set,l[h]=f),f.add(g)}}else l=e;if(o&&this.autoToggle.has(t)){const h={};let c=!1;for(const u in l){const p=this.selection[t][u];if(!p)continue;const d=l[u];for(const _ of d)if(p.has(_)){p.delete(_);let m=h[u];m||(m=new Set,h[u]=m),m.add(_),c=!0}else p.add(_);l[u]=p}c&&(this.events[t].onClear.trigger(h),t===this.config.selectName&&this.restorePreviousColors(h))}this.updateStyleMap(t,l),this.events[t].onHighlight.trigger(this.selection[t]),this._fromHighlight=!1,await this.updateColors(),n&&await this.zoomSelection(l)}async updateColors(){const t=this.components.get(Lt),e=[t.resetHighlight()];for(const[i,n]of Object.entries(this.selection)){const r=this.styles.get(i);if(!r)continue;const o=i==="select"||!this.styles.get(this.config.selectName)?n:this.getMapWithoutSelection(i);o&&e.push(t.highlight({...r,customId:i},o))}e.push(t.core.update(!0)),await Promise.allSettled(e)}updateStyleMap(t,e){const i=this.selection[t];for(const n in e){let r=i[n];r||(r=new Set,i[n]=r);const o=e[n];for(const a of o)r.add(a)}if(t!==this.config.selectName)for(const[n,r]of Object.entries(this.selection)){if(n===this.config.selectName||n===t)continue;const o=r;for(const[a,l]of Object.entries(i)){const h=o[a];if(h)for(const c of l)h.delete(c)}}}getMapWithoutSelection(t,e){const i=this.selection[t];if(!i)throw new Error(`Style ${t} does not exist.`);const n=this.selection[this.config.selectName]??{},r={};for(const o in i){const a=i[o],l=t===this.config.selectName?new Set:n[o]??new Set,h=Array.from(a).filter(c=>{var u;return!l.has(c)&&(!e||((u=e[o])==null?void 0:u.has(c)))});h.length>0&&(r[o]=new Set(h))}return Object.keys(r).length>0?r:null}async clear(t,e){const i=t?[t]:Object.keys(this.selection),n=e??void 0;for(const r of i){const o=this.selection[r]??{},a=n??o;r===this.config.selectName&&this.restorePreviousColors();const l={};for(const[h,c]of Object.entries(a)){const u=o[h];if(u)for(const p of c){if(!u.delete(p))continue;let d=l[h];d||(d=new Set,l[h]=d),d.add(p)}}Object.keys(l).length>0&&this.events[r].onClear.trigger(l)}this._fromHighlight||await this.updateColors()}setup(t){if(this.isSetup)return;this.config={...this.config,...t};const{selectName:e,selectionColor:i,selectMaterialDefinition:n}=this.config;n?(i&&(console.warn("highlighter.config.selectionColor is deprecated, use selectMaterialDefinition instead"),n.color=i),this.styles.set(e,n)):this.styles.set(e,null),this.autoToggle.add(this.config.selectName),this.setupEvents(!0),this.enabled=!0,this.isSetup=!0,this.onSetup.trigger(this)}async zoomSelection(t){if(!this.config.world)throw new Error("No world found in config!");const e=this.config.world;let i=!1;for(const m in t)if(t[m].size>0){i=!0;break}if(!i||!e.camera.hasCameraControls())return;const n=await this.components.get(Lt).getBBoxes(t),r=new ws,o=new Tt;for(const m of n)o.union(m);o.getBoundingSphere(r);const a=1/0,l=-1/0,{x:h,y:c,z:u}=r.center,p=r.radius===a||h===a||c===a||u===a,d=r.radius===l||h===l||c===l||u===l,_=r.radius===0;p||d||_||(r.radius*=this.zoomFactor,await e.camera.controls.fitToSphere(r,!0))}setupEvents(t){if(!this.config.world){console.log("No world found while setting up events!");return}if(this.config.world.isDisposing)return;if(!this.config.world.renderer)throw new Error("The given world doesn't have a renderer!");const e=this.config.world.renderer.three.domElement;e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("mouseup",this.onMouseUp),e.removeEventListener("pointermove",this.onMouseMove),t&&(e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("mouseup",this.onMouseUp),e.addEventListener("pointermove",this.onMouseMove))}};q(pC,"uuid","cb8a76f2-654a-4b50-80c6-66fd83cafd77");let uc=pC;const fC=class mC extends he{constructor(){super(...arguments),q(this,"enabled",!0),q(this,"geometries",new Wt),q(this,"onDisposed",new ft)}async get(t,e){const{material:i,coordinate:n,applyTransformation:r}={coordinate:!0,applyTransformation:!0,...e},o=this.components.get(Lt),a=new Wt;for(const[l,h]of Object.entries(t)){const c=o.list.get(l);if(!c)continue;const u=this.getModelMeshes(l);for(const p of h){let d=a.get(l);d||(d=new Wt,a.set(l,d));let _=u.get(p);if(_&&_.length>0){const f=[];for(const[b,{geometry:y,transform:E}]of _.entries()){const C=await this.createMesh(c,y,E,{material:i,applyTransformation:r,coordinate:n});f.push(C)}d.set(p,f);continue}else _=[],u.set(p,_);const[m]=await c.getItemsGeometry([p]);if(!m)continue;const g=[];for(const f of m){const b=this.createGeometry(f);if(!b)continue;const{geometry:y,transform:E}=b;_.push(b);const C=await this.createMesh(c,y,E,{material:i,applyTransformation:r,coordinate:n});g.push(C)}d.set(p,g)}}return a}getModelMeshes(t){let e=this.geometries.get(t);return e||(e=new Wt,this.geometries.set(t,e)),e}remove(t=[...this.geometries.keys()]){for(const e of t){const i=this.geometries.get(e);if(i){for(const[n,r]of i)for(const{geometry:o}of r)o.dispose();this.geometries.delete(e)}}}dispose(t=!0){this.remove(),t&&this.geometries.dispose(),this.onDisposed.trigger(mC.uuid)}getMeshesFromResult(t){const e=[];for(const i of t.values())for(const n of i.values())e.push(...n);return e}createGeometry(t){const{positions:e,indices:i,normals:n,transform:r}=t;if(!(e&&i&&n))return null;const o=new ye;return o.setAttribute("position",new Ve(e,3)),o.setAttribute("normal",new Ve(n,3,!0)),o.setIndex(new Ve(i,1)),{geometry:o,transform:r}}async createMesh(t,e,i,n){const{material:r,applyTransformation:o,coordinate:a}={applyTransformation:!0,coordinate:!0,...n},l=this.components.get(Lt),h=new lt(e,r);if(h.applyMatrix4(i),o||h.position.set(0,0,0),a&&l.baseCoordinationModel!==t.modelId){const c=await t.getCoordinationMatrix();l.applyBaseCoordinateSystem(h,c)}return h}};q(fC,"uuid","ab45d0a7-feea-4afc-927c-80832dae76dd");let kM=fC;const zM=class n_ extends he{constructor(t){super(t),q(this,"_world"),q(this,"styles",new ge),q(this,"outlinePositions",!1),q(this,"_mesh",null),q(this,"onDisposed",new ft),q(this,"_meshes",[]),q(this,"_map",{}),q(this,"_activeStyles",new Set),q(this,"_styleCallbacks",{}),t.add(n_.uuid,this),this.setupEvents()}set world(t){this._world=t,t&&this.getRenderer().postproduction.excludedObjectsPass.addExcludedMaterial(this._points.material)}get world(){return this._world}get _points(){return this._mesh||(this._mesh=new fw(new ye,new Wm({size:10,sizeAttenuation:!1,depthTest:!1}))),this._mesh}get enabled(){return!this.world||this.world.isDisposing?!1:this.getRenderer().postproduction.outlinesEnabled}set enabled(t){if(!this.world||this.world.isDisposing)return;const e=this.getRenderer();e.postproduction.outlinesEnabled=t,this.outlinePositions&&(this._points.material.color=this.color,this.world.scene.three.add(this._points))}get color(){return this.getRenderer().postproduction.outlinePass.outlineColor}set color(t){this.getRenderer().postproduction.outlinePass.outlineColor.copy(t),this._points.material.color.copy(t)}get thickness(){return this.getRenderer().postproduction.outlinePass.thickness}set thickness(t){this.getRenderer().postproduction.outlinePass.thickness=t}get fillColor(){return this.getRenderer().postproduction.outlinePass.fillColor}set fillColor(t){this.getRenderer().postproduction.outlinePass.fillColor.copy(t)}get fillOpacity(){return this.getRenderer().postproduction.outlinePass.fillOpacity}set fillOpacity(t){const e=this.getRenderer().postproduction;e.outlinePass.fillOpacity=t}setupEvents(){const t=this.components.get(uc);this.styles.guard=e=>t.styles.has(e),this.styles.onItemAdded.add(e=>{const i=this.components.get(uc),n=()=>{this._activeStyles.add(e),this.updateFromStyles()},r=()=>{this._activeStyles.delete(e),this.updateFromStyles()};this._styleCallbacks[e]={onHighlight:n,onClear:r},i.events[e].onHighlight.add(n),i.events[e].onClear.add(r)}),this.styles.onBeforeDelete.add(e=>{const{onHighlight:i,onClear:n}=this._styleCallbacks[e];t.events[e].onHighlight.remove(i),t.events[e].onClear.remove(n),this._activeStyles.delete(e),delete this._styleCallbacks[e]}),t.styles.onItemDeleted.add(e=>this.styles.delete(e))}async updateFromStyles(){const t=this.components.get(uc),e=[];for(const n of this._activeStyles){const r=t.selection[n];r&&e.push(r)}const i=vs.join(e);this._map=i,await this.update()}async update(t=this._map){if(t===this._map&&this.cleanMeshes(),this.outlinePositions&&this.updatePoints(),Object.keys(t).length===0)return;const e=this.getRenderer().postproduction.outlinePass,i=await this.components.get(kM).get(t);for(const[n,r]of i.entries()){const o=[...r.values()].flat();for(const a of o)this._meshes.push(a),e.scene.add(a)}}async addItems(t){vs.add(this._map,t),await this.update(t)}async removeItems(t){vs.remove(this._map,t),await this.update()}clean(){this._map={},this._activeStyles.clear(),this.cleanMeshes(),this._mesh&&this.components.get(dr).destroy(this._mesh,!0,!0),this._mesh=null}dispose(){this.styles.clear(),this.clean(),this.onDisposed.trigger(n_.uuid)}cleanMeshes(){for(const t of this._meshes)t.removeFromParent();this._meshes=[]}async updatePoints(){let t=0;for(const[i,n]of Object.entries(this._map))t+=n.size;this._points.geometry.setAttribute("position",new Us(new Float32Array(t*3),3));const e=await this.components.get(Lt).getPositions(this._map);for(let i=0;i<e.length;i++){const{x:n,y:r,z:o}=e[i];this._points.geometry.attributes.position.array[i*3]=n,this._points.geometry.attributes.position.array[i*3+1]=r,this._points.geometry.attributes.position.array[i*3+2]=o}this._points.geometry.attributes.position.needsUpdate=!0}getRenderer(){if(!this.world)throw new Error("You must set a world to use the outliner!");const t=this.world.renderer;if(!t.postproduction)throw new Error("The world given to the outliner must use the postproduction renderer.");return t}};q(zM,"uuid","2fd3bcc5-b3b6-4ded-9f64-f47a02854a10");const UM=class gC extends he{constructor(t){super(t),q(this,"HOVERER_OPACITY_KEY","_maxHoverOpacity"),q(this,"_hoverTimeout",null),q(this,"_meshes",new ge),q(this,"_localId",null),q(this,"_fadeAnimation",null),q(this,"_world",null),q(this,"_enabled",!1),q(this,"_material",new br({color:16777215,transparent:!0,opacity:.5,depthTest:!1,userData:{[this.HOVERER_OPACITY_KEY]:.5}})),q(this,"onDisposed",new ft),q(this,"duration",200),q(this,"animation",!0),q(this,"mouseStopTimeout",null),q(this,"onMouseMove",()=>{this.mouseStopTimeout!==null&&clearTimeout(this.mouseStopTimeout),this.mouseStopTimeout=window.setTimeout(()=>this.hover(),50)}),q(this,"onMouseLeave",()=>{this._meshes.clear()}),q(this,"animate",()=>{if(!(this._fadeAnimation&&this.animation&&this.material.transparent))return;const{startTime:e,duration:i,fadeIn:n}=this._fadeAnimation,r=Date.now()-e,o=Math.min(r/i,1),a=n?o:1-o,l=this.material.userData[this.HOVERER_OPACITY_KEY],h=a*(l!==void 0?l:1);this.material.opacity=h,o<1?requestAnimationFrame(this.animate):(n||this._meshes.clear(),this._fadeAnimation=null)}),t.add(gC.uuid,this),this._meshes.onBeforeDelete.add(e=>{e.removeFromParent(),e.geometry.dispose()}),this._meshes.onItemAdded.add(e=>{this.world&&this.world.scene.three.add(e)}),this._meshes.onCleared.add(()=>{this._localId=null,this._hoverTimeout&&(clearTimeout(this._hoverTimeout),this._hoverTimeout=null)})}set world(t){if(t){this.components.get(hn).get(t),this._world=t,this.setupEvents(!0);for(const e of this._meshes)t.scene.three.add(e)}else{this.setupEvents(!1),this._world=null;for(const e of this._meshes)e.removeFromParent()}}get world(){return this._world}set enabled(t){this.setupEvents(t),this._enabled=t}get enabled(){return this._enabled}set material(t){t.userData[this.HOVERER_OPACITY_KEY]=t.opacity;for(const e of this._meshes)e.material=t;this._material.dispose(),this._material=t}get material(){return this._material}setupEvents(t){if(!this.world||this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The given world doesn't have a renderer!");const e=this.world.renderer.three.domElement;e.removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("mouseleave",this.onMouseMove),t&&(e.addEventListener("mousemove",this.onMouseMove),e.addEventListener("mouseleave",this.onMouseLeave))}async hover(){if(!this.enabled||!this.world)return;const t=await this.components.get(hn).get(this.world).castRay();if(!t){this._meshes.clear();return}const{fragments:e,localId:i}=t;this._localId!==i&&(this._meshes.clear(),this._localId=i,this._hoverTimeout=window.setTimeout(async()=>{const n=await e.getItem(i).getGeometry();if(!n)return;const r=await n.get();for(const o of r){const{positions:a,normals:l,indices:h,transform:c}=o;if(!(a&&l&&h&&c))continue;const u=new ye;u.setAttribute("position",new Us(a,3)),u.setAttribute("normal",new Us(l,3)),u.setIndex(new zx(h,1)),o.transform&&u.applyMatrix4(o.transform),u.computeVertexNormals();const p=new lt(u,this.material);this._meshes.add(p)}this._fadeAnimation={startTime:Date.now(),duration:this.duration,fadeIn:!0},this.animate()},100))}clear(){this._meshes.clear()}dispose(){this._enabled=!1,this._meshes.clear(),this._fadeAnimation=null,this._hoverTimeout=null,this.onDisposed.trigger()}};q(UM,"uuid","26fbd870-b1b2-4b71-b747-4063d484de1b");class BM{constructor(t){q(this,"alignments",[]),q(this,"enabled",!0),q(this,"world",null),q(this,"_raycastable",[]),q(this,"_components"),this._components=t}update(){this.dispose();for(const t of this.alignments)for(const e of t.children){const i=e;i.updateWorldMatrix(!0,!0);for(const n of i.children){const r=n;if(r.isLine2&&r.userData.points){const o=new ye,a=new Ze;a.geometry.setIndex(r.geometry.index);const l=new Float32Array(r.userData.points),h=new Ve(l,3);o.setAttribute("position",h),a.geometry=o,a.userData.curve=r,a.applyMatrix4(r.matrixWorld),a.updateMatrixWorld(),this._raycastable.push(a)}}}}dispose(){for(const t of this._raycastable)t.geometry.dispose(),t.geometry=void 0;this._raycastable=[]}castRay(){if(!this.enabled||!this.world)return null;const t=this._components.get(hn).get(this.world).castRayToObjects(this._raycastable);if(!t)return null;const e=t.object,i=e.geometry,n=t.index,r=i.attributes.position.array[n*3],o=i.attributes.position.array[n*3+1],a=i.attributes.position.array[n*3+2],l=i.attributes.position.array[n*3+3],h=i.attributes.position.array[n*3+4],c=i.attributes.position.array[n*3+5],u=new F(l-r,h-o,c-a).normalize();return{point:t.point,normal:u,curve:e.userData.curve,alignment:e.userData.curve.parent}}}let Dm=class{static alignmentPercentageToPoint(s,t){const e=new F,i=new F,n=this.alignmentLength(s),r=t*n;let o=0;if(s.updateWorldMatrix(!0,!0),t===1)for(let a=s.children.length-1;a>=0;a--){const l=s.children[a],h=l.userData.points;if(!h)continue;const c=new F(h[h.length-3],h[h.length-2],h[h.length-1]);return c.applyMatrix4(l.matrixWorld),{normal:new F,point:c,curve:l,alignment:s}}for(const a of s.children){const l=a.userData.points;if(l)for(let h=0;h<l.length-3;h+=3){const c=e.set(l[h],l[h+1],l[h+2]),u=i.set(l[h+3],l[h+4],l[h+5]),p=c.distanceTo(u);if(o+p>=r){const d=r-o,_=u.clone().sub(c).normalize(),m=_.clone().multiplyScalar(d);return c.add(m),c.applyMatrix4(a.matrixWorld),{normal:_,point:c,curve:a,alignment:s}}o+=p}}return null}static curvePercentageToPoint(s,t,e){const i=new F,n=new F,r=this.curveLength(t),o=e*r;let a=0;const l=t.userData.points;if(!l)throw new Error("No points found in curve");for(let h=0;h<l.length-3;h+=3){const c=i.set(l[h],l[h+1],l[h+2]),u=n.set(l[h+3],l[h+4],l[h+5]),p=c.distanceTo(u);if(a+p>=o){const d=o-a,_=u.clone().sub(c).normalize(),m=_.clone().multiplyScalar(d);return c.add(m),{normal:_,point:c,curve:t,alignment:s}}a+=p}return null}static alignmentLength(s){let t=0;if(s.userData.length!==void 0)return s.userData.length;for(const e of s.children)"isLine2"in e&&(t+=this.curveLength(e));return s.userData.length=t,t}static curveLength(s){let t=0;if(s.userData.length!==void 0)return s.userData.length;const e=new F,i=new F,n=s.userData.points;if(!n)throw new Error("No points found in curve");for(let r=0;r<n.length-2-3;r+=3){const o=e.set(n[r],n[r+1],n[r+2]),a=i.set(n[r+3],n[r+4],n[r+5]);t+=o.distanceTo(a)}return s.userData.length=t,t}static curvePointToAlignmentPercentage(s,t,e){const i=new F,n=new F,r=this.alignmentLength(s);let o=0;s.updateWorldMatrix(!0,!0);for(const a of s.children){const l=a.userData.points;if(l)for(let h=0;h<l.length-3;h+=3){const c=i.set(l[h],l[h+1],l[h+2]),u=n.set(l[h+3],l[h+4],l[h+5]);c.applyMatrix4(a.matrixWorld),u.applyMatrix4(a.matrixWorld);const p=c.distanceTo(u),d=c.distanceTo(t)<.001,_=u.distanceTo(t)<.001,m=this.isPointbetweenTwoOthers(c,u,t);if(a===e&&(d||_||m)){const g=c.distanceTo(t);return(o+g)/r}o+=p}}return null}static isPointbetweenTwoOthers(s,t,e){const i=new F;i.subVectors(t,s).normalize();const n=new F;n.subVectors(e,s).normalize();const r=new F;r.subVectors(e,t).normalize();const o=1-.0016;return i.dot(n)>o&&i.dot(r)<-o}};class VM{constructor(t,e){q(this,"onDisposed",new ft),q(this,"alignments",[]),q(this,"components"),q(this,"onMarkerChange",new ft),q(this,"enabled",!0),q(this,"highlightMaterial"),q(this,"increments",20),q(this,"screenDistanceLimit",.1),q(this,"fadeInTime",500),q(this,"_mouseMarkers"),q(this,"_highlighted",new Set),q(this,"_stationPoints",new Map),q(this,"_originalHighlightMaterialId","originalHighlightMaterial"),q(this,"_world",null),q(this,"_raycaster"),q(this,"_stationLabelColor",new xt(16777215)),q(this,"_stationLabelBackgroundColor",new xt(8014801)),q(this,"_stationPointerColor",new xt(16777215)),q(this,"_stationPointerBackgroundColor",new xt(4803766)),q(this,"_pointerDown",performance.now()),q(this,"_pointerDownTime",150),q(this,"onPointerDown",()=>{this._pointerDown=performance.now()}),q(this,"onPointerUp",()=>{if(performance.now()-this._pointerDown>this._pointerDownTime)return;const i=this.setMarkerToMouse("select");i&&this.onMarkerChange.trigger(i)}),q(this,"onMouseMove",()=>{this.setMarkerToMouse("hover")}),this.components=t,this.highlightMaterial=e,this._raycaster=new BM(t),this._raycaster.alignments=this.alignments}get world(){return this._world}set world(t){var e,i,n,r;if(t===this._world||(this._world&&this.setupEvents(!1),this._world=t,(e=this._mouseMarkers)==null||e.hover.removeFromParent(),(i=this._mouseMarkers)==null||i.select.removeFromParent(),(n=this._mouseMarkers)==null||n.hover.element.remove(),(r=this._mouseMarkers)==null||r.select.element.remove(),!t))return;this._raycaster.world=t;const o=this.newCivilLabel(0,"stationPointer");t.scene.three.add(o),o.visible=!1,o.element.style.transition="";const a=this.newCivilLabel(0,"stationPointer");a.element.style.transition="",a.element.style.opacity="0.5",t.scene.three.add(a),a.visible=!1,this._mouseMarkers={select:o,hover:a},this.setupEvents(!0)}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(t){this._stationLabelColor=t;const e=`#${t.getHexString()}`;for(const[,{labels:i}]of this._stationPoints){const n=[...i.children];for(const r of n){const o=this.getLabel(r);o.style.color=e;const a=this.getPoint(r);a.style.backgroundColor=e}}}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(t){this._stationLabelBackgroundColor=t;const e=`#${t.getHexString()}`;for(const[,{labels:i}]of this._stationPoints){const n=[...i.children];for(const r of n){const o=this.getLabel(r);o.style.backgroundColor=e;const a=this.getPoint(r);a.style.border=`2px solid ${e}`}}}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(t){this._stationPointerColor=t;const e=`#${t.getHexString()}`;if(this._mouseMarkers){const i=this._mouseMarkers.select,n=this.getLabel(i);n.style.color=e;const r=this.getPoint(i);r.style.backgroundColor=e}}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(t){this._stationPointerBackgroundColor=t;const e=`#${t.getHexString()}`;if(this._mouseMarkers){const i=this._mouseMarkers.select,n=this.getLabel(i);n.style.backgroundColor=e;const r=this.getPoint(i);r.style.border=`2px solid ${e}`}}dispose(){var t,e,i,n;this.clearHighlight(),this.clearStations(),this.alignments=[],(t=this._mouseMarkers)==null||t.hover.removeFromParent(),(e=this._mouseMarkers)==null||e.select.removeFromParent(),(i=this._mouseMarkers)==null||i.hover.element.remove(),(n=this._mouseMarkers)==null||n.select.element.remove(),this._raycaster.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){this._raycaster.update()}setMarkerAtPoint(t,e){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");this.updateMarkerValue(t,e),this._mouseMarkers[e].visible=!0,this._mouseMarkers[e].position.copy(t.point)}highlight(t,e=!0){e&&this.clearHighlight(this._highlighted);for(const i of t.children)"isLineSegments2"in i&&"material"in i&&(i.userData[this._originalHighlightMaterialId]=i.material,i.material=this.highlightMaterial);this._highlighted.add(t)}clearHighlight(t=this._highlighted){for(const e of t)for(const i of e.children)"isLineSegments2"in i&&"material"in i&&(i.material=i.userData[this._originalHighlightMaterialId],delete i.userData[this._originalHighlightMaterialId]);this._highlighted.clear()}createStations(t){if(!this.world||this._stationPoints.has(t.uuid))return;const e=new on;this.world.scene.three.add(e),this._stationPoints.set(t.uuid,{alignment:t,labels:e})}clearStations(t=this._stationPoints.keys()){for(const e of t){const i=this._stationPoints.get(e);i&&(this.clearLabels(i.labels),this._stationPoints.delete(e))}}updateStations(){if(!this.world)throw new Error("No world found!");if(!this.world.renderer)throw new Error("No renderer found!");const t=this.world.camera.three,e=this.world.renderer.three,i=new cr,n=e.clippingPlanes,r=new F,o=new F;let a=!0;const l=new F;for(const[,{alignment:h,labels:c}]of this._stationPoints){this.clearLabels(c),h.updateWorldMatrix(!0,!0);const u=h.userData.initialStation;let p=u||0;const d=p%this.increments;let _=u+this.increments-d;for(const m of h.children){if(!("isLine2"in m))continue;const g=m;if(g.geometry.boundingBox||g.geometry.computeBoundingBox(),i.setFromProjectionMatrix(new vt().multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse)),!i.intersectsBox(g.geometry.boundingBox)){const L=Dm.curveLength(m);p+=L;const V=p%this.increments;_=p+this.increments-V;continue}const f=m.userData.points,b=f[0],y=f[1],E=f[2];if(l.set(b,y,E),l.applyMatrix4(m.matrixWorld),!this.isLabelClipped(n,l)){if(a){a=!1,r.set(l.x,l.y,l.z),r.project(t),r.z=0;const L=this.newCivilLabel(p,"stationLabel");L.position.set(l.x,l.y,l.z),c.children.push(L)}else if(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit){const L=this.newCivilLabel(p,"stationLabel");L.position.set(l.x,l.y,l.z),c.children.push(L),r.copy(o)}}const C=new F,I=new F;for(let L=0;L<f.length-3;L+=3){C.set(f[L],f[L+1],f[L+2]),I.set(f[L+3],f[L+4],f[L+5]);const V=C.distanceTo(I),T=p+V,N=I.clone().sub(C).normalize();for(;T>_;){const v=_-p,M=N.clone();M.multiplyScalar(v);const{x:Q,y:j,z:it}=C.clone().add(M);if(l.set(Q,j,it),l.applyMatrix4(m.matrixWorld),!this.isLabelClipped(n,l)&&i.containsPoint(l)&&(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit)){const G=this.newCivilLabel(_,"stationLabel");G.position.set(l.x,l.y,l.z),c.children.push(G),r.copy(o)}_+=this.increments}p+=V}const x=f[f.length-3],A=f[f.length-2],O=f[f.length-1];if(l.set(x,A,O),l.applyMatrix4(m.matrixWorld),!(this.isLabelClipped(n,l)||!i.containsPoint(l))&&(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit)){const L=this.newCivilLabel(p,"stationLabel");L.position.set(l.x,l.y,l.z),c.children.push(L),r.copy(o)}}}}getCursorValue(){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");return this._mouseMarkers.select.element.children[0].children[0].innerText}setCursorValue(t,e){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const i=this._mouseMarkers[e].element.children[0].children[0];i.innerText=t}isLabelClipped(t,e){for(const i of t)if(!(i.distanceToPoint(e)>0))return!0;return!1}clearLabels(t){const e=[...t.children];for(const i of e)i.element.style.opacity="0";setTimeout(()=>{for(const i of e)i.removeFromParent(),i.element.remove(),i.visible=!1},this.fadeInTime)}newCivilLabel(t,e){const i=document.createElement("div"),n=e==="stationLabel"?this.stationLabelColor:this.stationPointerColor,r=e==="stationLabel"?this.stationLabelBackgroundColor:this.stationPointerBackgroundColor,o=document.createElement("div");o.style.width="4px",o.style.height="4px",o.style.borderRadius="50%",o.style.backgroundColor=`#${n.getHexString()}`,o.style.border=`2px solid #${r.getHexString()}`,o.style.display="flex",o.style.justifyContent="center";const a=this.getFormattedStation(t),l=document.createElement("div");l.innerText=a,l.style.backgroundColor=`#${r.getHexString()}`,l.style.color=`#${n.getHexString()}`,l.style.padding="0.3rem",l.style.position="absolute",l.style.bottom="1rem",l.style.borderRadius="6px",l.style.boxShadow="rgba(0, 0, 0, 0.6) 0px 4px 6px",o.appendChild(l);const h=new hC(i);return i.appendChild(o),e==="stationLabel"&&(i.style.transition=`opacity ${this.fadeInTime}ms ease-in-out`,i.style.opacity="0",setTimeout(()=>{i.style.opacity="1"})),h}setupEvents(t){if(!this.world)throw new Error("No world found!");if(this.world.isDisposing||!this.world.renderer)return;const e=this.world.renderer.three.domElement,i=this.components.get(hn).get(this.world);i.three.params.Line||(i.three.params.Line={threshold:10}),e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointerup",this.onPointerUp),e.removeEventListener("pointermove",this.onMouseMove),t&&(e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointerup",this.onPointerUp),e.addEventListener("pointermove",this.onMouseMove))}setMarkerToMouse(t){if(!this.enabled||!this._mouseMarkers)return null;if(!this.world)throw new Error("No world found!");const e=this._raycaster.castRay();if(!e)return this._mouseMarkers[t].visible=!1,null;this._mouseMarkers[t].visible=!0;const i=e.point;return this._mouseMarkers[t].position.copy(i),this.updateMarkerValue(e,t),e}updateMarkerValue(t,e){if(!this._mouseMarkers)return;const{alignment:i,curve:n,point:r}=t,o=Dm.curvePointToAlignmentPercentage(i,r,n);if(o===null)throw new Error("Point is not on the curve");const a=o*Dm.alignmentLength(i)+i.userData.initialStation,l=this.getFormattedStation(a);this.setCursorValue(l,e)}getFormattedStation(t){const e=Math.floor(t/1e3),i=Math.round(t-e*1e3);return`${e}+${i}`}getLabel(t){return t.element.children[0].children[0]}getPoint(t){return t.element.children[0]}}const $M=class _C extends he{constructor(t){super(t),q(this,"onDisposed",new ft),q(this,"list",new Map),q(this,"enabled",!0),q(this,"highlightMaterial",new sb({color:8014801,linewidth:5,depthTest:!1})),q(this,"_increments",20),q(this,"_screenDistanceLimit",.1),q(this,"_fadeInTime",500),q(this,"_stationLabelColor",new xt(16777215)),q(this,"_stationLabelBackgroundColor",new xt(8014801)),q(this,"_stationPointerColor",new xt(16777215)),q(this,"_stationPointerBackgroundColor",new xt(4803766)),this.components.add(_C.uuid,this)}get increments(){return this._increments}set increments(t){this._increments=t;for(const[,e]of this.list)e.increments=t}get screenDistanceLimit(){return this._screenDistanceLimit}set screenDistanceLimit(t){this._screenDistanceLimit=t;for(const[,e]of this.list)e.screenDistanceLimit=t}get fadeInTime(){return this._fadeInTime}set fadeInTime(t){this._fadeInTime=t;for(const[,e]of this.list)e.fadeInTime=t}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(t){this._stationLabelColor=t;for(const[,e]of this.list)e.stationLabelColor=t}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(t){this._stationLabelBackgroundColor=t;for(const[,e]of this.list)e.stationLabelBackgroundColor=t}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(t){this._stationPointerColor=t;for(const[,e]of this.list)e.stationPointerColor=t}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(t){this._stationPointerBackgroundColor=t;for(const[,e]of this.list)e.stationPointerBackgroundColor=t}create(t){const e=new VM(this.components,this.highlightMaterial);return this.list.set(t,e),e}delete(t){const e=this.list.get(t);e&&(e.dispose(),this.list.delete(t))}dispose(){for(const[,t]of this.list)t.dispose();this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){for(const[,t]of this.list)t.updateAlignments()}};q($M,"uuid","0a59c09e-2b49-474a-9320-99f51f40f182");const HM=class bC extends he{constructor(t){super(t),q(this,"enabled",!0),q(this,"onDisposed",new ft),q(this,"_world",null),q(this,"_flip",!1),q(this,"_plane"),q(this,"_point",new F),q(this,"_edgeMeshes",[]),q(this,"_sectionVisible",!1),q(this,"_sectionOffset",.1),q(this,"edgeMaterial",new sb({color:0,linewidth:5,depthTest:!1})),this.components.add(bC.uuid,this)}get plane(){if(!this._plane)throw new Error("Plane is not set. You must give a world.");return this._plane}set plane(t){this._plane=t}get sectionVisible(){return this._sectionVisible}set sectionVisible(t){this._sectionVisible=t;for(const e of this._edgeMeshes)e.visible=t}get world(){return this._world}set world(t){var e;if(this._world=t,(e=this._plane)==null||e.dispose(),!t)return;const i=this.components.get(Ur),n=i.createFromNormalAndCoplanarPoint(t,new F(1,0,0),new F);this.plane=i.list.get(n),this.plane.visible=!1,this.plane.enabled=!1}get flip(){return this._flip}set flip(t){var e;if(t===this._flip)return;this._flip=t;const i=(e=this.plane)==null?void 0:e.normal.clone().multiplyScalar(-1);for(const n of this._edgeMeshes)n.position.add(i.clone().multiplyScalar(this._sectionOffset));this.plane.setFromNormalAndCoplanarPoint(i,this._point),this.plane.update()}dispose(){var t;this.clearMeshes(),(t=this.plane)==null||t.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}async set(t,e){this.flip&&e.multiplyScalar(-1),this.plane.setFromNormalAndCoplanarPoint(e,t),this._point.copy(t)}async update(){this.clearMeshes();const t=this.components.get(Lt);this.plane.update();const e=[];for(const[,i]of t.list)e.push(this.generateModelSection(i));await Promise.all(e)}async generateModelSection(t){if(!this.world)return;const e=this.plane.three.clone();e.constant-=.01;const{buffer:i}=await t.getSection(e),n=new ye,r=new Ve(i,3,!1);n.setAttribute("position",r);const o=new Lp(n),a=new eb;a.fromLineSegments(o);const l=new uC(a,this.edgeMaterial);l.frustumCulled=!1,this.world.scene.three.add(l),this._edgeMeshes.push(l),l.renderOrder=3,o.geometry.dispose()}clearMeshes(){for(const t of this._edgeMeshes)t.removeFromParent(),t.geometry.dispose(),t.material=void 0;this._edgeMeshes=[]}};q(HM,"uuid","96b2c87e-d90b-4639-8257-8f01136fe324");const Ja=class qd{constructor(t){q(this,"onDisposed",new ft),q(this,"marker",null),q(this,"world",null),q(this,"_enabled",!1),q(this,"_components"),this._components=t}set enabled(t){this._enabled=t,this.marker&&(this.marker.visible=t),t&&this.get()}get enabled(){return this._enabled}dispose(){this.marker&&this.marker.dispose()}async get(t){const e=(t==null?void 0:t.world)??this.world;if(!e)throw new Error("GraphicVertexPicker: a world is need to get a casting result.");const i=await this._components.get(hn).get(e).castRay({snappingClasses:t==null?void 0:t.snappingClasses});if(i){const{point:n}=i;if(!this.marker){const r=document.createElement("div");this.marker=new Yo(e,r)}if(this.marker.world!==e&&(this.marker.world=e,this.marker.three.removeFromParent(),e.scene.three.add(this.marker.three)),this.marker.visible=!0,this.marker.three.position.copy(n),"snappingClass"in i&&typeof i.snappingClass=="number"&&(i.snappingClass===0||i.snappingClass===1||i.snappingClass===2)){const r=qd.snappingStyles[i.snappingClass]??qd.baseSnappingStyle;Object.assign(this.marker.three.element.style,r)}else Object.assign(this.marker.three.element.style,qd.baseSnappingStyle)}else this.marker&&(this.marker.visible=!1);return i}};q(Ja,"baseSnappingStyle",{height:"6px",width:"6px",borderRadius:"100%",borderWidth:"2px",borderColor:"rgb(122, 75, 209)",borderStyle:"solid",zIndex:"-20"}),q(Ja,"snappingStyles",{[Qs.FACE]:{...Ja.baseSnappingStyle},[Qs.POINT]:{...Ja.baseSnappingStyle,borderColor:"#e25959",borderRadius:"0"},[Qs.LINE]:{...Ja.baseSnappingStyle,borderColor:"#2d2d2d",borderRadius:"0"}});let jM=Ja;function yC(){const s=document.createElement("div");return s.style.backgroundColor="blue",s.style.color="white",s.style.padding="6px",s.style.borderRadius="6px",s.style.boxShadow="0px 4px 6px rgba(0, 0, 0, 0.6)",s.style.zIndex="-10",s}function YM(s={}){const{color:t="white",size:e="4px",border:i="2px solid blue",background:n="white"}=s,r=document.createElement("div");return r.style.backgroundColor=n,r.style.color=t,r.style.height=e,r.style.width=e,r.style.borderRadius="50%",r.style.border=i,r.style.zIndex="-20",r}let Kr=class extends Gt{constructor(){super(...arguments),q(this,"id",Ss.create()),q(this,"_units","m"),q(this,"_rounding",2)}set units(s){this._units=s}get units(){return this._units}set rounding(s){this._rounding=s}get rounding(){return this._rounding}get value(){const s=this.distance();return ef.convertUnits(s,"m",this.units,this.rounding)}},WM=class r_{constructor(t,e,i,n=2,r="m"){q(this,"label"),q(this,"boundingBox",new lt),q(this,"world"),q(this,"_components"),q(this,"_units","m"),q(this,"_rounding",2),q(this,"startNormal",null),q(this,"line"),q(this,"rectangleComponentLines",[]),q(this,"projectionComponentLines",[]),q(this,"_visible",!0),q(this,"_root",new on),q(this,"_endpoints",new ge),q(this,"lineElement"),q(this,"rectangleDimensions",new ge),q(this,"projectionDimensions",new ge),q(this,"isSelected",!1),q(this,"_latestRectangularInversion",!1),q(this,"_endpointElement",YM()),q(this,"_material"),q(this,"_componentsMaterial",new jA({depthTest:!1,gapSize:.2,dashSize:.2,transparent:!0,opacity:.5,color:3026478})),this._components=t,this.world=e,this._material=i.lineMaterial,this._rounding=n,this._units=r,this.line=i.line,this.startNormal=i.startNormal??null,this.rectangleComponentLines=[new Kr,new Kr],this.updateRectangleComponents(),this.updateProjectionComponents(),this.lineElement=this.createLine(i),this._endpoints.onItemAdded.add(o=>{this._root.add(o.three);const a=this._endpoints.size===1?this.line.start:this.line.end;o.three.position.copy(a)}),this._endpoints.onBeforeDelete.add(o=>o.dispose()),this.createEndpoints();for(const o of this._endpoints)o.three.element.style.borderColor=`#${i.lineMaterial.color.getHexString()}`;this.label=this.newText(),this.label.three.element.style.backgroundColor=`#${i.lineMaterial.color.getHexString()}`,this.label.three.renderOrder=1,this._root.renderOrder=2,this.world.scene.three.add(this._root),this.setupEvents()}set units(t){for(const e of this.rectangleDimensions)e.units=t;for(const e of this.projectionDimensions)e.units=t;this._units=t,this.updateLabel()}get units(){return this._units}set rounding(t){for(const e of this.rectangleDimensions)e.rounding=t;for(const e of this.projectionDimensions)e.rounding=t;this._rounding=t,this.updateLabel()}get rounding(){return this._rounding}get visible(){return this._visible}set visible(t){for(const a of this.rectangleDimensions)a.visible=t;for(const a of this.projectionDimensions)a.visible=t;this._visible=t,this.label.visible=t;for(const a of this._endpoints)a.visible=t;const[e,i]=this._endpoints,n=e.three,r=i.three,o=this.label.three;t?(this.world.scene.three.add(this._root),this._root.add(o,n,r)):(o.removeFromParent(),n.removeFromParent(),r.removeFromParent(),this._root.removeFromParent())}set end(t){this.line.end=t;const e=this.lineElement.geometry.attributes.position;e.setXYZ(1,t.x,t.y,t.z),e.needsUpdate=!0,this.update()}set start(t){this.line.start=t;const e=this.lineElement.geometry.attributes.position;e.setXYZ(0,t.x,t.y,t.z),e.needsUpdate=!0,this.update()}setupEvents(){this.rectangleDimensions.onBeforeDelete.add(t=>t.dispose()),this.projectionDimensions.onBeforeDelete.add(t=>t.dispose())}dispose(){this.visible=!1;const t=this._components.get(dr);t.destroy(this._root),t.destroy(this.lineElement),this._endpoints.clear(),this.label.dispose(),this.boundingBox&&t.destroy(this.boundingBox),this.rectangleDimensions.clear(),this.projectionDimensions.clear(),this._components=null}createBoundingBox(){const t=new F;this.line.getCenter(t);const e=this.line.distance();this.boundingBox.geometry=new Jt(1,1,e),this.boundingBox.position.copy(t),this.boundingBox.lookAt(this.line.end),this.boundingBox.visible=!1,this._root.add(this.boundingBox)}invertRectangularDimensions(){this.rectangleDimensions.size!==0&&(this.rectangleDimensions.clear(),this._latestRectangularInversion=!this._latestRectangularInversion,this.updateRectangleComponents(this._latestRectangularInversion),this.displayRectangularDimensions())}displayRectangularDimensions(){this.rectangleDimensions.clear();for(const t of this.rectangleComponentLines){const e=new r_(this._components,this.world,{line:t,lineMaterial:this._componentsMaterial,endpointElement:this.endpointElement});e.lineElement.computeLineDistances(),this.rectangleDimensions.add(e)}}displayProjectionDimensions(){this.projectionDimensions.clear();for(const t of this.projectionComponentLines){const e=new r_(this._components,this.world,{line:t,lineMaterial:this._componentsMaterial,endpointElement:this.endpointElement});e.lineElement.computeLineDistances(),this.projectionDimensions.add(e)}}set endpointElement(t){for(const e of this.rectangleDimensions)e.endpointElement=t;for(const e of this.projectionDimensions)e.endpointElement=t;this._endpointElement=t,this.createEndpoints()}get endpointElement(){return this._endpointElement}createEndpoints(){this._endpoints.clear();const t=new Yo(this.world,this._endpointElement),e=new Yo(this.world,this._endpointElement.cloneNode(!0));this._endpoints.add(t,e)}updateProjectionComponents(){if(!this.startNormal)return;const t=new Ht().setFromNormalAndCoplanarPoint(this.startNormal,this.line.start),e=new F;t.projectPoint(this.line.end,e);let[i]=this.projectionComponentLines;i||(i=new Kr,this.projectionComponentLines.push(i)),i.set(this.line.end,e),i.distance()<.01&&this.projectionComponentLines.shift();for(const n of this.projectionDimensions)n&&n.update()}updateRectangleComponents(t=!1){const e=t?this.line.end:this.line.start,i=t?this.line.start:this.line.end,n=new F;n.subVectors(i,e),Math.abs(i.y-e.y)>=.1?n.y=0:n.x=0;const r=e.clone().add(n),[o,a]=this.rectangleComponentLines;o.set(r,e),a.set(r,i);for(const l of this.rectangleDimensions)l.update()}updateLabel(){this.label.three.element.textContent=this.getTextContent();const t=new F;this.line.getCenter(t),this.label.three.position.copy(t)}updateGeometry(){this.updateRectangleComponents(),this.updateProjectionComponents(),[...this._endpoints][0].three.position.copy(this.line.start),[...this._endpoints][1].three.position.copy(this.line.end),this.lineElement.geometry.computeBoundingSphere()}update(){this.updateGeometry(),this.updateLabel()}set material(t){this._material.dispose(),this._material=t,this.lineElement.material=t}get material(){return this._material}createLine(t){const e=new ye;e.setFromPoints([t.line.start,t.line.end]);const i=new Ze(e,t.lineMaterial);return this._root.add(i),i}newText(){const t=yC();t.textContent=this.getTextContent();const e=new Yo(this.world,t),i=new F;return this.line.getCenter(i),e.three.position.copy(i),this._root.add(e.three),e}getTextContent(t=this.line.distance()){return`${ef.convertUnits(t,"m",this._units,this.rounding)} ${this._units}`}set color(t){const e=`#${t.getHexString()}`;this.label.three.element.style.backgroundColor=e;for(const i of this._endpoints)i.three.element.style.borderColor=e;this._material.color.set(t)}},fp=class vC{constructor(t){q(this,"id",Ss.create()),q(this,"points",new ge),q(this,"tolerance",.005),q(this,"_plane",null),q(this,"_rounding",2),q(this,"_units","m2"),this.points.guard=e=>{const i=[...this.points].some(r=>r.equals(e)),n=this.isPointInPlane(e);return!i&&n},this.points.onItemAdded.add(e=>{if(this.plane){const i=new F;this.plane.projectPoint(e,i),e.copy(i)}this.points.size<3||this.points.size===3&&this.computePlane()}),this.points.onItemDeleted.add(()=>{this.points.size>=3||(this._plane=null)}),this.points.onCleared.add(()=>{this._plane=null}),t&&this.points.add(...t)}get plane(){return this._plane}get _coordinateSystem(){if(!this.plane)return null;const t=this.plane.normal,e=new F,i=new F;return Math.abs(t.x)>Math.abs(t.z)?e.set(-t.y,t.x,0).normalize():e.set(0,-t.z,t.y).normalize(),i.crossVectors(t,e).normalize(),{normal:t.clone(),x:e.clone(),y:i.clone()}}get points2D(){if(!this.plane)if(this.points.size>=3)this.computePlane();else return null;return[...this.points].map(t=>this.convertPointTo2D(t)).filter(t=>t!==null)}get center(){if(!this.plane||this.points.size<3)return null;const t=this.points2D;if(!t||t.length===0)return null;const e=t.reduce((i,n)=>i.add(n),new Bt).divideScalar(t.length);return this.convertPointTo3D(e)}get value(){const t=this.points2D;if(!t)return 0;const e=Math.abs(jx.area(t));return ef.convertUnits(e,"m2",this.units,this.rounding)}get boundingBox(){if(this.points.size===0)return null;const t=new Tt;for(const e of this.points)t.expandByPoint(e);return t}get perimeter(){const t=this.points2D;if(!t||t.length<2)return 0;let e=0;for(let i=0;i<t.length;i++){const n=t[i],r=t[(i+1)%t.length];e+=n.distanceTo(r)}return e}set rounding(t){this._rounding=t}get rounding(){return this._rounding}set units(t){this._units=t}get units(){return this._units}isPointInPlane(t){if(!this.plane)return!0;const e=this.plane.distanceToPoint(t);return Math.abs(e)<this.tolerance}clone(){return new vC([...this.points])}computePlane(){const[t,e,i]=this.points;if(!(t&&e&&i))return null;const n=new F().subVectors(e,t),r=new F().subVectors(i,t),o=new F().crossVectors(n,r).normalize();return this._plane=new Ht().setFromNormalAndCoplanarPoint(o,t),this.plane}convertPointTo2D(t){if(!this.isPointInPlane(t)||!this.plane)return null;const e=this._coordinateSystem;if(!e)return null;const i=new F;this.plane.projectPoint(t,i);const n=i.dot(e.x),r=i.dot(e.y);return new Bt(n,r)}convertPointTo3D(t){if(!this.plane)return null;const e=this._coordinateSystem;if(!e)return null;const{x:i,y:n,normal:r}=e;return new F().addScaledVector(i,t.x).addScaledVector(n,t.y).addScaledVector(r,-this.plane.constant)}};class GM extends Yo{constructor(t){const e=document.createElement("div");e.style.backgroundColor="blue",e.style.color="white",e.style.padding="6px",e.style.borderRadius="6px",e.style.boxShadow="0px 4px 6px rgba(0, 0, 0, 0.6)",e.style.zIndex="-10",super(t,e),q(this,"_value",0),q(this,"_units","m2"),q(this,"_worldUnits","m2"),q(this,"_color",new xt),q(this,"_textColor",new xt),q(this,"_rounding",2),this.three.renderOrder=1,e.textContent=this.formattedValue}set value(t){this._value=t}get value(){return this._value}set units(t){this._units=t,this.three.element.textContent=this.formattedValue}get units(){return this._units}set worldUnits(t){this._worldUnits=t,this.three.element.textContent=this.formattedValue}get worldUnits(){return this._worldUnits}set color(t){this._color=t;const e=`#${t.getHexString()}`;this.three.element.style.backgroundColor=e}get color(){return this._color}set textColor(t){this._textColor=t;const e=`#${t.getHexString()}`;this.three.element.style.color=e}get textColor(){return this._textColor}set rounding(t){this._rounding=t,this.three.element.textContent=this.formattedValue}get rounding(){return this._rounding}get formattedValue(){return`${ef.convertUnits(this.value,this.worldUnits,this.units,this.rounding)} ${this.units}`}}class qM{constructor(t,e,i=new fp){q(this,"_root",new on),q(this,"_components"),q(this,"_material",new I_({color:"red",transparent:!0,opacity:.5,side:Wn,depthTest:!1})),q(this,"_visible",!0),q(this,"_color",new xt),q(this,"label"),q(this,"three",new lt),q(this,"world"),q(this,"area"),q(this,"_triggerUpdate",()=>this.update()),this._components=t,this.world=e,this.area=i,this.world.scene.three.add(this.three),this.label=new GM(e),this._root.renderOrder=2,this.visible=!0,this.update(),i.points.onItemAdded.add(this._triggerUpdate),i.points.onItemDeleted.add(this._triggerUpdate),i.points.onCleared.add(this._triggerUpdate)}set material(t){this._material.dispose(),this._material=t,this.three.material=t}get material(){return this._material}set visible(t){this._visible=t,this.label.visible=t;const e=this.label.three;t?(this._root.add(e,this.three),this.world.scene.three.add(this._root)):(e.removeFromParent(),this._root.removeFromParent())}get visible(){return this._visible}set rounding(t){this.label.rounding=t}get rounding(){return this.label.rounding}set units(t){this.label.units=t}get units(){return this.label.units}set color(t){this._color=t,this.label.color=t,this._material.color.set(t)}get color(){return this._color}updateMesh(){if(this.area.points.size<3)return;const t=[...this.area.points],e=t.flatMap(r=>[r.x,r.y,r.z]),i=[];for(let r=1;r<t.length-1;r++)i.push(0,r,r+1);this.three.geometry.dispose();const n=new ye;n.setAttribute("position",new Us(e,3)),n.setIndex(i),this.three.geometry=n,this.three.material=this.material}update(){if(this.updateMesh(),this.area.value===0)this.label.visible=!1;else{this.label.value=this.area.value,this.label.visible=!0;const t=this.area.center;t&&this.label.three.position.copy(t)}}dispose(){this.label.dispose(),this._components.get(dr).destroy(this._root,!0,!0),this.area.points.clear()}}const ZM={length:"m",area:"m2",volume:"m3"};let wC=class extends he{constructor(s,t){super(s),q(this,"list",new ge),q(this,"onDisposed",new ft),q(this,"snappings",[Qs.LINE,Qs.POINT,Qs.FACE]),q(this,"lines",new ge),q(this,"fills",new ge),q(this,"labels",new ge),q(this,"_world",null),q(this,"measureType"),q(this,"onPointerStop",new ft),q(this,"onPointerMove",new ft),q(this,"onStateChanged",new ft),q(this,"pointerStopTimeout",null),q(this,"onMove",()=>{this.enabled&&(this.pointerStopTimeout!==null&&clearTimeout(this.pointerStopTimeout),this.pointerStopTimeout=window.setTimeout(()=>{this.onPointerStop.trigger()},50),this.onPointerMove.trigger())}),q(this,"onKeydown",e=>{this.enabled&&e.key==="Escape"&&this.cancelCreation()}),q(this,"onEnabledChange",new ft),q(this,"_enabled",!1),q(this,"onVisibilityChange",new ft),q(this,"_visible",!0),q(this,"_units"),q(this,"_rounding",2),q(this,"_linesEndpointElement",yC()),q(this,"_linesMaterial",new Mp({color:"#0000FF",depthTest:!1})),q(this,"_fillsMaterial",new I_({color:2392594,side:Wn,transparent:!0,opacity:.3,depthTest:!1})),q(this,"_color",new xt),q(this,"_vertexPicker",new jM(this.components)),q(this,"create",e=>{}),q(this,"endCreation",e=>{}),q(this,"cancelCreation",()=>{}),q(this,"delete",e=>{}),this.measureType=t,this._units=ZM[this.measureType],this.lines.onBeforeDelete.add(e=>e.dispose()),this.fills.onBeforeDelete.add(e=>e.dispose()),this.labels.onBeforeDelete.add(e=>e.dispose()),this.list.onCleared.add(()=>{this.lines.clear(),this.fills.clear(),this.labels.clear()})}set world(s){this._world=s,this._vertexPicker.world=s}get world(){return this._world}get unitsList(){let s=[];return this.measureType==="length"?s=["mm","cm","m","km"]:this.measureType==="area"?s=["mm2","cm2","m2","km2"]:s=["mm3","cm3","m3","km3"],s}setEvents(s){if(!this.world)throw new Error("Measurement: you must specify a world first!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("Measurement: the world needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;t&&(t.removeEventListener("pointermove",this.onMove),window.removeEventListener("keydown",this.onKeydown),s&&(t.addEventListener("pointermove",this.onMove),window.addEventListener("keydown",this.onKeydown)))}set enabled(s){this._enabled=s,this._vertexPicker.enabled=s,this.setEvents(s),this.cancelCreation(),this.onEnabledChange.trigger(s),this.onStateChanged.trigger(["enabled"])}get enabled(){return this._enabled}set visible(s){this._visible=s;for(const t of this.lines)t.visible=s;for(const t of this.fills)t.visible=s;this.onVisibilityChange.trigger(s),this.onStateChanged.trigger(["visibility"])}get visible(){return this._visible}set units(s){this._units=s;let t;if(s.endsWith("2")?t="area":s.endsWith("3")?t="volume":t="length",t==="length"){for(const e of this.lines)e.units=s;for(const e of this.list)(e instanceof Kr||e instanceof fp)&&(e.units=s)}else if(t==="area")for(const e of this.fills)e.units=s;this.onStateChanged.trigger(["units"])}get units(){return this._units}set rounding(s){this._rounding=s;for(const t of this.list)(t instanceof Kr||t instanceof fp)&&(t.rounding=s);for(const t of this.lines)t.rounding=s;for(const t of this.fills)t.rounding=s;this.onStateChanged.trigger(["rounding"])}get rounding(){return this._rounding}set linesEndpointElement(s){this._linesEndpointElement=s;for(const t of this.lines)t.endpointElement=s}get linesEndpointElement(){return this._linesEndpointElement}set linesMaterial(s){this._linesMaterial.dispose(),this._linesMaterial=s;for(const t of this.lines)t.material=s}get linesMaterial(){return this._linesMaterial}set fillsMaterial(s){this._fillsMaterial.dispose(),this._fillsMaterial=s;for(const t of this.fills)t.material=s}get fillsMaterial(){return this._fillsMaterial}set color(s){this._color=s,this._linesMaterial.color.set(s),this._fillsMaterial.color.set(s);for(const t of this.lines)t.color=s;for(const t of this.fills)t.color=s;this.onStateChanged.trigger(["color"])}get color(){return this._color}dispose(){this._vertexPicker.dispose(),this.list.clear(),this.linesMaterial.dispose(),this.fillsMaterial.dispose(),this.onDisposed.trigger()}createLineElement(s,t=null){if(!this.world)throw new Error("Measurement: world is need!");return new WM(this.components,this.world,{line:s,startNormal:t??void 0,lineMaterial:this.linesMaterial,endpointElement:this.linesEndpointElement},this.rounding,this.units)}createFillElement(s){if(!this.world)throw new Error("Measurement: world is need!");const t=new qM(this.components,this.world,s);return t.rounding=this.rounding,(this.units.endsWith("2")?"area":void 0)==="area"&&(t.units=this.units),t}addLineElementsFromPoints(s){for(let t=0;t<s.length;t++){const e=s[t],i=s[(t+1)%s.length],n=new Kr(e,i),r=this.createLineElement(n);r.label.visible=!1,this.lines.add(r)}}getLineBoxes(){const s=[];for(const t of this.lines)s.push(t.boundingBox);return s}getFillBoxes(){const s=[];for(const t of this.fills)s.push(t.three);return s}};const XM=class EC extends wC{constructor(t){super(t,"area"),q(this,"pickTolerance",.1),q(this,"tolerance",.005),q(this,"modes",["free","square"]),q(this,"_mode","free"),q(this,"_temp",{isDragging:!1,area:new fp,lines:new ge,point:new F}),q(this,"computeLineElements",()=>{this._temp.lines.clear();const e=[...this._temp.area.points];if(this._temp.area.isPointInPlane(this._temp.point)&&e.push(this._temp.point),!(e.length<2||!this.world))for(let i=0;i<e.length;i++){const n=e[i],r=e[(i+1)%e.length],o=new Kr(n,r),a=this.createLineElement(o);this._temp.lines.add(a)}}),q(this,"create",async()=>{if(!this.enabled)return;if(!this.world)throw new Error("Area Measurement: world is not defined!");const e=await this._vertexPicker.get({snappingClasses:this.snappings});if(!(e&&e.point))return;const{area:i,point:n}=this._temp;if(this._temp.isDragging||(i.tolerance=this.tolerance,i.points.clear(),this._temp.isDragging=!0),i.points.size===0&&n.copy(e.point),i.points.add(n.clone()),this.mode==="square"&&i.points.size===2&&e.normal){const[r,o]=i.points,a=new F().subVectors(o,r),l=a.clone(),h=a.clone().negate();Math.abs(a.y)>=.1?(l.y=0,h.y=0):(l.x=0,h.x=0);const c=r.clone().add(l),u=o.clone().add(h);i.points.clear(),i.points.add(r,c,o,u),this.endCreation()}}),q(this,"endCreation",()=>{this.enabled&&(this._temp.isDragging=!1,this._temp.area.points.size>=3&&this.list.add(this._temp.area.clone()),this._temp.area.points.clear(),this._temp.lines.clear())}),q(this,"cancelCreation",()=>{this.enabled&&(this._temp.isDragging=!1,this._temp.area.points.clear(),this._temp.lines.clear())}),q(this,"delete",()=>{if(!this.enabled||this.list.size===0||!this.world)return;const e=this.getFillBoxes(),i=this.components.get(hn).get(this.world).castRayToObjects(e),n=this.components.get(dr);for(const o of e)n.destroy(o);if(!i)return;const r=[...this.fills].find(o=>o.three===i.object);r&&(this.list.delete(r.area),this.lines.clear())}),t.add(EC.uuid,this),this.initHandlers(),this.color=new xt("#6528d7")}get mode(){return this._mode}set mode(t){this._mode=t,this.cancelCreation(),this.onStateChanged.trigger(["mode"])}initHandlers(){this.onVisibilityChange.add(()=>{for(const t of this.lines)t.label.visible=!1}),this.list.onItemAdded.add(t=>{if(!this.world)return;const e=this.createFillElement(t);e.color=this.color,this.fills.add(e),this.addLineElementsFromPoints([...t.points])}),this.list.onBeforeDelete.add(t=>{const e=[...this.fills].find(i=>i.area===t);e&&this.fills.delete(e)}),this.onPointerStop.add(()=>this.updatePreview()),this._temp.lines.onItemAdded.add(t=>t.label.visible=!1),this._temp.lines.onBeforeDelete.add(t=>t.dispose()),this._temp.area.points.onItemAdded.add(()=>{this.computeLineElements()}),this._temp.area.points.onItemDeleted.add(()=>{this._temp.lines.clear()})}async updatePreview(){if(!this.enabled||!this.world)throw new Error("Measurement is not enabled or world is not defined!");const t=await this._vertexPicker.get({snappingClasses:this.snappings});if(!(t&&t.point&&this._temp.isDragging))return;const e=t.point.clone(),{plane:i}=this._temp.area;if(i){const n=i.distanceToPoint(e);if(Math.abs(n)<.1){const r=new F;i.projectPoint(e,r),e.copy(r)}}this._temp.point.copy(e),this.computeLineElements()}};q(XM,"uuid","09b78c1f-0ff1-4630-a818-ceda3d878c75");const QM=class CC extends wC{constructor(t){super(t,"length"),q(this,"_temp",{isDragging:!1,line:new Kr}),q(this,"modes",["free","edge"]),q(this,"_mode","free"),q(this,"create",()=>{if(this.enabled){if(!this._temp.isDragging){this.initPreview();return}this.endCreation()}}),q(this,"endCreation",()=>{this.enabled&&this._temp.dimension&&(this.list.add(this._temp.line.clone()),this.mode==="free"&&(this._temp.dimension.dispose(),this._temp.dimension=void 0,this._temp.isDragging=!1,this._temp.startNormal=void 0))}),q(this,"cancelCreation",()=>{var e;this.enabled&&(this._temp.isDragging=!1,this._temp.dimension&&((e=this._temp.dimension)==null||e.dispose(),this._temp.dimension=void 0))}),q(this,"delete",()=>{if(!this.enabled||this.list.size===0||!this.world)return;const e=this.getLineBoxes(),i=this.components.get(hn).get(this.world).castRayToObjects(e);if(!i)return;const n=[...this.lines].find(r=>r.boundingBox===i.object);n&&this.list.delete(n.line)}),t.add(CC.uuid,this),this.initHandlers()}get mode(){return this._mode}set mode(t){this._mode=t,this.cancelCreation(),t==="edge"&&this.initPreview(),this.onStateChanged.trigger(["mode"])}initHandlers(){this.list.onItemAdded.add(t=>{const e=this.createLineElement(t,this._temp.startNormal);e.createBoundingBox(),this.lines.add(e)}),this.list.onBeforeDelete.add(t=>{const e=[...this.lines].find(i=>i.line===t);e&&this.lines.delete(e)}),this.onPointerStop.add(()=>this.updatePreviewLine()),this.onEnabledChange.add(t=>{t&&this.mode==="edge"&&this.initPreview()})}async initPreview(){if(!this.world)throw new Error("Measurement: world is need!");const t=await this._vertexPicker.get({snappingClasses:this.snappings});if(this.mode==="free"){if(!(t!=null&&t.point))return;const e=t.point;this._temp.line.set(e,e.clone()),this._temp.isDragging=!0,this._temp.dimension=this.createLineElement(this._temp.line),this._temp.startNormal=t.normal??void 0}else if(this.mode==="edge"){const e=t==null?void 0:t.snappedEdgeP1,i=t==null?void 0:t.snappedEdgeP2,n=e||new F,r=n||i;this._temp.line.set(n,r),this._temp.isDragging=!0,this._temp.dimension=this.createLineElement(this._temp.line),this._temp.dimension.visible=!!(e&&i)}}async updatePreviewLine(){if(!this.world)throw new Error("Measurement: world is need!");const t=await this._vertexPicker.get({snappingClasses:this.snappings});if(this.mode==="free"){if(!(t!=null&&t.point)||(this._temp.line.end.copy(t.point),!this._temp.dimension))return;this._temp.dimension.end=this._temp.line.end}else if(this.mode==="edge"){const e=t==null?void 0:t.snappedEdgeP1,i=t==null?void 0:t.snappedEdgeP2;if(this._temp.dimension&&(this._temp.dimension.visible=!!(e&&i)),!(e&&i)||(this._temp.line.start.copy(e),this._temp.line.end.copy(i),!this._temp.dimension))return;this._temp.dimension.start=this._temp.line.start,this._temp.dimension.end=this._temp.line.end}}};q(QM,"uuid","2f9bcacf-18a9-4be6-a293-e898eae64ea1");/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Zd=globalThis,ib=Zd.ShadowRoot&&(Zd.ShadyCSS===void 0||Zd.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,nb=Symbol(),av=new WeakMap;let IC=class{constructor(s,t,e){if(this._$cssResult$=!0,e!==nb)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=s,this.t=t}get styleSheet(){let s=this.o;const t=this.t;if(ib&&s===void 0){const e=t!==void 0&&t.length===1;e&&(s=av.get(t)),s===void 0&&((this.o=s=new CSSStyleSheet).replaceSync(this.cssText),e&&av.set(t,s))}return s}toString(){return this.cssText}};const KM=s=>new IC(typeof s=="string"?s:s+"",void 0,nb),rb=(s,...t)=>{const e=s.length===1?s[0]:t.reduce((i,n,r)=>i+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+s[r+1],s[0]);return new IC(e,s,nb)},JM=(s,t)=>{if(ib)s.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const e of t){const i=document.createElement("style"),n=Zd.litNonce;n!==void 0&&i.setAttribute("nonce",n),i.textContent=e.cssText,s.appendChild(i)}},lv=ib?s=>s:s=>s instanceof CSSStyleSheet?(t=>{let e="";for(const i of t.cssRules)e+=i.cssText;return KM(e)})(s):s;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:t4,defineProperty:e4,getOwnPropertyDescriptor:s4,getOwnPropertyNames:i4,getOwnPropertySymbols:n4,getPrototypeOf:r4}=Object,El=globalThis,hv=El.trustedTypes,o4=hv?hv.emptyScript:"",cv=El.reactiveElementPolyfillSupport,dc=(s,t)=>s,mp={toAttribute(s,t){switch(t){case Boolean:s=s?o4:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,t){let e=s;switch(t){case Boolean:e=s!==null;break;case Number:e=s===null?null:Number(s);break;case Object:case Array:try{e=JSON.parse(s)}catch{e=null}}return e}},ob=(s,t)=>!t4(s,t),uv={attribute:!0,type:String,converter:mp,reflect:!1,hasChanged:ob};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),El.litPropertyMetadata??(El.litPropertyMetadata=new WeakMap);class tl extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??(this.l=[])).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=uv){if(e.state&&(e.attribute=!1),this._$Ei(),this.elementProperties.set(t,e),!e.noAccessor){const i=Symbol(),n=this.getPropertyDescriptor(t,i,e);n!==void 0&&e4(this.prototype,t,n)}}static getPropertyDescriptor(t,e,i){const{get:n,set:r}=s4(this.prototype,t)??{get(){return this[e]},set(o){this[e]=o}};return{get(){return n==null?void 0:n.call(this)},set(o){const a=n==null?void 0:n.call(this);r.call(this,o),this.requestUpdate(t,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??uv}static _$Ei(){if(this.hasOwnProperty(dc("elementProperties")))return;const t=r4(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(dc("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(dc("properties"))){const e=this.properties,i=[...i4(e),...n4(e)];for(const n of i)this.createProperty(n,e[n])}const t=this[Symbol.metadata];if(t!==null){const e=litPropertyMetadata.get(t);if(e!==void 0)for(const[i,n]of e)this.elementProperties.set(i,n)}this._$Eh=new Map;for(const[e,i]of this.elementProperties){const n=this._$Eu(e,i);n!==void 0&&this._$Eh.set(n,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const n of i)e.unshift(lv(n))}else t!==void 0&&e.push(lv(t));return e}static _$Eu(t,e){const i=e.attribute;return i===!1?void 0:typeof i=="string"?i:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var t;this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),(t=this.constructor.l)==null||t.forEach(e=>e(this))}addController(t){var e;(this._$EO??(this._$EO=new Set)).add(t),this.renderRoot!==void 0&&this.isConnected&&((e=t.hostConnected)==null||e.call(t))}removeController(t){var e;(e=this._$EO)==null||e.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const i of e.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return JM(t,this.constructor.elementStyles),t}connectedCallback(){var t;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$EO)==null||t.forEach(e=>{var i;return(i=e.hostConnected)==null?void 0:i.call(e)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$EO)==null||t.forEach(e=>{var i;return(i=e.hostDisconnected)==null?void 0:i.call(e)})}attributeChangedCallback(t,e,i){this._$AK(t,i)}_$EC(t,e){var i;const n=this.constructor.elementProperties.get(t),r=this.constructor._$Eu(t,n);if(r!==void 0&&n.reflect===!0){const o=(((i=n.converter)==null?void 0:i.toAttribute)!==void 0?n.converter:mp).toAttribute(e,n.type);this._$Em=t,o==null?this.removeAttribute(r):this.setAttribute(r,o),this._$Em=null}}_$AK(t,e){var i;const n=this.constructor,r=n._$Eh.get(t);if(r!==void 0&&this._$Em!==r){const o=n.getPropertyOptions(r),a=typeof o.converter=="function"?{fromAttribute:o.converter}:((i=o.converter)==null?void 0:i.fromAttribute)!==void 0?o.converter:mp;this._$Em=r,this[r]=a.fromAttribute(e,o.type),this._$Em=null}}requestUpdate(t,e,i){if(t!==void 0){if(i??(i=this.constructor.getPropertyOptions(t)),!(i.hasChanged??ob)(this[t],e))return;this.P(t,e,i)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(t,e,i){this._$AL.has(t)||this._$AL.set(t,e),i.reflect===!0&&this._$Em!==t&&(this._$Ej??(this._$Ej=new Set)).add(t)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[r,o]of this._$Ep)this[r]=o;this._$Ep=void 0}const n=this.constructor.elementProperties;if(n.size>0)for(const[r,o]of n)o.wrapped!==!0||this._$AL.has(r)||this[r]===void 0||this.P(r,this[r],o)}let e=!1;const i=this._$AL;try{e=this.shouldUpdate(i),e?(this.willUpdate(i),(t=this._$EO)==null||t.forEach(n=>{var r;return(r=n.hostUpdate)==null?void 0:r.call(n)}),this.update(i)):this._$EU()}catch(n){throw e=!1,this._$EU(),n}e&&this._$AE(i)}willUpdate(t){}_$AE(t){var e;(e=this._$EO)==null||e.forEach(i=>{var n;return(n=i.hostUpdated)==null?void 0:n.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Ej&&(this._$Ej=this._$Ej.forEach(e=>this._$EC(e,this[e]))),this._$EU()}updated(t){}firstUpdated(t){}}tl.elementStyles=[],tl.shadowRootOptions={mode:"open"},tl[dc("elementProperties")]=new Map,tl[dc("finalized")]=new Map,cv==null||cv({ReactiveElement:tl}),(El.reactiveElementVersions??(El.reactiveElementVersions=[])).push("2.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const gp=globalThis,_p=gp.trustedTypes,dv=_p?_p.createPolicy("lit-html",{createHTML:s=>s}):void 0,xC="$lit$",Br=`lit$${Math.random().toFixed(9).slice(2)}$`,TC="?"+Br,a4=`<${TC}>`,sa=document,Pc=()=>sa.createComment(""),Fc=s=>s===null||typeof s!="object"&&typeof s!="function",ab=Array.isArray,l4=s=>ab(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",km=`[ 	
\f\r]`,xh=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,pv=/-->/g,fv=/>/g,wo=RegExp(`>|${km}(?:([^\\s"'>=/]+)(${km}*=${km}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),mv=/'/g,gv=/"/g,AC=/^(?:script|style|textarea|title)$/i,h4=s=>(t,...e)=>({_$litType$:s,strings:t,values:e}),lb=h4(1),Cl=Symbol.for("lit-noChange"),He=Symbol.for("lit-nothing"),_v=new WeakMap,Bo=sa.createTreeWalker(sa,129);function SC(s,t){if(!ab(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return dv!==void 0?dv.createHTML(t):t}const c4=(s,t)=>{const e=s.length-1,i=[];let n,r=t===2?"<svg>":t===3?"<math>":"",o=xh;for(let a=0;a<e;a++){const l=s[a];let h,c,u=-1,p=0;for(;p<l.length&&(o.lastIndex=p,c=o.exec(l),c!==null);)p=o.lastIndex,o===xh?c[1]==="!--"?o=pv:c[1]!==void 0?o=fv:c[2]!==void 0?(AC.test(c[2])&&(n=RegExp("</"+c[2],"g")),o=wo):c[3]!==void 0&&(o=wo):o===wo?c[0]===">"?(o=n??xh,u=-1):c[1]===void 0?u=-2:(u=o.lastIndex-c[2].length,h=c[1],o=c[3]===void 0?wo:c[3]==='"'?gv:mv):o===gv||o===mv?o=wo:o===pv||o===fv?o=xh:(o=wo,n=void 0);const d=o===wo&&s[a+1].startsWith("/>")?" ":"";r+=o===xh?l+a4:u>=0?(i.push(h),l.slice(0,u)+xC+l.slice(u)+Br+d):l+Br+(u===-2?a:d)}return[SC(s,r+(s[e]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),i]};let o_=class OC{constructor({strings:t,_$litType$:e},i){let n;this.parts=[];let r=0,o=0;const a=t.length-1,l=this.parts,[h,c]=c4(t,e);if(this.el=OC.createElement(h,i),Bo.currentNode=this.el.content,e===2||e===3){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;(n=Bo.nextNode())!==null&&l.length<a;){if(n.nodeType===1){if(n.hasAttributes())for(const u of n.getAttributeNames())if(u.endsWith(xC)){const p=c[o++],d=n.getAttribute(u).split(Br),_=/([.?@])?(.*)/.exec(p);l.push({type:1,index:r,name:_[2],strings:d,ctor:_[1]==="."?d4:_[1]==="?"?p4:_[1]==="@"?f4:sf}),n.removeAttribute(u)}else u.startsWith(Br)&&(l.push({type:6,index:r}),n.removeAttribute(u));if(AC.test(n.tagName)){const u=n.textContent.split(Br),p=u.length-1;if(p>0){n.textContent=_p?_p.emptyScript:"";for(let d=0;d<p;d++)n.append(u[d],Pc()),Bo.nextNode(),l.push({type:2,index:++r});n.append(u[p],Pc())}}}else if(n.nodeType===8)if(n.data===TC)l.push({type:2,index:r});else{let u=-1;for(;(u=n.data.indexOf(Br,u+1))!==-1;)l.push({type:7,index:r}),u+=Br.length-1}r++}}static createElement(t,e){const i=sa.createElement("template");return i.innerHTML=t,i}};function Il(s,t,e=s,i){var n,r;if(t===Cl)return t;let o=i!==void 0?(n=e._$Co)==null?void 0:n[i]:e._$Cl;const a=Fc(t)?void 0:t._$litDirective$;return(o==null?void 0:o.constructor)!==a&&((r=o==null?void 0:o._$AO)==null||r.call(o,!1),a===void 0?o=void 0:(o=new a(s),o._$AT(s,e,i)),i!==void 0?(e._$Co??(e._$Co=[]))[i]=o:e._$Cl=o),o!==void 0&&(t=Il(s,o._$AS(s,t.values),o,i)),t}let u4=class{constructor(s,t){this._$AV=[],this._$AN=void 0,this._$AD=s,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(s){const{el:{content:t},parts:e}=this._$AD,i=((s==null?void 0:s.creationScope)??sa).importNode(t,!0);Bo.currentNode=i;let n=Bo.nextNode(),r=0,o=0,a=e[0];for(;a!==void 0;){if(r===a.index){let l;a.type===2?l=new qc(n,n.nextSibling,this,s):a.type===1?l=new a.ctor(n,a.name,a.strings,this,s):a.type===6&&(l=new m4(n,this,s)),this._$AV.push(l),a=e[++o]}r!==(a==null?void 0:a.index)&&(n=Bo.nextNode(),r++)}return Bo.currentNode=sa,i}p(s){let t=0;for(const e of this._$AV)e!==void 0&&(e.strings!==void 0?(e._$AI(s,e,t),t+=e.strings.length-2):e._$AI(s[t])),t++}};class qc{get _$AU(){var t;return((t=this._$AM)==null?void 0:t._$AU)??this._$Cv}constructor(t,e,i,n){this.type=2,this._$AH=He,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=n,this._$Cv=(n==null?void 0:n.isConnected)??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=Il(this,t,e),Fc(t)?t===He||t==null||t===""?(this._$AH!==He&&this._$AR(),this._$AH=He):t!==this._$AH&&t!==Cl&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):l4(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==He&&Fc(this._$AH)?this._$AA.nextSibling.data=t:this.T(sa.createTextNode(t)),this._$AH=t}$(t){var e;const{values:i,_$litType$:n}=t,r=typeof n=="number"?this._$AC(t):(n.el===void 0&&(n.el=o_.createElement(SC(n.h,n.h[0]),this.options)),n);if(((e=this._$AH)==null?void 0:e._$AD)===r)this._$AH.p(i);else{const o=new u4(r,this),a=o.u(this.options);o.p(i),this.T(a),this._$AH=o}}_$AC(t){let e=_v.get(t.strings);return e===void 0&&_v.set(t.strings,e=new o_(t)),e}k(t){ab(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,n=0;for(const r of t)n===e.length?e.push(i=new qc(this.O(Pc()),this.O(Pc()),this,this.options)):i=e[n],i._$AI(r),n++;n<e.length&&(this._$AR(i&&i._$AB.nextSibling,n),e.length=n)}_$AR(t=this._$AA.nextSibling,e){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,e);t&&t!==this._$AB;){const n=t.nextSibling;t.remove(),t=n}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}}class sf{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,i,n,r){this.type=1,this._$AH=He,this._$AN=void 0,this.element=t,this.name=e,this._$AM=n,this.options=r,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=He}_$AI(t,e=this,i,n){const r=this.strings;let o=!1;if(r===void 0)t=Il(this,t,e,0),o=!Fc(t)||t!==this._$AH&&t!==Cl,o&&(this._$AH=t);else{const a=t;let l,h;for(t=r[0],l=0;l<r.length-1;l++)h=Il(this,a[i+l],e,l),h===Cl&&(h=this._$AH[l]),o||(o=!Fc(h)||h!==this._$AH[l]),h===He?t=He:t!==He&&(t+=(h??"")+r[l+1]),this._$AH[l]=h}o&&!n&&this.j(t)}j(t){t===He?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}let d4=class extends sf{constructor(){super(...arguments),this.type=3}j(s){this.element[this.name]=s===He?void 0:s}},p4=class extends sf{constructor(){super(...arguments),this.type=4}j(s){this.element.toggleAttribute(this.name,!!s&&s!==He)}},f4=class extends sf{constructor(s,t,e,i,n){super(s,t,e,i,n),this.type=5}_$AI(s,t=this){if((s=Il(this,s,t,0)??He)===Cl)return;const e=this._$AH,i=s===He&&e!==He||s.capture!==e.capture||s.once!==e.once||s.passive!==e.passive,n=s!==He&&(e===He||i);i&&this.element.removeEventListener(this.name,this,e),n&&this.element.addEventListener(this.name,this,s),this._$AH=s}handleEvent(s){var t;typeof this._$AH=="function"?this._$AH.call(((t=this.options)==null?void 0:t.host)??this.element,s):this._$AH.handleEvent(s)}},m4=class{constructor(s,t,e){this.element=s,this.type=6,this._$AN=void 0,this._$AM=t,this.options=e}get _$AU(){return this._$AM._$AU}_$AI(s){Il(this,s)}};const bv=gp.litHtmlPolyfillSupport;bv==null||bv(o_,qc),(gp.litHtmlVersions??(gp.litHtmlVersions=[])).push("3.2.1");const g4=(s,t,e)=>{const i=(e==null?void 0:e.renderBefore)??t;let n=i._$litPart$;if(n===void 0){const r=(e==null?void 0:e.renderBefore)??null;i._$litPart$=n=new qc(t.insertBefore(Pc(),r),r,void 0,e??{})}return n._$AI(s),n};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let Go=class extends tl{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var s;const t=super.createRenderRoot();return(s=this.renderOptions).renderBefore??(s.renderBefore=t.firstChild),t}update(s){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(s),this._$Do=g4(t,this.renderRoot,this.renderOptions)}connectedCallback(){var s;super.connectedCallback(),(s=this._$Do)==null||s.setConnected(!0)}disconnectedCallback(){var s;super.disconnectedCallback(),(s=this._$Do)==null||s.setConnected(!1)}render(){return Cl}};var yv;Go._$litElement$=!0,Go.finalized=!0,(yv=globalThis.litElementHydrateSupport)==null||yv.call(globalThis,{LitElement:Go});const vv=globalThis.litElementPolyfillSupport;vv==null||vv({LitElement:Go});(globalThis.litElementVersions??(globalThis.litElementVersions=[])).push("4.1.1");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const _4={attribute:!0,type:String,converter:mp,reflect:!1,hasChanged:ob},b4=(s=_4,t,e)=>{const{kind:i,metadata:n}=e;let r=globalThis.litPropertyMetadata.get(n);if(r===void 0&&globalThis.litPropertyMetadata.set(n,r=new Map),r.set(e.name,s),i==="accessor"){const{name:o}=e;return{set(a){const l=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,l,s)},init(a){return a!==void 0&&this.P(o,void 0,s),a}}}if(i==="setter"){const{name:o}=e;return function(a){const l=this[o];t.call(this,a),this.requestUpdate(o,l,s)}}throw Error("Unsupported decorator location: "+i)};function ei(s){return(t,e)=>typeof e=="object"?b4(s,t,e):((i,n,r)=>{const o=n.hasOwnProperty(r);return n.constructor.createProperty(r,o?{...i,wrapped:!0}:i),o?Object.getOwnPropertyDescriptor(n,r):void 0})(s,t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function y4(s){return ei({...s,state:!0,attribute:!1})}class v4 extends yi{constructor(t=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Bt(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&e.element.parentNode!==null&&e.element.remove()})})}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this.center=t.center,this}}new F;new vt;new vt;new F;new F;class w4{constructor(t,e){this._group=new on,this._frustum=new cr,this._frustumMat=new vt,this._regenerateDelay=200,this._regenerateCounter=0,this.material=new Mp({color:"#2e3338"}),this.numbers=new on,this.maxRegenerateRetrys=4,this.gridsFactor=5,this._scaleX=1,this._scaleY=1,this._offsetX=0,this._offsetY=0,this._camera=t,this._container=e;const i=this.newGrid(-1),n=this.newGrid(-2);this.grids={main:i,secondary:n},this._group.add(n,i,this.numbers)}set scaleX(t){this._scaleX=t,this.regenerate()}get scaleX(){return this._scaleX}set scaleY(t){this._scaleY=t,this.regenerate()}get scaleY(){return this._scaleY}set offsetX(t){this._offsetX=t,this.regenerate()}get offsetX(){return this._offsetX}set offsetY(t){this._offsetY=t,this.regenerate()}get offsetY(){return this._offsetY}get(){return this._group}dispose(){const{main:t,secondary:e}=this.grids;t.removeFromParent(),e.removeFromParent(),t.geometry.dispose(),t.material.dispose(),e.geometry.dispose(),e.material.dispose()}regenerate(){if(!this.isGridReady()){if(this._regenerateCounter++,this._regenerateCounter>this.maxRegenerateRetrys)throw new Error("Grid could not be regenerated");setTimeout(()=>this.regenerate,this._regenerateDelay);return}this._regenerateCounter=0,this._camera.updateMatrix(),this._camera.updateMatrixWorld();const t=this._frustumMat.multiplyMatrices(this._camera.projectionMatrix,this._camera.matrixWorldInverse);this._frustum.setFromProjectionMatrix(t);const{planes:e}=this._frustum,i=e[0].constant*-e[0].normal.x,n=e[1].constant*-e[1].normal.x,r=e[2].constant*-e[2].normal.y,o=e[3].constant*-e[3].normal.y,a=Math.abs(i-n),l=Math.abs(o-r),{clientWidth:h,clientHeight:c}=this._container,u=Math.max(h,c),p=Math.max(a,l)/u,d=Math.ceil(Math.log10(a/this.scaleX)),_=Math.ceil(Math.log10(l/this.scaleY)),m=10**(d-2)*this.scaleX,g=10**(_-2)*this.scaleY,f=m*this.gridsFactor,b=g*this.gridsFactor,y=Math.ceil(l/b),E=Math.ceil(a/f),C=Math.ceil(l/g),I=Math.ceil(a/m),x=m*Math.ceil(n/m),A=g*Math.ceil(r/g),O=f*Math.ceil(n/f),L=b*Math.ceil(r/b),V=[...this.numbers.children];for(const dt of V)dt.removeFromParent();this.numbers.children=[];const T=[],N=9*p,v=1e4,M=O+this._offsetX,Q=Math.round(Math.abs(M/this.scaleX)*v)/v,j=(E-1)*f,it=Math.round(Math.abs((M+j)/this.scaleX)*v)/v,G=Math.max(Q,it).toString().length*N;let nt=Math.ceil(G/f)*f;for(let dt=0;dt<E;dt++){let wt=O+dt*f;T.push(wt,o,0,wt,r,0),wt=Math.round(wt*v)/v,nt=Math.round(nt*v)/v;const pt=wt%nt;if(!(f<1||b<1)&&Math.abs(pt)>.01)continue;const _t=this.newNumber((wt+this._offsetX)/this.scaleX),yt=12*p;_t.position.set(wt,r+yt,0)}for(let dt=0;dt<y;dt++){const wt=L+dt*b;T.push(n,wt,0,i,wt,0);const pt=this.newNumber(wt/this.scaleY);let _t=12;pt.element.textContent&&(_t+=4*pt.element.textContent.length);const yt=_t*p;pt.position.set(n+yt,wt,0)}const $=[];for(let dt=0;dt<I;dt++){const wt=x+dt*m;$.push(wt,o,0,wt,r,0)}for(let dt=0;dt<C;dt++){const wt=A+dt*g;$.push(n,wt,0,i,wt,0)}const B=new Ve(new Float32Array(T),3),at=new Ve(new Float32Array($),3),{main:J,secondary:st}=this.grids;J.geometry.setAttribute("position",B),st.geometry.setAttribute("position",at)}newNumber(t){const e=document.createElement("bim-label");e.textContent=String(Math.round(t*100)/100);const i=new v4(e);return this.numbers.add(i),i}newGrid(t){const e=new ye,i=new Lp(e,this.material);return i.frustumCulled=!1,i.renderOrder=t,i}isGridReady(){const t=this._camera.projectionMatrix.elements;for(let e=0;e<t.length;e++){const i=t[e];if(Number.isNaN(i))return!1}return!0}}var E4=Object.defineProperty,C4=Object.getOwnPropertyDescriptor,Zc=(s,t,e,i)=>{for(var n=C4(t,e),r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&E4(t,e,n),n};const PC=class extends Go{constructor(){super(...arguments),this._grid=null,this._world=null,this.resize=()=>{this._world&&this._grid&&this._grid.regenerate()}}set gridColor(t){if(this._gridColor=t,!(t&&this._grid))return;const e=Number(t.replace("#","0x"));Number.isNaN(e)||this._grid.material.color.setHex(e)}get gridColor(){return this._gridColor}set gridScaleX(t){this._gridScaleX=t,t&&this._grid&&(this._grid.scaleX=t)}get gridScaleX(){return this._gridScaleX}set gridScaleY(t){this._gridScaleY=t,t&&this._grid&&(this._grid.scaleY=t)}get gridScaleY(){return this._gridScaleY}get gridOffsetX(){var t;return((t=this._grid)==null?void 0:t.offsetX)||0}set gridOffsetX(t){this._grid&&(this._grid.offsetX=t)}get gridOffsetY(){var t;return((t=this._grid)==null?void 0:t.offsetY)||0}set gridOffsetY(t){this._grid&&(this._grid.offsetY=t)}set components(t){this.dispose();const e=t.get(Gc).create();this._world=e,e.scene=new Z1(t),e.scene.setup(),e.renderer=new OM(t,this);const i=new qp(t);e.camera=i;const n=new w4(i.threeOrtho,this);this._grid=n,e.scene.three.add(n.get()),i.controls.addEventListener("update",()=>n.regenerate()),setTimeout(async()=>{e.camera.updateAspect(),i.set("Plan"),await i.controls.setLookAt(0,0,100,0,0,0),await i.projection.set("Orthographic"),i.controls.dollySpeed=3,i.controls.draggingSmoothTime=.085,i.controls.maxZoom=1e3,i.controls.zoom(4)})}get world(){return this._world}dispose(){var t;(t=this.world)==null||t.dispose(),this._world=null,this._grid=null}connectedCallback(){super.connectedCallback(),new ResizeObserver(this.resize).observe(this)}disconnectedCallback(){super.disconnectedCallback(),this.dispose()}render(){return lb`<slot></slot>`}};PC.styles=rb`
    :host {
      position: relative;
      display: flex;
      min-width: 0px;
      height: 100%;
      background-color: var(--bim-ui_bg-base);
    }
  `;let zl=PC;Zc([ei({type:String,attribute:"grid-color",reflect:!0})],zl.prototype,"gridColor");Zc([ei({type:Number,attribute:"grid-scale-x",reflect:!0})],zl.prototype,"gridScaleX");Zc([ei({type:Number,attribute:"grid-scale-y",reflect:!0})],zl.prototype,"gridScaleY");Zc([ei({type:Number,attribute:"grid-offset-x",reflect:!0})],zl.prototype,"gridOffsetX");Zc([ei({type:Number,attribute:"grid-offset-y",reflect:!0})],zl.prototype,"gridOffsetY");var I4=Object.defineProperty,ho=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&I4(t,e,n),n};const FC=class extends Go{constructor(){super(...arguments),this._defaults={size:60},this._cssMatrix3D="",this._matrix=new vt,this._onRightClick=new Event("rightclick"),this._onLeftClick=new Event("leftclick"),this._onTopClick=new Event("topclick"),this._onBottomClick=new Event("bottomclick"),this._onFrontClick=new Event("frontclick"),this._onBackClick=new Event("backclick"),this._camera=null,this._epsilon=t=>Math.abs(t)<1e-10?0:t}set camera(t){this._camera=t,this.updateOrientation()}get camera(){return this._camera}updateOrientation(){if(!this.camera)return;this._matrix.extractRotation(this.camera.matrixWorldInverse);const{elements:t}=this._matrix;this._cssMatrix3D=`matrix3d(
      ${this._epsilon(t[0])},
      ${this._epsilon(-t[1])},
      ${this._epsilon(t[2])},
      ${this._epsilon(t[3])},
      ${this._epsilon(t[4])},
      ${this._epsilon(-t[5])},
      ${this._epsilon(t[6])},
      ${this._epsilon(t[7])},
      ${this._epsilon(t[8])},
      ${this._epsilon(-t[9])},
      ${this._epsilon(t[10])},
      ${this._epsilon(t[11])},
      ${this._epsilon(t[12])},
      ${this._epsilon(-t[13])},
      ${this._epsilon(t[14])},
      ${this._epsilon(t[15])})
    `}render(){const t=this.size??this._defaults.size;return lb`
      <style>
        .face,
        .cube {
          width: ${t}px;
          height: ${t}px;
          transform: translateZ(-300px) ${this._cssMatrix3D};
        }

        .face-right {
          translate: ${t/2}px 0 0;
        }

        .face-left {
          translate: ${-t/2}px 0 0;
        }

        .face-top {
          translate: 0 ${t/2}px 0;
        }

        .face-bottom {
          translate: 0 ${-t/2}px 0;
        }

        .face-front {
          translate: 0 0 ${t/2}px;
        }

        .face-back {
          translate: 0 0 ${-t/2}px;
        }
      </style>
      <div class="parent">
        <div class="cube">
          <div
            class="face x-direction face-right"
            @click=${()=>this.dispatchEvent(this._onRightClick)}
          >
            ${this.rightText}
          </div>
          <div
            class="face x-direction face-left"
            @click=${()=>this.dispatchEvent(this._onLeftClick)}
          >
            ${this.leftText}
          </div>
          <div
            class="face y-direction face-top"
            @click=${()=>this.dispatchEvent(this._onTopClick)}
          >
            ${this.topText}
          </div>
          <div
            class="face y-direction face-bottom"
            @click=${()=>this.dispatchEvent(this._onBottomClick)}
          >
            ${this.bottomText}
          </div>
          <div
            class="face z-direction face-front"
            @click=${()=>this.dispatchEvent(this._onFrontClick)}
          >
            ${this.frontText}
          </div>
          <div
            class="face z-direction face-back"
            @click=${()=>this.dispatchEvent(this._onBackClick)}
          >
            ${this.backText}
          </div>
        </div>
      </div>
    `}};FC.styles=rb`
    :host {
      position: absolute;
      z-index: 999;
      bottom: 1rem;
      right: 1rem;
    }

    .parent {
      perspective: 400px;
    }

    .cube {
      position: relative;
      transform-style: preserve-3d;
    }

    .face {
      position: absolute;
      display: flex;
      justify-content: center;
      user-select: none;
      align-items: center;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
      color: var(--bim-view-cube--c, white);
      font-size: var(--bim-view-cube--fz, --bim-ui_size-2xl);
    }

    .x-direction {
      // background-color: var(--bim-view-cube_x--bgc, #c93830DD);
      background-color: var(--bim-view-cube_x--bgc, #01a6bcde);
    }

    .x-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .y-direction {
      // background-color: var(--bim-view-cube_y--bgc, #54ff19DD);
      background-color: var(--bim-view-cube_y--bgc, #8d0ec8de);
    }

    .y-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .z-direction {
      // background-color: var(--bim-view-cube_z--bgc, #3041c9DD);
      background-color: var(--bim-view-cube_z--bgc, #2718afde);
    }

    .z-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .face-front {
      transform: rotateX(180deg);
    }

    .face-back {
      transform: rotateZ(180deg);
    }

    .face-top {
      transform: rotateX(90deg);
    }

    .face-bottom {
      transform: rotateX(270deg);
    }

    .face-right {
      transform: rotateY(-270deg) rotateX(180deg);
    }

    .face-left {
      transform: rotateY(-90deg) rotateX(180deg);
    }
  `;let yr=FC;ho([ei({type:Number,reflect:!0})],yr.prototype,"size");ho([ei({type:String,attribute:"right-text",reflect:!0})],yr.prototype,"rightText");ho([ei({type:String,attribute:"left-text",reflect:!0})],yr.prototype,"leftText");ho([ei({type:String,attribute:"top-text",reflect:!0})],yr.prototype,"topText");ho([ei({type:String,attribute:"bottom-text",reflect:!0})],yr.prototype,"bottomText");ho([ei({type:String,attribute:"front-text",reflect:!0})],yr.prototype,"frontText");ho([ei({type:String,attribute:"back-text",reflect:!0})],yr.prototype,"backText");ho([y4()],yr.prototype,"_cssMatrix3D");/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const x4=s=>s.strings===void 0;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const T4={CHILD:2},A4=s=>(...t)=>({_$litDirective$:s,values:t});class S4{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,i){this._$Ct=t,this._$AM=e,this._$Ci=i}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const pc=(s,t)=>{var e;const i=s._$AN;if(i===void 0)return!1;for(const n of i)(e=n._$AO)==null||e.call(n,t,!1),pc(n,t);return!0},bp=s=>{let t,e;do{if((t=s._$AM)===void 0)break;e=t._$AN,e.delete(s),s=t}while((e==null?void 0:e.size)===0)},RC=s=>{for(let t;t=s._$AM;s=t){let e=t._$AN;if(e===void 0)t._$AN=e=new Set;else if(e.has(s))break;e.add(s),F4(t)}};function O4(s){this._$AN!==void 0?(bp(this),this._$AM=s,RC(this)):this._$AM=s}function P4(s,t=!1,e=0){const i=this._$AH,n=this._$AN;if(n!==void 0&&n.size!==0)if(t)if(Array.isArray(i))for(let r=e;r<i.length;r++)pc(i[r],!1),bp(i[r]);else i!=null&&(pc(i,!1),bp(i));else pc(this,s)}const F4=s=>{s.type==T4.CHILD&&(s._$AP??(s._$AP=P4),s._$AQ??(s._$AQ=O4))};class R4 extends S4{constructor(){super(...arguments),this._$AN=void 0}_$AT(t,e,i){super._$AT(t,e,i),RC(this),this.isConnected=t._$AU}_$AO(t,e=!0){var i,n;t!==this.isConnected&&(this.isConnected=t,t?(i=this.reconnected)==null||i.call(this):(n=this.disconnected)==null||n.call(this)),e&&(pc(this,t),bp(this))}setValue(t){if(x4(this._$Ct))this._$Ct._$AI(t,this);else{const e=[...this._$Ct._$AH];e[this._$Ci]=t,this._$Ct._$AI(e,this,0)}}disconnected(){}reconnected(){}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const a_=()=>new L4;class L4{}const zm=new WeakMap,N4=A4(class extends R4{render(s){return He}update(s,[t]){var e;const i=t!==this.Y;return i&&this.Y!==void 0&&this.rt(void 0),(i||this.lt!==this.ct)&&(this.Y=t,this.ht=(e=s.options)==null?void 0:e.host,this.rt(this.ct=s.element)),He}rt(s){if(this.isConnected||(s=void 0),typeof this.Y=="function"){const t=this.ht??globalThis;let e=zm.get(t);e===void 0&&(e=new WeakMap,zm.set(t,e)),e.get(this.Y)!==void 0&&this.Y.call(this.ht,void 0),e.set(this.Y,s),s!==void 0&&this.Y.call(this.ht,s)}else this.Y.value=s}get lt(){var s,t;return typeof this.Y=="function"?(s=zm.get(this.ht??globalThis))==null?void 0:s.get(this.Y):(t=this.Y)==null?void 0:t.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});var M4=Object.defineProperty,D4=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&M4(t,e,n),n};const LC=class extends Go{constructor(){super(...arguments),this.world=null,this._components=null,this._viewport=a_()}set components(t){var e;if(this._components=t,this.components){const i=this.components.get(Gc);this.world=i.create(),this.world.name=this.name}else(e=this.world)==null||e.dispose(),this.world=null}get components(){return this._components}connectedCallback(){super.connectedCallback(),this.world&&(this.world.enabled=!0)}disconnectedCallback(){super.disconnectedCallback(),this.world&&(this.world.enabled=!1)}dispose(){this.components=null,this.remove()}firstUpdated(){const{value:t}=this._viewport;if(!(this.components&&t&&this.world))return;const e=new Z1(this.components);this.world.scene=e,e.setup(),e.three.background=null;const i=new TF(this.components,t);this.world.renderer=i;const n=new qp(this.components);this.world.camera=n;const r=this.components.get(RF).create(this.world);r.material.uniforms.uColor.value=new xt(4342338),r.material.uniforms.uSize1.value=2,r.material.uniforms.uSize2.value=8}onSlotChange(){const t=new Event("slotchange");this.dispatchEvent(t)}render(){return lb` <bim-viewport ${N4(this._viewport)}>
      <slot @slotchange=${this.onSlotChange}></slot>
    </bim-viewport>`}};LC.styles=rb``;let NC=LC;D4([ei({type:String,reflect:!0})],NC.prototype,"name");var k4=Object.defineProperty,z4=(s,t,e)=>t in s?k4(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,Eo=(s,t,e)=>(z4(s,typeof t!="symbol"?t+"":t,e),e);const xl=Math.min,lr=Math.max,yp=Math.round,no=s=>({x:s,y:s}),U4={left:"right",right:"left",bottom:"top",top:"bottom"},B4={start:"end",end:"start"};function wv(s,t,e){return lr(s,xl(t,e))}function Xc(s,t){return typeof s=="function"?s(t):s}function fr(s){return s.split("-")[0]}function nf(s){return s.split("-")[1]}function MC(s){return s==="x"?"y":"x"}function DC(s){return s==="y"?"height":"width"}function ia(s){return["top","bottom"].includes(fr(s))?"y":"x"}function kC(s){return MC(ia(s))}function V4(s,t,e){e===void 0&&(e=!1);const i=nf(s),n=kC(s),r=DC(n);let o=n==="x"?i===(e?"end":"start")?"right":"left":i==="start"?"bottom":"top";return t.reference[r]>t.floating[r]&&(o=vp(o)),[o,vp(o)]}function $4(s){const t=vp(s);return[l_(s),t,l_(t)]}function l_(s){return s.replace(/start|end/g,t=>B4[t])}function H4(s,t,e){const i=["left","right"],n=["right","left"],r=["top","bottom"],o=["bottom","top"];switch(s){case"top":case"bottom":return e?t?n:i:t?i:n;case"left":case"right":return t?r:o;default:return[]}}function j4(s,t,e,i){const n=nf(s);let r=H4(fr(s),e==="start",i);return n&&(r=r.map(o=>o+"-"+n),t&&(r=r.concat(r.map(l_)))),r}function vp(s){return s.replace(/left|right|bottom|top/g,t=>U4[t])}function Y4(s){return{top:0,right:0,bottom:0,left:0,...s}}function zC(s){return typeof s!="number"?Y4(s):{top:s,right:s,bottom:s,left:s}}function Tl(s){const{x:t,y:e,width:i,height:n}=s;return{width:i,height:n,top:e,left:t,right:t+i,bottom:e+n,x:t,y:e}}function Ev(s,t,e){let{reference:i,floating:n}=s;const r=ia(t),o=kC(t),a=DC(o),l=fr(t),h=r==="y",c=i.x+i.width/2-n.width/2,u=i.y+i.height/2-n.height/2,p=i[a]/2-n[a]/2;let d;switch(l){case"top":d={x:c,y:i.y-n.height};break;case"bottom":d={x:c,y:i.y+i.height};break;case"right":d={x:i.x+i.width,y:u};break;case"left":d={x:i.x-n.width,y:u};break;default:d={x:i.x,y:i.y}}switch(nf(t)){case"start":d[o]-=p*(e&&h?-1:1);break;case"end":d[o]+=p*(e&&h?-1:1);break}return d}const W4=async(s,t,e)=>{const{placement:i="bottom",strategy:n="absolute",middleware:r=[],platform:o}=e,a=r.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(t));let h=await o.getElementRects({reference:s,floating:t,strategy:n}),{x:c,y:u}=Ev(h,i,l),p=i,d={},_=0;for(let m=0;m<a.length;m++){const{name:g,fn:f}=a[m],{x:b,y,data:E,reset:C}=await f({x:c,y:u,initialPlacement:i,placement:p,strategy:n,middlewareData:d,rects:h,platform:o,elements:{reference:s,floating:t}});c=b??c,u=y??u,d={...d,[g]:{...d[g],...E}},C&&_<=50&&(_++,typeof C=="object"&&(C.placement&&(p=C.placement),C.rects&&(h=C.rects===!0?await o.getElementRects({reference:s,floating:t,strategy:n}):C.rects),{x:c,y:u}=Ev(h,p,l)),m=-1)}return{x:c,y:u,placement:p,strategy:n,middlewareData:d}};async function UC(s,t){var e;t===void 0&&(t={});const{x:i,y:n,platform:r,rects:o,elements:a,strategy:l}=s,{boundary:h="clippingAncestors",rootBoundary:c="viewport",elementContext:u="floating",altBoundary:p=!1,padding:d=0}=Xc(t,s),_=zC(d),m=a[p?u==="floating"?"reference":"floating":u],g=Tl(await r.getClippingRect({element:(e=await(r.isElement==null?void 0:r.isElement(m)))==null||e?m:m.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(a.floating)),boundary:h,rootBoundary:c,strategy:l})),f=u==="floating"?{x:i,y:n,width:o.floating.width,height:o.floating.height}:o.reference,b=await(r.getOffsetParent==null?void 0:r.getOffsetParent(a.floating)),y=await(r.isElement==null?void 0:r.isElement(b))?await(r.getScale==null?void 0:r.getScale(b))||{x:1,y:1}:{x:1,y:1},E=Tl(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:f,offsetParent:b,strategy:l}):f);return{top:(g.top-E.top+_.top)/y.y,bottom:(E.bottom-g.bottom+_.bottom)/y.y,left:(g.left-E.left+_.left)/y.x,right:(E.right-g.right+_.right)/y.x}}const G4=function(s){return s===void 0&&(s={}),{name:"flip",options:s,async fn(t){var e,i;const{placement:n,middlewareData:r,rects:o,initialPlacement:a,platform:l,elements:h}=t,{mainAxis:c=!0,crossAxis:u=!0,fallbackPlacements:p,fallbackStrategy:d="bestFit",fallbackAxisSideDirection:_="none",flipAlignment:m=!0,...g}=Xc(s,t);if((e=r.arrow)!=null&&e.alignmentOffset)return{};const f=fr(n),b=ia(a),y=fr(a)===a,E=await(l.isRTL==null?void 0:l.isRTL(h.floating)),C=p||(y||!m?[vp(a)]:$4(a)),I=_!=="none";!p&&I&&C.push(...j4(a,m,_,E));const x=[a,...C],A=await UC(t,g),O=[];let L=((i=r.flip)==null?void 0:i.overflows)||[];if(c&&O.push(A[f]),u){const v=V4(n,o,E);O.push(A[v[0]],A[v[1]])}if(L=[...L,{placement:n,overflows:O}],!O.every(v=>v<=0)){var V,T;const v=(((V=r.flip)==null?void 0:V.index)||0)+1,M=x[v];if(M)return{data:{index:v,overflows:L},reset:{placement:M}};let Q=(T=L.filter(j=>j.overflows[0]<=0).sort((j,it)=>j.overflows[1]-it.overflows[1])[0])==null?void 0:T.placement;if(!Q)switch(d){case"bestFit":{var N;const j=(N=L.filter(it=>{if(I){const G=ia(it.placement);return G===b||G==="y"}return!0}).map(it=>[it.placement,it.overflows.filter(G=>G>0).reduce((G,nt)=>G+nt,0)]).sort((it,G)=>it[1]-G[1])[0])==null?void 0:N[0];j&&(Q=j);break}case"initialPlacement":Q=a;break}if(n!==Q)return{reset:{placement:Q}}}return{}}}};function BC(s){const t=xl(...s.map(r=>r.left)),e=xl(...s.map(r=>r.top)),i=lr(...s.map(r=>r.right)),n=lr(...s.map(r=>r.bottom));return{x:t,y:e,width:i-t,height:n-e}}function q4(s){const t=s.slice().sort((n,r)=>n.y-r.y),e=[];let i=null;for(let n=0;n<t.length;n++){const r=t[n];!i||r.y-i.y>i.height/2?e.push([r]):e[e.length-1].push(r),i=r}return e.map(n=>Tl(BC(n)))}const Z4=function(s){return s===void 0&&(s={}),{name:"inline",options:s,async fn(t){const{placement:e,elements:i,rects:n,platform:r,strategy:o}=t,{padding:a=2,x:l,y:h}=Xc(s,t),c=Array.from(await(r.getClientRects==null?void 0:r.getClientRects(i.reference))||[]),u=q4(c),p=Tl(BC(c)),d=zC(a);function _(){if(u.length===2&&u[0].left>u[1].right&&l!=null&&h!=null)return u.find(g=>l>g.left-d.left&&l<g.right+d.right&&h>g.top-d.top&&h<g.bottom+d.bottom)||p;if(u.length>=2){if(ia(e)==="y"){const L=u[0],V=u[u.length-1],T=fr(e)==="top",N=L.top,v=V.bottom,M=T?L.left:V.left,Q=T?L.right:V.right,j=Q-M,it=v-N;return{top:N,bottom:v,left:M,right:Q,width:j,height:it,x:M,y:N}}const g=fr(e)==="left",f=lr(...u.map(L=>L.right)),b=xl(...u.map(L=>L.left)),y=u.filter(L=>g?L.left===b:L.right===f),E=y[0].top,C=y[y.length-1].bottom,I=b,x=f,A=x-I,O=C-E;return{top:E,bottom:C,left:I,right:x,width:A,height:O,x:I,y:E}}return p}const m=await r.getElementRects({reference:{getBoundingClientRect:_},floating:i.floating,strategy:o});return n.reference.x!==m.reference.x||n.reference.y!==m.reference.y||n.reference.width!==m.reference.width||n.reference.height!==m.reference.height?{reset:{rects:m}}:{}}}};async function X4(s,t){const{placement:e,platform:i,elements:n}=s,r=await(i.isRTL==null?void 0:i.isRTL(n.floating)),o=fr(e),a=nf(e),l=ia(e)==="y",h=["left","top"].includes(o)?-1:1,c=r&&l?-1:1,u=Xc(t,s);let{mainAxis:p,crossAxis:d,alignmentAxis:_}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return a&&typeof _=="number"&&(d=a==="end"?_*-1:_),l?{x:d*c,y:p*h}:{x:p*h,y:d*c}}const VC=function(s){return{name:"offset",options:s,async fn(t){var e,i;const{x:n,y:r,placement:o,middlewareData:a}=t,l=await X4(t,s);return o===((e=a.offset)==null?void 0:e.placement)&&(i=a.arrow)!=null&&i.alignmentOffset?{}:{x:n+l.x,y:r+l.y,data:{...l,placement:o}}}}},Q4=function(s){return s===void 0&&(s={}),{name:"shift",options:s,async fn(t){const{x:e,y:i,placement:n}=t,{mainAxis:r=!0,crossAxis:o=!1,limiter:a={fn:g=>{let{x:f,y:b}=g;return{x:f,y:b}}},...l}=Xc(s,t),h={x:e,y:i},c=await UC(t,l),u=ia(fr(n)),p=MC(u);let d=h[p],_=h[u];if(r){const g=p==="y"?"top":"left",f=p==="y"?"bottom":"right",b=d+c[g],y=d-c[f];d=wv(b,d,y)}if(o){const g=u==="y"?"top":"left",f=u==="y"?"bottom":"right",b=_+c[g],y=_-c[f];_=wv(b,_,y)}const m=a.fn({...t,[p]:d,[u]:_});return{...m,data:{x:m.x-e,y:m.y-i,enabled:{[p]:r,[u]:o}}}}}};function rf(){return typeof window<"u"}function ro(s){return $C(s)?(s.nodeName||"").toLowerCase():"#document"}function bi(s){var t;return(s==null||(t=s.ownerDocument)==null?void 0:t.defaultView)||window}function co(s){var t;return(t=($C(s)?s.ownerDocument:s.document)||window.document)==null?void 0:t.documentElement}function $C(s){return rf()?s instanceof Node||s instanceof bi(s).Node:!1}function jn(s){return rf()?s instanceof Element||s instanceof bi(s).Element:!1}function Yn(s){return rf()?s instanceof HTMLElement||s instanceof bi(s).HTMLElement:!1}function Cv(s){return!rf()||typeof ShadowRoot>"u"?!1:s instanceof ShadowRoot||s instanceof bi(s).ShadowRoot}function Qc(s){const{overflow:t,overflowX:e,overflowY:i,display:n}=Vi(s);return/auto|scroll|overlay|hidden|clip/.test(t+i+e)&&!["inline","contents"].includes(n)}function K4(s){return["table","td","th"].includes(ro(s))}function J4(s){return[":popover-open",":modal"].some(t=>{try{return s.matches(t)}catch{return!1}})}function hb(s){const t=cb(),e=jn(s)?Vi(s):s;return e.transform!=="none"||e.perspective!=="none"||(e.containerType?e.containerType!=="normal":!1)||!t&&(e.backdropFilter?e.backdropFilter!=="none":!1)||!t&&(e.filter?e.filter!=="none":!1)||["transform","perspective","filter"].some(i=>(e.willChange||"").includes(i))||["paint","layout","strict","content"].some(i=>(e.contain||"").includes(i))}function tD(s){let t=Al(s);for(;Yn(t)&&!of(t);){if(hb(t))return t;if(J4(t))return null;t=Al(t)}return null}function cb(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function of(s){return["html","body","#document"].includes(ro(s))}function Vi(s){return bi(s).getComputedStyle(s)}function af(s){return jn(s)?{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}:{scrollLeft:s.scrollX,scrollTop:s.scrollY}}function Al(s){if(ro(s)==="html")return s;const t=s.assignedSlot||s.parentNode||Cv(s)&&s.host||co(s);return Cv(t)?t.host:t}function HC(s){const t=Al(s);return of(t)?s.ownerDocument?s.ownerDocument.body:s.body:Yn(t)&&Qc(t)?t:HC(t)}function jC(s,t,e){var i;t===void 0&&(t=[]);const n=HC(s),r=n===((i=s.ownerDocument)==null?void 0:i.body),o=bi(n);return r?(eD(o),t.concat(o,o.visualViewport||[],Qc(n)?n:[],[])):t.concat(n,jC(n,[]))}function eD(s){return s.parent&&Object.getPrototypeOf(s.parent)?s.frameElement:null}function YC(s){const t=Vi(s);let e=parseFloat(t.width)||0,i=parseFloat(t.height)||0;const n=Yn(s),r=n?s.offsetWidth:e,o=n?s.offsetHeight:i,a=yp(e)!==r||yp(i)!==o;return a&&(e=r,i=o),{width:e,height:i,$:a}}function WC(s){return jn(s)?s:s.contextElement}function pl(s){const t=WC(s);if(!Yn(t))return no(1);const e=t.getBoundingClientRect(),{width:i,height:n,$:r}=YC(t);let o=(r?yp(e.width):e.width)/i,a=(r?yp(e.height):e.height)/n;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const sD=no(0);function GC(s){const t=bi(s);return!cb()||!t.visualViewport?sD:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function iD(s,t,e){return t===void 0&&(t=!1),!e||t&&e!==bi(s)?!1:t}function Rc(s,t,e,i){t===void 0&&(t=!1),e===void 0&&(e=!1);const n=s.getBoundingClientRect(),r=WC(s);let o=no(1);t&&(i?jn(i)&&(o=pl(i)):o=pl(s));const a=iD(r,e,i)?GC(r):no(0);let l=(n.left+a.x)/o.x,h=(n.top+a.y)/o.y,c=n.width/o.x,u=n.height/o.y;if(r){const p=bi(r),d=i&&jn(i)?bi(i):i;let _=p,m=_.frameElement;for(;m&&i&&d!==_;){const g=pl(m),f=m.getBoundingClientRect(),b=Vi(m),y=f.left+(m.clientLeft+parseFloat(b.paddingLeft))*g.x,E=f.top+(m.clientTop+parseFloat(b.paddingTop))*g.y;l*=g.x,h*=g.y,c*=g.x,u*=g.y,l+=y,h+=E,_=bi(m),m=_.frameElement}}return Tl({width:c,height:u,x:l,y:h})}const nD=[":popover-open",":modal"];function qC(s){return nD.some(t=>{try{return s.matches(t)}catch{return!1}})}function rD(s){let{elements:t,rect:e,offsetParent:i,strategy:n}=s;const r=n==="fixed",o=co(i),a=t?qC(t.floating):!1;if(i===o||a&&r)return e;let l={scrollLeft:0,scrollTop:0},h=no(1);const c=no(0),u=Yn(i);if((u||!u&&!r)&&((ro(i)!=="body"||Qc(o))&&(l=af(i)),Yn(i))){const p=Rc(i);h=pl(i),c.x=p.x+i.clientLeft,c.y=p.y+i.clientTop}return{width:e.width*h.x,height:e.height*h.y,x:e.x*h.x-l.scrollLeft*h.x+c.x,y:e.y*h.y-l.scrollTop*h.y+c.y}}function oD(s){return Array.from(s.getClientRects())}function ZC(s){return Rc(co(s)).left+af(s).scrollLeft}function aD(s){const t=co(s),e=af(s),i=s.ownerDocument.body,n=lr(t.scrollWidth,t.clientWidth,i.scrollWidth,i.clientWidth),r=lr(t.scrollHeight,t.clientHeight,i.scrollHeight,i.clientHeight);let o=-e.scrollLeft+ZC(s);const a=-e.scrollTop;return Vi(i).direction==="rtl"&&(o+=lr(t.clientWidth,i.clientWidth)-n),{width:n,height:r,x:o,y:a}}function lD(s,t){const e=bi(s),i=co(s),n=e.visualViewport;let r=i.clientWidth,o=i.clientHeight,a=0,l=0;if(n){r=n.width,o=n.height;const h=cb();(!h||h&&t==="fixed")&&(a=n.offsetLeft,l=n.offsetTop)}return{width:r,height:o,x:a,y:l}}function hD(s,t){const e=Rc(s,!0,t==="fixed"),i=e.top+s.clientTop,n=e.left+s.clientLeft,r=Yn(s)?pl(s):no(1),o=s.clientWidth*r.x,a=s.clientHeight*r.y,l=n*r.x,h=i*r.y;return{width:o,height:a,x:l,y:h}}function Iv(s,t,e){let i;if(t==="viewport")i=lD(s,e);else if(t==="document")i=aD(co(s));else if(jn(t))i=hD(t,e);else{const n=GC(s);i={...t,x:t.x-n.x,y:t.y-n.y}}return Tl(i)}function XC(s,t){const e=Al(s);return e===t||!jn(e)||of(e)?!1:Vi(e).position==="fixed"||XC(e,t)}function cD(s,t){const e=t.get(s);if(e)return e;let i=jC(s,[]).filter(a=>jn(a)&&ro(a)!=="body"),n=null;const r=Vi(s).position==="fixed";let o=r?Al(s):s;for(;jn(o)&&!of(o);){const a=Vi(o),l=hb(o);!l&&a.position==="fixed"&&(n=null),(r?!l&&!n:!l&&a.position==="static"&&n&&["absolute","fixed"].includes(n.position)||Qc(o)&&!l&&XC(s,o))?i=i.filter(h=>h!==o):n=a,o=Al(o)}return t.set(s,i),i}function uD(s){let{element:t,boundary:e,rootBoundary:i,strategy:n}=s;const r=[...e==="clippingAncestors"?cD(t,this._c):[].concat(e),i],o=r[0],a=r.reduce((l,h)=>{const c=Iv(t,h,n);return l.top=lr(c.top,l.top),l.right=xl(c.right,l.right),l.bottom=xl(c.bottom,l.bottom),l.left=lr(c.left,l.left),l},Iv(t,o,n));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function dD(s){const{width:t,height:e}=YC(s);return{width:t,height:e}}function pD(s,t,e){const i=Yn(t),n=co(t),r=e==="fixed",o=Rc(s,!0,r,t);let a={scrollLeft:0,scrollTop:0};const l=no(0);if(i||!i&&!r)if((ro(t)!=="body"||Qc(n))&&(a=af(t)),i){const u=Rc(t,!0,r,t);l.x=u.x+t.clientLeft,l.y=u.y+t.clientTop}else n&&(l.x=ZC(n));const h=o.left+a.scrollLeft-l.x,c=o.top+a.scrollTop-l.y;return{x:h,y:c,width:o.width,height:o.height}}function xv(s,t){return!Yn(s)||Vi(s).position==="fixed"?null:t?t(s):s.offsetParent}function QC(s,t){const e=bi(s);if(!Yn(s)||qC(s))return e;let i=xv(s,t);for(;i&&K4(i)&&Vi(i).position==="static";)i=xv(i,t);return i&&(ro(i)==="html"||ro(i)==="body"&&Vi(i).position==="static"&&!hb(i))?e:i||tD(s)||e}const fD=async function(s){const t=this.getOffsetParent||QC,e=this.getDimensions;return{reference:pD(s.reference,await t(s.floating),s.strategy),floating:{x:0,y:0,...await e(s.floating)}}};function mD(s){return Vi(s).direction==="rtl"}const gD={convertOffsetParentRelativeRectToViewportRelativeRect:rD,getDocumentElement:co,getClippingRect:uD,getOffsetParent:QC,getElementRects:fD,getClientRects:oD,getDimensions:dD,getScale:pl,isElement:jn,isRTL:mD},KC=Q4,JC=G4,tI=Z4,eI=(s,t,e)=>{const i=new Map,n={platform:gD,...e},r={...n.platform,_c:i};return W4(s,t,{...n,platform:r})};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Xd=globalThis,ub=Xd.ShadowRoot&&(Xd.ShadyCSS===void 0||Xd.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,db=Symbol(),Tv=new WeakMap;let sI=class{constructor(s,t,e){if(this._$cssResult$=!0,e!==db)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=s,this.t=t}get styleSheet(){let s=this.o;const t=this.t;if(ub&&s===void 0){const e=t!==void 0&&t.length===1;e&&(s=Tv.get(t)),s===void 0&&((this.o=s=new CSSStyleSheet).replaceSync(this.cssText),e&&Tv.set(t,s))}return s}toString(){return this.cssText}};const _D=s=>new sI(typeof s=="string"?s:s+"",void 0,db),oe=(s,...t)=>{const e=s.length===1?s[0]:t.reduce((i,n,r)=>i+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+s[r+1],s[0]);return new sI(e,s,db)},bD=(s,t)=>{if(ub)s.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const e of t){const i=document.createElement("style"),n=Xd.litNonce;n!==void 0&&i.setAttribute("nonce",n),i.textContent=e.cssText,s.appendChild(i)}},Av=ub?s=>s:s=>s instanceof CSSStyleSheet?(t=>{let e="";for(const i of t.cssRules)e+=i.cssText;return _D(e)})(s):s;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:yD,defineProperty:vD,getOwnPropertyDescriptor:wD,getOwnPropertyNames:ED,getOwnPropertySymbols:CD,getPrototypeOf:ID}=Object,Sl=globalThis,Sv=Sl.trustedTypes,xD=Sv?Sv.emptyScript:"",Ov=Sl.reactiveElementPolyfillSupport,fc=(s,t)=>s,wp={toAttribute(s,t){switch(t){case Boolean:s=s?xD:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,t){let e=s;switch(t){case Boolean:e=s!==null;break;case Number:e=s===null?null:Number(s);break;case Object:case Array:try{e=JSON.parse(s)}catch{e=null}}return e}},pb=(s,t)=>!yD(s,t),Pv={attribute:!0,type:String,converter:wp,reflect:!1,hasChanged:pb};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Sl.litPropertyMetadata??(Sl.litPropertyMetadata=new WeakMap);class el extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??(this.l=[])).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=Pv){if(e.state&&(e.attribute=!1),this._$Ei(),this.elementProperties.set(t,e),!e.noAccessor){const i=Symbol(),n=this.getPropertyDescriptor(t,i,e);n!==void 0&&vD(this.prototype,t,n)}}static getPropertyDescriptor(t,e,i){const{get:n,set:r}=wD(this.prototype,t)??{get(){return this[e]},set(o){this[e]=o}};return{get(){return n==null?void 0:n.call(this)},set(o){const a=n==null?void 0:n.call(this);r.call(this,o),this.requestUpdate(t,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??Pv}static _$Ei(){if(this.hasOwnProperty(fc("elementProperties")))return;const t=ID(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(fc("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(fc("properties"))){const e=this.properties,i=[...ED(e),...CD(e)];for(const n of i)this.createProperty(n,e[n])}const t=this[Symbol.metadata];if(t!==null){const e=litPropertyMetadata.get(t);if(e!==void 0)for(const[i,n]of e)this.elementProperties.set(i,n)}this._$Eh=new Map;for(const[e,i]of this.elementProperties){const n=this._$Eu(e,i);n!==void 0&&this._$Eh.set(n,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const n of i)e.unshift(Av(n))}else t!==void 0&&e.push(Av(t));return e}static _$Eu(t,e){const i=e.attribute;return i===!1?void 0:typeof i=="string"?i:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var t;this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),(t=this.constructor.l)==null||t.forEach(e=>e(this))}addController(t){var e;(this._$EO??(this._$EO=new Set)).add(t),this.renderRoot!==void 0&&this.isConnected&&((e=t.hostConnected)==null||e.call(t))}removeController(t){var e;(e=this._$EO)==null||e.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const i of e.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return bD(t,this.constructor.elementStyles),t}connectedCallback(){var t;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$EO)==null||t.forEach(e=>{var i;return(i=e.hostConnected)==null?void 0:i.call(e)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$EO)==null||t.forEach(e=>{var i;return(i=e.hostDisconnected)==null?void 0:i.call(e)})}attributeChangedCallback(t,e,i){this._$AK(t,i)}_$EC(t,e){var i;const n=this.constructor.elementProperties.get(t),r=this.constructor._$Eu(t,n);if(r!==void 0&&n.reflect===!0){const o=(((i=n.converter)==null?void 0:i.toAttribute)!==void 0?n.converter:wp).toAttribute(e,n.type);this._$Em=t,o==null?this.removeAttribute(r):this.setAttribute(r,o),this._$Em=null}}_$AK(t,e){var i;const n=this.constructor,r=n._$Eh.get(t);if(r!==void 0&&this._$Em!==r){const o=n.getPropertyOptions(r),a=typeof o.converter=="function"?{fromAttribute:o.converter}:((i=o.converter)==null?void 0:i.fromAttribute)!==void 0?o.converter:wp;this._$Em=r,this[r]=a.fromAttribute(e,o.type),this._$Em=null}}requestUpdate(t,e,i){if(t!==void 0){if(i??(i=this.constructor.getPropertyOptions(t)),!(i.hasChanged??pb)(this[t],e))return;this.P(t,e,i)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(t,e,i){this._$AL.has(t)||this._$AL.set(t,e),i.reflect===!0&&this._$Em!==t&&(this._$Ej??(this._$Ej=new Set)).add(t)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[r,o]of this._$Ep)this[r]=o;this._$Ep=void 0}const n=this.constructor.elementProperties;if(n.size>0)for(const[r,o]of n)o.wrapped!==!0||this._$AL.has(r)||this[r]===void 0||this.P(r,this[r],o)}let e=!1;const i=this._$AL;try{e=this.shouldUpdate(i),e?(this.willUpdate(i),(t=this._$EO)==null||t.forEach(n=>{var r;return(r=n.hostUpdate)==null?void 0:r.call(n)}),this.update(i)):this._$EU()}catch(n){throw e=!1,this._$EU(),n}e&&this._$AE(i)}willUpdate(t){}_$AE(t){var e;(e=this._$EO)==null||e.forEach(i=>{var n;return(n=i.hostUpdated)==null?void 0:n.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Ej&&(this._$Ej=this._$Ej.forEach(e=>this._$EC(e,this[e]))),this._$EU()}updated(t){}firstUpdated(t){}}el.elementStyles=[],el.shadowRootOptions={mode:"open"},el[fc("elementProperties")]=new Map,el[fc("finalized")]=new Map,Ov==null||Ov({ReactiveElement:el}),(Sl.reactiveElementVersions??(Sl.reactiveElementVersions=[])).push("2.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ep=globalThis,Cp=Ep.trustedTypes,Fv=Cp?Cp.createPolicy("lit-html",{createHTML:s=>s}):void 0,iI="$lit$",Vr=`lit$${Math.random().toFixed(9).slice(2)}$`,nI="?"+Vr,TD=`<${nI}>`,na=document,Lc=()=>na.createComment(""),Nc=s=>s===null||typeof s!="object"&&typeof s!="function",fb=Array.isArray,AD=s=>fb(s)||typeof(s==null?void 0:s[Symbol.iterator])=="function",Um=`[ 	
\f\r]`,Th=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Rv=/-->/g,Lv=/>/g,Co=RegExp(`>|${Um}(?:([^\\s"'>=/]+)(${Um}*=${Um}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Nv=/'/g,Mv=/"/g,rI=/^(?:script|style|textarea|title)$/i,SD=s=>(t,...e)=>({_$litType$:s,strings:t,values:e}),ct=SD(1),ra=Symbol.for("lit-noChange"),Be=Symbol.for("lit-nothing"),Dv=new WeakMap,Vo=na.createTreeWalker(na,129);function oI(s,t){if(!fb(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return Fv!==void 0?Fv.createHTML(t):t}const OD=(s,t)=>{const e=s.length-1,i=[];let n,r=t===2?"<svg>":t===3?"<math>":"",o=Th;for(let a=0;a<e;a++){const l=s[a];let h,c,u=-1,p=0;for(;p<l.length&&(o.lastIndex=p,c=o.exec(l),c!==null);)p=o.lastIndex,o===Th?c[1]==="!--"?o=Rv:c[1]!==void 0?o=Lv:c[2]!==void 0?(rI.test(c[2])&&(n=RegExp("</"+c[2],"g")),o=Co):c[3]!==void 0&&(o=Co):o===Co?c[0]===">"?(o=n??Th,u=-1):c[1]===void 0?u=-2:(u=o.lastIndex-c[2].length,h=c[1],o=c[3]===void 0?Co:c[3]==='"'?Mv:Nv):o===Mv||o===Nv?o=Co:o===Rv||o===Lv?o=Th:(o=Co,n=void 0);const d=o===Co&&s[a+1].startsWith("/>")?" ":"";r+=o===Th?l+TD:u>=0?(i.push(h),l.slice(0,u)+iI+l.slice(u)+Vr+d):l+Vr+(u===-2?a:d)}return[oI(s,r+(s[e]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),i]};class Mc{constructor({strings:t,_$litType$:e},i){let n;this.parts=[];let r=0,o=0;const a=t.length-1,l=this.parts,[h,c]=OD(t,e);if(this.el=Mc.createElement(h,i),Vo.currentNode=this.el.content,e===2||e===3){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;(n=Vo.nextNode())!==null&&l.length<a;){if(n.nodeType===1){if(n.hasAttributes())for(const u of n.getAttributeNames())if(u.endsWith(iI)){const p=c[o++],d=n.getAttribute(u).split(Vr),_=/([.?@])?(.*)/.exec(p);l.push({type:1,index:r,name:_[2],strings:d,ctor:_[1]==="."?FD:_[1]==="?"?RD:_[1]==="@"?LD:lf}),n.removeAttribute(u)}else u.startsWith(Vr)&&(l.push({type:6,index:r}),n.removeAttribute(u));if(rI.test(n.tagName)){const u=n.textContent.split(Vr),p=u.length-1;if(p>0){n.textContent=Cp?Cp.emptyScript:"";for(let d=0;d<p;d++)n.append(u[d],Lc()),Vo.nextNode(),l.push({type:2,index:++r});n.append(u[p],Lc())}}}else if(n.nodeType===8)if(n.data===nI)l.push({type:2,index:r});else{let u=-1;for(;(u=n.data.indexOf(Vr,u+1))!==-1;)l.push({type:7,index:r}),u+=Vr.length-1}r++}}static createElement(t,e){const i=na.createElement("template");return i.innerHTML=t,i}}function Ol(s,t,e=s,i){var n,r;if(t===ra)return t;let o=i!==void 0?(n=e._$Co)==null?void 0:n[i]:e._$Cl;const a=Nc(t)?void 0:t._$litDirective$;return(o==null?void 0:o.constructor)!==a&&((r=o==null?void 0:o._$AO)==null||r.call(o,!1),a===void 0?o=void 0:(o=new a(s),o._$AT(s,e,i)),i!==void 0?(e._$Co??(e._$Co=[]))[i]=o:e._$Cl=o),o!==void 0&&(t=Ol(s,o._$AS(s,t.values),o,i)),t}class PD{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:i}=this._$AD,n=((t==null?void 0:t.creationScope)??na).importNode(e,!0);Vo.currentNode=n;let r=Vo.nextNode(),o=0,a=0,l=i[0];for(;l!==void 0;){if(o===l.index){let h;l.type===2?h=new Kc(r,r.nextSibling,this,t):l.type===1?h=new l.ctor(r,l.name,l.strings,this,t):l.type===6&&(h=new ND(r,this,t)),this._$AV.push(h),l=i[++a]}o!==(l==null?void 0:l.index)&&(r=Vo.nextNode(),o++)}return Vo.currentNode=na,n}p(t){let e=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}}class Kc{get _$AU(){var t;return((t=this._$AM)==null?void 0:t._$AU)??this._$Cv}constructor(t,e,i,n){this.type=2,this._$AH=Be,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=n,this._$Cv=(n==null?void 0:n.isConnected)??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=Ol(this,t,e),Nc(t)?t===Be||t==null||t===""?(this._$AH!==Be&&this._$AR(),this._$AH=Be):t!==this._$AH&&t!==ra&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):AD(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==Be&&Nc(this._$AH)?this._$AA.nextSibling.data=t:this.T(na.createTextNode(t)),this._$AH=t}$(t){var e;const{values:i,_$litType$:n}=t,r=typeof n=="number"?this._$AC(t):(n.el===void 0&&(n.el=Mc.createElement(oI(n.h,n.h[0]),this.options)),n);if(((e=this._$AH)==null?void 0:e._$AD)===r)this._$AH.p(i);else{const o=new PD(r,this),a=o.u(this.options);o.p(i),this.T(a),this._$AH=o}}_$AC(t){let e=Dv.get(t.strings);return e===void 0&&Dv.set(t.strings,e=new Mc(t)),e}k(t){fb(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,n=0;for(const r of t)n===e.length?e.push(i=new Kc(this.O(Lc()),this.O(Lc()),this,this.options)):i=e[n],i._$AI(r),n++;n<e.length&&(this._$AR(i&&i._$AB.nextSibling,n),e.length=n)}_$AR(t=this._$AA.nextSibling,e){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,e);t&&t!==this._$AB;){const n=t.nextSibling;t.remove(),t=n}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}}class lf{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,i,n,r){this.type=1,this._$AH=Be,this._$AN=void 0,this.element=t,this.name=e,this._$AM=n,this.options=r,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=Be}_$AI(t,e=this,i,n){const r=this.strings;let o=!1;if(r===void 0)t=Ol(this,t,e,0),o=!Nc(t)||t!==this._$AH&&t!==ra,o&&(this._$AH=t);else{const a=t;let l,h;for(t=r[0],l=0;l<r.length-1;l++)h=Ol(this,a[i+l],e,l),h===ra&&(h=this._$AH[l]),o||(o=!Nc(h)||h!==this._$AH[l]),h===Be?t=Be:t!==Be&&(t+=(h??"")+r[l+1]),this._$AH[l]=h}o&&!n&&this.j(t)}j(t){t===Be?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class FD extends lf{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===Be?void 0:t}}class RD extends lf{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==Be)}}class LD extends lf{constructor(t,e,i,n,r){super(t,e,i,n,r),this.type=5}_$AI(t,e=this){if((t=Ol(this,t,e,0)??Be)===ra)return;const i=this._$AH,n=t===Be&&i!==Be||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,r=t!==Be&&(i===Be||n);n&&this.element.removeEventListener(this.name,this,i),r&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e;typeof this._$AH=="function"?this._$AH.call(((e=this.options)==null?void 0:e.host)??this.element,t):this._$AH.handleEvent(t)}}class ND{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){Ol(this,t)}}const kv=Ep.litHtmlPolyfillSupport;kv==null||kv(Mc,Kc),(Ep.litHtmlVersions??(Ep.litHtmlVersions=[])).push("3.2.1");const Pl=(s,t,e)=>{const i=(e==null?void 0:e.renderBefore)??t;let n=i._$litPart$;if(n===void 0){const r=(e==null?void 0:e.renderBefore)??null;i._$litPart$=n=new Kc(t.insertBefore(Lc(),r),r,void 0,e??{})}return n._$AI(s),n};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let ie=class extends el{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var s;const t=super.createRenderRoot();return(s=this.renderOptions).renderBefore??(s.renderBefore=t.firstChild),t}update(s){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(s),this._$Do=Pl(t,this.renderRoot,this.renderOptions)}connectedCallback(){var s;super.connectedCallback(),(s=this._$Do)==null||s.setConnected(!0)}disconnectedCallback(){var s;super.disconnectedCallback(),(s=this._$Do)==null||s.setConnected(!1)}render(){return ra}};var zv;ie._$litElement$=!0,ie.finalized=!0,(zv=globalThis.litElementHydrateSupport)==null||zv.call(globalThis,{LitElement:ie});const Uv=globalThis.litElementPolyfillSupport;Uv==null||Uv({LitElement:ie});(globalThis.litElementVersions??(globalThis.litElementVersions=[])).push("4.1.1");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const MD={attribute:!0,type:String,converter:wp,reflect:!1,hasChanged:pb},DD=(s=MD,t,e)=>{const{kind:i,metadata:n}=e;let r=globalThis.litPropertyMetadata.get(n);if(r===void 0&&globalThis.litPropertyMetadata.set(n,r=new Map),r.set(e.name,s),i==="accessor"){const{name:o}=e;return{set(a){const l=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,l,s)},init(a){return a!==void 0&&this.P(o,void 0,s),a}}}if(i==="setter"){const{name:o}=e;return function(a){const l=this[o];t.call(this,a),this.requestUpdate(o,l,s)}}throw Error("Unsupported decorator location: "+i)};function ut(s){return(t,e)=>typeof e=="object"?DD(s,t,e):((i,n,r)=>{const o=n.hasOwnProperty(r);return n.constructor.createProperty(r,o?{...i,wrapped:!0}:i),o?Object.getOwnPropertyDescriptor(n,r):void 0})(s,t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Ul(s){return ut({...s,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const kD=s=>s.strings===void 0;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const aI={ATTRIBUTE:1,CHILD:2},lI=s=>(...t)=>({_$litDirective$:s,values:t});let hI=class{constructor(s){}get _$AU(){return this._$AM._$AU}_$AT(s,t,e){this._$Ct=s,this._$AM=t,this._$Ci=e}_$AS(s,t){return this.update(s,t)}update(s,t){return this.render(...t)}};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const mc=(s,t)=>{var e;const i=s._$AN;if(i===void 0)return!1;for(const n of i)(e=n._$AO)==null||e.call(n,t,!1),mc(n,t);return!0},Ip=s=>{let t,e;do{if((t=s._$AM)===void 0)break;e=t._$AN,e.delete(s),s=t}while((e==null?void 0:e.size)===0)},cI=s=>{for(let t;t=s._$AM;s=t){let e=t._$AN;if(e===void 0)t._$AN=e=new Set;else if(e.has(s))break;e.add(s),BD(t)}};function zD(s){this._$AN!==void 0?(Ip(this),this._$AM=s,cI(this)):this._$AM=s}function UD(s,t=!1,e=0){const i=this._$AH,n=this._$AN;if(n!==void 0&&n.size!==0)if(t)if(Array.isArray(i))for(let r=e;r<i.length;r++)mc(i[r],!1),Ip(i[r]);else i!=null&&(mc(i,!1),Ip(i));else mc(this,s)}const BD=s=>{s.type==aI.CHILD&&(s._$AP??(s._$AP=UD),s._$AQ??(s._$AQ=zD))};class VD extends hI{constructor(){super(...arguments),this._$AN=void 0}_$AT(t,e,i){super._$AT(t,e,i),cI(this),this.isConnected=t._$AU}_$AO(t,e=!0){var i,n;t!==this.isConnected&&(this.isConnected=t,t?(i=this.reconnected)==null||i.call(this):(n=this.disconnected)==null||n.call(this)),e&&(mc(this,t),Ip(this))}setValue(t){if(kD(this._$Ct))this._$Ct._$AI(t,this);else{const e=[...this._$Ct._$AH];e[this._$Ci]=t,this._$Ct._$AI(e,this,0)}}disconnected(){}reconnected(){}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Fl=()=>new $D;class $D{}const Bm=new WeakMap,ti=lI(class extends VD{render(s){return Be}update(s,[t]){var e;const i=t!==this.Y;return i&&this.Y!==void 0&&this.rt(void 0),(i||this.lt!==this.ct)&&(this.Y=t,this.ht=(e=s.options)==null?void 0:e.host,this.rt(this.ct=s.element)),Be}rt(s){if(this.isConnected||(s=void 0),typeof this.Y=="function"){const t=this.ht??globalThis;let e=Bm.get(t);e===void 0&&(e=new WeakMap,Bm.set(t,e)),e.get(this.Y)!==void 0&&this.Y.call(this.ht,void 0),e.set(this.Y,s),s!==void 0&&this.Y.call(this.ht,s)}else this.Y.value=s}get lt(){var s,t;return typeof this.Y=="function"?(s=Bm.get(this.ht??globalThis))==null?void 0:s.get(this.Y):(t=this.Y)==null?void 0:t.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});/**
* (c) Iconify
*
* For the full copyright and license information, please view the license.txt
* files at https://github.com/iconify/iconify
*
* Licensed under MIT.
*
* @license MIT
* @version 2.0.0
*/const uI=Object.freeze({left:0,top:0,width:16,height:16}),xp=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),Jc=Object.freeze({...uI,...xp}),h_=Object.freeze({...Jc,body:"",hidden:!1}),HD=Object.freeze({width:null,height:null}),dI=Object.freeze({...HD,...xp});function jD(s,t=0){const e=s.replace(/^-?[0-9.]*/,"");function i(n){for(;n<0;)n+=4;return n%4}if(e===""){const n=parseInt(s);return isNaN(n)?0:i(n)}else if(e!==s){let n=0;switch(e){case"%":n=25;break;case"deg":n=90}if(n){let r=parseFloat(s.slice(0,s.length-e.length));return isNaN(r)?0:(r=r/n,r%1===0?i(r):0)}}return t}const YD=/[\s,]+/;function WD(s,t){t.split(YD).forEach(e=>{switch(e.trim()){case"horizontal":s.hFlip=!0;break;case"vertical":s.vFlip=!0;break}})}const pI={...dI,preserveAspectRatio:""};function Bv(s){const t={...pI},e=(i,n)=>s.getAttribute(i)||n;return t.width=e("width",null),t.height=e("height",null),t.rotate=jD(e("rotate","")),WD(t,e("flip","")),t.preserveAspectRatio=e("preserveAspectRatio",e("preserveaspectratio","")),t}function GD(s,t){for(const e in pI)if(s[e]!==t[e])return!0;return!1}const gc=/^[a-z0-9]+(-[a-z0-9]+)*$/,tu=(s,t,e,i="")=>{const n=s.split(":");if(s.slice(0,1)==="@"){if(n.length<2||n.length>3)return null;i=n.shift().slice(1)}if(n.length>3||!n.length)return null;if(n.length>1){const a=n.pop(),l=n.pop(),h={provider:n.length>0?n[0]:i,prefix:l,name:a};return t&&!Qd(h)?null:h}const r=n[0],o=r.split("-");if(o.length>1){const a={provider:i,prefix:o.shift(),name:o.join("-")};return t&&!Qd(a)?null:a}if(e&&i===""){const a={provider:i,prefix:"",name:r};return t&&!Qd(a,e)?null:a}return null},Qd=(s,t)=>s?!!((s.provider===""||s.provider.match(gc))&&(t&&s.prefix===""||s.prefix.match(gc))&&s.name.match(gc)):!1;function qD(s,t){const e={};!s.hFlip!=!t.hFlip&&(e.hFlip=!0),!s.vFlip!=!t.vFlip&&(e.vFlip=!0);const i=((s.rotate||0)+(t.rotate||0))%4;return i&&(e.rotate=i),e}function Vv(s,t){const e=qD(s,t);for(const i in h_)i in xp?i in s&&!(i in e)&&(e[i]=xp[i]):i in t?e[i]=t[i]:i in s&&(e[i]=s[i]);return e}function ZD(s,t){const e=s.icons,i=s.aliases||Object.create(null),n=Object.create(null);function r(o){if(e[o])return n[o]=[];if(!(o in n)){n[o]=null;const a=i[o]&&i[o].parent,l=a&&r(a);l&&(n[o]=[a].concat(l))}return n[o]}return Object.keys(e).concat(Object.keys(i)).forEach(r),n}function XD(s,t,e){const i=s.icons,n=s.aliases||Object.create(null);let r={};function o(a){r=Vv(i[a]||n[a],r)}return o(t),e.forEach(o),Vv(s,r)}function fI(s,t){const e=[];if(typeof s!="object"||typeof s.icons!="object")return e;s.not_found instanceof Array&&s.not_found.forEach(n=>{t(n,null),e.push(n)});const i=ZD(s);for(const n in i){const r=i[n];r&&(t(n,XD(s,n,r)),e.push(n))}return e}const QD={provider:"",aliases:{},not_found:{},...uI};function Vm(s,t){for(const e in t)if(e in s&&typeof s[e]!=typeof t[e])return!1;return!0}function mI(s){if(typeof s!="object"||s===null)return null;const t=s;if(typeof t.prefix!="string"||!s.icons||typeof s.icons!="object"||!Vm(s,QD))return null;const e=t.icons;for(const n in e){const r=e[n];if(!n.match(gc)||typeof r.body!="string"||!Vm(r,h_))return null}const i=t.aliases||Object.create(null);for(const n in i){const r=i[n],o=r.parent;if(!n.match(gc)||typeof o!="string"||!e[o]&&!i[o]||!Vm(r,h_))return null}return t}const Tp=Object.create(null);function KD(s,t){return{provider:s,prefix:t,icons:Object.create(null),missing:new Set}}function oo(s,t){const e=Tp[s]||(Tp[s]=Object.create(null));return e[t]||(e[t]=KD(s,t))}function mb(s,t){return mI(t)?fI(t,(e,i)=>{i?s.icons[e]=i:s.missing.add(e)}):[]}function JD(s,t,e){try{if(typeof e.body=="string")return s.icons[t]={...e},!0}catch{}return!1}function t6(s,t){let e=[];return(typeof s=="string"?[s]:Object.keys(Tp)).forEach(i=>{(typeof i=="string"&&typeof t=="string"?[t]:Object.keys(Tp[i]||{})).forEach(n=>{const r=oo(i,n);e=e.concat(Object.keys(r.icons).map(o=>(i!==""?"@"+i+":":"")+n+":"+o))})}),e}let Dc=!1;function gI(s){return typeof s=="boolean"&&(Dc=s),Dc}function kc(s){const t=typeof s=="string"?tu(s,!0,Dc):s;if(t){const e=oo(t.provider,t.prefix),i=t.name;return e.icons[i]||(e.missing.has(i)?null:void 0)}}function _I(s,t){const e=tu(s,!0,Dc);if(!e)return!1;const i=oo(e.provider,e.prefix);return JD(i,e.name,t)}function $v(s,t){if(typeof s!="object")return!1;if(typeof t!="string"&&(t=s.provider||""),Dc&&!t&&!s.prefix){let n=!1;return mI(s)&&(s.prefix="",fI(s,(r,o)=>{o&&_I(r,o)&&(n=!0)})),n}const e=s.prefix;if(!Qd({provider:t,prefix:e,name:"a"}))return!1;const i=oo(t,e);return!!mb(i,s)}function Hv(s){return!!kc(s)}function e6(s){const t=kc(s);return t?{...Jc,...t}:null}function s6(s){const t={loaded:[],missing:[],pending:[]},e=Object.create(null);s.sort((n,r)=>n.provider!==r.provider?n.provider.localeCompare(r.provider):n.prefix!==r.prefix?n.prefix.localeCompare(r.prefix):n.name.localeCompare(r.name));let i={provider:"",prefix:"",name:""};return s.forEach(n=>{if(i.name===n.name&&i.prefix===n.prefix&&i.provider===n.provider)return;i=n;const r=n.provider,o=n.prefix,a=n.name,l=e[r]||(e[r]=Object.create(null)),h=l[o]||(l[o]=oo(r,o));let c;a in h.icons?c=t.loaded:o===""||h.missing.has(a)?c=t.missing:c=t.pending;const u={provider:r,prefix:o,name:a};c.push(u)}),t}function bI(s,t){s.forEach(e=>{const i=e.loaderCallbacks;i&&(e.loaderCallbacks=i.filter(n=>n.id!==t))})}function i6(s){s.pendingCallbacksFlag||(s.pendingCallbacksFlag=!0,setTimeout(()=>{s.pendingCallbacksFlag=!1;const t=s.loaderCallbacks?s.loaderCallbacks.slice(0):[];if(!t.length)return;let e=!1;const i=s.provider,n=s.prefix;t.forEach(r=>{const o=r.icons,a=o.pending.length;o.pending=o.pending.filter(l=>{if(l.prefix!==n)return!0;const h=l.name;if(s.icons[h])o.loaded.push({provider:i,prefix:n,name:h});else if(s.missing.has(h))o.missing.push({provider:i,prefix:n,name:h});else return e=!0,!0;return!1}),o.pending.length!==a&&(e||bI([s],r.id),r.callback(o.loaded.slice(0),o.missing.slice(0),o.pending.slice(0),r.abort))})}))}let n6=0;function r6(s,t,e){const i=n6++,n=bI.bind(null,e,i);if(!t.pending.length)return n;const r={id:i,icons:t,callback:s,abort:n};return e.forEach(o=>{(o.loaderCallbacks||(o.loaderCallbacks=[])).push(r)}),n}const c_=Object.create(null);function jv(s,t){c_[s]=t}function u_(s){return c_[s]||c_[""]}function o6(s,t=!0,e=!1){const i=[];return s.forEach(n=>{const r=typeof n=="string"?tu(n,t,e):n;r&&i.push(r)}),i}var a6={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function l6(s,t,e,i){const n=s.resources.length,r=s.random?Math.floor(Math.random()*n):s.index;let o;if(s.random){let I=s.resources.slice(0);for(o=[];I.length>1;){const x=Math.floor(Math.random()*I.length);o.push(I[x]),I=I.slice(0,x).concat(I.slice(x+1))}o=o.concat(I)}else o=s.resources.slice(r).concat(s.resources.slice(0,r));const a=Date.now();let l="pending",h=0,c,u=null,p=[],d=[];typeof i=="function"&&d.push(i);function _(){u&&(clearTimeout(u),u=null)}function m(){l==="pending"&&(l="aborted"),_(),p.forEach(I=>{I.status==="pending"&&(I.status="aborted")}),p=[]}function g(I,x){x&&(d=[]),typeof I=="function"&&d.push(I)}function f(){return{startTime:a,payload:t,status:l,queriesSent:h,queriesPending:p.length,subscribe:g,abort:m}}function b(){l="failed",d.forEach(I=>{I(void 0,c)})}function y(){p.forEach(I=>{I.status==="pending"&&(I.status="aborted")}),p=[]}function E(I,x,A){const O=x!=="success";switch(p=p.filter(L=>L!==I),l){case"pending":break;case"failed":if(O||!s.dataAfterTimeout)return;break;default:return}if(x==="abort"){c=A,b();return}if(O){c=A,p.length||(o.length?C():b());return}if(_(),y(),!s.random){const L=s.resources.indexOf(I.resource);L!==-1&&L!==s.index&&(s.index=L)}l="completed",d.forEach(L=>{L(A)})}function C(){if(l!=="pending")return;_();const I=o.shift();if(I===void 0){if(p.length){u=setTimeout(()=>{_(),l==="pending"&&(y(),b())},s.timeout);return}b();return}const x={status:"pending",resource:I,callback:(A,O)=>{E(x,A,O)}};p.push(x),h++,u=setTimeout(C,s.rotate),e(I,t,x.callback)}return setTimeout(C),f}function yI(s){const t={...a6,...s};let e=[];function i(){e=e.filter(o=>o().status==="pending")}function n(o,a,l){const h=l6(t,o,a,(c,u)=>{i(),l&&l(c,u)});return e.push(h),h}function r(o){return e.find(a=>o(a))||null}return{query:n,find:r,setIndex:o=>{t.index=o},getIndex:()=>t.index,cleanup:i}}function gb(s){let t;if(typeof s.resources=="string")t=[s.resources];else if(t=s.resources,!(t instanceof Array)||!t.length)return null;return{resources:t,path:s.path||"/",maxURL:s.maxURL||500,rotate:s.rotate||750,timeout:s.timeout||5e3,random:s.random===!0,index:s.index||0,dataAfterTimeout:s.dataAfterTimeout!==!1}}const hf=Object.create(null),Ed=["https://api.simplesvg.com","https://api.unisvg.com"],d_=[];for(;Ed.length>0;)Ed.length===1||Math.random()>.5?d_.push(Ed.shift()):d_.push(Ed.pop());hf[""]=gb({resources:["https://api.iconify.design"].concat(d_)});function Yv(s,t){const e=gb(t);return e===null?!1:(hf[s]=e,!0)}function cf(s){return hf[s]}function h6(){return Object.keys(hf)}function Wv(){}const $m=Object.create(null);function c6(s){if(!$m[s]){const t=cf(s);if(!t)return;const e=yI(t),i={config:t,redundancy:e};$m[s]=i}return $m[s]}function vI(s,t,e){let i,n;if(typeof s=="string"){const r=u_(s);if(!r)return e(void 0,424),Wv;n=r.send;const o=c6(s);o&&(i=o.redundancy)}else{const r=gb(s);if(r){i=yI(r);const o=s.resources?s.resources[0]:"",a=u_(o);a&&(n=a.send)}}return!i||!n?(e(void 0,424),Wv):i.query(t,n,e)().abort}const Gv="iconify2",zc="iconify",wI=zc+"-count",qv=zc+"-version",EI=36e5,u6=168,d6=50;function p_(s,t){try{return s.getItem(t)}catch{}}function _b(s,t,e){try{return s.setItem(t,e),!0}catch{}}function Zv(s,t){try{s.removeItem(t)}catch{}}function f_(s,t){return _b(s,wI,t.toString())}function m_(s){return parseInt(p_(s,wI))||0}const qo={local:!0,session:!0},CI={local:new Set,session:new Set};let bb=!1;function p6(s){bb=s}let Cd=typeof window>"u"?{}:window;function II(s){const t=s+"Storage";try{if(Cd&&Cd[t]&&typeof Cd[t].length=="number")return Cd[t]}catch{}qo[s]=!1}function xI(s,t){const e=II(s);if(!e)return;const i=p_(e,qv);if(i!==Gv){if(i){const a=m_(e);for(let l=0;l<a;l++)Zv(e,zc+l.toString())}_b(e,qv,Gv),f_(e,0);return}const n=Math.floor(Date.now()/EI)-u6,r=a=>{const l=zc+a.toString(),h=p_(e,l);if(typeof h=="string"){try{const c=JSON.parse(h);if(typeof c=="object"&&typeof c.cached=="number"&&c.cached>n&&typeof c.provider=="string"&&typeof c.data=="object"&&typeof c.data.prefix=="string"&&t(c,a))return!0}catch{}Zv(e,l)}};let o=m_(e);for(let a=o-1;a>=0;a--)r(a)||(a===o-1?(o--,f_(e,o)):CI[s].add(a))}function TI(){if(!bb){p6(!0);for(const s in qo)xI(s,t=>{const e=t.data,i=t.provider,n=e.prefix,r=oo(i,n);if(!mb(r,e).length)return!1;const o=e.lastModified||-1;return r.lastModifiedCached=r.lastModifiedCached?Math.min(r.lastModifiedCached,o):o,!0})}}function f6(s,t){const e=s.lastModifiedCached;if(e&&e>=t)return e===t;if(s.lastModifiedCached=t,e)for(const i in qo)xI(i,n=>{const r=n.data;return n.provider!==s.provider||r.prefix!==s.prefix||r.lastModified===t});return!0}function m6(s,t){bb||TI();function e(i){let n;if(!qo[i]||!(n=II(i)))return;const r=CI[i];let o;if(r.size)r.delete(o=Array.from(r).shift());else if(o=m_(n),o>=d6||!f_(n,o+1))return;const a={cached:Math.floor(Date.now()/EI),provider:s.provider,data:t};return _b(n,zc+o.toString(),JSON.stringify(a))}t.lastModified&&!f6(s,t.lastModified)||Object.keys(t.icons).length&&(t.not_found&&(t=Object.assign({},t),delete t.not_found),e("local")||e("session"))}function Xv(){}function g6(s){s.iconsLoaderFlag||(s.iconsLoaderFlag=!0,setTimeout(()=>{s.iconsLoaderFlag=!1,i6(s)}))}function _6(s,t){s.iconsToLoad?s.iconsToLoad=s.iconsToLoad.concat(t).sort():s.iconsToLoad=t,s.iconsQueueFlag||(s.iconsQueueFlag=!0,setTimeout(()=>{s.iconsQueueFlag=!1;const{provider:e,prefix:i}=s,n=s.iconsToLoad;delete s.iconsToLoad;let r;!n||!(r=u_(e))||r.prepare(e,i,n).forEach(o=>{vI(e,o,a=>{if(typeof a!="object")o.icons.forEach(l=>{s.missing.add(l)});else try{const l=mb(s,a);if(!l.length)return;const h=s.pendingIcons;h&&l.forEach(c=>{h.delete(c)}),m6(s,a)}catch(l){console.error(l)}g6(s)})})}))}const yb=(s,t)=>{const e=o6(s,!0,gI()),i=s6(e);if(!i.pending.length){let l=!0;return t&&setTimeout(()=>{l&&t(i.loaded,i.missing,i.pending,Xv)}),()=>{l=!1}}const n=Object.create(null),r=[];let o,a;return i.pending.forEach(l=>{const{provider:h,prefix:c}=l;if(c===a&&h===o)return;o=h,a=c,r.push(oo(h,c));const u=n[h]||(n[h]=Object.create(null));u[c]||(u[c]=[])}),i.pending.forEach(l=>{const{provider:h,prefix:c,name:u}=l,p=oo(h,c),d=p.pendingIcons||(p.pendingIcons=new Set);d.has(u)||(d.add(u),n[h][c].push(u))}),r.forEach(l=>{const{provider:h,prefix:c}=l;n[h][c].length&&_6(l,n[h][c])}),t?r6(t,i,r):Xv},b6=s=>new Promise((t,e)=>{const i=typeof s=="string"?tu(s,!0):s;if(!i){e(s);return}yb([i||s],n=>{if(n.length&&i){const r=kc(i);if(r){t({...Jc,...r});return}}e(s)})});function y6(s){try{const t=typeof s=="string"?JSON.parse(s):s;if(typeof t.body=="string")return{...t}}catch{}}function v6(s,t){const e=typeof s=="string"?tu(s,!0,!0):null;if(!e){const r=y6(s);return{value:s,data:r}}const i=kc(e);if(i!==void 0||!e.prefix)return{value:s,name:e,data:i};const n=yb([e],()=>t(s,e,kc(e)));return{value:s,name:e,loading:n}}function Hm(s){return s.hasAttribute("inline")}let AI=!1;try{AI=navigator.vendor.indexOf("Apple")===0}catch{}function w6(s,t){switch(t){case"svg":case"bg":case"mask":return t}return t!=="style"&&(AI||s.indexOf("<a")===-1)?"svg":s.indexOf("currentColor")===-1?"bg":"mask"}const E6=/(-?[0-9.]*[0-9]+[0-9.]*)/g,C6=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function g_(s,t,e){if(t===1)return s;if(e=e||100,typeof s=="number")return Math.ceil(s*t*e)/e;if(typeof s!="string")return s;const i=s.split(E6);if(i===null||!i.length)return s;const n=[];let r=i.shift(),o=C6.test(r);for(;;){if(o){const a=parseFloat(r);isNaN(a)?n.push(r):n.push(Math.ceil(a*t*e)/e)}else n.push(r);if(r=i.shift(),r===void 0)return n.join("");o=!o}}function I6(s,t="defs"){let e="";const i=s.indexOf("<"+t);for(;i>=0;){const n=s.indexOf(">",i),r=s.indexOf("</"+t);if(n===-1||r===-1)break;const o=s.indexOf(">",r);if(o===-1)break;e+=s.slice(n+1,r).trim(),s=s.slice(0,i).trim()+s.slice(o+1)}return{defs:e,content:s}}function x6(s,t){return s?"<defs>"+s+"</defs>"+t:t}function T6(s,t,e){const i=I6(s);return x6(i.defs,t+i.content+e)}const A6=s=>s==="unset"||s==="undefined"||s==="none";function SI(s,t){const e={...Jc,...s},i={...dI,...t},n={left:e.left,top:e.top,width:e.width,height:e.height};let r=e.body;[e,i].forEach(m=>{const g=[],f=m.hFlip,b=m.vFlip;let y=m.rotate;f?b?y+=2:(g.push("translate("+(n.width+n.left).toString()+" "+(0-n.top).toString()+")"),g.push("scale(-1 1)"),n.top=n.left=0):b&&(g.push("translate("+(0-n.left).toString()+" "+(n.height+n.top).toString()+")"),g.push("scale(1 -1)"),n.top=n.left=0);let E;switch(y<0&&(y-=Math.floor(y/4)*4),y=y%4,y){case 1:E=n.height/2+n.top,g.unshift("rotate(90 "+E.toString()+" "+E.toString()+")");break;case 2:g.unshift("rotate(180 "+(n.width/2+n.left).toString()+" "+(n.height/2+n.top).toString()+")");break;case 3:E=n.width/2+n.left,g.unshift("rotate(-90 "+E.toString()+" "+E.toString()+")");break}y%2===1&&(n.left!==n.top&&(E=n.left,n.left=n.top,n.top=E),n.width!==n.height&&(E=n.width,n.width=n.height,n.height=E)),g.length&&(r=T6(r,'<g transform="'+g.join(" ")+'">',"</g>"))});const o=i.width,a=i.height,l=n.width,h=n.height;let c,u;o===null?(u=a===null?"1em":a==="auto"?h:a,c=g_(u,l/h)):(c=o==="auto"?l:o,u=a===null?g_(c,h/l):a==="auto"?h:a);const p={},d=(m,g)=>{A6(g)||(p[m]=g.toString())};d("width",c),d("height",u);const _=[n.left,n.top,l,h];return p.viewBox=_.join(" "),{attributes:p,viewBox:_,body:r}}function vb(s,t){let e=s.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const i in t)e+=" "+i+'="'+t[i]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+e+">"+s+"</svg>"}function S6(s){return s.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function O6(s){return"data:image/svg+xml,"+S6(s)}function OI(s){return'url("'+O6(s)+'")'}const P6=()=>{let s;try{if(s=fetch,typeof s=="function")return s}catch{}};let Ap=P6();function F6(s){Ap=s}function R6(){return Ap}function L6(s,t){const e=cf(s);if(!e)return 0;let i;if(!e.maxURL)i=0;else{let n=0;e.resources.forEach(o=>{n=Math.max(n,o.length)});const r=t+".json?icons=";i=e.maxURL-n-e.path.length-r.length}return i}function N6(s){return s===404}const M6=(s,t,e)=>{const i=[],n=L6(s,t),r="icons";let o={type:r,provider:s,prefix:t,icons:[]},a=0;return e.forEach((l,h)=>{a+=l.length+1,a>=n&&h>0&&(i.push(o),o={type:r,provider:s,prefix:t,icons:[]},a=l.length),o.icons.push(l)}),i.push(o),i};function D6(s){if(typeof s=="string"){const t=cf(s);if(t)return t.path}return"/"}const k6=(s,t,e)=>{if(!Ap){e("abort",424);return}let i=D6(t.provider);switch(t.type){case"icons":{const r=t.prefix,o=t.icons.join(","),a=new URLSearchParams({icons:o});i+=r+".json?"+a.toString();break}case"custom":{const r=t.uri;i+=r.slice(0,1)==="/"?r.slice(1):r;break}default:e("abort",400);return}let n=503;Ap(s+i).then(r=>{const o=r.status;if(o!==200){setTimeout(()=>{e(N6(o)?"abort":"next",o)});return}return n=501,r.json()}).then(r=>{if(typeof r!="object"||r===null){setTimeout(()=>{r===404?e("abort",r):e("next",n)});return}setTimeout(()=>{e("success",r)})}).catch(()=>{e("next",n)})},z6={prepare:M6,send:k6};function Qv(s,t){switch(s){case"local":case"session":qo[s]=t;break;case"all":for(const e in qo)qo[e]=t;break}}const jm="data-style";let PI="";function U6(s){PI=s}function Kv(s,t){let e=Array.from(s.childNodes).find(i=>i.hasAttribute&&i.hasAttribute(jm));e||(e=document.createElement("style"),e.setAttribute(jm,jm),s.appendChild(e)),e.textContent=":host{display:inline-block;vertical-align:"+(t?"-0.125em":"0")+"}span,svg{display:block}"+PI}function FI(){jv("",z6),gI(!0);let s;try{s=window}catch{}if(s){if(TI(),s.IconifyPreload!==void 0){const t=s.IconifyPreload,e="Invalid IconifyPreload syntax.";typeof t=="object"&&t!==null&&(t instanceof Array?t:[t]).forEach(i=>{try{(typeof i!="object"||i===null||i instanceof Array||typeof i.icons!="object"||typeof i.prefix!="string"||!$v(i))&&console.error(e)}catch{console.error(e)}})}if(s.IconifyProviders!==void 0){const t=s.IconifyProviders;if(typeof t=="object"&&t!==null)for(const e in t){const i="IconifyProviders["+e+"] is invalid.";try{const n=t[e];if(typeof n!="object"||!n||n.resources===void 0)continue;Yv(e,n)||console.error(i)}catch{console.error(i)}}}}return{enableCache:t=>Qv(t,!0),disableCache:t=>Qv(t,!1),iconLoaded:Hv,iconExists:Hv,getIcon:e6,listIcons:t6,addIcon:_I,addCollection:$v,calculateSize:g_,buildIcon:SI,iconToHTML:vb,svgToURL:OI,loadIcons:yb,loadIcon:b6,addAPIProvider:Yv,appendCustomStyle:U6,_api:{getAPIConfig:cf,setAPIModule:jv,sendAPIQuery:vI,setFetch:F6,getFetch:R6,listAPIProviders:h6}}}const __={"background-color":"currentColor"},RI={"background-color":"transparent"},Jv={image:"var(--svg)",repeat:"no-repeat",size:"100% 100%"},tw={"-webkit-mask":__,mask:__,background:RI};for(const s in tw){const t=tw[s];for(const e in Jv)t[s+"-"+e]=Jv[e]}function ew(s){return s?s+(s.match(/^[-0-9.]+$/)?"px":""):"inherit"}function B6(s,t,e){const i=document.createElement("span");let n=s.body;n.indexOf("<a")!==-1&&(n+="<!-- "+Date.now()+" -->");const r=s.attributes,o=vb(n,{...r,width:t.width+"",height:t.height+""}),a=OI(o),l=i.style,h={"--svg":a,width:ew(r.width),height:ew(r.height),...e?__:RI};for(const c in h)l.setProperty(c,h[c]);return i}let _c;function V6(){try{_c=window.trustedTypes.createPolicy("iconify",{createHTML:s=>s})}catch{_c=null}}function $6(s){return _c===void 0&&V6(),_c?_c.createHTML(s):s}function H6(s){const t=document.createElement("span"),e=s.attributes;let i="";e.width||(i="width: inherit;"),e.height||(i+="height: inherit;"),i&&(e.style=i);const n=vb(s.body,e);return t.innerHTML=$6(n),t.firstChild}function b_(s){return Array.from(s.childNodes).find(t=>{const e=t.tagName&&t.tagName.toUpperCase();return e==="SPAN"||e==="SVG"})}function sw(s,t){const e=t.icon.data,i=t.customisations,n=SI(e,i);i.preserveAspectRatio&&(n.attributes.preserveAspectRatio=i.preserveAspectRatio);const r=t.renderedMode;let o;switch(r){case"svg":o=H6(n);break;default:o=B6(n,{...Jc,...e},r==="mask")}const a=b_(s);a?o.tagName==="SPAN"&&a.tagName===o.tagName?a.setAttribute("style",o.getAttribute("style")):s.replaceChild(o,a):s.appendChild(o)}function iw(s,t,e){const i=e&&(e.rendered?e:e.lastRender);return{rendered:!1,inline:t,icon:s,lastRender:i}}function j6(s="iconify-icon"){let t,e;try{t=window.customElements,e=window.HTMLElement}catch{return}if(!t||!e)return;const i=t.get(s);if(i)return i;const n=["icon","mode","inline","observe","width","height","rotate","flip"],r=class extends e{constructor(){super(),Eo(this,"_shadowRoot"),Eo(this,"_initialised",!1),Eo(this,"_state"),Eo(this,"_checkQueued",!1),Eo(this,"_connected",!1),Eo(this,"_observer",null),Eo(this,"_visible",!0);const a=this._shadowRoot=this.attachShadow({mode:"open"}),l=Hm(this);Kv(a,l),this._state=iw({value:""},l),this._queueCheck()}connectedCallback(){this._connected=!0,this.startObserver()}disconnectedCallback(){this._connected=!1,this.stopObserver()}static get observedAttributes(){return n.slice(0)}attributeChangedCallback(a){switch(a){case"inline":{const l=Hm(this),h=this._state;l!==h.inline&&(h.inline=l,Kv(this._shadowRoot,l));break}case"observer":{this.observer?this.startObserver():this.stopObserver();break}default:this._queueCheck()}}get icon(){const a=this.getAttribute("icon");if(a&&a.slice(0,1)==="{")try{return JSON.parse(a)}catch{}return a}set icon(a){typeof a=="object"&&(a=JSON.stringify(a)),this.setAttribute("icon",a)}get inline(){return Hm(this)}set inline(a){a?this.setAttribute("inline","true"):this.removeAttribute("inline")}get observer(){return this.hasAttribute("observer")}set observer(a){a?this.setAttribute("observer","true"):this.removeAttribute("observer")}restartAnimation(){const a=this._state;if(a.rendered){const l=this._shadowRoot;if(a.renderedMode==="svg")try{l.lastChild.setCurrentTime(0);return}catch{}sw(l,a)}}get status(){const a=this._state;return a.rendered?"rendered":a.icon.data===null?"failed":"loading"}_queueCheck(){this._checkQueued||(this._checkQueued=!0,setTimeout(()=>{this._check()}))}_check(){if(!this._checkQueued)return;this._checkQueued=!1;const a=this._state,l=this.getAttribute("icon");if(l!==a.icon.value){this._iconChanged(l);return}if(!a.rendered||!this._visible)return;const h=this.getAttribute("mode"),c=Bv(this);(a.attrMode!==h||GD(a.customisations,c)||!b_(this._shadowRoot))&&this._renderIcon(a.icon,c,h)}_iconChanged(a){const l=v6(a,(h,c,u)=>{const p=this._state;if(p.rendered||this.getAttribute("icon")!==h)return;const d={value:h,name:c,data:u};d.data?this._gotIconData(d):p.icon=d});l.data?this._gotIconData(l):this._state=iw(l,this._state.inline,this._state)}_forceRender(){if(!this._visible){const a=b_(this._shadowRoot);a&&this._shadowRoot.removeChild(a);return}this._queueCheck()}_gotIconData(a){this._checkQueued=!1,this._renderIcon(a,Bv(this),this.getAttribute("mode"))}_renderIcon(a,l,h){const c=w6(a.data.body,h),u=this._state.inline;sw(this._shadowRoot,this._state={rendered:!0,icon:a,inline:u,customisations:l,attrMode:h,renderedMode:c})}startObserver(){if(!this._observer)try{this._observer=new IntersectionObserver(a=>{const l=a.some(h=>h.isIntersecting);l!==this._visible&&(this._visible=l,this._forceRender())}),this._observer.observe(this)}catch{if(this._observer){try{this._observer.disconnect()}catch{}this._observer=null}}}stopObserver(){this._observer&&(this._observer.disconnect(),this._observer=null,this._visible=!0,this._connected&&this._forceRender())}};n.forEach(a=>{a in r.prototype||Object.defineProperty(r.prototype,a,{get:function(){return this.getAttribute(a)},set:function(l){l!==null?this.setAttribute(a,l):this.removeAttribute(a)}})});const o=FI();for(const a in o)r[a]=r.prototype[a]=o[a];return t.define(s,r),r}j6()||FI();const Y6=oe`
  ::-webkit-scrollbar {
    width: 0.4rem;
    height: 0.4rem;
    overflow: hidden;
  }

  ::-webkit-scrollbar-thumb {
    border-radius: 0.25rem;
    background-color: var(
      --bim-scrollbar--c,
      color-mix(in lab, var(--bim-ui_main-base), white 15%)
    );
  }

  ::-webkit-scrollbar-track {
    background-color: var(--bim-scrollbar--bgc, var(--bim-ui_bg-base));
  }
`,W6=oe`
  :root {
    /* Grayscale Colors */
    --bim-ui_gray-0: hsl(210 10% 5%);
    --bim-ui_gray-1: hsl(210 10% 10%);
    --bim-ui_gray-2: hsl(210 10% 20%);
    --bim-ui_gray-3: hsl(210 10% 30%);
    --bim-ui_gray-4: hsl(210 10% 40%);
    --bim-ui_gray-6: hsl(210 10% 60%);
    --bim-ui_gray-7: hsl(210 10% 70%);
    --bim-ui_gray-8: hsl(210 10% 80%);
    --bim-ui_gray-9: hsl(210 10% 90%);
    --bim-ui_gray-10: hsl(210 10% 95%);

    /* Brand Colors */
    --bim-ui_main-base: #6528d7;
    --bim-ui_accent-base: #bcf124;

    /* Brand Colors Contrasts */
    --bim-ui_main-contrast: var(--bim-ui_gray-10);
    --bim-ui_accent-contrast: var(--bim-ui_gray-0);

    /* Sizes */
    --bim-ui_size-4xs: 0.375rem;
    --bim-ui_size-3xs: 0.5rem;
    --bim-ui_size-2xs: 0.625rem;
    --bim-ui_size-xs: 0.75rem;
    --bim-ui_size-sm: 0.875rem;
    --bim-ui_size-base: 1rem;
    --bim-ui_size-lg: 1.125rem;
    --bim-ui_size-xl: 1.25rem;
    --bim-ui_size-2xl: 1.375rem;
    --bim-ui_size-3xl: 1.5rem;
    --bim-ui_size-4xl: 1.625rem;
    --bim-ui_size-5xl: 1.75rem;
    --bim-ui_size-6xl: 1.875rem;
    --bim-ui_size-7xl: 2rem;
    --bim-ui_size-8xl: 2.125rem;
    --bim-ui_size-9xl: 2.25rem;
  }

  /* Background Colors */
  @media (prefers-color-scheme: dark) {
    :root {
      --bim-ui_bg-base: var(--bim-ui_gray-0);
      --bim-ui_bg-contrast-10: var(--bim-ui_gray-1);
      --bim-ui_bg-contrast-20: var(--bim-ui_gray-2);
      --bim-ui_bg-contrast-30: var(--bim-ui_gray-3);
      --bim-ui_bg-contrast-40: var(--bim-ui_gray-4);
      --bim-ui_bg-contrast-60: var(--bim-ui_gray-6);
      --bim-ui_bg-contrast-80: var(--bim-ui_gray-8);
      --bim-ui_bg-contrast-100: var(--bim-ui_gray-10);
    }
  }

  @media (prefers-color-scheme: light) {
    :root {
      --bim-ui_bg-base: var(--bim-ui_gray-10);
      --bim-ui_bg-contrast-10: var(--bim-ui_gray-9);
      --bim-ui_bg-contrast-20: var(--bim-ui_gray-8);
      --bim-ui_bg-contrast-30: var(--bim-ui_gray-7);
      --bim-ui_bg-contrast-40: var(--bim-ui_gray-6);
      --bim-ui_bg-contrast-60: var(--bim-ui_gray-4);
      --bim-ui_bg-contrast-80: var(--bim-ui_gray-2);
      --bim-ui_bg-contrast-100: var(--bim-ui_gray-0);
      --bim-ui_accent-base: #6528d7;
    }
  }

  .theme-transition-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    filter: drop-shadow(0 0 10px var(--bim-ui_bg-base));
    z-index: 9999;
  }

  .theme-transition-overlay > div {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--bim-ui_bg-base);
  }

  html.bim-ui-dark {
    --bim-ui_bg-base: var(--bim-ui_gray-0);
    --bim-ui_bg-contrast-10: var(--bim-ui_gray-1);
    --bim-ui_bg-contrast-20: var(--bim-ui_gray-2);
    --bim-ui_bg-contrast-30: var(--bim-ui_gray-3);
    --bim-ui_bg-contrast-40: var(--bim-ui_gray-4);
    --bim-ui_bg-contrast-60: var(--bim-ui_gray-6);
    --bim-ui_bg-contrast-80: var(--bim-ui_gray-8);
    --bim-ui_bg-contrast-100: var(--bim-ui_gray-10);
  }

  html.bim-ui-light {
    --bim-ui_bg-base: var(--bim-ui_gray-10);
    --bim-ui_bg-contrast-10: var(--bim-ui_gray-9);
    --bim-ui_bg-contrast-20: var(--bim-ui_gray-8);
    --bim-ui_bg-contrast-30: var(--bim-ui_gray-7);
    --bim-ui_bg-contrast-40: var(--bim-ui_gray-6);
    --bim-ui_bg-contrast-60: var(--bim-ui_gray-4);
    --bim-ui_bg-contrast-80: var(--bim-ui_gray-2);
    --bim-ui_bg-contrast-100: var(--bim-ui_gray-0);
    --bim-ui_accent-base: #6528d7;
  }

  @keyframes toggleOverlay {
    0%,
    99% {
      display: block;
    }

    100% {
      display: none;
    }
  }

  @keyframes toggleThemeAnimation {
    0% {
      clip-path: circle(0% at center top);
    }
    45%,
    55% {
      clip-path: circle(150% at center center);
    }
    100% {
      clip-path: circle(0% at center bottom);
    }
  }

  [data-context-dialog]::backdrop {
    background-color: transparent;
  }
`,uo={scrollbar:Y6,globalStyles:W6},LI=class Kt{static set config(t){this._config={...Kt._config,...t}}static get config(){return Kt._config}static addGlobalStyles(){let t=document.querySelector("style[id='bim-ui']");if(t)return;t=document.createElement("style"),t.id="bim-ui",t.textContent=uo.globalStyles.cssText;const e=document.head.firstChild;e?document.head.insertBefore(t,e):document.head.append(t)}static defineCustomElement(t,e){customElements.get(t)||customElements.define(t,e)}static registerComponents(){Kt.init()}static init(t="",e=!0){Kt.addGlobalStyles(),Kt.defineCustomElement("bim-button",K6),Kt.defineCustomElement("bim-checkbox",Bl),Kt.defineCustomElement("bim-color-input",po),Kt.defineCustomElement("bim-context-menu",Sp),Kt.defineCustomElement("bim-dropdown",Gn),Kt.defineCustomElement("bim-grid",Eb),Kt.defineCustomElement("bim-icon",ok),Kt.defineCustomElement("bim-input",su),Kt.defineCustomElement("bim-label",Vl),Kt.defineCustomElement("bim-number-input",vi),Kt.defineCustomElement("bim-option",ns),Kt.defineCustomElement("bim-panel",ha),Kt.defineCustomElement("bim-panel-section",$l),Kt.defineCustomElement("bim-selector",Hl),Kt.defineCustomElement("bim-table",wi),Kt.defineCustomElement("bim-tabs",mr),Kt.defineCustomElement("bim-tab",li),Kt.defineCustomElement("bim-table-cell",qI),Kt.defineCustomElement("bim-table-children",yk),Kt.defineCustomElement("bim-table-group",QI),Kt.defineCustomElement("bim-table-row",jl),Kt.defineCustomElement("bim-text-input",si),Kt.defineCustomElement("bim-toolbar",gf),Kt.defineCustomElement("bim-toolbar-group",ff),Kt.defineCustomElement("bim-toolbar-section",Wl),Kt.defineCustomElement("bim-viewport",lx),e&&this.animateOnLoad(t)}static newRandomId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let i=0;i<10;i++){const n=Math.floor(Math.random()*t.length);e+=t.charAt(n)}return e}static animateOnLoad(t=""){const e=`
      bim-input,
      bim-button,
      bim-checkbox,
      bim-selector,
      bim-label,
      bim-table-row,
      bim-panel-section,
      bim-table-children .branch-vertical,
      .switchers
    `,i=[];function n(r,o=document,a=new Set){const l=[];return Array.from(o.querySelectorAll(r)).forEach(h=>{a.has(h)||(a.add(h),l.push(h))}),Array.from(o.querySelectorAll("*")).filter(h=>h.shadowRoot).forEach(h=>{a.has(h)||(a.add(h),l.push(...n(r,h.shadowRoot,a)))}),l}requestAnimationFrame(()=>{n(t||e).forEach(o=>{const a=o;let l="auto";l=window.getComputedStyle(a).getPropertyValue("transition"),a.style.setProperty("opacity","0"),a.style.setProperty("transition","none"),requestAnimationFrame(()=>{a.style.setProperty("transition",l)}),i.push(a)});const r=()=>{i.forEach(o=>{const a=o,l=(a.getBoundingClientRect().x+a.getBoundingClientRect().y)/(window.innerWidth+window.innerHeight),h=window.getComputedStyle(a).getPropertyValue("transform"),c=400,u=200+l*1e3;a.animate([{transform:"translateY(-20px)",opacity:"0"},{transform:"translateY(0)",opacity:"1"}],{duration:c,easing:"ease-in-out",delay:u}),setTimeout(()=>{a.style.removeProperty("opacity"),h!=="none"?a.style.setProperty("transform",h):a.style.removeProperty("transform")},u+c)})};document.readyState==="complete"?r():window.addEventListener("load",r)})}static toggleTheme(t=!0){const e=document.querySelector("html");if(!e)return;const i=()=>{e.classList.contains("bim-ui-dark")?e.classList.replace("bim-ui-dark","bim-ui-light"):e.classList.contains("bim-ui-light")?e.classList.replace("bim-ui-light","bim-ui-dark"):e.classList.add("bim-ui-light")};if(t){const n=document.createElement("div");n.classList.add("theme-transition-overlay");const r=document.createElement("div");n.appendChild(r),r.style.setProperty("transition",`background-color ${1e3/3200}s`),document.body.appendChild(n),n.style.setProperty("animation",`toggleOverlay ${1e3/1e3}s ease-in forwards`),r.style.setProperty("animation",`toggleThemeAnimation ${1e3/1e3}s ease forwards`),setTimeout(()=>{i()},1e3/4),setTimeout(()=>{document.body.querySelectorAll(".theme-transition-overlay").forEach(o=>{document.body.removeChild(o)})},1e3)}else i()}};LI._config={sectionLabelOnVerticalToolbar:!1};let Os=LI;class Es extends ie{constructor(){super(...arguments),this._lazyLoadObserver=null,this._visibleElements=[],this.ELEMENTS_BEFORE_OBSERVER=20,this.useObserver=!1,this.elements=new Set,this.observe=t=>{if(!this.useObserver)return;for(const i of t)this.elements.add(i);const e=t.slice(this.ELEMENTS_BEFORE_OBSERVER);for(const i of e)i.remove();this.observeLastElement()}}set visibleElements(t){this._visibleElements=this.useObserver?t:[],this.requestUpdate()}get visibleElements(){return this._visibleElements}getLazyObserver(){if(!this.useObserver)return null;if(this._lazyLoadObserver)return this._lazyLoadObserver;const t=new IntersectionObserver(e=>{const i=e[0];if(!i.isIntersecting)return;const n=i.target;t.unobserve(n);const r=this.ELEMENTS_BEFORE_OBSERVER+this.visibleElements.length,o=[...this.elements][r];o&&(this.visibleElements=[...this.visibleElements,o],t.observe(o))},{threshold:.5});return t}observeLastElement(){const t=this.getLazyObserver();if(!t)return;const e=this.ELEMENTS_BEFORE_OBSERVER+this.visibleElements.length-1,i=[...this.elements][e];i&&t.observe(i)}resetVisibleElements(){const t=this.getLazyObserver();if(t){for(const e of this.elements)t.unobserve(e);this.visibleElements=[],this.observeLastElement()}}static create(t,e){const i=document.createDocumentFragment();if(t.length===0)return Pl(t(),i),i.firstElementChild;if(!e)throw new Error("UIComponent: Initial state is required for statefull components.");let n=e;const r=t,o=l=>(n={...n,...l},Pl(r(n,o),i),n);o(e);const a=()=>n;return[i.firstElementChild,o,a]}}const Uc=(s,t={},e=!0)=>{let i={};for(const n of s.children){const r=n,o=r.getAttribute("name")||r.getAttribute("label"),a=o?t[o]:void 0;if(o){if("value"in r&&typeof r.value<"u"&&r.value!==null){const l=r.value;if(typeof l=="object"&&!Array.isArray(l)&&Object.keys(l).length===0)continue;i[o]=a?a(r.value):r.value}else if(e){const l=Uc(r,t);if(Object.keys(l).length===0)continue;i[o]=a?a(l):l}}else e&&(i={...i,...Uc(r,t)})}return i},uf=s=>s==="true"||s==="false"?s==="true":s&&!isNaN(Number(s))&&s.trim()!==""?Number(s):s,G6=[">=","<=","=",">","<","?","/","#"];function nw(s){const t=G6.find(o=>s.split(o).length===2),e=s.split(t).map(o=>o.trim()),[i,n]=e,r=n.startsWith("'")&&n.endsWith("'")?n.replace(/'/g,""):uf(n);return{key:i,condition:t,value:r}}const y_=s=>{try{const t=[],e=s.split(/&(?![^()]*\))/).map(i=>i.trim());for(const i of e){const n=!i.startsWith("(")&&!i.endsWith(")"),r=i.startsWith("(")&&i.endsWith(")");if(n){const o=nw(i);t.push(o)}if(r){const o={operator:"&",queries:i.replace(/^(\()|(\))$/g,"").split("&").map(a=>a.trim()).map((a,l)=>{const h=nw(a);return l>0&&(h.operator="&"),h})};t.push(o)}}return t}catch{return null}},rw=(s,t,e)=>{let i=!1;switch(t){case"=":i=s===e;break;case"?":i=String(s).includes(String(e));break;case"<":(typeof s=="number"||typeof e=="number")&&(i=s<e);break;case"<=":(typeof s=="number"||typeof e=="number")&&(i=s<=e);break;case">":(typeof s=="number"||typeof e=="number")&&(i=s>e);break;case">=":(typeof s=="number"||typeof e=="number")&&(i=s>=e);break;case"/":i=String(s).startsWith(String(e));break}return i};var q6=Object.defineProperty,Z6=Object.getOwnPropertyDescriptor,NI=(s,t,e,i)=>{for(var n=Z6(t,e),r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&q6(t,e,n),n},Qe;const wb=(Qe=class extends ie{constructor(){super(...arguments),this._previousContainer=null,this._visible=!1}get placement(){return this._placement}set placement(s){this._placement=s,this.updatePosition()}static removeMenus(){for(const s of Qe.menus)s instanceof Qe&&(s.visible=!1);setTimeout(()=>{Qe.dialog.close(),Qe.dialog.remove()},310)}get visible(){return this._visible}set visible(s){this._visible=s,s?(Qe.dialog.parentElement||document.body.append(Qe.dialog),this._previousContainer=this.parentElement,Qe.dialog.style.top=`${window.scrollY||document.documentElement.scrollTop}px`,this.style.setProperty("display","flex"),Qe.dialog.append(this),Qe.dialog.showModal(),this.updatePosition(),this.dispatchEvent(new Event("visible"))):setTimeout(()=>{var t;(t=this._previousContainer)==null||t.append(this),this._previousContainer=null,this.style.setProperty("display","none"),this.dispatchEvent(new Event("hidden"))},310)}async updatePosition(){if(!(this.visible&&this._previousContainer))return;const s=this.placement??"right",t=await eI(this._previousContainer,this,{placement:s,middleware:[VC(10),tI(),JC(),KC({padding:5})]}),{x:e,y:i}=t;this.style.left=`${e}px`,this.style.top=`${i}px`}connectedCallback(){super.connectedCallback(),Qe.menus.push(this),this.visible?(this.style.setProperty("width","auto"),this.style.setProperty("height","auto")):(this.style.setProperty("display","none"),this.style.setProperty("width","0"),this.style.setProperty("height","0"))}render(){return ct` <slot></slot> `}},Qe.styles=[uo.scrollbar,oe`
      :host {
        pointer-events: auto;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 999;
        overflow: auto;
        max-height: 20rem;
        min-width: 3rem;
        flex-direction: column;
        box-shadow: 1px 2px 8px 2px rgba(0, 0, 0, 0.15);
        padding: 0.5rem;
        border-radius: var(--bim-ui_size-4xs);
        display: flex;
        transform-origin: top left;
        transform: scale(1);
        clip-path: circle(150% at top left);
        background-color: var(--bim-ui_bg-contrast-20);
        transition:
          clip-path 0.2s cubic-bezier(0.72, 0.1, 0.43, 0.93),
          transform 0.3s cubic-bezier(0.72, 0.1, 0.45, 2.35);
      }

      :host(:not([visible])) {
        transform: scale(0.8);
        clip-path: circle(0 at top left);
      }
    `],Qe.dialog=Es.create(()=>ct` <dialog
      @click=${s=>{s.target===Qe.dialog&&Qe.removeMenus()}}
      @cancel=${()=>Qe.removeMenus()}
      data-context-dialog
      style="
      width: 0;
      height: 0;
      position: relative;
      padding: 0;
      border: none;
      outline: none;
      margin: none;
      overflow: visible;
      background-color: transparent;
    "
    ></dialog>`),Qe.menus=[],Qe);NI([ut({type:String,reflect:!0})],wb.prototype,"placement");NI([ut({type:Boolean,reflect:!0})],wb.prototype,"visible");let Sp=wb;var X6=Object.defineProperty,Q6=Object.getOwnPropertyDescriptor,un=(s,t,e,i)=>{for(var n=i>1?void 0:i?Q6(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&X6(t,e,n),n},Ah;const Hi=(Ah=class extends ie{constructor(){super(),this.labelHidden=!1,this.active=!1,this.disabled=!1,this.vertical=!1,this.tooltipVisible=!1,this._stateBeforeLoading={disabled:!1,icon:""},this._loading=!1,this._parent=Fl(),this._tooltip=Fl(),this._mouseLeave=!1,this.onClick=s=>{s.stopPropagation(),this.disabled||this.dispatchEvent(new Event("click"))},this.showContextMenu=()=>{const s=this._contextMenu;if(s){const t=this.getAttribute("data-context-group");t&&s.setAttribute("data-context-group",t),this.closeNestedContexts();const e=Os.newRandomId();for(const i of s.children)i instanceof Ah&&i.setAttribute("data-context-group",e);s.visible=!0}},this.mouseLeave=!0}set loading(s){if(this._loading=s,s)this._stateBeforeLoading={disabled:this.disabled,icon:this.icon},this.disabled=s,this.icon="eos-icons:loading";else{const{disabled:t,icon:e}=this._stateBeforeLoading;this.disabled=t,this.icon=e}}get loading(){return this._loading}set mouseLeave(s){this._mouseLeave=s,s&&(this.tooltipVisible=!1,clearTimeout(this.timeoutID))}get mouseLeave(){return this._mouseLeave}computeTooltipPosition(){const{value:s}=this._parent,{value:t}=this._tooltip;s&&t&&eI(s,t,{placement:"bottom",middleware:[VC(10),tI(),JC(),KC({padding:5})]}).then(e=>{const{x:i,y:n}=e;Object.assign(t.style,{left:`${i}px`,top:`${n}px`})})}onMouseEnter(){if(!(this.tooltipTitle||this.tooltipText))return;this.mouseLeave=!1;const s=this.tooltipTime??700;this.timeoutID=setTimeout(()=>{this.mouseLeave||(this.computeTooltipPosition(),this.tooltipVisible=!0)},s)}closeNestedContexts(){const s=this.getAttribute("data-context-group");if(s)for(const t of Sp.dialog.children){const e=t.getAttribute("data-context-group");if(t instanceof Sp&&e===s){t.visible=!1,t.removeAttribute("data-context-group");for(const i of t.children)i instanceof Ah&&(i.closeNestedContexts(),i.removeAttribute("data-context-group"))}}}click(){this.disabled||super.click()}get _contextMenu(){return this.querySelector("bim-context-menu")}connectedCallback(){super.connectedCallback(),this.addEventListener("click",this.showContextMenu)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("click",this.showContextMenu)}render(){const s=ct`
      <div ${ti(this._tooltip)} class="tooltip">
        ${this.tooltipTitle?ct`<p style="text-wrap: nowrap;">
              <strong>${this.tooltipTitle}</strong>
            </p>`:null}
        ${this.tooltipText?ct`<p style="width: 9rem;">${this.tooltipText}</p>`:null}
      </div>
    `,t=ct`<svg
      xmlns="http://www.w3.org/2000/svg"
      height="1.125rem"
      viewBox="0 0 24 24"
      width="1.125rem"
      style="fill: var(--bim-label--c)"
    >
      <path d="M0 0h24v24H0V0z" fill="none" />
      <path d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
    </svg>`;return ct`
      <div ${ti(this._parent)} class="parent" @click=${this.onClick}>
        ${this.label||this.icon?ct`
              <div
                class="button"
                @mouseenter=${this.onMouseEnter}
                @mouseleave=${()=>this.mouseLeave=!0}
              >
                <bim-label
                  .icon=${this.icon}
                  .vertical=${this.vertical}
                  .labelHidden=${this.labelHidden}
                  >${this.label}${this.label&&this._contextMenu?t:null}</bim-label
                >
              </div>
            `:null}
        ${this.tooltipTitle||this.tooltipText?s:null}
      </div>
      <slot></slot>
    `}},Ah.styles=oe`
    :host {
      --bim-label--c: var(--bim-ui_bg-contrast-100, white);
      position: relative;
      display: block;
      flex: 1;
      pointer-events: none;
      background-color: var(--bim-button--bgc, var(--bim-ui_bg-contrast-20));
      border-radius: var(--bim-ui_size-4xs);
      transition: all 0.15s;
    }

    :host(:not([disabled]))::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: inherit;
      background-color: var(--bim-ui_main-base);
      clip-path: circle(0 at center center);
      box-sizing: border-box;
      transition:
        clip-path 0.3s cubic-bezier(0.65, 0.05, 0.36, 1),
        transform 0.15s;
    }

    :host(:not([disabled]):hover) {
      cursor: pointer;
    }

    bim-label {
      pointer-events: none;
    }

    .parent {
      --bim-icon--c: var(--bim-label--c);
      position: relative;
      display: flex;
      height: 100%;
      user-select: none;
      row-gap: 0.125rem;
      min-height: var(--bim-ui_size-5xl);
      min-width: var(--bim-ui_size-5xl);
    }

    .button,
    .children {
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
    }

    .children {
      padding: 0 0.375rem;
      position: absolute;
      height: 100%;
      right: 0;
    }

    :host(:not([label-hidden])[icon][vertical]) .parent {
      min-height: 2.5rem;
    }

    .button {
      flex-grow: 1;
      transition: transform 0.15s;
    }

    :host(:not([label-hidden])[label]) .button {
      justify-content: var(--bim-button--jc, center);
    }

    :host(:hover)::before {
      clip-path: circle(120% at center center);
    }

    :host(:hover) {
      --bim-label--c: var(--bim-ui_main-contrast);
      z-index: 2;
    }

    :host([active]) {
      background-color: var(--bim-ui_main-base);
    }

    :host(:not([disabled]):active) {
      background: transparent;
    }

    :host(:not([disabled]):active) .button,
    :host(:not([disabled]):active)::before {
      transform: scale(0.98);
    }

    :host(:not([label]):not([icon])) .children {
      flex: 1;
    }

    :host([vertical]) .parent {
      justify-content: center;
    }

    :host(:not([label-hidden])[label]) .button {
      padding: 0 0.5rem;
    }

    :host([disabled]) {
      --bim-label--c: var(--bim-ui_bg-contrast-80) !important;
      background-color: gray !important;
    }

    ::slotted(bim-button) {
      --bim-icon--fz: var(--bim-ui_size-base);
      --bim-button--bdrs: var(--bim-ui_size-4xs);
      --bim-button--olw: 0;
      --bim-button--olc: transparent;
    }

    .tooltip {
      position: absolute;
      padding: 0.75rem;
      z-index: 99;
      display: flex;
      flex-flow: column;
      row-gap: 0.375rem;
      box-shadow: 0 0 10px 3px rgba(0 0 0 / 20%);
      outline: 1px solid var(--bim-ui_bg-contrast-40);
      font-size: var(--bim-ui_size-xs);
      border-radius: var(--bim-ui_size-4xs);
      background-color: var(--bim-ui_bg-contrast-20);
      color: var(--bim-ui_bg-contrast-100);
      animation: openTooltips 0.15s ease-out forwards;
      transition: visibility 0.2s;
    }

    .tooltip p {
      margin: 0;
      padding: 0;
    }

    :host(:not([tooltip-visible])) .tooltip {
      animation: closeTooltips 0.15s ease-in forwards;
      visibility: hidden;
      display: none;
    }

    @keyframes closeTooltips {
      0% {
        display: flex;
        padding: 0.75rem;
        transform: translateY(0);
        opacity: 1;
      }
      90% {
        padding: 0.75rem;
      }
      100% {
        display: none;
        padding: 0;
        transform: translateY(-10px);
        opacity: 0;
      }
    }

    @keyframes openTooltips {
      0% {
        display: flex;
        transform: translateY(-10px);
        opacity: 0;
      }
      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }
  `,Ah);un([ut({type:String,reflect:!0})],Hi.prototype,"label",2);un([ut({type:Boolean,attribute:"label-hidden",reflect:!0})],Hi.prototype,"labelHidden",2);un([ut({type:Boolean,reflect:!0})],Hi.prototype,"active",2);un([ut({type:Boolean,reflect:!0,attribute:"disabled"})],Hi.prototype,"disabled",2);un([ut({type:String,reflect:!0})],Hi.prototype,"icon",2);un([ut({type:Boolean,reflect:!0})],Hi.prototype,"vertical",2);un([ut({type:Number,attribute:"tooltip-time",reflect:!0})],Hi.prototype,"tooltipTime",2);un([ut({type:Boolean,attribute:"tooltip-visible",reflect:!0})],Hi.prototype,"tooltipVisible",2);un([ut({type:String,attribute:"tooltip-title",reflect:!0})],Hi.prototype,"tooltipTitle",2);un([ut({type:String,attribute:"tooltip-text",reflect:!0})],Hi.prototype,"tooltipText",2);un([ut({type:Boolean,reflect:!0})],Hi.prototype,"loading",1);let K6=Hi;var J6=Object.defineProperty,eu=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&J6(t,e,n),n};const MI=class extends ie{constructor(){super(...arguments),this.checked=!1,this.inverted=!1,this.onValueChange=new Event("change")}get value(){return this.checked}onChange(s){s.stopPropagation(),this.checked=s.target.checked,this.dispatchEvent(this.onValueChange)}render(){const s=ct`
      <svg viewBox="0 0 21 21">
        <polyline points="5 10.75 8.5 14.25 16 6"></polyline>
      </svg>
    `;return ct`
      <div class="parent">
        <label class="parent-label">
          ${this.label?ct`<bim-label .icon="${this.icon}">${this.label}</bim-label> `:null}
          <div class="input-container">
            <input
              type="checkbox"
              aria-label=${this.label||this.name||"Checkbox Input"}
              @change="${this.onChange}"
              .checked="${this.checked}"
            />
            ${s}
          </div>
        </label>
      </div>
    `}};MI.styles=oe`
    :host {
      display: block;
    }

    .parent-label {
      --background: #fff;
      --border: #dfdfe6;
      --stroke: #fff;
      --border-hover: var(--bim-ui_main-base);
      --border-active: var(--bim-ui_main-base);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      width: 100%;
      height: 1.75rem;
      column-gap: 0.25rem;
      position: relative;
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }

    :host([inverted]) .parent-label {
      flex-direction: row-reverse;
      justify-content: start;
    }

    input,
    svg {
      width: 1rem;
      height: 1rem;
      display: block;
    }

    input {
      -webkit-appearance: none;
      -moz-appearance: none;
      position: relative;
      outline: none;
      background: var(--background);
      border: none;
      margin: 0;
      padding: 0;
      cursor: pointer;
      border-radius: 4px;
      transition: box-shadow 0.3s;
      box-shadow: inset 0 0 0 var(--s, 1px) var(--b, var(--border));
    }

    svg {
      pointer-events: none;
      fill: none;
      stroke-width: 2.2px;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke: var(--stroke, var(--border-active));
      transform: translateY(-100%) scale(0);
      position: absolute;
      width: 1rem;
      height: 1rem;
    }

    input:hover {
      --s: 2px;
      --b: var(--border-hover);
    }

    input:checked {
      --b: var(--border-active);
      --s: 11px;
    }

    input:checked + svg {
      -webkit-animation: bounce 0.4s linear forwards 0.2s;
      animation: bounce 0.4s linear forwards 0.2s;
    }

    @keyframes bounce {
      0% {
        transform: translateY(-100%) scale(0);
      }
      50% {
        transform: translateY(-100%) scale(1.2);
      }
      75% {
        transform: translateY(-100%) scale(0.9);
      }
      100% {
        transform: translateY(-100%) scale(1);
      }
    }
  `;let Bl=MI;eu([ut({type:String,reflect:!0})],Bl.prototype,"icon");eu([ut({type:String,reflect:!0})],Bl.prototype,"name");eu([ut({type:String,reflect:!0})],Bl.prototype,"label");eu([ut({type:Boolean,reflect:!0})],Bl.prototype,"checked");eu([ut({type:Boolean,reflect:!0})],Bl.prototype,"inverted");var tk=Object.defineProperty,la=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&tk(t,e,n),n};const DI=class extends ie{constructor(){super(...arguments),this.vertical=!1,this.color="#bcf124",this.disabled=!1,this._colorInput=Fl(),this._textInput=Fl(),this.onValueChange=new Event("input"),this.onOpacityInput=s=>{const t=s.target;this.opacity=t.value,this.dispatchEvent(this.onValueChange)}}set value(s){const{color:t,opacity:e}=s;this.color=t,e&&(this.opacity=e)}get value(){const s={color:this.color};return this.opacity&&(s.opacity=this.opacity),s}onColorInput(s){s.stopPropagation();const{value:t}=this._colorInput;t&&(this.color=t.value,this.dispatchEvent(this.onValueChange))}onTextInput(s){s.stopPropagation();const{value:t}=this._textInput;if(!t)return;const{value:e}=t;let i=e.replace(/[^a-fA-F0-9]/g,"");i.startsWith("#")||(i=`#${i}`),t.value=i.slice(0,7),t.value.length===7&&(this.color=t.value,this.dispatchEvent(this.onValueChange))}focus(){const{value:s}=this._colorInput;s&&s.click()}render(){return ct`
      <div class="parent">
        <bim-input
          .label=${this.label}
          .icon=${this.icon}
          .vertical="${this.vertical}"
        >
          <div class="color-container">
            <div
              style="display: flex; align-items: center; gap: .375rem; height: 100%; flex: 1; padding: 0 0.5rem;"
            >
              <input
                ${ti(this._colorInput)}
                @input="${this.onColorInput}"
                type="color"
                aria-label=${this.label||this.name||"Color Input"}
                value="${this.color}"
                ?disabled=${this.disabled}
              />
              <div
                @click=${this.focus}
                class="sample"
                style="background-color: ${this.color}"
              ></div>
              <input
                ${ti(this._textInput)}
                @input="${this.onTextInput}"
                value="${this.color}"
                type="text"
                aria-label=${this.label||this.name||"Text Color Input"}
                ?disabled=${this.disabled}
              />
            </div>
            ${this.opacity!==void 0?ct`<bim-number-input
                  @change=${this.onOpacityInput}
                  slider
                  suffix="%"
                  min="0"
                  value=${this.opacity}
                  max="100"
                ></bim-number-input>`:null}
          </div>
        </bim-input>
      </div>
    `}};DI.styles=oe`
    :host {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
      flex: 1;
      display: block;
    }

    :host(:focus) {
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(--bim-ui_accent-base);
    }

    .parent {
      display: flex;
      gap: 0.375rem;
    }

    .color-container {
      position: relative;
      outline: none;
      display: flex;
      height: 100%;
      gap: 0.5rem;
      justify-content: flex-start;
      align-items: center;
      flex: 1;
      border-radius: var(--bim-color-input--bdrs, var(--bim-ui_size-4xs));
    }

    .color-container input[type="color"] {
      position: absolute;
      bottom: -0.25rem;
      visibility: hidden;
      width: 0;
      height: 0;
    }

    .color-container .sample {
      width: 1rem;
      height: 1rem;
      border-radius: 0.125rem;
      background-color: #fff;
    }

    .color-container input[type="text"] {
      height: 100%;
      flex: 1;
      width: 3.25rem;
      text-transform: uppercase;
      font-size: 0.75rem;
      background-color: transparent;
      padding: 0%;
      outline: none;
      border: none;
      color: var(--bim-color-input--c, var(--bim-ui_bg-contrast-100));
    }

    :host([disabled]) .color-container input[type="text"] {
      color: var(--bim-ui_bg-contrast-60);
    }

    bim-number-input {
      flex-grow: 0;
    }
  `;let po=DI;la([ut({type:String,reflect:!0})],po.prototype,"name");la([ut({type:String,reflect:!0})],po.prototype,"label");la([ut({type:String,reflect:!0})],po.prototype,"icon");la([ut({type:Boolean,reflect:!0})],po.prototype,"vertical");la([ut({type:Number,reflect:!0})],po.prototype,"opacity");la([ut({type:String,reflect:!0})],po.prototype,"color");la([ut({type:Boolean,reflect:!0})],po.prototype,"disabled");var ek=Object.defineProperty,sk=Object.getOwnPropertyDescriptor,fo=(s,t,e,i)=>{for(var n=i>1?void 0:i?sk(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&ek(t,e,n),n};const kI=class extends ie{constructor(){super(...arguments),this.checked=!1,this.checkbox=!1,this.noMark=!1,this.vertical=!1}get value(){return this._value!==void 0?this._value:this.label?uf(this.label):this.label}set value(s){this._value=s}render(){return ct`
      <div class="parent" .title=${this.label??""}>
        ${this.img||this.icon||this.label?ct` <div style="display: flex; column-gap: 0.375rem">
              ${this.checkbox&&!this.noMark?ct`<bim-checkbox
                    style="pointer-events: none"
                    .checked=${this.checked}
                  ></bim-checkbox>`:null}
              <bim-label
                .vertical=${this.vertical}
                .icon=${this.icon}
                .img=${this.img}
                >${this.label}</bim-label
              >
            </div>`:null}
        ${!this.checkbox&&!this.noMark&&this.checked?ct`<svg
              xmlns="http://www.w3.org/2000/svg"
              height="1.125rem"
              viewBox="0 0 24 24"
              width="1.125rem"
              fill="#FFFFFF"
            >
              <path d="M0 0h24v24H0z" fill="none" />
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
            </svg>`:null}
        <slot></slot>
      </div>
    `}};kI.styles=oe`
    :host {
      --bim-label--c: var(--bim-ui_bg-contrast-100);
      display: block;
      box-sizing: border-box;
      flex: 1;
      padding: 0rem 0.5rem;
      border-radius: var(--bim-ui_size-4xs);
      transition: all 0.15s;
    }

    :host(:hover) {
      cursor: pointer;
    }

    :host([checked]) {
      --bim-label--c: color-mix(in lab, var(--bim-ui_main-base), white 30%);
    }

    :host([checked]) svg {
      fill: color-mix(in lab, var(--bim-ui_main-base), white 30%);
    }

    .parent {
      box-sizing: border-box;
      display: flex;
      justify-content: var(--bim-option--jc, space-between);
      column-gap: 0.5rem;
      align-items: center;
      min-height: 1.75rem;
      height: 100%;
    }

    input {
      height: 1rem;
      width: 1rem;
      cursor: pointer;
      border: none;
      outline: none;
      accent-color: var(--bim-checkbox--c, var(--bim-ui_main-base));
    }

    input:focus {
      outline: var(--bim-checkbox--olw, 2px) solid
        var(--bim-checkbox--olc, var(--bim-ui_accent-base));
    }

    bim-label {
      pointer-events: none;
      z-index: 1;
    }
  `;let ns=kI;fo([ut({type:String,reflect:!0})],ns.prototype,"img",2);fo([ut({type:String,reflect:!0})],ns.prototype,"label",2);fo([ut({type:String,reflect:!0})],ns.prototype,"icon",2);fo([ut({type:Boolean,reflect:!0})],ns.prototype,"checked",2);fo([ut({type:Boolean,reflect:!0})],ns.prototype,"checkbox",2);fo([ut({type:Boolean,attribute:"no-mark",reflect:!0})],ns.prototype,"noMark",2);fo([ut({converter:{fromAttribute(s){return s&&uf(s)}}})],ns.prototype,"value",1);fo([ut({type:Boolean,reflect:!0})],ns.prototype,"vertical",2);var ik=Object.defineProperty,nk=Object.getOwnPropertyDescriptor,vr=(s,t,e,i)=>{for(var n=i>1?void 0:i?nk(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&ik(t,e,n),n};const zI=class extends Es{constructor(){super(),this.multiple=!1,this.required=!1,this.vertical=!1,this._visible=!1,this._value=new Set,this.onValueChange=new Event("change"),this._contextMenu=Fl(),this.onOptionClick=s=>{const t=s.target,e=this._value.has(t);if(!this.multiple&&!this.required&&!e)this._value=new Set([t]);else if(!this.multiple&&!this.required&&e)this._value=new Set([]);else if(!this.multiple&&this.required&&!e)this._value=new Set([t]);else if(this.multiple&&!this.required&&!e)this._value=new Set([...this._value,t]);else if(this.multiple&&!this.required&&e){const i=[...this._value].filter(n=>n!==t);this._value=new Set(i)}else if(this.multiple&&this.required&&!e)this._value=new Set([...this._value,t]);else if(this.multiple&&this.required&&e){const i=[...this._value].filter(r=>r!==t),n=new Set(i);n.size!==0&&(this._value=n)}this.updateOptionsState(),this.dispatchEvent(this.onValueChange)},this.useObserver=!0}set visible(s){if(s){const{value:t}=this._contextMenu;if(!t)return;for(const e of this.elements)t.append(e);this._visible=!0}else{for(const t of this.elements)this.append(t);this._visible=!1,this.resetVisibleElements()}}get visible(){return this._visible}set value(s){if(this.required&&Object.keys(s).length===0)return;const t=new Set;for(const e of s){const i=this.findOption(e);if(i&&(t.add(i),!this.multiple&&Object.keys(s).length===1))break}this._value=t,this.updateOptionsState(),this.dispatchEvent(this.onValueChange)}get value(){return[...this._value].filter(s=>s instanceof ns&&s.checked).map(s=>s.value)}get _options(){const s=new Set([...this.elements]);for(const t of this.children)t instanceof ns&&s.add(t);return[...s]}onSlotChange(s){const t=s.target.assignedElements();this.observe(t);const e=new Set;for(const i of this.elements){if(!(i instanceof ns)){i.remove();continue}i.checked&&e.add(i),i.removeEventListener("click",this.onOptionClick),i.addEventListener("click",this.onOptionClick)}this._value=e}updateOptionsState(){for(const s of this._options)s instanceof ns&&(s.checked=this._value.has(s))}findOption(s){return this._options.find(t=>t instanceof ns?t.label===s||t.value===s:!1)}render(){let s,t,e;if(this._value.size===0)s=this.placeholder??"Select an option...";else if(this._value.size===1){const i=[...this._value][0];s=(i==null?void 0:i.label)||(i==null?void 0:i.value),t=i==null?void 0:i.img,e=i==null?void 0:i.icon}else s=`Multiple (${this._value.size})`;return ct`
      <bim-input
        title=${this.label??""}
        .label=${this.label}
        .icon=${this.icon}
        .vertical=${this.vertical}
      >
        <div class="input" @click=${()=>this.visible=!this.visible}>
          <bim-label
            .img=${t}
            .icon=${e}
            style="overflow: hidden;"
            >${s}</bim-label
          >
          <svg
            style="flex-shrink: 0; fill: var(--bim-dropdown--c, var(--bim-ui_bg-contrast-100))"
            xmlns="http://www.w3.org/2000/svg"
            height="1.125rem"
            viewBox="0 0 24 24"
            width="1.125rem"
            fill="#9ca3af"
          >
            <path d="M0 0h24v24H0V0z" fill="none" />
            <path d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
          </svg>
          <bim-context-menu
            ${ti(this._contextMenu)}
            .visible=${this.visible}
            @hidden=${()=>{this.visible&&(this.visible=!1)}}
          >
            <slot @slotchange=${this.onSlotChange}></slot>
          </bim-context-menu>
        </div>
      </bim-input>
    `}};zI.styles=[uo.scrollbar,oe`
      :host {
        --bim-input--bgc: var(
          --bim-dropdown--bgc,
          var(--bim-ui_bg-contrast-20)
        );
        --bim-input--olw: 2px;
        --bim-input--olc: transparent;
        --bim-input--bdrs: var(--bim-ui_size-4xs);
        flex: 1;
        display: block;
      }

      :host([visible]) {
        --bim-input--olc: var(--bim-ui_accent-base);
      }

      .input {
        --bim-label--fz: var(--bim-drodown--fz, var(--bim-ui_size-xs));
        --bim-label--c: var(--bim-dropdown--c, var(--bim-ui_bg-contrast-100));
        height: 100%;
        display: flex;
        flex: 1;
        overflow: hidden;
        column-gap: 0.25rem;
        outline: none;
        cursor: pointer;
        align-items: center;
        justify-content: space-between;
        padding: 0 0.5rem;
      }

      bim-label {
        pointer-events: none;
      }
    `];let Gn=zI;vr([ut({type:String,reflect:!0})],Gn.prototype,"name",2);vr([ut({type:String,reflect:!0})],Gn.prototype,"icon",2);vr([ut({type:String,reflect:!0})],Gn.prototype,"label",2);vr([ut({type:Boolean,reflect:!0})],Gn.prototype,"multiple",2);vr([ut({type:Boolean,reflect:!0})],Gn.prototype,"required",2);vr([ut({type:Boolean,reflect:!0})],Gn.prototype,"vertical",2);vr([ut({type:String,reflect:!0})],Gn.prototype,"placeholder",2);vr([ut({type:Boolean,reflect:!0})],Gn.prototype,"visible",1);vr([Ul()],Gn.prototype,"_value",2);var rk=Object.defineProperty,UI=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&rk(t,e,n),n};const BI=class extends ie{constructor(){super(...arguments),this.floating=!1,this._layouts={},this._elements={},this._templateIds=new Map,this._updateFunctions={},this.updateComponent={}}set layouts(s){this._layouts=s,this._templateIds.clear()}get layouts(){return this._layouts}set elements(s){this._elements=s;const t={};for(const[e,i]of Object.entries(this.elements))"template"in i&&(t[e]=n=>{const r=this._updateFunctions[e];r&&r(n)});this.updateComponent=t}get elements(){return this._elements}getLayoutAreas(s){const{template:t}=s,e=t.split(`
`).map(i=>i.trim()).map(i=>i.split('"')[1]).filter(i=>i!==void 0).flatMap(i=>i.split(/\s+/));return[...new Set(e)].filter(i=>i!=="")}firstUpdated(){this._onLayoutChange=new Event("layoutchange")}getTemplateId(s){let t=this._templateIds.get(s);return t||(t=Os.newRandomId(),this._templateIds.set(s,t)),t}cleanUpdateFunctions(){if(!this.layout){this._updateFunctions={};return}const s=this.layouts[this.layout],t=this.getLayoutAreas(s);for(const e in this.elements)t.includes(e)||delete this._updateFunctions[e]}render(){if(this.layout){if(this.layouts[this.layout]){const s=this.layouts[this.layout],t=this.getLayoutAreas(s).map(e=>{var i;const n=((i=s.elements)==null?void 0:i[e])||this.elements[e];if(!n)return null;if(n instanceof HTMLElement)return n.style.gridArea=e,n;if("template"in n){const{template:l,initialState:h}=n,c=this.getTemplateId(l),u=this.querySelector(`[data-grid-template-id="${c}"]`);if(u)return u;const[p,d]=Es.create(l,h);return p.setAttribute("data-grid-template-id",c),p.style.gridArea=e,this._updateFunctions[e]=d,p}const r=this.getTemplateId(n),o=this.querySelector(`[data-grid-template-id="${r}"]`);if(o)return o;const a=Es.create(n);return a.setAttribute("data-grid-template-id",this.getTemplateId(n)),a.style.gridArea=e,a}).filter(e=>e!==null);this.innerHTML="",this.style.gridTemplate=s.template,this.append(...t),this._onLayoutChange&&this.dispatchEvent(this._onLayoutChange)}}else this.innerHTML="",this.style.gridTemplate="",this._onLayoutChange&&this.dispatchEvent(this._onLayoutChange);return this.cleanUpdateFunctions(),ct`<slot></slot>`}};BI.styles=oe`
    :host {
      display: grid;
      height: 100%;
      width: 100%;
      overflow: hidden;
      box-sizing: border-box;
    }

    /* :host(:not([layout])) {
      display: none;
    } */

    :host([floating]) {
      --bim-panel--bdrs: var(--bim-ui_size-4xs);
      background-color: transparent;
      padding: 1rem;
      gap: 1rem;
      position: absolute;
      pointer-events: none;
      top: 0px;
      left: 0px;
    }

    :host(:not([floating])) {
      --bim-panel--bdrs: 0;
      background-color: var(--bim-ui_bg-contrast-20);
      gap: 1px;
    }
  `;let Eb=BI;UI([ut({type:Boolean,reflect:!0})],Eb.prototype,"floating");UI([ut({type:String,reflect:!0})],Eb.prototype,"layout");const v_=class extends ie{render(){return ct`
      <iconify-icon .icon=${this.icon} height="none"></iconify-icon>
    `}};v_.styles=oe`
    :host {
      height: var(--bim-icon--fz, var(--bim-ui_size-sm));
      width: var(--bim-icon--fz, var(--bim-ui_size-sm));
    }

    iconify-icon {
      height: var(--bim-icon--fz, var(--bim-ui_size-sm));
      width: var(--bim-icon--fz, var(--bim-ui_size-sm));
      color: var(--bim-icon--c);
      transition: all 0.15s;
      display: flex;
    }
  `,v_.properties={icon:{type:String}};let ok=v_;var ak=Object.defineProperty,df=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&ak(t,e,n),n};const VI=class extends ie{constructor(){super(...arguments),this.vertical=!1,this.onValueChange=new Event("change")}get value(){const s={};for(const t of this.children){const e=t;"value"in e?s[e.name||e.label]=e.value:"checked"in e&&(s[e.name||e.label]=e.checked)}return s}set value(s){const t=[...this.children];for(const e in s){const i=t.find(o=>{const a=o;return a.name===e||a.label===e});if(!i)continue;const n=i,r=s[e];typeof r=="boolean"?n.checked=r:n.value=r}}render(){return ct`
      <div class="parent">
        ${this.label||this.icon?ct`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        <div class="input">
          <slot></slot>
        </div>
      </div>
    `}};VI.styles=oe`
    :host {
      flex: 1;
      display: block;
    }

    .parent {
      display: flex;
      flex-wrap: wrap;
      column-gap: 1rem;
      row-gap: 0.375rem;
      user-select: none;
      flex: 1;
    }

    :host(:not([vertical])) .parent {
      justify-content: space-between;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    .input {
      position: relative;
      overflow: hidden;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      min-height: 1.75rem;
      min-width: 3rem;
      gap: var(--bim-input--g, var(--bim-ui_size-4xs));
      padding: var(--bim-input--p, 0);
      background-color: var(--bim-input--bgc, transparent);
      border: var(--bim-input--olw, 2px) solid
        var(--bim-input--olc, transparent);
      border-radius: var(--bim-input--bdrs, var(--bim-ui_size-4xs));
      transition: all 0.15s;
    }

    :host(:not([vertical])) .input {
      flex: 1;
      justify-content: flex-end;
    }

    :host(:not([vertical])[label]) .input {
      max-width: fit-content;
    }
  `;let su=VI;df([ut({type:String,reflect:!0})],su.prototype,"name");df([ut({type:String,reflect:!0})],su.prototype,"label");df([ut({type:String,reflect:!0})],su.prototype,"icon");df([ut({type:Boolean,reflect:!0})],su.prototype,"vertical");var lk=Object.defineProperty,iu=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&lk(t,e,n),n};const $I=class extends ie{constructor(){super(...arguments),this.labelHidden=!1,this.iconHidden=!1,this.vertical=!1}get value(){return this.textContent?uf(this.textContent):this.textContent}render(){return ct`
      <div class="parent" .title=${this.textContent??""}>
        ${this.img?ct`<img .src=${this.img} .alt=${this.textContent||""} />`:null}
        ${!this.iconHidden&&this.icon?ct`<bim-icon .icon=${this.icon}></bim-icon>`:null}
        <p><slot></slot></p>
      </div>
    `}};$I.styles=oe`
    :host {
      --bim-icon--c: var(--bim-label--c);
      overflow: auto;
      color: var(--bim-label--c, var(--bim-ui_bg-contrast-60));
      font-size: var(--bim-label--fz, var(--bim-ui_size-xs));
      display: block;
      white-space: nowrap;
      transition: all 0.15s;
    }

    :host([icon]) {
      line-height: 1.1rem;
    }

    .parent {
      display: flex;
      align-items: center;
      column-gap: 0.25rem;
      row-gap: 0.125rem;
      user-select: none;
      height: 100%;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    .parent p {
      display: flex;
      margin: 0;
      text-overflow: ellipsis;
      overflow: hidden;
      align-items: center;
      gap: 0.125rem;
    }

    :host([label-hidden]) .parent p,
    :host(:empty) .parent p {
      display: none;
    }

    img {
      height: 100%;
      aspect-ratio: 1;
      border-radius: 100%;
      margin-right: 0.125rem;
    }

    :host(:not([vertical])) img {
      max-height: var(
        --bim-label_icon--sz,
        calc(var(--bim-label--fz, var(--bim-ui_size-xs)) * 1.8)
      );
    }

    :host([vertical]) img {
      max-height: var(
        --bim-label_icon--sz,
        calc(var(--bim-label--fz, var(--bim-ui_size-xs)) * 4)
      );
    }
  `;let Vl=$I;iu([ut({type:String,reflect:!0})],Vl.prototype,"img");iu([ut({type:Boolean,attribute:"label-hidden",reflect:!0})],Vl.prototype,"labelHidden");iu([ut({type:String,reflect:!0})],Vl.prototype,"icon");iu([ut({type:Boolean,attribute:"icon-hidden",reflect:!0})],Vl.prototype,"iconHidden");iu([ut({type:Boolean,reflect:!0})],Vl.prototype,"vertical");var hk=Object.defineProperty,ck=Object.getOwnPropertyDescriptor,ji=(s,t,e,i)=>{for(var n=i>1?void 0:i?ck(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&hk(t,e,n),n};const HI=class extends ie{constructor(){super(...arguments),this._value=0,this.vertical=!1,this.slider=!1,this._input=Fl(),this.onValueChange=new Event("change")}set value(s){this.setValue(s.toString())}get value(){return this._value}onChange(s){s.stopPropagation();const{value:t}=this._input;t&&this.setValue(t.value)}setValue(s){const{value:t}=this._input;let e=s;if(e=e.replace(/[^0-9.-]/g,""),e=e.replace(/(\..*)\./g,"$1"),e.endsWith(".")||(e.lastIndexOf("-")>0&&(e=e[0]+e.substring(1).replace(/-/g,"")),e==="-"||e==="-0"))return;let i=Number(e);Number.isNaN(i)||(i=this.min!==void 0?Math.max(i,this.min):i,i=this.max!==void 0?Math.min(i,this.max):i,this.value!==i&&(this._value=i,t&&(t.value=this.value.toString()),this.requestUpdate(),this.dispatchEvent(this.onValueChange)))}onBlur(){const{value:s}=this._input;s&&Number.isNaN(Number(s.value))&&(s.value=this.value.toString())}onSliderMouseDown(s){document.body.style.cursor="w-resize";const{clientX:t}=s,e=this.value;let i=!1;const n=a=>{var l;i=!0;const{clientX:h}=a,c=this.step??1,u=((l=c.toString().split(".")[1])==null?void 0:l.length)||0,p=1/(this.sensitivity??1),d=(h-t)/p;if(Math.floor(Math.abs(d))!==Math.abs(d))return;const _=e+d*c;this.setValue(_.toFixed(u))},r=()=>{this.slider=!0,this.removeEventListener("blur",r)},o=()=>{document.removeEventListener("mousemove",n),document.body.style.cursor="default",i?i=!1:(this.addEventListener("blur",r),this.slider=!1,requestAnimationFrame(()=>this.focus())),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)}onFocus(s){s.stopPropagation();const t=e=>{e.key==="Escape"&&(this.blur(),window.removeEventListener("keydown",t))};window.addEventListener("keydown",t)}connectedCallback(){super.connectedCallback(),this.min&&this.min>this.value&&(this._value=this.min),this.max&&this.max<this.value&&(this._value=this.max)}focus(){const{value:s}=this._input;s&&s.focus()}render(){const s=ct`
      ${this.pref||this.icon?ct`<bim-label
            style="pointer-events: auto"
            @mousedown=${this.onSliderMouseDown}
            .icon=${this.icon}
            >${this.pref}</bim-label
          >`:null}
      <input
        ${ti(this._input)}
        type="text"
        aria-label=${this.label||this.name||"Number Input"}
        size="1"
        @input=${o=>o.stopPropagation()}
        @change=${this.onChange}
        @blur=${this.onBlur}
        @focus=${this.onFocus}
        .value=${this.value.toString()}
      />
      ${this.suffix?ct`<bim-label
            style="pointer-events: auto"
            @mousedown=${this.onSliderMouseDown}
            >${this.suffix}</bim-label
          >`:null}
    `,t=this.min??-1/0,e=this.max??1/0,i=100*(this.value-t)/(e-t),n=ct`
      <style>
        .slider-indicator {
          width: ${`${i}%`};
        }
      </style>
      <div class="slider" @mousedown=${this.onSliderMouseDown}>
        <div class="slider-indicator"></div>
        ${this.pref||this.icon?ct`<bim-label
              style="z-index: 1; margin-right: 0.125rem"
              .icon=${this.icon}
              >${`${this.pref}: `}</bim-label
            >`:null}
        <bim-label style="z-index: 1;">${this.value}</bim-label>
        ${this.suffix?ct`<bim-label style="z-index: 1;">${this.suffix}</bim-label>`:null}
      </div>
    `,r=`${this.label||this.name||this.pref?`${this.label||this.name||this.pref}: `:""}${this.value}${this.suffix??""}`;return ct`
      <bim-input
        title=${r}
        .label=${this.label}
        .icon=${this.icon}
        .vertical=${this.vertical}
      >
        ${this.slider?n:s}
      </bim-input>
    `}};HI.styles=oe`
    :host {
      --bim-input--bgc: var(
        --bim-number-input--bgc,
        var(--bim-ui_bg-contrast-20)
      );
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(--bim-number-input--olc, transparent);
      --bim-input--bdrs: var(--bim-number-input--bdrs, var(--bim-ui_size-4xs));
      --bim-input--p: 0 0.375rem;
      flex: 1;
      display: block;
    }

    :host(:focus) {
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(
        --bim-number-inputfocus--c,
        var(--bim-ui_accent-base)
      );
    }

    :host(:not([slider])) bim-label {
      --bim-label--c: var(
        --bim-number-input_affixes--c,
        var(--bim-ui_bg-contrast-60)
      );
      --bim-label--fz: var(
        --bim-number-input_affixes--fz,
        var(--bim-ui_size-xs)
      );
    }

    p {
      margin: 0;
      padding: 0;
    }

    input {
      background-color: transparent;
      outline: none;
      border: none;
      padding: 0;
      flex-grow: 1;
      text-align: right;
      font-family: inherit;
      font-feature-settings: inherit;
      font-variation-settings: inherit;
      font-size: var(--bim-number-input--fz, var(--bim-ui_size-xs));
      color: var(--bim-number-input--c, var(--bim-ui_bg-contrast-100));
    }

    :host([suffix]:not([pref])) input {
      text-align: left;
    }

    :host([slider]) {
      --bim-input--p: 0;
    }

    :host([slider]) .slider {
      --bim-label--c: var(--bim-ui_bg-contrast-100);
    }

    .slider {
      position: relative;
      display: flex;
      justify-content: center;
      width: 100%;
      height: 100%;
      padding: 0 0.5rem;
    }

    .slider-indicator {
      height: 100%;
      background-color: var(--bim-ui_main-base);
      position: absolute;
      top: 0;
      left: 0;
      border-radius: var(--bim-input--bdrs, var(--bim-ui_size-4xs));
    }

    bim-input {
      display: flex;
    }

    bim-label {
      pointer-events: none;
    }
  `;let vi=HI;ji([ut({type:String,reflect:!0})],vi.prototype,"name",2);ji([ut({type:String,reflect:!0})],vi.prototype,"icon",2);ji([ut({type:String,reflect:!0})],vi.prototype,"label",2);ji([ut({type:String,reflect:!0})],vi.prototype,"pref",2);ji([ut({type:Number,reflect:!0})],vi.prototype,"min",2);ji([ut({type:Number,reflect:!0})],vi.prototype,"value",1);ji([ut({type:Number,reflect:!0})],vi.prototype,"step",2);ji([ut({type:Number,reflect:!0})],vi.prototype,"sensitivity",2);ji([ut({type:Number,reflect:!0})],vi.prototype,"max",2);ji([ut({type:String,reflect:!0})],vi.prototype,"suffix",2);ji([ut({type:Boolean,reflect:!0})],vi.prototype,"vertical",2);ji([ut({type:Boolean,reflect:!0})],vi.prototype,"slider",2);var uk=Object.defineProperty,dk=Object.getOwnPropertyDescriptor,nu=(s,t,e,i)=>{for(var n=i>1?void 0:i?dk(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&uk(t,e,n),n};const jI=class extends ie{constructor(){super(...arguments),this.onValueChange=new Event("change"),this._hidden=!1,this.headerHidden=!1,this.valueTransform={},this.activationButton=document.createElement("bim-button")}set hidden(s){this._hidden=s,this.activationButton.active=!s,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}get value(){return Uc(this,this.valueTransform)}set value(s){const t=[...this.children];for(const e in s){const i=t.find(r=>{const o=r;return o.name===e||o.label===e});if(!i)continue;const n=i;n.value=s[e]}}animatePanles(){const s=[{maxHeight:"100vh",maxWidth:"100vw",opacity:1},{maxHeight:"100vh",maxWidth:"100vw",opacity:0},{maxHeight:0,maxWidth:0,opacity:0}];this.animate(s,{duration:300,easing:"cubic-bezier(0.65, 0.05, 0.36, 1)",direction:this.hidden?"normal":"reverse",fill:"forwards"})}connectedCallback(){super.connectedCallback(),this.activationButton.active=!this.hidden,this.activationButton.onclick=()=>{this.hidden=!this.hidden,this.animatePanles()}}disconnectedCallback(){super.disconnectedCallback(),this.activationButton.remove()}collapseSections(){const s=this.querySelectorAll("bim-panel-section");for(const t of s)t.collapsed=!0}expandSections(){const s=this.querySelectorAll("bim-panel-section");for(const t of s)t.collapsed=!1}render(){return this.activationButton.icon=this.icon,this.activationButton.label=this.label||this.name,this.activationButton.tooltipTitle=this.label||this.name,ct`
      <div class="parent">
        ${this.label||this.name||this.icon?ct`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        <div class="sections">
          <slot></slot>
        </div>
      </div>
    `}};jI.styles=[uo.scrollbar,oe`
      :host {
        display: flex;
        border-radius: var(--bim-ui_size-base);
        background-color: var(--bim-ui_bg-base);
        overflow: auto;
      }

      :host([hidden]) {
        max-height: 0;
        max-width: 0;
        opacity: 0;
      }

      .parent {
        display: flex;
        flex: 1;
        flex-direction: column;
        pointer-events: auto;
        overflow: auto;
      }

      .parent bim-label {
        --bim-label--c: var(--bim-panel--c, var(--bim-ui_bg-contrast-80));
        --bim-label--fz: var(--bim-panel--fz, var(--bim-ui_size-sm));
        font-weight: 600;
        padding: 1rem;
        flex-shrink: 0;
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([header-hidden]) .parent bim-label {
        display: none;
      }

      .sections {
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow: auto;
        flex: 1;
      }

      ::slotted(bim-panel-section:not(:last-child)) {
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }
    `];let ha=jI;nu([ut({type:String,reflect:!0})],ha.prototype,"icon",2);nu([ut({type:String,reflect:!0})],ha.prototype,"name",2);nu([ut({type:String,reflect:!0})],ha.prototype,"label",2);nu([ut({type:Boolean,reflect:!0})],ha.prototype,"hidden",1);nu([ut({type:Boolean,attribute:"header-hidden",reflect:!0})],ha.prototype,"headerHidden",2);var pk=Object.defineProperty,ru=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&pk(t,e,n),n};const YI=class extends ie{constructor(){super(...arguments),this.onValueChange=new Event("change"),this.valueTransform={},this.componentHeight=-1}get value(){const s=this.parentElement;let t;return s instanceof ha&&(t=s.valueTransform),Object.values(this.valueTransform).length!==0&&(t=this.valueTransform),Uc(this,t)}set value(s){const t=[...this.children];for(const e in s){const i=t.find(r=>{const o=r;return o.name===e||o.label===e});if(!i)continue;const n=i;n.value=s[e]}}setFlexAfterTransition(){var s;const t=(s=this.shadowRoot)==null?void 0:s.querySelector(".components");t&&setTimeout(()=>{this.collapsed?t.style.removeProperty("flex"):t.style.setProperty("flex","1")},150)}animateHeader(){var s;const t=(s=this.shadowRoot)==null?void 0:s.querySelector(".components");this.componentHeight<0&&(this.collapsed?this.componentHeight=t.clientHeight:(t.style.setProperty("transition","none"),t.style.setProperty("height","auto"),t.style.setProperty("padding","0.125rem 1rem 1rem"),this.componentHeight=t.clientHeight,requestAnimationFrame(()=>{t.style.setProperty("height","0px"),t.style.setProperty("padding","0 1rem 0"),t.style.setProperty("transition","height 0.25s cubic-bezier(0.65, 0.05, 0.36, 1), padding 0.25s cubic-bezier(0.65, 0.05, 0.36, 1)")}))),this.collapsed?(t.style.setProperty("height",`${this.componentHeight}px`),requestAnimationFrame(()=>{t.style.setProperty("height","0px"),t.style.setProperty("padding","0 1rem 0")})):(t.style.setProperty("height","0px"),t.style.setProperty("padding","0 1rem 0"),requestAnimationFrame(()=>{t.style.setProperty("height",`${this.componentHeight}px`),t.style.setProperty("padding","0.125rem 1rem 1rem")})),this.setFlexAfterTransition()}onHeaderClick(){this.fixed||(this.collapsed=!this.collapsed,this.animateHeader())}handelSlotChange(s){s.target.assignedElements({flatten:!0}).forEach((t,e)=>{const i=e*.05;t.style.setProperty("transition-delay",`${i}s`)})}handlePointerEnter(){const s=this.renderRoot.querySelector(".expand-icon");this.collapsed?s==null||s.style.setProperty("animation","collapseAnim 0.5s"):s==null||s.style.setProperty("animation","expandAnim 0.5s")}handlePointerLeave(){const s=this.renderRoot.querySelector(".expand-icon");s==null||s.style.setProperty("animation","none")}render(){const s=this.label||this.icon||this.name||this.fixed,t=ct`<svg
      xmlns="http://www.w3.org/2000/svg"
      height="1.125rem"
      viewBox="0 0 24 24"
      width="1.125rem"
      class="expand-icon"
    >
      <path d="M0 0h24v24H0z" fill="none" />
      <path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z" />
    </svg>`,e=ct`
      <div
        class="header"
        title=${this.label??""}
        @pointerenter=${this.handlePointerEnter}
        @pointerleave=${this.handlePointerLeave}
        @click=${this.onHeaderClick}
      >
        ${this.label||this.icon||this.name?ct`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        ${this.fixed?null:t}
      </div>
    `;return ct`
      <div class="parent">
        ${s?e:null}
        <div class="components" style="flex: 1;">
          <div>
            <slot @slotchange=${this.handelSlotChange}></slot>
          </div>
        </div>
      </div>
    `}};YI.styles=[uo.scrollbar,oe`
      :host {
        display: block;
        pointer-events: auto;
      }

      :host .parent {
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      :host(:not([fixed])) .header:hover {
        --bim-label--c: var(--bim-ui_accent-base);
        color: var(--bim-ui_accent-base);
        cursor: pointer;
      }

      :host(:not([fixed])) .header:hover .expand-icon {
        fill: var(--bim-ui_accent-base);
      }

      .header {
        --bim-label--fz: var(--bim-ui_size-sm);
        --bim-label--c: var(
          --bim-panel-section_hc,
          var(--bim-ui_bg-contrast-80)
        );
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        height: 1.5rem;
        padding: 0.75rem 1rem;
      }

      .expand-icon {
        fill: var(--bim-ui_bg-contrast-80);
        transition: transform 0.2s;
      }

      :host([collapsed]) .expand-icon {
        transform: rotateZ(-180deg);
      }

      .title {
        display: flex;
        align-items: center;
        column-gap: 0.5rem;
      }

      .title p {
        font-size: var(--bim-ui_size-sm);
      }

      .components {
        display: flex;
        flex-direction: column;
        overflow: hidden;
        row-gap: 0.75rem;
        padding: 0 1rem 1rem;
        box-sizing: border-box;
        transition:
          height 0.25s cubic-bezier(0.65, 0.05, 0.36, 1),
          padding 0.25s cubic-bezier(0.65, 0.05, 0.36, 1);
      }

      .components > div {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        flex: 1;
        overflow: auto;
      }

      :host(:not([icon]):not([label])) .components {
        padding: 1rem;
      }

      :host(:not([fixed])[collapsed]) .components {
        padding: 0 1rem 0;
        height: 0px;
      }

      bim-label {
        pointer-events: none;
      }

      ::slotted(*) {
        transition:
          transform 0.25s cubic-bezier(0.65, 0.05, 0.36, 1),
          opacity 0.25s cubic-bezier(0.65, 0.05, 0.36, 1);
      }

      :host(:not([fixed])[collapsed]) ::slotted(*) {
        transform: translateX(-20%);
        opacity: 0;
      }

      @keyframes expandAnim {
        0%,
        100% {
          transform: translateY(0%);
        }
        25% {
          transform: translateY(-30%);
        }
        50% {
          transform: translateY(10%);
        }
        75% {
          transform: translateY(-30%);
        }
      }

      @keyframes collapseAnim {
        0%,
        100% {
          transform: translateY(0%) rotateZ(-180deg);
        }
        25% {
          transform: translateY(30%) rotateZ(-180deg);
        }
        50% {
          transform: translateY(-10%) rotateZ(-180deg);
        }
        75% {
          transform: translateY(30%) rotateZ(-180deg);
        }
      }
    `];let $l=YI;ru([ut({type:String,reflect:!0})],$l.prototype,"icon");ru([ut({type:String,reflect:!0})],$l.prototype,"label");ru([ut({type:String,reflect:!0})],$l.prototype,"name");ru([ut({type:Boolean,reflect:!0})],$l.prototype,"fixed");ru([ut({type:Boolean,reflect:!0})],$l.prototype,"collapsed");var fk=Object.defineProperty,ou=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&fk(t,e,n),n};const WI=class extends ie{constructor(){super(...arguments),this.vertical=!1,this.onValueChange=new Event("change"),this._canEmitEvents=!1,this._value=document.createElement("bim-option"),this.onOptionClick=s=>{this._value=s.target,this.setAnimatedBackgound(),this.dispatchEvent(this.onValueChange);for(const t of this.children)t instanceof ns&&(t.checked=t===s.target)}}get _options(){return[...this.querySelectorAll("bim-option")]}set value(s){const t=this.findOption(s);if(t){for(const e of this._options)e.checked=e===t;this._value=t,this.setAnimatedBackgound(),this._canEmitEvents&&this.dispatchEvent(this.onValueChange)}}get value(){return this._value.value}onSlotChange(s){const t=s.target.assignedElements();for(const e of t)e instanceof ns&&(e.noMark=!0,e.removeEventListener("click",this.onOptionClick),e.addEventListener("click",this.onOptionClick))}findOption(s){return this._options.find(t=>t instanceof ns?t.label===s||t.value===s:!1)}doubleRequestAnimationFrames(s){requestAnimationFrame(()=>requestAnimationFrame(s))}setAnimatedBackgound(s=!1){const t=this.renderRoot.querySelector(".animated-background"),e=this._value;requestAnimationFrame(()=>{var i,n,r,o;const a=(o=(r=(n=(i=e==null?void 0:e.parentElement)==null?void 0:i.shadowRoot)==null?void 0:n.querySelector("bim-input"))==null?void 0:r.shadowRoot)==null?void 0:o.querySelector(".input"),l={width:e==null?void 0:e.clientWidth,height:e==null?void 0:e.clientHeight,top:((e==null?void 0:e.offsetTop)??0)-((a==null?void 0:a.offsetTop)??0),left:((e==null?void 0:e.offsetLeft)??0)-((a==null?void 0:a.offsetLeft)??0)};t==null||t.style.setProperty("width",`${l.width}px`),t==null||t.style.setProperty("height",`${l.height}px`),t==null||t.style.setProperty("top",`${l.top}px`),t==null||t.style.setProperty("left",`${l.left}px`)}),s&&this.doubleRequestAnimationFrames(()=>{const i="ease";t==null||t.style.setProperty("transition",`width ${.3}s ${i}, height ${.3}s ${i}, top ${.3}s ${i}, left ${.3}s ${i}`)})}firstUpdated(){const s=[...this.children].find(t=>t instanceof ns&&t.checked);s&&(this._value=s),window.addEventListener("load",()=>{this.setAnimatedBackgound(!0)}),new ResizeObserver(()=>{this.setAnimatedBackgound()}).observe(this)}render(){return ct`
      <bim-input
        .vertical=${this.vertical}
        .label=${this.label}
        .icon=${this.icon}
      >
        <div class="animated-background"></div>
        <slot @slotchange=${this.onSlotChange}></slot>
      </bim-input>
    `}};WI.styles=oe`
    :host {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
      --bim-input--g: 0;
      --bim-option--jc: center;
      flex: 1;
      display: block;
    }

    ::slotted(bim-option) {
      position: relative;
      border-radius: 0;
      overflow: hidden;
      min-width: min-content;
      min-height: min-content;
      transition: background-color 0.2s;
    }

    .animated-background {
      position: absolute;
      background: var(--bim-ui_main-base);
      width: 0;
      height: 0;
      top: 0;
      left: 0;
    }

    ::slotted(bim-option[checked]) {
      --bim-label--c: var(--bim-ui_main-contrast);
    }

    ::slotted(bim-option:not([checked]):hover) {
      background-color: #0003;
    }
  `;let Hl=WI;ou([ut({type:String,reflect:!0})],Hl.prototype,"name");ou([ut({type:String,reflect:!0})],Hl.prototype,"icon");ou([ut({type:String,reflect:!0})],Hl.prototype,"label");ou([ut({type:Boolean,reflect:!0})],Hl.prototype,"vertical");ou([Ul()],Hl.prototype,"_value");const mk=()=>ct`
    <style>
      div {
        display: flex;
        gap: 0.375rem;
        border-radius: 0.25rem;
        min-height: 1.25rem;
      }

      [data-type="row"] {
        background-color: var(--bim-ui_bg-contrast-10);
        animation: row-loading 1s linear infinite alternate;
        padding: 0.5rem;
      }

      [data-type="cell"] {
        background-color: var(--bim-ui_bg-contrast-20);
        flex: 0.25;
      }

      @keyframes row-loading {
        0% {
          background-color: var(--bim-ui_bg-contrast-10);
        }
        100% {
          background-color: var(--bim-ui_bg-contrast-20);
        }
      }
    </style>
    <div style="display: flex; flex-direction: column;">
      <div data-type="row" style="gap: 2rem">
        <div data-type="cell" style="flex: 1"></div>
        <div data-type="cell" style="flex: 2"></div>
        <div data-type="cell" style="flex: 1"></div>
        <div data-type="cell" style="flex: 0.5"></div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.7s5"></div>
        </div>
      </div>
    </div>
  `,gk=()=>ct`
    <style>
      .loader {
        grid-area: Processing;
        position: relative;
        padding: 0.125rem;
      }
      .loader:before {
        content: "";
        position: absolute;
      }
      .loader .loaderBar {
        position: absolute;
        top: 0;
        right: 100%;
        bottom: 0;
        left: 0;
        background: var(--bim-ui_main-base);
        /* width: 25%; */
        width: 0;
        animation: borealisBar 2s linear infinite;
      }

      @keyframes borealisBar {
        0% {
          left: 0%;
          right: 100%;
          width: 0%;
        }
        10% {
          left: 0%;
          right: 75%;
          width: 25%;
        }
        90% {
          right: 0%;
          left: 75%;
          width: 25%;
        }
        100% {
          left: 100%;
          right: 0%;
          width: 0%;
        }
      }
    </style>
    <div class="loader">
      <div class="loaderBar"></div>
    </div>
  `;var _k=Object.defineProperty,bk=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&_k(t,e,n),n};const GI=class extends ie{constructor(){super(...arguments),this.column="",this.columnIndex=0,this.rowData={}}get data(){return this.column?this.rowData[this.column]:null}render(){return ct`
      <style>
        :host {
          grid-area: ${this.column??"unset"};
        }
      </style>
      <slot></slot>
    `}};GI.styles=oe`
    :host {
      padding: 0.375rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    :host([data-column-index="0"]) {
      justify-content: normal;
    }

    :host([data-column-index="0"]:not([data-cell-header]))
      ::slotted(bim-label) {
      text-align: left;
    }

    ::slotted(*) {
      --bim-input--bgc: transparent;
      --bim-input--olc: var(--bim-ui_bg-contrast-20);
      --bim-input--olw: 1px;
    }

    ::slotted(bim-input) {
      --bim-input--olw: 0;
    }

    ::slotted(bim-label) {
      white-space: normal;
      text-align: center;
    }
  `;let qI=GI;bk([ut({type:String,reflect:!0})],qI.prototype,"column");const ZI=class extends ie{constructor(){super(...arguments),this._groups=[],this.group=this.closest("bim-table-group"),this._data=[],this.table=this.closest("bim-table")}get data(){var s;return((s=this.group)==null?void 0:s.data.children)??this._data}set data(s){this._data=s}render(){return this._groups=[],ct`
      <slot></slot>
      ${this.data.map(s=>{const t=document.createElement("bim-table-group");return this._groups.push(t),t.table=this.table,t.data=s,t})}
    `}};ZI.styles=oe`
    :host {
      --bim-button--bgc: transparent;
      position: relative;
      display: block;
      overflow: hidden;
      grid-area: Children;
    }

    :host([hidden]) {
      height: 0;
      opacity: 0;
    }

    ::slotted(.branch.branch-vertical) {
      top: 0;
      bottom: 1.125rem;
    }
  `;let yk=ZI;var vk=Object.defineProperty,wk=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&vk(t,e,n),n};const XI=class extends ie{constructor(){super(...arguments),this.childrenHidden=!0,this.table=this.closest("bim-table"),this.data={data:{}}}get rowElement(){const s=this.shadowRoot;return s?s.querySelector("bim-table-row"):null}get childrenElement(){const s=this.shadowRoot;return s?s.querySelector("bim-table-children"):null}get _isChildrenEmpty(){return!(this.data.children&&this.data.children.length!==0)}connectedCallback(){super.connectedCallback(),this.table&&this.table.expanded?this.childrenHidden=!1:this.childrenHidden=!0}toggleChildren(s){this.childrenHidden=typeof s>"u"?!this.childrenHidden:!s,this.animateTableChildren(!0)}animateTableChildren(s=!0){if(!s){requestAnimationFrame(()=>{var r;const o=this.renderRoot.querySelector(".caret"),a=this.renderRoot.querySelector(".branch-vertical"),l=(r=this.renderRoot.querySelector("bim-table-children"))==null?void 0:r.querySelector(".branch-vertical");o.style.setProperty("transform",`translateY(-50%) rotate(${this.childrenHidden?"0":"90"}deg)`),a.style.setProperty("transform",`scaleY(${this.childrenHidden?"0":"1"})`),l==null||l.style.setProperty("transform",`scaleY(${this.childrenHidden?"0":"1"})`)});return}const t=500,e=0,i=200,n=350;requestAnimationFrame(()=>{var r;const o=this.renderRoot.querySelector("bim-table-children"),a=this.renderRoot.querySelector(".caret"),l=this.renderRoot.querySelector(".branch-vertical"),h=(r=this.renderRoot.querySelector("bim-table-children"))==null?void 0:r.querySelector(".branch-vertical"),c=()=>{const m=o==null?void 0:o.renderRoot.querySelectorAll("bim-table-group");m==null||m.forEach((g,f)=>{g.style.setProperty("opacity","0"),g.style.setProperty("left","-30px");const b=[{opacity:"0",left:"-30px"},{opacity:"1",left:"0"}];g.animate(b,{duration:t/2,delay:50+f*e,easing:"cubic-bezier(0.65, 0.05, 0.36, 1)",fill:"forwards"})})},u=()=>{const m=[{transform:"translateY(-50%) rotate(90deg)"},{transform:"translateY(-50%) rotate(0deg)"}];a==null||a.animate(m,{duration:n,easing:"cubic-bezier(0.68, -0.55, 0.27, 1.55)",fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})},p=()=>{const m=[{transform:"scaleY(1)"},{transform:"scaleY(0)"}];l==null||l.animate(m,{duration:i,easing:"cubic-bezier(0.4, 0, 0.2, 1)",delay:e,fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})},d=()=>{var m;const g=(m=this.renderRoot.querySelector("bim-table-row"))==null?void 0:m.querySelector(".branch-horizontal");if(g){g.style.setProperty("transform-origin","center right");const f=[{transform:"scaleX(0)"},{transform:"scaleX(1)"}];g.animate(f,{duration:i,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})}},_=()=>{const m=[{transform:"scaleY(0)"},{transform:"scaleY(1)"}];h==null||h.animate(m,{duration:i*1.2,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"forwards",delay:(e+i)*.7})};c(),u(),p(),d(),_()})}firstUpdated(){this.renderRoot.querySelectorAll(".caret").forEach(s=>{var t,e,i;if(!this.childrenHidden){s.style.setProperty("transform","translateY(-50%) rotate(90deg)");const n=(t=s.parentElement)==null?void 0:t.querySelector(".branch-horizontal");n&&n.style.setProperty("transform","scaleX(0)");const r=(i=(e=s.parentElement)==null?void 0:e.parentElement)==null?void 0:i.querySelectorAll(".branch-vertical");r==null||r.forEach(o=>{o.style.setProperty("transform","scaleY(1)")})}})}render(){if(!this.table)throw new Error("TableGroup: parent table wasn't found!");const s=this.table.getGroupIndentation(this.data)??0,t=ct`
      ${this.table.noIndentation?null:ct`
            <style>
              .branch-vertical {
                left: ${s+(this.table.selectableRows?1.9375:.5625)}rem;
              }
            </style>
            <div class="branch branch-vertical"></div>
          `}
    `;let e=null;this.table.noIndentation||(e=document.createElement("div"),e.classList.add("branch","branch-horizontal"),e.style.left=`${s-1+(this.table.selectableRows?2.05:.5625)}rem`);let i=null;if(!this.table.noIndentation){i=document.createElement("div");const o=document.createElementNS("http://www.w3.org/2000/svg","svg");if(o.setAttribute("height","9.9"),o.setAttribute("width","7.5"),o.setAttribute("viewBox","0 0 4.6666672 7.7"),this.table.noCarets){const a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx","2.3333336"),a.setAttribute("cy","3.85"),a.setAttribute("r","2.5"),o.append(a)}else{const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d","m 1.7470835,6.9583848 2.5899999,-2.59 c 0.39,-0.39 0.39,-1.02 0,-1.41 L 1.7470835,0.36838483 c -0.63,-0.62000003 -1.71000005,-0.18 -1.71000005,0.70999997 v 5.17 c 0,0.9 1.08000005,1.34 1.71000005,0.71 z"),o.append(a),i.style.cursor="pointer",i.addEventListener("click",l=>{l.stopPropagation(),this.toggleChildren()})}i.classList.add("caret"),i.style.left=`${(this.table.selectableRows?1.5:.125)+s}rem`,i.append(o)}const n=document.createElement("bim-table-row");if(!this._isChildrenEmpty){const o=document.createDocumentFragment();Pl(t,o),n.append(o)}n.table=this.table,n.group=this,this.table.dispatchEvent(new CustomEvent("rowcreated",{detail:{row:n}})),i&&!this._isChildrenEmpty&&n.append(i),s!==0&&e&&n.append(e);let r;if(!this._isChildrenEmpty&&!this.childrenHidden){r=document.createElement("bim-table-children"),r.table=this.table,r.group=this;const o=document.createDocumentFragment();Pl(t,o),r.append(o),this.animateTableChildren()}return ct`<div class="parent">${n} ${r}</div>`}};XI.styles=oe`
    :host {
      position: relative;
    }

    .parent {
      display: grid;
      grid-template-areas: "Data" "Children";
    }

    .branch {
      position: absolute;
      z-index: 1;
    }

    .branch-vertical {
      border-left: 1px dotted var(--bim-ui_bg-contrast-40);
      transform-origin: top center;
      transform: scaleY(0);
    }

    .branch-horizontal {
      top: 50%;
      width: 1rem;
      border-bottom: 1px dotted var(--bim-ui_bg-contrast-40);
    }

    .branch-horizontal {
      transform-origin: center left;
    }

    .caret {
      position: absolute;
      z-index: 2;
      transform: translateY(-50%) rotate(0deg);
      top: 50%;
      display: flex;
      width: 0.95rem;
      height: 0.95rem;
      justify-content: center;
      align-items: center;
    }

    .caret svg {
      fill: var(--bim-ui_bg-contrast-60);
    }
  `;let QI=XI;wk([ut({type:Boolean,attribute:"children-hidden",reflect:!0})],QI.prototype,"childrenHidden");var Ek=Object.defineProperty,au=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&Ek(t,e,n),n};const KI=class extends ie{constructor(){super(...arguments),this.selected=!1,this.columns=[],this.hiddenColumns=[],this.group=this.closest("bim-table-group"),this._data={},this.isHeader=!1,this.table=this.closest("bim-table"),this.onTableColumnsChange=()=>{this.table&&(this.columns=this.table.columns)},this.onTableColumnsHidden=()=>{this.table&&(this.hiddenColumns=this.table.hiddenColumns)},this._observer=new IntersectionObserver(s=>{this._intersecting=s[0].isIntersecting},{rootMargin:"36px"})}get groupData(){var s;return(s=this.group)==null?void 0:s.data}get data(){var s;return((s=this.group)==null?void 0:s.data.data)??this._data}set data(s){this._data=s}get _columnNames(){return this.columns.filter(s=>!this.hiddenColumns.includes(s.name)).map(s=>s.name)}get _columnWidths(){return this.columns.filter(s=>!this.hiddenColumns.includes(s.name)).map(s=>s.width)}get _isSelected(){var s;return(s=this.table)==null?void 0:s.selection.has(this.data)}onSelectionChange(s){if(!this.table)return;const t=s.target;this.selected=t.value,t.value?(this.table.selection.add(this.data),this.table.dispatchEvent(new CustomEvent("rowselected",{detail:{data:this.data}}))):(this.table.selection.delete(this.data),this.table.dispatchEvent(new CustomEvent("rowdeselected",{detail:{data:this.data}})))}connectedCallback(){super.connectedCallback(),this._observer.observe(this),this.table&&(this.columns=this.table.columns,this.hiddenColumns=this.table.hiddenColumns,this.table.addEventListener("columnschange",this.onTableColumnsChange),this.table.addEventListener("columnshidden",this.onTableColumnsHidden),this.toggleAttribute("selected",this._isSelected))}disconnectedCallback(){super.disconnectedCallback(),this._observer.unobserve(this),this.table&&(this.columns=[],this.hiddenColumns=[],this.table.removeEventListener("columnschange",this.onTableColumnsChange),this.table.removeEventListener("columnshidden",this.onTableColumnsHidden),this.toggleAttribute("selected",!1))}compute(){if(!this.table)throw new Error("TableRow: parent table wasn't found!");const s=this.table.getRowIndentation(this.data)??0,t=this.isHeader?this.data:this.table.applyDataTransform(this.group)??this.data,e=[];for(const i in t){if(this.hiddenColumns.includes(i))continue;const n=t[i];let r;if(typeof n=="string"||typeof n=="boolean"||typeof n=="number"?(r=document.createElement("bim-label"),r.textContent=String(n)):n instanceof HTMLElement?r=n:(r=document.createDocumentFragment(),Pl(n,r)),!r)continue;const o=document.createElement("bim-table-cell");o.append(r),o.column=i,this._columnNames.indexOf(i)===0&&(o.style.marginLeft=`${this.table.noIndentation?0:s+.75}rem`);const a=this._columnNames.indexOf(i);o.setAttribute("data-column-index",String(a)),o.toggleAttribute("data-no-indentation",a===0&&this.table.noIndentation),o.toggleAttribute("data-cell-header",this.isHeader),o.rowData=this.data,this.table.dispatchEvent(new CustomEvent("cellcreated",{detail:{cell:o}})),e.push(o)}return this.style.gridTemplateAreas=`"${this.table.selectableRows?"Selection":""} ${this._columnNames.join(" ")}"`,this.style.gridTemplateColumns=`${this.table.selectableRows?"1.6rem":""} ${this._columnWidths.join(" ")}`,ct`
      ${!this.isHeader&&this.table.selectableRows?ct`<bim-checkbox
            @change=${this.onSelectionChange}
            .checked=${this._isSelected}
            style="align-self: center; justify-self: center"
          ></bim-checkbox>`:null}
      ${e}
      <slot></slot>
    `}render(){return ct`${this._intersecting?this.compute():ct``}`}};KI.styles=oe`
    :host {
      position: relative;
      grid-area: Data;
      display: grid;
      min-height: 2.25rem;
      transition: all 0.15s;
    }

    ::slotted(.branch.branch-vertical) {
      top: 50%;
      bottom: 0;
    }

    :host([selected]) {
      background-color: color-mix(
        in lab,
        var(--bim-ui_bg-contrast-20) 30%,
        var(--bim-ui_main-base) 10%
      );
    }
  `;let jl=KI;au([ut({type:Boolean,reflect:!0})],jl.prototype,"selected");au([ut({attribute:!1})],jl.prototype,"columns");au([ut({attribute:!1})],jl.prototype,"hiddenColumns");au([ut({type:Boolean,attribute:"is-header",reflect:!0})],jl.prototype,"isHeader");au([Ul()],jl.prototype,"_intersecting");var Ck=Object.defineProperty,Ik=Object.getOwnPropertyDescriptor,Yi=(s,t,e,i)=>{for(var n=i>1?void 0:i?Ik(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&Ck(t,e,n),n};const JI=class extends ie{constructor(){super(...arguments),this._filteredData=[],this.headersHidden=!1,this.minColWidth="4rem",this._columns=[],this._textDelimiters={comma:",",tab:"	"},this._queryString=null,this._data=[],this.expanded=!1,this.preserveStructureOnFilter=!1,this.indentationInText=!1,this.dataTransform={},this.selectableRows=!1,this.selection=new Set,this.noIndentation=!1,this.noCarets=!1,this.loading=!1,this._errorLoading=!1,this._onColumnsHidden=new Event("columnshidden"),this._hiddenColumns=[],this._stringFilterFunction=(s,t)=>Object.values(t.data).some(e=>String(e).toLowerCase().includes(s.toLowerCase())),this._queryFilterFunction=(s,t)=>{let e=!1;const i=y_(s)??[];for(const n of i){if("queries"in n){e=!1;break}const{condition:r,value:o}=n;let{key:a}=n;if(a.startsWith("[")&&a.endsWith("]")){const l=a.replace("[","").replace("]","");a=l,e=Object.keys(t.data).filter(h=>h.includes(l)).map(h=>rw(t.data[h],r,o)).some(h=>h)}else e=rw(t.data[a],r,o);if(!e)break}return e}}set columns(s){const t=[];for(const e of s){const i=typeof e=="string"?{name:e,width:`minmax(${this.minColWidth}, 1fr)`}:e;t.push(i)}this._columns=t,this.computeMissingColumns(this.data),this.dispatchEvent(new Event("columnschange"))}get columns(){return this._columns}get _headerRowData(){const s={};for(const t of this.columns){const{name:e}=t;s[e]=String(e)}return s}get value(){return this._filteredData}set queryString(s){this.toggleAttribute("data-processing",!0),this._queryString=s&&s.trim()!==""?s.trim():null,this.updateFilteredData(),this.toggleAttribute("data-processing",!1)}get queryString(){return this._queryString}set data(s){this._data=s,this.updateFilteredData(),this.computeMissingColumns(s)&&(this.columns=this._columns)}get data(){return this._data}get dataAsync(){return new Promise(s=>{setTimeout(()=>{s(this.data)})})}set hiddenColumns(s){this._hiddenColumns=s,setTimeout(()=>{this.dispatchEvent(this._onColumnsHidden)})}get hiddenColumns(){return this._hiddenColumns}updateFilteredData(){this.queryString?(y_(this.queryString)?(this.filterFunction=this._queryFilterFunction,this._filteredData=this.filter(this.queryString)):(this.filterFunction=this._stringFilterFunction,this._filteredData=this.filter(this.queryString)),this.preserveStructureOnFilter&&(this._expandedBeforeFilter===void 0&&(this._expandedBeforeFilter=this.expanded),this.expanded=!0)):(this.preserveStructureOnFilter&&this._expandedBeforeFilter!==void 0&&(this.expanded=this._expandedBeforeFilter,this._expandedBeforeFilter=void 0),this._filteredData=this.data)}computeMissingColumns(s){let t=!1;for(const e of s){const{children:i,data:n}=e;for(const r in n)this._columns.map(o=>typeof o=="string"?o:o.name).includes(r)||(this._columns.push({name:r,width:`minmax(${this.minColWidth}, 1fr)`}),t=!0);if(i){const r=this.computeMissingColumns(i);r&&!t&&(t=r)}}return t}generateText(s="comma",t=this.value,e="",i=!0){const n=this._textDelimiters[s];let r="";const o=this.columns.map(a=>a.name);if(i){this.indentationInText&&(r+=`Indentation${n}`);const a=`${o.join(n)}
`;r+=a}for(const[a,l]of t.entries()){const{data:h,children:c}=l,u=this.indentationInText?`${e}${a+1}${n}`:"",p=o.map(_=>h[_]??""),d=`${u}${p.join(n)}
`;r+=d,c&&(r+=this.generateText(s,l.children,`${e}${a+1}.`,!1))}return r}get csv(){return this.generateText("comma")}get tsv(){return this.generateText("tab")}applyDataTransform(s){const t={};if(!s)return t;const{data:e}=s.data;for(const n of Object.keys(this.dataTransform)){const r=this.columns.find(o=>o.name===n);r&&r.forceDataTransform&&(n in e||(e[n]=""))}const i=e;for(const n in i){const r=this.dataTransform[n];r?t[n]=r(i[n],e,s):t[n]=e[n]}return t}downloadData(s="BIM Table Data",t="json"){let e=null;if(t==="json"&&(e=new File([JSON.stringify(this.value,void 0,2)],`${s}.json`)),t==="csv"&&(e=new File([this.csv],`${s}.csv`)),t==="tsv"&&(e=new File([this.tsv],`${s}.tsv`)),!e)return;const i=document.createElement("a");i.href=URL.createObjectURL(e),i.download=e.name,i.click(),URL.revokeObjectURL(i.href)}getRowIndentation(s,t=this.value,e=0){for(const i of t){if(i.data===s)return e;if(i.children){const n=this.getRowIndentation(s,i.children,e+1);if(n!==null)return n}}return null}getGroupIndentation(s,t=this.value,e=0){for(const i of t){if(i===s)return e;if(i.children){const n=this.getGroupIndentation(s,i.children,e+1);if(n!==null)return n}}return null}connectedCallback(){super.connectedCallback(),this.dispatchEvent(new Event("connected"))}disconnectedCallback(){super.disconnectedCallback(),this.dispatchEvent(new Event("disconnected"))}async loadData(s=!1){if(this._filteredData.length!==0&&!s||!this.loadFunction)return!1;this.loading=!0;try{const t=await this.loadFunction();return this.data=t,this.loading=!1,this._errorLoading=!1,!0}catch(t){if(this.loading=!1,this._filteredData.length!==0)return!1;const e=this.querySelector("[slot='error-loading']"),i=e==null?void 0:e.querySelector("[data-table-element='error-message']");return t instanceof Error&&i&&t.message.trim()!==""&&(i.textContent=t.message),this._errorLoading=!0,!1}}filter(s,t=this.filterFunction??this._stringFilterFunction,e=this.data){const i=[];for(const n of e)if(t(s,n)){if(this.preserveStructureOnFilter){const r={data:n.data};if(n.children){const o=this.filter(s,t,n.children);o.length&&(r.children=o)}i.push(r)}else if(i.push({data:n.data}),n.children){const r=this.filter(s,t,n.children);i.push(...r)}}else if(n.children){const r=this.filter(s,t,n.children);this.preserveStructureOnFilter&&r.length?i.push({data:n.data,children:r}):i.push(...r)}return i}get _missingDataElement(){return this.querySelector("[slot='missing-data']")}render(){if(this.loading)return mk();if(this._errorLoading)return ct`<slot name="error-loading"></slot>`;if(this._filteredData.length===0&&this._missingDataElement)return ct`<slot name="missing-data"></slot>`;const s=document.createElement("bim-table-row");s.table=this,s.isHeader=!0,s.data=this._headerRowData,s.style.gridArea="Header",s.style.position="sticky",s.style.top="0",s.style.zIndex="5";const t=document.createElement("bim-table-children");return t.table=this,t.data=this.value,t.style.gridArea="Body",t.style.backgroundColor="transparent",ct`
      <div class="parent">
        ${this.headersHidden?null:s} ${gk()}
        <div style="overflow-x: hidden; grid-area: Body">${t}</div>
      </div>
    `}};JI.styles=[uo.scrollbar,oe`
      :host {
        position: relative;
        overflow: auto;
        display: block;
        pointer-events: auto;
      }

      :host(:not([data-processing])) .loader {
        display: none;
      }

      .parent {
        display: grid;
        grid-template:
          "Header" auto
          "Processing" auto
          "Body" 1fr
          "Footer" auto;
        overflow: auto;
        height: 100%;
      }

      .parent > bim-table-row[is-header] {
        color: var(--bim-table_header--c, var(--bim-ui_bg-contrast-100));
        background-color: var(
          --bim-table_header--bgc,
          var(--bim-ui_bg-contrast-20)
        );
      }

      .controls {
        display: flex;
        gap: 0.375rem;
        flex-wrap: wrap;
        margin-bottom: 0.5rem;
      }
    `];let wi=JI;Yi([Ul()],wi.prototype,"_filteredData",2);Yi([ut({type:Boolean,attribute:"headers-hidden",reflect:!0})],wi.prototype,"headersHidden",2);Yi([ut({type:String,attribute:"min-col-width",reflect:!0})],wi.prototype,"minColWidth",2);Yi([ut({type:Array,attribute:!1})],wi.prototype,"columns",1);Yi([ut({type:Array,attribute:!1})],wi.prototype,"data",1);Yi([ut({type:Boolean,reflect:!0})],wi.prototype,"expanded",2);Yi([ut({type:Boolean,reflect:!0,attribute:"selectable-rows"})],wi.prototype,"selectableRows",2);Yi([ut({attribute:!1})],wi.prototype,"selection",2);Yi([ut({type:Boolean,attribute:"no-indentation",reflect:!0})],wi.prototype,"noIndentation",2);Yi([ut({type:Boolean,attribute:"no-carets",reflect:!0})],wi.prototype,"noCarets",2);Yi([ut({type:Boolean,reflect:!0})],wi.prototype,"loading",2);Yi([Ul()],wi.prototype,"_errorLoading",2);var xk=Object.defineProperty,Tk=Object.getOwnPropertyDescriptor,Yl=(s,t,e,i)=>{for(var n=i>1?void 0:i?Tk(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&xk(t,e,n),n};const tx=class extends ie{constructor(){super(...arguments),this._switchers=[],this.bottom=!1,this.switchersHidden=!1,this.floating=!1,this.switchersFull=!1,this.onTabHiddenChange=s=>{const t=s.target;t instanceof li&&!t.hidden&&(t.removeEventListener("hiddenchange",this.onTabHiddenChange),this.tab=t.name,t.addEventListener("hiddenchange",this.onTabHiddenChange))}}set tab(s){this._tab=s;const t=[...this.children],e=t.find(i=>i instanceof li&&i.name===s);for(const i of t){if(!(i instanceof li))continue;i.hidden=e!==i;const n=this.getTabSwitcher(i.name);n&&n.toggleAttribute("data-active",!i.hidden)}e||(this._tab="hidden",this.setAttribute("tab","hidden"))}get tab(){return this._tab}getTabSwitcher(s){return this._switchers.find(t=>t.getAttribute("data-name")===s)}createSwitchers(){this._switchers=[];for(const s of this.children){if(!(s instanceof li))continue;const t=document.createElement("div");t.addEventListener("click",()=>{this.tab===s.name?this.toggleAttribute("tab",!1):this.tab=s.name,this.setAnimatedBackgound()}),t.setAttribute("data-name",s.name),t.className="switcher";const e=document.createElement("bim-label");e.textContent=s.label??null,e.icon=s.icon,t.append(e),this._switchers.push(t)}}updateSwitchers(){for(const s of this.children){if(!(s instanceof li))continue;const t=this._switchers.find(i=>i.getAttribute("data-name")===s.name);if(!t)continue;const e=t.querySelector("bim-label");e&&(e.textContent=s.label??null,e.icon=s.icon)}}onSlotChange(s){this.createSwitchers();const t=s.target.assignedElements(),e=t.find(i=>i instanceof li?this.tab?i.name===this.tab:!i.hidden:!1);e&&e instanceof li&&(this.tab=e.name);for(const i of t){if(!(i instanceof li)){i.remove();continue}i.removeEventListener("hiddenchange",this.onTabHiddenChange),e!==i&&(i.hidden=!0),i.addEventListener("hiddenchange",this.onTabHiddenChange)}}doubleRequestAnimationFrames(s){requestAnimationFrame(()=>requestAnimationFrame(s))}setAnimatedBackgound(s=!1){var t;const e=this.renderRoot.querySelector(".animated-background"),i=[...((t=this.renderRoot.querySelector(".switchers"))==null?void 0:t.querySelectorAll(".switcher"))||[]].filter(n=>n.hasAttribute("data-active"))[0];requestAnimationFrame(()=>{var n,r,o,a;const l=(a=(o=(r=(n=i==null?void 0:i.parentElement)==null?void 0:n.shadowRoot)==null?void 0:r.querySelector("bim-input"))==null?void 0:o.shadowRoot)==null?void 0:a.querySelector(".input"),h={width:i==null?void 0:i.clientWidth,height:i==null?void 0:i.clientHeight,top:((i==null?void 0:i.offsetTop)??0)-((l==null?void 0:l.offsetTop)??0),left:((i==null?void 0:i.offsetLeft)??0)-((l==null?void 0:l.offsetLeft)??0)};i?(e==null||e.style.setProperty("width",`${h.width}px`),e==null||e.style.setProperty("height",`${h.height}px`),e==null||e.style.setProperty("left",`${h.left}px`)):e==null||e.style.setProperty("width","0"),this.bottom?(e==null||e.style.setProperty("top","100%"),e==null||e.style.setProperty("transform","translateY(-100%)")):e==null||e.style.setProperty("top",`${h.top}px`)}),s&&this.doubleRequestAnimationFrames(()=>{const n="ease";e==null||e.style.setProperty("transition",`width ${.3}s ${n}, height ${.3}s ${n}, top ${.3}s ${n}, left ${.3}s ${n}`)})}firstUpdated(){requestAnimationFrame(()=>{this.setAnimatedBackgound(!0)}),new ResizeObserver(()=>{this.setAnimatedBackgound()}).observe(this)}render(){return ct`
      <div class="parent">
        <div class="switchers">
          <div class="animated-background"></div>
          ${this._switchers}
        </div>
        <div class="content">
          <slot @slotchange=${this.onSlotChange}></slot>
        </div>
      </div>
    `}};tx.styles=[uo.scrollbar,oe`
      * {
        box-sizing: border-box;
      }

      :host {
        background-color: var(--bim-ui_bg-base);
        display: block;
        overflow: auto;
      }

      .parent {
        display: grid;
        overflow: hidden;
        position: relative;
        grid-template: "switchers" auto "content" 1fr;
        height: 100%;
      }

      :host([bottom]) .parent {
        grid-template: "content" 1fr "switchers" auto;
      }

      .switchers {
        position: relative;
        display: flex;
        height: 2.25rem;
        font-weight: 600;
        grid-area: switchers;
      }

      .switcher {
        --bim-label--c: var(--bim-ui_bg-contrast-80);
        background-color: transparent;
        position: relative;
        cursor: pointer;
        pointer-events: auto;
        padding: 0rem 0.75rem;
        display: flex;
        justify-content: center;
        z-index: 2;
        transition: all 0.15s;
      }

      .switcher:not([data-active]):hover {
        filter: brightness(150%);
      }

      :host([switchers-full]) .switcher {
        flex: 1;
      }

      .switcher[data-active] {
        --bim-label--c: var(--bim-ui_main-contrast);
      }

      .switchers bim-label {
        pointer-events: none;
      }

      :host([switchers-hidden]) .switchers {
        display: none;
      }

      .content {
        position: relative;
        display: grid;
        grid-template-columns: 1fr;
        grid-area: content;
        max-height: 100vh;
        overflow: auto;
        transition: max-height 0.2s;
      }

      :host([tab="hidden"]) .content {
        max-height: 0;
      }

      .animated-background {
        position: absolute;
        background: var(--bim-ui_main-base);
        width: 0;
        height: 0;
        top: 0;
        left: 0;
      }

      :host(:not([bottom])) .content {
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([bottom]) .content {
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating]) {
        background-color: transparent;
      }

      :host([floating]) .switchers {
        justify-self: center;
        overflow: hidden;
        background-color: var(--bim-ui_bg-base);
      }

      :host([floating]:not([bottom])) .switchers {
        border-radius: var(--bim-ui_size-2xs) var(--bim-ui_size-2xs) 0 0;
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
        border-left: 1px solid var(--bim-ui_bg-contrast-20);
        border-right: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][bottom]) .switchers {
        border-radius: 0 0 var(--bim-ui_size-2xs) var(--bim-ui_size-2xs);
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
        border-left: 1px solid var(--bim-ui_bg-contrast-20);
        border-right: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][tab="hidden"]) .switchers {
        border-radius: var(--bim-ui_size-2xs);
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][bottom][tab="hidden"]) .switchers {
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating]) .content {
        border: 1px solid var(--bim-ui_bg-contrast-20);
        border-radius: var(--bim-ui_size-2xs);
        background-color: var(--bim-ui_bg-base);
      }
    `];let mr=tx;Yl([Ul()],mr.prototype,"_switchers",2);Yl([ut({type:Boolean,reflect:!0})],mr.prototype,"bottom",2);Yl([ut({type:Boolean,attribute:"switchers-hidden",reflect:!0})],mr.prototype,"switchersHidden",2);Yl([ut({type:Boolean,reflect:!0})],mr.prototype,"floating",2);Yl([ut({type:String,reflect:!0})],mr.prototype,"tab",1);Yl([ut({type:Boolean,attribute:"switchers-full",reflect:!0})],mr.prototype,"switchersFull",2);var Ak=Object.defineProperty,Sk=Object.getOwnPropertyDescriptor,pf=(s,t,e,i)=>{for(var n=i>1?void 0:i?Sk(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&Ak(t,e,n),n};const ex=class extends ie{constructor(){super(...arguments),this._defaultName="__unnamed__",this.name=this._defaultName,this._hidden=!1}set label(s){this._label=s;const t=this.parentElement;t instanceof mr&&t.updateSwitchers()}get label(){return this._label}set icon(s){this._icon=s;const t=this.parentElement;t instanceof mr&&t.updateSwitchers()}get icon(){return this._icon}set hidden(s){this._hidden=s,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}connectedCallback(){super.connectedCallback();const{parentElement:s}=this;if(s&&this.name===this._defaultName){const t=[...s.children].indexOf(this);this.name=`${this._defaultName}${t}`}}render(){return ct` <slot></slot> `}};ex.styles=oe`
    :host {
      display: block;
      height: 100%;
      grid-row-start: 1;
      grid-column-start: 1;
      animation: openAnim 3s forwards;
      transform: translateY(0);
      max-height: 100vh;
      transition:
        opacity 0.3s ease,
        max-height 0.6s ease,
        transform 0.3s ease;
    }

    :host([hidden]) {
      transform: translateY(-20px);
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      visibility: hidden;
    }
  `;let li=ex;pf([ut({type:String,reflect:!0})],li.prototype,"name",2);pf([ut({type:String,reflect:!0})],li.prototype,"label",1);pf([ut({type:String,reflect:!0})],li.prototype,"icon",1);pf([ut({type:Boolean,reflect:!0})],li.prototype,"hidden",1);/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ow=s=>s??Be;var Ok=Object.defineProperty,Pk=Object.getOwnPropertyDescriptor,dn=(s,t,e,i)=>{for(var n=i>1?void 0:i?Pk(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&Ok(t,e,n),n};const sx=class extends ie{constructor(){super(...arguments),this._inputTypes=["date","datetime-local","email","month","password","search","tel","text","time","url","week","area"],this.value="",this.vertical=!1,this.disabled=!1,this.resize="vertical",this._type="text",this.onValueChange=new Event("input")}set type(s){this._inputTypes.includes(s)&&(this._type=s)}get type(){return this._type}get query(){return y_(this.value)}onInputChange(s){s.stopPropagation();const t=s.target;clearTimeout(this._debounceTimeoutID),this._debounceTimeoutID=setTimeout(()=>{this.value=t.value,this.dispatchEvent(this.onValueChange)},this.debounce)}focus(){setTimeout(()=>{var s;const t=(s=this.shadowRoot)==null?void 0:s.querySelector("input");t==null||t.focus()})}render(){return ct`
      <bim-input
        .name=${this.name}
        .icon=${this.icon}
        .label=${this.label}
        .vertical=${this.vertical}
      >
        ${this.type==="area"?ct` <textarea
              aria-label=${this.label||this.name||"Text Input"}
              .value=${this.value}
              .rows=${this.rows??5}
              ?disabled=${this.disabled}
              placeholder=${ow(this.placeholder)}
              @input=${this.onInputChange}
              style="resize: ${this.resize};"
            ></textarea>`:ct` <input
              aria-label=${this.label||this.name||"Text Input"}
              .type=${this.type}
              .value=${this.value}
              ?disabled=${this.disabled}
              placeholder=${ow(this.placeholder)}
              @input=${this.onInputChange}
            />`}
      </bim-input>
    `}};sx.styles=[uo.scrollbar,oe`
      :host {
        --bim-input--bgc: var(--bim-ui_bg-contrast-20);
        flex: 1;
        display: block;
      }

      input,
      textarea {
        font-family: inherit;
        background-color: transparent;
        border: none;
        width: 100%;
        padding: var(--bim-ui_size-3xs);
        color: var(--bim-text-input--c, var(--bim-ui_bg-contrast-100));
      }

      input {
        outline: none;
        height: 100%;
        padding: 0 var(--bim-ui_size-3xs); /* Override padding */
        border-radius: var(--bim-text-input--bdrs, var(--bim-ui_size-4xs));
      }

      :host([disabled]) input,
      :host([disabled]) textarea {
        color: var(--bim-ui_bg-contrast-60);
      }

      textarea {
        line-height: 1.1rem;
        outline: none;
      }

      :host(:focus) {
        --bim-input--olc: var(--bim-ui_accent-base);
      }

      /* :host([disabled]) {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
    } */
    `];let si=sx;dn([ut({type:String,reflect:!0})],si.prototype,"icon",2);dn([ut({type:String,reflect:!0})],si.prototype,"label",2);dn([ut({type:String,reflect:!0})],si.prototype,"name",2);dn([ut({type:String,reflect:!0})],si.prototype,"placeholder",2);dn([ut({type:String,reflect:!0})],si.prototype,"value",2);dn([ut({type:Boolean,reflect:!0})],si.prototype,"vertical",2);dn([ut({type:Number,reflect:!0})],si.prototype,"debounce",2);dn([ut({type:Number,reflect:!0})],si.prototype,"rows",2);dn([ut({type:Boolean,reflect:!0})],si.prototype,"disabled",2);dn([ut({type:String,reflect:!0})],si.prototype,"resize",2);dn([ut({type:String,reflect:!0})],si.prototype,"type",1);var Fk=Object.defineProperty,Rk=Object.getOwnPropertyDescriptor,ix=(s,t,e,i)=>{for(var n=i>1?void 0:i?Rk(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&Fk(t,e,n),n};const nx=class extends ie{constructor(){super(...arguments),this.rows=2,this._vertical=!1}set vertical(s){this._vertical=s,this.updateChildren()}get vertical(){return this._vertical}updateChildren(){const s=this.children;for(const t of s)this.vertical?t.setAttribute("label-hidden",""):t.removeAttribute("label-hidden")}render(){return ct`
      <style>
        .parent {
          grid-auto-flow: ${this.vertical?"row":"column"};
          grid-template-rows: repeat(${this.rows}, 1fr);
        }
      </style>
      <div class="parent">
        <slot @slotchange=${this.updateChildren}></slot>
      </div>
    `}};nx.styles=oe`
    .parent {
      display: grid;
      gap: 0.25rem;
    }

    ::slotted(bim-button[label]:not([vertical])) {
      --bim-button--jc: flex-start;
    }

    ::slotted(bim-button) {
      --bim-label--c: var(--bim-ui_bg-contrast-80);
    }
  `;let ff=nx;ix([ut({type:Number,reflect:!0})],ff.prototype,"rows",2);ix([ut({type:Boolean,reflect:!0})],ff.prototype,"vertical",1);var Lk=Object.defineProperty,Nk=Object.getOwnPropertyDescriptor,mf=(s,t,e,i)=>{for(var n=i>1?void 0:i?Nk(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&Lk(t,e,n),n};const rx=class extends ie{constructor(){super(...arguments),this._vertical=!1,this._labelHidden=!1}set vertical(s){this._vertical=s,this.updateChildren()}get vertical(){return this._vertical}set labelHidden(s){this._labelHidden=s,this.updateChildren()}get labelHidden(){return this._labelHidden}updateChildren(){const s=this.children;for(const t of s)t instanceof ff&&(t.vertical=this.vertical),t.toggleAttribute("label-hidden",this.vertical)}render(){return ct`
      <div class="parent">
        <div class="children">
          <slot @slotchange=${this.updateChildren}></slot>
        </div>
        ${!this.labelHidden&&(this.label||this.icon)?ct`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
      </div>
    `}};rx.styles=oe`
    :host {
      --bim-label--fz: var(--bim-ui_size-xs);
      --bim-label--c: var(--bim-ui_bg-contrast-60);
      display: block;
      flex: 1;
    }

    :host(:not([vertical])) ::slotted(bim-button[vertical]) {
      --bim-icon--fz: var(--bim-ui_size-5xl);
      min-height: 3.75rem;
    }

    .parent {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      align-items: center;
      padding: 0.5rem;
      height: 100%;
      box-sizing: border-box;
      justify-content: space-between;
    }

    :host([vertical]) .parent {
      flex-direction: row-reverse;
    }

    :host([vertical]) .parent > bim-label {
      writing-mode: tb;
    }

    .children {
      display: flex;
      gap: 0.25rem;
    }

    :host([vertical]) .children {
      flex-direction: column;
    }
  `;let Wl=rx;mf([ut({type:String,reflect:!0})],Wl.prototype,"label",2);mf([ut({type:String,reflect:!0})],Wl.prototype,"icon",2);mf([ut({type:Boolean,reflect:!0})],Wl.prototype,"vertical",1);mf([ut({type:Boolean,attribute:"label-hidden",reflect:!0})],Wl.prototype,"labelHidden",1);var Mk=Object.defineProperty,Dk=Object.getOwnPropertyDescriptor,Cb=(s,t,e,i)=>{for(var n=i>1?void 0:i?Dk(t,e):t,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(t,e,n):o(n))||n);return i&&n&&Mk(t,e,n),n};const ox=class extends ie{constructor(){super(...arguments),this.labelsHidden=!1,this._vertical=!1,this._hidden=!1}set vertical(s){this._vertical=s,this.updateSections()}get vertical(){return this._vertical}set hidden(s){this._hidden=s,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}updateSections(){const s=this.children;for(const t of s)t instanceof Wl&&(t.labelHidden=this.vertical&&!Os.config.sectionLabelOnVerticalToolbar,t.vertical=this.vertical)}render(){return ct`
      <div class="parent">
        <slot @slotchange=${this.updateSections}></slot>
      </div>
    `}};ox.styles=oe`
    :host {
      --bim-button--bgc: transparent;
      background-color: var(--bim-ui_bg-base);
      border-radius: var(--bim-ui_size-2xs);
      display: block;
    }

    :host([hidden]) {
      display: none;
    }

    .parent {
      display: flex;
      width: max-content;
      pointer-events: auto;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    :host([vertical]) {
      width: min-content;
      border-radius: var(--bim-ui_size-2xs);
      border: 1px solid var(--bim-ui_bg-contrast-20);
    }

    ::slotted(bim-toolbar-section:not(:last-child)) {
      border-right: 1px solid var(--bim-ui_bg-contrast-20);
      border-bottom: none;
    }

    :host([vertical]) ::slotted(bim-toolbar-section:not(:last-child)) {
      border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      border-right: none;
    }
  `;let gf=ox;Cb([ut({type:String,reflect:!0})],gf.prototype,"icon",2);Cb([ut({type:Boolean,attribute:"labels-hidden",reflect:!0})],gf.prototype,"labelsHidden",2);Cb([ut({type:Boolean,reflect:!0})],gf.prototype,"vertical",1);var kk=Object.defineProperty,zk=(s,t,e,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(t,e,n)||n);return n&&kk(t,e,n),n};const ax=class extends ie{constructor(){super(),this._onResize=new Event("resize"),new ResizeObserver(()=>{setTimeout(()=>{this.dispatchEvent(this._onResize)})}).observe(this)}render(){return ct`
      <div class="parent">
        <slot></slot>
      </div>
    `}};ax.styles=oe`
    :host {
      display: grid;
      min-width: 0;
      min-height: 0;
      height: 100%;
    }

    .parent {
      overflow: hidden;
      position: relative;
    }
  `;let lx=ax;zk([ut({type:String,reflect:!0})],lx.prototype,"name");/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const hx="important",Uk=" !"+hx,Zo=lI(class extends hI{constructor(s){var t;if(super(s),s.type!==aI.ATTRIBUTE||s.name!=="style"||((t=s.strings)==null?void 0:t.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(s){return Object.keys(s).reduce((t,e)=>{const i=s[e];return i==null?t:t+`${e=e.includes("-")?e:e.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${i};`},"")}update(s,[t]){const{style:e}=s.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(t)),this.render(t);for(const i of this.ft)t[i]==null&&(this.ft.delete(i),i.includes("-")?e.removeProperty(i):e[i]=null);for(const i in t){const n=t[i];if(n!=null){this.ft.add(i);const r=typeof n=="string"&&n.endsWith(Uk);i.includes("-")||r?e.setProperty(i,r?n.slice(0,-11):n,r?hx:""):e[i]=n}}return ra}});class Bk{static init(){Os.defineCustomElement("bim-view-cube",yr),Os.defineCustomElement("bim-world-2d",zl),Os.defineCustomElement("bim-world",NC)}}const Vk=s=>{const{components:t,modelUserData:e,worldName:i}=s;return ct`
    <bim-button
      data-ui-id="import-ifc"
      label="Load IFC"
      icon="mage:box-3d-fill"
      @click=${()=>{if(!(t&&i))return;const n=[...t.get(Gc).list.values()].find(o=>"name"in o&&o.name===i);if(!n)return;const r=document.createElement("input");r.type="file",r.accept=".ifc",r.onchange=async()=>{if(r.files===null||r.files.length===0)return;const o=r.files[0],a=await o.arrayBuffer(),l=new Uint8Array(a),h=o.name.replace(".ifc",""),c=t.get(Rt),u=t.get(_F);u.settings.autoSetWasm=!1,u.settings.wasm={path:"https://unpkg.com/web-ifc@0.0.69/",absolute:!1};const p=await u.load(l,!0,h,{userData:e});n.scene.three.add(p.object),p.useCamera(n.camera.three),c.core.update(!0)},r.click()}}
    ></bim-button>
  `},$k=s=>Es.create(Vk,s),Hk=Object.freeze(Object.defineProperty({__proto__:null,loadIfc:$k},Symbol.toStringTag,{value:"Module"})),jk=s=>{const{components:t,world:e}=s;return ct`
    <bim-button @click=${()=>{const i=document.createElement("input");i.type="file",i.accept=".frag",i.onchange=async()=>{if(i.files===null||i.files.length===0)return;const n=i.files[0],r=await n.arrayBuffer(),o=new Uint8Array(r),a=n.name.replace(".frag",""),l=t.get(Rt),h=await l.core.load(o,{modelId:a});e&&(e.scene.three.add(h.object),h.useCamera(e.camera.three),l.core.update(!0))},i.click()}}></bim-button>
  `},Yk=s=>{const t=Es.create(jk,s),[e]=t;return e.label="Load FRAG",e.icon="mage:box-3d-fill",t},Wk=Object.freeze(Object.defineProperty({__proto__:null,loadFrag:Yk},Symbol.toStringTag,{value:"Module"}));({...Hk,...Wk});const w_=async(s,t)=>{const{localId:e,category:i,children:n}=t;if(i&&n){const r={data:{Name:i,modelId:s.modelId,children:JSON.stringify(n.map(o=>o.localId))}};for(const o of n){const a=await w_(s,o);a&&(r.children||(r.children=[]),r.children.push(a))}return r}if(e!==null){const r=await s.getItem(e).getAttributes();if(!r)return null;const o={data:{Name:String(r.getValue("Name")),modelId:s.modelId,localId:e}};for(const a of n??[]){const l=await w_(s,a);l&&(o.children||(o.children=[]),o.children.push(l))}return o}return null},Gk=async s=>{const t=[];for(const e of s){const i=await e.getSpatialStructure(),n=await w_(e,i);if(!n)continue;const r={data:{Name:e.modelId,modelId:e.modelId},children:[n]};t.push(r)}return t},cx=s=>{const{components:t,models:e}=s,i=s.selectHighlighterName??"select";return ct`
    <bim-table @rowcreated=${n=>{n.stopImmediatePropagation();const{row:r}=n.detail,o=t.get(uc),a=t.get(Rt);r.onclick=async()=>{if(!i)return;const{data:{modelId:l,localId:h,children:c}}=r;if(!(l&&(h!==void 0||c)))return;const u=a.list.get(l);if(u){if(h!==void 0){const p=await u.getItemsChildren([h]),d={[l]:p.length!==0?new Set(p):new Set([h])};o.highlightByID(i,d,!0,!0)}else if(c){const p=JSON.parse(c),d=await u.getItemsChildren(p),_={[l]:d.length!==0?d:p};o.highlightByID(i,_,!0,!0)}}}}} @cellcreated=${({detail:n})=>{const{cell:r}=n;r.column==="Name"&&!r.rowData.Name&&(r.style.gridColumn="1 / -1")}} ${ti(async n=>{if(!n)return;const r=n;r.loadFunction=async()=>new Promise(o=>{setTimeout(()=>{o(Gk(e))})}),r.loadData(!0)})} headers-hidden>
      <bim-label slot="missing-data" style="--bim-icon--c: gold" icon="ic:round-warning">
        No models available to display the spatial structure!
      </bim-label>
    </bim-table>
  `},qk=(s,t=!0)=>{const e=Es.create(cx,s),[i,n]=e;if(i.hiddenColumns=["modelId","localId","children"],i.columns=["Name"],i.headersHidden=!0,t){const{components:r}=s,o=r.get(Rt);o.list.onItemSet.add(()=>n({models:o.list.values()})),o.list.onItemDeleted.add(()=>n())}return e},Zk=Object.freeze(Object.defineProperty({__proto__:null,spatialTree:qk,spatialTreeTemplate:cx},Symbol.toStringTag,{value:"Module"}));let $o={};const aw={_category:"Category",_localId:"LocalId",_guid:"Guid"},Xk=(s,t,e)=>{const i={data:{Name:t in aw?aw[t]:t,Value:e}};s.children||(s.children=[]),s.children.push(i)},ux=(s,t,e)=>{var i;s in $o||($o[s]=new Map);const n=$o[s],r=t._localId.value;if(n.has(r))return n.get(r);const o=(i=t[e.defaultItemNameKey])==null?void 0:i.value,a=t._category.value,l={data:{Name:(o==null?void 0:o.toString().length)>0?o.toString():a??String(r)}};n.set(r,l);for(const h in t){const c=t[h];if(!Array.isArray(c))Xk(l,h,c.value);else{const u={data:{Name:h}};l.children||(l.children=[]),l.children.push(u);for(const p of c){const d=ux(s,p,e);u.children||(u.children=[]),u.children.push(d)}}}return l},Qk=async(s,t,e)=>{const i=s.get(Rt);Object.keys(t).length===0&&($o={});const n=[];for(const r in t){const o=i.list.get(r);if(!o)continue;r in $o||($o[r]=new Map);const a=$o[r],l=t[r];for(const h of l){let c=a.get(h);if(c){n.push(c);continue}const[u]=await o.getItemsData([h],e.itemsDataConfig);c=ux(r,u,e),n.push(c)}}return n},dx=s=>{const t={defaultItemNameKey:"Name",itemsDataConfig:{attributesDefault:!0,relationsDefault:{attributes:!1,relations:!1},relations:{IsDefinedBy:{attributes:!0,relations:!0},DefinesOcurrence:{attributes:!1,relations:!1},ContainedInStructure:{attributes:!0,relations:!0},ContainsElements:{attributes:!1,relations:!1},Decomposes:{attributes:!1,relations:!1}}},...s},{components:e,modelIdMap:i,emptySelectionWarning:n}=s;return ct`
    <bim-table @cellcreated=${({detail:r})=>{const{cell:o}=r;o.column==="Name"&&!("Value"in o.rowData)&&(o.style.gridColumn="1 / -1")}} ${ti(async r=>{if(!r)return;const o=r;o.loadFunction=async()=>Qk(e,i,t),await o.loadData(!0)&&o.dispatchEvent(new Event("datacomputed"))})}>
      ${n?ct`
            <bim-label slot="missing-data" style="--bim-icon--c: gold" icon="ic:round-warning">
              Select some elements to display its properties
            </bim-label>
            `:null}
      <bim-label slot="error-loading" style="--bim-icon--c: #e72e2e" icon="bxs:error-alt">
        Something went wrong with the properties
      </bim-label>
    </bim-table>
  `},Kk=(s,t)=>{t.columns=[{name:"Name",width:"12rem"}],t.headersHidden=!0},Jk=s=>{const t=Es.create(dx,s),[e]=t;return Kk(s,e),t},tz=Object.freeze(Object.defineProperty({__proto__:null,itemsData:Jk,itemsDataTemplate:dx},Symbol.toStringTag,{value:"Module"})),px=s=>{const{components:t}=s,e=s.missingDataMessage??"No models has been loaded yet",i=t.get(Rt),n=({detail:r})=>{const{cell:o}=r;o.style.padding="0.25rem 0"};return ct`
    <bim-table ${ti(async r=>{if(!r)return;const o=r,a=[];for(const[,l]of i.list){if(!l)continue;const h=await l.getMetadata(),c={data:{Name:l.modelId,modelId:l.modelId,metadata:JSON.stringify(h)}};a.push(c)}o.data=a})} @cellcreated=${n}>
      <bim-label slot="missing-data" style="--bim-icon--c: gold" icon="ic:round-warning">
        ${e}
      </bim-label>
    </bim-table>
  `},ez=(s,t)=>{const{components:e,actions:i,metaDataTags:n}=s,r=e.get(Rt),o=(i==null?void 0:i.dispose)??!0,a=(i==null?void 0:i.download)??!0,l=(i==null?void 0:i.visibility)??!0,h=n??[];t.hiddenColumns=["modelId","metadata"],t.headersHidden=!0,t.noIndentation=!0,t.dataTransform={Name:(c,u)=>{const{modelId:p,metadata:d}=u;if(!p)return c;const _=r.list.get(p);if(!_)return p;const m=[];if(d){const y=JSON.parse(d);for(const E of h){const C=y[E];if(!(typeof C=="string"||typeof C=="boolean"||typeof C=="number"))continue;const I=ct`
            <bim-label style="background-color: var(--bim-ui_main-base); padding: 0 0.25rem; color: var(--bim-ui_main-contrast); border-radius: 0.25rem;">${C}</bim-label>
            `;m.push(I)}}let g;o&&(g=ct`<bim-button @click=${()=>r.core.disposeModel(_.modelId)} icon="mdi:delete"></bim-button>`);let f;l&&(f=ct`<bim-button @click=${async({target:y})=>{y.loading=!0,await _.setVisible(void 0,y.hasAttribute("data-model-hidden")),await r.core.update(!0),y.toggleAttribute("data-model-hidden"),y.icon=y.hasAttribute("data-model-hidden")?"mdi:eye-off":"mdi:eye",y.loading=!1}} icon="mdi:eye"></bim-button>`);let b;return a&&(b=ct`<bim-button @click=${async()=>{const y=await _.getBuffer(!1),E=new File([y],`${_.modelId}.frag`),C=document.createElement("a");C.href=URL.createObjectURL(E),C.download=E.name,C.click(),URL.revokeObjectURL(C.href)}} icon="flowbite:download-solid"></bim-button>`),ct`
       <div style="display: flex; flex: 1; gap: var(--bim-ui_size-4xs); justify-content: space-between; overflow: auto;">
        <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 0 var(--bim-ui_size-4xs); flex-grow: 1; overflow: auto;">
          <div style="min-height: 1.75rem; overflow: auto; display: flex;">
            <bim-label style="white-space: normal;">${c}</bim-label>
          </div>
          <div style="display: flex; flex-wrap: wrap; gap: var(--bim-ui_size-4xs); overflow: auto;">
            ${m}
          </div>
        </div>
        <div style="display: flex; align-self: flex-start; flex-shrink: 0;">
          ${b}
          ${f}
          ${g}
        </div>
       </div>
      `}}},sz=(s,t=!0)=>{const e=Es.create(px,s),[i,n]=e;if(ez(s,i),t){const{components:r}=s,o=r.get(Rt),a=()=>setTimeout(()=>n());o.list.onItemSet.add(a),o.list.onItemDeleted.add(a)}return e},iz=Object.freeze(Object.defineProperty({__proto__:null,modelsList:sz,modelsListTemplate:px},Symbol.toStringTag,{value:"Module"})),fx=s=>{var t;const{components:e}=s,i=s.missingDataMessage??"No viewpoints to display",n=e.get(gi),r=((t=s.topic)==null?void 0:t.viewpoints)??n.list.keys(),o=[];for(const h of r){const c=n.list.get(h);c&&o.push(c)}const a=h=>{if(!h)return;const c=h;c.data=o.map((u,p)=>({data:{Guid:u.guid,Title:u.title??`Viewpoint ${s.topic?p+1:""}`,Actions:""}}))},l=({detail:h})=>{const{cell:c}=h;c.style.padding="0.25rem"};return ct`
    <bim-table ${ti(a)} @cellcreated=${l}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${i}</bim-label>
    </bim-table>
  `},nz=(s,t)=>{const{components:e,topic:i}=s;t.noIndentation=!0,t.headersHidden=!0,t.hiddenColumns=["Guid"],t.columns=["Title",{name:"Actions",width:"auto"}];const n={selectComponents:!0,colorizeComponent:!0,resetColors:!0,updateCamera:!0,delete:!0,unlink:!!i,...s.actions},r=e.get(gi);t.dataTransform={Actions:(o,a)=>{const{Guid:l}=a;if(!(l&&typeof l=="string"))return o;const h=r.list.get(l);if(!h)return o;const c=async({target:b})=>{b.loading=!0,await h.go(),b.loading=!1};let u;n.selectComponents&&(u=ct`
          <bim-button label="Select Components" @click=${async({target:b})=>{const y=e.get(Rt),E=e.get(uc);if(!E.isSetup)return;b.loading=!0;const C=await y.guidsToModelIdMap([...h.selectionComponents]);await E.highlightByID("select",C),b.loading=!1}}></bim-button>
        `);let p;n.colorizeComponent&&(p=ct`
          <bim-button label="Colorize Components" @click=${async({target:b})=>{b.loading=!0,await h.setColorizationState(!0),b.loading=!1}}></bim-button>
        `);let d;n.resetColors&&(d=ct`
          <bim-button label="Reset Colors" @click=${async({target:b})=>{b.loading=!0,await h.setColorizationState(!1),b.loading=!1}}></bim-button>
        `);let _;n.updateCamera&&(_=ct`
          <bim-button label="Update Camera" @click=${()=>h.updateCamera()}></bim-button>
        `);let m;n.unlink&&(m=ct`
          <bim-button label="Unlink" @click=${()=>i==null?void 0:i.viewpoints.delete(h.guid)}></bim-button>
        `);let g;n.delete&&(g=ct`
          <bim-button label="Delete" @click=${()=>{r.list.delete(h.guid),Sp.removeMenus()}}></bim-button>
        `);let f;return Object.values(n).includes(!0)&&(f=ct`
          <bim-button icon="prime:ellipsis-v">
            <bim-context-menu>
              ${u}
              ${p}
              ${d}
              ${_}
              ${m}
              ${g}
            </bim-context-menu>
          </bim-button>
        `),ct`
        <bim-button icon="ph:eye-fill" @click=${c}></bim-button>
        ${f}
      `}}},mx=(s,t=!0)=>{const e=Es.create(fx,s),[i,n]=e;if(nz(s,i),t){const{components:r,topic:o}=s,a=r.get(gi);a.list.onItemUpdated.add(()=>n()),a.list.onItemDeleted.add(()=>n()),a.list.onCleared.add(()=>n()),o?(o.viewpoints.onItemAdded.add(()=>n()),o.viewpoints.onItemDeleted.add(()=>n()),o.viewpoints.onCleared.add(()=>n())):a.list.onItemSet.add(()=>n())}return e},rz=Object.freeze(Object.defineProperty({__proto__:null,viewpointsList:mx,viewpointsListTemplate:fx},Symbol.toStringTag,{value:"Module"})),gx=s=>{const{components:t}=s,e=s.missingDataMessage??"No topics to display",i=t.get(Ne),n=s.topics??i.list.values();return ct`
    <bim-table no-indentation ${ti(r=>{if(!r)return;const o=r;o.data=[...n].map(a=>{var l;return{data:{Guid:a.guid,Title:a.title,Status:a.status,Description:a.description??"",Author:a.creationAuthor,Assignee:a.assignedTo??"",Date:a.creationDate.toDateString(),DueDate:((l=a.dueDate)==null?void 0:l.toDateString())??"",Type:a.type,Priority:a.priority??""}}})})}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${e}</bim-label>
    </bim-table>
  `},fl=(s,t)=>{const e=t[s],i=(e==null?void 0:e.name)??s,n=i.trim().split(/\s+/);let r,o;return n[0]&&n[0][0]&&(r=n[0][0].toUpperCase(),n[0][1]&&(o=n[0][1].toUpperCase())),n[1]&&n[1][0]&&(o=n[1][0].toUpperCase()),ct`
    <div style="display: flex; gap: 0.25rem; overflow: hidden;">
      ${!(e!=null&&e.picture)&&(r||o)?ct`
        <bim-label
          style=${Zo({borderRadius:"999px",padding:"0.375rem",backgroundColor:"var(--bim-ui_bg-contrast-20)",aspectRatio:"1",fontSize:"0.7rem"})}>${r}${o}</bim-label>
        `:null}
      <bim-label .img=${e==null?void 0:e.picture}>${i}</bim-label>
    </div>
  `},ci={users:{"jhon.doe@example.com":{name:"Jhon Doe"}},priorities:{"On hold":{icon:"flowbite:circle-pause-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#767676"}},Minor:{icon:"mingcute:arrows-down-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#4CAF50"}},Normal:{icon:"fa6-solid:grip-lines",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Major:{icon:"mingcute:arrows-up-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Critical:{icon:"ph:warning",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}}},statuses:{Active:{icon:"prime:circle-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)"}},"In Progress":{icon:"prime:circle-fill",style:{backgroundColor:"#fa89004d","--bim-label--c":"#FB8C00","--bim-icon--c":"#FB8C00"}},"In Review":{icon:"prime:circle-fill",style:{backgroundColor:"#9c6bff4d","--bim-label--c":"#9D6BFF","--bim-icon--c":"#9D6BFF"}},Done:{icon:"prime:circle-fill",style:{backgroundColor:"#4CAF504D","--bim-label--c":"#4CAF50","--bim-icon--c":"#4CAF50"}},Closed:{icon:"prime:circle-fill",style:{backgroundColor:"#414141","--bim-label--c":"#727272","--bim-icon--c":"#727272"}}},types:{Clash:{icon:"gg:close-r",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Issue:{icon:"mdi:bug-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Failure:{icon:"mdi:bug-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Inquiry:{icon:"majesticons:comment-line",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Fault:{icon:"ph:warning",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Remark:{icon:"ph:note-blank-bold",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Request:{icon:"mynaui:edit-one",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#9D6BFF"}}}},ml={padding:"0.25rem 0.5rem",borderRadius:"999px","--bim-label--c":"var(--bim-ui_bg-contrast-100)"},oz={dueDate:s=>{if(typeof s=="string"&&s.trim()!=="")return new Date(s)},status:s=>{if(Array.isArray(s)&&s.length!==0)return s[0]},type:s=>{if(Array.isArray(s)&&s.length!==0)return s[0]},priority:s=>{if(Array.isArray(s)&&s.length!==0)return s[0]},stage:s=>{if(Array.isArray(s)&&s.length!==0)return s[0]},assignedTo:s=>{if(Array.isArray(s)&&s.length!==0)return s[0]},labels:s=>{if(Array.isArray(s))return new Set(s)}},_x=s=>{const{components:t,topic:e,value:i,onCancel:n,onSubmit:r,styles:o}=s,a=r??(()=>{}),l=t.get(Ne),h=(i==null?void 0:i.title)??(e==null?void 0:e.title)??Sn.default.title,c=(i==null?void 0:i.status)??(e==null?void 0:e.status)??Sn.default.status,u=(i==null?void 0:i.type)??(e==null?void 0:e.type)??Sn.default.type,p=(i==null?void 0:i.priority)??(e==null?void 0:e.priority)??Sn.default.priority,d=(i==null?void 0:i.assignedTo)??(e==null?void 0:e.assignedTo)??Sn.default.assignedTo,_=(i==null?void 0:i.labels)??(e==null?void 0:e.labels)??Sn.default.labels,m=(i==null?void 0:i.stage)??(e==null?void 0:e.stage)??Sn.default.stage,g=(i==null?void 0:i.description)??(e==null?void 0:e.description)??Sn.default.description,f=e!=null&&e.dueDate?e.dueDate.toISOString().split("T")[0]:null,b=new Set([...l.config.statuses]);c&&b.add(c);const y=new Set([...l.config.types]);u&&y.add(u);const E=new Set([...l.config.priorities]);p&&E.add(p);const C=new Set([...l.config.users]);d&&C.add(d);const I=new Set([...l.config.labels]);if(_)for(const v of _)I.add(v);const x=new Set([...l.config.stages]);m&&x.add(m);const A=a_(),O=async()=>{const{value:v}=A;if(!v)return;const M=Uc(v,oz);if(e)e.set(M),await a(e);else{const Q=l.create(M);await a(Q)}},L=a_(),V=v=>{const{value:M}=L;if(!M)return;const Q=v.target;M.disabled=Q.value.trim()===""},T=`btn-${Os.newRandomId()}`,N=`btn-${Os.newRandomId()}`;return ct`
    <div ${ti(A)} style="display: flex; flex-direction: column; gap: 0.75rem;">
      <div style="display: flex; gap: 0.375rem">
        <bim-text-input @input=${V} vertical label="Title" name="title" .value=${h}></bim-text-input>
        ${e?ct`
            <bim-dropdown vertical label="Status" name="status" required>
              ${[...b].map(v=>ct`<bim-option label=${v} .checked=${c===v}></bim-option>`)}
            </bim-dropdown>`:ct``}
      </div>
      <div style="display: flex; gap: 0.375rem">
        <bim-dropdown vertical label="Type" name="type" required>
          ${[...y].map(v=>ct`<bim-option label=${v} .checked=${u===v}></bim-option>`)}
        </bim-dropdown>
        <bim-dropdown vertical label="Priority" name="priority">
          ${[...E].map(v=>ct`<bim-option label=${v} .checked=${p===v}></bim-option>`)}
        </bim-dropdown>
      </div>
      <div style="display: flex; gap: 0.375rem">
        <bim-dropdown vertical label="Labels" name="labels" multiple>
          ${[...I].map(v=>ct`<bim-option label=${v} .checked=${_?[..._].includes(v):!1}></bim-option>`)}
        </bim-dropdown>
        <bim-dropdown vertical label="Assignee" name="assignedTo">
          ${[...C].map(v=>{const M=o!=null&&o.users?o.users[v]:null,Q=M?M.name:v,j=M==null?void 0:M.picture;return ct`<bim-option label=${Q} value=${v} .img=${j} .checked=${d===v}></bim-option>`})}
        </bim-dropdown>
      </div>
      <div style="display: flex; gap: 0.375rem">
        <bim-text-input vertical type="date" label="Due Date" name="dueDate" .value=${f}></bim-text-input> 
        <bim-dropdown vertical label="Stage" name="stage">
          ${[...x].map(v=>ct`<bim-option label=${v} .checked=${m===v}></bim-option>`)}
        </bim-dropdown>
      </div>
      <bim-text-input vertical label="Description" name="description" type="area" .value=${g??null}></bim-text-input>
      <div style="justify-content: right; display: flex; gap: 0.375rem">
        <style>
          #${N} {
            background-color: transparent;
          }

          #${N}:hover {
            --bim-label--c: #FF5252;
          }

          #${T}:hover {
            background-color: #329936;
          }
        </style>
        <bim-button id=${N} style="flex: 0" @click=${n} label="Cancel"></bim-button>
        <bim-button id=${T} style="flex: 0" @click=${O} ${ti(L)} label=${e?"Update Topic":"Add Topic"} icon=${e?"tabler:refresh":"mi:add"}></bim-button>
      </div>
    </div>
  `},az=(s,t)=>{const{dataStyles:e}=s;t.hiddenColumns.length===0&&(t.hiddenColumns=["Guid"]),t.columns=["Title"],t.dataTransform={Priority:i=>{if(typeof i!="string")return i;const n=((e==null?void 0:e.priorities)??ci.priorities)[i];return ct`
            <bim-label
              .icon=${n==null?void 0:n.icon}
              style=${Zo({...ml,...n==null?void 0:n.style})}
            >${i}
            </bim-label>
          `},Status:i=>{if(typeof i!="string")return i;const n=((e==null?void 0:e.statuses)??ci.statuses)[i];return ct`
            <bim-label
              .icon=${n==null?void 0:n.icon}
              style=${Zo({...ml,...n==null?void 0:n.style})}
            >${i}
            </bim-label>
          `},Type:i=>{if(typeof i!="string")return i;const n=((e==null?void 0:e.types)??ci.types)[i];return ct`
            <bim-label
              .icon=${n==null?void 0:n.icon}
              style=${Zo({...ml,...n==null?void 0:n.style})}
            >${i}
            </bim-label>
          `},Author:i=>typeof i!="string"?i:fl(i,(e==null?void 0:e.users)??ci.users),Assignee:i=>typeof i!="string"?i:fl(i,(e==null?void 0:e.users)??ci.users)}},bx=(s,t=!0)=>{const e=Es.create(gx,s),[i,n]=e;if(az(s,i),t){const{components:r,topics:o}=s,a=r.get(Ne),l=()=>n();if(a.list.onItemUpdated.add(l),a.list.onItemDeleted.add(l),o)for(const h of o)h.relatedTopics.onItemAdded.add(l),h.relatedTopics.onItemDeleted.add(l),h.relatedTopics.onCleared.add(l);else a.list.onItemSet.add(l)}return e},lz=Object.freeze(Object.defineProperty({__proto__:null,topicsList:bx,topicsListTemplate:gx},Symbol.toStringTag,{value:"Module"})),yx=s=>{const{topic:t,styles:e,viewpoint:i}=s,n=s.missingDataMessage??"The topic has no comments";return ct`
    <bim-table no-indentation ${ti(r=>{if(!r)return;const o=r;let a=t.comments.values();i&&(a=[...t.comments.values()].filter(l=>l.viewpoint===i.guid)),o.data=[...a].map(l=>({data:{guid:l.guid,Comment:l.comment,author:(()=>{const h=e;if(!h)return l.author;const c=h[l.author];return(c==null?void 0:c.name)??l.author})()}}))})}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${n}</bim-label>
    </bim-table>
  `},hz=(s,t)=>{const{topic:e,styles:i}=s,n={delete:!0,...s.actions};t.headersHidden=!0,t.hiddenColumns=["guid","author"],t.dataTransform={Comment:(r,o)=>{const{guid:a}=o;if(typeof a!="string")return r;const l=e.comments.get(a);if(!l)return r;const h=()=>{e.comments.delete(a)};let c;if(n.delete){const u=`btn-${Os.newRandomId()}`;c=ct`
          <div>
            <style>
              #${u} {
                background-color: transparent;
                --bim-label--c: var(--bim-ui_bg-contrast-60)
              }
  
              #${u}:hover {
                --bim-label--c: #FF5252;
              }
            </style>
            <bim-button @click=${h} id=${u} icon="majesticons:delete-bin"></bim-button>
          </div>
        `}return ct`
        <div style="display: flex; flex-direction: column; gap: 0.25rem; flex: 1">
          <div style="display: flex; justify-content: space-between;">
            <div style="display: flex; gap: 0.375rem;">
              ${fl(l.author,i??ci.users)}
              <bim-label style="color: var(--bim-ui_bg-contrast-40)">@ ${l.date.toDateString()}</bim-label>
            </div>
            ${c}
          </div>
          <bim-label style="margin-left: 1.7rem; white-space: normal">${l.comment}</bim-label>
        </div>
      `}}},vx=(s,t=!0)=>{const e=Es.create(yx,s),[i,n]=e;if(hz(s,i),t){const{topic:r}=s,o=()=>n();r.comments.onItemSet.add(o),r.comments.onItemUpdated.add(o),r.comments.onItemDeleted.add(o),r.comments.onCleared.add(o)}return e},cz=Object.freeze(Object.defineProperty({__proto__:null,commentsList:vx,commentsListTemplate:yx},Symbol.toStringTag,{value:"Module"}));({...Zk,...tz,...iz,...rz,...lz,...cz});const wx=(s,t)=>{const{showInput:e,topic:i,styles:n}=s,r={add:!0,delete:!0,...s.actions},o=`input-${Os.newRandomId()}`,a=`btn-${Os.newRandomId()}`,l=`btn-${Os.newRandomId()}`,h=()=>document.getElementById(a),c=()=>document.getElementById(o),u=()=>{const y=c();return y?y.value.trim().length>0:!1},p=()=>{t({showInput:!0})},d=()=>{const y=c(),E=u();y&&E&&(i.createComment(y.value),t({showInput:!1}))},_=()=>{t({showInput:!1})},m=()=>{const y=h();if(y){if(!c()){y.disabled=!0;return}y.disabled=!u()}},g=ct`
    ${r.add?ct`<bim-button @click=${p} label="Add Comment" icon="majesticons:comment-line"></bim-button>`:null}
  `,f=ct`
    <bim-text-input id=${o} @input=${m} @keypress=${y=>{y.code==="Enter"&&y.ctrlKey&&d()}} type="area"></bim-text-input>

    <div style="justify-content: right; display: flex; gap: 0.375rem">
      <style>
        #${a} {
          background-color: #329936;
        }  

        #${l} {
          background-color: transparent;
        }

        #${l}:hover {
          --bim-label--c: #FF5252;
        }
      </style>

      <bim-button style="flex: 0" id=${l} @click=${_} label="Cancel"></bim-button>
      <bim-button style="flex: 0" id=${a} @click=${d} label="Accept" icon="material-symbols:check" disabled></bim-button>
    </div>
  `,[b]=vx({topic:i,actions:r,styles:n??ci.users});return ct`
    <div style="display: flex; flex-direction: column; gap: 0.5rem">
      ${b}
      ${e?f:g}
    </div>
  `},uz=s=>Es.create(wx,s),dz=Object.freeze(Object.defineProperty({__proto__:null,topicComments:uz,topicCommentsSectionTemplate:wx},Symbol.toStringTag,{value:"Module"})),Ex=(s,t)=>{const{components:e,editing:i,topic:n,styles:r}=s,o={update:!0,...s.actions},a=(r==null?void 0:r.priorities)??ci.priorities,l=(r==null?void 0:r.statuses)??ci.statuses,h=(r==null?void 0:r.types)??ci.types;let c;n!=null&&n.priority&&(c=a[n.priority]);let u;n!=null&&n.type&&(u=h[n.type]);let p;n!=null&&n.type&&(p=l[n.status]);let d,_;return i?d=_x({components:e,topic:n,styles:r,onSubmit:()=>{t({editing:!1})},onCancel:()=>{t({editing:!1})}}):_=ct`
      <div>
        <bim-label>Title</bim-label>
        <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${n.title}</bim-label>
      </div>

      ${n.description?ct`
            <div>
              <bim-label>Description</bim-label>
              <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100); white-space: normal">${n.description}</bim-label>
            </div>
          `:null}

      <div style="display: flex; gap: 0.375rem">
        <bim-label>Status</bim-label>
        <bim-label .icon=${p==null?void 0:p.icon} style=${Zo({...ml,...p==null?void 0:p.style})}
        >${n.status}
        </bim-label>
      </div>

      <div style="display: flex; gap: 0.375rem">
        <bim-label>Type</bim-label>
        <bim-label .icon=${u==null?void 0:u.icon} style=${Zo({...ml,...u==null?void 0:u.style})}
        >${n.type}
        </bim-label>
      </div>

      ${n.priority?ct`
            <div style="display: flex; gap: 0.375rem">
              <bim-label>Priority</bim-label>
              <bim-label .icon=${c==null?void 0:c.icon} style=${Zo({...ml,...c==null?void 0:c.style})}
              >${n.priority}
              </bim-label>
            </div>`:null}

      <div style="display: flex; gap: 0.375rem">
        <bim-label>Author</bim-label>
        ${fl(n.creationAuthor,(r==null?void 0:r.users)??ci.users)}
      </div>

      ${n.assignedTo?ct`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Assignee</bim-label>
            ${fl(n.assignedTo,(r==null?void 0:r.users)??ci.users)}
          </div>`:null}

      ${n.dueDate?ct`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Due Date</bim-label>
            <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${n.dueDate.toDateString()}</bim-label>
          </div>`:null}

      ${n.modifiedAuthor?ct`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Modified By</bim-label>
            ${fl(n.modifiedAuthor,(r==null?void 0:r.users)??ci.users)}
          </div>`:null}

      ${n.modifiedDate?ct`
            <div style="display: flex; gap: 0.375rem">
              <bim-label>Modified Date</bim-label>
              <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${n.modifiedDate.toDateString()}</bim-label>
            </div>`:null}

      ${n.labels.size!==0?ct`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Labels</bim-label>
            <bim-label style="white-space: normal; --bim-label--c: var(--bim-ui_bg-contrast-100)">${[...n.labels].join(", ")}</bim-label>
          </div>`:null}

      ${o.update?ct`
              <bim-button @click=${()=>t({editing:!0})} label="Update Information" icon="tabler:refresh"></bim-button> 
            `:null}
    `,ct`
    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
      ${i?d:_}
    </div>
  `},pz=s=>Es.create(Ex,s),fz=Object.freeze(Object.defineProperty({__proto__:null,topicInformation:pz,topicInformationSectionTemplate:Ex},Symbol.toStringTag,{value:"Module"})),Cx=(s,t)=>{const{components:e,topic:i,linking:n}=s,r=e.get(Ne),o={link:!0,...s.actions},[a,l]=bx({components:e,topics:[...i.relatedTopics].map(p=>r.list.get(p)).map(p=>p)});a.headersHidden=!0,a.hiddenColumns=["Guid","Status","Description","Author","Assignee","Date","DueDate","Type","Priority"];const h=()=>ct`
      <bim-text-input placeholder="Search..." debounce="100" @input=${p=>{const d=p.target;d instanceof si&&(a.queryString=d.value)}}></bim-text-input> 
    `;let c,u;if(n){a.selectableRows=!0,l({topics:void 0});const p=a.data.filter(f=>{const{Guid:b}=f.data;return typeof b!="string"?!1:i.relatedTopics.has(b)}).map(f=>f.data);a.selection=new Set(p);const d=()=>{const f=[...a.selection].map(({Guid:b})=>typeof b!="string"?null:r.list.has(b)?b:null).map(b=>b);i.relatedTopics.clear(),i.relatedTopics.add(...f),t({linking:!1})},_=()=>{t({linking:!1})},m=`btn-${Os.newRandomId()}`,g=`btn-${Os.newRandomId()}`;c=ct`
      <div style="display: flex; gap: 0.25rem">
        <style>
          #${m}:hover {
            background-color: #329936;
          }  

          #${g} {
            background-color: transparent;
          }

          #${g}:hover {
            --bim-label--c: #FF5252;
          }
        </style>
        ${h()}
        <div style="display: flex; justify-content: right; gap: 0.25rem">
          <bim-button id=${g} @click=${_} style="flex: 0" label="Cancel" icon="material-symbols:close"></bim-button>
          <bim-button id=${m} @click=${d} style="flex: 0" label="Accept" icon="material-symbols:check"></bim-button>
        </div>
      </div> 
    `}else{a.selectableRows=!1;const p=()=>{t({linking:!0})};u=ct`
      <div style="display: flex; justify-content: right; gap: 0.25rem">
        ${h()}
        ${o.link?ct`<bim-button style="flex: 0" @click=${p} icon="tabler:link"></bim-button>`:null}
      </div> 
    `}return ct`
    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
      ${u}
      ${c}
      ${a}
    </div> 
  `},mz=s=>Es.create(Cx,s),gz=Object.freeze(Object.defineProperty({__proto__:null,topicRelations:mz,topicRelationsSectionTemplate:Cx},Symbol.toStringTag,{value:"Module"})),Ix=(s,t)=>{const{components:e,topic:i,world:n,linking:r}=s,o={add:!0,link:!0,selectComponents:!0,colorizeComponent:!0,resetColors:!0,updateCamera:!0,delete:!0,unlink:!0,...s.actions},a=e.get(gi),[l,h]=mx({components:e,topic:i,actions:o}),c=()=>ct`
      <bim-text-input placeholder="Search..." debounce="100" @input=${d=>{const _=d.target;_ instanceof si&&(l.queryString=_.value)}}></bim-text-input> 
    `;let u,p;if(r){l.selectableRows=!0,h({topic:void 0,actions:{delete:!1,updateCamera:!1,colorizeComponent:!1,resetColors:!1}});const d=l.data.filter(b=>{const{Guid:y}=b.data;return typeof y!="string"?!1:i.viewpoints.has(y)}).map(b=>b.data);l.selection=new Set(d);const _=()=>{const b=[...l.selection].map(({Guid:y})=>typeof y!="string"?null:a.list.has(y)?y:null).map(y=>y);i.viewpoints.clear(),i.viewpoints.add(...b),t({linking:!1})},m=()=>{t({linking:!1})},g=`btn-${Os.newRandomId()}`,f=`btn-${Os.newRandomId()}`;u=ct`
      <div style="display: flex; gap: 0.25rem">
        <style>
          #${g}:hover {
            background-color: #329936;
          }  

          #${f} {
            background-color: transparent;
          }

          #${f}:hover {
            --bim-label--c: #FF5252;
          }
        </style>
        ${c()}
        <div style="display: flex; justify-content: right; gap: 0.25rem">
          <bim-button id=${f} @click=${m} style="flex: 0" label="Cancel" icon="material-symbols:close"></bim-button>
          <bim-button id=${g} @click=${_} style="flex: 0" label="Accept" icon="material-symbols:check"></bim-button>
        </div>
      </div> 
    `}else{l.selectableRows=!1,h({topic:i,actions:o});const d=()=>{if(!(i&&o.add&&!r))return;const f=a.create();n&&(f.world=n),i.viewpoints.add(f.guid)},_=()=>{t({linking:!0})},m=ct`<bim-button style="flex: 0" @click=${d} .disabled=${!n} icon="mi:add"></bim-button>`,g=ct`<bim-button style="flex: 0" @click=${_} icon="tabler:link"></bim-button>`;p=ct`
      <div style="display: flex; justify-content: right; gap: 0.25rem">
        ${c()}
        <div style="display: flex; justify-content: right; gap: 0.25rem">
          ${o.add?m:null}
          ${o.link?g:null}
        </div>
      </div> 
    `}return ct`
    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
      ${p}
      ${u}
      ${l}
    </div> 
  `},_z=s=>Es.create(Ix,s),bz=Object.freeze(Object.defineProperty({__proto__:null,topicViewpoints:_z,topicViewpointsSectionTemplate:Ix},Symbol.toStringTag,{value:"Module"}));({...dz,...fz,...gz,...bz});const yz=s=>ct`
    <bim-panel-section fixed label="New Topic" name="topic">
      ${_x(s)}
    </bim-panel-section>
  `,vz=s=>Es.create(yz,s),wz=Object.freeze(Object.defineProperty({__proto__:null,topic:vz},Symbol.toStringTag,{value:"Module"}));({...wz});const xx=document.getElementById("container"),pn=new qA,Ez=pn.get(ZA),Re=Ez.create();Re.scene=new XA(pn);Re.renderer=new QA(pn,xx);Re.camera=new KA(pn);pn.init();tS.init();Bk.init();Re.scene.setup();Re.camera.controls.setLookAt(5,5,5,0,0,0);xx.appendChild(Re.renderer.three2D.domElement);const Cz=pn.get(JA);Cz.create(Re);Re.camera.three.far=1e4;Re.camera.three.updateProjectionMatrix();Re.scene.three.background=null;const _f=pn.get(Sw);_f.init("/node_modules/@thatopen/fragments/dist/Worker/worker.mjs");const Tx="/resources/frags/small_road.frag",Iz=await fetch(Tx),xz=await Iz.arrayBuffer(),Tz=new Uint8Array(xz),bf=await _f.core.load(Tz,{modelId:Tx,camera:Re.camera.three});Re.scene.three.add(bf.object);await _f.core.update(!0);Re.camera.controls.addEventListener("control",()=>_f.core.update());bf.getClippingPlanesEvent=()=>Array.from(Re.renderer.three.clippingPlanes)||[];const gr=await bf.getAlignments();Re.scene.three.add(gr);const Ls=pn.get(Xm),rs=Ls.create("absolute");rs.world=Re;for(const s of gr.children)s.userData.initialStation=1925;rs.alignments.push(gr);rs.updateAlignments();console.log(gr);const Op=new ws(void 0,20);rs.onMarkerChange.add(({point:s})=>{Op.center.copy(s),Re.camera.controls.fitToSphere(Op,!0)});const rn=pn.get(Qm);rn.world=Re;const Az=document.getElementById("horizontal-menu"),ca=document.createElement("bim-world-2d");ca.components=pn;if(!ca.world)throw new Error("World not found!");Az.appendChild(ca);const _r=Ls.create("horizontal");_r.world=ca.world;const ua=await bf.getHorizontalAlignments();for(const s of ua.children)s.rotation.x=Math.PI/2,s.rotation.y=Math.PI/2;_r.alignments.push(ua);_r.updateAlignments();const Ax=ca.world.scene.three;Ax.background=null;Ax.add(ua);for(const s of ua.children)s.userData.initialStation=1925;rs.onMarkerChange.add(s=>{console.log(s);const t=qr.curvePointToAlignmentPercentage(s.alignment,s.point,s.curve);if(t===null)return;const e=qr.alignmentPercentageToPoint(ua.children[0],t);e!==null&&(_r.setMarkerAtPoint(e,"select"),_r.setCursorValue(rs.getCursorValue(),"select"))});const Sz=pn.get(x_),Oz=Sz.get(ca.world);Oz.three.params.Line.threshold=10;await ca.world.camera.controls.setLookAt(0,0,1e4,0,0,0,!1);const Gl=new YA;Gl.showPanel(2);document.body.append(Gl.dom);Gl.dom.style.left="0px";Gl.dom.style.zIndex="unset";Re.renderer.onBeforeUpdate.add(()=>Gl.begin());Re.renderer.onAfterUpdate.add(()=>Gl.end());let hr=0,Ym=null,lw=0,Kd=!0,hl=!1;function E_(){const s=gr.children[hr],t=ua.children[hr];Kd?(rs.highlight(s),_r.highlight(t)):(rs.clearHighlight(),_r.clearHighlight())}E_();let hw=-1;function $r(){hw!==hr&&rs.clearStations(),hw=hr;const s=gr.children[hr];hl?(rs.createStations(s),rs.updateStations()):rs.clearStations()}function cw(s){const t=qr.alignmentPercentageToPoint(gr.children[hr],s);t&&(Op.center.copy(t.point),Re.camera.controls.fitToSphere(Op,!0),rs.setMarkerAtPoint(t,"select"),rn.set(t.point,t.normal),Ym&&clearTimeout(Ym),rn.sectionVisible=!1,Ym=setTimeout(()=>{rn.plane.enabled&&rn.update()},1e3),hl&&rn.plane.enabled&&$r());const e=qr.alignmentPercentageToPoint(ua.children[hr],s);e&&(_r.setMarkerAtPoint(e,"select"),_r.setCursorValue(rs.getCursorValue(),"select"))}const Sx=1e3;let Pp=0;Re.camera.controls.addEventListener("update",()=>{const s=Date.now();s-Pp>Sx&&($r(),Pp=s)});Re.camera.controls.addEventListener("update",()=>{const s=Date.now();s-Pp>Sx&&($r(),Pp=s)});const bc=Ow.create(()=>Zm`
  <bim-panel active label="Civil 3D Navigator Tutorial" class="options-menu">

      <bim-panel-section label="Alignments">

         <bim-dropdown required label="Selected alignment"
             @change="${({target:s})=>{hr=s.value[0],Kd&&E_(),hl&&$r()}}">

          ${gr.children.map(()=>Zm`
              <bim-option ?checked=${lw===0} label="${lw++}"></bim-option>
            `)}
        </bim-dropdown>
        
        <bim-number-input
          slider step="1" label="Highlight width" value="${rs.highlightMaterial.linewidth}" min="1" max="10"
          @change="${({target:s})=>{Ls.highlightMaterial.linewidth=s.value}}">
        </bim-number-input>

        <bim-color-input 
          label="Highlight Color" color="#${Ls.highlightMaterial.color.getHexString()}" 
          @input="${({target:s})=>{Ls.highlightMaterial.color=new xt(s.color)}}">
        </bim-color-input>

        
        <bim-color-input 
          label="Station Label Color" color="#${Ls.stationLabelColor.getHexString()}" 
          @input="${({target:s})=>{Ls.stationLabelColor=new xt(s.color)}}">
        </bim-color-input>

        
        <bim-color-input 
          label="Station Label Background Color" color="#${Ls.stationLabelBackgroundColor.getHexString()}" 
          @input="${({target:s})=>{Ls.stationLabelBackgroundColor=new xt(s.color)}}">
        </bim-color-input>

        <bim-color-input 
          label="Station Pointer Color" color="#${Ls.stationPointerColor.getHexString()}" 
          @input="${({target:s})=>{Ls.stationPointerColor=new xt(s.color)}}">
        </bim-color-input>

        <bim-color-input 
          label="Station Pointer Background Color" color="#${Ls.stationPointerBackgroundColor.getHexString()}" 
          @input="${({target:s})=>{Ls.stationPointerBackgroundColor=new xt(s.color)}}">
        </bim-color-input>

        <bim-number-input
          slider step="0.05" label="Screen distance limit" value="${Ls.screenDistanceLimit}" min="0" max="1"
          @change="${({target:s})=>{Ls.screenDistanceLimit=s.value,rs.updateStations()}}">
        </bim-number-input>

        <bim-checkbox
          label="Highlight selected" checked="${Kd}"
          @change="${({target:s})=>{Kd=s.checked,E_()}}">
        </bim-checkbox>

        <bim-checkbox
          label="Show kps"
          @change="${({target:s})=>{hl=s.checked,$r()}}">
        </bim-checkbox>

        
        <bim-checkbox
          label="Clip"
          @change="${({target:s})=>{rn.plane.enabled=s.checked,rn.sectionVisible=s.checked,s.checked&&(rn.update(),rn.plane.update()),hl&&$r()}}">
        </bim-checkbox>

        
      <bim-checkbox
        label="Flip"
        @change="${({target:s})=>{rn.flip=s.checked,hl&&$r()}}">
      </bim-checkbox>

      <bim-number-input
      slider step="10" label="Increments" value="${rs.increments}" min="10" max="100"
      @change="${({target:s})=>{rs.increments=s.value,$r()}}">
    </bim-number-input>

    <bim-number-input
      slider step="0.01" label="Alignment navigation" value="0.5" min="0" max="1"
      @change="${({target:s})=>{cw(s.value)}}">
    </bim-number-input>

    <bim-number-input
      slider step="10" label="Move to KP" value="2000" min="1925" max="3000"
      @change="${({target:s})=>{const t=gr.children[hr],e=qr.alignmentLength(t),n=(s.value-t.userData.initialStation)/e,r=Math.min(Math.max(n,0),1);cw(r)}}">
    </bim-number-input>

    </bim-panel-section>

    </bim-panel>
    `);bc.style.zIndex="9999";document.body.append(bc);const Pz=Ow.create(()=>Zm`
      <bim-button class="phone-menu-toggler" icon="solar:settings-bold"
        @click="${()=>{bc.classList.contains("options-menu-visible")?bc.classList.remove("options-menu-visible"):bc.classList.add("options-menu-visible")}}">
      </bim-button>
    `);document.body.append(Pz);
