var _=Object.defineProperty;var v=(o,i,e)=>i in o?_(o,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[i]=e;var t=(o,i,e)=>(v(o,typeof i!="symbol"?i+"":i,e),e);import{C as a,V as u,E as w,D as C,A as y,W as d,h as p}from"./web-ifc-api-r1ed24cU.js";import{j as f,E as h,D as E,g as x,h as z}from"./index-D8-6eVKV.js";class P extends f{constructor(){super(...arguments);t(this,"onAfterUpdate",new h);t(this,"onBeforeUpdate",new h);t(this,"onDisposed",new h);t(this,"onResize",new h);t(this,"onClippingPlanesUpdated",new h);t(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(e,s,n){s.isLocal=n;const r=this.clippingPlanes.indexOf(s);e&&r===-1?this.clippingPlanes.push(s):!e&&r>-1&&this.clippingPlanes.splice(r,1),this.three.clippingPlanes=this.clippingPlanes.filter(l=>!l.isLocal)}}class S extends f{constructor(e){super(e);t(this,"onDisposed",new h);t(this,"directionalLights",new Map);t(this,"ambientLights",new Map)}dispose(){const e=this.components.get(E);for(const s of this.three.children){const n=s;n.geometry&&e.destroy(n)}this.deleteAllLights(),this.three.children=[],this.onDisposed.trigger(),this.onDisposed.reset()}deleteAllLights(){for(const[,e]of this.directionalLights)e.removeFromParent(),e.target.removeFromParent(),e.dispose();this.directionalLights.clear();for(const[,e]of this.ambientLights)e.removeFromParent(),e.dispose();this.ambientLights.clear()}}class D{constructor(i,e){t(this,"_list");t(this,"_scene");this._list=i,this._scene=e}get color(){return this._list.directionalLight.color.value}set color(i){this._list.directionalLight.color.value=i;for(const[,e]of this._scene.directionalLights)e.color.copy(i)}get intensity(){return this._list.directionalLight.intensity.value}set intensity(i){this._list.directionalLight.intensity.value=i;for(const[,e]of this._scene.directionalLights)e.intensity=i}get position(){return this._list.directionalLight.position.value.clone()}set position(i){this._list.directionalLight.position.value=i;for(const[,e]of this._scene.directionalLights)e.position.copy(i)}}class k{constructor(i,e){t(this,"_list");t(this,"_scene");this._list=i,this._scene=e}get color(){return this._list.ambientLight.color.value}set color(i){this._list.ambientLight.color.value=i;for(const[,e]of this._scene.ambientLights)e.color.copy(i)}get intensity(){return this._list.ambientLight.intensity.value}set intensity(i){this._list.ambientLight.intensity.value=i;for(const[,e]of this._scene.ambientLights)e.intensity=i}}class R extends x{constructor(){super(...arguments);t(this,"_config",{backgroundColor:{value:new a,type:"Color"},ambientLight:{color:{type:"Color",value:new a},intensity:{type:"Number",interpolable:!0,min:0,max:10,value:2}},directionalLight:{color:{type:"Color",value:new a},intensity:{type:"Number",interpolable:!0,min:0,max:10,value:2},position:{type:"Vector3",value:new u}}});t(this,"ambientLight",new k(this._config,this._component));t(this,"directionalLight",new D(this._config,this._component))}get backgroundColor(){return this._config.backgroundColor.value}set backgroundColor(e){this._config.backgroundColor.value=e,this._component.three.background=e}}class O extends S{constructor(e){super(e);t(this,"onSetup",new h);t(this,"isSetup",!1);t(this,"three");t(this,"config",new R(this,this.components,"Scene"));t(this,"_defaultConfig",{backgroundColor:new a(2107698),directionalLight:{color:new a("white"),intensity:1.5,position:new u(5,10,3)},ambientLight:{color:new a("white"),intensity:1}});this.three=new w,this.three.background=new a(2107698)}setup(e){const s={...this._defaultConfig,...e};this.config.backgroundColor=s.backgroundColor;const n=s.ambientLight;this.config.ambientLight.color=n.color,this.config.ambientLight.intensity=n.intensity;const r=s.directionalLight;this.config.directionalLight.color=r.color,this.config.directionalLight.intensity=r.intensity,this.config.directionalLight.position=r.position,this.deleteAllLights();const{color:l,intensity:m}=this.config.directionalLight,c=new C(l,m);c.position.copy(r.position);const{color:L,intensity:b}=this.config.directionalLight,g=new y(L,b);this.three.add(c,g),this.directionalLights.set(c.uuid,c),this.ambientLights.set(g.uuid,g),this.isSetup=!0,this.onSetup.trigger()}dispose(){super.dispose(),this.components.get(z).list.delete(this.config.uuid)}}class W extends P{constructor(e,s,n){super(e);t(this,"enabled",!0);t(this,"container");t(this,"three");t(this,"_canvas");t(this,"_parameters");t(this,"_resizeObserver",null);t(this,"onContainerUpdated",new h);t(this,"_resizing",!1);t(this,"resize",e=>{if(this._resizing)return;this._resizing=!0,this.onContainerUpdated.trigger();const s=e?e.x:this.container.clientWidth,n=e?e.y:this.container.clientHeight;this.three.setSize(s,n),this.onResize.trigger(new p(s,n)),this._resizing=!1});t(this,"resizeEvent",()=>{this.resize()});t(this,"onContextLost",e=>{e.preventDefault(),this.enabled=!1});t(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new d({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0});this.container=s,this._parameters=n,this.three=new d({antialias:!0,alpha:!0,...n}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const r=this.three.getContext(),{canvas:l}=r;l.addEventListener("webglcontextlost",this.onContextLost,!1),l.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const e=this.currentWorld.scene.three,s=this.currentWorld.camera.three;this.three.render(e,s),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.forceContextLoss(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new p(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(e){const s=this.three.domElement.parentElement;if(!s)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),e&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(s),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}}export{O as S,W as a};
