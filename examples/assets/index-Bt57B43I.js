import{s as at,t as Me,T as es,u as on,E as Xc,c as de,V as O,h as Ue,v as jt,S as Zs,a as J,C as ft,w as js,D as zE,A as YE,W as _i,x as di,P as Mp,y as _p,z as an,Q as ct,H as Lp,J as ln,K as Kc,e as ze,b as It,N as Qs,r as Ot,U as Kt,X as ir,Y as ll,Z as hl,_ as cl,$ as nr,a0 as dl,a1 as ul,a2 as rr,a3 as pl,a4 as fl,a5 as ml,a6 as El,a7 as gl,a8 as Il,a9 as Cl,B as Be,aa as Zc,ab as gs,ac as er,ad as Tl,ae as yl,af as Qt,ag as ho,d as Ct,ah as St,ai as Oi,i as tr,aj as Np,ak as jc,al as as,am as hn,an as Mt,ao as Ke,O as Xs,ap as Qc,I as or,aq as ar,ar as lr,as as cn,j as Dp,at as Up,L as qs,au as Bp,av as zp,aw as Yp,ax as kp,ay as Vp,az as tl,aA as Gp,aB as Ws,aC as Li,aD as Pi,aE as je,aF as Hp,aG as Gs,aH as Wp,aI as Xp,aJ as Kp,aK as Zp,aL as jp,aM as Qp,aN as qc,aO as Ha,aP as kE,aQ as VE,aR as GE,aS as HE,f as WE,G as sl,aT as Wa,aU as Jc,aV as XE,aW as Sr,aX as li,aY as KE,aZ as ZE,a_ as jE,a$ as QE,b0 as qE,b1 as jd,b2 as JE,b3 as $E,b4 as e0,b5 as qp,b6 as t0,b7 as s0,b8 as sc,b9 as Qn,ba as i0}from"./web-ifc-api-BXZoUgQp.js";var n0=Object.defineProperty,r0=(h,e,t)=>e in h?n0(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t,b=(h,e,t)=>(r0(h,typeof e!="symbol"?e+"":e,t),t);const Jp=0,o0=1,a0=2,Qd=2,uh=1.25,qd=1,Xa=6*4+4+4,wl=65535,l0=Math.pow(2,-24),ph=Symbol("SKIP_GENERATION");function h0(h){return h.index?h.index.count:h.attributes.position.count}function hr(h){return h0(h)/3}function c0(h,e=ArrayBuffer){return h>65535?new Uint32Array(new e(4*h)):new Uint16Array(new e(2*h))}function d0(h,e){if(!h.index){const t=h.attributes.position.count,s=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=c0(t,s);h.setIndex(new Ct(i,1));for(let n=0;n<t;n++)i[n]=n}}function $p(h){const e=hr(h),t=h.drawRange,s=t.start/3,i=(t.start+t.count)/3,n=Math.max(0,s),r=Math.min(e,i)-n;return[{offset:Math.floor(n),count:Math.floor(r)}]}function ef(h){if(!h.groups||!h.groups.length)return $p(h);const e=[],t=new Set,s=h.drawRange,i=s.start/3,n=(s.start+s.count)/3;for(const o of h.groups){const a=o.start/3,l=(o.start+o.count)/3;t.add(Math.max(i,a)),t.add(Math.min(n,l))}const r=Array.from(t.values()).sort((o,a)=>o-a);for(let o=0;o<r.length-1;o++){const a=r[o],l=r[o+1];e.push({offset:Math.floor(a),count:Math.floor(l-a)})}return e}function u0(h){if(h.groups.length===0)return!1;const e=hr(h),t=ef(h).sort((n,r)=>n.offset-r.offset),s=t[t.length-1];s.count=Math.min(e-s.offset,s.count);let i=0;return t.forEach(({count:n})=>i+=n),e!==i}function lt(h,e,t){return t.min.x=e[h],t.min.y=e[h+1],t.min.z=e[h+2],t.max.x=e[h+3],t.max.y=e[h+4],t.max.z=e[h+5],t}function p0(h){h[0]=h[1]=h[2]=1/0,h[3]=h[4]=h[5]=-1/0}function Jd(h){let e=-1,t=-1/0;for(let s=0;s<3;s++){const i=h[s+3]-h[s];i>t&&(t=i,e=s)}return e}function $d(h,e){e.set(h)}function eu(h,e,t){let s,i;for(let n=0;n<3;n++){const r=n+3;s=h[n],i=e[n],t[n]=s<i?s:i,s=h[r],i=e[r],t[r]=s>i?s:i}}function Wo(h,e,t){for(let s=0;s<3;s++){const i=e[h+2*s],n=e[h+2*s+1],r=i-n,o=i+n;r<t[s]&&(t[s]=r),o>t[s+3]&&(t[s+3]=o)}}function Or(h){const e=h[3]-h[0],t=h[4]-h[1],s=h[5]-h[2];return 2*(e*t+t*s+s*e)}function fh(h,e,t,s,i=null){let n=1/0,r=1/0,o=1/0,a=-1/0,l=-1/0,c=-1/0,p=1/0,u=1/0,m=1/0,E=-1/0,g=-1/0,T=-1/0;const y=i!==null;for(let v=e*6,A=(e+t)*6;v<A;v+=6){const C=h[v+0],F=h[v+1],M=C-F,_=C+F;M<n&&(n=M),_>a&&(a=_),y&&C<p&&(p=C),y&&C>E&&(E=C);const L=h[v+2],D=h[v+3],B=L-D,z=L+D;B<r&&(r=B),z>l&&(l=z),y&&L<u&&(u=L),y&&L>g&&(g=L);const V=h[v+4],Q=h[v+5],ne=V-Q,ue=V+Q;ne<o&&(o=ne),ue>c&&(c=ue),y&&V<m&&(m=V),y&&V>T&&(T=V)}s[0]=n,s[1]=r,s[2]=o,s[3]=a,s[4]=l,s[5]=c,y&&(i[0]=p,i[1]=u,i[2]=m,i[3]=E,i[4]=g,i[5]=T)}function f0(h,e,t,s){let i=1/0,n=1/0,r=1/0,o=-1/0,a=-1/0,l=-1/0;for(let c=e*6,p=(e+t)*6;c<p;c+=6){const u=h[c+0];u<i&&(i=u),u>o&&(o=u);const m=h[c+2];m<n&&(n=m),m>a&&(a=m);const E=h[c+4];E<r&&(r=E),E>l&&(l=E)}s[0]=i,s[1]=n,s[2]=r,s[3]=o,s[4]=a,s[5]=l}function m0(h,e){p0(e);const t=h.attributes.position,s=h.index?h.index.array:null,i=hr(h),n=new Float32Array(i*6),r=t.normalized,o=t.array,a=t.offset||0;let l=3;t.isInterleavedBufferAttribute&&(l=t.data.stride);const c=["getX","getY","getZ"];for(let p=0;p<i;p++){const u=p*3,m=p*6;let E=u+0,g=u+1,T=u+2;s&&(E=s[E],g=s[g],T=s[T]),r||(E=E*l+a,g=g*l+a,T=T*l+a);for(let y=0;y<3;y++){let v,A,C;r?(v=t[c[y]](E),A=t[c[y]](g),C=t[c[y]](T)):(v=o[E+y],A=o[g+y],C=o[T+y]);let F=v;A<F&&(F=A),C<F&&(F=C);let M=v;A>M&&(M=A),C>M&&(M=C);const _=(M-F)/2,L=y*2;n[m+L+0]=F+_,n[m+L+1]=_+(Math.abs(F)+_)*l0,F<e[y]&&(e[y]=F),M>e[y+3]&&(e[y+3]=M)}}return n}const ii=32,E0=(h,e)=>h.candidate-e.candidate,Ti=new Array(ii).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Xo=new Float32Array(6);function g0(h,e,t,s,i,n){let r=-1,o=0;if(n===Jp)r=Jd(e),r!==-1&&(o=(e[r]+e[r+3])/2);else if(n===o0)r=Jd(h),r!==-1&&(o=I0(t,s,i,r));else if(n===a0){const a=Or(h);let l=uh*i;const c=s*6,p=(s+i)*6;for(let u=0;u<3;u++){const m=e[u],E=(e[u+3]-m)/ii;if(i<ii/4){const g=[...Ti];g.length=i;let T=0;for(let v=c;v<p;v+=6,T++){const A=g[T];A.candidate=t[v+2*u],A.count=0;const{bounds:C,leftCacheBounds:F,rightCacheBounds:M}=A;for(let _=0;_<3;_++)M[_]=1/0,M[_+3]=-1/0,F[_]=1/0,F[_+3]=-1/0,C[_]=1/0,C[_+3]=-1/0;Wo(v,t,C)}g.sort(E0);let y=i;for(let v=0;v<y;v++){const A=g[v];for(;v+1<y&&g[v+1].candidate===A.candidate;)g.splice(v+1,1),y--}for(let v=c;v<p;v+=6){const A=t[v+2*u];for(let C=0;C<y;C++){const F=g[C];A>=F.candidate?Wo(v,t,F.rightCacheBounds):(Wo(v,t,F.leftCacheBounds),F.count++)}}for(let v=0;v<y;v++){const A=g[v],C=A.count,F=i-A.count,M=A.leftCacheBounds,_=A.rightCacheBounds;let L=0;C!==0&&(L=Or(M)/a);let D=0;F!==0&&(D=Or(_)/a);const B=qd+uh*(L*C+D*F);B<l&&(r=u,l=B,o=A.candidate)}}else{for(let y=0;y<ii;y++){const v=Ti[y];v.count=0,v.candidate=m+E+y*E;const A=v.bounds;for(let C=0;C<3;C++)A[C]=1/0,A[C+3]=-1/0}for(let y=c;y<p;y+=6){let v=~~((t[y+2*u]-m)/E);v>=ii&&(v=ii-1);const A=Ti[v];A.count++,Wo(y,t,A.bounds)}const g=Ti[ii-1];$d(g.bounds,g.rightCacheBounds);for(let y=ii-2;y>=0;y--){const v=Ti[y],A=Ti[y+1];eu(v.bounds,A.rightCacheBounds,v.rightCacheBounds)}let T=0;for(let y=0;y<ii-1;y++){const v=Ti[y],A=v.count,C=v.bounds,F=Ti[y+1].rightCacheBounds;A!==0&&(T===0?$d(C,Xo):eu(C,Xo,Xo)),T+=A;let M=0,_=0;T!==0&&(M=Or(Xo)/a);const L=i-T;L!==0&&(_=Or(F)/a);const D=qd+uh*(M*T+_*L);D<l&&(r=u,l=D,o=v.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${n} used.`);return{axis:r,pos:o}}function I0(h,e,t,s){let i=0;for(let n=e,r=e+t;n<r;n++)i+=h[n*6+s*2];return i/t}class Ko{constructor(){}}function C0(h,e,t,s,i,n){let r=s,o=s+i-1;const a=n.pos,l=n.axis*2;for(;;){for(;r<=o&&t[r*6+l]<a;)r++;for(;r<=o&&t[o*6+l]>=a;)o--;if(r<o){for(let c=0;c<3;c++){let p=e[r*3+c];e[r*3+c]=e[o*3+c],e[o*3+c]=p}for(let c=0;c<6;c++){let p=t[r*6+c];t[r*6+c]=t[o*6+c],t[o*6+c]=p}r++,o--}else return r}}function T0(h,e,t,s,i,n){let r=s,o=s+i-1;const a=n.pos,l=n.axis*2;for(;;){for(;r<=o&&t[r*6+l]<a;)r++;for(;r<=o&&t[o*6+l]>=a;)o--;if(r<o){let c=h[r];h[r]=h[o],h[o]=c;for(let p=0;p<6;p++){let u=t[r*6+p];t[r*6+p]=t[o*6+p],t[o*6+p]=u}r++,o--}else return r}}function y0(h,e){const t=(h.index?h.index.count:h.attributes.position.count)/3,s=t>2**16,i=s?4:2,n=e?new SharedArrayBuffer(t*i):new ArrayBuffer(t*i),r=s?new Uint32Array(n):new Uint16Array(n);for(let o=0,a=r.length;o<a;o++)r[o]=o;return r}function w0(h,e){const t=h.geometry,s=t.index?t.index.array:null,i=e.maxDepth,n=e.verbose,r=e.maxLeafTris,o=e.strategy,a=e.onProgress,l=hr(t),c=h._indirectBuffer;let p=!1;const u=new Float32Array(6),m=new Float32Array(6),E=m0(t,u),g=e.indirect?T0:C0,T=[],y=e.indirect?$p(t):ef(t);if(y.length===1){const C=y[0],F=new Ko;F.boundingData=u,f0(E,C.offset,C.count,m),A(F,C.offset,C.count,m),T.push(F)}else for(let C of y){const F=new Ko;F.boundingData=new Float32Array(6),fh(E,C.offset,C.count,F.boundingData,m),A(F,C.offset,C.count,m),T.push(F)}return T;function v(C){a&&a(C/l)}function A(C,F,M,_=null,L=0){if(!p&&L>=i&&(p=!0,n&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),M<=r||L>=i)return v(F+M),C.offset=F,C.count=M,C;const D=g0(C.boundingData,_,E,F,M,o);if(D.axis===-1)return v(F+M),C.offset=F,C.count=M,C;const B=g(c,s,E,F,M,D);if(B===F||B===F+M)v(F+M),C.offset=F,C.count=M;else{C.splitAxis=D.axis;const z=new Ko,V=F,Q=B-F;C.left=z,z.boundingData=new Float32Array(6),fh(E,V,Q,z.boundingData,m),A(z,V,Q,m,L+1);const ne=new Ko,ue=B,oe=M-Q;C.right=ne,ne.boundingData=new Float32Array(6),fh(E,ue,oe,ne.boundingData,m),A(ne,ue,oe,m,L+1)}return C}}function v0(h,e){const t=h.geometry;e.indirect&&(h._indirectBuffer=y0(t,e.useSharedArrayBuffer),u0(t)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),h._indirectBuffer||d0(t,e);const s=w0(h,e);let i,n,r;const o=[],a=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let p=0;p<s.length;p++){const u=s[p];let m=l(u);const E=new a(Xa*m);i=new Float32Array(E),n=new Uint32Array(E),r=new Uint16Array(E),c(0,u),o.push(E)}h._roots=o;return;function l(p){return p.count?1:1+l(p.left)+l(p.right)}function c(p,u){const m=p/4,E=p/2,g=!!u.count,T=u.boundingData;for(let y=0;y<6;y++)i[m+y]=T[y];if(g){const y=u.offset,v=u.count;return n[m+6]=y,r[E+14]=v,r[E+15]=wl,p+Xa}else{const y=u.left,v=u.right,A=u.splitAxis;let C;if(C=c(p+Xa,y),C/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[m+6]=C/4,C=c(C,v),n[m+7]=A,C}}}let hi=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let s=1/0,i=-1/0;for(let n=0,r=e.length;n<r;n++){const o=e[n][t];s=o<s?o:s,i=o>i?o:i}this.min=s,this.max=i}setFromPoints(e,t){let s=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const o=t[n],a=e.dot(o);s=a<s?a:s,i=a>i?a:i}this.min=s,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}};hi.prototype.setFromBox=function(){const h=new O;return function(e,t){const s=t.min,i=t.max;let n=1/0,r=-1/0;for(let o=0;o<=1;o++)for(let a=0;a<=1;a++)for(let l=0;l<=1;l++){h.x=s.x*o+i.x*(1-o),h.y=s.y*a+i.y*(1-a),h.z=s.z*l+i.z*(1-l);const c=e.dot(h);n=Math.min(c,n),r=Math.max(c,r)}this.min=n,this.max=r}}();const R0=function(){const h=new O,e=new O,t=new O;return function(s,i,n){const r=s.start,o=h,a=i.start,l=e;t.subVectors(r,a),h.subVectors(s.end,s.start),e.subVectors(i.end,i.start);const c=t.dot(l),p=l.dot(o),u=l.dot(l),m=t.dot(o),E=o.dot(o)*u-p*p;let g,T;E!==0?g=(c*p-m*u)/E:g=0,T=(c+g*p)/u,n.x=g,n.y=T}}(),$c=function(){const h=new Ue,e=new O,t=new O;return function(s,i,n,r){R0(s,i,h);let o=h.x,a=h.y;if(o>=0&&o<=1&&a>=0&&a<=1){s.at(o,n),i.at(a,r);return}else if(o>=0&&o<=1){a<0?i.at(0,r):i.at(1,r),s.closestPointToPoint(r,!0,n);return}else if(a>=0&&a<=1){o<0?s.at(0,n):s.at(1,n),i.closestPointToPoint(n,!0,r);return}else{let l;o<0?l=s.start:l=s.end;let c;a<0?c=i.start:c=i.end;const p=e,u=t;if(s.closestPointToPoint(c,!0,e),i.closestPointToPoint(l,!0,t),p.distanceToSquared(c)<=u.distanceToSquared(l)){n.copy(p),r.copy(c);return}else{n.copy(l),r.copy(u);return}}}}(),F0=function(){const h=new O,e=new O,t=new jt,s=new at;return function(i,n){const{radius:r,center:o}=i,{a,b:l,c}=n;if(s.start=a,s.end=l,s.closestPointToPoint(o,!0,h).distanceTo(o)<=r||(s.start=a,s.end=c,s.closestPointToPoint(o,!0,h).distanceTo(o)<=r)||(s.start=l,s.end=c,s.closestPointToPoint(o,!0,h).distanceTo(o)<=r))return!0;const p=n.getPlane(t);if(Math.abs(p.distanceToPoint(o))<=r){const u=p.projectPoint(o,e);if(n.containsPoint(u))return!0}return!1}}(),A0=1e-15;function mh(h){return Math.abs(h)<A0}let Ss=class extends es{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new O),this.satBounds=new Array(4).fill().map(()=>new hi),this.points=[this.a,this.b,this.c],this.sphere=new Zs,this.plane=new jt,this.needsUpdate=!0}intersectsSphere(e){return F0(e,this)}update(){const e=this.a,t=this.b,s=this.c,i=this.points,n=this.satAxes,r=this.satBounds,o=n[0],a=r[0];this.getNormal(o),a.setFromPoints(o,i);const l=n[1],c=r[1];l.subVectors(e,t),c.setFromPoints(l,i);const p=n[2],u=r[2];p.subVectors(t,s),u.setFromPoints(p,i);const m=n[3],E=r[3];m.subVectors(s,e),E.setFromPoints(m,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}};Ss.prototype.closestPointToSegment=function(){const h=new O,e=new O,t=new at;return function(s,i=null,n=null){const{start:r,end:o}=s,a=this.points;let l,c=1/0;for(let p=0;p<3;p++){const u=(p+1)%3;t.start.copy(a[p]),t.end.copy(a[u]),$c(t,s,h,e),l=h.distanceToSquared(e),l<c&&(c=l,i&&i.copy(h),n&&n.copy(e))}return this.closestPointToPoint(r,h),l=r.distanceToSquared(h),l<c&&(c=l,i&&i.copy(h),n&&n.copy(r)),this.closestPointToPoint(o,h),l=o.distanceToSquared(h),l<c&&(c=l,i&&i.copy(h),n&&n.copy(o)),Math.sqrt(c)}}();Ss.prototype.intersectsTriangle=function(){const h=new Ss,e=new Array(3),t=new Array(3),s=new hi,i=new hi,n=new O,r=new O,o=new O,a=new O,l=new O,c=new at,p=new at,u=new at,m=new O;function E(g,T,y){const v=g.points;let A=0,C=-1;for(let F=0;F<3;F++){const{start:M,end:_}=c;M.copy(v[F]),_.copy(v[(F+1)%3]),c.delta(r);const L=mh(T.distanceToPoint(M));if(mh(T.normal.dot(r))&&L){y.copy(c),A=2;break}const D=T.intersectLine(c,m);if(!D&&L&&m.copy(M),(D||L)&&!mh(m.distanceTo(_))){if(A<=1)(A===1?y.start:y.end).copy(m),L&&(C=A);else if(A>=2){(C===1?y.start:y.end).copy(m),A=2;break}if(A++,A===2&&C===-1)break}}return A}return function(g,T=null,y=!1){this.needsUpdate&&this.update(),g.isExtendedTriangle?g.needsUpdate&&g.update():(h.copy(g),h.update(),g=h);const v=this.plane,A=g.plane;if(Math.abs(v.normal.dot(A.normal))>1-1e-10){const C=this.satBounds,F=this.satAxes;t[0]=g.a,t[1]=g.b,t[2]=g.c;for(let L=0;L<4;L++){const D=C[L],B=F[L];if(s.setFromPoints(B,t),D.isSeparated(s))return!1}const M=g.satBounds,_=g.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let L=0;L<4;L++){const D=M[L],B=_[L];if(s.setFromPoints(B,e),D.isSeparated(s))return!1}for(let L=0;L<4;L++){const D=F[L];for(let B=0;B<4;B++){const z=_[B];if(n.crossVectors(D,z),s.setFromPoints(n,e),i.setFromPoints(n,t),s.isSeparated(i))return!1}}return T&&(y||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),T.start.set(0,0,0),T.end.set(0,0,0)),!0}else{const C=E(this,A,p);if(C===1&&g.containsPoint(p.end))return T&&(T.start.copy(p.end),T.end.copy(p.end)),!0;if(C!==2)return!1;const F=E(g,v,u);if(F===1&&this.containsPoint(u.end))return T&&(T.start.copy(u.end),T.end.copy(u.end)),!0;if(F!==2)return!1;if(p.delta(o),u.delta(a),o.dot(a)<0){let V=u.start;u.start=u.end,u.end=V}const M=p.start.dot(o),_=p.end.dot(o),L=u.start.dot(o),D=u.end.dot(o),B=_<L,z=M<D;return M!==D&&L!==_&&B===z?!1:(T&&(l.subVectors(p.start,u.start),l.dot(o)>0?T.start.copy(p.start):T.start.copy(u.start),l.subVectors(p.end,u.end),l.dot(o)<0?T.end.copy(p.end):T.end.copy(u.end)),!0)}}}();Ss.prototype.distanceToPoint=function(){const h=new O;return function(e){return this.closestPointToPoint(e,h),e.distanceTo(h)}}();Ss.prototype.distanceToTriangle=function(){const h=new O,e=new O,t=["a","b","c"],s=new at,i=new at;return function(n,r=null,o=null){const a=r||o?s:null;if(this.intersectsTriangle(n,a))return(r||o)&&(r&&a.getCenter(r),o&&a.getCenter(o)),0;let l=1/0;for(let c=0;c<3;c++){let p;const u=t[c],m=n[u];this.closestPointToPoint(m,h),p=m.distanceToSquared(h),p<l&&(l=p,r&&r.copy(h),o&&o.copy(m));const E=this[u];n.closestPointToPoint(E,h),p=E.distanceToSquared(h),p<l&&(l=p,r&&r.copy(E),o&&o.copy(h))}for(let c=0;c<3;c++){const p=t[c],u=t[(c+1)%3];s.set(this[p],this[u]);for(let m=0;m<3;m++){const E=t[m],g=t[(m+1)%3];i.set(n[E],n[g]),$c(s,i,h,e);const T=h.distanceToSquared(e);T<l&&(l=T,r&&r.copy(h),o&&o.copy(e))}}return Math.sqrt(l)}}();class Gt{constructor(e,t,s){this.isOrientedBox=!0,this.min=new O,this.max=new O,this.matrix=new de,this.invMatrix=new de,this.points=new Array(8).fill().map(()=>new O),this.satAxes=new Array(3).fill().map(()=>new O),this.satBounds=new Array(3).fill().map(()=>new hi),this.alignedSatBounds=new Array(3).fill().map(()=>new hi),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),s&&this.matrix.copy(s)}set(e,t,s){this.min.copy(e),this.max.copy(t),this.matrix.copy(s),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Gt.prototype.update=function(){return function(){const h=this.matrix,e=this.min,t=this.max,s=this.points;for(let a=0;a<=1;a++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){const p=1*a|2*l|4*c,u=s[p];u.x=a?t.x:e.x,u.y=l?t.y:e.y,u.z=c?t.z:e.z,u.applyMatrix4(h)}const i=this.satBounds,n=this.satAxes,r=s[0];for(let a=0;a<3;a++){const l=n[a],c=i[a],p=1<<a,u=s[p];l.subVectors(r,u),c.setFromPoints(l,s)}const o=this.alignedSatBounds;o[0].setFromPointsField(s,"x"),o[1].setFromPointsField(s,"y"),o[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Gt.prototype.intersectsBox=function(){const h=new hi;return function(e){this.needsUpdate&&this.update();const t=e.min,s=e.max,i=this.satBounds,n=this.satAxes,r=this.alignedSatBounds;if(h.min=t.x,h.max=s.x,r[0].isSeparated(h)||(h.min=t.y,h.max=s.y,r[1].isSeparated(h))||(h.min=t.z,h.max=s.z,r[2].isSeparated(h)))return!1;for(let o=0;o<3;o++){const a=n[o],l=i[o];if(h.setFromBox(a,e),l.isSeparated(h))return!1}return!0}}();Gt.prototype.intersectsTriangle=function(){const h=new Ss,e=new Array(3),t=new hi,s=new hi,i=new O;return function(n){this.needsUpdate&&this.update(),n.isExtendedTriangle?n.needsUpdate&&n.update():(h.copy(n),h.update(),n=h);const r=this.satBounds,o=this.satAxes;e[0]=n.a,e[1]=n.b,e[2]=n.c;for(let p=0;p<3;p++){const u=r[p],m=o[p];if(t.setFromPoints(m,e),u.isSeparated(t))return!1}const a=n.satBounds,l=n.satAxes,c=this.points;for(let p=0;p<3;p++){const u=a[p],m=l[p];if(t.setFromPoints(m,c),u.isSeparated(t))return!1}for(let p=0;p<3;p++){const u=o[p];for(let m=0;m<4;m++){const E=l[m];if(i.crossVectors(u,E),t.setFromPoints(i,e),s.setFromPoints(i,c),t.isSeparated(s))return!1}}return!0}}();Gt.prototype.closestPointToPoint=function(){return function(h,e){return this.needsUpdate&&this.update(),e.copy(h).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();Gt.prototype.distanceToPoint=function(){const h=new O;return function(e){return this.closestPointToPoint(e,h),e.distanceTo(h)}}();Gt.prototype.distanceToBox=function(){const h=["x","y","z"],e=new Array(12).fill().map(()=>new at),t=new Array(12).fill().map(()=>new at),s=new O,i=new O;return function(n,r=0,o=null,a=null){if(this.needsUpdate&&this.update(),this.intersectsBox(n))return(o||a)&&(n.getCenter(i),this.closestPointToPoint(i,s),n.closestPointToPoint(s,i),o&&o.copy(s),a&&a.copy(i)),0;const l=r*r,c=n.min,p=n.max,u=this.points;let m=1/0;for(let g=0;g<8;g++){const T=u[g];i.copy(T).clamp(c,p);const y=T.distanceToSquared(i);if(y<m&&(m=y,o&&o.copy(T),a&&a.copy(i),y<l))return Math.sqrt(y)}let E=0;for(let g=0;g<3;g++)for(let T=0;T<=1;T++)for(let y=0;y<=1;y++){const v=(g+1)%3,A=(g+2)%3,C=T<<v|y<<A,F=1<<g|T<<v|y<<A,M=u[C],_=u[F];e[E].set(M,_);const L=h[g],D=h[v],B=h[A],z=t[E],V=z.start,Q=z.end;V[L]=c[L],V[D]=T?c[D]:p[D],V[B]=y?c[B]:p[D],Q[L]=p[L],Q[D]=T?c[D]:p[D],Q[B]=y?c[B]:p[D],E++}for(let g=0;g<=1;g++)for(let T=0;T<=1;T++)for(let y=0;y<=1;y++){i.x=g?p.x:c.x,i.y=T?p.y:c.y,i.z=y?p.z:c.z,this.closestPointToPoint(i,s);const v=i.distanceToSquared(s);if(v<m&&(m=v,o&&o.copy(s),a&&a.copy(i),v<l))return Math.sqrt(v)}for(let g=0;g<12;g++){const T=e[g];for(let y=0;y<12;y++){const v=t[y];$c(T,v,s,i);const A=s.distanceToSquared(i);if(A<m&&(m=A,o&&o.copy(s),a&&a.copy(i),A<l))return Math.sqrt(A)}}return Math.sqrt(m)}}();class ed{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}let S0=class extends ed{constructor(){super(()=>new Ss)}};const hs=new S0;function Jt(h,e){return e[h+15]===65535}function ts(h,e){return e[h+6]}function cs(h,e){return e[h+14]}function ds(h){return h+8}function us(h,e){return e[h+6]}function tf(h,e){return e[h+7]}class O0{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=s=>{t&&e.push(t),t=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const st=new O0;let bi,qn;const In=[],Zo=new ed(()=>new Me);function P0(h,e,t,s,i,n){bi=Zo.getPrimitive(),qn=Zo.getPrimitive(),In.push(bi,qn),st.setBuffer(h._roots[e]);const r=ic(0,h.geometry,t,s,i,n);st.clearBuffer(),Zo.releasePrimitive(bi),Zo.releasePrimitive(qn),In.pop(),In.pop();const o=In.length;return o>0&&(qn=In[o-1],bi=In[o-2]),r}function ic(h,e,t,s,i=null,n=0,r=0){const{float32Array:o,uint16Array:a,uint32Array:l}=st;let c=h*2;if(Jt(c,a)){const p=ts(h,l),u=cs(c,a);return lt(h,o,bi),s(p,u,!1,r,n+h,bi)}else{let p=function(z){const{uint16Array:V,uint32Array:Q}=st;let ne=z*2;for(;!Jt(ne,V);)z=ds(z),ne=z*2;return ts(z,Q)},u=function(z){const{uint16Array:V,uint32Array:Q}=st;let ne=z*2;for(;!Jt(ne,V);)z=us(z,Q),ne=z*2;return ts(z,Q)+cs(ne,V)};const m=ds(h),E=us(h,l);let g=m,T=E,y,v,A,C;if(i&&(A=bi,C=qn,lt(g,o,A),lt(T,o,C),y=i(A),v=i(C),v<y)){g=E,T=m;const z=y;y=v,v=z,A=C}A||(A=bi,lt(g,o,A));const F=Jt(g*2,a),M=t(A,F,y,r+1,n+g);let _;if(M===Qd){const z=p(g),V=u(g)-z;_=s(z,V,!0,r+1,n+g,A)}else _=M&&ic(g,e,t,s,i,n,r+1);if(_)return!0;C=qn,lt(T,o,C);const L=Jt(T*2,a),D=t(C,L,v,r+1,n+T);let B;if(D===Qd){const z=p(T),V=u(T)-z;B=s(z,V,!0,r+1,n+T,C)}else B=D&&ic(T,e,t,s,i,n,r+1);return!!B}}const Pr=new O,Eh=new O;function b0(h,e,t={},s=0,i=1/0){const n=s*s,r=i*i;let o=1/0,a=null;if(h.shapecast({boundsTraverseOrder:c=>(Pr.copy(e).clamp(c.min,c.max),Pr.distanceToSquared(e)),intersectsBounds:(c,p,u)=>u<o&&u<r,intersectsTriangle:(c,p)=>{c.closestPointToPoint(e,Pr);const u=e.distanceToSquared(Pr);return u<o&&(Eh.copy(Pr),o=u,a=p),u<n}}),o===1/0)return null;const l=Math.sqrt(o);return t.point?t.point.copy(Eh):t.point=Eh.clone(),t.distance=l,t.faceIndex=a,t}const Cn=new O,Tn=new O,yn=new O,jo=new Ue,Qo=new Ue,qo=new Ue,tu=new O,su=new O,iu=new O,Jo=new O;function x0(h,e,t,s,i,n){let r;return n===Qp?r=h.intersectTriangle(s,t,e,!0,i):r=h.intersectTriangle(e,t,s,n!==Qs,i),r===null?null:{distance:h.origin.distanceTo(i),point:i.clone()}}function M0(h,e,t,s,i,n,r,o,a){Cn.fromBufferAttribute(e,n),Tn.fromBufferAttribute(e,r),yn.fromBufferAttribute(e,o);const l=x0(h,Cn,Tn,yn,Jo,a);if(l){s&&(jo.fromBufferAttribute(s,n),Qo.fromBufferAttribute(s,r),qo.fromBufferAttribute(s,o),l.uv=es.getInterpolation(Jo,Cn,Tn,yn,jo,Qo,qo,new Ue)),i&&(jo.fromBufferAttribute(i,n),Qo.fromBufferAttribute(i,r),qo.fromBufferAttribute(i,o),l.uv1=es.getInterpolation(Jo,Cn,Tn,yn,jo,Qo,qo,new Ue)),t&&(tu.fromBufferAttribute(t,n),su.fromBufferAttribute(t,r),iu.fromBufferAttribute(t,o),l.normal=es.getInterpolation(Jo,Cn,Tn,yn,tu,su,iu,new O),l.normal.dot(h.direction)>0&&l.normal.multiplyScalar(-1));const c={a:n,b:r,c:o,normal:new O,materialIndex:0};es.getNormal(Cn,Tn,yn,c.normal),l.face=c,l.faceIndex=n}return l}function vl(h,e,t,s,i){const n=s*3;let r=n+0,o=n+1,a=n+2;const l=h.index;h.index&&(r=l.getX(r),o=l.getX(o),a=l.getX(a));const{position:c,normal:p,uv:u,uv1:m}=h.attributes,E=M0(t,c,p,u,m,r,o,a,e);return E?(E.faceIndex=s,i&&i.push(E),E):null}function mt(h,e,t,s){const i=h.a,n=h.b,r=h.c;let o=e,a=e+1,l=e+2;t&&(o=t.getX(o),a=t.getX(a),l=t.getX(l)),i.x=s.getX(o),i.y=s.getY(o),i.z=s.getZ(o),n.x=s.getX(a),n.y=s.getY(a),n.z=s.getZ(a),r.x=s.getX(l),r.y=s.getY(l),r.z=s.getZ(l)}function _0(h,e,t,s,i,n){const{geometry:r,_indirectBuffer:o}=h;for(let a=s,l=s+i;a<l;a++)vl(r,e,t,a,n)}function L0(h,e,t,s,i){const{geometry:n,_indirectBuffer:r}=h;let o=1/0,a=null;for(let l=s,c=s+i;l<c;l++){let p;p=vl(n,e,t,l),p&&p.distance<o&&(a=p,o=p.distance)}return a}function N0(h,e,t,s,i,n,r){const{geometry:o}=t,{index:a}=o,l=o.attributes.position;for(let c=h,p=e+h;c<p;c++){let u;if(u=c,mt(r,u*3,a,l),r.needsUpdate=!0,s(r,u,i,n))return!0}return!1}function D0(h,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=h.geometry,s=t.index?t.index.array:null,i=t.attributes.position;let n,r,o,a,l=0;const c=h._roots;for(let u=0,m=c.length;u<m;u++)n=c[u],r=new Uint32Array(n),o=new Uint16Array(n),a=new Float32Array(n),p(0,l),l+=n.byteLength;function p(u,m,E=!1){const g=u*2;if(o[g+15]===wl){const T=r[u+6],y=o[g+14];let v=1/0,A=1/0,C=1/0,F=-1/0,M=-1/0,_=-1/0;for(let L=3*T,D=3*(T+y);L<D;L++){let B=s[L];const z=i.getX(B),V=i.getY(B),Q=i.getZ(B);z<v&&(v=z),z>F&&(F=z),V<A&&(A=V),V>M&&(M=V),Q<C&&(C=Q),Q>_&&(_=Q)}return a[u+0]!==v||a[u+1]!==A||a[u+2]!==C||a[u+3]!==F||a[u+4]!==M||a[u+5]!==_?(a[u+0]=v,a[u+1]=A,a[u+2]=C,a[u+3]=F,a[u+4]=M,a[u+5]=_,!0):!1}else{const T=u+8,y=r[u+6],v=T+m,A=y+m;let C=E,F=!1,M=!1;e?C||(F=e.has(v),M=e.has(A),C=!F&&!M):(F=!0,M=!0);const _=C||F,L=C||M;let D=!1;_&&(D=p(T,m,C));let B=!1;L&&(B=p(y,m,C));const z=D||B;if(z)for(let V=0;V<3;V++){const Q=T+V,ne=y+V,ue=a[Q],oe=a[Q+3],Ie=a[ne],ce=a[ne+3];a[u+V]=ue<Ie?ue:Ie,a[u+V+3]=oe>ce?oe:ce}return z}}}const nu=new Me;function Ni(h,e,t,s){return lt(h,e,nu),t.intersectBox(nu,s)}function U0(h,e,t,s,i,n){const{geometry:r,_indirectBuffer:o}=h;for(let a=s,l=s+i;a<l;a++){let c=o?o[a]:a;vl(r,e,t,c,n)}}function B0(h,e,t,s,i){const{geometry:n,_indirectBuffer:r}=h;let o=1/0,a=null;for(let l=s,c=s+i;l<c;l++){let p;p=vl(n,e,t,r?r[l]:l),p&&p.distance<o&&(a=p,o=p.distance)}return a}function z0(h,e,t,s,i,n,r){const{geometry:o}=t,{index:a}=o,l=o.attributes.position;for(let c=h,p=e+h;c<p;c++){let u;if(u=t.resolveTriangleIndex(c),mt(r,u*3,a,l),r.needsUpdate=!0,s(r,u,i,n))return!0}return!1}const ru=new O;function Y0(h,e,t,s,i){st.setBuffer(h._roots[e]),nc(0,h,t,s,i),st.clearBuffer()}function nc(h,e,t,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=st,a=h*2;if(Jt(a,r)){const l=ts(h,o),c=cs(a,r);_0(e,t,s,l,c,i)}else{const l=ds(h);Ni(l,n,s,ru)&&nc(l,e,t,s,i);const c=us(h,o);Ni(c,n,s,ru)&&nc(c,e,t,s,i)}}const ou=new O,k0=["x","y","z"];function V0(h,e,t,s){st.setBuffer(h._roots[e]);const i=rc(0,h,t,s);return st.clearBuffer(),i}function rc(h,e,t,s){const{float32Array:i,uint16Array:n,uint32Array:r}=st;let o=h*2;if(Jt(o,n)){const a=ts(h,r),l=cs(o,n);return L0(e,t,s,a,l)}else{const a=tf(h,r),l=k0[a],c=s.direction[l]>=0;let p,u;c?(p=ds(h),u=us(h,r)):(p=us(h,r),u=ds(h));const m=Ni(p,i,s,ou)?rc(p,e,t,s):null;if(m){const g=m.point[l];if(c?g<=i[u+a]:g>=i[u+a+3])return m}const E=Ni(u,i,s,ou)?rc(u,e,t,s):null;return m&&E?m.distance<=E.distance?m:E:m||E||null}}const $o=new Me,wn=new Ss,vn=new Ss,br=new de,au=new Gt,ea=new Gt;function G0(h,e,t,s){st.setBuffer(h._roots[e]);const i=oc(0,h,t,s);return st.clearBuffer(),i}function oc(h,e,t,s,i=null){const{float32Array:n,uint16Array:r,uint32Array:o}=st;let a=h*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),au.set(t.boundingBox.min,t.boundingBox.max,s),i=au),Jt(a,r)){const l=e.geometry,c=l.index,p=l.attributes.position,u=t.index,m=t.attributes.position,E=ts(h,o),g=cs(a,r);if(br.copy(s).invert(),t.boundsTree)return lt(h,n,ea),ea.matrix.copy(br),ea.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:T=>ea.intersectsBox(T),intersectsTriangle:T=>{T.a.applyMatrix4(s),T.b.applyMatrix4(s),T.c.applyMatrix4(s),T.needsUpdate=!0;for(let y=E*3,v=(g+E)*3;y<v;y+=3)if(mt(vn,y,c,p),vn.needsUpdate=!0,T.intersectsTriangle(vn))return!0;return!1}});for(let T=E*3,y=(g+E)*3;T<y;T+=3){mt(wn,T,c,p),wn.a.applyMatrix4(br),wn.b.applyMatrix4(br),wn.c.applyMatrix4(br),wn.needsUpdate=!0;for(let v=0,A=u.count;v<A;v+=3)if(mt(vn,v,u,m),vn.needsUpdate=!0,wn.intersectsTriangle(vn))return!0}}else{const l=h+8,c=o[h+6];return lt(l,n,$o),!!(i.intersectsBox($o)&&oc(l,e,t,s,i)||(lt(c,n,$o),i.intersectsBox($o)&&oc(c,e,t,s,i)))}}const ta=new de,gh=new Gt,xr=new Gt,H0=new O,W0=new O,X0=new O,K0=new O;function Z0(h,e,t,s={},i={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),gh.set(e.boundingBox.min,e.boundingBox.max,t),gh.needsUpdate=!0;const o=h.geometry,a=o.attributes.position,l=o.index,c=e.attributes.position,p=e.index,u=hs.getPrimitive(),m=hs.getPrimitive();let E=H0,g=W0,T=null,y=null;i&&(T=X0,y=K0);let v=1/0,A=null,C=null;return ta.copy(t).invert(),xr.matrix.copy(ta),h.shapecast({boundsTraverseOrder:F=>gh.distanceToBox(F),intersectsBounds:(F,M,_)=>_<v&&_<r?(M&&(xr.min.copy(F.min),xr.max.copy(F.max),xr.needsUpdate=!0),!0):!1,intersectsRange:(F,M)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:_=>xr.distanceToBox(_),intersectsBounds:(_,L,D)=>D<v&&D<r,intersectsRange:(_,L)=>{for(let D=_,B=_+L;D<B;D++){mt(m,3*D,p,c),m.a.applyMatrix4(t),m.b.applyMatrix4(t),m.c.applyMatrix4(t),m.needsUpdate=!0;for(let z=F,V=F+M;z<V;z++){mt(u,3*z,l,a),u.needsUpdate=!0;const Q=u.distanceToTriangle(m,E,T);if(Q<v&&(g.copy(E),y&&y.copy(T),v=Q,A=z,C=D),Q<n)return!0}}}});{const _=hr(e);for(let L=0,D=_;L<D;L++){mt(m,3*L,p,c),m.a.applyMatrix4(t),m.b.applyMatrix4(t),m.c.applyMatrix4(t),m.needsUpdate=!0;for(let B=F,z=F+M;B<z;B++){mt(u,3*B,l,a),u.needsUpdate=!0;const V=u.distanceToTriangle(m,E,T);if(V<v&&(g.copy(E),y&&y.copy(T),v=V,A=B,C=L),V<n)return!0}}}}}),hs.releasePrimitive(u),hs.releasePrimitive(m),v===1/0?null:(s.point?s.point.copy(g):s.point=g.clone(),s.distance=v,s.faceIndex=A,i&&(i.point?i.point.copy(y):i.point=y.clone(),i.point.applyMatrix4(ta),g.applyMatrix4(ta),i.distance=g.sub(i.point).length(),i.faceIndex=C),s)}function j0(h,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=h.geometry,s=t.index?t.index.array:null,i=t.attributes.position;let n,r,o,a,l=0;const c=h._roots;for(let u=0,m=c.length;u<m;u++)n=c[u],r=new Uint32Array(n),o=new Uint16Array(n),a=new Float32Array(n),p(0,l),l+=n.byteLength;function p(u,m,E=!1){const g=u*2;if(o[g+15]===wl){const T=r[u+6],y=o[g+14];let v=1/0,A=1/0,C=1/0,F=-1/0,M=-1/0,_=-1/0;for(let L=T,D=T+y;L<D;L++){const B=3*h.resolveTriangleIndex(L);for(let z=0;z<3;z++){let V=B+z;V=s?s[V]:V;const Q=i.getX(V),ne=i.getY(V),ue=i.getZ(V);Q<v&&(v=Q),Q>F&&(F=Q),ne<A&&(A=ne),ne>M&&(M=ne),ue<C&&(C=ue),ue>_&&(_=ue)}}return a[u+0]!==v||a[u+1]!==A||a[u+2]!==C||a[u+3]!==F||a[u+4]!==M||a[u+5]!==_?(a[u+0]=v,a[u+1]=A,a[u+2]=C,a[u+3]=F,a[u+4]=M,a[u+5]=_,!0):!1}else{const T=u+8,y=r[u+6],v=T+m,A=y+m;let C=E,F=!1,M=!1;e?C||(F=e.has(v),M=e.has(A),C=!F&&!M):(F=!0,M=!0);const _=C||F,L=C||M;let D=!1;_&&(D=p(T,m,C));let B=!1;L&&(B=p(y,m,C));const z=D||B;if(z)for(let V=0;V<3;V++){const Q=T+V,ne=y+V,ue=a[Q],oe=a[Q+3],Ie=a[ne],ce=a[ne+3];a[u+V]=ue<Ie?ue:Ie,a[u+V+3]=oe>ce?oe:ce}return z}}}const lu=new O;function Q0(h,e,t,s,i){st.setBuffer(h._roots[e]),ac(0,h,t,s,i),st.clearBuffer()}function ac(h,e,t,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=st,a=h*2;if(Jt(a,r)){const l=ts(h,o),c=cs(a,r);U0(e,t,s,l,c,i)}else{const l=ds(h);Ni(l,n,s,lu)&&ac(l,e,t,s,i);const c=us(h,o);Ni(c,n,s,lu)&&ac(c,e,t,s,i)}}const hu=new O,q0=["x","y","z"];function J0(h,e,t,s){st.setBuffer(h._roots[e]);const i=lc(0,h,t,s);return st.clearBuffer(),i}function lc(h,e,t,s){const{float32Array:i,uint16Array:n,uint32Array:r}=st;let o=h*2;if(Jt(o,n)){const a=ts(h,r),l=cs(o,n);return B0(e,t,s,a,l)}else{const a=tf(h,r),l=q0[a],c=s.direction[l]>=0;let p,u;c?(p=ds(h),u=us(h,r)):(p=us(h,r),u=ds(h));const m=Ni(p,i,s,hu)?lc(p,e,t,s):null;if(m){const g=m.point[l];if(c?g<=i[u+a]:g>=i[u+a+3])return m}const E=Ni(u,i,s,hu)?lc(u,e,t,s):null;return m&&E?m.distance<=E.distance?m:E:m||E||null}}const sa=new Me,Rn=new Ss,Fn=new Ss,Mr=new de,cu=new Gt,ia=new Gt;function $0(h,e,t,s){st.setBuffer(h._roots[e]);const i=hc(0,h,t,s);return st.clearBuffer(),i}function hc(h,e,t,s,i=null){const{float32Array:n,uint16Array:r,uint32Array:o}=st;let a=h*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),cu.set(t.boundingBox.min,t.boundingBox.max,s),i=cu),Jt(a,r)){const l=e.geometry,c=l.index,p=l.attributes.position,u=t.index,m=t.attributes.position,E=ts(h,o),g=cs(a,r);if(Mr.copy(s).invert(),t.boundsTree)return lt(h,n,ia),ia.matrix.copy(Mr),ia.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:T=>ia.intersectsBox(T),intersectsTriangle:T=>{T.a.applyMatrix4(s),T.b.applyMatrix4(s),T.c.applyMatrix4(s),T.needsUpdate=!0;for(let y=E,v=g+E;y<v;y++)if(mt(Fn,3*e.resolveTriangleIndex(y),c,p),Fn.needsUpdate=!0,T.intersectsTriangle(Fn))return!0;return!1}});for(let T=E,y=g+E;T<y;T++){const v=e.resolveTriangleIndex(T);mt(Rn,3*v,c,p),Rn.a.applyMatrix4(Mr),Rn.b.applyMatrix4(Mr),Rn.c.applyMatrix4(Mr),Rn.needsUpdate=!0;for(let A=0,C=u.count;A<C;A+=3)if(mt(Fn,A,u,m),Fn.needsUpdate=!0,Rn.intersectsTriangle(Fn))return!0}}else{const l=h+8,c=o[h+6];return lt(l,n,sa),!!(i.intersectsBox(sa)&&hc(l,e,t,s,i)||(lt(c,n,sa),i.intersectsBox(sa)&&hc(c,e,t,s,i)))}}const na=new de,Ih=new Gt,_r=new Gt,eg=new O,tg=new O,sg=new O,ig=new O;function ng(h,e,t,s={},i={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),Ih.set(e.boundingBox.min,e.boundingBox.max,t),Ih.needsUpdate=!0;const o=h.geometry,a=o.attributes.position,l=o.index,c=e.attributes.position,p=e.index,u=hs.getPrimitive(),m=hs.getPrimitive();let E=eg,g=tg,T=null,y=null;i&&(T=sg,y=ig);let v=1/0,A=null,C=null;return na.copy(t).invert(),_r.matrix.copy(na),h.shapecast({boundsTraverseOrder:F=>Ih.distanceToBox(F),intersectsBounds:(F,M,_)=>_<v&&_<r?(M&&(_r.min.copy(F.min),_r.max.copy(F.max),_r.needsUpdate=!0),!0):!1,intersectsRange:(F,M)=>{if(e.boundsTree){const _=e.boundsTree;return _.shapecast({boundsTraverseOrder:L=>_r.distanceToBox(L),intersectsBounds:(L,D,B)=>B<v&&B<r,intersectsRange:(L,D)=>{for(let B=L,z=L+D;B<z;B++){const V=_.resolveTriangleIndex(B);mt(m,3*V,p,c),m.a.applyMatrix4(t),m.b.applyMatrix4(t),m.c.applyMatrix4(t),m.needsUpdate=!0;for(let Q=F,ne=F+M;Q<ne;Q++){const ue=h.resolveTriangleIndex(Q);mt(u,3*ue,l,a),u.needsUpdate=!0;const oe=u.distanceToTriangle(m,E,T);if(oe<v&&(g.copy(E),y&&y.copy(T),v=oe,A=Q,C=B),oe<n)return!0}}}})}else{const _=hr(e);for(let L=0,D=_;L<D;L++){mt(m,3*L,p,c),m.a.applyMatrix4(t),m.b.applyMatrix4(t),m.c.applyMatrix4(t),m.needsUpdate=!0;for(let B=F,z=F+M;B<z;B++){const V=h.resolveTriangleIndex(B);mt(u,3*V,l,a),u.needsUpdate=!0;const Q=u.distanceToTriangle(m,E,T);if(Q<v&&(g.copy(E),y&&y.copy(T),v=Q,A=B,C=L),Q<n)return!0}}}}}),hs.releasePrimitive(u),hs.releasePrimitive(m),v===1/0?null:(s.point?s.point.copy(g):s.point=g.clone(),s.distance=v,s.faceIndex=A,i&&(i.point?i.point.copy(y):i.point=y.clone(),i.point.applyMatrix4(na),g.applyMatrix4(na),i.distance=g.sub(i.point).length(),i.faceIndex=C),s)}function rg(){return typeof SharedArrayBuffer<"u"}const ro=new st.constructor,il=new st.constructor,Ai=new ed(()=>new Me),An=new Me,Sn=new Me,Ch=new Me,Th=new Me;let yh=!1;function og(h,e,t,s){if(yh)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");yh=!0;const i=h._roots,n=e._roots;let r,o=0,a=0;const l=new de().copy(t).invert();for(let c=0,p=i.length;c<p;c++){ro.setBuffer(i[c]),a=0;const u=Ai.getPrimitive();lt(0,ro.float32Array,u),u.applyMatrix4(l);for(let m=0,E=n.length;m<E&&(il.setBuffer(n[c]),r=Ts(0,0,t,l,s,o,a,0,0,u),il.clearBuffer(),a+=n[m].length,!r);m++);if(Ai.releasePrimitive(u),ro.clearBuffer(),o+=i[c].length,r)break}return yh=!1,r}function Ts(h,e,t,s,i,n=0,r=0,o=0,a=0,l=null,c=!1){let p,u;c?(p=il,u=ro):(p=ro,u=il);const m=p.float32Array,E=p.uint32Array,g=p.uint16Array,T=u.float32Array,y=u.uint32Array,v=u.uint16Array,A=h*2,C=e*2,F=Jt(A,g),M=Jt(C,v);let _=!1;if(M&&F)c?_=i(ts(e,y),cs(e*2,v),ts(h,E),cs(h*2,g),a,r+e,o,n+h):_=i(ts(h,E),cs(h*2,g),ts(e,y),cs(e*2,v),o,n+h,a,r+e);else if(M){const L=Ai.getPrimitive();lt(e,T,L),L.applyMatrix4(t);const D=ds(h),B=us(h,E);lt(D,m,An),lt(B,m,Sn);const z=L.intersectsBox(An),V=L.intersectsBox(Sn);_=z&&Ts(e,D,s,t,i,r,n,a,o+1,L,!c)||V&&Ts(e,B,s,t,i,r,n,a,o+1,L,!c),Ai.releasePrimitive(L)}else{const L=ds(e),D=us(e,y);lt(L,T,Ch),lt(D,T,Th);const B=l.intersectsBox(Ch),z=l.intersectsBox(Th);if(B&&z)_=Ts(h,L,t,s,i,n,r,o,a+1,l,c)||Ts(h,D,t,s,i,n,r,o,a+1,l,c);else if(B)if(F)_=Ts(h,L,t,s,i,n,r,o,a+1,l,c);else{const V=Ai.getPrimitive();V.copy(Ch).applyMatrix4(t);const Q=ds(h),ne=us(h,E);lt(Q,m,An),lt(ne,m,Sn);const ue=V.intersectsBox(An),oe=V.intersectsBox(Sn);_=ue&&Ts(L,Q,s,t,i,r,n,a,o+1,V,!c)||oe&&Ts(L,ne,s,t,i,r,n,a,o+1,V,!c),Ai.releasePrimitive(V)}else if(z)if(F)_=Ts(h,D,t,s,i,n,r,o,a+1,l,c);else{const V=Ai.getPrimitive();V.copy(Th).applyMatrix4(t);const Q=ds(h),ne=us(h,E);lt(Q,m,An),lt(ne,m,Sn);const ue=V.intersectsBox(An),oe=V.intersectsBox(Sn);_=ue&&Ts(D,Q,s,t,i,r,n,a,o+1,V,!c)||oe&&Ts(D,ne,s,t,i,r,n,a,o+1,V,!c),Ai.releasePrimitive(V)}}return _}const ra=new Gt,du=new Me;class td{static serialize(e,t={}){t={cloneBuffers:!0,...t};const s=e.geometry,i=e._roots,n=e._indirectBuffer,r=s.getIndex();let o;return t.cloneBuffers?o={roots:i.map(a=>a.slice()),index:r.array.slice(),indirectBuffer:n?n.slice():null}:o={roots:i,index:r.array,indirectBuffer:n},o}static deserialize(e,t,s={}){s={setIndex:!0,indirect:!!e.indirectBuffer,...s};const{index:i,roots:n,indirectBuffer:r}=e,o=new td(t,{...s,[ph]:!0});if(o._roots=n,o._indirectBuffer=r||null,s.setIndex){const a=t.getIndex();if(a===null){const l=new Ct(e.index,1,!1);t.setIndex(l)}else a.array!==i&&(a.array.set(i),a.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:Jp,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[ph]:!1},t),t.useSharedArrayBuffer&&!rg())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[ph]||(v0(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Me)));const{_indirectBuffer:s}=this;this.resolveTriangleIndex=t.indirect?i=>s[i]:i=>i}refit(e=null){return(this.indirect?j0:D0)(this,e)}traverse(e,t=0){const s=this._roots[t],i=new Uint32Array(s),n=new Uint16Array(s);r(0);function r(o,a=0){const l=o*2,c=n[l+15]===wl;if(c){const p=i[o+6],u=n[l+14];e(a,c,new Float32Array(s,o*4,6),p,u)}else{const p=o+Xa/4,u=i[o+6],m=i[o+7];e(a,c,new Float32Array(s,o*4,6),m)||(r(p,a+1),r(u,a+1))}}}raycast(e,t=tl){const s=this._roots,i=this.geometry,n=[],r=t.isMaterial,o=Array.isArray(t),a=i.groups,l=r?t.side:t,c=this.indirect?Q0:Y0;for(let p=0,u=s.length;p<u;p++){const m=o?t[a[p].materialIndex].side:l,E=n.length;if(c(this,p,m,e,n),o){const g=a[p].materialIndex;for(let T=E,y=n.length;T<y;T++)n[T].face.materialIndex=g}}return n}raycastFirst(e,t=tl){const s=this._roots,i=this.geometry,n=t.isMaterial,r=Array.isArray(t);let o=null;const a=i.groups,l=n?t.side:t,c=this.indirect?J0:V0;for(let p=0,u=s.length;p<u;p++){const m=r?t[a[p].materialIndex].side:l,E=c(this,p,m,e);E!=null&&(o==null||E.distance<o.distance)&&(o=E,r&&(E.face.materialIndex=a[p].materialIndex))}return o}intersectsGeometry(e,t){let s=!1;const i=this._roots,n=this.indirect?$0:G0;for(let r=0,o=i.length;r<o&&(s=n(this,r,e,t),!s);r++);return s}shapecast(e){const t=hs.getPrimitive(),s=this.indirect?z0:N0;let{boundsTraverseOrder:i,intersectsBounds:n,intersectsRange:r,intersectsTriangle:o}=e;if(r&&o){const p=r;r=(u,m,E,g,T)=>p(u,m,E,g,T)?!0:s(u,m,this,o,E,g,t)}else r||(o?r=(p,u,m,E)=>s(p,u,this,o,m,E,t):r=(p,u,m)=>m);let a=!1,l=0;const c=this._roots;for(let p=0,u=c.length;p<u;p++){const m=c[p];if(a=P0(this,p,n,r,i,l),a)break;l+=m.byteLength}return hs.releasePrimitive(t),a}bvhcast(e,t,s){let{intersectsRanges:i,intersectsTriangles:n}=s;const r=hs.getPrimitive(),o=this.geometry.index,a=this.geometry.attributes.position,l=this.indirect?E=>{const g=this.resolveTriangleIndex(E);mt(r,g*3,o,a)}:E=>{mt(r,E*3,o,a)},c=hs.getPrimitive(),p=e.geometry.index,u=e.geometry.attributes.position,m=e.indirect?E=>{const g=e.resolveTriangleIndex(E);mt(c,g*3,p,u)}:E=>{mt(c,E*3,p,u)};if(n){const E=(g,T,y,v,A,C,F,M)=>{for(let _=y,L=y+v;_<L;_++){m(_),c.a.applyMatrix4(t),c.b.applyMatrix4(t),c.c.applyMatrix4(t),c.needsUpdate=!0;for(let D=g,B=g+T;D<B;D++)if(l(D),r.needsUpdate=!0,n(r,c,D,_,A,C,F,M))return!0}return!1};if(i){const g=i;i=function(T,y,v,A,C,F,M,_){return g(T,y,v,A,C,F,M,_)?!0:E(T,y,v,A,C,F,M,_)}}else i=E}return og(this,e,t,i)}intersectsBox(e,t){return ra.set(e.min,e.max,t),ra.needsUpdate=!0,this.shapecast({intersectsBounds:s=>ra.intersectsBox(s),intersectsTriangle:s=>ra.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,s={},i={},n=0,r=1/0){return(this.indirect?ng:Z0)(this,e,t,s,i,n,r)}closestPointToPoint(e,t={},s=0,i=1/0){return b0(this,e,t,s,i)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{lt(0,new Float32Array(t),du),e.union(du)}),e}}function uu(h,e,t){return h===null||(h.point.applyMatrix4(e.matrixWorld),h.distance=h.point.distanceTo(t.ray.origin),h.object=e,h.distance<t.near||h.distance>t.far)?null:h}const wh=new Gp,pu=new de,ag=J.prototype.raycast;function lg(h,e){if(this.geometry.boundsTree){if(this.material===void 0)return;pu.copy(this.matrixWorld).invert(),wh.copy(h.ray).applyMatrix4(pu);const t=this.geometry.boundsTree;if(h.firstHitOnly===!0){const s=uu(t.raycastFirst(wh,this.material),this,h);s&&e.push(s)}else{const s=t.raycast(wh,this.material);for(let i=0,n=s.length;i<n;i++){const r=uu(s[i],this,h);r&&e.push(r)}}}else ag.call(this,h,e)}function hg(h){return this.boundsTree=new td(this,h),this.boundsTree}function cg(){this.boundsTree=null}let pe=class{constructor(){b(this,"trigger",e=>{const t=this.handlers.slice(0);for(const s of t)s(e)}),b(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}};class Ka{constructor(){b(this,"trigger",async e=>{const t=this.handlers.slice(0);for(const s of t)await s(e)}),b(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}}class sd{constructor(e){b(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),b(this,"isResizeable",()=>"resize"in this&&"getSize"in this),b(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),b(this,"isHideable",()=>"visible"in this),b(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),this.components=e}}let Tt=class extends sd{};class id extends sd{constructor(e){super(e),b(this,"worlds",new Map),b(this,"onWorldChanged",new pe),b(this,"currentWorld",null),this.onWorldChanged.add(({world:t,action:s})=>{s==="removed"&&this.worlds.delete(t.uuid)})}}let dg=class extends id{constructor(){super(...arguments),b(this,"hasCameraControls",()=>"controls"in this)}},ug=class extends id{constructor(){super(...arguments),b(this,"onAfterUpdate",new pe),b(this,"onBeforeUpdate",new pe),b(this,"onDisposed",new pe),b(this,"onResize",new pe),b(this,"onClippingPlanesUpdated",new pe),b(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(e,t,s){t.isLocal=s;const i=this.clippingPlanes.indexOf(t);e&&i===-1?this.clippingPlanes.push(t):!e&&i>-1&&this.clippingPlanes.splice(i,1),this.three.clippingPlanes=this.clippingPlanes.filter(n=>!n.isLocal)}};const sf=class cc extends Tt{constructor(e){super(e),b(this,"_disposedComponents",new Set),b(this,"enabled",!0),e.add(cc.uuid,this)}get(){return this._disposedComponents}destroy(e,t=!0,s=!0){e.removeFromParent();const i=e;i.dispose&&i.dispose(),this.disposeGeometryAndMaterials(e,t),s&&i.children&&i.children.length&&this.disposeChildren(i),e.children.length=0}disposeGeometry(e){e.boundsTree&&e.disposeBoundsTree&&e.disposeBoundsTree(),e.dispose()}disposeGeometryAndMaterials(e,t){const s=e;s.geometry&&this.disposeGeometry(s.geometry),t&&s.material&&cc.disposeMaterial(s),s.material=[],s.geometry=null}disposeChildren(e){for(const t of e.children)this.destroy(t)}static disposeMaterial(e){if(e.material)if(Array.isArray(e.material))for(const t of e.material)t.dispose();else e.material.dispose()}};b(sf,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let sr=sf,pg=class extends id{constructor(e){super(e),b(this,"onDisposed",new pe),b(this,"directionalLights",new Map),b(this,"ambientLights",new Map)}dispose(){const e=this.components.get(sr);for(const t of this.three.children){const s=t;s.geometry&&e.destroy(s)}for(const[,t]of this.directionalLights)t.removeFromParent(),t.target.removeFromParent(),t.dispose();for(const[,t]of this.ambientLights)t.removeFromParent(),t.dispose();this.three.children=[],this.onDisposed.trigger(),this.onDisposed.reset()}},fu=class extends Map{constructor(e){super(e),b(this,"onItemSet",new pe),b(this,"onItemUpdated",new pe),b(this,"onItemDeleted",new pe),b(this,"onCleared",new pe)}clear(){super.clear(),this.onCleared.trigger()}set(e,t){const s=this.has(e),i=super.set(e,t);return s?(this.onItemUpdated||(this.onItemUpdated=new pe),this.onItemUpdated.trigger({key:e,value:t})):(this.onItemSet||(this.onItemSet=new pe),this.onItemSet.trigger({key:e,value:t})),i}delete(e){const t=super.delete(e);return t&&this.onItemDeleted.trigger(),t}dispose(){this.clear(),this.onItemSet.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}};const Za=0,fg=1,mg=new O,mu=new at,vh=new jt,Eu=new O,oa=new es;let Eg=class{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new gu,this.unassigned=new gu,this.vertices=[]}setFromPoints(e){if(e.length>=4){this.makeEmpty();for(let t=0,s=e.length;t<s;t++)this.vertices.push(new gg(e[t]));this.compute()}return this}setFromObject(e){const t=[];return e.updateMatrixWorld(!0),e.traverse(function(s){const i=s.geometry;if(i!==void 0){const n=i.attributes.position;if(n!==void 0)for(let r=0,o=n.count;r<o;r++){const a=new O;a.fromBufferAttribute(n,r).applyMatrix4(s.matrixWorld),t.push(a)}}}),this.setFromPoints(t)}containsPoint(e){const t=this.faces;for(let s=0,i=t.length;s<i;s++)if(t[s].distanceToPoint(e)>this.tolerance)return!1;return!0}intersectRay(e,t){const s=this.faces;let i=-1/0,n=1/0;for(let r=0,o=s.length;r<o;r++){const a=s[r],l=a.distanceToPoint(e.origin),c=a.normal.dot(e.direction);if(l>0&&c>=0)return null;const p=c!==0?-l/c:0;if(!(p<=0)&&(c>0?n=Math.min(p,n):i=Math.max(p,i),i>n))return null}return i!==-1/0?e.at(i,t):e.at(n,t),t}intersectsRay(e){return this.intersectRay(e,mg)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,t){return e.face=t,t.outside===null?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}removeVertexFromFace(e,t){return e===t.outside&&(e.next!==null&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(e){if(e.outside!==null){const t=e.outside;let s=e.outside;for(;s.next!==null&&s.next.face===e;)s=s.next;return this.assigned.removeSubList(t,s),t.prev=s.next=null,e.outside=null,t}}deleteFaceVertices(e,t){const s=this.removeAllVerticesFromFace(e);if(s!==void 0)if(t===void 0)this.unassigned.appendChain(s);else{let i=s;do{const n=i.next;t.distanceToPoint(i.point)>this.tolerance?this.addVertexToFace(i,t):this.unassigned.append(i),i=n}while(i!==null)}return this}resolveUnassignedPoints(e){if(this.unassigned.isEmpty()===!1){let t=this.unassigned.first();do{const s=t.next;let i=this.tolerance,n=null;for(let r=0;r<e.length;r++){const o=e[r];if(o.mark===Za){const a=o.distanceToPoint(t.point);if(a>i&&(i=a,n=o),i>1e3*this.tolerance)break}}n!==null&&this.addVertexToFace(t,n),t=s}while(t!==null)}return this}computeExtremes(){const e=new O,t=new O,s=[],i=[];for(let n=0;n<3;n++)s[n]=i[n]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let n=0,r=this.vertices.length;n<r;n++){const o=this.vertices[n],a=o.point;for(let l=0;l<3;l++)a.getComponent(l)<e.getComponent(l)&&(e.setComponent(l,a.getComponent(l)),s[l]=o);for(let l=0;l<3;l++)a.getComponent(l)>t.getComponent(l)&&(t.setComponent(l,a.getComponent(l)),i[l]=o)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:s,max:i}}computeInitialHull(){const e=this.vertices,t=this.computeExtremes(),s=t.min,i=t.max;let n=0,r=0;for(let u=0;u<3;u++){const m=i[u].point.getComponent(u)-s[u].point.getComponent(u);m>n&&(n=m,r=u)}const o=s[r],a=i[r];let l,c;n=0,mu.set(o.point,a.point);for(let u=0,m=this.vertices.length;u<m;u++){const E=e[u];if(E!==o&&E!==a){mu.closestPointToPoint(E.point,!0,Eu);const g=Eu.distanceToSquared(E.point);g>n&&(n=g,l=E)}}n=-1,vh.setFromCoplanarPoints(o.point,a.point,l.point);for(let u=0,m=this.vertices.length;u<m;u++){const E=e[u];if(E!==o&&E!==a&&E!==l){const g=Math.abs(vh.distanceToPoint(E.point));g>n&&(n=g,c=E)}}const p=[];if(vh.distanceToPoint(c.point)<0){p.push(Rs.create(o,a,l),Rs.create(c,a,o),Rs.create(c,l,a),Rs.create(c,o,l));for(let u=0;u<3;u++){const m=(u+1)%3;p[u+1].getEdge(2).setTwin(p[0].getEdge(m)),p[u+1].getEdge(1).setTwin(p[m+1].getEdge(0))}}else{p.push(Rs.create(o,l,a),Rs.create(c,o,a),Rs.create(c,a,l),Rs.create(c,l,o));for(let u=0;u<3;u++){const m=(u+1)%3;p[u+1].getEdge(2).setTwin(p[0].getEdge((3-u)%3)),p[u+1].getEdge(0).setTwin(p[m+1].getEdge(1))}}for(let u=0;u<4;u++)this.faces.push(p[u]);for(let u=0,m=e.length;u<m;u++){const E=e[u];if(E!==o&&E!==a&&E!==l&&E!==c){n=this.tolerance;let g=null;for(let T=0;T<4;T++){const y=this.faces[T].distanceToPoint(E.point);y>n&&(n=y,g=this.faces[T])}g!==null&&this.addVertexToFace(E,g)}}return this}reindexFaces(){const e=[];for(let t=0;t<this.faces.length;t++){const s=this.faces[t];s.mark===Za&&e.push(s)}return this.faces=e,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let e,t=0;const s=this.assigned.first().face;let i=s.outside;do{const n=s.distanceToPoint(i.point);n>t&&(t=n,e=i),i=i.next}while(i!==null&&i.face===s);return e}}computeHorizon(e,t,s,i){this.deleteFaceVertices(s),s.mark=fg;let n;t===null?n=t=s.getEdge(0):n=t.next;do{const r=n.twin,o=r.face;o.mark===Za&&(o.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,r,o,i):i.push(n)),n=n.next}while(n!==t);return this}addAdjoiningFace(e,t){const s=Rs.create(e,t.tail(),t.head());return this.faces.push(s),s.getEdge(-1).setTwin(t.twin),s.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let s=null,i=null;for(let n=0;n<t.length;n++){const r=t[n],o=this.addAdjoiningFace(e,r);s===null?s=o:o.next.setTwin(i),this.newFaces.push(o.face),i=o}return s.next.setTwin(i),this}addVertexToHull(e){const t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let e;for(this.computeInitialHull();(e=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}};class Rs{constructor(){this.normal=new O,this.midpoint=new O,this.area=0,this.constant=0,this.outside=null,this.mark=Za,this.edge=null}static create(e,t,s){const i=new Rs,n=new Rh(e,i),r=new Rh(t,i),o=new Rh(s,i);return n.next=o.prev=r,r.next=n.prev=o,o.next=r.prev=n,i.edge=n,i.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){const e=this.edge.tail(),t=this.edge.head(),s=this.edge.next.head();return oa.set(e.point,t.point,s.point),oa.getNormal(this.normal),oa.getMidpoint(this.midpoint),this.area=oa.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}let Rh=class{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceTo(e.point):-1}lengthSquared(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}},gg=class{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}},gu=class{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,t.prev===null?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,t.next===null?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail;e.next!==null;)e=e.next;return this.tail=e,this}remove(e){return e.prev===null?this.head=e.next:e.prev.next=e.next,e.next===null?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return e.prev===null?this.head=t.next:e.prev.next=t.next,t.next===null?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return this.head===null}};const dc=[2,2,1],uc=[1,0,0];function ks(h,e){return h*3+e}function Ig(h){const e=h.elements;let t=0;for(let s=0;s<9;s++)t+=e[s]*e[s];return Math.sqrt(t)}function Cg(h){const e=h.elements;let t=0;for(let s=0;s<3;s++){const i=e[ks(dc[s],uc[s])];t+=2*i*i}return Math.sqrt(t)}function Tg(h,e){let t=0,s=1;const i=h.elements;for(let l=0;l<3;l++){const c=Math.abs(i[ks(dc[l],uc[l])]);c>t&&(t=c,s=l)}let n=1,r=0;const o=uc[s],a=dc[s];if(Math.abs(i[ks(a,o)])>Number.EPSILON){const l=i[ks(a,a)],c=i[ks(o,o)],p=i[ks(a,o)],u=(l-c)/2/p;let m;u<0?m=-1/(-u+Math.sqrt(1+u*u)):m=1/(u+Math.sqrt(1+u*u)),n=1/Math.sqrt(1+m*m),r=m*n}return e.identity(),e.elements[ks(o,o)]=n,e.elements[ks(a,a)]=n,e.elements[ks(a,o)]=r,e.elements[ks(o,a)]=-r,e}function yg(h,e){let t=0,s=0;const i=10;e.unitary.identity(),e.diagonal.copy(h);const n=e.unitary,r=e.diagonal,o=new Kt,a=new Kt,l=Number.EPSILON*Ig(r);for(;s<i&&Cg(r)>l;)Tg(r,o),a.copy(o).transpose(),r.multiply(o),r.premultiply(a),n.multiply(o),++t>2&&(s++,t=0);return e}function wg(h){const e=[];for(let Pe=0;Pe<h.length-2;Pe+=3){const Ce=h[Pe],Ae=h[Pe+1],wt=h[Pe+2];e.push(new O(Ce,Ae,wt))}const t=new Eg;t.setFromPoints(e);const s={unitary:new Kt,diagonal:new Kt},i=t.faces,n=[],r=[];for(let Pe=0,Ce=i.length;Pe<Ce;Pe++){const Ae=i[Pe];let wt=Ae.edge;n.length=0;do n.push(wt),wt=wt.next;while(wt!==Ae.edge);const ke=n.length-2;for(let zt=1,ur=ke;zt<=ur;zt++){const Yt=n[0].vertex,Js=n[zt+0].vertex,$s=n[zt+1].vertex;r.push(Yt.point.x,Yt.point.y,Yt.point.z),r.push(Js.point.x,Js.point.y,Js.point.z),r.push($s.point.x,$s.point.y,$s.point.z)}}const o=new O,a=new O,l=new O,c=new O,p=new O,u=new O,m=new O,E=new O;let g=0,T=0,y=0,v=0,A=0,C=0,F=0;for(let Pe=0,Ce=r.length;Pe<Ce;Pe+=9){o.fromArray(r,Pe),a.fromArray(r,Pe+3),l.fromArray(r,Pe+6),m.set(0,0,0),m.add(o).add(a).add(l).divideScalar(3),c.subVectors(a,o),p.subVectors(l,o);const Ae=u.crossVectors(c,p).length()/2;E.add(u.copy(m).multiplyScalar(Ae)),g+=Ae,T+=(9*m.x*m.x+o.x*o.x+a.x*a.x+l.x*l.x)*(Ae/12),y+=(9*m.x*m.y+o.x*o.y+a.x*a.y+l.x*l.y)*(Ae/12),v+=(9*m.x*m.z+o.x*o.z+a.x*a.z+l.x*l.z)*(Ae/12),A+=(9*m.y*m.y+o.y*o.y+a.y*a.y+l.y*l.y)*(Ae/12),C+=(9*m.y*m.z+o.y*o.z+a.y*a.z+l.y*l.z)*(Ae/12),F+=(9*m.z*m.z+o.z*o.z+a.z*a.z+l.z*l.z)*(Ae/12)}E.divideScalar(g),T/=g,y/=g,v/=g,A/=g,C/=g,F/=g,T-=E.x*E.x,y-=E.x*E.y,v-=E.x*E.z,A-=E.y*E.y,C-=E.y*E.z,F-=E.z*E.z;const M=new Kt;M.elements[0]=T,M.elements[1]=y,M.elements[2]=v,M.elements[3]=y,M.elements[4]=A,M.elements[5]=C,M.elements[6]=v,M.elements[7]=C,M.elements[8]=F,yg(M,s);const _=s.unitary,L=new O,D=new O,B=new O;_.extractBasis(L,D,B);let z=-1/0,V=-1/0,Q=-1/0,ne=1/0,ue=1/0,oe=1/0;for(let Pe=0,Ce=e.length;Pe<Ce;Pe++){const Ae=e[Pe];z=Math.max(L.dot(Ae),z),V=Math.max(D.dot(Ae),V),Q=Math.max(B.dot(Ae),Q),ne=Math.min(L.dot(Ae),ne),ue=Math.min(D.dot(Ae),ue),oe=Math.min(B.dot(Ae),oe)}L.multiplyScalar(.5*(ne+z)),D.multiplyScalar(.5*(ue+V)),B.multiplyScalar(.5*(oe+Q));const Ie=new O,ce=new O,ye=new Kt;Ie.add(L).add(D).add(B),ce.x=z-ne,ce.y=V-ue,ce.z=Q-oe,ce.multiplyScalar(.5),ye.copy(_);const{x:Ze,y:gt,z:Is}=ce,yt=new de;yt.makeScale(Ze*2,gt*2,Is*2);const ui=new de;ui.makeTranslation(-Ze,-gt,-Is);const Ps=new de;Ps.makeTranslation(Ie.x,Ie.y,Ie.z);const is=new de;is.setFromMatrix3(ye);const Bt=new de;return Bt.multiply(Ps),Bt.multiply(is),Bt.multiply(ui),Bt.multiply(yt),{center:Ie,halfSizes:ce,rotation:ye,transformation:Bt}}function vg(h,e,t){const s=[h[0]-e[0],h[1]-e[1],h[2]-e[2]];return t[0]*s[0]+t[1]*s[1]+t[2]*s[2]>0}class Iu{static isTransparent(e){return e.transparent&&e.opacity<1}}const pc=class Ft{static create(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return`${Ft._lut[e&255]+Ft._lut[e>>8&255]+Ft._lut[e>>16&255]+Ft._lut[e>>24&255]}-${Ft._lut[t&255]}${Ft._lut[t>>8&255]}-${Ft._lut[t>>16&15|64]}${Ft._lut[t>>24&255]}-${Ft._lut[s&63|128]}${Ft._lut[s>>8&255]}-${Ft._lut[s>>16&255]}${Ft._lut[s>>24&255]}${Ft._lut[i&255]}${Ft._lut[i>>8&255]}${Ft._lut[i>>16&255]}${Ft._lut[i>>24&255]}`.toLowerCase()}static validate(e){if(!Ft._pattern.test(e))throw new Error(`${e} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};b(pc,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/),b(pc,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let nd=pc;const nf=class rf{constructor(){b(this,"onDisposed",new pe),b(this,"list",new Map),b(this,"enabled",!1),b(this,"_clock"),b(this,"update",()=>{if(!this.enabled)return;const e=this._clock.getDelta();for(const[t,s]of this.list)s.enabled&&s.isUpdateable()&&s.update(e);requestAnimationFrame(this.update)}),this._clock=new Kc,rf.setupBVH()}add(e,t){if(this.list.has(e))throw new Error("You're trying to add a component that already exists in the components instance. Use Components.get() instead.");nd.validate(e),this.list.set(e,t)}get(e){const t=e.uuid;if(!this.list.has(t)){const s=new e(this);return this.list.has(t)||this.add(t,s),s}return this.list.get(t)}init(){this.enabled=!0,this._clock.start(),this.update()}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.enabled=!1,t.isDisposeable()&&t.dispose();this._clock.stop(),this.onDisposed.trigger(),this.onDisposed.reset()}static setupBVH(){ze.prototype.computeBoundsTree=hg,ze.prototype.disposeBoundsTree=cg,J.prototype.raycast=lg}};b(nf,"release","2.1.27");let Rg=nf,Fg=class extends sd{constructor(){super(...arguments),b(this,"meshes",new Set),b(this,"onAfterUpdate",new pe),b(this,"onBeforeUpdate",new pe),b(this,"onDisposed",new pe),b(this,"isDisposing",!1),b(this,"enabled",!0),b(this,"uuid",nd.create()),b(this,"name"),b(this,"_scene"),b(this,"_camera"),b(this,"_renderer",null)}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(e){this._scene=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(e){this._camera=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get renderer(){return this._renderer}set renderer(e){this._renderer=e,e&&(e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"}))}update(e){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(e),this.camera.isUpdateable()&&this.camera.update(e),this.renderer&&this.renderer.update(e),this.onAfterUpdate.trigger()))}dispose(e=!0){if(this.enabled=!1,this.isDisposing=!0,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),e){const t=this.components.get(sr);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const s of this.meshes)t.destroy(s);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.onDisposed.trigger()}},UT=class extends pg{constructor(e){super(e),b(this,"isSetup",!1),b(this,"three"),b(this,"onSetup",new pe),b(this,"config",{directionalLight:{color:new ft("white"),intensity:1.5,position:new O(5,10,3)},ambientLight:{color:new ft("white"),intensity:1}}),this.three=new js,this.three.background=new ft(2107698)}setup(e){this.config={...this.config,...e};const t=new zE(this.config.directionalLight.color,this.config.directionalLight.intensity);t.position.copy(this.config.directionalLight.position);const s=new YE(this.config.ambientLight.color,this.config.ambientLight.intensity);this.three.add(t,s),this.directionalLights.set(t.uuid,t),this.ambientLights.set(s.uuid,s),this.isSetup=!0,this.onSetup.trigger(this)}},zT=class extends ug{constructor(e,t,s){super(e),b(this,"enabled",!0),b(this,"container"),b(this,"three"),b(this,"_canvas"),b(this,"_parameters"),b(this,"_resizeObserver",null),b(this,"onContainerUpdated",new pe),b(this,"_resizing",!1),b(this,"resize",r=>{if(this._resizing)return;this._resizing=!0,this.onContainerUpdated.trigger();const o=r?r.x:this.container.clientWidth,a=r?r.y:this.container.clientHeight;this.three.setSize(o,a),this.onResize.trigger(new Ue(o,a)),this._resizing=!1}),b(this,"resizeEvent",()=>{this.resize()}),b(this,"onContextLost",r=>{r.preventDefault(),this.enabled=!1}),b(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new _i({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0}),this.container=t,this._parameters=s,this.three=new _i({antialias:!0,alpha:!0,...s}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const i=this.three.getContext(),{canvas:n}=i;n.addEventListener("webglcontextlost",this.onContextLost,!1),n.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const e=this.currentWorld.scene.three,t=this.currentWorld.camera.three;this.three.render(e,t),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.forceContextLoss(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new Ue(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(e){const t=this.three.domElement.parentElement;if(!t)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),e&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(t),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}};/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Re={LEFT:1,RIGHT:2,MIDDLE:4},se=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),On={NONE:0,IN:1,OUT:-1};function Xi(h){return h.isPerspectiveCamera}function Ri(h){return h.isOrthographicCamera}const Pn=Math.PI*2,Cu=Math.PI/2,of=1e-5,Lr=Math.PI/180;function ys(h,e,t){return Math.max(e,Math.min(t,h))}function $e(h,e=of){return Math.abs(h)<e}function We(h,e,t=of){return $e(h-e,t)}function Tu(h,e){return Math.round(h/e)*e}function Nr(h){return isFinite(h)?h:h<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Dr(h){return Math.abs(h)<Number.MAX_VALUE?h:h*(1/0)}function aa(h,e,t,s,i=1/0,n){s=Math.max(1e-4,s);const r=2/s,o=r*n,a=1/(1+o+.48*o*o+.235*o*o*o);let l=h-e;const c=e,p=i*s;l=ys(l,-p,p),e=h-l;const u=(t.value+r*l)*n;t.value=(t.value-r*u)*a;let m=e+(l+u)*a;return c-h>0==m>c&&(m=c,t.value=(m-c)/n),m}function yu(h,e,t,s,i=1/0,n,r){s=Math.max(1e-4,s);const o=2/s,a=o*n,l=1/(1+a+.48*a*a+.235*a*a*a);let c=e.x,p=e.y,u=e.z,m=h.x-c,E=h.y-p,g=h.z-u;const T=c,y=p,v=u,A=i*s,C=A*A,F=m*m+E*E+g*g;if(F>C){const ue=Math.sqrt(F);m=m/ue*A,E=E/ue*A,g=g/ue*A}c=h.x-m,p=h.y-E,u=h.z-g;const M=(t.x+o*m)*n,_=(t.y+o*E)*n,L=(t.z+o*g)*n;t.x=(t.x-o*M)*l,t.y=(t.y-o*_)*l,t.z=(t.z-o*L)*l,r.x=c+(m+M)*l,r.y=p+(E+_)*l,r.z=u+(g+L)*l;const D=T-h.x,B=y-h.y,z=v-h.z,V=r.x-T,Q=r.y-y,ne=r.z-v;return D*V+B*Q+z*ne>0&&(r.x=T,r.y=y,r.z=v,t.x=(r.x-T)/n,t.y=(r.y-y)/n,t.z=(r.z-v)/n),r}function Fh(h,e){e.set(0,0),h.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=h.length,e.y/=h.length}function Ah(h,e){return Ri(h)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class Ag{constructor(){this._listeners={}}addEventListener(e,t){const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){const s=this._listeners[e];if(s!==void 0){const i=s.indexOf(t);i!==-1&&s.splice(i,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const t=this._listeners[e.type];if(t!==void 0){e.target=this;const s=t.slice(0);for(let i=0,n=s.length;i<n;i++)s[i].call(this,e)}}}const Sg="2.7.3",la=1/8,af=typeof window<"u",Og=af&&/Mac/.test(navigator.platform),Pg=!(af&&"PointerEvent"in window);let we,wu,ha,Sh,Wt,be,Ge,bn,Ur,_s,Ls,Ki,vu,Ru,rs,Br,xn,Fu,Oh,Au,Ph,bh,ca;class Ut extends Ag{static install(e){we=e.THREE,wu=Object.freeze(new we.Vector3(0,0,0)),ha=Object.freeze(new we.Vector3(0,1,0)),Sh=Object.freeze(new we.Vector3(0,0,1)),Wt=new we.Vector2,be=new we.Vector3,Ge=new we.Vector3,bn=new we.Vector3,Ur=new we.Vector3,_s=new we.Vector3,Ls=new we.Vector3,Ki=new we.Vector3,vu=new we.Vector3,Ru=new we.Vector3,rs=new we.Spherical,Br=new we.Spherical,xn=new we.Box3,Fu=new we.Box3,Oh=new we.Sphere,Au=new we.Quaternion,Ph=new we.Quaternion,bh=new we.Matrix4,ca=new we.Raycaster}static get ACTION(){return se}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=se.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=On.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new we.Vector3,this._focalOffsetVelocity=new we.Vector3,this._zoomVelocity={value:0},this._truckInternal=(C,F,M)=>{let _,L;if(Xi(this._camera)){const D=be.copy(this._camera.position).sub(this._target),B=this._camera.getEffectiveFOV()*Lr,z=D.length()*Math.tan(B*.5);_=this.truckSpeed*C*z/this._elementRect.height,L=this.truckSpeed*F*z/this._elementRect.height}else if(Ri(this._camera)){const D=this._camera;_=C*(D.right-D.left)/D.zoom/this._elementRect.width,L=F*(D.top-D.bottom)/D.zoom/this._elementRect.height}else return;this.verticalDragToForward?(M?this.setFocalOffset(this._focalOffsetEnd.x+_,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(_,0,!0),this.forward(-L,!0)):M?this.setFocalOffset(this._focalOffsetEnd.x+_,this._focalOffsetEnd.y+L,this._focalOffsetEnd.z,!0):this.truck(_,L,!0)},this._rotateInternal=(C,F)=>{const M=Pn*this.azimuthRotateSpeed*C/this._elementRect.height,_=Pn*this.polarRotateSpeed*F/this._elementRect.height;this.rotate(M,_,!0)},this._dollyInternal=(C,F,M)=>{const _=Math.pow(.95,-C*this.dollySpeed),L=this._sphericalEnd.radius,D=this._sphericalEnd.radius*_,B=ys(D,this.minDistance,this.maxDistance),z=B-D;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(D,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(z,!0),this._dollyToNoClamp(B,!0)):this._dollyToNoClamp(B,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?D:B)-L,this._dollyControlCoord.set(F,M)),this._lastDollyDirection=Math.sign(-C)},this._zoomInternal=(C,F,M)=>{const _=Math.pow(.95,C*this.dollySpeed),L=this._zoom,D=this._zoom*_;this.zoomTo(D,!0),this.dollyToCursor&&(this._changedZoom+=D-L,this._dollyControlCoord.set(F,M))},typeof we>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new we.Quaternion().setFromUnitVectors(this._camera.up,ha),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=se.NONE,this._target=new we.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new we.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new we.Spherical().setFromVector3(be.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new we.Vector3,new we.Vector3,new we.Vector3,new we.Vector3],this._updateNearPlaneCorners(),this._boundary=new we.Box3(new we.Vector3(-1/0,-1/0,-1/0),new we.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new we.Vector2,this.mouseButtons={left:se.ROTATE,middle:se.DOLLY,right:se.TRUCK,wheel:Xi(this._camera)?se.DOLLY:Ri(this._camera)?se.ZOOM:se.NONE},this.touches={one:se.TOUCH_ROTATE,two:Xi(this._camera)?se.TOUCH_DOLLY_TRUCK:Ri(this._camera)?se.TOUCH_ZOOM_TRUCK:se.NONE,three:se.TOUCH_TRUCK};const s=new we.Vector2,i=new we.Vector2,n=new we.Vector2,r=C=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const _=this._domElement.getBoundingClientRect(),L=C.clientX/_.width,D=C.clientY/_.height;if(L<this._interactiveArea.left||L>this._interactiveArea.right||D<this._interactiveArea.top||D>this._interactiveArea.bottom)return}const F=C.pointerType!=="mouse"?null:(C.buttons&Re.LEFT)===Re.LEFT?Re.LEFT:(C.buttons&Re.MIDDLE)===Re.MIDDLE?Re.MIDDLE:(C.buttons&Re.RIGHT)===Re.RIGHT?Re.RIGHT:null;if(F!==null){const _=this._findPointerByMouseButton(F);_&&this._disposePointer(_)}if((C.buttons&Re.LEFT)===Re.LEFT&&this._lockedPointer)return;const M={pointerId:C.pointerId,clientX:C.clientX,clientY:C.clientY,deltaX:0,deltaY:0,mouseButton:F};this._activePointers.push(M),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),this._isDragging=!0,g(C)},o=C=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const _=this._domElement.getBoundingClientRect(),L=C.clientX/_.width,D=C.clientY/_.height;if(L<this._interactiveArea.left||L>this._interactiveArea.right||D<this._interactiveArea.top||D>this._interactiveArea.bottom)return}const F=(C.buttons&Re.LEFT)===Re.LEFT?Re.LEFT:(C.buttons&Re.MIDDLE)===Re.MIDDLE?Re.MIDDLE:(C.buttons&Re.RIGHT)===Re.RIGHT?Re.RIGHT:null;if(F!==null){const _=this._findPointerByMouseButton(F);_&&this._disposePointer(_)}const M={pointerId:1,clientX:C.clientX,clientY:C.clientY,deltaX:0,deltaY:0,mouseButton:(C.buttons&Re.LEFT)===Re.LEFT?Re.LEFT:(C.buttons&Re.MIDDLE)===Re.LEFT?Re.MIDDLE:(C.buttons&Re.RIGHT)===Re.LEFT?Re.RIGHT:null};this._activePointers.push(M),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("mouseup",p),this._domElement.ownerDocument.addEventListener("mousemove",l),this._domElement.ownerDocument.addEventListener("mouseup",p),this._isDragging=!0,g(C)},a=C=>{C.cancelable&&C.preventDefault();const F=C.pointerId,M=this._lockedPointer||this._findPointerById(F);if(M){if(M.clientX=C.clientX,M.clientY=C.clientY,M.deltaX=C.movementX,M.deltaY=C.movementY,this._state=0,C.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(C.buttons&Re.LEFT)===Re.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(C.buttons&Re.MIDDLE)===Re.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(C.buttons&Re.RIGHT)===Re.RIGHT&&(this._state=this._state|this.mouseButtons.right);T()}},l=C=>{const F=this._lockedPointer||this._findPointerById(1);F&&(F.clientX=C.clientX,F.clientY=C.clientY,F.deltaX=C.movementX,F.deltaY=C.movementY,this._state=0,(this._lockedPointer||(C.buttons&Re.LEFT)===Re.LEFT)&&(this._state=this._state|this.mouseButtons.left),(C.buttons&Re.MIDDLE)===Re.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(C.buttons&Re.RIGHT)===Re.RIGHT&&(this._state=this._state|this.mouseButtons.right),T())},c=C=>{const F=this._findPointerById(C.pointerId);if(!(F&&F===this._lockedPointer)){if(F&&this._disposePointer(F),C.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=se.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=se.NONE;y()}},p=()=>{const C=this._findPointerById(1);C&&C===this._lockedPointer||(C&&this._disposePointer(C),this._state=se.NONE,y())};let u=-1;const m=C=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===se.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const D=this._domElement.getBoundingClientRect(),B=C.clientX/D.width,z=C.clientY/D.height;if(B<this._interactiveArea.left||B>this._interactiveArea.right||z<this._interactiveArea.top||z>this._interactiveArea.bottom)return}if(C.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===se.ROTATE||this.mouseButtons.wheel===se.TRUCK){const D=performance.now();u-D<1e3&&this._getClientRect(this._elementRect),u=D}const F=Og?-1:-3,M=C.deltaMode===1?C.deltaY/F:C.deltaY/(F*10),_=this.dollyToCursor?(C.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,L=this.dollyToCursor?(C.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case se.ROTATE:{this._rotateInternal(C.deltaX,C.deltaY),this._isUserControllingRotate=!0;break}case se.TRUCK:{this._truckInternal(C.deltaX,C.deltaY,!1),this._isUserControllingTruck=!0;break}case se.OFFSET:{this._truckInternal(C.deltaX,C.deltaY,!0),this._isUserControllingOffset=!0;break}case se.DOLLY:{this._dollyInternal(-M,_,L),this._isUserControllingDolly=!0;break}case se.ZOOM:{this._zoomInternal(-M,_,L),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},E=C=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Ut.ACTION.NONE){const F=C instanceof PointerEvent?C.pointerId:0,M=this._findPointerById(F);M&&this._disposePointer(M),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("mouseup",p);return}C.preventDefault()}},g=C=>{if(this._enabled){if(Fh(this._activePointers,Wt),this._getClientRect(this._elementRect),s.copy(Wt),i.copy(Wt),this._activePointers.length>=2){const F=Wt.x-this._activePointers[1].clientX,M=Wt.y-this._activePointers[1].clientY,_=Math.sqrt(F*F+M*M);n.set(0,_);const L=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,D=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(L,D)}if(this._state=0,!C)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in C&&C.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(C.buttons&Re.LEFT)===Re.LEFT&&(this._state=this._state|this.mouseButtons.left),(C.buttons&Re.MIDDLE)===Re.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(C.buttons&Re.RIGHT)===Re.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&se.ROTATE)===se.ROTATE||(this._state&se.TOUCH_ROTATE)===se.TOUCH_ROTATE||(this._state&se.TOUCH_DOLLY_ROTATE)===se.TOUCH_DOLLY_ROTATE||(this._state&se.TOUCH_ZOOM_ROTATE)===se.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&se.TRUCK)===se.TRUCK||(this._state&se.TOUCH_TRUCK)===se.TOUCH_TRUCK||(this._state&se.TOUCH_DOLLY_TRUCK)===se.TOUCH_DOLLY_TRUCK||(this._state&se.TOUCH_ZOOM_TRUCK)===se.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&se.DOLLY)===se.DOLLY||(this._state&se.TOUCH_DOLLY)===se.TOUCH_DOLLY||(this._state&se.TOUCH_DOLLY_TRUCK)===se.TOUCH_DOLLY_TRUCK||(this._state&se.TOUCH_DOLLY_OFFSET)===se.TOUCH_DOLLY_OFFSET||(this._state&se.TOUCH_DOLLY_ROTATE)===se.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&se.ZOOM)===se.ZOOM||(this._state&se.TOUCH_ZOOM)===se.TOUCH_ZOOM||(this._state&se.TOUCH_ZOOM_TRUCK)===se.TOUCH_ZOOM_TRUCK||(this._state&se.TOUCH_ZOOM_OFFSET)===se.TOUCH_ZOOM_OFFSET||(this._state&se.TOUCH_ZOOM_ROTATE)===se.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&se.OFFSET)===se.OFFSET||(this._state&se.TOUCH_OFFSET)===se.TOUCH_OFFSET||(this._state&se.TOUCH_DOLLY_OFFSET)===se.TOUCH_DOLLY_OFFSET||(this._state&se.TOUCH_ZOOM_OFFSET)===se.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},T=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Fh(this._activePointers,Wt);const C=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,F=C?-C.deltaX:i.x-Wt.x,M=C?-C.deltaY:i.y-Wt.y;if(i.copy(Wt),((this._state&se.ROTATE)===se.ROTATE||(this._state&se.TOUCH_ROTATE)===se.TOUCH_ROTATE||(this._state&se.TOUCH_DOLLY_ROTATE)===se.TOUCH_DOLLY_ROTATE||(this._state&se.TOUCH_ZOOM_ROTATE)===se.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(F,M),this._isUserControllingRotate=!0),(this._state&se.DOLLY)===se.DOLLY||(this._state&se.ZOOM)===se.ZOOM){const _=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,L=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,D=this.dollyDragInverted?-1:1;(this._state&se.DOLLY)===se.DOLLY?(this._dollyInternal(D*M*la,_,L),this._isUserControllingDolly=!0):(this._zoomInternal(D*M*la,_,L),this._isUserControllingZoom=!0)}if((this._state&se.TOUCH_DOLLY)===se.TOUCH_DOLLY||(this._state&se.TOUCH_ZOOM)===se.TOUCH_ZOOM||(this._state&se.TOUCH_DOLLY_TRUCK)===se.TOUCH_DOLLY_TRUCK||(this._state&se.TOUCH_ZOOM_TRUCK)===se.TOUCH_ZOOM_TRUCK||(this._state&se.TOUCH_DOLLY_OFFSET)===se.TOUCH_DOLLY_OFFSET||(this._state&se.TOUCH_ZOOM_OFFSET)===se.TOUCH_ZOOM_OFFSET||(this._state&se.TOUCH_DOLLY_ROTATE)===se.TOUCH_DOLLY_ROTATE||(this._state&se.TOUCH_ZOOM_ROTATE)===se.TOUCH_ZOOM_ROTATE){const _=Wt.x-this._activePointers[1].clientX,L=Wt.y-this._activePointers[1].clientY,D=Math.sqrt(_*_+L*L),B=n.y-D;n.set(0,D);const z=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,V=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&se.TOUCH_DOLLY)===se.TOUCH_DOLLY||(this._state&se.TOUCH_DOLLY_ROTATE)===se.TOUCH_DOLLY_ROTATE||(this._state&se.TOUCH_DOLLY_TRUCK)===se.TOUCH_DOLLY_TRUCK||(this._state&se.TOUCH_DOLLY_OFFSET)===se.TOUCH_DOLLY_OFFSET?(this._dollyInternal(B*la,z,V),this._isUserControllingDolly=!0):(this._zoomInternal(B*la,z,V),this._isUserControllingZoom=!0)}((this._state&se.TRUCK)===se.TRUCK||(this._state&se.TOUCH_TRUCK)===se.TOUCH_TRUCK||(this._state&se.TOUCH_DOLLY_TRUCK)===se.TOUCH_DOLLY_TRUCK||(this._state&se.TOUCH_ZOOM_TRUCK)===se.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(F,M,!1),this._isUserControllingTruck=!0),((this._state&se.OFFSET)===se.OFFSET||(this._state&se.TOUCH_OFFSET)===se.TOUCH_OFFSET||(this._state&se.TOUCH_DOLLY_OFFSET)===se.TOUCH_DOLLY_OFFSET||(this._state&se.TOUCH_ZOOM_OFFSET)===se.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(F,M,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},y=()=>{Fh(this._activePointers,Wt),i.copy(Wt),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("mouseup",p),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",v),this._domElement.ownerDocument.addEventListener("pointerlockerror",A),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),g())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",v),this._domElement.ownerDocument.removeEventListener("pointerlockerror",A))};const v=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},A=()=>{this.unlockPointer()};this._addAllEventListeners=C=>{this._domElement=C,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",r),Pg&&this._domElement.addEventListener("mousedown",o),this._domElement.addEventListener("pointercancel",c),this._domElement.addEventListener("wheel",m,{passive:!1}),this._domElement.addEventListener("contextmenu",E)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",r),this._domElement.removeEventListener("mousedown",o),this._domElement.removeEventListener("pointercancel",c),this._domElement.removeEventListener("wheel",m,{passive:!1}),this._domElement.removeEventListener("contextmenu",E),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("mouseup",p),this._domElement.ownerDocument.removeEventListener("pointerlockchange",v),this._domElement.ownerDocument.removeEventListener("pointerlockerror",A))},this.cancel=()=>{this._state!==se.NONE&&(this._state=se.NONE,this._activePointers.length=0,y())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=ys(e.width,0,1),this._interactiveArea.height=ys(e.height,0,1),this._interactiveArea.x=ys(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=ys(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,s=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,s)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,s=!1){this._isUserControllingRotate=!1;const i=ys(e,this.minAzimuthAngle,this.maxAzimuthAngle),n=ys(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=n,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const r=!s||We(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&We(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(r)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=On.NONE,this._changedDolly=0,this._dollyToNoClamp(ys(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const n=this._collisionTest(),r=We(n,this._spherical.radius);if(!(s>e)&&r)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,n)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const i=!t||We(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(i)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(Ur).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const s=!t||We(this._target.x,this._targetEnd.x,this.restThreshold)&&We(this._target.y,this._targetEnd.y,this.restThreshold)&&We(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=ys(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const s=!t||We(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(e,t,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,s)}truck(e,t,s=!1){this._camera.updateMatrix(),_s.setFromMatrixColumn(this._camera.matrix,0),Ls.setFromMatrixColumn(this._camera.matrix,1),_s.multiplyScalar(e),Ls.multiplyScalar(-t);const i=be.copy(_s).add(Ls),n=Ge.copy(this._targetEnd).add(i);return this.moveTo(n.x,n.y,n.z,s)}forward(e,t=!1){be.setFromMatrixColumn(this._camera.matrix,0),be.crossVectors(this._camera.up,be),be.multiplyScalar(e);const s=Ge.copy(this._targetEnd).add(be);return this.moveTo(s.x,s.y,s.z,t)}elevate(e,t=!1){return be.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+be.x,this._targetEnd.y+be.y,this._targetEnd.z+be.z,t)}moveTo(e,t,s,i=!1){this._isUserControllingTruck=!1;const n=be.set(e,t,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,n,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const r=!i||We(this._target.x,this._targetEnd.x,this.restThreshold)&&We(this._target.y,this._targetEnd.y,this.restThreshold)&&We(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}lookInDirectionOf(e,t,s,i=!1){const n=be.set(e,t,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(n.x,n.y,n.z,i)}fitToBox(e,t,{cover:s=!1,paddingLeft:i=0,paddingRight:n=0,paddingBottom:r=0,paddingTop:o=0}={}){const a=[],l=e.isBox3?xn.copy(e):xn.setFromObject(e);l.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const c=Tu(this._sphericalEnd.theta,Cu),p=Tu(this._sphericalEnd.phi,Cu);a.push(this.rotateTo(c,p,t));const u=be.setFromSpherical(this._sphericalEnd).normalize(),m=Au.setFromUnitVectors(u,Sh),E=We(Math.abs(u.y),1);E&&m.multiply(Ph.setFromAxisAngle(ha,c)),m.multiply(this._yAxisUpSpaceInverse);const g=Fu.makeEmpty();Ge.copy(l.min).applyQuaternion(m),g.expandByPoint(Ge),Ge.copy(l.min).setX(l.max.x).applyQuaternion(m),g.expandByPoint(Ge),Ge.copy(l.min).setY(l.max.y).applyQuaternion(m),g.expandByPoint(Ge),Ge.copy(l.max).setZ(l.min.z).applyQuaternion(m),g.expandByPoint(Ge),Ge.copy(l.min).setZ(l.max.z).applyQuaternion(m),g.expandByPoint(Ge),Ge.copy(l.max).setY(l.min.y).applyQuaternion(m),g.expandByPoint(Ge),Ge.copy(l.max).setX(l.min.x).applyQuaternion(m),g.expandByPoint(Ge),Ge.copy(l.max).applyQuaternion(m),g.expandByPoint(Ge),g.min.x-=i,g.min.y-=r,g.max.x+=n,g.max.y+=o,m.setFromUnitVectors(Sh,u),E&&m.premultiply(Ph.invert()),m.premultiply(this._yAxisUpSpace);const T=g.getSize(be),y=g.getCenter(Ge).applyQuaternion(m);if(Xi(this._camera)){const v=this.getDistanceToFitBox(T.x,T.y,T.z,s);a.push(this.moveTo(y.x,y.y,y.z,t)),a.push(this.dollyTo(v,t)),a.push(this.setFocalOffset(0,0,0,t))}else if(Ri(this._camera)){const v=this._camera,A=v.right-v.left,C=v.top-v.bottom,F=s?Math.max(A/T.x,C/T.y):Math.min(A/T.x,C/T.y);a.push(this.moveTo(y.x,y.y,y.z,t)),a.push(this.zoomTo(F,t)),a.push(this.setFocalOffset(0,0,0,t))}return Promise.all(a)}fitToSphere(e,t){const s=[],i=e instanceof we.Sphere?Oh.copy(e):Ut.createBoundingSphere(e,Oh);if(s.push(this.moveTo(i.center.x,i.center.y,i.center.z,t)),Xi(this._camera)){const n=this.getDistanceToFitSphere(i.radius);s.push(this.dollyTo(n,t))}else if(Ri(this._camera)){const n=this._camera.right-this._camera.left,r=this._camera.top-this._camera.bottom,o=2*i.radius,a=Math.min(n/o,r/o);s.push(this.zoomTo(a,t))}return s.push(this.setFocalOffset(0,0,0,t)),Promise.all(s)}setLookAt(e,t,s,i,n,r,o=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=On.NONE,this._changedDolly=0;const a=Ge.set(i,n,r),l=be.set(e,t,s);this._targetEnd.copy(a),this._sphericalEnd.setFromVector3(l.sub(a).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const c=!o||We(this._target.x,this._targetEnd.x,this.restThreshold)&&We(this._target.y,this._targetEnd.y,this.restThreshold)&&We(this._target.z,this._targetEnd.z,this.restThreshold)&&We(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&We(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&We(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}lerpLookAt(e,t,s,i,n,r,o,a,l,c,p,u,m,E=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=On.NONE,this._changedDolly=0;const g=be.set(i,n,r),T=Ge.set(e,t,s);rs.setFromVector3(T.sub(g).applyQuaternion(this._yAxisUpSpace));const y=bn.set(c,p,u),v=Ge.set(o,a,l);Br.setFromVector3(v.sub(y).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(g.lerp(y,m));const A=Br.theta-rs.theta,C=Br.phi-rs.phi,F=Br.radius-rs.radius;this._sphericalEnd.set(rs.radius+F*m,rs.phi+C*m,rs.theta+A*m),this.normalizeRotations(),this._needsUpdate=!0,E||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const M=!E||We(this._target.x,this._targetEnd.x,this.restThreshold)&&We(this._target.y,this._targetEnd.y,this.restThreshold)&&We(this._target.z,this._targetEnd.z,this.restThreshold)&&We(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&We(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&We(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(M)}setPosition(e,t,s,i=!1){return this.setLookAt(e,t,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,s,i=!1){const n=this.getPosition(be),r=this.setLookAt(n.x,n.y,n.z,e,t,s,i);return this._sphericalEnd.phi=ys(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),r}setFocalOffset(e,t,s,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,s),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const n=!i||We(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&We(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&We(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}setOrbitPoint(e,t,s){this._camera.updateMatrixWorld(),_s.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Ls.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Ki.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=be.set(e,t,s),n=i.distanceTo(this._camera.position),r=i.sub(this._camera.position);_s.multiplyScalar(r.x),Ls.multiplyScalar(r.y),Ki.multiplyScalar(r.z),be.copy(_s).add(Ls).add(Ki),be.z=be.z+n,this.dollyTo(n,!1),this.setFocalOffset(-be.x,be.y,-be.z,!1),this.moveTo(e,t,s,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,s,i){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new we.Vector4,typeof e=="number"?this._viewport.set(e,t,s,i):this._viewport.copy(e)}getDistanceToFitBox(e,t,s,i=!1){if(Ah(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const n=e/t,r=this._camera.getEffectiveFOV()*Lr,o=this._camera.aspect;return((i?n>o:n<o)?t:e/o)*.5/Math.tan(r*.5)+s*.5}getDistanceToFitSphere(e){if(Ah(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*Lr,s=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?t:s;return e/Math.sin(i*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new we.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new we.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e&&e instanceof we.Spherical?e:new we.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new we.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Pn,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Pn),this._spherical.theta+=Pn*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Pn)}reset(e=!1){if(!We(this._camera.up.x,this._cameraUp0.x)||!We(this._camera.up.y,this._cameraUp0.y)||!We(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(be);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,ha),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=be.subVectors(this._target,this._camera.position).normalize(),t=Ge.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(be);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,n=vu.subVectors(this._targetEnd,this._target),r=Ru.subVectors(this._focalOffsetEnd,this._focalOffset),o=this._zoomEnd-this._zoom;if($e(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const c=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=aa(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,c,1/0,e),this._needsUpdate=!0}if($e(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const c=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=aa(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,c,1/0,e),this._needsUpdate=!0}if($e(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const c=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=aa(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,c,this.maxSpeed,e),this._needsUpdate=!0}if($e(n.x)&&$e(n.y)&&$e(n.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const c=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;yu(this._target,this._targetEnd,this._targetVelocity,c,this.maxSpeed,e,this._target),this._needsUpdate=!0}if($e(r.x)&&$e(r.y)&&$e(r.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const c=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;yu(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,c,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if($e(o))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const c=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=aa(this._zoom,this._zoomEnd,this._zoomVelocity,c,1/0,e)}if(this.dollyToCursor){if(Xi(this._camera)&&this._changedDolly!==0){const c=this._spherical.radius-this._lastDistance,p=this._camera,u=this._getCameraDirection(Ur),m=be.copy(u).cross(p.up).normalize();m.lengthSq()===0&&(m.x=1);const E=Ge.crossVectors(m,u),g=this._sphericalEnd.radius*Math.tan(p.getEffectiveFOV()*Lr*.5),T=(this._sphericalEnd.radius-c-this._sphericalEnd.radius)/this._sphericalEnd.radius,y=bn.copy(this._targetEnd).add(m.multiplyScalar(this._dollyControlCoord.x*g*p.aspect)).add(E.multiplyScalar(this._dollyControlCoord.y*g)),v=be.copy(this._targetEnd).lerp(y,T),A=this._lastDollyDirection===On.IN&&this._spherical.radius<=this.minDistance,C=this._lastDollyDirection===On.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(A||C)){this._sphericalEnd.radius-=c,this._spherical.radius-=c;const M=Ge.copy(u).multiplyScalar(-c);v.add(M)}this._boundary.clampPoint(v,v);const F=Ge.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(F),this._changedDolly-=c,$e(this._changedDolly)&&(this._changedDolly=0)}else if(Ri(this._camera)&&this._changedZoom!==0){const c=this._zoom-this._lastZoom,p=this._camera,u=be.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(p.near+p.far)/(p.near-p.far)).unproject(p),m=Ge.set(0,0,-1).applyQuaternion(p.quaternion),E=bn.copy(u).add(m.multiplyScalar(-u.dot(p.up))),g=-(this._zoom-c-this._zoom)/this._zoom,T=this._getCameraDirection(Ur),y=this._targetEnd.dot(T),v=be.copy(this._targetEnd).lerp(E,g),A=v.dot(T),C=T.multiplyScalar(A-y);v.sub(C),this._boundary.clampPoint(v,v);const F=Ge.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(F),this._changedZoom-=c,$e(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const a=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,a),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!$e(this._focalOffset.x)||!$e(this._focalOffset.y)||!$e(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),_s.setFromMatrixColumn(this._camera.matrix,0),Ls.setFromMatrixColumn(this._camera.matrix,1),Ki.setFromMatrixColumn(this._camera.matrix,2),_s.multiplyScalar(this._focalOffset.x),Ls.multiplyScalar(-this._focalOffset.y),Ki.multiplyScalar(this._focalOffset.z),be.copy(_s).add(Ls).add(Ki),this._camera.position.add(be)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),be.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const l=this._needsUpdate;return l&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):l?(this.dispatchEvent({type:"update"}),$e(t,this.restThreshold)&&$e(s,this.restThreshold)&&$e(i,this.restThreshold)&&$e(n.x,this.restThreshold)&&$e(n.y,this.restThreshold)&&$e(n.z,this.restThreshold)&&$e(r.x,this.restThreshold)&&$e(r.y,this.restThreshold)&&$e(r.z,this.restThreshold)&&$e(o,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!l&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=l,this._needsUpdate=!1,l}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Nr(this.maxDistance),minZoom:this.minZoom,maxZoom:Nr(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Nr(this.maxPolarAngle),minAzimuthAngle:Nr(this.minAzimuthAngle),maxAzimuthAngle:Nr(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:be.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const s=JSON.parse(e);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=Dr(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=Dr(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=Dr(s.maxPolarAngle),this.minAzimuthAngle=Dr(s.minAzimuthAngle),this.maxAzimuthAngle=Dr(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this.verticalDragToForward=s.verticalDragToForward,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],t),rs.setFromVector3(be.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(rs.theta,rs.phi,t),this.dollyTo(rs.radius,t),this.zoomTo(s.zoom,t),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",Sg),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,s){const i=t.lengthSq();if(i===0)return e;const n=Ge.copy(t).add(e),r=this._boundary.clampPoint(n,bn).sub(n),o=r.lengthSq();if(o===0)return e.add(t);if(o===i)return e;if(s===0)return e.add(t).add(r);{const a=1+s*o/t.dot(r);return e.add(Ge.copy(t).multiplyScalar(a)).add(r.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(Xi(this._camera)){const e=this._camera,t=e.near,s=e.getEffectiveFOV()*Lr,i=Math.tan(s*.5)*t,n=i*e.aspect;this._nearPlaneCorners[0].set(-n,-i,0),this._nearPlaneCorners[1].set(n,-i,0),this._nearPlaneCorners[2].set(n,i,0),this._nearPlaneCorners[3].set(-n,i,0)}else if(Ri(this._camera)){const e=this._camera,t=1/e.zoom,s=e.left*t,i=e.right*t,n=e.top*t,r=e.bottom*t;this._nearPlaneCorners[0].set(s,n,0),this._nearPlaneCorners[1].set(i,n,0),this._nearPlaneCorners[2].set(i,r,0),this._nearPlaneCorners[3].set(s,r,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||Ah(this._camera,"_collisionTest"))return e;const t=this._getTargetDirection(Ur);bh.lookAt(wu,t,this._camera.up);for(let s=0;s<4;s++){const i=Ge.copy(this._nearPlaneCorners[s]);i.applyMatrix4(bh);const n=bn.addVectors(this._target,i);ca.set(n,t),ca.far=this._spherical.radius+1;const r=ca.intersectObjects(this.colliderMeshes);r.length!==0&&r[0].distance<e&&(e=r[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const s=()=>{this.removeEventListener("rest",s),t()};this.addEventListener("rest",s)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new we.Sphere){const s=t,i=s.center;xn.makeEmpty(),e.traverseVisible(r=>{r.isMesh&&xn.expandByObject(r)}),xn.getCenter(i);let n=0;return e.traverseVisible(r=>{if(!r.isMesh)return;const o=r,a=o.geometry.clone();a.applyMatrix4(o.matrixWorld);const l=a.attributes.position;for(let c=0,p=l.count;c<p;c++)be.fromBufferAttribute(l,c),n=Math.max(n,i.distanceToSquared(be))}),s.radius=Math.sqrt(n),s}}let fc=class lf extends dg{constructor(e){super(e),b(this,"onBeforeUpdate",new pe),b(this,"onAfterUpdate",new pe),b(this,"onAspectUpdated",new pe),b(this,"onDisposed",new pe),b(this,"three"),b(this,"_allControls",new Map),b(this,"updateAspect",()=>{var t;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof di){this.onAspectUpdated.trigger();return}if((t=this.currentWorld.renderer)!=null&&t.isResizeable()){const s=this.currentWorld.renderer.getSize();this.three.aspect=s.width/s.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.onWorldChanged.add(({action:t,world:s})=>{if(t==="added"){const i=this.newCameraControls();this._allControls.set(s.uuid,i)}if(t==="removed"){const i=this._allControls.get(s.uuid);i&&(i.dispose(),this._allControls.delete(s.uuid))}})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const e=this._allControls.get(this.currentWorld.uuid);if(!e)throw new Error("Controls not found!");return e}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(e){this.currentWorld!==null&&(this.controls.enabled=e)}dispose(){this.setupEvents(!1),this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[e,t]of this._allControls)t.dispose()}update(e){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(e),this.onAfterUpdate.trigger(this))}setupCamera(){const e=window.innerWidth/window.innerHeight,t=new Mp(60,e,1,1e3);return t.position.set(50,50,50),t.lookAt(new O(0,0,0)),t}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");Ut.install({THREE:lf.getSubsetOfThree()});const{domElement:e}=this.currentWorld.renderer.three,t=new Ut(this.three,e);return t.smoothTime=.2,t.dollyToCursor=!0,t.infinityDolly=!0,t.minDistance=6,t}setupEvents(e){e?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:_p,Vector2:Ue,Vector3:O,Vector4:an,Quaternion:ct,Matrix4:de,Spherical:Lp,Box3:Me,Sphere:Zs,Raycaster:on,MathUtils:ln}}};const hf=class cf extends Tt{constructor(e){super(e),b(this,"onAfterUpdate",new pe),b(this,"onBeforeUpdate",new pe),b(this,"onDisposed",new pe),b(this,"onWorldCreated",new pe),b(this,"onWorldDeleted",new pe),b(this,"list",new Map),b(this,"enabled",!0),e.add(cf.uuid,this)}create(){const e=new Fg(this.components),t=e.uuid;if(this.list.has(t))throw new Error("There is already a world with this name!");return this.list.set(t,e),this.onWorldCreated.trigger(e),e}delete(e){if(!this.list.has(e.uuid))throw new Error("The provided world is not found in the list!");const t=e.uuid;this.list.delete(e.uuid),e.dispose(),this.onWorldDeleted.trigger(t)}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(e){if(this.enabled)for(const[t,s]of this.list)s.update(e)}};b(hf,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let bg=hf;function xg(h,e,t,s){return new Promise((i,n)=>{function r(){const o=h.clientWaitSync(e,t,0);if(o===h.WAIT_FAILED){n();return}if(o===h.TIMEOUT_EXPIRED){setTimeout(r,s);return}i()}r()})}async function Mg(h,e,t,s,i,n,r){const o=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),await xg(h,o,0,10),h.deleteSync(o),h.bindBuffer(e,t),h.getBufferSubData(e,s,i,n,r),h.bindBuffer(e,null)}async function _g(h,e,t,s,i,n,r,o){const a=h.createBuffer();return h.bindBuffer(h.PIXEL_PACK_BUFFER,a),h.bufferData(h.PIXEL_PACK_BUFFER,o.byteLength,h.STREAM_READ),h.readPixels(e,t,s,i,n,r,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null),await Mg(h,h.PIXEL_PACK_BUFFER,a,0,o),h.deleteBuffer(a),o}class Lg{constructor(e,t,s){if(b(this,"onDisposed",new pe),b(this,"onViewUpdated",new Ka),b(this,"enabled",!0),b(this,"needsUpdate",!1),b(this,"renderDebugFrame",!1),b(this,"components"),b(this,"world"),b(this,"renderer"),b(this,"autoUpdate",!0),b(this,"updateInterval",1e3),b(this,"worker"),b(this,"scene",new js),b(this,"_width",512),b(this,"_height",512),b(this,"_availableColor",1),b(this,"renderTarget"),b(this,"bufferSize"),b(this,"_buffer"),b(this,"_isWorkerBusy",!1),b(this,"updateVisibility",async r=>{if(!this.enabled||!this.needsUpdate&&!r||this._isWorkerBusy)return;this._isWorkerBusy=!0;const o=this.world.camera.three;o.updateMatrix(),this.renderer.setSize(this._width,this._height),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(this.scene,o);const a=this.renderer.getContext();await _g(a,0,0,this._width,this._height,a.RGBA,a.UNSIGNED_BYTE,this._buffer),this.renderer.setRenderTarget(null),this.renderDebugFrame&&this.renderer.render(this.scene,o),this.worker.postMessage({buffer:this._buffer}),this.needsUpdate=!1}),!t.renderer)throw new Error("The given world must have a renderer!");this.components=e,this.applySettings(s),this.world=t,this.renderer=new _i,this.renderTarget=new Ws(this._width,this._height),this.bufferSize=this._width*this._height*4,this._buffer=new Uint8Array(this.bufferSize),this.renderer.clippingPlanes=t.renderer.clippingPlanes;const i=`
      addEventListener("message", (event) => {
        const { buffer } = event.data;
        const colors = new Map();
        for (let i = 0; i < buffer.length; i += 4) {
          const r = buffer[i];
          const g = buffer[i + 1];
          const b = buffer[i + 2];
          const code = "" + r + "-" + g + "-" + b;
          if(colors.has(code)) {
            colors.set(code, colors.get(code) + 1);
          } else {
            colors.set(code, 1);
          }
        }
        postMessage({ colors });
      });
    `,n=new Blob([i],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(n))}dispose(){this.enabled=!1;for(const e of this.scene.children)e.removeFromParent();this.onViewUpdated.reset(),this.worker.terminate(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.renderTarget.dispose(),this._buffer=null,this.onDisposed.reset()}getAvailableColor(){let e=BigInt(this._availableColor.toString());const t=[];do t.unshift(Number(e%256n)),e/=256n;while(e);for(;t.length!==3;)t.unshift(0);const[s,i,n]=t,r=`${s}-${i}-${n}`;return{r:s,g:i,b:n,code:r}}increaseColor(){if(this._availableColor===256*256*256){console.warn("Color can't be increased over 256 x 256 x 256!");return}this._availableColor++}decreaseColor(){if(this._availableColor===1){console.warn("Color can't be decreased under 0!");return}this._availableColor--}applySettings(e){e&&(e.updateInterval!==void 0&&(this.updateInterval=e.updateInterval),e.height!==void 0&&(this._height=e.height),e.width!==void 0&&(this._width=e.width),e.autoUpdate!==void 0&&(this.autoUpdate=e.autoUpdate))}}let Ng=class extends Lg{constructor(e,t,s){super(e,t,s),b(this,"onViewUpdated",new pe),b(this,"threshold",100),b(this,"colorMeshes",new Map),b(this,"isProcessing",!1),b(this,"_colorCodeMeshMap",new Map),b(this,"_meshIDColorCodeMap",new Map),b(this,"_currentVisibleMeshes",new Set),b(this,"_recentlyHiddenMeshes",new Set),b(this,"_intervalID",null),b(this,"_transparentMat",new It({transparent:!0,opacity:0})),b(this,"handleWorkerMessage",async i=>{if(this.isProcessing)return;const n=i.data.colors;this._recentlyHiddenMeshes=new Set(this._currentVisibleMeshes),this._currentVisibleMeshes.clear();for(const[r,o]of n){if(o<this.threshold)continue;const a=this._colorCodeMeshMap.get(r);a&&(this._currentVisibleMeshes.add(a),this._recentlyHiddenMeshes.delete(a))}this.onViewUpdated.trigger({seen:this._currentVisibleMeshes,unseen:this._recentlyHiddenMeshes}),this._isWorkerBusy=!1}),this.worker.addEventListener("message",this.handleWorkerMessage),this.autoUpdate&&window.setInterval(async()=>{this.isProcessing||await this.updateVisibility()},this.updateInterval),this.onViewUpdated.add(({seen:i,unseen:n})=>{for(const r of i)r.visible=!0;for(const r of n)r.visible=!1})}dispose(){super.dispose(),this._intervalID!==null&&(window.clearInterval(this._intervalID),this._intervalID=null),this._currentVisibleMeshes.clear(),this._recentlyHiddenMeshes.clear(),this._meshIDColorCodeMap.clear(),this._transparentMat.dispose(),this._colorCodeMeshMap.clear();const e=this.components.get(sr);for(const t in this.colorMeshes){const s=this.colorMeshes.get(t);s&&e.destroy(s,!0)}this.colorMeshes.clear()}add(e){if(!this.enabled)return;if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const t=e instanceof Ot,{geometry:s,material:i}=e,{colorMaterial:n,code:r}=this.getAvailableMaterial();let o;if(Array.isArray(i)){let c=!0;const p=[];for(const u of i)Iu.isTransparent(u)?p.push(this._transparentMat):(c=!1,p.push(n));if(c){n.dispose(),this.isProcessing=!1;return}o=p}else if(Iu.isTransparent(i)){n.dispose(),this.isProcessing=!1;return}else o=n;this._colorCodeMeshMap.set(r,e),this._meshIDColorCodeMap.set(e.uuid,r);const a=t?e.count:1,l=new Ot(s,o,a);t?l.instanceMatrix=e.instanceMatrix:l.setMatrixAt(0,new de),e.visible=!1,e.updateWorldMatrix(!0,!1),l.applyMatrix4(e.matrixWorld),l.updateMatrix(),this.scene.add(l),this.colorMeshes.set(e.uuid,l),this.increaseColor(),this.isProcessing=!1}remove(e){if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const t=this.components.get(sr);this._currentVisibleMeshes.delete(e),this._recentlyHiddenMeshes.delete(e);const s=this.colorMeshes.get(e.uuid),i=this._meshIDColorCodeMap.get(e.uuid);if(!s||!i){this.isProcessing=!1;return}this._colorCodeMeshMap.delete(i),this._meshIDColorCodeMap.delete(e.uuid),this.colorMeshes.delete(e.uuid),s.geometry=void 0,s.material=[],t.destroy(s,!0),this._recentlyHiddenMeshes.delete(e),this._currentVisibleMeshes.delete(e),this.isProcessing=!1}updateInstanced(e){for(const t of e){const s=this.colorMeshes.get(t.uuid);s&&(s.count=t.count)}}getAvailableMaterial(){const{r:e,g:t,b:s,code:i}=this.getAvailableColor(),n=as.enabled;as.enabled=!1;const r=new ft(`rgb(${e}, ${t}, ${s})`);if(!this.world.renderer)throw new Error("Renderer not found in the world!");const o=this.world.renderer.clippingPlanes,a=new It({color:r,clippingPlanes:o,side:Qs});return as.enabled=n,{colorMaterial:a,code:i}}};const df=class mc extends Tt{constructor(e){super(e),b(this,"onDisposed",new pe),b(this,"_enabled",!0),b(this,"list",new Map),e.add(mc.uuid,this)}get enabled(){return this._enabled}set enabled(e){this._enabled=e;for(const[t,s]of this.list)s.enabled=e}create(e,t){if(this.list.has(e.uuid))return this.list.get(e.uuid);const s=new Ng(this.components,e,t);return this.list.set(e.uuid,s),s}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){this.enabled=!1,this.onDisposed.trigger(mc.uuid),this.onDisposed.reset();for(const[e,t]of this.list)t.dispose();this.list.clear()}updateInstanced(e){for(const[,t]of this.list)t.updateInstanced(e)}};b(df,"uuid","69f2a50d-c266-44fc-b1bd-fa4d34be89e6");let Dg=df,Ug=class{constructor(e){b(this,"_event"),b(this,"_position",new Ue),b(this,"onDisposed",new pe),b(this,"updateMouseInfo",t=>{this._event=t}),this.dom=e,this.setupEvents(!0)}get position(){if(this._event){const e=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(e,this._event),this._position.y=this.getPositionY(e,this._event)}return this._position}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}getPositionY(e,t){return-((t.clientY-e.top)/(e.bottom-e.top))*2+1}getPositionX(e,t){return(t.clientX-e.left)/(e.right-e.left)*2-1}setupEvents(e){e?this.dom.addEventListener("pointermove",this.updateMouseInfo):this.dom.removeEventListener("pointermove",this.updateMouseInfo)}};class Bg{constructor(e,t){b(this,"enabled",!0),b(this,"components"),b(this,"onDisposed",new pe),b(this,"mouse"),b(this,"three",new on),b(this,"world");const s=t.renderer;if(!s)throw new Error("A renderer is needed for the raycaster to work!");this.world=t,this.mouse=new Ug(s.three.domElement),this.components=e}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRay(e=Array.from(this.world.meshes)){if(!this.world)throw new Error("A world is needed to cast rays!");const t=this.world.camera.three;return this.three.setFromCamera(this.mouse.position,t),this.intersect(e)}castRayFromVector(e,t,s=Array.from(this.world.meshes)){return this.three.set(e,t),this.intersect(s)}intersect(e=Array.from(this.world.meshes)){const t=this.three.intersectObjects(e),s=this.filterClippingPlanes(t);return s.length>0?s[0]:null}filterClippingPlanes(e){if(!this.world.renderer)throw new Error("Renderer not found!");const t=this.world.renderer.three;if(!t.clippingPlanes)return e;const s=t.clippingPlanes;return e.length<=0||!s||(s==null?void 0:s.length)<=0?e:e.filter(i=>s.every(n=>n.distanceToPoint(i.point)>0))}}const uf=class pf extends Tt{constructor(e){super(e),b(this,"enabled",!0),b(this,"list",new Map),b(this,"onDisposed",new pe),e.add(pf.uuid,this)}get(e){if(this.list.has(e.uuid))return this.list.get(e.uuid);const t=new Bg(this.components,e);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}};b(uf,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let Su=uf,zg=class{constructor(e,t,s){b(this,"onDisposed",new pe),b(this,"world"),b(this,"components"),b(this,"three"),b(this,"_fade",3),b(this,"updateZoom",()=>{this.world.camera instanceof fc&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=t;const{color:i,size1:n,size2:r,distance:o}=s;this.components=e;const a=new hn(2,2,1,1),l=new Mt({side:Qs,uniforms:{uSize1:{value:n},uSize2:{value:r},uColor:{value:i},uDistance:{value:o},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new J(a,l),this.three.frustumCulled=!1,t.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(e){e?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(e){this._fade=e?3:0,this.material.uniforms.uFade.value=this._fade}dispose(){this.setupEvents(!1),this.components.get(sr).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(e){if(this.world.isDisposing||!(this.world.camera instanceof fc))return;const t=this.world.camera.controls;e?t.addEventListener("update",this.updateZoom):t.removeEventListener("update",this.updateZoom)}};const ff=class mf extends Tt{constructor(e){super(e),b(this,"list",new Map),b(this,"config",{color:new ft(12303291),size1:1,size2:10,distance:500}),b(this,"onDisposed",new pe),b(this,"enabled",!0),e.add(mf.uuid,this)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a grid!");const t=new zg(this.components,e,this.config);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}};b(ff,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");let HT=ff;const Zi=new on,Nt=new O,yi=new O,rt=new ct,Ou={X:new O(1,0,0),Y:new O(0,1,0),Z:new O(0,0,1)},xh={type:"change"},Pu={type:"mouseDown"},bu={type:"mouseUp",mode:null},xu={type:"objectChange"};class Yg extends Xs{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const s=new Xg;this._gizmo=s,this.add(s);const i=new Kg;this._plane=i,this.add(i);const n=this;function r(v,A){let C=A;Object.defineProperty(n,v,{get:function(){return C!==void 0?C:A},set:function(F){C!==F&&(C=F,i[v]=F,s[v]=F,n.dispatchEvent({type:v+"-changed",value:F}),n.dispatchEvent(xh))}}),n[v]=A,i[v]=A,s[v]=A}r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0);const o=new O,a=new O,l=new ct,c=new ct,p=new O,u=new ct,m=new O,E=new O,g=new O,T=0,y=new O;r("worldPosition",o),r("worldPositionStart",a),r("worldQuaternion",l),r("worldQuaternionStart",c),r("cameraPosition",p),r("cameraQuaternion",u),r("pointStart",m),r("pointEnd",E),r("rotationAxis",g),r("rotationAngle",T),r("eye",y),this._offset=new O,this._startNorm=new O,this._endNorm=new O,this._cameraScale=new O,this._parentPosition=new O,this._parentQuaternion=new ct,this._parentQuaternionInv=new ct,this._parentScale=new O,this._worldScaleStart=new O,this._worldQuaternionInv=new ct,this._worldScale=new O,this._positionStart=new O,this._quaternionStart=new ct,this._scaleStart=new O,this._getPointer=kg.bind(this),this._onPointerDown=Gg.bind(this),this._onPointerHover=Vg.bind(this),this._onPointerMove=Hg.bind(this),this._onPointerUp=Wg.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;Zi.setFromCamera(e,this.camera);const t=Mh(this._gizmo.picker[this.mode],Zi);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){Zi.setFromCamera(e,this.camera);const t=Mh(this._plane,Zi,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Pu.mode=this.mode,this.dispatchEvent(Pu)}}pointerMove(e){const t=this.axis,s=this.mode,i=this.object;let n=this.space;if(s==="scale"?n="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(n="world"),i===void 0||t===null||this.dragging===!1||e.button!==-1)return;Zi.setFromCamera(e,this.camera);const r=Mh(this._plane,Zi,!0);if(r){if(this.pointEnd.copy(r.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),n==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),n==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(n==="local"&&(i.position.applyQuaternion(rt.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),n==="world"&&(i.parent&&i.position.add(Nt.setFromMatrixPosition(i.parent.matrixWorld)),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(Nt.setFromMatrixPosition(i.parent.matrixWorld))));else if(s==="scale"){if(t.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),yi.set(o,o,o)}else Nt.copy(this.pointStart),yi.copy(this.pointEnd),Nt.applyQuaternion(this._worldQuaternionInv),yi.applyQuaternion(this._worldQuaternionInv),yi.divide(Nt),t.search("X")===-1&&(yi.x=1),t.search("Y")===-1&&(yi.y=1),t.search("Z")===-1&&(yi.z=1);i.scale.copy(this._scaleStart).multiply(yi),this.scaleSnap&&(t.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(Nt.setFromMatrixPosition(this.camera.matrixWorld));let a=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Nt.copy(this.rotationAxis).cross(this.eye))*o):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(Ou[t]),Nt.copy(Ou[t]),n==="local"&&Nt.applyQuaternion(this.worldQuaternion),Nt.cross(this.eye),Nt.length()===0?a=!0:this.rotationAngle=this._offset.dot(Nt.normalize())*o),(t==="E"||a)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),n==="local"&&t!=="E"&&t!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(rt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(rt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(xh),this.dispatchEvent(xu)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(bu.mode=this.mode,this.dispatchEvent(bu)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(xh),this.dispatchEvent(xu),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Zi}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function kg(h){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:h.button};{const e=this.domElement.getBoundingClientRect();return{x:(h.clientX-e.left)/e.width*2-1,y:-(h.clientY-e.top)/e.height*2+1,button:h.button}}}function Vg(h){if(this.enabled)switch(h.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(h));break}}function Gg(h){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(h.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(h)),this.pointerDown(this._getPointer(h)))}function Hg(h){this.enabled&&this.pointerMove(this._getPointer(h))}function Wg(h){this.enabled&&(this.domElement.releasePointerCapture(h.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(h)))}function Mh(h,e,t){const s=e.intersectObject(h,!0);for(let i=0;i<s.length;i++)if(s[i].object.visible||t)return s[i];return!1}const da=new Xc,qe=new O(0,1,0),Mu=new O(0,0,0),_u=new de,ua=new ct,ja=new ct,Ns=new O,Lu=new de,to=new O(1,0,0),$i=new O(0,1,0),so=new O(0,0,1),pa=new O,zr=new O,Yr=new O;class Xg extends Xs{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new It({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new qs({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const i=t.clone();i.opacity=.5;const n=e.clone();n.color.setHex(16711680);const r=e.clone();r.color.setHex(65280);const o=e.clone();o.color.setHex(255);const a=e.clone();a.color.setHex(16711680),a.opacity=.5;const l=e.clone();l.color.setHex(65280),l.opacity=.5;const c=e.clone();c.color.setHex(255),c.opacity=.5;const p=e.clone();p.opacity=.25;const u=e.clone();u.color.setHex(16776960),u.opacity=.25,e.clone().color.setHex(16776960);const m=e.clone();m.color.setHex(7895160);const E=new Ke(0,.04,.1,12);E.translate(0,.05,0);const g=new Be(.08,.08,.08);g.translate(0,.04,0);const T=new ze;T.setAttribute("position",new Li([0,0,0,1,0,0],3));const y=new Ke(.0075,.0075,.5,3);y.translate(0,.25,0);function v(ne,ue){const oe=new Gs(ne,.0075,3,64,ue*Math.PI*2);return oe.rotateY(Math.PI/2),oe.rotateX(Math.PI/2),oe}function A(){const ne=new ze;return ne.setAttribute("position",new Li([0,0,0,1,1,1],3)),ne}const C={X:[[new J(E,n),[.5,0,0],[0,0,-Math.PI/2]],[new J(E,n),[-.5,0,0],[0,0,Math.PI/2]],[new J(y,n),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new J(E,r),[0,.5,0]],[new J(E,r),[0,-.5,0],[Math.PI,0,0]],[new J(y,r)]],Z:[[new J(E,o),[0,0,.5],[Math.PI/2,0,0]],[new J(E,o),[0,0,-.5],[-Math.PI/2,0,0]],[new J(y,o),null,[Math.PI/2,0,0]]],XYZ:[[new J(new Pi(.1,0),p.clone()),[0,0,0]]],XY:[[new J(new Be(.15,.15,.01),c.clone()),[.15,.15,0]]],YZ:[[new J(new Be(.15,.15,.01),a.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new J(new Be(.15,.15,.01),l.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},F={X:[[new J(new Ke(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new J(new Ke(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new J(new Ke(.2,0,.6,4),s),[0,.3,0]],[new J(new Ke(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new J(new Ke(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new J(new Ke(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new J(new Pi(.2,0),s)]],XY:[[new J(new Be(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new J(new Be(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new J(new Be(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},M={START:[[new J(new Pi(.01,2),i),null,null,null,"helper"]],END:[[new J(new Pi(.01,2),i),null,null,null,"helper"]],DELTA:[[new je(A(),i),null,null,null,"helper"]],X:[[new je(T,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new je(T,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new je(T,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},_={XYZE:[[new J(v(.5,1),m),null,[0,Math.PI/2,0]]],X:[[new J(v(.5,.5),n)]],Y:[[new J(v(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new J(v(.5,.5),o),null,[0,Math.PI/2,0]]],E:[[new J(v(.75,1),u),null,[0,Math.PI/2,0]]]},L={AXIS:[[new je(T,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},D={XYZE:[[new J(new Hp(.25,10,8),s)]],X:[[new J(new Gs(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new J(new Gs(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new J(new Gs(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new J(new Gs(.75,.1,2,24),s)]]},B={X:[[new J(g,n),[.5,0,0],[0,0,-Math.PI/2]],[new J(y,n),[0,0,0],[0,0,-Math.PI/2]],[new J(g,n),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new J(g,r),[0,.5,0]],[new J(y,r)],[new J(g,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new J(g,o),[0,0,.5],[Math.PI/2,0,0]],[new J(y,o),[0,0,0],[Math.PI/2,0,0]],[new J(g,o),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new J(new Be(.15,.15,.01),c),[.15,.15,0]]],YZ:[[new J(new Be(.15,.15,.01),a),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new J(new Be(.15,.15,.01),l),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new J(new Be(.1,.1,.1),p.clone())]]},z={X:[[new J(new Ke(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new J(new Ke(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new J(new Ke(.2,0,.6,4),s),[0,.3,0]],[new J(new Ke(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new J(new Ke(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new J(new Ke(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new J(new Be(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new J(new Be(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new J(new Be(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new J(new Be(.2,.2,.2),s),[0,0,0]]]},V={X:[[new je(T,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new je(T,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new je(T,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function Q(ne){const ue=new Xs;for(const oe in ne)for(let Ie=ne[oe].length;Ie--;){const ce=ne[oe][Ie][0].clone(),ye=ne[oe][Ie][1],Ze=ne[oe][Ie][2],gt=ne[oe][Ie][3],Is=ne[oe][Ie][4];ce.name=oe,ce.tag=Is,ye&&ce.position.set(ye[0],ye[1],ye[2]),Ze&&ce.rotation.set(Ze[0],Ze[1],Ze[2]),gt&&ce.scale.set(gt[0],gt[1],gt[2]),ce.updateMatrix();const yt=ce.geometry.clone();yt.applyMatrix4(ce.matrix),ce.geometry=yt,ce.renderOrder=1/0,ce.position.set(0,0,0),ce.rotation.set(0,0,0),ce.scale.set(1,1,1),ue.add(ce)}return ue}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=Q(C)),this.add(this.gizmo.rotate=Q(_)),this.add(this.gizmo.scale=Q(B)),this.add(this.picker.translate=Q(F)),this.add(this.picker.rotate=Q(D)),this.add(this.picker.scale=Q(z)),this.add(this.helper.translate=Q(M)),this.add(this.helper.rotate=Q(L)),this.add(this.helper.scale=Q(V)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:ja;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let i=0;i<s.length;i++){const n=s[i];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);let r;if(this.camera.isOrthographicCamera?r=(this.camera.top-this.camera.bottom)/this.camera.zoom:r=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(r*this.size/4),n.tag==="helper"){n.visible=!1,n.name==="AXIS"?(n.visible=!!this.axis,this.axis==="X"&&(rt.setFromEuler(da.set(0,0,0)),n.quaternion.copy(t).multiply(rt),Math.abs(qe.copy(to).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Y"&&(rt.setFromEuler(da.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(rt),Math.abs(qe.copy($i).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Z"&&(rt.setFromEuler(da.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(rt),Math.abs(qe.copy(so).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="XYZE"&&(rt.setFromEuler(da.set(0,Math.PI/2,0)),qe.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(_u.lookAt(Mu,qe,$i)),n.quaternion.multiply(rt),n.visible=this.dragging),this.axis==="E"&&(n.visible=!1)):n.name==="START"?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):n.name==="END"?(n.position.copy(this.worldPosition),n.visible=this.dragging):n.name==="DELTA"?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),Nt.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Nt.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(Nt),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=this.axis.search(n.name)!==-1));continue}n.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(n.name==="X"&&Math.abs(qe.copy(to).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Y"&&Math.abs(qe.copy($i).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Z"&&Math.abs(qe.copy(so).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XY"&&Math.abs(qe.copy(so).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="YZ"&&Math.abs(qe.copy(to).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XZ"&&Math.abs(qe.copy($i).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)):this.mode==="rotate"&&(ua.copy(t),qe.copy(this.eye).applyQuaternion(rt.copy(t).invert()),n.name.search("E")!==-1&&n.quaternion.setFromRotationMatrix(_u.lookAt(this.eye,Mu,$i)),n.name==="X"&&(rt.setFromAxisAngle(to,Math.atan2(-qe.y,qe.z)),rt.multiplyQuaternions(ua,rt),n.quaternion.copy(rt)),n.name==="Y"&&(rt.setFromAxisAngle($i,Math.atan2(qe.x,qe.z)),rt.multiplyQuaternions(ua,rt),n.quaternion.copy(rt)),n.name==="Z"&&(rt.setFromAxisAngle(so,Math.atan2(qe.y,qe.x)),rt.multiplyQuaternions(ua,rt),n.quaternion.copy(rt))),n.visible=n.visible&&(n.name.indexOf("X")===-1||this.showX),n.visible=n.visible&&(n.name.indexOf("Y")===-1||this.showY),n.visible=n.visible&&(n.name.indexOf("Z")===-1||this.showZ),n.visible=n.visible&&(n.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled&&this.axis&&(n.name===this.axis||this.axis.split("").some(function(o){return n.name===o}))&&(n.material.color.setHex(16776960),n.material.opacity=1)}super.updateMatrixWorld(e)}}class Kg extends J{constructor(){super(new hn(1e5,1e5,2,2),new It({visible:!1,wireframe:!0,side:Qs,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),pa.copy(to).applyQuaternion(t==="local"?this.worldQuaternion:ja),zr.copy($i).applyQuaternion(t==="local"?this.worldQuaternion:ja),Yr.copy(so).applyQuaternion(t==="local"?this.worldQuaternion:ja),qe.copy(zr),this.mode){case"translate":case"scale":switch(this.axis){case"X":qe.copy(this.eye).cross(pa),Ns.copy(pa).cross(qe);break;case"Y":qe.copy(this.eye).cross(zr),Ns.copy(zr).cross(qe);break;case"Z":qe.copy(this.eye).cross(Yr),Ns.copy(Yr).cross(qe);break;case"XY":Ns.copy(Yr);break;case"YZ":Ns.copy(pa);break;case"XZ":qe.copy(Yr),Ns.copy(zr);break;case"XYZ":case"E":Ns.set(0,0,0);break}break;case"rotate":default:Ns.set(0,0,0)}Ns.length()===0?this.quaternion.copy(this.cameraQuaternion):(Lu.lookAt(Nt.set(0,0,0),Ns,qe),this.quaternion.setFromRotationMatrix(Lu)),super.updateMatrixWorld(e)}}class rd{constructor(e,t,s,i,n,r=5,o=!0){if(b(this,"onDraggingStarted",new pe),b(this,"onDraggingEnded",new pe),b(this,"onDisposed",new pe),b(this,"normal"),b(this,"origin"),b(this,"three",new jt),b(this,"components"),b(this,"world"),b(this,"type","default"),b(this,"_helper"),b(this,"_visible",!0),b(this,"_enabled",!0),b(this,"_controlsActive",!1),b(this,"_arrowBoundBox",new J),b(this,"_planeMesh"),b(this,"_controls"),b(this,"_hiddenMaterial",new It({visible:!1})),b(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),b(this,"changeDrag",a=>{this._visible=!a.value,this.preventCameraMovement(),this.notifyDraggingChanged(a)}),this.components=e,this.world=t,!t.renderer)throw new Error("The given world must have a renderer!");this.normal=i,this.origin=s,t.renderer.setPlane(!0,this.three),this._planeMesh=rd.newPlaneMesh(r,n),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(i,s),o&&this.toggleControls(!0)}get enabled(){return this._enabled}set enabled(e){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=e,this.world.renderer.setPlane(e,this.three)}get visible(){return this._visible}set visible(e){this._visible=e,this._controls.visible=e,this._helper.visible=e,this.toggleControls(e)}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(e){this._planeMesh.material=e}get size(){return this._planeMesh.scale.x}set size(e){this._planeMesh.scale.set(e,e,e)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(e,t){this.reset(),this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const e=new O(1,0,0),t=new O;this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix()}toggleControls(e){if(e){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=e}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const e=this.world.camera.three,t=this.world.renderer.three.domElement,s=new Yg(e,t);return this.initializeControls(s),this.world.scene.three.add(s),s}initializeControls(e){e.attach(this._helper),e.showX=!1,e.showY=!1,e.setSpace("local"),this.createArrowBoundingBox(),e.children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new Ke(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(e){e.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const e=new Xs;return e.lookAt(this.normal),e.position.copy(this.origin),this._planeMesh.position.z+=.01,e.add(this._planeMesh),this.world.scene.three.add(e),e}static newPlaneMesh(e,t){const s=new hn(1),i=new J(s,t);return i.scale.set(e,e,e),i}}const Ef=class Ec extends Tt{constructor(e){super(e),b(this,"onBeforeDrag",new pe),b(this,"onAfterDrag",new pe),b(this,"onBeforeCreate",new pe),b(this,"onBeforeCancel",new pe),b(this,"onAfterCancel",new pe),b(this,"onBeforeDelete",new pe),b(this,"onAfterCreate",new pe),b(this,"onAfterDelete",new pe),b(this,"onDisposed",new pe),b(this,"orthogonalY",!1),b(this,"toleranceOrthogonalY",.7),b(this,"Type",rd),b(this,"list",[]),b(this,"_material",new It({color:12255487,side:Qs,transparent:!0,opacity:.2})),b(this,"_size",5),b(this,"_enabled",!1),b(this,"_visible",!0),b(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),b(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(Ec.uuid,this)}get enabled(){return this._enabled}set enabled(e){this._enabled=e;for(const t of this.list)t.enabled=e;this.updateMaterialsAndPlanes()}get visible(){return this._visible}set visible(e){this._visible=e;for(const t of this.list)t.visible=e}get material(){return this._material}set material(e){this._material=e;for(const t of this.list)t.planeMaterial=e}get size(){return this._size}set size(e){this._size=e;for(const t of this.list)t.size=e}dispose(){this._enabled=!1;for(const e of this.list)e.dispose();this.list.length=0,this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(Ec.uuid),this.onDisposed.reset()}create(e){const t=this.components.get(Su).get(e).castRay();return t?this.createPlaneFromIntersection(e,t):null}createFromNormalAndCoplanarPoint(e,t,s){const i=this.newPlane(e,s,t);return this.updateMaterialsAndPlanes(),i}delete(e,t){t||(t=this.pickPlane(e)),t&&this.deletePlane(t)}deleteAll(e){const t=[...this.list];for(const s of t)if(!e||e.has(s.type)){this.delete(s.world,s);const i=this.list.indexOf(s);i!==-1&&this.list.splice(i,1)}}deletePlane(e){const t=this.list.indexOf(e);if(t!==-1){if(this.list.splice(t,1),!e.world.renderer)throw new Error("Renderer not found for this plane's world!");e.world.renderer.setPlane(!1,e.three),e.dispose(),this.updateMaterialsAndPlanes(),this.onAfterDelete.trigger(e)}}pickPlane(e){const t=this.components.get(Su).get(e),s=this.getAllPlaneMeshes(),i=t.castRay(s);if(i){const n=i.object;return this.list.find(r=>r.meshes.includes(n))}}getAllPlaneMeshes(){const e=[];for(const t of this.list)e.push(...t.meshes);return e}createPlaneFromIntersection(e,t){var s;if(!e.renderer)throw new Error("The given world must have a renderer!");const i=t.point.distanceTo(new O(0,0,0)),n=(s=t.face)==null?void 0:s.normal;if(!i||!n)return null;const r=this.getWorldNormal(t,n),o=this.newPlane(e,t.point,r.negate());return o.visible=this._visible,o.size=this._size,e.renderer.setPlane(!0,o.three),this.updateMaterialsAndPlanes(),o}getWorldNormal(e,t){const s=e.object;let i=e.object.matrixWorld.clone();if(s instanceof Ot&&e.instanceId!==void 0){const o=new de;s.getMatrixAt(e.instanceId,o),i=o.multiply(i)}const n=new Kt().getNormalMatrix(i),r=t.clone().applyMatrix3(n).normalize();return this.normalizePlaneDirectionY(r),r}normalizePlaneDirectionY(e){this.orthogonalY&&(e.y>this.toleranceOrthogonalY&&(e.x=0,e.y=1,e.z=0),e.y<-this.toleranceOrthogonalY&&(e.x=0,e.y=-1,e.z=0))}newPlane(e,t,s){const i=new this.Type(this.components,e,t,s,this._material);return i.onDraggingStarted.add(this._onStartDragging),i.onDraggingEnded.add(this._onEndDragging),this.list.push(i),this.onAfterCreate.trigger(i),i}updateMaterialsAndPlanes(){const e=this.components.get(bg);for(const[t,s]of e.list){if(!s.renderer)continue;s.renderer.updateClippingPlanes();const{clippingPlanes:i}=s.renderer;for(const n of s.meshes)if(n.material)if(Array.isArray(n.material))for(const r of n.material)r.clippingPlanes=i;else n.material.clippingPlanes=i}}};b(Ef,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let WT=Ef,Zg=class{constructor(e){if(b(this,"onDisposed",new pe),b(this,"onAfterUpdate",new pe),b(this,"onBeforeUpdate",new pe),b(this,"onResize",new pe),b(this,"frontOffset",0),b(this,"overrideMaterial",new Qc),b(this,"backgroundColor",new ft(395274)),b(this,"renderer"),b(this,"enabled",!0),b(this,"world"),b(this,"_lockRotation",!0),b(this,"_camera"),b(this,"_plane"),b(this,"_size",new Ue(320,160)),b(this,"_tempVector1",new O),b(this,"_tempVector2",new O),b(this,"_tempTarget",new O),b(this,"down",new O(0,-1,0)),b(this,"updatePlanes",()=>{if(!this.world.renderer)throw new Error("The given world must have a renderer!");const i=[],n=this.world.renderer.three;for(const r of n.clippingPlanes)i.push(r);i.push(this._plane),this.renderer.clippingPlanes=i}),this.world=e,!this.world.renderer)throw new Error("The given world must have a renderer!");this.renderer=new _i,this.renderer.setSize(this._size.x,this._size.y);const t=1,s=this._size.x/this._size.y;this._camera=new di(t*s/-2,t*s/2,t/2,t/-2),this.world.renderer.onClippingPlanesUpdated.add(this.updatePlanes),this._camera.position.set(0,200,0),this._camera.zoom=.1,this._camera.rotation.x=-Math.PI/2,this._plane=new jt(this.down,200),this.updatePlanes()}get lockRotation(){return this._lockRotation}set lockRotation(e){this._lockRotation=e,e&&(this._camera.rotation.z=0)}get zoom(){return this._camera.zoom}set zoom(e){this._camera.zoom=e,this._camera.updateProjectionMatrix()}dispose(){this.enabled=!1,this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.onResize.reset(),this.overrideMaterial.dispose(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get(){return this._camera}update(){if(!this.enabled)return;this.onBeforeUpdate.trigger();const e=this.world.scene.three,t=this.world.camera;if(!t.hasCameraControls())throw new Error("The given world must use camera controls!");if(!(e instanceof js))throw new Error("The given world must have a THREE.Scene as a root!");const s=t.controls;if(s.getPosition(this._tempVector1),this._camera.position.x=this._tempVector1.x,this._camera.position.z=this._tempVector1.z,this.frontOffset!==0&&(s.getTarget(this._tempVector2),this._tempVector2.sub(this._tempVector1),this._tempVector2.normalize().multiplyScalar(this.frontOffset),this._camera.position.x+=this._tempVector2.x,this._camera.position.z+=this._tempVector2.z),!this._lockRotation){s.getTarget(this._tempTarget);const n=Math.atan2(this._tempTarget.x-this._tempVector1.x,this._tempTarget.z-this._tempVector1.z);this._camera.rotation.z=n+Math.PI}this._plane.set(this.down,this._tempVector1.y);const i=e.background;e.background=this.backgroundColor,this.renderer.render(e,this._camera),e.background=i,this.onAfterUpdate.trigger()}getSize(){return this._size}resize(e=this._size){this._size.copy(e),this.renderer.setSize(e.x,e.y);const t=e.x/e.y,s=1;this._camera.left=s*t/-2,this._camera.right=s*t/2,this._camera.top=s/2,this._camera.bottom=-s/2,this._camera.updateProjectionMatrix(),this.onResize.trigger(e)}};const jg=class gf extends Tt{constructor(e){super(e),b(this,"onAfterUpdate",new pe),b(this,"onBeforeUpdate",new pe),b(this,"onDisposed",new pe),b(this,"enabled",!0),b(this,"list",new Map),this.components.add(gf.uuid,this)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a minimap!");const t=new Zg(e);return this.list.set(e.uuid,t),t}delete(e){const t=this.list.get(e);t&&t.dispose(),this.list.delete(e)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(){for(const[e,t]of this.list)t.update()}};b(jg,"uuid","39ad6aad-84c8-4adf-a1e0-7f25313a9e7f");let Qg=class{constructor(e){b(this,"enabled",!1),b(this,"id","FirstPerson"),this.camera=e}set(e){if(this.enabled=e,e){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const e=this.camera.controls,t=new O;e.distance--,e.getPosition(t),e.minDistance=1,e.maxDistance=1,e.distance=1,e.moveTo(t.x,t.y,t.z),e.truckSpeed=50,e.mouseButtons.wheel=Ut.ACTION.DOLLY,e.touches.two=Ut.ACTION.TOUCH_ZOOM_TRUCK}},qg=class{constructor(e){b(this,"enabled",!0),b(this,"id","Orbit"),this.camera=e,this.activateOrbitControls()}set(e){this.enabled=e,e&&this.activateOrbitControls()}activateOrbitControls(){const e=this.camera.controls;e.minDistance=1,e.maxDistance=300;const t=new O;e.getPosition(t);const s=t.length();e.distance=s,e.truckSpeed=2;const{rotation:i}=this.camera.three,n=new O(0,0,-1).applyEuler(i),r=t.addScaledVector(n,s);e.moveTo(r.x,r.y,r.z)}},Jg=class{constructor(e){b(this,"enabled",!1),b(this,"id","Plan"),b(this,"mouseAction1"),b(this,"mouseAction2"),b(this,"mouseInitialized",!1),b(this,"defaultAzimuthSpeed"),b(this,"defaultPolarSpeed"),this.camera=e,this.defaultAzimuthSpeed=e.controls.azimuthRotateSpeed,this.defaultPolarSpeed=e.controls.polarRotateSpeed}set(e){this.enabled=e;const t=this.camera.controls;t.azimuthRotateSpeed=e?0:this.defaultAzimuthSpeed,t.polarRotateSpeed=e?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=t.touches.one,this.mouseAction2=t.touches.two,this.mouseInitialized=!0),e?(t.mouseButtons.left=Ut.ACTION.TRUCK,t.touches.one=Ut.ACTION.TOUCH_TRUCK,t.touches.two=Ut.ACTION.TOUCH_ZOOM):(t.mouseButtons.left=Ut.ACTION.ROTATE,t.touches.one=this.mouseAction1,t.touches.two=this.mouseAction2)}},$g=class{constructor(e){b(this,"onChanged",new pe),b(this,"current","Perspective"),b(this,"camera"),b(this,"matchOrthoDistanceEnabled",!1),b(this,"_component"),b(this,"_previousDistance",-1),this._component=e,this.camera=e.three}async set(e){this.current!==e&&(e==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const e=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(e)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const e=this.getPerspectiveDims();if(!e)return;const{width:t,height:s}=e;this.setupOrthoCamera(s,t),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const e=this._component.currentWorld;if(!e||!e.renderer)return null;const t=new O;this._component.threePersp.getWorldDirection(t);const s=new O;this._component.controls.getTarget(s);const i=s.clone().sub(this._component.threePersp.position).dot(t),n=e.renderer.getSize(),r=n.x/n.y,o=this._component.threePersp,a=i*2*Math.atan(o.fov*(Math.PI/180)/2);return{width:a*r,height:a}}setupOrthoCamera(e,t){this._component.controls.mouseButtons.wheel=Ut.ACTION.ZOOM,this._component.controls.mouseButtons.middle=Ut.ACTION.ZOOM;const s=this._component.threePersp,i=this._component.threeOrtho;i.zoom=1,i.left=t/-2,i.right=t/2,i.top=e/2,i.bottom=e/-2,i.updateProjectionMatrix(),i.position.copy(s.position),i.quaternion.copy(s.quaternion),this._component.controls.camera=i}getDistance(){const e=this._component.threePersp,t=this._component.threeOrtho;return(t.top-t.bottom)/t.zoom/(2*Math.atan(e.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=Ut.ACTION.DOLLY,this._component.controls.mouseButtons.middle=Ut.ACTION.DOLLY;const e=this._component.threePersp,t=this._component.threeOrtho;e.position.copy(t.position),e.quaternion.copy(t.quaternion),this._component.controls.mouseButtons.wheel=Ut.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),e.updateProjectionMatrix(),this._component.controls.camera=e,this.camera=e,this.current="Perspective"}},qT=class extends fc{constructor(e){super(e),b(this,"projection"),b(this,"threeOrtho"),b(this,"threePersp"),b(this,"_userInputButtons",{}),b(this,"_frustumSize",50),b(this,"_navigationModes",new Map),b(this,"_mode",null),b(this,"previousSize",null),this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new $g(this),this.onAspectUpdated.add(()=>{this.setOrthoPerspCameraAspect()}),this.projection.onChanged.add(t=>{this.three=t,this.updateAspect()}),this.onWorldChanged.add(({action:t})=>{t==="added"&&(this._navigationModes.clear(),this._navigationModes.set("Orbit",new qg(this)),this._navigationModes.set("FirstPerson",new Qg(this)),this._navigationModes.set("Plan",new Jg(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0}),this.currentWorld&&this.currentWorld.renderer&&(this.previousSize=this.currentWorld.renderer.getSize().clone()))})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(e){if(this.mode!==null&&this.mode.id!==e){if(this.mode.set(!1),!this._navigationModes.has(e))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(e),this.mode.set(!0)}}async fit(e,t=1.5){if(!this.enabled)return;const s=Number.MAX_VALUE,i=Number.MIN_VALUE,n=new O(s,s,s),r=new O(i,i,i);for(const u of e){const m=new Me().setFromObject(u);m.min.x<n.x&&(n.x=m.min.x),m.min.y<n.y&&(n.y=m.min.y),m.min.z<n.z&&(n.z=m.min.z),m.max.x>r.x&&(r.x=m.max.x),m.max.y>r.y&&(r.y=m.max.y),m.max.z>r.z&&(r.z=m.max.z)}const o=new Me(n,r),a=new O;o.getSize(a);const l=new O;o.getCenter(l);const c=Math.max(a.x,a.y,a.z)*t,p=new Zs(l,c);await this.controls.fitToSphere(p,!0)}setUserInput(e){e?this.enableUserInput():this.disableUserInput()}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const e=window.innerWidth/window.innerHeight;return new di(this._frustumSize*e/-2,this._frustumSize*e/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoPerspCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer||!this.previousSize)return;const e=this.currentWorld.renderer.getSize(),t=this.threeOrtho.top,s=this.threeOrtho.right,i=e.y/this.previousSize.y,n=e.x/this.previousSize.x,r=t*i,o=s*n;this.threeOrtho.left=-o,this.threeOrtho.right=o,this.threeOrtho.top=r,this.threeOrtho.bottom=-r,this.threeOrtho.updateProjectionMatrix(),this.previousSize.copy(e)}};const eI=new Map([[ir,{forRelated:"Decomposes",forRelating:"IsDecomposedBy"}],[ll,{forRelated:"HasAssociations",forRelating:"AssociatedTo"}],[hl,{forRelated:"HasAssociations",forRelating:"ClassificationForObjects"}],[cl,{forRelated:"HasAssignments",forRelating:"IsGroupedBy"}],[nr,{forRelated:"IsDefinedBy",forRelating:"DefinesOcurrence"}],[dl,{forRelated:"IsTypedBy",forRelating:"Types"}],[ul,{forRelated:"IsDefinedBy",forRelating:"Defines"}],[rr,{forRelated:"ContainedInStructure",forRelating:"ContainsElements"}],[pl,{forRelated:"AssignedToFlowElement",forRelating:"HasControlElements"}],[fl,{forRelated:"ConnectedFrom",forRelating:"ConnectedTo"}],[ml,{forRelated:"HasAssignments",forRelating:"ReferencedBy"}],[El,{forRelated:"HasContext",forRelating:"Declares"}],[gl,{forRelated:"HasAssignments",forRelating:"Controls"}],[Il,{forRelated:"Nests",forRelating:"IsNestedBy"}]]),If=class gc extends Tt{constructor(e){super(e),b(this,"onDisposed",new pe),b(this,"onRelationsIndexed",new pe),b(this,"relationMaps",{}),b(this,"enabled",!0),b(this,"_relToAttributesMap",eI),b(this,"_inverseAttributes",["IsDecomposedBy","Decomposes","AssociatedTo","HasAssociations","ClassificationForObjects","IsGroupedBy","HasAssignments","IsDefinedBy","DefinesOcurrence","IsTypedBy","Types","Defines","ContainedInStructure","ContainsElements","HasControlElements","AssignedToFlowElement","ConnectedTo","ConnectedFrom","ReferencedBy","Declares","HasContext","Controls","IsNestedBy","Nests"]),b(this,"_ifcRels",[ir,ll,hl,cl,nr,dl,ul,rr,pl,fl,ml,El,gl,Il]),b(this,"onFragmentsDisposed",t=>{delete this.relationMaps[t.groupID]}),this.components.add(gc.uuid,this),e.get(ls).onFragmentsDisposed.add(this.onFragmentsDisposed)}indexRelations(e,t,s,i){const n=Object.keys(t).find(p=>p.startsWith("Relating")),r=Object.keys(t).find(p=>p.startsWith("Related"));if(!(n&&r))return;const o=t[n].value,a=t[r].map(p=>p.value),l=e.get(o)??new Map,c=this.getAttributeIndex(i);c!==null&&(l.set(c,a),e.set(o,l));for(const p of a){const u=e.get(p)??new Map,m=this.getAttributeIndex(s);if(!m)continue;const E=u.get(m)??[];E.push(o),u.set(m,E),e.set(p,u)}}getAttributeIndex(e){const t=this._inverseAttributes.indexOf(e);return t===-1?null:t}setRelationMap(e,t){this.relationMaps[e.uuid]=t,this.onRelationsIndexed.trigger({modelID:e.uuid,relationsMap:t})}async process(e){if(!e.hasProperties)throw new Error("FragmentsGroup properties not found");let t=this.relationMaps[e.uuid];if(t)return t;t=new Map;for(const s of this._ifcRels){const i=await e.getAllPropertiesOfType(s);if(!i)continue;const n=this._relToAttributesMap.get(s);if(!n)continue;const{forRelated:r,forRelating:o}=n;for(const a in i){const l=i[a];this.indexRelations(t,l,r,o)}}return this.setRelationMap(e,t),t}async processFromWebIfc(e,t){const s=new Map;for(const i of this._ifcRels){const n=this._relToAttributesMap.get(i);if(!n)continue;const{forRelated:r,forRelating:o}=n,a=e.GetLineIDsWithType(t,i);for(let l=0;l<a.size();l++){const c=await e.properties.getItemProperties(t,a.get(l));this.indexRelations(s,c,r,o)}}return this.onRelationsIndexed.trigger({modelID:t.toString(),relationsMap:s}),s}getEntityRelations(e,t,s){const i=this.relationMaps[e.uuid];if(!i)throw new Error(`IfcRelationsIndexer: model ${e.uuid} has no relations indexed.`);const n=i.get(t),r=this.getAttributeIndex(s);return n===void 0||r===null?null:n.get(r)||null}serializeRelations(e){const t={};for(const[s,i]of e.entries()){t[s]||(t[s]={});for(const[n,r]of i.entries())t[s][n]=r}return JSON.stringify(t)}serializeModelRelations(e){const t=this.relationMaps[e.uuid];return t?this.serializeRelations(t):null}serializeAllRelations(){const e={};for(const t in this.relationMaps){const s=this.relationMaps[t],i={};for(const[n,r]of s.entries()){i[n]||(i[n]={});for(const[o,a]of r.entries())i[n][o]=a}e[t]=i}return JSON.stringify(e)}getRelationsMapFromJSON(e){const t=JSON.parse(e),s=new Map;for(const i in t){const n=t[i],r=new Map;for(const o in n)r.set(Number(o),n[o]);s.set(Number(i),r)}return s}dispose(){this.relationMaps={},this.components.get(ls).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(gc.uuid),this.onDisposed.reset()}getEntitiesWithRelation(e,t,s){const i=this.relationMaps[e.uuid];if(!i)throw new Error("IfcRelationsIndexer: the model relations are not indexed!");const n=new Set;for(const[r,o]of i){const a=this.getAttributeIndex(t);if(a===null)throw new Error("IfcRelationsIndexer: invalid inverse attribute name");const l=o.get(a);l&&l.includes(s)&&n.add(r)}return n}addEntityRelations(e,t,s,...i){const n=this.getEntityRelations(e,t,s);if(n)n.push(...i);else{const r=this.getAttributeIndex(s);if(!r)throw new Error(`IfcRelationsIndexer: ${s} is not a valid relation name.`);const o=this.relationMaps[e.uuid].get(t);o==null||o.set(r,i)}}getEntityChildren(e,t,s=new Set){if(s.add(t),this.relationMaps[e.uuid]===void 0)throw new Error("The provided model has no indices. You have to generate them first.");const i=this.getEntityRelations(e,t,"IsDecomposedBy");if(i)for(const r of i)this.getEntityChildren(e,r,s);const n=this.getEntityRelations(e,t,"ContainsElements");if(n)for(const r of n)this.getEntityChildren(e,r,s);return s}};b(If,"uuid","23a889ab-83b3-44a4-8bee-ead83438370b");let Rl=If;const Cf=class Tf extends Tt{constructor(e){super(e),b(this,"onDisposed",new pe),b(this,"onFragmentsLoaded",new pe),b(this,"onFragmentsDisposed",new pe),b(this,"list",new fu),b(this,"groups",new fu),b(this,"baseCoordinationModel",""),b(this,"baseCoordinationMatrix",new de),b(this,"enabled",!0),b(this,"_loader",new Cl),this.components.add(Tf.uuid,this)}get meshes(){const e=[];for(const[t,s]of this.list)e.push(s.mesh);return e}dispose(){for(const[e,t]of this.groups)t.dispose(!0);this.baseCoordinationModel="",this.groups.clear(),this.list.clear(),this.onFragmentsLoaded.reset(),this.onFragmentsDisposed.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}disposeGroup(e){const{uuid:t}=e,s=[];for(const i of e.items)s.push(i.id),this.list.delete(i.id);e.dispose(!0),this.groups.delete(e.uuid),this.onFragmentsDisposed.trigger({groupID:t,fragmentIDs:s})}load(e,t){const s={coordinate:!0,...t},{coordinate:i,name:n,properties:r,relationsMap:o}=s,a=this._loader.import(e);t&&(a.isStreamed=t.isStreamed||!1),n&&(a.name=n);for(const l of a.items)l.group=a,this.list.set(l.id,l);return i&&this.coordinate([a]),this.groups.set(a.uuid,a),r&&a.setLocalProperties(r),o&&this.components.get(Rl).setRelationMap(a,o),this.onFragmentsLoaded.trigger(a),a}export(e){return this._loader.export(e)}getModelIdMap(e){const t={};for(const s in e){const i=this.list.get(s);if(!(i&&i.group))continue;const n=i.group;n.uuid in t||(t[n.uuid]=new Set);const r=e[s];for(const o of r)t[n.uuid].add(o)}return t}modelIdToFragmentIdMap(e){let t={};for(const s in e){const i=this.groups.get(s);if(!i)continue;const n=e[s],r=i.getFragmentMap(n);t={...t,...r}}return t}coordinate(e=Array.from(this.groups.values())){if(this.baseCoordinationModel.length===0){const t=e.pop();if(!t)return;this.baseCoordinationModel=t.uuid,this.baseCoordinationMatrix=t.coordinationMatrix.clone()}if(e.length)for(const t of e)t.coordinationMatrix.equals(this.baseCoordinationMatrix)||(t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1),t.updateMatrix(),this.applyBaseCoordinateSystem(t,t.coordinationMatrix))}applyBaseCoordinateSystem(e,t){e.applyMatrix4(t.clone().invert()),e.applyMatrix4(this.baseCoordinationMatrix)}clone(e,t){const s=e.cloneGroup(t);this.groups.set(s.uuid,s);for(const i of s.items)this.list.set(i.id,i);return s}};b(Cf,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let ls=Cf;const tI=class ni extends Tt{constructor(e){super(e),b(this,"enabled",!0),b(this,"onDisposed",new pe),b(this,"_absoluteMin"),b(this,"_absoluteMax"),b(this,"_meshes",[]),this.components.add(ni.uuid,this),this._absoluteMin=ni.newBound(!0),this._absoluteMax=ni.newBound(!1)}static getDimensions(e){const{min:t,max:s}=e,i=Math.abs(s.x-t.x),n=Math.abs(s.y-t.y),r=Math.abs(s.z-t.z),o=new O;return o.subVectors(s,t).divideScalar(2).add(t),{width:i,height:n,depth:r,center:o}}static newBound(e){const t=e?1:-1;return new O(t*Number.MAX_VALUE,t*Number.MAX_VALUE,t*Number.MAX_VALUE)}static getBounds(e,t,s){const i=s||this.newBound(!1),n=t||this.newBound(!0);for(const r of e)r.x<n.x&&(n.x=r.x),r.y<n.y&&(n.y=r.y),r.z<n.z&&(n.z=r.z),r.x>i.x&&(i.x=r.x),r.y>i.y&&(i.y=r.y),r.z>i.z&&(i.z=r.z);return new Me(t,s)}dispose(){const e=this.components.get(sr);for(const t of this._meshes)e.destroy(t);this._meshes=[],this.onDisposed.trigger(ni.uuid),this.onDisposed.reset()}get(){const e=this._absoluteMin.clone(),t=this._absoluteMax.clone();return new Me(e,t)}getSphere(){const e=this._absoluteMin.clone(),t=this._absoluteMax.clone(),s=Math.abs((t.x-e.x)/2),i=Math.abs((t.y-e.y)/2),n=Math.abs((t.z-e.z)/2),r=new O(e.x+s,e.y+i,e.z+n),o=r.distanceTo(e);return new Zs(r,o)}getMesh(){const e=new Me(this._absoluteMin,this._absoluteMax),t=ni.getDimensions(e),{width:s,height:i,depth:n,center:r}=t,o=new Be(s,i,n),a=new J(o);return this._meshes.push(a),a.position.copy(r),a}reset(){this._absoluteMin=ni.newBound(!0),this._absoluteMax=ni.newBound(!1)}add(e){for(const t of e.items)this.addMesh(t.mesh)}addMesh(e,t){if(!e.geometry.index)return;const s=ni.getFragmentBounds(e);e.updateMatrixWorld();const i=e.matrixWorld,n=new de,r=e instanceof Ot,o=new Set;if(e instanceof Zc){t||(t=e.fragment.ids);for(const a of t){const l=e.fragment.getInstancesIDs(a);if(l)for(const c of l)o.add(c)}}else o.add(0);for(const a of o){const l=s.min.clone(),c=s.max.clone();r&&(e.getMatrixAt(a,n),l.applyMatrix4(n),c.applyMatrix4(n)),l.applyMatrix4(i),c.applyMatrix4(i),l.x<this._absoluteMin.x&&(this._absoluteMin.x=l.x),l.y<this._absoluteMin.y&&(this._absoluteMin.y=l.y),l.z<this._absoluteMin.z&&(this._absoluteMin.z=l.z),l.x>this._absoluteMax.x&&(this._absoluteMax.x=l.x),l.y>this._absoluteMax.y&&(this._absoluteMax.y=l.y),l.z>this._absoluteMax.z&&(this._absoluteMax.z=l.z),c.x>this._absoluteMax.x&&(this._absoluteMax.x=c.x),c.y>this._absoluteMax.y&&(this._absoluteMax.y=c.y),c.z>this._absoluteMax.z&&(this._absoluteMax.z=c.z),c.x<this._absoluteMin.x&&(this._absoluteMin.x=c.x),c.y<this._absoluteMin.y&&(this._absoluteMin.y=c.y),c.z<this._absoluteMin.z&&(this._absoluteMin.z=c.z)}}addFragmentIdMap(e){const t=this.components.get(ls);for(const s in e){const i=t.list.get(s);if(!i)continue;const n=e[s];this.addMesh(i.mesh,n)}}static getFragmentBounds(e){const t=e.geometry.attributes.position,s=Number.MAX_VALUE,i=-s,n=new O(s,s,s),r=new O(i,i,i);if(!e.geometry.index)throw new Error("Geometry must be indexed!");const o=Array.from(e.geometry.index.array);for(let a=0;a<o.length;a++){if(a%3===0&&o[a]===0&&o[a+1]===0&&o[a+2]===0){a+=2;continue}const l=o[a],c=t.getX(l),p=t.getY(l),u=t.getZ(l);c<n.x&&(n.x=c),p<n.y&&(n.y=p),u<n.z&&(n.z=u),c>r.x&&(r.x=c),p>r.y&&(r.y=p),u>r.z&&(r.z=u)}return new Me(n,r)}};b(tI,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");const yf=new Set([1123145078,574549367,1675464909,2059837836,3798115385,32440307,3125803723,3207858831,2740243338,2624227202,4240577450,3615266464,3724593414,220341763,477187591,1878645084,1300840506,3303107099,1607154358,1878645084,846575682,1351298697,2417041796,3049322572,3331915920,1416205885,776857604,3285139300,3958052878,2827736869,2732653382,673634403,3448662350,4142052618,2924175390,803316827,2556980723,1809719519,2205249479,807026263,3737207727,1660063152,2347385850,2705031697,3732776249,2485617015,2611217952,1704287377,2937912522,2770003689,1281925730,1484403080,3448662350,4142052618,3800577675,4006246654,3590301190,1383045692,2775532180,2047409740,370225590,3593883385,2665983363,4124623270,812098782,3649129432,987898635,1105321065,3510044353,1635779807,2603310189,3406155212,1310608509,4261334040,2736907675,3649129432,1136057603,1260505505,4182860854,2713105998,2898889636,59481748,3749851601,3486308946,3150382593,1062206242,3264961684,15328376,1485152156,370225590,1981873012,2859738748,45288368,2614616156,2732653382,775493141,2147822146,2601014836,2629017746,1186437898,2367409068,1213902940,3632507154,3900360178,476780140,1472233963,2804161546,3008276851,738692330,374418227,315944413,3905492369,3570813810,2571569899,178912537,2294589976,1437953363,2133299955,572779678,3092502836,388784114,2624227202,1425443689,3057273783,2347385850,1682466193,2519244187,2839578677,3958567839,2513912981,2830218821,427810014]),wf=class vf extends Tt{constructor(e){super(e),b(this,"enabled",!0),e.add(vf.uuid,this)}async export(e,t,s=!1,i=!0){const n={},r=new Set(e.GetIfcEntityList(t)),o=new Set([or,ar,lr,cn,Qt]);for(const a of o)r.add(a);for(const a of r){if(yf.has(a))continue;const l=o.has(a)&&i,c=e.GetLineIDsWithType(t,a);for(const p of c){const u=e.GetLine(0,p,l,s);n[u.expressID]=u}}return n}};b(wf,"uuid","b32c4332-cd67-436e-ba7f-196646c7a635");let sI=wf;const Rf={950732822:"IFCURIREFERENCE",4075327185:"IFCTIME",1209108979:"IFCTEMPERATURERATEOFCHANGEMEASURE",3457685358:"IFCSOUNDPRESSURELEVELMEASURE",4157543285:"IFCSOUNDPOWERLEVELMEASURE",2798247006:"IFCPROPERTYSETDEFINITIONSET",1790229001:"IFCPOSITIVEINTEGER",525895558:"IFCNONNEGATIVELENGTHMEASURE",1774176899:"IFCLINEINDEX",1275358634:"IFCLANGUAGEID",2541165894:"IFCDURATION",3701338814:"IFCDAYINWEEKNUMBER",2195413836:"IFCDATETIME",937566702:"IFCDATE",1683019596:"IFCCARDINALPOINTREFERENCE",2314439260:"IFCBINARY",1500781891:"IFCAREADENSITYMEASURE",3683503648:"IFCARCINDEX",4065007721:"IFCYEARNUMBER",1718600412:"IFCWARPINGMOMENTMEASURE",51269191:"IFCWARPINGCONSTANTMEASURE",2593997549:"IFCVOLUMETRICFLOWRATEMEASURE",3458127941:"IFCVOLUMEMEASURE",3345633955:"IFCVAPORPERMEABILITYMEASURE",1278329552:"IFCTORQUEMEASURE",2591213694:"IFCTIMESTAMP",2726807636:"IFCTIMEMEASURE",743184107:"IFCTHERMODYNAMICTEMPERATUREMEASURE",2016195849:"IFCTHERMALTRANSMITTANCEMEASURE",857959152:"IFCTHERMALRESISTANCEMEASURE",2281867870:"IFCTHERMALEXPANSIONCOEFFICIENTMEASURE",2645777649:"IFCTHERMALCONDUCTIVITYMEASURE",232962298:"IFCTHERMALADMITTANCEMEASURE",296282323:"IFCTEXTTRANSFORMATION",603696268:"IFCTEXTFONTNAME",3490877962:"IFCTEXTDECORATION",1460886941:"IFCTEXTALIGNMENT",2801250643:"IFCTEXT",58845555:"IFCTEMPERATUREGRADIENTMEASURE",361837227:"IFCSPECULARROUGHNESS",2757832317:"IFCSPECULAREXPONENT",3477203348:"IFCSPECIFICHEATCAPACITYMEASURE",993287707:"IFCSOUNDPRESSUREMEASURE",846465480:"IFCSOUNDPOWERMEASURE",3471399674:"IFCSOLIDANGLEMEASURE",408310005:"IFCSHEARMODULUSMEASURE",2190458107:"IFCSECTIONALAREAINTEGRALMEASURE",3467162246:"IFCSECTIONMODULUSMEASURE",2766185779:"IFCSECONDINMINUTE",3211557302:"IFCROTATIONALSTIFFNESSMEASURE",1755127002:"IFCROTATIONALMASSMEASURE",2133746277:"IFCROTATIONALFREQUENCYMEASURE",200335297:"IFCREAL",96294661:"IFCRATIOMEASURE",3972513137:"IFCRADIOACTIVITYMEASURE",3665567075:"IFCPRESSUREMEASURE",2169031380:"IFCPRESENTABLETEXT",1364037233:"IFCPOWERMEASURE",1245737093:"IFCPOSITIVERATIOMEASURE",3054510233:"IFCPOSITIVEPLANEANGLEMEASURE",2815919920:"IFCPOSITIVELENGTHMEASURE",4042175685:"IFCPLANEANGLEMEASURE",2642773653:"IFCPLANARFORCEMEASURE",2260317790:"IFCPARAMETERVALUE",929793134:"IFCPHMEASURE",2395907400:"IFCNUMERICMEASURE",2095195183:"IFCNORMALISEDRATIOMEASURE",765770214:"IFCMONTHINYEARNUMBER",2615040989:"IFCMONETARYMEASURE",3114022597:"IFCMOMENTOFINERTIAMEASURE",1648970520:"IFCMOLECULARWEIGHTMEASURE",3177669450:"IFCMOISTUREDIFFUSIVITYMEASURE",1753493141:"IFCMODULUSOFSUBGRADEREACTIONMEASURE",1052454078:"IFCMODULUSOFROTATIONALSUBGRADEREACTIONMEASURE",2173214787:"IFCMODULUSOFLINEARSUBGRADEREACTIONMEASURE",3341486342:"IFCMODULUSOFELASTICITYMEASURE",102610177:"IFCMINUTEINHOUR",3531705166:"IFCMASSPERLENGTHMEASURE",3124614049:"IFCMASSMEASURE",4017473158:"IFCMASSFLOWRATEMEASURE",1477762836:"IFCMASSDENSITYMEASURE",2486716878:"IFCMAGNETICFLUXMEASURE",286949696:"IFCMAGNETICFLUXDENSITYMEASURE",151039812:"IFCLUMINOUSINTENSITYMEASURE",2755797622:"IFCLUMINOUSINTENSITYDISTRIBUTIONMEASURE",2095003142:"IFCLUMINOUSFLUXMEASURE",503418787:"IFCLOGICAL",3086160713:"IFCLINEARVELOCITYMEASURE",1307019551:"IFCLINEARSTIFFNESSMEASURE",2128979029:"IFCLINEARMOMENTMEASURE",191860431:"IFCLINEARFORCEMEASURE",1243674935:"IFCLENGTHMEASURE",3258342251:"IFCLABEL",2054016361:"IFCKINEMATICVISCOSITYMEASURE",3192672207:"IFCISOTHERMALMOISTURECAPACITYMEASURE",3686016028:"IFCIONCONCENTRATIONMEASURE",3809634241:"IFCINTEGERCOUNTRATEMEASURE",1939436016:"IFCINTEGER",2679005408:"IFCINDUCTANCEMEASURE",3358199106:"IFCILLUMINANCEMEASURE",983778844:"IFCIDENTIFIER",2589826445:"IFCHOURINDAY",1158859006:"IFCHEATINGVALUEMEASURE",3113092358:"IFCHEATFLUXDENSITYMEASURE",3064340077:"IFCGLOBALLYUNIQUEID",3044325142:"IFCFREQUENCYMEASURE",1361398929:"IFCFORCEMEASURE",2590844177:"IFCFONTWEIGHT",2715512545:"IFCFONTVARIANT",1102727119:"IFCFONTSTYLE",2078135608:"IFCENERGYMEASURE",2506197118:"IFCELECTRICVOLTAGEMEASURE",2951915441:"IFCELECTRICRESISTANCEMEASURE",3790457270:"IFCELECTRICCURRENTMEASURE",2093906313:"IFCELECTRICCONDUCTANCEMEASURE",3818826038:"IFCELECTRICCHARGEMEASURE",1827137117:"IFCELECTRICCAPACITANCEMEASURE",69416015:"IFCDYNAMICVISCOSITYMEASURE",524656162:"IFCDOSEEQUIVALENTMEASURE",4134073009:"IFCDIMENSIONCOUNT",1514641115:"IFCDESCRIPTIVEMEASURE",300323983:"IFCDAYLIGHTSAVINGHOUR",86635668:"IFCDAYINMONTHNUMBER",94842927:"IFCCURVATUREMEASURE",1778710042:"IFCCOUNTMEASURE",3238673880:"IFCCONTEXTDEPENDENTMEASURE",3812528620:"IFCCOMPOUNDPLANEANGLEMEASURE",2991860651:"IFCCOMPLEXNUMBER",1867003952:"IFCBOXALIGNMENT",2735952531:"IFCBOOLEAN",2650437152:"IFCAREAMEASURE",632304761:"IFCANGULARVELOCITYMEASURE",360377573:"IFCAMOUNTOFSUBSTANCEMEASURE",4182062534:"IFCACCELERATIONMEASURE",3699917729:"IFCABSORBEDDOSEMEASURE",1971632696:"IFCGEOSLICE",2680139844:"IFCGEOMODEL",24726584:"IFCELECTRICFLOWTREATMENTDEVICE",3693000487:"IFCDISTRIBUTIONBOARD",3460952963:"IFCCONVEYORSEGMENT",3999819293:"IFCCAISSONFOUNDATION",3314249567:"IFCBOREHOLE",4196446775:"IFCBEARING",325726236:"IFCALIGNMENT",3425753595:"IFCTRACKELEMENT",991950508:"IFCSIGNAL",3798194928:"IFCREINFORCEDSOIL",3290496277:"IFCRAIL",1383356374:"IFCPAVEMENT",2182337498:"IFCNAVIGATIONELEMENT",234836483:"IFCMOORINGDEVICE",2078563270:"IFCMOBILETELECOMMUNICATIONSAPPLIANCE",1638804497:"IFCLIQUIDTERMINAL",1154579445:"IFCLINEARPOSITIONINGELEMENT",2696325953:"IFCKERB",2713699986:"IFCGEOTECHNICALASSEMBLY",2142170206:"IFCELECTRICFLOWTREATMENTDEVICETYPE",3376911765:"IFCEARTHWORKSFILL",1077100507:"IFCEARTHWORKSELEMENT",3071239417:"IFCEARTHWORKSCUT",479945903:"IFCDISTRIBUTIONBOARDTYPE",3426335179:"IFCDEEPFOUNDATION",1502416096:"IFCCOURSE",2940368186:"IFCCONVEYORSEGMENTTYPE",3203706013:"IFCCAISSONFOUNDATIONTYPE",3862327254:"IFCBUILTSYSTEM",1876633798:"IFCBUILTELEMENT",963979645:"IFCBRIDGEPART",644574406:"IFCBRIDGE",3649138523:"IFCBEARINGTYPE",1662888072:"IFCALIGNMENTVERTICAL",317615605:"IFCALIGNMENTSEGMENT",1545765605:"IFCALIGNMENTHORIZONTAL",4266260250:"IFCALIGNMENTCANT",3956297820:"IFCVIBRATIONDAMPERTYPE",1530820697:"IFCVIBRATIONDAMPER",840318589:"IFCVEHICLE",1953115116:"IFCTRANSPORTATIONDEVICE",618700268:"IFCTRACKELEMENTTYPE",2281632017:"IFCTENDONCONDUITTYPE",3663046924:"IFCTENDONCONDUIT",42703149:"IFCSINESPIRAL",1894708472:"IFCSIGNALTYPE",3599934289:"IFCSIGNTYPE",33720170:"IFCSIGN",1027922057:"IFCSEVENTHORDERPOLYNOMIALSPIRAL",544395925:"IFCSEGMENTEDREFERENCECURVE",3649235739:"IFCSECONDORDERPOLYNOMIALSPIRAL",550521510:"IFCROADPART",146592293:"IFCROAD",3818125796:"IFCRELADHERESTOELEMENT",4021432810:"IFCREFERENT",1891881377:"IFCRAILWAYPART",3992365140:"IFCRAILWAY",1763565496:"IFCRAILTYPE",1946335990:"IFCPOSITIONINGELEMENT",514975943:"IFCPAVEMENTTYPE",506776471:"IFCNAVIGATIONELEMENTTYPE",710110818:"IFCMOORINGDEVICETYPE",1950438474:"IFCMOBILETELECOMMUNICATIONSAPPLIANCETYPE",976884017:"IFCMARINEPART",525669439:"IFCMARINEFACILITY",1770583370:"IFCLIQUIDTERMINALTYPE",2176059722:"IFCLINEARELEMENT",679976338:"IFCKERBTYPE",3948183225:"IFCIMPACTPROTECTIONDEVICETYPE",2568555532:"IFCIMPACTPROTECTIONDEVICE",2898700619:"IFCGRADIENTCURVE",1594536857:"IFCGEOTECHNICALSTRATUM",4230923436:"IFCGEOTECHNICALELEMENT",4228831410:"IFCFACILITYPARTCOMMON",1310830890:"IFCFACILITYPART",24185140:"IFCFACILITY",4234616927:"IFCDIRECTRIXDERIVEDREFERENCESWEPTAREASOLID",1306400036:"IFCDEEPFOUNDATIONTYPE",4189326743:"IFCCOURSETYPE",2000195564:"IFCCOSINESPIRAL",3497074424:"IFCCLOTHOID",1626504194:"IFCBUILTELEMENTTYPE",3651464721:"IFCVEHICLETYPE",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3665877780:"IFCTRANSPORTATIONDEVICETYPE",782932809:"IFCTHIRDORDERPOLYNOMIALSPIRAL",2735484536:"IFCSPIRAL",1356537516:"IFCSECTIONEDSURFACE",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1862484736:"IFCSECTIONEDSOLID",1441486842:"IFCRELPOSITIONS",1033248425:"IFCRELASSOCIATESPROFILEDEF",3381221214:"IFCPOLYNOMIALCURVE",2485787929:"IFCOFFSETCURVEBYDISTANCES",590820931:"IFCOFFSETCURVE",3465909080:"IFCINDEXEDPOLYGONALTEXTUREMAP",593015953:"IFCDIRECTRIXCURVESWEPTAREASOLID",4212018352:"IFCCURVESEGMENT",3425423356:"IFCAXIS2PLACEMENTLINEAR",823603102:"IFCSEGMENT",2165702409:"IFCPOINTBYDISTANCEEXPRESSION",182550632:"IFCOPENCROSSPROFILEDEF",388784114:"IFCLINEARPLACEMENT",536804194:"IFCALIGNMENTHORIZONTALSEGMENT",3752311538:"IFCALIGNMENTCANTSEGMENT",1010789467:"IFCTEXTURECOORDINATEINDICESWITHVOIDS",222769930:"IFCTEXTURECOORDINATEINDICES",2691318326:"IFCQUANTITYNUMBER",3633395639:"IFCALIGNMENTVERTICALSEGMENT",2879124712:"IFCALIGNMENTPARAMETERSEGMENT",25142252:"IFCCONTROLLER",3087945054:"IFCALARM",4288193352:"IFCACTUATOR",630975310:"IFCUNITARYCONTROLELEMENT",4086658281:"IFCSENSOR",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",182646315:"IFCFLOWINSTRUMENT",1426591983:"IFCFIRESUPPRESSIONTERMINAL",819412036:"IFCFILTER",3415622556:"IFCFAN",1003880860:"IFCELECTRICTIMECONTROL",402227799:"IFCELECTRICMOTOR",264262732:"IFCELECTRICGENERATOR",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",1904799276:"IFCELECTRICAPPLIANCE",1360408905:"IFCDUCTSILENCER",3518393246:"IFCDUCTSEGMENT",342316401:"IFCDUCTFITTING",562808652:"IFCDISTRIBUTIONCIRCUIT",4074379575:"IFCDAMPER",3640358203:"IFCCOOLINGTOWER",4136498852:"IFCCOOLEDBEAM",2272882330:"IFCCONDENSER",3571504051:"IFCCOMPRESSOR",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",639361253:"IFCCOIL",3902619387:"IFCCHILLER",4217484030:"IFCCABLESEGMENT",1051757585:"IFCCABLEFITTING",3758799889:"IFCCABLECARRIERSEGMENT",635142910:"IFCCABLECARRIERFITTING",2938176219:"IFCBURNER",32344328:"IFCBOILER",2906023776:"IFCBEAMSTANDARDCASE",277319702:"IFCAUDIOVISUALAPPLIANCE",2056796094:"IFCAIRTOAIRHEATRECOVERY",177149247:"IFCAIRTERMINALBOX",1634111441:"IFCAIRTERMINAL",486154966:"IFCWINDOWSTANDARDCASE",4237592921:"IFCWASTETERMINAL",4156078855:"IFCWALLELEMENTEDCASE",4207607924:"IFCVALVE",4292641817:"IFCUNITARYEQUIPMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",3026737570:"IFCTUBEBUNDLE",3825984169:"IFCTRANSFORMER",812556717:"IFCTANK",1162798199:"IFCSWITCHINGDEVICE",385403989:"IFCSTRUCTURALLOADCASE",1404847402:"IFCSTACKTERMINAL",1999602285:"IFCSPACEHEATER",3420628829:"IFCSOLARDEVICE",3027962421:"IFCSLABSTANDARDCASE",3127900445:"IFCSLABELEMENTEDCASE",1329646415:"IFCSHADINGDEVICE",3053780830:"IFCSANITARYTERMINAL",2572171363:"IFCREINFORCINGBARTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",90941305:"IFCPUMP",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",738039164:"IFCPROTECTIVEDEVICE",1156407060:"IFCPLATESTANDARDCASE",3612865200:"IFCPIPESEGMENT",310824031:"IFCPIPEFITTING",3694346114:"IFCOUTLET",144952367:"IFCOUTERBOUNDARYCURVE",2474470126:"IFCMOTORCONNECTION",1911478936:"IFCMEMBERSTANDARDCASE",1437502449:"IFCMEDICALDEVICE",629592764:"IFCLIGHTFIXTURE",76236018:"IFCLAMP",2176052936:"IFCJUNCTIONBOX",4175244083:"IFCINTERCEPTOR",2068733104:"IFCHUMIDIFIER",3319311131:"IFCHEATEXCHANGER",2188021234:"IFCFLOWMETER",1209101575:"IFCEXTERNALSPATIALELEMENT",484807127:"IFCEVAPORATOR",3747195512:"IFCEVAPORATIVECOOLER",2814081492:"IFCENGINE",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3242481149:"IFCDOORSTANDARDCASE",3205830791:"IFCDISTRIBUTIONSYSTEM",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",905975707:"IFCCOLUMNSTANDARDCASE",1677625105:"IFCCIVILELEMENT",3296154744:"IFCCHIMNEY",2674252688:"IFCCABLEFITTINGTYPE",2188180465:"IFCBURNERTYPE",1177604601:"IFCBUILDINGSYSTEM",39481116:"IFCBUILDINGELEMENTPARTTYPE",1136057603:"IFCBOUNDARYCURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4088093105:"IFCWORKCALENDAR",4009809668:"IFCWINDOWTYPE",926996030:"IFCVOIDINGFEATURE",2391383451:"IFCVIBRATIONISOLATOR",2415094496:"IFCTENDONTYPE",3081323446:"IFCTENDONANCHORTYPE",413509423:"IFCSYSTEMFURNITUREELEMENT",3101698114:"IFCSURFACEFEATURE",3657597509:"IFCSTRUCTURALSURFACEACTION",2757150158:"IFCSTRUCTURALCURVEREACTION",1004757350:"IFCSTRUCTURALCURVEACTION",338393293:"IFCSTAIRTYPE",1072016465:"IFCSOLARDEVICETYPE",4074543187:"IFCSHADINGDEVICETYPE",2157484638:"IFCSEAMCURVE",2781568857:"IFCROOFTYPE",2310774935:"IFCREINFORCINGMESHTYPE",964333572:"IFCREINFORCINGELEMENTTYPE",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",1469900589:"IFCRAMPTYPE",2839578677:"IFCPOLYGONALFACESET",1158309216:"IFCPILETYPE",3079942009:"IFCOPENINGSTANDARDCASE",1114901282:"IFCMEDICALDEVICETYPE",3113134337:"IFCINTERSECTIONCURVE",3946677679:"IFCINTERCEPTORTYPE",2571569899:"IFCINDEXEDPOLYCURVE",3493046030:"IFCGEOGRAPHICELEMENT",1509553395:"IFCFURNITURE",1893162501:"IFCFOOTINGTYPE",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",4148101412:"IFCEVENT",132023988:"IFCENGINETYPE",2397081782:"IFCELEMENTASSEMBLYTYPE",2323601079:"IFCDOORTYPE",1213902940:"IFCCYLINDRICALSURFACE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",15328376:"IFCCOMPOSITECURVEONSURFACE",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3893394355:"IFCCIVILELEMENTTYPE",2197970202:"IFCCHIMNEYTYPE",167062518:"IFCBSPLINESURFACEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",2603310189:"IFCADVANCEDBREPWITHVOIDS",1635779807:"IFCADVANCEDBREP",2916149573:"IFCTRIANGULATEDFACESET",1935646853:"IFCTOROIDALSURFACE",2387106220:"IFCTESSELLATEDFACESET",3206491090:"IFCTASKTYPE",699246055:"IFCSURFACECURVE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",603775116:"IFCSTRUCTURALSURFACEREACTION",4015995234:"IFCSPHERICALSURFACE",2481509218:"IFCSPATIALZONETYPE",463610769:"IFCSPATIALZONE",710998568:"IFCSPATIALELEMENTTYPE",1412071761:"IFCSPATIALELEMENT",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",427948657:"IFCRELINTERFERESELEMENTS",307848117:"IFCRELDEFINESBYTEMPLATE",1462361463:"IFCRELDEFINESBYOBJECT",2565941209:"IFCRELDECLARES",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",3521284610:"IFCPROPERTYTEMPLATE",492091185:"IFCPROPERTYSETTEMPLATE",653396225:"IFCPROJECTLIBRARY",569719735:"IFCPROCEDURETYPE",3967405729:"IFCPREDEFINEDPROPERTYSET",1682466193:"IFCPCURVE",428585644:"IFCLABORRESOURCETYPE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",178912537:"IFCINDEXEDPOLYGONALFACE",4095422895:"IFCGEOGRAPHICELEMENTTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",4024345920:"IFCEVENTTYPE",2629017746:"IFCCURVEBOUNDEDSURFACE",1815067380:"IFCCREWRESOURCETYPE",3419103109:"IFCCONTEXT",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",2059837836:"IFCCARTESIANPOINTLIST3D",1675464909:"IFCCARTESIANPOINTLIST2D",574549367:"IFCCARTESIANPOINTLIST",3406155212:"IFCADVANCEDFACE",3698973494:"IFCTYPERESOURCE",3736923433:"IFCTYPEPROCESS",901063453:"IFCTESSELLATEDITEM",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",1042787934:"IFCRESOURCETIME",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",2090586900:"IFCQUANTITYSET",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",3778827333:"IFCPREDEFINEDPROPERTIES",2998442950:"IFCMIRROREDPROFILEDEF",853536259:"IFCMATERIALRELATIONSHIP",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",3079605661:"IFCMATERIALPROFILESETUSAGE",2852063980:"IFCMATERIALCONSTITUENTSET",3708119e3:"IFCMATERIALCONSTITUENT",1585845231:"IFCLAGTIME",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",1437953363:"IFCINDEXEDTEXTUREMAP",3570813810:"IFCINDEXEDCOLOURMAP",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",297599258:"IFCEXTENDEDPROPERTIES",211053100:"IFCEVENTTIME",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",3285139300:"IFCCOLOURRGBLIST",1236880293:"IFCWORKTIME",1199560280:"IFCTIMEPERIOD",3611470254:"IFCTEXTUREVERTEXLIST",2771591690:"IFCTASKTIMERECURRING",1549132990:"IFCTASKTIME",2043862942:"IFCTABLECOLUMN",2934153892:"IFCSURFACEREINFORCEMENTAREA",609421318:"IFCSTRUCTURALLOADORRESULT",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1054537805:"IFCSCHEDULINGTIME",2439245199:"IFCRESOURCELEVELRELATIONSHIP",2433181523:"IFCREFERENCE",3915482550:"IFCRECURRENCEPATTERN",986844984:"IFCPROPERTYABSTRACTION",3843373140:"IFCPROJECTEDCRS",677532197:"IFCPRESENTATIONITEM",1507914824:"IFCMATERIALUSAGEDEFINITION",552965576:"IFCMATERIALPROFILEWITHOFFSETS",164193824:"IFCMATERIALPROFILESET",2235152071:"IFCMATERIALPROFILE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",760658860:"IFCMATERIALDEFINITION",3057273783:"IFCMAPCONVERSION",4294318154:"IFCEXTERNALINFORMATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",1785450214:"IFCCOORDINATEOPERATION",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",979691226:"IFCREINFORCINGBAR",3700593921:"IFCELECTRICDISTRIBUTIONPOINT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",578613899:"IFCCONTROLLERTYPE",2454782716:"IFCCHAMFEREDGEFEATURE",753842376:"IFCBEAM",3001207471:"IFCALARMTYPE",2874132201:"IFCACTUATORTYPE",3304561284:"IFCWINDOW",3512223829:"IFCWALLSTANDARDCASE",2391406946:"IFCWALL",3313531582:"IFCVIBRATIONISOLATORTYPE",2347447852:"IFCTENDONANCHOR",3824725483:"IFCTENDON",2515109513:"IFCSTRUCTURALANALYSISMODEL",4252922144:"IFCSTAIRFLIGHT",331165859:"IFCSTAIR",1529196076:"IFCSLAB",1783015770:"IFCSENSORTYPE",1376911519:"IFCROUNDEDEDGEFEATURE",2016517767:"IFCROOF",2320036040:"IFCREINFORCINGMESH",3027567501:"IFCREINFORCINGELEMENT",3055160366:"IFCRATIONALBEZIERCURVE",3283111854:"IFCRAMPFLIGHT",3024970846:"IFCRAMP",2262370178:"IFCRAILING",3171933400:"IFCPLATE",1687234759:"IFCPILE",1073191201:"IFCMEMBER",900683007:"IFCFOOTING",3508470533:"IFCFLOWTREATMENTDEVICE",2223149337:"IFCFLOWTERMINAL",707683696:"IFCFLOWSTORAGEDEVICE",987401354:"IFCFLOWSEGMENT",3132237377:"IFCFLOWMOVINGDEVICE",4037862832:"IFCFLOWINSTRUMENTTYPE",4278956645:"IFCFLOWFITTING",2058353004:"IFCFLOWCONTROLLER",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",1810631287:"IFCFILTERTYPE",346874300:"IFCFANTYPE",1658829314:"IFCENERGYCONVERSIONDEVICE",857184966:"IFCELECTRICALELEMENT",1634875225:"IFCELECTRICALCIRCUIT",712377611:"IFCELECTRICTIMECONTROLTYPE",1217240411:"IFCELECTRICMOTORTYPE",1365060375:"IFCELECTRICHEATERTYPE",1534661035:"IFCELECTRICGENERATORTYPE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",663422040:"IFCELECTRICAPPLIANCETYPE",855621170:"IFCEDGEFEATURE",2030761528:"IFCDUCTSILENCERTYPE",3760055223:"IFCDUCTSEGMENTTYPE",869906466:"IFCDUCTFITTINGTYPE",395920057:"IFCDOOR",3041715199:"IFCDISTRIBUTIONPORT",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",1945004755:"IFCDISTRIBUTIONELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",2635815018:"IFCDISCRETEACCESSORYTYPE",1335981549:"IFCDISCRETEACCESSORY",4147604152:"IFCDIAMETERDIMENSION",3961806047:"IFCDAMPERTYPE",3495092785:"IFCCURTAINWALL",1973544240:"IFCCOVERING",2954562838:"IFCCOOLINGTOWERTYPE",335055490:"IFCCOOLEDBEAMTYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",1163958913:"IFCCONDITIONCRITERION",2188551683:"IFCCONDITION",2816379211:"IFCCONDENSERTYPE",3850581409:"IFCCOMPRESSORTYPE",843113511:"IFCCOLUMN",2301859152:"IFCCOILTYPE",2611217952:"IFCCIRCLE",2951183804:"IFCCHILLERTYPE",1285652485:"IFCCABLESEGMENTTYPE",3293546465:"IFCCABLECARRIERSEGMENTTYPE",395041908:"IFCCABLECARRIERFITTINGTYPE",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",2979338954:"IFCBUILDINGELEMENTPART",52481810:"IFCBUILDINGELEMENTCOMPONENT",3299480353:"IFCBUILDINGELEMENT",231477066:"IFCBOILERTYPE",1916977116:"IFCBEZIERCURVE",819618141:"IFCBEAMTYPE",1967976161:"IFCBSPLINECURVE",3460190687:"IFCASSET",2470393545:"IFCANGULARDIMENSION",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3352864051:"IFCAIRTERMINALTYPE",1411407467:"IFCAIRTERMINALBOXTYPE",3821786052:"IFCACTIONREQUEST",1213861670:"IFC2DCOMPOSITECURVE",1033361043:"IFCZONE",3342526732:"IFCWORKSCHEDULE",4218914973:"IFCWORKPLAN",1028945134:"IFCWORKCONTROL",1133259667:"IFCWASTETERMINALTYPE",1898987631:"IFCWALLTYPE",2769231204:"IFCVIRTUALELEMENT",728799441:"IFCVALVETYPE",1911125066:"IFCUNITARYEQUIPMENTTYPE",1600972822:"IFCTUBEBUNDLETYPE",3593883385:"IFCTRIMMEDCURVE",1620046519:"IFCTRANSPORTELEMENT",1692211062:"IFCTRANSFORMERTYPE",1637806684:"IFCTIMESERIESSCHEDULE",5716631:"IFCTANKTYPE",2254336722:"IFCSYSTEM",2315554128:"IFCSWITCHINGDEVICETYPE",148013059:"IFCSUBCONTRACTRESOURCE",1975003073:"IFCSTRUCTURALSURFACECONNECTION",2986769608:"IFCSTRUCTURALRESULTGROUP",1235345126:"IFCSTRUCTURALPOINTREACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",2082059205:"IFCSTRUCTURALPOINTACTION",3987759626:"IFCSTRUCTURALPLANARACTIONVARYING",1621171031:"IFCSTRUCTURALPLANARACTION",1252848954:"IFCSTRUCTURALLOADGROUP",1721250024:"IFCSTRUCTURALLINEARACTIONVARYING",1807405624:"IFCSTRUCTURALLINEARACTION",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",214636428:"IFCSTRUCTURALCURVEMEMBER",4243806635:"IFCSTRUCTURALCURVECONNECTION",1179482911:"IFCSTRUCTURALCONNECTION",682877961:"IFCSTRUCTURALACTION",1039846685:"IFCSTAIRFLIGHTTYPE",3112655638:"IFCSTACKTERMINALTYPE",3812236995:"IFCSPACETYPE",652456506:"IFCSPACEPROGRAM",1305183839:"IFCSPACEHEATERTYPE",3856911033:"IFCSPACE",2533589738:"IFCSLABTYPE",4097777520:"IFCSITE",4105383287:"IFCSERVICELIFE",3517283431:"IFCSCHEDULETIMECONTROL",1768891740:"IFCSANITARYTERMINALTYPE",2863920197:"IFCRELASSIGNSTASKS",160246688:"IFCRELAGGREGATES",2324767716:"IFCRAMPFLIGHTTYPE",2893384427:"IFCRAILINGTYPE",3248260540:"IFCRADIUSDIMENSION",2250791053:"IFCPUMPTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3651124850:"IFCPROJECTIONELEMENT",3642467123:"IFCPROJECTORDERRECORD",2904328755:"IFCPROJECTORDER",2744685151:"IFCPROCEDURE",3740093272:"IFCPORT",3724593414:"IFCPOLYLINE",4017108033:"IFCPLATETYPE",4231323485:"IFCPIPESEGMENTTYPE",804291784:"IFCPIPEFITTINGTYPE",3327091369:"IFCPERMIT",2382730787:"IFCPERFORMANCEHISTORY",2837617999:"IFCOUTLETTYPE",3425660407:"IFCORDERACTION",3588315303:"IFCOPENINGELEMENT",4143007308:"IFCOCCUPANT",1916936684:"IFCMOVE",977012517:"IFCMOTORCONNECTIONTYPE",3181161470:"IFCMEMBERTYPE",2108223431:"IFCMECHANICALFASTENERTYPE",377706215:"IFCMECHANICALFASTENER",2506943328:"IFCLINEARDIMENSION",1161773419:"IFCLIGHTFIXTURETYPE",1051575348:"IFCLAMPTYPE",3827777499:"IFCLABORRESOURCE",4288270099:"IFCJUNCTIONBOXTYPE",2391368822:"IFCINVENTORY",1806887404:"IFCHUMIDIFIERTYPE",1251058090:"IFCHEATEXCHANGERTYPE",2706460486:"IFCGROUP",3009204131:"IFCGRID",200128114:"IFCGASTERMINALTYPE",814719939:"IFCFURNITURESTANDARD",263784265:"IFCFURNISHINGELEMENT",3009222698:"IFCFLOWTREATMENTDEVICETYPE",2297155007:"IFCFLOWTERMINALTYPE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",1834744321:"IFCFLOWSEGMENTTYPE",1482959167:"IFCFLOWMOVINGDEVICETYPE",3815607619:"IFCFLOWMETERTYPE",3198132628:"IFCFLOWFITTINGTYPE",3907093117:"IFCFLOWCONTROLLERTYPE",1287392070:"IFCFEATUREELEMENTSUBTRACTION",2143335405:"IFCFEATUREELEMENTADDITION",2827207264:"IFCFEATUREELEMENT",2489546625:"IFCFASTENERTYPE",647756555:"IFCFASTENER",3737207727:"IFCFACETEDBREPWITHVOIDS",807026263:"IFCFACETEDBREP",3390157468:"IFCEVAPORATORTYPE",3174744832:"IFCEVAPORATIVECOOLERTYPE",3272907226:"IFCEQUIPMENTSTANDARD",1962604670:"IFCEQUIPMENTELEMENT",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",1704287377:"IFCELLIPSE",2590856083:"IFCELEMENTCOMPONENTTYPE",1623761950:"IFCELEMENTCOMPONENT",4123344466:"IFCELEMENTASSEMBLY",1758889154:"IFCELEMENT",360485395:"IFCELECTRICALBASEPROPERTIES",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",681481545:"IFCDIMENSIONCURVEDIRECTEDCALLOUT",1457835157:"IFCCURTAINWALLTYPE",3295246426:"IFCCREWRESOURCE",1916426348:"IFCCOVERINGTYPE",1419761937:"IFCCOSTSCHEDULE",3895139033:"IFCCOSTITEM",3293443760:"IFCCONTROL",2559216714:"IFCCONSTRUCTIONRESOURCE",2510884976:"IFCCONIC",3732776249:"IFCCOMPOSITECURVE",300633059:"IFCCOLUMNTYPE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",3124254112:"IFCBUILDINGSTOREY",1950629157:"IFCBUILDINGELEMENTTYPE",4031249490:"IFCBUILDING",1260505505:"IFCBOUNDEDCURVE",3649129432:"IFCBOOLEANCLIPPINGRESULT",1334484129:"IFCBLOCK",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",1674181508:"IFCANNOTATION",2296667514:"IFCACTOR",2097647324:"IFCTRANSPORTELEMENTTYPE",3473067441:"IFCTASK",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",4124788165:"IFCSURFACEOFREVOLUTION",2809605785:"IFCSURFACEOFLINEAREXTRUSION",2028607225:"IFCSURFACECURVESWEPTAREASOLID",4070609034:"IFCSTRUCTUREDDIMENSIONCALLOUT",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",3979015343:"IFCSTRUCTURALSURFACEMEMBER",3689010777:"IFCSTRUCTURALREACTION",530289379:"IFCSTRUCTURALMEMBER",3136571912:"IFCSTRUCTURALITEM",3544373492:"IFCSTRUCTURALACTIVITY",451544542:"IFCSPHERE",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3626867408:"IFCRIGHTCIRCULARCYLINDER",4158566097:"IFCRIGHTCIRCULARCONE",1856042241:"IFCREVOLVEDAREASOLID",2914609552:"IFCRESOURCE",1401173127:"IFCRELVOIDSELEMENT",3451746338:"IFCRELSPACEBOUNDARY",366585022:"IFCRELSERVICESBUILDINGS",4122056220:"IFCRELSEQUENCE",1058617721:"IFCRELSCHEDULESCOSTITEMS",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",750771296:"IFCRELPROJECTSELEMENT",202636808:"IFCRELOVERRIDESPROPERTIES",2051452291:"IFCRELOCCUPIESSPACES",3268803585:"IFCRELNESTS",4189434867:"IFCRELINTERACTIONREQUIREMENTS",279856033:"IFCRELFLOWCONTROLELEMENTS",3940055652:"IFCRELFILLSELEMENT",781010003:"IFCRELDEFINESBYTYPE",4186316022:"IFCRELDEFINESBYPROPERTIES",693640335:"IFCRELDEFINES",2551354335:"IFCRELDECOMPOSES",2802773753:"IFCRELCOVERSSPACES",886880790:"IFCRELCOVERSBLDGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",504942748:"IFCRELCONNECTSWITHECCENTRICITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",3912681535:"IFCRELCONNECTSSTRUCTURALELEMENT",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",3190031847:"IFCRELCONNECTSPORTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3945020480:"IFCRELCONNECTSPATHELEMENTS",1204542856:"IFCRELCONNECTSELEMENTS",826625072:"IFCRELCONNECTS",2851387026:"IFCRELASSOCIATESPROFILEPROPERTIES",2655215786:"IFCRELASSOCIATESMATERIAL",3840914261:"IFCRELASSOCIATESLIBRARY",982818633:"IFCRELASSOCIATESDOCUMENT",2728634034:"IFCRELASSOCIATESCONSTRAINT",919958153:"IFCRELASSOCIATESCLASSIFICATION",4095574036:"IFCRELASSOCIATESAPPROVAL",1327628568:"IFCRELASSOCIATESAPPLIEDVALUE",1865459582:"IFCRELASSOCIATES",205026976:"IFCRELASSIGNSTORESOURCE",3372526763:"IFCRELASSIGNSTOPROJECTORDER",2857406711:"IFCRELASSIGNSTOPRODUCT",4278684876:"IFCRELASSIGNSTOPROCESS",1307041759:"IFCRELASSIGNSTOGROUP",2495723537:"IFCRELASSIGNSTOCONTROL",1683148259:"IFCRELASSIGNSTOACTOR",3939117080:"IFCRELASSIGNS",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",2798486643:"IFCRECTANGULARPYRAMID",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3219374653:"IFCPROXY",1451395588:"IFCPROPERTYSET",4194566429:"IFCPROJECTIONCURVE",103090709:"IFCPROJECT",4208778838:"IFCPRODUCT",2945172077:"IFCPROCESS",220341763:"IFCPLANE",603570806:"IFCPLANARBOX",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3505215534:"IFCOFFSETCURVE3D",3388369263:"IFCOFFSETCURVE2D",3888040117:"IFCOBJECT",1425443689:"IFCMANIFOLDSOLIDBREP",1281925730:"IFCLINE",572779678:"IFCLSHAPEPROFILEDEF",1484403080:"IFCISHAPEPROFILEDEF",987898635:"IFCGEOMETRICCURVESET",1268542332:"IFCFURNITURETYPE",4238390223:"IFCFURNISHINGELEMENTTYPE",3455213021:"IFCFLUIDFLOWPROPERTIES",315944413:"IFCFILLAREASTYLETILES",4203026998:"IFCFILLAREASTYLETILESYMBOLWITHSTYLE",374418227:"IFCFILLAREASTYLEHATCHING",2047409740:"IFCFACEBASEDSURFACEMODEL",477187591:"IFCEXTRUDEDAREASOLID",80994333:"IFCENERGYPROPERTIES",2835456948:"IFCELLIPSEPROFILEDEF",2777663545:"IFCELEMENTARYSURFACE",339256511:"IFCELEMENTTYPE",1883228015:"IFCELEMENTQUANTITY",1472233963:"IFCEDGELOOP",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",3073041342:"IFCDRAUGHTINGCALLOUT",526551008:"IFCDOORSTYLE",1714330368:"IFCDOORPANELPROPERTIES",2963535650:"IFCDOORLININGPROPERTIES",32440307:"IFCDIRECTION",4054601972:"IFCDIMENSIONCURVETERMINATOR",606661476:"IFCDIMENSIONCURVE",693772133:"IFCDEFINEDSYMBOL",2827736869:"IFCCURVEBOUNDEDPLANE",2601014836:"IFCCURVE",2147822146:"IFCCSGSOLID",2506170314:"IFCCSGPRIMITIVE3D",194851669:"IFCCRANERAILFSHAPEPROFILEDEF",4133800736:"IFCCRANERAILASHAPEPROFILEDEF",2485617015:"IFCCOMPOSITECURVESEGMENT",2205249479:"IFCCLOSEDSHELL",1383045692:"IFCCIRCLEPROFILEDEF",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",1123145078:"IFCCARTESIANPOINT",2898889636:"IFCCSHAPEPROFILEDEF",2713105998:"IFCBOXEDHALFSPACE",2581212453:"IFCBOUNDINGBOX",4182860854:"IFCBOUNDEDSURFACE",2736907675:"IFCBOOLEANRESULT",2740243338:"IFCAXIS2PLACEMENT3D",3125803723:"IFCAXIS2PLACEMENT2D",4261334040:"IFCAXIS1PLACEMENT",1302238472:"IFCANNOTATIONSURFACE",2265737646:"IFCANNOTATIONFILLAREAOCCURRENCE",669184980:"IFCANNOTATIONFILLAREA",3288037868:"IFCANNOTATIONCURVEOCCURRENCE",2543172580:"IFCZSHAPEPROFILEDEF",1299126871:"IFCWINDOWSTYLE",512836454:"IFCWINDOWPANELPROPERTIES",336235671:"IFCWINDOWLININGPROPERTIES",2759199220:"IFCVERTEXLOOP",1417489154:"IFCVECTOR",427810014:"IFCUSHAPEPROFILEDEF",2347495698:"IFCTYPEPRODUCT",1628702193:"IFCTYPEOBJECT",1345879162:"IFCTWODIRECTIONREPEATFACTOR",2715220739:"IFCTRAPEZIUMPROFILEDEF",3124975700:"IFCTEXTLITERALWITHEXTENT",4282788508:"IFCTEXTLITERAL",3028897424:"IFCTERMINATORSYMBOL",3071757647:"IFCTSHAPEPROFILEDEF",230924584:"IFCSWEPTSURFACE",1260650574:"IFCSWEPTDISKSOLID",2247615214:"IFCSWEPTAREASOLID",1878645084:"IFCSURFACESTYLERENDERING",2513912981:"IFCSURFACE",2233826070:"IFCSUBEDGE",3653947884:"IFCSTRUCTURALSTEELPROFILEPROPERTIES",3843319758:"IFCSTRUCTURALPROFILEPROPERTIES",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",390701378:"IFCSPACETHERMALLOADPROPERTIES",1202362311:"IFCSOUNDVALUE",2485662743:"IFCSOUNDPROPERTIES",723233188:"IFCSOLIDMODEL",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",4124623270:"IFCSHELLBASEDSURFACEMODEL",2411513650:"IFCSERVICELIFEFACTOR",1509187699:"IFCSECTIONEDSPINE",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",478536968:"IFCRELATIONSHIP",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",3413951693:"IFCREGULARTIMESERIES",3615266464:"IFCRECTANGLEPROFILEDEF",110355661:"IFCPROPERTYTABLEVALUE",3650150729:"IFCPROPERTYSINGLEVALUE",3357820518:"IFCPROPERTYSETDEFINITION",941946838:"IFCPROPERTYREFERENCEVALUE",2752243245:"IFCPROPERTYLISTVALUE",4166981789:"IFCPROPERTYENUMERATEDVALUE",1680319473:"IFCPROPERTYDEFINITION",871118103:"IFCPROPERTYBOUNDEDVALUE",673634403:"IFCPRODUCTDEFINITIONSHAPE",179317114:"IFCPREDEFINEDPOINTMARKERSYMBOL",433424934:"IFCPREDEFINEDDIMENSIONSYMBOL",2559016684:"IFCPREDEFINEDCURVEFONT",759155922:"IFCPREDEFINEDCOLOUR",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2924175390:"IFCPOLYLOOP",1423911732:"IFCPOINTONSURFACE",4022376103:"IFCPOINTONCURVE",2067069095:"IFCPOINT",1663979128:"IFCPLANAREXTENT",2004835150:"IFCPLACEMENT",597895409:"IFCPIXELTEXTURE",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2519244187:"IFCPATH",2529465313:"IFCPARAMETERIZEDPROFILEDEF",1029017970:"IFCORIENTEDEDGE",2665983363:"IFCOPENSHELL",2833995503:"IFCONEDIRECTIONREPEATFACTOR",219451334:"IFCOBJECTDEFINITION",1430189142:"IFCMECHANICALCONCRETEMATERIALPROPERTIES",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",2347385850:"IFCMAPPEDITEM",1008929658:"IFCLOOP",2624227202:"IFCLOCALPLACEMENT",3422422726:"IFCLIGHTSOURCESPOT",1520743889:"IFCLIGHTSOURCEPOSITIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",125510826:"IFCLIGHTSOURCEAMBIENT",1402838566:"IFCLIGHTSOURCE",3741457305:"IFCIRREGULARTIMESERIES",3905492369:"IFCIMAGETEXTURE",2445078500:"IFCHYGROSCOPICMATERIALPROPERTIES",812098782:"IFCHALFSPACESOLID",178086475:"IFCGRIDPLACEMENT",3590301190:"IFCGEOMETRICSET",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",1446786286:"IFCGENERALPROFILEPROPERTIES",803998398:"IFCGENERALMATERIALPROPERTIES",3857492461:"IFCFUELPROPERTIES",738692330:"IFCFILLAREASTYLE",4219587988:"IFCFAILURECONNECTIONCONDITION",3008276851:"IFCFACESURFACE",803316827:"IFCFACEOUTERBOUND",1809719519:"IFCFACEBOUND",2556980723:"IFCFACE",1860660968:"IFCEXTENDEDMATERIALPROPERTIES",476780140:"IFCEDGECURVE",3900360178:"IFCEDGE",4170525392:"IFCDRAUGHTINGPREDEFINEDTEXTFONT",3732053477:"IFCDOCUMENTREFERENCE",1694125774:"IFCDIMENSIONPAIR",2273265877:"IFCDIMENSIONCALLOUTRELATIONSHIP",3632507154:"IFCDERIVEDPROFILEDEF",3800577675:"IFCCURVESTYLE",2889183280:"IFCCONVERSIONBASEDUNIT",3050246964:"IFCCONTEXTDEPENDENTUNIT",45288368:"IFCCONNECTIONPOINTECCENTRICITY",1981873012:"IFCCONNECTIONCURVEGEOMETRY",370225590:"IFCCONNECTEDFACESET",1485152156:"IFCCOMPOSITEPROFILEDEF",2542286263:"IFCCOMPLEXPROPERTY",776857604:"IFCCOLOURRGB",647927063:"IFCCLASSIFICATIONREFERENCE",3150382593:"IFCCENTERLINEPROFILEDEF",616511568:"IFCBLOBTEXTURE",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",1310608509:"IFCARBITRARYOPENPROFILEDEF",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",2297822566:"IFCANNOTATIONTEXTOCCURRENCE",3612888222:"IFCANNOTATIONSYMBOLOCCURRENCE",962685235:"IFCANNOTATIONSURFACEOCCURRENCE",2442683028:"IFCANNOTATIONOCCURRENCE",1065908215:"IFCWATERPROPERTIES",891718957:"IFCVIRTUALGRIDINTERSECTION",1907098498:"IFCVERTEXPOINT",3304826586:"IFCVERTEXBASEDTEXTUREMAP",2799835756:"IFCVERTEX",180925521:"IFCUNITASSIGNMENT",1735638870:"IFCTOPOLOGYREPRESENTATION",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",581633288:"IFCTIMESERIESVALUE",1718945513:"IFCTIMESERIESREFERENCERELATIONSHIP",3101149627:"IFCTIMESERIES",3317419933:"IFCTHERMALMATERIALPROPERTIES",1210645708:"IFCTEXTUREVERTEX",2552916305:"IFCTEXTUREMAP",1742049831:"IFCTEXTURECOORDINATEGENERATOR",280115917:"IFCTEXTURECOORDINATE",1484833681:"IFCTEXTSTYLEWITHBOXCHARACTERISTICS",1640371178:"IFCTEXTSTYLETEXTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1983826977:"IFCTEXTSTYLEFONTMODEL",1447204868:"IFCTEXTSTYLE",912023232:"IFCTELECOMADDRESS",531007025:"IFCTABLEROW",985171141:"IFCTABLE",1290481447:"IFCSYMBOLSTYLE",626085974:"IFCSURFACETEXTURE",1351298697:"IFCSURFACESTYLEWITHTEXTURES",846575682:"IFCSURFACESTYLESHADING",1607154358:"IFCSURFACESTYLEREFRACTION",3303107099:"IFCSURFACESTYLELIGHTING",1300840506:"IFCSURFACESTYLE",3049322572:"IFCSTYLEDREPRESENTATION",3958052878:"IFCSTYLEDITEM",2830218821:"IFCSTYLEMODEL",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",2525727697:"IFCSTRUCTURALLOADSTATIC",2162789131:"IFCSTRUCTURALLOAD",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",3692461612:"IFCSIMPLEPROPERTY",4240577450:"IFCSHAPEREPRESENTATION",3982875396:"IFCSHAPEMODEL",867548509:"IFCSHAPEASPECT",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",2042790032:"IFCSECTIONPROPERTIES",448429030:"IFCSIUNIT",2341007311:"IFCROOT",3679540991:"IFCRIBPLATEPROFILEPROPERTIES",1660063152:"IFCREPRESENTATIONMAP",3008791417:"IFCREPRESENTATIONITEM",3377609919:"IFCREPRESENTATIONCONTEXT",1076942058:"IFCREPRESENTATION",1222501353:"IFCRELAXATION",1580146022:"IFCREINFORCEMENTBARPROPERTIES",2692823254:"IFCREFERENCESVALUEDOCUMENT",825690147:"IFCQUANTITYWEIGHT",2405470396:"IFCQUANTITYVOLUME",3252649465:"IFCQUANTITYTIME",931644368:"IFCQUANTITYLENGTH",2093928680:"IFCQUANTITYCOUNT",2044713172:"IFCQUANTITYAREA",3710013099:"IFCPROPERTYENUMERATION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",3896028662:"IFCPROPERTYCONSTRAINTRELATIONSHIP",2598011224:"IFCPROPERTY",2802850158:"IFCPROFILEPROPERTIES",3958567839:"IFCPROFILEDEF",2267347899:"IFCPRODUCTSOFCOMBUSTIONPROPERTIES",2095639259:"IFCPRODUCTREPRESENTATION",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",3119450353:"IFCPRESENTATIONSTYLE",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1775413392:"IFCPREDEFINEDTEXTFONT",3213052703:"IFCPREDEFINEDTERMINATORSYMBOL",990879717:"IFCPREDEFINEDSYMBOL",3727388367:"IFCPREDEFINEDITEM",3355820592:"IFCPOSTALADDRESS",2226359599:"IFCPHYSICALSIMPLEQUANTITY",2483315170:"IFCPHYSICALQUANTITY",101040310:"IFCPERSONANDORGANIZATION",2077209135:"IFCPERSON",1207048766:"IFCOWNERHISTORY",1411181986:"IFCORGANIZATIONRELATIONSHIP",4251960020:"IFCORGANIZATION",1227763645:"IFCOPTICALMATERIALPROPERTIES",2251480897:"IFCOBJECTIVE",3701648758:"IFCOBJECTPLACEMENT",1918398963:"IFCNAMEDUNIT",2706619895:"IFCMONETARYUNIT",3368373690:"IFCMETRIC",677618848:"IFCMECHANICALSTEELMATERIALPROPERTIES",4256014907:"IFCMECHANICALMATERIALPROPERTIES",2597039031:"IFCMEASUREWITHUNIT",3265635763:"IFCMATERIALPROPERTIES",2199411900:"IFCMATERIALLIST",1303795690:"IFCMATERIALLAYERSETUSAGE",3303938423:"IFCMATERIALLAYERSET",248100487:"IFCMATERIALLAYER",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",1838606355:"IFCMATERIAL",30780891:"IFCLOCALTIME",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",4162380809:"IFCLIGHTDISTRIBUTIONDATA",3452421091:"IFCLIBRARYREFERENCE",2655187982:"IFCLIBRARYINFORMATION",3020489413:"IFCIRREGULARTIMESERIESVALUE",852622518:"IFCGRIDAXIS",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",3207319532:"IFCEXTERNALLYDEFINEDSYMBOL",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",3200245327:"IFCEXTERNALREFERENCE",1648886627:"IFCENVIRONMENTALIMPACTVALUE",3796139169:"IFCDRAUGHTINGCALLOUTRELATIONSHIP",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",1154170062:"IFCDOCUMENTINFORMATION",1376555844:"IFCDOCUMENTELECTRONICFORMAT",2949456006:"IFCDIMENSIONALEXPONENTS",1045800335:"IFCDERIVEDUNITELEMENT",1765591967:"IFCDERIVEDUNIT",1072939445:"IFCDATEANDTIME",3510044353:"IFCCURVESTYLEFONTPATTERN",2367409068:"IFCCURVESTYLEFONTANDSCALING",1105321065:"IFCCURVESTYLEFONT",539742890:"IFCCURRENCYRELATIONSHIP",602808272:"IFCCOSTVALUE",1065062679:"IFCCOORDINATEDUNIVERSALTIMEOFFSET",347226245:"IFCCONSTRAINTRELATIONSHIP",613356794:"IFCCONSTRAINTCLASSIFICATIONRELATIONSHIP",1658513725:"IFCCONSTRAINTAGGREGATIONRELATIONSHIP",1959218052:"IFCCONSTRAINT",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",4257277454:"IFCCONNECTIONPORTGEOMETRY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",3264961684:"IFCCOLOURSPECIFICATION",3639012971:"IFCCLASSIFICATIONNOTATIONFACET",938368621:"IFCCLASSIFICATIONNOTATION",1098599126:"IFCCLASSIFICATIONITEMRELATIONSHIP",1767535486:"IFCCLASSIFICATIONITEM",747523909:"IFCCLASSIFICATION",622194075:"IFCCALENDARDATE",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1387855156:"IFCBOUNDARYNODECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1560379544:"IFCBOUNDARYEDGECONDITION",4037036970:"IFCBOUNDARYCONDITION",3869604511:"IFCAPPROVALRELATIONSHIP",390851274:"IFCAPPROVALPROPERTYRELATIONSHIP",2080292479:"IFCAPPROVALACTORRELATIONSHIP",130549933:"IFCAPPROVAL",1110488051:"IFCAPPLIEDVALUERELATIONSHIP",411424972:"IFCAPPLIEDVALUE",639542469:"IFCAPPLICATION",618182010:"IFCADDRESS",3630933823:"IFCACTORROLE",599546466:"FILE_DESCRIPTION",1390159747:"FILE_NAME",1109904537:"FILE_SCHEMA"};class tn{static async getUnits(e){var t,s,i;const{IFCUNITASSIGNMENT:n}=St,r=await e.getAllPropertiesOfType(n);if(!r)return 1;const o=Object.keys(r),a=r[parseInt(o[0],10)];for(const l of a.Units){if(l.value===void 0||l.value===null)continue;const c=await e.getProperties(l.value);if(!c||!c.UnitType||!c.UnitType.value||c.UnitType.value!=="LENGTHUNIT")continue;let p=1,u=1;return c.Name.value==="METRE"&&(u=1),c.Name.value==="FOOT"&&(u=.3048),((t=c.Prefix)==null?void 0:t.value)==="MILLI"?p=.001:((s=c.Prefix)==null?void 0:s.value)==="CENTI"?p=.01:((i=c.Prefix)==null?void 0:i.value)==="DECI"&&(p=.1),u*p}return 1}static async findItemByGuid(e,t){var s;const i=e.getAllPropertiesIDs();for(const n of i){const r=await e.getProperties(n);if(r&&((s=r.GlobalId)==null?void 0:s.value)===t)return r}return null}static async getRelationMap(e,t,s){var i;const n=s??(async()=>{}),r={},o=e.getAllPropertiesIDs();for(const a of o){const l=await e.getProperties(a);if(!l)continue;const c=l.type===t,p=Object.keys(l).find(T=>T.startsWith("Relating")),u=Object.keys(l).find(T=>T.startsWith("Related"));if(!(c&&p&&u))continue;const m=await e.getProperties((i=l[p])==null?void 0:i.value),E=l[u];if(!m||!E||!(E&&Array.isArray(E)))continue;const g=E.map(T=>T.value);await n(m.expressID,g),r[m.expressID]=g}return r}static async getQsetQuantities(e,t,s){const i=s??(()=>{}),n=await e.getProperties(t);return!n||n.type!==Dp?null:(n.Quantities??[{}]).map(r=>(r.value&&i(r.value),r.value)).filter(r=>r!==null)}static async getPsetProps(e,t,s){const i=s??(()=>{}),n=await e.getProperties(t);return!n||n.type!==tr?null:(n.HasProperties??[{}]).map(r=>(r.value&&i(r.value),r.value)).filter(r=>r!==null)}static async getPsetRel(e,t){var s;if(!await e.getProperties(t))return null;const i=await e.getAllPropertiesOfType(nr);if(!i)return null;const n=Object.values(i);let r=null;for(const o of n)((s=o.RelatingPropertyDefinition)==null?void 0:s.value)===t&&(r=o.expressID);return r}static async getQsetRel(e,t){return tn.getPsetRel(e,t)}static async getEntityName(e,t){var s;const i=await e.getProperties(t);if(!i)return{key:null,name:null};const n=Object.keys(i).find(o=>o.endsWith("Name"))??null,r=n?(s=i[n])==null?void 0:s.value:null;return{key:n,name:r}}static async getQuantityValue(e,t){const s=await e.getProperties(t);if(!s)return{key:null,value:null};const i=Object.keys(s).find(r=>r.endsWith("Value"))??null;let n;return i===null||s[i]===void 0||s[i]===null?n=null:n=s[i].value,{key:i,value:n}}static isRel(e){return Rf[e].startsWith("IFCREL")}static async attributeExists(e,t,s){const i=await e.getProperties(t);return i?Object.keys(i).includes(s):!1}static async groupEntitiesByType(e,t){var s;const i=new Map;for(const n of t){const r=await e.getProperties(n);if(!r)continue;const o=r.type;i.get(o)||i.set(o,new Set),(s=i.get(o))==null||s.add(n)}return i}}class iI{constructor(){b(this,"factor",1),b(this,"complement",1)}apply(e){const t=this.getScaleMatrix().multiply(e);e.copy(t)}setUp(e){var t,s,i;this.factor=1;const n=this.getLengthUnits(e);if(!n)return;const r=n==null,o=n.Name===void 0||n.Name===null;r||o||(n.Name.value==="FOOT"&&(this.factor=.3048),((t=n.Prefix)==null?void 0:t.value)==="MILLI"?this.complement=.001:((s=n.Prefix)==null?void 0:s.value)==="CENTI"?this.complement=.01:((i=n.Prefix)==null?void 0:i.value)==="DECI"&&(this.complement=.01))}getLengthUnits(e){try{const t=e.GetLineIDsWithType(0,Wp).get(0),s=e.GetLine(0,t);for(const i of s.Units){if(!i||i.value===null||i.value===void 0)continue;const n=e.GetLine(0,i.value);if(n.UnitType&&n.UnitType.value==="LENGTHUNIT")return n}return null}catch{return console.log("Could not get units"),null}}getScaleMatrix(){const e=this.factor;return new de().fromArray([e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1])}}let Ff=class{constructor(){b(this,"itemsByFloor",{}),b(this,"_units",new iI)}setUp(e){this._units.setUp(e),this.cleanUp();try{const t=e.GetLineIDsWithType(0,rr),s=new Set,i=e.GetLineIDsWithType(0,Qt);for(let l=0;l<i.size();l++)s.add(i.get(l));const n=e.GetLineIDsWithType(0,ir),r=n.size();for(let l=0;l<r;l++){const c=n.get(l),p=e.GetLine(0,c);if(!p||!p.RelatingObject||!p.RelatedObjects)continue;const u=p.RelatingObject.value,m=p.RelatedObjects;for(const E of m){const g=E.value;s.has(g)&&(this.itemsByFloor[g]=u)}}const o={},a=t.size();for(let l=0;l<a;l++){const c=t.get(l),p=e.GetLine(0,c);if(!p||!p.RelatingStructure||!p.RelatedElements)continue;const u=p.RelatingStructure.value,m=p.RelatedElements;if(s.has(u))for(const E of m){o[u]||(o[u]=[]);const g=E.value;o[u].push(g)}else for(const E of m){const g=E.value;this.itemsByFloor[g]=u}}for(const l in o){const c=this.itemsByFloor[l];if(c!==void 0){const p=o[l];for(const u of p)this.itemsByFloor[u]=c}}for(let l=0;l<r;l++){const c=n.get(l),p=e.GetLine(0,c);if(!p||!p.RelatingObject||!p.RelatedObjects)continue;const u=p.RelatingObject.value,m=p.RelatedObjects;for(const E of m){const g=E.value,T=this.itemsByFloor[u];T!==void 0&&(this.itemsByFloor[g]=T)}}}catch{console.log("Could not get floors.")}}cleanUp(){this.itemsByFloor={}}};class od{constructor(){b(this,"includeProperties",!0),b(this,"optionalCategories",[Qt]),b(this,"coordinate",!0),b(this,"wasm",{path:"",absolute:!1,logLevel:Up.LOG_LEVEL_OFF}),b(this,"excludedCategories",new Set),b(this,"includedCategories",new Set),b(this,"saveLocations",!1),b(this,"webIfc",{COORDINATE_TO_ORIGIN:!0}),b(this,"autoSetWasm",!0),b(this,"customLocateFileHandler",null)}}let Af=class{constructor(){b(this,"defLineMat",new qs({color:16777215}))}read(e){const t=e.GetAllAlignments(0),s=e.GetAllCrossSections2D(0),i=e.GetAllCrossSections3D(0),n={IfcAlignment:t,IfcCrossSection2D:s,IfcCrossSection3D:i};return this.get(n)}get(e){if(e.IfcAlignment){const t=new Map;for(const s of e.IfcAlignment){const i=new Bp;i.absolute=this.getCurves(s.curve3D,i),i.horizontal=this.getCurves(s.horizontal,i),i.vertical=this.getCurves(s.vertical,i),t.set(t.size,i)}return{alignments:t,coordinationMatrix:new de}}}getCurves(e,t){const s=[];let i=0;for(const n of e){const r={};if(n.data)for(const u of n.data){const[m,E]=u.split(": "),g=parseFloat(E);r[m]=g||E}const{points:o}=n,a=new Float32Array(o.length*3);for(let u=0;u<o.length;u++){const{x:m,y:E,z:g}=o[u];a[u*3]=m,a[u*3+1]=E,a[u*3+2]=g||0}const l=new Ct(a,3),c=new zp;c.setAttribute("position",l);const p=new Yp(i,r,t,c,this.defLineMat);s.push(p.curve),i++}return s}};class Sf{getNameInfo(e){var t;const s={},{arguments:i}=e.GetHeaderLine(0,kp)||{};if(!i)return s;const[n,r,o,a,l,c,p]=i;if(n!=null&&n.value&&(s.name=n.value),r!=null&&r.value&&(s.creationDate=new Date(r.value)),o){s.author={};const[u,m]=o;u!=null&&u.value&&(s.author.name=u.value),m!=null&&m.value&&(s.author.email=m.value)}return(t=a[0])!=null&&t.value&&(s.organization=a[0].value),l!=null&&l.value&&(s.preprocessorVersion=l==null?void 0:l.value),c!=null&&c.value&&(s.originatingSystem=c==null?void 0:c.value),p!=null&&p.value&&(s.authorization=p==null?void 0:p.value),s}getDescriptionInfo(e){var t;const s={},{arguments:i}=e.GetHeaderLine(0,Vp)||{};if(!i)return s;const[n,r]=i;if((t=n[0])!=null&&t.value){const o=n[0].value.match(/\[([^\]]+)\]/);o&&o[1]&&(s.viewDefinition=o[1])}return r!=null&&r.value&&(s.implementationLevel=r.value),s}}class Of{static get(e,t){const s=[or,ar,lr,cn,Qt,Xp,Kp,Zp,jp],i=e.data;for(const n of s){const r=t.GetLineIDsWithType(0,n),o=r.size();for(let a=0;a<o;a++){const l=r.get(a);i.has(l)||i.set(l,[[],[0,n]])}}}}const Pf=class Ic extends Tt{constructor(e){super(e),b(this,"onDisposed",new pe),b(this,"onIfcStartedLoading",new pe),b(this,"onSetup",new pe),b(this,"settings",new od),b(this,"webIfc",new gs),b(this,"enabled",!0),b(this,"_material",new er),b(this,"_spatialTree",new Ff),b(this,"_metaData",new Sf),b(this,"_fragmentInstances",new Map),b(this,"_civil",new Af),b(this,"_visitedFragments",new Map),b(this,"_materialT",new er({transparent:!0,opacity:.5})),this.components.add(Ic.uuid,this),this.settings.excludedCategories.add(Tl)}dispose(){this.webIfc=null,this.onDisposed.trigger(Ic.uuid),this.onDisposed.reset()}async setup(e){this.settings={...this.settings,...e},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(e,t=!0){const s=performance.now();this.onIfcStartedLoading.trigger(),await this.readIfcFile(e);const i=await this.getAllGeometries(),n=await this.components.get(sI).export(this.webIfc,0);i.setLocalProperties(n);const r=this.components.get(ls);r.groups.set(i.uuid,i);for(const o of i.items)r.list.set(o.id,o),o.mesh.uuid=o.id,o.group=i;r.onFragmentsLoaded.trigger(i),t&&r.coordinate([i]);for(const[o]of i.data){const a=n[o];if(!a||!a.GlobalId)continue;const l=a.GlobalId.value||a.GlobalId;i.globalToExpressIDs.set(l,o)}return Of.get(i,this.webIfc),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-s} ms!`),i}async readIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;return this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(e,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new gs,this._visitedFragments.clear(),this._fragmentInstances.clear()}async getAllGeometries(){this._spatialTree.setUp(this.webIfc);const e=this.webIfc.GetIfcEntityList(0),t=new yl;t.ifcMetadata={name:"",description:"",...this._metaData.getNameInfo(this.webIfc),...this._metaData.getDescriptionInfo(this.webIfc),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};const s=[];for(const n of e){if(!this.webIfc.IsIfcElement(n)&&n!==Qt)continue;const r=this.settings.includedCategories;if(r.size>0&&!r.has(n)||this.settings.excludedCategories.has(n))continue;const o=this.webIfc.GetLineIDsWithType(0,n),a=o.size();for(let l=0;l<a;l++){const c=o.get(l);s.push(c);const p=this._spatialTree.itemsByFloor[c]||0;t.data.set(c,[[],[p,n]])}}this._spatialTree.cleanUp(),this.webIfc.StreamMeshes(0,s,n=>{this.getMesh(n,t)});for(const n of this._visitedFragments){const{index:r,fragment:o}=n[1];t.keyFragments.set(r,o.id)}for(const n of t.items){const r=this._fragmentInstances.get(n.id);if(!r)throw new Error("Fragment not found!");const o=[];for(const[a,l]of r)o.push(l);n.add(o)}const i=this.webIfc.GetCoordinationMatrix(0);return t.coordinationMatrix.fromArray(i),t.civilData=this._civil.read(this.webIfc),t}getMesh(e,t){const s=e.geometries.size(),i=e.expressID;for(let n=0;n<s;n++){const r=e.geometries.get(n),{x:o,y:a,z:l,w:c}=r.color,p=c!==1,{geometryExpressID:u}=r,m=`${u}-${p}`;if(!this._visitedFragments.has(m)){const C=this.getGeometry(this.webIfc,u),F=p?this._materialT:this._material,M=new ho(C,F,1);t.add(M.mesh),t.items.push(M);const _=this._visitedFragments.size;this._visitedFragments.set(m,{index:_,fragment:M})}const E=new ft().setRGB(o,a,l,"srgb"),g=new de;g.fromArray(r.flatTransformation);const T=this._visitedFragments.get(m);if(T===void 0)throw new Error("Error getting geometry data for streaming!");const y=t.data.get(i);if(!y)throw new Error("Data not found!");y[0].push(T.index);const{fragment:v}=T;this._fragmentInstances.has(v.id)||this._fragmentInstances.set(v.id,new Map);const A=this._fragmentInstances.get(v.id);if(!A)throw new Error("Instances not found!");if(A.has(i)){const C=A.get(i);if(!C)throw new Error("Instance not found!");C.transforms.push(g),C.colors&&C.colors.push(E)}else A.set(i,{id:i,transforms:[g],colors:[E]})}}getGeometry(e,t){const s=e.GetGeometry(0,t),i=e.GetIndexArray(s.GetIndexData(),s.GetIndexDataSize()),n=e.GetVertexArray(s.GetVertexData(),s.GetVertexDataSize()),r=new Float32Array(n.length/2),o=new Float32Array(n.length/2);for(let p=0;p<n.length;p+=6)r[p/2]=n[p],r[p/2+1]=n[p+1],r[p/2+2]=n[p+2],o[p/2]=n[p+3],o[p/2+1]=n[p+4],o[p/2+2]=n[p+5];const a=new ze,l=new Ct(r,3),c=new Ct(o,3);return a.setAttribute("position",l),a.setAttribute("normal",c),a.setIndex(Array.from(i)),s.delete(),a}async autoSetWasm(){const e=await fetch(`https://unpkg.com/@thatopen/components@${Rg.release}/package.json`);if(!e.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const t=await e.json();if(!("web-ifc"in t.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const s=t.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${s}/`,this.settings.wasm.absolute=!0}}};b(Pf,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");let nI=Pf;const bf=class Kn extends Tt{constructor(e){super(e),b(this,"onDisposed",new pe),b(this,"onRequestFile",new pe),b(this,"ifcToExport",null),b(this,"onElementToPset",new pe),b(this,"onPropToPset",new pe),b(this,"onPsetRemoved",new pe),b(this,"onDataChanged",new pe),b(this,"wasm",{path:"/",absolute:!1}),b(this,"enabled",!0),b(this,"attributeListeners",{}),b(this,"selectedModel"),b(this,"changeMap",{}),this.components.add(Kn.uuid,this)}dispose(){this.selectedModel=void 0,this.attributeListeners={},this.changeMap={},this.onElementToPset.reset(),this.onPropToPset.reset(),this.onPsetRemoved.reset(),this.onDataChanged.reset(),this.onDisposed.trigger(Kn.uuid),this.onDisposed.reset()}static getIFCSchema(e){const t=e.ifcMetadata.schema;if(!t)throw new Error("IFC Schema not found");return t.startsWith("IFC2X3")?"IFC2X3":t.startsWith("IFC4")&&t.replace("IFC4","")===""?"IFC4":t.startsWith("IFC4X3")?"IFC4X3":t}async setData(e,...t){for(const s of t){const i=s.expressID;i&&(await e.setProperties(i,s),this.registerChange(e,i))}}async newPset(e,t,s){const i=Kn.getIFCSchema(e),{ownerHistoryHandle:n}=await this.getOwnerHistory(e),r=this.newGUID(e),o=new St[i].IfcLabel(t),a=s?new St[i].IfcText(s):null,l=new St[i].IfcPropertySet(r,n,o,a,[]);l.expressID=this.increaseMaxID(e);const c=this.newGUID(e),p=new St[i].IfcRelDefinesByProperties(c,n,null,null,[],new Oi(l.expressID));return p.expressID=this.increaseMaxID(e),await this.setData(e,l,p),{pset:l,rel:p}}async removePset(e,...t){for(const s of t){const i=await e.getProperties(s);if((i==null?void 0:i.type)!==tr)continue;const n=await tn.getPsetRel(e,s);if(n&&(await e.setProperties(n,null),this.registerChange(e,n)),i){for(const r of i.HasProperties)await e.setProperties(r.value,null);await e.setProperties(s,null),this.onPsetRemoved.trigger({model:e,psetID:s}),this.registerChange(e,s)}}}newSingleStringProperty(e,t,s,i){return this.newSingleProperty(e,t,s,i)}newSingleNumericProperty(e,t,s,i){return this.newSingleProperty(e,t,s,i)}newSingleBooleanProperty(e,t,s,i){return this.newSingleProperty(e,t,s,i)}async removePsetProp(e,t,s){const i=await e.getProperties(t),n=await e.getProperties(s);!i||!n||i.type===tr&&n&&(i.HasProperties=i.HasProperties.filter(r=>r.value!==s),await e.setProperties(s,null),this.registerChange(e,t,s))}async addElementToPset(e,t,...s){const i=await tn.getPsetRel(e,t);if(!i)return;const n=await e.getProperties(i);if(!n)return;for(const o of s){const a=new Oi(o);n.RelatedObjects.push(a),this.onElementToPset.trigger({model:e,psetID:t,elementID:o})}this.registerChange(e,t);const r=this.components.get(Rl);for(const o of s)r.addEntityRelations(e,o,"IsDefinedBy",t)}async addPropToPset(e,t,...s){const i=await e.getProperties(t);if(i){for(const n of s){if(i.HasProperties.includes(n))continue;const r=new Oi(n);i.HasProperties.push(r),this.onPropToPset.trigger({model:e,psetID:t,propID:n})}this.registerChange(e,t)}}async saveToIfc(e,t){const s=this.components.get(nI),i=s.webIfc,n=await s.readIfcFile(t),r=this.changeMap[e.uuid]??[];for(const a of r){const l=await e.getProperties(a);if(l)try{i.WriteLine(n,l)}catch{}else try{i.DeleteLine(n,a)}catch{}}const o=i.SaveModel(n);return s.webIfc.CloseModel(n),s.cleanUp(),o}async setAttributeListener(e,t,s){this.attributeListeners[e.uuid]||(this.attributeListeners[e.uuid]={});const i=this.attributeListeners[e.uuid][t]?this.attributeListeners[e.uuid][t][s]:null;if(i)return i;const n=await e.getProperties(t);if(!n)throw new Error(`Entity with expressID ${t} doesn't exists.`);const r=n[s];if(Array.isArray(r)||!r)throw new Error(`Attribute ${s} is array or null, and it can't have a listener.`);const o=r.value;if(o===void 0||o==null)throw new Error(`Attribute ${s} has a badly defined handle.`);const a=new pe;return Object.defineProperty(n[s],"value",{get(){return this._value},async set(l){this._value=l,a.trigger(l)}}),n[s].value=o,this.attributeListeners[e.uuid][t]||(this.attributeListeners[e.uuid][t]={}),this.attributeListeners[e.uuid][t][s]=a,a}increaseMaxID(e){return e.ifcMetadata.maxExpressID++,e.ifcMetadata.maxExpressID}newGUID(e){const t=Kn.getIFCSchema(e);return new St[t].IfcGloballyUniqueId(nd.create())}async getOwnerHistory(e){const t=await e.getAllPropertiesOfType(Np);if(!t)throw new Error("No OwnerHistory was found.");const s=Object.keys(t).map(r=>parseInt(r,10)),i=t[s[0]],n=new Oi(i.expressID);return{ownerHistory:i,ownerHistoryHandle:n}}registerChange(e,...t){this.changeMap[e.uuid]||(this.changeMap[e.uuid]=new Set);for(const s of t)this.changeMap[e.uuid].add(s),this.onDataChanged.trigger({model:e,expressID:s})}async newSingleProperty(e,t,s,i){const n=Kn.getIFCSchema(e),r=new St[n].IfcIdentifier(s),o=new St[n][t](i),a=new St[n].IfcPropertySingleValue(r,null,o,null);return a.expressID=this.increaseMaxID(e),await this.setData(e,a),a}};b(bf,"uuid","58c2d9f0-183c-48d6-a402-dfcf5b9a34df");let ty=bf;const xf=class Mf extends Tt{constructor(e){super(e),b(this,"enabled",!0),b(this,"list",{}),b(this,"onDisposed",new pe),b(this,"onFragmentsDisposed",t=>{const{groupID:s,fragmentIDs:i}=t;for(const n in this.list){const r=this.list[n],o=Object.keys(r);if(o.includes(s))delete r[s],Object.values(r).length===0&&delete this.list[n];else for(const a of o){const l=r[a];for(const c of i)delete l.map[c];Object.values(l).length===0&&delete r[a]}}}),e.add(Mf.uuid,this),e.get(ls).onFragmentsDisposed.add(this.onFragmentsDisposed)}dispose(){this.list={},this.components.get(ls).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(),this.onDisposed.reset()}remove(e){for(const t in this.list){const s=this.list[t];for(const i in s){const n=s[i];delete n.map[e]}}}find(e){const t=this.components.get(ls);if(!e){const r={};for(const[o,a]of t.list)r[o]=new Set(a.ids);return r}const s=Object.keys(e).length,i={};for(const r in e){const o=e[r];if(!this.list[r]){console.warn(`Classification ${r} does not exist.`);continue}for(const a of o){const l=this.list[r][a];if(l)for(const c in l.map){i[c]||(i[c]=new Map);for(const p of l.map[c]){const u=i[c].get(p);u===void 0?i[c].set(p,1):i[c].set(p,u+1)}}}}const n={};for(const r in i){const o=i[r];for(const[a,l]of o){if(l===void 0)throw new Error("Malformed fragments map!");l===s&&(n[r]||(n[r]=new Set),n[r].add(a))}}return n}byModel(e,t){this.list.models||(this.list.models={});const s=this.list.models;s[e]||(s[e]={map:{},id:null,name:e});const i=s[e];for(const[n,r]of t.data){const o=r[0];for(const a of o){const l=t.keyFragments.get(a);l&&(i.map[l]||(i.map[l]=new Set),i.map[l].add(n))}}}async byPredefinedType(e){var t;this.list.predefinedTypes||(this.list.predefinedTypes={});const s=this.list.predefinedTypes,i=e.getAllPropertiesIDs();for(const n of i){const r=await e.getProperties(n);if(!r)continue;const o=String((t=r.PredefinedType)==null?void 0:t.value).toUpperCase();s[o]||(s[o]={map:{},id:null,name:o});const a=s[o];for(const[l,c]of e.data){const p=c[0];for(const u of p){const m=e.keyFragments.get(u);if(!m)throw new Error("Fragment ID not found!");a.map[m]||(a.map[m]=new Set),a.map[m].add(r.expressID)}}}}byEntity(e){this.list.entities||(this.list.entities={});for(const[t,s]of e.data){const i=s[1][1],n=Rf[i];this.saveItem(e,"entities",n,t)}}async byIfcRel(e,t,s){tn.isRel(t)&&await tn.getRelationMap(e,t,async(i,n)=>{const{name:r}=await tn.getEntityName(e,i);for(const o of n)this.saveItem(e,s,r??"NO REL NAME",o)})}async bySpatialStructure(e,t={}){var s,i;const n=this.components.get(Rl),r=n.relationMaps[e.uuid];if(!r)throw new Error(`Classifier: model relations of ${e.name||e.uuid} have to exists to group by spatial structure.`);const o="spatialStructures",a=t.useProperties===void 0||t.useProperties;for(const[l]of r){if(t.isolate){const m=e.data.get(l);if(!m)continue;const E=m[1][1];if(E===void 0||!t.isolate.has(E))continue}const c=n.getEntityRelations(e,l,"Decomposes");if(c)for(const m of c){let E=m.toString();if(a){const g=await e.getProperties(m);if(!g)continue;E=(s=g.Name)==null?void 0:s.value}this.saveItem(e,o,E,l,m)}const p=n.getEntityRelations(e,l,"ContainsElements");if(!p)continue;let u=l.toString();if(a){const m=await e.getProperties(l);if(!m)continue;u=(i=m.Name)==null?void 0:i.value}for(const m of p){this.saveItem(e,o,u,m,l);const E=n.getEntityRelations(e,Number(m),"IsDecomposedBy");if(E)for(const g of E)this.saveItem(e,o,u,g,l)}}}setColor(e,t,s=!1){const i=this.components.get(ls);for(const n in e){const r=i.list.get(n);if(!r)continue;const o=e[n];r.setColor(t,o,s)}}resetColor(e){const t=this.components.get(ls);for(const s in e){const i=t.list.get(s);if(!i)continue;const n=e[s];i.resetColor(n)}}saveItem(e,t,s,i,n=null){this.list[t]||(this.list[t]={});const r=e.data.get(i);if(r)for(const o of r[0]){const a=e.keyFragments.get(o);if(a){const l=this.list[t];l[s]||(l[s]={map:{},id:n,name:s}),l[s].map[a]||(l[s].map[a]=new Set),l[s].map[a].add(i)}}}};b(xf,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");let rI=xf;const oI=class _f extends Tt{constructor(e){super(e),b(this,"onDisposed",new pe),b(this,"enabled",!0),b(this,"height",10),b(this,"groupName","spatialStructures"),b(this,"list",new Set),e.add(_f.uuid,this)}dispose(){this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}set(e){if(!this.enabled)return;const t=this.components.get(rI),s=this.components.get(ls),i=e?1:-1;let n=0;const r=t.list[this.groupName],o=new de;for(const a in r){o.elements[13]=n*i*this.height;for(const l in r[a].map){const c=s.list.get(l),p=a+l,u=this.list.has(p);if(!c||e&&u||!e&&!u)continue;e?this.list.add(p):this.list.delete(p);const m=r[a].map[l];c.applyTransform(m,o),c.mesh.computeBoundingSphere(),c.mesh.computeBoundingBox()}n++}}};b(oI,"uuid","d260618b-ce88-4c7d-826c-6debb91de3e2");const Lf=class Nf extends Tt{constructor(e){super(e),b(this,"enabled",!0),this.components.add(Nf.uuid,this)}set(e,t){const s=this.components.get(ls);if(!t){for(const[i,n]of s.list)n&&(n.setVisibility(e),this.updateCulledVisibility(n));return}for(const i in t){const n=t[i],r=s.list.get(i);r&&(r.setVisibility(e,n),this.updateCulledVisibility(r))}}isolate(e){this.set(!1),this.set(!0,e)}updateCulledVisibility(e){const t=this.components.get(Dg);for(const[s,i]of t.list){const n=i.colorMeshes.get(e.id);n&&(n.count=e.mesh.count)}}};b(Lf,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");let sy=Lf;class aI extends od{constructor(){super(...arguments),b(this,"minGeometrySize",10),b(this,"minAssetsSize",1e3)}}const lI=class Df extends Tt{constructor(e){super(e),b(this,"onGeometryStreamed",new pe),b(this,"onAssetStreamed",new pe),b(this,"onProgress",new pe),b(this,"onIfcLoaded",new pe),b(this,"onDisposed",new pe),b(this,"settings",new aI),b(this,"enabled",!0),b(this,"webIfc",new gs),b(this,"_spatialTree",new Ff),b(this,"_metaData",new Sf),b(this,"_visitedGeometries",new Map),b(this,"_streamSerializer",new jc),b(this,"_geometries",new Map),b(this,"_geometryCount",0),b(this,"_civil",new Af),b(this,"_groupSerializer",new Cl),b(this,"_assets",[]),b(this,"_meshesWithHoles",new Set),this.components.add(Df.uuid,this),this.settings.excludedCategories.add(Tl)}dispose(){this.onIfcLoaded.reset(),this.onGeometryStreamed.reset(),this.onAssetStreamed.reset(),this.webIfc=null,this.onDisposed.trigger(),this.onDisposed.reset()}async streamFromBuffer(e){await this.readIfcFile(e),await this.streamAllGeometries(),this.cleanUp()}async streamFromCallBack(e){await this.streamIfcFile(e),await this.streamAllGeometries(),this.cleanUp()}async readIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(e,this.settings.webIfc)}async streamIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)}async streamAllGeometries(){const{minGeometrySize:e,minAssetsSize:t}=this.settings;this._spatialTree.setUp(this.webIfc);const s=this.webIfc.GetIfcEntityList(0),i=[[]],n=new yl;n.ifcMetadata={name:"",description:"",...this._metaData.getNameInfo(this.webIfc),...this._metaData.getDescriptionInfo(this.webIfc),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};let r=0,o=0;for(const E of s){if(!this.webIfc.IsIfcElement(E)&&E!==Qt||this.settings.excludedCategories.has(E))continue;const g=this.webIfc.GetLineIDsWithType(0,E),T=g.size();for(let y=0;y<T;y++){r>e&&(r=0,o++,i.push([]));const v=g.get(y);i[o].push(v);const A=this.webIfc.GetLine(0,v);if(A.GlobalId){const F=(A==null?void 0:A.GlobalId.value)||(A==null?void 0:A.GlobalId);n.globalToExpressIDs.set(F,v)}const C=this._spatialTree.itemsByFloor[v]||0;n.data.set(v,[[],[C,E]]),r++}}this._spatialTree.cleanUp();let a=.01,l=0;for(const E of i){l++,this.webIfc.StreamMeshes(0,E,T=>{this.getMesh(this.webIfc,T,n)}),this._geometryCount>e&&await this.streamGeometries(),this._assets.length>t&&await this.streamAssets();const g=l/i.length;g>a&&(a+=.01,a=Math.max(a,g),this.onProgress.trigger(Math.round(a*100)/100))}this._geometryCount&&await this.streamGeometries(),this._assets.length&&await this.streamAssets();const{opaque:c,transparent:p}=n.geometryIDs;for(const[E,{index:g,uuid:T}]of this._visitedGeometries)n.keyFragments.set(g,T),(E>1?c:p).set(E,g);Of.get(n,this.webIfc);const u=this.webIfc.GetCoordinationMatrix(0);n.coordinationMatrix.fromArray(u),n.civilData=this._civil.read(this.webIfc);const m=this._groupSerializer.export(n);this.onIfcLoaded.trigger(m),n.dispose(!0)}cleanUp(){try{this.webIfc.Dispose()}catch{}this.webIfc=null,this.webIfc=new gs,this._visitedGeometries.clear(),this._geometries.clear(),this._assets=[],this._meshesWithHoles.clear()}getMesh(e,t,s){const i=t.geometries.size(),n=t.expressID,r={id:n,geometries:[]};for(let o=0;o<i;o++){const a=t.geometries.get(o),l=a.geometryExpressID,c=a.color.w===1?1:-1,p=l*c;if(!this._visitedGeometries.has(p)){this._visitedGeometries.has(l)||this.getGeometry(e,l);const C=this._visitedGeometries.size,F=ln.generateUUID();this._visitedGeometries.set(p,{uuid:F,index:C})}const u=this._visitedGeometries.get(p);if(u===void 0)throw new Error("Error getting geometry data for streaming!");const m=s.data.get(n);if(!m)throw new Error("Data not found!");m[0].push(u.index);const{x:E,y:g,z:T,w:y}=a.color,v=[E,g,T,y],A=a.flatTransformation;r.geometries.push({color:v,geometryID:l,transformation:A})}this._assets.push(r)}getGeometry(e,t){const s=e.GetGeometry(0,t),i=e.GetIndexArray(s.GetIndexData(),s.GetIndexDataSize()),n=e.GetVertexArray(s.GetVertexData(),s.GetVertexDataSize()),r=new Float32Array(n.length/2),o=new Float32Array(n.length/2);for(let u=0;u<n.length;u+=6)r[u/2]=n[u],r[u/2+1]=n[u+1],r[u/2+2]=n[u+2],o[u/2]=n[u+3],o[u/2+1]=n[u+4],o[u/2+2]=n[u+5];const a=wg(r),l=new Float32Array(a.transformation.elements),c=[a.center.x,a.center.y,a.center.z];let p=!1;for(let u=0;u<r.length-2;u+=3){const m=r[u],E=r[u+1],g=r[u+2],T=o[u],y=o[u+1],v=o[u+2];if(vg(c,[m,E,g],[T,y,v])){p=!0;break}}this._geometries.set(t,{position:r,normal:o,index:i,boundingBox:l,hasHoles:p}),s.delete(),this._geometryCount++}async streamAssets(){await this.onAssetStreamed.trigger(this._assets),this._assets=null,this._assets=[]}async streamGeometries(){let e=this._streamSerializer.export(this._geometries),t={};for(const[s,{boundingBox:i,hasHoles:n}]of this._geometries)t[s]={boundingBox:i,hasHoles:n};this.onGeometryStreamed.trigger({data:t,buffer:e}),t=null,e=null,this._geometries.clear(),this._geometryCount=0}};b(lI,"uuid","d9999a00-e1f5-4d3f-8cfe-c56e08609764");let hI=class extends od{constructor(){super(...arguments),b(this,"propertiesSize",100)}},cI=class extends Tt{constructor(){super(...arguments),b(this,"onPropertiesStreamed",new Ka),b(this,"onProgress",new Ka),b(this,"onIndicesStreamed",new Ka),b(this,"onDisposed",new pe),b(this,"enabled",!0),b(this,"settings",new hI),b(this,"webIfc",new gs)}async dispose(){this.onIndicesStreamed.reset(),this.onPropertiesStreamed.reset(),this.webIfc=null,this.onDisposed.reset()}async streamFromBuffer(e){await this.readIfcFile(e),await this.streamAllProperties(),this.cleanUp()}async streamFromCallBack(e){await this.streamIfcFile(e),await this.streamAllProperties(),this.cleanUp()}async readIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(e,this.settings.webIfc)}async streamIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)}async streamAllProperties(){const{propertiesSize:e}=this.settings,t=new Set(this.webIfc.GetIfcEntityList(0)),s=new Set([or,ar,lr,cn,Qt]);for(const o of s)t.add(o);let i=.01,n=0;for(const o of t){if(n++,yf.has(o))continue;const a=s.has(o),l=this.webIfc.GetLineIDsWithType(0,o),c=l.size();let p=0;for(let u=0;u<c-e;u+=e){const m={};for(let E=0;E<e;E++){p++;const g=l.get(u+E);try{const T=this.webIfc.GetLine(0,g,a);m[T.expressID]=T}catch{console.log(`Could not get property: ${g}`)}}await this.onPropertiesStreamed.trigger({type:o,data:m})}if(p!==c){const u={};for(let m=p;m<c;m++){const E=l.get(m);try{const g=this.webIfc.GetLine(0,E,a);u[g.expressID]=g}catch{console.log(`Could not get property: ${E}`)}}await this.onPropertiesStreamed.trigger({type:o,data:u})}n/t.size>i&&(i=Math.round(i*100)/100,await this.onProgress.trigger(i),i+=.01)}await this.onProgress.trigger(1);const r=await this.components.get(Rl).processFromWebIfc(this.webIfc,0);await this.onIndicesStreamed.trigger(r)}cleanUp(){this.webIfc.Dispose(),this.webIfc=null,this.webIfc=new gs}};b(cI,"uuid","88d2c89c-ce32-47d7-8cb6-d51e4b311a0b");const dI=class Uf extends Tt{constructor(e){super(e),b(this,"enabled",!0),e.add(Uf.uuid,this)}static distanceFromPointToLine(e,t,s,i=!1){const n=new at,r=new O;return n.set(t,s),n.closestPointToPoint(e,i,r),r.distanceTo(e)}getFace(e,t,s){if(!e.geometry.index)throw new Error("Geometry must be indexed!");const i=new Map,n=e.geometry.index.array,{plane:r}=this.getFaceData(t,s,e),o=[];for(let p=0;p<n.length/3;p++){const{plane:u,edges:m}=this.getFaceData(p,s,e);if(u.equals(r)){o.push({index:p,edges:m});for(const{id:E,points:g,distance:T}of m)i.set(E,{points:g,distance:T})}}let a=0;const l=new Map,c=new Map;for(const{index:p,edges:u}of o){const m=new Map;for(const{id:C}of u)if(l.has(C)){const F=l.get(C);m.set(C,F)}const E=u.map(C=>C.id);if(!m.size){const C=a++;for(const{id:F}of u)l.set(F,C);c.set(C,{edges:new Set(E),indices:new Set([p])});continue}let g=null;const T=new Set,y=new Set(E);for(const[C,F]of m){g===null?g=F:F!==g&&T.add(F),l.delete(C);const{edges:M}=c.get(F);M.delete(C),y.delete(C)}if(g===null)throw new Error("Error computing face!");const v=c.get(g),{indices:A}=v;A.add(p);for(const C of y){l.set(C,g);const{edges:F}=v;F.add(C)}for(const C of T){const F=c.get(C),{edges:M,indices:_}=F,L=c.get(g),{edges:D,indices:B}=L;for(const z of M)D.add(z),l.set(z,g);for(const z of _)B.add(z);c.delete(C)}}for(const[p,{indices:u,edges:m}]of c)if(u.has(t)){const E=[];for(const g of m){const T=i.get(g);E.push(T)}return{edges:E,indices:u}}return null}getVerticesAndNormal(e,t,s){if(!e.geometry.index)throw new Error("Geometry must be indexed!");const i=e.geometry.index.array,n=e.geometry.attributes.position.array,r=e.geometry.attributes.normal.array,o=i[t*3]*3,a=i[t*3+1]*3,l=i[t*3+2]*3,c=new O(n[o],n[o+1],n[o+2]),p=new O(n[a],n[a+1],n[a+2]),u=new O(n[l],n[l+1],n[l+2]),m=new O(r[o],r[o+1],r[o+2]),E=new O(r[a],r[a+1],r[a+2]),g=new O(r[l],r[l+1],r[l+2]),T=(m.x+E.x+g.x)/3,y=(m.y+E.y+g.y)/3,v=(m.z+E.z+g.z)/3,A=new O(T,y,v);if(s!==void 0&&e instanceof Ot){const C=new de;e.getMatrixAt(s,C);const F=new de;F.extractRotation(C),A.applyMatrix4(F),c.applyMatrix4(C),p.applyMatrix4(C),u.applyMatrix4(C)}return{p1:c,p2:p,p3:u,faceNormal:A}}round(e){e.x=Math.trunc(e.x*1e3)/1e3,e.y=Math.trunc(e.y*1e3)/1e3,e.z=Math.trunc(e.z*1e3)/1e3}getVolumeFromFragments(e){const t=this.components.get(ls),s=new de,i=[];for(const r in e){const o=t.list.get(r);if(!o)continue;const a=e[r];let l=0;for(const u of a){const m=o.getInstancesIDs(u);m&&(l+=m.size)}const c=new Ot(o.mesh.geometry,void 0,l);let p=0;for(const u of a){const m=o.getInstancesIDs(u);if(m)for(const E of m)o.mesh.getMatrixAt(E,s),c.setMatrixAt(p++,s)}i.push(c)}const n=this.getVolumeFromMeshes(i);for(const r of i)r.geometry=null,r.material=[],r.dispose();return n}getVolumeFromMeshes(e){let t=0;for(const s of e)t+=this.getVolumeOfMesh(s);return t}getFaceData(e,t,s){const i=this.getVerticesAndNormal(s,e,t),{p1:n,p2:r,p3:o,faceNormal:a}=i;this.round(n),this.round(r),this.round(o),this.round(a);const l=[{id:`${n.x}|${n.y}|${n.z}`,value:n},{id:`${r.x}|${r.y}|${r.z}`,value:r},{id:`${o.x}|${o.y}|${o.z}`,value:o}];l.sort((v,A)=>v.id<A.id?-1:v.id>A.id?1:0);const[{id:c,value:p},{id:u,value:m},{id:E,value:g}]=l,T=[{id:`${c}|${u}`,distance:p.distanceTo(m),points:[p,m]},{id:`${u}|${E}`,distance:m.distanceTo(g),points:[m,g]},{id:`${c}|${E}`,distance:p.distanceTo(g),points:[p,g]}],y=new jt;return y.setFromNormalAndCoplanarPoint(a,n),y.constant=Math.round(y.constant*10)/10,{plane:y,edges:T}}getVolumeOfMesh(e){let t=0;const s=new O,i=new O,n=new O,{index:r}=e.geometry,o=e.geometry.attributes.position.array;if(!r)return console.warn("Geometry must be indexed to compute its volume!"),0;const a=[];if(e instanceof Ot)for(let c=0;c<e.count;c++){const p=new de;e.getMatrixAt(c,p),a.push(p)}else a.push(new de().identity());const{matrixWorld:l}=e;for(let c=0;c<r.array.length-2;c+=3)for(const p of a){const u=p.multiply(l),m=r.array[c]*3,E=r.array[c+1]*3,g=r.array[c+2]*3;s.set(o[m],o[m+1],o[m+2]).applyMatrix4(u),i.set(o[E],o[E+1],o[E+2]).applyMatrix4(u),n.set(o[g],o[g+1],o[g+2]).applyMatrix4(u),t+=this.getSignedVolumeOfTriangle(s,i,n)}return Math.abs(t)}getSignedVolumeOfTriangle(e,t,s){const i=s.x*t.y*e.z,n=t.x*s.y*e.z,r=s.x*e.y*t.z,o=e.x*s.y*t.z,a=t.x*e.y*s.z,l=e.x*t.y*s.z;return 1/6*(-i+n+r-o-a+l)}};b(dI,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");var uI=Object.defineProperty,pI=(h,e,t)=>e in h?uI(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t,S=(h,e,t)=>(pI(h,typeof e!="symbol"?e+"":e,t),t),fI=Object.defineProperty,mI=(h,e,t)=>e in h?fI(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t,x=(h,e,t)=>(mI(h,typeof e!="symbol"?e+"":e,t),t);const Bf=0,EI=1,gI=2,Nu=2,_h=1.25,Du=1,Qa=6*4+4+4,Fl=65535,II=Math.pow(2,-24),Lh=Symbol("SKIP_GENERATION");function CI(h){return h.index?h.index.count:h.attributes.position.count}function cr(h){return CI(h)/3}function TI(h,e=ArrayBuffer){return h>65535?new Uint32Array(new e(4*h)):new Uint16Array(new e(2*h))}function yI(h,e){if(!h.index){const t=h.attributes.position.count,s=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=TI(t,s);h.setIndex(new Ct(i,1));for(let n=0;n<t;n++)i[n]=n}}function zf(h){const e=cr(h),t=h.drawRange,s=t.start/3,i=(t.start+t.count)/3,n=Math.max(0,s),r=Math.min(e,i)-n;return[{offset:Math.floor(n),count:Math.floor(r)}]}function Yf(h){if(!h.groups||!h.groups.length)return zf(h);const e=[],t=new Set,s=h.drawRange,i=s.start/3,n=(s.start+s.count)/3;for(const o of h.groups){const a=o.start/3,l=(o.start+o.count)/3;t.add(Math.max(i,a)),t.add(Math.min(n,l))}const r=Array.from(t.values()).sort((o,a)=>o-a);for(let o=0;o<r.length-1;o++){const a=r[o],l=r[o+1];e.push({offset:Math.floor(a),count:Math.floor(l-a)})}return e}function wI(h){if(h.groups.length===0)return!1;const e=cr(h),t=Yf(h).sort((n,r)=>n.offset-r.offset),s=t[t.length-1];s.count=Math.min(e-s.offset,s.count);let i=0;return t.forEach(({count:n})=>i+=n),e!==i}function ht(h,e,t){return t.min.x=e[h],t.min.y=e[h+1],t.min.z=e[h+2],t.max.x=e[h+3],t.max.y=e[h+4],t.max.z=e[h+5],t}function vI(h){h[0]=h[1]=h[2]=1/0,h[3]=h[4]=h[5]=-1/0}function Uu(h){let e=-1,t=-1/0;for(let s=0;s<3;s++){const i=h[s+3]-h[s];i>t&&(t=i,e=s)}return e}function Bu(h,e){e.set(h)}function zu(h,e,t){let s,i;for(let n=0;n<3;n++){const r=n+3;s=h[n],i=e[n],t[n]=s<i?s:i,s=h[r],i=e[r],t[r]=s>i?s:i}}function fa(h,e,t){for(let s=0;s<3;s++){const i=e[h+2*s],n=e[h+2*s+1],r=i-n,o=i+n;r<t[s]&&(t[s]=r),o>t[s+3]&&(t[s+3]=o)}}function kr(h){const e=h[3]-h[0],t=h[4]-h[1],s=h[5]-h[2];return 2*(e*t+t*s+s*e)}function Nh(h,e,t,s,i=null){let n=1/0,r=1/0,o=1/0,a=-1/0,l=-1/0,c=-1/0,p=1/0,u=1/0,m=1/0,E=-1/0,g=-1/0,T=-1/0;const y=i!==null;for(let v=e*6,A=(e+t)*6;v<A;v+=6){const C=h[v+0],F=h[v+1],M=C-F,_=C+F;M<n&&(n=M),_>a&&(a=_),y&&C<p&&(p=C),y&&C>E&&(E=C);const L=h[v+2],D=h[v+3],B=L-D,z=L+D;B<r&&(r=B),z>l&&(l=z),y&&L<u&&(u=L),y&&L>g&&(g=L);const V=h[v+4],Q=h[v+5],ne=V-Q,ue=V+Q;ne<o&&(o=ne),ue>c&&(c=ue),y&&V<m&&(m=V),y&&V>T&&(T=V)}s[0]=n,s[1]=r,s[2]=o,s[3]=a,s[4]=l,s[5]=c,y&&(i[0]=p,i[1]=u,i[2]=m,i[3]=E,i[4]=g,i[5]=T)}function RI(h,e,t,s){let i=1/0,n=1/0,r=1/0,o=-1/0,a=-1/0,l=-1/0;for(let c=e*6,p=(e+t)*6;c<p;c+=6){const u=h[c+0];u<i&&(i=u),u>o&&(o=u);const m=h[c+2];m<n&&(n=m),m>a&&(a=m);const E=h[c+4];E<r&&(r=E),E>l&&(l=E)}s[0]=i,s[1]=n,s[2]=r,s[3]=o,s[4]=a,s[5]=l}function FI(h,e){vI(e);const t=h.attributes.position,s=h.index?h.index.array:null,i=cr(h),n=new Float32Array(i*6),r=t.normalized,o=t.array,a=t.offset||0;let l=3;t.isInterleavedBufferAttribute&&(l=t.data.stride);const c=["getX","getY","getZ"];for(let p=0;p<i;p++){const u=p*3,m=p*6;let E=u+0,g=u+1,T=u+2;s&&(E=s[E],g=s[g],T=s[T]),r||(E=E*l+a,g=g*l+a,T=T*l+a);for(let y=0;y<3;y++){let v,A,C;r?(v=t[c[y]](E),A=t[c[y]](g),C=t[c[y]](T)):(v=o[E+y],A=o[g+y],C=o[T+y]);let F=v;A<F&&(F=A),C<F&&(F=C);let M=v;A>M&&(M=A),C>M&&(M=C);const _=(M-F)/2,L=y*2;n[m+L+0]=F+_,n[m+L+1]=_+(Math.abs(F)+_)*II,F<e[y]&&(e[y]=F),M>e[y+3]&&(e[y+3]=M)}}return n}const ri=32,AI=(h,e)=>h.candidate-e.candidate,wi=new Array(ri).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),ma=new Float32Array(6);function SI(h,e,t,s,i,n){let r=-1,o=0;if(n===Bf)r=Uu(e),r!==-1&&(o=(e[r]+e[r+3])/2);else if(n===EI)r=Uu(h),r!==-1&&(o=OI(t,s,i,r));else if(n===gI){const a=kr(h);let l=_h*i;const c=s*6,p=(s+i)*6;for(let u=0;u<3;u++){const m=e[u],E=(e[u+3]-m)/ri;if(i<ri/4){const g=[...wi];g.length=i;let T=0;for(let v=c;v<p;v+=6,T++){const A=g[T];A.candidate=t[v+2*u],A.count=0;const{bounds:C,leftCacheBounds:F,rightCacheBounds:M}=A;for(let _=0;_<3;_++)M[_]=1/0,M[_+3]=-1/0,F[_]=1/0,F[_+3]=-1/0,C[_]=1/0,C[_+3]=-1/0;fa(v,t,C)}g.sort(AI);let y=i;for(let v=0;v<y;v++){const A=g[v];for(;v+1<y&&g[v+1].candidate===A.candidate;)g.splice(v+1,1),y--}for(let v=c;v<p;v+=6){const A=t[v+2*u];for(let C=0;C<y;C++){const F=g[C];A>=F.candidate?fa(v,t,F.rightCacheBounds):(fa(v,t,F.leftCacheBounds),F.count++)}}for(let v=0;v<y;v++){const A=g[v],C=A.count,F=i-A.count,M=A.leftCacheBounds,_=A.rightCacheBounds;let L=0;C!==0&&(L=kr(M)/a);let D=0;F!==0&&(D=kr(_)/a);const B=Du+_h*(L*C+D*F);B<l&&(r=u,l=B,o=A.candidate)}}else{for(let y=0;y<ri;y++){const v=wi[y];v.count=0,v.candidate=m+E+y*E;const A=v.bounds;for(let C=0;C<3;C++)A[C]=1/0,A[C+3]=-1/0}for(let y=c;y<p;y+=6){let v=~~((t[y+2*u]-m)/E);v>=ri&&(v=ri-1);const A=wi[v];A.count++,fa(y,t,A.bounds)}const g=wi[ri-1];Bu(g.bounds,g.rightCacheBounds);for(let y=ri-2;y>=0;y--){const v=wi[y],A=wi[y+1];zu(v.bounds,A.rightCacheBounds,v.rightCacheBounds)}let T=0;for(let y=0;y<ri-1;y++){const v=wi[y],A=v.count,C=v.bounds,F=wi[y+1].rightCacheBounds;A!==0&&(T===0?Bu(C,ma):zu(C,ma,ma)),T+=A;let M=0,_=0;T!==0&&(M=kr(ma)/a);const L=i-T;L!==0&&(_=kr(F)/a);const D=Du+_h*(M*T+_*L);D<l&&(r=u,l=D,o=v.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${n} used.`);return{axis:r,pos:o}}function OI(h,e,t,s){let i=0;for(let n=e,r=e+t;n<r;n++)i+=h[n*6+s*2];return i/t}class Ea{constructor(){}}function PI(h,e,t,s,i,n){let r=s,o=s+i-1;const a=n.pos,l=n.axis*2;for(;;){for(;r<=o&&t[r*6+l]<a;)r++;for(;r<=o&&t[o*6+l]>=a;)o--;if(r<o){for(let c=0;c<3;c++){let p=e[r*3+c];e[r*3+c]=e[o*3+c],e[o*3+c]=p}for(let c=0;c<6;c++){let p=t[r*6+c];t[r*6+c]=t[o*6+c],t[o*6+c]=p}r++,o--}else return r}}function bI(h,e,t,s,i,n){let r=s,o=s+i-1;const a=n.pos,l=n.axis*2;for(;;){for(;r<=o&&t[r*6+l]<a;)r++;for(;r<=o&&t[o*6+l]>=a;)o--;if(r<o){let c=h[r];h[r]=h[o],h[o]=c;for(let p=0;p<6;p++){let u=t[r*6+p];t[r*6+p]=t[o*6+p],t[o*6+p]=u}r++,o--}else return r}}function xI(h,e){const t=(h.index?h.index.count:h.attributes.position.count)/3,s=t>2**16,i=s?4:2,n=e?new SharedArrayBuffer(t*i):new ArrayBuffer(t*i),r=s?new Uint32Array(n):new Uint16Array(n);for(let o=0,a=r.length;o<a;o++)r[o]=o;return r}function MI(h,e){const t=h.geometry,s=t.index?t.index.array:null,i=e.maxDepth,n=e.verbose,r=e.maxLeafTris,o=e.strategy,a=e.onProgress,l=cr(t),c=h._indirectBuffer;let p=!1;const u=new Float32Array(6),m=new Float32Array(6),E=FI(t,u),g=e.indirect?bI:PI,T=[],y=e.indirect?zf(t):Yf(t);if(y.length===1){const C=y[0],F=new Ea;F.boundingData=u,RI(E,C.offset,C.count,m),A(F,C.offset,C.count,m),T.push(F)}else for(let C of y){const F=new Ea;F.boundingData=new Float32Array(6),Nh(E,C.offset,C.count,F.boundingData,m),A(F,C.offset,C.count,m),T.push(F)}return T;function v(C){a&&a(C/l)}function A(C,F,M,_=null,L=0){if(!p&&L>=i&&(p=!0,n&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),M<=r||L>=i)return v(F+M),C.offset=F,C.count=M,C;const D=SI(C.boundingData,_,E,F,M,o);if(D.axis===-1)return v(F+M),C.offset=F,C.count=M,C;const B=g(c,s,E,F,M,D);if(B===F||B===F+M)v(F+M),C.offset=F,C.count=M;else{C.splitAxis=D.axis;const z=new Ea,V=F,Q=B-F;C.left=z,z.boundingData=new Float32Array(6),Nh(E,V,Q,z.boundingData,m),A(z,V,Q,m,L+1);const ne=new Ea,ue=B,oe=M-Q;C.right=ne,ne.boundingData=new Float32Array(6),Nh(E,ue,oe,ne.boundingData,m),A(ne,ue,oe,m,L+1)}return C}}function _I(h,e){const t=h.geometry;e.indirect&&(h._indirectBuffer=xI(t,e.useSharedArrayBuffer),wI(t)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),h._indirectBuffer||yI(t,e);const s=MI(h,e);let i,n,r;const o=[],a=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let p=0;p<s.length;p++){const u=s[p];let m=l(u);const E=new a(Qa*m);i=new Float32Array(E),n=new Uint32Array(E),r=new Uint16Array(E),c(0,u),o.push(E)}h._roots=o;return;function l(p){return p.count?1:1+l(p.left)+l(p.right)}function c(p,u){const m=p/4,E=p/2,g=!!u.count,T=u.boundingData;for(let y=0;y<6;y++)i[m+y]=T[y];if(g){const y=u.offset,v=u.count;return n[m+6]=y,r[E+14]=v,r[E+15]=Fl,p+Qa}else{const y=u.left,v=u.right,A=u.splitAxis;let C;if(C=c(p+Qa,y),C/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[m+6]=C/4,C=c(C,v),n[m+7]=A,C}}}class ci{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let s=1/0,i=-1/0;for(let n=0,r=e.length;n<r;n++){const o=e[n][t];s=o<s?o:s,i=o>i?o:i}this.min=s,this.max=i}setFromPoints(e,t){let s=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const o=t[n],a=e.dot(o);s=a<s?a:s,i=a>i?a:i}this.min=s,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}ci.prototype.setFromBox=function(){const h=new O;return function(e,t){const s=t.min,i=t.max;let n=1/0,r=-1/0;for(let o=0;o<=1;o++)for(let a=0;a<=1;a++)for(let l=0;l<=1;l++){h.x=s.x*o+i.x*(1-o),h.y=s.y*a+i.y*(1-a),h.z=s.z*l+i.z*(1-l);const c=e.dot(h);n=Math.min(c,n),r=Math.max(c,r)}this.min=n,this.max=r}}();const LI=function(){const h=new O,e=new O,t=new O;return function(s,i,n){const r=s.start,o=h,a=i.start,l=e;t.subVectors(r,a),h.subVectors(s.end,s.start),e.subVectors(i.end,i.start);const c=t.dot(l),p=l.dot(o),u=l.dot(l),m=t.dot(o),E=o.dot(o)*u-p*p;let g,T;E!==0?g=(c*p-m*u)/E:g=0,T=(c+g*p)/u,n.x=g,n.y=T}}(),ad=function(){const h=new Ue,e=new O,t=new O;return function(s,i,n,r){LI(s,i,h);let o=h.x,a=h.y;if(o>=0&&o<=1&&a>=0&&a<=1){s.at(o,n),i.at(a,r);return}else if(o>=0&&o<=1){a<0?i.at(0,r):i.at(1,r),s.closestPointToPoint(r,!0,n);return}else if(a>=0&&a<=1){o<0?s.at(0,n):s.at(1,n),i.closestPointToPoint(n,!0,r);return}else{let l;o<0?l=s.start:l=s.end;let c;a<0?c=i.start:c=i.end;const p=e,u=t;if(s.closestPointToPoint(c,!0,e),i.closestPointToPoint(l,!0,t),p.distanceToSquared(c)<=u.distanceToSquared(l)){n.copy(p),r.copy(c);return}else{n.copy(l),r.copy(u);return}}}}(),NI=function(){const h=new O,e=new O,t=new jt,s=new at;return function(i,n){const{radius:r,center:o}=i,{a,b:l,c}=n;if(s.start=a,s.end=l,s.closestPointToPoint(o,!0,h).distanceTo(o)<=r||(s.start=a,s.end=c,s.closestPointToPoint(o,!0,h).distanceTo(o)<=r)||(s.start=l,s.end=c,s.closestPointToPoint(o,!0,h).distanceTo(o)<=r))return!0;const p=n.getPlane(t);if(Math.abs(p.distanceToPoint(o))<=r){const u=p.projectPoint(o,e);if(n.containsPoint(u))return!0}return!1}}(),DI=1e-15;function Dh(h){return Math.abs(h)<DI}class Os extends es{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new O),this.satBounds=new Array(4).fill().map(()=>new ci),this.points=[this.a,this.b,this.c],this.sphere=new Zs,this.plane=new jt,this.needsUpdate=!0}intersectsSphere(e){return NI(e,this)}update(){const e=this.a,t=this.b,s=this.c,i=this.points,n=this.satAxes,r=this.satBounds,o=n[0],a=r[0];this.getNormal(o),a.setFromPoints(o,i);const l=n[1],c=r[1];l.subVectors(e,t),c.setFromPoints(l,i);const p=n[2],u=r[2];p.subVectors(t,s),u.setFromPoints(p,i);const m=n[3],E=r[3];m.subVectors(s,e),E.setFromPoints(m,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}Os.prototype.closestPointToSegment=function(){const h=new O,e=new O,t=new at;return function(s,i=null,n=null){const{start:r,end:o}=s,a=this.points;let l,c=1/0;for(let p=0;p<3;p++){const u=(p+1)%3;t.start.copy(a[p]),t.end.copy(a[u]),ad(t,s,h,e),l=h.distanceToSquared(e),l<c&&(c=l,i&&i.copy(h),n&&n.copy(e))}return this.closestPointToPoint(r,h),l=r.distanceToSquared(h),l<c&&(c=l,i&&i.copy(h),n&&n.copy(r)),this.closestPointToPoint(o,h),l=o.distanceToSquared(h),l<c&&(c=l,i&&i.copy(h),n&&n.copy(o)),Math.sqrt(c)}}();Os.prototype.intersectsTriangle=function(){const h=new Os,e=new Array(3),t=new Array(3),s=new ci,i=new ci,n=new O,r=new O,o=new O,a=new O,l=new O,c=new at,p=new at,u=new at,m=new O;function E(g,T,y){const v=g.points;let A=0,C=-1;for(let F=0;F<3;F++){const{start:M,end:_}=c;M.copy(v[F]),_.copy(v[(F+1)%3]),c.delta(r);const L=Dh(T.distanceToPoint(M));if(Dh(T.normal.dot(r))&&L){y.copy(c),A=2;break}const D=T.intersectLine(c,m);if(!D&&L&&m.copy(M),(D||L)&&!Dh(m.distanceTo(_))){if(A<=1)(A===1?y.start:y.end).copy(m),L&&(C=A);else if(A>=2){(C===1?y.start:y.end).copy(m),A=2;break}if(A++,A===2&&C===-1)break}}return A}return function(g,T=null,y=!1){this.needsUpdate&&this.update(),g.isExtendedTriangle?g.needsUpdate&&g.update():(h.copy(g),h.update(),g=h);const v=this.plane,A=g.plane;if(Math.abs(v.normal.dot(A.normal))>1-1e-10){const C=this.satBounds,F=this.satAxes;t[0]=g.a,t[1]=g.b,t[2]=g.c;for(let L=0;L<4;L++){const D=C[L],B=F[L];if(s.setFromPoints(B,t),D.isSeparated(s))return!1}const M=g.satBounds,_=g.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let L=0;L<4;L++){const D=M[L],B=_[L];if(s.setFromPoints(B,e),D.isSeparated(s))return!1}for(let L=0;L<4;L++){const D=F[L];for(let B=0;B<4;B++){const z=_[B];if(n.crossVectors(D,z),s.setFromPoints(n,e),i.setFromPoints(n,t),s.isSeparated(i))return!1}}return T&&(y||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),T.start.set(0,0,0),T.end.set(0,0,0)),!0}else{const C=E(this,A,p);if(C===1&&g.containsPoint(p.end))return T&&(T.start.copy(p.end),T.end.copy(p.end)),!0;if(C!==2)return!1;const F=E(g,v,u);if(F===1&&this.containsPoint(u.end))return T&&(T.start.copy(u.end),T.end.copy(u.end)),!0;if(F!==2)return!1;if(p.delta(o),u.delta(a),o.dot(a)<0){let V=u.start;u.start=u.end,u.end=V}const M=p.start.dot(o),_=p.end.dot(o),L=u.start.dot(o),D=u.end.dot(o),B=_<L,z=M<D;return M!==D&&L!==_&&B===z?!1:(T&&(l.subVectors(p.start,u.start),l.dot(o)>0?T.start.copy(p.start):T.start.copy(u.start),l.subVectors(p.end,u.end),l.dot(o)<0?T.end.copy(p.end):T.end.copy(u.end)),!0)}}}();Os.prototype.distanceToPoint=function(){const h=new O;return function(e){return this.closestPointToPoint(e,h),e.distanceTo(h)}}();Os.prototype.distanceToTriangle=function(){const h=new O,e=new O,t=["a","b","c"],s=new at,i=new at;return function(n,r=null,o=null){const a=r||o?s:null;if(this.intersectsTriangle(n,a))return(r||o)&&(r&&a.getCenter(r),o&&a.getCenter(o)),0;let l=1/0;for(let c=0;c<3;c++){let p;const u=t[c],m=n[u];this.closestPointToPoint(m,h),p=m.distanceToSquared(h),p<l&&(l=p,r&&r.copy(h),o&&o.copy(m));const E=this[u];n.closestPointToPoint(E,h),p=E.distanceToSquared(h),p<l&&(l=p,r&&r.copy(E),o&&o.copy(h))}for(let c=0;c<3;c++){const p=t[c],u=t[(c+1)%3];s.set(this[p],this[u]);for(let m=0;m<3;m++){const E=t[m],g=t[(m+1)%3];i.set(n[E],n[g]),ad(s,i,h,e);const T=h.distanceToSquared(e);T<l&&(l=T,r&&r.copy(h),o&&o.copy(e))}}return Math.sqrt(l)}}();class Ht{constructor(e,t,s){this.isOrientedBox=!0,this.min=new O,this.max=new O,this.matrix=new de,this.invMatrix=new de,this.points=new Array(8).fill().map(()=>new O),this.satAxes=new Array(3).fill().map(()=>new O),this.satBounds=new Array(3).fill().map(()=>new ci),this.alignedSatBounds=new Array(3).fill().map(()=>new ci),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),s&&this.matrix.copy(s)}set(e,t,s){this.min.copy(e),this.max.copy(t),this.matrix.copy(s),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Ht.prototype.update=function(){return function(){const h=this.matrix,e=this.min,t=this.max,s=this.points;for(let a=0;a<=1;a++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){const p=1*a|2*l|4*c,u=s[p];u.x=a?t.x:e.x,u.y=l?t.y:e.y,u.z=c?t.z:e.z,u.applyMatrix4(h)}const i=this.satBounds,n=this.satAxes,r=s[0];for(let a=0;a<3;a++){const l=n[a],c=i[a],p=1<<a,u=s[p];l.subVectors(r,u),c.setFromPoints(l,s)}const o=this.alignedSatBounds;o[0].setFromPointsField(s,"x"),o[1].setFromPointsField(s,"y"),o[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Ht.prototype.intersectsBox=function(){const h=new ci;return function(e){this.needsUpdate&&this.update();const t=e.min,s=e.max,i=this.satBounds,n=this.satAxes,r=this.alignedSatBounds;if(h.min=t.x,h.max=s.x,r[0].isSeparated(h)||(h.min=t.y,h.max=s.y,r[1].isSeparated(h))||(h.min=t.z,h.max=s.z,r[2].isSeparated(h)))return!1;for(let o=0;o<3;o++){const a=n[o],l=i[o];if(h.setFromBox(a,e),l.isSeparated(h))return!1}return!0}}();Ht.prototype.intersectsTriangle=function(){const h=new Os,e=new Array(3),t=new ci,s=new ci,i=new O;return function(n){this.needsUpdate&&this.update(),n.isExtendedTriangle?n.needsUpdate&&n.update():(h.copy(n),h.update(),n=h);const r=this.satBounds,o=this.satAxes;e[0]=n.a,e[1]=n.b,e[2]=n.c;for(let p=0;p<3;p++){const u=r[p],m=o[p];if(t.setFromPoints(m,e),u.isSeparated(t))return!1}const a=n.satBounds,l=n.satAxes,c=this.points;for(let p=0;p<3;p++){const u=a[p],m=l[p];if(t.setFromPoints(m,c),u.isSeparated(t))return!1}for(let p=0;p<3;p++){const u=o[p];for(let m=0;m<4;m++){const E=l[m];if(i.crossVectors(u,E),t.setFromPoints(i,e),s.setFromPoints(i,c),t.isSeparated(s))return!1}}return!0}}();Ht.prototype.closestPointToPoint=function(){return function(h,e){return this.needsUpdate&&this.update(),e.copy(h).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();Ht.prototype.distanceToPoint=function(){const h=new O;return function(e){return this.closestPointToPoint(e,h),e.distanceTo(h)}}();Ht.prototype.distanceToBox=function(){const h=["x","y","z"],e=new Array(12).fill().map(()=>new at),t=new Array(12).fill().map(()=>new at),s=new O,i=new O;return function(n,r=0,o=null,a=null){if(this.needsUpdate&&this.update(),this.intersectsBox(n))return(o||a)&&(n.getCenter(i),this.closestPointToPoint(i,s),n.closestPointToPoint(s,i),o&&o.copy(s),a&&a.copy(i)),0;const l=r*r,c=n.min,p=n.max,u=this.points;let m=1/0;for(let g=0;g<8;g++){const T=u[g];i.copy(T).clamp(c,p);const y=T.distanceToSquared(i);if(y<m&&(m=y,o&&o.copy(T),a&&a.copy(i),y<l))return Math.sqrt(y)}let E=0;for(let g=0;g<3;g++)for(let T=0;T<=1;T++)for(let y=0;y<=1;y++){const v=(g+1)%3,A=(g+2)%3,C=T<<v|y<<A,F=1<<g|T<<v|y<<A,M=u[C],_=u[F];e[E].set(M,_);const L=h[g],D=h[v],B=h[A],z=t[E],V=z.start,Q=z.end;V[L]=c[L],V[D]=T?c[D]:p[D],V[B]=y?c[B]:p[D],Q[L]=p[L],Q[D]=T?c[D]:p[D],Q[B]=y?c[B]:p[D],E++}for(let g=0;g<=1;g++)for(let T=0;T<=1;T++)for(let y=0;y<=1;y++){i.x=g?p.x:c.x,i.y=T?p.y:c.y,i.z=y?p.z:c.z,this.closestPointToPoint(i,s);const v=i.distanceToSquared(s);if(v<m&&(m=v,o&&o.copy(s),a&&a.copy(i),v<l))return Math.sqrt(v)}for(let g=0;g<12;g++){const T=e[g];for(let y=0;y<12;y++){const v=t[y];ad(T,v,s,i);const A=s.distanceToSquared(i);if(A<m&&(m=A,o&&o.copy(s),a&&a.copy(i),A<l))return Math.sqrt(A)}}return Math.sqrt(m)}}();class ld{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class UI extends ld{constructor(){super(()=>new Os)}}const ps=new UI;function $t(h,e){return e[h+15]===65535}function ss(h,e){return e[h+6]}function fs(h,e){return e[h+14]}function ms(h){return h+8}function Es(h,e){return e[h+6]}function kf(h,e){return e[h+7]}class BI{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=s=>{t&&e.push(t),t=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const it=new BI;let xi,Jn;const Mn=[],ga=new ld(()=>new Me);function zI(h,e,t,s,i,n){xi=ga.getPrimitive(),Jn=ga.getPrimitive(),Mn.push(xi,Jn),it.setBuffer(h._roots[e]);const r=Cc(0,h.geometry,t,s,i,n);it.clearBuffer(),ga.releasePrimitive(xi),ga.releasePrimitive(Jn),Mn.pop(),Mn.pop();const o=Mn.length;return o>0&&(Jn=Mn[o-1],xi=Mn[o-2]),r}function Cc(h,e,t,s,i=null,n=0,r=0){const{float32Array:o,uint16Array:a,uint32Array:l}=it;let c=h*2;if($t(c,a)){const p=ss(h,l),u=fs(c,a);return ht(h,o,xi),s(p,u,!1,r,n+h,xi)}else{let p=function(z){const{uint16Array:V,uint32Array:Q}=it;let ne=z*2;for(;!$t(ne,V);)z=ms(z),ne=z*2;return ss(z,Q)},u=function(z){const{uint16Array:V,uint32Array:Q}=it;let ne=z*2;for(;!$t(ne,V);)z=Es(z,Q),ne=z*2;return ss(z,Q)+fs(ne,V)};const m=ms(h),E=Es(h,l);let g=m,T=E,y,v,A,C;if(i&&(A=xi,C=Jn,ht(g,o,A),ht(T,o,C),y=i(A),v=i(C),v<y)){g=E,T=m;const z=y;y=v,v=z,A=C}A||(A=xi,ht(g,o,A));const F=$t(g*2,a),M=t(A,F,y,r+1,n+g);let _;if(M===Nu){const z=p(g),V=u(g)-z;_=s(z,V,!0,r+1,n+g,A)}else _=M&&Cc(g,e,t,s,i,n,r+1);if(_)return!0;C=Jn,ht(T,o,C);const L=$t(T*2,a),D=t(C,L,v,r+1,n+T);let B;if(D===Nu){const z=p(T),V=u(T)-z;B=s(z,V,!0,r+1,n+T,C)}else B=D&&Cc(T,e,t,s,i,n,r+1);return!!B}}const Vr=new O,Uh=new O;function YI(h,e,t={},s=0,i=1/0){const n=s*s,r=i*i;let o=1/0,a=null;if(h.shapecast({boundsTraverseOrder:c=>(Vr.copy(e).clamp(c.min,c.max),Vr.distanceToSquared(e)),intersectsBounds:(c,p,u)=>u<o&&u<r,intersectsTriangle:(c,p)=>{c.closestPointToPoint(e,Vr);const u=e.distanceToSquared(Vr);return u<o&&(Uh.copy(Vr),o=u,a=p),u<n}}),o===1/0)return null;const l=Math.sqrt(o);return t.point?t.point.copy(Uh):t.point=Uh.clone(),t.distance=l,t.faceIndex=a,t}const _n=new O,Ln=new O,Nn=new O,Ia=new Ue,Ca=new Ue,Ta=new Ue,Yu=new O,ku=new O,Vu=new O,ya=new O;function kI(h,e,t,s,i,n){let r;return n===Qp?r=h.intersectTriangle(s,t,e,!0,i):r=h.intersectTriangle(e,t,s,n!==Qs,i),r===null?null:{distance:h.origin.distanceTo(i),point:i.clone()}}function VI(h,e,t,s,i,n,r,o,a){_n.fromBufferAttribute(e,n),Ln.fromBufferAttribute(e,r),Nn.fromBufferAttribute(e,o);const l=kI(h,_n,Ln,Nn,ya,a);if(l){s&&(Ia.fromBufferAttribute(s,n),Ca.fromBufferAttribute(s,r),Ta.fromBufferAttribute(s,o),l.uv=es.getInterpolation(ya,_n,Ln,Nn,Ia,Ca,Ta,new Ue)),i&&(Ia.fromBufferAttribute(i,n),Ca.fromBufferAttribute(i,r),Ta.fromBufferAttribute(i,o),l.uv1=es.getInterpolation(ya,_n,Ln,Nn,Ia,Ca,Ta,new Ue)),t&&(Yu.fromBufferAttribute(t,n),ku.fromBufferAttribute(t,r),Vu.fromBufferAttribute(t,o),l.normal=es.getInterpolation(ya,_n,Ln,Nn,Yu,ku,Vu,new O),l.normal.dot(h.direction)>0&&l.normal.multiplyScalar(-1));const c={a:n,b:r,c:o,normal:new O,materialIndex:0};es.getNormal(_n,Ln,Nn,c.normal),l.face=c,l.faceIndex=n}return l}function Al(h,e,t,s,i){const n=s*3;let r=n+0,o=n+1,a=n+2;const l=h.index;h.index&&(r=l.getX(r),o=l.getX(o),a=l.getX(a));const{position:c,normal:p,uv:u,uv1:m}=h.attributes,E=VI(t,c,p,u,m,r,o,a,e);return E?(E.faceIndex=s,i&&i.push(E),E):null}function Et(h,e,t,s){const i=h.a,n=h.b,r=h.c;let o=e,a=e+1,l=e+2;t&&(o=t.getX(o),a=t.getX(a),l=t.getX(l)),i.x=s.getX(o),i.y=s.getY(o),i.z=s.getZ(o),n.x=s.getX(a),n.y=s.getY(a),n.z=s.getZ(a),r.x=s.getX(l),r.y=s.getY(l),r.z=s.getZ(l)}function GI(h,e,t,s,i,n){const{geometry:r,_indirectBuffer:o}=h;for(let a=s,l=s+i;a<l;a++)Al(r,e,t,a,n)}function HI(h,e,t,s,i){const{geometry:n,_indirectBuffer:r}=h;let o=1/0,a=null;for(let l=s,c=s+i;l<c;l++){let p;p=Al(n,e,t,l),p&&p.distance<o&&(a=p,o=p.distance)}return a}function WI(h,e,t,s,i,n,r){const{geometry:o}=t,{index:a}=o,l=o.attributes.position;for(let c=h,p=e+h;c<p;c++){let u;if(u=c,Et(r,u*3,a,l),r.needsUpdate=!0,s(r,u,i,n))return!0}return!1}function XI(h,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=h.geometry,s=t.index?t.index.array:null,i=t.attributes.position;let n,r,o,a,l=0;const c=h._roots;for(let u=0,m=c.length;u<m;u++)n=c[u],r=new Uint32Array(n),o=new Uint16Array(n),a=new Float32Array(n),p(0,l),l+=n.byteLength;function p(u,m,E=!1){const g=u*2;if(o[g+15]===Fl){const T=r[u+6],y=o[g+14];let v=1/0,A=1/0,C=1/0,F=-1/0,M=-1/0,_=-1/0;for(let L=3*T,D=3*(T+y);L<D;L++){let B=s[L];const z=i.getX(B),V=i.getY(B),Q=i.getZ(B);z<v&&(v=z),z>F&&(F=z),V<A&&(A=V),V>M&&(M=V),Q<C&&(C=Q),Q>_&&(_=Q)}return a[u+0]!==v||a[u+1]!==A||a[u+2]!==C||a[u+3]!==F||a[u+4]!==M||a[u+5]!==_?(a[u+0]=v,a[u+1]=A,a[u+2]=C,a[u+3]=F,a[u+4]=M,a[u+5]=_,!0):!1}else{const T=u+8,y=r[u+6],v=T+m,A=y+m;let C=E,F=!1,M=!1;e?C||(F=e.has(v),M=e.has(A),C=!F&&!M):(F=!0,M=!0);const _=C||F,L=C||M;let D=!1;_&&(D=p(T,m,C));let B=!1;L&&(B=p(y,m,C));const z=D||B;if(z)for(let V=0;V<3;V++){const Q=T+V,ne=y+V,ue=a[Q],oe=a[Q+3],Ie=a[ne],ce=a[ne+3];a[u+V]=ue<Ie?ue:Ie,a[u+V+3]=oe>ce?oe:ce}return z}}}const Gu=new Me;function Di(h,e,t,s){return ht(h,e,Gu),t.intersectBox(Gu,s)}function KI(h,e,t,s,i,n){const{geometry:r,_indirectBuffer:o}=h;for(let a=s,l=s+i;a<l;a++){let c=o?o[a]:a;Al(r,e,t,c,n)}}function ZI(h,e,t,s,i){const{geometry:n,_indirectBuffer:r}=h;let o=1/0,a=null;for(let l=s,c=s+i;l<c;l++){let p;p=Al(n,e,t,r?r[l]:l),p&&p.distance<o&&(a=p,o=p.distance)}return a}function jI(h,e,t,s,i,n,r){const{geometry:o}=t,{index:a}=o,l=o.attributes.position;for(let c=h,p=e+h;c<p;c++){let u;if(u=t.resolveTriangleIndex(c),Et(r,u*3,a,l),r.needsUpdate=!0,s(r,u,i,n))return!0}return!1}const Hu=new O;function QI(h,e,t,s,i){it.setBuffer(h._roots[e]),Tc(0,h,t,s,i),it.clearBuffer()}function Tc(h,e,t,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=it,a=h*2;if($t(a,r)){const l=ss(h,o),c=fs(a,r);GI(e,t,s,l,c,i)}else{const l=ms(h);Di(l,n,s,Hu)&&Tc(l,e,t,s,i);const c=Es(h,o);Di(c,n,s,Hu)&&Tc(c,e,t,s,i)}}const Wu=new O,qI=["x","y","z"];function JI(h,e,t,s){it.setBuffer(h._roots[e]);const i=yc(0,h,t,s);return it.clearBuffer(),i}function yc(h,e,t,s){const{float32Array:i,uint16Array:n,uint32Array:r}=it;let o=h*2;if($t(o,n)){const a=ss(h,r),l=fs(o,n);return HI(e,t,s,a,l)}else{const a=kf(h,r),l=qI[a],c=s.direction[l]>=0;let p,u;c?(p=ms(h),u=Es(h,r)):(p=Es(h,r),u=ms(h));const m=Di(p,i,s,Wu)?yc(p,e,t,s):null;if(m){const g=m.point[l];if(c?g<=i[u+a]:g>=i[u+a+3])return m}const E=Di(u,i,s,Wu)?yc(u,e,t,s):null;return m&&E?m.distance<=E.distance?m:E:m||E||null}}const wa=new Me,Dn=new Os,Un=new Os,Gr=new de,Xu=new Ht,va=new Ht;function $I(h,e,t,s){it.setBuffer(h._roots[e]);const i=wc(0,h,t,s);return it.clearBuffer(),i}function wc(h,e,t,s,i=null){const{float32Array:n,uint16Array:r,uint32Array:o}=it;let a=h*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),Xu.set(t.boundingBox.min,t.boundingBox.max,s),i=Xu),$t(a,r)){const l=e.geometry,c=l.index,p=l.attributes.position,u=t.index,m=t.attributes.position,E=ss(h,o),g=fs(a,r);if(Gr.copy(s).invert(),t.boundsTree)return ht(h,n,va),va.matrix.copy(Gr),va.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:T=>va.intersectsBox(T),intersectsTriangle:T=>{T.a.applyMatrix4(s),T.b.applyMatrix4(s),T.c.applyMatrix4(s),T.needsUpdate=!0;for(let y=E*3,v=(g+E)*3;y<v;y+=3)if(Et(Un,y,c,p),Un.needsUpdate=!0,T.intersectsTriangle(Un))return!0;return!1}});for(let T=E*3,y=(g+E)*3;T<y;T+=3){Et(Dn,T,c,p),Dn.a.applyMatrix4(Gr),Dn.b.applyMatrix4(Gr),Dn.c.applyMatrix4(Gr),Dn.needsUpdate=!0;for(let v=0,A=u.count;v<A;v+=3)if(Et(Un,v,u,m),Un.needsUpdate=!0,Dn.intersectsTriangle(Un))return!0}}else{const l=h+8,c=o[h+6];return ht(l,n,wa),!!(i.intersectsBox(wa)&&wc(l,e,t,s,i)||(ht(c,n,wa),i.intersectsBox(wa)&&wc(c,e,t,s,i)))}}const Ra=new de,Bh=new Ht,Hr=new Ht,e1=new O,t1=new O,s1=new O,i1=new O;function n1(h,e,t,s={},i={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),Bh.set(e.boundingBox.min,e.boundingBox.max,t),Bh.needsUpdate=!0;const o=h.geometry,a=o.attributes.position,l=o.index,c=e.attributes.position,p=e.index,u=ps.getPrimitive(),m=ps.getPrimitive();let E=e1,g=t1,T=null,y=null;i&&(T=s1,y=i1);let v=1/0,A=null,C=null;return Ra.copy(t).invert(),Hr.matrix.copy(Ra),h.shapecast({boundsTraverseOrder:F=>Bh.distanceToBox(F),intersectsBounds:(F,M,_)=>_<v&&_<r?(M&&(Hr.min.copy(F.min),Hr.max.copy(F.max),Hr.needsUpdate=!0),!0):!1,intersectsRange:(F,M)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:_=>Hr.distanceToBox(_),intersectsBounds:(_,L,D)=>D<v&&D<r,intersectsRange:(_,L)=>{for(let D=_,B=_+L;D<B;D++){Et(m,3*D,p,c),m.a.applyMatrix4(t),m.b.applyMatrix4(t),m.c.applyMatrix4(t),m.needsUpdate=!0;for(let z=F,V=F+M;z<V;z++){Et(u,3*z,l,a),u.needsUpdate=!0;const Q=u.distanceToTriangle(m,E,T);if(Q<v&&(g.copy(E),y&&y.copy(T),v=Q,A=z,C=D),Q<n)return!0}}}});{const _=cr(e);for(let L=0,D=_;L<D;L++){Et(m,3*L,p,c),m.a.applyMatrix4(t),m.b.applyMatrix4(t),m.c.applyMatrix4(t),m.needsUpdate=!0;for(let B=F,z=F+M;B<z;B++){Et(u,3*B,l,a),u.needsUpdate=!0;const V=u.distanceToTriangle(m,E,T);if(V<v&&(g.copy(E),y&&y.copy(T),v=V,A=B,C=L),V<n)return!0}}}}}),ps.releasePrimitive(u),ps.releasePrimitive(m),v===1/0?null:(s.point?s.point.copy(g):s.point=g.clone(),s.distance=v,s.faceIndex=A,i&&(i.point?i.point.copy(y):i.point=y.clone(),i.point.applyMatrix4(Ra),g.applyMatrix4(Ra),i.distance=g.sub(i.point).length(),i.faceIndex=C),s)}function r1(h,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=h.geometry,s=t.index?t.index.array:null,i=t.attributes.position;let n,r,o,a,l=0;const c=h._roots;for(let u=0,m=c.length;u<m;u++)n=c[u],r=new Uint32Array(n),o=new Uint16Array(n),a=new Float32Array(n),p(0,l),l+=n.byteLength;function p(u,m,E=!1){const g=u*2;if(o[g+15]===Fl){const T=r[u+6],y=o[g+14];let v=1/0,A=1/0,C=1/0,F=-1/0,M=-1/0,_=-1/0;for(let L=T,D=T+y;L<D;L++){const B=3*h.resolveTriangleIndex(L);for(let z=0;z<3;z++){let V=B+z;V=s?s[V]:V;const Q=i.getX(V),ne=i.getY(V),ue=i.getZ(V);Q<v&&(v=Q),Q>F&&(F=Q),ne<A&&(A=ne),ne>M&&(M=ne),ue<C&&(C=ue),ue>_&&(_=ue)}}return a[u+0]!==v||a[u+1]!==A||a[u+2]!==C||a[u+3]!==F||a[u+4]!==M||a[u+5]!==_?(a[u+0]=v,a[u+1]=A,a[u+2]=C,a[u+3]=F,a[u+4]=M,a[u+5]=_,!0):!1}else{const T=u+8,y=r[u+6],v=T+m,A=y+m;let C=E,F=!1,M=!1;e?C||(F=e.has(v),M=e.has(A),C=!F&&!M):(F=!0,M=!0);const _=C||F,L=C||M;let D=!1;_&&(D=p(T,m,C));let B=!1;L&&(B=p(y,m,C));const z=D||B;if(z)for(let V=0;V<3;V++){const Q=T+V,ne=y+V,ue=a[Q],oe=a[Q+3],Ie=a[ne],ce=a[ne+3];a[u+V]=ue<Ie?ue:Ie,a[u+V+3]=oe>ce?oe:ce}return z}}}const Ku=new O;function o1(h,e,t,s,i){it.setBuffer(h._roots[e]),vc(0,h,t,s,i),it.clearBuffer()}function vc(h,e,t,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=it,a=h*2;if($t(a,r)){const l=ss(h,o),c=fs(a,r);KI(e,t,s,l,c,i)}else{const l=ms(h);Di(l,n,s,Ku)&&vc(l,e,t,s,i);const c=Es(h,o);Di(c,n,s,Ku)&&vc(c,e,t,s,i)}}const Zu=new O,a1=["x","y","z"];function l1(h,e,t,s){it.setBuffer(h._roots[e]);const i=Rc(0,h,t,s);return it.clearBuffer(),i}function Rc(h,e,t,s){const{float32Array:i,uint16Array:n,uint32Array:r}=it;let o=h*2;if($t(o,n)){const a=ss(h,r),l=fs(o,n);return ZI(e,t,s,a,l)}else{const a=kf(h,r),l=a1[a],c=s.direction[l]>=0;let p,u;c?(p=ms(h),u=Es(h,r)):(p=Es(h,r),u=ms(h));const m=Di(p,i,s,Zu)?Rc(p,e,t,s):null;if(m){const g=m.point[l];if(c?g<=i[u+a]:g>=i[u+a+3])return m}const E=Di(u,i,s,Zu)?Rc(u,e,t,s):null;return m&&E?m.distance<=E.distance?m:E:m||E||null}}const Fa=new Me,Bn=new Os,zn=new Os,Wr=new de,ju=new Ht,Aa=new Ht;function h1(h,e,t,s){it.setBuffer(h._roots[e]);const i=Fc(0,h,t,s);return it.clearBuffer(),i}function Fc(h,e,t,s,i=null){const{float32Array:n,uint16Array:r,uint32Array:o}=it;let a=h*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),ju.set(t.boundingBox.min,t.boundingBox.max,s),i=ju),$t(a,r)){const l=e.geometry,c=l.index,p=l.attributes.position,u=t.index,m=t.attributes.position,E=ss(h,o),g=fs(a,r);if(Wr.copy(s).invert(),t.boundsTree)return ht(h,n,Aa),Aa.matrix.copy(Wr),Aa.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:T=>Aa.intersectsBox(T),intersectsTriangle:T=>{T.a.applyMatrix4(s),T.b.applyMatrix4(s),T.c.applyMatrix4(s),T.needsUpdate=!0;for(let y=E,v=g+E;y<v;y++)if(Et(zn,3*e.resolveTriangleIndex(y),c,p),zn.needsUpdate=!0,T.intersectsTriangle(zn))return!0;return!1}});for(let T=E,y=g+E;T<y;T++){const v=e.resolveTriangleIndex(T);Et(Bn,3*v,c,p),Bn.a.applyMatrix4(Wr),Bn.b.applyMatrix4(Wr),Bn.c.applyMatrix4(Wr),Bn.needsUpdate=!0;for(let A=0,C=u.count;A<C;A+=3)if(Et(zn,A,u,m),zn.needsUpdate=!0,Bn.intersectsTriangle(zn))return!0}}else{const l=h+8,c=o[h+6];return ht(l,n,Fa),!!(i.intersectsBox(Fa)&&Fc(l,e,t,s,i)||(ht(c,n,Fa),i.intersectsBox(Fa)&&Fc(c,e,t,s,i)))}}const Sa=new de,zh=new Ht,Xr=new Ht,c1=new O,d1=new O,u1=new O,p1=new O;function f1(h,e,t,s={},i={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),zh.set(e.boundingBox.min,e.boundingBox.max,t),zh.needsUpdate=!0;const o=h.geometry,a=o.attributes.position,l=o.index,c=e.attributes.position,p=e.index,u=ps.getPrimitive(),m=ps.getPrimitive();let E=c1,g=d1,T=null,y=null;i&&(T=u1,y=p1);let v=1/0,A=null,C=null;return Sa.copy(t).invert(),Xr.matrix.copy(Sa),h.shapecast({boundsTraverseOrder:F=>zh.distanceToBox(F),intersectsBounds:(F,M,_)=>_<v&&_<r?(M&&(Xr.min.copy(F.min),Xr.max.copy(F.max),Xr.needsUpdate=!0),!0):!1,intersectsRange:(F,M)=>{if(e.boundsTree){const _=e.boundsTree;return _.shapecast({boundsTraverseOrder:L=>Xr.distanceToBox(L),intersectsBounds:(L,D,B)=>B<v&&B<r,intersectsRange:(L,D)=>{for(let B=L,z=L+D;B<z;B++){const V=_.resolveTriangleIndex(B);Et(m,3*V,p,c),m.a.applyMatrix4(t),m.b.applyMatrix4(t),m.c.applyMatrix4(t),m.needsUpdate=!0;for(let Q=F,ne=F+M;Q<ne;Q++){const ue=h.resolveTriangleIndex(Q);Et(u,3*ue,l,a),u.needsUpdate=!0;const oe=u.distanceToTriangle(m,E,T);if(oe<v&&(g.copy(E),y&&y.copy(T),v=oe,A=Q,C=B),oe<n)return!0}}}})}else{const _=cr(e);for(let L=0,D=_;L<D;L++){Et(m,3*L,p,c),m.a.applyMatrix4(t),m.b.applyMatrix4(t),m.c.applyMatrix4(t),m.needsUpdate=!0;for(let B=F,z=F+M;B<z;B++){const V=h.resolveTriangleIndex(B);Et(u,3*V,l,a),u.needsUpdate=!0;const Q=u.distanceToTriangle(m,E,T);if(Q<v&&(g.copy(E),y&&y.copy(T),v=Q,A=B,C=L),Q<n)return!0}}}}}),ps.releasePrimitive(u),ps.releasePrimitive(m),v===1/0?null:(s.point?s.point.copy(g):s.point=g.clone(),s.distance=v,s.faceIndex=A,i&&(i.point?i.point.copy(y):i.point=y.clone(),i.point.applyMatrix4(Sa),g.applyMatrix4(Sa),i.distance=g.sub(i.point).length(),i.faceIndex=C),s)}function m1(){return typeof SharedArrayBuffer<"u"}const oo=new it.constructor,nl=new it.constructor,Si=new ld(()=>new Me),Yn=new Me,kn=new Me,Yh=new Me,kh=new Me;let Vh=!1;function E1(h,e,t,s){if(Vh)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Vh=!0;const i=h._roots,n=e._roots;let r,o=0,a=0;const l=new de().copy(t).invert();for(let c=0,p=i.length;c<p;c++){oo.setBuffer(i[c]),a=0;const u=Si.getPrimitive();ht(0,oo.float32Array,u),u.applyMatrix4(l);for(let m=0,E=n.length;m<E&&(nl.setBuffer(n[c]),r=ws(0,0,t,l,s,o,a,0,0,u),nl.clearBuffer(),a+=n[m].length,!r);m++);if(Si.releasePrimitive(u),oo.clearBuffer(),o+=i[c].length,r)break}return Vh=!1,r}function ws(h,e,t,s,i,n=0,r=0,o=0,a=0,l=null,c=!1){let p,u;c?(p=nl,u=oo):(p=oo,u=nl);const m=p.float32Array,E=p.uint32Array,g=p.uint16Array,T=u.float32Array,y=u.uint32Array,v=u.uint16Array,A=h*2,C=e*2,F=$t(A,g),M=$t(C,v);let _=!1;if(M&&F)c?_=i(ss(e,y),fs(e*2,v),ss(h,E),fs(h*2,g),a,r+e,o,n+h):_=i(ss(h,E),fs(h*2,g),ss(e,y),fs(e*2,v),o,n+h,a,r+e);else if(M){const L=Si.getPrimitive();ht(e,T,L),L.applyMatrix4(t);const D=ms(h),B=Es(h,E);ht(D,m,Yn),ht(B,m,kn);const z=L.intersectsBox(Yn),V=L.intersectsBox(kn);_=z&&ws(e,D,s,t,i,r,n,a,o+1,L,!c)||V&&ws(e,B,s,t,i,r,n,a,o+1,L,!c),Si.releasePrimitive(L)}else{const L=ms(e),D=Es(e,y);ht(L,T,Yh),ht(D,T,kh);const B=l.intersectsBox(Yh),z=l.intersectsBox(kh);if(B&&z)_=ws(h,L,t,s,i,n,r,o,a+1,l,c)||ws(h,D,t,s,i,n,r,o,a+1,l,c);else if(B)if(F)_=ws(h,L,t,s,i,n,r,o,a+1,l,c);else{const V=Si.getPrimitive();V.copy(Yh).applyMatrix4(t);const Q=ms(h),ne=Es(h,E);ht(Q,m,Yn),ht(ne,m,kn);const ue=V.intersectsBox(Yn),oe=V.intersectsBox(kn);_=ue&&ws(L,Q,s,t,i,r,n,a,o+1,V,!c)||oe&&ws(L,ne,s,t,i,r,n,a,o+1,V,!c),Si.releasePrimitive(V)}else if(z)if(F)_=ws(h,D,t,s,i,n,r,o,a+1,l,c);else{const V=Si.getPrimitive();V.copy(kh).applyMatrix4(t);const Q=ms(h),ne=Es(h,E);ht(Q,m,Yn),ht(ne,m,kn);const ue=V.intersectsBox(Yn),oe=V.intersectsBox(kn);_=ue&&ws(D,Q,s,t,i,r,n,a,o+1,V,!c)||oe&&ws(D,ne,s,t,i,r,n,a,o+1,V,!c),Si.releasePrimitive(V)}}return _}const Oa=new Ht,Qu=new Me;class hd{static serialize(e,t={}){t={cloneBuffers:!0,...t};const s=e.geometry,i=e._roots,n=e._indirectBuffer,r=s.getIndex();let o;return t.cloneBuffers?o={roots:i.map(a=>a.slice()),index:r.array.slice(),indirectBuffer:n?n.slice():null}:o={roots:i,index:r.array,indirectBuffer:n},o}static deserialize(e,t,s={}){s={setIndex:!0,indirect:!!e.indirectBuffer,...s};const{index:i,roots:n,indirectBuffer:r}=e,o=new hd(t,{...s,[Lh]:!0});if(o._roots=n,o._indirectBuffer=r||null,s.setIndex){const a=t.getIndex();if(a===null){const l=new Ct(e.index,1,!1);t.setIndex(l)}else a.array!==i&&(a.array.set(i),a.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:Bf,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[Lh]:!1},t),t.useSharedArrayBuffer&&!m1())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[Lh]||(_I(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Me)));const{_indirectBuffer:s}=this;this.resolveTriangleIndex=t.indirect?i=>s[i]:i=>i}refit(e=null){return(this.indirect?r1:XI)(this,e)}traverse(e,t=0){const s=this._roots[t],i=new Uint32Array(s),n=new Uint16Array(s);r(0);function r(o,a=0){const l=o*2,c=n[l+15]===Fl;if(c){const p=i[o+6],u=n[l+14];e(a,c,new Float32Array(s,o*4,6),p,u)}else{const p=o+Qa/4,u=i[o+6],m=i[o+7];e(a,c,new Float32Array(s,o*4,6),m)||(r(p,a+1),r(u,a+1))}}}raycast(e,t=tl){const s=this._roots,i=this.geometry,n=[],r=t.isMaterial,o=Array.isArray(t),a=i.groups,l=r?t.side:t,c=this.indirect?o1:QI;for(let p=0,u=s.length;p<u;p++){const m=o?t[a[p].materialIndex].side:l,E=n.length;if(c(this,p,m,e,n),o){const g=a[p].materialIndex;for(let T=E,y=n.length;T<y;T++)n[T].face.materialIndex=g}}return n}raycastFirst(e,t=tl){const s=this._roots,i=this.geometry,n=t.isMaterial,r=Array.isArray(t);let o=null;const a=i.groups,l=n?t.side:t,c=this.indirect?l1:JI;for(let p=0,u=s.length;p<u;p++){const m=r?t[a[p].materialIndex].side:l,E=c(this,p,m,e);E!=null&&(o==null||E.distance<o.distance)&&(o=E,r&&(E.face.materialIndex=a[p].materialIndex))}return o}intersectsGeometry(e,t){let s=!1;const i=this._roots,n=this.indirect?h1:$I;for(let r=0,o=i.length;r<o&&(s=n(this,r,e,t),!s);r++);return s}shapecast(e){const t=ps.getPrimitive(),s=this.indirect?jI:WI;let{boundsTraverseOrder:i,intersectsBounds:n,intersectsRange:r,intersectsTriangle:o}=e;if(r&&o){const p=r;r=(u,m,E,g,T)=>p(u,m,E,g,T)?!0:s(u,m,this,o,E,g,t)}else r||(o?r=(p,u,m,E)=>s(p,u,this,o,m,E,t):r=(p,u,m)=>m);let a=!1,l=0;const c=this._roots;for(let p=0,u=c.length;p<u;p++){const m=c[p];if(a=zI(this,p,n,r,i,l),a)break;l+=m.byteLength}return ps.releasePrimitive(t),a}bvhcast(e,t,s){let{intersectsRanges:i,intersectsTriangles:n}=s;const r=ps.getPrimitive(),o=this.geometry.index,a=this.geometry.attributes.position,l=this.indirect?E=>{const g=this.resolveTriangleIndex(E);Et(r,g*3,o,a)}:E=>{Et(r,E*3,o,a)},c=ps.getPrimitive(),p=e.geometry.index,u=e.geometry.attributes.position,m=e.indirect?E=>{const g=e.resolveTriangleIndex(E);Et(c,g*3,p,u)}:E=>{Et(c,E*3,p,u)};if(n){const E=(g,T,y,v,A,C,F,M)=>{for(let _=y,L=y+v;_<L;_++){m(_),c.a.applyMatrix4(t),c.b.applyMatrix4(t),c.c.applyMatrix4(t),c.needsUpdate=!0;for(let D=g,B=g+T;D<B;D++)if(l(D),r.needsUpdate=!0,n(r,c,D,_,A,C,F,M))return!0}return!1};if(i){const g=i;i=function(T,y,v,A,C,F,M,_){return g(T,y,v,A,C,F,M,_)?!0:E(T,y,v,A,C,F,M,_)}}else i=E}return E1(this,e,t,i)}intersectsBox(e,t){return Oa.set(e.min,e.max,t),Oa.needsUpdate=!0,this.shapecast({intersectsBounds:s=>Oa.intersectsBox(s),intersectsTriangle:s=>Oa.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,s={},i={},n=0,r=1/0){return(this.indirect?f1:n1)(this,e,t,s,i,n,r)}closestPointToPoint(e,t={},s=0,i=1/0){return YI(this,e,t,s,i)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{ht(0,new Float32Array(t),Qu),e.union(Qu)}),e}}function qu(h,e,t){return h===null||(h.point.applyMatrix4(e.matrixWorld),h.distance=h.point.distanceTo(t.ray.origin),h.object=e,h.distance<t.near||h.distance>t.far)?null:h}const Gh=new Gp,Ju=new de,g1=J.prototype.raycast;function I1(h,e){if(this.geometry.boundsTree){if(this.material===void 0)return;Ju.copy(this.matrixWorld).invert(),Gh.copy(h.ray).applyMatrix4(Ju);const t=this.geometry.boundsTree;if(h.firstHitOnly===!0){const s=qu(t.raycastFirst(Gh,this.material),this,h);s&&e.push(s)}else{const s=t.raycast(Gh,this.material);for(let i=0,n=s.length;i<n;i++){const r=qu(s[i],this,h);r&&e.push(r)}}}else g1.call(this,h,e)}function C1(h){return this.boundsTree=new hd(this,h),this.boundsTree}function T1(){this.boundsTree=null}class te{constructor(){x(this,"trigger",e=>{const t=this.handlers.slice(0);for(const s of t)s(e)}),x(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}}class ao{constructor(){x(this,"trigger",async e=>{const t=this.handlers.slice(0);for(const s of t)await s(e)}),x(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}}class cd{constructor(e){x(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),x(this,"isResizeable",()=>"resize"in this&&"getSize"in this),x(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),x(this,"isHideable",()=>"visible"in this),x(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),this.components=e}}class De extends cd{}class Vf extends cd{constructor(e){super(e),x(this,"worlds",new Map),x(this,"onWorldChanged",new te),x(this,"currentWorld",null),this.onWorldChanged.add(({world:t,action:s})=>{s==="removed"&&this.worlds.delete(t.uuid)})}}class y1 extends Vf{constructor(){super(...arguments),x(this,"hasCameraControls",()=>"controls"in this)}}class w1 extends Vf{constructor(){super(...arguments),x(this,"onAfterUpdate",new te),x(this,"onBeforeUpdate",new te),x(this,"onDisposed",new te),x(this,"onResize",new te),x(this,"onClippingPlanesUpdated",new te),x(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(e,t,s){t.isLocal=s;const i=this.clippingPlanes.indexOf(t);e&&i===-1?this.clippingPlanes.push(t):!e&&i>-1&&this.clippingPlanes.splice(i,1),this.three.clippingPlanes=this.clippingPlanes.filter(n=>!n.isLocal)}}const Gf=class Ac extends De{constructor(e){super(e),x(this,"_disposedComponents",new Set),x(this,"enabled",!0),e.add(Ac.uuid,this)}get(){return this._disposedComponents}destroy(e,t=!0,s=!0){e.removeFromParent();const i=e;i.dispose&&i.dispose(),this.disposeGeometryAndMaterials(e,t),s&&i.children&&i.children.length&&this.disposeChildren(i),e.children.length=0}disposeGeometry(e){e.boundsTree&&e.disposeBoundsTree&&e.disposeBoundsTree(),e.dispose()}disposeGeometryAndMaterials(e,t){const s=e;s.geometry&&this.disposeGeometry(s.geometry),t&&s.material&&Ac.disposeMaterial(s),s.material=[],s.geometry=null}disposeChildren(e){for(const t of e.children)this.destroy(t)}static disposeMaterial(e){if(e.material)if(Array.isArray(e.material))for(const t of e.material)t.dispose();else e.material.dispose()}};x(Gf,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let Ks=Gf;class $u extends Map{constructor(e){super(e),x(this,"onItemSet",new te),x(this,"onItemUpdated",new te),x(this,"onItemDeleted",new te),x(this,"onCleared",new te)}clear(){super.clear(),this.onCleared.trigger()}set(e,t){const s=this.has(e),i=super.set(e,t);return s?(this.onItemUpdated||(this.onItemUpdated=new te),this.onItemUpdated.trigger({key:e,value:t})):(this.onItemSet||(this.onItemSet=new te),this.onItemSet.trigger({key:e,value:t})),i}delete(e){const t=super.delete(e);return t&&this.onItemDeleted.trigger(),t}dispose(){this.clear(),this.onItemSet.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}const qa=0,v1=1,R1=new O,ep=new at,Hh=new jt,tp=new O,Pa=new es;class F1{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new sp,this.unassigned=new sp,this.vertices=[]}setFromPoints(e){if(e.length>=4){this.makeEmpty();for(let t=0,s=e.length;t<s;t++)this.vertices.push(new A1(e[t]));this.compute()}return this}setFromObject(e){const t=[];return e.updateMatrixWorld(!0),e.traverse(function(s){const i=s.geometry;if(i!==void 0){const n=i.attributes.position;if(n!==void 0)for(let r=0,o=n.count;r<o;r++){const a=new O;a.fromBufferAttribute(n,r).applyMatrix4(s.matrixWorld),t.push(a)}}}),this.setFromPoints(t)}containsPoint(e){const t=this.faces;for(let s=0,i=t.length;s<i;s++)if(t[s].distanceToPoint(e)>this.tolerance)return!1;return!0}intersectRay(e,t){const s=this.faces;let i=-1/0,n=1/0;for(let r=0,o=s.length;r<o;r++){const a=s[r],l=a.distanceToPoint(e.origin),c=a.normal.dot(e.direction);if(l>0&&c>=0)return null;const p=c!==0?-l/c:0;if(!(p<=0)&&(c>0?n=Math.min(p,n):i=Math.max(p,i),i>n))return null}return i!==-1/0?e.at(i,t):e.at(n,t),t}intersectsRay(e){return this.intersectRay(e,R1)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,t){return e.face=t,t.outside===null?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}removeVertexFromFace(e,t){return e===t.outside&&(e.next!==null&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(e){if(e.outside!==null){const t=e.outside;let s=e.outside;for(;s.next!==null&&s.next.face===e;)s=s.next;return this.assigned.removeSubList(t,s),t.prev=s.next=null,e.outside=null,t}}deleteFaceVertices(e,t){const s=this.removeAllVerticesFromFace(e);if(s!==void 0)if(t===void 0)this.unassigned.appendChain(s);else{let i=s;do{const n=i.next;t.distanceToPoint(i.point)>this.tolerance?this.addVertexToFace(i,t):this.unassigned.append(i),i=n}while(i!==null)}return this}resolveUnassignedPoints(e){if(this.unassigned.isEmpty()===!1){let t=this.unassigned.first();do{const s=t.next;let i=this.tolerance,n=null;for(let r=0;r<e.length;r++){const o=e[r];if(o.mark===qa){const a=o.distanceToPoint(t.point);if(a>i&&(i=a,n=o),i>1e3*this.tolerance)break}}n!==null&&this.addVertexToFace(t,n),t=s}while(t!==null)}return this}computeExtremes(){const e=new O,t=new O,s=[],i=[];for(let n=0;n<3;n++)s[n]=i[n]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let n=0,r=this.vertices.length;n<r;n++){const o=this.vertices[n],a=o.point;for(let l=0;l<3;l++)a.getComponent(l)<e.getComponent(l)&&(e.setComponent(l,a.getComponent(l)),s[l]=o);for(let l=0;l<3;l++)a.getComponent(l)>t.getComponent(l)&&(t.setComponent(l,a.getComponent(l)),i[l]=o)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:s,max:i}}computeInitialHull(){const e=this.vertices,t=this.computeExtremes(),s=t.min,i=t.max;let n=0,r=0;for(let u=0;u<3;u++){const m=i[u].point.getComponent(u)-s[u].point.getComponent(u);m>n&&(n=m,r=u)}const o=s[r],a=i[r];let l,c;n=0,ep.set(o.point,a.point);for(let u=0,m=this.vertices.length;u<m;u++){const E=e[u];if(E!==o&&E!==a){ep.closestPointToPoint(E.point,!0,tp);const g=tp.distanceToSquared(E.point);g>n&&(n=g,l=E)}}n=-1,Hh.setFromCoplanarPoints(o.point,a.point,l.point);for(let u=0,m=this.vertices.length;u<m;u++){const E=e[u];if(E!==o&&E!==a&&E!==l){const g=Math.abs(Hh.distanceToPoint(E.point));g>n&&(n=g,c=E)}}const p=[];if(Hh.distanceToPoint(c.point)<0){p.push(Fs.create(o,a,l),Fs.create(c,a,o),Fs.create(c,l,a),Fs.create(c,o,l));for(let u=0;u<3;u++){const m=(u+1)%3;p[u+1].getEdge(2).setTwin(p[0].getEdge(m)),p[u+1].getEdge(1).setTwin(p[m+1].getEdge(0))}}else{p.push(Fs.create(o,l,a),Fs.create(c,o,a),Fs.create(c,a,l),Fs.create(c,l,o));for(let u=0;u<3;u++){const m=(u+1)%3;p[u+1].getEdge(2).setTwin(p[0].getEdge((3-u)%3)),p[u+1].getEdge(0).setTwin(p[m+1].getEdge(1))}}for(let u=0;u<4;u++)this.faces.push(p[u]);for(let u=0,m=e.length;u<m;u++){const E=e[u];if(E!==o&&E!==a&&E!==l&&E!==c){n=this.tolerance;let g=null;for(let T=0;T<4;T++){const y=this.faces[T].distanceToPoint(E.point);y>n&&(n=y,g=this.faces[T])}g!==null&&this.addVertexToFace(E,g)}}return this}reindexFaces(){const e=[];for(let t=0;t<this.faces.length;t++){const s=this.faces[t];s.mark===qa&&e.push(s)}return this.faces=e,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let e,t=0;const s=this.assigned.first().face;let i=s.outside;do{const n=s.distanceToPoint(i.point);n>t&&(t=n,e=i),i=i.next}while(i!==null&&i.face===s);return e}}computeHorizon(e,t,s,i){this.deleteFaceVertices(s),s.mark=v1;let n;t===null?n=t=s.getEdge(0):n=t.next;do{const r=n.twin,o=r.face;o.mark===qa&&(o.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,r,o,i):i.push(n)),n=n.next}while(n!==t);return this}addAdjoiningFace(e,t){const s=Fs.create(e,t.tail(),t.head());return this.faces.push(s),s.getEdge(-1).setTwin(t.twin),s.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let s=null,i=null;for(let n=0;n<t.length;n++){const r=t[n],o=this.addAdjoiningFace(e,r);s===null?s=o:o.next.setTwin(i),this.newFaces.push(o.face),i=o}return s.next.setTwin(i),this}addVertexToHull(e){const t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let e;for(this.computeInitialHull();(e=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}class Fs{constructor(){this.normal=new O,this.midpoint=new O,this.area=0,this.constant=0,this.outside=null,this.mark=qa,this.edge=null}static create(e,t,s){const i=new Fs,n=new Wh(e,i),r=new Wh(t,i),o=new Wh(s,i);return n.next=o.prev=r,r.next=n.prev=o,o.next=r.prev=n,i.edge=n,i.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){const e=this.edge.tail(),t=this.edge.head(),s=this.edge.next.head();return Pa.set(e.point,t.point,s.point),Pa.getNormal(this.normal),Pa.getMidpoint(this.midpoint),this.area=Pa.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}class Wh{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceTo(e.point):-1}lengthSquared(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}}class A1{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}}class sp{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,t.prev===null?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,t.next===null?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail;e.next!==null;)e=e.next;return this.tail=e,this}remove(e){return e.prev===null?this.head=e.next:e.prev.next=e.next,e.next===null?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return e.prev===null?this.head=t.next:e.prev.next=t.next,t.next===null?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return this.head===null}}const Sc=[2,2,1],Oc=[1,0,0];function Vs(h,e){return h*3+e}function S1(h){const e=h.elements;let t=0;for(let s=0;s<9;s++)t+=e[s]*e[s];return Math.sqrt(t)}function O1(h){const e=h.elements;let t=0;for(let s=0;s<3;s++){const i=e[Vs(Sc[s],Oc[s])];t+=2*i*i}return Math.sqrt(t)}function P1(h,e){let t=0,s=1;const i=h.elements;for(let l=0;l<3;l++){const c=Math.abs(i[Vs(Sc[l],Oc[l])]);c>t&&(t=c,s=l)}let n=1,r=0;const o=Oc[s],a=Sc[s];if(Math.abs(i[Vs(a,o)])>Number.EPSILON){const l=i[Vs(a,a)],c=i[Vs(o,o)],p=i[Vs(a,o)],u=(l-c)/2/p;let m;u<0?m=-1/(-u+Math.sqrt(1+u*u)):m=1/(u+Math.sqrt(1+u*u)),n=1/Math.sqrt(1+m*m),r=m*n}return e.identity(),e.elements[Vs(o,o)]=n,e.elements[Vs(a,a)]=n,e.elements[Vs(a,o)]=r,e.elements[Vs(o,a)]=-r,e}function b1(h,e){let t=0,s=0;const i=10;e.unitary.identity(),e.diagonal.copy(h);const n=e.unitary,r=e.diagonal,o=new Kt,a=new Kt,l=Number.EPSILON*S1(r);for(;s<i&&O1(r)>l;)P1(r,o),a.copy(o).transpose(),r.multiply(o),r.premultiply(a),n.multiply(o),++t>2&&(s++,t=0);return e}function x1(h){const e=[];for(let Pe=0;Pe<h.length-2;Pe+=3){const Ce=h[Pe],Ae=h[Pe+1],wt=h[Pe+2];e.push(new O(Ce,Ae,wt))}const t=new F1;t.setFromPoints(e);const s={unitary:new Kt,diagonal:new Kt},i=t.faces,n=[],r=[];for(let Pe=0,Ce=i.length;Pe<Ce;Pe++){const Ae=i[Pe];let wt=Ae.edge;n.length=0;do n.push(wt),wt=wt.next;while(wt!==Ae.edge);const ke=n.length-2;for(let zt=1,ur=ke;zt<=ur;zt++){const Yt=n[0].vertex,Js=n[zt+0].vertex,$s=n[zt+1].vertex;r.push(Yt.point.x,Yt.point.y,Yt.point.z),r.push(Js.point.x,Js.point.y,Js.point.z),r.push($s.point.x,$s.point.y,$s.point.z)}}const o=new O,a=new O,l=new O,c=new O,p=new O,u=new O,m=new O,E=new O;let g=0,T=0,y=0,v=0,A=0,C=0,F=0;for(let Pe=0,Ce=r.length;Pe<Ce;Pe+=9){o.fromArray(r,Pe),a.fromArray(r,Pe+3),l.fromArray(r,Pe+6),m.set(0,0,0),m.add(o).add(a).add(l).divideScalar(3),c.subVectors(a,o),p.subVectors(l,o);const Ae=u.crossVectors(c,p).length()/2;E.add(u.copy(m).multiplyScalar(Ae)),g+=Ae,T+=(9*m.x*m.x+o.x*o.x+a.x*a.x+l.x*l.x)*(Ae/12),y+=(9*m.x*m.y+o.x*o.y+a.x*a.y+l.x*l.y)*(Ae/12),v+=(9*m.x*m.z+o.x*o.z+a.x*a.z+l.x*l.z)*(Ae/12),A+=(9*m.y*m.y+o.y*o.y+a.y*a.y+l.y*l.y)*(Ae/12),C+=(9*m.y*m.z+o.y*o.z+a.y*a.z+l.y*l.z)*(Ae/12),F+=(9*m.z*m.z+o.z*o.z+a.z*a.z+l.z*l.z)*(Ae/12)}E.divideScalar(g),T/=g,y/=g,v/=g,A/=g,C/=g,F/=g,T-=E.x*E.x,y-=E.x*E.y,v-=E.x*E.z,A-=E.y*E.y,C-=E.y*E.z,F-=E.z*E.z;const M=new Kt;M.elements[0]=T,M.elements[1]=y,M.elements[2]=v,M.elements[3]=y,M.elements[4]=A,M.elements[5]=C,M.elements[6]=v,M.elements[7]=C,M.elements[8]=F,b1(M,s);const _=s.unitary,L=new O,D=new O,B=new O;_.extractBasis(L,D,B);let z=-1/0,V=-1/0,Q=-1/0,ne=1/0,ue=1/0,oe=1/0;for(let Pe=0,Ce=e.length;Pe<Ce;Pe++){const Ae=e[Pe];z=Math.max(L.dot(Ae),z),V=Math.max(D.dot(Ae),V),Q=Math.max(B.dot(Ae),Q),ne=Math.min(L.dot(Ae),ne),ue=Math.min(D.dot(Ae),ue),oe=Math.min(B.dot(Ae),oe)}L.multiplyScalar(.5*(ne+z)),D.multiplyScalar(.5*(ue+V)),B.multiplyScalar(.5*(oe+Q));const Ie=new O,ce=new O,ye=new Kt;Ie.add(L).add(D).add(B),ce.x=z-ne,ce.y=V-ue,ce.z=Q-oe,ce.multiplyScalar(.5),ye.copy(_);const{x:Ze,y:gt,z:Is}=ce,yt=new de;yt.makeScale(Ze*2,gt*2,Is*2);const ui=new de;ui.makeTranslation(-Ze,-gt,-Is);const Ps=new de;Ps.makeTranslation(Ie.x,Ie.y,Ie.z);const is=new de;is.setFromMatrix3(ye);const Bt=new de;return Bt.multiply(Ps),Bt.multiply(is),Bt.multiply(ui),Bt.multiply(yt),{center:Ie,halfSizes:ce,rotation:ye,transformation:Bt}}function M1(h,e,t){const s=[h[0]-e[0],h[1]-e[1],h[2]-e[2]];return t[0]*s[0]+t[1]*s[1]+t[2]*s[2]>0}class ip{static isTransparent(e){return e.transparent&&e.opacity<1}}const Pc=class At{static create(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return`${At._lut[e&255]+At._lut[e>>8&255]+At._lut[e>>16&255]+At._lut[e>>24&255]}-${At._lut[t&255]}${At._lut[t>>8&255]}-${At._lut[t>>16&15|64]}${At._lut[t>>24&255]}-${At._lut[s&63|128]}${At._lut[s>>8&255]}-${At._lut[s>>16&255]}${At._lut[s>>24&255]}${At._lut[i&255]}${At._lut[i>>8&255]}${At._lut[i>>16&255]}${At._lut[i>>24&255]}`.toLowerCase()}static validate(e){if(!At._pattern.test(e))throw new Error(`${e} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};x(Pc,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/),x(Pc,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let dd=Pc;class _1 extends De{constructor(e,t){super(e),x(this,"onDisposed",new te),x(this,"onVertexFound",new te),x(this,"onVertexLost",new te),x(this,"onEnabled",new te),x(this,"components"),x(this,"workingPlane",null),x(this,"_pickedPoint",null),x(this,"_config"),x(this,"_enabled",!1),this.components=e,this.config={snapDistance:.25,showOnlyVertex:!1,...t},this.enabled=!1}set enabled(e){this._enabled=e,e||(this._pickedPoint=null),this.onEnabled.trigger(e)}get enabled(){return this._enabled}set config(e){this._config={...this._config,...e}}get config(){return this._config}dispose(){this.onVertexFound.reset(),this.onVertexLost.reset(),this.components=null,this.onDisposed.trigger(),this.onDisposed.reset()}get(e){if(!this.enabled)return this._pickedPoint;const t=this.components.get(As).get(e).castRay();if(!t)return this._pickedPoint!==null&&(this.onVertexLost.trigger(),this._pickedPoint=null),this._pickedPoint;const s=this.getClosestVertex(t);return s?!this.workingPlane||Math.abs(this.workingPlane.distanceToPoint(s))<.001?((this._pickedPoint===null||!this._pickedPoint.equals(s))&&(this._pickedPoint=s.clone(),this.onVertexFound.trigger(this._pickedPoint)),this._pickedPoint):(this._pickedPoint=null,this._pickedPoint):(this._pickedPoint!==null&&(this.onVertexLost.trigger(),this._pickedPoint=null),this._pickedPoint)}getClosestVertex(e){let t=new O,s=!1,i=Number.MAX_SAFE_INTEGER;const n=this.getVertices(e);if(n===null)return null;for(const r of n){if(!r)continue;const o=e.point.distanceTo(r);o>i||o>this._config.snapDistance||(s=!0,t=r,i=e.point.distanceTo(r))}return s?t:this.config.showOnlyVertex?null:e.point}getVertices(e){const t=e.object;if(!e.face||!t)return null;const s=t.geometry,i=new de,{instanceId:n}=e,r=n!==void 0,o=t instanceof Ot;return o&&r&&t.getMatrixAt(n,i),[this.getVertex(e.face.a,s),this.getVertex(e.face.b,s),this.getVertex(e.face.c,s)].map(a=>(a&&(o&&r&&a.applyMatrix4(i),a.applyMatrix4(t.matrixWorld)),a))}getVertex(e,t){if(e===void 0)return null;const s=t.attributes.position;return new O(s.getX(e),s.getY(e),s.getZ(e))}}const Hf=class Wf{constructor(){x(this,"onDisposed",new te),x(this,"list",new Map),x(this,"enabled",!1),x(this,"_clock"),x(this,"update",()=>{if(!this.enabled)return;const e=this._clock.getDelta();for(const[t,s]of this.list)s.enabled&&s.isUpdateable()&&s.update(e);requestAnimationFrame(this.update)}),this._clock=new Kc,Wf.setupBVH()}add(e,t){if(this.list.has(e))throw new Error("You're trying to add a component that already exists in the components instance. Use Components.get() instead.");dd.validate(e),this.list.set(e,t)}get(e){const t=e.uuid;if(!this.list.has(t)){const s=new e(this);return this.list.has(t)||this.add(t,s),s}return this.list.get(t)}init(){this.enabled=!0,this._clock.start(),this.update()}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.enabled=!1,t.isDisposeable()&&t.dispose();this._clock.stop(),this.onDisposed.trigger(),this.onDisposed.reset()}static setupBVH(){ze.prototype.computeBoundsTree=C1,ze.prototype.disposeBoundsTree=T1,J.prototype.raycast=I1}};x(Hf,"release","2.1.27");let L1=Hf;class N1 extends cd{constructor(){super(...arguments),x(this,"meshes",new Set),x(this,"onAfterUpdate",new te),x(this,"onBeforeUpdate",new te),x(this,"onDisposed",new te),x(this,"isDisposing",!1),x(this,"enabled",!0),x(this,"uuid",dd.create()),x(this,"name"),x(this,"_scene"),x(this,"_camera"),x(this,"_renderer",null)}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(e){this._scene=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(e){this._camera=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get renderer(){return this._renderer}set renderer(e){this._renderer=e,e&&(e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"}))}update(e){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(e),this.camera.isUpdateable()&&this.camera.update(e),this.renderer&&this.renderer.update(e),this.onAfterUpdate.trigger()))}dispose(e=!0){if(this.enabled=!1,this.isDisposing=!0,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),e){const t=this.components.get(Ks);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const s of this.meshes)t.destroy(s);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.onDisposed.trigger()}}class D1 extends w1{constructor(e,t,s){super(e),x(this,"enabled",!0),x(this,"container"),x(this,"three"),x(this,"_canvas"),x(this,"_parameters"),x(this,"_resizeObserver",null),x(this,"onContainerUpdated",new te),x(this,"_resizing",!1),x(this,"resize",r=>{if(this._resizing)return;this._resizing=!0,this.onContainerUpdated.trigger();const o=r?r.x:this.container.clientWidth,a=r?r.y:this.container.clientHeight;this.three.setSize(o,a),this.onResize.trigger(new Ue(o,a)),this._resizing=!1}),x(this,"resizeEvent",()=>{this.resize()}),x(this,"onContextLost",r=>{r.preventDefault(),this.enabled=!1}),x(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new _i({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0}),this.container=t,this._parameters=s,this.three=new _i({antialias:!0,alpha:!0,...s}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const i=this.three.getContext(),{canvas:n}=i;n.addEventListener("webglcontextlost",this.onContextLost,!1),n.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const e=this.currentWorld.scene.three,t=this.currentWorld.camera.three;this.three.render(e,t),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.forceContextLoss(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new Ue(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(e){const t=this.three.domElement.parentElement;if(!t)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),e&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(t),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Fe={LEFT:1,RIGHT:2,MIDDLE:4},ie=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),Vn={NONE:0,IN:1,OUT:-1};function ji(h){return h.isPerspectiveCamera}function Fi(h){return h.isOrthographicCamera}const Gn=Math.PI*2,np=Math.PI/2,Xf=1e-5,Kr=Math.PI/180;function vs(h,e,t){return Math.max(e,Math.min(t,h))}function et(h,e=Xf){return Math.abs(h)<e}function Xe(h,e,t=Xf){return et(h-e,t)}function rp(h,e){return Math.round(h/e)*e}function Zr(h){return isFinite(h)?h:h<0?-Number.MAX_VALUE:Number.MAX_VALUE}function jr(h){return Math.abs(h)<Number.MAX_VALUE?h:h*(1/0)}function ba(h,e,t,s,i=1/0,n){s=Math.max(1e-4,s);const r=2/s,o=r*n,a=1/(1+o+.48*o*o+.235*o*o*o);let l=h-e;const c=e,p=i*s;l=vs(l,-p,p),e=h-l;const u=(t.value+r*l)*n;t.value=(t.value-r*u)*a;let m=e+(l+u)*a;return c-h>0==m>c&&(m=c,t.value=(m-c)/n),m}function op(h,e,t,s,i=1/0,n,r){s=Math.max(1e-4,s);const o=2/s,a=o*n,l=1/(1+a+.48*a*a+.235*a*a*a);let c=e.x,p=e.y,u=e.z,m=h.x-c,E=h.y-p,g=h.z-u;const T=c,y=p,v=u,A=i*s,C=A*A,F=m*m+E*E+g*g;if(F>C){const ue=Math.sqrt(F);m=m/ue*A,E=E/ue*A,g=g/ue*A}c=h.x-m,p=h.y-E,u=h.z-g;const M=(t.x+o*m)*n,_=(t.y+o*E)*n,L=(t.z+o*g)*n;t.x=(t.x-o*M)*l,t.y=(t.y-o*_)*l,t.z=(t.z-o*L)*l,r.x=c+(m+M)*l,r.y=p+(E+_)*l,r.z=u+(g+L)*l;const D=T-h.x,B=y-h.y,z=v-h.z,V=r.x-T,Q=r.y-y,ne=r.z-v;return D*V+B*Q+z*ne>0&&(r.x=T,r.y=y,r.z=v,t.x=(r.x-T)/n,t.y=(r.y-y)/n,t.z=(r.z-v)/n),r}function Xh(h,e){e.set(0,0),h.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=h.length,e.y/=h.length}function Kh(h,e){return Fi(h)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class U1{constructor(){this._listeners={}}addEventListener(e,t){const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){const s=this._listeners[e];if(s!==void 0){const i=s.indexOf(t);i!==-1&&s.splice(i,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const t=this._listeners[e.type];if(t!==void 0){e.target=this;const s=t.slice(0);for(let i=0,n=s.length;i<n;i++)s[i].call(this,e)}}}const B1="2.7.3",xa=1/8,Kf=typeof window<"u",z1=Kf&&/Mac/.test(navigator.platform),Y1=!(Kf&&"PointerEvent"in window);let ve,ap,Ma,Zh,Xt,xe,He,Hn,Qr,Ds,Us,Qi,lp,hp,os,qr,Wn,cp,jh,dp,Qh,qh,_a;class co extends U1{static install(e){ve=e.THREE,ap=Object.freeze(new ve.Vector3(0,0,0)),Ma=Object.freeze(new ve.Vector3(0,1,0)),Zh=Object.freeze(new ve.Vector3(0,0,1)),Xt=new ve.Vector2,xe=new ve.Vector3,He=new ve.Vector3,Hn=new ve.Vector3,Qr=new ve.Vector3,Ds=new ve.Vector3,Us=new ve.Vector3,Qi=new ve.Vector3,lp=new ve.Vector3,hp=new ve.Vector3,os=new ve.Spherical,qr=new ve.Spherical,Wn=new ve.Box3,cp=new ve.Box3,jh=new ve.Sphere,dp=new ve.Quaternion,Qh=new ve.Quaternion,qh=new ve.Matrix4,_a=new ve.Raycaster}static get ACTION(){return ie}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=ie.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Vn.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new ve.Vector3,this._focalOffsetVelocity=new ve.Vector3,this._zoomVelocity={value:0},this._truckInternal=(C,F,M)=>{let _,L;if(ji(this._camera)){const D=xe.copy(this._camera.position).sub(this._target),B=this._camera.getEffectiveFOV()*Kr,z=D.length()*Math.tan(B*.5);_=this.truckSpeed*C*z/this._elementRect.height,L=this.truckSpeed*F*z/this._elementRect.height}else if(Fi(this._camera)){const D=this._camera;_=C*(D.right-D.left)/D.zoom/this._elementRect.width,L=F*(D.top-D.bottom)/D.zoom/this._elementRect.height}else return;this.verticalDragToForward?(M?this.setFocalOffset(this._focalOffsetEnd.x+_,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(_,0,!0),this.forward(-L,!0)):M?this.setFocalOffset(this._focalOffsetEnd.x+_,this._focalOffsetEnd.y+L,this._focalOffsetEnd.z,!0):this.truck(_,L,!0)},this._rotateInternal=(C,F)=>{const M=Gn*this.azimuthRotateSpeed*C/this._elementRect.height,_=Gn*this.polarRotateSpeed*F/this._elementRect.height;this.rotate(M,_,!0)},this._dollyInternal=(C,F,M)=>{const _=Math.pow(.95,-C*this.dollySpeed),L=this._sphericalEnd.radius,D=this._sphericalEnd.radius*_,B=vs(D,this.minDistance,this.maxDistance),z=B-D;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(D,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(z,!0),this._dollyToNoClamp(B,!0)):this._dollyToNoClamp(B,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?D:B)-L,this._dollyControlCoord.set(F,M)),this._lastDollyDirection=Math.sign(-C)},this._zoomInternal=(C,F,M)=>{const _=Math.pow(.95,C*this.dollySpeed),L=this._zoom,D=this._zoom*_;this.zoomTo(D,!0),this.dollyToCursor&&(this._changedZoom+=D-L,this._dollyControlCoord.set(F,M))},typeof ve>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new ve.Quaternion().setFromUnitVectors(this._camera.up,Ma),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=ie.NONE,this._target=new ve.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new ve.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new ve.Spherical().setFromVector3(xe.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new ve.Vector3,new ve.Vector3,new ve.Vector3,new ve.Vector3],this._updateNearPlaneCorners(),this._boundary=new ve.Box3(new ve.Vector3(-1/0,-1/0,-1/0),new ve.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new ve.Vector2,this.mouseButtons={left:ie.ROTATE,middle:ie.DOLLY,right:ie.TRUCK,wheel:ji(this._camera)?ie.DOLLY:Fi(this._camera)?ie.ZOOM:ie.NONE},this.touches={one:ie.TOUCH_ROTATE,two:ji(this._camera)?ie.TOUCH_DOLLY_TRUCK:Fi(this._camera)?ie.TOUCH_ZOOM_TRUCK:ie.NONE,three:ie.TOUCH_TRUCK};const s=new ve.Vector2,i=new ve.Vector2,n=new ve.Vector2,r=C=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const _=this._domElement.getBoundingClientRect(),L=C.clientX/_.width,D=C.clientY/_.height;if(L<this._interactiveArea.left||L>this._interactiveArea.right||D<this._interactiveArea.top||D>this._interactiveArea.bottom)return}const F=C.pointerType!=="mouse"?null:(C.buttons&Fe.LEFT)===Fe.LEFT?Fe.LEFT:(C.buttons&Fe.MIDDLE)===Fe.MIDDLE?Fe.MIDDLE:(C.buttons&Fe.RIGHT)===Fe.RIGHT?Fe.RIGHT:null;if(F!==null){const _=this._findPointerByMouseButton(F);_&&this._disposePointer(_)}if((C.buttons&Fe.LEFT)===Fe.LEFT&&this._lockedPointer)return;const M={pointerId:C.pointerId,clientX:C.clientX,clientY:C.clientY,deltaX:0,deltaY:0,mouseButton:F};this._activePointers.push(M),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),this._isDragging=!0,g(C)},o=C=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const _=this._domElement.getBoundingClientRect(),L=C.clientX/_.width,D=C.clientY/_.height;if(L<this._interactiveArea.left||L>this._interactiveArea.right||D<this._interactiveArea.top||D>this._interactiveArea.bottom)return}const F=(C.buttons&Fe.LEFT)===Fe.LEFT?Fe.LEFT:(C.buttons&Fe.MIDDLE)===Fe.MIDDLE?Fe.MIDDLE:(C.buttons&Fe.RIGHT)===Fe.RIGHT?Fe.RIGHT:null;if(F!==null){const _=this._findPointerByMouseButton(F);_&&this._disposePointer(_)}const M={pointerId:1,clientX:C.clientX,clientY:C.clientY,deltaX:0,deltaY:0,mouseButton:(C.buttons&Fe.LEFT)===Fe.LEFT?Fe.LEFT:(C.buttons&Fe.MIDDLE)===Fe.LEFT?Fe.MIDDLE:(C.buttons&Fe.RIGHT)===Fe.LEFT?Fe.RIGHT:null};this._activePointers.push(M),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("mouseup",p),this._domElement.ownerDocument.addEventListener("mousemove",l),this._domElement.ownerDocument.addEventListener("mouseup",p),this._isDragging=!0,g(C)},a=C=>{C.cancelable&&C.preventDefault();const F=C.pointerId,M=this._lockedPointer||this._findPointerById(F);if(M){if(M.clientX=C.clientX,M.clientY=C.clientY,M.deltaX=C.movementX,M.deltaY=C.movementY,this._state=0,C.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(C.buttons&Fe.LEFT)===Fe.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(C.buttons&Fe.MIDDLE)===Fe.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(C.buttons&Fe.RIGHT)===Fe.RIGHT&&(this._state=this._state|this.mouseButtons.right);T()}},l=C=>{const F=this._lockedPointer||this._findPointerById(1);F&&(F.clientX=C.clientX,F.clientY=C.clientY,F.deltaX=C.movementX,F.deltaY=C.movementY,this._state=0,(this._lockedPointer||(C.buttons&Fe.LEFT)===Fe.LEFT)&&(this._state=this._state|this.mouseButtons.left),(C.buttons&Fe.MIDDLE)===Fe.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(C.buttons&Fe.RIGHT)===Fe.RIGHT&&(this._state=this._state|this.mouseButtons.right),T())},c=C=>{const F=this._findPointerById(C.pointerId);if(!(F&&F===this._lockedPointer)){if(F&&this._disposePointer(F),C.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=ie.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=ie.NONE;y()}},p=()=>{const C=this._findPointerById(1);C&&C===this._lockedPointer||(C&&this._disposePointer(C),this._state=ie.NONE,y())};let u=-1;const m=C=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===ie.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const D=this._domElement.getBoundingClientRect(),B=C.clientX/D.width,z=C.clientY/D.height;if(B<this._interactiveArea.left||B>this._interactiveArea.right||z<this._interactiveArea.top||z>this._interactiveArea.bottom)return}if(C.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===ie.ROTATE||this.mouseButtons.wheel===ie.TRUCK){const D=performance.now();u-D<1e3&&this._getClientRect(this._elementRect),u=D}const F=z1?-1:-3,M=C.deltaMode===1?C.deltaY/F:C.deltaY/(F*10),_=this.dollyToCursor?(C.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,L=this.dollyToCursor?(C.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case ie.ROTATE:{this._rotateInternal(C.deltaX,C.deltaY),this._isUserControllingRotate=!0;break}case ie.TRUCK:{this._truckInternal(C.deltaX,C.deltaY,!1),this._isUserControllingTruck=!0;break}case ie.OFFSET:{this._truckInternal(C.deltaX,C.deltaY,!0),this._isUserControllingOffset=!0;break}case ie.DOLLY:{this._dollyInternal(-M,_,L),this._isUserControllingDolly=!0;break}case ie.ZOOM:{this._zoomInternal(-M,_,L),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},E=C=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===co.ACTION.NONE){const F=C instanceof PointerEvent?C.pointerId:0,M=this._findPointerById(F);M&&this._disposePointer(M),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("mouseup",p);return}C.preventDefault()}},g=C=>{if(this._enabled){if(Xh(this._activePointers,Xt),this._getClientRect(this._elementRect),s.copy(Xt),i.copy(Xt),this._activePointers.length>=2){const F=Xt.x-this._activePointers[1].clientX,M=Xt.y-this._activePointers[1].clientY,_=Math.sqrt(F*F+M*M);n.set(0,_);const L=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,D=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(L,D)}if(this._state=0,!C)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in C&&C.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(C.buttons&Fe.LEFT)===Fe.LEFT&&(this._state=this._state|this.mouseButtons.left),(C.buttons&Fe.MIDDLE)===Fe.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(C.buttons&Fe.RIGHT)===Fe.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&ie.ROTATE)===ie.ROTATE||(this._state&ie.TOUCH_ROTATE)===ie.TOUCH_ROTATE||(this._state&ie.TOUCH_DOLLY_ROTATE)===ie.TOUCH_DOLLY_ROTATE||(this._state&ie.TOUCH_ZOOM_ROTATE)===ie.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&ie.TRUCK)===ie.TRUCK||(this._state&ie.TOUCH_TRUCK)===ie.TOUCH_TRUCK||(this._state&ie.TOUCH_DOLLY_TRUCK)===ie.TOUCH_DOLLY_TRUCK||(this._state&ie.TOUCH_ZOOM_TRUCK)===ie.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&ie.DOLLY)===ie.DOLLY||(this._state&ie.TOUCH_DOLLY)===ie.TOUCH_DOLLY||(this._state&ie.TOUCH_DOLLY_TRUCK)===ie.TOUCH_DOLLY_TRUCK||(this._state&ie.TOUCH_DOLLY_OFFSET)===ie.TOUCH_DOLLY_OFFSET||(this._state&ie.TOUCH_DOLLY_ROTATE)===ie.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&ie.ZOOM)===ie.ZOOM||(this._state&ie.TOUCH_ZOOM)===ie.TOUCH_ZOOM||(this._state&ie.TOUCH_ZOOM_TRUCK)===ie.TOUCH_ZOOM_TRUCK||(this._state&ie.TOUCH_ZOOM_OFFSET)===ie.TOUCH_ZOOM_OFFSET||(this._state&ie.TOUCH_ZOOM_ROTATE)===ie.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&ie.OFFSET)===ie.OFFSET||(this._state&ie.TOUCH_OFFSET)===ie.TOUCH_OFFSET||(this._state&ie.TOUCH_DOLLY_OFFSET)===ie.TOUCH_DOLLY_OFFSET||(this._state&ie.TOUCH_ZOOM_OFFSET)===ie.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},T=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Xh(this._activePointers,Xt);const C=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,F=C?-C.deltaX:i.x-Xt.x,M=C?-C.deltaY:i.y-Xt.y;if(i.copy(Xt),((this._state&ie.ROTATE)===ie.ROTATE||(this._state&ie.TOUCH_ROTATE)===ie.TOUCH_ROTATE||(this._state&ie.TOUCH_DOLLY_ROTATE)===ie.TOUCH_DOLLY_ROTATE||(this._state&ie.TOUCH_ZOOM_ROTATE)===ie.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(F,M),this._isUserControllingRotate=!0),(this._state&ie.DOLLY)===ie.DOLLY||(this._state&ie.ZOOM)===ie.ZOOM){const _=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,L=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,D=this.dollyDragInverted?-1:1;(this._state&ie.DOLLY)===ie.DOLLY?(this._dollyInternal(D*M*xa,_,L),this._isUserControllingDolly=!0):(this._zoomInternal(D*M*xa,_,L),this._isUserControllingZoom=!0)}if((this._state&ie.TOUCH_DOLLY)===ie.TOUCH_DOLLY||(this._state&ie.TOUCH_ZOOM)===ie.TOUCH_ZOOM||(this._state&ie.TOUCH_DOLLY_TRUCK)===ie.TOUCH_DOLLY_TRUCK||(this._state&ie.TOUCH_ZOOM_TRUCK)===ie.TOUCH_ZOOM_TRUCK||(this._state&ie.TOUCH_DOLLY_OFFSET)===ie.TOUCH_DOLLY_OFFSET||(this._state&ie.TOUCH_ZOOM_OFFSET)===ie.TOUCH_ZOOM_OFFSET||(this._state&ie.TOUCH_DOLLY_ROTATE)===ie.TOUCH_DOLLY_ROTATE||(this._state&ie.TOUCH_ZOOM_ROTATE)===ie.TOUCH_ZOOM_ROTATE){const _=Xt.x-this._activePointers[1].clientX,L=Xt.y-this._activePointers[1].clientY,D=Math.sqrt(_*_+L*L),B=n.y-D;n.set(0,D);const z=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,V=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&ie.TOUCH_DOLLY)===ie.TOUCH_DOLLY||(this._state&ie.TOUCH_DOLLY_ROTATE)===ie.TOUCH_DOLLY_ROTATE||(this._state&ie.TOUCH_DOLLY_TRUCK)===ie.TOUCH_DOLLY_TRUCK||(this._state&ie.TOUCH_DOLLY_OFFSET)===ie.TOUCH_DOLLY_OFFSET?(this._dollyInternal(B*xa,z,V),this._isUserControllingDolly=!0):(this._zoomInternal(B*xa,z,V),this._isUserControllingZoom=!0)}((this._state&ie.TRUCK)===ie.TRUCK||(this._state&ie.TOUCH_TRUCK)===ie.TOUCH_TRUCK||(this._state&ie.TOUCH_DOLLY_TRUCK)===ie.TOUCH_DOLLY_TRUCK||(this._state&ie.TOUCH_ZOOM_TRUCK)===ie.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(F,M,!1),this._isUserControllingTruck=!0),((this._state&ie.OFFSET)===ie.OFFSET||(this._state&ie.TOUCH_OFFSET)===ie.TOUCH_OFFSET||(this._state&ie.TOUCH_DOLLY_OFFSET)===ie.TOUCH_DOLLY_OFFSET||(this._state&ie.TOUCH_ZOOM_OFFSET)===ie.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(F,M,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},y=()=>{Xh(this._activePointers,Xt),i.copy(Xt),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("mouseup",p),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",v),this._domElement.ownerDocument.addEventListener("pointerlockerror",A),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",c),g())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",v),this._domElement.ownerDocument.removeEventListener("pointerlockerror",A))};const v=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},A=()=>{this.unlockPointer()};this._addAllEventListeners=C=>{this._domElement=C,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",r),Y1&&this._domElement.addEventListener("mousedown",o),this._domElement.addEventListener("pointercancel",c),this._domElement.addEventListener("wheel",m,{passive:!1}),this._domElement.addEventListener("contextmenu",E)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",r),this._domElement.removeEventListener("mousedown",o),this._domElement.removeEventListener("pointercancel",c),this._domElement.removeEventListener("wheel",m,{passive:!1}),this._domElement.removeEventListener("contextmenu",E),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("pointerup",c),this._domElement.ownerDocument.removeEventListener("mouseup",p),this._domElement.ownerDocument.removeEventListener("pointerlockchange",v),this._domElement.ownerDocument.removeEventListener("pointerlockerror",A))},this.cancel=()=>{this._state!==ie.NONE&&(this._state=ie.NONE,this._activePointers.length=0,y())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=vs(e.width,0,1),this._interactiveArea.height=vs(e.height,0,1),this._interactiveArea.x=vs(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=vs(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,s=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,s)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,s=!1){this._isUserControllingRotate=!1;const i=vs(e,this.minAzimuthAngle,this.maxAzimuthAngle),n=vs(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=n,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const r=!s||Xe(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Xe(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(r)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Vn.NONE,this._changedDolly=0,this._dollyToNoClamp(vs(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const n=this._collisionTest(),r=Xe(n,this._spherical.radius);if(!(s>e)&&r)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,n)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const i=!t||Xe(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(i)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(Qr).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const s=!t||Xe(this._target.x,this._targetEnd.x,this.restThreshold)&&Xe(this._target.y,this._targetEnd.y,this.restThreshold)&&Xe(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=vs(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const s=!t||Xe(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(e,t,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,s)}truck(e,t,s=!1){this._camera.updateMatrix(),Ds.setFromMatrixColumn(this._camera.matrix,0),Us.setFromMatrixColumn(this._camera.matrix,1),Ds.multiplyScalar(e),Us.multiplyScalar(-t);const i=xe.copy(Ds).add(Us),n=He.copy(this._targetEnd).add(i);return this.moveTo(n.x,n.y,n.z,s)}forward(e,t=!1){xe.setFromMatrixColumn(this._camera.matrix,0),xe.crossVectors(this._camera.up,xe),xe.multiplyScalar(e);const s=He.copy(this._targetEnd).add(xe);return this.moveTo(s.x,s.y,s.z,t)}elevate(e,t=!1){return xe.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+xe.x,this._targetEnd.y+xe.y,this._targetEnd.z+xe.z,t)}moveTo(e,t,s,i=!1){this._isUserControllingTruck=!1;const n=xe.set(e,t,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,n,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const r=!i||Xe(this._target.x,this._targetEnd.x,this.restThreshold)&&Xe(this._target.y,this._targetEnd.y,this.restThreshold)&&Xe(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}lookInDirectionOf(e,t,s,i=!1){const n=xe.set(e,t,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(n.x,n.y,n.z,i)}fitToBox(e,t,{cover:s=!1,paddingLeft:i=0,paddingRight:n=0,paddingBottom:r=0,paddingTop:o=0}={}){const a=[],l=e.isBox3?Wn.copy(e):Wn.setFromObject(e);l.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const c=rp(this._sphericalEnd.theta,np),p=rp(this._sphericalEnd.phi,np);a.push(this.rotateTo(c,p,t));const u=xe.setFromSpherical(this._sphericalEnd).normalize(),m=dp.setFromUnitVectors(u,Zh),E=Xe(Math.abs(u.y),1);E&&m.multiply(Qh.setFromAxisAngle(Ma,c)),m.multiply(this._yAxisUpSpaceInverse);const g=cp.makeEmpty();He.copy(l.min).applyQuaternion(m),g.expandByPoint(He),He.copy(l.min).setX(l.max.x).applyQuaternion(m),g.expandByPoint(He),He.copy(l.min).setY(l.max.y).applyQuaternion(m),g.expandByPoint(He),He.copy(l.max).setZ(l.min.z).applyQuaternion(m),g.expandByPoint(He),He.copy(l.min).setZ(l.max.z).applyQuaternion(m),g.expandByPoint(He),He.copy(l.max).setY(l.min.y).applyQuaternion(m),g.expandByPoint(He),He.copy(l.max).setX(l.min.x).applyQuaternion(m),g.expandByPoint(He),He.copy(l.max).applyQuaternion(m),g.expandByPoint(He),g.min.x-=i,g.min.y-=r,g.max.x+=n,g.max.y+=o,m.setFromUnitVectors(Zh,u),E&&m.premultiply(Qh.invert()),m.premultiply(this._yAxisUpSpace);const T=g.getSize(xe),y=g.getCenter(He).applyQuaternion(m);if(ji(this._camera)){const v=this.getDistanceToFitBox(T.x,T.y,T.z,s);a.push(this.moveTo(y.x,y.y,y.z,t)),a.push(this.dollyTo(v,t)),a.push(this.setFocalOffset(0,0,0,t))}else if(Fi(this._camera)){const v=this._camera,A=v.right-v.left,C=v.top-v.bottom,F=s?Math.max(A/T.x,C/T.y):Math.min(A/T.x,C/T.y);a.push(this.moveTo(y.x,y.y,y.z,t)),a.push(this.zoomTo(F,t)),a.push(this.setFocalOffset(0,0,0,t))}return Promise.all(a)}fitToSphere(e,t){const s=[],i=e instanceof ve.Sphere?jh.copy(e):co.createBoundingSphere(e,jh);if(s.push(this.moveTo(i.center.x,i.center.y,i.center.z,t)),ji(this._camera)){const n=this.getDistanceToFitSphere(i.radius);s.push(this.dollyTo(n,t))}else if(Fi(this._camera)){const n=this._camera.right-this._camera.left,r=this._camera.top-this._camera.bottom,o=2*i.radius,a=Math.min(n/o,r/o);s.push(this.zoomTo(a,t))}return s.push(this.setFocalOffset(0,0,0,t)),Promise.all(s)}setLookAt(e,t,s,i,n,r,o=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Vn.NONE,this._changedDolly=0;const a=He.set(i,n,r),l=xe.set(e,t,s);this._targetEnd.copy(a),this._sphericalEnd.setFromVector3(l.sub(a).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const c=!o||Xe(this._target.x,this._targetEnd.x,this.restThreshold)&&Xe(this._target.y,this._targetEnd.y,this.restThreshold)&&Xe(this._target.z,this._targetEnd.z,this.restThreshold)&&Xe(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Xe(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Xe(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(c)}lerpLookAt(e,t,s,i,n,r,o,a,l,c,p,u,m,E=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Vn.NONE,this._changedDolly=0;const g=xe.set(i,n,r),T=He.set(e,t,s);os.setFromVector3(T.sub(g).applyQuaternion(this._yAxisUpSpace));const y=Hn.set(c,p,u),v=He.set(o,a,l);qr.setFromVector3(v.sub(y).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(g.lerp(y,m));const A=qr.theta-os.theta,C=qr.phi-os.phi,F=qr.radius-os.radius;this._sphericalEnd.set(os.radius+F*m,os.phi+C*m,os.theta+A*m),this.normalizeRotations(),this._needsUpdate=!0,E||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const M=!E||Xe(this._target.x,this._targetEnd.x,this.restThreshold)&&Xe(this._target.y,this._targetEnd.y,this.restThreshold)&&Xe(this._target.z,this._targetEnd.z,this.restThreshold)&&Xe(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Xe(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Xe(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(M)}setPosition(e,t,s,i=!1){return this.setLookAt(e,t,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,s,i=!1){const n=this.getPosition(xe),r=this.setLookAt(n.x,n.y,n.z,e,t,s,i);return this._sphericalEnd.phi=vs(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),r}setFocalOffset(e,t,s,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,s),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const n=!i||Xe(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Xe(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Xe(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}setOrbitPoint(e,t,s){this._camera.updateMatrixWorld(),Ds.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Us.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Qi.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=xe.set(e,t,s),n=i.distanceTo(this._camera.position),r=i.sub(this._camera.position);Ds.multiplyScalar(r.x),Us.multiplyScalar(r.y),Qi.multiplyScalar(r.z),xe.copy(Ds).add(Us).add(Qi),xe.z=xe.z+n,this.dollyTo(n,!1),this.setFocalOffset(-xe.x,xe.y,-xe.z,!1),this.moveTo(e,t,s,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,s,i){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new ve.Vector4,typeof e=="number"?this._viewport.set(e,t,s,i):this._viewport.copy(e)}getDistanceToFitBox(e,t,s,i=!1){if(Kh(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const n=e/t,r=this._camera.getEffectiveFOV()*Kr,o=this._camera.aspect;return((i?n>o:n<o)?t:e/o)*.5/Math.tan(r*.5)+s*.5}getDistanceToFitSphere(e){if(Kh(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*Kr,s=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?t:s;return e/Math.sin(i*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new ve.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new ve.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e&&e instanceof ve.Spherical?e:new ve.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new ve.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Gn,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Gn),this._spherical.theta+=Gn*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Gn)}reset(e=!1){if(!Xe(this._camera.up.x,this._cameraUp0.x)||!Xe(this._camera.up.y,this._cameraUp0.y)||!Xe(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(xe);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Ma),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=xe.subVectors(this._target,this._camera.position).normalize(),t=He.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(xe);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,n=lp.subVectors(this._targetEnd,this._target),r=hp.subVectors(this._focalOffsetEnd,this._focalOffset),o=this._zoomEnd-this._zoom;if(et(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const c=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=ba(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,c,1/0,e),this._needsUpdate=!0}if(et(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const c=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=ba(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,c,1/0,e),this._needsUpdate=!0}if(et(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const c=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=ba(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,c,this.maxSpeed,e),this._needsUpdate=!0}if(et(n.x)&&et(n.y)&&et(n.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const c=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;op(this._target,this._targetEnd,this._targetVelocity,c,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(et(r.x)&&et(r.y)&&et(r.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const c=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;op(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,c,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(et(o))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const c=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=ba(this._zoom,this._zoomEnd,this._zoomVelocity,c,1/0,e)}if(this.dollyToCursor){if(ji(this._camera)&&this._changedDolly!==0){const c=this._spherical.radius-this._lastDistance,p=this._camera,u=this._getCameraDirection(Qr),m=xe.copy(u).cross(p.up).normalize();m.lengthSq()===0&&(m.x=1);const E=He.crossVectors(m,u),g=this._sphericalEnd.radius*Math.tan(p.getEffectiveFOV()*Kr*.5),T=(this._sphericalEnd.radius-c-this._sphericalEnd.radius)/this._sphericalEnd.radius,y=Hn.copy(this._targetEnd).add(m.multiplyScalar(this._dollyControlCoord.x*g*p.aspect)).add(E.multiplyScalar(this._dollyControlCoord.y*g)),v=xe.copy(this._targetEnd).lerp(y,T),A=this._lastDollyDirection===Vn.IN&&this._spherical.radius<=this.minDistance,C=this._lastDollyDirection===Vn.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(A||C)){this._sphericalEnd.radius-=c,this._spherical.radius-=c;const M=He.copy(u).multiplyScalar(-c);v.add(M)}this._boundary.clampPoint(v,v);const F=He.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(F),this._changedDolly-=c,et(this._changedDolly)&&(this._changedDolly=0)}else if(Fi(this._camera)&&this._changedZoom!==0){const c=this._zoom-this._lastZoom,p=this._camera,u=xe.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(p.near+p.far)/(p.near-p.far)).unproject(p),m=He.set(0,0,-1).applyQuaternion(p.quaternion),E=Hn.copy(u).add(m.multiplyScalar(-u.dot(p.up))),g=-(this._zoom-c-this._zoom)/this._zoom,T=this._getCameraDirection(Qr),y=this._targetEnd.dot(T),v=xe.copy(this._targetEnd).lerp(E,g),A=v.dot(T),C=T.multiplyScalar(A-y);v.sub(C),this._boundary.clampPoint(v,v);const F=He.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(F),this._changedZoom-=c,et(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const a=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,a),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!et(this._focalOffset.x)||!et(this._focalOffset.y)||!et(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),Ds.setFromMatrixColumn(this._camera.matrix,0),Us.setFromMatrixColumn(this._camera.matrix,1),Qi.setFromMatrixColumn(this._camera.matrix,2),Ds.multiplyScalar(this._focalOffset.x),Us.multiplyScalar(-this._focalOffset.y),Qi.multiplyScalar(this._focalOffset.z),xe.copy(Ds).add(Us).add(Qi),this._camera.position.add(xe)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),xe.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const l=this._needsUpdate;return l&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):l?(this.dispatchEvent({type:"update"}),et(t,this.restThreshold)&&et(s,this.restThreshold)&&et(i,this.restThreshold)&&et(n.x,this.restThreshold)&&et(n.y,this.restThreshold)&&et(n.z,this.restThreshold)&&et(r.x,this.restThreshold)&&et(r.y,this.restThreshold)&&et(r.z,this.restThreshold)&&et(o,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!l&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=l,this._needsUpdate=!1,l}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Zr(this.maxDistance),minZoom:this.minZoom,maxZoom:Zr(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Zr(this.maxPolarAngle),minAzimuthAngle:Zr(this.minAzimuthAngle),maxAzimuthAngle:Zr(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:xe.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const s=JSON.parse(e);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=jr(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=jr(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=jr(s.maxPolarAngle),this.minAzimuthAngle=jr(s.minAzimuthAngle),this.maxAzimuthAngle=jr(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this.verticalDragToForward=s.verticalDragToForward,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],t),os.setFromVector3(xe.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(os.theta,os.phi,t),this.dollyTo(os.radius,t),this.zoomTo(s.zoom,t),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",B1),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,s){const i=t.lengthSq();if(i===0)return e;const n=He.copy(t).add(e),r=this._boundary.clampPoint(n,Hn).sub(n),o=r.lengthSq();if(o===0)return e.add(t);if(o===i)return e;if(s===0)return e.add(t).add(r);{const a=1+s*o/t.dot(r);return e.add(He.copy(t).multiplyScalar(a)).add(r.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(ji(this._camera)){const e=this._camera,t=e.near,s=e.getEffectiveFOV()*Kr,i=Math.tan(s*.5)*t,n=i*e.aspect;this._nearPlaneCorners[0].set(-n,-i,0),this._nearPlaneCorners[1].set(n,-i,0),this._nearPlaneCorners[2].set(n,i,0),this._nearPlaneCorners[3].set(-n,i,0)}else if(Fi(this._camera)){const e=this._camera,t=1/e.zoom,s=e.left*t,i=e.right*t,n=e.top*t,r=e.bottom*t;this._nearPlaneCorners[0].set(s,n,0),this._nearPlaneCorners[1].set(i,n,0),this._nearPlaneCorners[2].set(i,r,0),this._nearPlaneCorners[3].set(s,r,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||Kh(this._camera,"_collisionTest"))return e;const t=this._getTargetDirection(Qr);qh.lookAt(ap,t,this._camera.up);for(let s=0;s<4;s++){const i=He.copy(this._nearPlaneCorners[s]);i.applyMatrix4(qh);const n=Hn.addVectors(this._target,i);_a.set(n,t),_a.far=this._spherical.radius+1;const r=_a.intersectObjects(this.colliderMeshes);r.length!==0&&r[0].distance<e&&(e=r[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const s=()=>{this.removeEventListener("rest",s),t()};this.addEventListener("rest",s)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new ve.Sphere){const s=t,i=s.center;Wn.makeEmpty(),e.traverseVisible(r=>{r.isMesh&&Wn.expandByObject(r)}),Wn.getCenter(i);let n=0;return e.traverseVisible(r=>{if(!r.isMesh)return;const o=r,a=o.geometry.clone();a.applyMatrix4(o.matrixWorld);const l=a.attributes.position;for(let c=0,p=l.count;c<p;c++)xe.fromBufferAttribute(l,c),n=Math.max(n,i.distanceToSquared(xe))}),s.radius=Math.sqrt(n),s}}class rl extends y1{constructor(e){super(e),x(this,"onBeforeUpdate",new te),x(this,"onAfterUpdate",new te),x(this,"onAspectUpdated",new te),x(this,"onDisposed",new te),x(this,"three"),x(this,"_allControls",new Map),x(this,"updateAspect",()=>{var t;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof di){this.onAspectUpdated.trigger();return}if((t=this.currentWorld.renderer)!=null&&t.isResizeable()){const s=this.currentWorld.renderer.getSize();this.three.aspect=s.width/s.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.onWorldChanged.add(({action:t,world:s})=>{if(t==="added"){const i=this.newCameraControls();this._allControls.set(s.uuid,i)}if(t==="removed"){const i=this._allControls.get(s.uuid);i&&(i.dispose(),this._allControls.delete(s.uuid))}})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const e=this._allControls.get(this.currentWorld.uuid);if(!e)throw new Error("Controls not found!");return e}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(e){this.currentWorld!==null&&(this.controls.enabled=e)}dispose(){this.setupEvents(!1),this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[e,t]of this._allControls)t.dispose()}update(e){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(e),this.onAfterUpdate.trigger(this))}setupCamera(){const e=window.innerWidth/window.innerHeight,t=new Mp(60,e,1,1e3);return t.position.set(50,50,50),t.lookAt(new O(0,0,0)),t}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");co.install({THREE:rl.getSubsetOfThree()});const{domElement:e}=this.currentWorld.renderer.three,t=new co(this.three,e);return t.smoothTime=.2,t.dollyToCursor=!0,t.infinityDolly=!0,t.minDistance=6,t}setupEvents(e){e?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:_p,Vector2:Ue,Vector3:O,Vector4:an,Quaternion:ct,Matrix4:de,Spherical:Lp,Box3:Me,Sphere:Zs,Raycaster:on,MathUtils:ln}}}const Zf=class jf extends De{constructor(e){super(e),x(this,"onAfterUpdate",new te),x(this,"onBeforeUpdate",new te),x(this,"onDisposed",new te),x(this,"onWorldCreated",new te),x(this,"onWorldDeleted",new te),x(this,"list",new Map),x(this,"enabled",!0),e.add(jf.uuid,this)}create(){const e=new N1(this.components),t=e.uuid;if(this.list.has(t))throw new Error("There is already a world with this name!");return this.list.set(t,e),this.onWorldCreated.trigger(e),e}delete(e){if(!this.list.has(e.uuid))throw new Error("The provided world is not found in the list!");const t=e.uuid;this.list.delete(e.uuid),e.dispose(),this.onWorldDeleted.trigger(t)}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(e){if(this.enabled)for(const[t,s]of this.list)s.update(e)}};x(Zf,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let k1=Zf;function V1(h,e,t,s){return new Promise((i,n)=>{function r(){const o=h.clientWaitSync(e,t,0);if(o===h.WAIT_FAILED){n();return}if(o===h.TIMEOUT_EXPIRED){setTimeout(r,s);return}i()}r()})}async function G1(h,e,t,s,i,n,r){const o=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),await V1(h,o,0,10),h.deleteSync(o),h.bindBuffer(e,t),h.getBufferSubData(e,s,i,n,r),h.bindBuffer(e,null)}async function H1(h,e,t,s,i,n,r,o){const a=h.createBuffer();return h.bindBuffer(h.PIXEL_PACK_BUFFER,a),h.bufferData(h.PIXEL_PACK_BUFFER,o.byteLength,h.STREAM_READ),h.readPixels(e,t,s,i,n,r,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null),await G1(h,h.PIXEL_PACK_BUFFER,a,0,o),h.deleteBuffer(a),o}class Qf{constructor(e,t,s){if(x(this,"onDisposed",new te),x(this,"onViewUpdated",new ao),x(this,"enabled",!0),x(this,"needsUpdate",!1),x(this,"renderDebugFrame",!1),x(this,"components"),x(this,"world"),x(this,"renderer"),x(this,"autoUpdate",!0),x(this,"updateInterval",1e3),x(this,"worker"),x(this,"scene",new js),x(this,"_width",512),x(this,"_height",512),x(this,"_availableColor",1),x(this,"renderTarget"),x(this,"bufferSize"),x(this,"_buffer"),x(this,"_isWorkerBusy",!1),x(this,"updateVisibility",async r=>{if(!this.enabled||!this.needsUpdate&&!r||this._isWorkerBusy)return;this._isWorkerBusy=!0;const o=this.world.camera.three;o.updateMatrix(),this.renderer.setSize(this._width,this._height),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(this.scene,o);const a=this.renderer.getContext();await H1(a,0,0,this._width,this._height,a.RGBA,a.UNSIGNED_BYTE,this._buffer),this.renderer.setRenderTarget(null),this.renderDebugFrame&&this.renderer.render(this.scene,o),this.worker.postMessage({buffer:this._buffer}),this.needsUpdate=!1}),!t.renderer)throw new Error("The given world must have a renderer!");this.components=e,this.applySettings(s),this.world=t,this.renderer=new _i,this.renderTarget=new Ws(this._width,this._height),this.bufferSize=this._width*this._height*4,this._buffer=new Uint8Array(this.bufferSize),this.renderer.clippingPlanes=t.renderer.clippingPlanes;const i=`
      addEventListener("message", (event) => {
        const { buffer } = event.data;
        const colors = new Map();
        for (let i = 0; i < buffer.length; i += 4) {
          const r = buffer[i];
          const g = buffer[i + 1];
          const b = buffer[i + 2];
          const code = "" + r + "-" + g + "-" + b;
          if(colors.has(code)) {
            colors.set(code, colors.get(code) + 1);
          } else {
            colors.set(code, 1);
          }
        }
        postMessage({ colors });
      });
    `,n=new Blob([i],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(n))}dispose(){this.enabled=!1;for(const e of this.scene.children)e.removeFromParent();this.onViewUpdated.reset(),this.worker.terminate(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.renderTarget.dispose(),this._buffer=null,this.onDisposed.reset()}getAvailableColor(){let e=BigInt(this._availableColor.toString());const t=[];do t.unshift(Number(e%256n)),e/=256n;while(e);for(;t.length!==3;)t.unshift(0);const[s,i,n]=t,r=`${s}-${i}-${n}`;return{r:s,g:i,b:n,code:r}}increaseColor(){if(this._availableColor===256*256*256){console.warn("Color can't be increased over 256 x 256 x 256!");return}this._availableColor++}decreaseColor(){if(this._availableColor===1){console.warn("Color can't be decreased under 0!");return}this._availableColor--}applySettings(e){e&&(e.updateInterval!==void 0&&(this.updateInterval=e.updateInterval),e.height!==void 0&&(this._height=e.height),e.width!==void 0&&(this._width=e.width),e.autoUpdate!==void 0&&(this.autoUpdate=e.autoUpdate))}}class W1 extends Qf{constructor(e,t,s){super(e,t,s),x(this,"onViewUpdated",new te),x(this,"threshold",100),x(this,"colorMeshes",new Map),x(this,"isProcessing",!1),x(this,"_colorCodeMeshMap",new Map),x(this,"_meshIDColorCodeMap",new Map),x(this,"_currentVisibleMeshes",new Set),x(this,"_recentlyHiddenMeshes",new Set),x(this,"_intervalID",null),x(this,"_transparentMat",new It({transparent:!0,opacity:0})),x(this,"handleWorkerMessage",async i=>{if(this.isProcessing)return;const n=i.data.colors;this._recentlyHiddenMeshes=new Set(this._currentVisibleMeshes),this._currentVisibleMeshes.clear();for(const[r,o]of n){if(o<this.threshold)continue;const a=this._colorCodeMeshMap.get(r);a&&(this._currentVisibleMeshes.add(a),this._recentlyHiddenMeshes.delete(a))}this.onViewUpdated.trigger({seen:this._currentVisibleMeshes,unseen:this._recentlyHiddenMeshes}),this._isWorkerBusy=!1}),this.worker.addEventListener("message",this.handleWorkerMessage),this.autoUpdate&&window.setInterval(async()=>{this.isProcessing||await this.updateVisibility()},this.updateInterval),this.onViewUpdated.add(({seen:i,unseen:n})=>{for(const r of i)r.visible=!0;for(const r of n)r.visible=!1})}dispose(){super.dispose(),this._intervalID!==null&&(window.clearInterval(this._intervalID),this._intervalID=null),this._currentVisibleMeshes.clear(),this._recentlyHiddenMeshes.clear(),this._meshIDColorCodeMap.clear(),this._transparentMat.dispose(),this._colorCodeMeshMap.clear();const e=this.components.get(Ks);for(const t in this.colorMeshes){const s=this.colorMeshes.get(t);s&&e.destroy(s,!0)}this.colorMeshes.clear()}add(e){if(!this.enabled)return;if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const t=e instanceof Ot,{geometry:s,material:i}=e,{colorMaterial:n,code:r}=this.getAvailableMaterial();let o;if(Array.isArray(i)){let c=!0;const p=[];for(const u of i)ip.isTransparent(u)?p.push(this._transparentMat):(c=!1,p.push(n));if(c){n.dispose(),this.isProcessing=!1;return}o=p}else if(ip.isTransparent(i)){n.dispose(),this.isProcessing=!1;return}else o=n;this._colorCodeMeshMap.set(r,e),this._meshIDColorCodeMap.set(e.uuid,r);const a=t?e.count:1,l=new Ot(s,o,a);t?l.instanceMatrix=e.instanceMatrix:l.setMatrixAt(0,new de),e.visible=!1,e.updateWorldMatrix(!0,!1),l.applyMatrix4(e.matrixWorld),l.updateMatrix(),this.scene.add(l),this.colorMeshes.set(e.uuid,l),this.increaseColor(),this.isProcessing=!1}remove(e){if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const t=this.components.get(Ks);this._currentVisibleMeshes.delete(e),this._recentlyHiddenMeshes.delete(e);const s=this.colorMeshes.get(e.uuid),i=this._meshIDColorCodeMap.get(e.uuid);if(!s||!i){this.isProcessing=!1;return}this._colorCodeMeshMap.delete(i),this._meshIDColorCodeMap.delete(e.uuid),this.colorMeshes.delete(e.uuid),s.geometry=void 0,s.material=[],t.destroy(s,!0),this._recentlyHiddenMeshes.delete(e),this._currentVisibleMeshes.delete(e),this.isProcessing=!1}updateInstanced(e){for(const t of e){const s=this.colorMeshes.get(t.uuid);s&&(s.count=t.count)}}getAvailableMaterial(){const{r:e,g:t,b:s,code:i}=this.getAvailableColor(),n=as.enabled;as.enabled=!1;const r=new ft(`rgb(${e}, ${t}, ${s})`);if(!this.world.renderer)throw new Error("Renderer not found in the world!");const o=this.world.renderer.clippingPlanes,a=new It({color:r,clippingPlanes:o,side:Qs});return as.enabled=n,{colorMaterial:a,code:i}}}const qf=class bc extends De{constructor(e){super(e),x(this,"onDisposed",new te),x(this,"_enabled",!0),x(this,"list",new Map),e.add(bc.uuid,this)}get enabled(){return this._enabled}set enabled(e){this._enabled=e;for(const[t,s]of this.list)s.enabled=e}create(e,t){if(this.list.has(e.uuid))return this.list.get(e.uuid);const s=new W1(this.components,e,t);return this.list.set(e.uuid,s),s}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){this.enabled=!1,this.onDisposed.trigger(bc.uuid),this.onDisposed.reset();for(const[e,t]of this.list)t.dispose();this.list.clear()}updateInstanced(e){for(const[,t]of this.list)t.updateInstanced(e)}};x(qf,"uuid","69f2a50d-c266-44fc-b1bd-fa4d34be89e6");let X1=qf;class K1{constructor(e){x(this,"_event"),x(this,"_position",new Ue),x(this,"onDisposed",new te),x(this,"updateMouseInfo",t=>{this._event=t}),this.dom=e,this.setupEvents(!0)}get position(){if(this._event){const e=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(e,this._event),this._position.y=this.getPositionY(e,this._event)}return this._position}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}getPositionY(e,t){return-((t.clientY-e.top)/(e.bottom-e.top))*2+1}getPositionX(e,t){return(t.clientX-e.left)/(e.right-e.left)*2-1}setupEvents(e){e?this.dom.addEventListener("pointermove",this.updateMouseInfo):this.dom.removeEventListener("pointermove",this.updateMouseInfo)}}class Z1{constructor(e,t){x(this,"enabled",!0),x(this,"components"),x(this,"onDisposed",new te),x(this,"mouse"),x(this,"three",new on),x(this,"world");const s=t.renderer;if(!s)throw new Error("A renderer is needed for the raycaster to work!");this.world=t,this.mouse=new K1(s.three.domElement),this.components=e}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRay(e=Array.from(this.world.meshes)){if(!this.world)throw new Error("A world is needed to cast rays!");const t=this.world.camera.three;return this.three.setFromCamera(this.mouse.position,t),this.intersect(e)}castRayFromVector(e,t,s=Array.from(this.world.meshes)){return this.three.set(e,t),this.intersect(s)}intersect(e=Array.from(this.world.meshes)){const t=this.three.intersectObjects(e),s=this.filterClippingPlanes(t);return s.length>0?s[0]:null}filterClippingPlanes(e){if(!this.world.renderer)throw new Error("Renderer not found!");const t=this.world.renderer.three;if(!t.clippingPlanes)return e;const s=t.clippingPlanes;return e.length<=0||!s||(s==null?void 0:s.length)<=0?e:e.filter(i=>s.every(n=>n.distanceToPoint(i.point)>0))}}const Jf=class $f extends De{constructor(e){super(e),x(this,"enabled",!0),x(this,"list",new Map),x(this,"onDisposed",new te),e.add($f.uuid,this)}get(e){if(this.list.has(e.uuid))return this.list.get(e.uuid);const t=new Z1(this.components,e);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}};x(Jf,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let As=Jf;class j1{constructor(e,t,s){x(this,"onDisposed",new te),x(this,"world"),x(this,"components"),x(this,"three"),x(this,"_fade",3),x(this,"updateZoom",()=>{this.world.camera instanceof rl&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=t;const{color:i,size1:n,size2:r,distance:o}=s;this.components=e;const a=new hn(2,2,1,1),l=new Mt({side:Qs,uniforms:{uSize1:{value:n},uSize2:{value:r},uColor:{value:i},uDistance:{value:o},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new J(a,l),this.three.frustumCulled=!1,t.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(e){e?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(e){this._fade=e?3:0,this.material.uniforms.uFade.value=this._fade}dispose(){this.setupEvents(!1),this.components.get(Ks).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(e){if(this.world.isDisposing||!(this.world.camera instanceof rl))return;const t=this.world.camera.controls;e?t.addEventListener("update",this.updateZoom):t.removeEventListener("update",this.updateZoom)}}const Q1=class em extends De{constructor(e){super(e),x(this,"list",new Map),x(this,"config",{color:new ft(12303291),size1:1,size2:10,distance:500}),x(this,"onDisposed",new te),x(this,"enabled",!0),e.add(em.uuid,this)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a grid!");const t=new j1(this.components,e,this.config);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}};x(Q1,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");const qi=new on,Dt=new O,vi=new O,ot=new ct,up={X:new O(1,0,0),Y:new O(0,1,0),Z:new O(0,0,1)},Jh={type:"change"},pp={type:"mouseDown"},fp={type:"mouseUp",mode:null},mp={type:"objectChange"};class q1 extends Xs{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const s=new iC;this._gizmo=s,this.add(s);const i=new nC;this._plane=i,this.add(i);const n=this;function r(v,A){let C=A;Object.defineProperty(n,v,{get:function(){return C!==void 0?C:A},set:function(F){C!==F&&(C=F,i[v]=F,s[v]=F,n.dispatchEvent({type:v+"-changed",value:F}),n.dispatchEvent(Jh))}}),n[v]=A,i[v]=A,s[v]=A}r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0);const o=new O,a=new O,l=new ct,c=new ct,p=new O,u=new ct,m=new O,E=new O,g=new O,T=0,y=new O;r("worldPosition",o),r("worldPositionStart",a),r("worldQuaternion",l),r("worldQuaternionStart",c),r("cameraPosition",p),r("cameraQuaternion",u),r("pointStart",m),r("pointEnd",E),r("rotationAxis",g),r("rotationAngle",T),r("eye",y),this._offset=new O,this._startNorm=new O,this._endNorm=new O,this._cameraScale=new O,this._parentPosition=new O,this._parentQuaternion=new ct,this._parentQuaternionInv=new ct,this._parentScale=new O,this._worldScaleStart=new O,this._worldQuaternionInv=new ct,this._worldScale=new O,this._positionStart=new O,this._quaternionStart=new ct,this._scaleStart=new O,this._getPointer=J1.bind(this),this._onPointerDown=eC.bind(this),this._onPointerHover=$1.bind(this),this._onPointerMove=tC.bind(this),this._onPointerUp=sC.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;qi.setFromCamera(e,this.camera);const t=$h(this._gizmo.picker[this.mode],qi);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){qi.setFromCamera(e,this.camera);const t=$h(this._plane,qi,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,pp.mode=this.mode,this.dispatchEvent(pp)}}pointerMove(e){const t=this.axis,s=this.mode,i=this.object;let n=this.space;if(s==="scale"?n="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(n="world"),i===void 0||t===null||this.dragging===!1||e.button!==-1)return;qi.setFromCamera(e,this.camera);const r=$h(this._plane,qi,!0);if(r){if(this.pointEnd.copy(r.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),n==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),n==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(n==="local"&&(i.position.applyQuaternion(ot.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),n==="world"&&(i.parent&&i.position.add(Dt.setFromMatrixPosition(i.parent.matrixWorld)),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(Dt.setFromMatrixPosition(i.parent.matrixWorld))));else if(s==="scale"){if(t.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),vi.set(o,o,o)}else Dt.copy(this.pointStart),vi.copy(this.pointEnd),Dt.applyQuaternion(this._worldQuaternionInv),vi.applyQuaternion(this._worldQuaternionInv),vi.divide(Dt),t.search("X")===-1&&(vi.x=1),t.search("Y")===-1&&(vi.y=1),t.search("Z")===-1&&(vi.z=1);i.scale.copy(this._scaleStart).multiply(vi),this.scaleSnap&&(t.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(Dt.setFromMatrixPosition(this.camera.matrixWorld));let a=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Dt.copy(this.rotationAxis).cross(this.eye))*o):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(up[t]),Dt.copy(up[t]),n==="local"&&Dt.applyQuaternion(this.worldQuaternion),Dt.cross(this.eye),Dt.length()===0?a=!0:this.rotationAngle=this._offset.dot(Dt.normalize())*o),(t==="E"||a)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),n==="local"&&t!=="E"&&t!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(ot.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(ot.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Jh),this.dispatchEvent(mp)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(fp.mode=this.mode,this.dispatchEvent(fp)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Jh),this.dispatchEvent(mp),this.pointStart.copy(this.pointEnd))}getRaycaster(){return qi}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function J1(h){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:h.button};{const e=this.domElement.getBoundingClientRect();return{x:(h.clientX-e.left)/e.width*2-1,y:-(h.clientY-e.top)/e.height*2+1,button:h.button}}}function $1(h){if(this.enabled)switch(h.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(h));break}}function eC(h){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(h.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(h)),this.pointerDown(this._getPointer(h)))}function tC(h){this.enabled&&this.pointerMove(this._getPointer(h))}function sC(h){this.enabled&&(this.domElement.releasePointerCapture(h.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(h)))}function $h(h,e,t){const s=e.intersectObject(h,!0);for(let i=0;i<s.length;i++)if(s[i].object.visible||t)return s[i];return!1}const La=new Xc,Je=new O(0,1,0),Ep=new O(0,0,0),gp=new de,Na=new ct,Ja=new ct,Bs=new O,Ip=new de,io=new O(1,0,0),en=new O(0,1,0),no=new O(0,0,1),Da=new O,Jr=new O,$r=new O;class iC extends Xs{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new It({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new qs({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const i=t.clone();i.opacity=.5;const n=e.clone();n.color.setHex(16711680);const r=e.clone();r.color.setHex(65280);const o=e.clone();o.color.setHex(255);const a=e.clone();a.color.setHex(16711680),a.opacity=.5;const l=e.clone();l.color.setHex(65280),l.opacity=.5;const c=e.clone();c.color.setHex(255),c.opacity=.5;const p=e.clone();p.opacity=.25;const u=e.clone();u.color.setHex(16776960),u.opacity=.25,e.clone().color.setHex(16776960);const m=e.clone();m.color.setHex(7895160);const E=new Ke(0,.04,.1,12);E.translate(0,.05,0);const g=new Be(.08,.08,.08);g.translate(0,.04,0);const T=new ze;T.setAttribute("position",new Li([0,0,0,1,0,0],3));const y=new Ke(.0075,.0075,.5,3);y.translate(0,.25,0);function v(ne,ue){const oe=new Gs(ne,.0075,3,64,ue*Math.PI*2);return oe.rotateY(Math.PI/2),oe.rotateX(Math.PI/2),oe}function A(){const ne=new ze;return ne.setAttribute("position",new Li([0,0,0,1,1,1],3)),ne}const C={X:[[new J(E,n),[.5,0,0],[0,0,-Math.PI/2]],[new J(E,n),[-.5,0,0],[0,0,Math.PI/2]],[new J(y,n),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new J(E,r),[0,.5,0]],[new J(E,r),[0,-.5,0],[Math.PI,0,0]],[new J(y,r)]],Z:[[new J(E,o),[0,0,.5],[Math.PI/2,0,0]],[new J(E,o),[0,0,-.5],[-Math.PI/2,0,0]],[new J(y,o),null,[Math.PI/2,0,0]]],XYZ:[[new J(new Pi(.1,0),p.clone()),[0,0,0]]],XY:[[new J(new Be(.15,.15,.01),c.clone()),[.15,.15,0]]],YZ:[[new J(new Be(.15,.15,.01),a.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new J(new Be(.15,.15,.01),l.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},F={X:[[new J(new Ke(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new J(new Ke(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new J(new Ke(.2,0,.6,4),s),[0,.3,0]],[new J(new Ke(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new J(new Ke(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new J(new Ke(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new J(new Pi(.2,0),s)]],XY:[[new J(new Be(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new J(new Be(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new J(new Be(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},M={START:[[new J(new Pi(.01,2),i),null,null,null,"helper"]],END:[[new J(new Pi(.01,2),i),null,null,null,"helper"]],DELTA:[[new je(A(),i),null,null,null,"helper"]],X:[[new je(T,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new je(T,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new je(T,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},_={XYZE:[[new J(v(.5,1),m),null,[0,Math.PI/2,0]]],X:[[new J(v(.5,.5),n)]],Y:[[new J(v(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new J(v(.5,.5),o),null,[0,Math.PI/2,0]]],E:[[new J(v(.75,1),u),null,[0,Math.PI/2,0]]]},L={AXIS:[[new je(T,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},D={XYZE:[[new J(new Hp(.25,10,8),s)]],X:[[new J(new Gs(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new J(new Gs(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new J(new Gs(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new J(new Gs(.75,.1,2,24),s)]]},B={X:[[new J(g,n),[.5,0,0],[0,0,-Math.PI/2]],[new J(y,n),[0,0,0],[0,0,-Math.PI/2]],[new J(g,n),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new J(g,r),[0,.5,0]],[new J(y,r)],[new J(g,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new J(g,o),[0,0,.5],[Math.PI/2,0,0]],[new J(y,o),[0,0,0],[Math.PI/2,0,0]],[new J(g,o),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new J(new Be(.15,.15,.01),c),[.15,.15,0]]],YZ:[[new J(new Be(.15,.15,.01),a),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new J(new Be(.15,.15,.01),l),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new J(new Be(.1,.1,.1),p.clone())]]},z={X:[[new J(new Ke(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new J(new Ke(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new J(new Ke(.2,0,.6,4),s),[0,.3,0]],[new J(new Ke(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new J(new Ke(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new J(new Ke(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new J(new Be(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new J(new Be(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new J(new Be(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new J(new Be(.2,.2,.2),s),[0,0,0]]]},V={X:[[new je(T,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new je(T,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new je(T,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function Q(ne){const ue=new Xs;for(const oe in ne)for(let Ie=ne[oe].length;Ie--;){const ce=ne[oe][Ie][0].clone(),ye=ne[oe][Ie][1],Ze=ne[oe][Ie][2],gt=ne[oe][Ie][3],Is=ne[oe][Ie][4];ce.name=oe,ce.tag=Is,ye&&ce.position.set(ye[0],ye[1],ye[2]),Ze&&ce.rotation.set(Ze[0],Ze[1],Ze[2]),gt&&ce.scale.set(gt[0],gt[1],gt[2]),ce.updateMatrix();const yt=ce.geometry.clone();yt.applyMatrix4(ce.matrix),ce.geometry=yt,ce.renderOrder=1/0,ce.position.set(0,0,0),ce.rotation.set(0,0,0),ce.scale.set(1,1,1),ue.add(ce)}return ue}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=Q(C)),this.add(this.gizmo.rotate=Q(_)),this.add(this.gizmo.scale=Q(B)),this.add(this.picker.translate=Q(F)),this.add(this.picker.rotate=Q(D)),this.add(this.picker.scale=Q(z)),this.add(this.helper.translate=Q(M)),this.add(this.helper.rotate=Q(L)),this.add(this.helper.scale=Q(V)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Ja;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let i=0;i<s.length;i++){const n=s[i];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);let r;if(this.camera.isOrthographicCamera?r=(this.camera.top-this.camera.bottom)/this.camera.zoom:r=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(r*this.size/4),n.tag==="helper"){n.visible=!1,n.name==="AXIS"?(n.visible=!!this.axis,this.axis==="X"&&(ot.setFromEuler(La.set(0,0,0)),n.quaternion.copy(t).multiply(ot),Math.abs(Je.copy(io).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Y"&&(ot.setFromEuler(La.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(ot),Math.abs(Je.copy(en).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Z"&&(ot.setFromEuler(La.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(ot),Math.abs(Je.copy(no).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="XYZE"&&(ot.setFromEuler(La.set(0,Math.PI/2,0)),Je.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(gp.lookAt(Ep,Je,en)),n.quaternion.multiply(ot),n.visible=this.dragging),this.axis==="E"&&(n.visible=!1)):n.name==="START"?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):n.name==="END"?(n.position.copy(this.worldPosition),n.visible=this.dragging):n.name==="DELTA"?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),Dt.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Dt.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(Dt),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=this.axis.search(n.name)!==-1));continue}n.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(n.name==="X"&&Math.abs(Je.copy(io).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Y"&&Math.abs(Je.copy(en).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Z"&&Math.abs(Je.copy(no).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XY"&&Math.abs(Je.copy(no).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="YZ"&&Math.abs(Je.copy(io).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XZ"&&Math.abs(Je.copy(en).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)):this.mode==="rotate"&&(Na.copy(t),Je.copy(this.eye).applyQuaternion(ot.copy(t).invert()),n.name.search("E")!==-1&&n.quaternion.setFromRotationMatrix(gp.lookAt(this.eye,Ep,en)),n.name==="X"&&(ot.setFromAxisAngle(io,Math.atan2(-Je.y,Je.z)),ot.multiplyQuaternions(Na,ot),n.quaternion.copy(ot)),n.name==="Y"&&(ot.setFromAxisAngle(en,Math.atan2(Je.x,Je.z)),ot.multiplyQuaternions(Na,ot),n.quaternion.copy(ot)),n.name==="Z"&&(ot.setFromAxisAngle(no,Math.atan2(Je.y,Je.x)),ot.multiplyQuaternions(Na,ot),n.quaternion.copy(ot))),n.visible=n.visible&&(n.name.indexOf("X")===-1||this.showX),n.visible=n.visible&&(n.name.indexOf("Y")===-1||this.showY),n.visible=n.visible&&(n.name.indexOf("Z")===-1||this.showZ),n.visible=n.visible&&(n.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled&&this.axis&&(n.name===this.axis||this.axis.split("").some(function(o){return n.name===o}))&&(n.material.color.setHex(16776960),n.material.opacity=1)}super.updateMatrixWorld(e)}}class nC extends J{constructor(){super(new hn(1e5,1e5,2,2),new It({visible:!1,wireframe:!0,side:Qs,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),Da.copy(io).applyQuaternion(t==="local"?this.worldQuaternion:Ja),Jr.copy(en).applyQuaternion(t==="local"?this.worldQuaternion:Ja),$r.copy(no).applyQuaternion(t==="local"?this.worldQuaternion:Ja),Je.copy(Jr),this.mode){case"translate":case"scale":switch(this.axis){case"X":Je.copy(this.eye).cross(Da),Bs.copy(Da).cross(Je);break;case"Y":Je.copy(this.eye).cross(Jr),Bs.copy(Jr).cross(Je);break;case"Z":Je.copy(this.eye).cross($r),Bs.copy($r).cross(Je);break;case"XY":Bs.copy($r);break;case"YZ":Bs.copy(Da);break;case"XZ":Je.copy($r),Bs.copy(Jr);break;case"XYZ":case"E":Bs.set(0,0,0);break}break;case"rotate":default:Bs.set(0,0,0)}Bs.length()===0?this.quaternion.copy(this.cameraQuaternion):(Ip.lookAt(Dt.set(0,0,0),Bs,Je),this.quaternion.setFromRotationMatrix(Ip)),super.updateMatrixWorld(e)}}class Sl{constructor(e,t,s,i,n,r=5,o=!0){if(x(this,"onDraggingStarted",new te),x(this,"onDraggingEnded",new te),x(this,"onDisposed",new te),x(this,"normal"),x(this,"origin"),x(this,"three",new jt),x(this,"components"),x(this,"world"),x(this,"type","default"),x(this,"_helper"),x(this,"_visible",!0),x(this,"_enabled",!0),x(this,"_controlsActive",!1),x(this,"_arrowBoundBox",new J),x(this,"_planeMesh"),x(this,"_controls"),x(this,"_hiddenMaterial",new It({visible:!1})),x(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),x(this,"changeDrag",a=>{this._visible=!a.value,this.preventCameraMovement(),this.notifyDraggingChanged(a)}),this.components=e,this.world=t,!t.renderer)throw new Error("The given world must have a renderer!");this.normal=i,this.origin=s,t.renderer.setPlane(!0,this.three),this._planeMesh=Sl.newPlaneMesh(r,n),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(i,s),o&&this.toggleControls(!0)}get enabled(){return this._enabled}set enabled(e){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=e,this.world.renderer.setPlane(e,this.three)}get visible(){return this._visible}set visible(e){this._visible=e,this._controls.visible=e,this._helper.visible=e,this.toggleControls(e)}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(e){this._planeMesh.material=e}get size(){return this._planeMesh.scale.x}set size(e){this._planeMesh.scale.set(e,e,e)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(e,t){this.reset(),this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const e=new O(1,0,0),t=new O;this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix()}toggleControls(e){if(e){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=e}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const e=this.world.camera.three,t=this.world.renderer.three.domElement,s=new q1(e,t);return this.initializeControls(s),this.world.scene.three.add(s),s}initializeControls(e){e.attach(this._helper),e.showX=!1,e.showY=!1,e.setSpace("local"),this.createArrowBoundingBox(),e.children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new Ke(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(e){e.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const e=new Xs;return e.lookAt(this.normal),e.position.copy(this.origin),this._planeMesh.position.z+=.01,e.add(this._planeMesh),this.world.scene.three.add(e),e}static newPlaneMesh(e,t){const s=new hn(1),i=new J(s,t);return i.scale.set(e,e,e),i}}const tm=class xc extends De{constructor(e){super(e),x(this,"onBeforeDrag",new te),x(this,"onAfterDrag",new te),x(this,"onBeforeCreate",new te),x(this,"onBeforeCancel",new te),x(this,"onAfterCancel",new te),x(this,"onBeforeDelete",new te),x(this,"onAfterCreate",new te),x(this,"onAfterDelete",new te),x(this,"onDisposed",new te),x(this,"orthogonalY",!1),x(this,"toleranceOrthogonalY",.7),x(this,"Type",Sl),x(this,"list",[]),x(this,"_material",new It({color:12255487,side:Qs,transparent:!0,opacity:.2})),x(this,"_size",5),x(this,"_enabled",!1),x(this,"_visible",!0),x(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),x(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(xc.uuid,this)}get enabled(){return this._enabled}set enabled(e){this._enabled=e;for(const t of this.list)t.enabled=e;this.updateMaterialsAndPlanes()}get visible(){return this._visible}set visible(e){this._visible=e;for(const t of this.list)t.visible=e}get material(){return this._material}set material(e){this._material=e;for(const t of this.list)t.planeMaterial=e}get size(){return this._size}set size(e){this._size=e;for(const t of this.list)t.size=e}dispose(){this._enabled=!1;for(const e of this.list)e.dispose();this.list.length=0,this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(xc.uuid),this.onDisposed.reset()}create(e){const t=this.components.get(As).get(e).castRay();return t?this.createPlaneFromIntersection(e,t):null}createFromNormalAndCoplanarPoint(e,t,s){const i=this.newPlane(e,s,t);return this.updateMaterialsAndPlanes(),i}delete(e,t){t||(t=this.pickPlane(e)),t&&this.deletePlane(t)}deleteAll(e){const t=[...this.list];for(const s of t)if(!e||e.has(s.type)){this.delete(s.world,s);const i=this.list.indexOf(s);i!==-1&&this.list.splice(i,1)}}deletePlane(e){const t=this.list.indexOf(e);if(t!==-1){if(this.list.splice(t,1),!e.world.renderer)throw new Error("Renderer not found for this plane's world!");e.world.renderer.setPlane(!1,e.three),e.dispose(),this.updateMaterialsAndPlanes(),this.onAfterDelete.trigger(e)}}pickPlane(e){const t=this.components.get(As).get(e),s=this.getAllPlaneMeshes(),i=t.castRay(s);if(i){const n=i.object;return this.list.find(r=>r.meshes.includes(n))}}getAllPlaneMeshes(){const e=[];for(const t of this.list)e.push(...t.meshes);return e}createPlaneFromIntersection(e,t){var s;if(!e.renderer)throw new Error("The given world must have a renderer!");const i=t.point.distanceTo(new O(0,0,0)),n=(s=t.face)==null?void 0:s.normal;if(!i||!n)return null;const r=this.getWorldNormal(t,n),o=this.newPlane(e,t.point,r.negate());return o.visible=this._visible,o.size=this._size,e.renderer.setPlane(!0,o.three),this.updateMaterialsAndPlanes(),o}getWorldNormal(e,t){const s=e.object;let i=e.object.matrixWorld.clone();if(s instanceof Ot&&e.instanceId!==void 0){const o=new de;s.getMatrixAt(e.instanceId,o),i=o.multiply(i)}const n=new Kt().getNormalMatrix(i),r=t.clone().applyMatrix3(n).normalize();return this.normalizePlaneDirectionY(r),r}normalizePlaneDirectionY(e){this.orthogonalY&&(e.y>this.toleranceOrthogonalY&&(e.x=0,e.y=1,e.z=0),e.y<-this.toleranceOrthogonalY&&(e.x=0,e.y=-1,e.z=0))}newPlane(e,t,s){const i=new this.Type(this.components,e,t,s,this._material);return i.onDraggingStarted.add(this._onStartDragging),i.onDraggingEnded.add(this._onEndDragging),this.list.push(i),this.onAfterCreate.trigger(i),i}updateMaterialsAndPlanes(){const e=this.components.get(k1);for(const[t,s]of e.list){if(!s.renderer)continue;s.renderer.updateClippingPlanes();const{clippingPlanes:i}=s.renderer;for(const n of s.meshes)if(n.material)if(Array.isArray(n.material))for(const r of n.material)r.clippingPlanes=i;else n.material.clippingPlanes=i}}};x(tm,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let uo=tm;class rC{constructor(e){if(x(this,"onDisposed",new te),x(this,"onAfterUpdate",new te),x(this,"onBeforeUpdate",new te),x(this,"onResize",new te),x(this,"frontOffset",0),x(this,"overrideMaterial",new Qc),x(this,"backgroundColor",new ft(395274)),x(this,"renderer"),x(this,"enabled",!0),x(this,"world"),x(this,"_lockRotation",!0),x(this,"_camera"),x(this,"_plane"),x(this,"_size",new Ue(320,160)),x(this,"_tempVector1",new O),x(this,"_tempVector2",new O),x(this,"_tempTarget",new O),x(this,"down",new O(0,-1,0)),x(this,"updatePlanes",()=>{if(!this.world.renderer)throw new Error("The given world must have a renderer!");const i=[],n=this.world.renderer.three;for(const r of n.clippingPlanes)i.push(r);i.push(this._plane),this.renderer.clippingPlanes=i}),this.world=e,!this.world.renderer)throw new Error("The given world must have a renderer!");this.renderer=new _i,this.renderer.setSize(this._size.x,this._size.y);const t=1,s=this._size.x/this._size.y;this._camera=new di(t*s/-2,t*s/2,t/2,t/-2),this.world.renderer.onClippingPlanesUpdated.add(this.updatePlanes),this._camera.position.set(0,200,0),this._camera.zoom=.1,this._camera.rotation.x=-Math.PI/2,this._plane=new jt(this.down,200),this.updatePlanes()}get lockRotation(){return this._lockRotation}set lockRotation(e){this._lockRotation=e,e&&(this._camera.rotation.z=0)}get zoom(){return this._camera.zoom}set zoom(e){this._camera.zoom=e,this._camera.updateProjectionMatrix()}dispose(){this.enabled=!1,this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.onResize.reset(),this.overrideMaterial.dispose(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get(){return this._camera}update(){if(!this.enabled)return;this.onBeforeUpdate.trigger();const e=this.world.scene.three,t=this.world.camera;if(!t.hasCameraControls())throw new Error("The given world must use camera controls!");if(!(e instanceof js))throw new Error("The given world must have a THREE.Scene as a root!");const s=t.controls;if(s.getPosition(this._tempVector1),this._camera.position.x=this._tempVector1.x,this._camera.position.z=this._tempVector1.z,this.frontOffset!==0&&(s.getTarget(this._tempVector2),this._tempVector2.sub(this._tempVector1),this._tempVector2.normalize().multiplyScalar(this.frontOffset),this._camera.position.x+=this._tempVector2.x,this._camera.position.z+=this._tempVector2.z),!this._lockRotation){s.getTarget(this._tempTarget);const n=Math.atan2(this._tempTarget.x-this._tempVector1.x,this._tempTarget.z-this._tempVector1.z);this._camera.rotation.z=n+Math.PI}this._plane.set(this.down,this._tempVector1.y);const i=e.background;e.background=this.backgroundColor,this.renderer.render(e,this._camera),e.background=i,this.onAfterUpdate.trigger()}getSize(){return this._size}resize(e=this._size){this._size.copy(e),this.renderer.setSize(e.x,e.y);const t=e.x/e.y,s=1;this._camera.left=s*t/-2,this._camera.right=s*t/2,this._camera.top=s/2,this._camera.bottom=-s/2,this._camera.updateProjectionMatrix(),this.onResize.trigger(e)}}const oC=class sm extends De{constructor(e){super(e),x(this,"onAfterUpdate",new te),x(this,"onBeforeUpdate",new te),x(this,"onDisposed",new te),x(this,"enabled",!0),x(this,"list",new Map),this.components.add(sm.uuid,this)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a minimap!");const t=new rC(e);return this.list.set(e.uuid,t),t}delete(e){const t=this.list.get(e);t&&t.dispose(),this.list.delete(e)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(){for(const[e,t]of this.list)t.update()}};x(oC,"uuid","39ad6aad-84c8-4adf-a1e0-7f25313a9e7f");const aC=new Map([[ir,{forRelated:"Decomposes",forRelating:"IsDecomposedBy"}],[ll,{forRelated:"HasAssociations",forRelating:"AssociatedTo"}],[hl,{forRelated:"HasAssociations",forRelating:"ClassificationForObjects"}],[cl,{forRelated:"HasAssignments",forRelating:"IsGroupedBy"}],[nr,{forRelated:"IsDefinedBy",forRelating:"DefinesOcurrence"}],[dl,{forRelated:"IsTypedBy",forRelating:"Types"}],[ul,{forRelated:"IsDefinedBy",forRelating:"Defines"}],[rr,{forRelated:"ContainedInStructure",forRelating:"ContainsElements"}],[pl,{forRelated:"AssignedToFlowElement",forRelating:"HasControlElements"}],[fl,{forRelated:"ConnectedFrom",forRelating:"ConnectedTo"}],[ml,{forRelated:"HasAssignments",forRelating:"ReferencedBy"}],[El,{forRelated:"HasContext",forRelating:"Declares"}],[gl,{forRelated:"HasAssignments",forRelating:"Controls"}],[Il,{forRelated:"Nests",forRelating:"IsNestedBy"}]]),im=class Mc extends De{constructor(e){super(e),x(this,"onDisposed",new te),x(this,"onRelationsIndexed",new te),x(this,"relationMaps",{}),x(this,"enabled",!0),x(this,"_relToAttributesMap",aC),x(this,"_inverseAttributes",["IsDecomposedBy","Decomposes","AssociatedTo","HasAssociations","ClassificationForObjects","IsGroupedBy","HasAssignments","IsDefinedBy","DefinesOcurrence","IsTypedBy","Types","Defines","ContainedInStructure","ContainsElements","HasControlElements","AssignedToFlowElement","ConnectedTo","ConnectedFrom","ReferencedBy","Declares","HasContext","Controls","IsNestedBy","Nests"]),x(this,"_ifcRels",[ir,ll,hl,cl,nr,dl,ul,rr,pl,fl,ml,El,gl,Il]),x(this,"onFragmentsDisposed",t=>{delete this.relationMaps[t.groupID]}),this.components.add(Mc.uuid,this),e.get(Qe).onFragmentsDisposed.add(this.onFragmentsDisposed)}indexRelations(e,t,s,i){const n=Object.keys(t).find(p=>p.startsWith("Relating")),r=Object.keys(t).find(p=>p.startsWith("Related"));if(!(n&&r))return;const o=t[n].value,a=t[r].map(p=>p.value),l=e.get(o)??new Map,c=this.getAttributeIndex(i);c!==null&&(l.set(c,a),e.set(o,l));for(const p of a){const u=e.get(p)??new Map,m=this.getAttributeIndex(s);if(!m)continue;const E=u.get(m)??[];E.push(o),u.set(m,E),e.set(p,u)}}getAttributeIndex(e){const t=this._inverseAttributes.indexOf(e);return t===-1?null:t}setRelationMap(e,t){this.relationMaps[e.uuid]=t,this.onRelationsIndexed.trigger({modelID:e.uuid,relationsMap:t})}async process(e){if(!e.hasProperties)throw new Error("FragmentsGroup properties not found");let t=this.relationMaps[e.uuid];if(t)return t;t=new Map;for(const s of this._ifcRels){const i=await e.getAllPropertiesOfType(s);if(!i)continue;const n=this._relToAttributesMap.get(s);if(!n)continue;const{forRelated:r,forRelating:o}=n;for(const a in i){const l=i[a];this.indexRelations(t,l,r,o)}}return this.setRelationMap(e,t),t}async processFromWebIfc(e,t){const s=new Map;for(const i of this._ifcRels){const n=this._relToAttributesMap.get(i);if(!n)continue;const{forRelated:r,forRelating:o}=n,a=e.GetLineIDsWithType(t,i);for(let l=0;l<a.size();l++){const c=await e.properties.getItemProperties(t,a.get(l));this.indexRelations(s,c,r,o)}}return this.onRelationsIndexed.trigger({modelID:t.toString(),relationsMap:s}),s}getEntityRelations(e,t,s){const i=this.relationMaps[e.uuid];if(!i)throw new Error(`IfcRelationsIndexer: model ${e.uuid} has no relations indexed.`);const n=i.get(t),r=this.getAttributeIndex(s);return n===void 0||r===null?null:n.get(r)||null}serializeRelations(e){const t={};for(const[s,i]of e.entries()){t[s]||(t[s]={});for(const[n,r]of i.entries())t[s][n]=r}return JSON.stringify(t)}serializeModelRelations(e){const t=this.relationMaps[e.uuid];return t?this.serializeRelations(t):null}serializeAllRelations(){const e={};for(const t in this.relationMaps){const s=this.relationMaps[t],i={};for(const[n,r]of s.entries()){i[n]||(i[n]={});for(const[o,a]of r.entries())i[n][o]=a}e[t]=i}return JSON.stringify(e)}getRelationsMapFromJSON(e){const t=JSON.parse(e),s=new Map;for(const i in t){const n=t[i],r=new Map;for(const o in n)r.set(Number(o),n[o]);s.set(Number(i),r)}return s}dispose(){this.relationMaps={},this.components.get(Qe).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(Mc.uuid),this.onDisposed.reset()}getEntitiesWithRelation(e,t,s){const i=this.relationMaps[e.uuid];if(!i)throw new Error("IfcRelationsIndexer: the model relations are not indexed!");const n=new Set;for(const[r,o]of i){const a=this.getAttributeIndex(t);if(a===null)throw new Error("IfcRelationsIndexer: invalid inverse attribute name");const l=o.get(a);l&&l.includes(s)&&n.add(r)}return n}addEntityRelations(e,t,s,...i){const n=this.getEntityRelations(e,t,s);if(n)n.push(...i);else{const r=this.getAttributeIndex(s);if(!r)throw new Error(`IfcRelationsIndexer: ${s} is not a valid relation name.`);const o=this.relationMaps[e.uuid].get(t);o==null||o.set(r,i)}}getEntityChildren(e,t,s=new Set){if(s.add(t),this.relationMaps[e.uuid]===void 0)throw new Error("The provided model has no indices. You have to generate them first.");const i=this.getEntityRelations(e,t,"IsDecomposedBy");if(i)for(const r of i)this.getEntityChildren(e,r,s);const n=this.getEntityRelations(e,t,"ContainsElements");if(n)for(const r of n)this.getEntityChildren(e,r,s);return s}};x(im,"uuid","23a889ab-83b3-44a4-8bee-ead83438370b");let Eo=im;const nm=class rm extends De{constructor(e){super(e),x(this,"onDisposed",new te),x(this,"onFragmentsLoaded",new te),x(this,"onFragmentsDisposed",new te),x(this,"list",new $u),x(this,"groups",new $u),x(this,"baseCoordinationModel",""),x(this,"baseCoordinationMatrix",new de),x(this,"enabled",!0),x(this,"_loader",new Cl),this.components.add(rm.uuid,this)}get meshes(){const e=[];for(const[t,s]of this.list)e.push(s.mesh);return e}dispose(){for(const[e,t]of this.groups)t.dispose(!0);this.baseCoordinationModel="",this.groups.clear(),this.list.clear(),this.onFragmentsLoaded.reset(),this.onFragmentsDisposed.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}disposeGroup(e){const{uuid:t}=e,s=[];for(const i of e.items)s.push(i.id),this.list.delete(i.id);e.dispose(!0),this.groups.delete(e.uuid),this.onFragmentsDisposed.trigger({groupID:t,fragmentIDs:s})}load(e,t){const s={coordinate:!0,...t},{coordinate:i,name:n,properties:r,relationsMap:o}=s,a=this._loader.import(e);t&&(a.isStreamed=t.isStreamed||!1),n&&(a.name=n);for(const l of a.items)l.group=a,this.list.set(l.id,l);return i&&this.coordinate([a]),this.groups.set(a.uuid,a),r&&a.setLocalProperties(r),o&&this.components.get(Eo).setRelationMap(a,o),this.onFragmentsLoaded.trigger(a),a}export(e){return this._loader.export(e)}getModelIdMap(e){const t={};for(const s in e){const i=this.list.get(s);if(!(i&&i.group))continue;const n=i.group;n.uuid in t||(t[n.uuid]=new Set);const r=e[s];for(const o of r)t[n.uuid].add(o)}return t}modelIdToFragmentIdMap(e){let t={};for(const s in e){const i=this.groups.get(s);if(!i)continue;const n=e[s],r=i.getFragmentMap(n);t={...t,...r}}return t}coordinate(e=Array.from(this.groups.values())){if(this.baseCoordinationModel.length===0){const t=e.pop();if(!t)return;this.baseCoordinationModel=t.uuid,this.baseCoordinationMatrix=t.coordinationMatrix.clone()}if(e.length)for(const t of e)t.coordinationMatrix.equals(this.baseCoordinationMatrix)||(t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1),t.updateMatrix(),this.applyBaseCoordinateSystem(t,t.coordinationMatrix))}applyBaseCoordinateSystem(e,t){e.applyMatrix4(t.clone().invert()),e.applyMatrix4(this.baseCoordinationMatrix)}clone(e,t){const s=e.cloneGroup(t);this.groups.set(s.uuid,s);for(const i of s.items)this.list.set(i.id,i);return s}};x(nm,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let Qe=nm;const om=class oi extends De{constructor(e){super(e),x(this,"enabled",!0),x(this,"onDisposed",new te),x(this,"_absoluteMin"),x(this,"_absoluteMax"),x(this,"_meshes",[]),this.components.add(oi.uuid,this),this._absoluteMin=oi.newBound(!0),this._absoluteMax=oi.newBound(!1)}static getDimensions(e){const{min:t,max:s}=e,i=Math.abs(s.x-t.x),n=Math.abs(s.y-t.y),r=Math.abs(s.z-t.z),o=new O;return o.subVectors(s,t).divideScalar(2).add(t),{width:i,height:n,depth:r,center:o}}static newBound(e){const t=e?1:-1;return new O(t*Number.MAX_VALUE,t*Number.MAX_VALUE,t*Number.MAX_VALUE)}static getBounds(e,t,s){const i=s||this.newBound(!1),n=t||this.newBound(!0);for(const r of e)r.x<n.x&&(n.x=r.x),r.y<n.y&&(n.y=r.y),r.z<n.z&&(n.z=r.z),r.x>i.x&&(i.x=r.x),r.y>i.y&&(i.y=r.y),r.z>i.z&&(i.z=r.z);return new Me(t,s)}dispose(){const e=this.components.get(Ks);for(const t of this._meshes)e.destroy(t);this._meshes=[],this.onDisposed.trigger(oi.uuid),this.onDisposed.reset()}get(){const e=this._absoluteMin.clone(),t=this._absoluteMax.clone();return new Me(e,t)}getSphere(){const e=this._absoluteMin.clone(),t=this._absoluteMax.clone(),s=Math.abs((t.x-e.x)/2),i=Math.abs((t.y-e.y)/2),n=Math.abs((t.z-e.z)/2),r=new O(e.x+s,e.y+i,e.z+n),o=r.distanceTo(e);return new Zs(r,o)}getMesh(){const e=new Me(this._absoluteMin,this._absoluteMax),t=oi.getDimensions(e),{width:s,height:i,depth:n,center:r}=t,o=new Be(s,i,n),a=new J(o);return this._meshes.push(a),a.position.copy(r),a}reset(){this._absoluteMin=oi.newBound(!0),this._absoluteMax=oi.newBound(!1)}add(e){for(const t of e.items)this.addMesh(t.mesh)}addMesh(e,t){if(!e.geometry.index)return;const s=oi.getFragmentBounds(e);e.updateMatrixWorld();const i=e.matrixWorld,n=new de,r=e instanceof Ot,o=new Set;if(e instanceof Zc){t||(t=e.fragment.ids);for(const a of t){const l=e.fragment.getInstancesIDs(a);if(l)for(const c of l)o.add(c)}}else o.add(0);for(const a of o){const l=s.min.clone(),c=s.max.clone();r&&(e.getMatrixAt(a,n),l.applyMatrix4(n),c.applyMatrix4(n)),l.applyMatrix4(i),c.applyMatrix4(i),l.x<this._absoluteMin.x&&(this._absoluteMin.x=l.x),l.y<this._absoluteMin.y&&(this._absoluteMin.y=l.y),l.z<this._absoluteMin.z&&(this._absoluteMin.z=l.z),l.x>this._absoluteMax.x&&(this._absoluteMax.x=l.x),l.y>this._absoluteMax.y&&(this._absoluteMax.y=l.y),l.z>this._absoluteMax.z&&(this._absoluteMax.z=l.z),c.x>this._absoluteMax.x&&(this._absoluteMax.x=c.x),c.y>this._absoluteMax.y&&(this._absoluteMax.y=c.y),c.z>this._absoluteMax.z&&(this._absoluteMax.z=c.z),c.x<this._absoluteMin.x&&(this._absoluteMin.x=c.x),c.y<this._absoluteMin.y&&(this._absoluteMin.y=c.y),c.z<this._absoluteMin.z&&(this._absoluteMin.z=c.z)}}addFragmentIdMap(e){const t=this.components.get(Qe);for(const s in e){const i=t.list.get(s);if(!i)continue;const n=e[s];this.addMesh(i.mesh,n)}}static getFragmentBounds(e){const t=e.geometry.attributes.position,s=Number.MAX_VALUE,i=-s,n=new O(s,s,s),r=new O(i,i,i);if(!e.geometry.index)throw new Error("Geometry must be indexed!");const o=Array.from(e.geometry.index.array);for(let a=0;a<o.length;a++){if(a%3===0&&o[a]===0&&o[a+1]===0&&o[a+2]===0){a+=2;continue}const l=o[a],c=t.getX(l),p=t.getY(l),u=t.getZ(l);c<n.x&&(n.x=c),p<n.y&&(n.y=p),u<n.z&&(n.z=u),c>r.x&&(r.x=c),p>r.y&&(r.y=p),u>r.z&&(r.z=u)}return new Me(n,r)}};x(om,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");let _c=om;const am=new Set([1123145078,574549367,1675464909,2059837836,3798115385,32440307,3125803723,3207858831,2740243338,2624227202,4240577450,3615266464,3724593414,220341763,477187591,1878645084,1300840506,3303107099,1607154358,1878645084,846575682,1351298697,2417041796,3049322572,3331915920,1416205885,776857604,3285139300,3958052878,2827736869,2732653382,673634403,3448662350,4142052618,2924175390,803316827,2556980723,1809719519,2205249479,807026263,3737207727,1660063152,2347385850,2705031697,3732776249,2485617015,2611217952,1704287377,2937912522,2770003689,1281925730,1484403080,3448662350,4142052618,3800577675,4006246654,3590301190,1383045692,2775532180,2047409740,370225590,3593883385,2665983363,4124623270,812098782,3649129432,987898635,1105321065,3510044353,1635779807,2603310189,3406155212,1310608509,4261334040,2736907675,3649129432,1136057603,1260505505,4182860854,2713105998,2898889636,59481748,3749851601,3486308946,3150382593,1062206242,3264961684,15328376,1485152156,370225590,1981873012,2859738748,45288368,2614616156,2732653382,775493141,2147822146,2601014836,2629017746,1186437898,2367409068,1213902940,3632507154,3900360178,476780140,1472233963,2804161546,3008276851,738692330,374418227,315944413,3905492369,3570813810,2571569899,178912537,2294589976,1437953363,2133299955,572779678,3092502836,388784114,2624227202,1425443689,3057273783,2347385850,1682466193,2519244187,2839578677,3958567839,2513912981,2830218821,427810014]),lm=class hm extends De{constructor(e){super(e),x(this,"enabled",!0),e.add(hm.uuid,this)}async export(e,t,s=!1,i=!0){const n={},r=new Set(e.GetIfcEntityList(t)),o=new Set([or,ar,lr,cn,Qt]);for(const a of o)r.add(a);for(const a of r){if(am.has(a))continue;const l=o.has(a)&&i,c=e.GetLineIDsWithType(t,a);for(const p of c){const u=e.GetLine(0,p,l,s);n[u.expressID]=u}}return n}};x(lm,"uuid","b32c4332-cd67-436e-ba7f-196646c7a635");let lC=lm;const cm={950732822:"IFCURIREFERENCE",4075327185:"IFCTIME",1209108979:"IFCTEMPERATURERATEOFCHANGEMEASURE",3457685358:"IFCSOUNDPRESSURELEVELMEASURE",4157543285:"IFCSOUNDPOWERLEVELMEASURE",2798247006:"IFCPROPERTYSETDEFINITIONSET",1790229001:"IFCPOSITIVEINTEGER",525895558:"IFCNONNEGATIVELENGTHMEASURE",1774176899:"IFCLINEINDEX",1275358634:"IFCLANGUAGEID",2541165894:"IFCDURATION",3701338814:"IFCDAYINWEEKNUMBER",2195413836:"IFCDATETIME",937566702:"IFCDATE",1683019596:"IFCCARDINALPOINTREFERENCE",2314439260:"IFCBINARY",1500781891:"IFCAREADENSITYMEASURE",3683503648:"IFCARCINDEX",4065007721:"IFCYEARNUMBER",1718600412:"IFCWARPINGMOMENTMEASURE",51269191:"IFCWARPINGCONSTANTMEASURE",2593997549:"IFCVOLUMETRICFLOWRATEMEASURE",3458127941:"IFCVOLUMEMEASURE",3345633955:"IFCVAPORPERMEABILITYMEASURE",1278329552:"IFCTORQUEMEASURE",2591213694:"IFCTIMESTAMP",2726807636:"IFCTIMEMEASURE",743184107:"IFCTHERMODYNAMICTEMPERATUREMEASURE",2016195849:"IFCTHERMALTRANSMITTANCEMEASURE",857959152:"IFCTHERMALRESISTANCEMEASURE",2281867870:"IFCTHERMALEXPANSIONCOEFFICIENTMEASURE",2645777649:"IFCTHERMALCONDUCTIVITYMEASURE",232962298:"IFCTHERMALADMITTANCEMEASURE",296282323:"IFCTEXTTRANSFORMATION",603696268:"IFCTEXTFONTNAME",3490877962:"IFCTEXTDECORATION",1460886941:"IFCTEXTALIGNMENT",2801250643:"IFCTEXT",58845555:"IFCTEMPERATUREGRADIENTMEASURE",361837227:"IFCSPECULARROUGHNESS",2757832317:"IFCSPECULAREXPONENT",3477203348:"IFCSPECIFICHEATCAPACITYMEASURE",993287707:"IFCSOUNDPRESSUREMEASURE",846465480:"IFCSOUNDPOWERMEASURE",3471399674:"IFCSOLIDANGLEMEASURE",408310005:"IFCSHEARMODULUSMEASURE",2190458107:"IFCSECTIONALAREAINTEGRALMEASURE",3467162246:"IFCSECTIONMODULUSMEASURE",2766185779:"IFCSECONDINMINUTE",3211557302:"IFCROTATIONALSTIFFNESSMEASURE",1755127002:"IFCROTATIONALMASSMEASURE",2133746277:"IFCROTATIONALFREQUENCYMEASURE",200335297:"IFCREAL",96294661:"IFCRATIOMEASURE",3972513137:"IFCRADIOACTIVITYMEASURE",3665567075:"IFCPRESSUREMEASURE",2169031380:"IFCPRESENTABLETEXT",1364037233:"IFCPOWERMEASURE",1245737093:"IFCPOSITIVERATIOMEASURE",3054510233:"IFCPOSITIVEPLANEANGLEMEASURE",2815919920:"IFCPOSITIVELENGTHMEASURE",4042175685:"IFCPLANEANGLEMEASURE",2642773653:"IFCPLANARFORCEMEASURE",2260317790:"IFCPARAMETERVALUE",929793134:"IFCPHMEASURE",2395907400:"IFCNUMERICMEASURE",2095195183:"IFCNORMALISEDRATIOMEASURE",765770214:"IFCMONTHINYEARNUMBER",2615040989:"IFCMONETARYMEASURE",3114022597:"IFCMOMENTOFINERTIAMEASURE",1648970520:"IFCMOLECULARWEIGHTMEASURE",3177669450:"IFCMOISTUREDIFFUSIVITYMEASURE",1753493141:"IFCMODULUSOFSUBGRADEREACTIONMEASURE",1052454078:"IFCMODULUSOFROTATIONALSUBGRADEREACTIONMEASURE",2173214787:"IFCMODULUSOFLINEARSUBGRADEREACTIONMEASURE",3341486342:"IFCMODULUSOFELASTICITYMEASURE",102610177:"IFCMINUTEINHOUR",3531705166:"IFCMASSPERLENGTHMEASURE",3124614049:"IFCMASSMEASURE",4017473158:"IFCMASSFLOWRATEMEASURE",1477762836:"IFCMASSDENSITYMEASURE",2486716878:"IFCMAGNETICFLUXMEASURE",286949696:"IFCMAGNETICFLUXDENSITYMEASURE",151039812:"IFCLUMINOUSINTENSITYMEASURE",2755797622:"IFCLUMINOUSINTENSITYDISTRIBUTIONMEASURE",2095003142:"IFCLUMINOUSFLUXMEASURE",503418787:"IFCLOGICAL",3086160713:"IFCLINEARVELOCITYMEASURE",1307019551:"IFCLINEARSTIFFNESSMEASURE",2128979029:"IFCLINEARMOMENTMEASURE",191860431:"IFCLINEARFORCEMEASURE",1243674935:"IFCLENGTHMEASURE",3258342251:"IFCLABEL",2054016361:"IFCKINEMATICVISCOSITYMEASURE",3192672207:"IFCISOTHERMALMOISTURECAPACITYMEASURE",3686016028:"IFCIONCONCENTRATIONMEASURE",3809634241:"IFCINTEGERCOUNTRATEMEASURE",1939436016:"IFCINTEGER",2679005408:"IFCINDUCTANCEMEASURE",3358199106:"IFCILLUMINANCEMEASURE",983778844:"IFCIDENTIFIER",2589826445:"IFCHOURINDAY",1158859006:"IFCHEATINGVALUEMEASURE",3113092358:"IFCHEATFLUXDENSITYMEASURE",3064340077:"IFCGLOBALLYUNIQUEID",3044325142:"IFCFREQUENCYMEASURE",1361398929:"IFCFORCEMEASURE",2590844177:"IFCFONTWEIGHT",2715512545:"IFCFONTVARIANT",1102727119:"IFCFONTSTYLE",2078135608:"IFCENERGYMEASURE",2506197118:"IFCELECTRICVOLTAGEMEASURE",2951915441:"IFCELECTRICRESISTANCEMEASURE",3790457270:"IFCELECTRICCURRENTMEASURE",2093906313:"IFCELECTRICCONDUCTANCEMEASURE",3818826038:"IFCELECTRICCHARGEMEASURE",1827137117:"IFCELECTRICCAPACITANCEMEASURE",69416015:"IFCDYNAMICVISCOSITYMEASURE",524656162:"IFCDOSEEQUIVALENTMEASURE",4134073009:"IFCDIMENSIONCOUNT",1514641115:"IFCDESCRIPTIVEMEASURE",300323983:"IFCDAYLIGHTSAVINGHOUR",86635668:"IFCDAYINMONTHNUMBER",94842927:"IFCCURVATUREMEASURE",1778710042:"IFCCOUNTMEASURE",3238673880:"IFCCONTEXTDEPENDENTMEASURE",3812528620:"IFCCOMPOUNDPLANEANGLEMEASURE",2991860651:"IFCCOMPLEXNUMBER",1867003952:"IFCBOXALIGNMENT",2735952531:"IFCBOOLEAN",2650437152:"IFCAREAMEASURE",632304761:"IFCANGULARVELOCITYMEASURE",360377573:"IFCAMOUNTOFSUBSTANCEMEASURE",4182062534:"IFCACCELERATIONMEASURE",3699917729:"IFCABSORBEDDOSEMEASURE",1971632696:"IFCGEOSLICE",2680139844:"IFCGEOMODEL",24726584:"IFCELECTRICFLOWTREATMENTDEVICE",3693000487:"IFCDISTRIBUTIONBOARD",3460952963:"IFCCONVEYORSEGMENT",3999819293:"IFCCAISSONFOUNDATION",3314249567:"IFCBOREHOLE",4196446775:"IFCBEARING",325726236:"IFCALIGNMENT",3425753595:"IFCTRACKELEMENT",991950508:"IFCSIGNAL",3798194928:"IFCREINFORCEDSOIL",3290496277:"IFCRAIL",1383356374:"IFCPAVEMENT",2182337498:"IFCNAVIGATIONELEMENT",234836483:"IFCMOORINGDEVICE",2078563270:"IFCMOBILETELECOMMUNICATIONSAPPLIANCE",1638804497:"IFCLIQUIDTERMINAL",1154579445:"IFCLINEARPOSITIONINGELEMENT",2696325953:"IFCKERB",2713699986:"IFCGEOTECHNICALASSEMBLY",2142170206:"IFCELECTRICFLOWTREATMENTDEVICETYPE",3376911765:"IFCEARTHWORKSFILL",1077100507:"IFCEARTHWORKSELEMENT",3071239417:"IFCEARTHWORKSCUT",479945903:"IFCDISTRIBUTIONBOARDTYPE",3426335179:"IFCDEEPFOUNDATION",1502416096:"IFCCOURSE",2940368186:"IFCCONVEYORSEGMENTTYPE",3203706013:"IFCCAISSONFOUNDATIONTYPE",3862327254:"IFCBUILTSYSTEM",1876633798:"IFCBUILTELEMENT",963979645:"IFCBRIDGEPART",644574406:"IFCBRIDGE",3649138523:"IFCBEARINGTYPE",1662888072:"IFCALIGNMENTVERTICAL",317615605:"IFCALIGNMENTSEGMENT",1545765605:"IFCALIGNMENTHORIZONTAL",4266260250:"IFCALIGNMENTCANT",3956297820:"IFCVIBRATIONDAMPERTYPE",1530820697:"IFCVIBRATIONDAMPER",840318589:"IFCVEHICLE",1953115116:"IFCTRANSPORTATIONDEVICE",618700268:"IFCTRACKELEMENTTYPE",2281632017:"IFCTENDONCONDUITTYPE",3663046924:"IFCTENDONCONDUIT",42703149:"IFCSINESPIRAL",1894708472:"IFCSIGNALTYPE",3599934289:"IFCSIGNTYPE",33720170:"IFCSIGN",1027922057:"IFCSEVENTHORDERPOLYNOMIALSPIRAL",544395925:"IFCSEGMENTEDREFERENCECURVE",3649235739:"IFCSECONDORDERPOLYNOMIALSPIRAL",550521510:"IFCROADPART",146592293:"IFCROAD",3818125796:"IFCRELADHERESTOELEMENT",4021432810:"IFCREFERENT",1891881377:"IFCRAILWAYPART",3992365140:"IFCRAILWAY",1763565496:"IFCRAILTYPE",1946335990:"IFCPOSITIONINGELEMENT",514975943:"IFCPAVEMENTTYPE",506776471:"IFCNAVIGATIONELEMENTTYPE",710110818:"IFCMOORINGDEVICETYPE",1950438474:"IFCMOBILETELECOMMUNICATIONSAPPLIANCETYPE",976884017:"IFCMARINEPART",525669439:"IFCMARINEFACILITY",1770583370:"IFCLIQUIDTERMINALTYPE",2176059722:"IFCLINEARELEMENT",679976338:"IFCKERBTYPE",3948183225:"IFCIMPACTPROTECTIONDEVICETYPE",2568555532:"IFCIMPACTPROTECTIONDEVICE",2898700619:"IFCGRADIENTCURVE",1594536857:"IFCGEOTECHNICALSTRATUM",4230923436:"IFCGEOTECHNICALELEMENT",4228831410:"IFCFACILITYPARTCOMMON",1310830890:"IFCFACILITYPART",24185140:"IFCFACILITY",4234616927:"IFCDIRECTRIXDERIVEDREFERENCESWEPTAREASOLID",1306400036:"IFCDEEPFOUNDATIONTYPE",4189326743:"IFCCOURSETYPE",2000195564:"IFCCOSINESPIRAL",3497074424:"IFCCLOTHOID",1626504194:"IFCBUILTELEMENTTYPE",3651464721:"IFCVEHICLETYPE",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3665877780:"IFCTRANSPORTATIONDEVICETYPE",782932809:"IFCTHIRDORDERPOLYNOMIALSPIRAL",2735484536:"IFCSPIRAL",1356537516:"IFCSECTIONEDSURFACE",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1862484736:"IFCSECTIONEDSOLID",1441486842:"IFCRELPOSITIONS",1033248425:"IFCRELASSOCIATESPROFILEDEF",3381221214:"IFCPOLYNOMIALCURVE",2485787929:"IFCOFFSETCURVEBYDISTANCES",590820931:"IFCOFFSETCURVE",3465909080:"IFCINDEXEDPOLYGONALTEXTUREMAP",593015953:"IFCDIRECTRIXCURVESWEPTAREASOLID",4212018352:"IFCCURVESEGMENT",3425423356:"IFCAXIS2PLACEMENTLINEAR",823603102:"IFCSEGMENT",2165702409:"IFCPOINTBYDISTANCEEXPRESSION",182550632:"IFCOPENCROSSPROFILEDEF",388784114:"IFCLINEARPLACEMENT",536804194:"IFCALIGNMENTHORIZONTALSEGMENT",3752311538:"IFCALIGNMENTCANTSEGMENT",1010789467:"IFCTEXTURECOORDINATEINDICESWITHVOIDS",222769930:"IFCTEXTURECOORDINATEINDICES",2691318326:"IFCQUANTITYNUMBER",3633395639:"IFCALIGNMENTVERTICALSEGMENT",2879124712:"IFCALIGNMENTPARAMETERSEGMENT",25142252:"IFCCONTROLLER",3087945054:"IFCALARM",4288193352:"IFCACTUATOR",630975310:"IFCUNITARYCONTROLELEMENT",4086658281:"IFCSENSOR",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",182646315:"IFCFLOWINSTRUMENT",1426591983:"IFCFIRESUPPRESSIONTERMINAL",819412036:"IFCFILTER",3415622556:"IFCFAN",1003880860:"IFCELECTRICTIMECONTROL",402227799:"IFCELECTRICMOTOR",264262732:"IFCELECTRICGENERATOR",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",1904799276:"IFCELECTRICAPPLIANCE",1360408905:"IFCDUCTSILENCER",3518393246:"IFCDUCTSEGMENT",342316401:"IFCDUCTFITTING",562808652:"IFCDISTRIBUTIONCIRCUIT",4074379575:"IFCDAMPER",3640358203:"IFCCOOLINGTOWER",4136498852:"IFCCOOLEDBEAM",2272882330:"IFCCONDENSER",3571504051:"IFCCOMPRESSOR",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",639361253:"IFCCOIL",3902619387:"IFCCHILLER",4217484030:"IFCCABLESEGMENT",1051757585:"IFCCABLEFITTING",3758799889:"IFCCABLECARRIERSEGMENT",635142910:"IFCCABLECARRIERFITTING",2938176219:"IFCBURNER",32344328:"IFCBOILER",2906023776:"IFCBEAMSTANDARDCASE",277319702:"IFCAUDIOVISUALAPPLIANCE",2056796094:"IFCAIRTOAIRHEATRECOVERY",177149247:"IFCAIRTERMINALBOX",1634111441:"IFCAIRTERMINAL",486154966:"IFCWINDOWSTANDARDCASE",4237592921:"IFCWASTETERMINAL",4156078855:"IFCWALLELEMENTEDCASE",4207607924:"IFCVALVE",4292641817:"IFCUNITARYEQUIPMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",3026737570:"IFCTUBEBUNDLE",3825984169:"IFCTRANSFORMER",812556717:"IFCTANK",1162798199:"IFCSWITCHINGDEVICE",385403989:"IFCSTRUCTURALLOADCASE",1404847402:"IFCSTACKTERMINAL",1999602285:"IFCSPACEHEATER",3420628829:"IFCSOLARDEVICE",3027962421:"IFCSLABSTANDARDCASE",3127900445:"IFCSLABELEMENTEDCASE",1329646415:"IFCSHADINGDEVICE",3053780830:"IFCSANITARYTERMINAL",2572171363:"IFCREINFORCINGBARTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",90941305:"IFCPUMP",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",738039164:"IFCPROTECTIVEDEVICE",1156407060:"IFCPLATESTANDARDCASE",3612865200:"IFCPIPESEGMENT",310824031:"IFCPIPEFITTING",3694346114:"IFCOUTLET",144952367:"IFCOUTERBOUNDARYCURVE",2474470126:"IFCMOTORCONNECTION",1911478936:"IFCMEMBERSTANDARDCASE",1437502449:"IFCMEDICALDEVICE",629592764:"IFCLIGHTFIXTURE",76236018:"IFCLAMP",2176052936:"IFCJUNCTIONBOX",4175244083:"IFCINTERCEPTOR",2068733104:"IFCHUMIDIFIER",3319311131:"IFCHEATEXCHANGER",2188021234:"IFCFLOWMETER",1209101575:"IFCEXTERNALSPATIALELEMENT",484807127:"IFCEVAPORATOR",3747195512:"IFCEVAPORATIVECOOLER",2814081492:"IFCENGINE",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3242481149:"IFCDOORSTANDARDCASE",3205830791:"IFCDISTRIBUTIONSYSTEM",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",905975707:"IFCCOLUMNSTANDARDCASE",1677625105:"IFCCIVILELEMENT",3296154744:"IFCCHIMNEY",2674252688:"IFCCABLEFITTINGTYPE",2188180465:"IFCBURNERTYPE",1177604601:"IFCBUILDINGSYSTEM",39481116:"IFCBUILDINGELEMENTPARTTYPE",1136057603:"IFCBOUNDARYCURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4088093105:"IFCWORKCALENDAR",4009809668:"IFCWINDOWTYPE",926996030:"IFCVOIDINGFEATURE",2391383451:"IFCVIBRATIONISOLATOR",2415094496:"IFCTENDONTYPE",3081323446:"IFCTENDONANCHORTYPE",413509423:"IFCSYSTEMFURNITUREELEMENT",3101698114:"IFCSURFACEFEATURE",3657597509:"IFCSTRUCTURALSURFACEACTION",2757150158:"IFCSTRUCTURALCURVEREACTION",1004757350:"IFCSTRUCTURALCURVEACTION",338393293:"IFCSTAIRTYPE",1072016465:"IFCSOLARDEVICETYPE",4074543187:"IFCSHADINGDEVICETYPE",2157484638:"IFCSEAMCURVE",2781568857:"IFCROOFTYPE",2310774935:"IFCREINFORCINGMESHTYPE",964333572:"IFCREINFORCINGELEMENTTYPE",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",1469900589:"IFCRAMPTYPE",2839578677:"IFCPOLYGONALFACESET",1158309216:"IFCPILETYPE",3079942009:"IFCOPENINGSTANDARDCASE",1114901282:"IFCMEDICALDEVICETYPE",3113134337:"IFCINTERSECTIONCURVE",3946677679:"IFCINTERCEPTORTYPE",2571569899:"IFCINDEXEDPOLYCURVE",3493046030:"IFCGEOGRAPHICELEMENT",1509553395:"IFCFURNITURE",1893162501:"IFCFOOTINGTYPE",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",4148101412:"IFCEVENT",132023988:"IFCENGINETYPE",2397081782:"IFCELEMENTASSEMBLYTYPE",2323601079:"IFCDOORTYPE",1213902940:"IFCCYLINDRICALSURFACE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",15328376:"IFCCOMPOSITECURVEONSURFACE",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3893394355:"IFCCIVILELEMENTTYPE",2197970202:"IFCCHIMNEYTYPE",167062518:"IFCBSPLINESURFACEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",2603310189:"IFCADVANCEDBREPWITHVOIDS",1635779807:"IFCADVANCEDBREP",2916149573:"IFCTRIANGULATEDFACESET",1935646853:"IFCTOROIDALSURFACE",2387106220:"IFCTESSELLATEDFACESET",3206491090:"IFCTASKTYPE",699246055:"IFCSURFACECURVE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",603775116:"IFCSTRUCTURALSURFACEREACTION",4015995234:"IFCSPHERICALSURFACE",2481509218:"IFCSPATIALZONETYPE",463610769:"IFCSPATIALZONE",710998568:"IFCSPATIALELEMENTTYPE",1412071761:"IFCSPATIALELEMENT",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",427948657:"IFCRELINTERFERESELEMENTS",307848117:"IFCRELDEFINESBYTEMPLATE",1462361463:"IFCRELDEFINESBYOBJECT",2565941209:"IFCRELDECLARES",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",3521284610:"IFCPROPERTYTEMPLATE",492091185:"IFCPROPERTYSETTEMPLATE",653396225:"IFCPROJECTLIBRARY",569719735:"IFCPROCEDURETYPE",3967405729:"IFCPREDEFINEDPROPERTYSET",1682466193:"IFCPCURVE",428585644:"IFCLABORRESOURCETYPE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",178912537:"IFCINDEXEDPOLYGONALFACE",4095422895:"IFCGEOGRAPHICELEMENTTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",4024345920:"IFCEVENTTYPE",2629017746:"IFCCURVEBOUNDEDSURFACE",1815067380:"IFCCREWRESOURCETYPE",3419103109:"IFCCONTEXT",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",2059837836:"IFCCARTESIANPOINTLIST3D",1675464909:"IFCCARTESIANPOINTLIST2D",574549367:"IFCCARTESIANPOINTLIST",3406155212:"IFCADVANCEDFACE",3698973494:"IFCTYPERESOURCE",3736923433:"IFCTYPEPROCESS",901063453:"IFCTESSELLATEDITEM",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",1042787934:"IFCRESOURCETIME",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",2090586900:"IFCQUANTITYSET",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",3778827333:"IFCPREDEFINEDPROPERTIES",2998442950:"IFCMIRROREDPROFILEDEF",853536259:"IFCMATERIALRELATIONSHIP",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",3079605661:"IFCMATERIALPROFILESETUSAGE",2852063980:"IFCMATERIALCONSTITUENTSET",3708119e3:"IFCMATERIALCONSTITUENT",1585845231:"IFCLAGTIME",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",1437953363:"IFCINDEXEDTEXTUREMAP",3570813810:"IFCINDEXEDCOLOURMAP",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",297599258:"IFCEXTENDEDPROPERTIES",211053100:"IFCEVENTTIME",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",3285139300:"IFCCOLOURRGBLIST",1236880293:"IFCWORKTIME",1199560280:"IFCTIMEPERIOD",3611470254:"IFCTEXTUREVERTEXLIST",2771591690:"IFCTASKTIMERECURRING",1549132990:"IFCTASKTIME",2043862942:"IFCTABLECOLUMN",2934153892:"IFCSURFACEREINFORCEMENTAREA",609421318:"IFCSTRUCTURALLOADORRESULT",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1054537805:"IFCSCHEDULINGTIME",2439245199:"IFCRESOURCELEVELRELATIONSHIP",2433181523:"IFCREFERENCE",3915482550:"IFCRECURRENCEPATTERN",986844984:"IFCPROPERTYABSTRACTION",3843373140:"IFCPROJECTEDCRS",677532197:"IFCPRESENTATIONITEM",1507914824:"IFCMATERIALUSAGEDEFINITION",552965576:"IFCMATERIALPROFILEWITHOFFSETS",164193824:"IFCMATERIALPROFILESET",2235152071:"IFCMATERIALPROFILE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",760658860:"IFCMATERIALDEFINITION",3057273783:"IFCMAPCONVERSION",4294318154:"IFCEXTERNALINFORMATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",1785450214:"IFCCOORDINATEOPERATION",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",979691226:"IFCREINFORCINGBAR",3700593921:"IFCELECTRICDISTRIBUTIONPOINT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",578613899:"IFCCONTROLLERTYPE",2454782716:"IFCCHAMFEREDGEFEATURE",753842376:"IFCBEAM",3001207471:"IFCALARMTYPE",2874132201:"IFCACTUATORTYPE",3304561284:"IFCWINDOW",3512223829:"IFCWALLSTANDARDCASE",2391406946:"IFCWALL",3313531582:"IFCVIBRATIONISOLATORTYPE",2347447852:"IFCTENDONANCHOR",3824725483:"IFCTENDON",2515109513:"IFCSTRUCTURALANALYSISMODEL",4252922144:"IFCSTAIRFLIGHT",331165859:"IFCSTAIR",1529196076:"IFCSLAB",1783015770:"IFCSENSORTYPE",1376911519:"IFCROUNDEDEDGEFEATURE",2016517767:"IFCROOF",2320036040:"IFCREINFORCINGMESH",3027567501:"IFCREINFORCINGELEMENT",3055160366:"IFCRATIONALBEZIERCURVE",3283111854:"IFCRAMPFLIGHT",3024970846:"IFCRAMP",2262370178:"IFCRAILING",3171933400:"IFCPLATE",1687234759:"IFCPILE",1073191201:"IFCMEMBER",900683007:"IFCFOOTING",3508470533:"IFCFLOWTREATMENTDEVICE",2223149337:"IFCFLOWTERMINAL",707683696:"IFCFLOWSTORAGEDEVICE",987401354:"IFCFLOWSEGMENT",3132237377:"IFCFLOWMOVINGDEVICE",4037862832:"IFCFLOWINSTRUMENTTYPE",4278956645:"IFCFLOWFITTING",2058353004:"IFCFLOWCONTROLLER",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",1810631287:"IFCFILTERTYPE",346874300:"IFCFANTYPE",1658829314:"IFCENERGYCONVERSIONDEVICE",857184966:"IFCELECTRICALELEMENT",1634875225:"IFCELECTRICALCIRCUIT",712377611:"IFCELECTRICTIMECONTROLTYPE",1217240411:"IFCELECTRICMOTORTYPE",1365060375:"IFCELECTRICHEATERTYPE",1534661035:"IFCELECTRICGENERATORTYPE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",663422040:"IFCELECTRICAPPLIANCETYPE",855621170:"IFCEDGEFEATURE",2030761528:"IFCDUCTSILENCERTYPE",3760055223:"IFCDUCTSEGMENTTYPE",869906466:"IFCDUCTFITTINGTYPE",395920057:"IFCDOOR",3041715199:"IFCDISTRIBUTIONPORT",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",1945004755:"IFCDISTRIBUTIONELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",2635815018:"IFCDISCRETEACCESSORYTYPE",1335981549:"IFCDISCRETEACCESSORY",4147604152:"IFCDIAMETERDIMENSION",3961806047:"IFCDAMPERTYPE",3495092785:"IFCCURTAINWALL",1973544240:"IFCCOVERING",2954562838:"IFCCOOLINGTOWERTYPE",335055490:"IFCCOOLEDBEAMTYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",1163958913:"IFCCONDITIONCRITERION",2188551683:"IFCCONDITION",2816379211:"IFCCONDENSERTYPE",3850581409:"IFCCOMPRESSORTYPE",843113511:"IFCCOLUMN",2301859152:"IFCCOILTYPE",2611217952:"IFCCIRCLE",2951183804:"IFCCHILLERTYPE",1285652485:"IFCCABLESEGMENTTYPE",3293546465:"IFCCABLECARRIERSEGMENTTYPE",395041908:"IFCCABLECARRIERFITTINGTYPE",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",2979338954:"IFCBUILDINGELEMENTPART",52481810:"IFCBUILDINGELEMENTCOMPONENT",3299480353:"IFCBUILDINGELEMENT",231477066:"IFCBOILERTYPE",1916977116:"IFCBEZIERCURVE",819618141:"IFCBEAMTYPE",1967976161:"IFCBSPLINECURVE",3460190687:"IFCASSET",2470393545:"IFCANGULARDIMENSION",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3352864051:"IFCAIRTERMINALTYPE",1411407467:"IFCAIRTERMINALBOXTYPE",3821786052:"IFCACTIONREQUEST",1213861670:"IFC2DCOMPOSITECURVE",1033361043:"IFCZONE",3342526732:"IFCWORKSCHEDULE",4218914973:"IFCWORKPLAN",1028945134:"IFCWORKCONTROL",1133259667:"IFCWASTETERMINALTYPE",1898987631:"IFCWALLTYPE",2769231204:"IFCVIRTUALELEMENT",728799441:"IFCVALVETYPE",1911125066:"IFCUNITARYEQUIPMENTTYPE",1600972822:"IFCTUBEBUNDLETYPE",3593883385:"IFCTRIMMEDCURVE",1620046519:"IFCTRANSPORTELEMENT",1692211062:"IFCTRANSFORMERTYPE",1637806684:"IFCTIMESERIESSCHEDULE",5716631:"IFCTANKTYPE",2254336722:"IFCSYSTEM",2315554128:"IFCSWITCHINGDEVICETYPE",148013059:"IFCSUBCONTRACTRESOURCE",1975003073:"IFCSTRUCTURALSURFACECONNECTION",2986769608:"IFCSTRUCTURALRESULTGROUP",1235345126:"IFCSTRUCTURALPOINTREACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",2082059205:"IFCSTRUCTURALPOINTACTION",3987759626:"IFCSTRUCTURALPLANARACTIONVARYING",1621171031:"IFCSTRUCTURALPLANARACTION",1252848954:"IFCSTRUCTURALLOADGROUP",1721250024:"IFCSTRUCTURALLINEARACTIONVARYING",1807405624:"IFCSTRUCTURALLINEARACTION",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",214636428:"IFCSTRUCTURALCURVEMEMBER",4243806635:"IFCSTRUCTURALCURVECONNECTION",1179482911:"IFCSTRUCTURALCONNECTION",682877961:"IFCSTRUCTURALACTION",1039846685:"IFCSTAIRFLIGHTTYPE",3112655638:"IFCSTACKTERMINALTYPE",3812236995:"IFCSPACETYPE",652456506:"IFCSPACEPROGRAM",1305183839:"IFCSPACEHEATERTYPE",3856911033:"IFCSPACE",2533589738:"IFCSLABTYPE",4097777520:"IFCSITE",4105383287:"IFCSERVICELIFE",3517283431:"IFCSCHEDULETIMECONTROL",1768891740:"IFCSANITARYTERMINALTYPE",2863920197:"IFCRELASSIGNSTASKS",160246688:"IFCRELAGGREGATES",2324767716:"IFCRAMPFLIGHTTYPE",2893384427:"IFCRAILINGTYPE",3248260540:"IFCRADIUSDIMENSION",2250791053:"IFCPUMPTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3651124850:"IFCPROJECTIONELEMENT",3642467123:"IFCPROJECTORDERRECORD",2904328755:"IFCPROJECTORDER",2744685151:"IFCPROCEDURE",3740093272:"IFCPORT",3724593414:"IFCPOLYLINE",4017108033:"IFCPLATETYPE",4231323485:"IFCPIPESEGMENTTYPE",804291784:"IFCPIPEFITTINGTYPE",3327091369:"IFCPERMIT",2382730787:"IFCPERFORMANCEHISTORY",2837617999:"IFCOUTLETTYPE",3425660407:"IFCORDERACTION",3588315303:"IFCOPENINGELEMENT",4143007308:"IFCOCCUPANT",1916936684:"IFCMOVE",977012517:"IFCMOTORCONNECTIONTYPE",3181161470:"IFCMEMBERTYPE",2108223431:"IFCMECHANICALFASTENERTYPE",377706215:"IFCMECHANICALFASTENER",2506943328:"IFCLINEARDIMENSION",1161773419:"IFCLIGHTFIXTURETYPE",1051575348:"IFCLAMPTYPE",3827777499:"IFCLABORRESOURCE",4288270099:"IFCJUNCTIONBOXTYPE",2391368822:"IFCINVENTORY",1806887404:"IFCHUMIDIFIERTYPE",1251058090:"IFCHEATEXCHANGERTYPE",2706460486:"IFCGROUP",3009204131:"IFCGRID",200128114:"IFCGASTERMINALTYPE",814719939:"IFCFURNITURESTANDARD",263784265:"IFCFURNISHINGELEMENT",3009222698:"IFCFLOWTREATMENTDEVICETYPE",2297155007:"IFCFLOWTERMINALTYPE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",1834744321:"IFCFLOWSEGMENTTYPE",1482959167:"IFCFLOWMOVINGDEVICETYPE",3815607619:"IFCFLOWMETERTYPE",3198132628:"IFCFLOWFITTINGTYPE",3907093117:"IFCFLOWCONTROLLERTYPE",1287392070:"IFCFEATUREELEMENTSUBTRACTION",2143335405:"IFCFEATUREELEMENTADDITION",2827207264:"IFCFEATUREELEMENT",2489546625:"IFCFASTENERTYPE",647756555:"IFCFASTENER",3737207727:"IFCFACETEDBREPWITHVOIDS",807026263:"IFCFACETEDBREP",3390157468:"IFCEVAPORATORTYPE",3174744832:"IFCEVAPORATIVECOOLERTYPE",3272907226:"IFCEQUIPMENTSTANDARD",1962604670:"IFCEQUIPMENTELEMENT",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",1704287377:"IFCELLIPSE",2590856083:"IFCELEMENTCOMPONENTTYPE",1623761950:"IFCELEMENTCOMPONENT",4123344466:"IFCELEMENTASSEMBLY",1758889154:"IFCELEMENT",360485395:"IFCELECTRICALBASEPROPERTIES",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",681481545:"IFCDIMENSIONCURVEDIRECTEDCALLOUT",1457835157:"IFCCURTAINWALLTYPE",3295246426:"IFCCREWRESOURCE",1916426348:"IFCCOVERINGTYPE",1419761937:"IFCCOSTSCHEDULE",3895139033:"IFCCOSTITEM",3293443760:"IFCCONTROL",2559216714:"IFCCONSTRUCTIONRESOURCE",2510884976:"IFCCONIC",3732776249:"IFCCOMPOSITECURVE",300633059:"IFCCOLUMNTYPE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",3124254112:"IFCBUILDINGSTOREY",1950629157:"IFCBUILDINGELEMENTTYPE",4031249490:"IFCBUILDING",1260505505:"IFCBOUNDEDCURVE",3649129432:"IFCBOOLEANCLIPPINGRESULT",1334484129:"IFCBLOCK",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",1674181508:"IFCANNOTATION",2296667514:"IFCACTOR",2097647324:"IFCTRANSPORTELEMENTTYPE",3473067441:"IFCTASK",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",4124788165:"IFCSURFACEOFREVOLUTION",2809605785:"IFCSURFACEOFLINEAREXTRUSION",2028607225:"IFCSURFACECURVESWEPTAREASOLID",4070609034:"IFCSTRUCTUREDDIMENSIONCALLOUT",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",3979015343:"IFCSTRUCTURALSURFACEMEMBER",3689010777:"IFCSTRUCTURALREACTION",530289379:"IFCSTRUCTURALMEMBER",3136571912:"IFCSTRUCTURALITEM",3544373492:"IFCSTRUCTURALACTIVITY",451544542:"IFCSPHERE",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3626867408:"IFCRIGHTCIRCULARCYLINDER",4158566097:"IFCRIGHTCIRCULARCONE",1856042241:"IFCREVOLVEDAREASOLID",2914609552:"IFCRESOURCE",1401173127:"IFCRELVOIDSELEMENT",3451746338:"IFCRELSPACEBOUNDARY",366585022:"IFCRELSERVICESBUILDINGS",4122056220:"IFCRELSEQUENCE",1058617721:"IFCRELSCHEDULESCOSTITEMS",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",750771296:"IFCRELPROJECTSELEMENT",202636808:"IFCRELOVERRIDESPROPERTIES",2051452291:"IFCRELOCCUPIESSPACES",3268803585:"IFCRELNESTS",4189434867:"IFCRELINTERACTIONREQUIREMENTS",279856033:"IFCRELFLOWCONTROLELEMENTS",3940055652:"IFCRELFILLSELEMENT",781010003:"IFCRELDEFINESBYTYPE",4186316022:"IFCRELDEFINESBYPROPERTIES",693640335:"IFCRELDEFINES",2551354335:"IFCRELDECOMPOSES",2802773753:"IFCRELCOVERSSPACES",886880790:"IFCRELCOVERSBLDGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",504942748:"IFCRELCONNECTSWITHECCENTRICITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",3912681535:"IFCRELCONNECTSSTRUCTURALELEMENT",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",3190031847:"IFCRELCONNECTSPORTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3945020480:"IFCRELCONNECTSPATHELEMENTS",1204542856:"IFCRELCONNECTSELEMENTS",826625072:"IFCRELCONNECTS",2851387026:"IFCRELASSOCIATESPROFILEPROPERTIES",2655215786:"IFCRELASSOCIATESMATERIAL",3840914261:"IFCRELASSOCIATESLIBRARY",982818633:"IFCRELASSOCIATESDOCUMENT",2728634034:"IFCRELASSOCIATESCONSTRAINT",919958153:"IFCRELASSOCIATESCLASSIFICATION",4095574036:"IFCRELASSOCIATESAPPROVAL",1327628568:"IFCRELASSOCIATESAPPLIEDVALUE",1865459582:"IFCRELASSOCIATES",205026976:"IFCRELASSIGNSTORESOURCE",3372526763:"IFCRELASSIGNSTOPROJECTORDER",2857406711:"IFCRELASSIGNSTOPRODUCT",4278684876:"IFCRELASSIGNSTOPROCESS",1307041759:"IFCRELASSIGNSTOGROUP",2495723537:"IFCRELASSIGNSTOCONTROL",1683148259:"IFCRELASSIGNSTOACTOR",3939117080:"IFCRELASSIGNS",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",2798486643:"IFCRECTANGULARPYRAMID",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3219374653:"IFCPROXY",1451395588:"IFCPROPERTYSET",4194566429:"IFCPROJECTIONCURVE",103090709:"IFCPROJECT",4208778838:"IFCPRODUCT",2945172077:"IFCPROCESS",220341763:"IFCPLANE",603570806:"IFCPLANARBOX",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3505215534:"IFCOFFSETCURVE3D",3388369263:"IFCOFFSETCURVE2D",3888040117:"IFCOBJECT",1425443689:"IFCMANIFOLDSOLIDBREP",1281925730:"IFCLINE",572779678:"IFCLSHAPEPROFILEDEF",1484403080:"IFCISHAPEPROFILEDEF",987898635:"IFCGEOMETRICCURVESET",1268542332:"IFCFURNITURETYPE",4238390223:"IFCFURNISHINGELEMENTTYPE",3455213021:"IFCFLUIDFLOWPROPERTIES",315944413:"IFCFILLAREASTYLETILES",4203026998:"IFCFILLAREASTYLETILESYMBOLWITHSTYLE",374418227:"IFCFILLAREASTYLEHATCHING",2047409740:"IFCFACEBASEDSURFACEMODEL",477187591:"IFCEXTRUDEDAREASOLID",80994333:"IFCENERGYPROPERTIES",2835456948:"IFCELLIPSEPROFILEDEF",2777663545:"IFCELEMENTARYSURFACE",339256511:"IFCELEMENTTYPE",1883228015:"IFCELEMENTQUANTITY",1472233963:"IFCEDGELOOP",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",3073041342:"IFCDRAUGHTINGCALLOUT",526551008:"IFCDOORSTYLE",1714330368:"IFCDOORPANELPROPERTIES",2963535650:"IFCDOORLININGPROPERTIES",32440307:"IFCDIRECTION",4054601972:"IFCDIMENSIONCURVETERMINATOR",606661476:"IFCDIMENSIONCURVE",693772133:"IFCDEFINEDSYMBOL",2827736869:"IFCCURVEBOUNDEDPLANE",2601014836:"IFCCURVE",2147822146:"IFCCSGSOLID",2506170314:"IFCCSGPRIMITIVE3D",194851669:"IFCCRANERAILFSHAPEPROFILEDEF",4133800736:"IFCCRANERAILASHAPEPROFILEDEF",2485617015:"IFCCOMPOSITECURVESEGMENT",2205249479:"IFCCLOSEDSHELL",1383045692:"IFCCIRCLEPROFILEDEF",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",1123145078:"IFCCARTESIANPOINT",2898889636:"IFCCSHAPEPROFILEDEF",2713105998:"IFCBOXEDHALFSPACE",2581212453:"IFCBOUNDINGBOX",4182860854:"IFCBOUNDEDSURFACE",2736907675:"IFCBOOLEANRESULT",2740243338:"IFCAXIS2PLACEMENT3D",3125803723:"IFCAXIS2PLACEMENT2D",4261334040:"IFCAXIS1PLACEMENT",1302238472:"IFCANNOTATIONSURFACE",2265737646:"IFCANNOTATIONFILLAREAOCCURRENCE",669184980:"IFCANNOTATIONFILLAREA",3288037868:"IFCANNOTATIONCURVEOCCURRENCE",2543172580:"IFCZSHAPEPROFILEDEF",1299126871:"IFCWINDOWSTYLE",512836454:"IFCWINDOWPANELPROPERTIES",336235671:"IFCWINDOWLININGPROPERTIES",2759199220:"IFCVERTEXLOOP",1417489154:"IFCVECTOR",427810014:"IFCUSHAPEPROFILEDEF",2347495698:"IFCTYPEPRODUCT",1628702193:"IFCTYPEOBJECT",1345879162:"IFCTWODIRECTIONREPEATFACTOR",2715220739:"IFCTRAPEZIUMPROFILEDEF",3124975700:"IFCTEXTLITERALWITHEXTENT",4282788508:"IFCTEXTLITERAL",3028897424:"IFCTERMINATORSYMBOL",3071757647:"IFCTSHAPEPROFILEDEF",230924584:"IFCSWEPTSURFACE",1260650574:"IFCSWEPTDISKSOLID",2247615214:"IFCSWEPTAREASOLID",1878645084:"IFCSURFACESTYLERENDERING",2513912981:"IFCSURFACE",2233826070:"IFCSUBEDGE",3653947884:"IFCSTRUCTURALSTEELPROFILEPROPERTIES",3843319758:"IFCSTRUCTURALPROFILEPROPERTIES",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",390701378:"IFCSPACETHERMALLOADPROPERTIES",1202362311:"IFCSOUNDVALUE",2485662743:"IFCSOUNDPROPERTIES",723233188:"IFCSOLIDMODEL",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",4124623270:"IFCSHELLBASEDSURFACEMODEL",2411513650:"IFCSERVICELIFEFACTOR",1509187699:"IFCSECTIONEDSPINE",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",478536968:"IFCRELATIONSHIP",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",3413951693:"IFCREGULARTIMESERIES",3615266464:"IFCRECTANGLEPROFILEDEF",110355661:"IFCPROPERTYTABLEVALUE",3650150729:"IFCPROPERTYSINGLEVALUE",3357820518:"IFCPROPERTYSETDEFINITION",941946838:"IFCPROPERTYREFERENCEVALUE",2752243245:"IFCPROPERTYLISTVALUE",4166981789:"IFCPROPERTYENUMERATEDVALUE",1680319473:"IFCPROPERTYDEFINITION",871118103:"IFCPROPERTYBOUNDEDVALUE",673634403:"IFCPRODUCTDEFINITIONSHAPE",179317114:"IFCPREDEFINEDPOINTMARKERSYMBOL",433424934:"IFCPREDEFINEDDIMENSIONSYMBOL",2559016684:"IFCPREDEFINEDCURVEFONT",759155922:"IFCPREDEFINEDCOLOUR",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2924175390:"IFCPOLYLOOP",1423911732:"IFCPOINTONSURFACE",4022376103:"IFCPOINTONCURVE",2067069095:"IFCPOINT",1663979128:"IFCPLANAREXTENT",2004835150:"IFCPLACEMENT",597895409:"IFCPIXELTEXTURE",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2519244187:"IFCPATH",2529465313:"IFCPARAMETERIZEDPROFILEDEF",1029017970:"IFCORIENTEDEDGE",2665983363:"IFCOPENSHELL",2833995503:"IFCONEDIRECTIONREPEATFACTOR",219451334:"IFCOBJECTDEFINITION",1430189142:"IFCMECHANICALCONCRETEMATERIALPROPERTIES",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",2347385850:"IFCMAPPEDITEM",1008929658:"IFCLOOP",2624227202:"IFCLOCALPLACEMENT",3422422726:"IFCLIGHTSOURCESPOT",1520743889:"IFCLIGHTSOURCEPOSITIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",125510826:"IFCLIGHTSOURCEAMBIENT",1402838566:"IFCLIGHTSOURCE",3741457305:"IFCIRREGULARTIMESERIES",3905492369:"IFCIMAGETEXTURE",2445078500:"IFCHYGROSCOPICMATERIALPROPERTIES",812098782:"IFCHALFSPACESOLID",178086475:"IFCGRIDPLACEMENT",3590301190:"IFCGEOMETRICSET",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",1446786286:"IFCGENERALPROFILEPROPERTIES",803998398:"IFCGENERALMATERIALPROPERTIES",3857492461:"IFCFUELPROPERTIES",738692330:"IFCFILLAREASTYLE",4219587988:"IFCFAILURECONNECTIONCONDITION",3008276851:"IFCFACESURFACE",803316827:"IFCFACEOUTERBOUND",1809719519:"IFCFACEBOUND",2556980723:"IFCFACE",1860660968:"IFCEXTENDEDMATERIALPROPERTIES",476780140:"IFCEDGECURVE",3900360178:"IFCEDGE",4170525392:"IFCDRAUGHTINGPREDEFINEDTEXTFONT",3732053477:"IFCDOCUMENTREFERENCE",1694125774:"IFCDIMENSIONPAIR",2273265877:"IFCDIMENSIONCALLOUTRELATIONSHIP",3632507154:"IFCDERIVEDPROFILEDEF",3800577675:"IFCCURVESTYLE",2889183280:"IFCCONVERSIONBASEDUNIT",3050246964:"IFCCONTEXTDEPENDENTUNIT",45288368:"IFCCONNECTIONPOINTECCENTRICITY",1981873012:"IFCCONNECTIONCURVEGEOMETRY",370225590:"IFCCONNECTEDFACESET",1485152156:"IFCCOMPOSITEPROFILEDEF",2542286263:"IFCCOMPLEXPROPERTY",776857604:"IFCCOLOURRGB",647927063:"IFCCLASSIFICATIONREFERENCE",3150382593:"IFCCENTERLINEPROFILEDEF",616511568:"IFCBLOBTEXTURE",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",1310608509:"IFCARBITRARYOPENPROFILEDEF",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",2297822566:"IFCANNOTATIONTEXTOCCURRENCE",3612888222:"IFCANNOTATIONSYMBOLOCCURRENCE",962685235:"IFCANNOTATIONSURFACEOCCURRENCE",2442683028:"IFCANNOTATIONOCCURRENCE",1065908215:"IFCWATERPROPERTIES",891718957:"IFCVIRTUALGRIDINTERSECTION",1907098498:"IFCVERTEXPOINT",3304826586:"IFCVERTEXBASEDTEXTUREMAP",2799835756:"IFCVERTEX",180925521:"IFCUNITASSIGNMENT",1735638870:"IFCTOPOLOGYREPRESENTATION",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",581633288:"IFCTIMESERIESVALUE",1718945513:"IFCTIMESERIESREFERENCERELATIONSHIP",3101149627:"IFCTIMESERIES",3317419933:"IFCTHERMALMATERIALPROPERTIES",1210645708:"IFCTEXTUREVERTEX",2552916305:"IFCTEXTUREMAP",1742049831:"IFCTEXTURECOORDINATEGENERATOR",280115917:"IFCTEXTURECOORDINATE",1484833681:"IFCTEXTSTYLEWITHBOXCHARACTERISTICS",1640371178:"IFCTEXTSTYLETEXTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1983826977:"IFCTEXTSTYLEFONTMODEL",1447204868:"IFCTEXTSTYLE",912023232:"IFCTELECOMADDRESS",531007025:"IFCTABLEROW",985171141:"IFCTABLE",1290481447:"IFCSYMBOLSTYLE",626085974:"IFCSURFACETEXTURE",1351298697:"IFCSURFACESTYLEWITHTEXTURES",846575682:"IFCSURFACESTYLESHADING",1607154358:"IFCSURFACESTYLEREFRACTION",3303107099:"IFCSURFACESTYLELIGHTING",1300840506:"IFCSURFACESTYLE",3049322572:"IFCSTYLEDREPRESENTATION",3958052878:"IFCSTYLEDITEM",2830218821:"IFCSTYLEMODEL",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",2525727697:"IFCSTRUCTURALLOADSTATIC",2162789131:"IFCSTRUCTURALLOAD",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",3692461612:"IFCSIMPLEPROPERTY",4240577450:"IFCSHAPEREPRESENTATION",3982875396:"IFCSHAPEMODEL",867548509:"IFCSHAPEASPECT",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",2042790032:"IFCSECTIONPROPERTIES",448429030:"IFCSIUNIT",2341007311:"IFCROOT",3679540991:"IFCRIBPLATEPROFILEPROPERTIES",1660063152:"IFCREPRESENTATIONMAP",3008791417:"IFCREPRESENTATIONITEM",3377609919:"IFCREPRESENTATIONCONTEXT",1076942058:"IFCREPRESENTATION",1222501353:"IFCRELAXATION",1580146022:"IFCREINFORCEMENTBARPROPERTIES",2692823254:"IFCREFERENCESVALUEDOCUMENT",825690147:"IFCQUANTITYWEIGHT",2405470396:"IFCQUANTITYVOLUME",3252649465:"IFCQUANTITYTIME",931644368:"IFCQUANTITYLENGTH",2093928680:"IFCQUANTITYCOUNT",2044713172:"IFCQUANTITYAREA",3710013099:"IFCPROPERTYENUMERATION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",3896028662:"IFCPROPERTYCONSTRAINTRELATIONSHIP",2598011224:"IFCPROPERTY",2802850158:"IFCPROFILEPROPERTIES",3958567839:"IFCPROFILEDEF",2267347899:"IFCPRODUCTSOFCOMBUSTIONPROPERTIES",2095639259:"IFCPRODUCTREPRESENTATION",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",3119450353:"IFCPRESENTATIONSTYLE",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1775413392:"IFCPREDEFINEDTEXTFONT",3213052703:"IFCPREDEFINEDTERMINATORSYMBOL",990879717:"IFCPREDEFINEDSYMBOL",3727388367:"IFCPREDEFINEDITEM",3355820592:"IFCPOSTALADDRESS",2226359599:"IFCPHYSICALSIMPLEQUANTITY",2483315170:"IFCPHYSICALQUANTITY",101040310:"IFCPERSONANDORGANIZATION",2077209135:"IFCPERSON",1207048766:"IFCOWNERHISTORY",1411181986:"IFCORGANIZATIONRELATIONSHIP",4251960020:"IFCORGANIZATION",1227763645:"IFCOPTICALMATERIALPROPERTIES",2251480897:"IFCOBJECTIVE",3701648758:"IFCOBJECTPLACEMENT",1918398963:"IFCNAMEDUNIT",2706619895:"IFCMONETARYUNIT",3368373690:"IFCMETRIC",677618848:"IFCMECHANICALSTEELMATERIALPROPERTIES",4256014907:"IFCMECHANICALMATERIALPROPERTIES",2597039031:"IFCMEASUREWITHUNIT",3265635763:"IFCMATERIALPROPERTIES",2199411900:"IFCMATERIALLIST",1303795690:"IFCMATERIALLAYERSETUSAGE",3303938423:"IFCMATERIALLAYERSET",248100487:"IFCMATERIALLAYER",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",1838606355:"IFCMATERIAL",30780891:"IFCLOCALTIME",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",4162380809:"IFCLIGHTDISTRIBUTIONDATA",3452421091:"IFCLIBRARYREFERENCE",2655187982:"IFCLIBRARYINFORMATION",3020489413:"IFCIRREGULARTIMESERIESVALUE",852622518:"IFCGRIDAXIS",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",3207319532:"IFCEXTERNALLYDEFINEDSYMBOL",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",3200245327:"IFCEXTERNALREFERENCE",1648886627:"IFCENVIRONMENTALIMPACTVALUE",3796139169:"IFCDRAUGHTINGCALLOUTRELATIONSHIP",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",1154170062:"IFCDOCUMENTINFORMATION",1376555844:"IFCDOCUMENTELECTRONICFORMAT",2949456006:"IFCDIMENSIONALEXPONENTS",1045800335:"IFCDERIVEDUNITELEMENT",1765591967:"IFCDERIVEDUNIT",1072939445:"IFCDATEANDTIME",3510044353:"IFCCURVESTYLEFONTPATTERN",2367409068:"IFCCURVESTYLEFONTANDSCALING",1105321065:"IFCCURVESTYLEFONT",539742890:"IFCCURRENCYRELATIONSHIP",602808272:"IFCCOSTVALUE",1065062679:"IFCCOORDINATEDUNIVERSALTIMEOFFSET",347226245:"IFCCONSTRAINTRELATIONSHIP",613356794:"IFCCONSTRAINTCLASSIFICATIONRELATIONSHIP",1658513725:"IFCCONSTRAINTAGGREGATIONRELATIONSHIP",1959218052:"IFCCONSTRAINT",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",4257277454:"IFCCONNECTIONPORTGEOMETRY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",3264961684:"IFCCOLOURSPECIFICATION",3639012971:"IFCCLASSIFICATIONNOTATIONFACET",938368621:"IFCCLASSIFICATIONNOTATION",1098599126:"IFCCLASSIFICATIONITEMRELATIONSHIP",1767535486:"IFCCLASSIFICATIONITEM",747523909:"IFCCLASSIFICATION",622194075:"IFCCALENDARDATE",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1387855156:"IFCBOUNDARYNODECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1560379544:"IFCBOUNDARYEDGECONDITION",4037036970:"IFCBOUNDARYCONDITION",3869604511:"IFCAPPROVALRELATIONSHIP",390851274:"IFCAPPROVALPROPERTYRELATIONSHIP",2080292479:"IFCAPPROVALACTORRELATIONSHIP",130549933:"IFCAPPROVAL",1110488051:"IFCAPPLIEDVALUERELATIONSHIP",411424972:"IFCAPPLIEDVALUE",639542469:"IFCAPPLICATION",618182010:"IFCADDRESS",3630933823:"IFCACTORROLE",599546466:"FILE_DESCRIPTION",1390159747:"FILE_NAME",1109904537:"FILE_SCHEMA"};class Mi{static async getUnits(e){var t,s,i;const{IFCUNITASSIGNMENT:n}=St,r=await e.getAllPropertiesOfType(n);if(!r)return 1;const o=Object.keys(r),a=r[parseInt(o[0],10)];for(const l of a.Units){if(l.value===void 0||l.value===null)continue;const c=await e.getProperties(l.value);if(!c||!c.UnitType||!c.UnitType.value||c.UnitType.value!=="LENGTHUNIT")continue;let p=1,u=1;return c.Name.value==="METRE"&&(u=1),c.Name.value==="FOOT"&&(u=.3048),((t=c.Prefix)==null?void 0:t.value)==="MILLI"?p=.001:((s=c.Prefix)==null?void 0:s.value)==="CENTI"?p=.01:((i=c.Prefix)==null?void 0:i.value)==="DECI"&&(p=.1),u*p}return 1}static async findItemByGuid(e,t){var s;const i=e.getAllPropertiesIDs();for(const n of i){const r=await e.getProperties(n);if(r&&((s=r.GlobalId)==null?void 0:s.value)===t)return r}return null}static async getRelationMap(e,t,s){var i;const n=s??(async()=>{}),r={},o=e.getAllPropertiesIDs();for(const a of o){const l=await e.getProperties(a);if(!l)continue;const c=l.type===t,p=Object.keys(l).find(T=>T.startsWith("Relating")),u=Object.keys(l).find(T=>T.startsWith("Related"));if(!(c&&p&&u))continue;const m=await e.getProperties((i=l[p])==null?void 0:i.value),E=l[u];if(!m||!E||!(E&&Array.isArray(E)))continue;const g=E.map(T=>T.value);await n(m.expressID,g),r[m.expressID]=g}return r}static async getQsetQuantities(e,t,s){const i=s??(()=>{}),n=await e.getProperties(t);return!n||n.type!==Dp?null:(n.Quantities??[{}]).map(r=>(r.value&&i(r.value),r.value)).filter(r=>r!==null)}static async getPsetProps(e,t,s){const i=s??(()=>{}),n=await e.getProperties(t);return!n||n.type!==tr?null:(n.HasProperties??[{}]).map(r=>(r.value&&i(r.value),r.value)).filter(r=>r!==null)}static async getPsetRel(e,t){var s;if(!await e.getProperties(t))return null;const i=await e.getAllPropertiesOfType(nr);if(!i)return null;const n=Object.values(i);let r=null;for(const o of n)((s=o.RelatingPropertyDefinition)==null?void 0:s.value)===t&&(r=o.expressID);return r}static async getQsetRel(e,t){return Mi.getPsetRel(e,t)}static async getEntityName(e,t){var s;const i=await e.getProperties(t);if(!i)return{key:null,name:null};const n=Object.keys(i).find(o=>o.endsWith("Name"))??null,r=n?(s=i[n])==null?void 0:s.value:null;return{key:n,name:r}}static async getQuantityValue(e,t){const s=await e.getProperties(t);if(!s)return{key:null,value:null};const i=Object.keys(s).find(r=>r.endsWith("Value"))??null;let n;return i===null||s[i]===void 0||s[i]===null?n=null:n=s[i].value,{key:i,value:n}}static isRel(e){return cm[e].startsWith("IFCREL")}static async attributeExists(e,t,s){const i=await e.getProperties(t);return i?Object.keys(i).includes(s):!1}static async groupEntitiesByType(e,t){var s;const i=new Map;for(const n of t){const r=await e.getProperties(n);if(!r)continue;const o=r.type;i.get(o)||i.set(o,new Set),(s=i.get(o))==null||s.add(n)}return i}}class hC{constructor(){x(this,"factor",1),x(this,"complement",1)}apply(e){const t=this.getScaleMatrix().multiply(e);e.copy(t)}setUp(e){var t,s,i;this.factor=1;const n=this.getLengthUnits(e);if(!n)return;const r=n==null,o=n.Name===void 0||n.Name===null;r||o||(n.Name.value==="FOOT"&&(this.factor=.3048),((t=n.Prefix)==null?void 0:t.value)==="MILLI"?this.complement=.001:((s=n.Prefix)==null?void 0:s.value)==="CENTI"?this.complement=.01:((i=n.Prefix)==null?void 0:i.value)==="DECI"&&(this.complement=.01))}getLengthUnits(e){try{const t=e.GetLineIDsWithType(0,Wp).get(0),s=e.GetLine(0,t);for(const i of s.Units){if(!i||i.value===null||i.value===void 0)continue;const n=e.GetLine(0,i.value);if(n.UnitType&&n.UnitType.value==="LENGTHUNIT")return n}return null}catch{return console.log("Could not get units"),null}}getScaleMatrix(){const e=this.factor;return new de().fromArray([e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1])}}class dm{constructor(){x(this,"itemsByFloor",{}),x(this,"_units",new hC)}setUp(e){this._units.setUp(e),this.cleanUp();try{const t=e.GetLineIDsWithType(0,rr),s=new Set,i=e.GetLineIDsWithType(0,Qt);for(let l=0;l<i.size();l++)s.add(i.get(l));const n=e.GetLineIDsWithType(0,ir),r=n.size();for(let l=0;l<r;l++){const c=n.get(l),p=e.GetLine(0,c);if(!p||!p.RelatingObject||!p.RelatedObjects)continue;const u=p.RelatingObject.value,m=p.RelatedObjects;for(const E of m){const g=E.value;s.has(g)&&(this.itemsByFloor[g]=u)}}const o={},a=t.size();for(let l=0;l<a;l++){const c=t.get(l),p=e.GetLine(0,c);if(!p||!p.RelatingStructure||!p.RelatedElements)continue;const u=p.RelatingStructure.value,m=p.RelatedElements;if(s.has(u))for(const E of m){o[u]||(o[u]=[]);const g=E.value;o[u].push(g)}else for(const E of m){const g=E.value;this.itemsByFloor[g]=u}}for(const l in o){const c=this.itemsByFloor[l];if(c!==void 0){const p=o[l];for(const u of p)this.itemsByFloor[u]=c}}for(let l=0;l<r;l++){const c=n.get(l),p=e.GetLine(0,c);if(!p||!p.RelatingObject||!p.RelatedObjects)continue;const u=p.RelatingObject.value,m=p.RelatedObjects;for(const E of m){const g=E.value,T=this.itemsByFloor[u];T!==void 0&&(this.itemsByFloor[g]=T)}}}catch{console.log("Could not get floors.")}}cleanUp(){this.itemsByFloor={}}}class ud{constructor(){x(this,"includeProperties",!0),x(this,"optionalCategories",[Qt]),x(this,"coordinate",!0),x(this,"wasm",{path:"",absolute:!1,logLevel:Up.LOG_LEVEL_OFF}),x(this,"excludedCategories",new Set),x(this,"includedCategories",new Set),x(this,"saveLocations",!1),x(this,"webIfc",{COORDINATE_TO_ORIGIN:!0}),x(this,"autoSetWasm",!0),x(this,"customLocateFileHandler",null)}}class um{constructor(){x(this,"defLineMat",new qs({color:16777215}))}read(e){const t=e.GetAllAlignments(0),s=e.GetAllCrossSections2D(0),i=e.GetAllCrossSections3D(0),n={IfcAlignment:t,IfcCrossSection2D:s,IfcCrossSection3D:i};return this.get(n)}get(e){if(e.IfcAlignment){const t=new Map;for(const s of e.IfcAlignment){const i=new Bp;i.absolute=this.getCurves(s.curve3D,i),i.horizontal=this.getCurves(s.horizontal,i),i.vertical=this.getCurves(s.vertical,i),t.set(t.size,i)}return{alignments:t,coordinationMatrix:new de}}}getCurves(e,t){const s=[];let i=0;for(const n of e){const r={};if(n.data)for(const u of n.data){const[m,E]=u.split(": "),g=parseFloat(E);r[m]=g||E}const{points:o}=n,a=new Float32Array(o.length*3);for(let u=0;u<o.length;u++){const{x:m,y:E,z:g}=o[u];a[u*3]=m,a[u*3+1]=E,a[u*3+2]=g||0}const l=new Ct(a,3),c=new zp;c.setAttribute("position",l);const p=new Yp(i,r,t,c,this.defLineMat);s.push(p.curve),i++}return s}}class pm{getNameInfo(e){var t;const s={},{arguments:i}=e.GetHeaderLine(0,kp)||{};if(!i)return s;const[n,r,o,a,l,c,p]=i;if(n!=null&&n.value&&(s.name=n.value),r!=null&&r.value&&(s.creationDate=new Date(r.value)),o){s.author={};const[u,m]=o;u!=null&&u.value&&(s.author.name=u.value),m!=null&&m.value&&(s.author.email=m.value)}return(t=a[0])!=null&&t.value&&(s.organization=a[0].value),l!=null&&l.value&&(s.preprocessorVersion=l==null?void 0:l.value),c!=null&&c.value&&(s.originatingSystem=c==null?void 0:c.value),p!=null&&p.value&&(s.authorization=p==null?void 0:p.value),s}getDescriptionInfo(e){var t;const s={},{arguments:i}=e.GetHeaderLine(0,Vp)||{};if(!i)return s;const[n,r]=i;if((t=n[0])!=null&&t.value){const o=n[0].value.match(/\[([^\]]+)\]/);o&&o[1]&&(s.viewDefinition=o[1])}return r!=null&&r.value&&(s.implementationLevel=r.value),s}}class fm{static get(e,t){const s=[or,ar,lr,cn,Qt,Xp,Kp,Zp,jp],i=e.data;for(const n of s){const r=t.GetLineIDsWithType(0,n),o=r.size();for(let a=0;a<o;a++){const l=r.get(a);i.has(l)||i.set(l,[[],[0,n]])}}}}const mm=class Lc extends De{constructor(e){super(e),x(this,"onDisposed",new te),x(this,"onIfcStartedLoading",new te),x(this,"onSetup",new te),x(this,"settings",new ud),x(this,"webIfc",new gs),x(this,"enabled",!0),x(this,"_material",new er),x(this,"_spatialTree",new dm),x(this,"_metaData",new pm),x(this,"_fragmentInstances",new Map),x(this,"_civil",new um),x(this,"_visitedFragments",new Map),x(this,"_materialT",new er({transparent:!0,opacity:.5})),this.components.add(Lc.uuid,this),this.settings.excludedCategories.add(Tl)}dispose(){this.webIfc=null,this.onDisposed.trigger(Lc.uuid),this.onDisposed.reset()}async setup(e){this.settings={...this.settings,...e},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(e,t=!0){const s=performance.now();this.onIfcStartedLoading.trigger(),await this.readIfcFile(e);const i=await this.getAllGeometries(),n=await this.components.get(lC).export(this.webIfc,0);i.setLocalProperties(n);const r=this.components.get(Qe);r.groups.set(i.uuid,i);for(const o of i.items)r.list.set(o.id,o),o.mesh.uuid=o.id,o.group=i;r.onFragmentsLoaded.trigger(i),t&&r.coordinate([i]);for(const[o]of i.data){const a=n[o];if(!a||!a.GlobalId)continue;const l=a.GlobalId.value||a.GlobalId;i.globalToExpressIDs.set(l,o)}return fm.get(i,this.webIfc),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-s} ms!`),i}async readIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;return this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(e,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new gs,this._visitedFragments.clear(),this._fragmentInstances.clear()}async getAllGeometries(){this._spatialTree.setUp(this.webIfc);const e=this.webIfc.GetIfcEntityList(0),t=new yl;t.ifcMetadata={name:"",description:"",...this._metaData.getNameInfo(this.webIfc),...this._metaData.getDescriptionInfo(this.webIfc),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};const s=[];for(const n of e){if(!this.webIfc.IsIfcElement(n)&&n!==Qt)continue;const r=this.settings.includedCategories;if(r.size>0&&!r.has(n)||this.settings.excludedCategories.has(n))continue;const o=this.webIfc.GetLineIDsWithType(0,n),a=o.size();for(let l=0;l<a;l++){const c=o.get(l);s.push(c);const p=this._spatialTree.itemsByFloor[c]||0;t.data.set(c,[[],[p,n]])}}this._spatialTree.cleanUp(),this.webIfc.StreamMeshes(0,s,n=>{this.getMesh(n,t)});for(const n of this._visitedFragments){const{index:r,fragment:o}=n[1];t.keyFragments.set(r,o.id)}for(const n of t.items){const r=this._fragmentInstances.get(n.id);if(!r)throw new Error("Fragment not found!");const o=[];for(const[a,l]of r)o.push(l);n.add(o)}const i=this.webIfc.GetCoordinationMatrix(0);return t.coordinationMatrix.fromArray(i),t.civilData=this._civil.read(this.webIfc),t}getMesh(e,t){const s=e.geometries.size(),i=e.expressID;for(let n=0;n<s;n++){const r=e.geometries.get(n),{x:o,y:a,z:l,w:c}=r.color,p=c!==1,{geometryExpressID:u}=r,m=`${u}-${p}`;if(!this._visitedFragments.has(m)){const C=this.getGeometry(this.webIfc,u),F=p?this._materialT:this._material,M=new ho(C,F,1);t.add(M.mesh),t.items.push(M);const _=this._visitedFragments.size;this._visitedFragments.set(m,{index:_,fragment:M})}const E=new ft().setRGB(o,a,l,"srgb"),g=new de;g.fromArray(r.flatTransformation);const T=this._visitedFragments.get(m);if(T===void 0)throw new Error("Error getting geometry data for streaming!");const y=t.data.get(i);if(!y)throw new Error("Data not found!");y[0].push(T.index);const{fragment:v}=T;this._fragmentInstances.has(v.id)||this._fragmentInstances.set(v.id,new Map);const A=this._fragmentInstances.get(v.id);if(!A)throw new Error("Instances not found!");if(A.has(i)){const C=A.get(i);if(!C)throw new Error("Instance not found!");C.transforms.push(g),C.colors&&C.colors.push(E)}else A.set(i,{id:i,transforms:[g],colors:[E]})}}getGeometry(e,t){const s=e.GetGeometry(0,t),i=e.GetIndexArray(s.GetIndexData(),s.GetIndexDataSize()),n=e.GetVertexArray(s.GetVertexData(),s.GetVertexDataSize()),r=new Float32Array(n.length/2),o=new Float32Array(n.length/2);for(let p=0;p<n.length;p+=6)r[p/2]=n[p],r[p/2+1]=n[p+1],r[p/2+2]=n[p+2],o[p/2]=n[p+3],o[p/2+1]=n[p+4],o[p/2+2]=n[p+5];const a=new ze,l=new Ct(r,3),c=new Ct(o,3);return a.setAttribute("position",l),a.setAttribute("normal",c),a.setIndex(Array.from(i)),s.delete(),a}async autoSetWasm(){const e=await fetch(`https://unpkg.com/@thatopen/components@${L1.release}/package.json`);if(!e.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const t=await e.json();if(!("web-ifc"in t.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const s=t.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${s}/`,this.settings.wasm.absolute=!0}}};x(mm,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");let cC=mm;const dC=class Zn extends De{constructor(e){super(e),x(this,"onDisposed",new te),x(this,"onRequestFile",new te),x(this,"ifcToExport",null),x(this,"onElementToPset",new te),x(this,"onPropToPset",new te),x(this,"onPsetRemoved",new te),x(this,"onDataChanged",new te),x(this,"wasm",{path:"/",absolute:!1}),x(this,"enabled",!0),x(this,"attributeListeners",{}),x(this,"selectedModel"),x(this,"changeMap",{}),this.components.add(Zn.uuid,this)}dispose(){this.selectedModel=void 0,this.attributeListeners={},this.changeMap={},this.onElementToPset.reset(),this.onPropToPset.reset(),this.onPsetRemoved.reset(),this.onDataChanged.reset(),this.onDisposed.trigger(Zn.uuid),this.onDisposed.reset()}static getIFCSchema(e){const t=e.ifcMetadata.schema;if(!t)throw new Error("IFC Schema not found");return t.startsWith("IFC2X3")?"IFC2X3":t.startsWith("IFC4")&&t.replace("IFC4","")===""?"IFC4":t.startsWith("IFC4X3")?"IFC4X3":t}async setData(e,...t){for(const s of t){const i=s.expressID;i&&(await e.setProperties(i,s),this.registerChange(e,i))}}async newPset(e,t,s){const i=Zn.getIFCSchema(e),{ownerHistoryHandle:n}=await this.getOwnerHistory(e),r=this.newGUID(e),o=new St[i].IfcLabel(t),a=s?new St[i].IfcText(s):null,l=new St[i].IfcPropertySet(r,n,o,a,[]);l.expressID=this.increaseMaxID(e);const c=this.newGUID(e),p=new St[i].IfcRelDefinesByProperties(c,n,null,null,[],new Oi(l.expressID));return p.expressID=this.increaseMaxID(e),await this.setData(e,l,p),{pset:l,rel:p}}async removePset(e,...t){for(const s of t){const i=await e.getProperties(s);if((i==null?void 0:i.type)!==tr)continue;const n=await Mi.getPsetRel(e,s);if(n&&(await e.setProperties(n,null),this.registerChange(e,n)),i){for(const r of i.HasProperties)await e.setProperties(r.value,null);await e.setProperties(s,null),this.onPsetRemoved.trigger({model:e,psetID:s}),this.registerChange(e,s)}}}newSingleStringProperty(e,t,s,i){return this.newSingleProperty(e,t,s,i)}newSingleNumericProperty(e,t,s,i){return this.newSingleProperty(e,t,s,i)}newSingleBooleanProperty(e,t,s,i){return this.newSingleProperty(e,t,s,i)}async removePsetProp(e,t,s){const i=await e.getProperties(t),n=await e.getProperties(s);!i||!n||i.type===tr&&n&&(i.HasProperties=i.HasProperties.filter(r=>r.value!==s),await e.setProperties(s,null),this.registerChange(e,t,s))}async addElementToPset(e,t,...s){const i=await Mi.getPsetRel(e,t);if(!i)return;const n=await e.getProperties(i);if(!n)return;for(const o of s){const a=new Oi(o);n.RelatedObjects.push(a),this.onElementToPset.trigger({model:e,psetID:t,elementID:o})}this.registerChange(e,t);const r=this.components.get(Eo);for(const o of s)r.addEntityRelations(e,o,"IsDefinedBy",t)}async addPropToPset(e,t,...s){const i=await e.getProperties(t);if(i){for(const n of s){if(i.HasProperties.includes(n))continue;const r=new Oi(n);i.HasProperties.push(r),this.onPropToPset.trigger({model:e,psetID:t,propID:n})}this.registerChange(e,t)}}async saveToIfc(e,t){const s=this.components.get(cC),i=s.webIfc,n=await s.readIfcFile(t),r=this.changeMap[e.uuid]??[];for(const a of r){const l=await e.getProperties(a);if(l)try{i.WriteLine(n,l)}catch{}else try{i.DeleteLine(n,a)}catch{}}const o=i.SaveModel(n);return s.webIfc.CloseModel(n),s.cleanUp(),o}async setAttributeListener(e,t,s){this.attributeListeners[e.uuid]||(this.attributeListeners[e.uuid]={});const i=this.attributeListeners[e.uuid][t]?this.attributeListeners[e.uuid][t][s]:null;if(i)return i;const n=await e.getProperties(t);if(!n)throw new Error(`Entity with expressID ${t} doesn't exists.`);const r=n[s];if(Array.isArray(r)||!r)throw new Error(`Attribute ${s} is array or null, and it can't have a listener.`);const o=r.value;if(o===void 0||o==null)throw new Error(`Attribute ${s} has a badly defined handle.`);const a=new te;return Object.defineProperty(n[s],"value",{get(){return this._value},async set(l){this._value=l,a.trigger(l)}}),n[s].value=o,this.attributeListeners[e.uuid][t]||(this.attributeListeners[e.uuid][t]={}),this.attributeListeners[e.uuid][t][s]=a,a}increaseMaxID(e){return e.ifcMetadata.maxExpressID++,e.ifcMetadata.maxExpressID}newGUID(e){const t=Zn.getIFCSchema(e);return new St[t].IfcGloballyUniqueId(dd.create())}async getOwnerHistory(e){const t=await e.getAllPropertiesOfType(Np);if(!t)throw new Error("No OwnerHistory was found.");const s=Object.keys(t).map(r=>parseInt(r,10)),i=t[s[0]],n=new Oi(i.expressID);return{ownerHistory:i,ownerHistoryHandle:n}}registerChange(e,...t){this.changeMap[e.uuid]||(this.changeMap[e.uuid]=new Set);for(const s of t)this.changeMap[e.uuid].add(s),this.onDataChanged.trigger({model:e,expressID:s})}async newSingleProperty(e,t,s,i){const n=Zn.getIFCSchema(e),r=new St[n].IfcIdentifier(s),o=new St[n][t](i),a=new St[n].IfcPropertySingleValue(r,null,o,null);return a.expressID=this.increaseMaxID(e),await this.setData(e,a),a}};x(dC,"uuid","58c2d9f0-183c-48d6-a402-dfcf5b9a34df");const Em=class gm extends De{constructor(e){super(e),x(this,"enabled",!0),x(this,"list",{}),x(this,"onDisposed",new te),x(this,"onFragmentsDisposed",t=>{const{groupID:s,fragmentIDs:i}=t;for(const n in this.list){const r=this.list[n],o=Object.keys(r);if(o.includes(s))delete r[s],Object.values(r).length===0&&delete this.list[n];else for(const a of o){const l=r[a];for(const c of i)delete l.map[c];Object.values(l).length===0&&delete r[a]}}}),e.add(gm.uuid,this),e.get(Qe).onFragmentsDisposed.add(this.onFragmentsDisposed)}dispose(){this.list={},this.components.get(Qe).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(),this.onDisposed.reset()}remove(e){for(const t in this.list){const s=this.list[t];for(const i in s){const n=s[i];delete n.map[e]}}}find(e){const t=this.components.get(Qe);if(!e){const r={};for(const[o,a]of t.list)r[o]=new Set(a.ids);return r}const s=Object.keys(e).length,i={};for(const r in e){const o=e[r];if(!this.list[r]){console.warn(`Classification ${r} does not exist.`);continue}for(const a of o){const l=this.list[r][a];if(l)for(const c in l.map){i[c]||(i[c]=new Map);for(const p of l.map[c]){const u=i[c].get(p);u===void 0?i[c].set(p,1):i[c].set(p,u+1)}}}}const n={};for(const r in i){const o=i[r];for(const[a,l]of o){if(l===void 0)throw new Error("Malformed fragments map!");l===s&&(n[r]||(n[r]=new Set),n[r].add(a))}}return n}byModel(e,t){this.list.models||(this.list.models={});const s=this.list.models;s[e]||(s[e]={map:{},id:null,name:e});const i=s[e];for(const[n,r]of t.data){const o=r[0];for(const a of o){const l=t.keyFragments.get(a);l&&(i.map[l]||(i.map[l]=new Set),i.map[l].add(n))}}}async byPredefinedType(e){var t;this.list.predefinedTypes||(this.list.predefinedTypes={});const s=this.list.predefinedTypes,i=e.getAllPropertiesIDs();for(const n of i){const r=await e.getProperties(n);if(!r)continue;const o=String((t=r.PredefinedType)==null?void 0:t.value).toUpperCase();s[o]||(s[o]={map:{},id:null,name:o});const a=s[o];for(const[l,c]of e.data){const p=c[0];for(const u of p){const m=e.keyFragments.get(u);if(!m)throw new Error("Fragment ID not found!");a.map[m]||(a.map[m]=new Set),a.map[m].add(r.expressID)}}}}byEntity(e){this.list.entities||(this.list.entities={});for(const[t,s]of e.data){const i=s[1][1],n=cm[i];this.saveItem(e,"entities",n,t)}}async byIfcRel(e,t,s){Mi.isRel(t)&&await Mi.getRelationMap(e,t,async(i,n)=>{const{name:r}=await Mi.getEntityName(e,i);for(const o of n)this.saveItem(e,s,r??"NO REL NAME",o)})}async bySpatialStructure(e,t={}){var s,i;const n=this.components.get(Eo),r=n.relationMaps[e.uuid];if(!r)throw new Error(`Classifier: model relations of ${e.name||e.uuid} have to exists to group by spatial structure.`);const o="spatialStructures",a=t.useProperties===void 0||t.useProperties;for(const[l]of r){if(t.isolate){const m=e.data.get(l);if(!m)continue;const E=m[1][1];if(E===void 0||!t.isolate.has(E))continue}const c=n.getEntityRelations(e,l,"Decomposes");if(c)for(const m of c){let E=m.toString();if(a){const g=await e.getProperties(m);if(!g)continue;E=(s=g.Name)==null?void 0:s.value}this.saveItem(e,o,E,l,m)}const p=n.getEntityRelations(e,l,"ContainsElements");if(!p)continue;let u=l.toString();if(a){const m=await e.getProperties(l);if(!m)continue;u=(i=m.Name)==null?void 0:i.value}for(const m of p){this.saveItem(e,o,u,m,l);const E=n.getEntityRelations(e,Number(m),"IsDecomposedBy");if(E)for(const g of E)this.saveItem(e,o,u,g,l)}}}setColor(e,t,s=!1){const i=this.components.get(Qe);for(const n in e){const r=i.list.get(n);if(!r)continue;const o=e[n];r.setColor(t,o,s)}}resetColor(e){const t=this.components.get(Qe);for(const s in e){const i=t.list.get(s);if(!i)continue;const n=e[s];i.resetColor(n)}}saveItem(e,t,s,i,n=null){this.list[t]||(this.list[t]={});const r=e.data.get(i);if(r)for(const o of r[0]){const a=e.keyFragments.get(o);if(a){const l=this.list[t];l[s]||(l[s]={map:{},id:n,name:s}),l[s].map[a]||(l[s].map[a]=new Set),l[s].map[a].add(i)}}}};x(Em,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");let uC=Em;const pC=class Im extends De{constructor(e){super(e),x(this,"onDisposed",new te),x(this,"enabled",!0),x(this,"height",10),x(this,"groupName","spatialStructures"),x(this,"list",new Set),e.add(Im.uuid,this)}dispose(){this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}set(e){if(!this.enabled)return;const t=this.components.get(uC),s=this.components.get(Qe),i=e?1:-1;let n=0;const r=t.list[this.groupName],o=new de;for(const a in r){o.elements[13]=n*i*this.height;for(const l in r[a].map){const c=s.list.get(l),p=a+l,u=this.list.has(p);if(!c||e&&u||!e&&!u)continue;e?this.list.add(p):this.list.delete(p);const m=r[a].map[l];c.applyTransform(m,o),c.mesh.computeBoundingSphere(),c.mesh.computeBoundingBox()}n++}}};x(pC,"uuid","d260618b-ce88-4c7d-826c-6debb91de3e2");const fC=class Cm extends De{constructor(e){super(e),x(this,"enabled",!0),this.components.add(Cm.uuid,this)}set(e,t){const s=this.components.get(Qe);if(!t){for(const[i,n]of s.list)n&&(n.setVisibility(e),this.updateCulledVisibility(n));return}for(const i in t){const n=t[i],r=s.list.get(i);r&&(r.setVisibility(e,n),this.updateCulledVisibility(r))}}isolate(e){this.set(!1),this.set(!0,e)}updateCulledVisibility(e){const t=this.components.get(X1);for(const[s,i]of t.list){const n=i.colorMeshes.get(e.id);n&&(n.count=e.mesh.count)}}};x(fC,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");class mC extends ud{constructor(){super(...arguments),x(this,"minGeometrySize",10),x(this,"minAssetsSize",1e3)}}const EC=class Tm extends De{constructor(e){super(e),x(this,"onGeometryStreamed",new te),x(this,"onAssetStreamed",new te),x(this,"onProgress",new te),x(this,"onIfcLoaded",new te),x(this,"onDisposed",new te),x(this,"settings",new mC),x(this,"enabled",!0),x(this,"webIfc",new gs),x(this,"_spatialTree",new dm),x(this,"_metaData",new pm),x(this,"_visitedGeometries",new Map),x(this,"_streamSerializer",new jc),x(this,"_geometries",new Map),x(this,"_geometryCount",0),x(this,"_civil",new um),x(this,"_groupSerializer",new Cl),x(this,"_assets",[]),x(this,"_meshesWithHoles",new Set),this.components.add(Tm.uuid,this),this.settings.excludedCategories.add(Tl)}dispose(){this.onIfcLoaded.reset(),this.onGeometryStreamed.reset(),this.onAssetStreamed.reset(),this.webIfc=null,this.onDisposed.trigger(),this.onDisposed.reset()}async streamFromBuffer(e){await this.readIfcFile(e),await this.streamAllGeometries(),this.cleanUp()}async streamFromCallBack(e){await this.streamIfcFile(e),await this.streamAllGeometries(),this.cleanUp()}async readIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(e,this.settings.webIfc)}async streamIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)}async streamAllGeometries(){const{minGeometrySize:e,minAssetsSize:t}=this.settings;this._spatialTree.setUp(this.webIfc);const s=this.webIfc.GetIfcEntityList(0),i=[[]],n=new yl;n.ifcMetadata={name:"",description:"",...this._metaData.getNameInfo(this.webIfc),...this._metaData.getDescriptionInfo(this.webIfc),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};let r=0,o=0;for(const E of s){if(!this.webIfc.IsIfcElement(E)&&E!==Qt||this.settings.excludedCategories.has(E))continue;const g=this.webIfc.GetLineIDsWithType(0,E),T=g.size();for(let y=0;y<T;y++){r>e&&(r=0,o++,i.push([]));const v=g.get(y);i[o].push(v);const A=this.webIfc.GetLine(0,v);if(A.GlobalId){const F=(A==null?void 0:A.GlobalId.value)||(A==null?void 0:A.GlobalId);n.globalToExpressIDs.set(F,v)}const C=this._spatialTree.itemsByFloor[v]||0;n.data.set(v,[[],[C,E]]),r++}}this._spatialTree.cleanUp();let a=.01,l=0;for(const E of i){l++,this.webIfc.StreamMeshes(0,E,T=>{this.getMesh(this.webIfc,T,n)}),this._geometryCount>e&&await this.streamGeometries(),this._assets.length>t&&await this.streamAssets();const g=l/i.length;g>a&&(a+=.01,a=Math.max(a,g),this.onProgress.trigger(Math.round(a*100)/100))}this._geometryCount&&await this.streamGeometries(),this._assets.length&&await this.streamAssets();const{opaque:c,transparent:p}=n.geometryIDs;for(const[E,{index:g,uuid:T}]of this._visitedGeometries)n.keyFragments.set(g,T),(E>1?c:p).set(E,g);fm.get(n,this.webIfc);const u=this.webIfc.GetCoordinationMatrix(0);n.coordinationMatrix.fromArray(u),n.civilData=this._civil.read(this.webIfc);const m=this._groupSerializer.export(n);this.onIfcLoaded.trigger(m),n.dispose(!0)}cleanUp(){try{this.webIfc.Dispose()}catch{}this.webIfc=null,this.webIfc=new gs,this._visitedGeometries.clear(),this._geometries.clear(),this._assets=[],this._meshesWithHoles.clear()}getMesh(e,t,s){const i=t.geometries.size(),n=t.expressID,r={id:n,geometries:[]};for(let o=0;o<i;o++){const a=t.geometries.get(o),l=a.geometryExpressID,c=a.color.w===1?1:-1,p=l*c;if(!this._visitedGeometries.has(p)){this._visitedGeometries.has(l)||this.getGeometry(e,l);const C=this._visitedGeometries.size,F=ln.generateUUID();this._visitedGeometries.set(p,{uuid:F,index:C})}const u=this._visitedGeometries.get(p);if(u===void 0)throw new Error("Error getting geometry data for streaming!");const m=s.data.get(n);if(!m)throw new Error("Data not found!");m[0].push(u.index);const{x:E,y:g,z:T,w:y}=a.color,v=[E,g,T,y],A=a.flatTransformation;r.geometries.push({color:v,geometryID:l,transformation:A})}this._assets.push(r)}getGeometry(e,t){const s=e.GetGeometry(0,t),i=e.GetIndexArray(s.GetIndexData(),s.GetIndexDataSize()),n=e.GetVertexArray(s.GetVertexData(),s.GetVertexDataSize()),r=new Float32Array(n.length/2),o=new Float32Array(n.length/2);for(let u=0;u<n.length;u+=6)r[u/2]=n[u],r[u/2+1]=n[u+1],r[u/2+2]=n[u+2],o[u/2]=n[u+3],o[u/2+1]=n[u+4],o[u/2+2]=n[u+5];const a=x1(r),l=new Float32Array(a.transformation.elements),c=[a.center.x,a.center.y,a.center.z];let p=!1;for(let u=0;u<r.length-2;u+=3){const m=r[u],E=r[u+1],g=r[u+2],T=o[u],y=o[u+1],v=o[u+2];if(M1(c,[m,E,g],[T,y,v])){p=!0;break}}this._geometries.set(t,{position:r,normal:o,index:i,boundingBox:l,hasHoles:p}),s.delete(),this._geometryCount++}async streamAssets(){await this.onAssetStreamed.trigger(this._assets),this._assets=null,this._assets=[]}async streamGeometries(){let e=this._streamSerializer.export(this._geometries),t={};for(const[s,{boundingBox:i,hasHoles:n}]of this._geometries)t[s]={boundingBox:i,hasHoles:n};this.onGeometryStreamed.trigger({data:t,buffer:e}),t=null,e=null,this._geometries.clear(),this._geometryCount=0}};x(EC,"uuid","d9999a00-e1f5-4d3f-8cfe-c56e08609764");class gC extends ud{constructor(){super(...arguments),x(this,"propertiesSize",100)}}class IC extends De{constructor(){super(...arguments),x(this,"onPropertiesStreamed",new ao),x(this,"onProgress",new ao),x(this,"onIndicesStreamed",new ao),x(this,"onDisposed",new te),x(this,"enabled",!0),x(this,"settings",new gC),x(this,"webIfc",new gs)}async dispose(){this.onIndicesStreamed.reset(),this.onPropertiesStreamed.reset(),this.webIfc=null,this.onDisposed.reset()}async streamFromBuffer(e){await this.readIfcFile(e),await this.streamAllProperties(),this.cleanUp()}async streamFromCallBack(e){await this.streamIfcFile(e),await this.streamAllProperties(),this.cleanUp()}async readIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(e,this.settings.webIfc)}async streamIfcFile(e){const{path:t,absolute:s,logLevel:i}=this.settings.wasm;this.webIfc.SetWasmPath(t,s),await this.webIfc.Init(),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)}async streamAllProperties(){const{propertiesSize:e}=this.settings,t=new Set(this.webIfc.GetIfcEntityList(0)),s=new Set([or,ar,lr,cn,Qt]);for(const o of s)t.add(o);let i=.01,n=0;for(const o of t){if(n++,am.has(o))continue;const a=s.has(o),l=this.webIfc.GetLineIDsWithType(0,o),c=l.size();let p=0;for(let u=0;u<c-e;u+=e){const m={};for(let E=0;E<e;E++){p++;const g=l.get(u+E);try{const T=this.webIfc.GetLine(0,g,a);m[T.expressID]=T}catch{console.log(`Could not get property: ${g}`)}}await this.onPropertiesStreamed.trigger({type:o,data:m})}if(p!==c){const u={};for(let m=p;m<c;m++){const E=l.get(m);try{const g=this.webIfc.GetLine(0,E,a);u[g.expressID]=g}catch{console.log(`Could not get property: ${E}`)}}await this.onPropertiesStreamed.trigger({type:o,data:u})}n/t.size>i&&(i=Math.round(i*100)/100,await this.onProgress.trigger(i),i+=.01)}await this.onProgress.trigger(1);const r=await this.components.get(Eo).processFromWebIfc(this.webIfc,0);await this.onIndicesStreamed.trigger(r)}cleanUp(){this.webIfc.Dispose(),this.webIfc=null,this.webIfc=new gs}}x(IC,"uuid","88d2c89c-ce32-47d7-8cb6-d51e4b311a0b");const ym=class wm extends De{constructor(e){super(e),x(this,"enabled",!0),e.add(wm.uuid,this)}static distanceFromPointToLine(e,t,s,i=!1){const n=new at,r=new O;return n.set(t,s),n.closestPointToPoint(e,i,r),r.distanceTo(e)}getFace(e,t,s){if(!e.geometry.index)throw new Error("Geometry must be indexed!");const i=new Map,n=e.geometry.index.array,{plane:r}=this.getFaceData(t,s,e),o=[];for(let p=0;p<n.length/3;p++){const{plane:u,edges:m}=this.getFaceData(p,s,e);if(u.equals(r)){o.push({index:p,edges:m});for(const{id:E,points:g,distance:T}of m)i.set(E,{points:g,distance:T})}}let a=0;const l=new Map,c=new Map;for(const{index:p,edges:u}of o){const m=new Map;for(const{id:C}of u)if(l.has(C)){const F=l.get(C);m.set(C,F)}const E=u.map(C=>C.id);if(!m.size){const C=a++;for(const{id:F}of u)l.set(F,C);c.set(C,{edges:new Set(E),indices:new Set([p])});continue}let g=null;const T=new Set,y=new Set(E);for(const[C,F]of m){g===null?g=F:F!==g&&T.add(F),l.delete(C);const{edges:M}=c.get(F);M.delete(C),y.delete(C)}if(g===null)throw new Error("Error computing face!");const v=c.get(g),{indices:A}=v;A.add(p);for(const C of y){l.set(C,g);const{edges:F}=v;F.add(C)}for(const C of T){const F=c.get(C),{edges:M,indices:_}=F,L=c.get(g),{edges:D,indices:B}=L;for(const z of M)D.add(z),l.set(z,g);for(const z of _)B.add(z);c.delete(C)}}for(const[p,{indices:u,edges:m}]of c)if(u.has(t)){const E=[];for(const g of m){const T=i.get(g);E.push(T)}return{edges:E,indices:u}}return null}getVerticesAndNormal(e,t,s){if(!e.geometry.index)throw new Error("Geometry must be indexed!");const i=e.geometry.index.array,n=e.geometry.attributes.position.array,r=e.geometry.attributes.normal.array,o=i[t*3]*3,a=i[t*3+1]*3,l=i[t*3+2]*3,c=new O(n[o],n[o+1],n[o+2]),p=new O(n[a],n[a+1],n[a+2]),u=new O(n[l],n[l+1],n[l+2]),m=new O(r[o],r[o+1],r[o+2]),E=new O(r[a],r[a+1],r[a+2]),g=new O(r[l],r[l+1],r[l+2]),T=(m.x+E.x+g.x)/3,y=(m.y+E.y+g.y)/3,v=(m.z+E.z+g.z)/3,A=new O(T,y,v);if(s!==void 0&&e instanceof Ot){const C=new de;e.getMatrixAt(s,C);const F=new de;F.extractRotation(C),A.applyMatrix4(F),c.applyMatrix4(C),p.applyMatrix4(C),u.applyMatrix4(C)}return{p1:c,p2:p,p3:u,faceNormal:A}}round(e){e.x=Math.trunc(e.x*1e3)/1e3,e.y=Math.trunc(e.y*1e3)/1e3,e.z=Math.trunc(e.z*1e3)/1e3}getVolumeFromFragments(e){const t=this.components.get(Qe),s=new de,i=[];for(const r in e){const o=t.list.get(r);if(!o)continue;const a=e[r];let l=0;for(const u of a){const m=o.getInstancesIDs(u);m&&(l+=m.size)}const c=new Ot(o.mesh.geometry,void 0,l);let p=0;for(const u of a){const m=o.getInstancesIDs(u);if(m)for(const E of m)o.mesh.getMatrixAt(E,s),c.setMatrixAt(p++,s)}i.push(c)}const n=this.getVolumeFromMeshes(i);for(const r of i)r.geometry=null,r.material=[],r.dispose();return n}getVolumeFromMeshes(e){let t=0;for(const s of e)t+=this.getVolumeOfMesh(s);return t}getFaceData(e,t,s){const i=this.getVerticesAndNormal(s,e,t),{p1:n,p2:r,p3:o,faceNormal:a}=i;this.round(n),this.round(r),this.round(o),this.round(a);const l=[{id:`${n.x}|${n.y}|${n.z}`,value:n},{id:`${r.x}|${r.y}|${r.z}`,value:r},{id:`${o.x}|${o.y}|${o.z}`,value:o}];l.sort((v,A)=>v.id<A.id?-1:v.id>A.id?1:0);const[{id:c,value:p},{id:u,value:m},{id:E,value:g}]=l,T=[{id:`${c}|${u}`,distance:p.distanceTo(m),points:[p,m]},{id:`${u}|${E}`,distance:m.distanceTo(g),points:[m,g]},{id:`${c}|${E}`,distance:p.distanceTo(g),points:[p,g]}],y=new jt;return y.setFromNormalAndCoplanarPoint(a,n),y.constant=Math.round(y.constant*10)/10,{plane:y,edges:T}}getVolumeOfMesh(e){let t=0;const s=new O,i=new O,n=new O,{index:r}=e.geometry,o=e.geometry.attributes.position.array;if(!r)return console.warn("Geometry must be indexed to compute its volume!"),0;const a=[];if(e instanceof Ot)for(let c=0;c<e.count;c++){const p=new de;e.getMatrixAt(c,p),a.push(p)}else a.push(new de().identity());const{matrixWorld:l}=e;for(let c=0;c<r.array.length-2;c+=3)for(const p of a){const u=p.multiply(l),m=r.array[c]*3,E=r.array[c+1]*3,g=r.array[c+2]*3;s.set(o[m],o[m+1],o[m+2]).applyMatrix4(u),i.set(o[E],o[E+1],o[E+2]).applyMatrix4(u),n.set(o[g],o[g+1],o[g+2]).applyMatrix4(u),t+=this.getSignedVolumeOfTriangle(s,i,n)}return Math.abs(t)}getSignedVolumeOfTriangle(e,t,s){const i=s.x*t.y*e.z,n=t.x*s.y*e.z,r=s.x*e.y*t.z,o=e.x*s.y*t.z,a=t.x*e.y*s.z,l=e.x*t.y*s.z;return 1/6*(-i+n+r-o-a+l)}};x(ym,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");let sn=ym;const Cp=new Me,Ua=new O;class vm extends s0{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],s=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(s),this.setAttribute("position",new Li(e,3)),this.setAttribute("uv",new Li(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,s=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),s.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const s=new sc(t,6,1);return this.setAttribute("instanceStart",new Qn(s,3,0)),this.setAttribute("instanceEnd",new Qn(s,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const s=new sc(t,6,1);return this.setAttribute("instanceColorStart",new Qn(s,3,0)),this.setAttribute("instanceColorEnd",new Qn(s,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new i0(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Me);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),Cp.setFromBufferAttribute(t),this.boundingBox.union(Cp))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Zs),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const s=this.boundingSphere.center;this.boundingBox.getCenter(s);let i=0;for(let n=0,r=e.count;n<r;n++)Ua.fromBufferAttribute(e,n),i=Math.max(i,s.distanceToSquared(Ua)),Ua.fromBufferAttribute(t,n),i=Math.max(i,s.distanceToSquared(Ua));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}Ha.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Ue(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};Wa.line={uniforms:qc.merge([Ha.common,Ha.fog,Ha.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class go extends Mt{constructor(e){super({type:"LineMaterial",uniforms:qc.clone(Wa.line.uniforms),vertexShader:Wa.line.vertexShader,fragmentShader:Wa.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}}const Tp=new O,yp=new O,Pt=new an,bt=new an,zs=new an,ec=new O,tc=new de,xt=new at,wp=new O,Ba=new Me,za=new Zs,Ys=new an;let Hs,nn;function vp(h,e,t){return Ys.set(0,0,-e,1).applyMatrix4(h.projectionMatrix),Ys.multiplyScalar(1/Ys.w),Ys.x=nn/t.width,Ys.y=nn/t.height,Ys.applyMatrix4(h.projectionMatrixInverse),Ys.multiplyScalar(1/Ys.w),Math.abs(Math.max(Ys.x,Ys.y))}function CC(h,e){const t=h.matrixWorld,s=h.geometry,i=s.attributes.instanceStart,n=s.attributes.instanceEnd,r=Math.min(s.instanceCount,i.count);for(let o=0,a=r;o<a;o++){xt.start.fromBufferAttribute(i,o),xt.end.fromBufferAttribute(n,o),xt.applyMatrix4(t);const l=new O,c=new O;Hs.distanceSqToSegment(xt.start,xt.end,c,l),c.distanceTo(l)<nn*.5&&e.push({point:c,pointOnLine:l,distance:Hs.origin.distanceTo(c),object:h,face:null,faceIndex:o,uv:null,uv1:null})}}function TC(h,e,t){const s=e.projectionMatrix,i=h.material.resolution,n=h.matrixWorld,r=h.geometry,o=r.attributes.instanceStart,a=r.attributes.instanceEnd,l=Math.min(r.instanceCount,o.count),c=-e.near;Hs.at(1,zs),zs.w=1,zs.applyMatrix4(e.matrixWorldInverse),zs.applyMatrix4(s),zs.multiplyScalar(1/zs.w),zs.x*=i.x/2,zs.y*=i.y/2,zs.z=0,ec.copy(zs),tc.multiplyMatrices(e.matrixWorldInverse,n);for(let p=0,u=l;p<u;p++){if(Pt.fromBufferAttribute(o,p),bt.fromBufferAttribute(a,p),Pt.w=1,bt.w=1,Pt.applyMatrix4(tc),bt.applyMatrix4(tc),Pt.z>c&&bt.z>c)continue;if(Pt.z>c){const y=Pt.z-bt.z,v=(Pt.z-c)/y;Pt.lerp(bt,v)}else if(bt.z>c){const y=bt.z-Pt.z,v=(bt.z-c)/y;bt.lerp(Pt,v)}Pt.applyMatrix4(s),bt.applyMatrix4(s),Pt.multiplyScalar(1/Pt.w),bt.multiplyScalar(1/bt.w),Pt.x*=i.x/2,Pt.y*=i.y/2,bt.x*=i.x/2,bt.y*=i.y/2,xt.start.copy(Pt),xt.start.z=0,xt.end.copy(bt),xt.end.z=0;const m=xt.closestPointToPointParameter(ec,!0);xt.at(m,wp);const E=ln.lerp(Pt.z,bt.z,m),g=E>=-1&&E<=1,T=ec.distanceTo(wp)<nn*.5;if(g&&T){xt.start.fromBufferAttribute(o,p),xt.end.fromBufferAttribute(a,p),xt.start.applyMatrix4(n),xt.end.applyMatrix4(n);const y=new O,v=new O;Hs.distanceSqToSegment(xt.start,xt.end,v,y),t.push({point:v,pointOnLine:y,distance:Hs.origin.distanceTo(v),object:h,face:null,faceIndex:p,uv:null,uv1:null})}}}class yC extends J{constructor(e=new vm,t=new go({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,s=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let r=0,o=0,a=t.count;r<a;r++,o+=2)Tp.fromBufferAttribute(t,r),yp.fromBufferAttribute(s,r),i[o]=o===0?0:i[o-1],i[o+1]=i[o]+Tp.distanceTo(yp);const n=new sc(i,2,1);return e.setAttribute("instanceDistanceStart",new Qn(n,1,0)),e.setAttribute("instanceDistanceEnd",new Qn(n,1,1)),this}raycast(e,t){const s=this.material.worldUnits,i=e.camera;i===null&&!s&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const n=e.params.Line2!==void 0&&e.params.Line2.threshold||0;Hs=e.ray;const r=this.matrixWorld,o=this.geometry,a=this.material;nn=a.linewidth+n,o.boundingSphere===null&&o.computeBoundingSphere(),za.copy(o.boundingSphere).applyMatrix4(r);let l;if(s)l=nn*.5;else{const p=Math.max(i.near,za.distanceToPoint(Hs.origin));l=vp(i,p,a.resolution)}if(za.radius+=l,Hs.intersectsSphere(za)===!1)return;o.boundingBox===null&&o.computeBoundingBox(),Ba.copy(o.boundingBox).applyMatrix4(r);let c;if(s)c=nn*.5;else{const p=Math.max(i.near,Ba.distanceToPoint(Hs.origin));c=vp(i,p,a.resolution)}Ba.expandByScalar(c),Hs.intersectsBox(Ba)!==!1&&(s?CC(this,t):TC(this,i,t))}}class ol extends vm{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,s=new Float32Array(2*t);for(let i=0;i<t;i+=3)s[2*i]=e[i],s[2*i+1]=e[i+1],s[2*i+2]=e[i+2],s[2*i+3]=e[i+3],s[2*i+4]=e[i+4],s[2*i+5]=e[i+5];return super.setPositions(s),this}setColors(e){const t=e.length-3,s=new Float32Array(2*t);for(let i=0;i<t;i+=3)s[2*i]=e[i],s[2*i+1]=e[i+1],s[2*i+2]=e[i+2],s[2*i+3]=e[i+3],s[2*i+4]=e[i+4],s[2*i+5]=e[i+5];return super.setColors(s),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class Rm extends yC{constructor(e=new ol,t=new go({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}const Fm=class Am{constructor(e,t){S(this,"scene"),S(this,"onSelect",new te),S(this,"type"),S(this,"selectCurve"),S(this,"selectPoints"),S(this,"hoverCurve"),S(this,"hoverPoints"),S(this,"caster",new on),this.scene=e,this.type=t,this.hoverCurve=this.newCurve(.003,4473924,!1),this.hoverPoints=this.newPoints(5,4473924),this.selectCurve=this.newCurve(.005,16777215,!0),this.selectPoints=this.newPoints(7,16777215)}dispose(){this.selectCurve&&this.scene.remove(this.selectCurve),this.selectCurve.material.dispose(),this.selectCurve.geometry.dispose(),this.selectCurve=null,this.hoverCurve.material.dispose(),this.hoverCurve.geometry.dispose(),this.hoverCurve=null,this.hoverPoints.material.dispose(),this.hoverPoints.geometry.dispose(),this.selectPoints.material.dispose(),this.selectPoints.geometry.dispose(),this.scene=null}castRay(e,t,s,i){const n=new Ue,r=s.getBoundingClientRect();n.x=(e.clientX-r.left)/r.width*2-1,n.y=-((e.clientY-r.top)/r.height)*2+1,this.caster.setFromCamera(n,t);const o=this.caster.intersectObjects(i);return o.length?o[0]:null}select(e){this.highlight(e,this.selectCurve,this.selectPoints,!0),this.onSelect.trigger(e)}unSelect(){this.selectCurve.removeFromParent(),this.selectPoints.removeFromParent()}hover(e){this.highlight(e,this.hoverCurve,this.hoverPoints,!1)}unHover(){this.hoverCurve.removeFromParent(),this.hoverPoints.removeFromParent()}setResolution({x:e,y:t}){this.selectCurve.material.resolution.set(e/t,1),this.hoverCurve.material.resolution.set(e/t,1)}highlight(e,t,s,i){const{alignment:n}=e.curve;this.scene.add(t),this.scene.add(s);const r=[],o=[],a=[];for(const u of n[this.type]){const m=u.mesh.geometry.attributes.position;for(const y of m.array)r.push(y);if(i){let y;if(this.type==="absolute"){const{horizontal:A}=u.alignment;y=A[u.index].data.TYPE}else y=u.data.TYPE;const v=Am.settings.colors[y]||[1,1,1];for(let A=0;A<m.count;A++)o.push(...v)}const[E,g,T]=m.array;a.push(new O(E,g,T))}const l=r[r.length-3],c=r[r.length-2],p=r[r.length-1];a.push(new O(l,c,p)),r.length/3>t.geometry.attributes.position.count&&(t.geometry.dispose(),t.geometry=new ol),t.geometry.setPositions(r),i&&t.geometry.setColors(o),s.geometry.setFromPoints(a)}newCurve(e,t,s){const i=new ol,n=new go({color:t,linewidth:e,vertexColors:s,worldUnits:!1,depthTest:!1}),r=new Rm(i,n);return this.scene.add(r),r}newPoints(e,t){const s=new ze,i=new Ct(new Float32Array,3);s.setAttribute("position",i);const n=new kE({size:e,color:t,sizeAttenuation:!1,depthTest:!1}),r=new VE(s,n);return r.frustumCulled=!1,this.scene.add(r),r}};S(Fm,"settings",{colors:{LINE:[213/255,0/255,255/255],CIRCULARARC:[0/255,46,255/255],CLOTHOID:[0/255,255/255,0/255],PARABOLICARC:[0/255,255/255,72/255],CONSTANTGRADIENT:[213/255,0/255,255/255]}});let Sm=Fm;class wC extends Xs{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Ue(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const Xn=new O,Rp=new de,Fp=new de,Ap=new O,Sp=new O;class vC{constructor(e={}){const t=this;let s,i,n,r;const o={objects:new WeakMap},a=e.element!==void 0?e.element:document.createElement("div");a.style.overflow="hidden",this.domElement=a,this.getSize=function(){return{width:s,height:i}},this.render=function(m,E){m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),E.parent===null&&E.matrixWorldAutoUpdate===!0&&E.updateMatrixWorld(),Rp.copy(E.matrixWorldInverse),Fp.multiplyMatrices(E.projectionMatrix,Rp),l(m,m,E),u(m)},this.setSize=function(m,E){s=m,i=E,n=s/2,r=i/2,a.style.width=m+"px",a.style.height=E+"px"};function l(m,E,g){if(m.isCSS2DObject){Xn.setFromMatrixPosition(m.matrixWorld),Xn.applyMatrix4(Fp);const T=m.visible===!0&&Xn.z>=-1&&Xn.z<=1&&m.layers.test(g.layers)===!0;if(m.element.style.display=T===!0?"":"none",T===!0){m.onBeforeRender(t,E,g);const v=m.element;v.style.transform="translate("+-100*m.center.x+"%,"+-100*m.center.y+"%)translate("+(Xn.x*n+n)+"px,"+(-Xn.y*r+r)+"px)",v.parentNode!==a&&a.appendChild(v),m.onAfterRender(t,E,g)}const y={distanceToCameraSquared:c(g,m)};o.objects.set(m,y)}for(let T=0,y=m.children.length;T<y;T++)l(m.children[T],E,g)}function c(m,E){return Ap.setFromMatrixPosition(m.matrixWorld),Sp.setFromMatrixPosition(E.matrixWorld),Ap.distanceToSquared(Sp)}function p(m){const E=[];return m.traverse(function(g){g.isCSS2DObject&&E.push(g)}),E}function u(m){const E=p(m).sort(function(T,y){if(T.renderOrder!==y.renderOrder)return y.renderOrder-T.renderOrder;const v=o.objects.get(T).distanceToCameraSquared,A=o.objects.get(y).distanceToCameraSquared;return v-A}),g=E.length;for(let T=0,y=E.length;T<y;T++)E[T].element.style.zIndex=g-T}}}class Zt{constructor(e,t,s){S(this,"three"),S(this,"world"),S(this,"onDisposed",new te),this.world=e;let i;t?i=t:(i=document.createElement("div"),i.style.width="15px",i.style.height="15px",i.style.border="5px solid red"),this.three=new wC(i),(s||e.scene.three).add(this.three),this.visible=!0}set visible(e){this.three.visible=e}get visible(){return this.three.visible}toggleVisibility(){this.visible=!this.visible}dispose(){this.three.removeFromParent(),this.three.element.remove(),this.onDisposed.trigger(),this.onDisposed.reset()}}class RC extends D1{constructor(e,t,s){super(e,t,s),S(this,"three2D",new vC),this.onAfterUpdate.add(()=>{if(this.onBeforeUpdate.trigger(this),!this.enabled||!this.currentWorld)return;const i=this.currentWorld.scene.three,n=this.currentWorld.camera.three;i instanceof js&&this.three2D.render(i,n)}),this.onDisposed.add(()=>{this.three2D.domElement.remove()}),this.onResize.add(({x:i,y:n})=>{this.three2D.setSize(i,n)}),this.setupHtmlRenderer(),this.resize()}setupHtmlRenderer(){this.three2D.domElement.style.position="absolute",this.three2D.domElement.style.top="0px",this.three2D.domElement.style.pointerEvents="none",this.container&&this.container.appendChild(this.three2D.domElement)}}const Om=class Pm extends De{constructor(e){super(e),S(this,"onDisposed",new te),S(this,"enabled",!0),S(this,"threshold",50),S(this,"autoCluster",!0),S(this,"list",new Map),S(this,"clusterLabels",new Set),S(this,"currentKeys",new Set),S(this,"_color","white"),S(this,"_markerKey",0),S(this,"_clusterKey",0),S(this,"_worldEvents",new Map),S(this,"_setupWorlds",new Set),e.add(Pm.uuid,this)}get color(){return this._color}set color(e){this._color=e;for(const[t,s]of this.list)for(const[i,n]of s)n.label.three.element.style.color=e}create(e,t,s,i=!1){this.setupEvents(e,!0);const n=this._markerKey.toString(),r=this.getWorldMarkerList(e);if(r.has(n))return;const o=document.createElement("span");o.innerHTML=t,o.style.color=this._color;const a=new Zt(e,o);return a.three.position.copy(s),r.set(n,{key:n,label:a,merged:!1,static:i}),this._markerKey++,n}delete(e){for(const[t,s]of this.list){const i=s.get(e);i&&i.label.dispose(),s.delete(e)}}getWorldMarkerList(e){return this.list.has(e.uuid)||this.list.set(e.uuid,new Map),this.list.get(e.uuid)}dispose(e){for(const[t,s]of this.list){const i=[...s.keys()];for(const n of i){const r=s.get(n);e&&r.type!==e||(r.label.dispose(),s.delete(n))}}if(!e){this.list.clear(),this._markerKey=0;for(const t of this.clusterLabels)t.label.dispose();this.clusterLabels.clear(),this._clusterKey=0,this.currentKeys.clear()}this.onDisposed.trigger()}setupEvents(e,t){if(t&&this._setupWorlds.has(e.uuid)||!e.camera.hasCameraControls())return;const s=this.getWorldEvent(e);e.camera.controls.removeEventListener("sleep",s),e.camera.controls.removeEventListener("rest",s),t&&(e.camera.controls.addEventListener("sleep",s),e.camera.controls.addEventListener("rest",s))}cluster(e){if(!this.autoCluster)return;this.resetMarkers();const t=this.list.get(e.uuid);if(t){for(const[s,i]of t)if(!i.merged&&!i.static){this.currentKeys.clear();for(const[n,r]of t)r.static||i.key!==r.key&&!r.merged&&this.distance(i.label,r.label)<this.threshold&&(this.currentKeys.add(r.key),r.merged=!0);if(this.currentKeys.size>0){this.currentKeys.add(i.key),i.merged=!0;const n=Array.from(this.currentKeys),r=this.getAveragePositionFromLabels(n),o=new Zt(i.label.world,this.createClusterElement(this._clusterKey.toString())),{element:a}=o.three;a.textContent=n.length.toString(),o.three.position.copy(r),this.clusterLabels.add({key:this._clusterKey.toString(),markerKeys:n,label:o}),this._clusterKey++}}this.removeMergeMarkers(e)}}getWorldEvent(e){if(!this._worldEvents.has(e.uuid)){const t=()=>{this.cluster(e)};this._worldEvents.set(e.uuid,t)}return this._worldEvents.get(e.uuid)}resetMarkers(){for(const[e,t]of this.list)for(const[s,i]of t)i.merged=!1;for(const e of this.clusterLabels)e.label.dispose();this.clusterLabels.clear(),this._clusterKey=0}removeMergeMarkers(e){const t=this.list.get(e.uuid);if(t){for(const[s,i]of t)i.merged?i.label.dispose():i.label.world.scene.three.add(i.label.three);for(const s of this.clusterLabels)if(s.markerKeys.length===1){for(const[i,n]of this.list){const r=n.get(s.markerKeys[0]);r&&(r.label.world.scene.three.add(r.label.three),r.merged=!1)}s.label.dispose(),this.clusterLabels.delete(s)}}}getAveragePositionFromLabels(e){const t=e.map(s=>{for(const[i,n]of this.list){const r=n.get(s);if(r)return r.label.three.position}return new O});return t.reduce((s,i)=>s.add(i),new O).divideScalar(t.length)}createClusterElement(e){const t=document.createElement("div");return t.textContent=e,t.style.color="#000000",t.style.background="#FFFFFF",t.style.fontSize="1.2rem",t.style.fontWeight="500",t.style.pointerEvents="auto",t.style.borderRadius="50%",t.style.padding="5px 11px",t.style.textAlign="center",t.style.cursor="pointer",t.addEventListener("pointerdown",()=>{this.navigateToCluster(e)}),t.addEventListener("pointerover",()=>{t.style.background="#BCF124"}),t.addEventListener("pointerout",()=>{t.style.background="#FFFFFF"}),t}getScreenPosition(e){const t=new O;if(!e.world.renderer)throw new Error("Renderer not found!");const s=e.three.position.clone();s.project(e.world.camera.three);const i=e.world.renderer.getSize();return t.x=s.x*i.x/2+i.x/2,t.y=-(s.y*i.y/2)+i.y/2,t}distance(e,t){const s=this.getScreenPosition(e),i=this.getScreenPosition(t),n=s.x-i.x,r=s.y-i.y,o=Math.sqrt(n*n+r*r)*.5;return o===0?this.threshold+1:o}navigateToCluster(e){const t=[],s=Array.from(this.clusterLabels).find(l=>l.key===e);if(!s)return;const i=s.label.world.camera;if(!i.hasCameraControls()){console.warn("Zoom to clusters only supported with Camera Controls!");return}for(const l of s.markerKeys)for(const[c,p]of this.list){const u=p.get(l);if(u){const{x:m,y:E,z:g}=u.label.three.position;t.push(m,E,g)}}s.label.dispose(),this.clusterLabels.delete(s);const n=new ze,r=new Float32Array(t),o=new Ct(r,3);n.setAttribute("position",o);const a=new J(n);a.geometry.computeBoundingSphere(),a.geometry.boundingSphere&&i.controls.fitToSphere(a,!0),n.dispose(),a.clear(),t.length=0}};S(Om,"uuid","4079eb91-79b0-4ede-bcf2-15b837129236");let Ji=Om;var Op=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bm(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var pd={exports:{}};pd.exports=Ol;pd.exports.default=Ol;function Ol(h,e,t){t=t||2;var s=e&&e.length,i=s?e[0]*t:h.length,n=xm(h,0,i,t,!0),r=[];if(!n||n.next===n.prev)return r;var o,a,l,c,p,u,m;if(s&&(n=PC(h,e,n,t)),h.length>80*t){o=l=h[0],a=c=h[1];for(var E=t;E<i;E+=t)p=h[E],u=h[E+1],p<o&&(o=p),u<a&&(a=u),p>l&&(l=p),u>c&&(c=u);m=Math.max(l-o,c-a),m=m!==0?32767/m:0}return po(n,r,t,o,a,m,0),r}function xm(h,e,t,s,i){var n,r;if(i===Uc(h,e,t,s)>0)for(n=e;n<t;n+=s)r=Pp(n,h[n],h[n+1],r);else for(n=t-s;n>=e;n-=s)r=Pp(n,h[n],h[n+1],r);return r&&Pl(r,r.next)&&(mo(r),r=r.next),r}function rn(h,e){if(!h)return h;e||(e=h);var t=h,s;do if(s=!1,!t.steiner&&(Pl(t,t.next)||dt(t.prev,t,t.next)===0)){if(mo(t),t=e=t.prev,t===t.next)break;s=!0}else t=t.next;while(s||t!==e);return e}function po(h,e,t,s,i,n,r){if(h){!r&&n&&LC(h,s,i,n);for(var o=h,a,l;h.prev!==h.next;){if(a=h.prev,l=h.next,n?AC(h,s,i,n):FC(h)){e.push(a.i/t|0),e.push(h.i/t|0),e.push(l.i/t|0),mo(h),h=l.next,o=l.next;continue}if(h=l,h===o){r?r===1?(h=SC(rn(h),e,t),po(h,e,t,s,i,n,2)):r===2&&OC(h,e,t,s,i,n):po(rn(h),e,t,s,i,n,1);break}}}}function FC(h){var e=h.prev,t=h,s=h.next;if(dt(e,t,s)>=0)return!1;for(var i=e.x,n=t.x,r=s.x,o=e.y,a=t.y,l=s.y,c=i<n?i<r?i:r:n<r?n:r,p=o<a?o<l?o:l:a<l?a:l,u=i>n?i>r?i:r:n>r?n:r,m=o>a?o>l?o:l:a>l?a:l,E=s.next;E!==e;){if(E.x>=c&&E.x<=u&&E.y>=p&&E.y<=m&&$n(i,o,n,a,r,l,E.x,E.y)&&dt(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function AC(h,e,t,s){var i=h.prev,n=h,r=h.next;if(dt(i,n,r)>=0)return!1;for(var o=i.x,a=n.x,l=r.x,c=i.y,p=n.y,u=r.y,m=o<a?o<l?o:l:a<l?a:l,E=c<p?c<u?c:u:p<u?p:u,g=o>a?o>l?o:l:a>l?a:l,T=c>p?c>u?c:u:p>u?p:u,y=Nc(m,E,e,t,s),v=Nc(g,T,e,t,s),A=h.prevZ,C=h.nextZ;A&&A.z>=y&&C&&C.z<=v;){if(A.x>=m&&A.x<=g&&A.y>=E&&A.y<=T&&A!==i&&A!==r&&$n(o,c,a,p,l,u,A.x,A.y)&&dt(A.prev,A,A.next)>=0||(A=A.prevZ,C.x>=m&&C.x<=g&&C.y>=E&&C.y<=T&&C!==i&&C!==r&&$n(o,c,a,p,l,u,C.x,C.y)&&dt(C.prev,C,C.next)>=0))return!1;C=C.nextZ}for(;A&&A.z>=y;){if(A.x>=m&&A.x<=g&&A.y>=E&&A.y<=T&&A!==i&&A!==r&&$n(o,c,a,p,l,u,A.x,A.y)&&dt(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;C&&C.z<=v;){if(C.x>=m&&C.x<=g&&C.y>=E&&C.y<=T&&C!==i&&C!==r&&$n(o,c,a,p,l,u,C.x,C.y)&&dt(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function SC(h,e,t){var s=h;do{var i=s.prev,n=s.next.next;!Pl(i,n)&&Mm(i,s,s.next,n)&&fo(i,n)&&fo(n,i)&&(e.push(i.i/t|0),e.push(s.i/t|0),e.push(n.i/t|0),mo(s),mo(s.next),s=h=n),s=s.next}while(s!==h);return rn(s)}function OC(h,e,t,s,i,n){var r=h;do{for(var o=r.next.next;o!==r.prev;){if(r.i!==o.i&&UC(r,o)){var a=_m(r,o);r=rn(r,r.next),a=rn(a,a.next),po(r,e,t,s,i,n,0),po(a,e,t,s,i,n,0);return}o=o.next}r=r.next}while(r!==h)}function PC(h,e,t,s){var i=[],n,r,o,a,l;for(n=0,r=e.length;n<r;n++)o=e[n]*s,a=n<r-1?e[n+1]*s:h.length,l=xm(h,o,a,s,!1),l===l.next&&(l.steiner=!0),i.push(DC(l));for(i.sort(bC),n=0;n<i.length;n++)t=xC(i[n],t);return t}function bC(h,e){return h.x-e.x}function xC(h,e){var t=MC(h,e);if(!t)return e;var s=_m(t,h);return rn(s,s.next),rn(t,t.next)}function MC(h,e){var t=e,s=h.x,i=h.y,n=-1/0,r;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){var o=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(o<=s&&o>n&&(n=o,r=t.x<t.next.x?t:t.next,o===s))return r}t=t.next}while(t!==e);if(!r)return null;var a=r,l=r.x,c=r.y,p=1/0,u;t=r;do s>=t.x&&t.x>=l&&s!==t.x&&$n(i<c?s:n,i,l,c,i<c?n:s,i,t.x,t.y)&&(u=Math.abs(i-t.y)/(s-t.x),fo(t,h)&&(u<p||u===p&&(t.x>r.x||t.x===r.x&&_C(r,t)))&&(r=t,p=u)),t=t.next;while(t!==a);return r}function _C(h,e){return dt(h.prev,h,e.prev)<0&&dt(e.next,h,h.next)<0}function LC(h,e,t,s){var i=h;do i.z===0&&(i.z=Nc(i.x,i.y,e,t,s)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==h);i.prevZ.nextZ=null,i.prevZ=null,NC(i)}function NC(h){var e,t,s,i,n,r,o,a,l=1;do{for(t=h,h=null,n=null,r=0;t;){for(r++,s=t,o=0,e=0;e<l&&(o++,s=s.nextZ,!!s);e++);for(a=l;o>0||a>0&&s;)o!==0&&(a===0||!s||t.z<=s.z)?(i=t,t=t.nextZ,o--):(i=s,s=s.nextZ,a--),n?n.nextZ=i:h=i,i.prevZ=n,n=i;t=s}n.nextZ=null,l*=2}while(r>1);return h}function Nc(h,e,t,s,i){return h=(h-t)*i|0,e=(e-s)*i|0,h=(h|h<<8)&16711935,h=(h|h<<4)&252645135,h=(h|h<<2)&858993459,h=(h|h<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,h|e<<1}function DC(h){var e=h,t=h;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==h);return t}function $n(h,e,t,s,i,n,r,o){return(i-r)*(e-o)>=(h-r)*(n-o)&&(h-r)*(s-o)>=(t-r)*(e-o)&&(t-r)*(n-o)>=(i-r)*(s-o)}function UC(h,e){return h.next.i!==e.i&&h.prev.i!==e.i&&!BC(h,e)&&(fo(h,e)&&fo(e,h)&&zC(h,e)&&(dt(h.prev,h,e.prev)||dt(h,e.prev,e))||Pl(h,e)&&dt(h.prev,h,h.next)>0&&dt(e.prev,e,e.next)>0)}function dt(h,e,t){return(e.y-h.y)*(t.x-e.x)-(e.x-h.x)*(t.y-e.y)}function Pl(h,e){return h.x===e.x&&h.y===e.y}function Mm(h,e,t,s){var i=ka(dt(h,e,t)),n=ka(dt(h,e,s)),r=ka(dt(t,s,h)),o=ka(dt(t,s,e));return!!(i!==n&&r!==o||i===0&&Ya(h,t,e)||n===0&&Ya(h,s,e)||r===0&&Ya(t,h,s)||o===0&&Ya(t,e,s))}function Ya(h,e,t){return e.x<=Math.max(h.x,t.x)&&e.x>=Math.min(h.x,t.x)&&e.y<=Math.max(h.y,t.y)&&e.y>=Math.min(h.y,t.y)}function ka(h){return h>0?1:h<0?-1:0}function BC(h,e){var t=h;do{if(t.i!==h.i&&t.next.i!==h.i&&t.i!==e.i&&t.next.i!==e.i&&Mm(t,t.next,h,e))return!0;t=t.next}while(t!==h);return!1}function fo(h,e){return dt(h.prev,h,h.next)<0?dt(h,e,h.next)>=0&&dt(h,h.prev,e)>=0:dt(h,e,h.prev)<0||dt(h,h.next,e)<0}function zC(h,e){var t=h,s=!1,i=(h.x+e.x)/2,n=(h.y+e.y)/2;do t.y>n!=t.next.y>n&&t.next.y!==t.y&&i<(t.next.x-t.x)*(n-t.y)/(t.next.y-t.y)+t.x&&(s=!s),t=t.next;while(t!==h);return s}function _m(h,e){var t=new Dc(h.i,h.x,h.y),s=new Dc(e.i,e.x,e.y),i=h.next,n=e.prev;return h.next=e,e.prev=h,t.next=i,i.prev=t,s.next=t,t.prev=s,n.next=s,s.prev=n,s}function Pp(h,e,t,s){var i=new Dc(h,e,t);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i}function mo(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function Dc(h,e,t){this.i=h,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Ol.deviation=function(h,e,t,s){var i=e&&e.length,n=i?e[0]*t:h.length,r=Math.abs(Uc(h,0,n,t));if(i)for(var o=0,a=e.length;o<a;o++){var l=e[o]*t,c=o<a-1?e[o+1]*t:h.length;r-=Math.abs(Uc(h,l,c,t))}var p=0;for(o=0;o<s.length;o+=3){var u=s[o]*t,m=s[o+1]*t,E=s[o+2]*t;p+=Math.abs((h[u]-h[E])*(h[m+1]-h[u+1])-(h[u]-h[m])*(h[E+1]-h[u+1]))}return r===0&&p===0?0:Math.abs((p-r)/r)};function Uc(h,e,t,s){for(var i=0,n=e,r=t-s;n<t;n+=s)i+=(h[r]-h[n])*(h[n+1]+h[r+1]),r=n;return i}Ol.flatten=function(h){for(var e=h[0][0].length,t={vertices:[],holes:[],dimensions:e},s=0,i=0;i<h.length;i++){for(var n=0;n<h[i].length;n++)for(var r=0;r<e;r++)t.vertices.push(h[i][n][r]);i>0&&(s+=h[i-1].length,t.holes.push(s))}return t};var YC=pd.exports;const kC=bm(YC),VC={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class dr{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const GC=new di(-1,1,1,-1,0,1);class HC extends ze{constructor(){super(),this.setAttribute("position",new Li([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Li([0,2,0,0,2,0],2))}}const WC=new HC;class Lm{constructor(e){this._mesh=new J(WC,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,GC)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Nm extends dr{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof Mt?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=qc.clone(e.uniforms),this.material=new Mt({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Lm(this.material)}render(e,t,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=s.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class bp extends dr{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,s){const i=e.getContext(),n=e.state;n.buffers.color.setMask(!1),n.buffers.depth.setMask(!1),n.buffers.color.setLocked(!0),n.buffers.depth.setLocked(!0);let r,o;this.inverse?(r=0,o=1):(r=1,o=0),n.buffers.stencil.setTest(!0),n.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),n.buffers.stencil.setFunc(i.ALWAYS,r,4294967295),n.buffers.stencil.setClear(o),n.buffers.stencil.setLocked(!0),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),n.buffers.color.setLocked(!1),n.buffers.depth.setLocked(!1),n.buffers.color.setMask(!0),n.buffers.depth.setMask(!0),n.buffers.stencil.setLocked(!1),n.buffers.stencil.setFunc(i.EQUAL,1,4294967295),n.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),n.buffers.stencil.setLocked(!0)}}class XC extends dr{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class KC{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const s=e.getSize(new Ue);this._width=s.width,this._height=s.height,t=new Ws(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Jc}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Nm(VC),this.copyPass.material.blending=XE,this.clock=new Kc}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let s=!1;for(let i=0,n=this.passes.length;i<n;i++){const r=this.passes[i];if(r.enabled!==!1){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),r.needsSwap){if(s){const o=this.renderer.getContext(),a=this.renderer.state.buffers.stencil;a.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),a.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}bp!==void 0&&(r instanceof bp?s=!0:r instanceof XC&&(s=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new Ue);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(s,i),this.renderTarget2.setSize(s,i);for(let n=0;n<this.passes.length;n++)this.passes[n].setSize(s,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class ZC extends dr{constructor(e,t,s=null,i=null,n=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=s,this.clearColor=i,this.clearAlpha=n,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new ft}render(e,t,s){const i=e.autoClear;e.autoClear=!1;let n,r;this.overrideMaterial!==null&&(r=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor)),this.clearAlpha!==null&&(n=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:s),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(n),this.overrideMaterial!==null&&(this.scene.overrideMaterial=r),e.autoClear=i}}const Io=new ze;Io.setAttribute("position",new Ct(new Float32Array([-1,-1,3,-1,-1,3]),2));Io.setAttribute("uv",new Ct(new Float32Array([0,0,2,0,0,2]),2));Io.boundingSphere=new Zs;Io.computeBoundingSphere=function(){};const jC=new di;class Va{constructor(e){this._mesh=new J(Io,e),this._mesh.frustumCulled=!1}render(e){e.render(this._mesh,jC)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}}const QC={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},sceneNormal:{value:null},projMat:{value:new de},viewMat:{value:new de},projViewMat:{value:new de},projectionMatrixInv:{value:new de},viewMatrixInv:{value:new de},cameraPos:{value:new O},resolution:{value:new Ue},time:{value:0},samples:{value:[]},samplesR:{value:[]},bluenoise:{value:null},distanceFalloff:{value:1},radius:{value:5},near:{value:.1},far:{value:1e3},logDepth:{value:!1},ortho:{value:!1},screenSpaceRadius:{value:!1}},vertexShader:`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 1);
}`,fragmentShader:`
    #define SAMPLES 16
    #define FSAMPLES 16.0
uniform sampler2D sceneDiffuse;
uniform sampler2D sceneNormal;
uniform highp sampler2D sceneDepth;
uniform mat4 projectionMatrixInv;
uniform mat4 viewMatrixInv;
uniform mat4 projMat;
uniform mat4 viewMat;
uniform mat4 projViewMat;
uniform vec3 cameraPos;
uniform vec2 resolution;
uniform float time;
uniform vec3[SAMPLES] samples;
uniform float[SAMPLES] samplesR;
uniform float radius;
uniform float distanceFalloff;
uniform float near;
uniform float far;
uniform bool logDepth;
uniform bool ortho;
uniform bool screenSpaceRadius;
uniform sampler2D bluenoise;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }

    vec3 getWorldPosLog(vec3 posS) {
      vec2 uv = posS.xy;
      float z = posS.z;
      float nearZ =near;
      float farZ = far;
      float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
      vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
      return wpos.xyz / wpos.w;
    }
    vec3 getWorldPos(float depth, vec2 coord) {
      #ifdef LOGDEPTH
        return getWorldPosLog(vec3(coord, depth));
      #endif
      float z = depth * 2.0 - 1.0;
      vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
      vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
      // Perspective division
     vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
     worldSpacePosition.xyz /= worldSpacePosition.w;
      return worldSpacePosition.xyz;
  }

  vec3 computeNormal(vec3 worldPos, vec2 vUv) {
    ivec2 p = ivec2(vUv * resolution);
    float c0 = texelFetch(sceneDepth, p, 0).x;
    float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
    float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
    float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
    float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
    float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
    float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
    float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
    float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;

    float dl = abs((2.0 * l1 - l2) - c0);
    float dr = abs((2.0 * r1 - r2) - c0);
    float db = abs((2.0 * b1 - b2) - c0);
    float dt = abs((2.0 * t1 - t2) - c0);

    vec3 ce = getWorldPos(c0, vUv).xyz;

    vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                          : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
    vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                          : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;

    return normalize(cross(dpdx, dpdy));
}

void main() {
      vec4 diffuse = texture2D(sceneDiffuse, vUv);
      float depth = texture2D(sceneDepth, vUv).x;
      if (depth == 1.0) {
        gl_FragColor = vec4(vec3(1.0), 1.0);
        return;
      }
      vec3 worldPos = getWorldPos(depth, vUv);
    //  vec3 normal = texture2D(sceneNormal, vUv).rgb;//computeNormal(worldPos, vUv);
      #ifdef HALFRES
        vec3 normal = texture2D(sceneNormal, vUv).rgb;
      #else
        vec3 normal = computeNormal(worldPos, vUv);
      #endif
      vec4 noise = texture2D(bluenoise, gl_FragCoord.xy / 128.0);
      vec3 randomVec = normalize(noise.rgb * 2.0 - 1.0);
      vec3 tangent = normalize(randomVec - normal * dot(randomVec, normal));
      vec3 bitangent = cross(normal, tangent);
      mat3 tbn = mat3(tangent, bitangent, normal);
      float occluded = 0.0;
      float totalWeight = 0.0;
     /* float radiusScreen = distance(
        worldPos,
        getWorldPos(depth, vUv + 
          vec2(48.0, 0.0) / resolution)
      );/*vUv.x < 0.5 ? radius : min(distance(
        worldPos,
        getWorldPos(depth, vUv + 
          vec2(100.0, 0.0) / resolution)
      ), radius);
      float distanceFalloffScreen = radiusScreen * 0.2;*/
      float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
      float bias = (0.1 / near) * fwidth(distance(worldPos, cameraPos)) / radiusToUse;
      for(float i = 0.0; i < FSAMPLES; i++) {
        vec3 sampleDirection = 
        tbn * 
        samples[int(i)];
        ;
        float moveAmt = samplesR[int(mod(i + noise.a * FSAMPLES, FSAMPLES))];
        vec3 samplePos = worldPos + radiusToUse * moveAmt * sampleDirection;
        vec4 offset = projViewMat * vec4(samplePos, 1.0);
        offset.xyz /= offset.w;
        offset.xyz = offset.xyz * 0.5 + 0.5;
        float sampleDepth = textureLod(sceneDepth, offset.xy, 0.0).x;
        /*float distSample = logDepth ? linearize_depth_log(sampleDepth, near, far) 
         (ortho ?  linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far));*/
        #ifdef LOGDEPTH
        float distSample = linearize_depth_log(sampleDepth, near, far);
        #else
        float distSample = ortho ? linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far);
        #endif
        float distWorld = ortho ? linearize_depth_ortho(offset.z, near, far) : linearize_depth(offset.z, near, far);
        float rangeCheck = smoothstep(0.0, 1.0, distanceFalloffToUse / (abs(distSample - distWorld)));
        vec2 diff = gl_FragCoord.xy - ( offset.xy * resolution);
        float weight = dot(sampleDirection, normal);
          occluded += rangeCheck * weight * 
            (distSample + bias
               < distWorld ? 1.0 : 0.0) * (
          (dot(
            diff,
            diff
             
            ) < 1.0 || (sampleDepth == depth) || (
              offset.x < 0.0 || offset.x > 1.0 || offset.y < 0.0 || offset.y > 1.0
            ) ? 0.0 : 1.0)
          );
          totalWeight += weight;
      }
      float occ = clamp(1.0 - occluded / totalWeight, 0.0, 1.0);
      gl_FragColor = vec4(0.5 + 0.5 * normal, occ);
}`},qC={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new de},viewMat:{value:new de},projectionMatrixInv:{value:new de},viewMatrixInv:{value:new de},cameraPos:{value:new O},resolution:{value:new Ue},color:{value:new O(0,0,0)},blueNoise:{value:null},downsampledDepth:{value:null},time:{value:0},intensity:{value:10},renderMode:{value:0},gammaCorrection:{value:!1},logDepth:{value:!1},ortho:{value:!1},near:{value:.1},far:{value:1e3},screenSpaceRadius:{value:!1},radius:{value:0},distanceFalloff:{value:1}},vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform sampler2D sceneDepth;
    uniform sampler2D downsampledDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform vec2 resolution;
    uniform vec3 color;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform float intensity;
    uniform float renderMode;
    uniform float near;
    uniform float far;
    uniform bool gammaCorrection;
    uniform bool logDepth;
    uniform bool ortho;
    uniform bool screenSpaceRadius;
    uniform float radius;
    uniform float distanceFalloff;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
       // if (logDepth) {
        #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
        #endif
      //  }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }

    #include <common>
    #include <dithering_pars_fragment>
    void main() {
        //vec4 texel = texture2D(tDiffuse, vUv);//vec3(0.0);
        vec4 sceneTexel = texture2D(sceneDiffuse, vUv);

        #ifdef HALFRES 
        float depth = texture2D(
            sceneDepth,
            vUv
        ).x;
        vec4 texel;
        if (depth == 1.0) {
            texel = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
        vec3 worldPos = getWorldPos(depth, vUv);
        vec3 normal = computeNormal(getWorldPos(depth, vUv), vUv);
       // vec4 texel = texture2D(tDiffuse, vUv);
       // Find closest depth;
       float totalWeight = 0.0;
       float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
        for(float x = -1.0; x <= 1.0; x++) {
            for(float y = -1.0; y <= 1.0; y++) {
                vec2 offset = vec2(x, y);
                ivec2 p = ivec2(
                    (vUv * resolution * 0.5) + offset
                );
                vec2 pUv = vec2(p) / (resolution * 0.5);
                float sampleDepth = texelFetch(downsampledDepth,p, 0).x;
                vec4 sampleInfo = texelFetch(tDiffuse, p, 0);
                vec3 normalSample = sampleInfo.xyz * 2.0 - 1.0;
                vec3 worldPosSample = getWorldPos(sampleDepth, pUv);
                float tangentPlaneDist = abs(dot(worldPos - worldPosSample, normal));
                float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0);
                float weight = rangeCheck;
                totalWeight += weight;
                texel += sampleInfo * weight;
            }
        }
        if (totalWeight == 0.0) {
            texel = texture2D(tDiffuse, vUv);
        } else {
            texel /= totalWeight;
        }
    }
        #else
        vec4 texel = texture2D(tDiffuse, vUv);
        #endif

     
        float finalAo = pow(texel.a, intensity);
        if (renderMode == 0.0) {
            gl_FragColor = vec4( mix(sceneTexel.rgb, color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 1.0) {
            gl_FragColor = vec4( mix(vec3(1.0), color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 2.0) {
            gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
        } else if (renderMode == 3.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(sceneTexel.rgb, color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
            }
        } else if (renderMode == 4.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(vec3(1.0), color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
            }
        }
        #include <dithering_fragment>
        if (gammaCorrection) {
            gl_FragColor = LinearTosRGB(gl_FragColor);
        }
    }
    `},JC={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new de},viewMat:{value:new de},projectionMatrixInv:{value:new de},viewMatrixInv:{value:new de},cameraPos:{value:new O},resolution:{value:new Ue},time:{value:0},r:{value:5},blueNoise:{value:null},radius:{value:12},worldRadius:{value:5},index:{value:0},poissonDisk:{value:[]},distanceFalloff:{value:1},near:{value:.1},far:{value:1e3},logDepth:{value:!1},screenSpaceRadius:{value:!1}},vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1.0);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform vec2 resolution;
    uniform float r;
    uniform float radius;
     uniform float worldRadius;
    uniform float index;
     uniform float near;
     uniform float far;
     uniform float distanceFalloff;
     uniform bool logDepth;
     uniform bool screenSpaceRadius;
    varying vec2 vUv;

    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        highp float z_n = 2.0 * d - 1.0;
        return 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
     float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     return linearize_depth(linDepth, nearZ, farZ);
   }
   highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
     return nearZ + (farZ - nearZ) * d;
   }
   vec3 getWorldPosLog(vec3 posS) {
     vec2 uv = posS.xy;
     float z = posS.z;
     float nearZ =near;
     float farZ = far;
     float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
     vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
     return wpos.xyz / wpos.w;
   }
    vec3 getWorldPos(float depth, vec2 coord) {
     #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
     #endif
        
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
    #include <common>
    #define NUM_SAMPLES 16
    uniform vec2 poissonDisk[NUM_SAMPLES];
    void main() {
        const float pi = 3.14159;
        vec2 texelSize = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec2 uv = vUv;
        vec4 data = texture2D(tDiffuse, vUv);
        float occlusion = data.a;
        float baseOcc = data.a;
        vec3 normal = data.rgb * 2.0 - 1.0;
        float count = 1.0;
        float d = texture2D(sceneDepth, vUv).x;
        vec3 worldPos = getWorldPos(d, vUv);
        float size = radius;
        float angle;
        if (index == 0.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).x * PI2;
        } else if (index == 1.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).y * PI2;
        } else if (index == 2.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).z * PI2;
        } else {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).w * PI2;
        }

        mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        float radiusToUse = screenSpaceRadius ? distance(
          worldPos,
          getWorldPos(d, vUv +
            vec2(worldRadius, 0.0) / resolution)
        ) : worldRadius;
        float distanceFalloffToUse =screenSpaceRadius ?
            radiusToUse * distanceFalloff
        : distanceFalloff;


        for(int i = 0; i < NUM_SAMPLES; i++) {
            vec2 offset = (rotationMatrix * poissonDisk[i]) * texelSize * size;
            vec4 dataSample = texture2D(tDiffuse, uv + offset);
            float occSample = dataSample.a;
            vec3 normalSample = dataSample.rgb * 2.0 - 1.0;
            float dSample = texture2D(sceneDepth, uv + offset).x;
            vec3 worldPosSample = getWorldPos(dSample, uv + offset);
            float tangentPlaneDist = abs(dot(worldPos - worldPosSample, normal));
            float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0) * (1.0 - abs(occSample - baseOcc));
            occlusion += occSample * rangeCheck;
            count += rangeCheck;
        }
        occlusion /= count;
        gl_FragColor = vec4(0.5 + 0.5 * normal, occlusion);
    }
    `},$C={uniforms:{sceneDepth:{value:null},resolution:{value:new Ue},near:{value:.1},far:{value:1e3},viewMatrixInv:{value:new de},projectionMatrixInv:{value:new de},logDepth:{value:!1}},vertexShader:`
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = vec4(position, 1);
    }`,fragmentShader:`
    uniform sampler2D sceneDepth;
    uniform vec2 resolution;
    uniform float near;
    uniform float far;
    uniform bool logDepth;
    uniform mat4 viewMatrixInv;
    uniform mat4 projectionMatrixInv;
    varying vec2 vUv;
    layout(location = 1) out vec4 gNormal;
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
        if (logDepth) {
          return getWorldPosLog(vec3(coord, depth));
        }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }
    void main() {
        vec2 uv = vUv - vec2(0.5) / resolution;
        vec2 pixelSize = vec2(1.0) / resolution;
        vec2[] uvSamples = vec2[4](
            uv,
            uv + vec2(pixelSize.x, 0.0),
            uv + vec2(0.0, pixelSize.y),
            uv + pixelSize
        );
        float depth00 = texture2D(sceneDepth, uvSamples[0]).r;
        float depth10 = texture2D(sceneDepth, uvSamples[1]).r;
        float depth01 = texture2D(sceneDepth, uvSamples[2]).r;
        float depth11 = texture2D(sceneDepth, uvSamples[3]).r;
        float minDepth = min(min(depth00, depth10), min(depth01, depth11));
        float maxDepth = max(max(depth00, depth10), max(depth01, depth11));
        float targetDepth = minDepth;
        // Checkerboard pattern to avoid artifacts
        if (mod(gl_FragCoord.x + gl_FragCoord.y, 2.0) > 0.5) { 
            targetDepth = maxDepth;
        }
        int chosenIndex = 0;
        float[] samples = float[4](depth00, depth10, depth01, depth11);
        for(int i = 0; i < 4; ++i) {
            if (samples[i] == targetDepth) {
                chosenIndex = i;
                break;
            }
        }
        gl_FragColor = vec4(samples[chosenIndex], 0.0, 0.0, 1.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[chosenIndex], uvSamples[chosenIndex]), uvSamples[chosenIndex]
        ), 0.0);
       /* float[] samples = float[4](depth00, depth10, depth01, depth11);
        float c = 0.25 * (depth00 + depth10 + depth01 + depth11);
        float[] distances = float[4](depth00, depth10, depth01, depth11);
        float maxDistance = max(max(distances[0], distances[1]), max(distances[2], distances[3]));

        int remaining[3];
        int rejected[3];
        int i, j, k;

        for(i = 0, j = 0, k = 0; i < 4; ++i) {
            if (distances[i] < maxDistance) {
                remaining[j++] = i;
            } else {
                rejected[k++] = i;
            }
        }
        for(;j < 3;++j) {
            remaining[j] = rejected[--k];
        }
        vec3 s = vec3(
            samples[remaining[0]],
            samples[remaining[1]],
            samples[remaining[2]]
        );
        c = (s.x + s.y + s.z) / 3.0;

        distances[0] = abs(c - s.x);
        distances[1] = abs(c - s.y);
        distances[2] = abs(c - s.z);

        float minDistance = min(min(distances[0], distances[1]), distances[2]);

        for(i = 0; i < 3; ++i) {
            if (distances[i] == minDistance) {
                break;
            }
        }*/
      /*  gl_FragColor = vec4(samples[remaining[i]], 0.0, 0.0, 0.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[remaining[i]], uvSamples[remaining[i]]), uvSamples[remaining[i]]
        ), 0.0);*/
    }`};var Dm="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";Uint8Array.from(atob(Dm),h=>h.charCodeAt(0));const eT=Uint8Array.from(atob(Dm),h=>h.charCodeAt(0));function Um(h,e,t){if(e.getQueryParameter(h,e.QUERY_RESULT_AVAILABLE)){const s=e.getQueryParameter(h,e.QUERY_RESULT)/1e6;t.lastTime=s}else setTimeout(()=>{Um(h,e,t)},1)}class tT extends dr{constructor(e,t,s=512,i=512){super(),this.width=s,this.height=i,this.clear=!0,this.camera=t,this.scene=e,this.configuration=new Proxy({aoSamples:16,aoRadius:5,denoiseSamples:8,denoiseRadius:12,distanceFalloff:1,intensity:5,denoiseIterations:2,renderMode:0,color:new ft(0,0,0),gammaCorrection:!0,logarithmicDepthBuffer:!1,screenSpaceRadius:!1,halfRes:!1,depthAwareUpsampling:!0},{set:(n,r,o)=>{const a=n[r];return n[r]=o,r==="aoSamples"&&a!==o&&this.configureAOPass(this.configuration.logarithmicDepthBuffer),r==="denoiseSamples"&&a!==o&&this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),r==="halfRes"&&a!==o&&(this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureHalfResTargets(),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.setSize(this.width,this.height)),r==="depthAwareUpsampling"&&a!==o&&this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),!0}}),this.samples=[],this.samplesR=[],this.samplesDenoise=[],this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.configureSampleDependentPasses(),this.configureHalfResTargets(),this.beautyRenderTarget=new Ws(this.width,this.height,{minFilter:Sr,magFilter:li}),this.beautyRenderTarget.depthTexture=new KE(this.width,this.height,ZE),this.beautyRenderTarget.depthTexture.format=jE,this.writeTargetInternal=new Ws(this.width,this.height,{minFilter:Sr,magFilter:Sr,depthBuffer:!1}),this.readTargetInternal=new Ws(this.width,this.height,{minFilter:Sr,magFilter:Sr,depthBuffer:!1}),this.bluenoise=new QE(eT,128,128),this.bluenoise.colorSpace=qE,this.bluenoise.wrapS=jd,this.bluenoise.wrapT=jd,this.bluenoise.minFilter=li,this.bluenoise.magFilter=li,this.bluenoise.needsUpdate=!0,this.lastTime=0,this._r=new Ue,this._c=new ft}configureHalfResTargets(){this.configuration.halfRes?(this.depthDownsampleTarget=new JE(this.width/2,this.height/2,2),this.depthDownsampleTarget.texture[0].format=$E,this.depthDownsampleTarget.texture[0].type=e0,this.depthDownsampleTarget.texture[0].minFilter=li,this.depthDownsampleTarget.texture[0].magFilter=li,this.depthDownsampleTarget.texture[0].depthBuffer=!1,this.depthDownsampleTarget.texture[1].format=qp,this.depthDownsampleTarget.texture[1].type=Jc,this.depthDownsampleTarget.texture[1].minFilter=li,this.depthDownsampleTarget.texture[1].magFilter=li,this.depthDownsampleTarget.texture[1].depthBuffer=!1,this.depthDownsampleQuad=new Va(new Mt($C))):(this.depthDownsampleTarget&&(this.depthDownsampleTarget.dispose(),this.depthDownsampleTarget=null),this.depthDownsampleQuad&&(this.depthDownsampleQuad.dispose(),this.depthDownsampleQuad=null))}configureSampleDependentPasses(){this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer)}configureAOPass(e=!1){this.samples=this.generateHemisphereSamples(this.configuration.aoSamples),this.samplesR=this.generateHemisphereSamplesR(this.configuration.aoSamples);const t={...QC};t.fragmentShader=t.fragmentShader.replace("16",this.configuration.aoSamples).replace("16.0",this.configuration.aoSamples+".0"),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectShaderQuad?(this.effectShaderQuad.material.dispose(),this.effectShaderQuad.material=new Mt(t)):this.effectShaderQuad=new Va(new Mt(t))}configureDenoisePass(e=!1){this.samplesDenoise=this.generateDenoiseSamples(this.configuration.denoiseSamples,11);const t={...JC};t.fragmentShader=t.fragmentShader.replace("16",this.configuration.denoiseSamples),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.poissonBlurQuad?(this.poissonBlurQuad.material.dispose(),this.poissonBlurQuad.material=new Mt(t)):this.poissonBlurQuad=new Va(new Mt(t))}configureEffectCompositer(e=!1){const t={...qC};e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&this.configuration.depthAwareUpsampling&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectCompositerQuad?(this.effectCompositerQuad.material.dispose(),this.effectCompositerQuad.material=new Mt(t)):this.effectCompositerQuad=new Va(new Mt(t))}generateHemisphereSamples(e){const t=[];for(let s=0;s<e;s++){const i=2.399963*s,n=Math.sqrt(s+.5)/Math.sqrt(e),r=n*Math.cos(i),o=n*Math.sin(i),a=Math.sqrt(1-(r*r+o*o));t.push(new O(r,o,a))}return t}generateHemisphereSamplesR(e){let t=[];for(let s=0;s<e;s++)t.push((s+1)/e);return t}generateDenoiseSamples(e,t){const s=2*Math.PI*t/e,i=1/e,n=i,r=[];let o=i,a=0;for(let l=0;l<e;l++)r.push(new Ue(Math.cos(a),Math.sin(a)).multiplyScalar(Math.pow(o,.75))),o+=n,a+=s;return r}setSize(e,t){this.width=e,this.height=t;const s=this.configuration.halfRes?.5:1;this.beautyRenderTarget.setSize(e,t),this.writeTargetInternal.setSize(e*s,t*s),this.readTargetInternal.setSize(e*s,t*s),this.configuration.halfRes&&this.depthDownsampleTarget.setSize(e*s,t*s)}render(e,t,s,i,n){e.capabilities.logarithmicDepthBuffer!==this.configuration.logarithmicDepthBuffer&&(this.configuration.logarithmicDepthBuffer=e.capabilities.logarithmicDepthBuffer,this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer));let r,o,a;this.debugMode&&(r=e.getContext(),o=r.getExtension("EXT_disjoint_timer_query_webgl2"),o===null&&(console.error("EXT_disjoint_timer_query_webgl2 not available, disabling debug mode."),this.debugMode=!1)),e.setRenderTarget(this.beautyRenderTarget),e.render(this.scene,this.camera),this.debugMode&&(a=r.createQuery(),r.beginQuery(o.TIME_ELAPSED_EXT,a));const l=e.xr.enabled;e.xr.enabled=!1,this.camera.updateMatrixWorld(),this._r.set(this.width,this.height);let c=this.configuration.aoRadius;this.configuration.halfRes&&this.configuration.screenSpaceRadius&&(c*=.5),this.configuration.halfRes&&(e.setRenderTarget(this.depthDownsampleTarget),this.depthDownsampleQuad.material.uniforms.sceneDepth.value=this.beautyRenderTarget.depthTexture,this.depthDownsampleQuad.material.uniforms.resolution.value=this._r,this.depthDownsampleQuad.material.uniforms.near.value=this.camera.near,this.depthDownsampleQuad.material.uniforms.far.value=this.camera.far,this.depthDownsampleQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.depthDownsampleQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.depthDownsampleQuad.material.uniforms.logDepth.value=this.configuration.logarithmicDepthBuffer,this.depthDownsampleQuad.render(e)),this.effectShaderQuad.material.uniforms.sceneDiffuse.value=this.beautyRenderTarget.texture,this.effectShaderQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.beautyRenderTarget.depthTexture,this.effectShaderQuad.material.uniforms.sceneNormal.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[1]:null,this.effectShaderQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.effectShaderQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.effectShaderQuad.material.uniforms.projViewMat.value=this.camera.projectionMatrix.clone().multiply(this.camera.matrixWorldInverse.clone()),this.effectShaderQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectShaderQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectShaderQuad.material.uniforms.cameraPos.value=this.camera.position,this.effectShaderQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.effectShaderQuad.material.uniforms.time.value=performance.now()/1e3,this.effectShaderQuad.material.uniforms.samples.value=this.samples,this.effectShaderQuad.material.uniforms.samplesR.value=this.samplesR,this.effectShaderQuad.material.uniforms.bluenoise.value=this.bluenoise,this.effectShaderQuad.material.uniforms.radius.value=c,this.effectShaderQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectShaderQuad.material.uniforms.near.value=this.camera.near,this.effectShaderQuad.material.uniforms.far.value=this.camera.far,this.effectShaderQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectShaderQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectShaderQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.effectShaderQuad.render(e);for(let p=0;p<this.configuration.denoiseIterations;p++)[this.writeTargetInternal,this.readTargetInternal]=[this.readTargetInternal,this.writeTargetInternal],this.poissonBlurQuad.material.uniforms.tDiffuse.value=this.readTargetInternal.texture,this.poissonBlurQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.beautyRenderTarget.depthTexture,this.poissonBlurQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.poissonBlurQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.poissonBlurQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.poissonBlurQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.poissonBlurQuad.material.uniforms.cameraPos.value=this.camera.position,this.poissonBlurQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.poissonBlurQuad.material.uniforms.time.value=performance.now()/1e3,this.poissonBlurQuad.material.uniforms.blueNoise.value=this.bluenoise,this.poissonBlurQuad.material.uniforms.radius.value=this.configuration.denoiseRadius*(this.configuration.halfRes?.5:1),this.poissonBlurQuad.material.uniforms.worldRadius.value=c,this.poissonBlurQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.poissonBlurQuad.material.uniforms.index.value=p,this.poissonBlurQuad.material.uniforms.poissonDisk.value=this.samplesDenoise,this.poissonBlurQuad.material.uniforms.near.value=this.camera.near,this.poissonBlurQuad.material.uniforms.far.value=this.camera.far,this.poissonBlurQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.poissonBlurQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.poissonBlurQuad.render(e);this.effectCompositerQuad.material.uniforms.sceneDiffuse.value=this.beautyRenderTarget.texture,this.effectCompositerQuad.material.uniforms.sceneDepth.value=this.beautyRenderTarget.depthTexture,this.effectCompositerQuad.material.uniforms.near.value=this.camera.near,this.effectCompositerQuad.material.uniforms.far.value=this.camera.far,this.effectCompositerQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectCompositerQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectCompositerQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectCompositerQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectCompositerQuad.material.uniforms.downsampledDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.beautyRenderTarget.depthTexture,this.effectCompositerQuad.material.uniforms.resolution.value=this._r,this.effectCompositerQuad.material.uniforms.blueNoise.value=this.bluenoise,this.effectCompositerQuad.material.uniforms.intensity.value=this.configuration.intensity,this.effectCompositerQuad.material.uniforms.renderMode.value=this.configuration.renderMode,this.effectCompositerQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectCompositerQuad.material.uniforms.radius.value=c,this.effectCompositerQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectCompositerQuad.material.uniforms.gammaCorrection.value=this.configuration.gammaCorrection,this.effectCompositerQuad.material.uniforms.tDiffuse.value=this.writeTargetInternal.texture,this.effectCompositerQuad.material.uniforms.color.value=this._c.copy(this.configuration.color).convertSRGBToLinear(),e.setRenderTarget(this.renderToScreen?null:t),this.effectCompositerQuad.render(e),this.debugMode&&(r.endQuery(o.TIME_ELAPSED_EXT),Um(a,r,this)),e.xr.enabled=l}enableDebugMode(){this.debugMode=!0}disableDebugMode(){this.debugMode=!1}setDisplayMode(e){this.configuration.renderMode=["Combined","AO","No AO","Split","Split AO"].indexOf(e)}setQualityMode(e){e==="Performance"?(this.configuration.aoSamples=8,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Low"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Medium"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=12):e==="High"?(this.configuration.aoSamples=64,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=6):e==="Ultra"&&(this.configuration.aoSamples=64,this.configuration.denoiseSamples=16,this.configuration.denoiseRadius=6)}}const sT={name:"GammaCorrectionShader",uniforms:{tDiffuse:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 tex = texture2D( tDiffuse, vUv );

			gl_FragColor = sRGBTransferOETF( tex );

		}`};function iT(){return new Mt({side:2,clipping:!0,uniforms:{},vertexShader:`
    varying vec4 vColor;
    
    #include <clipping_planes_pars_vertex>
  
    void main() {
       #include <begin_vertex>
    
       vec4 absPosition = vec4(position, 1.0);
       vec3 trueNormal = normal;
       
       #ifdef USE_INSTANCING
          absPosition = instanceMatrix * absPosition;
          trueNormal = (instanceMatrix * vec4(normal, 0.)).xyz;
       #endif
       
       absPosition = modelMatrix * absPosition;
       trueNormal = (normalize(modelMatrix * vec4(trueNormal, 0.))).xyz;
       
       vec3 planePosition = absPosition.xyz / 40.;
       float d = abs(dot(trueNormal, planePosition));
       vColor = vec4(abs(trueNormal), d);
       gl_Position = projectionMatrix * viewMatrix * absPosition;
       
       #include <project_vertex>
       #include <clipping_planes_vertex>
    }
    `,fragmentShader:`
    varying vec4 vColor;
    
    #include <clipping_planes_pars_fragment>
  
    void main() {
      #include <clipping_planes_fragment>
      gl_FragColor = vColor;
    }
    `})}function nT(){return new Mt({side:2,clipping:!0,uniforms:{},vertexShader:`
    varying vec3 vCameraPosition;
    varying vec3 vPosition;
    varying vec3 vNormal;
    
    #include <clipping_planes_pars_vertex>
  
    void main() {
       #include <begin_vertex>
       
       vec4 absPosition = vec4(position, 1.0);
       vNormal = normal;
       
       #ifdef USE_INSTANCING
          absPosition = instanceMatrix * absPosition;
          vNormal = (instanceMatrix * vec4(normal, 0.)).xyz;
       #endif
       
       absPosition = modelMatrix * absPosition;
       vNormal = (normalize(modelMatrix * vec4(vNormal, 0.))).xyz;
       
       gl_Position = projectionMatrix * viewMatrix * absPosition;
       
       vCameraPosition = cameraPosition;
       vPosition = absPosition.xyz;
       
       #include <project_vertex>
       #include <clipping_planes_vertex>
    }
    `,fragmentShader:`
    varying vec3 vCameraPosition;
    varying vec3 vPosition;
    varying vec3 vNormal;
    
    #include <clipping_planes_pars_fragment>
  
    void main() {
      #include <clipping_planes_fragment>
      vec3 cameraPixelVec = normalize(vCameraPosition - vPosition);
      float difference = abs(dot(vNormal, cameraPixelVec));
      
      // This achieves a double gloss effect: when the surface is perpendicular and when it's parallel
      difference = abs((difference * 2.) - 1.);
      
      gl_FragColor = vec4(difference, difference, difference, 1.);
    }
    `})}class rT extends dr{constructor(e,t,s,i,n){if(super(),S(this,"components"),S(this,"resolution"),S(this,"renderScene"),S(this,"renderCamera"),S(this,"fsQuad"),S(this,"normalOverrideMaterial"),S(this,"glossOverrideMaterial"),S(this,"planeBuffer"),S(this,"glossBuffer"),S(this,"outlineBuffer"),S(this,"excludedMeshes",[]),S(this,"outlinedMeshes",{}),S(this,"outlineScene",new js),S(this,"_outlineEnabled",!1),S(this,"_lineColor",10066329),S(this,"_opacity",.4),S(this,"_tolerance",3),S(this,"_glossEnabled",!0),S(this,"_glossExponent",1.9),S(this,"_minGloss",-.1),S(this,"_maxGloss",.1),!s.renderer)throw new Error("The given world must have a renderer!");this.components=t,this.renderScene=i,this.renderCamera=n,this.resolution=new Ue(e.x,e.y),this.fsQuad=new Lm,this.fsQuad.material=this.createOutlinePostProcessMaterial(),this.planeBuffer=this.newRenderTarget(),this.glossBuffer=this.newRenderTarget(),this.outlineBuffer=this.newRenderTarget();const r=iT();r.clippingPlanes=s.renderer.clippingPlanes,this.normalOverrideMaterial=r;const o=nT();o.clippingPlanes=s.renderer.clippingPlanes,this.glossOverrideMaterial=o}get lineColor(){return this._lineColor}set lineColor(e){this._lineColor=e,this.fsQuad.material.uniforms.lineColor.value.set(e)}get tolerance(){return this._tolerance}set tolerance(e){this._tolerance=e;const t=this.fsQuad.material;t.uniforms.tolerance.value=e}get opacity(){return this._opacity}set opacity(e){this._opacity=e;const t=this.fsQuad.material;t.uniforms.opacity.value=e}get glossEnabled(){return this._glossEnabled}set glossEnabled(e){if(e===this._glossEnabled)return;this._glossEnabled=e;const t=this.fsQuad.material;t.uniforms.glossEnabled.value=e?1:0}get glossExponent(){return this._glossExponent}set glossExponent(e){this._glossExponent=e;const t=this.fsQuad.material;t.uniforms.glossExponent.value=e}get minGloss(){return this._minGloss}set minGloss(e){this._minGloss=e;const t=this.fsQuad.material;t.uniforms.minGloss.value=e}get maxGloss(){return new It().color.convertLinearToSRGB(),this._maxGloss}set maxGloss(e){this._maxGloss=e;const t=this.fsQuad.material;t.uniforms.maxGloss.value=e}get outlineEnabled(){return this._outlineEnabled}set outlineEnabled(e){if(e===this._outlineEnabled)return;this._outlineEnabled=e;const t=this.fsQuad.material;t.uniforms.outlineEnabled.value=e?1:0}async dispose(){this.planeBuffer.dispose(),this.glossBuffer.dispose(),this.outlineBuffer.dispose(),this.normalOverrideMaterial.dispose(),this.glossOverrideMaterial.dispose(),this.fsQuad.material.dispose(),this.fsQuad.dispose(),this.excludedMeshes=[],this.outlineScene.children=[];const e=this.components.get(Ks);for(const t in this.outlinedMeshes){const s=this.outlinedMeshes[t];for(const i of s.meshes){e.destroy(i,!0,!0);const n=i;n.fragment&&n.fragment.dispose(!0)}s.material.dispose()}}setSize(e,t){this.planeBuffer.setSize(e,t),this.glossBuffer.setSize(e,t),this.outlineBuffer.setSize(e,t),this.resolution.set(e,t);const s=this.fsQuad.material;s.uniforms.screenSize.value.set(this.resolution.x,this.resolution.y,1/this.resolution.x,1/this.resolution.y),s.uniformsNeedUpdate=!0}render(e,t,s){const i=t.depthBuffer;t.depthBuffer=!1;const n=this.renderScene.overrideMaterial,r=this.renderScene.background;this.renderScene.background=null;for(const a of this.excludedMeshes)a.visible=!1;e.setRenderTarget(this.planeBuffer),this.renderScene.overrideMaterial=this.normalOverrideMaterial,e.render(this.renderScene,this.renderCamera),this._glossEnabled&&(e.setRenderTarget(this.glossBuffer),this.renderScene.overrideMaterial=this.glossOverrideMaterial,e.render(this.renderScene,this.renderCamera)),this.renderScene.overrideMaterial=n,e.setRenderTarget(this.outlineBuffer),this._outlineEnabled?e.render(this.outlineScene,this.renderCamera):e.clear();for(const a of this.excludedMeshes)a.visible=!0;this.renderScene.background=r;const o=this.fsQuad.material;o.uniforms.planeBuffer.value=this.planeBuffer.texture,o.uniforms.glossBuffer.value=this.glossBuffer.texture,o.uniforms.outlineBuffer.value=this.outlineBuffer.texture,o.uniforms.sceneColorBuffer.value=s.texture,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.fsQuad.render(e)),t.depthBuffer=i}get vertexShader(){return`
	  varying vec2 vUv;
	  void main() {
	  	vUv = uv;
	  	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
	  }
	`}get fragmentShader(){return`
	  uniform sampler2D sceneColorBuffer;
	  uniform sampler2D planeBuffer;
	  uniform sampler2D glossBuffer;
	  uniform sampler2D outlineBuffer;
	  uniform vec4 screenSize;
	  uniform vec3 lineColor;
	  
	  uniform float outlineEnabled;
	  
      uniform int width;
	  uniform float opacity;
      uniform float tolerance;
      uniform float glossExponent;
      uniform float minGloss;
      uniform float maxGloss;
      uniform float glossEnabled;

	  varying vec2 vUv;

	  vec4 getValue(sampler2D buffer, int x, int y) {
	  	return texture2D(buffer, vUv + screenSize.zw * vec2(x, y));
	  }

      float normalDiff(vec3 normal1, vec3 normal2) {
        return ((dot(normal1, normal2) - 1.) * -1.) / 2.;
      }

      // Returns 0 if it's background, 1 if it's not
      float getIsBackground(vec3 normal) {
        float background = 1.0;
        background *= step(normal.x, 0.);
        background *= step(normal.y, 0.);
        background *= step(normal.z, 0.);
        background = (background - 1.) * -1.;
        return background;
      }

	  void main() {
	  
	    vec4 sceneColor = getValue(sceneColorBuffer, 0, 0);
	    vec3 normSceneColor = normalize(sceneColor.rgb);
  
        vec4 plane = getValue(planeBuffer, 0, 0);
	    vec3 normal = plane.xyz;
        float distance = plane.w;
  
        vec3 normalTop = getValue(planeBuffer, 0, width).rgb;
        vec3 normalBottom = getValue(planeBuffer, 0, -width).rgb;
        vec3 normalRight = getValue(planeBuffer, width, 0).rgb;
        vec3 normalLeft = getValue(planeBuffer, -width, 0).rgb;
        vec3 normalTopRight = getValue(planeBuffer, width, width).rgb;
        vec3 normalTopLeft = getValue(planeBuffer, -width, width).rgb;
        vec3 normalBottomRight = getValue(planeBuffer, width, -width).rgb;
        vec3 normalBottomLeft = getValue(planeBuffer, -width, -width).rgb;
  
        float distanceTop = getValue(planeBuffer, 0, width).a;
        float distanceBottom = getValue(planeBuffer, 0, -width).a;
        float distanceRight = getValue(planeBuffer, width, 0).a;
        float distanceLeft = getValue(planeBuffer, -width, 0).a;
        float distanceTopRight = getValue(planeBuffer, width, width).a;
        float distanceTopLeft = getValue(planeBuffer, -width, width).a;
        float distanceBottomRight = getValue(planeBuffer, width, -width).a;
        float distanceBottomLeft = getValue(planeBuffer, -width, -width).a;
        
        vec3 sceneColorTop = normalize(getValue(sceneColorBuffer, 1, 0).rgb);
        vec3 sceneColorBottom = normalize(getValue(sceneColorBuffer, -1, 0).rgb);
        vec3 sceneColorLeft = normalize(getValue(sceneColorBuffer, 0, -1).rgb);
        vec3 sceneColorRight = normalize(getValue(sceneColorBuffer, 0, 1).rgb);
        vec3 sceneColorTopRight = normalize(getValue(sceneColorBuffer, 1, 1).rgb);
        vec3 sceneColorBottomRight = normalize(getValue(sceneColorBuffer, -1, 1).rgb);
        vec3 sceneColorTopLeft = normalize(getValue(sceneColorBuffer, 1, 1).rgb);
        vec3 sceneColorBottomLeft = normalize(getValue(sceneColorBuffer, -1, 1).rgb);

        // Checks if the planes of this texel and the neighbour texels are different

        float planeDiff = 0.0;

        planeDiff += step(0.001, normalDiff(normal, normalTop));
        planeDiff += step(0.001, normalDiff(normal, normalBottom));
        planeDiff += step(0.001, normalDiff(normal, normalLeft));
        planeDiff += step(0.001, normalDiff(normal, normalRight));
        planeDiff += step(0.001, normalDiff(normal, normalTopRight));
        planeDiff += step(0.001, normalDiff(normal, normalTopLeft));
        planeDiff += step(0.001, normalDiff(normal, normalBottomRight));
        planeDiff += step(0.001, normalDiff(normal, normalBottomLeft));
        
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorTop));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorBottom));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorLeft));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorRight));
       	planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorTopRight));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorTopLeft));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorBottomRight));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorBottomLeft));

        planeDiff += step(0.001, abs(distance - distanceTop));
        planeDiff += step(0.001, abs(distance - distanceBottom));
        planeDiff += step(0.001, abs(distance - distanceLeft));
        planeDiff += step(0.001, abs(distance - distanceRight));
        planeDiff += step(0.001, abs(distance - distanceTopRight));
        planeDiff += step(0.001, abs(distance - distanceTopLeft));
        planeDiff += step(0.001, abs(distance - distanceBottomRight));
        planeDiff += step(0.001, abs(distance - distanceBottomLeft));

        // Add extra background outline

        int width2 = width + 1;
        vec3 normalTop2 = getValue(planeBuffer, 0, width2).rgb;
        vec3 normalBottom2 = getValue(planeBuffer, 0, -width2).rgb;
        vec3 normalRight2 = getValue(planeBuffer, width2, 0).rgb;
        vec3 normalLeft2 = getValue(planeBuffer, -width2, 0).rgb;
        vec3 normalTopRight2 = getValue(planeBuffer, width2, width2).rgb;
        vec3 normalTopLeft2 = getValue(planeBuffer, -width2, width2).rgb;
        vec3 normalBottomRight2 = getValue(planeBuffer, width2, -width2).rgb;
        vec3 normalBottomLeft2 = getValue(planeBuffer, -width2, -width2).rgb;

        planeDiff += -(getIsBackground(normalTop2) - 1.);
        planeDiff += -(getIsBackground(normalBottom2) - 1.);
        planeDiff += -(getIsBackground(normalRight2) - 1.);
        planeDiff += -(getIsBackground(normalLeft2) - 1.);
        planeDiff += -(getIsBackground(normalTopRight2) - 1.);
        planeDiff += -(getIsBackground(normalBottomRight2) - 1.);
        planeDiff += -(getIsBackground(normalBottomRight2) - 1.);
        planeDiff += -(getIsBackground(normalBottomLeft2) - 1.);

        // Tolerance sets the minimum amount of differences to consider
        // this texel an edge

        float line = step(tolerance, planeDiff);

        // Exclude background and apply opacity

        float background = getIsBackground(normal);
        line *= background;
        line *= opacity;
        
        // Add gloss
        
        vec3 gloss = getValue(glossBuffer, 0, 0).xyz;
        float diffGloss = abs(maxGloss - minGloss);
        vec3 glossExpVector = vec3(glossExponent,glossExponent,glossExponent);
        gloss = min(pow(gloss, glossExpVector), vec3(1.,1.,1.));
        gloss *= diffGloss;
        gloss += minGloss;
        vec4 glossedColor = sceneColor + vec4(gloss, 1.) * glossEnabled;
        
        vec4 corrected = mix(sceneColor, glossedColor, background);
        
        // Draw lines
        
        corrected = mix(corrected, vec4(lineColor, 1.), line);
        
        // Add outline
        
        vec4 outlinePreview =getValue(outlineBuffer, 0, 0);
        float outlineColorCorrection = 1. / max(0.2, outlinePreview.a);
        vec3 outlineColor = outlinePreview.rgb * outlineColorCorrection;
        
        // thickness between 10 and 2, opacity between 1 and 0.2
	    int outlineThickness = int(outlinePreview.a * 10.);
	    
	    float outlineDiff = 0.;
        
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 1, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -1, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, -1).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, 1).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, outlineThickness, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -outlineThickness, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, -outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, outlineThickness, outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -outlineThickness, outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -outlineThickness, -outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, outlineThickness, -outlineThickness).a);
        
        float outLine = step(4., outlineDiff) * step(outlineDiff, 12.) * outlineEnabled;
        corrected = mix(corrected, vec4(outlineColor, 1.), outLine);
        
        gl_FragColor = corrected;
	}
			`}createOutlinePostProcessMaterial(){return new Mt({uniforms:{opacity:{value:this._opacity},debugVisualize:{value:0},sceneColorBuffer:{value:null},tolerance:{value:this._tolerance},planeBuffer:{value:null},glossBuffer:{value:null},outlineBuffer:{value:null},glossEnabled:{value:1},minGloss:{value:this._minGloss},maxGloss:{value:this._maxGloss},outlineEnabled:{value:0},glossExponent:{value:this._glossExponent},width:{value:1},lineColor:{value:new ft(this._lineColor)},screenSize:{value:new an(this.resolution.x,this.resolution.y,1/this.resolution.x,1/this.resolution.y)}},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader})}newRenderTarget(){const e=new Ws(this.resolution.x,this.resolution.y);return e.texture.colorSpace="srgb-linear",e.texture.format=qp,e.texture.type=Jc,e.texture.minFilter=li,e.texture.magFilter=li,e.texture.generateMipmaps=!1,e.stencilBuffer=!1,e}}class oT{constructor(e,t,s){if(S(this,"composer"),S(this,"overrideClippingPlanes",!1),S(this,"_components"),S(this,"_world"),S(this,"_renderTarget"),S(this,"_enabled",!1),S(this,"_initialized",!1),S(this,"_n8ao"),S(this,"_customEffects"),S(this,"_basePass"),S(this,"_gammaPass"),S(this,"_depthTexture"),S(this,"_renderer"),S(this,"_settings",{gamma:!0,custom:!0,ao:!1}),!s.renderer)throw new Error("The given world must have a renderer!");this._components=e,this._renderer=t,this._world=s,this._renderTarget=new Ws(window.innerWidth,window.innerHeight),this._renderTarget.texture.colorSpace="srgb-linear",this.composer=new KC(t,this._renderTarget),this.composer.setSize(window.innerWidth,window.innerHeight)}get basePass(){if(!this._basePass)throw new Error("Custom effects not initialized!");return this._basePass}get gammaPass(){if(!this._gammaPass)throw new Error("Custom effects not initialized!");return this._gammaPass}get customEffects(){if(!this._customEffects)throw new Error("Custom effects not initialized!");return this._customEffects}get n8ao(){if(!this._n8ao)throw new Error("Custom effects not initialized!");return this._n8ao}get enabled(){return this._enabled}set enabled(e){this._initialized||this.initialize(),this._enabled=e}get settings(){return{...this._settings}}dispose(){var e,t,s,i;this.composer.dispose(),this._renderTarget.dispose(),(e=this._depthTexture)==null||e.dispose(),(t=this._customEffects)==null||t.dispose(),(s=this._gammaPass)==null||s.dispose(),(i=this._n8ao)==null||i.dispose()}setPasses(e){let t=!1;for(const s in e){const i=s;if(this.settings[i]!==e[i]){t=!0;break}}if(t){for(const s in e){const i=s;this._settings[i]!==void 0&&(this._settings[i]=e[i])}this.updatePasses()}}setSize(e,t){if(!(e===0||t===0)&&this._initialized){const s=this._settings.custom;s&&this.setPasses({custom:!1}),this.setPasses({custom:!1}),this.composer.setSize(e,t),this.basePass.setSize(e,t),this.n8ao.setSize(e,t),this.customEffects.setSize(e,t),this.gammaPass.setSize(e,t),s&&this.setPasses({custom:!0})}}update(){this._enabled&&this.composer.render()}updateCamera(){const e=this._world.camera.three;this._n8ao&&(this._n8ao.camera=e),this._customEffects&&(this._customEffects.renderCamera=e),this._basePass&&(this._basePass.camera=e)}updateProjection(e){this.composer.passes.forEach(t=>{t.camera=e}),this.update()}initialize(){if(!this._world.renderer)throw new Error("The given world must have a renderer!");const e=this._world.scene.three,t=this._world.camera.three;if(!(e instanceof js))throw new Error("The given scene must have a THREE.Scene as core!");const s=this._world.camera;s.projection&&s.projection.onChanged.add(()=>{this.updateCamera()});const i=this._world.renderer;this.overrideClippingPlanes||(this._renderer.clippingPlanes=i.clippingPlanes),this._renderer.outputColorSpace="srgb",this._renderer.toneMapping=GE,this.newBasePass(e,t),this.newSaoPass(e,t),this.newGammaPass(),this.newCustomPass(e,t),this._initialized=!0,this.updatePasses()}updatePasses(){for(const e of this.composer.passes)this.composer.removePass(e);this._basePass&&this.composer.addPass(this.basePass),this._settings.gamma&&this.composer.addPass(this.gammaPass),this._settings.ao&&this.composer.addPass(this.n8ao),this._settings.custom&&this.composer.addPass(this.customEffects)}newCustomPass(e,t){this._customEffects=new rT(new Ue(window.innerWidth,window.innerHeight),this._components,this._world,e,t)}newGammaPass(){this._gammaPass=new Nm(sT)}newSaoPass(e,t){if(!this._world.renderer)throw new Error("The given world must have a renderer!");const{width:s,height:i}=this._world.renderer.getSize();this._n8ao=new tT(e,t,s,i);const{configuration:n}=this._n8ao;n.aoSamples=16,n.denoiseSamples=1,n.denoiseRadius=13,n.aoRadius=1,n.distanceFalloff=4,n.aoRadius=1,n.intensity=4,n.halfRes=!0,n.color=new ft().setHex(13421772,"srgb-linear")}newBasePass(e,t){this._basePass=new ZC(e,t)}}class Bc extends RC{constructor(e,t,s){super(e,t,s),S(this,"_postproduction"),this.onResize.add(i=>this.resizePostproduction(i)),this.onWorldChanged.add(()=>{this.currentWorld&&(this._postproduction&&this._postproduction.dispose(),this._postproduction=new oT(e,this.three,this.currentWorld),this.setPostproductionSize())})}get postproduction(){if(!this._postproduction)throw new Error("Renderer not initialized yet with a world!");return this._postproduction}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger();const e=this.currentWorld.scene.three,t=this.currentWorld.camera.three;this.postproduction.enabled?this.postproduction.composer.render():this.three.render(e,t),e instanceof js&&this.three2D.render(e,t),this.onAfterUpdate.trigger()}dispose(){super.dispose(),this.postproduction.dispose()}resizePostproduction(e){this.postproduction&&this.setPostproductionSize(e)}setPostproductionSize(e){if(!this.container)return;const t=e?e.x:this.container.clientWidth,s=e?e.y:this.container.clientHeight;this.postproduction.setSize(t,s)}}class aT{constructor(e,t,s,i,n){S(this,"mesh",new J(new ze)),S(this,"components"),S(this,"world"),S(this,"styleName"),S(this,"_precission",1e4),S(this,"_tempVector",new O),S(this,"_plane"),S(this,"_geometry"),S(this,"_outlinedMesh"),S(this,"_plane2DCoordinateSystem",new de),S(this,"_planeAxis"),this.components=e,this.world=t,this.mesh.material=n,this.mesh.frustumCulled=!1,this.mesh.userData.indexFragmentMap=new Map,this._plane=s;const{x:r,y:o,z:a}=s.normal;Math.abs(r)===1?this._planeAxis="x":Math.abs(o)===1?this._planeAxis="y":Math.abs(a)===1&&(this._planeAxis="z"),this._geometry=i,this.mesh.geometry.attributes.position=i.attributes.position;const l=s.normal.clone().multiplyScalar(.01);this._outlinedMesh=new J(this.mesh.geometry),this.mesh.position.copy(l),this._outlinedMesh.position.copy(l),this.visible=!0}get visible(){return this.mesh.parent!==null}set visible(e){const t=this.getStyleAndScene();if(e){if(this.world.scene.three.add(this.mesh),t){const{style:s,outlineScene:i}=t;this._outlinedMesh.material=s.material,s.meshes.add(this._outlinedMesh),i.add(this._outlinedMesh)}}else if(this.mesh.removeFromParent(),t){const{style:s}=t;s.meshes.delete(this._outlinedMesh),this._outlinedMesh.removeFromParent()}}set geometry(e){this._geometry=e,this.mesh.geometry.attributes.position=e.attributes.position}dispose(){const e=this.getStyleAndScene();if(e){const{style:t}=e;t.meshes.delete(this._outlinedMesh),this._outlinedMesh.removeFromParent()}this.mesh.material=[],this._outlinedMesh.material=[],this.mesh.userData.indexFragmentMap.clear(),this.mesh.userData={},this.mesh.geometry.dispose(),this.mesh.removeFromParent(),this.mesh.geometry=null,this._outlinedMesh.geometry=null,this.mesh=null,this._plane=null,this._geometry=null,this.components=null}update(e,t){const s=this._geometry.attributes.position.array;if(!s)return;this.updatePlane2DCoordinateSystem();const{userData:i}=this.mesh,n=i.indexFragmentMap;n.clear();let r=0;const o=[];let a=0;const l=this.components.get(Qe);for(const[c,p]of t)for(const u in p){const m=l.list.get(u);m&&(m.mesh.userData.fills||(m.mesh.userData.fills=new Set),m.mesh.userData.fills.add(this.mesh))}for(let c=0;c<e.length;c++){const p=e[c],u=[];for(let T=a;T<p;T+=2)u.push(T*3);const m=this.computeFill(u,s),E=t.get(p);let g=0;for(const T of m)o.push(T),E&&g%3===0&&n.set(r++,E),g++;a=p}this.mesh.geometry.setIndex(o)}computeFill(e,t){const s=new Map,i={},n=new Map;let r=0;const o=new Map,a=new Map,l=new Set,c=this._precission;for(let u=0;u<e.length;u++){const m=e[u];let E=0,g=0,T=0,y=0;const v=t[m],A=t[m+1],C=t[m+2],F=t[m+3],M=t[m+4],_=t[m+5];if(this._tempVector.set(v,A,C),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),E=Math.trunc(this._tempVector.x*c)/c,g=Math.trunc(this._tempVector.y*c)/c,this._tempVector.set(F,M,_),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),T=Math.trunc(this._tempVector.x*c)/c,y=Math.trunc(this._tempVector.y*c)/c,E===T&&g===y)continue;const L=`${E}|${g}`,D=`${T}|${y}`;s.has(L)||s.set(L,m/3),s.has(D)||s.set(D,m/3+1);const B=s.get(L),z=s.get(D);i[B]=[E,g],i[z]=[T,y];const V=a.has(B),Q=o.has(B),ne=a.has(z),ue=o.has(z);if(!V&&!Q&&!ne&&!ue)a.set(B,r),o.set(z,r),l.add(r),n.set(r,[B,z]),r++;else if(V&&ue){const oe=a.get(B),Ie=o.get(z);if(oe!==Ie){const ce=n.get(Ie),ye=n.get(oe);if(!ce||!ye)continue;n.delete(oe),l.delete(oe),o.set(ye[ye.length-1],Ie),o.delete(ce[ce.length-1]);for(const Ze of ye)ce.push(Ze)}else l.delete(Ie);a.delete(B),o.delete(z)}else if(Q&&ne){const oe=a.get(z),Ie=o.get(B);if(oe!==Ie){const ce=n.get(Ie),ye=n.get(oe);if(!ce||!ye)continue;n.delete(oe),l.delete(oe),o.set(ye[ye.length-1],Ie),o.delete(ce[ce.length-1]);for(const Ze of ye)ce.push(Ze)}else l.delete(Ie);a.delete(z),o.delete(B)}else if(V&&ne){const oe=a.get(z),Ie=a.get(B),ce=n.get(Ie),ye=n.get(oe);if(!ce||!ye)continue;n.delete(oe),l.delete(oe),a.delete(ce[0]),a.delete(ye[0]),o.delete(ye[ye.length-1]),a.set(ye[ye.length-1],Ie),ye.reverse(),ce.splice(0,0,...ye)}else if(Q&&ue){const oe=o.get(z),Ie=o.get(B),ce=n.get(Ie),ye=n.get(oe);if(!ce||!ye)continue;n.delete(oe),l.delete(oe),o.delete(ce[ce.length-1]),o.delete(ye[ye.length-1]),a.delete(ye[0]),o.set(ye[0],Ie),ye.reverse(),ce.push(...ye)}else if(V){const oe=a.get(B),Ie=n.get(oe);if(!Ie)continue;Ie.unshift(z),a.delete(B),a.set(z,oe)}else if(Q){const oe=o.get(B),Ie=n.get(oe);if(!Ie)continue;Ie.push(z),o.delete(B),o.set(z,oe)}else if(ne){const oe=a.get(z),Ie=n.get(oe);if(!Ie)continue;Ie.unshift(B),a.delete(z),a.set(B,oe)}else if(ue){const oe=o.get(z),Ie=n.get(oe);if(!Ie)continue;Ie.push(B),o.delete(z),o.set(B,oe)}}const p=[];for(const[u,m]of n){if(l.has(u))continue;const E=[],g=new Map;let T=0;for(const v of m){const A=i[v];E.push(A[0],A[1]),g.set(T++,v)}const y=kC(E);for(const v of y){const A=g.get(v);if(A===void 0)throw new Error("Map error!");p.push(A)}}return p}updatePlane2DCoordinateSystem(){this._plane2DCoordinateSystem=new de;const e=new O(1,0,0),t=new O(0,1,0),s=this._plane.normal,i=new O;this._plane.coplanarPoint(i),this._planeAxis==="x"?e.crossVectors(t,s):this._planeAxis==="y"?t.crossVectors(s,e):this._planeAxis==="z"||(e.crossVectors(t,s).normalize(),t.crossVectors(s,e)),this._plane2DCoordinateSystem.fromArray([e.x,e.y,e.z,0,t.x,t.y,t.z,0,s.x,s.y,s.z,0,i.x,i.y,i.z,1]),this._plane2DCoordinateSystem.invert()}getStyleAndScene(){if(!this.world.renderer)return null;const e=this.world.renderer instanceof Bc;if(this.styleName&&e){const t=this.world.renderer,s=t.postproduction.customEffects.outlinedMeshes[this.styleName],i=t.postproduction.customEffects.outlineScene;return{style:s,outlineScene:i}}return null}}class lT{constructor(e,t,s){S(this,"onDisposed",new te),S(this,"onAfterUpdate",new te),S(this,"onBeforeUpdate",new te),S(this,"enabled",!0),S(this,"fillNeedsUpdate",!1),S(this,"components"),S(this,"world"),S(this,"_edges",{}),S(this,"_visible",!0),S(this,"_inverseMatrix",new de),S(this,"_localPlane",new jt),S(this,"_tempLine",new at),S(this,"_tempVector",new O),S(this,"_plane"),this.components=e,this.world=t,this._plane=s}get visible(){return this._visible}set visible(e){this._visible=e;for(const t in this._edges){const s=this._edges[t];e?this.world.scene.three.add(s.mesh):s.mesh.removeFromParent(),s.fill&&(s.fill.visible=e)}}get fillMeshes(){const e=[];for(const t in this._edges){const s=this._edges[t];s.fill&&e.push(s.fill.mesh)}return e}update(){const e=this.components.get(Ga).styles.list;this.updateDeletedEdges(e);for(const t in e)this.drawEdges(t);this.fillNeedsUpdate=!1}get(){return this._edges}dispose(){const e=Object.keys(this._edges);for(const t of e)this.disposeEdge(t);this.onDisposed.trigger(),this.onDisposed.reset()}newEdgesMesh(e){const t=this.components.get(Ga).styles.list[e].lineMaterial,s=new ze,i=new Float32Array(3e5),n=new Ct(i,3,!1);n.setUsage(HE),s.setAttribute("position",n);const r=new WE(s,t);return r.frustumCulled=!1,r}newFillMesh(e,t){const s=this.components.get(Ga).styles.list[e],i=s.fillMaterial;if(i){const n=new aT(this.components,this.world,this._plane,t,i);return this.newFillOutline(e,n,s),n}}newFillOutline(e,t,s){if(!s.outlineMaterial||!this.world.renderer)return;const i=this.world.renderer;if(i instanceof Bc){const n=i.postproduction.customEffects.outlinedMeshes;n[e]||(n[e]={meshes:new Set,material:s.outlineMaterial}),t.styleName=e}}drawEdges(e){const t=this.components.get(Ga).styles.list[e];this._edges[e]||this.initializeStyle(e);const s=this._edges[e];let i=0;const n=s.mesh.geometry.attributes.position;n.array.fill(0);const r=[];let o=0;const a=new Map;for(const c of t.meshes)if(c.geometry){if(!c.geometry.boundsTree)throw new Error("Bounds tree not found for clipping edges subset.");if(c instanceof Ot){if(c.count===0)continue;const p=c;for(let u=0;u<p.count;u++){const m=p instanceof Zc,E=p,g=t.fragments[E.fragment.id];if(m&&g){const v=E.fragment.getItemID(u);if(v===null||!g.has(v))continue}const T=new J(c.geometry);T.matrix.copy(c.matrix);const y=new de;if(p.getMatrixAt(u,y),T.applyMatrix4(y),T.applyMatrix4(c.matrixWorld),T.updateMatrix(),T.updateMatrixWorld(),this._inverseMatrix.copy(T.matrixWorld).invert(),this._localPlane.copy(this._plane).applyMatrix4(this._inverseMatrix),i=this.shapecast(T,n,i),i!==o){if(m&&g){const v=E.fragment.getItemID(u);v!==null&&a.set(i,{[E.fragment.id]:new Set([v])})}r.push(i),o=i}}}else this._inverseMatrix.copy(c.matrixWorld).invert(),this._localPlane.copy(this._plane).applyMatrix4(this._inverseMatrix),i=this.shapecast(c,n,i),i!==o&&(r.push(i),o=i)}s.mesh.geometry.setDrawRange(0,i),s.mesh.position.copy(this._plane.normal).multiplyScalar(1e-4),n.needsUpdate=!0;const l=s.mesh.geometry.attributes.position;Number.isNaN(l.array[0])||this.fillNeedsUpdate&&s.fill&&(s.fill.geometry=s.mesh.geometry,s.fill.update(r,a),s.fill.visible=this._visible)}initializeStyle(e){const t=this.newEdgesMesh(e),s=t.geometry,i=this.newFillMesh(e,s);this._edges[e]={mesh:t,name:e,fill:i}}shapecast(e,t,s){return e.geometry.boundsTree.shapecast({intersectsBounds:i=>this._localPlane.intersectsBox(i),intersectsTriangle:i=>{let n=0;if(this._tempLine.start.copy(i.a),this._tempLine.end.copy(i.b),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const r=this._tempVector.applyMatrix4(e.matrixWorld);t.setXYZ(s,r.x,r.y,r.z),n++,s++}if(this._tempLine.start.copy(i.b),this._tempLine.end.copy(i.c),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const r=this._tempVector.applyMatrix4(e.matrixWorld);t.setXYZ(s,r.x,r.y,r.z),n++,s++}if(this._tempLine.start.copy(i.c),this._tempLine.end.copy(i.a),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const r=this._tempVector.applyMatrix4(e.matrixWorld);t.setXYZ(s,r.x,r.y,r.z),n++,s++}n!==2&&(s-=n)}}),s}updateDeletedEdges(e){const t=Object.keys(this._edges);for(const s of t)e[s]===void 0&&(this.disposeEdge(s),this.disposeOutline(s))}disposeOutline(e){if(!this.world.renderer)return;const t=this.world.renderer;if(t instanceof Bc){const s=t.postproduction.customEffects.outlinedMeshes;delete s[e]}}disposeEdge(e){const t=this.components.get(Ks),s=this._edges[e];s.fill&&s.fill.dispose(),t.destroy(s.mesh,!1),delete this._edges[e]}}class al extends Sl{constructor(e,t,s,i,n,r=5,o=!0){super(e,t,s,i,n,r,o),S(this,"edges"),S(this,"edgesMaxUpdateRate",50),S(this,"_visible",!0),S(this,"_edgesVisible",!0),S(this,"updateFill",()=>{this.edges.fillNeedsUpdate=!0,this.edges.update()}),this.edges=new lT(e,t,this.three),this.toggleControls(!0),this.edges.visible=!0,this.onDraggingEnded.add(()=>{this.updateFill(),this.edges.visible=!0}),this.onDraggingStarted.add(()=>this.edges.visible=!1)}get visible(){return this._visible}set visible(e){super.visible=e,this.toggleControls(e)}set enabled(e){this._enabled=e,this.world.renderer&&this.world.renderer.setPlane(e,this.three)}get enabled(){return super.enabled}dispose(){super.dispose(),this.edges.dispose()}}class hT{constructor(){S(this,"onDisposed",new te),S(this,"enabled",!0),S(this,"list",{}),S(this,"_defaultLineMaterial",new qs({color:0,linewidth:.001})),S(this,"onAfterUpdate",new te),S(this,"onBeforeUpdate",new te)}update(e){this.onBeforeUpdate.trigger(this.list),this.onAfterUpdate.trigger(this.list)}create(e,t,s,i,n,r){if(!s.renderer)throw new Error("The given world doesn't have a renderer!");i||(i=this._defaultLineMaterial);for(const l of t)l.geometry.boundsTree||l.geometry.computeBoundsTree();const o=s.renderer;i.clippingPlanes=o.clippingPlanes;const a={name:e,lineMaterial:i,meshes:t,fillMaterial:n,outlineMaterial:r,fragments:{}};return this.list[e]=a,a}dispose(){const e=Object.keys(this.list);for(const t of e)this.deleteStyle(t);this.list={},this.onDisposed.trigger(),this.onDisposed.reset()}deleteStyle(e,t=!0){var s,i;const n=this.list[e];n&&(n.meshes.clear(),t&&(n.lineMaterial.dispose(),(s=n.fillMaterial)==null||s.dispose(),(i=n.outlineMaterial)==null||i.dispose())),delete this.list[e]}}const Bm=class zm extends De{constructor(e){super(e),S(this,"onDisposed",new te),S(this,"enabled",!0),S(this,"styles"),S(this,"fillsNeedUpdate",!1),S(this,"_visible",!0),this.components.list.set(zm.uuid,this),this.styles=new hT}get visible(){return this._visible}set visible(e){this._visible=e;const t=this.components.get(uo);for(const s of t.list)s instanceof al&&(s.edges.visible=e)}dispose(){this.styles.dispose(),this.onDisposed.trigger()}async update(e=!1){if(!this.enabled)return;const t=this.components.get(uo);for(const s of t.list)s instanceof al&&(e||this.fillsNeedUpdate?s.updateFill():s.update());this.fillsNeedUpdate=!1}};S(Bm,"uuid","24dfc306-a3c4-410f-8071-babc4afa5e4d");let Ga=Bm;const cT={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},dT={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`},Ym=class jn extends De{constructor(e){super(e),S(this,"onDisposed",new te),S(this,"enabled",!0),S(this,"cameraHeight",10),S(this,"darkness",1.2),S(this,"opacity",1),S(this,"resolution",512),S(this,"amount",3.5),S(this,"planeColor",16777215),S(this,"shadowOffset",0),S(this,"shadowExtraScaleFactor",1.5),S(this,"list",{}),S(this,"tempMaterial",new It({visible:!1})),S(this,"depthMaterial",new Qc),this.components.add(jn.uuid,this),this.initializeDepthMaterial()}dispose(){for(const e in this.list)this.deleteShadow(e);this.tempMaterial.dispose(),this.depthMaterial.dispose(),this.components=null,this.onDisposed.trigger(jn.uuid),this.onDisposed.reset()}create(e,t,s){if(this.list[t])throw new Error(`There is already a shadow with ID ${t}`);const{size:i,center:n,min:r}=this.getSizeCenterMin(e),o=this.createShadow(t,i,s);return this.initializeShadow(o,n,r),this.createPlanes(o,i),this.bakeShadow(e,o),o.root}deleteShadow(e){const t=this.components.get(Ks),s=this.list[e];if(delete this.list[e],!s)throw new Error(`No shadow with ID ${e} was found.`);t.destroy(s.root),t.destroy(s.blurPlane),s.rt.dispose(),s.rtBlur.dispose()}createPlanes(e,t){const s=new hn(t.x,t.z).rotateX(Math.PI/2);this.createBasePlane(e,s),jn.createBlurPlane(e,s)}initializeShadow(e,t,s){this.initializeRoot(e,t,s),jn.initializeRenderTargets(e),jn.initializeCamera(e)}bakeShadow(e,t){const s=t.world.scene.three;if(!(s instanceof js))throw new Error("The core of the scene of the world must be a scene!");if(!t.world.renderer)throw new Error("The given world must have a renderer!");const i=t.world.renderer.three,n=e.map(l=>!!l.parent);for(let l=0;l<e.length;l++)n[l]||s.add(e[l]);const r=s.children.filter(l=>!e.includes(l)&&l!==t.root);for(let l=r.length-1;l>=0;l--)s.remove(r[l]);const o=s.background;s.background=null,s.overrideMaterial=this.depthMaterial;const a=[];for(const l of e)a.push(l.visible),l.visible=!0;i.setRenderTarget(t.rt),i.render(s,t.camera),s.overrideMaterial=null,this.blurShadow(t,this.amount),this.blurShadow(t,this.amount*.4),i.setRenderTarget(null),s.background=o;for(let l=0;l<e.length;l++)e[l].visible=a[l];for(let l=r.length-1;l>=0;l--)s.add(r[l]);for(let l=0;l<e.length;l++)n[l]||s.remove(e[l])}static initializeCamera(e){e.camera.rotation.x=Math.PI/2,e.root.add(e.camera)}static initializeRenderTargets(e){e.rt.texture.generateMipmaps=!1,e.rtBlur.texture.generateMipmaps=!1}initializeRoot(e,t,s){const i=e.world.scene.three;e.root.position.set(t.x,s.y-this.shadowOffset,t.z),i.add(e.root)}createBasePlane(e,t){const s=this.createPlaneMaterial(e),i=new J(t,s);i.renderOrder=2,e.root.add(i),i.scale.y=-1}static createBlurPlane(e,t){e.blurPlane.geometry=t,e.blurPlane.visible=!1,e.root.add(e.blurPlane)}createPlaneMaterial(e){if(!e.world.renderer)throw new Error("The given world must have a renderer!");const t=e.world.renderer.three;return new It({map:e.rt.texture,opacity:this.opacity,transparent:!0,depthWrite:!1,clippingPlanes:t.clippingPlanes})}initializeDepthMaterial(){this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1;const e="gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );",t="gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * darkness );";this.depthMaterial.userData.darkness={value:this.darkness},this.depthMaterial.onBeforeCompile=s=>{s.uniforms.darkness=this.depthMaterial.userData.darkness,s.fragmentShader=`
						uniform float darkness;
						${s.fragmentShader.replace(e,t)}
					`}}createShadow(e,t,s){return this.list[e]={root:new sl,world:s,rt:new Ws(this.resolution,this.resolution),rtBlur:new Ws(this.resolution,this.resolution),blurPlane:new J,camera:this.createCamera(t)},this.list[e]}createCamera(e){return new di(-e.x/2,e.x/2,e.z/2,-e.z/2,0,this.cameraHeight)}getSizeCenterMin(e){const t=e[0].parent,s=new sl;s.children=e;const i=new Me().setFromObject(s);t==null||t.add(...e);const n=new O;i.getSize(n),n.x*=this.shadowExtraScaleFactor,n.z*=this.shadowExtraScaleFactor;const r=new O;i.getCenter(r);const o=i.min;return{size:n,center:r,min:o}}blurShadow(e,t){if(!e.world.renderer)throw new Error("The given world must have a renderer!");const s=new Mt(cT);s.depthTest=!1;const i=new Mt(dT);i.depthTest=!1,e.blurPlane.visible=!0,e.blurPlane.material=s,e.blurPlane.material.uniforms.tDiffuse.value=e.rt.texture,s.uniforms.h.value=t*1/256;const n=e.world.renderer.three;n.setRenderTarget(e.rtBlur),n.render(e.blurPlane,e.camera),e.blurPlane.material=i,e.blurPlane.material.uniforms.tDiffuse.value=e.rtBlur.texture,i.uniforms.v.value=t*1/256,n.setRenderTarget(e.rt),n.render(e.blurPlane,e.camera),e.blurPlane.visible=!1}};S(Ym,"uuid","f833a09a-a3ab-4c58-b03e-da5298c7a1b6");let ry=Ym;const uT=["Station","Radius","Length","InitialKP","FinalKP","KP","Slope","Height","InitialKPV","FinalKPV"],km=class Vm extends De{constructor(e){super(e),S(this,"enabled",!0),S(this,"world",null),S(this,"_markerKey",0),S(this,"_list",new Map),S(this,"type","horizontal"),S(this,"divisionLength",100),e.add(Vm.uuid,this)}addKPStation(e,t,s){const i=this.components.get(Ji),n=document.createElement("div"),r=document.createElement("div");n.appendChild(r),r.innerHTML=t,r.style.color=i.color,r.style.borderBottom="1px dotted white",r.style.width="160px",r.style.textAlign="left";const o=new Zt(e,n),a=new O;a.x=s.geometry.attributes.position.getX(s.geometry.attributes.position.count-1),a.y=s.geometry.attributes.position.getY(s.geometry.attributes.position.count-1),a.z=s.geometry.attributes.position.getZ(s.geometry.attributes.position.count-1);const l=new O;l.x=s.geometry.attributes.position.getX(s.geometry.attributes.position.count-2),l.y=s.geometry.attributes.position.getY(s.geometry.attributes.position.count-2),l.z=s.geometry.attributes.position.getZ(s.geometry.attributes.position.count-2);const c=new O;c.x=(a.x+l.x)/2,c.y=(a.y+l.y)/2,c.z=(a.z+l.z)/2,o.three.position.copy(c);const p=new O;p.subVectors(a,l).normalize();const u=new ct;u.setFromUnitVectors(new O(0,1,0),p);const m=new Xc().setFromQuaternion(u).z,E=ln.radToDeg(m);r.style.transform=`rotate(${-E-90}deg) translate(-35%, -50%)`;const g=this._markerKey.toString();i.setupEvents(e,!0),i.getWorldMarkerList(e).set(g,{label:o,key:g,merged:!1,static:!1}),this._markerKey++,this.save(g,"KP")}addVerticalMarker(e,t,s,i,n){const r=this.components.get(Ji),o=document.createElement("span");o.innerHTML=t,o.style.color=r.color;const a=new Zt(e,o,n);if(i==="Height"){const c=document.createElement("span");c.innerHTML=t,c.style.color=r.color;const{position:p}=s.geometry.attributes,u=(p.array.length/3-1)*3,m=p.array.slice(u,u+3);a.three.position.set(m[0],m[1]+10,m[2])}else if(i==="InitialKPV"){const{position:c}=s.geometry.attributes,p=c.getX(0),u=c.getY(0),m=c.getZ(0);a.three.position.set(p-20,u,m)}else if(i==="FinalKPV"){const{position:c}=s.geometry.attributes,p=c.getX(s.geometry.attributes.position.count-1),u=c.getY(s.geometry.attributes.position.count-1),m=c.getZ(s.geometry.attributes.position.count-1);a.three.position.set(p+20,u,m)}else if(i==="Slope"){o.style.color="grey";const{position:c}=s.geometry.attributes,p=new O;p.x=c.getX(0),p.y=c.getY(0),p.z=c.getZ(0);const u=new O;u.x=c.getX(c.count-1),u.y=c.getY(c.count-1),u.z=c.getZ(c.count-1);const m=new O;m.addVectors(p,u).multiplyScalar(.5),a.three.position.set(m.x,m.y-10,m.z)}const l=this._markerKey.toString();return r.setupEvents(e,!0),r.getWorldMarkerList(e).set(l,{label:a,key:l,type:i,merged:!1,static:!1}),this._markerKey++,this.save(l,i),a}addCivilMarker(e,t,s,i){const n=this.components.get(Ji),r=document.createElement("span");r.innerHTML=t,r.style.color=n.color;const o=new Zt(e,r);if(i==="InitialKP"){const l=s.geometry.attributes.position.getX(0),c=s.geometry.attributes.position.getY(0),p=s.geometry.attributes.position.getZ(0);o.three.position.set(l+2,c+2,p)}else if(i==="FinalKP"){const l=s.geometry.attributes.position.getX(s.geometry.attributes.position.count-1),c=s.geometry.attributes.position.getY(s.geometry.attributes.position.count-1),p=s.geometry.attributes.position.getZ(s.geometry.attributes.position.count-1);o.three.position.set(l+2,c-2,p)}else if(i==="Length"){const l=new O;l.x=s.geometry.attributes.position.getX(0),l.y=s.geometry.attributes.position.getY(0),l.z=s.geometry.attributes.position.getZ(0);const c=new O;c.x=s.geometry.attributes.position.getX(s.geometry.attributes.position.count-1),c.y=s.geometry.attributes.position.getY(s.geometry.attributes.position.count-1),c.z=s.geometry.attributes.position.getZ(s.geometry.attributes.position.count-1);const p=l.distanceTo(c);o.three.element.innerText=p.toFixed(2);const u=c.clone().add(l).divideScalar(2);o.three.position.copy(u)}const a=this._markerKey.toString();return n.setupEvents(e,!0),n.getWorldMarkerList(e).set(a,{label:o,key:a,type:i,merged:!1,static:!1}),this._markerKey++,this.save(a,i),o}showKPStations(e){if(!this.world)throw new Error("A world is needed for this component to work!");if(this.type==="horizontal"){const t=this.generateStartAndEndKP(e);for(const[,i]of t)this.addKPStation(this.world,i.value,i.normal);const s=this.generateConstantKP(e);for(const[,i]of s)this.addKPStation(this.world,i.value,i.normal)}}showCurveLength(e,t){if(!this.world)throw new Error("A world is needed for this component to work!");const s=this.components.get(Ji),i=e.length,n=`${t.toFixed(2)} m`,r=Math.round(i/2),o=e[r],a=s.create(this.world,n,o,!0);a!==void 0&&this.save(a,"Radius")}showLineLength(e,t){if(!this.world)throw new Error("A world is needed for this component to work!");const s=this.components.get(Ji),i=new O;i.x=e.geometry.getAttribute("position").getX(0),i.y=e.geometry.getAttribute("position").getY(0),i.z=e.geometry.getAttribute("position").getZ(0);const n=new O;n.x=e.geometry.getAttribute("position").getX(1),n.y=e.geometry.getAttribute("position").getY(1),n.z=e.geometry.getAttribute("position").getZ(1);const r=`${t.toFixed(2)} m`,o=new O;o.addVectors(i,n).multiplyScalar(.5);const a=s.create(this.world,r,o,!0);a!==void 0&&this.save(a,"Radius")}showCurveRadius(e,t){if(!this.world)throw new Error("A world is needed for this component to work!");const s=this.components.get(Ji),i=new O;i.x=e.geometry.getAttribute("position").getX(0),i.y=e.geometry.getAttribute("position").getY(0),i.z=e.geometry.getAttribute("position").getZ(0);const n=new O;n.x=e.geometry.getAttribute("position").getX(1),n.y=e.geometry.getAttribute("position").getY(1),n.z=e.geometry.getAttribute("position").getZ(1);const r=`R = ${t.toFixed(2)} m`,o=new O;o.addVectors(i,n).multiplyScalar(.5);const a=s.create(this.world,r,o,!0);a!==void 0&&this.save(a,"Radius")}deleteByType(e=uT){const t=this.components.get(Ji);for(const s of e){const i=this._list.get(s);if(i){for(const n of i)t.delete(n);this._list.delete(s)}}}generateStartAndEndKP(e){const{alignment:t}=e.curve,s=new Map;for(const i of t.horizontal){const n=i.getLength();if(s.size>0){const r=i.index-1,o=s.get(r).distance+n,a=i.mesh.geometry.getAttribute("position"),l=a.count-1,c=new O;c.x=a.getX(l),c.y=a.getY(l),c.z=a.getZ(l);const p=this.createNormalLine(i.mesh);s.set(i.index,{value:this.getShortendKPValue(o),distance:o,point:c,normal:p})}else{const r=i.mesh.geometry.getAttribute("position"),o=r.count-1,a=new O;a.x=r.getX(o),a.y=r.getY(o),a.z=r.getZ(o);const l=this.createNormalLine(i.mesh);s.set(i.index,{value:this.getShortendKPValue(n),distance:n,point:a,normal:l})}}return s}createNormalLine(e){const t=e.geometry.attributes.position.count-1,s=t-1,i=new O;i.x=e.geometry.attributes.position.getX(t),i.y=e.geometry.attributes.position.getY(t),i.z=e.geometry.attributes.position.getZ(t);const n=new O;n.x=e.geometry.attributes.position.getX(s),n.y=e.geometry.attributes.position.getY(s),n.z=e.geometry.attributes.position.getZ(s);const r=new O().subVectors(i,n).clone().applyAxisAngle(new O(0,0,1),Math.PI*.5).normalize(),o=new ze().setFromPoints([r.clone().setLength(10).add(i),r.clone().setLength(-10).add(i)]);return new je(o)}generateConstantKP(e){const{alignment:t}=e.curve,s=new Map,i=t.getLength("horizontal"),n=Math.floor(i/this.divisionLength);for(let r=0;r<n;r++){const o=r/n,a=t.getPointAt(o,"horizontal"),l=i*o,c=this.getNormal(t,a);s.set(r,{value:this.getShortendKPValue(l),distance:l,point:a,normal:c})}return s}getNormal(e,t){const s=[],i={start:new O,end:new O};for(let o=0;o<e.horizontal.length;o++){const a=e.horizontal[o].mesh.geometry.attributes.position,l=a.count;for(let c=0;c<l;c++){const p=a.getX(c),u=a.getY(c),m=a.getZ(c);s.push(new O(p,u,m))}}for(let o=0;o<s.length-1;o++){const a=s[o],l=s[o+1],c=a.distanceTo(t),p=l.distanceTo(t),u=a.distanceTo(l);Math.abs(c+p-u)<1e-5&&(i.start=a,i.end=l)}const n=new O().subVectors(i.end,i.start).clone().applyAxisAngle(new O(0,0,1),Math.PI*.5).normalize(),r=new ze().setFromPoints([n.clone().setLength(10).add(t),n.clone().setLength(-10).add(t)]);return new je(r,new qs({color:16711680}))}getShortendKPValue(e){const t=e.toFixed(2),[s,i]=t.toString().split("."),n=i||"00";if(parseInt(s,10)>1e3&&parseInt(s,10)<1e4){const[r,...o]=s;return`${r}+${o.join("")}.${n}`}if(parseInt(s,10)>1e4){const[r,o,...a]=s;return`${r}${o}+${a.join("")}.${n}`}return`0+${s.padStart(3,"0")}.${n}`}save(e,t){this._list.has(t)||this._list.set(t,new Set),this._list.get(t).add(e)}};S(km,"uuid","0af12c32-81ee-4100-a030-e9ae546f6170");let lo=km;class Gm extends De{constructor(e){super(e),S(this,"onHighlight",new te),S(this,"onMarkerChange",new te),S(this,"onMarkerHidden",new te),S(this,"onDisposed",new te),S(this,"enabled",!0),S(this,"mouseMarkers"),S(this,"_curves",[]),S(this,"_previousAlignment",null),S(this,"_highlighter"),S(this,"_world",null),S(this,"updateLinesResolution",t=>{var s;(s=this._highlighter)==null||s.setResolution(t)}),S(this,"onMouseMove",t=>{var s,i,n;if(!this._world)throw new Error("No world was given for this navigator!");if(!this._world.renderer)return;const r=this._world.renderer.three.domElement.parentElement,o=this._world.camera.three,a=(s=this._highlighter)==null?void 0:s.castRay(t,o,r,this._curves);if(a){const{object:l}=a;(i=this._highlighter)==null||i.hover(l),this.updateMarker(a,"hover");return}this.mouseMarkers&&(this.mouseMarkers.hover.visible=!1),(n=this._highlighter)==null||n.unHover(),this.onMarkerHidden.trigger({type:"hover"})}),S(this,"onClick",t=>{var s,i;if(!this._world)throw new Error("No world was given for this navigator!");if(!this._world.renderer)return;const n=this._world.renderer.three.domElement.parentElement,r=this._world.camera.three,o=(s=this._highlighter)==null?void 0:s.castRay(t,r,n,this._curves);if(o){const a=o,l=a.object;if((i=this._highlighter)==null||i.select(l),this.updateMarker(a,"select"),this._world.camera.hasCameraControls()&&(l.geometry.boundingBox||l.geometry.computeBoundingBox(),l.geometry.boundingBox)){const c=this.getScaledBox(l.geometry.boundingBox,2);this._world.camera.controls.fitToBox(c,!0)}this.onHighlight.trigger({mesh:l,point:a.point}),this._previousAlignment!==l.curve.alignment&&(this.components.get(lo).showKPStations(l),this._previousAlignment=l.curve.alignment)}}),S(this,"onControlsUpdated",()=>{if(!this._world)throw new Error("No world was given for this navigator!");if(!(this._world.camera.three instanceof di)||!this._highlighter)return;const{zoom:t,left:s,right:i,top:n,bottom:r}=this._world.camera.three,o=s-i,a=n-r,l=Math.max(o,a)/t,c=40,{caster:p}=this._highlighter;p.params.Line.threshold=l/c})}get highlighter(){if(!this._highlighter)throw new Error("Highlighter not initialized. You must set a world first!");return this._highlighter}get world(){return this._world}set world(e){var t,s,i;if(e===this._world||(this._world&&this.setupEvents(!1),this._world=e,(t=this._highlighter)==null||t.dispose(),(s=this.mouseMarkers)==null||s.hover.dispose(),(i=this.mouseMarkers)==null||i.select.dispose(),!e))return;const n=e.scene.three;this._highlighter=new Sm(n,this.view),this.mouseMarkers={select:this.newMouseMarker("#ffffff",e),hover:this.newMouseMarker("#575757",e)},this.setupEvents(!0)}async draw(e,t){if(!e.civilData)throw new Error("The provided model doesn't have civil data!");if(!this._world)throw new Error("No world was given for this navigator!");const{alignments:s}=e.civilData,i=t||s.values(),n=this._world.scene.three,r=new Me;r.makeEmpty(),r.min.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r.max.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(const a of i){if(!a)throw new Error("Alignment not found!");for(const l of a[this.view])if(n.add(l.mesh),this._curves.push(l.mesh),!r.isEmpty())r.expandByObject(l.mesh);else{l.mesh.geometry.computeBoundingBox();const c=l.mesh.geometry.boundingBox;c instanceof Me&&r.copy(c).applyMatrix4(l.mesh.matrixWorld)}}const o=this.getScaledBox(r,1.2);this._world.camera.hasCameraControls()&&await this._world.camera.controls.fitToBox(o,!1)}async dispose(){var e;(e=this._highlighter)==null||e.dispose(),this.clear(),this.onHighlight.reset(),this._curves=[],this.onDisposed.trigger(),this.onDisposed.reset()}clear(){var e,t;(e=this._highlighter)==null||e.unSelect(),(t=this._highlighter)==null||t.unHover();for(const s of this._curves)s.removeFromParent();this._curves=[]}setMarker(e,t,s){if(!this._curves.length)return;const i=e.getCurveAt(t,this.view),n=e.getPointAt(t,this.view),{index:r}=i.curve.getSegmentAt(i.percentage);this.setMouseMarker(n,i.curve.mesh,r,s)}setDefSegments(e){const t=[],s=[],i=(n,r)=>{const o=r[1]-n[1],a=r[0]-n[0];return o/a};for(let n=0;n<e.length;n++){const r=e[n];let o,a,l,c;for(let u=0;u<Object.keys(r).length/3;u++)if(r[u*3]!==void 0&&r[u*3+1]!==void 0){o=r[u*3],a=r[u*3+1];break}for(let u=Object.keys(r).length/3-1;u>=0;u--)if(r[u*3]!==void 0&&r[u*3+1]!==void 0){l=r[u*3],c=r[u*3+1];break}const p=(i([o,a],[l,c])*100).toFixed(2);s.push({slope:p})}for(const n of e)for(let r=0;r<n.length-3;r+=3){const o=n[r],a=n[r+1],l=n[r+2],c=n[r+3],p=n[r+4],u=n[r+5];t.push({start:new O(o,a,l),end:new O(c,p,u)})}return{defSegments:t,slope:s}}hideMarker(e){this.mouseMarkers&&(this.mouseMarkers[e].visible=!1)}setupEvents(e){var t,s;if(!this._world)throw new Error("No world was given for this navigator!");if(this._world.isDisposing||!this._world.renderer)return;const i=this._world.renderer.three.domElement.parentElement;(t=this._world.renderer)==null||t.onResize.remove(this.updateLinesResolution),i.removeEventListener("pointermove",this.onMouseMove),i.removeEventListener("click",this.onClick),this._world.camera.hasCameraControls()&&this._world.camera.controls.removeEventListener("update",this.onControlsUpdated),e&&(i.addEventListener("pointermove",this.onMouseMove),i.addEventListener("click",this.onClick),(s=this._world.renderer)==null||s.onResize.add(this.updateLinesResolution),this._world.camera.hasCameraControls()&&this._world.camera.controls.addEventListener("update",this.onControlsUpdated))}newMouseMarker(e,t){if(!this._world)throw new Error("No world was given for this navigator!");const s=t.scene.three,i=document.createElement("div"),n=document.createElement("div");i.appendChild(n),n.style.backgroundColor=e,n.style.width="3rem",n.style.height="3px";const r=new Zt(this._world,i,s);return r.visible=!1,r}setMouseMarker(e,t,s,i){if(s===void 0||!this.mouseMarkers)return;this.mouseMarkers[i].visible=!0;const n=this.mouseMarkers[i].three;n.position.copy(e);const r=t,{startPoint:o,endPoint:a}=r.curve.getSegment(s),l=Math.atan2(a.y-o.y,a.x-o.x),c=n.element.children[0],p=90-l/Math.PI*180;c.style.transform=`rotate(${p}deg)`}updateMarker(e,t){const{point:s,index:i,object:n}=e,r=n,o=r.curve,a=r.curve.alignment,l=a.getPercentageAt(s,this.view),c=s.clone();this.setMouseMarker(c,r,i,t),l!==null&&this.onMarkerChange.trigger({alignment:a,percentage:l,type:t,curve:o})}getScaledBox(e,t){const s=new Me,i=new O,n=new O;return e.getCenter(n),e.getSize(i),i.multiplyScalar(t),s.setFromCenterAndSize(n,i),s}}class pT{constructor(e,t,s){S(this,"components"),S(this,"_scene"),S(this,"_world"),S(this,"offset",10),S(this,"markupLines",[]),S(this,"currentCurveMesh"),S(this,"markupMaterial",new qs({color:6842472})),this.components=e,this._scene=t,this._world=s}showCurveInfo(e){switch(this.disposeMarkups(),this.currentCurveMesh=e,e.curve.data.TYPE){case"LINE":this.showLineInfo(e,this.offset);break;case"CIRCULARARC":this.showCircularArcInfo(e,this.offset);break;case"CLOTHOID":this.showClothoidInfo(e,this.offset);break;default:console.log("Unknown curve type:",e.curve.data.TYPE);break}}updateOffset(e,t,s){const i=Math.max(e.height,e.width)/(t*150);i!==this.offset&&(this.offset=i,s&&this.currentCurveMesh&&this.showCurveInfo(this.currentCurveMesh))}dispose(){for(const e of this.markupLines)e.removeFromParent();this.disposeMarkups(),this.markupMaterial.dispose()}disposeMarkups(){for(const e of this.markupLines)e.geometry.dispose(),e.removeFromParent();this.markupLines=[]}unSelect(){this.disposeMarkups()}calculateTangent(e,t){const s=t*3,i=Math.max(0,s-3),n=Math.min(e.length-3,s+3),r=new O().fromArray(e,i);return new O().fromArray(e,n).clone().sub(r).normalize()}calculateParallelCurve(e,t,s){const i=[];for(let n=0;n<t;n++){const r=this.calculateTangent(e,n).clone().applyAxisAngle(new O(0,0,1),Math.PI/2);r.normalize();const o=r.clone().multiplyScalar(s),a=n*3,l=new O().fromArray(e,a).add(o);i.push(l)}return i}calculateDimensionLines(e,t){const s=[],i=e.geometry.attributes.position.array,n=t.geometry.attributes.position.array;if(i.length<6&&n.length<6)throw new Error("Line must have at least two vertices");const r=new O(i[0],i[1],i[2]),o=new O(n[0],n[1],n[2]),a=[],l=i.length-3,c=new O(i[l],i[l+1],i[l+2]),p=n.length-3,u=new O(n[p],n[p+1],n[p+2]);return s.push(r,o),a.push(c,u),{startDimensionPoints:s,endDimensionPoints:a}}offsetDimensionLine(e,t){const s=new O().copy(e[e.length-1]).sub(e[0]).normalize().clone().multiplyScalar(t);return e.map(i=>i.clone().add(s))}showLineInfo(e,t){const s=this.components.get(lo);s.world=this._world,s.deleteByType(["Length","Radius"]);const i=e.geometry.attributes.position.array,n=this.calculateParallelCurve(i,i.length/3,t),r=new ze().setFromPoints(n),o=new je(r,this.markupMaterial);s.showLineLength(o,e.curve.getLength()),this._scene.add(o),this.markupLines.push(o);const{startDimensionPoints:a,endDimensionPoints:l}=this.calculateDimensionLines(e,o),c=this.offsetDimensionLine(a,t*.1),p=this.offsetDimensionLine(l,t*.1),u=new ze().setFromPoints(c),m=new ze().setFromPoints(p),E=new je(u,this.markupMaterial);this._scene.add(E),this.markupLines.push(E);const g=new je(m,this.markupMaterial);this._scene.add(g),this.markupLines.push(g)}showClothoidInfo(e,t){const s=this.components.get(lo);s.world=this._world,s.deleteByType(["Length","Radius"]);const i=e.geometry.attributes.position.array,n=this.calculateParallelCurve(i,i.length/3,t),r=new ze().setFromPoints(n);s.showCurveLength(n,e.curve.getLength());const o=new je(r,this.markupMaterial);this._scene.add(o),this.markupLines.push(o);const{startDimensionPoints:a,endDimensionPoints:l}=this.calculateDimensionLines(e,o),c=this.offsetDimensionLine(a,t*.1),p=this.offsetDimensionLine(l,t*.1),u=new ze().setFromPoints(c),m=new ze().setFromPoints(p),E=new je(u,this.markupMaterial);this._scene.add(E),this.markupLines.push(E);const g=new je(m,this.markupMaterial);this._scene.add(g),this.markupLines.push(g)}showCircularArcInfo(e,t){const s=this.components.get(lo);s.world=this._world,s.deleteByType(["Length","Radius"]);const i=e.curve.data.RADIUS,n=e.geometry.attributes.position.array,r=e.geometry.attributes.position.count,o=[],a=new O(n[0],n[1],n[2]),l=(r-1)*3,c=new O(n[l],n[l+1],n[l+2]),p=r/2*3,u=new O(n[p],n[p+1],n[p+2]),m=c.clone().sub(a).normalize(),E=new O(-m.y,m.x,0);E.multiplyScalar(i);const g=u.clone().add(E);o.push(u),o.push(g);const T=new ze().setFromPoints(o),y=new je(T,this.markupMaterial);s.showCurveRadius(y,Math.abs(i)),this._scene.add(y),this.markupLines.push(y);const v=[];for(let Q=0;Q<r;Q++){const ne=this.calculateTangent(n,Q),ue=e.curve.data.RADIUS,oe=new O(ne.y,-ne.x,0);oe.normalize(),ue<0&&oe.negate();const Ie=oe.clone().multiplyScalar(t),ce=Q*3,ye=new O(n[ce]+Ie.x,n[ce+1]+Ie.y,n[ce+2]+Ie.z);v.push(ye)}const A=new ze().setFromPoints(v);s.showCurveLength(v,e.curve.getLength());const C=new je(A,this.markupMaterial);this._scene.add(C),this.markupLines.push(C);const{startDimensionPoints:F,endDimensionPoints:M}=this.calculateDimensionLines(e,C),_=this.offsetDimensionLine(F,t*.1),L=this.offsetDimensionLine(M,t*.1),D=new ze().setFromPoints(_),B=new ze().setFromPoints(L),z=new je(D,this.markupMaterial);this._scene.add(z),this.markupLines.push(z);const V=new je(B,this.markupMaterial);this._scene.add(V),this.markupLines.push(V)}}const Hm=class Wm extends Gm{constructor(e){super(e),S(this,"view","horizontal"),S(this,"planHighlighter"),this.components.add(Wm.uuid,this),this.onHighlight.add(({mesh:t})=>{!this._highlighter||!this.planHighlighter||this.planHighlighter.showCurveInfo(t)})}get world(){return super.world}set world(e){var t;super.world=e,e&&((t=this.planHighlighter)==null||t.dispose(),this.planHighlighter=new pT(this.components,e.scene.three,e))}};S(Hm,"uuid","3096dea0-5bc2-41c7-abce-9089b6c9431b");let oy=Hm;const Xm=class Km extends Gm{constructor(e){super(e),S(this,"enabled",!0),S(this,"view","vertical"),this.components.add(Km.uuid,this)}get world(){return super.world}set world(e){this.world!==e&&(super.world=e,this._highlighter&&this._highlighter.onSelect.add(t=>{if(!this.world)throw new Error("A world is needed to work with this component!");const s=this.components.get(lo);s.deleteByType(["Slope","Height","InitialKPV","FinalKPV"]);const{alignment:i}=t.curve,n=[];for(const l of i.vertical){const c=l.mesh.geometry.attributes.position.array;n.push(c)}const{defSegments:r,slope:o}=this.setDefSegments(n),a=this.world.scene.three;for(let l=0;l<i.vertical.length;l++){const c=i.vertical[l];s.addVerticalMarker(this.world,`S: ${o[l].slope}%`,c.mesh,"Slope",a),s.addVerticalMarker(this.world,`H: ${r[l].end.y.toFixed(2)}`,c.mesh,"Height",a)}s.addVerticalMarker(this.world,"KP: 0",i.vertical[0].mesh,"InitialKPV",a),s.addVerticalMarker(this.world,`KP: ${i.vertical.length}`,i.vertical[i.vertical.length-1].mesh,"FinalKPV",a)}))}};S(Xm,"uuid","097eea29-2d5a-431a-a247-204d44670621");let ay=Xm;const Zm=class jm extends De{constructor(e){super(e),S(this,"onHighlight",new te),S(this,"onMarkerChange",new te),S(this,"onMarkerHidden",new te),S(this,"enabled",!0),S(this,"mouseMarkers"),S(this,"_highlighter"),S(this,"_curves",[]),S(this,"_world",null),S(this,"updateLinesResolution",t=>{var s;(s=this.highlighter)==null||s.setResolution(t)}),S(this,"onClick",t=>{if(!this.enabled||!this._highlighter)return;if(!this.world)throw new Error("No world found!");if(!this.world.renderer)return;const s=this.world.renderer.three.domElement,i=this.world.camera.three,n=this._highlighter.castRay(t,i,s,this._curves);if(n){const r=n.object;this._highlighter.select(r),this.updateMarker(n,"select");const{point:o,index:a}=n;a!==void 0&&this.onHighlight.trigger({curve:r,point:o,index:a});return}this._highlighter.unSelect(),this.mouseMarkers&&(this.mouseMarkers.hover.visible=!1),this.onMarkerHidden.trigger({type:"hover"})}),S(this,"onMouseMove",async t=>{if(!this.enabled||!this._highlighter)return;if(!this.world)throw new Error("No world found!");if(!this.world.renderer)return;const s=this.world.renderer.three.domElement,i=this.world.camera.three,n=this._highlighter.castRay(t,i,s,this._curves);if(n){this._highlighter.hover(n.object),this.updateMarker(n,"hover");return}this._highlighter.unHover()}),this.components.add(jm.uuid,this)}get world(){return this._world}set world(e){var t,s,i;if(e===this._world||(this._world&&this.setupEvents(!1),this._world=e,(t=this._highlighter)==null||t.dispose(),(s=this.mouseMarkers)==null||s.hover.dispose(),(i=this.mouseMarkers)==null||i.select.dispose(),!e))return;const n=e.scene.three;this._highlighter=new Sm(n,"absolute"),this.mouseMarkers={select:this.newMouseMarker("#ffffff",e),hover:this.newMouseMarker("#575757",e)},this.setupEvents(!0)}get highlighter(){if(!this._highlighter)throw new Error("Navigator not initialized!");return this._highlighter}draw(e){if(!e.civilData)throw new Error("Model must have civil data!");if(!this.world)throw new Error("A world must be given before drawing an alignment!");const t=this.world.scene.three;for(const[s,i]of e.civilData.alignments)for(const{mesh:n}of i.absolute)t.add(n),this._curves.push(n)}setMarker(e,t,s){if(!this.mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const i=e.getPointAt(t,"absolute");this.mouseMarkers[s].visible=!0,this.mouseMarkers[s].three.position.copy(i)}hideMarker(e){if(!this.mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const t=this.mouseMarkers[e].three;t.visible=!1}newMouseMarker(e,t){const s=t.scene.three,i=document.createElement("div");i.style.backgroundColor=e,i.style.width="1rem",i.style.height="1rem",i.style.borderRadius="1rem";const n=new Zt(t,i,s);return n.visible=!1,n}setupEvents(e){var t,s;if(!this.world)throw new Error("No world found!");if(this.world.isDisposing||!this.world.renderer)return;const i=this.world.renderer.three.domElement;(t=this.world.renderer)==null||t.onResize.remove(this.updateLinesResolution),i.removeEventListener("click",this.onClick),i.removeEventListener("pointermove",this.onMouseMove),e&&(i.addEventListener("click",this.onClick),i.addEventListener("pointermove",this.onMouseMove),(s=this.world.renderer)==null||s.onResize.add(this.updateLinesResolution))}updateMarker(e,t){if(!this.mouseMarkers)return;const{point:s,object:i}=e,n=i,r=n.curve,o=n.curve.alignment,a=o.getPercentageAt(s,"absolute");this.mouseMarkers[t].visible=!0,this.mouseMarkers[t].three.position.copy(s),a!==null&&this.onMarkerChange.trigger({alignment:o,percentage:a,type:t,curve:r})}};S(Zm,"uuid","0a59c09e-2b49-474a-9320-99f51f40f182");let ly=Zm;const Qm=class qm extends De{constructor(e){super(e),S(this,"enabled",!0),S(this,"world",null),S(this,"plane"),S(this,"_world3D",null),this.components.add(qm.uuid,this)}get world3D(){return this._world3D}set world3D(e){var t;if(this._world3D=e,(t=this.plane)==null||t.dispose(),!e)return;const s=this.components.get(uo),i=s.Type;s.Type=al,this.plane=s.createFromNormalAndCoplanarPoint(e,new O(1,0,0),new O),s.Type=i,this.plane.visible=!1,this.plane.enabled=!1}async set(e,t){if(!this.world||!this.plane)throw new Error("You must set a world before using this component");this.plane.enabled=!0;const s=e.curve.getPercentageAt(t);if(s===null)return;const{startPoint:i,endPoint:n}=e.curve.getSegmentAt(s);if(e.geometry.index===null)throw new Error("Geometry must be indexed!");const r=new O;r.subVectors(n,i),r.normalize(),this.plane.setFromNormalAndCoplanarPoint(r,t),this.plane.edges.update();const o=this.plane.helper.matrix.clone();o.invert();const a=this.world.scene.three,l=this.plane.edges.get();for(const c in l){const{mesh:p}=l[c];p.position.set(0,0,0),p.rotation.set(0,0,0),p.updateMatrix(),p.applyMatrix4(o),p.parent!==a&&a.add(p)}this.plane.enabled=!1}};S(Qm,"uuid","96b2c87e-d90b-4639-8257-8f01136fe324");let hy=Qm;function Ui(){const h=document.createElement("div");return h.style.backgroundColor="black",h.style.color="white",h.style.padding="8px",h.style.borderRadius="8px",h.style.fontFamily="sans-serif",h}const $a=class el{constructor(e,t,s){S(this,"label"),S(this,"boundingBox",new J),S(this,"world"),S(this,"components"),S(this,"_length"),S(this,"_visible",!0),S(this,"_start"),S(this,"_end"),S(this,"_root",new sl),S(this,"_endpoints",[]),S(this,"_line"),this.components=e,this.world=t,this._start=s.start,this._end=s.end,this._length=this.getLength(),this._line=this.createLine(s),this.newEndpointElement(s.endpointElement),this.newEndpointElement(s.endpointElement.cloneNode(!0)),this.label=this.newText(),this._root.renderOrder=2,this.world.scene.three.add(this._root)}get visible(){return this._visible}set visible(e){this._visible=e,this.label.visible=e,this._endpoints[0].visible=e,this._endpoints[1].visible=e;const[t,s]=this._endpoints,i=t.three,n=s.three,r=this.label.three;e?(this.world.scene.three.add(this._root),this._root.add(r,i,n)):(r.removeFromParent(),i.removeFromParent(),n.removeFromParent(),this._root.removeFromParent())}get endPoint(){return this._end}set endPoint(e){this._end=e;const t=this._line.geometry.attributes.position;t.setXYZ(1,e.x,e.y,e.z),t.needsUpdate=!0,this._endpoints[1].three.position.copy(e),this.updateLabel()}get startPoint(){return this._start}set startPoint(e){this._start=e;const t=this._line.geometry.attributes.position;t.setXYZ(0,e.x,e.y,e.z),t.needsUpdate=!0,this._endpoints[0].three.position.copy(e),this.updateLabel()}get _center(){let e=this._end.clone().sub(this._start);const t=e.length()*.5;return e=e.normalize().multiplyScalar(t),this._start.clone().add(e)}dispose(){const e=this.components.get(Ks);this.visible=!1,e.destroy(this._root),e.destroy(this._line);for(const t of this._endpoints)t.dispose();this._endpoints.length=0,this.label.dispose(),this.boundingBox&&e.destroy(this.boundingBox),this.components=null}createBoundingBox(){this.boundingBox.geometry=new Be(1,1,this._length),this.boundingBox.position.copy(this._center),this.boundingBox.lookAt(this._end),this.boundingBox.visible=!1,this._root.add(this.boundingBox)}toggleLabel(){this.label.toggleVisibility()}newEndpointElement(e){const t=this._endpoints.length===0?this._start:this._end,s=new Zt(this.world,e);s.three.position.copy(t),this._endpoints.push(s),this._root.add(s.three)}updateLabel(){this._length=this.getLength(),this.label.three.element.textContent=this.getTextContent(),this.label.three.position.copy(this._center),this._line.computeLineDistances()}createLine(e){const t=new ze;t.setFromPoints([e.start,e.end]);const s=new je(t,e.lineMaterial);return this._root.add(s),s}newText(){const e=Ui();e.textContent=this.getTextContent();const t=new Zt(this.world,e);return t.three.position.copy(this._center),this._root.add(t.three),t}getTextContent(){return`${(this._length/el.scale).toFixed(el.rounding)} ${el.units}`}getLength(){return this._start.distanceTo(this._end)}};S($a,"scale",1),S($a,"units","m"),S($a,"rounding",2);let fd=$a;class fT{constructor(e,t,s){S(this,"enabled",!0),S(this,"points",[]),S(this,"workingPlane",null),S(this,"labelMarker"),S(this,"world"),S(this,"components"),S(this,"onDisposed",new te),S(this,"onAreaComputed",new te),S(this,"onWorkingPlaneComputed",new te),S(this,"onPointAdded",new te),S(this,"onPointRemoved",new te),S(this,"_visible",!0),S(this,"_rotationMatrix",null),S(this,"_dimensionLines",[]),S(this,"_defaultLineMaterial",new qs({color:"red"})),this.world=t,this.components=e;const i=Ui();this.labelMarker=new Zt(t,i),this.labelMarker.visible=!1,this.onPointAdded.add(n=>{this.points.length===3&&!this._dimensionLines[2]&&(this.addDimensionLine(n,this.points[0]),this.labelMarker.visible=!0)}),s==null||s.forEach(n=>this.setPoint(n))}get visible(){return this._visible}set visible(e){this._visible=e;for(const t of this._dimensionLines)t.visible=e,t.label.visible=!1;this.labelMarker.visible=e}setPoint(e,t){let s;if(t?s=t:s=this.points.length===0?0:this.points.length,s===0){this.points[0]=e;return}if(s<0||s>this.points.length)return;const i=this.points.length>s;this.points[s]=e,this.onPointAdded.trigger(e),i||this.addDimensionLine(this.points[s-1],e);const{previousLine:n,nextLine:r}=this.getLinesBetweenIndex(s);n&&(n.endPoint=e),r&&(r.startPoint=e)}removePoint(e){if(this.points.length===3)return;this.points.splice(e,1);const{previousLine:t,nextLine:s}=this.getLinesBetweenIndex(e);s&&(t.endPoint=s.endPoint),s==null||s.dispose(),this._dimensionLines.splice(e,1),this.onPointRemoved.trigger()}toggleLabel(){this.labelMarker.toggleVisibility()}addDimensionLine(e,t){const s=new fd(this.components,this.world,{start:e,end:t,lineMaterial:this._defaultLineMaterial,endpointElement:Ui()});return s.toggleLabel(),this._dimensionLines.length>1?this._dimensionLines.splice(this._dimensionLines.length-1,0,s):this._dimensionLines.push(s),s}getLinesBetweenIndex(e){const t=e===0?this._dimensionLines.length-1:e-1,s=this._dimensionLines[t],i=this._dimensionLines[e];return{previousLine:s,nextLine:i}}computeWorkingPlane(){this.workingPlane=new jt().setFromCoplanarPoints(this.points[0],this.points[1],this.points[2]);const e=new O(0,1,0),t=this.workingPlane.normal.angleTo(e),s=new O().crossVectors(this.workingPlane.normal,e).normalize();this._rotationMatrix=new de().makeRotationAxis(s,t),this.onWorkingPlaneComputed.trigger(this.workingPlane)}computeArea(){if(!(this._rotationMatrix&&this.workingPlane))return this.onAreaComputed.trigger(0),0;let e=0,t=0;const s=this._rotationMatrix,i=this.points.map(r=>{const o=r.clone().applyMatrix4(s),a=new Ue(o.x,o.z);return e+=a.x,t+=a.y,a}),n=Math.abs(t0.area(i));return this.labelMarker.three.element.textContent=`${n.toFixed(2)} m`,this.labelMarker.three.position.set(e/i.length,-this.workingPlane.constant,t/i.length).applyMatrix4(s.clone().invert()),this.onAreaComputed.trigger(n),n}dispose(){this.onAreaComputed.reset(),this.onWorkingPlaneComputed.reset(),this.onPointAdded.reset(),this.onPointRemoved.reset();for(const e of this._dimensionLines)e.dispose();this.labelMarker.dispose(),this._dimensionLines=[],this.points=[],this._rotationMatrix=null,this.workingPlane=null,this._defaultLineMaterial.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get(){return{points:this.points,workingPlane:this.workingPlane,area:this.computeArea()}}}class md extends _1{constructor(e,t){super(e,t),S(this,"onDisposed",new te),S(this,"marker",null),S(this,"_className","default-vertex-picker"),this.onEnabled.add(s=>{this.marker&&(this.marker.visible=s)})}get className(){return this._className}set className(e){this._className=e,this.marker&&(this.marker.three.element.className=e)}dispose(){this.marker&&this.marker.dispose(),super.dispose()}get(e){const t=super.get(e);return t?(this.marker||(this.marker=new Zt(e),this.marker.three.element.className=this._className),this.marker.world!==e&&(this.marker.world=e,this.marker.three.removeFromParent(),e.scene.three.add(this.marker.three)),this.marker.visible=!0,this.marker.three.position.copy(t)):this.marker&&(this.marker.visible=!1),t}}const Jm=class zc extends De{constructor(e){super(e),S(this,"onDisposed",new te),S(this,"list",[]),S(this,"world"),S(this,"_enabled",!1),S(this,"_visible",!0),S(this,"_vertexPicker"),S(this,"_currentAreaElement",null),S(this,"_clickCount",0),S(this,"create",()=>{if(!this.enabled)return;if(!this.world)throw new Error("World not defined for the area measurement!");const t=this._vertexPicker.get(this.world);if(t){if(!this._currentAreaElement){const s=new fT(this.components,this.world);s.onPointAdded.add(()=>{this._clickCount===2&&!s.workingPlane&&(s.computeWorkingPlane(),this._vertexPicker.workingPlane=s.workingPlane)}),s.onPointRemoved.add(()=>this._clickCount--),this._currentAreaElement=s}this._currentAreaElement.setPoint(t,this._clickCount),this._currentAreaElement.computeArea(),this._clickCount++}}),S(this,"onMouseMove",()=>{if(!this.world){console.log("No world given for the area measurement!");return}const t=this._vertexPicker.get(this.world);t&&this._currentAreaElement&&(this._currentAreaElement.setPoint(t,this._clickCount),this._currentAreaElement.computeArea())}),S(this,"onKeydown",t=>{this.enabled&&(t.key==="z"&&t.ctrlKey&&this._currentAreaElement&&this._currentAreaElement.removePoint(this._clickCount-1),t.key==="Enter"&&this._currentAreaElement&&this.endCreation(),t.key==="Escape"&&(this._clickCount===0&&!this._currentAreaElement?this.enabled=!1:this.cancelCreation()))}),this.components.add(zc.uuid,this),this._vertexPicker=new md(e)}set enabled(e){this._enabled=e,this._vertexPicker.enabled=e,this.setupEvents(e),e||this.cancelCreation()}get enabled(){return this._enabled}set workingPlane(e){this._vertexPicker.workingPlane=e}get workingPlane(){return this._vertexPicker.workingPlane}get visible(){return this._visible}set visible(e){this._visible=e;for(const t of this.list)t.visible=e}dispose(){this.setupEvents(!1),this._vertexPicker.dispose(),this._currentAreaElement&&this._currentAreaElement.dispose();for(const e of this.list)e.dispose();this.components=null,this.onDisposed.trigger(zc.uuid),this.onDisposed.reset()}delete(){}deleteAll(){for(const e of this.list)e.dispose();this.list=[]}endCreation(){this._currentAreaElement&&(this._currentAreaElement.points.length<3||(this._currentAreaElement&&(this.list.push(this._currentAreaElement),this._currentAreaElement.removePoint(this._clickCount),this._currentAreaElement.computeWorkingPlane(),this._currentAreaElement.computeArea(),this._currentAreaElement=null),this._vertexPicker.workingPlane=null,this._clickCount=0))}cancelCreation(){this._currentAreaElement&&(this._currentAreaElement.dispose(),this._currentAreaElement=null),this._vertexPicker.workingPlane=null,this._clickCount=0}setupEvents(e){if(!this.world)throw new Error("The area measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the area measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}};S(Jm,"uuid","c453a99e-f054-4781-9060-33df617db4a5");let cy=Jm;class mT{constructor(e,t){S(this,"enabled",!0),S(this,"visible",!0),S(this,"points",[]),S(this,"world"),S(this,"onDisposed",new te),S(this,"_lineMaterial",new go({color:6629591,linewidth:2})),S(this,"_lineGeometry",new ol),S(this,"_line",new Rm(this._lineGeometry,this._lineMaterial)),S(this,"_labelMarker"),S(this,"onAngleComputed",new te),S(this,"onPointAdded",new te),this.world=e;const s=Ui();this._labelMarker=new Zt(e,s),this.labelMarker.visible=!0,this.onPointAdded.add(()=>{this.points.length===1&&e.scene.three.add(this._line),this.points.length===3&&(this.labelMarker.visible=!0)}),this.onAngleComputed.add(i=>{this.labelMarker.three.element.textContent=`${i.toFixed(2)}`,this.labelMarker.three.position.copy(this.points[1]??new O)}),t==null||t.forEach(i=>this.setPoint(i))}set lineMaterial(e){this._lineMaterial.dispose(),this._lineMaterial=e,this._line.material=e,this._lineMaterial.resolution.set(window.innerWidth,window.innerHeight)}get lineMaterial(){return this._lineMaterial}set labelMarker(e){this._labelMarker.dispose(),this._labelMarker=e}get labelMarker(){return this._labelMarker}get angle(){return{points:this.points,angle:this.computeAngle()}}setPoint(e,t){let s;if(t?s=t:s=this.points.length===0?0:this.points.length,![0,1,2].includes(s))return;this.points[s]=e,this.onPointAdded.trigger(e);const i=this.points.map(n=>[n.x,n.y,n.z]);this._lineGeometry.setPositions(i.flat())}toggleLabel(){this.labelMarker.toggleVisibility()}computeAngle(){const e=this.points[0],t=this.points[1],s=this.points[2];if(!(e&&t&&s))return 0;const i=new O().subVectors(t,e),n=new O().subVectors(t,s),r=ln.radToDeg(i.angleTo(n));return this.onAngleComputed.trigger(r),r}dispose(){this.points=[],this.labelMarker.dispose(),this.onAngleComputed.reset(),this.onPointAdded.reset(),this.labelMarker.dispose(),this._line.removeFromParent(),this._lineMaterial.dispose(),this._lineGeometry.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}}const $m=class Yc extends De{constructor(e){super(e),S(this,"onDisposed",new te),S(this,"world"),S(this,"list",[]),S(this,"_lineMaterial"),S(this,"_enabled",!1),S(this,"_vertexPicker"),S(this,"_currentAngleElement",null),S(this,"_clickCount",0),S(this,"create",()=>{if(!this.enabled)return;if(!this.world){console.log("No world selected for angle measurement!");return}const t=this._vertexPicker.get(this.world);if(t){if(!this._currentAngleElement){const s=new mT(this.world);s.lineMaterial=this.lineMaterial,this._currentAngleElement=s}this._currentAngleElement.setPoint(t,this._clickCount),this._currentAngleElement.setPoint(t,this._clickCount+1),this._currentAngleElement.setPoint(t,this._clickCount+2),this._currentAngleElement.computeAngle(),this._clickCount++,this._clickCount===3&&this.endCreation()}}),S(this,"onMouseMove",()=>{if(!this.world){console.log("No world selected for angle measurement!");return}const t=this._vertexPicker.get(this.world);t&&this._currentAngleElement&&(this._currentAngleElement.setPoint(t,this._clickCount),this._currentAngleElement.computeAngle())}),S(this,"onKeyDown",t=>{this.enabled&&t.key==="Escape"&&this.cancelCreation()}),this.components.add(Yc.uuid,this),this._vertexPicker=new md(e),this._lineMaterial=new go({color:6629591,linewidth:2})}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.setupEvents(e),this._vertexPicker.enabled=e,e||this.cancelCreation()}get lineMaterial(){return this._lineMaterial}set lineMaterial(e){this._lineMaterial.dispose(),this._lineMaterial=e,this._lineMaterial.resolution.set(window.innerWidth,window.innerHeight)}get workingPlane(){return this._vertexPicker.workingPlane}set workingPlane(e){this._vertexPicker.workingPlane=e}dispose(){this.setupEvents(!1),this._lineMaterial.dispose(),this._vertexPicker.dispose();for(const e of this.list)e.dispose();this._currentAngleElement&&this._currentAngleElement.dispose(),this.components=null,this.onDisposed.trigger(Yc.uuid),this.onDisposed.reset()}delete(){}deleteAll(){for(const e of this.list)e.dispose();this.list=[]}endCreation(){this._currentAngleElement&&(this.list.push(this._currentAngleElement),this._currentAngleElement.computeAngle(),this._currentAngleElement=null),this._clickCount=0}cancelCreation(){this._currentAngleElement&&(this._currentAngleElement.dispose(),this._currentAngleElement=null),this._clickCount=0}setupEvents(e){if(!this.world)throw new Error("No world selected for angle measurement!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The given world doesn't have a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeyDown)):(t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeyDown))}};S($m,"uuid","622fb2c9-528c-4b0a-8a0e-6a1375f0a3aa");let dy=$m;const eE=class kc extends De{constructor(e){super(e),S(this,"onDisposed",new te),S(this,"onBeforeUpdate",new te),S(this,"onAfterUpdate",new te),S(this,"snapDistance",.25),S(this,"list",[]),S(this,"world"),S(this,"_vertexPicker"),S(this,"_lineMaterial",new qs({color:"#DC2626",linewidth:2,depthTest:!1})),S(this,"_visible",!0),S(this,"_enabled",!1),S(this,"_temp",{isDragging:!1,start:new O,end:new O,dimension:void 0}),S(this,"create",t=>{const s=t instanceof Xs?t:void 0;if(this._enabled){if(!this._temp.isDragging){this.drawStart(s);return}this.endCreation()}}),S(this,"onMouseMove",()=>{this.world&&this._vertexPicker.get(this.world)}),this.components.add(kc.uuid,this),this._vertexPicker=new md(e,{previewElement:Ui(),snapDistance:this.snapDistance})}get enabled(){return this._enabled}set enabled(e){e||this.cancelCreation(),this._enabled=e,this._vertexPicker.enabled=e,this.setupEvents(e)}get visible(){return this._visible}set visible(e){this._visible=e;for(const t of this.list)t.visible=e}get color(){return this._lineMaterial.color}set color(e){this._lineMaterial.color=e}dispose(){this.setupEvents(!1),this.enabled=!1;for(const e of this.list)e.dispose();this._lineMaterial.dispose(),this.list=[],this._vertexPicker.dispose(),this.onDisposed.trigger(kc.uuid),this.onDisposed.reset()}async update(e){this._enabled&&this._temp.isDragging&&this.drawInProcess()}createOnPoints(e,t){const s=this.drawDimension();s.startPoint=e,s.endPoint=t,s.createBoundingBox(),this.list.push(s)}delete(){if(!this.world)throw new Error("World is needed for Length Measurement!");if(!this._enabled||this.list.length===0)return;const e=this.getBoundingBoxes(),t=this.components.get(As).get(this.world).castRay(e);if(!t)return;const s=this.list.find(i=>i.boundingBox===t.object);if(s){const i=this.list.indexOf(s);this.list.splice(i,1),s.dispose()}}async deleteMeasurement(e){if(e){const t=this.list.indexOf(e);this.list.splice(t,1),e.dispose()}}deleteAll(){for(const e of this.list)e.dispose();this.list=[]}cancelCreation(){var e;this._temp.dimension&&(this._temp.isDragging=!1,(e=this._temp.dimension)==null||e.dispose(),this._temp.dimension=void 0)}endCreation(){this._temp.dimension&&(this._temp.dimension.createBoundingBox(),this.list.push(this._temp.dimension),this._temp.dimension=void 0,this._temp.isDragging=!1)}drawStart(e){if(!this.world)throw new Error("The length measurement needs a world to work!");const t=e?[e]:void 0,s=this.components.get(As).get(this.world).castRay(t),i=this._vertexPicker.get(this.world);s&&i&&(this._temp.isDragging=!0,this._temp.start=e?s.point:i)}drawInProcess(){if(!this.world)throw new Error("The length measurement needs a world to work!");if(!this.components.get(As).get(this.world).castRay())return;const e=this._vertexPicker.get(this.world);e&&(this._temp.end=e,this._temp.dimension||(this._temp.dimension=this.drawDimension()),this._temp.dimension.endPoint=this._temp.end)}drawDimension(){if(!this.world)throw new Error("The length measurement needs a world to work!");return new fd(this.components,this.world,{start:this._temp.start,end:this._temp.end,lineMaterial:this._lineMaterial,endpointElement:Ui()})}getBoundingBoxes(){return this.list.map(e=>e.boundingBox).filter(e=>e!==void 0)}setupEvents(e){if(!this.world)throw new Error("The length measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the length measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;t&&(t.removeEventListener("pointermove",this.onMouseMove),e&&t.addEventListener("pointermove",this.onMouseMove))}};S(eE,"uuid","2f9bcacf-18a9-4be6-a293-e898eae64ea1");let eo=eE;const tE=class sE extends De{constructor(e){super(e),S(this,"onDisposed",new te),S(this,"onVolumeFound",new te),S(this,"label",null),S(this,"world"),S(this,"_enabled",!1),S(this,"create",()=>{if(!this.enabled)return;if(!this.world)throw new Error("World is needed for Volume Measurement!");const t=this.components.get(As).get(this.world).castRay(),s=this.components.get(sn);if(!t||!t.object)return;const{object:i}=t;if(i instanceof J){const n=s.getVolumeFromMeshes([i]);this.onVolumeFound.trigger(n)}}),S(this,"onMouseMove",()=>{}),S(this,"onKeydown",t=>{}),this.components.add(sE.uuid,this)}set enabled(e){this._enabled=e,this.setupEvents(e),e||this.cancelCreation()}get enabled(){return this._enabled}async dispose(){var e;this.setupEvents(!1),(e=this.label)==null||e.dispose(),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null}delete(){}async deleteAll(){}endCreation(){}cancelCreation(){}getVolumeFromFragments(e){const t=this.components.get(sn).getVolumeFromFragments(e),s=this.components.get(_c);s.reset(),s.addFragmentIdMap(e);const i=s.getSphere();return this.setLabel(i,t),t}getVolumeFromMeshes(e){const t=this.components.get(sn),s=this.components.get(_c);s.reset();for(const r of e)s.addMesh(r);const i=s.getSphere(),n=t.getVolumeFromMeshes(e);return this.setLabel(i,n),n}clear(){this.label&&(this.label.visible=!1)}newLabel(){if(!this.world)throw new Error("World is needed for Volume Measurement!");const e=Ui();return new Zt(this.world,e)}setupEvents(e){if(!this.world)throw new Error("The volume measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the volume measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("click",this.create),t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("click",this.create),t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}setLabel(e,t){if(!this.world)throw new Error("World is needed for Volume Measurement!");this.label||(this.label=this.newLabel(),this.label.three.removeFromParent()),this.label.visible=!0,this.world.scene.three.add(this.label.three),this.label.three.position.copy(e.center);const s=Math.trunc(t*100)/100;this.label.three.element.textContent=s.toString()}};S(tE,"uuid","811da532-7af3-4635-b592-1c06ae494af5");let uy=tE;const iE=class nE extends De{constructor(e){super(e),S(this,"onDisposed",new te),S(this,"selection",[]),S(this,"preview",new J(new ze,new It({side:2,depthTest:!1,transparent:!0,opacity:.25,color:"#BCF124"}))),S(this,"selectionMaterial",new It({side:2,depthTest:!1,transparent:!0,color:"#BCF124",opacity:.75})),S(this,"world"),S(this,"_enabled",!1),S(this,"_currentSelelection",null),S(this,"create",()=>{if(!this.world)throw new Error("No world given to the face measurement!");if(!this.enabled||!this._currentSelelection)return;const t=this.world.scene.three,s=new ze,i=new J(s,this.selectionMaterial);s.setAttribute("position",this.preview.geometry.attributes.position),t.add(i),s.computeBoundingSphere();const{area:n,perimeter:r}=this._currentSelelection,o=this.newLabel(s,n);i.add(o.three),this.selection.push({area:n,perimeter:r,mesh:i,label:o})}),S(this,"onMouseMove",()=>{if(!this.world)throw new Error("The face measurement needs a world to work!");if(!this.enabled){this.unselect();return}const t=this.components.get(As).get(this.world).castRay();if(!t||!t.object||t.faceIndex===void 0){this.unselect();return}const{object:s,faceIndex:i}=t;s instanceof J||s instanceof Ot?this.updateSelection(s,i,t.instanceId):this.unselect()}),S(this,"onKeydown",t=>{}),this.components.add(nE.uuid,this),this.preview.frustumCulled=!1}set enabled(e){if(!this.world)throw new Error("No world given for the Face measurement!");this._enabled=e,this.setupEvents(e),e?this.world.scene.three.add(this.preview):(this.preview.removeFromParent(),this.cancelCreation()),this.setVisibility(e)}get enabled(){return this._enabled}dispose(){this.setupEvents(!1),this.deleteAll(),this.preview.removeFromParent(),this.preview.material.dispose(),this.preview.geometry.dispose(),this.selectionMaterial.dispose(),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null}delete(){if(!this.world)throw new Error("No world given to the face measurement!");const e=this.selection.map(n=>n.mesh),t=this.components.get(As).get(this.world).castRay(e);if(!t||!t.object)return;const s=this.selection.find(n=>n.mesh===t.object);if(!s)return;s.mesh.removeFromParent(),s.mesh.geometry.dispose(),s.label.dispose();const i=this.selection.indexOf(s);this.selection.splice(i,1)}deleteAll(){for(const e of this.selection)e.mesh.removeFromParent(),e.mesh.geometry.dispose(),e.label.dispose();this.selection=[]}endCreation(){}cancelCreation(){}get(){const e=[];for(const t of this.selection){const s=t.mesh.geometry,{area:i,perimeter:n}=t,r=s.attributes.position.array;e.push({position:r,area:i,perimeter:n})}return e}set(e){if(!this.world)throw new Error("No world given to the face measurement!");const t=this.world.scene.three;for(const s of e){const i=new ze,n=new J(i,this.selectionMaterial);t.add(n);const r=new Ct(s.position,3);i.setAttribute("position",r),i.computeBoundingSphere();const{area:o,perimeter:a}=s,l=this.newLabel(i,o);n.add(l.three),this.selection.push({area:o,perimeter:a,mesh:n,label:l})}}setupEvents(e){if(!this.world)throw new Error("The face measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the face measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown),e&&(t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown))}setVisibility(e){if(!this.world)throw new Error("The face measurement needs a world to work!");if(this.world.isDisposing)return;const t=this.world.scene.three;for(const s of this.selection){const i=s.label.three;e?(t.add(s.mesh),s.mesh.add(i)):(s.mesh.removeFromParent(),i.removeFromParent())}}unselect(){this.preview.removeFromParent(),this._currentSelelection=null}updateSelection(e,t,s){if(!this.world)throw new Error("The face measurement needs a world to work!");this.world.scene.three.add(this.preview);const i=this.components.get(sn).getFace(e,t,s);if(i===null)return;const n=this.regenerateHighlight(e,i.indices,s);let r=0;for(const{distance:o}of i.edges)r+=o;this._currentSelelection={perimeter:r,area:n}}newLabel(e,t){if(!e.boundingSphere)throw new Error("Error computing area geometry");if(!this.world)throw new Error("The face measurement needs a world to work!");const{center:s}=e.boundingSphere,i=Ui(),n=Math.trunc(t*100)/100;i.textContent=n.toString();const r=new Zt(this.world,i);return r.three.position.copy(s),r}regenerateHighlight(e,t,s){const i=[],n=[];let r=0,o=0;const a=new es,l=this.components.get(sn);for(const u of t){const{p1:m,p2:E,p3:g}=l.getVerticesAndNormal(e,u,s);i.push(m.x,m.y,m.z),i.push(E.x,E.y,E.z),i.push(g.x,g.y,g.z),a.set(m,E,g),o+=a.getArea(),n.push(r,r+1,r+2),r+=3}this.preview.position.set(0,0,0),this.preview.rotation.set(0,0,0),this.preview.scale.set(1,1,1),this.preview.updateMatrix(),this.preview.applyMatrix4(e.matrixWorld);const c=new Float32Array(i),p=new Ct(c,3);return this.preview.geometry.setAttribute("position",p),this.preview.geometry.setIndex(n),o}};S(iE,"uuid","30279548-1309-44f6-aa97-ce26eed73522");let py=iE;const rE=class oE extends De{constructor(e){super(e),S(this,"onDisposed",new te),S(this,"preview"),S(this,"tolerance",.3),S(this,"world"),S(this,"_enabled",!1),S(this,"_lineMaterial",new qs({color:"#DC2626",linewidth:2,depthTest:!1,transparent:!0})),S(this,"create",async()=>{if(!this.preview||!this.enabled||!this.preview.visible)return;const t=this.components.get(eo);t.world=this.world;const s=this.preview.startPoint.clone(),i=this.preview.endPoint.clone();t.createOnPoints(s,i)}),S(this,"onMouseMove",()=>{if(!this.preview)return;if(!this.world)throw new Error("The edge measurement needs a world to work!");if(!this.enabled){this.preview.visible=!1;return}const t=this.components.get(As).get(this.world).castRay();if(!t||!t.object){this.preview.visible=!1;return}const{object:s,faceIndex:i,point:n}=t;if(i===void 0){this.preview.visible=!1;return}s instanceof J||s instanceof Ot?this.updateSelection(s,n,i,t.instanceId):this.preview.visible=!1}),S(this,"onKeydown",t=>{}),this.components.add(oE.uuid,this)}set enabled(e){if(this._enabled=e,this.setupEvents(e),e){if(!this.world)throw new Error("The edge measurement needs a world to work!");if(!this.preview){const t=document.createElement("div");t.className="w-2 h-2 bg-red-600 rounded-full",this.preview=new fd(this.components,this.world,{start:new O,end:new O,lineMaterial:this._lineMaterial,endpointElement:t}),this.preview.visible=!1}}else this.cancelCreation()}get enabled(){return this._enabled}dispose(){this.preview&&this.preview.dispose(),this._lineMaterial.dispose(),this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null}delete(){if(!this.enabled)return;const e=this.components.get(eo),t=e.enabled;e.enabled=!0,e.delete(),e.enabled=t}deleteAll(){this.components.get(eo).deleteAll()}endCreation(){}cancelCreation(){}get(){const e=this.components.get(eo).list,t=[];for(const s of e){const i=s.startPoint,n=s.endPoint,r=[i.x,i.y,i.z,n.x,n.y,n.z];t.push(r)}return t}set(e){const t=this.components.get(eo);t.world=this.world;for(const s of e){const[i,n,r,o,a,l]=s,c=new O(i,n,r),p=new O(o,a,l);t.createOnPoints(c,p)}}setupEvents(e){if(!this.world)throw new Error("The edge measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the edge measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}updateSelection(e,t,s,i){if(!this.preview||!e.geometry.index)return;const n=this.components.get(sn).getFace(e,s,i);if(!n)return;const{edges:r}=n;let o=Number.MAX_VALUE,a=[];for(const p of r){const[u,m]=p.points,E=sn.distanceFromPointToLine(t,u,m,!0);E<this.tolerance&&E<o&&(o=E,a=p.points)}if(!a.length){this.preview.visible=!1;return}const[l,c]=a;this.preview.startPoint=l,this.preview.endPoint=c,this.preview.visible=!0}};S(rE,"uuid","e7be5749-89df-4514-8d25-83aa38ce12d8");let fy=rE;class ET extends Qf{constructor(e,t,s){super(e,t,s),S(this,"threshold",50),S(this,"bboxThreshold",200),S(this,"maxLostTime",3e4),S(this,"maxHiddenTime",5e3),S(this,"boxes",new Map),S(this,"_staticGeometries",{culled:{},unculled:{}}),S(this,"_geometry"),S(this,"_material",new It({transparent:!0,side:2,opacity:1})),S(this,"onViewUpdated",new ao),S(this,"_modelIDIndex",new Map),S(this,"_indexModelID",new Map),S(this,"_nextModelID",0),S(this,"_geometries",new Map),S(this,"_geometriesGroups",new Map),S(this,"_geometriesInMemory",new Set),S(this,"_intervalID",null),S(this,"codes",new Map),S(this,"handleWorkerMessage",async n=>{const r=n.data.colors,o={},a={},l={},c={},p=performance.now();let u=!1;const m=new Set(this._geometriesInMemory);for(const[E,g]of r){const T=this._geometries.get(E);if(!T||!(g>this.threshold))continue;m.delete(E);const{exists:y}=T,v=this._indexModelID.get(T.modelIndex);y?(T.time=p,c[v]||(c[v]=new Set),c[v].add(T.geometryID),this._geometriesInMemory.add(E),u=!0):(o[v]||(o[v]=new Map),T.time=p,T.exists=!0,o[v].has(g)||o[v].set(g,new Set),o[v].get(g).add(T.geometryID),this._geometriesInMemory.add(E),u=!0)}for(const E of m){const g=this._geometries.get(E);g&&(this.handleLostGeometries(p,E,g,a,l),u=!0)}u&&await this.onViewUpdated.trigger({toLoad:o,toRemove:a,toHide:l,toShow:c}),this._isWorkerBusy=!1}),this.updateInterval=500,this._geometry=new Be(1,1,1),this._geometry.groups=[],this._geometry.deleteAttribute("uv");const i=this._geometry.attributes.position.array;for(let n=0;n<i.length;n++)i[n]+=.5;this._geometry.attributes.position.needsUpdate=!0,this.worker.addEventListener("message",this.handleWorkerMessage),this.autoUpdate&&(this._intervalID=window.setInterval(this.updateVisibility,this.updateInterval))}dispose(){super.dispose(),this.onViewUpdated.reset(),this._intervalID!==null&&(window.clearInterval(this._intervalID),this._intervalID=null);for(const[e,t]of this._geometriesGroups){t.removeFromParent();const s=[...t.children];for(const i of s)i.removeFromParent()}this._geometriesGroups.clear();for(const[e,t]of this.boxes)t.dispose(!0);this.boxes.clear();for(const[e,t]of this._geometries)t.fragment&&(t.fragment.dispose(!0),t.fragment=void 0);this._geometries.clear(),this._staticGeometries={culled:{},unculled:{}},this._geometry.dispose(),this._material.dispose(),this._modelIDIndex.clear(),this._indexModelID.clear(),this.codes.clear()}add(e,t,s){const i=this.createModelIndex(e),n=as.enabled;as.enabled=!1;const r=new Map,o=new de,a=new ho(this._geometry,this._material,10);this.boxes.set(i,a),this.scene.add(a.mesh);const l=new sl;this.scene.add(l),this._geometriesGroups.set(i,l);const c=new Map;for(const u of t)for(const m of u.geometries){const{geometryID:E,transformation:g,color:T}=m,y=new ft;y.setRGB(T[0],T[1],T[2],"srgb");const v=this.getInstanceID(u.id,E),A=s[E];if(!A){console.log(`Geometry not found: ${E}`);continue}const{boundingBox:C}=A;let F;r.has(E)?F=r.get(E):(F=this.getAvailableColor(),this.increaseColor(),r.set(E,F));const{r:M,g:_,b:L,code:D}=F,B=new ft;B.setRGB(M/255,_/255,L/255,"srgb"),this.codes.has(i)||this.codes.set(i,new Map),this.codes.get(i).set(E,D);const z=new de,V=Object.values(C);if(z.fromArray(g),o.fromArray(V),z.multiply(o),c.has(v)){const Q=c.get(v);if(Q===void 0||!Q.colors)throw new Error("Malformed item!");Q.colors.push(B),Q.geometryColors.push(y),Q.transforms.push(z)}else c.set(v,{id:v,colors:[B],geometryColors:[y],transforms:[z]});if(this._geometries.has(D))this._geometries.get(D).assetIDs.add(u.id);else{const Q=new Set([u.id]);this._geometries.set(D,{modelIndex:i,geometryID:E,assetIDs:Q,exists:!1,hidden:!1,time:0})}}const p=Array.from(c.values());a.add(p),as.enabled=n}remove(e){const t=this._modelIDIndex.get(e);if(t===void 0)throw new Error("Model doesn't exist!");const s=this._geometriesGroups.get(t);s.removeFromParent();const i=[...s.children];for(const r of i)r.removeFromParent();this._geometriesGroups.delete(t),this.boxes.get(t).dispose(!1),this.boxes.delete(t);const n=this.codes.get(t);this.codes.delete(t);for(const[r,o]of n){const a=this._geometries.get(o);a&&a.fragment&&(a.fragment.dispose(!1),a.fragment=void 0),this._geometries.delete(o)}this._modelIDIndex.delete(e),this._indexModelID.delete(t),this._geometriesInMemory.clear()}addFragment(e,t,s){const i=as.enabled;as.enabled=!1;const n=this._modelIDIndex.get(e),r=this.codes.get(n).get(t),o=this._geometries.get(r);if(this.setGeometryVisibility(o,!1,!1),!o.fragment){o.fragment=new ho(s.mesh.geometry,this._material,s.capacity);const u=this._geometriesGroups.get(n);if(!u)throw new Error("Group not found!");u.add(o.fragment.mesh)}const[a,l,c]=r.split("-").map(u=>parseInt(u,10)),p=[];for(const u of s.ids){const m=s.get(u);if(!m.colors)throw new Error("Malformed fragments!");for(const E of m.colors)E.setRGB(a/255,l/255,c/255,"srgb");p.push(m)}o.fragment.add(p),as.enabled=i,this.needsUpdate=!0}removeFragment(e,t){const s=this._modelIDIndex.get(e),i=this.codes.get(s).get(t),n=this._geometries.get(i);if(n.hidden||this.setGeometryVisibility(n,!0,!1),n.fragment){const{fragment:r}=n;r.dispose(!1),n.fragment=void 0}}setModelTransformation(e,t){const s=this._modelIDIndex.get(e);if(s===void 0)throw new Error("Model not found!");const i=this.boxes.get(s);i&&(i.mesh.position.set(0,0,0),i.mesh.rotation.set(0,0,0),i.mesh.scale.set(1,1,1),i.mesh.applyMatrix4(t));const n=this._geometriesGroups.get(s);n&&(n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),n.applyMatrix4(t))}setVisibility(e,t,s){const i=this._modelIDIndex.get(t);if(i!==void 0)for(const[n,r]of s){const o=this.codes.get(i);if(o===void 0)throw new Error("Map not found!");const a=o.get(n),l=this._geometries.get(a);if(l===void 0)throw new Error("Geometry not found!");l.hidden=!e,this.setGeometryVisibility(l,e,!0,r)}}updateTransformations(e){const t=this._modelIDIndex.get(e);if(t===void 0)return;const s=this.components.get(Qe).groups.get(e);if(s){s.updateWorldMatrix(!0,!1),s.updateMatrix();const i=this.boxes.get(t);i&&(i.mesh.position.set(0,0,0),i.mesh.rotation.set(0,0,0),i.mesh.scale.set(1,1,1),i.mesh.updateMatrix(),i.mesh.applyMatrix4(s.matrixWorld),i.mesh.updateMatrix());const n=this._geometriesGroups.get(t);n&&(n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),n.updateMatrix(),n.applyMatrix4(s.matrixWorld),n.updateMatrix())}}async addStaticGeometries(e,t=!0){const s={data:{colors:new Map}},i=this.threshold+1e3;for(const n in e){const r=this._modelIDIndex.get(n);if(r===void 0)continue;const o=this.codes.get(r);if(!o)continue;const a=e[n];for(const l of a){const c=o.get(l);if(!c)continue;const p=this._geometries.get(c);if(!p)continue;p.exists=!0,t||(p.hidden=!1,p.time=performance.now(),s.data.colors.set(c,i)),this._geometriesInMemory.add(c);const u=t?this._staticGeometries.culled:this._staticGeometries.unculled;u[n]||(u[n]=new Set),u[n].add(l)}}t||await this.handleWorkerMessage(s)}removeStaticGeometries(e,t){const s=[];t===void 0?s.push("culled","unculled"):t===!0?s.push("culled"):s.push("unculled");for(const i in e){const n=e[i];for(const r of s){const o=this._staticGeometries[r][i];if(o)for(const a of n)o.delete(a)}}}setGeometryVisibility(e,t,s,i){const{modelIndex:n,geometryID:r,assetIDs:o}=e,a=this.boxes.get(n);if(a===void 0)throw new Error("Model not found!");const l=i||o;if(s&&e.fragment)e.fragment.setVisibility(t,l);else{const c=new Set;for(const p of l){const u=this.getInstanceID(p,r);c.add(u)}a.setVisibility(t,c)}}handleLostGeometries(e,t,s,i,n){var r,o,a;const l=this._indexModelID.get(s.modelIndex),c=e-s.time,{culled:p,unculled:u}=this._staticGeometries;if(c>this.maxLostTime){if((r=p[l])!=null&&r.has(s.geometryID)||(o=u[l])!=null&&o.has(s.geometryID))return;i[l]||(i[l]=new Set),s.exists=!1,i[l].add(s.geometryID),this._geometriesInMemory.delete(t)}else if(c>this.maxHiddenTime){if((a=u[l])!=null&&a.has(s.geometryID))return;n[l]||(n[l]=new Set),n[l].add(s.geometryID)}}createModelIndex(e){if(this._modelIDIndex.has(e))throw new Error("Can't load the same model twice!");const t=this._nextModelID;return this._nextModelID++,this._modelIDIndex.set(e,t),this._indexModelID.set(t,e),t}getInstanceID(e,t){const s=10**(Math.log(t)*Math.LOG10E+1|0);return e+t/s}}var aE={exports:{}};(function(h,e){(function(t,s){h.exports=s()})(Op,function(){var t=function(d,f){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,w){I.__proto__=w}||function(I,w){for(var R in w)Object.prototype.hasOwnProperty.call(w,R)&&(I[R]=w[R])})(d,f)},s=function(){return(s=Object.assign||function(d){for(var f,I=1,w=arguments.length;I<w;I++)for(var R in f=arguments[I])Object.prototype.hasOwnProperty.call(f,R)&&(d[R]=f[R]);return d}).apply(this,arguments)};function i(d,f,I){for(var w,R=0,P=f.length;R<P;R++)!w&&R in f||((w=w||Array.prototype.slice.call(f,0,R))[R]=f[R]);return d.concat(w||Array.prototype.slice.call(f))}var n=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Op,r=Object.keys,o=Array.isArray;function a(d,f){return typeof f!="object"||r(f).forEach(function(I){d[I]=f[I]}),d}typeof Promise>"u"||n.Promise||(n.Promise=Promise);var l=Object.getPrototypeOf,c={}.hasOwnProperty;function p(d,f){return c.call(d,f)}function u(d,f){typeof f=="function"&&(f=f(l(d))),(typeof Reflect>"u"?r:Reflect.ownKeys)(f).forEach(function(I){E(d,I,f[I])})}var m=Object.defineProperty;function E(d,f,I,w){m(d,f,a(I&&p(I,"get")&&typeof I.get=="function"?{get:I.get,set:I.set,configurable:!0}:{value:I,configurable:!0,writable:!0},w))}function g(d){return{from:function(f){return d.prototype=Object.create(f.prototype),E(d.prototype,"constructor",d),{extend:u.bind(null,d.prototype)}}}}var T=Object.getOwnPropertyDescriptor,y=[].slice;function v(d,f,I){return y.call(d,f,I)}function A(d,f){return f(d)}function C(d){if(!d)throw new Error("Assertion Failed")}function F(d){n.setImmediate?setImmediate(d):setTimeout(d,0)}function M(d,f){if(typeof f=="string"&&p(d,f))return d[f];if(!f)return d;if(typeof f!="string"){for(var I=[],w=0,R=f.length;w<R;++w){var P=M(d,f[w]);I.push(P)}return I}var N=f.indexOf(".");if(N!==-1){var U=d[f.substr(0,N)];return U==null?void 0:M(U,f.substr(N+1))}}function _(d,f,I){if(d&&f!==void 0&&!("isFrozen"in Object&&Object.isFrozen(d)))if(typeof f!="string"&&"length"in f){C(typeof I!="string"&&"length"in I);for(var w=0,R=f.length;w<R;++w)_(d,f[w],I[w])}else{var P,N,U=f.indexOf(".");U!==-1?(P=f.substr(0,U),(N=f.substr(U+1))===""?I===void 0?o(d)&&!isNaN(parseInt(P))?d.splice(P,1):delete d[P]:d[P]=I:_(U=!(U=d[P])||!p(d,P)?d[P]={}:U,N,I)):I===void 0?o(d)&&!isNaN(parseInt(f))?d.splice(f,1):delete d[f]:d[f]=I}}function L(d){var f,I={};for(f in d)p(d,f)&&(I[f]=d[f]);return I}var D=[].concat;function B(d){return D.apply([],d)}var ti="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(B([8,16,32,64].map(function(d){return["Int","Uint","Float"].map(function(f){return f+d+"Array"})}))).filter(function(d){return n[d]}),z=new Set(ti.map(function(d){return n[d]})),V=null;function Q(d){return V=new WeakMap,d=function f(I){if(!I||typeof I!="object")return I;var w=V.get(I);if(w)return w;if(o(I)){w=[],V.set(I,w);for(var R=0,P=I.length;R<P;++R)w.push(f(I[R]))}else if(z.has(I.constructor))w=I;else{var N,U=l(I);for(N in w=U===Object.prototype?{}:Object.create(U),V.set(I,w),I)p(I,N)&&(w[N]=f(I[N]))}return w}(d),V=null,d}var ne={}.toString;function ue(d){return ne.call(d).slice(8,-1)}var oe=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Ie=typeof oe=="symbol"?function(d){var f;return d!=null&&(f=d[oe])&&f.apply(d)}:function(){return null};function ce(d,f){return f=d.indexOf(f),0<=f&&d.splice(f,1),0<=f}var ye={};function Ze(d){var f,I,w,R;if(arguments.length===1){if(o(d))return d.slice();if(this===ye&&typeof d=="string")return[d];if(R=Ie(d)){for(I=[];!(w=R.next()).done;)I.push(w.value);return I}if(d==null)return[d];if(typeof(f=d.length)!="number")return[d];for(I=new Array(f);f--;)I[f]=d[f];return I}for(f=arguments.length,I=new Array(f);f--;)I[f]=arguments[f];return I}var gt=typeof Symbol<"u"?function(d){return d[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},fr=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ns=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(fr),Is={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function yt(d,f){this.name=d,this.message=f}function ui(d,f){return d+". Errors: "+Object.keys(f).map(function(I){return f[I].toString()}).filter(function(I,w,R){return R.indexOf(I)===w}).join(`
`)}function Ps(d,f,I,w){this.failures=f,this.failedKeys=w,this.successCount=I,this.message=ui(d,f)}function is(d,f){this.name="BulkError",this.failures=Object.keys(f).map(function(I){return f[I]}),this.failuresByPos=f,this.message=ui(d,this.failures)}g(yt).from(Error).extend({toString:function(){return this.name+": "+this.message}}),g(Ps).from(yt),g(is).from(yt);var Bt=ns.reduce(function(d,f){return d[f]=f+"Error",d},{}),Pe=yt,Ce=ns.reduce(function(d,f){var I=f+"Error";function w(R,P){this.name=I,R?typeof R=="string"?(this.message="".concat(R).concat(P?`
 `+P:""),this.inner=P||null):typeof R=="object"&&(this.message="".concat(R.name," ").concat(R.message),this.inner=R):(this.message=Is[f]||I,this.inner=null)}return g(w).from(Pe),d[f]=w,d},{});Ce.Syntax=SyntaxError,Ce.Type=TypeError,Ce.Range=RangeError;var Ae=fr.reduce(function(d,f){return d[f+"Error"]=Ce[f],d},{}),wt=ns.reduce(function(d,f){return["Syntax","Type","Range"].indexOf(f)===-1&&(d[f+"Error"]=Ce[f]),d},{});function ke(){}function zt(d){return d}function ur(d,f){return d==null||d===zt?f:function(I){return f(d(I))}}function Yt(d,f){return function(){d.apply(this,arguments),f.apply(this,arguments)}}function Js(d,f){return d===ke?f:function(){var I=d.apply(this,arguments);I!==void 0&&(arguments[0]=I);var w=this.onsuccess,R=this.onerror;this.onsuccess=null,this.onerror=null;var P=f.apply(this,arguments);return w&&(this.onsuccess=this.onsuccess?Yt(w,this.onsuccess):w),R&&(this.onerror=this.onerror?Yt(R,this.onerror):R),P!==void 0?P:I}}function $s(d,f){return d===ke?f:function(){d.apply(this,arguments);var I=this.onsuccess,w=this.onerror;this.onsuccess=this.onerror=null,f.apply(this,arguments),I&&(this.onsuccess=this.onsuccess?Yt(I,this.onsuccess):I),w&&(this.onerror=this.onerror?Yt(w,this.onerror):w)}}function uE(d,f){return d===ke?f:function(I){var w=d.apply(this,arguments);a(I,w);var R=this.onsuccess,P=this.onerror;return this.onsuccess=null,this.onerror=null,I=f.apply(this,arguments),R&&(this.onsuccess=this.onsuccess?Yt(R,this.onsuccess):R),P&&(this.onerror=this.onerror?Yt(P,this.onerror):P),w===void 0?I===void 0?void 0:I:a(w,I)}}function pE(d,f){return d===ke?f:function(){return f.apply(this,arguments)!==!1&&d.apply(this,arguments)}}function bl(d,f){return d===ke?f:function(){var I=d.apply(this,arguments);if(I&&typeof I.then=="function"){for(var w=this,R=arguments.length,P=new Array(R);R--;)P[R]=arguments[R];return I.then(function(){return f.apply(w,P)})}return f.apply(this,arguments)}}wt.ModifyError=Ps,wt.DexieError=yt,wt.BulkError=is;var bs=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ed(d){bs=d}var pr={},gd=100,ti=typeof Promise>"u"?[]:function(){var d=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[d,l(d),d];var f=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[f,l(f),d]}(),fr=ti[0],ns=ti[1],ti=ti[2],ns=ns&&ns.then,mr=fr&&fr.constructor,xl=!!ti,Er=function(d,f){gr.push([d,f]),Co&&(queueMicrotask(mE),Co=!1)},Ml=!0,Co=!0,Bi=[],To=[],_l=zt,pi={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ke,pgp:!1,env:{},finalize:ke},Te=pi,gr=[],zi=0,yo=[];function ge(d){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var f=this._PSD=Te;if(typeof d!="function"){if(d!==pr)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Nl(this,this._value))}this._state=null,this._value=null,++f.ref,function I(w,R){try{R(function(P){if(w._state===null){if(P===w)throw new TypeError("A promise cannot be resolved with itself.");var N=w._lib&&dn();P&&typeof P.then=="function"?I(w,function(U,H){P instanceof ge?P._then(U,H):P.then(U,H)}):(w._state=!0,w._value=P,Cd(w)),N&&un()}},Nl.bind(null,w))}catch(P){Nl(w,P)}}(this,d)}var Ll={get:function(){var d=Te,f=Fo;function I(w,R){var P=this,N=!d.global&&(d!==Te||f!==Fo),U=N&&!mi(),H=new ge(function(k,K){Dl(P,new Id(yd(w,d,N,U),yd(R,d,N,U),k,K,d))});return this._consoleTask&&(H._consoleTask=this._consoleTask),H}return I.prototype=pr,I},set:function(d){E(this,"then",d&&d.prototype===pr?Ll:{get:function(){return d},set:Ll.set})}};function Id(d,f,I,w,R){this.onFulfilled=typeof d=="function"?d:null,this.onRejected=typeof f=="function"?f:null,this.resolve=I,this.reject=w,this.psd=R}function Nl(d,f){var I,w;To.push(f),d._state===null&&(I=d._lib&&dn(),f=_l(f),d._state=!1,d._value=f,w=d,Bi.some(function(R){return R._value===w._value})||Bi.push(w),Cd(d),I&&un())}function Cd(d){var f=d._listeners;d._listeners=[];for(var I=0,w=f.length;I<w;++I)Dl(d,f[I]);var R=d._PSD;--R.ref||R.finalize(),zi===0&&(++zi,Er(function(){--zi==0&&Ul()},[]))}function Dl(d,f){if(d._state!==null){var I=d._state?f.onFulfilled:f.onRejected;if(I===null)return(d._state?f.resolve:f.reject)(d._value);++f.psd.ref,++zi,Er(fE,[I,d,f])}else d._listeners.push(f)}function fE(d,f,I){try{var w,R=f._value;!f._state&&To.length&&(To=[]),w=bs&&f._consoleTask?f._consoleTask.run(function(){return d(R)}):d(R),f._state||To.indexOf(R)!==-1||function(P){for(var N=Bi.length;N;)if(Bi[--N]._value===P._value)return Bi.splice(N,1)}(f),I.resolve(w)}catch(P){I.reject(P)}finally{--zi==0&&Ul(),--I.psd.ref||I.psd.finalize()}}function mE(){Yi(pi,function(){dn()&&un()})}function dn(){var d=Ml;return Co=Ml=!1,d}function un(){var d,f,I;do for(;0<gr.length;)for(d=gr,gr=[],I=d.length,f=0;f<I;++f){var w=d[f];w[0].apply(null,w[1])}while(0<gr.length);Co=Ml=!0}function Ul(){var d=Bi;Bi=[],d.forEach(function(w){w._PSD.onunhandled.call(null,w._value,w)});for(var f=yo.slice(0),I=f.length;I;)f[--I]()}function wo(d){return new ge(pr,!1,d)}function nt(d,f){var I=Te;return function(){var w=dn(),R=Te;try{return Ei(I,!0),d.apply(this,arguments)}catch(P){f&&f(P)}finally{Ei(R,!1),w&&un()}}}u(ge.prototype,{then:Ll,_then:function(d,f){Dl(this,new Id(null,null,d,f,Te))},catch:function(d){if(arguments.length===1)return this.then(null,d);var f=d,I=arguments[1];return typeof f=="function"?this.then(null,function(w){return(w instanceof f?I:wo)(w)}):this.then(null,function(w){return(w&&w.name===f?I:wo)(w)})},finally:function(d){return this.then(function(f){return ge.resolve(d()).then(function(){return f})},function(f){return ge.resolve(d()).then(function(){return wo(f)})})},timeout:function(d,f){var I=this;return d<1/0?new ge(function(w,R){var P=setTimeout(function(){return R(new Ce.Timeout(f))},d);I.then(w,R).finally(clearTimeout.bind(null,P))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&E(ge.prototype,Symbol.toStringTag,"Dexie.Promise"),pi.env=Td(),u(ge,{all:function(){var d=Ze.apply(null,arguments).map(Ao);return new ge(function(f,I){d.length===0&&f([]);var w=d.length;d.forEach(function(R,P){return ge.resolve(R).then(function(N){d[P]=N,--w||f(d)},I)})})},resolve:function(d){return d instanceof ge?d:d&&typeof d.then=="function"?new ge(function(f,I){d.then(f,I)}):new ge(pr,!0,d)},reject:wo,race:function(){var d=Ze.apply(null,arguments).map(Ao);return new ge(function(f,I){d.map(function(w){return ge.resolve(w).then(f,I)})})},PSD:{get:function(){return Te},set:function(d){return Te=d}},totalEchoes:{get:function(){return Fo}},newPSD:fi,usePSD:Yi,scheduler:{get:function(){return Er},set:function(d){Er=d}},rejectionMapper:{get:function(){return _l},set:function(d){_l=d}},follow:function(d,f){return new ge(function(I,w){return fi(function(R,P){var N=Te;N.unhandleds=[],N.onunhandled=P,N.finalize=Yt(function(){var U,H=this;U=function(){H.unhandleds.length===0?R():P(H.unhandleds[0])},yo.push(function k(){U(),yo.splice(yo.indexOf(k),1)}),++zi,Er(function(){--zi==0&&Ul()},[])},N.finalize),d()},f,I,w)})}}),mr&&(mr.allSettled&&E(ge,"allSettled",function(){var d=Ze.apply(null,arguments).map(Ao);return new ge(function(f){d.length===0&&f([]);var I=d.length,w=new Array(I);d.forEach(function(R,P){return ge.resolve(R).then(function(N){return w[P]={status:"fulfilled",value:N}},function(N){return w[P]={status:"rejected",reason:N}}).then(function(){return--I||f(w)})})})}),mr.any&&typeof AggregateError<"u"&&E(ge,"any",function(){var d=Ze.apply(null,arguments).map(Ao);return new ge(function(f,I){d.length===0&&I(new AggregateError([]));var w=d.length,R=new Array(w);d.forEach(function(P,N){return ge.resolve(P).then(function(U){return f(U)},function(U){R[N]=U,--w||I(new AggregateError(R))})})})}));var vt={awaits:0,echoes:0,id:0},EE=0,vo=[],Ro=0,Fo=0,gE=0;function fi(d,f,I,w){var R=Te,P=Object.create(R);return P.parent=R,P.ref=0,P.global=!1,P.id=++gE,pi.env,P.env=xl?{Promise:ge,PromiseProp:{value:ge,configurable:!0,writable:!0},all:ge.all,race:ge.race,allSettled:ge.allSettled,any:ge.any,resolve:ge.resolve,reject:ge.reject}:{},f&&a(P,f),++R.ref,P.finalize=function(){--this.parent.ref||this.parent.finalize()},w=Yi(P,d,I,w),P.ref===0&&P.finalize(),w}function pn(){return vt.id||(vt.id=++EE),++vt.awaits,vt.echoes+=gd,vt.id}function mi(){return!!vt.awaits&&(--vt.awaits==0&&(vt.id=0),vt.echoes=vt.awaits*gd,!0)}function Ao(d){return vt.echoes&&d&&d.constructor===mr?(pn(),d.then(function(f){return mi(),f},function(f){return mi(),ut(f)})):d}function IE(){var d=vo[vo.length-1];vo.pop(),Ei(d,!1)}function Ei(d,f){var I,w=Te;(f?!vt.echoes||Ro++&&d===Te:!Ro||--Ro&&d===Te)||queueMicrotask(f?(function(R){++Fo,vt.echoes&&--vt.echoes!=0||(vt.echoes=vt.awaits=vt.id=0),vo.push(Te),Ei(R,!0)}).bind(null,d):IE),d!==Te&&(Te=d,w===pi&&(pi.env=Td()),xl&&(I=pi.env.Promise,f=d.env,(w.global||d.global)&&(Object.defineProperty(n,"Promise",f.PromiseProp),I.all=f.all,I.race=f.race,I.resolve=f.resolve,I.reject=f.reject,f.allSettled&&(I.allSettled=f.allSettled),f.any&&(I.any=f.any))))}function Td(){var d=n.Promise;return xl?{Promise:d,PromiseProp:Object.getOwnPropertyDescriptor(n,"Promise"),all:d.all,race:d.race,allSettled:d.allSettled,any:d.any,resolve:d.resolve,reject:d.reject}:{}}function Yi(d,f,I,w,R){var P=Te;try{return Ei(d,!0),f(I,w,R)}finally{Ei(P,!1)}}function yd(d,f,I,w){return typeof d!="function"?d:function(){var R=Te;I&&pn(),Ei(f,!0);try{return d.apply(this,arguments)}finally{Ei(R,!1),w&&queueMicrotask(mi)}}}function Bl(d){Promise===mr&&vt.echoes===0?Ro===0?d():enqueueNativeMicroTask(d):setTimeout(d,0)}(""+ns).indexOf("[native code]")===-1&&(pn=mi=ke);var ut=ge.reject,ki="",ei="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",wd="String expected.",fn=[],So="__dbnames",zl="readonly",Yl="readwrite";function Vi(d,f){return d?f?function(){return d.apply(this,arguments)&&f.apply(this,arguments)}:d:f}var vd={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Oo(d){return typeof d!="string"||/\./.test(d)?function(f){return f}:function(f){return f[d]===void 0&&d in f&&delete(f=Q(f))[d],f}}function Rd(){throw Ce.Type()}function Ye(d,f){try{var I=Fd(d),w=Fd(f);if(I!==w)return I==="Array"?1:w==="Array"?-1:I==="binary"?1:w==="binary"?-1:I==="string"?1:w==="string"?-1:I==="Date"?1:w!=="Date"?NaN:-1;switch(I){case"number":case"Date":case"string":return f<d?1:d<f?-1:0;case"binary":return function(R,P){for(var N=R.length,U=P.length,H=N<U?N:U,k=0;k<H;++k)if(R[k]!==P[k])return R[k]<P[k]?-1:1;return N===U?0:N<U?-1:1}(Ad(d),Ad(f));case"Array":return function(R,P){for(var N=R.length,U=P.length,H=N<U?N:U,k=0;k<H;++k){var K=Ye(R[k],P[k]);if(K!==0)return K}return N===U?0:N<U?-1:1}(d,f)}}catch{}return NaN}function Fd(d){var f=typeof d;return f!="object"?f:ArrayBuffer.isView(d)?"binary":(d=ue(d),d==="ArrayBuffer"?"binary":d)}function Ad(d){return d instanceof Uint8Array?d:ArrayBuffer.isView(d)?new Uint8Array(d.buffer,d.byteOffset,d.byteLength):new Uint8Array(d)}var Sd=(tt.prototype._trans=function(d,f,I){var w=this._tx||Te.trans,R=this.name,P=bs&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(d==="readonly"?"read":"write"," ").concat(this.name));function N(k,K,Y){if(!Y.schema[R])throw new Ce.NotFound("Table "+R+" not part of transaction");return f(Y.idbtrans,Y)}var U=dn();try{var H=w&&w.db._novip===this.db._novip?w===Te.trans?w._promise(d,N,I):fi(function(){return w._promise(d,N,I)},{trans:w,transless:Te.transless||Te}):function k(K,Y,Z,G){if(K.idbdb&&(K._state.openComplete||Te.letThrough||K._vip)){var W=K._createTransaction(Y,Z,K._dbSchema);try{W.create(),K._state.PR1398_maxLoop=3}catch(j){return j.name===Bt.InvalidState&&K.isOpen()&&0<--K._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),K.close({disableAutoOpen:!1}),K.open().then(function(){return k(K,Y,Z,G)})):ut(j)}return W._promise(Y,function(j,X){return fi(function(){return Te.trans=W,G(j,X,W)})}).then(function(j){if(Y==="readwrite")try{W.idbtrans.commit()}catch{}return Y==="readonly"?j:W._completion.then(function(){return j})})}if(K._state.openComplete)return ut(new Ce.DatabaseClosed(K._state.dbOpenError));if(!K._state.isBeingOpened){if(!K._state.autoOpen)return ut(new Ce.DatabaseClosed);K.open().catch(ke)}return K._state.dbReadyPromise.then(function(){return k(K,Y,Z,G)})}(this.db,d,[this.name],N);return P&&(H._consoleTask=P,H=H.catch(function(k){return console.trace(k),ut(k)})),H}finally{U&&un()}},tt.prototype.get=function(d,f){var I=this;return d&&d.constructor===Object?this.where(d).first(f):d==null?ut(new Ce.Type("Invalid argument to Table.get()")):this._trans("readonly",function(w){return I.core.get({trans:w,key:d}).then(function(R){return I.hook.reading.fire(R)})}).then(f)},tt.prototype.where=function(d){if(typeof d=="string")return new this.db.WhereClause(this,d);if(o(d))return new this.db.WhereClause(this,"[".concat(d.join("+"),"]"));var f=r(d);if(f.length===1)return this.where(f[0]).equals(d[f[0]]);var I=this.schema.indexes.concat(this.schema.primKey).filter(function(H){if(H.compound&&f.every(function(K){return 0<=H.keyPath.indexOf(K)})){for(var k=0;k<f.length;++k)if(f.indexOf(H.keyPath[k])===-1)return!1;return!0}return!1}).sort(function(H,k){return H.keyPath.length-k.keyPath.length})[0];if(I&&this.db._maxKey!==ki){var N=I.keyPath.slice(0,f.length);return this.where(N).equals(N.map(function(k){return d[k]}))}!I&&bs&&console.warn("The query ".concat(JSON.stringify(d)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(f.join("+"),"]"));var w=this.schema.idxByName,R=this.db._deps.indexedDB;function P(H,k){return R.cmp(H,k)===0}var U=f.reduce(function(Z,k){var K=Z[0],Y=Z[1],Z=w[k],G=d[k];return[K||Z,K||!Z?Vi(Y,Z&&Z.multi?function(W){return W=M(W,k),o(W)&&W.some(function(j){return P(G,j)})}:function(W){return P(G,M(W,k))}):Y]},[null,null]),N=U[0],U=U[1];return N?this.where(N.name).equals(d[N.keyPath]).filter(U):I?this.filter(U):this.where(f).equals("")},tt.prototype.filter=function(d){return this.toCollection().and(d)},tt.prototype.count=function(d){return this.toCollection().count(d)},tt.prototype.offset=function(d){return this.toCollection().offset(d)},tt.prototype.limit=function(d){return this.toCollection().limit(d)},tt.prototype.each=function(d){return this.toCollection().each(d)},tt.prototype.toArray=function(d){return this.toCollection().toArray(d)},tt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},tt.prototype.orderBy=function(d){return new this.db.Collection(new this.db.WhereClause(this,o(d)?"[".concat(d.join("+"),"]"):d))},tt.prototype.reverse=function(){return this.toCollection().reverse()},tt.prototype.mapToClass=function(d){var f,I=this.db,w=this.name;function R(){return f!==null&&f.apply(this,arguments)||this}(this.schema.mappedClass=d).prototype instanceof Rd&&(function(H,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");function K(){this.constructor=H}t(H,k),H.prototype=k===null?Object.create(k):(K.prototype=k.prototype,new K)}(R,f=d),Object.defineProperty(R.prototype,"db",{get:function(){return I},enumerable:!1,configurable:!0}),R.prototype.table=function(){return w},d=R);for(var P=new Set,N=d.prototype;N;N=l(N))Object.getOwnPropertyNames(N).forEach(function(H){return P.add(H)});function U(H){if(!H)return H;var k,K=Object.create(d.prototype);for(k in H)if(!P.has(k))try{K[k]=H[k]}catch{}return K}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=U,this.hook("reading",U),d},tt.prototype.defineClass=function(){return this.mapToClass(function(d){a(this,d)})},tt.prototype.add=function(d,f){var I=this,w=this.schema.primKey,R=w.auto,P=w.keyPath,N=d;return P&&R&&(N=Oo(P)(d)),this._trans("readwrite",function(U){return I.core.mutate({trans:U,type:"add",keys:f!=null?[f]:null,values:[N]})}).then(function(U){return U.numFailures?ge.reject(U.failures[0]):U.lastResult}).then(function(U){if(P)try{_(d,P,U)}catch{}return U})},tt.prototype.update=function(d,f){return typeof d!="object"||o(d)?this.where(":id").equals(d).modify(f):(d=M(d,this.schema.primKey.keyPath),d===void 0?ut(new Ce.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(d).modify(f))},tt.prototype.put=function(d,f){var I=this,w=this.schema.primKey,R=w.auto,P=w.keyPath,N=d;return P&&R&&(N=Oo(P)(d)),this._trans("readwrite",function(U){return I.core.mutate({trans:U,type:"put",values:[N],keys:f!=null?[f]:null})}).then(function(U){return U.numFailures?ge.reject(U.failures[0]):U.lastResult}).then(function(U){if(P)try{_(d,P,U)}catch{}return U})},tt.prototype.delete=function(d){var f=this;return this._trans("readwrite",function(I){return f.core.mutate({trans:I,type:"delete",keys:[d]})}).then(function(I){return I.numFailures?ge.reject(I.failures[0]):void 0})},tt.prototype.clear=function(){var d=this;return this._trans("readwrite",function(f){return d.core.mutate({trans:f,type:"deleteRange",range:vd})}).then(function(f){return f.numFailures?ge.reject(f.failures[0]):void 0})},tt.prototype.bulkGet=function(d){var f=this;return this._trans("readonly",function(I){return f.core.getMany({keys:d,trans:I}).then(function(w){return w.map(function(R){return f.hook.reading.fire(R)})})})},tt.prototype.bulkAdd=function(d,f,I){var w=this,R=Array.isArray(f)?f:void 0,P=(I=I||(R?void 0:f))?I.allKeys:void 0;return this._trans("readwrite",function(N){var k=w.schema.primKey,U=k.auto,k=k.keyPath;if(k&&R)throw new Ce.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(R&&R.length!==d.length)throw new Ce.InvalidArgument("Arguments objects and keys must have the same length");var H=d.length,k=k&&U?d.map(Oo(k)):d;return w.core.mutate({trans:N,type:"add",keys:R,values:k,wantResults:P}).then(function(W){var Y=W.numFailures,Z=W.results,G=W.lastResult,W=W.failures;if(Y===0)return P?Z:G;throw new is("".concat(w.name,".bulkAdd(): ").concat(Y," of ").concat(H," operations failed"),W)})})},tt.prototype.bulkPut=function(d,f,I){var w=this,R=Array.isArray(f)?f:void 0,P=(I=I||(R?void 0:f))?I.allKeys:void 0;return this._trans("readwrite",function(N){var k=w.schema.primKey,U=k.auto,k=k.keyPath;if(k&&R)throw new Ce.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(R&&R.length!==d.length)throw new Ce.InvalidArgument("Arguments objects and keys must have the same length");var H=d.length,k=k&&U?d.map(Oo(k)):d;return w.core.mutate({trans:N,type:"put",keys:R,values:k,wantResults:P}).then(function(W){var Y=W.numFailures,Z=W.results,G=W.lastResult,W=W.failures;if(Y===0)return P?Z:G;throw new is("".concat(w.name,".bulkPut(): ").concat(Y," of ").concat(H," operations failed"),W)})})},tt.prototype.bulkUpdate=function(d){var f=this,I=this.core,w=d.map(function(N){return N.key}),R=d.map(function(N){return N.changes}),P=[];return this._trans("readwrite",function(N){return I.getMany({trans:N,keys:w,cache:"clone"}).then(function(U){var H=[],k=[];d.forEach(function(Y,Z){var G=Y.key,W=Y.changes,j=U[Z];if(j){for(var X=0,q=Object.keys(W);X<q.length;X++){var $=q[X],ee=W[$];if($===f.schema.primKey.keyPath){if(Ye(ee,G)!==0)throw new Ce.Constraint("Cannot update primary key in bulkUpdate()")}else _(j,$,ee)}P.push(Z),H.push(G),k.push(j)}});var K=H.length;return I.mutate({trans:N,type:"put",keys:H,values:k,updates:{keys:w,changeSpecs:R}}).then(function(Y){var Z=Y.numFailures,G=Y.failures;if(Z===0)return K;for(var W=0,j=Object.keys(G);W<j.length;W++){var X,q=j[W],$=P[Number(q)];$!=null&&(X=G[q],delete G[q],G[$]=X)}throw new is("".concat(f.name,".bulkUpdate(): ").concat(Z," of ").concat(K," operations failed"),G)})})})},tt.prototype.bulkDelete=function(d){var f=this,I=d.length;return this._trans("readwrite",function(w){return f.core.mutate({trans:w,type:"delete",keys:d})}).then(function(N){var R=N.numFailures,P=N.lastResult,N=N.failures;if(R===0)return P;throw new is("".concat(f.name,".bulkDelete(): ").concat(R," of ").concat(I," operations failed"),N)})},tt);function tt(){}function Ir(d){function f(N,U){if(U){for(var H=arguments.length,k=new Array(H-1);--H;)k[H-1]=arguments[H];return I[N].subscribe.apply(null,k),d}if(typeof N=="string")return I[N]}var I={};f.addEventType=P;for(var w=1,R=arguments.length;w<R;++w)P(arguments[w]);return f;function P(N,U,H){if(typeof N!="object"){var k;U=U||pE;var K={subscribers:[],fire:H=H||ke,subscribe:function(Y){K.subscribers.indexOf(Y)===-1&&(K.subscribers.push(Y),K.fire=U(K.fire,Y))},unsubscribe:function(Y){K.subscribers=K.subscribers.filter(function(Z){return Z!==Y}),K.fire=K.subscribers.reduce(U,H)}};return I[N]=f[N]=K}r(k=N).forEach(function(Y){var Z=k[Y];if(o(Z))P(Y,k[Y][0],k[Y][1]);else{if(Z!=="asap")throw new Ce.InvalidArgument("Invalid event config");var G=P(Y,zt,function(){for(var W=arguments.length,j=new Array(W);W--;)j[W]=arguments[W];G.subscribers.forEach(function(X){F(function(){X.apply(null,j)})})})}})}}function Cr(d,f){return g(f).from({prototype:d}),f}function mn(d,f){return!(d.filter||d.algorithm||d.or)&&(f?d.justLimit:!d.replayFilter)}function kl(d,f){d.filter=Vi(d.filter,f)}function Vl(d,f,I){var w=d.replayFilter;d.replayFilter=w?function(){return Vi(w(),f())}:f,d.justLimit=I&&!w}function Po(d,f){if(d.isPrimKey)return f.primaryKey;var I=f.getIndexByKeyPath(d.index);if(!I)throw new Ce.Schema("KeyPath "+d.index+" on object store "+f.name+" is not indexed");return I}function Od(d,f,I){var w=Po(d,f.schema);return f.openCursor({trans:I,values:!d.keysOnly,reverse:d.dir==="prev",unique:!!d.unique,query:{index:w,range:d.range}})}function bo(d,f,I,w){var R=d.replayFilter?Vi(d.filter,d.replayFilter()):d.filter;if(d.or){var P={},N=function(U,H,k){var K,Y;R&&!R(H,k,function(Z){return H.stop(Z)},function(Z){return H.fail(Z)})||((Y=""+(K=H.primaryKey))=="[object ArrayBuffer]"&&(Y=""+new Uint8Array(K)),p(P,Y)||(P[Y]=!0,f(U,H,k)))};return Promise.all([d.or._iterate(N,I),Pd(Od(d,w,I),d.algorithm,N,!d.keysOnly&&d.valueMapper)])}return Pd(Od(d,w,I),Vi(d.algorithm,R),f,!d.keysOnly&&d.valueMapper)}function Pd(d,f,I,w){var R=nt(w?function(P,N,U){return I(w(P),N,U)}:I);return d.then(function(P){if(P)return P.start(function(){var N=function(){return P.continue()};f&&!f(P,function(U){return N=U},function(U){P.stop(U),N=ke},function(U){P.fail(U),N=ke})||R(P.value,P,function(U){return N=U}),N()})})}var ti=Symbol(),Tr=(bd.prototype.execute=function(d){if(this.add!==void 0){var f=this.add;if(o(f))return i(i([],o(d)?d:[],!0),f).sort();if(typeof f=="number")return(Number(d)||0)+f;if(typeof f=="bigint")try{return BigInt(d)+f}catch{return BigInt(0)+f}throw new TypeError("Invalid term ".concat(f))}if(this.remove!==void 0){var I=this.remove;if(o(I))return o(d)?d.filter(function(w){return!I.includes(w)}).sort():[];if(typeof I=="number")return Number(d)-I;if(typeof I=="bigint")try{return BigInt(d)-I}catch{return BigInt(0)-I}throw new TypeError("Invalid subtrahend ".concat(I))}return f=(f=this.replacePrefix)===null||f===void 0?void 0:f[0],f&&typeof d=="string"&&d.startsWith(f)?this.replacePrefix[1]+d.substring(f.length):d},bd);function bd(d){Object.assign(this,d)}var CE=(Ve.prototype._read=function(d,f){var I=this._ctx;return I.error?I.table._trans(null,ut.bind(null,I.error)):I.table._trans("readonly",d).then(f)},Ve.prototype._write=function(d){var f=this._ctx;return f.error?f.table._trans(null,ut.bind(null,f.error)):f.table._trans("readwrite",d,"locked")},Ve.prototype._addAlgorithm=function(d){var f=this._ctx;f.algorithm=Vi(f.algorithm,d)},Ve.prototype._iterate=function(d,f){return bo(this._ctx,d,f,this._ctx.table.core)},Ve.prototype.clone=function(d){var f=Object.create(this.constructor.prototype),I=Object.create(this._ctx);return d&&a(I,d),f._ctx=I,f},Ve.prototype.raw=function(){return this._ctx.valueMapper=null,this},Ve.prototype.each=function(d){var f=this._ctx;return this._read(function(I){return bo(f,d,I,f.table.core)})},Ve.prototype.count=function(d){var f=this;return this._read(function(I){var w=f._ctx,R=w.table.core;if(mn(w,!0))return R.count({trans:I,query:{index:Po(w,R.schema),range:w.range}}).then(function(N){return Math.min(N,w.limit)});var P=0;return bo(w,function(){return++P,!1},I,R).then(function(){return P})}).then(d)},Ve.prototype.sortBy=function(d,f){var I=d.split(".").reverse(),w=I[0],R=I.length-1;function P(H,k){return k?P(H[I[k]],k-1):H[w]}var N=this._ctx.dir==="next"?1:-1;function U(H,k){return H=P(H,R),k=P(k,R),H<k?-N:k<H?N:0}return this.toArray(function(H){return H.sort(U)}).then(f)},Ve.prototype.toArray=function(d){var f=this;return this._read(function(I){var w=f._ctx;if(w.dir==="next"&&mn(w,!0)&&0<w.limit){var R=w.valueMapper,P=Po(w,w.table.core.schema);return w.table.core.query({trans:I,limit:w.limit,values:!0,query:{index:P,range:w.range}}).then(function(U){return U=U.result,R?U.map(R):U})}var N=[];return bo(w,function(U){return N.push(U)},I,w.table.core).then(function(){return N})},d)},Ve.prototype.offset=function(d){var f=this._ctx;return d<=0||(f.offset+=d,mn(f)?Vl(f,function(){var I=d;return function(w,R){return I===0||(I===1?--I:R(function(){w.advance(I),I=0}),!1)}}):Vl(f,function(){var I=d;return function(){return--I<0}})),this},Ve.prototype.limit=function(d){return this._ctx.limit=Math.min(this._ctx.limit,d),Vl(this._ctx,function(){var f=d;return function(I,w,R){return--f<=0&&w(R),0<=f}},!0),this},Ve.prototype.until=function(d,f){return kl(this._ctx,function(I,w,R){return!d(I.value)||(w(R),f)}),this},Ve.prototype.first=function(d){return this.limit(1).toArray(function(f){return f[0]}).then(d)},Ve.prototype.last=function(d){return this.reverse().first(d)},Ve.prototype.filter=function(d){var f;return kl(this._ctx,function(I){return d(I.value)}),(f=this._ctx).isMatch=Vi(f.isMatch,d),this},Ve.prototype.and=function(d){return this.filter(d)},Ve.prototype.or=function(d){return new this.db.WhereClause(this._ctx.table,d,this)},Ve.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Ve.prototype.desc=function(){return this.reverse()},Ve.prototype.eachKey=function(d){var f=this._ctx;return f.keysOnly=!f.isMatch,this.each(function(I,w){d(w.key,w)})},Ve.prototype.eachUniqueKey=function(d){return this._ctx.unique="unique",this.eachKey(d)},Ve.prototype.eachPrimaryKey=function(d){var f=this._ctx;return f.keysOnly=!f.isMatch,this.each(function(I,w){d(w.primaryKey,w)})},Ve.prototype.keys=function(d){var f=this._ctx;f.keysOnly=!f.isMatch;var I=[];return this.each(function(w,R){I.push(R.key)}).then(function(){return I}).then(d)},Ve.prototype.primaryKeys=function(d){var f=this._ctx;if(f.dir==="next"&&mn(f,!0)&&0<f.limit)return this._read(function(w){var R=Po(f,f.table.core.schema);return f.table.core.query({trans:w,values:!1,limit:f.limit,query:{index:R,range:f.range}})}).then(function(w){return w.result}).then(d);f.keysOnly=!f.isMatch;var I=[];return this.each(function(w,R){I.push(R.primaryKey)}).then(function(){return I}).then(d)},Ve.prototype.uniqueKeys=function(d){return this._ctx.unique="unique",this.keys(d)},Ve.prototype.firstKey=function(d){return this.limit(1).keys(function(f){return f[0]}).then(d)},Ve.prototype.lastKey=function(d){return this.reverse().firstKey(d)},Ve.prototype.distinct=function(){var d=this._ctx,d=d.index&&d.table.schema.idxByName[d.index];if(!d||!d.multi)return this;var f={};return kl(this._ctx,function(R){var w=R.primaryKey.toString(),R=p(f,w);return f[w]=!0,!R}),this},Ve.prototype.modify=function(d){var f=this,I=this._ctx;return this._write(function(w){var R,P,N;N=typeof d=="function"?d:(R=r(d),P=R.length,function(X){for(var q=!1,$=0;$<P;++$){var ee=R[$],re=d[ee],le=M(X,ee);re instanceof Tr?(_(X,ee,re.execute(le)),q=!0):le!==re&&(_(X,ee,re),q=!0)}return q});function U(X,ee){var $=ee.failures,ee=ee.numFailures;W+=X-ee;for(var re=0,le=r($);re<le.length;re++){var me=le[re];G.push($[me])}}var H=I.table.core,k=H.schema.primaryKey,K=k.outbound,Y=k.extractKey,Z=f.db._options.modifyChunkSize||200,G=[],W=0,j=[];return f.clone().primaryKeys().then(function(X){function q(ee){var re=Math.min(Z,X.length-ee);return H.getMany({trans:w,keys:X.slice(ee,ee+re),cache:"immutable"}).then(function(le){for(var me=[],he=[],fe=K?[]:null,Ee=[],ae=0;ae<re;++ae){var Se=le[ae],Oe={value:Q(Se),primKey:X[ee+ae]};N.call(Oe,Oe.value,Oe)!==!1&&(Oe.value==null?Ee.push(X[ee+ae]):K||Ye(Y(Se),Y(Oe.value))===0?(he.push(Oe.value),K&&fe.push(X[ee+ae])):(Ee.push(X[ee+ae]),me.push(Oe.value)))}return Promise.resolve(0<me.length&&H.mutate({trans:w,type:"add",values:me}).then(function(Ne){for(var _e in Ne.failures)Ee.splice(parseInt(_e),1);U(me.length,Ne)})).then(function(){return(0<he.length||$&&typeof d=="object")&&H.mutate({trans:w,type:"put",keys:fe,values:he,criteria:$,changeSpec:typeof d!="function"&&d,isAdditionalChunk:0<ee}).then(function(Ne){return U(he.length,Ne)})}).then(function(){return(0<Ee.length||$&&d===Gl)&&H.mutate({trans:w,type:"delete",keys:Ee,criteria:$,isAdditionalChunk:0<ee}).then(function(Ne){return U(Ee.length,Ne)})}).then(function(){return X.length>ee+re&&q(ee+Z)})})}var $=mn(I)&&I.limit===1/0&&(typeof d!="function"||d===Gl)&&{index:I.index,range:I.range};return q(0).then(function(){if(0<G.length)throw new Ps("Error modifying one or more objects",G,W,j);return X.length})})})},Ve.prototype.delete=function(){var d=this._ctx,f=d.range;return mn(d)&&(d.isPrimKey||f.type===3)?this._write(function(I){var w=d.table.core.schema.primaryKey,R=f;return d.table.core.count({trans:I,query:{index:w,range:R}}).then(function(P){return d.table.core.mutate({trans:I,type:"deleteRange",range:R}).then(function(N){var U=N.failures;if(N.lastResult,N.results,N=N.numFailures,N)throw new Ps("Could not delete some values",Object.keys(U).map(function(H){return U[H]}),P-N);return P-N})})}):this.modify(Gl)},Ve);function Ve(){}var Gl=function(d,f){return f.value=null};function TE(d,f){return d<f?-1:d===f?0:1}function yE(d,f){return f<d?-1:d===f?0:1}function qt(d,f,I){return d=d instanceof Md?new d.Collection(d):d,d._ctx.error=new(I||TypeError)(f),d}function En(d){return new d.Collection(d,function(){return xd("")}).limit(0)}function xo(d,f,I,w){var R,P,N,U,H,k,K,Y=I.length;if(!I.every(function(W){return typeof W=="string"}))return qt(d,wd);function Z(W){R=W==="next"?function(X){return X.toUpperCase()}:function(X){return X.toLowerCase()},P=W==="next"?function(X){return X.toLowerCase()}:function(X){return X.toUpperCase()},N=W==="next"?TE:yE;var j=I.map(function(X){return{lower:P(X),upper:R(X)}}).sort(function(X,q){return N(X.lower,q.lower)});U=j.map(function(X){return X.upper}),H=j.map(function(X){return X.lower}),K=(k=W)==="next"?"":w}Z("next"),d=new d.Collection(d,function(){return gi(U[0],H[Y-1]+w)}),d._ondirectionchange=function(W){Z(W)};var G=0;return d._addAlgorithm(function(W,j,X){var q=W.key;if(typeof q!="string")return!1;var $=P(q);if(f($,H,G))return!0;for(var ee=null,re=G;re<Y;++re){var le=function(me,he,fe,Ee,ae,Se){for(var Oe=Math.min(me.length,Ee.length),Ne=-1,_e=0;_e<Oe;++_e){var Cs=he[_e];if(Cs!==Ee[_e])return ae(me[_e],fe[_e])<0?me.substr(0,_e)+fe[_e]+fe.substr(_e+1):ae(me[_e],Ee[_e])<0?me.substr(0,_e)+Ee[_e]+fe.substr(_e+1):0<=Ne?me.substr(0,Ne)+he[Ne]+fe.substr(Ne+1):null;ae(me[_e],Cs)<0&&(Ne=_e)}return Oe<Ee.length&&Se==="next"?me+fe.substr(me.length):Oe<me.length&&Se==="prev"?me.substr(0,fe.length):Ne<0?null:me.substr(0,Ne)+Ee[Ne]+fe.substr(Ne+1)}(q,$,U[re],H[re],N,k);le===null&&ee===null?G=re+1:(ee===null||0<N(ee,le))&&(ee=le)}return j(ee!==null?function(){W.continue(ee+K)}:X),!1}),d}function gi(d,f,I,w){return{type:2,lower:d,upper:f,lowerOpen:I,upperOpen:w}}function xd(d){return{type:1,lower:d,upper:d}}var Md=(Object.defineProperty(Rt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Rt.prototype.between=function(d,f,I,w){I=I!==!1,w=w===!0;try{return 0<this._cmp(d,f)||this._cmp(d,f)===0&&(I||w)&&(!I||!w)?En(this):new this.Collection(this,function(){return gi(d,f,!I,!w)})}catch{return qt(this,ei)}},Rt.prototype.equals=function(d){return d==null?qt(this,ei):new this.Collection(this,function(){return xd(d)})},Rt.prototype.above=function(d){return d==null?qt(this,ei):new this.Collection(this,function(){return gi(d,void 0,!0)})},Rt.prototype.aboveOrEqual=function(d){return d==null?qt(this,ei):new this.Collection(this,function(){return gi(d,void 0,!1)})},Rt.prototype.below=function(d){return d==null?qt(this,ei):new this.Collection(this,function(){return gi(void 0,d,!1,!0)})},Rt.prototype.belowOrEqual=function(d){return d==null?qt(this,ei):new this.Collection(this,function(){return gi(void 0,d)})},Rt.prototype.startsWith=function(d){return typeof d!="string"?qt(this,wd):this.between(d,d+ki,!0,!0)},Rt.prototype.startsWithIgnoreCase=function(d){return d===""?this.startsWith(d):xo(this,function(f,I){return f.indexOf(I[0])===0},[d],ki)},Rt.prototype.equalsIgnoreCase=function(d){return xo(this,function(f,I){return f===I[0]},[d],"")},Rt.prototype.anyOfIgnoreCase=function(){var d=Ze.apply(ye,arguments);return d.length===0?En(this):xo(this,function(f,I){return I.indexOf(f)!==-1},d,"")},Rt.prototype.startsWithAnyOfIgnoreCase=function(){var d=Ze.apply(ye,arguments);return d.length===0?En(this):xo(this,function(f,I){return I.some(function(w){return f.indexOf(w)===0})},d,ki)},Rt.prototype.anyOf=function(){var d=this,f=Ze.apply(ye,arguments),I=this._cmp;try{f.sort(I)}catch{return qt(this,ei)}if(f.length===0)return En(this);var w=new this.Collection(this,function(){return gi(f[0],f[f.length-1])});w._ondirectionchange=function(P){I=P==="next"?d._ascending:d._descending,f.sort(I)};var R=0;return w._addAlgorithm(function(P,N,U){for(var H=P.key;0<I(H,f[R]);)if(++R===f.length)return N(U),!1;return I(H,f[R])===0||(N(function(){P.continue(f[R])}),!1)}),w},Rt.prototype.notEqual=function(d){return this.inAnyRange([[-1/0,d],[d,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Rt.prototype.noneOf=function(){var d=Ze.apply(ye,arguments);if(d.length===0)return new this.Collection(this);try{d.sort(this._ascending)}catch{return qt(this,ei)}var f=d.reduce(function(I,w){return I?I.concat([[I[I.length-1][1],w]]):[[-1/0,w]]},null);return f.push([d[d.length-1],this.db._maxKey]),this.inAnyRange(f,{includeLowers:!1,includeUppers:!1})},Rt.prototype.inAnyRange=function(q,f){var I=this,w=this._cmp,R=this._ascending,P=this._descending,N=this._min,U=this._max;if(q.length===0)return En(this);if(!q.every(function($){return $[0]!==void 0&&$[1]!==void 0&&R($[0],$[1])<=0}))return qt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Ce.InvalidArgument);var H=!f||f.includeLowers!==!1,k=f&&f.includeUppers===!0,K,Y=R;function Z($,ee){return Y($[0],ee[0])}try{(K=q.reduce(function($,ee){for(var re=0,le=$.length;re<le;++re){var me=$[re];if(w(ee[0],me[1])<0&&0<w(ee[1],me[0])){me[0]=N(me[0],ee[0]),me[1]=U(me[1],ee[1]);break}}return re===le&&$.push(ee),$},[])).sort(Z)}catch{return qt(this,ei)}var G=0,W=k?function($){return 0<R($,K[G][1])}:function($){return 0<=R($,K[G][1])},j=H?function($){return 0<P($,K[G][0])}:function($){return 0<=P($,K[G][0])},X=W,q=new this.Collection(this,function(){return gi(K[0][0],K[K.length-1][1],!H,!k)});return q._ondirectionchange=function($){Y=$==="next"?(X=W,R):(X=j,P),K.sort(Z)},q._addAlgorithm(function($,ee,re){for(var le,me=$.key;X(me);)if(++G===K.length)return ee(re),!1;return!W(le=me)&&!j(le)||(I._cmp(me,K[G][1])===0||I._cmp(me,K[G][0])===0||ee(function(){Y===R?$.continue(K[G][0]):$.continue(K[G][1])}),!1)}),q},Rt.prototype.startsWithAnyOf=function(){var d=Ze.apply(ye,arguments);return d.every(function(f){return typeof f=="string"})?d.length===0?En(this):this.inAnyRange(d.map(function(f){return[f,f+ki]})):qt(this,"startsWithAnyOf() only works with strings")},Rt);function Rt(){}function xs(d){return nt(function(f){return yr(f),d(f.target.error),!1})}function yr(d){d.stopPropagation&&d.stopPropagation(),d.preventDefault&&d.preventDefault()}var wr="storagemutated",Hl="x-storagemutated-1",Ii=Ir(null,wr),wE=(Ms.prototype._lock=function(){return C(!Te.global),++this._reculock,this._reculock!==1||Te.global||(Te.lockOwnerFor=this),this},Ms.prototype._unlock=function(){if(C(!Te.global),--this._reculock==0)for(Te.global||(Te.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var d=this._blockedFuncs.shift();try{Yi(d[1],d[0])}catch{}}return this},Ms.prototype._locked=function(){return this._reculock&&Te.lockOwnerFor!==this},Ms.prototype.create=function(d){var f=this;if(!this.mode)return this;var I=this.db.idbdb,w=this.db._state.dbOpenError;if(C(!this.idbtrans),!d&&!I)switch(w&&w.name){case"DatabaseClosedError":throw new Ce.DatabaseClosed(w);case"MissingAPIError":throw new Ce.MissingAPI(w.message,w);default:throw new Ce.OpenFailed(w)}if(!this.active)throw new Ce.TransactionInactive;return C(this._completion._state===null),(d=this.idbtrans=d||(this.db.core||I).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=nt(function(R){yr(R),f._reject(d.error)}),d.onabort=nt(function(R){yr(R),f.active&&f._reject(new Ce.Abort(d.error)),f.active=!1,f.on("abort").fire(R)}),d.oncomplete=nt(function(){f.active=!1,f._resolve(),"mutatedParts"in d&&Ii.storagemutated.fire(d.mutatedParts)}),this},Ms.prototype._promise=function(d,f,I){var w=this;if(d==="readwrite"&&this.mode!=="readwrite")return ut(new Ce.ReadOnly("Transaction is readonly"));if(!this.active)return ut(new Ce.TransactionInactive);if(this._locked())return new ge(function(P,N){w._blockedFuncs.push([function(){w._promise(d,f,I).then(P,N)},Te])});if(I)return fi(function(){var P=new ge(function(N,U){w._lock();var H=f(N,U,w);H&&H.then&&H.then(N,U)});return P.finally(function(){return w._unlock()}),P._lib=!0,P});var R=new ge(function(P,N){var U=f(P,N,w);U&&U.then&&U.then(P,N)});return R._lib=!0,R},Ms.prototype._root=function(){return this.parent?this.parent._root():this},Ms.prototype.waitFor=function(d){var f,I=this._root(),w=ge.resolve(d);I._waitingFor?I._waitingFor=I._waitingFor.then(function(){return w}):(I._waitingFor=w,I._waitingQueue=[],f=I.idbtrans.objectStore(I.storeNames[0]),function P(){for(++I._spinCount;I._waitingQueue.length;)I._waitingQueue.shift()();I._waitingFor&&(f.get(-1/0).onsuccess=P)}());var R=I._waitingFor;return new ge(function(P,N){w.then(function(U){return I._waitingQueue.push(nt(P.bind(null,U)))},function(U){return I._waitingQueue.push(nt(N.bind(null,U)))}).finally(function(){I._waitingFor===R&&(I._waitingFor=null)})})},Ms.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Ce.Abort))},Ms.prototype.table=function(d){var f=this._memoizedTables||(this._memoizedTables={});if(p(f,d))return f[d];var I=this.schema[d];if(!I)throw new Ce.NotFound("Table "+d+" not part of transaction");return I=new this.db.Table(d,I,this),I.core=this.db.core.table(d),f[d]=I},Ms);function Ms(){}function Wl(d,f,I,w,R,P,N){return{name:d,keyPath:f,unique:I,multi:w,auto:R,compound:P,src:(I&&!N?"&":"")+(w?"*":"")+(R?"++":"")+_d(f)}}function _d(d){return typeof d=="string"?d:d?"["+[].join.call(d,"+")+"]":""}function Xl(d,f,I){return{name:d,primKey:f,indexes:I,mappedClass:null,idxByName:(w=function(R){return[R.name,R]},I.reduce(function(R,P,N){return N=w(P,N),N&&(R[N[0]]=N[1]),R},{}))};var w}var vr=function(d){try{return d.only([[]]),vr=function(){return[[]]},[[]]}catch{return vr=function(){return ki},ki}};function Kl(d){return d==null?function(){}:typeof d=="string"?(f=d).split(".").length===1?function(I){return I[f]}:function(I){return M(I,f)}:function(I){return M(I,d)};var f}function Ld(d){return[].slice.call(d)}var vE=0;function Rr(d){return d==null?":id":typeof d=="string"?d:"[".concat(d.join("+"),"]")}function RE(d,f,H){function w(X){if(X.type===3)return null;if(X.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var G=X.lower,W=X.upper,j=X.lowerOpen,X=X.upperOpen;return G===void 0?W===void 0?null:f.upperBound(W,!!X):W===void 0?f.lowerBound(G,!!j):f.bound(G,W,!!j,!!X)}function R(Z){var G,W=Z.name;return{name:W,schema:Z,mutate:function(j){var X=j.trans,q=j.type,$=j.keys,ee=j.values,re=j.range;return new Promise(function(le,me){le=nt(le);var he=X.objectStore(W),fe=he.keyPath==null,Ee=q==="put"||q==="add";if(!Ee&&q!=="delete"&&q!=="deleteRange")throw new Error("Invalid operation type: "+q);var ae,Se=($||ee||{length:1}).length;if($&&ee&&$.length!==ee.length)throw new Error("Given keys array must have same length as given values array.");if(Se===0)return le({numFailures:0,failures:{},results:[],lastResult:void 0});function Oe(Vt){++Cs,yr(Vt)}var Ne=[],_e=[],Cs=0;if(q==="deleteRange"){if(re.type===4)return le({numFailures:Cs,failures:_e,results:[],lastResult:void 0});re.type===3?Ne.push(ae=he.clear()):Ne.push(ae=he.delete(w(re)))}else{var fe=Ee?fe?[ee,$]:[ee,null]:[$,null],Le=fe[0],_t=fe[1];if(Ee)for(var Lt=0;Lt<Se;++Lt)Ne.push(ae=_t&&_t[Lt]!==void 0?he[q](Le[Lt],_t[Lt]):he[q](Le[Lt])),ae.onerror=Oe;else for(Lt=0;Lt<Se;++Lt)Ne.push(ae=he[q](Le[Lt])),ae.onerror=Oe}function Ho(Vt){Vt=Vt.target.result,Ne.forEach(function(Wi,dh){return Wi.error!=null&&(_e[dh]=Wi.error)}),le({numFailures:Cs,failures:_e,results:q==="delete"?$:Ne.map(function(Wi){return Wi.result}),lastResult:Vt})}ae.onerror=function(Vt){Oe(Vt),Ho(Vt)},ae.onsuccess=Ho})},getMany:function(j){var X=j.trans,q=j.keys;return new Promise(function($,ee){$=nt($);for(var re,le=X.objectStore(W),me=q.length,he=new Array(me),fe=0,Ee=0,ae=function(Ne){Ne=Ne.target,he[Ne._pos]=Ne.result,++Ee===fe&&$(he)},Se=xs(ee),Oe=0;Oe<me;++Oe)q[Oe]!=null&&((re=le.get(q[Oe]))._pos=Oe,re.onsuccess=ae,re.onerror=Se,++fe);fe===0&&$(he)})},get:function(j){var X=j.trans,q=j.key;return new Promise(function($,ee){$=nt($);var re=X.objectStore(W).get(q);re.onsuccess=function(le){return $(le.target.result)},re.onerror=xs(ee)})},query:(G=k,function(j){return new Promise(function(X,q){X=nt(X);var $,ee,re,fe=j.trans,le=j.values,me=j.limit,ae=j.query,he=me===1/0?void 0:me,Ee=ae.index,ae=ae.range,fe=fe.objectStore(W),Ee=Ee.isPrimaryKey?fe:fe.index(Ee.name),ae=w(ae);if(me===0)return X({result:[]});G?((he=le?Ee.getAll(ae,he):Ee.getAllKeys(ae,he)).onsuccess=function(Se){return X({result:Se.target.result})},he.onerror=xs(q)):($=0,ee=!le&&"openKeyCursor"in Ee?Ee.openKeyCursor(ae):Ee.openCursor(ae),re=[],ee.onsuccess=function(Se){var Oe=ee.result;return Oe?(re.push(le?Oe.value:Oe.primaryKey),++$===me?X({result:re}):void Oe.continue()):X({result:re})},ee.onerror=xs(q))})}),openCursor:function(j){var X=j.trans,q=j.values,$=j.query,ee=j.reverse,re=j.unique;return new Promise(function(le,me){le=nt(le);var Ee=$.index,he=$.range,fe=X.objectStore(W),fe=Ee.isPrimaryKey?fe:fe.index(Ee.name),Ee=ee?re?"prevunique":"prev":re?"nextunique":"next",ae=!q&&"openKeyCursor"in fe?fe.openKeyCursor(w(he),Ee):fe.openCursor(w(he),Ee);ae.onerror=xs(me),ae.onsuccess=nt(function(Se){var Oe,Ne,_e,Cs,Le=ae.result;Le?(Le.___id=++vE,Le.done=!1,Oe=Le.continue.bind(Le),Ne=(Ne=Le.continuePrimaryKey)&&Ne.bind(Le),_e=Le.advance.bind(Le),Cs=function(){throw new Error("Cursor not stopped")},Le.trans=X,Le.stop=Le.continue=Le.continuePrimaryKey=Le.advance=function(){throw new Error("Cursor not started")},Le.fail=nt(me),Le.next=function(){var _t=this,Lt=1;return this.start(function(){return Lt--?_t.continue():_t.stop()}).then(function(){return _t})},Le.start=function(_t){function Lt(){if(ae.result)try{_t()}catch(Vt){Le.fail(Vt)}else Le.done=!0,Le.start=function(){throw new Error("Cursor behind last entry")},Le.stop()}var Ho=new Promise(function(Vt,Wi){Vt=nt(Vt),ae.onerror=xs(Wi),Le.fail=Wi,Le.stop=function(dh){Le.stop=Le.continue=Le.continuePrimaryKey=Le.advance=Cs,Vt(dh)}});return ae.onsuccess=nt(function(Vt){ae.onsuccess=Lt,Lt()}),Le.continue=Oe,Le.continuePrimaryKey=Ne,Le.advance=_e,Lt(),Ho},le(Le)):le(null)},me)})},count:function(j){var X=j.query,q=j.trans,$=X.index,ee=X.range;return new Promise(function(re,le){var me=q.objectStore(W),he=$.isPrimaryKey?me:me.index($.name),me=w(ee),he=me?he.count(me):he.count();he.onsuccess=nt(function(fe){return re(fe.target.result)}),he.onerror=xs(le)})}}}var P,N,U,K=(N=H,U=Ld((P=d).objectStoreNames),{schema:{name:P.name,tables:U.map(function(Z){return N.objectStore(Z)}).map(function(Z){var G=Z.keyPath,X=Z.autoIncrement,W=o(G),j={},X={name:Z.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:G==null,compound:W,keyPath:G,autoIncrement:X,unique:!0,extractKey:Kl(G)},indexes:Ld(Z.indexNames).map(function(q){return Z.index(q)}).map(function(re){var $=re.name,ee=re.unique,le=re.multiEntry,re=re.keyPath,le={name:$,compound:o(re),keyPath:re,unique:ee,multiEntry:le,extractKey:Kl(re)};return j[Rr(re)]=le}),getIndexByKeyPath:function(q){return j[Rr(q)]}};return j[":id"]=X.primaryKey,G!=null&&(j[Rr(G)]=X.primaryKey),X})},hasGetAll:0<U.length&&"getAll"in N.objectStore(U[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),H=K.schema,k=K.hasGetAll,K=H.tables.map(R),Y={};return K.forEach(function(Z){return Y[Z.name]=Z}),{stack:"dbcore",transaction:d.transaction.bind(d),table:function(Z){if(!Y[Z])throw new Error("Table '".concat(Z,"' not found"));return Y[Z]},MIN_KEY:-1/0,MAX_KEY:vr(f),schema:H}}function FE(d,f,I,w){var R=I.IDBKeyRange;return I.indexedDB,{dbcore:(w=RE(f,R,w),d.dbcore.reduce(function(P,N){return N=N.create,s(s({},P),N(P))},w))}}function Mo(d,w){var I=w.db,w=FE(d._middlewares,I,d._deps,w);d.core=w.dbcore,d.tables.forEach(function(R){var P=R.name;d.core.schema.tables.some(function(N){return N.name===P})&&(R.core=d.core.table(P),d[P]instanceof d.Table&&(d[P].core=R.core))})}function _o(d,f,I,w){I.forEach(function(R){var P=w[R];f.forEach(function(N){var U=function H(k,K){return T(k,K)||(k=l(k))&&H(k,K)}(N,R);(!U||"value"in U&&U.value===void 0)&&(N===d.Transaction.prototype||N instanceof d.Transaction?E(N,R,{get:function(){return this.table(R)},set:function(H){m(this,R,{value:H,writable:!0,configurable:!0,enumerable:!0})}}):N[R]=new d.Table(R,P))})})}function Zl(d,f){f.forEach(function(I){for(var w in I)I[w]instanceof d.Table&&delete I[w]})}function AE(d,f){return d._cfg.version-f._cfg.version}function SE(d,f,I,w){var R=d._dbSchema;I.objectStoreNames.contains("$meta")&&!R.$meta&&(R.$meta=Xl("$meta",Dd("")[0],[]),d._storeNames.push("$meta"));var P=d._createTransaction("readwrite",d._storeNames,R);P.create(I),P._completion.catch(w);var N=P._reject.bind(P),U=Te.transless||Te;fi(function(){return Te.trans=P,Te.transless=U,f!==0?(Mo(d,I),k=f,((H=P).storeNames.includes("$meta")?H.table("$meta").get("version").then(function(K){return K??k}):ge.resolve(k)).then(function(K){return Z=K,G=P,W=I,j=[],K=(Y=d)._versions,X=Y._dbSchema=No(0,Y.idbdb,W),(K=K.filter(function(q){return q._cfg.version>=Z})).length!==0?(K.forEach(function(q){j.push(function(){var $=X,ee=q._cfg.dbschema;Do(Y,$,W),Do(Y,ee,W),X=Y._dbSchema=ee;var re=jl($,ee);re.add.forEach(function(Ee){Ql(W,Ee[0],Ee[1].primKey,Ee[1].indexes)}),re.change.forEach(function(Ee){if(Ee.recreate)throw new Ce.Upgrade("Not yet support for changing primary key");var ae=W.objectStore(Ee.name);Ee.add.forEach(function(Se){return Lo(ae,Se)}),Ee.change.forEach(function(Se){ae.deleteIndex(Se.name),Lo(ae,Se)}),Ee.del.forEach(function(Se){return ae.deleteIndex(Se)})});var le=q._cfg.contentUpgrade;if(le&&q._cfg.version>Z){Mo(Y,W),G._memoizedTables={};var me=L(ee);re.del.forEach(function(Ee){me[Ee]=$[Ee]}),Zl(Y,[Y.Transaction.prototype]),_o(Y,[Y.Transaction.prototype],r(me),me),G.schema=me;var he,fe=gt(le);return fe&&pn(),re=ge.follow(function(){var Ee;(he=le(G))&&fe&&(Ee=mi.bind(null,null),he.then(Ee,Ee))}),he&&typeof he.then=="function"?ge.resolve(he):re.then(function(){return he})}}),j.push(function($){var ee,re,le=q._cfg.dbschema;ee=le,re=$,[].slice.call(re.db.objectStoreNames).forEach(function(me){return ee[me]==null&&re.db.deleteObjectStore(me)}),Zl(Y,[Y.Transaction.prototype]),_o(Y,[Y.Transaction.prototype],Y._storeNames,Y._dbSchema),G.schema=Y._dbSchema}),j.push(function($){Y.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(Y.idbdb.version/10)===q._cfg.version?(Y.idbdb.deleteObjectStore("$meta"),delete Y._dbSchema.$meta,Y._storeNames=Y._storeNames.filter(function(ee){return ee!=="$meta"})):$.objectStore("$meta").put(q._cfg.version,"version"))})}),function q(){return j.length?ge.resolve(j.shift()(G.idbtrans)).then(q):ge.resolve()}().then(function(){Nd(X,W)})):ge.resolve();var Y,Z,G,W,j,X}).catch(N)):(r(R).forEach(function(K){Ql(I,K,R[K].primKey,R[K].indexes)}),Mo(d,I),void ge.follow(function(){return d.on.populate.fire(P)}).catch(N));var H,k})}function OE(d,f){Nd(d._dbSchema,f),f.db.version%10!=0||f.objectStoreNames.contains("$meta")||f.db.createObjectStore("$meta").add(Math.ceil(f.db.version/10-1),"version");var I=No(0,d.idbdb,f);Do(d,d._dbSchema,f);for(var w=0,R=jl(I,d._dbSchema).change;w<R.length;w++){var P=function(N){if(N.change.length||N.recreate)return console.warn("Unable to patch indexes of table ".concat(N.name," because it has changes on the type of index or primary key.")),{value:void 0};var U=f.objectStore(N.name);N.add.forEach(function(H){bs&&console.debug("Dexie upgrade patch: Creating missing index ".concat(N.name,".").concat(H.src)),Lo(U,H)})}(R[w]);if(typeof P=="object")return P.value}}function jl(d,f){var I,w={del:[],add:[],change:[]};for(I in d)f[I]||w.del.push(I);for(I in f){var R=d[I],P=f[I];if(R){var N={name:I,def:P,recreate:!1,del:[],add:[],change:[]};if(""+(R.primKey.keyPath||"")!=""+(P.primKey.keyPath||"")||R.primKey.auto!==P.primKey.auto)N.recreate=!0,w.change.push(N);else{var U=R.idxByName,H=P.idxByName,k=void 0;for(k in U)H[k]||N.del.push(k);for(k in H){var K=U[k],Y=H[k];K?K.src!==Y.src&&N.change.push(Y):N.add.push(Y)}(0<N.del.length||0<N.add.length||0<N.change.length)&&w.change.push(N)}}else w.add.push([I,P])}return w}function Ql(d,f,I,w){var R=d.db.createObjectStore(f,I.keyPath?{keyPath:I.keyPath,autoIncrement:I.auto}:{autoIncrement:I.auto});return w.forEach(function(P){return Lo(R,P)}),R}function Nd(d,f){r(d).forEach(function(I){f.db.objectStoreNames.contains(I)||(bs&&console.debug("Dexie: Creating missing table",I),Ql(f,I,d[I].primKey,d[I].indexes))})}function Lo(d,f){d.createIndex(f.name,f.keyPath,{unique:f.unique,multiEntry:f.multi})}function No(d,f,I){var w={};return v(f.objectStoreNames,0).forEach(function(R){for(var P=I.objectStore(R),N=Wl(_d(k=P.keyPath),k||"",!0,!1,!!P.autoIncrement,k&&typeof k!="string",!0),U=[],H=0;H<P.indexNames.length;++H){var K=P.index(P.indexNames[H]),k=K.keyPath,K=Wl(K.name,k,!!K.unique,!!K.multiEntry,!1,k&&typeof k!="string",!1);U.push(K)}w[R]=Xl(R,N,U)}),w}function Do(d,f,I){for(var w=I.db.objectStoreNames,R=0;R<w.length;++R){var P=w[R],N=I.objectStore(P);d._hasGetAll="getAll"in N;for(var U=0;U<N.indexNames.length;++U){var H=N.indexNames[U],k=N.index(H).keyPath,K=typeof k=="string"?k:"["+v(k).join("+")+"]";!f[P]||(k=f[P].idxByName[K])&&(k.name=H,delete f[P].idxByName[K],f[P].idxByName[H]=k)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&n.WorkerGlobalScope&&n instanceof n.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(d._hasGetAll=!1)}function Dd(d){return d.split(",").map(function(f,I){var w=(f=f.trim()).replace(/([&*]|\+\+)/g,""),R=/^\[/.test(w)?w.match(/^\[(.*)\]$/)[1].split("+"):w;return Wl(w,R||null,/\&/.test(f),/\*/.test(f),/\+\+/.test(f),o(R),I===0)})}var PE=(Uo.prototype._parseStoresSpec=function(d,f){r(d).forEach(function(I){if(d[I]!==null){var w=Dd(d[I]),R=w.shift();if(R.unique=!0,R.multi)throw new Ce.Schema("Primary key cannot be multi-valued");w.forEach(function(P){if(P.auto)throw new Ce.Schema("Only primary key can be marked as autoIncrement (++)");if(!P.keyPath)throw new Ce.Schema("Index must have a name and cannot be an empty string")}),f[I]=Xl(I,R,w)}})},Uo.prototype.stores=function(I){var f=this.db;this._cfg.storesSource=this._cfg.storesSource?a(this._cfg.storesSource,I):I;var I=f._versions,w={},R={};return I.forEach(function(P){a(w,P._cfg.storesSource),R=P._cfg.dbschema={},P._parseStoresSpec(w,R)}),f._dbSchema=R,Zl(f,[f._allTables,f,f.Transaction.prototype]),_o(f,[f._allTables,f,f.Transaction.prototype,this._cfg.tables],r(R),R),f._storeNames=r(R),this},Uo.prototype.upgrade=function(d){return this._cfg.contentUpgrade=bl(this._cfg.contentUpgrade||ke,d),this},Uo);function Uo(){}function ql(d,f){var I=d._dbNamesDB;return I||(I=d._dbNamesDB=new si(So,{addons:[],indexedDB:d,IDBKeyRange:f})).version(1).stores({dbnames:"name"}),I.table("dbnames")}function Jl(d){return d&&typeof d.databases=="function"}function $l(d){return fi(function(){return Te.letThrough=!0,d()})}function eh(d){return!("from"in d)}var kt=function(d,f){if(!this){var I=new kt;return d&&"d"in d&&a(I,d),I}a(this,arguments.length?{d:1,from:d,to:1<arguments.length?f:d}:{d:0})};function Fr(d,f,I){var w=Ye(f,I);if(!isNaN(w)){if(0<w)throw RangeError();if(eh(d))return a(d,{from:f,to:I,d:1});var R=d.l,w=d.r;if(Ye(I,d.from)<0)return R?Fr(R,f,I):d.l={from:f,to:I,d:1,l:null,r:null},Bd(d);if(0<Ye(f,d.to))return w?Fr(w,f,I):d.r={from:f,to:I,d:1,l:null,r:null},Bd(d);Ye(f,d.from)<0&&(d.from=f,d.l=null,d.d=w?w.d+1:1),0<Ye(I,d.to)&&(d.to=I,d.r=null,d.d=d.l?d.l.d+1:1),I=!d.r,R&&!d.l&&Ar(d,R),w&&I&&Ar(d,w)}}function Ar(d,f){eh(f)||function I(w,H){var P=H.from,N=H.to,U=H.l,H=H.r;Fr(w,P,N),U&&I(w,U),H&&I(w,H)}(d,f)}function Ud(d,f){var I=Bo(f),w=I.next();if(w.done)return!1;for(var R=w.value,P=Bo(d),N=P.next(R.from),U=N.value;!w.done&&!N.done;){if(Ye(U.from,R.to)<=0&&0<=Ye(U.to,R.from))return!0;Ye(R.from,U.from)<0?R=(w=I.next(U.from)).value:U=(N=P.next(R.from)).value}return!1}function Bo(d){var f=eh(d)?null:{s:0,n:d};return{next:function(I){for(var w=0<arguments.length;f;)switch(f.s){case 0:if(f.s=1,w)for(;f.n.l&&Ye(I,f.n.from)<0;)f={up:f,n:f.n.l,s:1};else for(;f.n.l;)f={up:f,n:f.n.l,s:1};case 1:if(f.s=2,!w||Ye(I,f.n.to)<=0)return{value:f.n,done:!1};case 2:if(f.n.r){f.s=3,f={up:f,n:f.n.r,s:0};continue}case 3:f=f.up}return{done:!0}}}}function Bd(d){var f,I,w=(((f=d.r)===null||f===void 0?void 0:f.d)||0)-(((I=d.l)===null||I===void 0?void 0:I.d)||0),R=1<w?"r":w<-1?"l":"";R&&(f=R=="r"?"l":"r",I=s({},d),w=d[R],d.from=w.from,d.to=w.to,d[R]=w[R],I[R]=w[f],(d[f]=I).d=zd(I)),d.d=zd(d)}function zd(I){var f=I.r,I=I.l;return(f?I?Math.max(f.d,I.d):f.d:I?I.d:0)+1}function zo(d,f){return r(f).forEach(function(I){d[I]?Ar(d[I],f[I]):d[I]=function w(R){var P,N,U={};for(P in R)p(R,P)&&(N=R[P],U[P]=!N||typeof N!="object"||z.has(N.constructor)?N:w(N));return U}(f[I])}),d}function th(d,f){return d.all||f.all||Object.keys(d).some(function(I){return f[I]&&Ud(f[I],d[I])})}u(kt.prototype,((ns={add:function(d){return Ar(this,d),this},addKey:function(d){return Fr(this,d,d),this},addKeys:function(d){var f=this;return d.forEach(function(I){return Fr(f,I,I)}),this},hasKey:function(d){var f=Bo(this).next(d).value;return f&&Ye(f.from,d)<=0&&0<=Ye(f.to,d)}})[oe]=function(){return Bo(this)},ns));var Gi={},sh={},ih=!1;function Yo(d){zo(sh,d),ih||(ih=!0,setTimeout(function(){ih=!1,nh(sh,!(sh={}))},0))}function nh(d,f){f===void 0&&(f=!1);var I=new Set;if(d.all)for(var w=0,R=Object.values(Gi);w<R.length;w++)Yd(N=R[w],d,I,f);else for(var P in d){var N,U=/^idb\:\/\/(.*)\/(.*)\//.exec(P);U&&(P=U[1],U=U[2],(N=Gi["idb://".concat(P,"/").concat(U)])&&Yd(N,d,I,f))}I.forEach(function(H){return H()})}function Yd(d,f,I,w){for(var R=[],P=0,N=Object.entries(d.queries.query);P<N.length;P++){for(var U=N[P],H=U[0],k=[],K=0,Y=U[1];K<Y.length;K++){var Z=Y[K];th(f,Z.obsSet)?Z.subscribers.forEach(function(X){return I.add(X)}):w&&k.push(Z)}w&&R.push([H,k])}if(w)for(var G=0,W=R;G<W.length;G++){var j=W[G],H=j[0],k=j[1];d.queries.query[H]=k}}function bE(d){var f=d._state,I=d._deps.indexedDB;if(f.isBeingOpened||d.idbdb)return f.dbReadyPromise.then(function(){return f.dbOpenError?ut(f.dbOpenError):d});f.isBeingOpened=!0,f.dbOpenError=null,f.openComplete=!1;var w=f.openCanceller,R=Math.round(10*d.verno),P=!1;function N(){if(f.openCanceller!==w)throw new Ce.DatabaseClosed("db.open() was cancelled")}function U(){return new ge(function(Z,G){if(N(),!I)throw new Ce.MissingAPI;var W=d.name,j=f.autoSchema||!R?I.open(W):I.open(W,R);if(!j)throw new Ce.MissingAPI;j.onerror=xs(G),j.onblocked=nt(d._fireOnBlocked),j.onupgradeneeded=nt(function(X){var q;K=j.transaction,f.autoSchema&&!d._options.allowEmptyDB?(j.onerror=yr,K.abort(),j.result.close(),(q=I.deleteDatabase(W)).onsuccess=q.onerror=nt(function(){G(new Ce.NoSuchDatabase("Database ".concat(W," doesnt exist")))})):(K.onerror=xs(G),X=X.oldVersion>Math.pow(2,62)?0:X.oldVersion,Y=X<1,d.idbdb=j.result,P&&OE(d,K),SE(d,X/10,K,G))},G),j.onsuccess=nt(function(){K=null;var X,q,$,ee,re,le=d.idbdb=j.result,me=v(le.objectStoreNames);if(0<me.length)try{var he=le.transaction((ee=me).length===1?ee[0]:ee,"readonly");if(f.autoSchema)q=le,$=he,(X=d).verno=q.version/10,$=X._dbSchema=No(0,q,$),X._storeNames=v(q.objectStoreNames,0),_o(X,[X._allTables],r($),$);else if(Do(d,d._dbSchema,he),((re=jl(No(0,(re=d).idbdb,he),re._dbSchema)).add.length||re.change.some(function(fe){return fe.add.length||fe.change.length}))&&!P)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),le.close(),R=le.version+1,P=!0,Z(U());Mo(d,he)}catch{}fn.push(d),le.onversionchange=nt(function(fe){f.vcFired=!0,d.on("versionchange").fire(fe)}),le.onclose=nt(function(fe){d.on("close").fire(fe)}),Y&&(re=d._deps,he=W,le=re.indexedDB,re=re.IDBKeyRange,Jl(le)||he===So||ql(le,re).put({name:he}).catch(ke)),Z()},G)}).catch(function(Z){switch(Z==null?void 0:Z.name){case"UnknownError":if(0<f.PR1398_maxLoop)return f.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),U();break;case"VersionError":if(0<R)return R=0,U()}return ge.reject(Z)})}var H,k=f.dbReadyResolve,K=null,Y=!1;return ge.race([w,(typeof navigator>"u"?ge.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(Z){function G(){return indexedDB.databases().finally(Z)}H=setInterval(G,100),G()}).finally(function(){return clearInterval(H)}):Promise.resolve()).then(U)]).then(function(){return N(),f.onReadyBeingFired=[],ge.resolve($l(function(){return d.on.ready.fire(d.vip)})).then(function Z(){if(0<f.onReadyBeingFired.length){var G=f.onReadyBeingFired.reduce(bl,ke);return f.onReadyBeingFired=[],ge.resolve($l(function(){return G(d.vip)})).then(Z)}})}).finally(function(){f.openCanceller===w&&(f.onReadyBeingFired=null,f.isBeingOpened=!1)}).catch(function(Z){f.dbOpenError=Z;try{K&&K.abort()}catch{}return w===f.openCanceller&&d._close(),ut(Z)}).finally(function(){f.openComplete=!0,k()}).then(function(){var Z;return Y&&(Z={},d.tables.forEach(function(G){G.schema.indexes.forEach(function(W){W.name&&(Z["idb://".concat(d.name,"/").concat(G.name,"/").concat(W.name)]=new kt(-1/0,[[[]]]))}),Z["idb://".concat(d.name,"/").concat(G.name,"/")]=Z["idb://".concat(d.name,"/").concat(G.name,"/:dels")]=new kt(-1/0,[[[]]])}),Ii(wr).fire(Z),nh(Z,!0)),d})}function rh(d){function f(P){return d.next(P)}var I=R(f),w=R(function(P){return d.throw(P)});function R(P){return function(H){var U=P(H),H=U.value;return U.done?H:H&&typeof H.then=="function"?H.then(I,w):o(H)?Promise.all(H).then(I,w):I(H)}}return R(f)()}function ko(d,f,I){for(var w=o(d)?d.slice():[d],R=0;R<I;++R)w.push(f);return w}var xE={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(d){return s(s({},d),{table:function(f){var I=d.table(f),w=I.schema,R={},P=[];function N(Y,Z,G){var W=Rr(Y),j=R[W]=R[W]||[],X=Y==null?0:typeof Y=="string"?1:Y.length,q=0<Z,q=s(s({},G),{name:q?"".concat(W,"(virtual-from:").concat(G.name,")"):G.name,lowLevelIndex:G,isVirtual:q,keyTail:Z,keyLength:X,extractKey:Kl(Y),unique:!q&&G.unique});return j.push(q),q.isPrimaryKey||P.push(q),1<X&&N(X===2?Y[0]:Y.slice(0,X-1),Z+1,G),j.sort(function($,ee){return $.keyTail-ee.keyTail}),q}f=N(w.primaryKey.keyPath,0,w.primaryKey),R[":id"]=[f];for(var U=0,H=w.indexes;U<H.length;U++){var k=H[U];N(k.keyPath,0,k)}function K(Y){var Z,G=Y.query.index;return G.isVirtual?s(s({},Y),{query:{index:G.lowLevelIndex,range:(Z=Y.query.range,G=G.keyTail,{type:Z.type===1?2:Z.type,lower:ko(Z.lower,Z.lowerOpen?d.MAX_KEY:d.MIN_KEY,G),lowerOpen:!0,upper:ko(Z.upper,Z.upperOpen?d.MIN_KEY:d.MAX_KEY,G),upperOpen:!0})}}):Y}return s(s({},I),{schema:s(s({},w),{primaryKey:f,indexes:P,getIndexByKeyPath:function(Y){return(Y=R[Rr(Y)])&&Y[0]}}),count:function(Y){return I.count(K(Y))},query:function(Y){return I.query(K(Y))},openCursor:function(Y){var Z=Y.query.index,G=Z.keyTail,W=Z.isVirtual,j=Z.keyLength;return W?I.openCursor(K(Y)).then(function(q){return q&&X(q)}):I.openCursor(Y);function X(q){return Object.create(q,{continue:{value:function($){$!=null?q.continue(ko($,Y.reverse?d.MAX_KEY:d.MIN_KEY,G)):Y.unique?q.continue(q.key.slice(0,j).concat(Y.reverse?d.MIN_KEY:d.MAX_KEY,G)):q.continue()}},continuePrimaryKey:{value:function($,ee){q.continuePrimaryKey(ko($,d.MAX_KEY,G),ee)}},primaryKey:{get:function(){return q.primaryKey}},key:{get:function(){var $=q.key;return j===1?$[0]:$.slice(0,j)}},value:{get:function(){return q.value}}})}}})}})}};function oh(d,f,I,w){return I=I||{},w=w||"",r(d).forEach(function(R){var P,N,U;p(f,R)?(P=d[R],N=f[R],typeof P=="object"&&typeof N=="object"&&P&&N?(U=ue(P))!==ue(N)?I[w+R]=f[R]:U==="Object"?oh(P,N,I,w+R+"."):P!==N&&(I[w+R]=f[R]):P!==N&&(I[w+R]=f[R])):I[w+R]=void 0}),r(f).forEach(function(R){p(d,R)||(I[w+R]=f[R])}),I}function ah(d,f){return f.type==="delete"?f.keys:f.keys||f.values.map(d.extractKey)}var ME={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(d){return s(s({},d),{table:function(f){var I=d.table(f),w=I.schema.primaryKey;return s(s({},I),{mutate:function(R){var P=Te.trans,N=P.table(f).hook,U=N.deleting,H=N.creating,k=N.updating;switch(R.type){case"add":if(H.fire===ke)break;return P._promise("readwrite",function(){return K(R)},!0);case"put":if(H.fire===ke&&k.fire===ke)break;return P._promise("readwrite",function(){return K(R)},!0);case"delete":if(U.fire===ke)break;return P._promise("readwrite",function(){return K(R)},!0);case"deleteRange":if(U.fire===ke)break;return P._promise("readwrite",function(){return function Y(Z,G,W){return I.query({trans:Z,values:!1,query:{index:w,range:G},limit:W}).then(function(j){var X=j.result;return K({type:"delete",keys:X,trans:Z}).then(function(q){return 0<q.numFailures?Promise.reject(q.failures[0]):X.length<W?{failures:[],numFailures:0,lastResult:void 0}:Y(Z,s(s({},G),{lower:X[X.length-1],lowerOpen:!0}),W)})})}(R.trans,R.range,1e4)},!0)}return I.mutate(R);function K(Y){var Z,G,W,j=Te.trans,X=Y.keys||ah(w,Y);if(!X)throw new Error("Keys missing");return(Y=Y.type==="add"||Y.type==="put"?s(s({},Y),{keys:X}):s({},Y)).type!=="delete"&&(Y.values=i([],Y.values)),Y.keys&&(Y.keys=i([],Y.keys)),Z=I,W=X,((G=Y).type==="add"?Promise.resolve([]):Z.getMany({trans:G.trans,keys:W,cache:"immutable"})).then(function(q){var $=X.map(function(ee,re){var le,me,he,fe=q[re],Ee={onerror:null,onsuccess:null};return Y.type==="delete"?U.fire.call(Ee,ee,fe,j):Y.type==="add"||fe===void 0?(le=H.fire.call(Ee,ee,Y.values[re],j),ee==null&&le!=null&&(Y.keys[re]=ee=le,w.outbound||_(Y.values[re],w.keyPath,ee))):(le=oh(fe,Y.values[re]),(me=k.fire.call(Ee,le,ee,fe,j))&&(he=Y.values[re],Object.keys(me).forEach(function(ae){p(he,ae)?he[ae]=me[ae]:_(he,ae,me[ae])}))),Ee});return I.mutate(Y).then(function(ee){for(var re=ee.failures,le=ee.results,me=ee.numFailures,ee=ee.lastResult,he=0;he<X.length;++he){var fe=(le||X)[he],Ee=$[he];fe==null?Ee.onerror&&Ee.onerror(re[he]):Ee.onsuccess&&Ee.onsuccess(Y.type==="put"&&q[he]?Y.values[he]:fe)}return{failures:re,results:le,numFailures:me,lastResult:ee}}).catch(function(ee){return $.forEach(function(re){return re.onerror&&re.onerror(ee)}),Promise.reject(ee)})})}}})}})}};function kd(d,f,I){try{if(!f||f.keys.length<d.length)return null;for(var w=[],R=0,P=0;R<f.keys.length&&P<d.length;++R)Ye(f.keys[R],d[P])===0&&(w.push(I?Q(f.values[R]):f.values[R]),++P);return w.length===d.length?w:null}catch{return null}}var _E={stack:"dbcore",level:-1,create:function(d){return{table:function(f){var I=d.table(f);return s(s({},I),{getMany:function(w){if(!w.cache)return I.getMany(w);var R=kd(w.keys,w.trans._cache,w.cache==="clone");return R?ge.resolve(R):I.getMany(w).then(function(P){return w.trans._cache={keys:w.keys,values:w.cache==="clone"?Q(P):P},P})},mutate:function(w){return w.type!=="add"&&(w.trans._cache=null),I.mutate(w)}})}}}};function Vd(d,f){return d.trans.mode==="readonly"&&!!d.subscr&&!d.trans.explicit&&d.trans.db._options.cache!=="disabled"&&!f.schema.primaryKey.outbound}function Gd(d,f){switch(d){case"query":return f.values&&!f.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var LE={stack:"dbcore",level:0,name:"Observability",create:function(d){var f=d.schema.name,I=new kt(d.MIN_KEY,d.MAX_KEY);return s(s({},d),{transaction:function(w,R,P){if(Te.subscr&&R!=="readonly")throw new Ce.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Te.querier));return d.transaction(w,R,P)},table:function(w){var R=d.table(w),P=R.schema,N=P.primaryKey,Y=P.indexes,U=N.extractKey,H=N.outbound,k=N.autoIncrement&&Y.filter(function(G){return G.compound&&G.keyPath.includes(N.keyPath)}),K=s(s({},R),{mutate:function(G){function W(ae){return ae="idb://".concat(f,"/").concat(w,"/").concat(ae),ee[ae]||(ee[ae]=new kt)}var j,X,q,$=G.trans,ee=G.mutatedParts||(G.mutatedParts={}),re=W(""),le=W(":dels"),me=G.type,Ee=G.type==="deleteRange"?[G.range]:G.type==="delete"?[G.keys]:G.values.length<50?[ah(N,G).filter(function(ae){return ae}),G.values]:[],he=Ee[0],fe=Ee[1],Ee=G.trans._cache;return o(he)?(re.addKeys(he),(Ee=me==="delete"||he.length===fe.length?kd(he,Ee):null)||le.addKeys(he),(Ee||fe)&&(j=W,X=Ee,q=fe,P.indexes.forEach(function(ae){var Se=j(ae.name||"");function Oe(_e){return _e!=null?ae.extractKey(_e):null}function Ne(_e){return ae.multiEntry&&o(_e)?_e.forEach(function(Cs){return Se.addKey(Cs)}):Se.addKey(_e)}(X||q).forEach(function(_e,_t){var Le=X&&Oe(X[_t]),_t=q&&Oe(q[_t]);Ye(Le,_t)!==0&&(Le!=null&&Ne(Le),_t!=null&&Ne(_t))})}))):he?(fe={from:he.lower,to:he.upper},le.add(fe),re.add(fe)):(re.add(I),le.add(I),P.indexes.forEach(function(ae){return W(ae.name).add(I)})),R.mutate(G).then(function(ae){return!he||G.type!=="add"&&G.type!=="put"||(re.addKeys(ae.results),k&&k.forEach(function(Se){var Oe=G.values.map(function(_e){return Se.extractKey(_e)}),Ne=Se.keyPath.findIndex(function(_e){return _e===N.keyPath});ae.results.forEach(function(_e){return Oe[Ne]=_e}),W(Se.name).addKeys(Oe)})),$.mutatedParts=zo($.mutatedParts||{},ee),ae})}}),Y=function(W){var j=W.query,W=j.index,j=j.range;return[W,new kt((W=j.lower)!==null&&W!==void 0?W:d.MIN_KEY,(j=j.upper)!==null&&j!==void 0?j:d.MAX_KEY)]},Z={get:function(G){return[N,new kt(G.key)]},getMany:function(G){return[N,new kt().addKeys(G.keys)]},count:Y,query:Y,openCursor:Y};return r(Z).forEach(function(G){K[G]=function(W){var j=Te.subscr,X=!!j,q=Vd(Te,R)&&Gd(G,W)?W.obsSet={}:j;if(X){var $=function(fe){return fe="idb://".concat(f,"/").concat(w,"/").concat(fe),q[fe]||(q[fe]=new kt)},ee=$(""),re=$(":dels"),j=Z[G](W),X=j[0],j=j[1];if((G==="query"&&X.isPrimaryKey&&!W.values?re:$(X.name||"")).add(j),!X.isPrimaryKey){if(G!=="count"){var le=G==="query"&&H&&W.values&&R.query(s(s({},W),{values:!1}));return R[G].apply(this,arguments).then(function(fe){if(G==="query"){if(H&&W.values)return le.then(function(Oe){return Oe=Oe.result,ee.addKeys(Oe),fe});var Ee=W.values?fe.result.map(U):fe.result;(W.values?ee:re).addKeys(Ee)}else if(G==="openCursor"){var ae=fe,Se=W.values;return ae&&Object.create(ae,{key:{get:function(){return re.addKey(ae.primaryKey),ae.key}},primaryKey:{get:function(){var Oe=ae.primaryKey;return re.addKey(Oe),Oe}},value:{get:function(){return Se&&ee.addKey(ae.primaryKey),ae.value}}})}return fe})}re.add(I)}}return R[G].apply(this,arguments)}}),K}})}};function Hd(d,f,I){if(I.numFailures===0)return f;if(f.type==="deleteRange")return null;var w=f.keys?f.keys.length:"values"in f&&f.values?f.values.length:1;return I.numFailures===w?null:(f=s({},f),o(f.keys)&&(f.keys=f.keys.filter(function(R,P){return!(P in I.failures)})),"values"in f&&o(f.values)&&(f.values=f.values.filter(function(R,P){return!(P in I.failures)})),f)}function lh(d,f){return I=d,((w=f).lower===void 0||(w.lowerOpen?0<Ye(I,w.lower):0<=Ye(I,w.lower)))&&(d=d,(f=f).upper===void 0||(f.upperOpen?Ye(d,f.upper)<0:Ye(d,f.upper)<=0));var I,w}function Wd(d,f,Z,w,R,P){if(!Z||Z.length===0)return d;var N=f.query.index,U=N.multiEntry,H=f.query.range,k=w.schema.primaryKey.extractKey,K=N.extractKey,Y=(N.lowLevelIndex||N).extractKey,Z=Z.reduce(function(G,W){var j=G,X=[];if(W.type==="add"||W.type==="put")for(var q=new kt,$=W.values.length-1;0<=$;--$){var ee,re=W.values[$],le=k(re);q.hasKey(le)||(ee=K(re),(U&&o(ee)?ee.some(function(Ee){return lh(Ee,H)}):lh(ee,H))&&(q.addKey(le),X.push(re)))}switch(W.type){case"add":j=G.concat(f.values?X:X.map(function(ae){return k(ae)}));break;case"put":var me=new kt().addKeys(W.values.map(function(ae){return k(ae)})),j=G.filter(function(ae){return!me.hasKey(f.values?k(ae):ae)}).concat(f.values?X:X.map(function(ae){return k(ae)}));break;case"delete":var he=new kt().addKeys(W.keys);j=G.filter(function(ae){return!he.hasKey(f.values?k(ae):ae)});break;case"deleteRange":var fe=W.range;j=G.filter(function(ae){return!lh(k(ae),fe)})}return j},d);return Z===d?d:(Z.sort(function(G,W){return Ye(Y(G),Y(W))||Ye(k(G),k(W))}),f.limit&&f.limit<1/0&&(Z.length>f.limit?Z.length=f.limit:d.length===f.limit&&Z.length<f.limit&&(R.dirty=!0)),P?Object.freeze(Z):Z)}function Xd(d,f){return Ye(d.lower,f.lower)===0&&Ye(d.upper,f.upper)===0&&!!d.lowerOpen==!!f.lowerOpen&&!!d.upperOpen==!!f.upperOpen}function NE(d,f){return function(I,w,R,P){if(I===void 0)return w!==void 0?-1:0;if(w===void 0)return 1;if((w=Ye(I,w))===0){if(R&&P)return 0;if(R)return 1;if(P)return-1}return w}(d.lower,f.lower,d.lowerOpen,f.lowerOpen)<=0&&0<=function(I,w,R,P){if(I===void 0)return w!==void 0?1:0;if(w===void 0)return-1;if((w=Ye(I,w))===0){if(R&&P)return 0;if(R)return-1;if(P)return 1}return w}(d.upper,f.upper,d.upperOpen,f.upperOpen)}function DE(d,f,I,w){d.subscribers.add(I),w.addEventListener("abort",function(){var R,P;d.subscribers.delete(I),d.subscribers.size===0&&(R=d,P=f,setTimeout(function(){R.subscribers.size===0&&ce(P,R)},3e3))})}var UE={stack:"dbcore",level:0,name:"Cache",create:function(d){var f=d.schema.name;return s(s({},d),{transaction:function(I,w,R){var P,N,U=d.transaction(I,w,R);return w==="readwrite"&&(N=(P=new AbortController).signal,R=function(H){return function(){if(P.abort(),w==="readwrite"){for(var k=new Set,K=0,Y=I;K<Y.length;K++){var Z=Y[K],G=Gi["idb://".concat(f,"/").concat(Z)];if(G){var W=d.table(Z),j=G.optimisticOps.filter(function(Se){return Se.trans===U});if(U._explicit&&H&&U.mutatedParts)for(var X=0,q=Object.values(G.queries.query);X<q.length;X++)for(var $=0,ee=(me=q[X]).slice();$<ee.length;$++)th((he=ee[$]).obsSet,U.mutatedParts)&&(ce(me,he),he.subscribers.forEach(function(Se){return k.add(Se)}));else if(0<j.length){G.optimisticOps=G.optimisticOps.filter(function(Se){return Se.trans!==U});for(var re=0,le=Object.values(G.queries.query);re<le.length;re++)for(var me,he,fe,Ee=0,ae=(me=le[re]).slice();Ee<ae.length;Ee++)(he=ae[Ee]).res!=null&&U.mutatedParts&&(H&&!he.dirty?(fe=Object.isFrozen(he.res),fe=Wd(he.res,he.req,j,W,he,fe),he.dirty?(ce(me,he),he.subscribers.forEach(function(Se){return k.add(Se)})):fe!==he.res&&(he.res=fe,he.promise=ge.resolve({result:fe}))):(he.dirty&&ce(me,he),he.subscribers.forEach(function(Se){return k.add(Se)})))}}}k.forEach(function(Se){return Se()})}}},U.addEventListener("abort",R(!1),{signal:N}),U.addEventListener("error",R(!1),{signal:N}),U.addEventListener("complete",R(!0),{signal:N})),U},table:function(I){var w=d.table(I),R=w.schema.primaryKey;return s(s({},w),{mutate:function(P){var N=Te.trans;if(R.outbound||N.db._options.cache==="disabled"||N.explicit)return w.mutate(P);var U=Gi["idb://".concat(f,"/").concat(I)];return U?(N=w.mutate(P),P.type!=="add"&&P.type!=="put"||!(50<=P.values.length||ah(R,P).some(function(H){return H==null}))?(U.optimisticOps.push(P),P.mutatedParts&&Yo(P.mutatedParts),N.then(function(H){0<H.numFailures&&(ce(U.optimisticOps,P),(H=Hd(0,P,H))&&U.optimisticOps.push(H),P.mutatedParts&&Yo(P.mutatedParts))}),N.catch(function(){ce(U.optimisticOps,P),P.mutatedParts&&Yo(P.mutatedParts)})):N.then(function(H){var k=Hd(0,s(s({},P),{values:P.values.map(function(G,Y){var Z,G=(Z=R.keyPath)!==null&&Z!==void 0&&Z.includes(".")?Q(G):s({},G);return _(G,R.keyPath,H.results[Y]),G})}),H);U.optimisticOps.push(k),queueMicrotask(function(){return P.mutatedParts&&Yo(P.mutatedParts)})}),N):w.mutate(P)},query:function(P){if(!Vd(Te,w)||!Gd("query",P))return w.query(P);var N=((k=Te.trans)===null||k===void 0?void 0:k.db._options.cache)==="immutable",Y=Te,U=Y.requery,H=Y.signal,k=function(W,j,X,q){var $=Gi["idb://".concat(W,"/").concat(j)];if(!$)return[];if(!(j=$.queries[X]))return[null,!1,$,null];var ee=j[(q.query?q.query.index.name:null)||""];if(!ee)return[null,!1,$,null];switch(X){case"query":var re=ee.find(function(le){return le.req.limit===q.limit&&le.req.values===q.values&&Xd(le.req.query.range,q.query.range)});return re?[re,!0,$,ee]:[ee.find(function(le){return("limit"in le.req?le.req.limit:1/0)>=q.limit&&(!q.values||le.req.values)&&NE(le.req.query.range,q.query.range)}),!1,$,ee];case"count":return re=ee.find(function(le){return Xd(le.req.query.range,q.query.range)}),[re,!!re,$,ee]}}(f,I,"query",P),K=k[0],Y=k[1],Z=k[2],G=k[3];return K&&Y?K.obsSet=P.obsSet:(Y=w.query(P).then(function(W){var j=W.result;if(K&&(K.res=j),N){for(var X=0,q=j.length;X<q;++X)Object.freeze(j[X]);Object.freeze(j)}else W.result=Q(j);return W}).catch(function(W){return G&&K&&ce(G,K),Promise.reject(W)}),K={obsSet:P.obsSet,promise:Y,subscribers:new Set,type:"query",req:P,dirty:!1},G?G.push(K):(G=[K],(Z=Z||(Gi["idb://".concat(f,"/").concat(I)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[P.query.index.name||""]=G)),DE(K,G,U,H),K.promise.then(function(W){return{result:Wd(W.result,P,Z==null?void 0:Z.optimisticOps,w,K,N)}})}})}})}};function Vo(d,f){return new Proxy(d,{get:function(I,w,R){return w==="db"?f:Reflect.get(I,w,R)}})}var si=(pt.prototype.version=function(d){if(isNaN(d)||d<.1)throw new Ce.Type("Given version is not a positive number");if(d=Math.round(10*d)/10,this.idbdb||this._state.isBeingOpened)throw new Ce.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,d);var f=this._versions,I=f.filter(function(w){return w._cfg.version===d})[0];return I||(I=new this.Version(d),f.push(I),f.sort(AE),I.stores({}),this._state.autoSchema=!1,I)},pt.prototype._whenReady=function(d){var f=this;return this.idbdb&&(this._state.openComplete||Te.letThrough||this._vip)?d():new ge(function(I,w){if(f._state.openComplete)return w(new Ce.DatabaseClosed(f._state.dbOpenError));if(!f._state.isBeingOpened){if(!f._state.autoOpen)return void w(new Ce.DatabaseClosed);f.open().catch(ke)}f._state.dbReadyPromise.then(I,w)}).then(d)},pt.prototype.use=function(d){var f=d.stack,I=d.create,w=d.level,R=d.name;return R&&this.unuse({stack:f,name:R}),d=this._middlewares[f]||(this._middlewares[f]=[]),d.push({stack:f,create:I,level:w??10,name:R}),d.sort(function(P,N){return P.level-N.level}),this},pt.prototype.unuse=function(d){var f=d.stack,I=d.name,w=d.create;return f&&this._middlewares[f]&&(this._middlewares[f]=this._middlewares[f].filter(function(R){return w?R.create!==w:!!I&&R.name!==I})),this},pt.prototype.open=function(){var d=this;return Yi(pi,function(){return bE(d)})},pt.prototype._close=function(){var d=this._state,f=fn.indexOf(this);if(0<=f&&fn.splice(f,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}d.isBeingOpened||(d.dbReadyPromise=new ge(function(I){d.dbReadyResolve=I}),d.openCanceller=new ge(function(I,w){d.cancelOpen=w}))},pt.prototype.close=function(I){var f=(I===void 0?{disableAutoOpen:!0}:I).disableAutoOpen,I=this._state;f?(I.isBeingOpened&&I.cancelOpen(new Ce.DatabaseClosed),this._close(),I.autoOpen=!1,I.dbOpenError=new Ce.DatabaseClosed):(this._close(),I.autoOpen=this._options.autoOpen||I.isBeingOpened,I.openComplete=!1,I.dbOpenError=null)},pt.prototype.delete=function(d){var f=this;d===void 0&&(d={disableAutoOpen:!0});var I=0<arguments.length&&typeof arguments[0]!="object",w=this._state;return new ge(function(R,P){function N(){f.close(d);var U=f._deps.indexedDB.deleteDatabase(f.name);U.onsuccess=nt(function(){var H,k,K;H=f._deps,k=f.name,K=H.indexedDB,H=H.IDBKeyRange,Jl(K)||k===So||ql(K,H).delete(k).catch(ke),R()}),U.onerror=xs(P),U.onblocked=f._fireOnBlocked}if(I)throw new Ce.InvalidArgument("Invalid closeOptions argument to db.delete()");w.isBeingOpened?w.dbReadyPromise.then(N):N()})},pt.prototype.backendDB=function(){return this.idbdb},pt.prototype.isOpen=function(){return this.idbdb!==null},pt.prototype.hasBeenClosed=function(){var d=this._state.dbOpenError;return d&&d.name==="DatabaseClosed"},pt.prototype.hasFailed=function(){return this._state.dbOpenError!==null},pt.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(pt.prototype,"tables",{get:function(){var d=this;return r(this._allTables).map(function(f){return d._allTables[f]})},enumerable:!1,configurable:!0}),pt.prototype.transaction=function(){var d=(function(f,I,w){var R=arguments.length;if(R<2)throw new Ce.InvalidArgument("Too few arguments");for(var P=new Array(R-1);--R;)P[R-1]=arguments[R];return w=P.pop(),[f,B(P),w]}).apply(this,arguments);return this._transaction.apply(this,d)},pt.prototype._transaction=function(d,f,I){var w=this,R=Te.trans;R&&R.db===this&&d.indexOf("!")===-1||(R=null);var P,N,U=d.indexOf("?")!==-1;d=d.replace("!","").replace("?","");try{if(N=f.map(function(k){if(k=k instanceof w.Table?k.name:k,typeof k!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return k}),d=="r"||d===zl)P=zl;else{if(d!="rw"&&d!=Yl)throw new Ce.InvalidArgument("Invalid transaction mode: "+d);P=Yl}if(R){if(R.mode===zl&&P===Yl){if(!U)throw new Ce.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");R=null}R&&N.forEach(function(k){if(R&&R.storeNames.indexOf(k)===-1){if(!U)throw new Ce.SubTransaction("Table "+k+" not included in parent transaction.");R=null}}),U&&R&&!R.active&&(R=null)}}catch(k){return R?R._promise(null,function(K,Y){Y(k)}):ut(k)}var H=(function k(K,Y,Z,G,W){return ge.resolve().then(function(){var j=Te.transless||Te,X=K._createTransaction(Y,Z,K._dbSchema,G);if(X.explicit=!0,j={trans:X,transless:j},G)X.idbtrans=G.idbtrans;else try{X.create(),X.idbtrans._explicit=!0,K._state.PR1398_maxLoop=3}catch(ee){return ee.name===Bt.InvalidState&&K.isOpen()&&0<--K._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),K.close({disableAutoOpen:!1}),K.open().then(function(){return k(K,Y,Z,null,W)})):ut(ee)}var q,$=gt(W);return $&&pn(),j=ge.follow(function(){var ee;(q=W.call(X,X))&&($?(ee=mi.bind(null,null),q.then(ee,ee)):typeof q.next=="function"&&typeof q.throw=="function"&&(q=rh(q)))},j),(q&&typeof q.then=="function"?ge.resolve(q).then(function(ee){return X.active?ee:ut(new Ce.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):j.then(function(){return q})).then(function(ee){return G&&X._resolve(),X._completion.then(function(){return ee})}).catch(function(ee){return X._reject(ee),ut(ee)})})}).bind(null,this,P,N,R,I);return R?R._promise(P,H,"lock"):Te.trans?Yi(Te.transless,function(){return w._whenReady(H)}):this._whenReady(H)},pt.prototype.table=function(d){if(!p(this._allTables,d))throw new Ce.InvalidTable("Table ".concat(d," does not exist"));return this._allTables[d]},pt);function pt(d,f){var I=this;this._middlewares={},this.verno=0;var w=pt.dependencies;this._options=f=s({addons:pt.addons,autoOpen:!0,indexedDB:w.indexedDB,IDBKeyRange:w.IDBKeyRange,cache:"cloned"},f),this._deps={indexedDB:f.indexedDB,IDBKeyRange:f.IDBKeyRange},w=f.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var R,P,N,U,H,k={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ke,dbReadyPromise:null,cancelOpen:ke,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:f.autoOpen};k.dbReadyPromise=new ge(function(Y){k.dbReadyResolve=Y}),k.openCanceller=new ge(function(Y,Z){k.cancelOpen=Z}),this._state=k,this.name=d,this.on=Ir(this,"populate","blocked","versionchange","close",{ready:[bl,ke]}),this.on.ready.subscribe=A(this.on.ready.subscribe,function(Y){return function(Z,G){pt.vip(function(){var W,j=I._state;j.openComplete?(j.dbOpenError||ge.resolve().then(Z),G&&Y(Z)):j.onReadyBeingFired?(j.onReadyBeingFired.push(Z),G&&Y(Z)):(Y(Z),W=I,G||Y(function X(){W.on.ready.unsubscribe(Z),W.on.ready.unsubscribe(X)}))})}}),this.Collection=(R=this,Cr(CE.prototype,function(q,X){this.db=R;var G=vd,W=null;if(X)try{G=X()}catch($){W=$}var j=q._ctx,X=j.table,q=X.hook.reading.fire;this._ctx={table:X,index:j.index,isPrimKey:!j.index||X.schema.primKey.keyPath&&j.index===X.schema.primKey.name,range:G,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:W,or:j.or,valueMapper:q!==zt?q:null}})),this.Table=(P=this,Cr(Sd.prototype,function(Y,Z,G){this.db=P,this._tx=G,this.name=Y,this.schema=Z,this.hook=P._allTables[Y]?P._allTables[Y].hook:Ir(null,{creating:[Js,ke],reading:[ur,zt],updating:[uE,ke],deleting:[$s,ke]})})),this.Transaction=(N=this,Cr(wE.prototype,function(Y,Z,G,W,j){var X=this;this.db=N,this.mode=Y,this.storeNames=Z,this.schema=G,this.chromeTransactionDurability=W,this.idbtrans=null,this.on=Ir(this,"complete","error","abort"),this.parent=j||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new ge(function(q,$){X._resolve=q,X._reject=$}),this._completion.then(function(){X.active=!1,X.on.complete.fire()},function(q){var $=X.active;return X.active=!1,X.on.error.fire(q),X.parent?X.parent._reject(q):$&&X.idbtrans&&X.idbtrans.abort(),ut(q)})})),this.Version=(U=this,Cr(PE.prototype,function(Y){this.db=U,this._cfg={version:Y,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(H=this,Cr(Md.prototype,function(Y,Z,G){if(this.db=H,this._ctx={table:Y,index:Z===":id"?null:Z,or:G},this._cmp=this._ascending=Ye,this._descending=function(W,j){return Ye(j,W)},this._max=function(W,j){return 0<Ye(W,j)?W:j},this._min=function(W,j){return Ye(W,j)<0?W:j},this._IDBKeyRange=H._deps.IDBKeyRange,!this._IDBKeyRange)throw new Ce.MissingAPI})),this.on("versionchange",function(Y){0<Y.newVersion?console.warn("Another connection wants to upgrade database '".concat(I.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(I.name,"'. Closing db now to resume the delete request.")),I.close({disableAutoOpen:!1})}),this.on("blocked",function(Y){!Y.newVersion||Y.newVersion<Y.oldVersion?console.warn("Dexie.delete('".concat(I.name,"') was blocked")):console.warn("Upgrade '".concat(I.name,"' blocked by other connection holding version ").concat(Y.oldVersion/10))}),this._maxKey=vr(f.IDBKeyRange),this._createTransaction=function(Y,Z,G,W){return new I.Transaction(Y,Z,G,I._options.chromeTransactionDurability,W)},this._fireOnBlocked=function(Y){I.on("blocked").fire(Y),fn.filter(function(Z){return Z.name===I.name&&Z!==I&&!Z._state.vcFired}).map(function(Z){return Z.on("versionchange").fire(Y)})},this.use(_E),this.use(UE),this.use(LE),this.use(xE),this.use(ME);var K=new Proxy(this,{get:function(Y,Z,G){if(Z==="_vip")return!0;if(Z==="table")return function(j){return Vo(I.table(j),K)};var W=Reflect.get(Y,Z,G);return W instanceof Sd?Vo(W,K):Z==="tables"?W.map(function(j){return Vo(j,K)}):Z==="_createTransaction"?function(){return Vo(W.apply(this,arguments),K)}:W}});this.vip=K,w.forEach(function(Y){return Y(I)})}var Go,ns=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",BE=(hh.prototype.subscribe=function(d,f,I){return this._subscribe(d&&typeof d!="function"?d:{next:d,error:f,complete:I})},hh.prototype[ns]=function(){return this},hh);function hh(d){this._subscribe=d}try{Go={indexedDB:n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB,IDBKeyRange:n.IDBKeyRange||n.webkitIDBKeyRange}}catch{Go={indexedDB:null,IDBKeyRange:null}}function Kd(d){var f,I=!1,w=new BE(function(R){var P=gt(d),N,U=!1,H={},k={},K={get closed(){return U},unsubscribe:function(){U||(U=!0,N&&N.abort(),Y&&Ii.storagemutated.unsubscribe(G))}};R.start&&R.start(K);var Y=!1,Z=function(){return Bl(W)},G=function(j){zo(H,j),th(k,H)&&Z()},W=function(){var j,X,q;!U&&Go.indexedDB&&(H={},j={},N&&N.abort(),N=new AbortController,q=function($){var ee=dn();try{P&&pn();var re=fi(d,$);return re=P?re.finally(mi):re}finally{ee&&un()}}(X={subscr:j,signal:N.signal,requery:Z,querier:d,trans:null}),Promise.resolve(q).then(function($){I=!0,f=$,U||X.signal.aborted||(H={},function(ee){for(var re in ee)if(p(ee,re))return;return 1}(k=j)||Y||(Ii(wr,G),Y=!0),Bl(function(){return!U&&R.next&&R.next($)}))},function($){I=!1,["DatabaseClosedError","AbortError"].includes($==null?void 0:$.name)||U||Bl(function(){U||R.error&&R.error($)})}))};return setTimeout(Z,0),K});return w.hasValue=function(){return I},w.getValue=function(){return f},w}var Hi=si;function ch(d){var f=Ci;try{Ci=!0,Ii.storagemutated.fire(d),nh(d,!0)}finally{Ci=f}}u(Hi,s(s({},wt),{delete:function(d){return new Hi(d,{addons:[]}).delete()},exists:function(d){return new Hi(d,{addons:[]}).open().then(function(f){return f.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(d){try{return f=Hi.dependencies,I=f.indexedDB,f=f.IDBKeyRange,(Jl(I)?Promise.resolve(I.databases()).then(function(w){return w.map(function(R){return R.name}).filter(function(R){return R!==So})}):ql(I,f).toCollection().primaryKeys()).then(d)}catch{return ut(new Ce.MissingAPI)}var f,I},defineClass:function(){return function(d){a(this,d)}},ignoreTransaction:function(d){return Te.trans?Yi(Te.transless,d):d()},vip:$l,async:function(d){return function(){try{var f=rh(d.apply(this,arguments));return f&&typeof f.then=="function"?f:ge.resolve(f)}catch(I){return ut(I)}}},spawn:function(d,f,I){try{var w=rh(d.apply(I,f||[]));return w&&typeof w.then=="function"?w:ge.resolve(w)}catch(R){return ut(R)}},currentTransaction:{get:function(){return Te.trans||null}},waitFor:function(d,f){return f=ge.resolve(typeof d=="function"?Hi.ignoreTransaction(d):d).timeout(f||6e4),Te.trans?Te.trans.waitFor(f):f},Promise:ge,debug:{get:function(){return bs},set:function(d){Ed(d)}},derive:g,extend:a,props:u,override:A,Events:Ir,on:Ii,liveQuery:Kd,extendObservabilitySet:zo,getByKeyPath:M,setByKeyPath:_,delByKeyPath:function(d,f){typeof f=="string"?_(d,f,void 0):"length"in f&&[].map.call(f,function(I){_(d,I,void 0)})},shallowClone:L,deepClone:Q,getObjectDiff:oh,cmp:Ye,asap:F,minKey:-1/0,addons:[],connections:fn,errnames:Bt,dependencies:Go,cache:Gi,semVer:"4.0.8",version:"4.0.8".split(".").map(function(d){return parseInt(d)}).reduce(function(d,f,I){return d+f/Math.pow(10,2*I)})})),Hi.maxKey=vr(Hi.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Ii(wr,function(d){Ci||(d=new CustomEvent(Hl,{detail:d}),Ci=!0,dispatchEvent(d),Ci=!1)}),addEventListener(Hl,function(d){d=d.detail,Ci||ch(d)}));var gn,Ci=!1,Zd=function(){};return typeof BroadcastChannel<"u"&&((Zd=function(){(gn=new BroadcastChannel(Hl)).onmessage=function(d){return d.data&&ch(d.data)}})(),typeof gn.unref=="function"&&gn.unref(),Ii(wr,function(d){Ci||gn.postMessage(d)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(d){if(!si.disableBfCache&&d.persisted){bs&&console.debug("Dexie: handling persisted pagehide"),gn!=null&&gn.close();for(var f=0,I=fn;f<I.length;f++)I[f].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(d){!si.disableBfCache&&d.persisted&&(bs&&console.debug("Dexie: handling persisted pageshow"),Zd(),ch({all:new kt(-1/0,[[]])}))})),ge.rejectionMapper=function(d,f){return!d||d instanceof yt||d instanceof TypeError||d instanceof SyntaxError||!d.name||!Ae[d.name]?d:(f=new Ae[d.name](f||d.message,d),"stack"in d&&E(f,"stack",{get:function(){return this.inner.stack}}),f)},Ed(bs),s(si,Object.freeze({__proto__:null,Dexie:si,liveQuery:Kd,Entity:Rd,cmp:Ye,PropModSymbol:ti,PropModification:Tr,replacePrefix:function(d,f){return new Tr({replacePrefix:[d,f]})},add:function(d){return new Tr({add:d})},remove:function(d){return new Tr({remove:d})},default:si,RangeSet:kt,mergeRanges:Ar,rangesOverlap:Ud}),{default:si}),si})})(aE);var gT=aE.exports;const Vc=bm(gT),xp=Symbol.for("Dexie"),Gc=globalThis[xp]||(globalThis[xp]=Vc);if(Vc.semVer!==Gc.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Vc.semVer} and ${Gc.semVer}`);class IT extends Gc{constructor(){super("MyAppDatabase"),S(this,"files"),this.version(1).stores({files:"id, file"})}}class CT{constructor(e){S(this,"interval",1e4),S(this,"maxTime",6e4),S(this,"list",new Map),S(this,"_enabled",!1),S(this,"_intervalId",null),S(this,"_fileCache"),this._fileCache=e}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e){if(this._enabled=e,!e){this._intervalId!==null&&clearInterval(this._intervalId),this._intervalId=null;return}this._intervalId=window.setInterval(()=>{const t=new Date().getTime();for(const[s,i]of this.list)t-i>this.maxTime&&this.clean(s)},this.interval)}}update(e){this.enabled&&this.list.set(e,new Date().getTime())}async clear(){for(const[e]of this.list)this.clean(e)}clean(e){try{this._fileCache.files.delete(e)}catch{console.log(`File not found in indexedDB: ${e}`)}this.list.delete(e)}}const lE=class Hc extends De{constructor(e){super(e),S(this,"enabled",!0),S(this,"onFragmentsDeleted",new te),S(this,"onFragmentsLoaded",new te),S(this,"onDisposed",new te),S(this,"models",{}),S(this,"serializer",new jc),S(this,"maxRamTime",5e3),S(this,"useCache",!0),S(this,"dbCleaner"),S(this,"fetch",async t=>fetch(t)),S(this,"_culler",null),S(this,"_world",null),S(this,"_ramCache",new Map),S(this,"_fileCache",new IT),S(this,"_url",null),S(this,"_isDisposing",!1),S(this,"_geometryInstances",{}),S(this,"_loadedFragments",{}),S(this,"fragIDData",new Map),S(this,"_baseMaterial",new er),S(this,"_baseMaterialT",new er({transparent:!0,opacity:.5})),S(this,"disposeStreamedGroup",t=>{this._isDisposing=!0;const{groupID:s,fragmentIDs:i}=t;if(this.models[s]){delete this.models[s],delete this._geometryInstances[s],delete this._loadedFragments[s];for(const n of i)this.fragIDData.delete(n);this.culler.remove(s),this._isDisposing=!1}}),this.components.add(Hc.uuid,this),this.dbCleaner=new CT(this._fileCache),this.components.get(Qe).onFragmentsDisposed.add(this.disposeStreamedGroup)}get url(){if(!this._url)throw new Error("url must be set before using the streaming service!");return this._url}set url(e){this._url=e}get world(){if(!this._world)throw new Error("You must set a world before using the streamer!");return this._world}set world(e){var t;this._world=e,(t=this._culler)==null||t.dispose(),this._culler=new ET(this.components,e),this._culler.onViewUpdated.add(async({toLoad:s,toRemove:i,toShow:n,toHide:r})=>{await this.loadFoundGeometries(s),await this.unloadLostGeometries(i),this.setMeshVisibility(n,!0),this.setMeshVisibility(r,!1)})}get culler(){if(!this._culler)throw new Error("You must set a world before using the streamer!");return this._culler}dispose(){var e;this._isDisposing=!0,this.onFragmentsLoaded.reset(),this.onFragmentsDeleted.reset(),this._ramCache.clear(),this.components.get(Qe).onFragmentsDisposed.remove(this.disposeStreamedGroup),this.models={},this._geometryInstances={},this._loadedFragments={},this.fragIDData.clear(),this._baseMaterial.dispose(),this._baseMaterialT.dispose(),(e=this._culler)==null||e.dispose(),this.onDisposed.trigger(Hc.uuid),this.onDisposed.reset(),this._isDisposing=!1}async load(e,t,s){const{assets:i,geometries:n,globalDataFileId:r}=e,o=this.url+r,a=await(await this.fetch(o)).arrayBuffer(),l=new Uint8Array(a),c=this.components.get(Qe).load(l,{coordinate:t,isStreamed:!0});c.name=r.replace("-processed-global",""),this.world.scene.three.add(c);const{opaque:p,transparent:u}=c.geometryIDs;for(const[E,g]of p){const T=c.keyFragments.get(g);if(T===void 0)throw new Error("Malformed fragments group!");this.fragIDData.set(T,[c,E,new Set])}for(const[E,g]of u){const T=c.keyFragments.get(g);if(T===void 0)throw new Error("Malformed fragments group!");this.fragIDData.set(T,[c,Math.abs(E),new Set])}this.culler.add(c.uuid,i,n),this.models[c.uuid]={assets:i,geometries:n};const m=new Map;for(const E of i){const g=E.id;for(const{transformation:T,geometryID:y,color:v}of E.geometries){m.has(y)||m.set(y,[]);const A=m.get(y);if(!A)throw new Error("Malformed instances");A.push({id:g,transformation:T,color:v})}}if(this._geometryInstances[c.uuid]=m,s){const E=new Map,g=new Map;for(const F in s.ids){const M=s.ids[F],_=parseInt(F,10);E.set(_,M)}for(const F in s.types){const M=s.types[F],_=parseInt(F,10);g.set(_,M)}const T=r.replace("-global","-properties");c.streamSettings={baseUrl:this.url,baseFileName:T,ids:E,types:g};const{indexesFile:y}=s,v=this.url+y,A=await(await this.fetch(v)).text(),C=this.components.get(Eo);C.setRelationMap(c,C.getRelationsMapFromJSON(A))}return this.culler.updateTransformations(c.uuid),this.culler.needsUpdate=!0,c}remove(e){const t=this.components.get(Qe),s=t.groups.get(e);s&&t.disposeGroup(s)}setVisibility(e,t){const s=new Map;for(const i in t){const n=this.fragIDData.get(i);if(n===void 0)throw new Error("Geometry not found!");const[r,o,a]=n,l=r.uuid;s.has(l)||s.set(l,new Map);const c=s.get(l),p=t[i];for(const m of p)e?a.delete(m):a.add(m);c.get(o)||c.set(o,new Set);const u=c.get(o);for(const m of p)u.add(m)}for(const[i,n]of s){this.culler.setVisibility(e,i,n);for(const[r]of n){const o=this._loadedFragments[i];if(!o)continue;const a=o[r];if(a)for(const l of a){const c=t[l.id];c&&l.setVisibility(e,c)}}}this.culler.needsUpdate=!0}async clearCache(){await this._fileCache.delete()}async setStatic(e,t,s){const i={};for(const n of e){const r=this.fragIDData.get(n);if(!r){console.log(`Item not found: ${n}.`);continue}const[o,a]=r,l=o.uuid;i[l]||(i[l]=new Set),i[l].add(a)}if(t){const n={};for(const r in i){const o=new Map;o.set(1,i[r]),n[r]=o}await this.loadFoundGeometries(n,!1),await this.culler.addStaticGeometries(i,s)}else this.culler.removeStaticGeometries(i,s)}async loadFoundGeometries(e,t=!0){for(const s in e){if(this._isDisposing)return;const i=this.components.get(Qe).groups.get(s);if(!i)return;const{geometries:n}=this.models[s],r=new Map,o=new Set;for(const[p,u]of e[s])for(const m of u){o.add(m);const E=n[m];if(!E)throw new Error("Geometry not found");if(E.geometryFile){const g=E.geometryFile,T=r.get(g)||0;r.set(g,T+p)}}const a=Array.from(r).sort((p,u)=>u[1]-p[1]);for(const[p]of a){const u=this.url+p;if(!this._ramCache.has(u)){let g=new Uint8Array;if(this.useCache){this.dbCleaner.update(u);const y=await this._fileCache.files.get(u);if(y)g=y.file;else{const v=await(await this.fetch(u)).arrayBuffer();g=new Uint8Array(v),this._fileCache.files.add({file:g,id:u})}}else{const y=await(await this.fetch(u)).arrayBuffer();g=new Uint8Array(y)}const T=this.serializer.import(g);this._ramCache.set(u,{data:T,time:performance.now()})}const m=this._ramCache.get(u);if(!m)continue;m.time=performance.now();const E=[];if(m)for(const[g,{position:T,index:y,normal:v}]of m.data){if(this._isDisposing)return;if(!o.has(g)||!this._geometryInstances[s]||!this._geometryInstances[s].has(g))continue;const A=this._geometryInstances[s].get(g);if(!A)throw new Error("Instances not found!");const C=new ze,F=new Ct(T,3),M=new Ct(v,3);C.setAttribute("position",F),C.setAttribute("normal",M),C.setIndex(Array.from(y));const _=[],L=[];for(const D of A)D.color[3]===1?L.push(D):_.push(D);this.newFragment(i,g,C,_,!0,E,t),this.newFragment(i,g,C,L,!1,E,t)}E.length&&!this._isDisposing&&this.onFragmentsLoaded.trigger(E)}const l=new Set,c=performance.now();for(const[p,{time:u}]of this._ramCache)c-u>this.maxRamTime&&l.add(p);for(const p of l)this._ramCache.delete(p)}}async unloadLostGeometries(e){if(this._isDisposing)return;const t=[],s=this.components.get(Qe);for(const i in e){const n=s.groups.get(i);if(!n)throw new Error("Fragment group not found!");if(!this._loadedFragments[i])continue;const r=this._loadedFragments[i],o=e[i];for(const a of o){if(this.culler.removeFragment(n.uuid,a),!r[a])continue;const l=r[a];for(const c of l)n.items.splice(n.items.indexOf(c),1),t.push(c);delete r[a]}}t.length&&this.onFragmentsDeleted.trigger(t);for(const i of t)s.list.delete(i.id),this.world.meshes.delete(i.mesh),i.mesh.material=[],i.dispose(!0)}setMeshVisibility(e,t){for(const s in e)for(const i of e[s]){const n=this._loadedFragments[s];if(!n)continue;const r=n[i];if(r)for(const o of r)o.mesh.visible=t}}newFragment(e,t,s,i,n,r,o){if(i.length===0||this._isDisposing)return;const a=e.geometryIDs,l=n?a.transparent:a.opaque,c=t*(n?-1:1),p=l.get(c);if(p===void 0)return;const u=e.keyFragments.get(p);if(u===void 0)return;const m=this.components.get(Qe);if(m.list.has(u))return;const E=n?this._baseMaterialT:this._baseMaterial,g=new ho(s,E,i.length);g.mesh.visible=o,g.id=u,g.mesh.uuid=u,g.group=e,e.add(g.mesh),e.items.push(g),m.list.set(g.id,g),this.world.meshes.add(g.mesh),this._loadedFragments[e.uuid]||(this._loadedFragments[e.uuid]={});const T=this._loadedFragments[e.uuid];T[t]||(T[t]=[]),T[t].push(g);const y=new Map;for(let F=0;F<i.length;F++){const M=new de,_=new ft,{id:L,transformation:D,color:B}=i[F];M.fromArray(D);const[z,V,Q]=B;if(_.setRGB(z,V,Q,"srgb"),y.has(L)){const ne=y.get(L);if(!ne)continue;ne.transforms.push(M),ne.colors&&ne.colors.push(_)}else y.set(L,{id:L,colors:[_],transforms:[M]})}const v=Array.from(y.values());g.add(v);const A=this.fragIDData.get(g.id);if(!A)throw new Error("Fragment data not found!");const C=A[2];C.size&&g.setVisibility(!1,C),this.culler.addFragment(e.uuid,t,g),r.push(g)}};S(lE,"uuid","22437e8d-9dbc-4b99-a04f-d2da280d50c8");let my=lE;class TT{constructor(){S(this,"_meshes",new Map)}highlight(e,t,s,i){if(!t.userData.indexFragmentMap||!t.geometry.index)return;const{userData:n}=t,r=n.indexFragmentMap,o=[],a=t.geometry.index.array;for(const[p,u]of r)for(const m in u)if(i[m]){for(const E of u[m])if(i[m].has(E)){const g=a[p*3],T=a[p*3+1],y=a[p*3+2];o.push(g,T,y)}}this._meshes.has(e)||this._meshes.set(e,new Map);const l=this._meshes.get(e);if(!l.has(t.uuid)){const p=new It({depthTest:!1,side:2,color:s}),u=new ze;u.attributes=t.geometry.attributes;const m=new J(u,p);m.frustumCulled=!1,l.set(t.uuid,m)}const c=l.get(t.uuid);c.position.copy(t.position),t.parent&&t.parent!==c.parent&&t.parent.add(c),c.geometry.setIndex(o),c.material.color.copy(s)}clear(e){for(const[t,s]of this._meshes)if(!(e&&e!==t))for(const[i,n]of s)n.removeFromParent()}dispose(){for(const[e,t]of this._meshes)for(const[s,i]of t)i.removeFromParent(),i.geometry.attributes={},i.geometry.dispose(),i.material.dispose();this._meshes.clear()}}const hE=class Wc extends De{constructor(e){super(e),S(this,"onDisposed",new te),S(this,"onBeforeUpdate",new te),S(this,"onAfterUpdate",new te),S(this,"onSetup",new te),S(this,"isSetup",!1),S(this,"enabled",!0),S(this,"events",{}),S(this,"multiple","ctrlKey"),S(this,"zoomFactor",1.5),S(this,"zoomToSelection",!1),S(this,"backupColor",null),S(this,"selection",{}),S(this,"config",{selectName:"select",hoverName:"hover",selectionColor:new ft("#BCF124"),hoverColor:new ft("#6528D7"),autoHighlightOnClick:!0,world:null,selectEnabled:!0,hoverEnabled:!0}),S(this,"colors",new Map),S(this,"autoToggle",new Set),S(this,"selectable",{}),S(this,"_fills",new TT),S(this,"_mouseState",{down:!1,moved:!1}),S(this,"_colorsBeforeSelect",{}),S(this,"saveHighlightersBeforeSelect",t=>{var s;const i=this.components.get(Qe);for(const n in t){const r=i.list.get(n);if(!r)continue;const o=(s=r.group)==null?void 0:s.uuid;if(o)for(const a in this.selection){if(a===this.config.selectName||a===this.config.hoverName)continue;const l=this.selection[a][n];if(l){a in this._colorsBeforeSelect||(this._colorsBeforeSelect[a]={}),o in this._colorsBeforeSelect[a]||(this._colorsBeforeSelect[a]={[o]:new Set});for(const c of l)this._colorsBeforeSelect[a][o].add(c)}}}}),S(this,"restoreHighlightersAfterDeselect",()=>{const t=this.components.get(Qe);for(const s in this._colorsBeforeSelect){let i={};const n=this._colorsBeforeSelect[s];for(const r in n){const o=t.groups.get(r);if(!o)continue;const a=o.getFragmentMap(n[r]);i={...i,...a}}this.highlightByID(s,i,!1,!1)}this._colorsBeforeSelect={}}),S(this,"clearHover",()=>{this.selection[this.config.hoverName]={}}),S(this,"onMouseDown",()=>{this.enabled&&(this._mouseState.down=!0)}),S(this,"onMouseUp",async t=>{if(!this.enabled)return;const{world:s,autoHighlightOnClick:i,selectEnabled:n}=this.config;if(!s)throw new Error("No world found!");if(!s.renderer)throw new Error("This world doesn't have a renderer!");if(t.target===s.renderer.three.domElement){if(this._mouseState.down=!1,this._mouseState.moved||t.button!==0){this._mouseState.moved=!1;return}if(this._mouseState.moved=!1,i&&n){const r=this.multiple==="none"?!0:!t[this.multiple];await this.highlight(this.config.selectName,r,this.zoomToSelection)}}}),S(this,"onMouseMove",async()=>{if(!this.enabled)return;const{hoverName:t,hoverEnabled:s}=this.config;if(this._mouseState.moved){this.clear(t);return}this._mouseState.moved=this._mouseState.down;const i={};for(const n in this.selection){if(n===t)continue;const r=this.selection[n];for(const o in r){o in i||(i[o]=new Set);const a=r[o];for(const l of a)i[o].add(l)}}s&&await this.highlight(this.config.hoverName,!0,!1,i)}),this.components.add(Wc.uuid,this)}async dispose(){this.setupEvents(!1),this._fills.dispose(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.selection={};for(const e in this.events)this.events[e].onClear.reset(),this.events[e].onHighlight.reset();this.onSetup.reset(),this.events={},this.onDisposed.trigger(Wc.uuid),this.onDisposed.reset()}add(e,t){if(this.selection[e]||this.colors.has(e))throw new Error("A selection with that name already exists!");this.colors.set(e,t),this.selection[e]={},this.events[e]={onHighlight:new te,onClear:new te}}async highlight(e,t=!0,s=this.zoomToSelection,i={}){if(!this.enabled)return null;if(!this.config.world)throw new Error("No world found in config!");const n=this.config.world;if(!this.selection[e])throw new Error(`Selection ${e} does not exist.`);const r=[],o=this.components.get(Qe).meshes;for(const T of o)r.push(T);const a=this.components.get(uo);for(const T of a.list){const y=T;if(y.edges){const v=y.edges.fillMeshes;for(const A of v)r.push(A)}}const l=this.components.get(As).get(n).castRay(r);if(!l||!l.face)return this.clear(e),null;const c=l.object;if(!c.fragment&&c.userData.indexFragmentMap){if(l.faceIndex===void 0||!c.geometry.index)return null;const{userData:T}=c,y=T.indexFragmentMap.get(l.faceIndex);if(y){await this.highlightByID(e,y,t,s,i,c,!0);const v=Object.keys(y)[0];return{id:Array.from(y[v])[0],fragments:y}}return null}const p=c.geometry,u=l.instanceId;if(!p||u===void 0)return null;const m=c.fragment.getItemID(u);if(m===null)throw new Error("Item ID not found!");const E=c.fragment.group;if(!E)throw new Error("Fragment must belong to a FragmentsGroup!");const g=E.getFragmentMap([m]);return await this.highlightByID(e,g,t,s,i,void 0,!0),{id:m,fragments:g}}async highlightByID(e,t,s=!0,i=this.zoomToSelection,n={},r=void 0,o=!1){if(!this.enabled)return;s&&this.clear(e);const a=this.components.get(Qe),l=this.colors.get(e);if(!l)throw new Error("Color for selection not found!");const c={};for(const p in t){const u=t[p],m=n[p];for(const E of u)if(!(m&&m.has(E))){if(this.selectable[e]){const g=this.selectable[e];if(!g[p]||!g[p].has(E))continue}c[p]||(c[p]=new Set),c[p].add(E)}}for(const p in c){this.selection[e][p]||(this.selection[e][p]=new Set);const u=c[p],m=new Set,E=new Set;for(const T of u){const y=this.selection[e][p];o&&this.autoToggle.has(e)&&y.has(T)?(m.add(T),y.delete(T)):(y.add(T),E.add(T))}const g=a.list.get(p);if(g&&(m.size&&(this.backupColor?g.setColor(this.backupColor,m):g.resetColor(m)),E.size&&g.setColor(l,E),g.mesh.userData.fills))for(const T of g.mesh.userData.fills)this._fills.highlight(e,T,l,t)}this.events[e].onHighlight.trigger(this.selection[e]),r&&this._fills.highlight(e,r,l,t),i&&await this.zoomSelection(e)}clear(e){const t=e?[e]:Object.keys(this.selection);for(const s of t){this._fills.clear(s);const i=this.components.get(Qe),n=this.selection[s];for(const r in this.selection[s]){const o=i.list.get(r);if(!o)continue;const a=n[r];a&&(this.backupColor?o.setColor(this.backupColor,a):o.resetColor(a))}this.events[s].onClear.trigger(null),this.selection[s]={}}}setup(e){this.config={...this.config,...e},this.add(this.config.selectName,this.config.selectionColor),this.autoToggle.add(this.config.selectName),this.add(this.config.hoverName,this.config.hoverColor),this.setupEvents(!0),this.enabled=!0,this.isSetup=!0,this.onSetup.trigger(this)}updateFragments(e){for(const t of e)for(const s in this.selection){const i=this.selection[s][t.id],n=this.colors.get(s);i&&n&&t.setColor(n,i)}}async zoomSelection(e){if(!this.config.world)throw new Error("No world found in config!");const t=this.config.world;if(!t.camera.hasCameraControls())return;const s=this.components.get(_c),i=this.components.get(Qe);s.reset();const n=this.selection[e];if(!Object.keys(n).length)return;for(const g in n){const T=i.list.get(g);if(!T)continue;const y=n[g];s.addMesh(T.mesh,y)}const r=s.getSphere(),o=1/0,a=-1/0,{x:l,y:c,z:p}=r.center,u=r.radius===o||l===o||c===o||p===o,m=r.radius===a||l===a||c===a||p===a,E=r.radius===0;u||m||E||(r.radius*=this.zoomFactor,await t.camera.controls.fitToSphere(r,!0))}setupEvents(e){if(!this.config.world){console.log("No world found while setting up events!");return}if(this.config.world.isDisposing)return;if(!this.config.world.renderer)throw new Error("The given world doesn't have a renderer!");const t=this.config.world.renderer.three.domElement,s=this.events[this.config.selectName].onHighlight;s.remove(this.clearHover),s.remove(this.saveHighlightersBeforeSelect);const i=this.events[this.config.selectName].onClear;i.remove(this.restoreHighlightersAfterDeselect),t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("mouseup",this.onMouseUp),t.removeEventListener("pointermove",this.onMouseMove),e&&(s.add(this.clearHover),s.add(this.saveHighlightersBeforeSelect),i.add(this.restoreHighlightersAfterDeselect),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("mouseup",this.onMouseUp),t.addEventListener("pointermove",this.onMouseMove))}};S(hE,"uuid","cb8a76f2-654a-4b50-80c6-66fd83cafd77");let Ey=hE;class yT extends De{constructor(){super(...arguments),S(this,"onDisposed",new te),S(this,"world")}get enabled(){return this.world?this.getRenderer().postproduction.customEffects.outlineEnabled:!1}set enabled(e){if(!this.world)throw new Error("Before enabling the outliner, provide a world!");const t=this.getRenderer();t.postproduction.customEffects.outlineEnabled=e}create(e,t){const s=this.getRenderer();if(s.postproduction.customEffects.outlinedMeshes[e]!==void 0)throw new Error(`There's already a style with the name ${e}.`);s.postproduction.customEffects.outlinedMeshes[e]={material:t,meshes:new Set}}add(e,t){const s=this.getRenderer(),i=this.getStyles()[e];if(!i)throw new Error(`The style ${e} does not exist`);const n=s.postproduction.customEffects.outlineScene,r=this.components.get(Qe);for(const o in t){const a=r.list.get(o);if(!a)continue;const l=t[o],c=a.clone(l);c.mesh.instanceColor=null,c.mesh.material=[i.material],i.meshes.add(c.mesh),n.add(c.mesh)}}clear(e){if(e){this.clearStyle(e,!1);return}const t=this.getStyles(),s=Object.keys(t);for(const i of s)this.clearStyle(i,!1);this.world=void 0}dispose(){const e=this.getStyles(),t=Object.keys(e);for(const s of t)this.clearStyle(s,!0);this.onDisposed.trigger(),this.onDisposed.reset()}clearStyle(e,t){const s=this.getStyles(),i=s[e];if(!i)return;const n=this.components.get(Ks);for(const r of i.meshes){const o=r;o.fragment&&o.fragment.dispose(!1),n.destroy(r)}i.meshes.clear(),t&&(i.material.dispose(),delete s[e])}getStyles(){return this.getRenderer().postproduction.customEffects.outlinedMeshes}getRenderer(){if(!this.world)throw new Error("You must set a world to use the outliner!");const e=this.world.renderer;if(!e.postproduction)throw new Error("The world given to the outliner must use the postproduction renderer.");return e}}S(yT,"uuid","2fd3bcc5-b3b6-4ded-9f64-f47a02854a10");class ai extends De{constructor(){super(...arguments),S(this,"enabled",!1),S(this,"onDisposed",new te),S(this,"onNavigated",new te),S(this,"onExited",new te),S(this,"planeType","section"),S(this,"offset",100),S(this,"list",new Map),S(this,"world"),S(this,"current",null),S(this,"cached3DCamera",{position:new O,target:new O,projection:"Perspective",zoom:1,top:10,bottom:-10,right:10,left:-10})}create(e){const t=this.getWorld(),{id:s,point:i,normal:n,type:r}=e;let{name:o,offset:a}=e;const l=this.components.get(uo),c=l.Type;l.Type=al;const p=l.createFromNormalAndCoplanarPoint(t,n,i);p.visible=!1,p.edges.visible=!1,p.enabled=!1,o=o||s,a=a||this.offset,p.type=r||this.planeType,p.updateFill();const u=n.clone().multiplyScalar(-a).add(i),m=i.clone(),E={id:s,name:o,plane:p,offset:a,cached:{position:u,target:m,zoom:1,size:10}};return this.list.set(s,E),l.Type=c,E}delete(e){const t=this.list.get(e);t&&(t.plane.dispose(),this.list.delete(e))}async goTo(e,t=!1){var s;const i=this.getCamera();if(((s=this.current)==null?void 0:s.id)===e)return;const n=this.list.get(e);if(!n)throw new Error(`There's no section with the ID: ${e}.`);this.cacheCameraPosition(),await this.hidePreviousClippingPlane(),await i.projection.set("Orthographic"),this.current=n;const r=new O,o=new O,{cached:a}=n,{position:l,target:c}=a;r.copy(c),o.copy(l),await i.controls.setLookAt(o.x,o.y,o.z,r.x,r.y,r.z,t);const p=n.cached.size,u=i.threePersp.aspect;i.threeOrtho.top=p,i.threeOrtho.bottom=-p,i.threeOrtho.left=-p*u,i.threeOrtho.right=p*u,i.threeOrtho.updateProjectionMatrix(),await i.controls.zoomTo(a.zoom,!1),i.set("Plan"),this.current.plane&&(this.current.plane.enabled=!0,this.current.plane.edges.fillNeedsUpdate=!0,this.current.plane.edges.visible=!0),this.enabled=!0,this.onNavigated.trigger({id:e})}async exit(e=!1){if(!this.enabled||!this.world)return;this.cacheCameraPosition();const t=this.getCamera();t.set("Orbit");const{position:s,target:i,projection:n}=this.cached3DCamera;await t.projection.set(n),this.current&&(this.current.plane.enabled=!1,this.current.plane.edges.enabled=!1,this.current.plane.edges.visible=!1),this.current=null;const{x:r,y:o,z:a}=s,{x:l,y:c,z:p}=i;await t.controls.setLookAt(r,o,a,l,c,p,e),t.projection.current==="Orthographic"&&(await t.controls.zoomTo(this.cached3DCamera.zoom,!1),t.threeOrtho.left=this.cached3DCamera.left,t.threeOrtho.right=this.cached3DCamera.right,t.threeOrtho.top=this.cached3DCamera.top,t.threeOrtho.bottom=this.cached3DCamera.bottom),this.enabled=!1,this.onExited.trigger()}setVisibility(){}dispose(){for(const[,{plane:e}]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}getWorld(){if(!this.world)throw new Error("World is needed to create sections!");return this.world}getCamera(){const e=this.getWorld().camera;if(!e.hasCameraControls()||!e.projection)throw new Error("The world given to sections must have an OrthoPerspective camera.");return e}cacheCameraPosition(){if(!this.world)throw new Error("World is needed to create clipping planes!");const e=this.getCamera();if(this.enabled){if(!this.current)throw new Error("Current section not found!");const{cached:t}=this.current,{position:s,target:i}=t;e.controls.getPosition(s),e.controls.getTarget(i),t.zoom=e.threeOrtho.zoom,t.size=e.threeOrtho.top}else{e.three.getWorldPosition(this.cached3DCamera.position),e.controls.getTarget(this.cached3DCamera.target),this.cached3DCamera.projection=e.projection.current,this.cached3DCamera.zoom=e.threeOrtho.zoom;const{top:t,bottom:s,left:i,right:n}=e.threeOrtho;this.cached3DCamera.top=t,this.cached3DCamera.bottom=s,this.cached3DCamera.left=i,this.cached3DCamera.right=n}}async hidePreviousClippingPlane(){if(this.current){const e=this.current.plane;e&&(e.enabled=!1),this.current.plane.edges.visible=!1}}}S(ai,"uuid","45b41ba3-7bb8-4e08-909f-e0fa87973965");const cE=class dE extends De{constructor(e){super(e),S(this,"onDisposed",new te),S(this,"planeType","floorplan"),S(this,"onNavigated",new te),S(this,"onExited",new te),S(this,"enabled",!1),S(this,"currentPlan",null),S(this,"offset",1.5),S(this,"list",[]),S(this,"_cachedPlanCamera",null),this.components.add(dE.uuid,this)}get world(){return this.components.get(ai).world}set world(e){const t=this.components.get(ai);t.world=e}get defaultCameraOffset(){return this.components.get(ai).offset}set defaultCameraOffset(e){const t=this.components.get(ai);t.offset=e}dispose(){this.onExited.reset(),this.onNavigated.reset();const e=this.components.get(ai);for(const t of this.list)e.delete(t.id);this.list=[],this.onDisposed.trigger(),this.onDisposed.reset()}async generate(e){if(!e.hasProperties)throw new Error("Properties are needed to compute plan views!");const t=await e.getAllPropertiesOfType(cn);if(!t)throw new Error("Floorplans not found!");const s=e.coordinationMatrix.elements[13],i=await Mi.getUnits(e);for(const n of Object.values(t)){const r={value:0};this.getAbsoluteFloorHeight(n.ObjectPlacement,r);const o=r.value*i+s+this.offset;this.create({name:n.Name.value,id:n.GlobalId.value,normal:new O(0,-1,0),point:new O(0,o,0)})}}create(e){const t=this.components.get(ai);e.type=e.type||this.planeType;const s={...t.create(e),planOffset:this.offset};this.list.push(s)}async goTo(e,t=!1){this.enabled&&this.cachePlanCamera(),await this.components.get(ai).goTo(e,t),await this.applyCachedPlanCamera(),this.enabled=!0}async exitPlanView(e=!1){this.enabled&&(this.cachePlanCamera(),await this.components.get(ai).exit(e),this.enabled=!1,this.onExited.trigger())}cachePlanCamera(){var e;const t=(e=this.world)==null?void 0:e.camera,s=new O,i=new O;t.controls.getTarget(s),t.controls.getPosition(i),this._cachedPlanCamera={target:s,position:i,zoom:t.threeOrtho.zoom,top:t.threeOrtho.top,right:t.threeOrtho.right,bottom:t.threeOrtho.bottom,left:t.threeOrtho.left}}async applyCachedPlanCamera(){var e;if(!this._cachedPlanCamera)return;const t=(e=this.world)==null?void 0:e.camera,{position:s,target:i}=this._cachedPlanCamera,n=new O,r=new O;t.controls.getPosition(n),t.controls.getTarget(r);const o=n.y,a=r.y;await t.controls.setLookAt(s.x,o,s.z,i.x,a,i.z),await t.controls.zoomTo(this._cachedPlanCamera.zoom),t.threeOrtho.top=this._cachedPlanCamera.top,t.threeOrtho.bottom=this._cachedPlanCamera.bottom,t.threeOrtho.left=this._cachedPlanCamera.left,t.threeOrtho.right=this._cachedPlanCamera.right,t.threeOrtho.updateProjectionMatrix()}getAbsoluteFloorHeight(e,t){const s=e.RelativePlacement.Location.Coordinates;t.value+=s[2].value,e.PlacementRelTo&&this.getAbsoluteFloorHeight(e.PlacementRelTo,t)}};S(cE,"uuid","a80874aa-1c93-43a4-80f2-df346da086b1");let gy=cE;export{gy as A,bg as C,Ga as E,Ey as F,fc as H,ay as I,al as M,UT as O,my as R,Bc as S,uy as T,yT as U,Rf as V,Su as W,sy as _,dy as a,py as b,Dg as c,rI as d,zT as e,WT as f,ry as g,ls as h,oy as i,Rl as j,eo as k,qT as l,nI as m,Fg as n,ty as o,Rg as p,Ji as r,ai as s,HT as u,ly as v,cy as w,fy as x,hy as y,RC as z};
