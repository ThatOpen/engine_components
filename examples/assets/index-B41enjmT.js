var A=Object.defineProperty;var B=(f,a,e)=>a in f?A(f,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):f[a]=e;var u=(f,a,e)=>(B(f,typeof a!="symbol"?a+"":a,e),e);import{c as F,F as D,E as j}from"./graphic-vertex-picker-CqNhsDsK.js";import{Y as y,c as E,m as G,M as Y}from"./index-lvtjgYNN.js";const M=class M extends F{constructor(){super(...arguments);u(this,"enabled",!0);u(this,"geometries",new y);u(this,"onDisposed",new j)}async get(e,t){const{material:s,coordinate:n,applyTransformation:r}={coordinate:!0,applyTransformation:!0,...t},o=this.components.get(D),m=new y;for(const[i,w]of Object.entries(e)){const h=o.list.get(i);if(!h)continue;const I=this.getModelMeshes(i);for(const l of w){let d=m.get(i);d||(d=new y,m.set(i,d));let c=I.get(l);if(c&&c.length>0){const g=[];for(const[p,{geometry:b}]of c.entries()){const x=await this.createMesh(h,b,{material:s,applyTransformation:r,coordinate:n});g.push(x)}d.set(l,g);continue}else c=[],I.set(l,c);const[v]=await h.getItemsGeometry([l]);if(!v)continue;const C=[];for(const g of v){const p=this.createGeometry(g);if(!p)continue;const{geometry:b}=p;c.push(p);const x=await this.createMesh(h,b,{material:s,applyTransformation:r,coordinate:n});C.push(x)}d.set(l,C)}}return m}getModelMeshes(e){let t=this.geometries.get(e);return t||(t=new y,this.geometries.set(e,t)),t}remove(e=[...this.geometries.keys()]){for(const t of e){const s=this.geometries.get(t);if(s){for(const[n,r]of s)for(const{geometry:o}of r)o.dispose();this.geometries.delete(t)}}}dispose(e=!0){this.remove(),e&&this.geometries.dispose(),this.onDisposed.trigger(M.uuid)}getMeshesFromResult(e){const t=[];for(const s of e.values())for(const n of s.values())t.push(...n);return t}createGeometry(e){const{positions:t,indices:s,normals:n,transform:r}=e;if(!(t&&s&&n))return null;const o=new E;return o.setAttribute("position",new G(t,3)),o.setAttribute("normal",new G(n,3,!0)),o.setIndex(new G(s,1)),o.applyMatrix4(r),{geometry:o,transform:r}}async createMesh(e,t,s){const{material:n,applyTransformation:r,coordinate:o}={applyTransformation:!0,coordinate:!0,...s},m=this.components.get(D),i=new Y(t,n);if(i.applyMatrix4(e.object.matrixWorld),r||i.position.set(0,0,0),o&&m.baseCoordinationModel!==e.modelId){const w=await e.getCoordinationMatrix();m.applyBaseCoordinateSystem(i,w)}return i}};u(M,"uuid","ab45d0a7-feea-4afc-927c-80832dae76dd");let T=M;export{T as M};
