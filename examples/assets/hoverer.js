var R=Object.defineProperty;var D=(o,r,e)=>r in o?R(o,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[r]=e;var s=(o,r,e)=>(D(o,typeof r!="symbol"?r+"":r,e),e);import{W as S,k as I,d as x,F as A,U as B,M as Y,T as k,L as M,m as L,a as F,C as H}from"./index-BR15nMAM.js";import{b as U,R as C,E as V,C as W,W as K,S as G,O as $,F as j}from"./graphic-vertex-picker-WQ6fDD2d.js";import{P as q}from"./index-BYTOCRNk.js";const p=class p extends U{constructor(e){super(e);s(this,"HOVERER_OPACITY_KEY","_maxHoverOpacity");s(this,"_hoverTimeout",null);s(this,"_meshes",new S);s(this,"_localId",null);s(this,"_fadeAnimation",null);s(this,"_world",null);s(this,"_enabled",!1);s(this,"_material",new I({color:16777215,transparent:!0,opacity:.5,depthTest:!1,userData:{[this.HOVERER_OPACITY_KEY]:.5}}));s(this,"onDisposed",new V);s(this,"duration",200);s(this,"animation",!0);s(this,"mouseStopTimeout",null);s(this,"onMouseMove",()=>{this.mouseStopTimeout!==null&&clearTimeout(this.mouseStopTimeout),this.mouseStopTimeout=window.setTimeout(()=>this.hover(),50)});s(this,"onMouseLeave",()=>{this._meshes.clear()});s(this,"animate",()=>{if(!(this._fadeAnimation&&this.animation&&this.material.transparent))return;const{startTime:e,duration:t,fadeIn:a}=this._fadeAnimation,_=Date.now()-e,i=Math.min(_/t,1),v=a?i:1-i,u=this.material.userData[this.HOVERER_OPACITY_KEY],w=v*(u!==void 0?u:1);this.material.opacity=w,i<1?requestAnimationFrame(this.animate):(a||this._meshes.clear(),this._fadeAnimation=null)});e.add(p.uuid,this),this._meshes.onBeforeDelete.add(t=>{t.removeFromParent(),t.geometry.dispose()}),this._meshes.onItemAdded.add(t=>{this.world&&this.world.scene.three.add(t)}),this._meshes.onCleared.add(()=>{this._localId=null,this._hoverTimeout&&(clearTimeout(this._hoverTimeout),this._hoverTimeout=null)})}set world(e){if(e){this.components.get(C).get(e),this._world=e,this.setupEvents(!0);for(const t of this._meshes)e.scene.three.add(t)}else{this.setupEvents(!1),this._world=null;for(const t of this._meshes)t.removeFromParent()}}get world(){return this._world}set enabled(e){this.setupEvents(e),this._enabled=e}get enabled(){return this._enabled}set material(e){e.userData[this.HOVERER_OPACITY_KEY]=e.opacity;for(const t of this._meshes)t.material=e;this._material.dispose(),this._material=e}get material(){return this._material}setupEvents(e){if(!this.world||this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The given world doesn't have a renderer!");const t=this.world.renderer.three.domElement;t.removeEventListener("mousemove",this.onMouseMove),t.removeEventListener("mouseleave",this.onMouseMove),e&&(t.addEventListener("mousemove",this.onMouseMove),t.addEventListener("mouseleave",this.onMouseLeave))}async hover(){if(!this.enabled||!this.world)return;const a=await this.components.get(C).get(this.world).castRay();if(!a){this._meshes.clear();return}const{fragments:_,localId:i}=a;this._localId!==i&&(this._meshes.clear(),this._localId=i,this._hoverTimeout=window.setTimeout(async()=>{const u=await _.getItem(i).getGeometry();if(!u)return;const w=await u.get();for(const b of w){const{positions:E,normals:T,indices:y,transform:O}=b;if(!(E&&T&&y&&O))continue;const c=new x;c.setAttribute("position",new A(E,3)),c.setAttribute("normal",new A(T,3)),c.setIndex(new B(y,1)),b.transform&&c.applyMatrix4(b.transform),c.computeVertexNormals();const P=new Y(c,this.material);this._meshes.add(P)}this._fadeAnimation={startTime:Date.now(),duration:this.duration,fadeIn:!0},this.animate()},100))}clear(){this._meshes.clear()}dispose(){this._enabled=!1,this._meshes.clear(),this._fadeAnimation=null,this._hoverTimeout=null,this.onDisposed.trigger()}};s(p,"uuid","26fbd870-b1b2-4b71-b747-4063d484de1b");let g=p;const d=new W,z=d.get(K),n=z.create();n.scene=new G(d);n.scene.setup();n.scene.three.background=null;const N=document.getElementById("container");n.renderer=new q(d,N);n.camera=new $(d);await n.camera.controls.setLookAt(68,23,-8.5,21.5,-5.5,23);d.init();const J="/node_modules/@thatopen/fragments/dist/Worker/worker.mjs",m=d.get(j);m.init(J);n.camera.controls.addEventListener("rest",()=>m.core.update(!0));n.onCameraChanged.add(o=>{for(const[,r]of m.list)r.useCamera(o.three);m.core.update(!0)});m.list.onItemSet.add(({value:o})=>{o.useCamera(n.camera.three),n.scene.three.add(o.object),m.core.update(!0)});const Q=["/resources/frags/school_arq.frag"];await Promise.all(Q.map(async o=>{var a;const r=(a=o.split("/").pop())==null?void 0:a.split(".").shift();if(!r)return null;const t=await(await fetch(o)).arrayBuffer();return m.core.load(t,{modelId:r})}));const l=d.get(g);l.world=n;l.enabled=!0;l.material=new I({color:6629591,transparent:!0,opacity:.5,depthTest:!1});k.init();const f=M.create(()=>{const o=({target:r})=>{"color"in l.material&&l.material.color instanceof H&&l.material.color.set(r.color)};return L`
    <bim-panel active label="Hoverer Tutorial" class="options-menu">
      <bim-panel-section label="Controls">
        <bim-color-input color="#${l.material.color.getHexString()}" label="Color" @input=${o}></bim-color-input>
      </bim-panel-section>
    </bim-panel>
  `});document.body.append(f);const X=M.create(()=>L`
      <bim-button class="phone-menu-toggler" icon="solar:settings-bold"
        @click="${()=>{f.classList.contains("options-menu-visible")?f.classList.remove("options-menu-visible"):f.classList.add("options-menu-visible")}}">
      </bim-button>
    `);document.body.append(X);const h=new F;h.showPanel(2);document.body.append(h.dom);h.dom.style.left="0px";h.dom.style.zIndex="unset";n.renderer.onBeforeUpdate.add(()=>h.begin());n.renderer.onAfterUpdate.add(()=>h.end());
