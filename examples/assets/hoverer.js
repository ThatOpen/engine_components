var P=Object.defineProperty;var x=(o,r,e)=>r in o?P(o,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[r]=e;var s=(o,r,e)=>(x(o,typeof r!="symbol"?r+"":r,e),e);import{W as D,j as I,c as S,F as A,U as B,M as F,a as U,C as k}from"./index-D7EC26VF.js";import{b as Y,R as C,E as j,C as H,W as V,S as K,O as W,F as G}from"./graphic-vertex-picker-C_xseSgk.js";import{a as $,R as M,m as R}from"./index-bERBRksd.js";import{P as q}from"./index-WsJUHyIb.js";const f=class f extends Y{constructor(e){super(e);s(this,"HOVERER_OPACITY_KEY","_maxHoverOpacity");s(this,"_hoverTimeout",null);s(this,"_meshes",new D);s(this,"_localId",null);s(this,"_fadeAnimation",null);s(this,"_world",null);s(this,"_enabled",!1);s(this,"_material",new I({color:16777215,transparent:!0,opacity:.5,depthTest:!1,userData:{[this.HOVERER_OPACITY_KEY]:.5}}));s(this,"onDisposed",new j);s(this,"duration",200);s(this,"animation",!0);s(this,"mouseStopTimeout",null);s(this,"onMouseMove",()=>{this.mouseStopTimeout!==null&&clearTimeout(this.mouseStopTimeout),this.mouseStopTimeout=window.setTimeout(()=>this.hover(),50)});s(this,"onMouseLeave",()=>{this._meshes.clear()});s(this,"animate",()=>{if(!(this._fadeAnimation&&this.animation&&this.material.transparent))return;const{startTime:e,duration:t,fadeIn:a}=this._fadeAnimation,w=Date.now()-e,i=Math.min(w/t,1),v=a?i:1-i,u=this.material.userData[this.HOVERER_OPACITY_KEY],b=v*(u!==void 0?u:1);this.material.opacity=b,i<1?requestAnimationFrame(this.animate):(a||this._meshes.clear(),this._fadeAnimation=null)});e.add(f.uuid,this),this._meshes.onBeforeDelete.add(t=>{t.removeFromParent(),t.geometry.dispose()}),this._meshes.onItemAdded.add(t=>{this.world&&this.world.scene.three.add(t)}),this._meshes.onCleared.add(()=>{this._localId=null,this._hoverTimeout&&(clearTimeout(this._hoverTimeout),this._hoverTimeout=null)})}set world(e){if(e){this.components.get(C).get(e),this._world=e,this.setupEvents(!0);for(const t of this._meshes)e.scene.three.add(t)}else{this.setupEvents(!1),this._world=null;for(const t of this._meshes)t.removeFromParent()}}get world(){return this._world}set enabled(e){this.setupEvents(e),this._enabled=e}get enabled(){return this._enabled}set material(e){e.userData[this.HOVERER_OPACITY_KEY]=e.opacity;for(const t of this._meshes)t.material=e;this._material.dispose(),this._material=e}get material(){return this._material}setupEvents(e){if(!this.world||this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The given world doesn't have a renderer!");const t=this.world.renderer.three.domElement;t.removeEventListener("mousemove",this.onMouseMove),t.removeEventListener("mouseleave",this.onMouseMove),e&&(t.addEventListener("mousemove",this.onMouseMove),t.addEventListener("mouseleave",this.onMouseLeave))}async hover(){if(!this.enabled||!this.world)return;const a=await this.components.get(C).get(this.world).castRay();if(!a){this._meshes.clear();return}const{fragments:w,localId:i}=a;this._localId!==i&&(this._meshes.clear(),this._localId=i,this._hoverTimeout=window.setTimeout(async()=>{const u=await w.getItem(i).getGeometry();if(!u)return;const b=await u.get();for(const _ of b){const{positions:y,normals:E,indices:T,transform:L}=_;if(!(y&&E&&T&&L))continue;const d=new S;d.setAttribute("position",new A(y,3)),d.setAttribute("normal",new A(E,3)),d.setIndex(new B(T,1)),_.transform&&d.applyMatrix4(_.transform),d.computeVertexNormals();const O=new F(d,this.material);this._meshes.add(O)}this._fadeAnimation={startTime:Date.now(),duration:this.duration,fadeIn:!0},this.animate()},100))}clear(){this._meshes.clear()}dispose(){this._enabled=!1,this._meshes.clear(),this._fadeAnimation=null,this._hoverTimeout=null,this.onDisposed.trigger()}};s(f,"uuid","26fbd870-b1b2-4b71-b747-4063d484de1b");let g=f;const c=new H,z=c.get(V),n=z.create();n.scene=new K(c);n.scene.setup();n.scene.three.background=null;const N=document.getElementById("container");n.renderer=new q(c,N);n.camera=new W(c);await n.camera.controls.setLookAt(68,23,-8.5,21.5,-5.5,23);c.init();const J="https://thatopen.github.io/engine_fragment/resources/worker.mjs",Q=await fetch(J),X=await Q.blob(),Z=new File([X],"worker.mjs",{type:"text/javascript"}),ee=URL.createObjectURL(Z),m=c.get(G);m.init(ee);n.camera.controls.addEventListener("rest",()=>m.core.update(!0));n.onCameraChanged.add(o=>{for(const[,r]of m.list)r.useCamera(o.three);m.core.update(!0)});m.list.onItemSet.add(({value:o})=>{o.useCamera(n.camera.three),n.scene.three.add(o.object),m.core.update(!0)});const te=["https://thatopen.github.io/engine_components/resources/frags/school_arq.frag"];await Promise.all(te.map(async o=>{var a;const r=(a=o.split("/").pop())==null?void 0:a.split(".").shift();if(!r)return null;const t=await(await fetch(o)).arrayBuffer();return m.core.load(t,{modelId:r})}));const l=c.get(g);l.world=n;l.enabled=!0;l.material=new I({color:6629591,transparent:!0,opacity:.5,depthTest:!1});$.init();const p=M.create(()=>{const o=({target:r})=>{"color"in l.material&&l.material.color instanceof k&&l.material.color.set(r.color)};return R`
    <bim-panel active label="Hoverer Tutorial" class="options-menu">
      <bim-panel-section label="Controls">
        <bim-color-input color="#${l.material.color.getHexString()}" label="Color" @input=${o}></bim-color-input>
      </bim-panel-section>
    </bim-panel>
  `});document.body.append(p);const se=M.create(()=>R`
      <bim-button class="phone-menu-toggler" icon="solar:settings-bold"
        @click="${()=>{p.classList.contains("options-menu-visible")?p.classList.remove("options-menu-visible"):p.classList.add("options-menu-visible")}}">
      </bim-button>
    `);document.body.append(se);const h=new U;h.showPanel(2);document.body.append(h.dom);h.dom.style.left="0px";h.dom.style.zIndex="unset";n.renderer.onBeforeUpdate.add(()=>h.begin());n.renderer.onAfterUpdate.add(()=>h.end());
