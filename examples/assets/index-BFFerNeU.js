var w=Object.defineProperty;var E=(r,i,e)=>i in r?w(r,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[i]=e;var t=(r,i,e)=>(E(r,typeof i!="symbol"?i+"":i,e),e);import{c as T,E as u,R as _}from"./graphic-vertex-picker-BY8Y4wOR.js";import{W as g,n as M}from"./index-D_lOu8Cy.js";import{M as I}from"./index-CenXdrKi.js";const a=class a extends T{constructor(e){super(e);t(this,"onHoverStarted",new u);t(this,"onHoverEnded",new u);t(this,"HOVERER_OPACITY_KEY","_maxHoverOpacity");t(this,"_hoverTimeout",null);t(this,"_meshes",new g);t(this,"_localId",null);t(this,"_fadeAnimation",null);t(this,"_world",null);t(this,"_enabled",!1);t(this,"_material",new M({color:16777215,transparent:!0,opacity:.5,depthTest:!1,userData:{[this.HOVERER_OPACITY_KEY]:.5}}));t(this,"onDisposed",new u);t(this,"duration",200);t(this,"animation",!0);t(this,"mouseStopTimeout",null);t(this,"onMouseMove",()=>{this.mouseStopTimeout!==null&&clearTimeout(this.mouseStopTimeout),this.mouseStopTimeout=window.setTimeout(()=>this.hover(),50)});t(this,"onMouseLeave",()=>{this._meshes.clear()});t(this,"animate",()=>{if(!(this._fadeAnimation&&this.animation&&this.material.transparent))return;const{startTime:e,duration:s,fadeIn:n}=this._fadeAnimation,h=Date.now()-e,o=Math.min(h/s,1),m=n?o:1-o,d=this.material.userData[this.HOVERER_OPACITY_KEY],l=m*(d!==void 0?d:1);this.material.opacity=l,o<1?requestAnimationFrame(this.animate):(n||this._meshes.clear(),this._fadeAnimation=null,this.onHoverEnded.trigger(this))});e.add(a.uuid,this),this._meshes.onBeforeDelete.add(s=>{s.removeFromParent(),s.geometry.dispose()}),this._meshes.onItemAdded.add(s=>{this.world&&this.world.scene.three.add(s)}),this._meshes.onCleared.add(()=>{this._localId=null,this._hoverTimeout&&(clearTimeout(this._hoverTimeout),this._hoverTimeout=null)})}set world(e){if(e){this.components.get(_).get(e),this._world=e,this.setupEvents(!0);for(const s of this._meshes)e.scene.three.add(s)}else{this.setupEvents(!1),this._world=null;for(const s of this._meshes)s.removeFromParent()}}get world(){return this._world}set enabled(e){this.setupEvents(e),this._enabled=e}get enabled(){return this._enabled}set material(e){e.userData[this.HOVERER_OPACITY_KEY]=e.opacity;for(const s of this._meshes)s.material=e;this._material.dispose(),this._material=e}get material(){return this._material}setupEvents(e){if(!this.world||this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The given world doesn't have a renderer!");const s=this.world.renderer.three.domElement;s.removeEventListener("mousemove",this.onMouseMove),s.removeEventListener("mouseleave",this.onMouseMove),e&&(s.addEventListener("mousemove",this.onMouseMove),s.addEventListener("mouseleave",this.onMouseLeave))}async hover(){if(!this.enabled||!this.world)return;const n=await this.components.get(_).get(this.world).castRay();if(!n){this._meshes.clear();return}const{fragments:h,localId:o}=n;this._localId!==o&&(this._meshes.clear(),this._localId=o,this._hoverTimeout=window.setTimeout(async()=>{const m={[h.modelId]:new Set([o])},l=await this.components.get(I).get(m);for(const[b,p]of l.entries()){const v=[...p.values()].flat();for(const c of v)c.material=this.material,this._meshes.add(c)}this._fadeAnimation={startTime:Date.now(),duration:this.duration,fadeIn:!0},this.onHoverStarted.trigger(this),this.animate()},100))}clear(){this._meshes.clear()}dispose(){this._enabled=!1,this._meshes.clear(),this._fadeAnimation=null,this._hoverTimeout=null,this.onHoverStarted.reset(),this.onHoverEnded.reset(),this.onDisposed.trigger()}};t(a,"uuid","26fbd870-b1b2-4b71-b747-4063d484de1b");let f=a;export{f as H};
