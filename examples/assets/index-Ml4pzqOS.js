var w=Object.defineProperty;var v=(a,i,e)=>i in a?w(a,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[i]=e;var s=(a,i,e)=>(v(a,typeof i!="symbol"?i+"":i,e),e);import{c as E,R as c,E as T}from"./graphic-vertex-picker-DIM7gQA5.js";import{W as g,l as M}from"./index-BVinSk0X.js";import{M as I}from"./index-uVKS97J8.js";const n=class n extends E{constructor(e){super(e);s(this,"HOVERER_OPACITY_KEY","_maxHoverOpacity");s(this,"_hoverTimeout",null);s(this,"_meshes",new g);s(this,"_localId",null);s(this,"_fadeAnimation",null);s(this,"_world",null);s(this,"_enabled",!1);s(this,"_material",new M({color:16777215,transparent:!0,opacity:.5,depthTest:!1,userData:{[this.HOVERER_OPACITY_KEY]:.5}}));s(this,"onDisposed",new T);s(this,"duration",200);s(this,"animation",!0);s(this,"mouseStopTimeout",null);s(this,"onMouseMove",()=>{this.mouseStopTimeout!==null&&clearTimeout(this.mouseStopTimeout),this.mouseStopTimeout=window.setTimeout(()=>this.hover(),50)});s(this,"onMouseLeave",()=>{this._meshes.clear()});s(this,"animate",()=>{if(!(this._fadeAnimation&&this.animation&&this.material.transparent))return;const{startTime:e,duration:t,fadeIn:r}=this._fadeAnimation,h=Date.now()-e,o=Math.min(h/t,1),m=r?o:1-o,l=this.material.userData[this.HOVERER_OPACITY_KEY],d=m*(l!==void 0?l:1);this.material.opacity=d,o<1?requestAnimationFrame(this.animate):(r||this._meshes.clear(),this._fadeAnimation=null)});e.add(n.uuid,this),this._meshes.onBeforeDelete.add(t=>{t.removeFromParent(),t.geometry.dispose()}),this._meshes.onItemAdded.add(t=>{this.world&&this.world.scene.three.add(t)}),this._meshes.onCleared.add(()=>{this._localId=null,this._hoverTimeout&&(clearTimeout(this._hoverTimeout),this._hoverTimeout=null)})}set world(e){if(e){this.components.get(c).get(e),this._world=e,this.setupEvents(!0);for(const t of this._meshes)e.scene.three.add(t)}else{this.setupEvents(!1),this._world=null;for(const t of this._meshes)t.removeFromParent()}}get world(){return this._world}set enabled(e){this.setupEvents(e),this._enabled=e}get enabled(){return this._enabled}set material(e){e.userData[this.HOVERER_OPACITY_KEY]=e.opacity;for(const t of this._meshes)t.material=e;this._material.dispose(),this._material=e}get material(){return this._material}setupEvents(e){if(!this.world||this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The given world doesn't have a renderer!");const t=this.world.renderer.three.domElement;t.removeEventListener("mousemove",this.onMouseMove),t.removeEventListener("mouseleave",this.onMouseMove),e&&(t.addEventListener("mousemove",this.onMouseMove),t.addEventListener("mouseleave",this.onMouseLeave))}async hover(){if(!this.enabled||!this.world)return;const r=await this.components.get(c).get(this.world).castRay();if(!r){this._meshes.clear();return}const{fragments:h,localId:o}=r;this._localId!==o&&(this._meshes.clear(),this._localId=o,this._hoverTimeout=window.setTimeout(async()=>{const m={[h.modelId]:new Set([o])},d=await this.components.get(I).get(m);for(const[b,f]of d.entries()){const p=[...f.values()].flat();for(const u of p)u.material=this.material,this._meshes.add(u)}this._fadeAnimation={startTime:Date.now(),duration:this.duration,fadeIn:!0},this.animate()},100))}clear(){this._meshes.clear()}dispose(){this._enabled=!1,this._meshes.clear(),this._fadeAnimation=null,this._hoverTimeout=null,this.onDisposed.trigger()}};s(n,"uuid","26fbd870-b1b2-4b71-b747-4063d484de1b");let _=n;export{_ as H};
