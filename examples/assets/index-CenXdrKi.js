var A=Object.defineProperty;var F=(c,i,e)=>i in c?A(c,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[i]=e;var h=(c,i,e)=>(F(c,typeof i!="symbol"?i+"":i,e),e);import{c as j,F as B,E}from"./graphic-vertex-picker-BY8Y4wOR.js";import{Y as p,f as Y,q as x,d as k}from"./index-D_lOu8Cy.js";const y=class y extends j{constructor(){super(...arguments);h(this,"enabled",!0);h(this,"geometries",new p);h(this,"onDisposed",new E)}async get(e,t){const{material:s,applyTransformation:r}={applyTransformation:!0,...t},a=this.components.get(B),o=new p;for(const[n,T]of Object.entries(e)){const u=a.list.get(n);if(!u)continue;const G=this.getModelMeshes(n);for(const f of T){let l=o.get(n);l||(l=new p,o.set(n,l));let m=G.get(f);if(m&&m.length>0){const g=[];for(const[d,{geometry:M,transform:w}]of m.entries()){const b=await this.createMesh(u,M,w,{material:s,applyTransformation:r});g.push(b)}l.set(f,g);continue}else m=[],G.set(f,m);const[v]=await u.getItemsGeometry([f]);if(!v)continue;const I=[];for(const g of v){const d=this.createGeometry(g);if(!d)continue;const{geometry:M,transform:w}=d;m.push(d);const b=await this.createMesh(u,M,w,{material:s,applyTransformation:r});I.push(b)}l.set(f,I)}}return o}getModelMeshes(e){let t=this.geometries.get(e);return t||(t=new p,this.geometries.set(e,t)),t}remove(e=[...this.geometries.keys()]){for(const t of e){const s=this.geometries.get(t);if(s){for(const[r,a]of s)for(const{geometry:o}of a)o.dispose();this.geometries.delete(t)}}}dispose(e=!0){this.remove(),e&&this.geometries.dispose(),this.onDisposed.trigger(y.uuid)}getMeshesFromResult(e){const t=[];for(const s of e.values())for(const r of s.values())t.push(...r);return t}createGeometry(e){const{positions:t,indices:s,normals:r,transform:a}=e;if(!(t&&s&&r))return null;const o=new Y;return o.setAttribute("position",new x(t,3)),o.setAttribute("normal",new x(r,3,!0)),o.setIndex(new x(s,1)),{geometry:o,transform:a}}async createMesh(e,t,s,r){const{material:a,applyTransformation:o}={applyTransformation:!0,...r},n=new k(t,a);return n.applyMatrix4(s),n.applyMatrix4(e.object.matrixWorld),o||(n.position.set(0,0,0),n.rotation.set(0,0,0)),n}};h(y,"uuid","ab45d0a7-feea-4afc-927c-80832dae76dd");let D=y;export{D as M};
