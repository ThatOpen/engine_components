var v=Object.defineProperty;var C=(t,s,e)=>s in t?v(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var o=(t,s,e)=>(C(t,typeof s!="symbol"?s+"":s,e),e);import{aq as F,al as I,am as O,u as D,V as L,f as b,a as W}from"./index-b0R13blq.js";import{d as z,E as p,F as S,C as k,W as E,S as U,a as j,O as B}from"./index-CEn02O1f.js";import{G as P}from"./index-CY-zRXoh.js";class R{constructor(){o(this,"wasm",{path:"",absolute:!1,logLevel:F.LOG_LEVEL_OFF});o(this,"webIfc",{COORDINATE_TO_ORIGIN:!0});o(this,"autoSetWasm",!0);o(this,"customLocateFileHandler",null)}}const u=class u extends z{constructor(e){super(e);o(this,"onDisposed",new p);o(this,"onIfcStartedLoading",new p);o(this,"onIfcImporterInitialized",new p);o(this,"onSetup",new p);o(this,"settings",new R);o(this,"webIfc",new I);o(this,"enabled",!0);this.components.add(u.uuid,this)}dispose(){this.webIfc=null,this.onDisposed.trigger(u.uuid),this.onDisposed.reset()}async setup(e){this.settings={...this.settings,...e},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(e,a,i,n){const f=this.components.get(S);if(!f.initialized)throw new Error("You need to initialize fragments first.");this.settings.autoSetWasm&&await this.autoSetWasm(),f.core.settings.autoCoordinate=a;const d=new O;d.wasm.path=this.settings.wasm.path,d.wasm.absolute=this.settings.wasm.absolute,d.webIfcSettings=this.settings.webIfc,this.onIfcImporterInitialized.trigger(d),n!=null&&n.instanceCallback&&n.instanceCallback(d);const y=await d.process({...n==null?void 0:n.processData,bytes:e});return await f.core.load(y,{modelId:i,userData:n==null?void 0:n.userData})}async readIfcFile(e){const{path:a,absolute:i,logLevel:n}=this.settings.wasm;return this.webIfc.SetWasmPath(a,i),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModel(e,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new I}async autoSetWasm(){const e=await fetch(`https://unpkg.com/@thatopen/components@${k.release}/package.json`);if(!e.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const a=await e.json();if(!("web-ifc"in a.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const i=a.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${i}/`,this.settings.wasm.absolute=!0}}};o(u,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");let h=u;const l=new k,$=l.get(E),c=$.create();c.scene=new U(l);c.scene.setup();c.scene.three.background=null;const _=document.getElementById("container");c.renderer=new j(l,_);c.camera=new B(l);await c.camera.controls.setLookAt(78,20,-2.2,26,-4,25);l.init();l.get(P).create(c);const g=l.get(h);g.onIfcImporterInitialized.add(t=>{console.log(t.classes)});await g.setup({autoSetWasm:!1,wasm:{path:"https://unpkg.com/web-ifc@0.0.72/",absolute:!0}});const A="https://thatopen.github.io/engine_fragment/resources/worker.mjs",r=l.get(S);r.init(A);c.camera.controls.addEventListener("rest",()=>r.core.update(!0));r.list.onItemSet.add(({value:t})=>{t.useCamera(c.camera.three),c.scene.three.add(t.object),r.core.update(!0)});const x=async t=>{const e=await(await fetch(t)).arrayBuffer(),a=new Uint8Array(e);await g.load(a,!1,"example",{processData:{progressCallback:i=>console.log(i)}})},G=async()=>{const[t]=r.list.values();if(!t)return;const s=await t.getBuffer(!1),e=new File([s],"school_str.frag"),a=document.createElement("a");a.href=URL.createObjectURL(e),a.download=e.name,a.click(),URL.revokeObjectURL(a.href)};D.init();const[w,V]=L.create(t=>{let s;r.list.size>0&&(s=b`
      <bim-button label="Download Fragments" @click=${G}></bim-button>
    `);let e;return r.list.size===0&&(e=b`
      <bim-button label="Load IFC" @click=${async({target:i})=>{i.label="Conversion in progress...",i.loading=!0,await x("https://thatopen.github.io/engine_components/resources/ifc/school_str.ifc"),i.loading=!1,i.label="Load IFC"}}></bim-button>
      <bim-label>Open the console to see the progress!</bim-label>
    `),b`
    <bim-panel active label="IfcLoader Tutorial" class="options-menu">
      <bim-panel-section label="Controls">
        ${e}
        ${s}
      </bim-panel-section>
    </bim-panel>
  `},{});document.body.append(w);r.list.onItemSet.add(()=>V());const N=L.create(()=>b`
      <bim-button class="phone-menu-toggler" icon="solar:settings-bold"
        @click="${()=>{w.classList.contains("options-menu-visible")?w.classList.remove("options-menu-visible"):w.classList.add("options-menu-visible")}}">
      </bim-button>
    `);document.body.append(N);const m=new W;m.showPanel(2);document.body.append(m.dom);m.dom.style.left="0px";m.dom.style.zIndex="unset";c.renderer.onBeforeUpdate.add(()=>m.begin());c.renderer.onAfterUpdate.add(()=>m.end());
